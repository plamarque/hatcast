<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test √âtat Connexion</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background: #22c55e; }
        .disconnected { background: #ef4444; }
        .info { background: #3b82f6; }
    </style>
</head>
<body>
    <h1>üîç Test √âtat Connexion Firebase</h1>
    
    <div id="status" class="status disconnected">
        Chargement...
    </div>
    
    <div id="details" class="status info">
        D√©tails en cours de chargement...
    </div>
    
    <script type="module">
        // Importer Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js'
        
        // Configuration Firebase (√† adapter selon votre config)
        const firebaseConfig = {
            apiKey: "AIzaSyBXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
            authDomain: "hatcast-XXXXX.firebaseapp.com",
            projectId: "hatcast-XXXXX",
            storageBucket: "hatcast-XXXXX.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        }
        
        // Initialiser Firebase
        const app = initializeApp(firebaseConfig)
        const auth = getAuth(app)
        
        const statusDiv = document.getElementById('status')
        const detailsDiv = document.getElementById('details')
        
        // √âcouter les changements d'√©tat d'authentification
        onAuthStateChanged(auth, (user) => {
            if (user) {
                statusDiv.className = 'status connected'
                statusDiv.textContent = '‚úÖ Connect√©'
                
                detailsDiv.innerHTML = `
                    <strong>Utilisateur connect√© :</strong><br>
                    Email: ${user.email}<br>
                    UID: ${user.uid}<br>
                    Email v√©rifi√©: ${user.emailVerified}<br>
                    Date de connexion: ${new Date(user.metadata.lastSignInTime).toLocaleString()}
                `
            } else {
                statusDiv.className = 'status disconnected'
                statusDiv.textContent = '‚ùå Non connect√©'
                
                detailsDiv.innerHTML = `
                    <strong>Aucun utilisateur connect√©</strong><br>
                    Vous devez vous connecter pour tester l'activation directe des notifications.
                `
            }
        })
        
        // Test de comparaison d'email
        const testEmail = 'patrice.lamarque@gmail.com'
        console.log('üß™ Test de comparaison d\'email:', testEmail)
        
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const isSameEmail = user.email === testEmail
                console.log('üìß Comparaison email:', {
                    userEmail: user.email,
                    testEmail: testEmail,
                    isSame: isSameEmail
                })
            }
        })
    </script>
</body>
</html>
