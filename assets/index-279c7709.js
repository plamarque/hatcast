(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function jm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Ut={},rl=[],ts=()=>{},IA=()=>!1,Fh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Bm=n=>n.startsWith("onUpdate:"),Rn=Object.assign,qm=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},EA=Object.prototype.hasOwnProperty,Ot=(n,e)=>EA.call(n,e),We=Array.isArray,sl=n=>Dc(n)==="[object Map]",Ml=n=>Dc(n)==="[object Set]",xy=n=>Dc(n)==="[object Date]",nt=n=>typeof n=="function",hn=n=>typeof n=="string",is=n=>typeof n=="symbol",jt=n=>n!==null&&typeof n=="object",jb=n=>(jt(n)||nt(n))&&nt(n.then)&&nt(n.catch),Bb=Object.prototype.toString,Dc=n=>Bb.call(n),TA=n=>Dc(n).slice(8,-1),qb=n=>Dc(n)==="[object Object]",zm=n=>hn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Vu=jm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Uh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},AA=/-(\w)/g,Gr=Uh(n=>n.replace(AA,(e,t)=>t?t.toUpperCase():"")),SA=/\B([A-Z])/g,fo=Uh(n=>n.replace(SA,"-$1").toLowerCase()),jh=Uh(n=>n.charAt(0).toUpperCase()+n.slice(1)),Yf=Uh(n=>n?`on${jh(n)}`:""),Ji=(n,e)=>!Object.is(n,e),$d=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},$p=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},ih=n=>{const e=parseFloat(n);return isNaN(e)?n:e},PA=n=>{const e=hn(n)?Number(n):NaN;return isNaN(e)?n:e};let Iy;const Bh=()=>Iy||(Iy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Vr(n){if(We(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=hn(r)?DA(r):Vr(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(hn(n)||jt(n))return n}const RA=/;(?![^(]*\))/g,CA=/:([^]+)/,kA=/\/\*[^]*?\*\//g;function DA(n){const e={};return n.replace(kA,"").split(RA).forEach(t=>{if(t){const r=t.split(CA);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function wn(n){let e="";if(hn(n))e=n;else if(We(n))for(let t=0;t<n.length;t++){const r=wn(n[t]);r&&(e+=r+" ")}else if(jt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const NA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",OA=jm(NA);function zb(n){return!!n||n===""}function VA(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Nc(n[r],e[r]);return t}function Nc(n,e){if(n===e)return!0;let t=xy(n),r=xy(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=is(n),r=is(e),t||r)return n===e;if(t=We(n),r=We(e),t||r)return t&&r?VA(n,e):!1;if(t=jt(n),r=jt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Nc(n[o],e[o]))return!1}}return String(n)===String(e)}function Hm(n,e){return n.findIndex(t=>Nc(t,e))}const Hb=n=>!!(n&&n.__v_isRef===!0),te=n=>hn(n)?n:n==null?"":We(n)||jt(n)&&(n.toString===Bb||!nt(n.toString))?Hb(n)?te(n.value):JSON.stringify(n,Kb,2):String(n),Kb=(n,e)=>Hb(e)?Kb(n,e.value):sl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Xf(r,i)+" =>"]=s,t),{})}:Ml(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Xf(t))}:is(e)?Xf(e):jt(e)&&!We(e)&&!qb(e)?String(e):e,Xf=(n,e="")=>{var t;return is(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ir;class MA{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ir,!e&&Ir&&(this.index=(Ir.scopes||(Ir.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Ir;try{return Ir=this,e()}finally{Ir=t}}}on(){++this._on===1&&(this.prevScope=Ir,Ir=this)}off(){this._on>0&&--this._on===0&&(Ir=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function LA(){return Ir}let zt;const Zf=new WeakSet;class Gb{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ir&&Ir.active&&Ir.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Zf.has(this)&&(Zf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Qb(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ey(this),Jb(this);const e=zt,t=ns;zt=this,ns=!0;try{return this.fn()}finally{Yb(this),zt=e,ns=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Wm(e);this.deps=this.depsTail=void 0,Ey(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Zf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Fp(this)&&this.run()}get dirty(){return Fp(this)}}let Wb=0,Mu,Lu;function Qb(n,e=!1){if(n.flags|=8,e){n.next=Lu,Lu=n;return}n.next=Mu,Mu=n}function Km(){Wb++}function Gm(){if(--Wb>0)return;if(Lu){let e=Lu;for(Lu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Mu;){let e=Mu;for(Mu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Jb(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Yb(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Wm(r),$A(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Fp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Xb(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function Xb(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Zu)||(n.globalVersion=Zu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Fp(n))))return;n.flags|=2;const e=n.dep,t=zt,r=ns;zt=n,ns=!0;try{Jb(n);const s=n.fn(n._value);(e.version===0||Ji(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{zt=t,ns=r,Yb(n),n.flags&=-3}}function Wm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Wm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function $A(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let ns=!0;const Zb=[];function Xs(){Zb.push(ns),ns=!1}function Zs(){const n=Zb.pop();ns=n===void 0?!0:n}function Ey(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=zt;zt=void 0;try{e()}finally{zt=t}}}let Zu=0;class FA{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Qm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!zt||!ns||zt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==zt)t=this.activeLink=new FA(zt,this),zt.deps?(t.prevDep=zt.depsTail,zt.depsTail.nextDep=t,zt.depsTail=t):zt.deps=zt.depsTail=t,ew(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=zt.depsTail,t.nextDep=void 0,zt.depsTail.nextDep=t,zt.depsTail=t,zt.deps===t&&(zt.deps=r)}return t}trigger(e){this.version++,Zu++,this.notify(e)}notify(e){Km();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Gm()}}}function ew(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)ew(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Up=new WeakMap,Jo=Symbol(""),jp=Symbol(""),ec=Symbol("");function ir(n,e,t){if(ns&&zt){let r=Up.get(n);r||Up.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Qm),s.map=r,s.key=t),s.track()}}function Fs(n,e,t,r,s,i){const o=Up.get(n);if(!o){Zu++;return}const a=l=>{l&&l.trigger()};if(Km(),e==="clear")o.forEach(a);else{const l=We(n),c=l&&zm(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,m)=>{(m==="length"||m===ec||!is(m)&&m>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(ec)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Jo)),sl(n)&&a(o.get(jp)));break;case"delete":l||(a(o.get(Jo)),sl(n)&&a(o.get(jp)));break;case"set":sl(n)&&a(o.get(Jo));break}}Gm()}function za(n){const e=Pt(n);return e===n?e:(ir(e,"iterate",ec),Kr(n)?e:e.map(Qn))}function qh(n){return ir(n=Pt(n),"iterate",ec),n}const UA={__proto__:null,[Symbol.iterator](){return ep(this,Symbol.iterator,Qn)},concat(...n){return za(this).concat(...n.map(e=>We(e)?za(e):e))},entries(){return ep(this,"entries",n=>(n[1]=Qn(n[1]),n))},every(n,e){return Os(this,"every",n,e,void 0,arguments)},filter(n,e){return Os(this,"filter",n,e,t=>t.map(Qn),arguments)},find(n,e){return Os(this,"find",n,e,Qn,arguments)},findIndex(n,e){return Os(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Os(this,"findLast",n,e,Qn,arguments)},findLastIndex(n,e){return Os(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Os(this,"forEach",n,e,void 0,arguments)},includes(...n){return tp(this,"includes",n)},indexOf(...n){return tp(this,"indexOf",n)},join(n){return za(this).join(n)},lastIndexOf(...n){return tp(this,"lastIndexOf",n)},map(n,e){return Os(this,"map",n,e,void 0,arguments)},pop(){return mu(this,"pop")},push(...n){return mu(this,"push",n)},reduce(n,...e){return Ty(this,"reduce",n,e)},reduceRight(n,...e){return Ty(this,"reduceRight",n,e)},shift(){return mu(this,"shift")},some(n,e){return Os(this,"some",n,e,void 0,arguments)},splice(...n){return mu(this,"splice",n)},toReversed(){return za(this).toReversed()},toSorted(n){return za(this).toSorted(n)},toSpliced(...n){return za(this).toSpliced(...n)},unshift(...n){return mu(this,"unshift",n)},values(){return ep(this,"values",Qn)}};function ep(n,e,t){const r=qh(n),s=r[e]();return r!==n&&!Kr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const jA=Array.prototype;function Os(n,e,t,r,s,i){const o=qh(n),a=o!==n&&!Kr(n),l=o[e];if(l!==jA[e]){const f=l.apply(n,i);return a?Qn(f):f}let c=t;o!==n&&(a?c=function(f,m){return t.call(this,Qn(f),m,n)}:t.length>2&&(c=function(f,m){return t.call(this,f,m,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function Ty(n,e,t,r){const s=qh(n);let i=t;return s!==n&&(Kr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Qn(a),l,n)}),s[e](i,...r)}function tp(n,e,t){const r=Pt(n);ir(r,"iterate",ec);const s=r[e](...t);return(s===-1||s===!1)&&Xm(t[0])?(t[0]=Pt(t[0]),r[e](...t)):s}function mu(n,e,t=[]){Xs(),Km();const r=Pt(n)[e].apply(n,t);return Gm(),Zs(),r}const BA=jm("__proto__,__v_isRef,__isVue"),tw=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(is));function qA(n){is(n)||(n=String(n));const e=Pt(this);return ir(e,"has",n),e.hasOwnProperty(n)}class nw{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?ZA:ow:i?iw:sw).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=We(e);if(!s){let l;if(o&&(l=UA[t]))return l;if(t==="hasOwnProperty")return qA}const a=Reflect.get(e,t,ar(e)?e:r);return(is(t)?tw.has(t):BA(t))||(s||ir(e,"get",t),i)?a:ar(a)?o&&zm(t)?a:a.value:jt(a)?s?lw(a):zh(a):a}}class rw extends nw{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=to(i);if(!Kr(r)&&!to(r)&&(i=Pt(i),r=Pt(r)),!We(e)&&ar(i)&&!ar(r))return l?!1:(i.value=r,!0)}const o=We(e)&&zm(t)?Number(t)<e.length:Ot(e,t),a=Reflect.set(e,t,r,ar(e)?e:s);return e===Pt(s)&&(o?Ji(r,i)&&Fs(e,"set",t,r):Fs(e,"add",t,r)),a}deleteProperty(e,t){const r=Ot(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Fs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!is(t)||!tw.has(t))&&ir(e,"has",t),r}ownKeys(e){return ir(e,"iterate",We(e)?"length":Jo),Reflect.ownKeys(e)}}class zA extends nw{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const HA=new rw,KA=new zA,GA=new rw(!0);const Bp=n=>n,wd=n=>Reflect.getPrototypeOf(n);function WA(n,e,t){return function(...r){const s=this.__v_raw,i=Pt(s),o=sl(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?Bp:e?oh:Qn;return!e&&ir(i,"iterate",l?jp:Jo),{next(){const{value:f,done:m}=c.next();return m?{value:f,done:m}:{value:a?[h(f[0]),h(f[1])]:h(f),done:m}},[Symbol.iterator](){return this}}}}function xd(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function QA(n,e){const t={get(s){const i=this.__v_raw,o=Pt(i),a=Pt(s);n||(Ji(s,a)&&ir(o,"get",s),ir(o,"get",a));const{has:l}=wd(o),c=e?Bp:n?oh:Qn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&ir(Pt(s),"iterate",Jo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Pt(i),a=Pt(s);return n||(Ji(s,a)&&ir(o,"has",s),ir(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Pt(a),c=e?Bp:n?oh:Qn;return!n&&ir(l,"iterate",Jo),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return Rn(t,n?{add:xd("add"),set:xd("set"),delete:xd("delete"),clear:xd("clear")}:{add(s){!e&&!Kr(s)&&!to(s)&&(s=Pt(s));const i=Pt(this);return wd(i).has.call(i,s)||(i.add(s),Fs(i,"add",s,s)),this},set(s,i){!e&&!Kr(i)&&!to(i)&&(i=Pt(i));const o=Pt(this),{has:a,get:l}=wd(o);let c=a.call(o,s);c||(s=Pt(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Ji(i,h)&&Fs(o,"set",s,i):Fs(o,"add",s,i),this},delete(s){const i=Pt(this),{has:o,get:a}=wd(i);let l=o.call(i,s);l||(s=Pt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&Fs(i,"delete",s,void 0),c},clear(){const s=Pt(this),i=s.size!==0,o=s.clear();return i&&Fs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=WA(s,n,e)}),t}function Jm(n,e){const t=QA(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Ot(t,s)&&s in r?t:r,s,i)}const JA={get:Jm(!1,!1)},YA={get:Jm(!1,!0)},XA={get:Jm(!0,!1)};const sw=new WeakMap,iw=new WeakMap,ow=new WeakMap,ZA=new WeakMap;function eS(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function tS(n){return n.__v_skip||!Object.isExtensible(n)?0:eS(TA(n))}function zh(n){return to(n)?n:Ym(n,!1,HA,JA,sw)}function aw(n){return Ym(n,!1,GA,YA,iw)}function lw(n){return Ym(n,!0,KA,XA,ow)}function Ym(n,e,t,r,s){if(!jt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=tS(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function il(n){return to(n)?il(n.__v_raw):!!(n&&n.__v_isReactive)}function to(n){return!!(n&&n.__v_isReadonly)}function Kr(n){return!!(n&&n.__v_isShallow)}function Xm(n){return n?!!n.__v_raw:!1}function Pt(n){const e=n&&n.__v_raw;return e?Pt(e):n}function nS(n){return!Ot(n,"__v_skip")&&Object.isExtensible(n)&&$p(n,"__v_skip",!0),n}const Qn=n=>jt(n)?zh(n):n,oh=n=>jt(n)?lw(n):n;function ar(n){return n?n.__v_isRef===!0:!1}function R(n){return uw(n,!1)}function rS(n){return uw(n,!0)}function uw(n,e){return ar(n)?n:new sS(n,e)}class sS{constructor(e,t){this.dep=new Qm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Pt(e),this._value=t?e:Qn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Kr(e)||to(e);e=r?e:Pt(e),Ji(e,t)&&(this._rawValue=e,this._value=r?e:Qn(e),this.dep.trigger())}}function rs(n){return ar(n)?n.value:n}const iS={get:(n,e,t)=>e==="__v_raw"?n:rs(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return ar(s)&&!ar(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function cw(n){return il(n)?n:new Proxy(n,iS)}class oS{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Qm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Zu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&zt!==this)return Qb(this,!0),!0}get value(){const e=this.dep.track();return Xb(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function aS(n,e,t=!1){let r,s;return nt(n)?r=n:(r=n.get,s=n.set),new oS(r,s,t)}const Id={},ah=new WeakMap;let Lo;function lS(n,e=!1,t=Lo){if(t){let r=ah.get(t);r||ah.set(t,r=[]),r.push(n)}}function uS(n,e,t=Ut){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=B=>s?B:Kr(B)||s===!1||s===0?Us(B,1):Us(B);let h,f,m,v,w=!1,x=!1;if(ar(n)?(f=()=>n.value,w=Kr(n)):il(n)?(f=()=>c(n),w=!0):We(n)?(x=!0,w=n.some(B=>il(B)||Kr(B)),f=()=>n.map(B=>{if(ar(B))return B.value;if(il(B))return c(B);if(nt(B))return l?l(B,2):B()})):nt(n)?e?f=l?()=>l(n,2):n:f=()=>{if(m){Xs();try{m()}finally{Zs()}}const B=Lo;Lo=h;try{return l?l(n,3,[v]):n(v)}finally{Lo=B}}:f=ts,e&&s){const B=f,ne=s===!0?1/0:s;f=()=>Us(B(),ne)}const A=LA(),L=()=>{h.stop(),A&&A.active&&qm(A.effects,h)};if(i&&e){const B=e;e=(...ne)=>{B(...ne),L()}}let F=x?new Array(n.length).fill(Id):Id;const $=B=>{if(!(!(h.flags&1)||!h.dirty&&!B))if(e){const ne=h.run();if(s||w||(x?ne.some((re,T)=>Ji(re,F[T])):Ji(ne,F))){m&&m();const re=Lo;Lo=h;try{const T=[ne,F===Id?void 0:x&&F[0]===Id?[]:F,v];F=ne,l?l(e,3,T):e(...T)}finally{Lo=re}}}else h.run()};return a&&a($),h=new Gb(f),h.scheduler=o?()=>o($,!1):$,v=B=>lS(B,!1,h),m=h.onStop=()=>{const B=ah.get(h);if(B){if(l)l(B,4);else for(const ne of B)ne();ah.delete(h)}},e?r?$(!0):F=h.run():o?o($.bind(null,!0),!0):h.run(),L.pause=h.pause.bind(h),L.resume=h.resume.bind(h),L.stop=L,L}function Us(n,e=1/0,t){if(e<=0||!jt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,ar(n))Us(n.value,e,t);else if(We(n))for(let r=0;r<n.length;r++)Us(n[r],e,t);else if(Ml(n)||sl(n))n.forEach(r=>{Us(r,e,t)});else if(qb(n)){for(const r in n)Us(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Us(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Oc(n,e,t,r){try{return r?n(...r):n()}catch(s){Hh(s,e,t)}}function os(n,e,t,r){if(nt(n)){const s=Oc(n,e,t,r);return s&&jb(s)&&s.catch(i=>{Hh(i,e,t)}),s}if(We(n)){const s=[];for(let i=0;i<n.length;i++)s.push(os(n[i],e,t,r));return s}}function Hh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Ut;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){Xs(),Oc(i,null,10,[n,l,c]),Zs();return}}cS(n,t,s,r,o)}function cS(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const pr=[];let _s=-1;const ol=[];let Oi=null,Qa=0;const dw=Promise.resolve();let lh=null;function Zt(n){const e=lh||dw;return n?e.then(this?n.bind(this):n):e}function dS(n){let e=_s+1,t=pr.length;for(;e<t;){const r=e+t>>>1,s=pr[r],i=tc(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Zm(n){if(!(n.flags&1)){const e=tc(n),t=pr[pr.length-1];!t||!(n.flags&2)&&e>=tc(t)?pr.push(n):pr.splice(dS(e),0,n),n.flags|=1,hw()}}function hw(){lh||(lh=dw.then(pw))}function hS(n){We(n)?ol.push(...n):Oi&&n.id===-1?Oi.splice(Qa+1,0,n):n.flags&1||(ol.push(n),n.flags|=1),hw()}function Ay(n,e,t=_s+1){for(;t<pr.length;t++){const r=pr[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;pr.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function fw(n){if(ol.length){const e=[...new Set(ol)].sort((t,r)=>tc(t)-tc(r));if(ol.length=0,Oi){Oi.push(...e);return}for(Oi=e,Qa=0;Qa<Oi.length;Qa++){const t=Oi[Qa];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Oi=null,Qa=0}}const tc=n=>n.id==null?n.flags&2?-1:1/0:n.id;function pw(n){const e=ts;try{for(_s=0;_s<pr.length;_s++){const t=pr[_s];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Oc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;_s<pr.length;_s++){const t=pr[_s];t&&(t.flags&=-2)}_s=-1,pr.length=0,fw(),lh=null,(pr.length||ol.length)&&pw()}}let Bn=null,mw=null;function uh(n){const e=Bn;return Bn=n,mw=n&&n.type.__scopeId||null,e}function Fd(n,e=Bn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Fy(-1);const i=uh(e);let o;try{o=n(...s)}finally{uh(i),r._d&&Fy(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function lt(n,e){if(Bn===null)return n;const t=Jh(Bn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Ut]=e[s];i&&(nt(i)&&(i={mounted:i,updated:i}),i.deep&&Us(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Do(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Xs(),os(l,t,8,[n.el,a,n,e]),Zs())}}const gw=Symbol("_vte"),vw=n=>n.__isTeleport,$u=n=>n&&(n.disabled||n.disabled===""),Sy=n=>n&&(n.defer||n.defer===""),Py=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Ry=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,qp=(n,e)=>{const t=n&&n.to;return hn(t)?e?e(t):null:t},yw={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:m,o:{insert:v,querySelector:w,createText:x,createComment:A}}=c,L=$u(e.props);let{shapeFlag:F,children:$,dynamicChildren:B}=e;if(n==null){const ne=e.el=x(""),re=e.anchor=x("");v(ne,t,r),v(re,t,r);const T=(E,k)=>{F&16&&(s&&s.isCE&&(s.ce._teleportTarget=E),h($,E,k,s,i,o,a,l))},_=()=>{const E=e.target=qp(e.props,w),k=_w(E,e,x,v);E&&(o!=="svg"&&Py(E)?o="svg":o!=="mathml"&&Ry(E)&&(o="mathml"),L||(T(E,k),Ud(e,!1)))};L&&(T(t,re),Ud(e,!0)),Sy(e.props)?(e.el.__isMounted=!1,fr(()=>{_(),delete e.el.__isMounted},i)):_()}else{if(Sy(e.props)&&n.el.__isMounted===!1){fr(()=>{yw.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const ne=e.anchor=n.anchor,re=e.target=n.target,T=e.targetAnchor=n.targetAnchor,_=$u(n.props),E=_?t:re,k=_?ne:T;if(o==="svg"||Py(re)?o="svg":(o==="mathml"||Ry(re))&&(o="mathml"),B?(m(n.dynamicChildren,B,E,s,i,o,a),sg(n,e,!0)):l||f(n,e,E,k,s,i,o,a,!1),L)_?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Ed(e,t,ne,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const D=e.target=qp(e.props,w);D&&Ed(e,D,null,c,0)}else _&&Ed(e,re,T,c,1);Ud(e,L)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:m}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const v=i||!$u(m);for(let w=0;w<a.length;w++){const x=a[w];r(x,e,t,v,!!x.dynamicChildren)}}},move:Ed,hydrate:fS};function Ed(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||$u(h))&&l&16)for(let m=0;m<c.length;m++)s(c[m],e,t,2);f&&r(a,e,t)}function fS(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const m=e.target=qp(e.props,l);if(m){const v=$u(e.props),w=m._lpa||m.firstChild;if(e.shapeFlag&16)if(v)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=w,e.targetAnchor=w&&o(w);else{e.anchor=o(n);let x=w;for(;x;){if(x&&x.nodeType===8){if(x.data==="teleport start anchor")e.targetStart=x;else if(x.data==="teleport anchor"){e.targetAnchor=x,m._lpa=e.targetAnchor&&o(e.targetAnchor);break}}x=o(x)}e.targetAnchor||_w(m,e,h,c),f(w&&o(w),e,m,t,r,s,i)}Ud(e,v)}return e.anchor&&o(e.anchor)}const nc=yw;function Ud(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function _w(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[gw]=i,n&&(r(s,n),r(i,n)),i}const Vi=Symbol("_leaveCb"),Td=Symbol("_enterCb");function pS(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return En(()=>{n.isMounted=!0}),eg(()=>{n.isUnmounting=!0}),n}const Hr=[Function,Array],bw={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Hr,onEnter:Hr,onAfterEnter:Hr,onEnterCancelled:Hr,onBeforeLeave:Hr,onLeave:Hr,onAfterLeave:Hr,onLeaveCancelled:Hr,onBeforeAppear:Hr,onAppear:Hr,onAfterAppear:Hr,onAppearCancelled:Hr},ww=n=>{const e=n.subTree;return e.component?ww(e.component):e},mS={name:"BaseTransition",props:bw,setup(n,{slots:e}){const t=hP(),r=pS();return()=>{const s=e.default&&Ew(e.default(),!0);if(!s||!s.length)return;const i=xw(s),o=Pt(n),{mode:a}=o;if(r.isLeaving)return np(i);const l=Cy(i);if(!l)return np(i);let c=zp(l,o,r,t,f=>c=f);l.type!==or&&rc(l,c);let h=t.subTree&&Cy(t.subTree);if(h&&h.type!==or&&!Bo(l,h)&&ww(t).type!==or){let f=zp(h,o,r,t);if(rc(h,f),a==="out-in"&&l.type!==or)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,h=void 0},np(i);a==="in-out"&&l.type!==or?f.delayLeave=(m,v,w)=>{const x=Iw(r,h);x[String(h.key)]=h,m[Vi]=()=>{v(),m[Vi]=void 0,delete c.delayedLeave,h=void 0},c.delayedLeave=()=>{w(),delete c.delayedLeave,h=void 0}}:h=void 0}else h&&(h=void 0);return i}}};function xw(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==or){e=t;break}}return e}const gS=mS;function Iw(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function zp(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:h,onEnterCancelled:f,onBeforeLeave:m,onLeave:v,onAfterLeave:w,onLeaveCancelled:x,onBeforeAppear:A,onAppear:L,onAfterAppear:F,onAppearCancelled:$}=e,B=String(n.key),ne=Iw(t,n),re=(E,k)=>{E&&os(E,r,9,k)},T=(E,k)=>{const D=k[1];re(E,k),We(E)?E.every(S=>S.length<=1)&&D():E.length<=1&&D()},_={mode:o,persisted:a,beforeEnter(E){let k=l;if(!t.isMounted)if(i)k=A||l;else return;E[Vi]&&E[Vi](!0);const D=ne[B];D&&Bo(n,D)&&D.el[Vi]&&D.el[Vi](),re(k,[E])},enter(E){let k=c,D=h,S=f;if(!t.isMounted)if(i)k=L||c,D=F||h,S=$||f;else return;let P=!1;const ke=E[Td]=Re=>{P||(P=!0,Re?re(S,[E]):re(D,[E]),_.delayedLeave&&_.delayedLeave(),E[Td]=void 0)};k?T(k,[E,ke]):ke()},leave(E,k){const D=String(n.key);if(E[Td]&&E[Td](!0),t.isUnmounting)return k();re(m,[E]);let S=!1;const P=E[Vi]=ke=>{S||(S=!0,k(),ke?re(x,[E]):re(w,[E]),E[Vi]=void 0,ne[D]===n&&delete ne[D])};ne[D]=n,v?T(v,[E,P]):P()},clone(E){const k=zp(E,e,t,r,s);return s&&s(k),k}};return _}function np(n){if(Kh(n))return n=no(n),n.children=null,n}function Cy(n){if(!Kh(n))return vw(n.type)&&n.children?xw(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&nt(t.default))return t.default()}}function rc(n,e){n.shapeFlag&6&&n.component?(n.transition=e,rc(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Ew(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===ft?(o.patchFlag&128&&s++,r=r.concat(Ew(o.children,e,a))):(e||o.type!==or)&&r.push(a!=null?no(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function Tw(n,e){return nt(n)?(()=>Rn({name:n.name},e,{setup:n}))():n}function Aw(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Fu(n,e,t,r,s=!1){if(We(n)){n.forEach((w,x)=>Fu(w,e&&(We(e)?e[x]:e),t,r,s));return}if(al(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Fu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Jh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Ut?a.refs={}:a.refs,f=a.setupState,m=Pt(f),v=f===Ut?()=>!1:w=>Ot(m,w);if(c!=null&&c!==l&&(hn(c)?(h[c]=null,v(c)&&(f[c]=null)):ar(c)&&(c.value=null)),nt(l))Oc(l,a,12,[o,h]);else{const w=hn(l),x=ar(l);if(w||x){const A=()=>{if(n.f){const L=w?v(l)?f[l]:h[l]:l.value;s?We(L)&&qm(L,i):We(L)?L.includes(i)||L.push(i):w?(h[l]=[i],v(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else w?(h[l]=o,v(l)&&(f[l]=o)):x&&(l.value=o,n.k&&(h[n.k]=o))};o?(A.id=-1,fr(A,t)):A()}}}Bh().requestIdleCallback;Bh().cancelIdleCallback;const al=n=>!!n.type.__asyncLoader,Kh=n=>n.type.__isKeepAlive;function vS(n,e){Sw(n,"a",e)}function yS(n,e){Sw(n,"da",e)}function Sw(n,e,t=Jn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Gh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Kh(s.parent.vnode)&&_S(r,e,t,s),s=s.parent}}function _S(n,e,t,r){const s=Gh(e,n,r,!0);Ks(()=>{qm(r[e],s)},t)}function Gh(n,e,t=Jn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Xs();const a=Vc(t),l=os(e,t,n,o);return a(),Zs(),l});return r?s.unshift(i):s.push(i),i}}const ai=n=>(e,t=Jn)=>{(!oc||n==="sp")&&Gh(n,(...r)=>e(...r),t)},bS=ai("bm"),En=ai("m"),wS=ai("bu"),xS=ai("u"),eg=ai("bum"),Ks=ai("um"),IS=ai("sp"),ES=ai("rtg"),TS=ai("rtc");function AS(n,e=Jn){Gh("ec",n,e)}const Pw="components";function SS(n,e){return RS(Pw,n,!0,e)||n}const PS=Symbol.for("v-ndc");function RS(n,e,t=!0,r=!1){const s=Bn||Jn;if(s){const i=s.type;if(n===Pw){const a=vP(i,!1);if(a&&(a===e||a===Gr(e)||a===jh(Gr(e))))return i}const o=ky(s[n]||i[n],e)||ky(s.appContext[n],e);return!o&&r?i:o}}function ky(n,e){return n&&(n[e]||n[Gr(e)]||n[jh(Gr(e))])}function Mr(n,e,t,r){let s;const i=t&&t[r],o=We(n);if(o||hn(n)){const a=o&&il(n);let l=!1,c=!1;a&&(l=!Kr(n),c=to(n),n=qh(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?oh(Qn(n[h])):Qn(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(jt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function CS(n,e,t={},r,s){if(Bn.ce||Bn.parent&&al(Bn.parent)&&Bn.parent.ce)return e!=="default"&&(t.name=e),N(),Gs(ft,null,[Ye("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),N();const o=i&&Rw(i(t)),a=t.key||o&&o.key,l=Gs(ft,{key:(a&&!is(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function Rw(n){return n.some(e=>ic(e)?!(e.type===or||e.type===ft&&!Rw(e.children)):!0)?n:null}const Hp=n=>n?Gw(n)?Jh(n):Hp(n.parent):null,Uu=Rn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Hp(n.parent),$root:n=>Hp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>tg(n),$forceUpdate:n=>n.f||(n.f=()=>{Zm(n.update)}),$nextTick:n=>n.n||(n.n=Zt.bind(n.proxy)),$watch:n=>YS.bind(n)}),rp=(n,e)=>n!==Ut&&!n.__isScriptSetup&&Ot(n,e),kS={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(rp(r,e))return o[e]=1,r[e];if(s!==Ut&&Ot(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&Ot(c,e))return o[e]=3,i[e];if(t!==Ut&&Ot(t,e))return o[e]=4,t[e];Kp&&(o[e]=0)}}const h=Uu[e];let f,m;if(h)return e==="$attrs"&&ir(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Ut&&Ot(t,e))return o[e]=4,t[e];if(m=l.config.globalProperties,Ot(m,e))return m[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return rp(s,e)?(s[e]=t,!0):r!==Ut&&Ot(r,e)?(r[e]=t,!0):Ot(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Ut&&Ot(n,o)||rp(e,o)||(a=i[0])&&Ot(a,o)||Ot(r,o)||Ot(Uu,o)||Ot(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Ot(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Dy(n){return We(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Kp=!0;function DS(n){const e=tg(n),t=n.proxy,r=n.ctx;Kp=!1,e.beforeCreate&&Ny(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:m,beforeUpdate:v,updated:w,activated:x,deactivated:A,beforeDestroy:L,beforeUnmount:F,destroyed:$,unmounted:B,render:ne,renderTracked:re,renderTriggered:T,errorCaptured:_,serverPrefetch:E,expose:k,inheritAttrs:D,components:S,directives:P,filters:ke}=e;if(c&&NS(c,r,null),o)for(const Ce in o){const _e=o[Ce];nt(_e)&&(r[Ce]=_e.bind(t))}if(s){const Ce=s.call(t,t);jt(Ce)&&(n.data=zh(Ce))}if(Kp=!0,i)for(const Ce in i){const _e=i[Ce],le=nt(_e)?_e.bind(t,t):nt(_e.get)?_e.get.bind(t,t):ts,Je=!nt(_e)&&nt(_e.set)?_e.set.bind(t):ts,oe=Ue({get:le,set:Je});Object.defineProperty(r,Ce,{enumerable:!0,configurable:!0,get:()=>oe.value,set:Z=>oe.value=Z})}if(a)for(const Ce in a)Cw(a[Ce],r,t,Ce);if(l){const Ce=nt(l)?l.call(t):l;Reflect.ownKeys(Ce).forEach(_e=>{jd(_e,Ce[_e])})}h&&Ny(h,n,"c");function Pe(Ce,_e){We(_e)?_e.forEach(le=>Ce(le.bind(t))):_e&&Ce(_e.bind(t))}if(Pe(bS,f),Pe(En,m),Pe(wS,v),Pe(xS,w),Pe(vS,x),Pe(yS,A),Pe(AS,_),Pe(TS,re),Pe(ES,T),Pe(eg,F),Pe(Ks,B),Pe(IS,E),We(k))if(k.length){const Ce=n.exposed||(n.exposed={});k.forEach(_e=>{Object.defineProperty(Ce,_e,{get:()=>t[_e],set:le=>t[_e]=le})})}else n.exposed||(n.exposed={});ne&&n.render===ts&&(n.render=ne),D!=null&&(n.inheritAttrs=D),S&&(n.components=S),P&&(n.directives=P),E&&Aw(n)}function NS(n,e,t=ts){We(n)&&(n=Gp(n));for(const r in n){const s=n[r];let i;jt(s)?"default"in s?i=ss(s.from||r,s.default,!0):i=ss(s.from||r):i=ss(s),ar(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Ny(n,e,t){os(We(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Cw(n,e,t,r){let s=r.includes(".")?Bw(t,r):()=>t[r];if(hn(n)){const i=e[n];nt(i)&&Rt(s,i)}else if(nt(n))Rt(s,n.bind(t));else if(jt(n))if(We(n))n.forEach(i=>Cw(i,e,t,r));else{const i=nt(n.handler)?n.handler.bind(t):e[n.handler];nt(i)&&Rt(s,i,n)}}function tg(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>ch(l,c,o,!0)),ch(l,e,o)),jt(e)&&i.set(e,l),l}function ch(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&ch(n,i,t,!0),s&&s.forEach(o=>ch(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=OS[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const OS={data:Oy,props:Vy,emits:Vy,methods:Su,computed:Su,beforeCreate:hr,created:hr,beforeMount:hr,mounted:hr,beforeUpdate:hr,updated:hr,beforeDestroy:hr,beforeUnmount:hr,destroyed:hr,unmounted:hr,activated:hr,deactivated:hr,errorCaptured:hr,serverPrefetch:hr,components:Su,directives:Su,watch:MS,provide:Oy,inject:VS};function Oy(n,e){return e?n?function(){return Rn(nt(n)?n.call(this,this):n,nt(e)?e.call(this,this):e)}:e:n}function VS(n,e){return Su(Gp(n),Gp(e))}function Gp(n){if(We(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function hr(n,e){return n?[...new Set([].concat(n,e))]:e}function Su(n,e){return n?Rn(Object.create(null),n,e):e}function Vy(n,e){return n?We(n)&&We(e)?[...new Set([...n,...e])]:Rn(Object.create(null),Dy(n),Dy(e??{})):e}function MS(n,e){if(!n)return e;if(!e)return n;const t=Rn(Object.create(null),n);for(const r in e)t[r]=hr(n[r],e[r]);return t}function kw(){return{app:null,config:{isNativeTag:IA,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let LS=0;function $S(n,e){return function(r,s=null){nt(r)||(r=Rn({},r)),s!=null&&!jt(s)&&(s=null);const i=kw(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:LS++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:_P,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&nt(h.install)?(o.add(h),h.install(c,...f)):nt(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,m){if(!l){const v=c._ceVNode||Ye(r,s);return v.appContext=i,m===!0?m="svg":m===!1&&(m=void 0),f&&e?e(v,h):n(v,h,m),l=!0,c._container=h,h.__vue_app__=c,Jh(v.component)}},onUnmount(h){a.push(h)},unmount(){l&&(os(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=ll;ll=c;try{return h()}finally{ll=f}}};return c}}let ll=null;function jd(n,e){if(Jn){let t=Jn.provides;const r=Jn.parent&&Jn.parent.provides;r===t&&(t=Jn.provides=Object.create(r)),t[n]=e}}function ss(n,e,t=!1){const r=Jn||Bn;if(r||ll){let s=ll?ll._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&nt(e)?e.call(r&&r.proxy):e}}const Dw={},Nw=()=>Object.create(Dw),Ow=n=>Object.getPrototypeOf(n)===Dw;function FS(n,e,t,r=!1){const s={},i=Nw();n.propsDefaults=Object.create(null),Vw(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:aw(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function US(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Pt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let m=h[f];if(Wh(n.emitsOptions,m))continue;const v=e[m];if(l)if(Ot(i,m))v!==i[m]&&(i[m]=v,c=!0);else{const w=Gr(m);s[w]=Wp(l,a,w,v,n,!1)}else v!==i[m]&&(i[m]=v,c=!0)}}}else{Vw(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!Ot(e,f)&&((h=fo(f))===f||!Ot(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=Wp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!Ot(e,f))&&(delete i[f],c=!0)}c&&Fs(n.attrs,"set","")}function Vw(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Vu(l))continue;const c=e[l];let h;s&&Ot(s,h=Gr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:Wh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=Pt(t),c=a||Ut;for(let h=0;h<i.length;h++){const f=i[h];t[f]=Wp(s,l,f,c[f],n,!Ot(c,f))}}return o}function Wp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Ot(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&nt(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=Vc(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===fo(t))&&(r=!0))}return r}const jS=new WeakMap;function Mw(n,e,t=!1){const r=t?jS:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!nt(n)){const h=f=>{l=!0;const[m,v]=Mw(f,e,!0);Rn(o,m),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return jt(n)&&r.set(n,rl),rl;if(We(i))for(let h=0;h<i.length;h++){const f=Gr(i[h]);My(f)&&(o[f]=Ut)}else if(i)for(const h in i){const f=Gr(h);if(My(f)){const m=i[h],v=o[f]=We(m)||nt(m)?{type:m}:Rn({},m),w=v.type;let x=!1,A=!0;if(We(w))for(let L=0;L<w.length;++L){const F=w[L],$=nt(F)&&F.name;if($==="Boolean"){x=!0;break}else $==="String"&&(A=!1)}else x=nt(w)&&w.name==="Boolean";v[0]=x,v[1]=A,(x||Ot(v,"default"))&&a.push(f)}}const c=[o,a];return jt(n)&&r.set(n,c),c}function My(n){return n[0]!=="$"&&!Vu(n)}const ng=n=>n[0]==="_"||n==="$stable",rg=n=>We(n)?n.map(bs):[bs(n)],BS=(n,e,t)=>{if(e._n)return e;const r=Fd((...s)=>rg(e(...s)),t);return r._c=!1,r},Lw=(n,e,t)=>{const r=n._ctx;for(const s in n){if(ng(s))continue;const i=n[s];if(nt(i))e[s]=BS(s,i,r);else if(i!=null){const o=rg(i);e[s]=()=>o}}},$w=(n,e)=>{const t=rg(e);n.slots.default=()=>t},Fw=(n,e,t)=>{for(const r in e)(t||!ng(r))&&(n[r]=e[r])},qS=(n,e,t)=>{const r=n.slots=Nw();if(n.vnode.shapeFlag&32){const s=e.__;s&&$p(r,"__",s,!0);const i=e._;i?(Fw(r,e,t),t&&$p(r,"_",i,!0)):Lw(e,r)}else e&&$w(n,e)},zS=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Ut;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Fw(s,e,t):(i=!e.$stable,Lw(e,s)),o=e}else e&&($w(n,e),o={default:1});if(i)for(const a in s)!ng(a)&&o[a]==null&&delete s[a]},fr=sP;function HS(n){return KS(n)}function KS(n,e){const t=Bh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:m,setScopeId:v=ts,insertStaticContent:w}=n,x=(C,V,H,K=null,X=null,ue=null,ge=void 0,me=null,ye=!!V.dynamicChildren)=>{if(C===V)return;C&&!Bo(C,V)&&(K=J(C),Z(C,X,ue,!0),C=null),V.patchFlag===-2&&(ye=!1,V.dynamicChildren=null);const{type:pe,ref:Fe,shapeFlag:Ae}=V;switch(pe){case Qh:A(C,V,H,K);break;case or:L(C,V,H,K);break;case Bd:C==null&&F(V,H,K,ge);break;case ft:S(C,V,H,K,X,ue,ge,me,ye);break;default:Ae&1?ne(C,V,H,K,X,ue,ge,me,ye):Ae&6?P(C,V,H,K,X,ue,ge,me,ye):(Ae&64||Ae&128)&&pe.process(C,V,H,K,X,ue,ge,me,ye,De)}Fe!=null&&X?Fu(Fe,C&&C.ref,ue,V||C,!V):Fe==null&&C&&C.ref!=null&&Fu(C.ref,null,ue,C,!0)},A=(C,V,H,K)=>{if(C==null)r(V.el=a(V.children),H,K);else{const X=V.el=C.el;V.children!==C.children&&c(X,V.children)}},L=(C,V,H,K)=>{C==null?r(V.el=l(V.children||""),H,K):V.el=C.el},F=(C,V,H,K)=>{[C.el,C.anchor]=w(C.children,V,H,K,C.el,C.anchor)},$=({el:C,anchor:V},H,K)=>{let X;for(;C&&C!==V;)X=m(C),r(C,H,K),C=X;r(V,H,K)},B=({el:C,anchor:V})=>{let H;for(;C&&C!==V;)H=m(C),s(C),C=H;s(V)},ne=(C,V,H,K,X,ue,ge,me,ye)=>{V.type==="svg"?ge="svg":V.type==="math"&&(ge="mathml"),C==null?re(V,H,K,X,ue,ge,me,ye):E(C,V,X,ue,ge,me,ye)},re=(C,V,H,K,X,ue,ge,me)=>{let ye,pe;const{props:Fe,shapeFlag:Ae,transition:Oe,dirs:ze}=C;if(ye=C.el=o(C.type,ue,Fe&&Fe.is,Fe),Ae&8?h(ye,C.children):Ae&16&&_(C.children,ye,null,K,X,sp(C,ue),ge,me),ze&&Do(C,null,K,"created"),T(ye,C,C.scopeId,ge,K),Fe){for(const Ze in Fe)Ze!=="value"&&!Vu(Ze)&&i(ye,Ze,null,Fe[Ze],ue,K);"value"in Fe&&i(ye,"value",null,Fe.value,ue),(pe=Fe.onVnodeBeforeMount)&&ys(pe,K,C)}ze&&Do(C,null,K,"beforeMount");const He=GS(X,Oe);He&&Oe.beforeEnter(ye),r(ye,V,H),((pe=Fe&&Fe.onVnodeMounted)||He||ze)&&fr(()=>{pe&&ys(pe,K,C),He&&Oe.enter(ye),ze&&Do(C,null,K,"mounted")},X)},T=(C,V,H,K,X)=>{if(H&&v(C,H),K)for(let ue=0;ue<K.length;ue++)v(C,K[ue]);if(X){let ue=X.subTree;if(V===ue||zw(ue.type)&&(ue.ssContent===V||ue.ssFallback===V)){const ge=X.vnode;T(C,ge,ge.scopeId,ge.slotScopeIds,X.parent)}}},_=(C,V,H,K,X,ue,ge,me,ye=0)=>{for(let pe=ye;pe<C.length;pe++){const Fe=C[pe]=me?Mi(C[pe]):bs(C[pe]);x(null,Fe,V,H,K,X,ue,ge,me)}},E=(C,V,H,K,X,ue,ge)=>{const me=V.el=C.el;let{patchFlag:ye,dynamicChildren:pe,dirs:Fe}=V;ye|=C.patchFlag&16;const Ae=C.props||Ut,Oe=V.props||Ut;let ze;if(H&&No(H,!1),(ze=Oe.onVnodeBeforeUpdate)&&ys(ze,H,V,C),Fe&&Do(V,C,H,"beforeUpdate"),H&&No(H,!0),(Ae.innerHTML&&Oe.innerHTML==null||Ae.textContent&&Oe.textContent==null)&&h(me,""),pe?k(C.dynamicChildren,pe,me,H,K,sp(V,X),ue):ge||_e(C,V,me,null,H,K,sp(V,X),ue,!1),ye>0){if(ye&16)D(me,Ae,Oe,H,X);else if(ye&2&&Ae.class!==Oe.class&&i(me,"class",null,Oe.class,X),ye&4&&i(me,"style",Ae.style,Oe.style,X),ye&8){const He=V.dynamicProps;for(let Ze=0;Ze<He.length;Ze++){const ct=He[Ze],vn=Ae[ct],rn=Oe[ct];(rn!==vn||ct==="value")&&i(me,ct,vn,rn,X,H)}}ye&1&&C.children!==V.children&&h(me,V.children)}else!ge&&pe==null&&D(me,Ae,Oe,H,X);((ze=Oe.onVnodeUpdated)||Fe)&&fr(()=>{ze&&ys(ze,H,V,C),Fe&&Do(V,C,H,"updated")},K)},k=(C,V,H,K,X,ue,ge)=>{for(let me=0;me<V.length;me++){const ye=C[me],pe=V[me],Fe=ye.el&&(ye.type===ft||!Bo(ye,pe)||ye.shapeFlag&198)?f(ye.el):H;x(ye,pe,Fe,null,K,X,ue,ge,!0)}},D=(C,V,H,K,X)=>{if(V!==H){if(V!==Ut)for(const ue in V)!Vu(ue)&&!(ue in H)&&i(C,ue,V[ue],null,X,K);for(const ue in H){if(Vu(ue))continue;const ge=H[ue],me=V[ue];ge!==me&&ue!=="value"&&i(C,ue,me,ge,X,K)}"value"in H&&i(C,"value",V.value,H.value,X)}},S=(C,V,H,K,X,ue,ge,me,ye)=>{const pe=V.el=C?C.el:a(""),Fe=V.anchor=C?C.anchor:a("");let{patchFlag:Ae,dynamicChildren:Oe,slotScopeIds:ze}=V;ze&&(me=me?me.concat(ze):ze),C==null?(r(pe,H,K),r(Fe,H,K),_(V.children||[],H,Fe,X,ue,ge,me,ye)):Ae>0&&Ae&64&&Oe&&C.dynamicChildren?(k(C.dynamicChildren,Oe,H,X,ue,ge,me),(V.key!=null||X&&V===X.subTree)&&sg(C,V,!0)):_e(C,V,H,Fe,X,ue,ge,me,ye)},P=(C,V,H,K,X,ue,ge,me,ye)=>{V.slotScopeIds=me,C==null?V.shapeFlag&512?X.ctx.activate(V,H,K,ge,ye):ke(V,H,K,X,ue,ge,ye):Re(C,V,ye)},ke=(C,V,H,K,X,ue,ge)=>{const me=C.component=dP(C,K,X);if(Kh(C)&&(me.ctx.renderer=De),fP(me,!1,ge),me.asyncDep){if(X&&X.registerDep(me,Pe,ge),!C.el){const ye=me.subTree=Ye(or);L(null,ye,V,H)}}else Pe(me,C,V,H,X,ue,ge)},Re=(C,V,H)=>{const K=V.component=C.component;if(nP(C,V,H))if(K.asyncDep&&!K.asyncResolved){Ce(K,V,H);return}else K.next=V,K.update();else V.el=C.el,K.vnode=V},Pe=(C,V,H,K,X,ue,ge)=>{const me=()=>{if(C.isMounted){let{next:Ae,bu:Oe,u:ze,parent:He,vnode:Ze}=C;{const qt=Uw(C);if(qt){Ae&&(Ae.el=Ze.el,Ce(C,Ae,ge)),qt.asyncDep.then(()=>{C.isUnmounted||me()});return}}let ct=Ae,vn;No(C,!1),Ae?(Ae.el=Ze.el,Ce(C,Ae,ge)):Ae=Ze,Oe&&$d(Oe),(vn=Ae.props&&Ae.props.onVnodeBeforeUpdate)&&ys(vn,He,Ae,Ze),No(C,!0);const rn=ip(C),Hn=C.subTree;C.subTree=rn,x(Hn,rn,f(Hn.el),J(Hn),C,X,ue),Ae.el=rn.el,ct===null&&rP(C,rn.el),ze&&fr(ze,X),(vn=Ae.props&&Ae.props.onVnodeUpdated)&&fr(()=>ys(vn,He,Ae,Ze),X)}else{let Ae;const{el:Oe,props:ze}=V,{bm:He,m:Ze,parent:ct,root:vn,type:rn}=C,Hn=al(V);if(No(C,!1),He&&$d(He),!Hn&&(Ae=ze&&ze.onVnodeBeforeMount)&&ys(Ae,ct,V),No(C,!0),Oe&&gt){const qt=()=>{C.subTree=ip(C),gt(Oe,C.subTree,C,X,null)};Hn&&rn.__asyncHydrate?rn.__asyncHydrate(Oe,C,qt):qt()}else{vn.ce&&vn.ce._def.shadowRoot!==!1&&vn.ce._injectChildStyle(rn);const qt=C.subTree=ip(C);x(null,qt,H,K,C,X,ue),V.el=qt.el}if(Ze&&fr(Ze,X),!Hn&&(Ae=ze&&ze.onVnodeMounted)){const qt=V;fr(()=>ys(Ae,ct,qt),X)}(V.shapeFlag&256||ct&&al(ct.vnode)&&ct.vnode.shapeFlag&256)&&C.a&&fr(C.a,X),C.isMounted=!0,V=H=K=null}};C.scope.on();const ye=C.effect=new Gb(me);C.scope.off();const pe=C.update=ye.run.bind(ye),Fe=C.job=ye.runIfDirty.bind(ye);Fe.i=C,Fe.id=C.uid,ye.scheduler=()=>Zm(Fe),No(C,!0),pe()},Ce=(C,V,H)=>{V.component=C;const K=C.vnode.props;C.vnode=V,C.next=null,US(C,V.props,K,H),zS(C,V.children,H),Xs(),Ay(C),Zs()},_e=(C,V,H,K,X,ue,ge,me,ye=!1)=>{const pe=C&&C.children,Fe=C?C.shapeFlag:0,Ae=V.children,{patchFlag:Oe,shapeFlag:ze}=V;if(Oe>0){if(Oe&128){Je(pe,Ae,H,K,X,ue,ge,me,ye);return}else if(Oe&256){le(pe,Ae,H,K,X,ue,ge,me,ye);return}}ze&8?(Fe&16&&Yt(pe,X,ue),Ae!==pe&&h(H,Ae)):Fe&16?ze&16?Je(pe,Ae,H,K,X,ue,ge,me,ye):Yt(pe,X,ue,!0):(Fe&8&&h(H,""),ze&16&&_(Ae,H,K,X,ue,ge,me,ye))},le=(C,V,H,K,X,ue,ge,me,ye)=>{C=C||rl,V=V||rl;const pe=C.length,Fe=V.length,Ae=Math.min(pe,Fe);let Oe;for(Oe=0;Oe<Ae;Oe++){const ze=V[Oe]=ye?Mi(V[Oe]):bs(V[Oe]);x(C[Oe],ze,H,null,X,ue,ge,me,ye)}pe>Fe?Yt(C,X,ue,!0,!1,Ae):_(V,H,K,X,ue,ge,me,ye,Ae)},Je=(C,V,H,K,X,ue,ge,me,ye)=>{let pe=0;const Fe=V.length;let Ae=C.length-1,Oe=Fe-1;for(;pe<=Ae&&pe<=Oe;){const ze=C[pe],He=V[pe]=ye?Mi(V[pe]):bs(V[pe]);if(Bo(ze,He))x(ze,He,H,null,X,ue,ge,me,ye);else break;pe++}for(;pe<=Ae&&pe<=Oe;){const ze=C[Ae],He=V[Oe]=ye?Mi(V[Oe]):bs(V[Oe]);if(Bo(ze,He))x(ze,He,H,null,X,ue,ge,me,ye);else break;Ae--,Oe--}if(pe>Ae){if(pe<=Oe){const ze=Oe+1,He=ze<Fe?V[ze].el:K;for(;pe<=Oe;)x(null,V[pe]=ye?Mi(V[pe]):bs(V[pe]),H,He,X,ue,ge,me,ye),pe++}}else if(pe>Oe)for(;pe<=Ae;)Z(C[pe],X,ue,!0),pe++;else{const ze=pe,He=pe,Ze=new Map;for(pe=He;pe<=Oe;pe++){const Gt=V[pe]=ye?Mi(V[pe]):bs(V[pe]);Gt.key!=null&&Ze.set(Gt.key,pe)}let ct,vn=0;const rn=Oe-He+1;let Hn=!1,qt=0;const Ur=new Array(rn);for(pe=0;pe<rn;pe++)Ur[pe]=0;for(pe=ze;pe<=Ae;pe++){const Gt=C[pe];if(vn>=rn){Z(Gt,X,ue,!0);continue}let un;if(Gt.key!=null)un=Ze.get(Gt.key);else for(ct=He;ct<=Oe;ct++)if(Ur[ct-He]===0&&Bo(Gt,V[ct])){un=ct;break}un===void 0?Z(Gt,X,ue,!0):(Ur[un-He]=pe+1,un>=qt?qt=un:Hn=!0,x(Gt,V[un],H,null,X,ue,ge,me,ye),vn++)}const jr=Hn?WS(Ur):rl;for(ct=jr.length-1,pe=rn-1;pe>=0;pe--){const Gt=He+pe,un=V[Gt],Br=Gt+1<Fe?V[Gt+1].el:K;Ur[pe]===0?x(null,un,H,Br,X,ue,ge,me,ye):Hn&&(ct<0||pe!==jr[ct]?oe(un,H,Br,2):ct--)}}},oe=(C,V,H,K,X=null)=>{const{el:ue,type:ge,transition:me,children:ye,shapeFlag:pe}=C;if(pe&6){oe(C.component.subTree,V,H,K);return}if(pe&128){C.suspense.move(V,H,K);return}if(pe&64){ge.move(C,V,H,De);return}if(ge===ft){r(ue,V,H);for(let Ae=0;Ae<ye.length;Ae++)oe(ye[Ae],V,H,K);r(C.anchor,V,H);return}if(ge===Bd){$(C,V,H);return}if(K!==2&&pe&1&&me)if(K===0)me.beforeEnter(ue),r(ue,V,H),fr(()=>me.enter(ue),X);else{const{leave:Ae,delayLeave:Oe,afterLeave:ze}=me,He=()=>{C.ctx.isUnmounted?s(ue):r(ue,V,H)},Ze=()=>{Ae(ue,()=>{He(),ze&&ze()})};Oe?Oe(ue,He,Ze):Ze()}else r(ue,V,H)},Z=(C,V,H,K=!1,X=!1)=>{const{type:ue,props:ge,ref:me,children:ye,dynamicChildren:pe,shapeFlag:Fe,patchFlag:Ae,dirs:Oe,cacheIndex:ze}=C;if(Ae===-2&&(X=!1),me!=null&&(Xs(),Fu(me,null,H,C,!0),Zs()),ze!=null&&(V.renderCache[ze]=void 0),Fe&256){V.ctx.deactivate(C);return}const He=Fe&1&&Oe,Ze=!al(C);let ct;if(Ze&&(ct=ge&&ge.onVnodeBeforeUnmount)&&ys(ct,V,C),Fe&6)At(C.component,H,K);else{if(Fe&128){C.suspense.unmount(H,K);return}He&&Do(C,null,V,"beforeUnmount"),Fe&64?C.type.remove(C,V,H,De,K):pe&&!pe.hasOnce&&(ue!==ft||Ae>0&&Ae&64)?Yt(pe,V,H,!1,!0):(ue===ft&&Ae&384||!X&&Fe&16)&&Yt(ye,V,H),K&&Le(C)}(Ze&&(ct=ge&&ge.onVnodeUnmounted)||He)&&fr(()=>{ct&&ys(ct,V,C),He&&Do(C,null,V,"unmounted")},H)},Le=C=>{const{type:V,el:H,anchor:K,transition:X}=C;if(V===ft){ut(H,K);return}if(V===Bd){B(C);return}const ue=()=>{s(H),X&&!X.persisted&&X.afterLeave&&X.afterLeave()};if(C.shapeFlag&1&&X&&!X.persisted){const{leave:ge,delayLeave:me}=X,ye=()=>ge(H,ue);me?me(C.el,ue,ye):ye()}else ue()},ut=(C,V)=>{let H;for(;C!==V;)H=m(C),s(C),C=H;s(V)},At=(C,V,H)=>{const{bum:K,scope:X,job:ue,subTree:ge,um:me,m:ye,a:pe,parent:Fe,slots:{__:Ae}}=C;Ly(ye),Ly(pe),K&&$d(K),Fe&&We(Ae)&&Ae.forEach(Oe=>{Fe.renderCache[Oe]=void 0}),X.stop(),ue&&(ue.flags|=8,Z(ge,C,V,H)),me&&fr(me,V),fr(()=>{C.isUnmounted=!0},V),V&&V.pendingBranch&&!V.isUnmounted&&C.asyncDep&&!C.asyncResolved&&C.suspenseId===V.pendingId&&(V.deps--,V.deps===0&&V.resolve())},Yt=(C,V,H,K=!1,X=!1,ue=0)=>{for(let ge=ue;ge<C.length;ge++)Z(C[ge],V,H,K,X)},J=C=>{if(C.shapeFlag&6)return J(C.component.subTree);if(C.shapeFlag&128)return C.suspense.next();const V=m(C.anchor||C.el),H=V&&V[gw];return H?m(H):V};let xe=!1;const ve=(C,V,H)=>{C==null?V._vnode&&Z(V._vnode,null,null,!0):x(V._vnode||null,C,V,null,null,null,H),V._vnode=C,xe||(xe=!0,Ay(),fw(),xe=!1)},De={p:x,um:Z,m:oe,r:Le,mt:ke,mc:_,pc:_e,pbc:k,n:J,o:n};let it,gt;return e&&([it,gt]=e(De)),{render:ve,hydrate:it,createApp:$S(ve,it)}}function sp({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function No({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function GS(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function sg(n,e,t=!1){const r=n.children,s=e.children;if(We(r)&&We(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Mi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&sg(o,a)),a.type===Qh&&(a.el=o.el),a.type===or&&!a.el&&(a.el=o.el)}}function WS(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Uw(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Uw(e)}function Ly(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const QS=Symbol.for("v-scx"),JS=()=>ss(QS);function Rt(n,e,t){return jw(n,e,t)}function jw(n,e,t=Ut){const{immediate:r,deep:s,flush:i,once:o}=t,a=Rn({},t),l=e&&r||!e&&i!=="post";let c;if(oc){if(i==="sync"){const v=JS();c=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=ts,v.resume=ts,v.pause=ts,v}}const h=Jn;a.call=(v,w,x)=>os(v,h,w,x);let f=!1;i==="post"?a.scheduler=v=>{fr(v,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(v,w)=>{w?v():Zm(v)}),a.augmentJob=v=>{e&&(v.flags|=4),f&&(v.flags|=2,h&&(v.id=h.uid,v.i=h))};const m=uS(n,e,a);return oc&&(c?c.push(m):l&&m()),m}function YS(n,e,t){const r=this.proxy,s=hn(n)?n.includes(".")?Bw(r,n):()=>r[n]:n.bind(r,r);let i;nt(e)?i=e:(i=e.handler,t=e);const o=Vc(this),a=jw(s,i.bind(r),t);return o(),a}function Bw(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const XS=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Gr(e)}Modifiers`]||n[`${fo(e)}Modifiers`];function ZS(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Ut;let s=t;const i=e.startsWith("update:"),o=i&&XS(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>hn(h)?h.trim():h)),o.number&&(s=t.map(ih)));let a,l=r[a=Yf(e)]||r[a=Yf(Gr(e))];!l&&i&&(l=r[a=Yf(fo(e))]),l&&os(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,os(c,n,6,s)}}function qw(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!nt(n)){const l=c=>{const h=qw(c,e,!0);h&&(a=!0,Rn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(jt(n)&&r.set(n,null),null):(We(i)?i.forEach(l=>o[l]=null):Rn(o,i),jt(n)&&r.set(n,o),o)}function Wh(n,e){return!n||!Fh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ot(n,e[0].toLowerCase()+e.slice(1))||Ot(n,fo(e))||Ot(n,e))}function ip(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:m,setupState:v,ctx:w,inheritAttrs:x}=n,A=uh(n);let L,F;try{if(t.shapeFlag&4){const B=s||r,ne=B;L=bs(c.call(ne,B,h,f,v,m,w)),F=a}else{const B=e;L=bs(B.length>1?B(f,{attrs:a,slots:o,emit:l}):B(f,null)),F=e.props?a:eP(a)}}catch(B){ju.length=0,Hh(B,n,1),L=Ye(or)}let $=L;if(F&&x!==!1){const B=Object.keys(F),{shapeFlag:ne}=$;B.length&&ne&7&&(i&&B.some(Bm)&&(F=tP(F,i)),$=no($,F,!1,!0))}return t.dirs&&($=no($,null,!1,!0),$.dirs=$.dirs?$.dirs.concat(t.dirs):t.dirs),t.transition&&rc($,t.transition),L=$,uh(A),L}const eP=n=>{let e;for(const t in n)(t==="class"||t==="style"||Fh(t))&&((e||(e={}))[t]=n[t]);return e},tP=(n,e)=>{const t={};for(const r in n)(!Bm(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function nP(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?$y(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const m=h[f];if(o[m]!==r[m]&&!Wh(c,m))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?$y(r,o,c):!0:!!o;return!1}function $y(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Wh(t,i))return!0}return!1}function rP({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const zw=n=>n.__isSuspense;function sP(n,e){e&&e.pendingBranch?We(n)?e.effects.push(...n):e.effects.push(n):hS(n)}const ft=Symbol.for("v-fgt"),Qh=Symbol.for("v-txt"),or=Symbol.for("v-cmt"),Bd=Symbol.for("v-stc"),ju=[];let Lr=null;function N(n=!1){ju.push(Lr=n?null:[])}function iP(){ju.pop(),Lr=ju[ju.length-1]||null}let sc=1;function Fy(n,e=!1){sc+=n,n<0&&Lr&&e&&(Lr.hasOnce=!0)}function Hw(n){return n.dynamicChildren=sc>0?Lr||rl:null,iP(),sc>0&&Lr&&Lr.push(n),n}function O(n,e,t,r,s,i){return Hw(d(n,e,t,r,s,i,!0))}function Gs(n,e,t,r,s){return Hw(Ye(n,e,t,r,s,!0))}function ic(n){return n?n.__v_isVNode===!0:!1}function Bo(n,e){return n.type===e.type&&n.key===e.key}const Kw=({key:n})=>n??null,qd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?hn(n)||ar(n)||nt(n)?{i:Bn,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===ft?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Kw(e),ref:e&&qd(e),scopeId:mw,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Bn};return a?(ig(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=hn(t)?8:16),sc>0&&!o&&Lr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Lr.push(l),l}const Ye=oP;function oP(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===PS)&&(n=or),ic(n)){const a=no(n,e,!0);return t&&ig(a,t),sc>0&&!i&&Lr&&(a.shapeFlag&6?Lr[Lr.indexOf(n)]=a:Lr.push(a)),a.patchFlag=-2,a}if(yP(n)&&(n=n.__vccOpts),e){e=aP(e);let{class:a,style:l}=e;a&&!hn(a)&&(e.class=wn(a)),jt(l)&&(Xm(l)&&!We(l)&&(l=Rn({},l)),e.style=Vr(l))}const o=hn(n)?1:zw(n)?128:vw(n)?64:jt(n)?4:nt(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function aP(n){return n?Xm(n)||Ow(n)?Rn({},n):n:null}function no(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?lP(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Kw(c),ref:e&&e.ref?t&&i?We(i)?i.concat(qd(e)):[i,qd(e)]:qd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==ft?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&no(n.ssContent),ssFallback:n.ssFallback&&no(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&rc(h,l.clone(h)),h}function _t(n=" ",e=0){return Ye(Qh,null,n,e)}function Nn(n,e){const t=Ye(Bd,null,n);return t.staticCount=e,t}function ae(n="",e=!1){return e?(N(),Gs(or,null,n)):Ye(or,null,n)}function bs(n){return n==null||typeof n=="boolean"?Ye(or):We(n)?Ye(ft,null,n.slice()):ic(n)?Mi(n):Ye(Qh,null,String(n))}function Mi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:no(n)}function ig(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(We(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),ig(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Ow(e)?e._ctx=Bn:s===3&&Bn&&(Bn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else nt(e)?(e={default:e,_ctx:Bn},t=32):(e=String(e),r&64?(t=16,e=[_t(e)]):t=8);n.children=e,n.shapeFlag|=t}function lP(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=wn([e.class,r.class]));else if(s==="style")e.style=Vr([e.style,r.style]);else if(Fh(s)){const i=e[s],o=r[s];o&&i!==o&&!(We(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function ys(n,e,t,r=null){os(n,e,7,[t,r])}const uP=kw();let cP=0;function dP(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||uP,i={uid:cP++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new MA(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Mw(r,s),emitsOptions:qw(r,s),emit:null,emitted:null,propsDefaults:Ut,inheritAttrs:r.inheritAttrs,ctx:Ut,data:Ut,props:Ut,attrs:Ut,slots:Ut,refs:Ut,setupState:Ut,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=ZS.bind(null,i),n.ce&&n.ce(i),i}let Jn=null;const hP=()=>Jn||Bn;let dh,Qp;{const n=Bh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};dh=e("__VUE_INSTANCE_SETTERS__",t=>Jn=t),Qp=e("__VUE_SSR_SETTERS__",t=>oc=t)}const Vc=n=>{const e=Jn;return dh(n),n.scope.on(),()=>{n.scope.off(),dh(e)}},Uy=()=>{Jn&&Jn.scope.off(),dh(null)};function Gw(n){return n.vnode.shapeFlag&4}let oc=!1;function fP(n,e=!1,t=!1){e&&Qp(e);const{props:r,children:s}=n.vnode,i=Gw(n);FS(n,r,i,e),qS(n,s,t||e);const o=i?pP(n,e):void 0;return e&&Qp(!1),o}function pP(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,kS);const{setup:r}=t;if(r){Xs();const s=n.setupContext=r.length>1?gP(n):null,i=Vc(n),o=Oc(r,n,0,[n.props,s]),a=jb(o);if(Zs(),i(),(a||n.sp)&&!al(n)&&Aw(n),a){if(o.then(Uy,Uy),e)return o.then(l=>{jy(n,l,e)}).catch(l=>{Hh(l,n,0)});n.asyncDep=o}else jy(n,o,e)}else Ww(n,e)}function jy(n,e,t){nt(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:jt(e)&&(n.setupState=cw(e)),Ww(n,t)}let By;function Ww(n,e,t){const r=n.type;if(!n.render){if(!e&&By&&!r.render){const s=r.template||tg(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Rn(Rn({isCustomElement:i,delimiters:a},o),l);r.render=By(s,c)}}n.render=r.render||ts}{const s=Vc(n);Xs();try{DS(n)}finally{Zs(),s()}}}const mP={get(n,e){return ir(n,"get",""),n[e]}};function gP(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,mP),slots:n.slots,emit:n.emit,expose:e}}function Jh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(cw(nS(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Uu)return Uu[t](n)},has(e,t){return t in e||t in Uu}})):n.proxy}function vP(n,e=!0){return nt(n)?n.displayName||n.name:n.name||e&&n.__name}function yP(n){return nt(n)&&"__vccOpts"in n}const Ue=(n,e)=>aS(n,e,oc);function og(n,e,t){const r=arguments.length;return r===2?jt(e)&&!We(e)?ic(e)?Ye(n,null,[e]):Ye(n,e):Ye(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&ic(t)&&(t=[t]),Ye(n,e,t))}const _P="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Jp;const qy=typeof window<"u"&&window.trustedTypes;if(qy)try{Jp=qy.createPolicy("vue",{createHTML:n=>n})}catch{}const Qw=Jp?n=>Jp.createHTML(n):n=>n,bP="http://www.w3.org/2000/svg",wP="http://www.w3.org/1998/Math/MathML",Ls=typeof document<"u"?document:null,zy=Ls&&Ls.createElement("template"),xP={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Ls.createElementNS(bP,n):e==="mathml"?Ls.createElementNS(wP,n):t?Ls.createElement(n,{is:t}):Ls.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Ls.createTextNode(n),createComment:n=>Ls.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ls.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{zy.innerHTML=Qw(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=zy.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Ri="transition",gu="animation",ac=Symbol("_vtc"),Jw={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},IP=Rn({},bw,Jw),EP=n=>(n.displayName="Transition",n.props=IP,n),op=EP((n,{slots:e})=>og(gS,TP(n),e)),Oo=(n,e=[])=>{We(n)?n.forEach(t=>t(...e)):n&&n(...e)},Hy=n=>n?We(n)?n.some(e=>e.length>1):n.length>1:!1;function TP(n){const e={};for(const S in n)S in Jw||(e[S]=n[S]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=o,appearToClass:h=a,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:m=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,w=AP(s),x=w&&w[0],A=w&&w[1],{onBeforeEnter:L,onEnter:F,onEnterCancelled:$,onLeave:B,onLeaveCancelled:ne,onBeforeAppear:re=L,onAppear:T=F,onAppearCancelled:_=$}=e,E=(S,P,ke,Re)=>{S._enterCancelled=Re,Vo(S,P?h:a),Vo(S,P?c:o),ke&&ke()},k=(S,P)=>{S._isLeaving=!1,Vo(S,f),Vo(S,v),Vo(S,m),P&&P()},D=S=>(P,ke)=>{const Re=S?T:F,Pe=()=>E(P,S,ke);Oo(Re,[P,Pe]),Ky(()=>{Vo(P,S?l:i),Vs(P,S?h:a),Hy(Re)||Gy(P,r,x,Pe)})};return Rn(e,{onBeforeEnter(S){Oo(L,[S]),Vs(S,i),Vs(S,o)},onBeforeAppear(S){Oo(re,[S]),Vs(S,l),Vs(S,c)},onEnter:D(!1),onAppear:D(!0),onLeave(S,P){S._isLeaving=!0;const ke=()=>k(S,P);Vs(S,f),S._enterCancelled?(Vs(S,m),Jy()):(Jy(),Vs(S,m)),Ky(()=>{S._isLeaving&&(Vo(S,f),Vs(S,v),Hy(B)||Gy(S,r,A,ke))}),Oo(B,[S,ke])},onEnterCancelled(S){E(S,!1,void 0,!0),Oo($,[S])},onAppearCancelled(S){E(S,!0,void 0,!0),Oo(_,[S])},onLeaveCancelled(S){k(S),Oo(ne,[S])}})}function AP(n){if(n==null)return null;if(jt(n))return[ap(n.enter),ap(n.leave)];{const e=ap(n);return[e,e]}}function ap(n){return PA(n)}function Vs(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[ac]||(n[ac]=new Set)).add(e)}function Vo(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[ac];t&&(t.delete(e),t.size||(n[ac]=void 0))}function Ky(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let SP=0;function Gy(n,e,t,r){const s=n._endId=++SP,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=PP(n,e);if(!o)return r();const c=o+"end";let h=0;const f=()=>{n.removeEventListener(c,m),i()},m=v=>{v.target===n&&++h>=l&&f()};setTimeout(()=>{h<l&&f()},a+1),n.addEventListener(c,m)}function PP(n,e){const t=window.getComputedStyle(n),r=w=>(t[w]||"").split(", "),s=r(`${Ri}Delay`),i=r(`${Ri}Duration`),o=Wy(s,i),a=r(`${gu}Delay`),l=r(`${gu}Duration`),c=Wy(a,l);let h=null,f=0,m=0;e===Ri?o>0&&(h=Ri,f=o,m=i.length):e===gu?c>0&&(h=gu,f=c,m=l.length):(f=Math.max(o,c),h=f>0?o>c?Ri:gu:null,m=h?h===Ri?i.length:l.length:0);const v=h===Ri&&/\b(transform|all)(,|$)/.test(r(`${Ri}Property`).toString());return{type:h,timeout:f,propCount:m,hasTransform:v}}function Wy(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>Qy(t)+Qy(n[r])))}function Qy(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function Jy(){return document.body.offsetHeight}function RP(n,e,t){const r=n[ac];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const hh=Symbol("_vod"),Yw=Symbol("_vsh"),lp={beforeMount(n,{value:e},{transition:t}){n[hh]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):vu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),vu(n,!0),r.enter(n)):r.leave(n,()=>{vu(n,!1)}):vu(n,e))},beforeUnmount(n,{value:e}){vu(n,e)}};function vu(n,e){n.style.display=e?n[hh]:"none",n[Yw]=!e}const CP=Symbol(""),kP=/(^|;)\s*display\s*:/;function DP(n,e,t){const r=n.style,s=hn(t);let i=!1;if(t&&!s){if(e)if(hn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&zd(r,a,"")}else for(const o in e)t[o]==null&&zd(r,o,"");for(const o in t)o==="display"&&(i=!0),zd(r,o,t[o])}else if(s){if(e!==t){const o=r[CP];o&&(t+=";"+o),r.cssText=t,i=kP.test(t)}}else e&&n.removeAttribute("style");hh in n&&(n[hh]=i?r.display:"",n[Yw]&&(r.display="none"))}const Yy=/\s*!important$/;function zd(n,e,t){if(We(t))t.forEach(r=>zd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=NP(n,e);Yy.test(t)?n.setProperty(fo(r),t.replace(Yy,""),"important"):n[r]=t}}const Xy=["Webkit","Moz","ms"],up={};function NP(n,e){const t=up[e];if(t)return t;let r=Gr(e);if(r!=="filter"&&r in n)return up[e]=r;r=jh(r);for(let s=0;s<Xy.length;s++){const i=Xy[s]+r;if(i in n)return up[e]=i}return e}const Zy="http://www.w3.org/1999/xlink";function e0(n,e,t,r,s,i=OA(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Zy,e.slice(6,e.length)):n.setAttributeNS(Zy,e,t):t==null||i&&!zb(t)?n.removeAttribute(e):n.setAttribute(e,i?"":is(t)?String(t):t)}function t0(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?Qw(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=zb(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function $i(n,e,t,r){n.addEventListener(e,t,r)}function OP(n,e,t,r){n.removeEventListener(e,t,r)}const n0=Symbol("_vei");function VP(n,e,t,r,s=null){const i=n[n0]||(n[n0]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=MP(e);if(r){const c=i[e]=FP(r,s);$i(n,a,c,l)}else o&&(OP(n,a,o,l),i[e]=void 0)}}const r0=/(?:Once|Passive|Capture)$/;function MP(n){let e;if(r0.test(n)){e={};let r;for(;r=n.match(r0);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):fo(n.slice(2)),e]}let cp=0;const LP=Promise.resolve(),$P=()=>cp||(LP.then(()=>cp=0),cp=Date.now());function FP(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;os(UP(r,t.value),e,5,[r])};return t.value=n,t.attached=$P(),t}function UP(n,e){if(We(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const s0=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,jP=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?RP(n,r,o):e==="style"?DP(n,t,r):Fh(e)?Bm(e)||VP(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):BP(n,e,r,o))?(t0(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&e0(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!hn(r))?t0(n,Gr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),e0(n,e,r,o))};function BP(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&s0(e)&&nt(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return s0(e)&&hn(t)?!1:e in n}const gl=n=>{const e=n.props["onUpdate:modelValue"]||!1;return We(e)?t=>$d(e,t):e};function qP(n){n.target.composing=!0}function i0(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ws=Symbol("_assign"),Mt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Ws]=gl(s);const i=r||s.props&&s.props.type==="number";$i(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=ih(a)),n[Ws](a)}),t&&$i(n,"change",()=>{n.value=n.value.trim()}),e||($i(n,"compositionstart",qP),$i(n,"compositionend",i0),$i(n,"change",i0))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Ws]=gl(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?ih(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Gi={deep:!0,created(n,e,t){n[Ws]=gl(t),$i(n,"change",()=>{const r=n._modelValue,s=lc(n),i=n.checked,o=n[Ws];if(We(r)){const a=Hm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Ml(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(Xw(n,i))})},mounted:o0,beforeUpdate(n,e,t){n[Ws]=gl(t),o0(n,e,t)}};function o0(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(We(e))s=Hm(e,r.props.value)>-1;else if(Ml(e))s=e.has(r.props.value);else{if(e===t)return;s=Nc(e,Xw(n,!0))}n.checked!==s&&(n.checked=s)}const zP={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Ml(e);$i(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?ih(lc(o)):lc(o));n[Ws](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,Zt(()=>{n._assigning=!1})}),n[Ws]=gl(r)},mounted(n,{value:e}){a0(n,e)},beforeUpdate(n,e,t){n[Ws]=gl(t)},updated(n,{value:e}){n._assigning||a0(n,e)}};function a0(n,e){const t=n.multiple,r=We(e);if(!(t&&!r&&!Ml(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=lc(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Hm(e,a)>-1}else o.selected=e.has(a);else if(Nc(lc(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function lc(n){return"_value"in n?n._value:n.value}function Xw(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const HP=["ctrl","shift","alt","meta"],KP={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>HP.some(t=>n[`${t}Key`]&&!e.includes(t))},pt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=KP[e[o]];if(a&&a(s,e))return}return n(s,...i)})},GP={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},rr=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=fo(s.key);if(e.some(o=>o===i||GP[o]===i))return n(s)})},WP=Rn({patchProp:jP},xP);let l0;function QP(){return l0||(l0=HS(WP))}const JP=(...n)=>{const e=QP().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=XP(r);if(!s)return;const i=e._component;!nt(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,YP(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function YP(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function XP(n){return hn(n)?document.querySelector(n):n}const ZP="/icons/icon-48x48.png";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zw=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},eR=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},ex={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(m=64)),r.push(t[h],t[f],t[m],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Zw(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):eR(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new tR;const m=i<<2|a>>4;if(r.push(m),c!==64){const v=a<<4&240|c>>2;if(r.push(v),f!==64){const w=c<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class tR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const nR=function(n){const e=Zw(n);return ex.encodeByteArray(e,!0)},fh=function(n){return nR(n).replace(/\./g,"")},tx=function(n){try{return ex.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR=()=>rR().__FIREBASE_DEFAULTS__,iR=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},oR=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&tx(n[1]);return e&&JSON.parse(e)},Yh=()=>{try{return sR()||iR()||oR()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},nx=n=>{var e,t;return(t=(e=Yh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},rx=n=>{const e=nx(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},sx=()=>{var n;return(n=Yh())===null||n===void 0?void 0:n.config},ix=n=>{var e;return(e=Yh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ox(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[fh(JSON.stringify(t)),fh(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(On())}function uR(){var n;const e=(n=Yh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function dR(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function hR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fR(){const n=On();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ax(){return!uR()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ag(){try{return typeof indexedDB=="object"}catch{return!1}}function lx(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function pR(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mR="FirebaseError";class us extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=mR,Object.setPrototypeOf(this,us.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ma.prototype.create)}}class ma{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?gR(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new us(s,a,r)}}function gR(n,e){return n.replace(vR,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const vR=/\{\$([^}]+)}/g;function yR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ro(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(u0(i)&&u0(o)){if(!ro(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function u0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ll(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Pu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ru(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function _R(n,e){const t=new bR(n,e);return t.subscribe.bind(t)}class bR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");wR(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=dp),s.error===void 0&&(s.error=dp),s.complete===void 0&&(s.complete=dp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function wR(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function dp(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Me(n){return n&&n._delegate?n._delegate:n}class Wr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $o="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new aR;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ER(e))try{this.getOrInitializeService({instanceIdentifier:$o})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=$o){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=$o){return this.instances.has(e)}getOptions(e=$o){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:IR(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=$o){return this.component?this.component.multipleInstances?e:$o:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function IR(n){return n===$o?void 0:n}function ER(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new xR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(yt||(yt={}));const AR={debug:yt.DEBUG,verbose:yt.VERBOSE,info:yt.INFO,warn:yt.WARN,error:yt.ERROR,silent:yt.SILENT},SR=yt.INFO,PR={[yt.DEBUG]:"log",[yt.VERBOSE]:"log",[yt.INFO]:"info",[yt.WARN]:"warn",[yt.ERROR]:"error"},RR=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=PR[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class lg{constructor(e){this.name=e,this._logLevel=SR,this._logHandler=RR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in yt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?AR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,yt.DEBUG,...e),this._logHandler(this,yt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,yt.VERBOSE,...e),this._logHandler(this,yt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,yt.INFO,...e),this._logHandler(this,yt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,yt.WARN,...e),this._logHandler(this,yt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,yt.ERROR,...e),this._logHandler(this,yt.ERROR,...e)}}const CR=(n,e)=>e.some(t=>n instanceof t);let c0,d0;function kR(){return c0||(c0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function DR(){return d0||(d0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ux=new WeakMap,Yp=new WeakMap,cx=new WeakMap,hp=new WeakMap,ug=new WeakMap;function NR(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Qs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ux.set(t,n)}).catch(()=>{}),ug.set(e,n),e}function OR(n){if(Yp.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Yp.set(n,e)}let Xp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Yp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||cx.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Qs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function VR(n){Xp=n(Xp)}function MR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(fp(this),e,...t);return cx.set(r,e.sort?e.sort():[e]),Qs(r)}:DR().includes(n)?function(...e){return n.apply(fp(this),e),Qs(ux.get(this))}:function(...e){return Qs(n.apply(fp(this),e))}}function LR(n){return typeof n=="function"?MR(n):(n instanceof IDBTransaction&&OR(n),CR(n,kR())?new Proxy(n,Xp):n)}function Qs(n){if(n instanceof IDBRequest)return NR(n);if(hp.has(n))return hp.get(n);const e=LR(n);return e!==n&&(hp.set(n,e),ug.set(e,n)),e}const fp=n=>ug.get(n);function Xh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Qs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Qs(o.result),l.oldVersion,l.newVersion,Qs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function pp(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Qs(t).then(()=>{})}const $R=["get","getKey","getAll","getAllKeys","count"],FR=["put","add","delete","clear"],mp=new Map;function h0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(mp.get(e))return mp.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=FR.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||$R.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return mp.set(e,i),i}VR(n=>({...n,get:(e,t,r)=>h0(e,t)||n.get(e,t,r),has:(e,t)=>!!h0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(jR(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function jR(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Zp="@firebase/app",f0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ei=new lg("@firebase/app"),BR="@firebase/app-compat",qR="@firebase/analytics-compat",zR="@firebase/analytics",HR="@firebase/app-check-compat",KR="@firebase/app-check",GR="@firebase/auth",WR="@firebase/auth-compat",QR="@firebase/database",JR="@firebase/data-connect",YR="@firebase/database-compat",XR="@firebase/functions",ZR="@firebase/functions-compat",eC="@firebase/installations",tC="@firebase/installations-compat",nC="@firebase/messaging",rC="@firebase/messaging-compat",sC="@firebase/performance",iC="@firebase/performance-compat",oC="@firebase/remote-config",aC="@firebase/remote-config-compat",lC="@firebase/storage",uC="@firebase/storage-compat",cC="@firebase/firestore",dC="@firebase/vertexai-preview",hC="@firebase/firestore-compat",fC="firebase",pC="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph="[DEFAULT]",mC={[Zp]:"fire-core",[BR]:"fire-core-compat",[zR]:"fire-analytics",[qR]:"fire-analytics-compat",[KR]:"fire-app-check",[HR]:"fire-app-check-compat",[GR]:"fire-auth",[WR]:"fire-auth-compat",[QR]:"fire-rtdb",[JR]:"fire-data-connect",[YR]:"fire-rtdb-compat",[XR]:"fire-fn",[ZR]:"fire-fn-compat",[eC]:"fire-iid",[tC]:"fire-iid-compat",[nC]:"fire-fcm",[rC]:"fire-fcm-compat",[sC]:"fire-perf",[iC]:"fire-perf-compat",[oC]:"fire-rc",[aC]:"fire-rc-compat",[lC]:"fire-gcs",[uC]:"fire-gcs-compat",[cC]:"fire-fst",[hC]:"fire-fst-compat",[dC]:"fire-vertex","fire-js":"fire-js",[fC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh=new Map,gC=new Map,em=new Map;function p0(n,e){try{n.container.addComponent(e)}catch(t){ei.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function as(n){const e=n.name;if(em.has(e))return ei.debug(`There were multiple attempts to register component ${e}.`),!1;em.set(e,n);for(const t of mh.values())p0(t,n);for(const t of gC.values())p0(t,n);return!0}function li(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function vC(n,e,t=ph){li(n,e).clearInstance(t)}function In(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Yi=new ma("app","Firebase",yC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Wr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Yi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ga=pC;function dx(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ph,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Yi.create("bad-app-name",{appName:String(s)});if(t||(t=sx()),!t)throw Yi.create("no-options");const i=mh.get(s);if(i){if(ro(t,i.options)&&ro(r,i.config))return i;throw Yi.create("duplicate-app",{appName:s})}const o=new TR(s);for(const l of em.values())o.addComponent(l);const a=new _C(t,r,o);return mh.set(s,a),a}function $l(n=ph){const e=mh.get(n);if(!e&&n===ph&&sx())return dx();if(!e)throw Yi.create("no-app",{appName:n});return e}function Sr(n,e,t){var r;let s=(r=mC[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ei.warn(a.join(" "));return}as(new Wr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bC="firebase-heartbeat-database",wC=1,uc="firebase-heartbeat-store";let gp=null;function hx(){return gp||(gp=Xh(bC,wC,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(uc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Yi.create("idb-open",{originalErrorMessage:n.message})})),gp}async function xC(n){try{const t=(await hx()).transaction(uc),r=await t.objectStore(uc).get(fx(n));return await t.done,r}catch(e){if(e instanceof us)ei.warn(e.message);else{const t=Yi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ei.warn(t.message)}}}async function m0(n,e){try{const r=(await hx()).transaction(uc,"readwrite");await r.objectStore(uc).put(e,fx(n)),await r.done}catch(t){if(t instanceof us)ei.warn(t.message);else{const r=Yi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ei.warn(r.message)}}}function fx(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IC=1024,EC=30*24*60*60*1e3;class TC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new SC(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=g0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=EC}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ei.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=g0(),{heartbeatsToSend:r,unsentEntries:s}=AC(this._heartbeatsCache.heartbeats),i=fh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ei.warn(t),""}}}function g0(){return new Date().toISOString().substring(0,10)}function AC(n,e=IC){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),v0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),v0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class SC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ag()?lx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await xC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return m0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return m0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function v0(n){return fh(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PC(n){as(new Wr("platform-logger",e=>new UR(e),"PRIVATE")),as(new Wr("heartbeat",e=>new TC(e),"PRIVATE")),Sr(Zp,f0,n),Sr(Zp,f0,"esm2017"),Sr("fire-js","")}PC("");const px="@firebase/installations",cg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mx=1e4,gx=`w:${cg}`,vx="FIS_v2",RC="https://firebaseinstallations.googleapis.com/v1",CC=60*60*1e3,kC="installations",DC="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},na=new ma(kC,DC,NC);function yx(n){return n instanceof us&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _x({projectId:n}){return`${RC}/projects/${n}/installations`}function bx(n){return{token:n.token,requestStatus:2,expiresIn:VC(n.expiresIn),creationTime:Date.now()}}async function wx(n,e){const r=(await e.json()).error;return na.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function xx({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function OC(n,{refreshToken:e}){const t=xx(n);return t.append("Authorization",MC(e)),t}async function Ix(n){const e=await n();return e.status>=500&&e.status<600?n():e}function VC(n){return Number(n.replace("s","000"))}function MC(n){return`${vx} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LC({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=_x(n),s=xx(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:vx,appId:n.appId,sdkVersion:gx},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Ix(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:bx(c.authToken)}}else throw await wx("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ex(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $C(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC=/^[cdef][\w-]{21}$/,tm="";function UC(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=jC(n);return FC.test(t)?t:tm}catch{return tm}}function jC(n){return $C(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zh(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tx=new Map;function Ax(n,e){const t=Zh(n);Sx(t,e),BC(t,e)}function Sx(n,e){const t=Tx.get(n);if(t)for(const r of t)r(e)}function BC(n,e){const t=qC();t&&t.postMessage({key:n,fid:e}),zC()}let Go=null;function qC(){return!Go&&"BroadcastChannel"in self&&(Go=new BroadcastChannel("[Firebase] FID Change"),Go.onmessage=n=>{Sx(n.data.key,n.data.fid)}),Go}function zC(){Tx.size===0&&Go&&(Go.close(),Go=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC="firebase-installations-database",KC=1,ra="firebase-installations-store";let vp=null;function dg(){return vp||(vp=Xh(HC,KC,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ra)}}})),vp}async function gh(n,e){const t=Zh(n),s=(await dg()).transaction(ra,"readwrite"),i=s.objectStore(ra),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&Ax(n,e.fid),e}async function Px(n){const e=Zh(n),r=(await dg()).transaction(ra,"readwrite");await r.objectStore(ra).delete(e),await r.done}async function ef(n,e){const t=Zh(n),s=(await dg()).transaction(ra,"readwrite"),i=s.objectStore(ra),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&Ax(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hg(n){let e;const t=await ef(n.appConfig,r=>{const s=GC(r),i=WC(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===tm?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function GC(n){const e=n||{fid:UC(),registrationStatus:0};return Rx(e)}function WC(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(na.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=QC(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:JC(n)}:{installationEntry:e}}async function QC(n,e){try{const t=await LC(n,e);return gh(n.appConfig,t)}catch(t){throw yx(t)&&t.customData.serverCode===409?await Px(n.appConfig):await gh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function JC(n){let e=await y0(n.appConfig);for(;e.registrationStatus===1;)await Ex(100),e=await y0(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await hg(n);return r||t}return e}function y0(n){return ef(n,e=>{if(!e)throw na.create("installation-not-found");return Rx(e)})}function Rx(n){return YC(n)?{fid:n.fid,registrationStatus:0}:n}function YC(n){return n.registrationStatus===1&&n.registrationTime+mx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XC({appConfig:n,heartbeatServiceProvider:e},t){const r=ZC(n,t),s=OC(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:gx,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Ix(()=>fetch(r,a));if(l.ok){const c=await l.json();return bx(c)}else throw await wx("Generate Auth Token",l)}function ZC(n,{fid:e}){return`${_x(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fg(n,e=!1){let t;const r=await ef(n.appConfig,i=>{if(!Cx(i))throw na.create("not-registered");const o=i.authToken;if(!e&&nk(o))return i;if(o.requestStatus===1)return t=ek(n,e),i;{if(!navigator.onLine)throw na.create("app-offline");const a=sk(i);return t=tk(n,a),a}});return t?await t:r.authToken}async function ek(n,e){let t=await _0(n.appConfig);for(;t.authToken.requestStatus===1;)await Ex(100),t=await _0(n.appConfig);const r=t.authToken;return r.requestStatus===0?fg(n,e):r}function _0(n){return ef(n,e=>{if(!Cx(e))throw na.create("not-registered");const t=e.authToken;return ik(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function tk(n,e){try{const t=await XC(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await gh(n.appConfig,r),t}catch(t){if(yx(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Px(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await gh(n.appConfig,r)}throw t}}function Cx(n){return n!==void 0&&n.registrationStatus===2}function nk(n){return n.requestStatus===2&&!rk(n)}function rk(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+CC}function sk(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function ik(n){return n.requestStatus===1&&n.requestTime+mx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ok(n){const e=n,{installationEntry:t,registrationPromise:r}=await hg(e);return r?r.catch(console.error):fg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ak(n,e=!1){const t=n;return await lk(t),(await fg(t,e)).token}async function lk(n){const{registrationPromise:e}=await hg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uk(n){if(!n||!n.options)throw yp("App Configuration");if(!n.name)throw yp("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw yp(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function yp(n){return na.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kx="installations",ck="installations-internal",dk=n=>{const e=n.getProvider("app").getImmediate(),t=uk(e),r=li(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},hk=n=>{const e=n.getProvider("app").getImmediate(),t=li(e,kx).getImmediate();return{getId:()=>ok(t),getToken:s=>ak(t,s)}};function fk(){as(new Wr(kx,dk,"PUBLIC")),as(new Wr(ck,hk,"PRIVATE"))}fk();Sr(px,cg);Sr(px,cg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk="/firebase-messaging-sw.js",mk="/firebase-cloud-messaging-push-scope",Dx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",gk="https://fcmregistrations.googleapis.com/v1",Nx="google.c.a.c_id",vk="google.c.a.c_l",yk="google.c.a.ts",_k="google.c.a.e";var b0;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(b0||(b0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var cc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(cc||(cc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $s(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function bk(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _p="fcm_token_details_db",wk=5,w0="fcm_token_object_Store";async function xk(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(_p))return null;let e=null;return(await Xh(_p,wk,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(w0))return;const l=o.objectStore(w0),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:$s(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:$s(h.auth),p256dh:$s(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:$s(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:$s(h.auth),p256dh:$s(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:$s(h.vapidKey)}}}}}})).close(),await pp(_p),await pp("fcm_vapid_details_db"),await pp("undefined"),Ik(e)?e:null}function Ik(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek="firebase-messaging-database",Tk=1,dc="firebase-messaging-store";let bp=null;function Ox(){return bp||(bp=Xh(Ek,Tk,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(dc)}}})),bp}async function Ak(n){const e=Vx(n),r=await(await Ox()).transaction(dc).objectStore(dc).get(e);if(r)return r;{const s=await xk(n.appConfig.senderId);if(s)return await pg(n,s),s}}async function pg(n,e){const t=Vx(n),s=(await Ox()).transaction(dc,"readwrite");return await s.objectStore(dc).put(e,t),await s.done,e}function Vx({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},mr=new ma("messaging","Messaging",Sk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pk(n,e){const t=await gg(n),r=Mx(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(mg(n.appConfig),s)).json()}catch(o){throw mr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw mr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw mr.create("token-subscribe-no-token");return i.token}async function Rk(n,e){const t=await gg(n),r=Mx(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${mg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw mr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw mr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw mr.create("token-update-no-token");return i.token}async function Ck(n,e){const r={method:"DELETE",headers:await gg(n)};try{const i=await(await fetch(`${mg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw mr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw mr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function mg({projectId:n}){return`${gk}/projects/${n}/registrations`}async function gg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function Mx({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==Dx&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kk=7*24*60*60*1e3;async function Dk(n){const e=await Ok(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:$s(e.getKey("auth")),p256dh:$s(e.getKey("p256dh"))},r=await Ak(n.firebaseDependencies);if(r){if(Vk(r.subscriptionOptions,t))return Date.now()>=r.createTime+kk?Nk(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await Ck(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return x0(n.firebaseDependencies,t)}else return x0(n.firebaseDependencies,t)}async function Nk(n,e){try{const t=await Rk(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await pg(n.firebaseDependencies,r),t}catch(t){throw t}}async function x0(n,e){const r={token:await Pk(n,e),createTime:Date.now(),subscriptionOptions:e};return await pg(n,r),r.token}async function Ok(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:bk(e)})}function Vk(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return Mk(e,n),Lk(e,n),$k(e,n),e}function Mk(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function Lk(n,e){e.data&&(n.data=e.data)}function $k(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fk(n){return typeof n=="object"&&!!n&&Nx in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Uk("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function Uk(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jk(n){if(!n||!n.options)throw wp("App Configuration Object");if(!n.name)throw wp("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw wp(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function wp(n){return mr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bk{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=jk(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qk(n){try{n.swRegistration=await navigator.serviceWorker.register(pk,{scope:mk}),n.swRegistration.update().catch(()=>{})}catch(e){throw mr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zk(n,e){if(!e&&!n.swRegistration&&await qk(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw mr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hk(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=Dx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lx(n,e){if(!navigator)throw mr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw mr.create("permission-blocked");return await Hk(n,e==null?void 0:e.vapidKey),await zk(n,e==null?void 0:e.serviceWorkerRegistration),Dk(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kk(n,e,t){const r=Gk(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[Nx],message_name:t[vk],message_time:t[yk],message_device_time:Math.floor(Date.now()/1e3)})}function Gk(n){switch(n){case cc.NOTIFICATION_CLICKED:return"notification_open";case cc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wk(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===cc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(I0(t)):n.onMessageHandler.next(I0(t)));const r=t.data;Fk(r)&&r[_k]==="1"&&await Kk(n,t.messageType,r)}const E0="@firebase/messaging",T0="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk=n=>{const e=new Bk(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>Wk(e,t)),e},Jk=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>Lx(e,r)}};function Yk(){as(new Wr("messaging",Qk,"PUBLIC")),as(new Wr("messaging-internal",Jk,"PRIVATE")),Sr(E0,T0),Sr(E0,T0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $x(){try{await lx()}catch{return!1}return typeof window<"u"&&ag()&&pR()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(n=$l()){return $x().then(e=>{if(!e)throw mr.create("unsupported-browser")},e=>{throw mr.create("indexed-db-unsupported")}),li(Me(n),"messaging").getImmediate()}async function Fx(n,e){return n=Me(n),Lx(n,e)}Yk();var Xk="firebase",Zk="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sr(Xk,Zk,"app");var A0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yo,Ux;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,_){function E(){}E.prototype=_.prototype,T.D=_.prototype,T.prototype=new E,T.prototype.constructor=T,T.C=function(k,D,S){for(var P=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)P[ke-2]=arguments[ke];return _.prototype[D].apply(k,P)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,_,E){E||(E=0);var k=Array(16);if(typeof _=="string")for(var D=0;16>D;++D)k[D]=_.charCodeAt(E++)|_.charCodeAt(E++)<<8|_.charCodeAt(E++)<<16|_.charCodeAt(E++)<<24;else for(D=0;16>D;++D)k[D]=_[E++]|_[E++]<<8|_[E++]<<16|_[E++]<<24;_=T.g[0],E=T.g[1],D=T.g[2];var S=T.g[3],P=_+(S^E&(D^S))+k[0]+3614090360&4294967295;_=E+(P<<7&4294967295|P>>>25),P=S+(D^_&(E^D))+k[1]+3905402710&4294967295,S=_+(P<<12&4294967295|P>>>20),P=D+(E^S&(_^E))+k[2]+606105819&4294967295,D=S+(P<<17&4294967295|P>>>15),P=E+(_^D&(S^_))+k[3]+3250441966&4294967295,E=D+(P<<22&4294967295|P>>>10),P=_+(S^E&(D^S))+k[4]+4118548399&4294967295,_=E+(P<<7&4294967295|P>>>25),P=S+(D^_&(E^D))+k[5]+1200080426&4294967295,S=_+(P<<12&4294967295|P>>>20),P=D+(E^S&(_^E))+k[6]+2821735955&4294967295,D=S+(P<<17&4294967295|P>>>15),P=E+(_^D&(S^_))+k[7]+4249261313&4294967295,E=D+(P<<22&4294967295|P>>>10),P=_+(S^E&(D^S))+k[8]+1770035416&4294967295,_=E+(P<<7&4294967295|P>>>25),P=S+(D^_&(E^D))+k[9]+2336552879&4294967295,S=_+(P<<12&4294967295|P>>>20),P=D+(E^S&(_^E))+k[10]+4294925233&4294967295,D=S+(P<<17&4294967295|P>>>15),P=E+(_^D&(S^_))+k[11]+2304563134&4294967295,E=D+(P<<22&4294967295|P>>>10),P=_+(S^E&(D^S))+k[12]+1804603682&4294967295,_=E+(P<<7&4294967295|P>>>25),P=S+(D^_&(E^D))+k[13]+4254626195&4294967295,S=_+(P<<12&4294967295|P>>>20),P=D+(E^S&(_^E))+k[14]+2792965006&4294967295,D=S+(P<<17&4294967295|P>>>15),P=E+(_^D&(S^_))+k[15]+1236535329&4294967295,E=D+(P<<22&4294967295|P>>>10),P=_+(D^S&(E^D))+k[1]+4129170786&4294967295,_=E+(P<<5&4294967295|P>>>27),P=S+(E^D&(_^E))+k[6]+3225465664&4294967295,S=_+(P<<9&4294967295|P>>>23),P=D+(_^E&(S^_))+k[11]+643717713&4294967295,D=S+(P<<14&4294967295|P>>>18),P=E+(S^_&(D^S))+k[0]+3921069994&4294967295,E=D+(P<<20&4294967295|P>>>12),P=_+(D^S&(E^D))+k[5]+3593408605&4294967295,_=E+(P<<5&4294967295|P>>>27),P=S+(E^D&(_^E))+k[10]+38016083&4294967295,S=_+(P<<9&4294967295|P>>>23),P=D+(_^E&(S^_))+k[15]+3634488961&4294967295,D=S+(P<<14&4294967295|P>>>18),P=E+(S^_&(D^S))+k[4]+3889429448&4294967295,E=D+(P<<20&4294967295|P>>>12),P=_+(D^S&(E^D))+k[9]+568446438&4294967295,_=E+(P<<5&4294967295|P>>>27),P=S+(E^D&(_^E))+k[14]+3275163606&4294967295,S=_+(P<<9&4294967295|P>>>23),P=D+(_^E&(S^_))+k[3]+4107603335&4294967295,D=S+(P<<14&4294967295|P>>>18),P=E+(S^_&(D^S))+k[8]+1163531501&4294967295,E=D+(P<<20&4294967295|P>>>12),P=_+(D^S&(E^D))+k[13]+2850285829&4294967295,_=E+(P<<5&4294967295|P>>>27),P=S+(E^D&(_^E))+k[2]+4243563512&4294967295,S=_+(P<<9&4294967295|P>>>23),P=D+(_^E&(S^_))+k[7]+1735328473&4294967295,D=S+(P<<14&4294967295|P>>>18),P=E+(S^_&(D^S))+k[12]+2368359562&4294967295,E=D+(P<<20&4294967295|P>>>12),P=_+(E^D^S)+k[5]+4294588738&4294967295,_=E+(P<<4&4294967295|P>>>28),P=S+(_^E^D)+k[8]+2272392833&4294967295,S=_+(P<<11&4294967295|P>>>21),P=D+(S^_^E)+k[11]+1839030562&4294967295,D=S+(P<<16&4294967295|P>>>16),P=E+(D^S^_)+k[14]+4259657740&4294967295,E=D+(P<<23&4294967295|P>>>9),P=_+(E^D^S)+k[1]+2763975236&4294967295,_=E+(P<<4&4294967295|P>>>28),P=S+(_^E^D)+k[4]+1272893353&4294967295,S=_+(P<<11&4294967295|P>>>21),P=D+(S^_^E)+k[7]+4139469664&4294967295,D=S+(P<<16&4294967295|P>>>16),P=E+(D^S^_)+k[10]+3200236656&4294967295,E=D+(P<<23&4294967295|P>>>9),P=_+(E^D^S)+k[13]+681279174&4294967295,_=E+(P<<4&4294967295|P>>>28),P=S+(_^E^D)+k[0]+3936430074&4294967295,S=_+(P<<11&4294967295|P>>>21),P=D+(S^_^E)+k[3]+3572445317&4294967295,D=S+(P<<16&4294967295|P>>>16),P=E+(D^S^_)+k[6]+76029189&4294967295,E=D+(P<<23&4294967295|P>>>9),P=_+(E^D^S)+k[9]+3654602809&4294967295,_=E+(P<<4&4294967295|P>>>28),P=S+(_^E^D)+k[12]+3873151461&4294967295,S=_+(P<<11&4294967295|P>>>21),P=D+(S^_^E)+k[15]+530742520&4294967295,D=S+(P<<16&4294967295|P>>>16),P=E+(D^S^_)+k[2]+3299628645&4294967295,E=D+(P<<23&4294967295|P>>>9),P=_+(D^(E|~S))+k[0]+4096336452&4294967295,_=E+(P<<6&4294967295|P>>>26),P=S+(E^(_|~D))+k[7]+1126891415&4294967295,S=_+(P<<10&4294967295|P>>>22),P=D+(_^(S|~E))+k[14]+2878612391&4294967295,D=S+(P<<15&4294967295|P>>>17),P=E+(S^(D|~_))+k[5]+4237533241&4294967295,E=D+(P<<21&4294967295|P>>>11),P=_+(D^(E|~S))+k[12]+1700485571&4294967295,_=E+(P<<6&4294967295|P>>>26),P=S+(E^(_|~D))+k[3]+2399980690&4294967295,S=_+(P<<10&4294967295|P>>>22),P=D+(_^(S|~E))+k[10]+4293915773&4294967295,D=S+(P<<15&4294967295|P>>>17),P=E+(S^(D|~_))+k[1]+2240044497&4294967295,E=D+(P<<21&4294967295|P>>>11),P=_+(D^(E|~S))+k[8]+1873313359&4294967295,_=E+(P<<6&4294967295|P>>>26),P=S+(E^(_|~D))+k[15]+4264355552&4294967295,S=_+(P<<10&4294967295|P>>>22),P=D+(_^(S|~E))+k[6]+2734768916&4294967295,D=S+(P<<15&4294967295|P>>>17),P=E+(S^(D|~_))+k[13]+1309151649&4294967295,E=D+(P<<21&4294967295|P>>>11),P=_+(D^(E|~S))+k[4]+4149444226&4294967295,_=E+(P<<6&4294967295|P>>>26),P=S+(E^(_|~D))+k[11]+3174756917&4294967295,S=_+(P<<10&4294967295|P>>>22),P=D+(_^(S|~E))+k[2]+718787259&4294967295,D=S+(P<<15&4294967295|P>>>17),P=E+(S^(D|~_))+k[9]+3951481745&4294967295,T.g[0]=T.g[0]+_&4294967295,T.g[1]=T.g[1]+(D+(P<<21&4294967295|P>>>11))&4294967295,T.g[2]=T.g[2]+D&4294967295,T.g[3]=T.g[3]+S&4294967295}r.prototype.u=function(T,_){_===void 0&&(_=T.length);for(var E=_-this.blockSize,k=this.B,D=this.h,S=0;S<_;){if(D==0)for(;S<=E;)s(this,T,S),S+=this.blockSize;if(typeof T=="string"){for(;S<_;)if(k[D++]=T.charCodeAt(S++),D==this.blockSize){s(this,k),D=0;break}}else for(;S<_;)if(k[D++]=T[S++],D==this.blockSize){s(this,k),D=0;break}}this.h=D,this.o+=_},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var _=1;_<T.length-8;++_)T[_]=0;var E=8*this.o;for(_=T.length-8;_<T.length;++_)T[_]=E&255,E/=256;for(this.u(T),T=Array(16),_=E=0;4>_;++_)for(var k=0;32>k;k+=8)T[E++]=this.g[_]>>>k&255;return T};function i(T,_){var E=a;return Object.prototype.hasOwnProperty.call(E,T)?E[T]:E[T]=_(T)}function o(T,_){this.h=_;for(var E=[],k=!0,D=T.length-1;0<=D;D--){var S=T[D]|0;k&&S==_||(E[D]=S,k=!1)}this.g=E}var a={};function l(T){return-128<=T&&128>T?i(T,function(_){return new o([_|0],0>_?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return A(c(-T));for(var _=[],E=1,k=0;T>=E;k++)_[k]=T/E|0,E*=4294967296;return new o(_,0)}function h(T,_){if(T.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(T.charAt(0)=="-")return A(h(T.substring(1),_));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=c(Math.pow(_,8)),k=f,D=0;D<T.length;D+=8){var S=Math.min(8,T.length-D),P=parseInt(T.substring(D,D+S),_);8>S?(S=c(Math.pow(_,S)),k=k.j(S).add(c(P))):(k=k.j(E),k=k.add(c(P)))}return k}var f=l(0),m=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(x(this))return-A(this).m();for(var T=0,_=1,E=0;E<this.g.length;E++){var k=this.i(E);T+=(0<=k?k:4294967296+k)*_,_*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(w(this))return"0";if(x(this))return"-"+A(this).toString(T);for(var _=c(Math.pow(T,6)),E=this,k="";;){var D=B(E,_).g;E=L(E,D.j(_));var S=((0<E.g.length?E.g[0]:E.h)>>>0).toString(T);if(E=D,w(E))return S+k;for(;6>S.length;)S="0"+S;k=S+k}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function w(T){if(T.h!=0)return!1;for(var _=0;_<T.g.length;_++)if(T.g[_]!=0)return!1;return!0}function x(T){return T.h==-1}n.l=function(T){return T=L(this,T),x(T)?-1:w(T)?0:1};function A(T){for(var _=T.g.length,E=[],k=0;k<_;k++)E[k]=~T.g[k];return new o(E,~T.h).add(m)}n.abs=function(){return x(this)?A(this):this},n.add=function(T){for(var _=Math.max(this.g.length,T.g.length),E=[],k=0,D=0;D<=_;D++){var S=k+(this.i(D)&65535)+(T.i(D)&65535),P=(S>>>16)+(this.i(D)>>>16)+(T.i(D)>>>16);k=P>>>16,S&=65535,P&=65535,E[D]=P<<16|S}return new o(E,E[E.length-1]&-2147483648?-1:0)};function L(T,_){return T.add(A(_))}n.j=function(T){if(w(this)||w(T))return f;if(x(this))return x(T)?A(this).j(A(T)):A(A(this).j(T));if(x(T))return A(this.j(A(T)));if(0>this.l(v)&&0>T.l(v))return c(this.m()*T.m());for(var _=this.g.length+T.g.length,E=[],k=0;k<2*_;k++)E[k]=0;for(k=0;k<this.g.length;k++)for(var D=0;D<T.g.length;D++){var S=this.i(k)>>>16,P=this.i(k)&65535,ke=T.i(D)>>>16,Re=T.i(D)&65535;E[2*k+2*D]+=P*Re,F(E,2*k+2*D),E[2*k+2*D+1]+=S*Re,F(E,2*k+2*D+1),E[2*k+2*D+1]+=P*ke,F(E,2*k+2*D+1),E[2*k+2*D+2]+=S*ke,F(E,2*k+2*D+2)}for(k=0;k<_;k++)E[k]=E[2*k+1]<<16|E[2*k];for(k=_;k<2*_;k++)E[k]=0;return new o(E,0)};function F(T,_){for(;(T[_]&65535)!=T[_];)T[_+1]+=T[_]>>>16,T[_]&=65535,_++}function $(T,_){this.g=T,this.h=_}function B(T,_){if(w(_))throw Error("division by zero");if(w(T))return new $(f,f);if(x(T))return _=B(A(T),_),new $(A(_.g),A(_.h));if(x(_))return _=B(T,A(_)),new $(A(_.g),_.h);if(30<T.g.length){if(x(T)||x(_))throw Error("slowDivide_ only works with positive integers.");for(var E=m,k=_;0>=k.l(T);)E=ne(E),k=ne(k);var D=re(E,1),S=re(k,1);for(k=re(k,2),E=re(E,2);!w(k);){var P=S.add(k);0>=P.l(T)&&(D=D.add(E),S=P),k=re(k,1),E=re(E,1)}return _=L(T,D.j(_)),new $(D,_)}for(D=f;0<=T.l(_);){for(E=Math.max(1,Math.floor(T.m()/_.m())),k=Math.ceil(Math.log(E)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),S=c(E),P=S.j(_);x(P)||0<P.l(T);)E-=k,S=c(E),P=S.j(_);w(S)&&(S=m),D=D.add(S),T=L(T,P)}return new $(D,T)}n.A=function(T){return B(this,T).h},n.and=function(T){for(var _=Math.max(this.g.length,T.g.length),E=[],k=0;k<_;k++)E[k]=this.i(k)&T.i(k);return new o(E,this.h&T.h)},n.or=function(T){for(var _=Math.max(this.g.length,T.g.length),E=[],k=0;k<_;k++)E[k]=this.i(k)|T.i(k);return new o(E,this.h|T.h)},n.xor=function(T){for(var _=Math.max(this.g.length,T.g.length),E=[],k=0;k<_;k++)E[k]=this.i(k)^T.i(k);return new o(E,this.h^T.h)};function ne(T){for(var _=T.g.length+1,E=[],k=0;k<_;k++)E[k]=T.i(k)<<1|T.i(k-1)>>>31;return new o(E,T.h)}function re(T,_){var E=_>>5;_%=32;for(var k=T.g.length-E,D=[],S=0;S<k;S++)D[S]=0<_?T.i(S+E)>>>_|T.i(S+E+1)<<32-_:T.i(S+E);return new o(D,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Ux=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,Yo=o}).apply(typeof A0<"u"?A0:typeof self<"u"?self:typeof window<"u"?window:{});var Ad=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var jx,Cu,Bx,Hd,nm,qx,zx,Hx;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,y){return u==Array.prototype||u==Object.prototype||(u[p]=y.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ad=="object"&&Ad];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var I=0;I<u.length-1;I++){var q=u[I];if(!(q in y))break e;y=y[q]}u=u[u.length-1],I=y[u],p=p(I),p!=I&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var y=0,I=!1,q={next:function(){if(!I&&y<u.length){var Q=y++;return{value:p(Q,u[Q]),done:!1}}return I=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,y){return u.call.apply(u.bind,arguments)}function f(u,p,y){if(!u)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(q,I),u.apply(p,q)}}return function(){return u.apply(p,arguments)}}function m(u,p,y){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function v(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var I=y.slice();return I.push.apply(I,arguments),u.apply(this,I)}}function w(u,p){function y(){}y.prototype=p.prototype,u.aa=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Qb=function(I,q,Q){for(var Ie=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)Ie[Ct-2]=arguments[Ct];return p.prototype[q].apply(I,Ie)}}function x(u){const p=u.length;if(0<p){const y=Array(p);for(let I=0;I<p;I++)y[I]=u[I];return y}return[]}function A(u,p){for(let y=1;y<arguments.length;y++){const I=arguments[y];if(l(I)){const q=u.length||0,Q=I.length||0;u.length=q+Q;for(let Ie=0;Ie<Q;Ie++)u[q+Ie]=I[Ie]}else u.push(I)}}class L{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function F(u){return/^[\s\xa0]*$/.test(u)}function $(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function B(u){return B[" "](u),u}B[" "]=function(){};var ne=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function re(u,p,y){for(const I in u)p.call(y,u[I],I,u)}function T(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function _(u){const p={};for(const y in u)p[y]=u[y];return p}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(u,p){let y,I;for(let q=1;q<arguments.length;q++){I=arguments[q];for(y in I)u[y]=I[y];for(let Q=0;Q<E.length;Q++)y=E[Q],Object.prototype.hasOwnProperty.call(I,y)&&(u[y]=I[y])}}function D(u){var p=1;u=u.split(":");const y=[];for(;0<p&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function S(u){a.setTimeout(()=>{throw u},0)}function P(){var u=le;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class ke{constructor(){this.h=this.g=null}add(p,y){const I=Re.get();I.set(p,y),this.h?this.h.next=I:this.g=I,this.h=I}}var Re=new L(()=>new Pe,u=>u.reset());class Pe{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let Ce,_e=!1,le=new ke,Je=()=>{const u=a.Promise.resolve(void 0);Ce=()=>{u.then(oe)}};var oe=()=>{for(var u;u=P();){try{u.h.call(u.g)}catch(y){S(y)}var p=Re;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}_e=!1};function Z(){this.s=this.s,this.C=this.C}Z.prototype.s=!1,Z.prototype.ma=function(){this.s||(this.s=!0,this.N())},Z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Le(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Le.prototype.h=function(){this.defaultPrevented=!0};var ut=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function At(u,p){if(Le.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var y=this.type=u.type,I=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(ne){e:{try{B(p.nodeName);var q=!0;break e}catch{}q=!1}q||(p=null)}}else y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement);this.relatedTarget=p,I?(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Yt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&At.aa.h.call(this)}}w(At,Le);var Yt={2:"touch",3:"pen",4:"mouse"};At.prototype.h=function(){At.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var J="closure_listenable_"+(1e6*Math.random()|0),xe=0;function ve(u,p,y,I,q){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!I,this.ha=q,this.key=++xe,this.da=this.fa=!1}function De(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function it(u){this.src=u,this.g={},this.h=0}it.prototype.add=function(u,p,y,I,q){var Q=u.toString();u=this.g[Q],u||(u=this.g[Q]=[],this.h++);var Ie=C(u,p,I,q);return-1<Ie?(p=u[Ie],y||(p.fa=!1)):(p=new ve(p,this.src,Q,!!I,q),p.fa=y,u.push(p)),p};function gt(u,p){var y=p.type;if(y in u.g){var I=u.g[y],q=Array.prototype.indexOf.call(I,p,void 0),Q;(Q=0<=q)&&Array.prototype.splice.call(I,q,1),Q&&(De(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function C(u,p,y,I){for(var q=0;q<u.length;++q){var Q=u[q];if(!Q.da&&Q.listener==p&&Q.capture==!!y&&Q.ha==I)return q}return-1}var V="closure_lm_"+(1e6*Math.random()|0),H={};function K(u,p,y,I,q){if(I&&I.once)return ge(u,p,y,I,q);if(Array.isArray(p)){for(var Q=0;Q<p.length;Q++)K(u,p[Q],y,I,q);return null}return y=ze(y),u&&u[J]?u.K(p,y,c(I)?!!I.capture:!!I,q):X(u,p,y,!1,I,q)}function X(u,p,y,I,q,Q){if(!p)throw Error("Invalid event type");var Ie=c(q)?!!q.capture:!!q,Ct=Ae(u);if(Ct||(u[V]=Ct=new it(u)),y=Ct.add(p,y,I,Ie,Q),y.proxy)return y;if(I=ue(),y.proxy=I,I.src=u,I.listener=y,u.addEventListener)ut||(q=Ie),q===void 0&&(q=!1),u.addEventListener(p.toString(),I,q);else if(u.attachEvent)u.attachEvent(pe(p.toString()),I);else if(u.addListener&&u.removeListener)u.addListener(I);else throw Error("addEventListener and attachEvent are unavailable.");return y}function ue(){function u(y){return p.call(u.src,u.listener,y)}const p=Fe;return u}function ge(u,p,y,I,q){if(Array.isArray(p)){for(var Q=0;Q<p.length;Q++)ge(u,p[Q],y,I,q);return null}return y=ze(y),u&&u[J]?u.L(p,y,c(I)?!!I.capture:!!I,q):X(u,p,y,!0,I,q)}function me(u,p,y,I,q){if(Array.isArray(p))for(var Q=0;Q<p.length;Q++)me(u,p[Q],y,I,q);else I=c(I)?!!I.capture:!!I,y=ze(y),u&&u[J]?(u=u.i,p=String(p).toString(),p in u.g&&(Q=u.g[p],y=C(Q,y,I,q),-1<y&&(De(Q[y]),Array.prototype.splice.call(Q,y,1),Q.length==0&&(delete u.g[p],u.h--)))):u&&(u=Ae(u))&&(p=u.g[p.toString()],u=-1,p&&(u=C(p,y,I,q)),(y=-1<u?p[u]:null)&&ye(y))}function ye(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[J])gt(p.i,u);else{var y=u.type,I=u.proxy;p.removeEventListener?p.removeEventListener(y,I,u.capture):p.detachEvent?p.detachEvent(pe(y),I):p.addListener&&p.removeListener&&p.removeListener(I),(y=Ae(p))?(gt(y,u),y.h==0&&(y.src=null,p[V]=null)):De(u)}}}function pe(u){return u in H?H[u]:H[u]="on"+u}function Fe(u,p){if(u.da)u=!0;else{p=new At(p,this);var y=u.listener,I=u.ha||u.src;u.fa&&ye(u),u=y.call(I,p)}return u}function Ae(u){return u=u[V],u instanceof it?u:null}var Oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function ze(u){return typeof u=="function"?u:(u[Oe]||(u[Oe]=function(p){return u.handleEvent(p)}),u[Oe])}function He(){Z.call(this),this.i=new it(this),this.M=this,this.F=null}w(He,Z),He.prototype[J]=!0,He.prototype.removeEventListener=function(u,p,y,I){me(this,u,p,y,I)};function Ze(u,p){var y,I=u.F;if(I)for(y=[];I;I=I.F)y.push(I);if(u=u.M,I=p.type||p,typeof p=="string")p=new Le(p,u);else if(p instanceof Le)p.target=p.target||u;else{var q=p;p=new Le(I,u),k(p,q)}if(q=!0,y)for(var Q=y.length-1;0<=Q;Q--){var Ie=p.g=y[Q];q=ct(Ie,I,!0,p)&&q}if(Ie=p.g=u,q=ct(Ie,I,!0,p)&&q,q=ct(Ie,I,!1,p)&&q,y)for(Q=0;Q<y.length;Q++)Ie=p.g=y[Q],q=ct(Ie,I,!1,p)&&q}He.prototype.N=function(){if(He.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var y=u.g[p],I=0;I<y.length;I++)De(y[I]);delete u.g[p],u.h--}}this.F=null},He.prototype.K=function(u,p,y,I){return this.i.add(String(u),p,!1,y,I)},He.prototype.L=function(u,p,y,I){return this.i.add(String(u),p,!0,y,I)};function ct(u,p,y,I){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var q=!0,Q=0;Q<p.length;++Q){var Ie=p[Q];if(Ie&&!Ie.da&&Ie.capture==y){var Ct=Ie.listener,Dn=Ie.ha||Ie.src;Ie.fa&&gt(u.i,Ie),q=Ct.call(Dn,I)!==!1&&q}}return q&&!I.defaultPrevented}function vn(u,p,y){if(typeof u=="function")y&&(u=m(u,y));else if(u&&typeof u.handleEvent=="function")u=m(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function rn(u){u.g=vn(()=>{u.g=null,u.i&&(u.i=!1,rn(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class Hn extends Z{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:rn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function qt(u){Z.call(this),this.h=u,this.g={}}w(qt,Z);var Ur=[];function jr(u){re(u.g,function(p,y){this.g.hasOwnProperty(y)&&ye(p)},u),u.g={}}qt.prototype.N=function(){qt.aa.N.call(this),jr(this)},qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Gt=a.JSON.stringify,un=a.JSON.parse,Br=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function ee(){}ee.prototype.h=null;function j(u){return u.h||(u.h=u.i())}function we(){}var je={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ke(){Le.call(this,"d")}w(Ke,Le);function at(){Le.call(this,"c")}w(at,Le);var vt={},Tt=null;function Cn(){return Tt=Tt||new He}vt.La="serverreachability";function kn(u){Le.call(this,vt.La,u)}w(kn,Le);function Zn(u){const p=Cn();Ze(p,new kn(p))}vt.STAT_EVENT="statevent";function rt(u,p){Le.call(this,vt.STAT_EVENT,u),this.stat=p}w(rt,Le);function St(u){const p=Cn();Ze(p,new rt(p,u))}vt.Ma="timingevent";function er(u,p){Le.call(this,vt.Ma,u),this.size=p}w(er,Le);function tr(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function Mn(){this.g=!0}Mn.prototype.xa=function(){this.g=!1};function Aa(u,p,y,I,q,Q){u.info(function(){if(u.g)if(Q)for(var Ie="",Ct=Q.split("&"),Dn=0;Dn<Ct.length;Dn++){var It=Ct[Dn].split("=");if(1<It.length){var $n=It[0];It=It[1];var Fn=$n.split("_");Ie=2<=Fn.length&&Fn[1]=="type"?Ie+($n+"="+It+"&"):Ie+($n+"=redacted&")}}else Ie=null;else Ie=Q;return"XMLHTTP REQ ("+I+") [attempt "+q+"]: "+p+`
`+y+`
`+Ie})}function Sa(u,p,y,I,q,Q,Ie){u.info(function(){return"XMLHTTP RESP ("+I+") [ attempt "+q+"]: "+p+`
`+y+`
`+Q+" "+Ie})}function cs(u,p,y,I){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+qf(u,y)+(I?" "+I:"")})}function Bf(u,p){u.info(function(){return"TIMEOUT: "+p})}Mn.prototype.info=function(){};function qf(u,p){if(!u.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(u=0;u<y.length;u++)if(Array.isArray(y[u])){var I=y[u];if(!(2>I.length)){var q=I[1];if(Array.isArray(q)&&!(1>q.length)){var Q=q[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(var Ie=1;Ie<q.length;Ie++)q[Ie]=""}}}}return Gt(y)}catch{return p}}var Pa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ra;function Ca(){}w(Ca,ee),Ca.prototype.g=function(){return new XMLHttpRequest},Ca.prototype.i=function(){return{}},Ra=new Ca;function Yr(u,p,y,I){this.j=u,this.i=p,this.l=y,this.R=I||1,this.U=new qt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new id}function id(){this.i=null,this.g="",this.h=!1}var eu={},tu={};function qr(u,p,y){u.L=1,u.v=wo(yr(p)),u.m=y,u.P=!0,ds(u,null)}function ds(u,p){u.F=Date.now(),Rr(u),u.A=yr(u.v);var y=u.A,I=u.R;Array.isArray(I)||(I=[String(I)]),dd(y.i,"t",I),u.C=0,y=u.j.J,u.h=new id,u.g=hu(u.j,y?p:null,!u.m),0<u.O&&(u.M=new Hn(m(u.Y,u,u.g),u.O)),p=u.U,y=u.g,I=u.ca;var q="readystatechange";Array.isArray(q)||(q&&(Ur[0]=q.toString()),q=Ur);for(var Q=0;Q<q.length;Q++){var Ie=K(y,q[Q],I||p.handleEvent,!1,p.h||p);if(!Ie)break;p.g[Ie.key]=Ie}p=u.H?_(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Zn(),Aa(u.i,u.u,u.A,u.l,u.R,u.m)}Yr.prototype.ca=function(u){u=u.target;const p=this.M;p&&yn(u)==3?p.j():this.Y(u)},Yr.prototype.Y=function(u){try{if(u==this.g)e:{const Fn=yn(this.g);var p=this.g.Ba();const Pi=this.g.Z();if(!(3>Fn)&&(Fn!=3||this.g&&(this.h.h||this.g.oa()||fd(this.g)))){this.J||Fn!=4||p==7||(p==8||0>=Pi?Zn(3):Zn(2)),gi(this);var y=this.g.Z();this.X=y;t:if(Xr(this)){var I=fd(this.g);u="";var q=I.length,Q=yn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Rs(this),Zr(this);var Ie="";break t}this.h.i=new a.TextDecoder}for(p=0;p<q;p++)this.h.h=!0,u+=this.h.i.decode(I[p],{stream:!(Q&&p==q-1)});I.length=0,this.h.g+=u,this.C=0,Ie=this.h.g}else Ie=this.g.oa();if(this.o=y==200,Sa(this.i,this.u,this.A,this.l,this.R,Fn,y),this.o){if(this.T&&!this.K){t:{if(this.g){var Ct,Dn=this.g;if((Ct=Dn.g?Dn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(Ct)){var It=Ct;break t}}It=null}if(y=It)cs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,vr(this,y);else{this.o=!1,this.s=3,St(12),Rs(this),Zr(this);break e}}if(this.P){y=!0;let Dr;for(;!this.J&&this.C<Ie.length;)if(Dr=mi(this,Ie),Dr==tu){Fn==4&&(this.s=4,St(14),y=!1),cs(this.i,this.l,null,"[Incomplete Response]");break}else if(Dr==eu){this.s=4,St(15),cs(this.i,this.l,Ie,"[Invalid Chunk]"),y=!1;break}else cs(this.i,this.l,Dr,null),vr(this,Dr);if(Xr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Fn!=4||Ie.length!=0||this.h.h||(this.s=1,St(16),y=!1),this.o=this.o&&y,!y)cs(this.i,this.l,Ie,"[Invalid Chunked Response]"),Rs(this),Zr(this);else if(0<Ie.length&&!this.W){this.W=!0;var $n=this.j;$n.g==this&&$n.ba&&!$n.M&&($n.j.info("Great, no buffering proxy detected. Bytes received: "+Ie.length),Ua($n),$n.M=!0,St(11))}}else cs(this.i,this.l,Ie,null),vr(this,Ie);Fn==4&&Rs(this),this.o&&!this.J&&(Fn==4?So(this.j,this):(this.o=!1,Rr(this)))}else lu(this.g),y==400&&0<Ie.indexOf("Unknown SID")?(this.s=3,St(12)):(this.s=0,St(13)),Rs(this),Zr(this)}}}catch{}finally{}};function Xr(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function mi(u,p){var y=u.C,I=p.indexOf(`
`,y);return I==-1?tu:(y=Number(p.substring(y,I)),isNaN(y)?eu:(I+=1,I+y>p.length?tu:(p=p.slice(I,I+y),u.C=I+y,p)))}Yr.prototype.cancel=function(){this.J=!0,Rs(this)};function Rr(u){u.S=Date.now()+u.I,nu(u,u.I)}function nu(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=tr(m(u.ba,u),p)}function gi(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Yr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Bf(this.i,this.A),this.L!=2&&(Zn(),St(17)),Rs(this),this.s=2,Zr(this)):nu(this,this.S-u)};function Zr(u){u.j.G==0||u.J||So(u.j,u)}function Rs(u){gi(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,jr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function vr(u,p){try{var y=u.j;if(y.G!=0&&(y.g==u||Kn(y.h,u))){if(!u.K&&Kn(y.h,u)&&y.G==3){try{var I=y.Da.g.parse(p)}catch{I=null}if(Array.isArray(I)&&I.length==3){var q=I;if(q[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<u.F)Ai(y),Eo(y);else break e;du(y),St(18)}}else y.za=q[1],0<y.za-y.T&&37500>q[2]&&y.F&&y.v==0&&!y.C&&(y.C=tr(m(y.Za,y),6e3));if(1>=ad(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else vs(y,11)}else if((u.K||y.g==u)&&Ai(y),!F(p))for(q=y.Da.g.parse(p),p=0;p<q.length;p++){let It=q[p];if(y.T=It[0],It=It[1],y.G==2)if(It[0]=="c"){y.K=It[1],y.ia=It[2];const $n=It[3];$n!=null&&(y.la=$n,y.j.info("VER="+y.la));const Fn=It[4];Fn!=null&&(y.Aa=Fn,y.j.info("SVER="+y.Aa));const Pi=It[5];Pi!=null&&typeof Pi=="number"&&0<Pi&&(I=1.5*Pi,y.L=I,y.j.info("backChannelRequestTimeoutMs_="+I)),I=y;const Dr=u.g;if(Dr){const Nr=Dr.g?Dr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Nr){var Q=I.h;Q.g||Nr.indexOf("spdy")==-1&&Nr.indexOf("quic")==-1&&Nr.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(vi(Q,Q.h),Q.h=null))}if(I.D){const fu=Dr.g?Dr.g.getResponseHeader("X-HTTP-Session-Id"):null;fu&&(I.ya=fu,Ft(I.I,I.D,fu))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-u.F,y.j.info("Handshake RTT: "+y.R+"ms")),I=y;var Ie=u;if(I.qa=vd(I,I.J?I.ia:null,I.W),Ie.K){Cr(I.h,Ie);var Ct=Ie,Dn=I.L;Dn&&(Ct.I=Dn),Ct.B&&(gi(Ct),Rr(Ct)),I.g=Ie}else Fa(I);0<y.i.length&&Ti(y)}else It[0]!="stop"&&It[0]!="close"||vs(y,7);else y.G==3&&(It[0]=="stop"||It[0]=="close"?It[0]=="stop"?vs(y,7):uu(y):It[0]!="noop"&&y.l&&y.l.ta(It),y.v=0)}}Zn(4)}catch{}}var od=class{constructor(u,p){this.g=u,this.map=p}};function ru(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ka(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function ad(u){return u.h?1:u.g?u.g.size:0}function Kn(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function vi(u,p){u.g?u.g.add(p):u.h=p}function Cr(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}ru.prototype.cancel=function(){if(this.i=su(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function su(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.D);return p}return x(u.i)}function ld(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],y=u.length,I=0;I<y;I++)p.push(u[I]);return p}p=[],y=0;for(I in u)p[y++]=u[I];return p}function _o(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var y=0;y<u;y++)p.push(y);return p}p=[],y=0;for(const I in u)p[y++]=I;return p}}}function yi(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var y=_o(u),I=ld(u),q=I.length,Q=0;Q<q;Q++)p.call(void 0,I[Q],y&&y[Q],u)}var bo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function _i(u,p){if(u){u=u.split("&");for(var y=0;y<u.length;y++){var I=u[y].indexOf("="),q=null;if(0<=I){var Q=u[y].substring(0,I);q=u[y].substring(I+1)}else Q=u[y];p(Q,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function hs(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof hs){this.h=u.h,_r(this,u.j),this.o=u.o,this.g=u.g,Da(this,u.s),this.l=u.l;var p=u.i,y=new wi;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),ud(this,y),this.m=u.m}else u&&(p=String(u).match(bo))?(this.h=!1,_r(this,p[1]||"",!0),this.o=fs(p[2]||""),this.g=fs(p[3]||"",!0),Da(this,p[4]),this.l=fs(p[5]||"",!0),ud(this,p[6]||"",!0),this.m=fs(p[7]||"")):(this.h=!1,this.i=new wi(null,this.h))}hs.prototype.toString=function(){var u=[],p=this.j;p&&u.push(ps(p,Be,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(ps(p,Be,!0),"@"),u.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&u.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(ps(y,y.charAt(0)=="/"?kr:xt,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",ps(y,zf)),u.join("")};function yr(u){return new hs(u)}function _r(u,p,y){u.j=y?fs(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function Da(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function ud(u,p,y){p instanceof wi?(u.i=p,Oa(u.i,u.h)):(y||(p=ps(p,bi)),u.i=new wi(p,u.h))}function Ft(u,p,y){u.i.set(p,y)}function wo(u){return Ft(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function fs(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function ps(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,iu),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function iu(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Be=/[#\/\?@]/g,xt=/[#\?:]/g,kr=/[#\?]/g,bi=/[#\?@]/g,zf=/#/g;function wi(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function ms(u){u.g||(u.g=new Map,u.h=0,u.i&&_i(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=wi.prototype,n.add=function(u,p){ms(this),this.i=null,u=zr(this,u);var y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function cd(u,p){ms(u),p=zr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Na(u,p){return ms(u),p=zr(u,p),u.g.has(p)}n.forEach=function(u,p){ms(this),this.g.forEach(function(y,I){y.forEach(function(q){u.call(p,q,I,this)},this)},this)},n.na=function(){ms(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let I=0;I<p.length;I++){const q=u[I];for(let Q=0;Q<q.length;Q++)y.push(p[I])}return y},n.V=function(u){ms(this);let p=[];if(typeof u=="string")Na(this,u)&&(p=p.concat(this.g.get(zr(this,u))));else{u=Array.from(this.g.values());for(let y=0;y<u.length;y++)p=p.concat(u[y])}return p},n.set=function(u,p){return ms(this),this.i=null,u=zr(this,u),Na(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function dd(u,p,y){cd(u,p),0<y.length&&(u.i=null,u.g.set(zr(u,p),x(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var I=p[y];const Q=encodeURIComponent(String(I)),Ie=this.V(I);for(I=0;I<Ie.length;I++){var q=Q;Ie[I]!==""&&(q+="="+encodeURIComponent(String(Ie[I]))),u.push(q)}}return this.i=u.join("&")};function zr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Oa(u,p){p&&!u.j&&(ms(u),u.i=null,u.g.forEach(function(y,I){var q=I.toLowerCase();I!=q&&(cd(this,I),dd(this,q,y))},u)),u.j=p}function xi(u,p){const y=new Mn;if(a.Image){const I=new Image;I.onload=v(br,y,"TestLoadImage: loaded",!0,p,I),I.onerror=v(br,y,"TestLoadImage: error",!1,p,I),I.onabort=v(br,y,"TestLoadImage: abort",!1,p,I),I.ontimeout=v(br,y,"TestLoadImage: timeout",!1,p,I),a.setTimeout(function(){I.ontimeout&&I.ontimeout()},1e4),I.src=u}else p(!1)}function Ii(u,p){const y=new Mn,I=new AbortController,q=setTimeout(()=>{I.abort(),br(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:I.signal}).then(Q=>{clearTimeout(q),Q.ok?br(y,"TestPingServer: ok",!0,p):br(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(q),br(y,"TestPingServer: error",!1,p)})}function br(u,p,y,I,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),I(y)}catch{}}function xo(){this.g=new Br}function Va(u,p,y){const I=y||"";try{yi(u,function(q,Q){let Ie=q;c(q)&&(Ie=Gt(q)),p.push(I+Q+"="+encodeURIComponent(Ie))})}catch(q){throw p.push(I+"type="+encodeURIComponent("_badmap")),q}}function Ma(u){this.l=u.Ub||null,this.j=u.eb||!1}w(Ma,ee),Ma.prototype.g=function(){return new La(this.l,this.j)},Ma.prototype.i=function(u){return function(){return u}}({});function La(u,p){He.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(La,He),n=La.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Xe(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ei(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Xe(this)),this.g&&(this.readyState=3,Xe(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;hd(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function hd(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Ei(this):Xe(this),this.readyState==3&&hd(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Ei(this))},n.Qa=function(u){this.g&&(this.response=u,Ei(this))},n.ga=function(){this.g&&Ei(this)};function Ei(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Xe(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function Xe(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(La.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function dt(u){let p="";return re(u,function(y,I){p+=I,p+=":",p+=y,p+=`\r
`}),p}function Xt(u,p,y){e:{for(I in y){var I=!1;break e}I=!0}I||(y=dt(y),typeof u=="string"?y!=null&&encodeURIComponent(String(y)):Ft(u,p,y))}function Qe(u){He.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(Qe,He);var Hf=/^https?$/i,ou=["POST","PUT"];n=Qe.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,y,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ra.g(),this.v=this.o?j(this.o):j(Ra),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(Q){au(this,Q);return}if(u=y||"",y=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var q in I)y.set(q,I[q]);else if(typeof I.keys=="function"&&typeof I.get=="function")for(const Q of I.keys())y.set(Q,I.get(Q));else throw Error("Unknown input type for opt_headers: "+String(I));I=Array.from(y.keys()).find(Q=>Q.toLowerCase()=="content-type"),q=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(ou,p,void 0))||I||q||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,Ie]of y)this.g.setRequestHeader(Q,Ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ks(this),this.u=!0,this.g.send(u),this.u=!1}catch(Q){au(this,Q)}};function au(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Cs(u),$a(u)}function Cs(u){u.A||(u.A=!0,Ze(u,"complete"),Ze(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Ze(this,"complete"),Ze(this,"abort"),$a(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$a(this,!0)),Qe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?gs(this):this.bb())},n.bb=function(){gs(this)};function gs(u){if(u.h&&typeof o<"u"&&(!u.v[1]||yn(u)!=4||u.Z()!=2)){if(u.u&&yn(u)==4)vn(u.Ea,0,u);else if(Ze(u,"readystatechange"),yn(u)==4){u.h=!1;try{const Ie=u.Z();e:switch(Ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var I;if(I=Ie===0){var q=String(u.D).match(bo)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),I=!Hf.test(q?q.toLowerCase():"")}y=I}if(y)Ze(u,"complete"),Ze(u,"success");else{u.m=6;try{var Q=2<yn(u)?u.g.statusText:""}catch{Q=""}u.l=Q+" ["+u.Z()+"]",Cs(u)}}finally{$a(u)}}}}function $a(u,p){if(u.g){ks(u);const y=u.g,I=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Ze(u,"ready");try{y.onreadystatechange=I}catch{}}}function ks(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function yn(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<yn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),un(p)}};function fd(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function lu(u){const p={};u=(u.g&&2<=yn(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let I=0;I<u.length;I++){if(F(u[I]))continue;var y=D(u[I]);const q=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const Q=p[q]||[];p[q]=Q,Q.push(y)}T(p,function(I){return I.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Io(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function pd(u){this.Aa=0,this.i=[],this.j=new Mn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Io("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Io("baseRetryDelayMs",5e3,u),this.cb=Io("retryDelaySeedMs",1e4,u),this.Wa=Io("forwardChannelMaxRetries",2,u),this.wa=Io("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new ru(u&&u.concurrentRequestLimit),this.Da=new xo,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=pd.prototype,n.la=8,n.G=1,n.connect=function(u,p,y,I){St(0),this.W=u,this.H=p||{},y&&I!==void 0&&(this.H.OSID=y,this.H.OAID=I),this.F=this.X,this.I=vd(this,null,this.W),Ti(this)};function uu(u){if(To(u),u.G==3){var p=u.U++,y=yr(u.I);if(Ft(y,"SID",u.K),Ft(y,"RID",p),Ft(y,"TYPE","terminate"),Ao(u,y),p=new Yr(u,u.j,p),p.L=2,p.v=wo(yr(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=hu(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Rr(p)}gd(u)}function Eo(u){u.g&&(Ua(u),u.g.cancel(),u.g=null)}function To(u){Eo(u),u.u&&(a.clearTimeout(u.u),u.u=null),Ai(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Ti(u){if(!ka(u.h)&&!u.s){u.s=!0;var p=u.Ga;Ce||Je(),_e||(Ce(),_e=!0),le.add(p,u),u.B=0}}function wr(u,p){return ad(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=tr(m(u.Ga,u,p),Po(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const q=new Yr(this,this.j,u);let Q=this.o;if(this.S&&(Q?(Q=_(Q),k(Q,this.S)):Q=this.S),this.m!==null||this.O||(q.H=Q,Q=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var I=this.i[y];if("__data__"in I.map&&(I=I.map.__data__,typeof I=="string")){I=I.length;break t}I=void 0}if(I===void 0)break;if(p+=I,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=cu(this,q,p),y=yr(this.I),Ft(y,"RID",u),Ft(y,"CVER",22),this.D&&Ft(y,"X-HTTP-Session-Id",this.D),Ao(this,y),Q&&(this.O?p="headers="+encodeURIComponent(String(dt(Q)))+"&"+p:this.m&&Xt(y,this.m,Q)),vi(this.h,q),this.Ua&&Ft(y,"TYPE","init"),this.P?(Ft(y,"$req",p),Ft(y,"SID","null"),q.T=!0,qr(q,y,null)):qr(q,y,p),this.G=2}}else this.G==3&&(u?md(this,u):this.i.length==0||ka(this.h)||md(this))};function md(u,p){var y;p?y=p.l:y=u.U++;const I=yr(u.I);Ft(I,"SID",u.K),Ft(I,"RID",y),Ft(I,"AID",u.T),Ao(u,I),u.m&&u.o&&Xt(I,u.m,u.o),y=new Yr(u,u.j,y,u.B+1),u.m===null&&(y.H=u.o),p&&(u.i=p.D.concat(u.i)),p=cu(u,y,1e3),y.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),vi(u.h,y),qr(y,I,p)}function Ao(u,p){u.H&&re(u.H,function(y,I){Ft(p,I,y)}),u.l&&yi({},function(y,I){Ft(p,I,y)})}function cu(u,p,y){y=Math.min(u.i.length,y);var I=u.l?m(u.l.Na,u.l,u):null;e:{var q=u.i;let Q=-1;for(;;){const Ie=["count="+y];Q==-1?0<y?(Q=q[0].g,Ie.push("ofs="+Q)):Q=0:Ie.push("ofs="+Q);let Ct=!0;for(let Dn=0;Dn<y;Dn++){let It=q[Dn].g;const $n=q[Dn].map;if(It-=Q,0>It)Q=Math.max(0,q[Dn].g-100),Ct=!1;else try{Va($n,Ie,"req"+It+"_")}catch{I&&I($n)}}if(Ct){I=Ie.join("&");break e}}}return u=u.i.splice(0,y),p.D=u,I}function Fa(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Ce||Je(),_e||(Ce(),_e=!0),le.add(p,u),u.v=0}}function du(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=tr(m(u.Fa,u),Po(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Ds(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=tr(m(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,St(10),Eo(this),Ds(this))};function Ua(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Ds(u){u.g=new Yr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=yr(u.qa);Ft(p,"RID","rpc"),Ft(p,"SID",u.K),Ft(p,"AID",u.T),Ft(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Ft(p,"TO",u.ja),Ft(p,"TYPE","xmlhttp"),Ao(u,p),u.m&&u.o&&Xt(p,u.m,u.o),u.L&&(u.g.I=u.L);var y=u.g;u=u.ia,y.L=1,y.v=wo(yr(p)),y.m=null,y.P=!0,ds(y,u)}n.Za=function(){this.C!=null&&(this.C=null,Eo(this),du(this),St(19))};function Ai(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function So(u,p){var y=null;if(u.g==p){Ai(u),Ua(u),u.g=null;var I=2}else if(Kn(u.h,p))y=p.D,Cr(u.h,p),I=1;else return;if(u.G!=0){if(p.o)if(I==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var q=u.B;I=Cn(),Ze(I,new er(I,y)),Ti(u)}else Fa(u);else if(q=p.s,q==3||q==0&&0<p.X||!(I==1&&wr(u,p)||I==2&&du(u)))switch(y&&0<y.length&&(p=u.h,p.i=p.i.concat(y)),q){case 1:vs(u,5);break;case 4:vs(u,10);break;case 3:vs(u,6);break;default:vs(u,2)}}}function Po(u,p){let y=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(y*=2),y*p}function vs(u,p){if(u.j.info("Error code "+p),p==2){var y=m(u.fb,u),I=u.Xa;const q=!I;I=new hs(I||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||_r(I,"https"),wo(I),q?xi(I.toString(),y):Ii(I.toString(),y)}else St(2);u.G=0,u.l&&u.l.sa(p),gd(u),To(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),St(2)):(this.j.info("Failed to ping google.com"),St(1))};function gd(u){if(u.G=0,u.ka=[],u.l){const p=su(u.h);(p.length!=0||u.i.length!=0)&&(A(u.ka,p),A(u.ka,u.i),u.h.i.length=0,x(u.i),u.i.length=0),u.l.ra()}}function vd(u,p,y){var I=y instanceof hs?yr(y):new hs(y);if(I.g!="")p&&(I.g=p+"."+I.g),Da(I,I.s);else{var q=a.location;I=q.protocol,p=p?p+"."+q.hostname:q.hostname,q=+q.port;var Q=new hs(null);I&&_r(Q,I),p&&(Q.g=p),q&&Da(Q,q),y&&(Q.l=y),I=Q}return y=u.D,p=u.ya,y&&p&&Ft(I,y,p),Ft(I,"VER",u.la),Ao(u,I),I}function hu(u,p,y){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Qe(new Ma({eb:y})):new Qe(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ja(){}n=ja.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ns(){}Ns.prototype.g=function(u,p){return new Ln(u,p)};function Ln(u,p){He.call(this),this.g=new pd(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!F(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!F(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Si(this)}w(Ln,He),Ln.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ln.prototype.close=function(){uu(this.g)},Ln.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.u&&(y={},y.__data__=Gt(u),u=y);p.i.push(new od(p.Ya++,u)),p.G==3&&Ti(p)},Ln.prototype.N=function(){this.g.l=null,delete this.j,uu(this.g),delete this.g,Ln.aa.N.call(this)};function yd(u){Ke.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}w(yd,Ke);function _d(){at.call(this),this.status=1}w(_d,at);function Si(u){this.g=u}w(Si,ja),Si.prototype.ua=function(){Ze(this.g,"a")},Si.prototype.ta=function(u){Ze(this.g,new yd(u))},Si.prototype.sa=function(u){Ze(this.g,new _d)},Si.prototype.ra=function(){Ze(this.g,"b")},Ns.prototype.createWebChannel=Ns.prototype.g,Ln.prototype.send=Ln.prototype.o,Ln.prototype.open=Ln.prototype.m,Ln.prototype.close=Ln.prototype.close,Hx=function(){return new Ns},zx=function(){return Cn()},qx=vt,nm={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Pa.NO_ERROR=0,Pa.TIMEOUT=8,Pa.HTTP_ERROR=6,Hd=Pa,sd.COMPLETE="complete",Bx=sd,we.EventType=je,je.OPEN="a",je.CLOSE="b",je.ERROR="c",je.MESSAGE="d",He.prototype.listen=He.prototype.K,Cu=we,Qe.prototype.listenOnce=Qe.prototype.L,Qe.prototype.getLastError=Qe.prototype.Ka,Qe.prototype.getLastErrorCode=Qe.prototype.Ba,Qe.prototype.getStatus=Qe.prototype.Z,Qe.prototype.getResponseJson=Qe.prototype.Oa,Qe.prototype.getResponseText=Qe.prototype.oa,Qe.prototype.send=Qe.prototype.ea,Qe.prototype.setWithCredentials=Qe.prototype.Ha,jx=Qe}).apply(typeof Ad<"u"?Ad:typeof self<"u"?self:typeof window<"u"?window:{});const S0="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}jn.UNAUTHENTICATED=new jn(null),jn.GOOGLE_CREDENTIALS=new jn("google-credentials-uid"),jn.FIRST_PARTY=new jn("first-party-uid"),jn.MOCK_USER=new jn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const so=new lg("@firebase/firestore");function Ja(){return so.logLevel}function VH(n){so.setLogLevel(n)}function de(n,...e){if(so.logLevel<=yt.DEBUG){const t=e.map(yg);so.debug(`Firestore (${Fl}): ${n}`,...t)}}function xn(n,...e){if(so.logLevel<=yt.ERROR){const t=e.map(yg);so.error(`Firestore (${Fl}): ${n}`,...t)}}function Qr(n,...e){if(so.logLevel<=yt.WARN){const t=e.map(yg);so.warn(`Firestore (${Fl}): ${n}`,...t)}}function yg(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n="Unexpected state"){const e=`FIRESTORE (${Fl}) INTERNAL ASSERTION FAILED: `+n;throw xn(e),new Error(e)}function $e(n,e){n||Ne()}function MH(n,e){n||Ne()}function Te(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends us{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class e2{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(jn.UNAUTHENTICATED))}shutdown(){}}class t2{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class n2{constructor(e){this.t=e,this.currentUser=jn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){$e(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new qn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new qn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{de("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(de("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new qn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(de("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($e(typeof r.accessToken=="string"),new Kx(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return $e(e===null||typeof e=="string"),new jn(e)}}class r2{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=jn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class s2{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new r2(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(jn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Gx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class i2{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){$e(this.o===void 0);const r=i=>{i.error!=null&&de("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,de("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{de("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):de("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($e(typeof t.token=="string"),this.R=t.token,new Gx(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class LH{getToken(){return Promise.resolve(new Gx(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=o2(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function et(n,e){return n<e?-1:n>e?1:0}function vl(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function Qx(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new he(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new he(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new he(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new he(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return an.fromMillis(Date.now())}static fromDate(e){return an.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new an(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?et(this.nanoseconds,e.nanoseconds):et(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new qe(e)}static min(){return new qe(new an(0,0))}static max(){return new qe(new an(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ne(),r===void 0?r=e.length-t:r>e.length-t&&Ne(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return hc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof hc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class bt extends hc{construct(e,t,r){return new bt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new he(W.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new bt(t)}static emptyPath(){return new bt([])}}const a2=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tn extends hc{construct(e,t,r){return new tn(e,t,r)}static isValidIdentifier(e){return a2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new tn(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new he(W.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new he(W.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new he(W.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new he(W.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tn(t)}static emptyPath(){return new tn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.path=e}static fromPath(e){return new Se(bt.fromString(e))}static fromName(e){return new Se(bt.fromString(e).popFirst(5))}static empty(){return new Se(bt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&bt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return bt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Se(new bt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function rm(n){return n.fields.find(e=>e.kind===2)}function Fo(n){return n.fields.filter(e=>e.kind!==2)}function l2(n,e){let t=et(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=u2(n.fields[r],e.fields[r]),t!==0)return t;return et(n.fields.length,e.fields.length)}yl.UNKNOWN_ID=-1;class Xo{constructor(e,t){this.fieldPath=e,this.kind=t}}function u2(n,e){const t=tn.comparator(n.fieldPath,e.fieldPath);return t!==0?t:et(n.kind,e.kind)}class _l{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new _l(0,Fr.min())}}function Jx(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=qe.fromTimestamp(r===1e9?new an(t+1,0):new an(t,r));return new Fr(s,Se.empty(),e)}function Yx(n){return new Fr(n.readTime,n.key,-1)}class Fr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Fr(qe.min(),Se.empty(),-1)}static max(){return new Fr(qe.max(),Se.empty(),-1)}}function _g(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Se.comparator(n.documentKey,e.documentKey),t!==0?t:et(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Zx{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function po(n){if(n.code!==W.FAILED_PRECONDITION||n.message!==Xx)throw n;de("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ne(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new qn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Bu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=bg(r.target.error);this.V.reject(new Bu(e,s))}}static open(e,t,r,s){try{return new tf(t,e.transaction(s,r))}catch(i){throw new Bu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(de("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new d2(t)}}class Ts{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Ts.S(On())===12.2&&xn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return de("SimpleDb","Removing database:",e),qo(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!ag())return!1;if(Ts.v())return!0;const e=On(),t=Ts.S(e),r=0<t&&t<10,s=eI(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(de("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Bu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new he(W.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new he(W.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Bu(e,o))},s.onupgradeneeded=i=>{de("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{de("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=tf.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(de("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function eI(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class c2{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return qo(this.B.delete())}}class Bu extends he{constructor(e,t){super(W.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function mo(n){return n.name==="IndexedDbTransactionError"}class d2{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(de("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(de("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),qo(r)}add(e){return de("SimpleDb","ADD",this.store.name,e,e),qo(this.store.add(e))}get(e){return qo(this.store.get(e)).next(t=>(t===void 0&&(t=null),de("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return de("SimpleDb","DELETE",this.store.name,e),qo(this.store.delete(e))}count(){return de("SimpleDb","COUNT",this.store.name),qo(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){de("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=bg(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new c2(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const h=c.catch(f=>(l.done(),z.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function qo(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=bg(r.target.error);t(s)}})}let P0=!1;function bg(n){const e=Ts.S(On());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new he("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return P0||(P0=!0,setTimeout(()=>{throw r},0)),r}}return n}class h2{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){de("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{de("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){mo(t)?de("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await po(t)}await this.X(6e4)})}}class f2{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return de("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(de("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Yx(i);_g(o,r)>0&&(r=o)}),new Fr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Er.oe=-1;function Mc(n){return n==null}function fc(n){return n===0&&1/n==-1/0}function tI(n){return typeof n=="number"&&Number.isInteger(n)&&!fc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=R0(e)),e=p2(n.get(t),e);return R0(e)}function p2(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function R0(n){return n+""}function ws(n){const e=n.length;if($e(e>=2),e===2)return $e(n.charAt(0)===""&&n.charAt(1)===""),bt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ne(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ne()}i=o+2}return new bt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C0=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kd(n,e){return[n,lr(e)]}function nI(n,e,t){return[n,lr(e),t]}const m2={},g2=["prefixPath","collectionGroup","readTime","documentId"],v2=["prefixPath","collectionGroup","documentId"],y2=["collectionGroup","readTime","prefixPath","documentId"],_2=["canonicalId","targetId"],b2=["targetId","path"],w2=["path","targetId"],x2=["collectionId","parent"],I2=["indexId","uid"],E2=["uid","sequenceNumber"],T2=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],A2=["indexId","uid","orderedDocumentKey"],S2=["userId","collectionPath","documentId"],P2=["userId","collectionPath","largestBatchId"],R2=["userId","collectionGroup","largestBatchId"],rI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],C2=[...rI,"documentOverlays"],sI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],iI=sI,wg=[...iI,"indexConfiguration","indexState","indexEntries"],k2=wg,D2=[...wg,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm extends Zx{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Vn(n,e){const t=Te(n);return Ts.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k0(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function go(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function oI(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function aI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e,t){this.comparator=e,this.root=t||Wn.EMPTY}insert(e,t){return new Ht(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Wn.BLACK,null,null))}remove(e){return new Ht(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Sd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Sd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Sd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Sd(this.root,e,this.comparator,!0)}}class Sd{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Wn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Wn.RED,this.left=s??Wn.EMPTY,this.right=i??Wn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Wn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Wn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Wn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ne();const e=this.left.check();if(e!==this.right.check())throw Ne();return e+(this.isRed()?0:1)}}Wn.EMPTY=null,Wn.RED=!0,Wn.BLACK=!1;Wn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ne()}get value(){throw Ne()}get color(){throw Ne()}get left(){throw Ne()}get right(){throw Ne()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Wn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.comparator=e,this.data=new Ht(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new D0(this.data.getIterator())}getIteratorFrom(e){return new D0(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof $t)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new $t(this.comparator);return t.data=e,t}}class D0{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ha(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(e){this.fields=e,e.sort(tn.comparator)}static empty(){return new Tr([])}unionWith(e){let t=new $t(tn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Tr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return vl(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FH(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new lI("Invalid base64 string: "+i):i}}(e);return new fn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new fn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return et(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}fn.EMPTY_BYTE_STRING=new fn("");const N2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ti(n){if($e(!!n),typeof n=="string"){let e=0;const t=N2.exec(n);if($e(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:en(n.seconds),nanos:en(n.nanos)}}function en(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ni(n){return typeof n=="string"?fn.fromBase64String(n):fn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function rf(n){const e=n.mapValue.fields.__previous_value__;return nf(e)?rf(e):e}function pc(n){const e=ti(n.mapValue.fields.__local_write_time__.timestampValue);return new an(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O2{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class sa{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new sa("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof sa&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Gd={nullValue:"NULL_VALUE"};function io(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?nf(n)?4:uI(n)?9007199254740991:sf(n)?10:11:Ne()}function Ps(n,e){if(n===e)return!0;const t=io(n);if(t!==io(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return pc(n).isEqual(pc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ti(s.timestampValue),a=ti(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ni(s.bytesValue).isEqual(ni(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return en(s.geoPointValue.latitude)===en(i.geoPointValue.latitude)&&en(s.geoPointValue.longitude)===en(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return en(s.integerValue)===en(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=en(s.doubleValue),a=en(i.doubleValue);return o===a?fc(o)===fc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return vl(n.arrayValue.values||[],e.arrayValue.values||[],Ps);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(k0(o)!==k0(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ps(o[l],a[l])))return!1;return!0}(n,e);default:return Ne()}}function mc(n,e){return(n.values||[]).find(t=>Ps(t,e))!==void 0}function oo(n,e){if(n===e)return 0;const t=io(n),r=io(e);if(t!==r)return et(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return et(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=en(i.integerValue||i.doubleValue),l=en(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return N0(n.timestampValue,e.timestampValue);case 4:return N0(pc(n),pc(e));case 5:return et(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ni(i),l=ni(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=et(a[c],l[c]);if(h!==0)return h}return et(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=et(en(i.latitude),en(o.latitude));return a!==0?a:et(en(i.longitude),en(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return O0(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},m=o.fields||{},v=(a=f.value)===null||a===void 0?void 0:a.arrayValue,w=(l=m.value)===null||l===void 0?void 0:l.arrayValue,x=et(((c=v==null?void 0:v.values)===null||c===void 0?void 0:c.length)||0,((h=w==null?void 0:w.values)===null||h===void 0?void 0:h.length)||0);return x!==0?x:O0(v,w)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Wi.mapValue&&o===Wi.mapValue)return 0;if(i===Wi.mapValue)return 1;if(o===Wi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const m=et(l[f],h[f]);if(m!==0)return m;const v=oo(a[l[f]],c[h[f]]);if(v!==0)return v}return et(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Ne()}}function N0(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return et(n,e);const t=ti(n),r=ti(e),s=et(t.seconds,r.seconds);return s!==0?s:et(t.nanos,r.nanos)}function O0(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=oo(t[s],r[s]);if(i)return i}return et(t.length,r.length)}function bl(n){return im(n)}function im(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ti(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ni(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Se.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=im(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${im(t.fields[o])}`;return s+"}"}(n.mapValue):Ne()}function Wd(n){switch(io(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=rf(n);return e?16+Wd(e):16;case 5:return 2*n.stringValue.length;case 6:return ni(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Wd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return go(r.fields,(i,o)=>{s+=i.length+Wd(o)}),s}(n.mapValue);default:throw Ne()}}function ia(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function om(n){return!!n&&"integerValue"in n}function gc(n){return!!n&&"arrayValue"in n}function V0(n){return!!n&&"nullValue"in n}function M0(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qd(n){return!!n&&"mapValue"in n}function sf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function qu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return go(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=qu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function uI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const cI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function V2(n){return"nullValue"in n?Gd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ia(sa.empty(),Se.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?sf(n)?cI:{mapValue:{}}:Ne()}function M2(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ia(sa.empty(),Se.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?cI:"mapValue"in n?sf(n)?{mapValue:{}}:Wi:Ne()}function L0(n,e){const t=oo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function $0(n,e){const t=oo(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this.value=e}static empty(){return new Yn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Qd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qu(t)}setAll(e){let t=tn.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=qu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Qd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ps(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Qd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){go(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Yn(qu(this.value))}}function dI(n){const e=[];return go(n.fields,(t,r)=>{const s=new tn([t]);if(Qd(r)){const i=dI(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Tr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Wt(e,0,qe.min(),qe.min(),qe.min(),Yn.empty(),0)}static newFoundDocument(e,t,r,s){return new Wt(e,1,t,qe.min(),r,s,0)}static newNoDocument(e,t){return new Wt(e,2,t,qe.min(),qe.min(),Yn.empty(),0)}static newUnknownDocument(e,t){return new Wt(e,3,t,qe.min(),qe.min(),Yn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(qe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Yn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Yn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Wt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Wt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t){this.position=e,this.inclusive=t}}function F0(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Se.comparator(Se.fromName(o.referenceValue),t.key):r=oo(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function U0(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ps(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vc{constructor(e,t="asc"){this.field=e,this.dir=t}}function L2(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hI{}class wt extends hI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new $2(e,t,r):t==="array-contains"?new j2(e,r):t==="in"?new yI(e,r):t==="not-in"?new B2(e,r):t==="array-contains-any"?new q2(e,r):new wt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new F2(e,r):new U2(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(oo(t,this.value)):t!==null&&io(this.value)===io(t)&&this.matchesComparison(oo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ne()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Lt extends hI{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Lt(e,t)}matches(e){return wl(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function wl(n){return n.op==="and"}function am(n){return n.op==="or"}function xg(n){return fI(n)&&wl(n)}function fI(n){for(const e of n.filters)if(e instanceof Lt)return!1;return!0}function lm(n){if(n instanceof wt)return n.field.canonicalString()+n.op.toString()+bl(n.value);if(xg(n))return n.filters.map(e=>lm(e)).join(",");{const e=n.filters.map(t=>lm(t)).join(",");return`${n.op}(${e})`}}function pI(n,e){return n instanceof wt?function(r,s){return s instanceof wt&&r.op===s.op&&r.field.isEqual(s.field)&&Ps(r.value,s.value)}(n,e):n instanceof Lt?function(r,s){return s instanceof Lt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&pI(o,s.filters[a]),!0):!1}(n,e):void Ne()}function mI(n,e){const t=n.filters.concat(e);return Lt.create(t,n.op)}function gI(n){return n instanceof wt?function(t){return`${t.field.canonicalString()} ${t.op} ${bl(t.value)}`}(n):n instanceof Lt?function(t){return t.op.toString()+" {"+t.getFilters().map(gI).join(" ,")+"}"}(n):"Filter"}class $2 extends wt{constructor(e,t,r){super(e,t,r),this.key=Se.fromName(r.referenceValue)}matches(e){const t=Se.comparator(e.key,this.key);return this.matchesComparison(t)}}class F2 extends wt{constructor(e,t){super(e,"in",t),this.keys=vI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class U2 extends wt{constructor(e,t){super(e,"not-in",t),this.keys=vI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function vI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Se.fromName(r.referenceValue))}class j2 extends wt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return gc(t)&&mc(t.arrayValue,this.value)}}class yI extends wt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&mc(this.value.arrayValue,t)}}class B2 extends wt{constructor(e,t){super(e,"not-in",t)}matches(e){if(mc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!mc(this.value.arrayValue,t)}}class q2 extends wt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!gc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>mc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z2{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function um(n,e=null,t=[],r=[],s=null,i=null,o=null){return new z2(n,e,t,r,s,i,o)}function oa(n){const e=Te(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>lm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Mc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>bl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>bl(r)).join(",")),e.ue=t}return e.ue}function Lc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!L2(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!pI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!U0(n.startAt,e.startAt)&&U0(n.endAt,e.endAt)}function vh(n){return Se.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function yh(n,e){return n.filters.filter(t=>t instanceof wt&&t.field.isEqual(e))}function j0(n,e,t){let r=Gd,s=!0;for(const i of yh(n,e)){let o=Gd,a=!0;switch(i.op){case"<":case"<=":o=V2(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Gd}L0({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];L0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function B0(n,e,t){let r=Wi,s=!0;for(const i of yh(n,e)){let o=Wi,a=!0;switch(i.op){case">=":case">":o=M2(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Wi}$0({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];$0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ui{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function _I(n,e,t,r,s,i,o,a){return new ui(n,e,t,r,s,i,o,a)}function Ul(n){return new ui(n)}function q0(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ig(n){return n.collectionGroup!==null}function ul(n){const e=Te(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new $t(tn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new vc(i,r))}),t.has(tn.keyField().canonicalString())||e.ce.push(new vc(tn.keyField(),r))}return e.ce}function ur(n){const e=Te(n);return e.le||(e.le=wI(e,ul(n))),e.le}function bI(n){const e=Te(n);return e.he||(e.he=wI(e,n.explicitOrderBy)),e.he}function wI(n,e){if(n.limitType==="F")return um(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new vc(s.field,i)});const t=n.endAt?new ao(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ao(n.startAt.position,n.startAt.inclusive):null;return um(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function cm(n,e){const t=n.filters.concat([e]);return new ui(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function _h(n,e,t){return new ui(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function $c(n,e){return Lc(ur(n),ur(e))&&n.limitType===e.limitType}function xI(n){return`${oa(ur(n))}|lt:${n.limitType}`}function Ya(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>gI(s)).join(", ")}]`),Mc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>bl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>bl(s)).join(",")),`Target(${r})`}(ur(n))}; limitType=${n.limitType})`}function Fc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ul(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=F0(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,ul(r),s)||r.endAt&&!function(o,a,l){const c=F0(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,ul(r),s))}(n,e)}function II(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function EI(n){return(e,t)=>{let r=!1;for(const s of ul(n)){const i=H2(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function H2(n,e,t){const r=n.field.isKeyField()?Se.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?oo(l,c):Ne()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ne()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){go(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return aI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2=new Ht(Se.comparator);function Ar(){return K2}const TI=new Ht(Se.comparator);function ku(...n){let e=TI;for(const t of n)e=e.insert(t.key,t);return e}function AI(n){let e=TI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function xs(){return zu()}function SI(){return zu()}function zu(){return new ci(n=>n.toString(),(n,e)=>n.isEqual(e))}const G2=new Ht(Se.comparator),W2=new $t(Se.comparator);function ot(...n){let e=W2;for(const t of n)e=e.add(t);return e}const Q2=new $t(et);function Eg(){return Q2}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tg(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fc(e)?"-0":e}}function PI(n){return{integerValue:""+n}}function RI(n,e){return tI(e)?PI(e):Tg(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(){this._=void 0}}function J2(n,e,t){return n instanceof xl?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&nf(i)&&(i=rf(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof aa?kI(n,e):n instanceof la?DI(n,e):function(s,i){const o=CI(s,i),a=z0(o)+z0(s.Pe);return om(o)&&om(s.Pe)?PI(a):Tg(s.serializer,a)}(n,e)}function Y2(n,e,t){return n instanceof aa?kI(n,e):n instanceof la?DI(n,e):t}function CI(n,e){return n instanceof Il?function(r){return om(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class xl extends of{}class aa extends of{constructor(e){super(),this.elements=e}}function kI(n,e){const t=NI(e);for(const r of n.elements)t.some(s=>Ps(s,r))||t.push(r);return{arrayValue:{values:t}}}class la extends of{constructor(e){super(),this.elements=e}}function DI(n,e){let t=NI(e);for(const r of n.elements)t=t.filter(s=>!Ps(s,r));return{arrayValue:{values:t}}}class Il extends of{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function z0(n){return en(n.integerValue||n.doubleValue)}function NI(n){return gc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,t){this.field=e,this.transform=t}}function X2(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof aa&&s instanceof aa||r instanceof la&&s instanceof la?vl(r.elements,s.elements,Ps):r instanceof Il&&s instanceof Il?Ps(r.Pe,s.Pe):r instanceof xl&&s instanceof xl}(n.transform,e.transform)}class Z2{constructor(e,t){this.version=e,this.transformResults=t}}class nn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new nn}static exists(e){return new nn(void 0,e)}static updateTime(e){return new nn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Jd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class af{}function OI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Bl(n.key,nn.none()):new jl(n.key,n.data,nn.none());{const t=n.data,r=Yn.empty();let s=new $t(tn.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new di(n.key,r,new Tr(s.toArray()),nn.none())}}function eD(n,e,t){n instanceof jl?function(s,i,o){const a=s.value.clone(),l=K0(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof di?function(s,i,o){if(!Jd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=K0(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(VI(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Hu(n,e,t,r){return n instanceof jl?function(i,o,a,l){if(!Jd(i.precondition,o))return a;const c=i.value.clone(),h=G0(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof di?function(i,o,a,l){if(!Jd(i.precondition,o))return a;const c=G0(i.fieldTransforms,l,o),h=o.data;return h.setAll(VI(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Jd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function tD(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=CI(r.transform,s||null);i!=null&&(t===null&&(t=Yn.empty()),t.set(r.field,i))}return t||null}function H0(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&vl(r,s,(i,o)=>X2(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class jl extends af{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class di extends af{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function VI(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function K0(n,e,t){const r=new Map;$e(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Y2(o,a,t[s]))}return r}function G0(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,J2(i,o,e))}return r}class Bl extends af{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ag extends af{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&eD(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Hu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Hu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=SI();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=OI(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(qe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ot())}isEqual(e){return this.batchId===e.batchId&&vl(this.mutations,e.mutations,(t,r)=>H0(t,r))&&vl(this.baseMutations,e.baseMutations,(t,r)=>H0(t,r))}}class Pg{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){$e(e.mutations.length===r.length);let s=function(){return G2}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Pg(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MI{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sn,Et;function LI(n){switch(n){default:return Ne();case W.CANCELLED:case W.UNKNOWN:case W.DEADLINE_EXCEEDED:case W.RESOURCE_EXHAUSTED:case W.INTERNAL:case W.UNAVAILABLE:case W.UNAUTHENTICATED:return!1;case W.INVALID_ARGUMENT:case W.NOT_FOUND:case W.ALREADY_EXISTS:case W.PERMISSION_DENIED:case W.FAILED_PRECONDITION:case W.ABORTED:case W.OUT_OF_RANGE:case W.UNIMPLEMENTED:case W.DATA_LOSS:return!0}}function $I(n){if(n===void 0)return xn("GRPC error has no .code"),W.UNKNOWN;switch(n){case Sn.OK:return W.OK;case Sn.CANCELLED:return W.CANCELLED;case Sn.UNKNOWN:return W.UNKNOWN;case Sn.DEADLINE_EXCEEDED:return W.DEADLINE_EXCEEDED;case Sn.RESOURCE_EXHAUSTED:return W.RESOURCE_EXHAUSTED;case Sn.INTERNAL:return W.INTERNAL;case Sn.UNAVAILABLE:return W.UNAVAILABLE;case Sn.UNAUTHENTICATED:return W.UNAUTHENTICATED;case Sn.INVALID_ARGUMENT:return W.INVALID_ARGUMENT;case Sn.NOT_FOUND:return W.NOT_FOUND;case Sn.ALREADY_EXISTS:return W.ALREADY_EXISTS;case Sn.PERMISSION_DENIED:return W.PERMISSION_DENIED;case Sn.FAILED_PRECONDITION:return W.FAILED_PRECONDITION;case Sn.ABORTED:return W.ABORTED;case Sn.OUT_OF_RANGE:return W.OUT_OF_RANGE;case Sn.UNIMPLEMENTED:return W.UNIMPLEMENTED;case Sn.DATA_LOSS:return W.DATA_LOSS;default:return Ne()}}(Et=Sn||(Sn={}))[Et.OK=0]="OK",Et[Et.CANCELLED=1]="CANCELLED",Et[Et.UNKNOWN=2]="UNKNOWN",Et[Et.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Et[Et.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Et[Et.NOT_FOUND=5]="NOT_FOUND",Et[Et.ALREADY_EXISTS=6]="ALREADY_EXISTS",Et[Et.PERMISSION_DENIED=7]="PERMISSION_DENIED",Et[Et.UNAUTHENTICATED=16]="UNAUTHENTICATED",Et[Et.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Et[Et.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Et[Et.ABORTED=10]="ABORTED",Et[Et.OUT_OF_RANGE=11]="OUT_OF_RANGE",Et[Et.UNIMPLEMENTED=12]="UNIMPLEMENTED",Et[Et.INTERNAL=13]="INTERNAL",Et[Et.UNAVAILABLE=14]="UNAVAILABLE",Et[Et.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD=new Yo([4294967295,4294967295],0);function W0(n){const e=FI().encode(n),t=new Ux;return t.update(e),new Uint8Array(t.digest())}function Q0(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Yo([t,r],0),new Yo([s,i],0)]}class Cg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Du(`Invalid padding: ${t}`);if(r<0)throw new Du(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Du(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Du(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Yo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Yo.fromNumber(r)));return s.compare(rD)===1&&(s=new Yo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=W0(e),[r,s]=Q0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Cg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=W0(e),[r,s]=Q0(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Du extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Bc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new jc(qe.min(),s,new Ht(et),Ar(),ot())}}class Bc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Bc(r,t,ot(),ot(),ot())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class UI{constructor(e,t){this.targetId=e,this.me=t}}class jI{constructor(e,t,r=fn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class J0{constructor(){this.fe=0,this.ge=X0(),this.pe=fn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ot(),t=ot(),r=ot();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ne()}}),new Bc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=X0()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,$e(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class sD{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ar(),this.qe=Y0(),this.Qe=new Ht(et)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ne()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(vh(i))if(r===0){const o=new Se(i.path);this.Ue(t,o,Wt.newNoDocument(o,qe.min()))}else $e(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}bh==null||bh.et(function(h,f,m,v,w){var x,A,L,F,$,B;const ne={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},re=f.unchangedNames;return re&&(ne.bloomFilter={applied:w===0,hashCount:(x=re==null?void 0:re.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(F=(L=(A=re==null?void 0:re.bits)===null||A===void 0?void 0:A.bitmap)===null||L===void 0?void 0:L.length)!==null&&F!==void 0?F:0,padding:(B=($=re==null?void 0:re.bits)===null||$===void 0?void 0:$.padding)!==null&&B!==void 0?B:0,mightContain:T=>{var _;return(_=v==null?void 0:v.mightContain(T))!==null&&_!==void 0&&_}}),ne}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ni(r).toUint8Array()}catch(l){if(l instanceof lI)return Qr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Cg(o,s,i)}catch(l){return Qr(l instanceof Du?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&vh(a.target)){const l=new Se(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Wt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=ot();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new jc(e,t,this.Qe,this.ke,r);return this.ke=Ar(),this.qe=Y0(),this.Qe=new Ht(et),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new J0,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new $t(et),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||de("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new J0),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Y0(){return new Ht(Se.comparator)}function X0(){return new Ht(Se.comparator)}const iD=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),oD=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),aD=(()=>({and:"AND",or:"OR"}))();class lD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function dm(n,e){return n.useProto3Json||Mc(e)?e:{value:e}}function El(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function BI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function uD(n,e){return El(n,e.toTimestamp())}function Tn(n){return $e(!!n),qe.fromTimestamp(function(t){const r=ti(t);return new an(r.seconds,r.nanos)}(n))}function kg(n,e){return hm(n,e).canonicalString()}function hm(n,e){const t=function(s){return new bt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function qI(n){const e=bt.fromString(n);return $e(ZI(e)),e}function yc(n,e){return kg(n.databaseId,e.path)}function As(n,e){const t=qI(e);if(t.get(1)!==n.databaseId.projectId)throw new he(W.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new he(W.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Se(KI(t))}function zI(n,e){return kg(n.databaseId,e)}function HI(n){const e=qI(n);return e.length===4?bt.emptyPath():KI(e)}function fm(n){return new bt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function KI(n){return $e(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Z0(n,e,t){return{name:yc(n,e),fields:t.value.mapValue.fields}}function GI(n,e,t){const r=As(n,e.name),s=Tn(e.updateTime),i=e.createTime?Tn(e.createTime):qe.min(),o=new Yn({mapValue:{fields:e.fields}}),a=Wt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function cD(n,e){return"found"in e?function(r,s){$e(!!s.found),s.found.name,s.found.updateTime;const i=As(r,s.found.name),o=Tn(s.found.updateTime),a=s.found.createTime?Tn(s.found.createTime):qe.min(),l=new Yn({mapValue:{fields:s.found.fields}});return Wt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){$e(!!s.missing),$e(!!s.readTime);const i=As(r,s.missing),o=Tn(s.readTime);return Wt.newNoDocument(i,o)}(n,e):Ne()}function dD(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ne()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?($e(h===void 0||typeof h=="string"),fn.fromBase64String(h||"")):($e(h===void 0||h instanceof Buffer||h instanceof Uint8Array),fn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?W.UNKNOWN:$I(c.code);return new he(h,c.message||"")}(o);t=new jI(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=As(n,r.document.name),i=Tn(r.document.updateTime),o=r.document.createTime?Tn(r.document.createTime):qe.min(),a=new Yn({mapValue:{fields:r.document.fields}}),l=Wt.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new Yd(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=As(n,r.document),i=r.readTime?Tn(r.readTime):qe.min(),o=Wt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Yd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=As(n,r.document),i=r.removedTargetIds||[];t=new Yd([],i,s,null)}else{if(!("filter"in e))return Ne();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new nD(s,i),a=r.targetId;t=new UI(a,o)}}return t}function _c(n,e){let t;if(e instanceof jl)t={update:Z0(n,e.key,e.value)};else if(e instanceof Bl)t={delete:yc(n,e.key)};else if(e instanceof di)t={update:Z0(n,e.key,e.data),updateMask:vD(e.fieldMask)};else{if(!(e instanceof Ag))return Ne();t={verify:yc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof xl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof aa)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof la)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Il)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ne()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:uD(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ne()}(n,e.precondition)),t}function pm(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?nn.updateTime(Tn(i.updateTime)):i.exists!==void 0?nn.exists(i.exists):nn.none()}(e.currentDocument):nn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)$e(a.setToServerValue==="REQUEST_TIME"),l=new xl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new aa(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new la(h)}else"increment"in a?l=new Il(o,a.increment):Ne();const c=tn.fromServerFormat(a.fieldPath);return new Uc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=As(n,e.update.name),i=new Yn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Tr(c.map(h=>tn.fromServerFormat(h)))}(e.updateMask);return new di(s,i,o,t,r)}return new jl(s,i,t,r)}if(e.delete){const s=As(n,e.delete);return new Bl(s,t)}if(e.verify){const s=As(n,e.verify);return new Ag(s,t)}return Ne()}function hD(n,e){return n&&n.length>0?($e(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?Tn(s.updateTime):Tn(i);return o.isEqual(qe.min())&&(o=Tn(i)),new Z2(o,s.transformResults||[])}(t,e))):[]}function WI(n,e){return{documents:[zI(n,e.path)]}}function lf(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=zI(n,s);const i=function(c){if(c.length!==0)return XI(Lt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(m){return{field:Fi(m.field),direction:pD(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=dm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function QI(n,e,t,r){const{_t:s,parent:i}=lf(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:Fi(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:Fi(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function JI(n){let e=HI(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){$e(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const m=YI(f);return m instanceof Lt&&xg(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(w){return new vc(Xa(w.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Mc(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){const m=!!f.before,v=f.values||[];return new ao(v,m)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const m=!f.before,v=f.values||[];return new ao(v,m)}(t.endAt)),_I(e,s,o,i,a,"F",l,c)}function fD(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ne()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function YI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Xa(t.unaryFilter.field);return wt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Xa(t.unaryFilter.field);return wt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Xa(t.unaryFilter.field);return wt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Xa(t.unaryFilter.field);return wt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ne()}}(n):n.fieldFilter!==void 0?function(t){return wt.create(Xa(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ne()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Lt.create(t.compositeFilter.filters.map(r=>YI(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ne()}}(t.compositeFilter.op))}(n):Ne()}function pD(n){return iD[n]}function mD(n){return oD[n]}function gD(n){return aD[n]}function Fi(n){return{fieldPath:n.canonicalString()}}function Xa(n){return tn.fromServerFormat(n.fieldPath)}function XI(n){return n instanceof wt?function(t){if(t.op==="=="){if(M0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NAN"}};if(V0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(M0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NAN"}};if(V0(t.value))return{unaryFilter:{field:Fi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fi(t.field),op:mD(t.op),value:t.value}}}(n):n instanceof Lt?function(t){const r=t.getFilters().map(s=>XI(s));return r.length===1?r[0]:{compositeFilter:{op:gD(t.op),filters:r}}}(n):Ne()}function vD(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ZI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(e,t,r,s,i=qe.min(),o=qe.min(),a=fn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Bs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e){this.ct=e}}function yD(n,e){let t;if(e.document)t=GI(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Se.fromSegments(e.noDocument.path),s=ca(e.noDocument.readTime);t=Wt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ne();{const r=Se.fromSegments(e.unknownDocument.path),s=ca(e.unknownDocument.version);t=Wt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new an(s[0],s[1]);return qe.fromTimestamp(i)}(e.readTime)),t}function e_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:wh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:yc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:El(i,o.version.toTimestamp()),createTime:El(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ua(e.version)};else{if(!e.isUnknownDocument())return Ne();r.unknownDocument={path:t.path.toArray(),version:ua(e.version)}}return r}function wh(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ua(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ca(n){const e=new an(n.seconds,n.nanoseconds);return qe.fromTimestamp(e)}function zo(n,e){const t=(e.baseMutations||[]).map(i=>pm(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>pm(n.ct,i)),s=an.fromMillis(e.localWriteTimeMs);return new Sg(e.batchId,s,t,r)}function Nu(n){const e=ca(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ca(n.lastLimboFreeSnapshotVersion):qe.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return $e(i.documents.length===1),ur(Ul(HI(i.documents[0])))}(n.query):function(i){return ur(JI(i))}(n.query),new Bs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,fn.fromBase64String(n.resumeToken))}function tE(n,e){const t=ua(e.snapshotVersion),r=ua(e.lastLimboFreeSnapshotVersion);let s;s=vh(e.target)?WI(n.ct,e.target):lf(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:oa(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Dg(n){const e=JI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_h(e,e.limit,"L"):e}function xp(n,e){return new Rg(e.largestBatchId,pm(n.ct,e.overlayMutation))}function t_(n,e){const t=e.path.lastSegment();return[n,lr(e.path.popLast()),t]}function n_(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ua(r.readTime),documentKey:lr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _D{getBundleMetadata(e,t){return r_(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ca(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return r_(e).put(function(s){return{bundleId:s.id,createTime:ua(Tn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return s_(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Dg(i.bundledQuery),readTime:ca(i.readTime)}}(r)})}saveNamedQuery(e,t){return s_(e).put(function(s){return{name:s.name,readTime:ua(Tn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function r_(n){return Vn(n,"bundles")}function s_(n){return Vn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new uf(e,r)}getOverlay(e,t){return yu(e).get(t_(this.userId,t)).next(r=>r?xp(this.serializer,r):null)}getOverlays(e,t){const r=xs();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Rg(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(lr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(yu(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=xs(),i=lr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return yu(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=xp(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=xs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return yu(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=xp(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return yu(e).put(function(s,i,o){const[a,l,c]=t_(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_c(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function yu(n){return Vn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bD{Pt(e){return Vn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?fn.fromUint8Array(r):fn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(en(e.integerValue));else if("doubleValue"in e){const r=en(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),fc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ti(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ni(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?uI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):sf(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ne()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(en(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Se.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Ho.vt=new Ho;function wD(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function i_(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=wD(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class xD{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=i_(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=i_(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class ID{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class ED{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class _u{constructor(){this.jt=new xD,this.Ht=new ID(this.jt),this.Jt=new ED(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ko(this.indexId,this.documentKey,this.arrayValue,r)}}function Ci(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=o_(n.arrayValue,e.arrayValue),t!==0?t:(t=o_(n.directionalValue,e.directionalValue),t!==0?t:Se.comparator(n.documentKey,e.documentKey)))}function o_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(e){this.Xt=new $t((t,r)=>tn.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if($e(e.collectionGroup===this.collectionId),this.nn)return!1;const t=rm(e);if(t!==void 0&&!this.sn(t))return!1;const r=Fo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new $t(tn.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Xo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Xo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Xo(r.field,r.dir==="asc"?0:1)));return new yl(yl.UNKNOWN_ID,this.collectionId,t,_l.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nE(n){var e,t;if($e(n instanceof wt||n instanceof Lt),n instanceof wt){if(n instanceof yI){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>wt.create(n.field,"==",i)))||[];return Lt.create(s,"or")}return n}const r=n.filters.map(s=>nE(s));return Lt.create(r,n.op)}function TD(n){if(n.getFilters().length===0)return[];const e=vm(nE(n));return $e(rE(e)),mm(e)||gm(e)?[e]:e.getFilters()}function mm(n){return n instanceof wt}function gm(n){return n instanceof Lt&&xg(n)}function rE(n){return mm(n)||gm(n)||function(t){if(t instanceof Lt&&am(t)){for(const r of t.getFilters())if(!mm(r)&&!gm(r))return!1;return!0}return!1}(n)}function vm(n){if($e(n instanceof wt||n instanceof Lt),n instanceof wt)return n;if(n.filters.length===1)return vm(n.filters[0]);const e=n.filters.map(r=>vm(r));let t=Lt.create(e,n.op);return t=xh(t),rE(t)?t:($e(t instanceof Lt),$e(wl(t)),$e(t.filters.length>1),t.filters.reduce((r,s)=>Ng(r,s)))}function Ng(n,e){let t;return $e(n instanceof wt||n instanceof Lt),$e(e instanceof wt||e instanceof Lt),t=n instanceof wt?e instanceof wt?function(s,i){return Lt.create([s,i],"and")}(n,e):l_(n,e):e instanceof wt?l_(e,n):function(s,i){if($e(s.filters.length>0&&i.filters.length>0),wl(s)&&wl(i))return mI(s,i.getFilters());const o=am(s)?s:i,a=am(s)?i:s,l=o.filters.map(c=>Ng(c,a));return Lt.create(l,"or")}(n,e),xh(t)}function l_(n,e){if(wl(e))return mI(e,n.getFilters());{const t=e.filters.map(r=>Ng(n,r));return Lt.create(t,"or")}}function xh(n){if($e(n instanceof wt||n instanceof Lt),n instanceof wt)return n;const e=n.getFilters();if(e.length===1)return xh(e[0]);if(fI(n))return n;const t=e.map(s=>xh(s)),r=[];return t.forEach(s=>{s instanceof wt?r.push(s):s instanceof Lt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Lt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AD{constructor(){this.un=new Og}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(Fr.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(Fr.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class Og{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new $t(bt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new $t(bt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd=new Uint8Array(0);class SD{constructor(e,t){this.databaseId=t,this.cn=new Og,this.ln=new ci(r=>oa(r),(r,s)=>Lc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:lr(s)};return u_(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[Qx(t),""],!1,!0);return u_(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ws(o.parent))}return r})}addFieldIndex(e,t){const r=bu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ga(e);return i.next(a=>{o.put(n_(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=bu(e),s=Ga(e),i=Ka(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=bu(e),r=Ka(e),s=Ga(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new a_(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ka(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=ot();const a=[];return z.forEach(i,(l,c)=>{de("IndexedDbIndexManager",`Using index ${function($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map(B=>`${B.fieldPath}:${B.kind}`).join(",")}`}(l)} to execute ${oa(t)}`);const h=function($,B){const ne=rm(B);if(ne===void 0)return null;for(const re of yh($,ne.fieldPath))switch(re.op){case"array-contains-any":return re.value.arrayValue.values||[];case"array-contains":return[re.value]}return null}(c,l),f=function($,B){const ne=new Map;for(const re of Fo(B))for(const T of yh($,re.fieldPath))switch(T.op){case"==":case"in":ne.set(re.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return ne.set(re.fieldPath.canonicalString(),T.value),Array.from(ne.values())}return null}(c,l),m=function($,B){const ne=[];let re=!0;for(const T of Fo(B)){const _=T.kind===0?j0($,T.fieldPath,$.startAt):B0($,T.fieldPath,$.startAt);ne.push(_.value),re&&(re=_.inclusive)}return new ao(ne,re)}(c,l),v=function($,B){const ne=[];let re=!0;for(const T of Fo(B)){const _=T.kind===0?B0($,T.fieldPath,$.endAt):j0($,T.fieldPath,$.endAt);ne.push(_.value),re&&(re=_.inclusive)}return new ao(ne,re)}(c,l),w=this.In(l,c,m),x=this.In(l,c,v),A=this.Tn(l,c,f),L=this.En(l.indexId,h,w,m.inclusive,x,v.inclusive,A);return z.forEach(L,F=>r.G(F,t.limit).next($=>{$.forEach(B=>{const ne=Se.fromSegments(B.documentKey);o.has(ne)||(o=o.add(ne),a.push(ne))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=TD(Lt.create(e.filters,"and")).map(r=>um(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const m=t?this.dn(t[f/c]):Pd,v=this.An(e,m,r[f%c],s),w=this.Rn(e,m,i[f%c],o),x=a.map(A=>this.An(e,m,A,!0));h.push(...this.createRange(v,w,x))}return h}An(e,t,r,s){const i=new Ko(e,Se.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Ko(e,Se.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new a_(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new $t(tn.comparator),h=!1;for(const f of l.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:c=c.add(m.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new _u;for(const s of Fo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Ho.vt.It(i,o)}return r.zt()}dn(e){const t=new _u;return Ho.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new _u;return Ho.vt.It(ia(this.databaseId,t),r.Yt(function(i){const o=Fo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new _u);let i=0;for(const o of Fo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&gc(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Ho.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new _u;l.seed(a.zt()),Ho.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof wt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=bu(e),s=Ga(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const m=f?new _l(f.sequenceNumber,new Fr(ca(f.readTime),new Se(ws(f.documentKey)),f.largestBatchId)):_l.empty(),v=h.fields.map(([w,x])=>new Xo(tn.fromServerFormat(w),x));return new yl(h.indexId,h.collectionGroup,v,m)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:et(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=bu(e),i=Ga(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(n_(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?z.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return Ka(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ka(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ka(e);let i=new $t(Ci);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Ko(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new $t(Ci);const s=this.Vn(t,e);if(s==null)return r;const i=rm(t);if(i!=null){const o=e.data.field(i.fieldPath);if(gc(o))for(const a of o.arrayValue.values||[])r=r.add(new Ko(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Ko(t.indexId,e.key,Pd,s));return r}bn(e,t,r,s,i){de("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,m){const v=l.getIterator(),w=c.getIterator();let x=Ha(v),A=Ha(w);for(;x||A;){let L=!1,F=!1;if(x&&A){const $=h(x,A);$<0?F=!0:$>0&&(L=!0)}else x!=null?F=!0:L=!0;L?(f(A),A=Ha(w)):F?(m(x),x=Ha(v)):(x=Ha(v),A=Ha(w))}}(s,i,Ci,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return Ga(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ci(o,a)).filter((o,a,l)=>!a||Ci(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ci(o,e),l=Ci(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Pd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Pd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Ci(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(c_)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ne())).next(c_)}}function u_(n){return Vn(n,"collectionParents")}function Ka(n){return Vn(n,"indexEntries")}function bu(n){return Vn(n,"indexConfiguration")}function Ga(n){return Vn(n,"indexState")}function c_(n){$e(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;_g(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Fr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sr{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new sr(e,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sE(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,m)=>(a++,m.delete()));i.push(l.next(()=>{$e(a===1)}));const c=[];for(const h of t.mutations){const f=nI(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return z.waitFor(i).next(()=>c)}function Ih(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ne();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sr.DEFAULT_COLLECTION_PERCENTILE=10,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sr.DEFAULT=new sr(41943040,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sr.DISABLED=new sr(-1,0,0);class cf{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){$e(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new cf(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Za(e),o=ki(e);return o.add({}).next(a=>{$e(typeof a=="number");const l=new Sg(a,t,r,s),c=function(v,w,x){const A=x.baseMutations.map(F=>_c(v.ct,F)),L=x.mutations.map(F=>_c(v.ct,F));return{userId:w,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:A,mutations:L}}(this.serializer,this.userId,l),h=[];let f=new $t((m,v)=>et(m.canonicalString(),v.canonicalString()));for(const m of s){const v=nI(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(c)),h.push(i.put(v,m2))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return ki(e).get(t).next(r=>r?($e(r.userId===this.userId),zo(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ki(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&($e(a.batchId>=r),i=zo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ki(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ki(e).U("userMutationsIndex",t).next(r=>r.map(s=>zo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Kd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Za(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,m=ws(h);if(c===this.userId&&t.path.isEqual(m))return ki(e).get(f).next(v=>{if(!v)throw Ne();$e(v.userId===this.userId),i.push(zo(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new $t(et);const s=[];return t.forEach(i=>{const o=Kd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Za(e).J({range:a},(c,h,f)=>{const[m,v,w]=c,x=ws(v);m===this.userId&&i.path.isEqual(x)?r=r.add(w):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Kd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new $t(et);return Za(e).J({range:o},(l,c,h)=>{const[f,m,v]=l,w=ws(m);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(v)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ki(e).get(i).next(o=>{if(o===null)throw Ne();$e(o.userId===this.userId),r.push(zo(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return sE(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Za(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=ws(i[1]);s.push(l)}else a.done()}).next(()=>{$e(s.length===0)})})}containsKey(e,t){return iE(e,this.userId,t)}Nn(e){return oE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function iE(n,e,t){const r=Kd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Za(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function ki(n){return Vn(n,"mutations")}function Za(n){return Vn(n,"documentMutations")}function oE(n){return Vn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new da(0)}static kn(){return new da(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PD{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new da(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>qe.fromTimestamp(new an(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Wa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>($e(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Wa(e).J((o,a)=>{const l=Nu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Wa(e).J((r,s)=>{const i=Nu(s);t(i)})}qn(e){return h_(e).get("targetGlobalKey").next(t=>($e(t!==null),t))}Qn(e,t){return h_(e).put("targetGlobalKey",t)}Kn(e,t){return Wa(e).put(tE(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=oa(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Wa(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Nu(a);Lc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ui(e);return t.forEach(o=>{const a=lr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ui(e);return z.forEach(t,i=>{const o=lr(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ui(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ui(e);let i=ot();return s.J({range:r,H:!0},(o,a,l)=>{const c=ws(o[1]),h=new Se(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=lr(t.path),s=IDBKeyRange.bound([r],[Qx(r)],!1,!0);let i=0;return Ui(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Wa(e).get(t).next(r=>r?Nu(r):null)}}function Wa(n){return Vn(n,"targets")}function h_(n){return Vn(n,"targetGlobal")}function Ui(n){return Vn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f_([n,e],[t,r]){const s=et(n,t);return s===0?et(e,r):s}class RD{constructor(e){this.Un=e,this.buffer=new $t(f_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();f_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class aE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){de("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){mo(t)?de("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await po(t)}await this.Hn(3e5)})}}class CD{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(Er.oe);const r=new RD(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(de("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve(d_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(de("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),d_):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(de("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Ja()<=yt.DEBUG&&de("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function lE(n,e){return new CD(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e,t){this.db=e,this.garbageCollector=lE(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Rd(e,r)}removeReference(e,t,r){return Rd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Rd(e,t)}nr(e,t){return function(s,i){let o=!1;return oE(s).Y(a=>iE(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,qe.min()),Ui(e).delete(function(f){return[0,lr(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Rd(e,t)}tr(e,t){const r=Ui(e);let s,i=Er.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Er.oe&&t(new Se(ws(s)),i),i=c,s=l):i=Er.oe}).next(()=>{i!==Er.oe&&t(new Se(ws(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Rd(n,e){return Ui(n).put(function(r,s){return{targetId:0,path:lr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE{constructor(){this.changes=new ci(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Wt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Mo(e).put(r)}removeEntry(e,t,r){return Mo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],wh(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Wt.newInvalidDocument(t);return Mo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(wu(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Wt.newInvalidDocument(t)};return Mo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(wu(t))},(s,i)=>{r={document:this.ir(t,i),size:Ih(i)}}).next(()=>r)}getEntries(e,t){let r=Ar();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Ar(),s=new Ht(Se.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Ih(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new $t(g_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(wu(s.first()),wu(s.last())),o=s.getIterator();let a=o.getNext();return Mo(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=Se.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&g_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(wu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),wh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Mo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=Ar();for(const f of c){const m=this.ir(Se.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(Fc(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Ar();const o=m_(t,r),a=m_(t,Fr.max());return Mo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(Se.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new ND(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return p_(e).get("remoteDocumentGlobalKey").next(t=>($e(!!t),t))}rr(e,t){return p_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=yD(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(qe.min())))return r}return Wt.newInvalidDocument(e)}}function cE(n){return new DD(n)}class ND extends uE{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new ci(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new $t((i,o)=>et(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=e_(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Ih(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=e_(this.cr.serializer,o.convertToNoDocument(qe.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function p_(n){return Vn(n,"remoteDocumentGlobal")}function Mo(n){return Vn(n,"remoteDocumentsV14")}function wu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function m_(n,e){const t=e.documentKey.path.toArray();return[n,wh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function g_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=et(t[i],r[i]),s)return s;return s=et(t.length,r.length),s||(s=et(t[t.length-2],r[r.length-2]),s||et(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Hu(r.mutation,s,Tr.empty(),an.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ot()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ot()){const s=xs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=ku();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=xs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ot()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Ar();const o=zu(),a=function(){return zu()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof di)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),Hu(h.mutation,c,h.mutation.getFieldMask(),an.now())):o.set(c.key,Tr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new OD(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=zu();let s=new Ht((o,a)=>o-a),i=ot();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||Tr.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||ot()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=SI();h.forEach(m=>{if(!i.has(m)){const v=OI(t.get(m),r.get(m));v!==null&&f.set(m,v),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ig(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(xs());let a=-1,l=i;return o.next(c=>z.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?z.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{l=l.insert(h,m)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,ot())).next(h=>({batchId:a,changes:AI(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Se(t)).next(r=>{let s=ku();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=ku();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,m){return new ui(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,Wt.newInvalidDocument(h)))});let a=ku();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&Hu(h.mutation,c,Tr.empty(),an.now()),Fc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VD{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Tn(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Dg(s.bundledQuery),readTime:Tn(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{constructor(){this.overlays=new Ht(Se.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=xs();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=xs(),i=t.length+1,o=new Se(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ht((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=xs(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=xs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Rg(t,r));let i=this.Ir.get(t);i===void 0&&(i=ot(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(){this.sessionToken=fn.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(){this.Tr=new $t(Un.Er),this.dr=new $t(Un.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Un(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Un(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Se(new bt([])),r=new Un(t,e),s=new Un(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Se(new bt([])),r=new Un(t,e),s=new Un(t,e+1);let i=ot();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Un(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Un{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Se.comparator(e.key,t.key)||et(e.wr,t.wr)}static Ar(e,t){return et(e.wr,t.wr)||Se.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new $t(Un.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Sg(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Un(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Un(t,0),s=new Un(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new $t(et);return t.forEach(s=>{const i=new Un(s,0),o=new Un(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Se.isDocumentKey(i)||(i=i.child(""));const o=new Un(new Se(i),0);let a=new $t(et);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){$e(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new Un(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Un(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e){this.Mr=e,this.docs=function(){return new Ht(Se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():Wt.newInvalidDocument(t))}getEntries(e,t){let r=Ar();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Wt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Ar();const o=t.path,a=new Se(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||_g(Yx(h),r)<=0||(s.has(h.key)||Fc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ne()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new UD(this)}getSize(e){return z.resolve(this.size)}}class UD extends uE{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(e){this.persistence=e,this.Nr=new ci(t=>oa(t),Lc),this.lastRemoteSnapshotVersion=qe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Vg,this.targetCount=0,this.kr=da.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new da(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Er(0),this.Kr=!1,this.Kr=!0,this.$r=new LD,this.referenceDelegate=e(this),this.Ur=new jD(this),this.indexManager=new AD,this.remoteDocumentCache=function(s){return new FD(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new eE(t),this.Gr=new VD(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new MD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new $D(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){de("MemoryPersistence","Starting transaction:",e);const s=new BD(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class BD extends Zx{constructor(e){super(),this.currentSequenceNumber=e}}class df{constructor(e){this.persistence=e,this.Jr=new Vg,this.Yr=null}static Zr(e){return new df(e)}get Xr(){if(this.Yr)return this.Yr;throw Ne()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=Se.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,qe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Eh{constructor(e,t){this.persistence=e,this.ti=new ci(r=>lr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=lE(this,t)}static Zr(e,t){return new Eh(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,qe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Wd(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e){this.serializer=e}O(e,t,r,s){const i=new tf("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",C0,{unique:!0}),l.createObjectStore("documentMutations")}(e),v_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),v_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:qe.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",C0,{unique:!0});const f=c.store("mutations"),m=h.map(v=>f.put(v));return z.waitFor(m)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:S2});c.createIndex("collectionPathOverlayIndex",P2,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",R2,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:g2});c.createIndex("documentKeyIndex",v2),c.createIndex("collectionGroupIndex",y2)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:I2}).createIndex("sequenceNumberIndex",E2,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:T2}).createIndex("documentKeyIndex",A2,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Ih(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{$e(l.userId===i.userId);const c=zo(this.serializer,l);return sE(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new bt(o),c=function(f){return[0,lr(f)]}(l);i.push(t.get(c).next(h=>h?z.resolve():(f=>t.put({targetId:0,path:lr(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:x2});const r=t.store("collectionParents"),s=new Og,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:lr(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new bt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=ws(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Nu(s),o=tE(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Se(bt.fromString(f.document.name).popFirst(5)):f.noDocument?Se.fromSegments(f.noDocument.path):f.unknownDocument?Se.fromSegments(f.unknownDocument.path):Ne()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=cE(this.serializer),i=new Mg(df.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:ot();zo(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),z.forEach(a,(l,c)=>{const h=new jn(c),f=uf.lt(this.serializer,h),m=i.getIndexManager(h),v=cf.lt(h,this.serializer,m,i.referenceDelegate);return new dE(s,v,f,m).recalculateAndSaveOverlaysForDocumentKeys(new sm(t,Er.oe),l).next()})})}}function v_(n){n.createObjectStore("targetDocuments",{keyPath:b2}).createIndex("documentTargetsIndex",w2,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",_2,{unique:!0}),n.createObjectStore("targetGlobal")}const Ip="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Lg{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!Lg.D())throw new he(W.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new kD(this,s),this.Ai=t+"main",this.serializer=new eE(l),this.Ri=new Ts(this.Ai,this.hi,new qD(this.serializer)),this.$r=new bD,this.Ur=new PD(this.referenceDelegate,this.serializer),this.remoteDocumentCache=cE(this.serializer),this.Gr=new _D,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&xn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new he(W.FAILED_PRECONDITION,Ip);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Er(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Cd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(mo(e))return de("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return de("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return xu(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return Cd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Vn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):xu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new he(W.FAILED_PRECONDITION,Ip);return!1}}return!(!this.networkEnabled||!this.inForeground)||Cd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&de("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new sm(e,Er.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Cd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return cf.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new SD(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return uf.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){de("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?D2:l===16?k2:l===15?wg:l===14?iI:l===13?sI:l===12?C2:l===11?rI:void Ne()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new sm(a,this.Qr?this.Qr.next():Er.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw xn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new he(W.FAILED_PRECONDITION,Xx);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return xu(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new he(W.FAILED_PRECONDITION,Ip)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return xu(e).put("owner",t)}static D(){return Ts.D()}bi(e){const t=xu(e);return t.get("owner").next(r=>this.vi(r)?(de("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(xn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;ax()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return de("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return xn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){xn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function xu(n){return Vn(n,"owner")}function Cd(n){return Vn(n,"clientMetadata")}function $g(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=ot(),s=ot();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Fg(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return ax()?8:eI(On())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new zD;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Ja()<=yt.DEBUG&&de("QueryEngine","SDK will not create cache indexes for query:",Ya(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(Ja()<=yt.DEBUG&&de("QueryEngine","Query:",Ya(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Ja()<=yt.DEBUG&&de("QueryEngine","The SDK decides to create cache indexes for query:",Ya(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ur(t))):z.resolve())}Yi(e,t){if(q0(t))return z.resolve(null);let r=ur(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=_h(t,null,"F"),r=ur(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ot(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,_h(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return q0(t)||s.isEqual(qe.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(Ja()<=yt.DEBUG&&de("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ya(t)),this.rs(e,o,t,Jx(s,-1)).next(a=>a))})}ts(e,t){let r=new $t(EI(e));return t.forEach((s,i)=>{Fc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Ja()<=yt.DEBUG&&de("QueryEngine","Using full collection scan to execute query:",Ya(t)),this.Ji.getDocumentsMatchingQuery(e,t,Fr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ht(et),this._s=new ci(i=>oa(i),Lc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dE(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function fE(n,e,t,r){return new HD(n,e,t,r)}async function pE(n,e){const t=Te(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ot();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function KD(n,e){const t=Te(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,m=f.keys();let v=z.resolve();return m.forEach(w=>{v=v.next(()=>h.getEntry(l,w)).next(x=>{const A=c.docVersions.get(w);$e(A!==null),x.version.compareTo(A)<0&&(f.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),h.addEntry(x)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ot();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function mE(n){const e=Te(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function GD(n,e){const t=Te(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let v=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(fn.EMPTY_BYTE_STRING,qe.min()).withLastLimboFreeSnapshotVersion(qe.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,r)),s=s.insert(f,v),function(x,A,L){return x.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0}(m,v,h)&&a.push(t.Ur.updateTargetData(i,v))});let l=Ar(),c=ot();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(gE(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual(qe.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function gE(n,e,t){let r=ot(),s=ot();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Ar();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(qe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):de("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function WD(n,e){const t=Te(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Tl(n,e){const t=Te(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Bs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Al(n,e,t){const r=Te(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!mo(o))throw o;de("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Th(n,e,t){const r=Te(n);let s=qe.min(),i=ot();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Te(l),m=f._s.get(h);return m!==void 0?z.resolve(f.os.get(m)):f.Ur.getTargetData(c,h)}(r,o,ur(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:qe.min(),t?i:ot())).next(a=>(_E(r,II(e),a),{documents:a,Ts:i})))}function vE(n,e){const t=Te(n),r=Te(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function yE(n,e){const t=Te(n),r=t.us.get(e)||qe.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,Jx(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(_E(t,e,s),s))}function _E(n,e,t){let r=n.us.get(e)||qe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function QD(n,e,t,r){const s=Te(n);let i=ot(),o=Ar();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Tl(s,function(h){return ur(Ul(bt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>gE(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function JD(n,e,t=ot()){const r=await Tl(n,ur(Dg(e.bundledQuery))),s=Te(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Tn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(fn.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function y_(n,e){return`firestore_clients_${n}_${e}`}function __(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Ep(n,e){return`firestore_targets_${n}_${e}`}class Ah{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new he(s.error.code,s.error.message))),o?new Ah(e,t,s.state,i):(xn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ku{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new he(r.error.code,r.error.message))),i?new Ku(e,r.state,s):(xn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Sh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Eg();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=tI(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Sh(e,i):(xn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ug{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Ug(t.clientId,t.onlineState):(xn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ym{constructor(){this.activeTargetIds=Eg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Tp{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ht(et),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=y_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new ym),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(y_(this.persistenceKey,r));if(s){const i=Sh.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Ep(this.persistenceKey,e));if(s){const i=Ku.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ep(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return de("SharedClientState","READ",e,t),t}setItem(e,t){de("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){de("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(de("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void xn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Er.oe;if(i!=null)try{const a=JSON.parse(i);$e(typeof a=="number"),o=a}catch(a){xn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Er.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Ah(this.currentUser,e,t,r),i=__(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=__(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Ep(this.persistenceKey,e),i=new Ku(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Sh.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Ah.Rs(new jn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Ku.Rs(s,t)}Ls(e){return Ug.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);de("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Eg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class bE{constructor(){this.so=new ym,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ym,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){de("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){de("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kd=null;function Ap(){return kd===null?kd=function(){return 268435456+Math.round(2147483648*Math.random())}():kd++,"0x"+kd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr="WebChannelConnection";class eN extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Ap(),l=this.xo(t,r.toUriEncodedString());de("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(de("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw Qr("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Fl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=XD[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Ap();return new Promise((o,a)=>{const l=new jx;l.setWithCredentials(!0),l.listenOnce(Bx.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Hd.NO_ERROR:const h=l.getResponseJson();de(nr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case Hd.TIMEOUT:de(nr,`RPC '${e}' ${i} timed out`),a(new he(W.DEADLINE_EXCEEDED,"Request time out"));break;case Hd.HTTP_ERROR:const f=l.getStatus();if(de(nr,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let m=l.getResponseJson();Array.isArray(m)&&(m=m[0]);const v=m==null?void 0:m.error;if(v&&v.status&&v.message){const w=function(A){const L=A.toLowerCase().replace(/_/g,"-");return Object.values(W).indexOf(L)>=0?L:W.UNKNOWN}(v.status);a(new he(w,v.message))}else a(new he(W.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new he(W.UNAVAILABLE,"Connection failed."));break;default:Ne()}}finally{de(nr,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);de(nr,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Ap(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Hx(),a=zx(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");de(nr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let m=!1,v=!1;const w=new ZD({Io:A=>{v?de(nr,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(m||(de(nr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),de(nr,`RPC '${e}' stream ${s} sending:`,A),f.send(A))},To:()=>f.close()}),x=(A,L,F)=>{A.listen(L,$=>{try{F($)}catch(B){setTimeout(()=>{throw B},0)}})};return x(f,Cu.EventType.OPEN,()=>{v||(de(nr,`RPC '${e}' stream ${s} transport opened.`),w.yo())}),x(f,Cu.EventType.CLOSE,()=>{v||(v=!0,de(nr,`RPC '${e}' stream ${s} transport closed`),w.So())}),x(f,Cu.EventType.ERROR,A=>{v||(v=!0,Qr(nr,`RPC '${e}' stream ${s} transport errored:`,A),w.So(new he(W.UNAVAILABLE,"The operation could not be completed")))}),x(f,Cu.EventType.MESSAGE,A=>{var L;if(!v){const F=A.data[0];$e(!!F);const $=F,B=$.error||((L=$[0])===null||L===void 0?void 0:L.error);if(B){de(nr,`RPC '${e}' stream ${s} received error:`,B);const ne=B.status;let re=function(E){const k=Sn[E];if(k!==void 0)return $I(k)}(ne),T=B.message;re===void 0&&(re=W.INTERNAL,T="Unknown error status: "+ne+" with message "+B.message),v=!0,w.So(new he(re,T)),f.close()}else de(nr,`RPC '${e}' stream ${s} received:`,F),w.bo(F)}}),x(a,qx.STAT_EVENT,A=>{A.stat===nm.PROXY?de(nr,`RPC '${e}' stream ${s} detected buffering proxy`):A.stat===nm.NOPROXY&&de(nr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.wo()},0),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wE(){return typeof window<"u"?window:null}function Xd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qc(n){return new lD(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&de("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new jg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===W.RESOURCE_EXHAUSTED?(xn(t.toString()),xn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===W.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new he(W.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return de("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(de("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class tN extends xE{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=dD(this.serializer,e),r=function(i){if(!("targetChange"in i))return qe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?qe.min():o.readTime?Tn(o.readTime):qe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=fm(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=vh(l)?{documents:WI(i,l)}:{query:lf(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=BI(i,o.resumeToken);const c=dm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(qe.min())>0){a.readTime=El(i,o.snapshotVersion.toTimestamp());const c=dm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=fD(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=fm(this.serializer),t.removeTarget=e,this.a_(t)}}class nN extends xE{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return $e(!!e.streamToken),this.lastStreamToken=e.streamToken,$e(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){$e(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=hD(e.writeResults,e.commitTime),r=Tn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=fm(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>_c(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new he(W.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,hm(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new he(W.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,hm(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new he(W.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class sN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(xn(t),this.D_=!1):de("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{vo(this)&&(de("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Te(l);c.L_.add(4),await ql(c),c.q_.set("Unknown"),c.L_.delete(4),await zc(c)}(this))})}),this.q_=new sN(r,s)}}async function zc(n){if(vo(n))for(const e of n.B_)await e(!0)}async function ql(n){for(const e of n.B_)await e(!1)}function hf(n,e){const t=Te(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),zg(t)?qg(t):Hl(t).r_()&&Bg(t,e))}function Sl(n,e){const t=Te(n),r=Hl(t);t.N_.delete(e),r.r_()&&IE(t,e),t.N_.size===0&&(r.r_()?r.o_():vo(t)&&t.q_.set("Unknown"))}function Bg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(qe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Hl(n).A_(e)}function IE(n,e){n.Q_.xe(e),Hl(n).R_(e)}function qg(n){n.Q_=new sD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Hl(n).start(),n.q_.v_()}function zg(n){return vo(n)&&!Hl(n).n_()&&n.N_.size>0}function vo(n){return Te(n).L_.size===0}function EE(n){n.Q_=void 0}async function oN(n){n.q_.set("Online")}async function aN(n){n.N_.forEach((e,t)=>{Bg(n,e)})}async function lN(n,e){EE(n),zg(n)?(n.q_.M_(e),qg(n)):n.q_.set("Unknown")}async function uN(n,e,t){if(n.q_.set("Online"),e instanceof jI&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){de("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ph(n,r)}else if(e instanceof Yd?n.Q_.Ke(e):e instanceof UI?n.Q_.He(e):n.Q_.We(e),!t.isEqual(qe.min()))try{const r=await mE(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(fn.EMPTY_BYTE_STRING,h.snapshotVersion)),IE(i,l);const f=new Bs(h.target,l,c,h.sequenceNumber);Bg(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){de("RemoteStore","Failed to raise snapshot:",r),await Ph(n,r)}}async function Ph(n,e,t){if(!mo(e))throw e;n.L_.add(1),await ql(n),n.q_.set("Offline"),t||(t=()=>mE(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{de("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await zc(n)})}function TE(n,e){return e().catch(t=>Ph(n,t,e))}async function zl(n){const e=Te(n),t=lo(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;cN(e);)try{const s=await WD(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,dN(e,s)}catch(s){await Ph(e,s)}AE(e)&&SE(e)}function cN(n){return vo(n)&&n.O_.length<10}function dN(n,e){n.O_.push(e);const t=lo(n);t.r_()&&t.V_&&t.m_(e.mutations)}function AE(n){return vo(n)&&!lo(n).n_()&&n.O_.length>0}function SE(n){lo(n).start()}async function hN(n){lo(n).p_()}async function fN(n){const e=lo(n);for(const t of n.O_)e.m_(t.mutations)}async function pN(n,e,t){const r=n.O_.shift(),s=Pg.from(r,e,t);await TE(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await zl(n)}async function mN(n,e){e&&lo(n).V_&&await async function(r,s){if(function(o){return LI(o)&&o!==W.ABORTED}(s.code)){const i=r.O_.shift();lo(r).s_(),await TE(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await zl(r)}}(n,e),AE(n)&&SE(n)}async function w_(n,e){const t=Te(n);t.asyncQueue.verifyOperationInProgress(),de("RemoteStore","RemoteStore received new credentials");const r=vo(t);t.L_.add(3),await ql(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await zc(t)}async function _m(n,e){const t=Te(n);e?(t.L_.delete(2),await zc(t)):e||(t.L_.add(2),await ql(t),t.q_.set("Unknown"))}function Hl(n){return n.K_||(n.K_=function(t,r,s){const i=Te(t);return i.w_(),new tN(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:oN.bind(null,n),Ro:aN.bind(null,n),mo:lN.bind(null,n),d_:uN.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),zg(n)?qg(n):n.q_.set("Unknown")):(await n.K_.stop(),EE(n))})),n.K_}function lo(n){return n.U_||(n.U_=function(t,r,s){const i=Te(t);return i.w_(),new nN(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:hN.bind(null,n),mo:mN.bind(null,n),f_:fN.bind(null,n),g_:pN.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await zl(n)):(await n.U_.stop(),n.O_.length>0&&(de("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Hg(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new he(W.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Kl(n,e){if(xn("AsyncQueue",`${e}: ${n}`),mo(n))return new he(W.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Se.comparator(t.key,r.key):(t,r)=>Se.comparator(t.key,r.key),this.keyedMap=ku(),this.sortedSet=new Ht(this.comparator)}static emptySet(e){return new cl(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof cl)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new cl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_{constructor(){this.W_=new Ht(Se.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ne():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Pl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Pl(e,t,cl.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&$c(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class vN{constructor(){this.queries=I_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Te(t),i=s.queries;s.queries=I_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new he(W.ABORTED,"Firestore shutting down"))}}function I_(){return new ci(n=>xI(n),$c)}async function Kg(n,e){const t=Te(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new gN,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Kl(o,`Initialization of query '${Ya(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Wg(t)}async function Gg(n,e){const t=Te(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function yN(n,e){const t=Te(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Wg(t)}function _N(n,e,t){const r=Te(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Wg(n){n.Y_.forEach(e=>{e.next()})}var bm,E_;(E_=bm||(bm={})).ea="default",E_.Cache="cache";class Qg{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Pl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Pl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==bm.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_{constructor(e){this.serializer=e}Es(e){return As(this.serializer,e)}ds(e){return e.metadata.exists?GI(this.serializer,e.document,!1):Wt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return Tn(e)}}class wN{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=PE(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=bt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new T_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||ot()).add(i);t.set(o,a)}}return t}async complete(){const e=await QD(this.localStore,new T_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await JD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function PE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(e){this.key=e}}class CE{constructor(e){this.key=e}}class kE{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ot(),this.mutatedKeys=ot(),this.Aa=EI(e),this.Ra=new cl(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new x_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),v=Fc(this.query,f)?f:null,w=!!m&&this.mutatedKeys.has(m.key),x=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let A=!1;m&&v?m.data.isEqual(v.data)?w!==x&&(r.track({type:3,doc:v}),A=!0):this.ga(m,v)||(r.track({type:2,doc:v}),A=!0,(l&&this.Aa(v,l)>0||c&&this.Aa(v,c)<0)&&(a=!0)):!m&&v?(r.track({type:0,doc:v}),A=!0):m&&!v&&(r.track({type:1,doc:m}),A=!0,(l||c)&&(a=!0)),A&&(v?(o=o.add(v),i=x?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(v,w){const x=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ne()}};return x(v)-x(w)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Pl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new x_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ot(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new CE(r))}),this.da.forEach(r=>{e.has(r)||t.push(new RE(r))}),t}ba(e){this.Ta=e.Ts,this.da=ot();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Pl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class xN{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class IN{constructor(e){this.key=e,this.va=!1}}class EN{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new ci(a=>xI(a),$c),this.Ma=new Map,this.xa=new Set,this.Oa=new Ht(Se.comparator),this.Na=new Map,this.La=new Vg,this.Ba={},this.ka=new Map,this.qa=da.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function TN(n,e,t=!0){const r=ff(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await DE(r,e,t,!0),s}async function AN(n,e){const t=ff(n);await DE(t,e,!0,!1)}async function DE(n,e,t,r){const s=await Tl(n.localStore,ur(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Jg(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&hf(n.remoteStore,s),a}async function Jg(n,e,t,r,s){n.Ka=(f,m,v)=>async function(x,A,L,F){let $=A.view.ma(L);$.ns&&($=await Th(x.localStore,A.query,!1).then(({documents:T})=>A.view.ma(T,$)));const B=F&&F.targetChanges.get(A.targetId),ne=F&&F.targetMismatches.get(A.targetId)!=null,re=A.view.applyChanges($,x.isPrimaryClient,B,ne);return wm(x,A.targetId,re.wa),re.snapshot}(n,f,m,v);const i=await Th(n.localStore,e,!0),o=new kE(e,i.Ts),a=o.ma(i.documents),l=Bc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);wm(n,t,c.wa);const h=new xN(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function SN(n,e,t){const r=Te(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!$c(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Al(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Sl(r.remoteStore,s.targetId),Rl(r,s.targetId)}).catch(po)):(Rl(r,s.targetId),await Al(r.localStore,s.targetId,!0))}async function PN(n,e){const t=Te(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Sl(t.remoteStore,r.targetId))}async function RN(n,e,t){const r=ev(n);try{const s=await function(o,a){const l=Te(o),c=an.now(),h=a.reduce((v,w)=>v.add(w.key),ot());let f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let w=Ar(),x=ot();return l.cs.getEntries(v,h).next(A=>{w=A,w.forEach((L,F)=>{F.isValidDocument()||(x=x.add(L))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,w)).next(A=>{f=A;const L=[];for(const F of a){const $=tD(F,f.get(F.key).overlayedDocument);$!=null&&L.push(new di(F.key,$,dI($.value.mapValue),nn.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,L,a)}).next(A=>{m=A;const L=A.applyToLocalDocumentSet(f,x);return l.documentOverlayCache.saveOverlays(v,A.batchId,L)})}).then(()=>({batchId:m.batchId,changes:AI(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ht(et)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await hi(r,s.changes),await zl(r.remoteStore)}catch(s){const i=Kl(s,"Failed to persist write");t.reject(i)}}async function NE(n,e){const t=Te(n);try{const r=await GD(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&($e(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?$e(o.va):s.removedDocuments.size>0&&($e(o.va),o.va=!1))}),await hi(t,r,e)}catch(r){await po(r)}}function A_(n,e,t){const r=Te(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Te(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const m of f.j_)m.Z_(a)&&(c=!0)}),c&&Wg(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function CN(n,e,t){const r=Te(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ht(Se.comparator);o=o.insert(i,Wt.newNoDocument(i,qe.min()));const a=ot().add(i),l=new jc(qe.min(),new Map,new Ht(et),o,a);await NE(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Zg(r)}else await Al(r.localStore,e,!1).then(()=>Rl(r,e,t)).catch(po)}async function kN(n,e){const t=Te(n),r=e.batch.batchId;try{const s=await KD(t.localStore,e);Xg(t,r,null),Yg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await hi(t,s)}catch(s){await po(s)}}async function DN(n,e,t){const r=Te(n);try{const s=await function(o,a){const l=Te(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>($e(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);Xg(r,e,t),Yg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await hi(r,s)}catch(s){await po(s)}}async function NN(n,e){const t=Te(n);vo(t.remoteStore)||de("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Te(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Kl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Yg(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Xg(n,e,t){const r=Te(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Rl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||OE(n,r)})}function OE(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Sl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Zg(n))}function wm(n,e,t){for(const r of t)r instanceof RE?(n.La.addReference(r.key,e),ON(n,r)):r instanceof CE?(de("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||OE(n,r.key)):Ne()}function ON(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(de("SyncEngine","New document in limbo: "+t),n.xa.add(r),Zg(n))}function Zg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Se(bt.fromString(e)),r=n.qa.next();n.Na.set(r,new IN(t)),n.Oa=n.Oa.insert(t,r),hf(n.remoteStore,new Bs(ur(Ul(t.path)),r,"TargetPurposeLimboResolution",Er.oe))}}async function hi(n,e,t){const r=Te(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Fg.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Te(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,m=>z.forEach(m.$i,v=>h.persistence.referenceDelegate.addReference(f,m.targetId,v)).next(()=>z.forEach(m.Ui,v=>h.persistence.referenceDelegate.removeReference(f,m.targetId,v)))))}catch(f){if(!mo(f))throw f;de("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const m=f.targetId;if(!f.fromCache){const v=h.os.get(m),w=v.snapshotVersion,x=v.withLastLimboFreeSnapshotVersion(w);h.os=h.os.insert(m,x)}}}(r.localStore,i))}async function VN(n,e){const t=Te(n);if(!t.currentUser.isEqual(e)){de("SyncEngine","User change. New user:",e.toKey());const r=await pE(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new he(W.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await hi(t,r.hs)}}function MN(n,e){const t=Te(n),r=t.Na.get(e);if(r&&r.va)return ot().add(r.key);{let s=ot();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function LN(n,e){const t=Te(n),r=await Th(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&wm(t,e.targetId,s.wa),s}async function $N(n,e){const t=Te(n);return yE(t.localStore,e).then(r=>hi(t,r))}async function FN(n,e,t,r){const s=Te(n),i=await function(a,l){const c=Te(a),h=Te(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(m=>m?c.localDocuments.getDocuments(f,m):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await zl(s.remoteStore):t==="acknowledged"||t==="rejected"?(Xg(s,e,r||null),Yg(s,e),function(a,l){Te(Te(a).mutationQueue).On(l)}(s.localStore,e)):Ne(),await hi(s,i)):de("SyncEngine","Cannot apply mutation batch with id: "+e)}async function UN(n,e){const t=Te(n);if(ff(t),ev(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await S_(t,r.toArray());t.Qa=!0,await _m(t.remoteStore,!0);for(const i of s)hf(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Rl(t,o),Al(t.localStore,o,!0))),Sl(t.remoteStore,o)}),await s,await S_(t,r),function(o){const a=Te(o);a.Na.forEach((l,c)=>{Sl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ht(Se.comparator)}(t),t.Qa=!1,await _m(t.remoteStore,!1)}}async function S_(n,e,t){const r=Te(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Tl(r.localStore,ur(l[0]));for(const c of l){const h=r.Fa.get(c),f=await LN(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await vE(r.localStore,o);a=await Tl(r.localStore,c),await Jg(r,VE(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function VE(n){return _I(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function jN(n){return function(t){return Te(Te(t).persistence).Qi()}(Te(n).localStore)}async function BN(n,e,t,r){const s=Te(n);if(s.Qa)return void de("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await yE(s.localStore,II(i[0])),a=jc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",fn.EMPTY_BYTE_STRING);await hi(s,o,a);break}case"rejected":await Al(s.localStore,e,!0),Rl(s,e,r);break;default:Ne()}}async function qN(n,e,t){const r=ff(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){de("SyncEngine","Adding an already active target "+s);continue}const i=await vE(r.localStore,s),o=await Tl(r.localStore,i);await Jg(r,VE(i),o.targetId,!1,o.resumeToken),hf(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Al(r.localStore,s,!1).then(()=>{Sl(r.remoteStore,s),Rl(r,s)}).catch(po)}}function ff(n){const e=Te(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=NE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=MN.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=CN.bind(null,e),e.Ca.d_=yN.bind(null,e.eventManager),e.Ca.$a=_N.bind(null,e.eventManager),e}function ev(n){const e=Te(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=kN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=DN.bind(null,e),e}function zN(n,e,t){const r=Te(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,w){const x=Te(v),A=Tn(w.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",L=>x.Gr.getBundleMetadata(L,w.id)).then(L=>!!L&&L.createTime.compareTo(A)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(PE(l));const c=new wN(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const m=await c.la(h);m&&a._updateProgress(m),h=await o.Ua()}const f=await c.complete();return await hi(i,f.Ia,void 0),await function(v,w){const x=Te(v);return x.persistence.runTransaction("Save bundle","readwrite",A=>x.Gr.saveBundleMetadata(A,w))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Qr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class uo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return fE(this.persistence,new hE,e.initialUser,this.serializer)}Ga(e){return new Mg(df.Zr,this.serializer)}Wa(e){return new bE}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}uo.provider={build:()=>new uo};class HN extends uo{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){$e(this.persistence.referenceDelegate instanceof Eh);const r=this.persistence.referenceDelegate.garbageCollector;return new aE(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new Mg(r=>Eh.Zr(r,t),this.serializer)}}class tv extends uo{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await ev(this.Ja.syncEngine),await zl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return fE(this.persistence,new hE,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new aE(r,e.asyncQueue,t)}Ha(e,t){const r=new f2(t,this.persistence);return new h2(e.asyncQueue,r)}Ga(e){const t=$g(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new Lg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,wE(),Xd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new bE}}class ME extends tv{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Tp&&(this.sharedClientState.syncEngine={no:FN.bind(null,t),ro:BN.bind(null,t),io:qN.bind(null,t),Qi:jN.bind(null,t),eo:$N.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await UN(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=wE();if(!Tp.D(t))throw new he(W.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=$g(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Tp(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class co{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>A_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=VN.bind(null,this.syncEngine),await _m(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new vN}()}createDatastore(e){const t=qc(e.databaseInfo.databaseId),r=function(i){return new eN(i)}(e.databaseInfo);return function(i,o,a,l){return new rN(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new iN(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>A_(this.syncEngine,t,0),function(){return b_.D()?new b_:new YD}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new EN(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Te(s);de("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ql(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}co.provider={build:()=>new co};function P_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):xn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new qn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new bN(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GN{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new he(W.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Te(s),a={documents:i.map(f=>yc(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,bt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const m=cD(o.serializer,f);c.set(m.key.toString(),m)});const h=[];return i.forEach(f=>{const m=c.get(f.toString());$e(!!m),h.push(m)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Bl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Se.fromPath(r);this.mutations.push(new Ag(s,this.precondition(s)))}),await async function(r,s){const i=Te(r),o={writes:s.map(a=>_c(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,bt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ne();t=qe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new he(W.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(qe.min())?nn.exists(!1):nn.updateTime(t):nn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(qe.min()))throw new he(W.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return nn.updateTime(t)}return nn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WN{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new jg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new GN(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Mc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!LI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QN{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=jn.UNAUTHENTICATED,this.clientId=Wx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{de("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(de("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Kl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Sp(n,e){n.asyncQueue.verifyOperationInProgress(),de("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await pE(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function R_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await nv(n);de("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>w_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>w_(e.remoteStore,s)),n._onlineComponents=e}async function nv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){de("FirestoreClient","Using user provided OfflineComponentProvider");try{await Sp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===W.FAILED_PRECONDITION||s.code===W.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Qr("Error using user provided cache. Falling back to memory cache: "+t),await Sp(n,new uo)}}else de("FirestoreClient","Using default OfflineComponentProvider"),await Sp(n,new uo);return n._offlineComponents}async function mf(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(de("FirestoreClient","Using user provided OnlineComponentProvider"),await R_(n,n._uninitializedComponentsProvider._online)):(de("FirestoreClient","Using default OnlineComponentProvider"),await R_(n,new co))),n._onlineComponents}function LE(n){return nv(n).then(e=>e.persistence)}function Gl(n){return nv(n).then(e=>e.localStore)}function $E(n){return mf(n).then(e=>e.remoteStore)}function rv(n){return mf(n).then(e=>e.syncEngine)}function FE(n){return mf(n).then(e=>e.datastore)}async function Cl(n){const e=await mf(n),t=e.eventManager;return t.onListen=TN.bind(null,e.syncEngine),t.onUnlisten=SN.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=AN.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=PN.bind(null,e.syncEngine),t}function JN(n){return n.asyncQueue.enqueue(async()=>{const e=await LE(n),t=await $E(n);return e.setNetworkEnabled(!0),function(s){const i=Te(s);return i.L_.delete(0),zc(i)}(t)})}function YN(n){return n.asyncQueue.enqueue(async()=>{const e=await LE(n),t=await $E(n);return e.setNetworkEnabled(!1),async function(s){const i=Te(s);i.L_.add(0),await ql(i),i.q_.set("Offline")}(t)})}function XN(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Te(c);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new he(W.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Kl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Gl(n),e,t)),t.promise}function UE(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new pf({next:m=>{h.Za(),o.enqueueAndForget(()=>Gg(i,f));const v=m.docs.has(a);!v&&m.fromCache?c.reject(new he(W.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&m.fromCache&&l&&l.source==="server"?c.reject(new he(W.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Qg(Ul(a.path),h,{includeMetadataChanges:!0,_a:!0});return Kg(i,f)}(await Cl(n),n.asyncQueue,e,t,r)),r.promise}function ZN(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Th(s,i,!0),l=new kE(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=Kl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Gl(n),e,t)),t.promise}function jE(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new pf({next:m=>{h.Za(),o.enqueueAndForget(()=>Gg(i,f)),m.fromCache&&l.source==="server"?c.reject(new he(W.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Qg(a,h,{includeMetadataChanges:!0,_a:!0});return Kg(i,f)}(await Cl(n),n.asyncQueue,e,t,r)),r.promise}function eO(n,e,t){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await FE(n);r.resolve(async function(o,a,l){var c;const h=Te(o),{request:f,ut:m,parent:v}=QI(h.serializer,bI(a),l);h.connection.Fo||delete f.parent;const w=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,v,f,1)).filter(A=>!!A.result);$e(w.length===1);const x=(c=w[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(x).reduce((A,L)=>(A[m[L]]=x[L],A),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function tO(n,e){const t=new pf(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Te(s).Y_.add(i),i.next()}(await Cl(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Te(s).Y_.delete(i)}(await Cl(n),t))}}function nO(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?FI().encode(o):o,function(h,f){return new KN(h,f)}(function(h,f){if(h instanceof Uint8Array)return P_(h,f);if(h instanceof ArrayBuffer)return P_(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,qc(e));n.asyncQueue.enqueueAndForget(async()=>{zN(await rv(n),s,r)})}function rO(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Te(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Gl(n),e))}function sO(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Te(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,m,v,w,x){f=[...f],m=[...m],f.sort(v),m.sort(v);const A=f.length,L=m.length;let F=0,$=0;for(;F<L&&$<A;){const B=v(f[$],m[F]);B<0?x(f[$++]):B>0?w(m[F++]):(F++,$++)}for(;F<L;)w(m[F++]);for(;$<A;)x(f[$++])}(c,s,l2,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>z.waitFor(a)))}(await Gl(n),e))}function iO(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Te(r).ss.zi=s}(await Gl(n),e))}function oO(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Te(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Gl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(n,e,t){if(!t)throw new he(W.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function aO(n,e,t,r){if(e===!0&&r===!0)throw new he(W.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function k_(n){if(!Se.isDocumentKey(n))throw new he(W.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function D_(n){if(Se.isDocumentKey(n))throw new he(W.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function gf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ne()}function mt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new he(W.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=gf(n);throw new he(W.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function qE(n,e){if(e<=0)throw new he(W.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new he(W.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new he(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}aO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=BE((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new he(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new he(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new he(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Hc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new N_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(W.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new he(W.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new N_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new e2;switch(r.type){case"firstParty":return new s2(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new he(W.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=C_.get(t);r&&(de("ComponentProvider","Removing Datastore"),C_.delete(t),r.terminate())}(this),Promise.resolve()}}function lO(n,e,t,r={}){var s;const i=(n=mt(n,Hc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Qr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=jn.MOCK_USER;else{a=ox(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new he(W.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new jn(c)}n._authCredentials=new t2(new Kx(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Xn(this.firestore,e,this._query)}}class An{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ss(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new An(this.firestore,e,this._key)}}class Ss extends Xn{constructor(e,t,r){super(e,t,Ul(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new An(this.firestore,null,new Se(e))}withConverter(e){return new Ss(this.firestore,e,this._path)}}function st(n,e,...t){if(n=Me(n),sv("collection","path",e),n instanceof Hc){const r=bt.fromString(e,...t);return D_(r),new Ss(n,null,r)}{if(!(n instanceof An||n instanceof Ss))throw new he(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(e,...t));return D_(r),new Ss(n.firestore,null,r)}}function BH(n,e){if(n=mt(n,Hc),sv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new he(W.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Xn(n,null,function(r){return new ui(bt.emptyPath(),r)}(e))}function Ee(n,e,...t){if(n=Me(n),arguments.length===1&&(e=Wx.newId()),sv("doc","path",e),n instanceof Hc){const r=bt.fromString(e,...t);return k_(r),new An(n,null,new Se(r))}{if(!(n instanceof An||n instanceof Ss))throw new he(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(e,...t));return k_(r),new An(n.firestore,n instanceof Ss?n.converter:null,new Se(r))}}function qH(n,e){return n=Me(n),e=Me(e),(n instanceof An||n instanceof Ss)&&(e instanceof An||e instanceof Ss)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function zE(n,e){return n=Me(n),e=Me(e),n instanceof Xn&&e instanceof Xn&&n.firestore===e.firestore&&$c(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new jg(this,"async_queue_retry"),this.Vu=()=>{const r=Xd();r&&de("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Xd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Xd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new qn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!mo(e))throw e;de("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw xn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Hg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ne()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function xm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class uO{constructor(){this._progressObserver={},this._taskCompletionResolver=new qn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zH=-1;class Bt extends Hc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new O_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new O_(e),this._firestoreClient=void 0,await e}}}function HH(n,e,t){t||(t="(default)");const r=li(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ro(i,e))return s;throw new he(W.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new he(W.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new he(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function cO(n,e){const t=typeof n=="object"?n:$l(),r=typeof n=="string"?n:e||"(default)",s=li(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=rx("firestore");i&&lO(s,...i)}return s}function ln(n){if(n._terminated)throw new he(W.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||HE(n),n._firestoreClient}function HE(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new O2(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,BE(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new QN(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function dO(n,e){Qr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return KE(n,co.provider,{build:r=>new tv(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function KH(n){Qr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();KE(n,co.provider,{build:t=>new ME(t,e.cacheSizeBytes)})}function KE(n,e,t){if((n=mt(n,Bt))._firestoreClient||n._terminated)throw new he(W.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new he(W.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},HE(n)}function GH(n){if(n._initialized&&!n._terminated)throw new he(W.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new qn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ts.D())return Promise.resolve();const s=r+"main";await Ts.delete(s)}($g(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function WH(n){return function(t){const r=new qn;return t.asyncQueue.enqueueAndForget(async()=>NN(await rv(t),r)),r.promise}(ln(n=mt(n,Bt)))}function QH(n){return JN(ln(n=mt(n,Bt)))}function JH(n){return YN(ln(n=mt(n,Bt)))}function YH(n){return vC(n.app,"firestore",n._databaseId.database),n._delete()}function XH(n,e){const t=ln(n=mt(n,Bt)),r=new uO;return nO(t,n._databaseId,e,r),r}function ZH(n,e){return rO(ln(n=mt(n,Bt)),e).then(t=>t?new Xn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bc{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class hO{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ha(fn.fromBase64String(e))}catch(t){throw new he(W.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ha(fn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new he(W.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function eK(){return new va("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ya{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new he(W.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new he(W.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return et(this._lat,e._lat)||et(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fO=/^__.*__$/;class pO{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new di(e,this.data,this.fieldMask,t,this.fieldTransforms):new jl(e,this.data,t,this.fieldTransforms)}}class GE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new di(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function WE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ne()}}class yf{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new yf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Rh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(WE(this.Cu)&&fO.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class mO{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||qc(e)}Qu(e,t,r,s=!1){return new yf({Cu:e,methodName:t,qu:r,path:tn.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _a(n){const e=n._freezeSettings(),t=qc(n._databaseId);return new mO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function _f(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);hv("Data must be an object, but it was:",o,r);const a=YE(r,o);let l,c;if(i.merge)l=new Tr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=wc(e,f,t);if(!o.contains(m))throw new he(W.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);ZE(h,m)||h.push(m)}l=new Tr(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new pO(new Yn(a),l,c)}class Kc extends ya{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Kc}}function QE(n,e,t){return new yf({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ov extends ya{_toFieldTransform(e){return new Uc(e.path,new xl)}isEqual(e){return e instanceof ov}}class av extends ya{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=QE(this,e,!0),r=this.Ku.map(i=>ba(i,t)),s=new aa(r);return new Uc(e.path,s)}isEqual(e){return e instanceof av&&ro(this.Ku,e.Ku)}}class lv extends ya{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=QE(this,e,!0),r=this.Ku.map(i=>ba(i,t)),s=new la(r);return new Uc(e.path,s)}isEqual(e){return e instanceof lv&&ro(this.Ku,e.Ku)}}class uv extends ya{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Il(e.serializer,RI(e.serializer,this.$u));return new Uc(e.path,t)}isEqual(e){return e instanceof uv&&this.$u===e.$u}}function cv(n,e,t,r){const s=n.Qu(1,e,t);hv("Data must be an object, but it was:",s,r);const i=[],o=Yn.empty();go(r,(l,c)=>{const h=bf(e,l,t);c=Me(c);const f=s.Nu(h);if(c instanceof Kc)i.push(h);else{const m=ba(c,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new Tr(i);return new GE(o,a,s.fieldTransforms)}function dv(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[wc(e,r,t)],l=[s];if(i.length%2!=0)throw new he(W.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(wc(e,i[m])),l.push(i[m+1]);const c=[],h=Yn.empty();for(let m=a.length-1;m>=0;--m)if(!ZE(c,a[m])){const v=a[m];let w=l[m];w=Me(w);const x=o.Nu(v);if(w instanceof Kc)c.push(v);else{const A=ba(w,x);A!=null&&(c.push(v),h.set(v,A))}}const f=new Tr(c);return new GE(h,f,o.fieldTransforms)}function JE(n,e,t,r=!1){return ba(t,n.Qu(r?4:3,e))}function ba(n,e){if(XE(n=Me(n)))return hv("Unsupported field value:",e,n),YE(n,e);if(n instanceof ya)return function(r,s){if(!WE(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ba(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Me(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return RI(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=an.fromDate(r);return{timestampValue:El(s.serializer,i)}}if(r instanceof an){const i=new an(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:El(s.serializer,i)}}if(r instanceof iv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ha)return{bytesValue:BI(s.serializer,r._byteString)};if(r instanceof An){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:kg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof vf)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Tg(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${gf(r)}`)}(n,e)}function YE(n,e){const t={};return aI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):go(n,(r,s)=>{const i=ba(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function XE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof an||n instanceof iv||n instanceof ha||n instanceof An||n instanceof ya||n instanceof vf)}function hv(n,e,t){if(!XE(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=gf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function wc(n,e,t){if((e=Me(e))instanceof va)return e._internalPath;if(typeof e=="string")return bf(n,e);throw Rh("Field path arguments must be of type string or ",n,!1,void 0,t)}const gO=new RegExp("[~\\*/\\[\\]]");function bf(n,e,t){if(e.search(gO)>=0)throw Rh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new va(...e.split("."))._internalPath}catch{throw Rh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rh(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new he(W.INVALID_ARGUMENT,a+n+l)}function ZE(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new An(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new vO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(wf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class vO extends xc{data(){return super.data()}}function wf(n,e){return typeof e=="string"?bf(n,e):e instanceof va?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new he(W.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class fv{}class Gc extends fv{}function Ic(n,e,...t){let r=[];e instanceof fv&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Wl).length,a=i.filter(l=>l instanceof Wc).length;if(o>1||o>0&&a>0)throw new he(W.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Wc extends Gc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Wc(e,t,r)}_apply(e){const t=this._parse(e);return nT(e._query,t),new Xn(e.firestore,e.converter,cm(e._query,t))}_parse(e){const t=_a(e.firestore);return function(i,o,a,l,c,h,f){let m;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new he(W.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){M_(f,h);const v=[];for(const w of f)v.push(V_(l,i,w));m={arrayValue:{values:v}}}else m=V_(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||M_(f,h),m=JE(a,o,f,h==="in"||h==="not-in");return wt.create(c,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ch(n,e,t){const r=e,s=wf("where",n);return Wc._create(s,r,t)}class Wl extends fv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Wl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Lt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)nT(o,l),o=cm(o,l)}(e._query,t),new Xn(e.firestore,e.converter,cm(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function tK(...n){return n.forEach(e=>rT("or",e)),Wl._create("or",n)}function nK(...n){return n.forEach(e=>rT("and",e)),Wl._create("and",n)}class pv extends Gc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new pv(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new he(W.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new he(W.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vc(i,o)}(e._query,this._field,this._direction);return new Xn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new ui(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function yO(n,e="asc"){const t=e,r=wf("orderBy",n);return pv._create(r,t)}class xf extends Gc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new xf(e,t,r)}_apply(e){return new Xn(e.firestore,e.converter,_h(e._query,this._limit,this._limitType))}}function rK(n){return qE("limit",n),xf._create("limit",n,"F")}function sK(n){return qE("limitToLast",n),xf._create("limitToLast",n,"L")}class If extends Gc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new If(e,t,r)}_apply(e){const t=tT(e,this.type,this._docOrFields,this._inclusive);return new Xn(e.firestore,e.converter,function(s,i){return new ui(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function iK(...n){return If._create("startAt",n,!0)}function oK(...n){return If._create("startAfter",n,!1)}class Ef extends Gc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ef(e,t,r)}_apply(e){const t=tT(e,this.type,this._docOrFields,this._inclusive);return new Xn(e.firestore,e.converter,function(s,i){return new ui(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function aK(...n){return Ef._create("endBefore",n,!1)}function lK(...n){return Ef._create("endAt",n,!0)}function tT(n,e,t,r){if(t[0]=Me(t[0]),t[0]instanceof xc)return function(i,o,a,l,c){if(!l)throw new he(W.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of ul(i))if(f.field.isKeyField())h.push(ia(o,l.key));else{const m=l.data.field(f.field);if(nf(m))throw new he(W.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const v=f.field.canonicalString();throw new he(W.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}h.push(m)}return new ao(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=_a(n.firestore);return function(o,a,l,c,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new he(W.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let w=0;w<h.length;w++){const x=h[w];if(m[w].field.isKeyField()){if(typeof x!="string")throw new he(W.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof x}`);if(!Ig(o)&&x.indexOf("/")!==-1)throw new he(W.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${x}' contains a slash.`);const A=o.path.child(bt.fromString(x));if(!Se.isDocumentKey(A))throw new he(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${A}' is not because it contains an odd number of segments.`);const L=new Se(A);v.push(ia(a,L))}else{const A=JE(l,c,x);v.push(A)}}return new ao(v,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function V_(n,e,t){if(typeof(t=Me(t))=="string"){if(t==="")throw new he(W.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ig(e)&&t.indexOf("/")!==-1)throw new he(W.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(bt.fromString(t));if(!Se.isDocumentKey(r))throw new he(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ia(n,new Se(r))}if(t instanceof An)return ia(n,t._key);throw new he(W.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gf(t)}.`)}function M_(n,e){if(!Array.isArray(n)||n.length===0)throw new he(W.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function nT(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new he(W.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new he(W.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function rT(n,e){if(!(e instanceof Wc||e instanceof Wl))throw new he(W.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class sT{convertValue(e,t="none"){switch(io(e)){case 0:return null;case 1:return e.booleanValue;case 2:return en(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ne()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return go(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>en(o.doubleValue));return new vf(i)}convertGeoPoint(e){return new iv(en(e.latitude),en(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=rf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(pc(e));default:return null}}convertTimestamp(e){const t=ti(e);return new an(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=bt.fromString(e);$e(ZI(r));const s=new sa(r.get(1),r.get(3)),i=new Se(r.popFirst(5));return s.isEqual(t)||xn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tf(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class _O extends sT{constructor(e){super(),this.firestore=e}convertBytes(e){return new ha(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new An(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uK(n){return new bc("sum",wc("sum",n))}function cK(n){return new bc("avg",wc("average",n))}function bO(){return new bc("count")}function dK(n,e){var t,r;return n instanceof bc&&e instanceof bc&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function hK(n,e){return zE(n.query,e.query)&&ro(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class kl extends xc{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Zd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(wf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Zd extends kl{data(e={}){return super.data(e)}}class Dl{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Wo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Zd(this._firestore,this._userDataWriter,r.key,r,new Wo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new he(W.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Zd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Zd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:wO(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function wO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ne()}}function fK(n,e){return n instanceof kl&&e instanceof kl?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Dl&&e instanceof Dl&&n._firestore===e._firestore&&zE(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(n){n=mt(n,An);const e=mt(n.firestore,Bt);return UE(ln(e),n._key).then(t=>mv(e,n,t))}class yo extends sT{constructor(e){super(),this.firestore=e}convertBytes(e){return new ha(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new An(this.firestore,null,t)}}function pK(n){n=mt(n,An);const e=mt(n.firestore,Bt),t=ln(e),r=new yo(e);return XN(t,n._key).then(s=>new kl(e,r,n._key,s,new Wo(s!==null&&s.hasLocalMutations,!0),n.converter))}function mK(n){n=mt(n,An);const e=mt(n.firestore,Bt);return UE(ln(e),n._key,{source:"server"}).then(t=>mv(e,n,t))}function Vt(n){n=mt(n,Xn);const e=mt(n.firestore,Bt),t=ln(e),r=new yo(e);return eT(n._query),jE(t,n._query).then(s=>new Dl(e,r,n,s))}function gK(n){n=mt(n,Xn);const e=mt(n.firestore,Bt),t=ln(e),r=new yo(e);return ZN(t,n._query).then(s=>new Dl(e,r,n,s))}function vK(n){n=mt(n,Xn);const e=mt(n.firestore,Bt),t=ln(e),r=new yo(e);return jE(t,n._query,{source:"server"}).then(s=>new Dl(e,r,n,s))}function dn(n,e,t){n=mt(n,An);const r=mt(n.firestore,Bt),s=Tf(n.converter,e,t);return Qc(r,[_f(_a(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,nn.none())])}function wa(n,e,t,...r){n=mt(n,An);const s=mt(n.firestore,Bt),i=_a(s);let o;return o=typeof(e=Me(e))=="string"||e instanceof va?dv(i,"updateDoc",n._key,e,t,r):cv(i,"updateDoc",n._key,e),Qc(s,[o.toMutation(n._key,nn.exists(!0))])}function Nl(n){return Qc(mt(n.firestore,Bt),[new Bl(n._key,nn.none())])}function Ql(n,e){const t=mt(n.firestore,Bt),r=Ee(n),s=Tf(n.converter,e);return Qc(t,[_f(_a(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,nn.exists(!1))]).then(()=>r)}function yK(n,...e){var t,r,s;n=Me(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||xm(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(xm(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof An)c=mt(n.firestore,Bt),h=Ul(n._key.path),l={next:f=>{e[o]&&e[o](mv(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=mt(n,Xn);c=mt(f.firestore,Bt),h=f._query;const m=new yo(c);l={next:v=>{e[o]&&e[o](new Dl(c,m,f,v))},error:e[o+1],complete:e[o+2]},eT(n._query)}return function(m,v,w,x){const A=new pf(x),L=new Qg(v,A,w);return m.asyncQueue.enqueueAndForget(async()=>Kg(await Cl(m),L)),()=>{A.Za(),m.asyncQueue.enqueueAndForget(async()=>Gg(await Cl(m),L))}}(ln(c),h,a,l)}function _K(n,e){return tO(ln(n=mt(n,Bt)),xm(e)?e:{next:e})}function Qc(n,e){return function(r,s){const i=new qn;return r.asyncQueue.enqueueAndForget(async()=>RN(await rv(r),s,i)),i.promise}(ln(n),e)}function mv(n,e,t){const r=t.docs.get(e._key),s=new yo(n);return new kl(n,s,e._key,r,new Wo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bK(n){return xO(n,{count:bO()})}function xO(n,e){const t=mt(n.firestore,Bt),r=ln(t),s=oI(e,(i,o)=>new MI(o,i.aggregateType,i._internalFieldPath));return eO(r,n._query,s).then(i=>function(a,l,c){const h=new yo(a);return new hO(l,h,c)}(t,n,i))}class IO{constructor(e){this.kind="memory",this._onlineComponentProvider=co.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=uo.provider}toJSON(){return{kind:this.kind}}}class EO{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=RO(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class TO{constructor(){this.kind="memoryEager",this._offlineComponentProvider=uo.provider}toJSON(){return{kind:this.kind}}}class AO{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new HN(e)}}toJSON(){return{kind:this.kind}}}function wK(){return new TO}function xK(n){return new AO(n==null?void 0:n.cacheSizeBytes)}function IK(n){return new IO(n)}function EK(n){return new EO(n)}class SO{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=co.provider,this._offlineComponentProvider={build:t=>new tv(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class PO{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=co.provider,this._offlineComponentProvider={build:t=>new ME(t,e==null?void 0:e.cacheSizeBytes)}}}function RO(n){return new SO(n==null?void 0:n.forceOwnership)}function TK(){return new PO}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CO={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kO{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=_a(e)}set(e,t,r){this._verifyNotCommitted();const s=ji(e,this._firestore),i=Tf(s.converter,t,r),o=_f(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,nn.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ji(e,this._firestore);let o;return o=typeof(t=Me(t))=="string"||t instanceof va?dv(this._dataReader,"WriteBatch.update",i._key,t,r,s):cv(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,nn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ji(e,this._firestore);return this._mutations=this._mutations.concat(new Bl(t._key,nn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new he(W.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ji(n,e){if((n=Me(n)).firestore!==e)throw new he(W.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DO extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=_a(t)}get(t){const r=ji(t,this._firestore),s=new _O(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ne();const o=i[0];if(o.isFoundDocument())return new xc(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new xc(this._firestore,s,r._key,null,r.converter);throw Ne()})}set(t,r,s){const i=ji(t,this._firestore),o=Tf(i.converter,r,s),a=_f(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=ji(t,this._firestore);let a;return a=typeof(r=Me(r))=="string"||r instanceof va?dv(this._dataReader,"Transaction.update",o._key,r,s,i):cv(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=ji(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ji(e,this._firestore),r=new yo(this._firestore);return super.get(e).then(s=>new kl(this._firestore,r,t._key,s._document,new Wo(!1,!1),t.converter))}}function SK(n,e,t){n=mt(n,Bt);const r=Object.assign(Object.assign({},CO),t);return function(i){if(i.maxAttempts<1)throw new he(W.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new qn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await FE(i);new WN(i.asyncQueue,c,a,o,l).au()}),l.promise}(ln(n),s=>e(new DO(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PK(){return new Kc("deleteField")}function ri(){return new ov("serverTimestamp")}function NO(...n){return new av("arrayUnion",n)}function RK(...n){return new lv("arrayRemove",n)}function CK(n){return new uv("increment",n)}function kK(n){return new vf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gv(n){return ln(n=mt(n,Bt)),new kO(n,e=>Qc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DK(n,e){const t=ln(n=mt(n,Bt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Qr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new he(W.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=L_(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const m=bf("setIndexConfiguration",L_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Xo(m,2)):f.order==="ASCENDING"?h.push(new Xo(m,0)):f.order==="DESCENDING"&&h.push(new Xo(m,1))}a.push(new yl(yl.UNKNOWN_ID,c,h,_l.empty()))}return a}(e);return sO(t,r)}function L_(n,e){if(typeof n[e]!="string")throw new he(W.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OO{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function NK(n){var e;n=mt(n,Bt);const t=$_.get(n);if(t)return t;if(((e=ln(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new OO(n);return $_.set(n,r),r}function OK(n){iT(n,!0)}function VK(n){iT(n,!1)}function MK(n){oO(ln(n._firestore)).then(e=>de("deleting all persistent cache indexes succeeded")).catch(e=>Qr("deleting all persistent cache indexes failed",e))}function iT(n,e){iO(ln(n._firestore),e).then(t=>de(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Qr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const $_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LK(n){var e;const t=(e=ln(mt(n.firestore,Bt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:lf(t,ur(n._query))._t}function $K(n,e){var t;const r=oI(e,(i,o)=>new MI(o,i.aggregateType,i._internalFieldPath)),s=(t=ln(mt(n.firestore,Bt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:QI(s,bI(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FK{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return vv.instance.onExistenceFilterMismatch(e)}}class vv{constructor(){this.Uu=new Map}static get instance(){return Dd||(Dd=new vv,function(t){if(bh)throw new Error("a TestingHooksSpi instance is already set");bh=t}(Dd)),Dd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Dd=null;(function(e,t=!0){(function(s){Fl=s})(ga),as(new Wr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Bt(new n2(r.getProvider("auth-internal")),new i2(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new he(W.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sa(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Sr(S0,"4.7.3",e),Sr(S0,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oT="firebasestorage.googleapis.com",aT="storageBucket",VO=2*60*1e3,MO=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn extends us{constructor(e,t,r=0){super(Pp(e),`Firebase Storage: ${t} (${Pp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,mn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Pp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var pn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(pn||(pn={}));function Pp(n){return"storage/"+n}function yv(){const n="An unknown error occurred, please check the error payload for server response.";return new mn(pn.UNKNOWN,n)}function LO(n){return new mn(pn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function $O(n){return new mn(pn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function FO(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new mn(pn.UNAUTHENTICATED,n)}function UO(){return new mn(pn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function jO(n){return new mn(pn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function BO(){return new mn(pn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function qO(){return new mn(pn.CANCELED,"User canceled the upload/download.")}function zO(n){return new mn(pn.INVALID_URL,"Invalid URL '"+n+"'.")}function HO(n){return new mn(pn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function KO(){return new mn(pn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+aT+"' property when initializing the app?")}function GO(){return new mn(pn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function WO(){return new mn(pn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function QO(n){return new mn(pn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Im(n){return new mn(pn.INVALID_ARGUMENT,n)}function lT(){return new mn(pn.APP_DELETED,"The Firebase app was deleted.")}function JO(n){return new mn(pn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Gu(n,e){return new mn(pn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Iu(n){throw new mn(pn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=$r.makeFromUrl(e,t)}catch{return new $r(e,"")}if(r.path==="")return r;throw HO(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(B){B.path.charAt(B.path.length-1)==="/"&&(B.path_=B.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(B){B.path_=decodeURIComponent(B.path)}const h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${h}/b/${s}/o${m}`,"i"),w={bucket:1,path:3},x=t===oT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,A="([^?#]*)",L=new RegExp(`^https?://${x}/${s}/${A}`,"i"),$=[{regex:a,indices:l,postModify:i},{regex:v,indices:w,postModify:c},{regex:L,indices:{bucket:1,path:2},postModify:c}];for(let B=0;B<$.length;B++){const ne=$[B],re=ne.regex.exec(e);if(re){const T=re[ne.indices.bucket];let _=re[ne.indices.path];_||(_=""),r=new $r(T,_),ne.postModify(r);break}}if(r==null)throw zO(e);return r}}class YO{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function h(...A){c||(c=!0,e.apply(null,A))}function f(A){s=setTimeout(()=>{s=null,n(v,l())},A)}function m(){i&&clearTimeout(i)}function v(A,...L){if(c){m();return}if(A){m(),h.call(null,A,...L);return}if(l()||o){m(),h.call(null,A,...L);return}r<64&&(r*=2);let $;a===1?(a=2,$=0):$=(r+Math.random())*1e3,f($)}let w=!1;function x(A){w||(w=!0,m(),!c&&(s!==null?(A||(a=2),clearTimeout(s),f(0)):A||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,x(!0)},t),x}function ZO(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eV(n){return n!==void 0}function tV(n){return typeof n=="object"&&!Array.isArray(n)}function _v(n){return typeof n=="string"||n instanceof String}function F_(n){return bv()&&n instanceof Blob}function bv(){return typeof Blob<"u"}function U_(n,e,t,r){if(r<e)throw Im(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Im(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function uT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var Zo;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Zo||(Zo={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nV(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(e,t,r,s,i,o,a,l,c,h,f,m=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=f,this.retry=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,w)=>{this.resolve_=v,this.reject_=w,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Nd(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Zo.NO_ERROR,l=i.getStatus();if(!a||nV(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===Zo.ABORT;r(!1,new Nd(!1,null,h));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new Nd(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());eV(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=yv();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?lT():qO();o(l)}else{const l=BO();o(l)}};this.canceled_?t(!1,new Nd(!1,null,!0)):this.backoffId_=XO(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&ZO(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Nd{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function sV(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function iV(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function oV(n,e){e&&(n["X-Firebase-GMPID"]=e)}function aV(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function lV(n,e,t,r,s,i,o=!0){const a=uT(n.urlParams),l=n.url+a,c=Object.assign({},n.headers);return oV(c,e),sV(c,t),iV(c,i),aV(c,r),new rV(l,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uV(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function cV(...n){const e=uV();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(bv())return new Blob(n);throw new mn(pn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function dV(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hV(n){if(typeof atob>"u")throw QO("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Is={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Rp{constructor(e,t){this.data=e,this.contentType=t||null}}function fV(n,e){switch(n){case Is.RAW:return new Rp(cT(e));case Is.BASE64:case Is.BASE64URL:return new Rp(dT(n,e));case Is.DATA_URL:return new Rp(mV(e),gV(e))}throw yv()}function cT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function pV(n){let e;try{e=decodeURIComponent(n)}catch{throw Gu(Is.DATA_URL,"Malformed data URL.")}return cT(e)}function dT(n,e){switch(n){case Is.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Gu(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Is.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Gu(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=hV(e)}catch(s){throw s.message.includes("polyfill")?s:Gu(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class hT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Gu(Is.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=vV(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function mV(n){const e=new hT(n);return e.base64?dT(Is.BASE64,e.rest):pV(e.rest)}function gV(n){return new hT(n).contentType}function vV(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,t){let r=0,s="";F_(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(F_(this.data_)){const r=this.data_,s=dV(r,e,t);return s===null?null:new Bi(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Bi(r,!0)}}static getBlob(...e){if(bv()){const t=e.map(r=>r instanceof Bi?r.data_:r);return new Bi(cV.apply(null,t))}else{const t=e.map(o=>_v(o)?fV(Is.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Bi(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fT(n){let e;try{e=JSON.parse(n)}catch{return null}return tV(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yV(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function _V(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function pT(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bV(n,e){return e}class dr{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||bV}}let Od=null;function wV(n){return!_v(n)||n.length<2?n:pT(n)}function mT(){if(Od)return Od;const n=[];n.push(new dr("bucket")),n.push(new dr("generation")),n.push(new dr("metageneration")),n.push(new dr("name","fullPath",!0));function e(i,o){return wV(o)}const t=new dr("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new dr("size");return s.xform=r,n.push(s),n.push(new dr("timeCreated")),n.push(new dr("updated")),n.push(new dr("md5Hash",null,!0)),n.push(new dr("cacheControl",null,!0)),n.push(new dr("contentDisposition",null,!0)),n.push(new dr("contentEncoding",null,!0)),n.push(new dr("contentLanguage",null,!0)),n.push(new dr("contentType",null,!0)),n.push(new dr("metadata","customMetadata",!0)),Od=n,Od}function xV(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new $r(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function IV(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return xV(r,n),r}function gT(n,e,t){const r=fT(e);return r===null?null:IV(n,r,t)}function EV(n,e,t,r){const s=fT(e);if(s===null||!_v(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const h=n.bucket,f=n.fullPath,m="/b/"+o(h)+"/o/"+o(f),v=Af(m,t,r),w=uT({alt:"media",token:c});return v+w})[0]}function TV(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class wv{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vT(n){if(!n)throw yv()}function AV(n,e){function t(r,s){const i=gT(n,s,e);return vT(i!==null),i}return t}function SV(n,e){function t(r,s){const i=gT(n,s,e);return vT(i!==null),EV(i,s,n.host,n._protocol)}return t}function yT(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=UO():s=FO():t.getStatus()===402?s=$O(n.bucket):t.getStatus()===403?s=jO(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function _T(n){const e=yT(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=LO(n.path)),i.serverResponse=s.serverResponse,i}return t}function PV(n,e,t){const r=e.fullServerUrl(),s=Af(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new wv(s,i,SV(n,t),o);return a.errorHandler=_T(e),a}function RV(n,e){const t=e.fullServerUrl(),r=Af(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,c){}const a=new wv(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=_T(e),a}function CV(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function kV(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=CV(null,e)),r}function DV(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let $="";for(let B=0;B<2;B++)$=$+Math.random().toString().slice(2);return $}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=kV(e,r,s),h=TV(c,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,m=`\r
--`+l+"--",v=Bi.getBlob(f,r,m);if(v===null)throw GO();const w={name:c.fullPath},x=Af(i,n.host,n._protocol),A="POST",L=n.maxUploadRetryTime,F=new wv(x,A,AV(n,t),L);return F.urlParams=w,F.headers=o,F.body=v.uploadData(),F.errorHandler=yT(e),F}class NV{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Zo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Zo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Zo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s){if(this.sent_)throw Iu("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Iu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Iu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Iu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Iu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class OV extends NV{initXhr(){this.xhr_.responseType="text"}}function xv(){return new OV}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e,t){this._service=e,t instanceof $r?this._location=t:this._location=$r.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new fa(e,t)}get root(){const e=new $r(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return pT(this._location.path)}get storage(){return this._service}get parent(){const e=yV(this._location.path);if(e===null)return null;const t=new $r(this._location.bucket,e);return new fa(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw JO(e)}}function VV(n,e,t){n._throwIfRoot("uploadBytes");const r=DV(n.storage,n._location,mT(),new Bi(e,!0),t);return n.storage.makeRequestWithTokens(r,xv).then(s=>({metadata:s,ref:n}))}function MV(n){n._throwIfRoot("getDownloadURL");const e=PV(n.storage,n._location,mT());return n.storage.makeRequestWithTokens(e,xv).then(t=>{if(t===null)throw WO();return t})}function LV(n){n._throwIfRoot("deleteObject");const e=RV(n.storage,n._location);return n.storage.makeRequestWithTokens(e,xv)}function $V(n,e){const t=_V(n._location.path,e),r=new $r(n._location.bucket,t);return new fa(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FV(n){return/^[A-Za-z]+:\/\//.test(n)}function UV(n,e){return new fa(n,e)}function bT(n,e){if(n instanceof Iv){const t=n;if(t._bucket==null)throw KO();const r=new fa(t,t._bucket);return e!=null?bT(r,e):r}else return e!==void 0?$V(n,e):n}function jV(n,e){if(e&&FV(e)){if(n instanceof Iv)return UV(n,e);throw Im("To use ref(service, url), the first argument must be a Storage instance.")}else return bT(n,e)}function j_(n,e){const t=e==null?void 0:e[aT];return t==null?null:$r.makeFromBucketSpec(t,n)}function BV(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:ox(s,n.app.options.projectId))}class Iv{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=oT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=VO,this._maxUploadRetryTime=MO,this._requests=new Set,s!=null?this._bucket=$r.makeFromBucketSpec(s,this._host):this._bucket=j_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=$r.makeFromBucketSpec(this._url,e):this._bucket=j_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){U_("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){U_("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new fa(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new YO(lT());{const o=lV(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const B_="@firebase/storage",q_="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wT="storage";function qV(n,e,t){return n=Me(n),VV(n,e,t)}function zV(n){return n=Me(n),MV(n)}function HV(n){return n=Me(n),LV(n)}function xT(n,e){return n=Me(n),jV(n,e)}function KV(n=$l(),e){n=Me(n);const r=li(n,wT).getImmediate({identifier:e}),s=rx("storage");return s&&GV(r,...s),r}function GV(n,e,t,r={}){BV(n,e,t,r)}function WV(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Iv(t,r,s,e,ga)}function QV(){as(new Wr(wT,WV,"PUBLIC").setMultipleInstances(!0)),Sr(B_,q_,""),Sr(B_,q_,"esm2017")}QV();function Ev(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UK={PHONE:"phone",TOTP:"totp"},jK={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},BK={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},qK={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},zK={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JV(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function IT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const HK=JV,YV=IT,ET=new ma("auth","Firebase",IT()),KK={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kh=new lg("@firebase/auth");function XV(n,...e){kh.logLevel<=yt.WARN&&kh.warn(`Auth (${ga}): ${n}`,...e)}function eh(n,...e){kh.logLevel<=yt.ERROR&&kh.error(`Auth (${ga}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(n,...e){throw Av(n,...e)}function gr(n,...e){return Av(n,...e)}function Tv(n,e,t){const r=Object.assign(Object.assign({},YV()),{[e]:t});return new ma("auth","Firebase",r).create(e,{appName:n.name})}function zn(n){return Tv(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Jl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Pr(n,"argument-error"),Tv(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Av(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ET.create(n,...e)}function be(n,e,...t){if(!n)throw Av(e,...t)}function Es(n){const e="INTERNAL ASSERTION FAILED: "+n;throw eh(e),new Error(e)}function si(n,e){n||Es(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Sv(){return z_()==="http:"||z_()==="https:"}function z_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZV(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Sv()||dR()||"connection"in navigator)?navigator.onLine:!0}function eM(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t){this.shortDelay=e,this.longDelay=t,si(t>e,"Short delay should be less than long delay!"),this.isMobile=lR()||hR()}get(){return ZV()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pv(n,e){si(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Es("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Es("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Es("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nM=new Jc(3e4,6e4);function Qt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Jt(n,e,t,r,s={}){return AT(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ll(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return cR()||(c.referrerPolicy="no-referrer"),TT.fetch()(ST(n,n.config.apiHost,t,a),c)})}async function AT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},tM),e);try{const s=new sM(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ou(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ou(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Ou(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Ou(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Tv(n,h,c);Pr(n,h)}}catch(s){if(s instanceof us)throw s;Pr(n,"network-request-failed",{message:String(s)})}}async function fi(n,e,t,r,s={}){const i=await Jt(n,e,t,r,s);return"mfaPendingCredential"in i&&Pr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function ST(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Pv(n.config,s):`${n.config.apiScheme}://${s}`}function rM(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class sM{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(gr(this.auth,"network-request-failed")),nM.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ou(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=gr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H_(n){return n!==void 0&&n.getResponse!==void 0}function K_(n){return n!==void 0&&n.enterprise!==void 0}class PT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return rM(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iM(n){return(await Jt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function RT(n,e){return Jt(n,"GET","/v2/recaptchaConfig",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oM(n,e){return Jt(n,"POST","/v1/accounts:delete",e)}async function aM(n,e){return Jt(n,"POST","/v1/accounts:update",e)}async function CT(n,e){return Jt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GK(n,e=!1){return Me(n).getIdToken(e)}async function lM(n,e=!1){const t=Me(n),r=await t.getIdToken(e),s=Sf(r);be(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Wu(Cp(s.auth_time)),issuedAtTime:Wu(Cp(s.iat)),expirationTime:Wu(Cp(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Cp(n){return Number(n)*1e3}function Sf(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return eh("JWT malformed, contained fewer than 3 sections"),null;try{const s=tx(t);return s?JSON.parse(s):(eh("Failed to decode base64 JWT payload"),null)}catch(s){return eh("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function G_(n){const e=Sf(n);return be(e,"internal-error"),be(typeof e.exp<"u","internal-error"),be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ii(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof us&&uM(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function uM({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cM{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Wu(this.lastLoginAt),this.creationTime=Wu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tc(n){var e;const t=n.auth,r=await n.getIdToken(),s=await ii(n,CT(t,{idToken:r}));be(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?kT(i.providerUserInfo):[],a=hM(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Em(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function dM(n){const e=Me(n);await Tc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function hM(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function kT(n){return n.map(e=>{var{providerId:t}=e,r=Ev(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fM(n,e){const t=await AT(n,{},async()=>{const r=Ll({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=ST(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",TT.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function pM(n,e){return Jt(n,"POST","/v2/accounts:revokeToken",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){be(e.idToken,"internal-error"),be(typeof e.idToken<"u","internal-error"),be(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):G_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){be(e.length!==0,"internal-error");const t=G_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await fM(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new dl;return r&&(be(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(be(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(be(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new dl,this.toJSON())}_performRefresh(){return Es("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Di(n,e){be(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class qs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Ev(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new cM(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Em(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ii(this,this.stsTokenManager.getToken(this.auth,e));return be(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return lM(this,e)}reload(){return dM(this)}_assign(e){this!==e&&(be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new qs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Tc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(In(this.auth.app))return Promise.reject(zn(this.auth));const e=await this.getIdToken();return await ii(this,oM(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,m=(s=t.email)!==null&&s!==void 0?s:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,w=(o=t.photoURL)!==null&&o!==void 0?o:void 0,x=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,L=(c=t.createdAt)!==null&&c!==void 0?c:void 0,F=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:$,emailVerified:B,isAnonymous:ne,providerData:re,stsTokenManager:T}=t;be($&&T,e,"internal-error");const _=dl.fromJSON(this.name,T);be(typeof $=="string",e,"internal-error"),Di(f,e.name),Di(m,e.name),be(typeof B=="boolean",e,"internal-error"),be(typeof ne=="boolean",e,"internal-error"),Di(v,e.name),Di(w,e.name),Di(x,e.name),Di(A,e.name),Di(L,e.name),Di(F,e.name);const E=new qs({uid:$,auth:e,email:m,emailVerified:B,displayName:f,isAnonymous:ne,photoURL:w,phoneNumber:v,tenantId:x,stsTokenManager:_,createdAt:L,lastLoginAt:F});return re&&Array.isArray(re)&&(E.providerData=re.map(k=>Object.assign({},k))),A&&(E._redirectEventId=A),E}static async _fromIdTokenResponse(e,t,r=!1){const s=new dl;s.updateFromServerResponse(t);const i=new qs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Tc(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];be(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?kT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new dl;a.updateFromIdToken(r);const l=new qs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Em(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W_=new Map;function zs(n){si(n instanceof Function,"Expected a class definition");let e=W_.get(n);return e?(si(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,W_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}DT.type="NONE";const Q_=DT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(n,e,t){return`firebase:${n}:${e}:${t}`}class hl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=th(this.userKey,s.apiKey,i),this.fullPersistenceKey=th("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?qs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new hl(zs(Q_),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||zs(Q_);const o=th(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=qs._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new hl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new hl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(MT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(NT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if($T(e))return"Blackberry";if(FT(e))return"Webos";if(OT(e))return"Safari";if((e.includes("chrome/")||VT(e))&&!e.includes("edge/"))return"Chrome";if(LT(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function NT(n=On()){return/firefox\//i.test(n)}function OT(n=On()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function VT(n=On()){return/crios\//i.test(n)}function MT(n=On()){return/iemobile/i.test(n)}function LT(n=On()){return/android/i.test(n)}function $T(n=On()){return/blackberry/i.test(n)}function FT(n=On()){return/webos/i.test(n)}function Rv(n=On()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function mM(n=On()){var e;return Rv(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function gM(){return fR()&&document.documentMode===10}function UT(n=On()){return Rv(n)||LT(n)||FT(n)||$T(n)||/windows phone/i.test(n)||MT(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jT(n,e=[]){let t;switch(n){case"Browser":t=J_(On());break;case"Worker":t=`${J_(On())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ga}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vM{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yM(n,e={}){return Jt(n,"GET","/v2/passwordPolicy",Qt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _M=6;class bM{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:_M,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wM{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Y_(this),this.idTokenSubscription=new Y_(this),this.beforeStateQueue=new vM(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ET,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=zs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await hl.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await CT(this,{idToken:e}),r=await qs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(In(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Tc(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=eM()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(In(this.app))return Promise.reject(zn(this));const t=e?Me(e):null;return t&&be(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return In(this.app)?Promise.reject(zn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return In(this.app)?Promise.reject(zn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(zs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await yM(this),t=new bM(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ma("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await pM(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&zs(e)||this._popupRedirectResolver;be(t,this,"argument-error"),this.redirectPersistenceManager=await hl.create(this,[zs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(be(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=jT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&XV(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function gn(n){return Me(n)}class Y_{constructor(e){this.auth=e,this.observer=null,this.addObserver=_R(t=>this.observer=t)}get next(){return be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function xM(n){Yc=n}function Cv(n){return Yc.loadJS(n)}function IM(){return Yc.recaptchaV2Script}function EM(){return Yc.recaptchaEnterpriseScript}function TM(){return Yc.gapiScript}function BT(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const AM="recaptcha-enterprise",SM="NO_RECAPTCHA";class qT{constructor(e){this.type=AM,this.auth=gn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{RT(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new PT(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;K_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(SM)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&K_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=EM();l.length!==0&&(l+=a),Cv(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function X_(n,e,t,r=!1){const s=new qT(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ac(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await X_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await X_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function PM(n){const e=gn(n),t=await RT(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new PT(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new qT(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RM(n,e){const t=li(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ro(i,e??{}))return s;Pr(s,"already-initialized")}return t.initialize({options:e})}function CM(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(zs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function kM(n,e,t){const r=gn(n);be(r._canInitEmulator,r,"emulator-config-failed"),be(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=zT(e),{host:o,port:a}=DM(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||NM()}function zT(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function DM(n){const e=zT(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Z_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Z_(o)}}}function Z_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function NM(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Es("not implemented")}_getIdTokenResponse(e){return Es("not implemented")}_linkToIdToken(e,t){return Es("not implemented")}_getReauthenticationResolver(e){return Es("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HT(n,e){return Jt(n,"POST","/v1/accounts:resetPassword",Qt(n,e))}async function OM(n,e){return Jt(n,"POST","/v1/accounts:update",e)}async function VM(n,e){return Jt(n,"POST","/v1/accounts:signUp",e)}async function MM(n,e){return Jt(n,"POST","/v1/accounts:update",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LM(n,e){return fi(n,"POST","/v1/accounts:signInWithPassword",Qt(n,e))}async function Pf(n,e){return Jt(n,"POST","/v1/accounts:sendOobCode",Qt(n,e))}async function $M(n,e){return Pf(n,e)}async function FM(n,e){return Pf(n,e)}async function UM(n,e){return Pf(n,e)}async function jM(n,e){return Pf(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BM(n,e){return fi(n,"POST","/v1/accounts:signInWithEmailLink",Qt(n,e))}async function qM(n,e){return fi(n,"POST","/v1/accounts:signInWithEmailLink",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc extends Xc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Sc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Sc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ac(e,t,"signInWithPassword",LM);case"emailLink":return BM(e,{email:this._email,oobCode:this._password});default:Pr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ac(e,r,"signUpPassword",VM);case"emailLink":return qM(e,{idToken:t,email:this._email,oobCode:this._password});default:Pr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Js(n,e){return fi(n,"POST","/v1/accounts:signInWithIdp",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zM="http://localhost";class oi extends Xc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new oi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Pr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Ev(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new oi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Js(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Js(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Js(e,t)}buildRequest(){const e={requestUri:zM,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ll(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HM(n,e){return Jt(n,"POST","/v1/accounts:sendVerificationCode",Qt(n,e))}async function KM(n,e){return fi(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,e))}async function GM(n,e){const t=await fi(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,e));if(t.temporaryProof)throw Ou(n,"account-exists-with-different-credential",t);return t}const WM={USER_NOT_FOUND:"user-not-found"};async function QM(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return fi(n,"POST","/v1/accounts:signInWithPhoneNumber",Qt(n,t),WM)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea extends Xc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ea({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ea({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return KM(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return GM(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return QM(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ea({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JM(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function YM(n){const e=Pu(Ru(n)).link,t=e?Pu(Ru(e)).deep_link_id:null,r=Pu(Ru(n)).deep_link_id;return(r?Pu(Ru(r)).link:null)||r||t||e||n}class Zc{constructor(e){var t,r,s,i,o,a;const l=Pu(Ru(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=JM((s=l.mode)!==null&&s!==void 0?s:null);be(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=YM(e);try{return new Zc(t)}catch{return null}}}function WK(n){return Zc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(){this.providerId=xa.PROVIDER_ID}static credential(e,t){return Sc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Zc.parseLink(t);return be(r,"argument-error"),Sc._fromEmailAndCode(e,r.code,r.tenantId)}}xa.PROVIDER_ID="password";xa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl extends pi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nh extends Yl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return be("providerId"in t&&"signInMethod"in t,"argument-error"),oi._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return be(e.idToken||e.accessToken,"argument-error"),oi._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return nh.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return nh.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new nh(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi extends Yl{constructor(){super("facebook.com")}static credential(e){return oi._fromParams({providerId:qi.PROVIDER_ID,signInMethod:qi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qi.credentialFromTaggedObject(e)}static credentialFromError(e){return qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qi.credential(e.oauthAccessToken)}catch{return null}}}qi.FACEBOOK_SIGN_IN_METHOD="facebook.com";qi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends Yl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return oi._fromParams({providerId:zi.PROVIDER_ID,signInMethod:zi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return zi.credentialFromTaggedObject(e)}static credentialFromError(e){return zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return zi.credential(t,r)}catch{return null}}}zi.GOOGLE_SIGN_IN_METHOD="google.com";zi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi extends Yl{constructor(){super("github.com")}static credential(e){return oi._fromParams({providerId:Hi.PROVIDER_ID,signInMethod:Hi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Hi.credentialFromTaggedObject(e)}static credentialFromError(e){return Hi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Hi.credential(e.oauthAccessToken)}catch{return null}}}Hi.GITHUB_SIGN_IN_METHOD="github.com";Hi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XM="http://localhost";class Pc extends Xc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Js(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Js(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Js(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Pc(r,i)}static _create(e,t){return new Pc(e,t)}buildRequest(){return{requestUri:XM,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM="saml.";class Tm extends pi{constructor(e){be(e.startsWith(ZM),"argument-error"),super(e)}static credentialFromResult(e){return Tm.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Tm.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Pc.fromJSON(e);return be(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Pc._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki extends Yl{constructor(){super("twitter.com")}static credential(e,t){return oi._fromParams({providerId:Ki.PROVIDER_ID,signInMethod:Ki.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ki.credentialFromTaggedObject(e)}static credentialFromError(e){return Ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Ki.credential(t,r)}catch{return null}}}Ki.TWITTER_SIGN_IN_METHOD="twitter.com";Ki.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KT(n,e){return fi(n,"POST","/v1/accounts:signUp",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await qs._fromIdTokenResponse(e,r,s),o=eb(r);return new Jr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=eb(r);return new Jr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function eb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GT(n){var e;if(In(n.app))return Promise.reject(zn(n));const t=gn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Jr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await KT(t,{returnSecureToken:!0}),s=await Jr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh extends us{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Dh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Dh(e,t,r,s)}}function WT(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Dh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QT(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QK(n,e){const t=Me(n);await Rf(!0,t,e);const{providerUserInfo:r}=await aM(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=QT(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function kv(n,e,t=!1){const r=await ii(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Jr._forOperation(n,"link",r)}async function Rf(n,e,t){await Tc(e);const r=QT(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";be(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JT(n,e,t=!1){const{auth:r}=n;if(In(r.app))return Promise.reject(zn(r));const s="reauthenticate";try{const i=await ii(n,WT(r,s,e,n),t);be(i.idToken,r,"internal-error");const o=Sf(i.idToken);be(o,r,"internal-error");const{sub:a}=o;return be(n.uid===a,r,"user-mismatch"),Jr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Pr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YT(n,e,t=!1){if(In(n.app))return Promise.reject(zn(n));const r="signIn",s=await WT(n,r,e),i=await Jr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Dv(n,e){return YT(gn(n),e)}async function eL(n,e){const t=Me(n);return await Rf(!1,t,e.providerId),kv(t,e)}async function tL(n,e){return JT(Me(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nL(n,e){return fi(n,"POST","/v1/accounts:signInWithCustomToken",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JK(n,e){if(In(n.app))return Promise.reject(zn(n));const t=gn(n),r=await nL(t,{token:e,returnSecureToken:!0}),s=await Jr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Nv._fromServerResponse(e,t):"totpInfo"in t?Ov._fromServerResponse(e,t):Pr(e,"internal-error")}}class Nv extends ed{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Nv(t)}}class Ov extends ed{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Ov(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(n,e,t){var r;be(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),be(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(be(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(be(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vv(n){const e=gn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function rL(n,e,t){const r=gn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Cf(r,s,t),await Ac(r,s,"getOobCode",FM)}async function sL(n,e,t){await HT(Me(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Vv(n),r})}async function YK(n,e){await MM(Me(n),{oobCode:e})}async function iL(n,e){const t=Me(n),r=await HT(t,{oobCode:e}),s=r.requestType;switch(be(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":be(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":be(r.mfaInfo,t,"internal-error");default:be(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=ed._fromServerResponse(gn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function XK(n,e){const{data:t}=await iL(Me(n),e);return t.email}async function oL(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=gn(n),o=await Ac(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",KT).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Vv(n),l}),a=await Jr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function aL(n,e,t){return In(n.app)?Promise.reject(zn(n)):Dv(Me(n),xa.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Vv(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZK(n,e,t){const r=gn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){be(a.handleCodeInApp,r,"argument-error"),a&&Cf(r,o,a)}i(s,t),await Ac(r,s,"getOobCode",UM)}function eG(n,e){const t=Zc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function tG(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=Me(n),s=xa.credentialWithLink(e,t||Ec());return be(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Dv(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lL(n,e){return Jt(n,"POST","/v1/accounts:createAuthUri",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nG(n,e){const t=Sv()?Ec():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await lL(Me(n),r);return s||[]}async function rG(n,e){const t=Me(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Cf(t.auth,s,e);const{email:i}=await $M(t.auth,s);i!==n.email&&await n.reload()}async function sG(n,e,t){const r=Me(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Cf(r.auth,i,t);const{email:o}=await jM(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uL(n,e){return Jt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iG(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Me(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await ii(r,uL(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function cL(n,e){const t=Me(n);return In(t.auth.app)?Promise.reject(zn(t.auth)):XT(t,e,null)}function dL(n,e){return XT(Me(n),null,e)}async function XT(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await ii(n,OM(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hL(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Sf(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new fl(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new fL(i,s);case"github.com":return new pL(i,s);case"google.com":return new mL(i,s);case"twitter.com":return new gL(i,s,n.screenName||null);case"custom":case"anonymous":return new fl(i,null);default:return new fl(i,r,s)}}class fl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class ZT extends fl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class fL extends fl{constructor(e,t){super(e,"facebook.com",t)}}class pL extends ZT{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class mL extends fl{constructor(e,t){super(e,"google.com",t)}}class gL extends ZT{constructor(e,t,r){super(e,"twitter.com",t,r)}}function oG(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:hL(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vL(n,e){return Me(n).setPersistence(e)}function aG(n){return PM(n)}async function lG(n,e){return gn(n).validatePassword(e)}function yL(n,e,t,r){return Me(n).onIdTokenChanged(e,t,r)}function _L(n,e,t){return Me(n).beforeAuthStateChanged(e,t)}function bL(n,e,t,r){return Me(n).onAuthStateChanged(e,t,r)}function uG(n){Me(n).useDeviceLanguage()}function cG(n,e){return Me(n).updateCurrentUser(e)}function wL(n){return Me(n).signOut()}function dG(n,e){return gn(n).revokeAccessToken(e)}async function hG(n){return Me(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Qo("enroll",e,t)}static _fromMfaPendingCredential(e){return new Qo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Qo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Qo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mv{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=gn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>ed._fromServerResponse(r,a));be(s.mfaPendingCredential,r,"internal-error");const o=Qo._fromMfaPendingCredential(s.mfaPendingCredential);return new Mv(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await Jr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return be(t.user,r,"internal-error"),Jr._forOperation(t.user,t.operationType,c);default:Pr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function fG(n,e){var t;const r=Me(n),s=e;return be(e.customData.operationType,r,"argument-error"),be((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Mv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xL(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:start",Qt(n,e))}function IL(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Qt(n,e))}function EL(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:start",Qt(n,e))}function TL(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Qt(n,e))}function AL(n,e){return Jt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Qt(n,e))}class Lv{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>ed._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Lv(e)}async getSession(){return Qo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await ii(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await ii(this.user,AL(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const kp=new WeakMap;function pG(n){const e=Me(n);return kp.has(e)||kp.set(e,Lv._fromUser(e)),kp.get(e)}const Nh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Nh,"1"),this.storage.removeItem(Nh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SL=1e3,PL=10;class t1 extends e1{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=UT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);gM()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,PL):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},SL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}t1.type="LOCAL";const n1=t1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1 extends e1{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}r1.type="SESSION";const s1=r1;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RL(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new kf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await RL(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}kf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Df("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===c)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(){return window}function kL(n){Pn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(){return typeof Pn().WorkerGlobalScope<"u"&&typeof Pn().importScripts=="function"}async function DL(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function NL(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function OL(){return $v()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1="firebaseLocalStorageDb",VL=1,Oh="firebaseLocalStorage",o1="fbase_key";class td{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Nf(n,e){return n.transaction([Oh],e?"readwrite":"readonly").objectStore(Oh)}function ML(){const n=indexedDB.deleteDatabase(i1);return new td(n).toPromise()}function Am(){const n=indexedDB.open(i1,VL);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Oh,{keyPath:o1})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Oh)?e(r):(r.close(),await ML(),e(await Am()))})})}async function tb(n,e,t){const r=Nf(n,!0).put({[o1]:e,value:t});return new td(r).toPromise()}async function LL(n,e){const t=Nf(n,!1).get(e),r=await new td(t).toPromise();return r===void 0?null:r.value}function nb(n,e){const t=Nf(n,!0).delete(e);return new td(t).toPromise()}const $L=800,FL=3;class a1{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Am(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>FL)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return $v()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=kf._getInstance(OL()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await DL(),!this.activeServiceWorker)return;this.sender=new CL(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||NL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Am();return await tb(e,Nh,"1"),await nb(e,Nh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>tb(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>LL(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>nb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Nf(s,!1).getAll();return new td(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),$L)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}a1.type="LOCAL";const UL=a1;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(n,e){return Jt(n,"POST","/v2/accounts/mfaSignIn:start",Qt(n,e))}function BL(n,e){return Jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Qt(n,e))}function qL(n,e){return Jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Qt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zL=500,HL=6e4,Vd=1e12;class KL{constructor(e){this.auth=e,this.counter=Vd,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new GL(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Vd;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Vd;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Vd;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class GL{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;be(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=WL(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},HL)},zL))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function WL(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dp=BT("rcb"),QL=new Jc(3e4,6e4);class JL{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Pn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return be(YL(t),e,"argument-error"),this.shouldResolveImmediately(t)&&H_(Pn().grecaptcha)?Promise.resolve(Pn().grecaptcha):new Promise((r,s)=>{const i=Pn().setTimeout(()=>{s(gr(e,"network-request-failed"))},QL.get());Pn()[Dp]=()=>{Pn().clearTimeout(i),delete Pn()[Dp];const a=Pn().grecaptcha;if(!a||!H_(a)){s(gr(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${IM()}?${Ll({onload:Dp,render:"explicit",hl:t})}`;Cv(o).catch(()=>{clearTimeout(i),s(gr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Pn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function YL(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class XL{async load(e){return new KL(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1="recaptcha",ZL={theme:"light",type:"image"};class mG{constructor(e,t,r=Object.assign({},ZL)){this.parameters=r,this.type=l1,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=gn(e),this.isInvisible=this.parameters.size==="invisible",be(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;be(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new XL:new JL,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){be(!this.parameters.sitekey,this.auth,"argument-error"),be(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),be(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Pn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){be(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){be(Sv()&&!$v(),this.auth,"internal-error"),await e4(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await iM(this.auth);be(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return be(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function e4(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ea._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function gG(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=gn(n),s=await Of(r,e,Me(t));return new Fv(s,i=>Dv(r,i))}async function vG(n,e,t){const r=Me(n);await Rf(!1,r,"phone");const s=await Of(r.auth,e,Me(t));return new Fv(s,i=>eL(r,i))}async function yG(n,e,t){const r=Me(n);if(In(r.auth.app))return Promise.reject(zn(r.auth));const s=await Of(r.auth,e,Me(t));return new Fv(s,i=>tL(r,i))}async function Of(n,e,t){var r;const s=await t.verify();try{be(typeof s=="string",n,"argument-error"),be(t.type===l1,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return be(o.type==="enroll",n,"internal-error"),(await xL(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{be(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return be(a,n,"missing-multi-factor-info"),(await jL(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await HM(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function _G(n,e){const t=Me(n);if(In(t.auth.app))return Promise.reject(zn(t.auth));await kv(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(e){this.providerId=pl.PROVIDER_ID,this.auth=gn(e)}verifyPhoneNumber(e,t){return Of(this.auth,e,Me(t))}static credential(e,t){return ea._fromVerification(e,t)}static credentialFromResult(e){const t=e;return pl.credentialFromTaggedObject(t)}static credentialFromError(e){return pl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ea._fromTokenResponse(t,r):null}}pl.PROVIDER_ID="phone";pl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ia(n,e){return e?zs(e):(be(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv extends Xc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Js(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Js(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Js(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function t4(n){return YT(n.auth,new Uv(n),n.bypassAuthState)}function n4(n){const{auth:e,user:t}=n;return be(t,e,"internal-error"),JT(t,new Uv(n),n.bypassAuthState)}async function r4(n){const{auth:e,user:t}=n;return be(t,e,"internal-error"),kv(t,new Uv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u1{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return t4;case"linkViaPopup":case"linkViaRedirect":return r4;case"reauthViaPopup":case"reauthViaRedirect":return n4;default:Pr(this.auth,"internal-error")}}resolve(e){si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){si(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s4=new Jc(2e3,1e4);async function bG(n,e,t){if(In(n.app))return Promise.reject(gr(n,"operation-not-supported-in-this-environment"));const r=gn(n);Jl(n,e,pi);const s=Ia(r,t);return new Hs(r,"signInViaPopup",e,s).executeNotNull()}async function wG(n,e,t){const r=Me(n);if(In(r.auth.app))return Promise.reject(gr(r.auth,"operation-not-supported-in-this-environment"));Jl(r.auth,e,pi);const s=Ia(r.auth,t);return new Hs(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function xG(n,e,t){const r=Me(n);Jl(r.auth,e,pi);const s=Ia(r.auth,t);return new Hs(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Hs extends u1{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Hs.currentPopupAction&&Hs.currentPopupAction.cancel(),Hs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return be(e,this.auth,"internal-error"),e}async onExecution(){si(this.filter.length===1,"Popup operations only handle one event");const e=Df();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(gr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(gr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(gr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,s4.get())};e()}}Hs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i4="pendingRedirect",rh=new Map;class o4 extends u1{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=rh.get(this.auth._key());if(!e){try{const r=await a4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}rh.set(this.auth._key(),e)}return this.bypassAuthState||rh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function a4(n,e){const t=d1(e),r=c1(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function jv(n,e){return c1(n)._set(d1(e),"true")}function l4(n,e){rh.set(n._key(),e)}function c1(n){return zs(n._redirectPersistence)}function d1(n){return th(i4,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IG(n,e,t){return u4(n,e,t)}async function u4(n,e,t){if(In(n.app))return Promise.reject(zn(n));const r=gn(n);Jl(n,e,pi),await r._initializationPromise;const s=Ia(r,t);return await jv(s,r),s._openRedirect(r,e,"signInViaRedirect")}function EG(n,e,t){return c4(n,e,t)}async function c4(n,e,t){const r=Me(n);if(Jl(r.auth,e,pi),In(r.auth.app))return Promise.reject(zn(r.auth));await r.auth._initializationPromise;const s=Ia(r.auth,t);await jv(s,r.auth);const i=await f1(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function TG(n,e,t){return d4(n,e,t)}async function d4(n,e,t){const r=Me(n);Jl(r.auth,e,pi),await r.auth._initializationPromise;const s=Ia(r.auth,t);await Rf(!1,r,e.providerId),await jv(s,r.auth);const i=await f1(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function AG(n,e){return await gn(n)._initializationPromise,h1(n,e,!1)}async function h1(n,e,t=!1){if(In(n.app))return Promise.reject(zn(n));const r=gn(n),s=Ia(r,e),o=await new o4(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function f1(n){const e=Df(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4=10*60*1e3;class f4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!p4(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!p1(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(gr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=h4&&this.cachedEventUids.clear(),this.cachedEventUids.has(rb(e))}saveEventToCache(e){this.cachedEventUids.add(rb(e)),this.lastProcessedEventTime=Date.now()}}function rb(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function p1({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function p4(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return p1(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m4(n,e={}){return Jt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,v4=/^https?/;async function y4(n){if(n.config.emulator)return;const{authorizedDomains:e}=await m4(n);for(const t of e)try{if(_4(t))return}catch{}Pr(n,"unauthorized-domain")}function _4(n){const e=Ec(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!v4.test(t))return!1;if(g4.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4=new Jc(3e4,6e4);function sb(){const n=Pn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function w4(n){return new Promise((e,t)=>{var r,s,i;function o(){sb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sb(),t(gr(n,"network-request-failed"))},timeout:b4.get()})}if(!((s=(r=Pn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Pn().gapi)===null||i===void 0)&&i.load)o();else{const a=BT("iframefcb");return Pn()[a]=()=>{gapi.load?o():t(gr(n,"network-request-failed"))},Cv(`${TM()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw sh=null,e})}let sh=null;function x4(n){return sh=sh||w4(n),sh}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I4=new Jc(5e3,15e3),E4="__/auth/iframe",T4="emulator/auth/iframe",A4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},S4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function P4(n){const e=n.config;be(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Pv(e,T4):`https://${n.config.authDomain}/${E4}`,r={apiKey:e.apiKey,appName:n.name,v:ga},s=S4.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ll(r).slice(1)}`}async function R4(n){const e=await x4(n),t=Pn().gapi;return be(t,n,"internal-error"),e.open({where:document.body,url:P4(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:A4,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=gr(n,"network-request-failed"),a=Pn().setTimeout(()=>{i(o)},I4.get());function l(){Pn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},k4=500,D4=600,N4="_blank",O4="http://localhost";class ib{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function V4(n,e,t,r=k4,s=D4){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},C4),{width:r.toString(),height:s.toString(),top:i,left:o}),c=On().toLowerCase();t&&(a=VT(c)?N4:t),NT(c)&&(e=e||O4,l.scrollbars="yes");const h=Object.entries(l).reduce((m,[v,w])=>`${m}${v}=${w},`,"");if(mM(c)&&a!=="_self")return M4(e||"",a),new ib(null);const f=window.open(e||"",a,h);be(f,n,"popup-blocked");try{f.focus()}catch{}return new ib(f)}function M4(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L4="__/auth/handler",$4="emulator/auth/handler",F4=encodeURIComponent("fac");async function ob(n,e,t,r,s,i){be(n.config.authDomain,n,"auth-domain-config-required"),be(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ga,eventId:s};if(e instanceof pi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",yR(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Yl){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${F4}=${encodeURIComponent(l)}`:"";return`${U4(n)}?${Ll(a).slice(1)}${c}`}function U4({config:n}){return n.emulator?Pv(n,$4):`https://${n.authDomain}/${L4}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Np="webStorageSupport";class j4{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=s1,this._completeRedirectFn=h1,this._overrideRedirectResult=l4}async _openPopup(e,t,r,s){var i;si((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await ob(e,t,r,Ec(),s);return V4(e,o,Df())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await ob(e,t,r,Ec(),s);return kL(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(si(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await R4(e),r=new f4(e);return t.register("authEvent",s=>(be(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Np,{type:Np},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Np];o!==void 0&&t(!!o),Pr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=y4(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return UT()||OT()||Rv()}}const B4=j4;class m1{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Es("unexpected MultiFactorSessionType")}}}class Bv extends m1{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Bv(e)}_finalizeEnroll(e,t,r){return IL(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return BL(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class q4{constructor(){}static assertion(e){return Bv._fromCredential(e)}}q4.FACTOR_ID="phone";class z4{static assertionForEnrollment(e,t){return Rc._fromSecret(e,t)}static assertionForSignIn(e,t){return Rc._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;be(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await EL(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return qv._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}z4.FACTOR_ID="totp";class Rc extends m1{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Rc(t,void 0,e)}static _fromEnrollmentId(e,t){return new Rc(t,e)}async _finalizeEnroll(e,t,r){return be(typeof this.secret<"u",e,"argument-error"),TL(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){be(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return qL(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class qv{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new qv(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Md(e)||Md(t))&&(s=!0),s&&(Md(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Md(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Md(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var ab="@firebase/auth",lb="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K4(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function G4(n){as(new Wr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;be(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:jT(n)},c=new wM(r,s,i,l);return CM(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),as(new Wr("auth-internal",e=>{const t=gn(e.getProvider("auth").getImmediate());return(r=>new H4(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Sr(ab,lb,K4(n)),Sr(ab,lb,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4=5*60,Q4=ix("authIdTokenMaxAge")||W4;let ub=null;const J4=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Q4)return;const s=t==null?void 0:t.token;ub!==s&&(ub=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function Y4(n=$l()){const e=li(n,"auth");if(e.isInitialized())return e.getImmediate();const t=RM(n,{popupRedirectResolver:B4,persistence:[UL,n1,s1]}),r=ix("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=J4(i.toString());_L(t,o,()=>o(t.currentUser)),yL(t,a=>o(a))}}const s=nx("auth");return s&&kM(t,`http://${s}`),t}function X4(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}xM({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=gr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",X4().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});G4("Browser");const Z4={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},zv=dx(Z4),ie=cO(zv),Hv=KV(zv),Ge=Y4(zv);try{dO(ie)}catch{}try{vL(Ge,n1)}catch{}bL(Ge,n=>{n||GT(Ge)});async function e3(n,e){try{return(await oL(Ge,n,e)).user}catch(t){throw t}}async function g1(n,e){try{return(await aL(Ge,n,e)).user}catch(t){throw t}}async function Kv(n){try{await rL(Ge,n)}catch(e){throw e}}async function t3(n){try{const e=Ge.currentUser;if(e)await dL(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Xi=Object.freeze(Object.defineProperty({__proto__:null,auth:Ge,createPlayerAccount:e3,db:ie,getMessaging:vg,resetPlayerPassword:Kv,signInPlayer:g1,storage:Hv,updatePlayerPassword:t3},Symbol.toStringTag,{value:"Module"})),Sm="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function v1(){try{return await $x()}catch{return!1}}async function y1(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function n3(n){var i;if(!await v1()||await Notification.requestPermission()!=="granted")return null;const t=vg($l());let r=n||await y1();const s=await Fx(t,r?{vapidKey:Sm,serviceWorkerRegistration:r}:{vapidKey:Sm});try{const o=((i=Ge==null?void 0:Ge.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await dn(Ee(ie,"userPushTokens",o),{tokens:NO(s),lastToken:s,email:o,updatedAt:ri(),userAgent:navigator.userAgent,lastActivation:ri()},{merge:!0})}catch{}return s}async function Qu(){try{const n=localStorage.getItem("fcmToken");if(n){const r=vg($l());try{const s=await Fx(r,{vapidKey:Sm});if(s===n)return{active:!0,token:s}}catch{}}const e=await y1(),t=await n3(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function r3(){setInterval(async()=>{try{const n=await Qu();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const s3={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},i3={class:"flex items-center space-x-3"},o3={key:0,class:"fixed bottom-4 left-4 right-4 z-[200] max-w-sm mx-auto"},a3={key:0,class:"fixed bottom-4 left-4 right-4 z-[200] max-w-sm mx-auto"},l3={__name:"App",setup(n){const e=R(null),t=R(!1),r=R(!1),s=R(!1),i=R(!1);function o(v){v.preventDefault(),e.value=v,t.value=!0;const w=localStorage.getItem("hatcast-pwa-banner-last-shown"),x=Date.now(),A=24*60*60*1e3;w&&x-parseInt(w)<A?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",x.toString())}async function a(){if(e.value){try{e.value.prompt();const{outcome:v}=await e.value.userChoice;v==="accepted"?(console.log("PWA installée avec succès"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refusée par l'utilisateur")}catch(v){console.error("Erreur lors de l'installation PWA:",v)}t.value=!1,e.value=null,i.value=!0}}function l(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function c(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function h(){const v=localStorage.getItem("hatcast-pwa-installed"),w=localStorage.getItem("hatcast-pwa-banner-dismissed");if(v==="true"){t.value=!1;return}if(w){const x=Date.now(),A=60*60*1e3;x-parseInt(w)<A&&(i.value=!0)}}function f(){s.value=!0,console.log("🚀 Début de la mise à jour PWA..."),setTimeout(async()=>{try{if(console.log("📡 Vérification du service worker..."),"serviceWorker"in navigator){const v=await navigator.serviceWorker.getRegistration();console.log("🔍 Enregistrement SW trouvé:",v),v&&v.active?(console.log("✅ Service worker actif trouvé, envoi du message SKIP_WAITING..."),v.active.postMessage({type:"SKIP_WAITING"}),console.log("📤 Message SKIP_WAITING envoyé"),await new Promise(w=>setTimeout(w,500)),console.log("⏳ Attente de 500ms terminée"),v.waiting?(console.log("🔄 Service worker en attente détecté, attente de l'activation..."),await new Promise(w=>{const x=()=>{v.waiting?(console.log("⏳ Service worker toujours en attente, nouvelle vérification dans 100ms..."),setTimeout(x,100)):(console.log("✅ Service worker activé avec succès"),w())};x()})):console.log("ℹ️ Aucun service worker en attente")):console.warn("⚠️ Aucun service worker actif trouvé")}else console.warn("⚠️ Service Worker non supporté sur cet appareil");console.log("🔄 Rechargement de la page..."),window.location.reload()}catch(v){console.error("❌ Erreur lors de la mise à jour:",v),s.value=!1,alert(`Erreur lors de la mise à jour: ${v.message}

Veuillez rafraîchir manuellement la page.`)}},1e3)}function m(){r.value=!0}return En(()=>{h(),Qu().then(v=>{v.active?console.log("Notifications push actives au démarrage"):console.log("Notifications push inactives au démarrage:",v.error)}),window.addEventListener("beforeinstallprompt",o),window.addEventListener("appinstalled",c),window.addEventListener("pwa-update-test",m),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",v=>{v.data&&v.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise à jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(v=>{v&&v.update()})},60*60*1e3))}),eg(()=>{window.removeEventListener("beforeinstallprompt",o),window.removeEventListener("appinstalled",c),window.removeEventListener("pwa-update-test",m)}),(v,w)=>{const x=SS("router-view");return N(),O(ft,null,[Ye(x),Ye(op,{name:"install-banner",appear:""},{default:Fd(()=>[t.value&&!i.value?(N(),O("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:a},[d("div",s3,[w[1]||(w[1]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:ZP,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure expérience ")])],-1)),d("div",i3,[d("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:pt(a,["stop"])}," Installer "),d("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:pt(l,["stop"]),"aria-label":"Fermer la barre d'installation"},w[0]||(w[0]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ae("",!0)]),_:1}),Ye(op,{name:"update-toast",appear:""},{default:Fd(()=>[r.value&&!s.value?(N(),O("div",o3,[d("div",{class:"bg-white rounded-lg shadow-lg border border-gray-200 p-4 flex items-center justify-between"},[w[3]||(w[3]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("div",{class:"w-8 h-8 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center flex-shrink-0"},[d("svg",{class:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])]),d("div",{class:"flex-1 min-w-0"},[d("p",{class:"text-sm font-medium text-gray-900 truncate"}," Nouvelle version disponible "),d("p",{class:"text-xs text-gray-500"}," Mise à jour rapide disponible ")])],-1)),d("button",{onClick:f,class:"ml-3 bg-green-600 hover:bg-green-700 text-white text-xs font-medium px-3 py-1.5 rounded-md transition-colors duration-200 flex items-center space-x-1"},w[2]||(w[2]=[d("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),d("span",null,"Mettre à jour",-1)]))])])):ae("",!0)]),_:1}),Ye(op,{name:"update-toast",appear:""},{default:Fd(()=>[s.value?(N(),O("div",a3,w[4]||(w[4]=[d("div",{class:"bg-blue-600 text-white rounded-lg shadow-lg p-4 flex items-center justify-between"},[d("div",{class:"flex items-center space-x-3 flex-1"},[d("div",{class:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center flex-shrink-0"},[d("svg",{class:"w-4 h-4 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])]),d("div",{class:"flex-1"},[d("p",{class:"text-sm font-medium"}," Mise à jour en cours... ")])])],-1)]))):ae("",!0)]),_:1})],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const el=typeof document<"u";function _1(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function u3(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&_1(n.default)}const Nt=Object.assign;function Op(n,e){const t={};for(const r in e){const s=e[r];t[r]=ls(s)?s.map(n):n(s)}return t}const Ju=()=>{},ls=Array.isArray,b1=/#/g,c3=/&/g,d3=/\//g,h3=/=/g,f3=/\?/g,w1=/\+/g,p3=/%5B/g,m3=/%5D/g,x1=/%5E/g,g3=/%60/g,I1=/%7B/g,v3=/%7C/g,E1=/%7D/g,y3=/%20/g;function Gv(n){return encodeURI(""+n).replace(v3,"|").replace(p3,"[").replace(m3,"]")}function _3(n){return Gv(n).replace(I1,"{").replace(E1,"}").replace(x1,"^")}function Pm(n){return Gv(n).replace(w1,"%2B").replace(y3,"+").replace(b1,"%23").replace(c3,"%26").replace(g3,"`").replace(I1,"{").replace(E1,"}").replace(x1,"^")}function b3(n){return Pm(n).replace(h3,"%3D")}function w3(n){return Gv(n).replace(b1,"%23").replace(f3,"%3F")}function x3(n){return n==null?"":w3(n).replace(d3,"%2F")}function Cc(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const I3=/\/$/,E3=n=>n.replace(I3,"");function Vp(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=P3(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Cc(o)}}function T3(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function cb(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function A3(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Ol(e.matched[r],t.matched[s])&&T1(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ol(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function T1(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!S3(n[t],e[t]))return!1;return!0}function S3(n,e){return ls(n)?db(n,e):ls(e)?db(e,n):n===e}function db(n,e){return ls(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function P3(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Ni={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var kc;(function(n){n.pop="pop",n.push="push"})(kc||(kc={}));var Yu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Yu||(Yu={}));function R3(n){if(!n)if(el){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),E3(n)}const C3=/^[^#]+#/;function k3(n,e){return n.replace(C3,"#")+e}function D3(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Vf=()=>({left:window.scrollX,top:window.scrollY});function N3(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=D3(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function hb(n,e){return(history.state?history.state.position-e:-1)+n}const Rm=new Map;function O3(n,e){Rm.set(n,e)}function V3(n){const e=Rm.get(n);return Rm.delete(n),e}let M3=()=>location.protocol+"//"+location.host;function A1(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),cb(l,"")}return cb(t,n)+r+s}function L3(n,e,t,r){let s=[],i=[],o=null;const a=({state:m})=>{const v=A1(n,location),w=t.value,x=e.value;let A=0;if(m){if(t.value=v,e.value=m,o&&o===w){o=null;return}A=x?m.position-x.position:0}else r(v);s.forEach(L=>{L(t.value,w,{delta:A,type:kc.pop,direction:A?A>0?Yu.forward:Yu.back:Yu.unknown})})};function l(){o=t.value}function c(m){s.push(m);const v=()=>{const w=s.indexOf(m);w>-1&&s.splice(w,1)};return i.push(v),v}function h(){const{history:m}=window;m.state&&m.replaceState(Nt({},m.state,{scroll:Vf()}),"")}function f(){for(const m of i)m();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function fb(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Vf():null}}function $3(n){const{history:e,location:t}=window,r={value:A1(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),m=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:M3()+n+l;try{e[h?"replaceState":"pushState"](c,"",m),s.value=c}catch(v){console.error(v),t[h?"replace":"assign"](m)}}function o(l,c){const h=Nt({},e.state,fb(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=Nt({},s.value,e.state,{forward:l,scroll:Vf()});i(h.current,h,!0);const f=Nt({},fb(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function F3(n){n=R3(n);const e=$3(n),t=L3(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Nt({location:"",base:n,go:r,createHref:k3.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function U3(n){return typeof n=="string"||n&&typeof n=="object"}function S1(n){return typeof n=="string"||typeof n=="symbol"}const P1=Symbol("");var pb;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(pb||(pb={}));function Vl(n,e){return Nt(new Error,{type:n,[P1]:!0},e)}function Ms(n,e){return n instanceof Error&&P1 in n&&(e==null||!!(n.type&e))}const mb="[^/]+?",j3={sensitive:!1,strict:!1,start:!0,end:!0},B3=/[.+*?^${}()[\]/\\]/g;function q3(n,e){const t=Nt({},j3,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const m=c[f];let v=40+(t.sensitive?.25:0);if(m.type===0)f||(s+="/"),s+=m.value.replace(B3,"\\$&"),v+=40;else if(m.type===1){const{value:w,repeatable:x,optional:A,regexp:L}=m;i.push({name:w,repeatable:x,optional:A});const F=L||mb;if(F!==mb){v+=10;try{new RegExp(`(${F})`)}catch(B){throw new Error(`Invalid custom RegExp for param "${w}" (${F}): `+B.message)}}let $=x?`((?:${F})(?:/(?:${F}))*)`:`(${F})`;f||($=A&&c.length<2?`(?:/${$})`:"/"+$),A&&($+="?"),s+=$,v+=20,A&&(v+=-8),x&&(v+=-20),F===".*"&&(v+=-50)}h.push(v)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let m=1;m<h.length;m++){const v=h[m]||"",w=i[m-1];f[w.name]=v&&w.repeatable?v.split("/"):v}return f}function l(c){let h="",f=!1;for(const m of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const v of m)if(v.type===0)h+=v.value;else if(v.type===1){const{value:w,repeatable:x,optional:A}=v,L=w in c?c[w]:"";if(ls(L)&&!x)throw new Error(`Provided param "${w}" is an array but it is not repeatable (* or + modifiers)`);const F=ls(L)?L.join("/"):L;if(!F)if(A)m.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${w}"`);h+=F}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function z3(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function R1(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=z3(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(gb(r))return 1;if(gb(s))return-1}return s.length-r.length}function gb(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const H3={type:0,value:""},K3=/[a-zA-Z0-9_]/;function G3(n){if(!n)return[[]];if(n==="/")return[[H3]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${c}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function m(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):m();break;case 4:m(),t=r;break;case 1:l==="("?t=2:K3.test(l)?m():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function W3(n,e,t){const r=q3(G3(n.path),t),s=Nt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function Q3(n,e){const t=[],r=new Map;e=bb({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,m,v){const w=!v,x=yb(f);x.aliasOf=v&&v.record;const A=bb(e,f),L=[x];if("alias"in f){const B=typeof f.alias=="string"?[f.alias]:f.alias;for(const ne of B)L.push(yb(Nt({},x,{components:v?v.record.components:x.components,path:ne,aliasOf:v?v.record:x})))}let F,$;for(const B of L){const{path:ne}=B;if(m&&ne[0]!=="/"){const re=m.record.path,T=re[re.length-1]==="/"?"":"/";B.path=m.record.path+(ne&&T+ne)}if(F=W3(B,m,A),v?v.alias.push(F):($=$||F,$!==F&&$.alias.push(F),w&&f.name&&!_b(F)&&o(f.name)),C1(F)&&l(F),x.children){const re=x.children;for(let T=0;T<re.length;T++)i(re[T],F,v&&v.children[T])}v=v||F}return $?()=>{o($)}:Ju}function o(f){if(S1(f)){const m=r.get(f);m&&(r.delete(f),t.splice(t.indexOf(m),1),m.children.forEach(o),m.alias.forEach(o))}else{const m=t.indexOf(f);m>-1&&(t.splice(m,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const m=X3(f,t);t.splice(m,0,f),f.record.name&&!_b(f)&&r.set(f.record.name,f)}function c(f,m){let v,w={},x,A;if("name"in f&&f.name){if(v=r.get(f.name),!v)throw Vl(1,{location:f});A=v.record.name,w=Nt(vb(m.params,v.keys.filter($=>!$.optional).concat(v.parent?v.parent.keys.filter($=>$.optional):[]).map($=>$.name)),f.params&&vb(f.params,v.keys.map($=>$.name))),x=v.stringify(w)}else if(f.path!=null)x=f.path,v=t.find($=>$.re.test(x)),v&&(w=v.parse(x),A=v.record.name);else{if(v=m.name?r.get(m.name):t.find($=>$.re.test(m.path)),!v)throw Vl(1,{location:f,currentLocation:m});A=v.record.name,w=Nt({},m.params,f.params),x=v.stringify(w)}const L=[];let F=v;for(;F;)L.unshift(F.record),F=F.parent;return{name:A,path:x,params:w,matched:L,meta:Y3(L)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function vb(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function yb(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:J3(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function J3(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function _b(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function Y3(n){return n.reduce((e,t)=>Nt(e,t.meta),{})}function bb(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function X3(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;R1(n,e[i])<0?r=i:t=i+1}const s=Z3(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function Z3(n){let e=n;for(;e=e.parent;)if(C1(e)&&R1(n,e)===0)return e}function C1({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function e$(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(w1," "),o=i.indexOf("="),a=Cc(o<0?i:i.slice(0,o)),l=o<0?null:Cc(i.slice(o+1));if(a in e){let c=e[a];ls(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function wb(n){let e="";for(let t in n){const r=n[t];if(t=b3(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(ls(r)?r.map(i=>i&&Pm(i)):[r&&Pm(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function t$(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=ls(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const n$=Symbol(""),xb=Symbol(""),Mf=Symbol(""),Wv=Symbol(""),Cm=Symbol("");function Eu(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Li(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=m=>{m===!1?l(Vl(4,{from:t,to:e})):m instanceof Error?l(m):U3(m)?l(Vl(2,{from:e,to:m})):(o&&r.enterCallbacks[s]===o&&typeof m=="function"&&o.push(m),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(m=>l(m))})}function Mp(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(_1(l)){const h=(l.__vccOpts||l)[e];h&&i.push(Li(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=u3(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const v=(f.__vccOpts||f)[e];return v&&Li(v,t,r,o,a,s)()}))}}return i}function Ib(n){const e=ss(Mf),t=ss(Wv),r=Ue(()=>{const l=rs(n.to);return e.resolve(l)}),s=Ue(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const m=f.findIndex(Ol.bind(null,h));if(m>-1)return m;const v=Eb(l[c-2]);return c>1&&Eb(h)===v&&f[f.length-1].path!==v?f.findIndex(Ol.bind(null,l[c-2])):m}),i=Ue(()=>s.value>-1&&a$(t.params,r.value.params)),o=Ue(()=>s.value>-1&&s.value===t.matched.length-1&&T1(t.params,r.value.params));function a(l={}){if(o$(l)){const c=e[rs(n.replace)?"replace":"push"](rs(n.to)).catch(Ju);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Ue(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function r$(n){return n.length===1?n[0]:n}const s$=Tw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Ib,setup(n,{slots:e}){const t=zh(Ib(n)),{options:r}=ss(Mf),s=Ue(()=>({[Tb(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Tb(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&r$(e.default(t));return n.custom?i:og("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),i$=s$;function o$(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function a$(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!ls(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function Eb(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Tb=(n,e,t)=>n??e??t,l$=Tw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=ss(Cm),s=Ue(()=>n.route||r.value),i=ss(xb,0),o=Ue(()=>{let c=rs(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=Ue(()=>s.value.matched[o.value]);jd(xb,Ue(()=>o.value+1)),jd(n$,a),jd(Cm,s);const l=R();return Rt(()=>[l.value,a.value,n.name],([c,h,f],[m,v,w])=>{h&&(h.instances[f]=c,v&&v!==h&&c&&c===m&&(h.leaveGuards.size||(h.leaveGuards=v.leaveGuards),h.updateGuards.size||(h.updateGuards=v.updateGuards))),c&&h&&(!v||!Ol(h,v)||!m)&&(h.enterCallbacks[f]||[]).forEach(x=>x(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,m=f&&f.components[h];if(!m)return Ab(t.default,{Component:m,route:c});const v=f.props[h],w=v?v===!0?c.params:typeof v=="function"?v(c):v:null,A=og(m,Nt({},w,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return Ab(t.default,{Component:A,route:c})||A}}});function Ab(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const u$=l$;function c$(n){const e=Q3(n.routes,n),t=n.parseQuery||e$,r=n.stringifyQuery||wb,s=n.history,i=Eu(),o=Eu(),a=Eu(),l=rS(Ni);let c=Ni;el&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Op.bind(null,J=>""+J),f=Op.bind(null,x3),m=Op.bind(null,Cc);function v(J,xe){let ve,De;return S1(J)?(ve=e.getRecordMatcher(J),De=xe):De=J,e.addRoute(De,ve)}function w(J){const xe=e.getRecordMatcher(J);xe&&e.removeRoute(xe)}function x(){return e.getRoutes().map(J=>J.record)}function A(J){return!!e.getRecordMatcher(J)}function L(J,xe){if(xe=Nt({},xe||l.value),typeof J=="string"){const V=Vp(t,J,xe.path),H=e.resolve({path:V.path},xe),K=s.createHref(V.fullPath);return Nt(V,H,{params:m(H.params),hash:Cc(V.hash),redirectedFrom:void 0,href:K})}let ve;if(J.path!=null)ve=Nt({},J,{path:Vp(t,J.path,xe.path).path});else{const V=Nt({},J.params);for(const H in V)V[H]==null&&delete V[H];ve=Nt({},J,{params:f(V)}),xe.params=f(xe.params)}const De=e.resolve(ve,xe),it=J.hash||"";De.params=h(m(De.params));const gt=T3(r,Nt({},J,{hash:_3(it),path:De.path})),C=s.createHref(gt);return Nt({fullPath:gt,hash:it,query:r===wb?t$(J.query):J.query||{}},De,{redirectedFrom:void 0,href:C})}function F(J){return typeof J=="string"?Vp(t,J,l.value.path):Nt({},J)}function $(J,xe){if(c!==J)return Vl(8,{from:xe,to:J})}function B(J){return T(J)}function ne(J){return B(Nt(F(J),{replace:!0}))}function re(J){const xe=J.matched[J.matched.length-1];if(xe&&xe.redirect){const{redirect:ve}=xe;let De=typeof ve=="function"?ve(J):ve;return typeof De=="string"&&(De=De.includes("?")||De.includes("#")?De=F(De):{path:De},De.params={}),Nt({query:J.query,hash:J.hash,params:De.path!=null?{}:J.params},De)}}function T(J,xe){const ve=c=L(J),De=l.value,it=J.state,gt=J.force,C=J.replace===!0,V=re(ve);if(V)return T(Nt(F(V),{state:typeof V=="object"?Nt({},it,V.state):it,force:gt,replace:C}),xe||ve);const H=ve;H.redirectedFrom=xe;let K;return!gt&&A3(r,De,ve)&&(K=Vl(16,{to:H,from:De}),oe(De,De,!0,!1)),(K?Promise.resolve(K):k(H,De)).catch(X=>Ms(X)?Ms(X,2)?X:Je(X):_e(X,H,De)).then(X=>{if(X){if(Ms(X,2))return T(Nt({replace:C},F(X.to),{state:typeof X.to=="object"?Nt({},it,X.to.state):it,force:gt}),xe||H)}else X=S(H,De,!0,C,it);return D(H,De,X),X})}function _(J,xe){const ve=$(J,xe);return ve?Promise.reject(ve):Promise.resolve()}function E(J){const xe=ut.values().next().value;return xe&&typeof xe.runWithContext=="function"?xe.runWithContext(J):J()}function k(J,xe){let ve;const[De,it,gt]=d$(J,xe);ve=Mp(De.reverse(),"beforeRouteLeave",J,xe);for(const V of De)V.leaveGuards.forEach(H=>{ve.push(Li(H,J,xe))});const C=_.bind(null,J,xe);return ve.push(C),Yt(ve).then(()=>{ve=[];for(const V of i.list())ve.push(Li(V,J,xe));return ve.push(C),Yt(ve)}).then(()=>{ve=Mp(it,"beforeRouteUpdate",J,xe);for(const V of it)V.updateGuards.forEach(H=>{ve.push(Li(H,J,xe))});return ve.push(C),Yt(ve)}).then(()=>{ve=[];for(const V of gt)if(V.beforeEnter)if(ls(V.beforeEnter))for(const H of V.beforeEnter)ve.push(Li(H,J,xe));else ve.push(Li(V.beforeEnter,J,xe));return ve.push(C),Yt(ve)}).then(()=>(J.matched.forEach(V=>V.enterCallbacks={}),ve=Mp(gt,"beforeRouteEnter",J,xe,E),ve.push(C),Yt(ve))).then(()=>{ve=[];for(const V of o.list())ve.push(Li(V,J,xe));return ve.push(C),Yt(ve)}).catch(V=>Ms(V,8)?V:Promise.reject(V))}function D(J,xe,ve){a.list().forEach(De=>E(()=>De(J,xe,ve)))}function S(J,xe,ve,De,it){const gt=$(J,xe);if(gt)return gt;const C=xe===Ni,V=el?history.state:{};ve&&(De||C?s.replace(J.fullPath,Nt({scroll:C&&V&&V.scroll},it)):s.push(J.fullPath,it)),l.value=J,oe(J,xe,ve,C),Je()}let P;function ke(){P||(P=s.listen((J,xe,ve)=>{if(!At.listening)return;const De=L(J),it=re(De);if(it){T(Nt(it,{replace:!0,force:!0}),De).catch(Ju);return}c=De;const gt=l.value;el&&O3(hb(gt.fullPath,ve.delta),Vf()),k(De,gt).catch(C=>Ms(C,12)?C:Ms(C,2)?(T(Nt(F(C.to),{force:!0}),De).then(V=>{Ms(V,20)&&!ve.delta&&ve.type===kc.pop&&s.go(-1,!1)}).catch(Ju),Promise.reject()):(ve.delta&&s.go(-ve.delta,!1),_e(C,De,gt))).then(C=>{C=C||S(De,gt,!1),C&&(ve.delta&&!Ms(C,8)?s.go(-ve.delta,!1):ve.type===kc.pop&&Ms(C,20)&&s.go(-1,!1)),D(De,gt,C)}).catch(Ju)}))}let Re=Eu(),Pe=Eu(),Ce;function _e(J,xe,ve){Je(J);const De=Pe.list();return De.length?De.forEach(it=>it(J,xe,ve)):console.error(J),Promise.reject(J)}function le(){return Ce&&l.value!==Ni?Promise.resolve():new Promise((J,xe)=>{Re.add([J,xe])})}function Je(J){return Ce||(Ce=!J,ke(),Re.list().forEach(([xe,ve])=>J?ve(J):xe()),Re.reset()),J}function oe(J,xe,ve,De){const{scrollBehavior:it}=n;if(!el||!it)return Promise.resolve();const gt=!ve&&V3(hb(J.fullPath,0))||(De||!ve)&&history.state&&history.state.scroll||null;return Zt().then(()=>it(J,xe,gt)).then(C=>C&&N3(C)).catch(C=>_e(C,J,xe))}const Z=J=>s.go(J);let Le;const ut=new Set,At={currentRoute:l,listening:!0,addRoute:v,removeRoute:w,clearRoutes:e.clearRoutes,hasRoute:A,getRoutes:x,resolve:L,options:n,push:B,replace:ne,go:Z,back:()=>Z(-1),forward:()=>Z(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Pe.add,isReady:le,install(J){const xe=this;J.component("RouterLink",i$),J.component("RouterView",u$),J.config.globalProperties.$router=xe,Object.defineProperty(J.config.globalProperties,"$route",{enumerable:!0,get:()=>rs(l)}),el&&!Le&&l.value===Ni&&(Le=!0,B(s.location).catch(it=>{}));const ve={};for(const it in Ni)Object.defineProperty(ve,it,{get:()=>l.value[it],enumerable:!0});J.provide(Mf,xe),J.provide(Wv,aw(ve)),J.provide(Cm,l);const De=J.unmount;ut.add(J),J.unmount=function(){ut.delete(J),ut.size<1&&(c=Ni,P&&P(),P=null,l.value=Ni,Le=!1,Ce=!1),De()}}};function Yt(J){return J.reduce((xe,ve)=>xe.then(()=>E(ve)),Promise.resolve())}return At}function d$(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Ol(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Ol(c,l))||s.push(l))}return[t,r,s]}function Xl(){return ss(Mf)}function Ea(n){return ss(Wv)}const h$="modulepreload",f$=function(n){return"/"+n},Sb={},on=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=f$(i),i in Sb)return;Sb[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":h$,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function p$(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await on(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),a.addEventListener("installed",m=>{m.isUpdate||r==null||r()}),a.register({immediate:e}).then(m=>{i?i("/service-worker.js",m):s==null||s(m)}).catch(m=>{o==null||o(m)})}}return l=h(),c}const Ta="seasons";async function m$(n,e,t,r="",s=""){return await Ql(st(ie,Ta),{name:n,slug:e,pinCode:t,description:r,logoUrl:s,createdAt:ri()})}async function g$(n){return await Nl(Ee(ie,Ta,n))}async function tl(){const n=Ic(st(ie,Ta),yO("createdAt","desc"));return(await Vt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Vh(n,e){const t=await Kt(Ee(ie,Ta,n));return t.exists()?t.data().pinCode===e:!1}async function km(n){const e=await Kt(Ee(ie,Ta,n));return e.exists()?e.data().pinCode:null}async function Tu(n,e){const t=Ee(ie,Ta,n);await wa(t,{sortOrder:e})}async function v$(n,e){const t=Ee(ie,Ta,n);await wa(t,e)}const y$=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function _$(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function k1(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function b$(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function D1(n){if(!n)return!1;const e=String(n).toLowerCase();return y$.some(t=>e.includes(t.toLowerCase()))}function Dm(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?b$(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Dm(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=D1(t)?"••••":Dm(r);return e}return n}function w$(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&D1(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Dm(r))}return e}const x$=k1(_$());function Ld(n,e){const t=k1(n);return(...r)=>{if(t<x$)return;const s=w$(r);console[e](...s)}}const U={debug:Ld("debug","log"),info:Ld("info","info"),warn:Ld("warn","warn"),error:Ld("error","error")},Qv="lastVisitedSeason",N1="lastVisitedSeasonTimestamp";async function I$(n){if(n)try{const e=Ge.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(Qv,n),localStorage.setItem(N1,Date.now().toString())}catch(r){U.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=Ee(ie,"userPreferences",t);await dn(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),U.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){U.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){U.error("Erreur lors de la mémorisation de la saison",e)}}async function O1(){try{const n=Ge.currentUser,e=n==null?void 0:n.email;if(e)try{const t=Ee(ie,"userPreferences",e),r=await Kt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return U.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){U.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(Qv);if(t)return U.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){U.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return U.error("Erreur lors de la récupération de la dernière saison",n),null}}async function E$(n=null){var e;try{const t=n||((e=Ge.currentUser)==null?void 0:e.email);try{localStorage.removeItem(Qv),localStorage.removeItem(N1)}catch(r){U.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=Ee(ie,"userPreferences",t);await dn(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),U.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){U.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){U.error("Erreur lors du nettoyage des préférences",t)}}function T$(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const Ys=R(null),Qi=R(!1),js=R(!1),A$=Ue(()=>{var n;return!!Ys.value&&!((n=Ys.value)!=null&&n.isAnonymous)});Ue(()=>!!Ys.value);function ml(){var n;try{const e=Ge.currentUser;e!==Ys.value&&(Ys.value=e,U.debug("Synchronisation forcée de l'état d'authentification",{user:((n=Ys.value)==null?void 0:n.email)||"non connecté"}))}catch(e){U.error("Erreur lors de la synchronisation forcée",e)}}function S$(){var n;if(U.debug("Tentative d'initialisation du service d'authentification",{isInitialized:Qi.value,isInitializing:js.value}),Qi.value||js.value){U.debug("Service déjà initialisé ou en cours d'initialisation, sortie");return}js.value=!0,U.debug("Marquage du service comme en cours d'initialisation");try{Ys.value=Ge.currentUser,U.debug("État initial de l'utilisateur:",((n=Ys.value)==null?void 0:n.email)||"non connecté");const e=Ge.onAuthStateChanged(t=>{Ys.value=t,Qi.value=!0,js.value=!1,U.debug("État d'authentification changé",{isLoggedIn:!!t,email:(t==null?void 0:t.email)||"non connecté"})});window._authStateUnsubscribe=e,U.info("Service d'état d'authentification initialisé avec succès")}catch(e){U.error("Erreur lors de l'initialisation du service d'authentification:",e),js.value=!1}}function V1(){return new Promise((n,e)=>{if(U.debug("waitForInitialization appelé",{isInitialized:Qi.value,isInitializing:js.value}),Qi.value){U.debug("Service déjà initialisé, résolution immédiate"),n();return}if(!js.value){U.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{U.debug("Vérification de l'initialisation...",{isInitialized:Qi.value,isInitializing:js.value}),Qi.value&&(clearInterval(t),U.debug("Service initialisé, résolution"),n())},100);setTimeout(()=>{clearInterval(t),U.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function P$(){U.debug("Initialisation forcée demandée"),!Qi.value&&!js.value&&Mh()}function Mh(){if(U.debug("Tentative d'auto-initialisation du service d'authentification"),typeof Ge>"u"||!Ge){U.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(Mh,500);return}try{S$()}catch(n){U.error("Erreur lors de l'auto-initialisation:",n),setTimeout(Mh,1e3)}}setTimeout(Mh,100);const R$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},C$={class:"text-center"},k$={class:"text-white text-lg"},D$={__name:"SeasonResolver",setup(n){const e=Xl(),t=R("Chargement...");return En(async()=>{try{t.value="Vérification de votre session...",ml(),await V1();const r=await new Promise((o,a)=>{const l=setTimeout(()=>{a(new Error("Timeout Firebase Auth"))},3e3),c=Ge.onAuthStateChanged(h=>{clearTimeout(l),c(),o(h)});Ge.currentUser&&(clearTimeout(l),c(),o(Ge.currentUser))}),s=r==null?void 0:r.email;if(!s){U.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const i=await O1();if(!i){U.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const o=await tl();if(!T$(i,o)){U.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await E$(s),e.replace("/seasons");return}}catch(o){U.error("Erreur lors de la vérification des saisons",o),e.replace("/seasons");return}U.info("Redirection vers la saison mémorisée",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){U.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(N(),O("div",R$,[d("div",C$,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",k$,te(t.value),1)])]))}},Nm="/logos/hatcast-mask.png",Om="/logos/hatcast-logo-mobile.png";async function N$(n,e=800,t=800,r=.8){return new Promise((s,i)=>{const o=document.createElement("canvas"),a=o.getContext("2d"),l=new Image;l.onload=()=>{let{width:c,height:h}=l;c>e&&(h=h*e/c,c=e),h>t&&(c=c*t/h,h=t),o.width=c,o.height=h,a.drawImage(l,0,0,c,h),o.toBlob(f=>{if(f){const m=new File([f],n.name,{type:"image/jpeg",lastModified:Date.now()});s(m)}else i(new Error("Erreur lors du redimensionnement"))},"image/jpeg",r)},l.onerror=()=>i(new Error("Erreur lors du chargement de l'image")),l.src=URL.createObjectURL(n)})}async function M1(){if(!Ge.currentUser){U.info("Aucun utilisateur connecté, tentative de connexion anonyme...");try{await GT(Ge),U.info("Connexion anonyme réussie")}catch(n){throw U.error("Erreur lors de la connexion anonyme:",n),new Error("Impossible de s'authentifier: "+n.message)}}await new Promise(n=>setTimeout(n,1e3))}async function O$(n,e,t={}){var r;try{if(U.info("Début upload image",{fileName:n.name,path:e,originalSize:`${(n.size/1024/1024).toFixed(2)}MB`}),await M1(),!n.type.startsWith("image/"))throw new Error("Le fichier doit être une image");if(n.size>10*1024*1024)throw new Error("L'image est trop volumineuse (max 10MB)");let s=n;if(t.resize!==!1&&(n.size>1024*1024||t.forceResize)){U.info("Redimensionnement de l'image pour optimiser les performances...");try{s=await N$(n,t.maxWidth||800,t.maxHeight||800,t.quality||.8),U.info("Image redimensionnée",{newSize:`${(s.size/1024/1024).toFixed(2)}MB`,compression:`${((1-s.size/n.size)*100).toFixed(1)}%`})}catch(w){U.warn("Erreur lors du redimensionnement, utilisation du fichier original:",w),s=n}}const a=`${Date.now()}_${n.name}`,l=`${e}/${a}`,c=xT(Hv,l);U.info("Tentative d'upload vers Firebase Storage...",{fullPath:l,user:(r=Ge.currentUser)==null?void 0:r.uid,isAuthenticated:!!Ge.currentUser,finalSize:`${(s.size/1024/1024).toFixed(2)}MB`});const h=qV(c,s),f=new Promise((w,x)=>setTimeout(()=>x(new Error("Timeout: Upload trop long")),3e4)),m=await Promise.race([h,f]);U.info("Image uploadée avec succès",{fullPath:l});const v=await zV(m.ref);return U.info("URL de téléchargement récupérée",{downloadURL:v}),v}catch(s){if(U.error("Erreur lors de l'upload de l'image",s),s.message.includes("CORS")||s.message.includes("preflight")||s.message.includes("permission")||s.message.includes("unauthenticated")||s.message.includes("ERR_FAILED")||s.message.includes("Timeout"))return U.warn("Erreur d'accès détectée, utilisation du stockage local temporaire",s.message),await V$(n,e);throw s}}async function V$(n,e){return new Promise((t,r)=>{const s=new FileReader;s.onload=i=>{const o=i.target.result;U.info("Image stockée localement en base64",{path:e}),t(o)},s.onerror=()=>r(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(n)})}async function M$(n){var e;try{if(U.info("Début suppression image",{imageUrl:n}),n.startsWith("data:image/")){U.info("Image locale (base64), suppression ignorée");return}await M1();const r=(e=new URL(n).pathname.split("/o/")[1])==null?void 0:e.split("?")[0];if(!r)throw new Error("Impossible d'extraire le chemin de l'image");const s=decodeURIComponent(r),i=xT(Hv,s);await HV(i),U.info("Image supprimée avec succès",{decodedPath:s})}catch(t){throw U.error("Erreur lors de la suppression de l'image",t),t}}function L$(n){return n&&n.includes("firebasestorage.googleapis.com")}const Lp=7*24*60*60*1e3,Au="hatcast_pin_session";class $${constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Au);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Lp){try{t.timestamp=Date.now(),localStorage.setItem(Au,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Au,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Lp;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Au,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Au),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Lp-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Gn=new $$,F$={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},U$={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},j$={class:"text-center mb-6"},B$={class:"text-gray-300"},q$={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},z$={class:"text-sm text-green-400"},H$={class:"mb-6"},K$={class:"mb-4"},G$={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},W$={class:"flex justify-end space-x-3"},Q$=["disabled"],L1={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=R(""),i=R(""),o=R(null);Rt(()=>t.show,h=>{h&&(s.value="",i.value="",Zt(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(N(),O("div",F$,[d("div",U$,[d("div",j$,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",B$,te(n.message),1),n.sessionInfo?(N(),O("div",q$,[d("p",z$," Session active : "+te(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ae("",!0)]),d("div",H$,[d("div",K$,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),lt(d("input",{"onUpdate:modelValue":f[0]||(f[0]=m=>s.value=m),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[rr(l,["enter"]),rr(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Mt,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(N(),O("div",G$,te(i.value||t.error),1)):ae("",!0),d("div",W$,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,Q$)])])])):ae("",!0)}},Pb="hatcast_trusted_players",Rb=180*24*60*60*1e3;class J${constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(Pb);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(Pb,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<Rb;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>Rb&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const ho=new J$,Y$={class:"mt-4"},X$={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},$1={__name:"AccountBenefitsHint",setup(n){const e=R(!1);return(t,r)=>(N(),O("div",Y$,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),d("span",{class:wn(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(N(),O("div",X$,r[2]||(r[2]=[d("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),d("div",null,[_t("• "),d("span",{class:"text-blue-300"},"Protégez vos saisies :"),_t(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),d("div",null,[_t("• "),d("span",{class:"text-blue-300"},"Notifications :"),_t(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),d("div",null,[_t("• "),d("span",{class:"text-blue-300"},"Saisie simplifiée :"),_t(" votre joueur reste toujours en haut de la liste")],-1)]))):ae("",!0)]))}},Z$={class:"space-y-4"},eF={class:"flex items-center justify-between"},tF={class:"flex items-center gap-2 text-gray-300 text-sm"},nF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},rF={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},sF={class:"flex justify-center gap-3 mt-2"},iF=["disabled"],oF={key:0,class:"animate-spin"},aF={key:1},F1={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=R(""),s=R(""),i=R(!1),o=R(""),a=R(""),l=R(!0),c=Ue(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await g1(r.value.trim(),s.value),l.value)try{ho.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await Kv(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(m,v)=>n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:v[6]||(v[6]=w=>m.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[5]||(v[5]=pt(()=>{},["stop"]))},[d("button",{onClick:v[0]||(v[0]=w=>m.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),v[10]||(v[10]=Nn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",Z$,[Ye($1),d("div",null,[v[7]||(v[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),lt(d("input",{"onUpdate:modelValue":v[1]||(v[1]=w=>r.value=w),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Mt,r.value]])]),d("div",null,[v[8]||(v[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),lt(d("input",{"onUpdate:modelValue":v[2]||(v[2]=w=>s.value=w),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Mt,s.value]])]),d("div",eF,[d("label",tF,[lt(d("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=w=>l.value=w),class:"w-4 h-4"},null,512),[[Gi,l.value]]),v[9]||(v[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(N(),O("div",nF,te(o.value),1)):ae("",!0),a.value?(N(),O("div",rF,te(a.value),1)):ae("",!0),d("div",sF,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(N(),O("span",oF,"⏳")):(N(),O("span",aF,"Se connecter"))],8,iF),d("button",{onClick:v[4]||(v[4]=w=>m.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ae("",!0)}},Lf="magicLinks";function $f({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Jv(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Vm({seasonId:n,playerId:e,eventId:t,action:r}){const s=$f({seasonId:n,playerId:e,eventId:t,action:r}),i=Jv(40),o=Ee(ie,Lf,s),a=Date.now()+1e3*60*60*24*7;await dn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function U1({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=$f({seasonId:n,playerId:e,eventId:r,action:s}),o=Jv(40),a=Ee(ie,Lf,i),l=Date.now()+1e3*60*60*24*7;await dn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function j1({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=$f({seasonId:n,playerId:e,eventId:t,action:s}),o=Ee(ie,Lf,i),a=await Kt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Mm({seasonId:n,playerId:e,eventId:t,action:r}){const s=$f({seasonId:n,playerId:e,eventId:t,action:r}),i=Ee(ie,Lf,s);await Nl(i)}const Yv="accountMagicLinks";function Ff(n){return`account__${n}`}async function B1({currentEmail:n,newEmail:e}){const t=Jv(40),r=Ff(t),s=Ee(ie,Yv,r),i=Date.now()+1e3*60*60*24*7;await dn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function q1({token:n}){const e=Ff(n),t=Ee(ie,Yv,e),r=await Kt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function z1({token:n}){const e=Ff(n),t=Ee(ie,Yv,e);await Nl(t)}const lF=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Ff,consumeAccountEmailUpdateLink:z1,consumeMagicLink:Mm,createAccountEmailUpdateLink:B1,createEmailVerificationLink:U1,createMagicLink:Vm,verifyAccountEmailUpdateLink:q1,verifyMagicLink:j1},Symbol.toStringTag,{value:"Module"}));async function nd({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:ri()};return await Ql(st(ie,"pushQueue"),i),{success:!0}}function H1({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>tous</strong>"}, es-tu dispo le ${t} pour <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a> ?</p>
      <p style="margin-top: 12px; text-align: center;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails : <a href="${r}" style="color:#3b82f6;text-decoration:underline;">${r}</a></p>
    </div>
  `}function uF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${n?`<strong>${n}</strong>`:"<strong>tous</strong>"}, tu fais partie de l'équipe pour <a href="${r}" style="color:#8b5cf6;text-decoration:underline;font-weight:600;">${e}</a> (${t}).</p>
      <p>Un imprévu ? Signales-le 👇</p>
      <p style="margin-top: 8px; text-align: center;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Je ne suis plus disponible</a>
      </p>
    </div>
  `}function cF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>Bonjour ${n}</strong>`:"<strong>Bonjour</strong>"}, tu n'as pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
      <p style="margin-top: 8px; font-weight: 600;">${e}</p>
      <p style="color:#374151;">${t}</p>
      <p style="margin-top: 8px;">Lien direct : ${r}</p>
    </div>
  `}function dF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`${n}`:"tous"}, es-tu dispo le ${t} pour ${e} ?

✅ Dispo ❌ Pas dispo

Lien direct : ${r}`}function hF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`Bonjour ${n}`:"Bonjour tous"},

Tu fais partie de l'équipe pour ${e} (${t}).

Un imprévu ?

❌ Je ne suis plus disponible

Lien direct: ${r}`}const fF="HatCast <impropick@gmail.com>",pF="impropick@gmail.com";function Uf(n=null){return{from:n||fF,replyTo:n||pF}}async function mF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=Ee(ie,"userPreferences",n),w=await Kt(v);if(w.exists()){const x=w.data();if((x==null?void 0:x.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=H1({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:ri(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},m=Uf(l);f.from=m.from,f.replyTo=m.replyTo,await Ql(st(ie,"mail"),f);try{const v=Ee(ie,"userPreferences",n),w=await Kt(v),x=w.exists()?w.data():{};if((x==null?void 0:x.notifyAvailabilityPush)!==!1){const A=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,L=`${e}, t'es dispo ?`;await nd({toEmail:n,title:A,body:L,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function K1({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,m={to:n,message:{subject:h,html:f},createdAt:ri(),meta:{reason:t,displayName:r}},v=Uf(s);m.from=v.from,m.replyTo=v.replyTo,await Ql(st(ie,"mail"),m)}async function gF({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return K1({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function vF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0}){try{const v=Ee(ie,"userPreferences",n),w=await Kt(v);if(w.exists()){const x=w.data();if((x==null?void 0:x.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}U.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const c=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,h=o||`🎭 Sélection confirmée · ${t}`;U.debug("queueSelectionEmail html/subject ready");const f={to:n,message:{subject:h,html:c},createdAt:ri(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},m=Uf(a);f.from=m.from,f.replyTo=m.replyTo,U.debug("queueSelectionEmail firestore payload ready");try{await Ql(st(ie,"mail"),f);try{const v=Ee(ie,"userPreferences",n),w=await Kt(v),x=w.exists()?w.data():{};console.log("Préférences utilisateur pour notifications push",{toEmail:n,prefs:x,notifySelectionPush:x==null?void 0:x.notifySelectionPush,shouldSendPush:(x==null?void 0:x.notifySelectionPush)!==!1}),(x==null?void 0:x.notifySelectionPush)!==!1?(console.log("Envoi notification push de sélection",{toEmail:n,playerName:e,eventTitle:t}),await nd({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin,noUrl:l},reason:"selection"}),console.log("Notification push de sélection envoyée avec succès")):console.log("Notification push de sélection désactivée par préférences utilisateur")}catch(v){console.error("Erreur lors de l'envoi de la notification push de sélection",v)}return U.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(v){throw U.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:v}),v}}async function yF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const w=Ee(ie,"userPreferences",n),x=await Kt(w);if(x.exists()){const A=x.data();if((A==null?void 0:A.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,m={to:n,message:{subject:f,html:h},createdAt:ri(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=Uf(l);m.from=v.from,m.replyTo=v.replyTo,await Ql(st(ie,"mail"),m);try{const w=Ee(ie,"userPreferences",n),x=await Kt(w),A=x.exists()?x.data():{};(A==null?void 0:A.notifySelectionPush)!==!1&&await nd({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function _F({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(U.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await on(()=>Promise.resolve().then(()=>rd),void 0),{createMagicLink:a}=await on(()=>Promise.resolve().then(()=>lF),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){U.debug("Traitement du joueur",{playerName:f});try{const m=i==null?void 0:i.find(F=>F.name===f);if(!m){U.warn("Joueur non trouvé",{playerName:f});continue}U.debug("Joueur trouvé");const v=await o(m.id,r);if(!v){U.warn("Pas d'email pour le joueur",{playerName:f});continue}U.debug("Email trouvé pour joueur");const x=`${(await a({seasonId:r,playerId:m.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,A=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${Lh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${x}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;U.debug("HTML généré pour joueur");const L=vF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Lh(e.date),eventUrl:l,html:A,subject:c,noUrl:x});h.push(L),U.info("Email ajouté à la queue",{playerName:f})}catch(m){U.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:m})}}return U.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),U.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function bF({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(U.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await on(()=>Promise.resolve().then(()=>rd),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const m=o==null?void 0:o.find(x=>x.name===f);if(!m){U.warn("Joueur retiré non trouvé",{playerName:f});continue}const v=await a(m.id,s);if(!v){U.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const w=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${Lh(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(yF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:Lh(e.date),eventUrl:l,newSelectedPlayers:r,html:w}))}catch(m){U.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:m})}return await Promise.all(c),U.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function Lh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Xv(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function G1(n){return`seasonPreferredPlayer:${n||"global"}`}function Lm(n,e){try{const t=G1(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function wF(n,e){try{const t=G1(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function W1(n,e,t,r=null){try{U.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Zl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await on(()=>import("./index.esm-22da11e6.js"),[]),{db:c}=await on(()=>Promise.resolve().then(()=>Xi),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),m=await l(f);if(!m.empty&&m.docs.find($=>$.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");U.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await on(()=>import("./index.esm-25d5b37d.js"),[]),{auth:w}=await on(()=>Promise.resolve().then(()=>Xi),void 0),x=await v(w,e,t);U.info("Compte Firebase Auth créé",{uid:x.user.uid});const A=Xv(t),L=r?Ee(c,"seasons",r,"playerProtection",n):Ee(c,"playerProtection",n);return await dn(L,{playerId:n,email:e,passwordHash:A,firebaseUid:x.user.uid,isProtected:!0,createdAt:new Date}),U.info("Protection sauvegardée dans Firestore"),r&&Lm(r,n),{success:!0}}catch(s){throw U.error("Erreur lors de la protection du joueur",s),s}}async function Q1({playerId:n,email:e,seasonId:t=null}){const r=t?Ee(ie,"seasons",t,"playerProtection",n):Ee(ie,"playerProtection",n);(await Kt(r)).exists()?await wa(r,{email:e,updatedAt:new Date}):await dn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await U1({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function J1({playerId:n,seasonId:e=null}){const t=e?Ee(ie,"seasons",e,"playerProtection",n):Ee(ie,"playerProtection",n);if(!(await Kt(t)).exists())throw new Error("Protection introuvable");return await wa(t,{emailVerifiedAt:new Date}),{success:!0}}async function Y1({playerId:n,seasonId:e=null}){const t=e?Ee(ie,"seasons",e,"playerProtection",n):Ee(ie,"playerProtection",n);return await wa(t,{emailVerifiedAt:null}),{success:!0}}async function X1(n,e=null){try{const t=e?Ee(ie,"seasons",e,"playerProtection",n):Ee(ie,"playerProtection",n);return await dn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&wF(e,n),{success:!0,email:""}}catch(t){throw U.error("Erreur lors de la suppression de la protection",t),t}}async function Zi(n,e=null){try{const t=e?Ee(ie,"seasons",e,"playerProtection",n):Ee(ie,"playerProtection",n),r=await Kt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return U.error("Erreur lors de la vérification de protection",t),!1}}async function Zl(n,e=null){try{const t=e?Ee(ie,"seasons",e,"playerProtection",n):Ee(ie,"playerProtection",n),r=await Kt(t);return r.exists()?r.data():null}catch(t){return U.error("Erreur lors de la récupération des données de protection",t),null}}async function Z1(n,e=null){try{const t=await Zl(n,e);return(t==null?void 0:t.email)||""}catch(t){return U.error("Erreur lors de la récupération de l'email",t),""}}async function $m(n=null){try{const e=n?st(ie,"seasons",n,"playerProtection"):st(ie,"playerProtection");return(await Vt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return U.error("Erreur lors du chargement des protections",e),[]}}async function jf(n){try{const e=[],t=Ic(st(ie,"playerProtection"),Ch("email","==",n));(await Vt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Vt(st(ie,"seasons"));for(const i of s.docs){const o=i.id,a=Ic(st(ie,"seasons",o,"playerProtection"),Ch("email","==",n));(await Vt(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return U.error("Erreur listAssociationsForEmail",e),[]}}async function eA(n,e,t=null){try{const r=await Zl(n,t);if(!r||!r.isProtected)return!1;if(r.email){U.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await on(()=>import("./index.esm-25d5b37d.js"),[]),{auth:i}=await on(()=>Promise.resolve().then(()=>Xi),void 0);return await s(i,r.email,e),U.debug("Mot de passe Firebase Auth valide"),ho.saveSession(n),t&&Lm(t,n),!0}catch(s){return U.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{U.debug("Vérification avec hash local");const s=Xv(e),i=r.passwordHash===s;return i&&(ho.saveSession(n),t&&Lm(t,n)),i}}catch(r){return U.error("Erreur lors de la vérification du mot de passe",r),!1}}async function tA({playerId:n,seasonId:e=null}){const t=e?Ee(ie,"seasons",e,"playerProtection",n):Ee(ie,"playerProtection",n),r=await Kt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await wa(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function ta(n){return ho.isPasswordCached(n)}function xF(n){return null}async function nA(n,e=null){try{U.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Zl(n,e);if(U.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(U.debug("Email à utiliser (masqué)"),t.firebaseUid){U.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await on(()=>import("./index.esm-25d5b37d.js"),[]),{auth:s}=await on(()=>Promise.resolve().then(()=>Xi),void 0);U.debug("Tentative d'envoi d'email"),await r(s,t.email),U.info("Email envoyé avec succès via Firebase Auth")}else{U.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await on(()=>import("./index.esm-25d5b37d.js"),[]),{auth:i}=await on(()=>Promise.resolve().then(()=>Xi),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);U.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),U.info("Email envoyé avec succès");const{updateDoc:l}=await on(()=>import("./index.esm-22da11e6.js"),[]),{db:c}=await on(()=>Promise.resolve().then(()=>Xi),void 0),h=e?Ee(c,"seasons",e,"playerProtection",n):Ee(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")U.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),U.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw U.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function IF(n,e,t=null){try{const r=Xv(e),s=t?Ee(ie,"seasons",t,"playerProtection",n):Ee(ie,"playerProtection",n);return await wa(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw U.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function EF(n){return new Promise((e,t)=>{U.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const rd=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:Y1,finalizeProtectionAfterVerification:tA,getCachedPlayerPassword:xF,getPlayerEmail:Z1,getPlayerProtectionData:Zl,isPlayerPasswordCached:ta,isPlayerProtected:Zi,listAssociationsForEmail:jf,listProtectedPlayers:$m,markEmailVerifiedForProtection:J1,protectPlayer:W1,requirePlayerPasswordForAvailability:EF,sendPasswordResetEmail:nA,startEmailVerificationForProtection:Q1,unprotectPlayer:X1,updatePlayerPasswordInFirestore:IF,verifyPlayerPassword:eA},Symbol.toStringTag,{value:"Module"})),TF={class:"mb-4 md:mb-6"},AF={class:"flex items-start gap-4"},SF={class:"flex items-center gap-3"},PF={class:"space-y-2"},RF={class:"flex items-center gap-2"},CF={class:"text-gray-400 text-xs md:text-sm"},kF={key:0,class:"flex items-center gap-2"},DF=["title"],NF={class:"text-blue-200"},OF={class:"space-y-4 md:space-y-6"},VF={class:"space-y-2 md:space-y-3"},MF={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},LF=["disabled"],$F={key:0,class:"mt-2 text-xs text-red-300"},FF={key:1,class:"mt-2 text-xs text-green-300"},UF={class:"space-y-2 md:space-y-3"},jF={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},BF={class:"flex items-center justify-between mb-4"},qF={class:"space-y-4"},zF=["disabled"],HF={key:0,class:"text-xs text-red-300 text-center"},KF={key:1,class:"text-xs text-green-300 text-center"},GF={class:"flex items-center justify-between mb-4"},WF={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},QF={class:"space-y-3"},JF={key:0,class:"text-sm text-gray-400 text-center py-4"},YF={key:1,class:"space-y-2"},XF={class:"flex items-center gap-2 min-w-0 flex-1"},ZF={class:"truncate"},e6={class:"text-white font-medium text-sm"},t6={class:"text-gray-400 text-xs"},n6=["onClick"],rA={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=R(""),i=R(""),o=R(!1),a=R(""),l=R(""),c=R(!1),h=R(!1),f=R(""),m=R(""),v=R([]),w=R(!1),x=R(!1);Rt(s,T=>{i.value=T||""}),Rt(i,T=>{c.value=!!T&&T.includes("@")&&T!==s.value});async function A(){if(c.value){o.value=!0,a.value="",l.value="";try{const T=await B1({currentEmail:s.value,newEmail:i.value.trim()});await K1({toEmail:i.value.trim(),verifyUrl:T.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(T){a.value=(T==null?void 0:T.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function L(){if(s.value){h.value=!0,f.value="",m.value="";try{await Kv(s.value),m.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{h.value=!1}}}function F(T){return`${T.seasonId||"global"}__${T.playerId}`}async function $(){try{const T=s.value?await jf(s.value):[],_=[];for(const E of T){let k=E.playerId,D=E.seasonId||"—";try{if(E.seasonId){const S=Ee(ie,"seasons",E.seasonId,"players",E.playerId),P=await Kt(S);P.exists()&&(k=P.data().name||k);const ke=Ee(ie,"seasons",E.seasonId),Re=await Kt(ke);Re.exists()&&(D=Re.data().name||D)}}catch{}_.push({...E,playerName:k,seasonName:D})}v.value=_}catch{v.value=[]}}async function B(T){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${T.playerName}" de votre compte ?`))try{const{deleteDoc:_}=await on(()=>import("./index.esm-22da11e6.js"),[]);if(T.seasonId){const k=Ee(ie,"seasons",T.seasonId,"playerProtection",T.playerId);await _(k)}else{const k=Ee(ie,"playerProtection",T.playerId);await _(k)}try{if(T.seasonId){const k=`seasonPreferredPlayer:${T.seasonId}`,D=localStorage.getItem(k);if(D)if(D.startsWith("[")){const P=(JSON.parse(D)||[]).filter(ke=>ke!==T.playerId);localStorage.setItem(k,JSON.stringify(P))}else D===T.playerId&&localStorage.removeItem(k)}}catch{}await $();const E=`Joueur "${T.playerName}" dissocié avec succès`}catch(_){console.error("Erreur lors de la dissociation:",_),alert(`Erreur lors de la dissociation: ${_.message||"Veuillez réessayer"}`)}}function ne(T){r("open-player",T),re()}function re(){r("close")}return Rt(()=>t.show,T=>{var _;if(T)try{s.value=((_=Ge==null?void 0:Ge.currentUser)==null?void 0:_.email)||"",$()}catch{}}),En(()=>{var T;if(t.show)try{s.value=((T=Ge==null?void 0:Ge.currentUser)==null?void 0:T.email)||"",$()}catch{}}),(T,_)=>n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:re},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:_[3]||(_[3]=pt(()=>{},["stop"]))},[d("button",{onClick:re,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),d("div",TF,[d("div",AF,[d("div",SF,[_[13]||(_[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"👤")],-1)),d("div",PF,[_[12]||(_[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",RF,[d("span",CF,te(s.value||"Non défini"),1),d("button",{onClick:_[0]||(_[0]=E=>w.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),v.value.length>0?(N(),O("div",kF,[d("button",{onClick:_[1]||(_[1]=E=>v.value.length===1?ne(v.value[0]):x.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Gérer mes joueurs"},[_[11]||(_[11]=d("span",{class:"text-blue-300"},"⭐",-1)),d("span",NF,te(v.value.length===1?v.value[0].playerName:`${v.value.length} joueurs`),1)],8,DF)])):ae("",!0)])])])]),_[18]||(_[18]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",OF,[d("div",VF,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},"🔑"),_t(" Mot de passe ")],-1)),d("div",MF,[_[14]||(_[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:L,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},te(h.value?"⏳":"Changer de mot de passe"),9,LF),f.value?(N(),O("div",$F,te(f.value),1)):ae("",!0),m.value?(N(),O("div",FF,te(m.value),1)):ae("",!0)])]),d("div",UF,[_[17]||(_[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},"⚠️"),_t(" Suppression de compte ")],-1)),d("div",jF,[_[16]||(_[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),d("button",{onClick:_[2]||(_[2]=E=>T.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:re,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),w.value?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[7]||(_[7]=E=>w.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:_[6]||(_[6]=pt(()=>{},["stop"]))},[d("div",BF,[_[19]||(_[19]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},"📧"),_t(" Modifier l'email ")],-1)),d("button",{onClick:_[4]||(_[4]=E=>w.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",qF,[d("div",null,[_[20]||(_[20]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),lt(d("input",{"onUpdate:modelValue":_[5]||(_[5]=E=>i.value=E),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Mt,i.value]])]),d("button",{onClick:A,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},te(o.value?"⏳":"Mettre à jour"),9,zF),a.value?(N(),O("div",HF,te(a.value),1)):ae("",!0),l.value?(N(),O("div",KF,te(l.value),1)):ae("",!0)])])])):ae("",!0),x.value?(N(),O("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[10]||(_[10]=E=>x.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:_[9]||(_[9]=pt(()=>{},["stop"]))},[d("div",GF,[d("h3",WF,[_[21]||(_[21]=d("span",{class:"text-yellow-400"},"⭐",-1)),_t(" "+te(v.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),d("button",{onClick:_[8]||(_[8]=E=>x.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",QF,[v.value.length===0?(N(),O("div",JF," Aucun joueur associé pour le moment. ")):(N(),O("div",YF,[(N(!0),O(ft,null,Mr(v.value,E=>(N(),O("div",{key:F(E),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",XF,[_[22]||(_[22]=d("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),d("div",ZF,[d("div",e6,te(E.playerName||"—"),1),d("div",t6,te(E.seasonName||E.seasonId||"—"),1)])]),d("button",{onClick:k=>B(E),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,n6)]))),128))]))])])])):ae("",!0)])):ae("",!0)}},Cb="/logos/hatcast-logo-desktop.png",r6={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},s6=["aria-expanded"],Fm={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=R(!1),i=R(!0),o=R(null),a=R({});Rt(()=>t.isConnected,A=>{i.value=!1},{immediate:!0}),En(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&Zt(()=>h())}function h(){if(o.value){const A=o.value.getBoundingClientRect();a.value={top:`${A.bottom+8}px`,right:`${window.innerWidth-A.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function m(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function w(){s.value=!1;try{await Ge.signOut(),r("logout")}catch(A){console.error("Erreur lors de la déconnexion:",A)}}function x(){s.value=!1}return En(()=>{document.addEventListener("click",x),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),Ks(()=>{document.removeEventListener("click",x),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(A,L)=>(N(),O("div",{class:"relative",onClick:L[0]||(L[0]=pt(()=>{},["stop"]))},[i.value?(N(),O("div",r6)):n.isConnected?(N(),O("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},L[1]||(L[1]=[d("span",{class:"text-2xl"},"👤",-1)]),8,s6)):(N(),O("button",{key:1,onClick:l,class:wn(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(N(),Gs(nc,{to:"body"},[s.value&&n.isConnected?(N(),O("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:Vr(a.value),role:"menu"},[d("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[2]||(L[2]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[3]||(L[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:m,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[4]||(L[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),d("span",{class:"truncate"},"Aide",-1)])),L[6]||(L[6]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:w,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},L[5]||(L[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),d("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ae("",!0)]))]))}},i6={class:"container mx-auto px-4 py-4"},o6={class:"flex items-center justify-between"},a6={class:"flex items-center"},l6={href:"/",class:"flex items-center"},u6={class:"relative w-48 h-12 md:w-56 md:h-14"},c6={class:"flex items-center gap-2"},d6={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=Ea(),i=Ue(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");Rt(()=>s.path,()=>{ml(),setTimeout(()=>{ml()},100)},{immediate:!0}),Ks(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function h(){r("logout")}function f(){r("open-login")}return(m,v)=>(N(),O("header",{class:wn(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-transparent"])},[d("nav",i6,[d("div",o6,[d("div",a6,[d("a",l6,[d("div",u6,[n.isScrolled?(N(),O(ft,{key:1},[v[2]||(v[2]=d("img",{src:Om,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"},null,-1)),v[3]||(v[3]=d("img",{src:Cb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"},null,-1))],64)):(N(),O(ft,{key:0},[v[0]||(v[0]=d("img",{src:Om,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden brightness-0 invert"},null,-1)),v[1]||(v[1]=d("img",{src:Cb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block brightness-0 invert"},null,-1))],64))])])]),d("div",c6,[Ye(Fm,{"is-connected":rs(A$),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:h,onOpenLogin:f},null,8,["is-connected","button-class"]),CS(m.$slots,"actions")])])])],2))}},h6={class:"space-y-4 md:space-y-6"},f6={class:"space-y-2 md:space-y-3"},p6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},m6={class:"flex items-center justify-between"},g6={class:"flex items-center gap-2"},v6={class:"flex items-center justify-between"},y6={class:"flex items-center gap-2"},_6={class:"space-y-2 md:space-y-3"},b6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},w6={class:"flex items-center justify-between"},x6={class:"flex items-center gap-2"},I6={class:"flex items-center justify-between"},E6={class:"flex items-center gap-2"},T6={class:"flex items-center justify-between pt-2 border-t border-white/10"},A6=["disabled"],S6={key:1,class:"inline-flex items-center text-xs text-gray-300"},P6={class:"flex items-center justify-between pt-2"},R6=["disabled"],C6={key:0,class:"text-xs text-green-300"},k6={key:1,class:"text-xs text-red-300"},D6={key:2,class:"text-[10px] text-gray-400 break-all"},N6={class:"text-[10px] text-gray-500"},O6={key:0,class:"text-xs text-red-300"},V6={key:1,class:"text-xs text-green-300"},M6={class:"mt-6 flex justify-between items-center"},L6=["disabled"],sA={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=R(""),i=R({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=R(!1),a=R(""),l=R(""),c=R(!1),h=R(""),f=R(""),m=R(!1),v=R(localStorage.getItem("fcmToken")||""),w=R(!1),x=function(_){try{return _?_.length>20?_.slice(0,8)+"…"+_.slice(-6):_:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");function A(T){const{active:_,token:E}=T.detail;_&&E?(v.value=E,w.value=!0,localStorage.setItem("fcmToken",E),console.log("Notifications push réactivées automatiquement")):(w.value=!1,v.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push désactivées"))}async function L(){try{if(!s.value)return;const T=Ee(ie,"userPreferences",s.value),_=await Kt(T);if(_.exists()){const E=_.data()||{};i.value.notifyAvailability=E.notifyAvailability!==!1,i.value.notifySelection=E.notifySelection!==!1,i.value.notifySelectionPush=E.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=E.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function F(){if(s.value){c.value=!0,f.value="",h.value="";try{if(!(await Qu()).active){f.value="Notifications push non actives sur cet appareil";return}await nd({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),h.value="OK"}catch{f.value="Échec de l'envoi du test"}finally{c.value=!1}}}function $(){const T=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(T),alert(`🧪 Test de mise à jour PWA déclenché !

Vérifiez que la modal de mise à jour apparaît dans l'interface principale.`)}async function B(){try{if(m.value=!0,!await v1()){f.value="Push non supporté sur cet appareil";return}const _=await Qu();_.active?(v.value=_.token,w.value=!0,localStorage.setItem("fcmToken",_.token),console.log("Notifications push activées avec succès")):f.value=`Activation impossible: ${_.error}`}catch(T){const _=typeof Notification<"u"?Notification.permission:"unknown",E=T&&(T.message||T.code)?` (${T.message||T.code})`:"";f.value=`Activation impossible – permission: ${_}${E}`}finally{m.value=!1}}async function ne(){if(s.value){o.value=!0,a.value="",l.value="";try{const T=Ee(ie,"userPreferences",s.value);await dn(T,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function re(){r("close")}return Rt(()=>t.show,T=>{T&&L()}),En(()=>{var T;try{s.value=((T=Ge==null?void 0:Ge.currentUser)==null?void 0:T.email)||"",w.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),r3(),window.addEventListener("push-status-changed",A),Qu().then(_=>{_.active&&(v.value=_.token,w.value=!0,localStorage.setItem("fcmToken",_.token))})}catch{}t.show&&L()}),Ks(()=>{window.removeEventListener("push-status-changed",A)}),(T,_)=>n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:re},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:_[4]||(_[4]=pt(()=>{},["stop"]))},[d("button",{onClick:re,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),_[16]||(_[16]=Nn('<div class="mb-4 md:mb-6"><div class="flex items-start gap-4"><div class="flex items-center gap-3"><div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-lg md:text-xl">🔔</span></div><div class="space-y-2"><h3 class="text-white font-semibold text-base md:text-lg">Notifications</h3><p class="text-gray-400 text-xs md:text-sm">Ne ratez rien, soyez le premier prévenu !</p></div></div></div></div><div class="border-t border-white/10 mb-4 md:mb-6"></div>',2)),d("div",h6,[d("div",f6,[_[7]||(_[7]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-blue-400"},"📧"),_t(" Emails ")],-1)),d("div",p6,[d("div",m6,[d("label",g6,[lt(d("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=E=>i.value.notifyAvailability=E),class:"w-4 h-4"},null,512),[[Gi,i.value.notifyAvailability]]),_[5]||(_[5]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),d("div",v6,[d("label",y6,[lt(d("input",{type:"checkbox","onUpdate:modelValue":_[1]||(_[1]=E=>i.value.notifySelection=E),class:"w-4 h-4"},null,512),[[Gi,i.value.notifySelection]]),_[6]||(_[6]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),d("div",_6,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-emerald-400"},"📱"),_t(" Mobile (expérimental) ")],-1)),d("div",b6,[_[14]||(_[14]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),d("div",w6,[d("label",x6,[lt(d("input",{type:"checkbox","onUpdate:modelValue":_[2]||(_[2]=E=>i.value.notifySelectionPush=E),class:"w-4 h-4"},null,512),[[Gi,i.value.notifySelectionPush]]),_[8]||(_[8]=d("span",{class:"text-sm text-white"},"Me notifier lorsque je suis concerné par une sélection",-1))])]),d("div",I6,[d("label",E6,[lt(d("input",{type:"checkbox","onUpdate:modelValue":_[3]||(_[3]=E=>i.value.notifyAvailabilityPush=E),class:"w-4 h-4"},null,512),[[Gi,i.value.notifyAvailabilityPush]]),_[9]||(_[9]=d("span",{class:"text-sm text-white"},"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),d("div",T6,[_[11]||(_[11]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),w.value?(N(),O("span",S6,_[10]||(_[10]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),_t(" Actif ")]))):(N(),O("button",{key:0,onClick:B,disabled:m.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},te(m.value?"...":"Activer"),9,A6))]),d("div",P6,[_[12]||(_[12]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:F,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},te(c.value?"Envoi…":"Envoyer un test"),9,R6)]),d("div",{class:"flex items-center justify-between pt-2"},[_[13]||(_[13]=d("div",{class:"text-xs text-gray-400"},"Test de mise à jour PWA",-1)),d("button",{onClick:$,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"}," 🧪 Simuler maj ")]),h.value?(N(),O("div",C6,"Notification test envoyée (vérifiez votre appareil)")):ae("",!0),f.value?(N(),O("div",k6,te(f.value),1)):ae("",!0),v.value?(N(),O("div",D6,"FCM token: "+te(v.value),1)):ae("",!0),d("div",N6,"VAPID: "+te(rs(x)||"indisponible"),1)])]),a.value?(N(),O("div",O6,te(a.value),1)):ae("",!0),l.value?(N(),O("div",V6,te(l.value),1)):ae("",!0)]),d("div",M6,[d("button",{onClick:ne,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},te(o.value?"⏳":"Sauvegarder"),9,L6),d("button",{onClick:re,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ae("",!0)}},$6={class:"space-y-3"},F6={key:0,class:"text-sm text-gray-400"},U6={key:1,class:"space-y-2"},j6={class:"flex items-center justify-between gap-3"},B6={class:"truncate"},q6={class:"text-white font-semibold"},z6={class:"text-gray-400 text-xs"},H6=["onClick"],iA={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=R(""),i=R([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=Ge==null?void 0:Ge.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await jf(s.value):[],m=[];for(const v of f){let w=v.playerId;try{if(v.seasonId){const x=Ee(ie,"seasons",v.seasonId,"players",v.playerId),A=await Kt(x);A.exists()&&(w=A.data().name||w)}}catch{}m.push({...v,playerName:w})}i.value=m}catch{i.value=[]}}function l(h){r("manage-player",h),c()}function c(){r("close")}return Rt(()=>t.show,h=>{h&&a()}),En(()=>{t.show&&a()}),(h,f)=>n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=pt(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=Nn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),d("div",$6,[f[1]||(f[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(N(),O("div",F6,"Aucun joueur associé pour le moment.")):(N(),O("ul",U6,[(N(!0),O(ft,null,Mr(i.value,m=>(N(),O("li",{key:o(m),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",j6,[d("div",B6,[d("div",q6,te(m.seasonName||m.seasonId||"—"),1),d("div",z6,"Joueur : "+te(m.playerName||"—"),1)]),d("button",{onClick:v=>l(m),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,H6)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ae("",!0)}};let cr="mock",eo=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],pa=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function Zv(n){cr=n}async function K6(){if(cr!=="firebase"||!(await Vt(st(ie,"seasons"))).empty)return;const e=Ee(st(ie,"seasons"));await dn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:ri()});const t=await Vt(st(ie,"players"));for(const o of t.docs)await dn(Ee(e,"players",o.id),o.data());const r=await Vt(st(ie,"events"));for(const o of r.docs)await dn(Ee(e,"events",o.id),o.data());const s=await Vt(st(ie,"availability"));for(const o of s.docs)await dn(Ee(e,"availability",o.id),o.data());const i=await Vt(st(ie,"selections"));for(const o of i.docs)await dn(Ee(e,"selections",o.id),o.data())}async function oA(){cr==="firebase"&&await K6()}async function $h(n=null){let e;return cr==="firebase"?n?e=(await Vt(st(ie,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Vt(st(ie,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=pa,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Xu(n=null){let e;return cr==="firebase"?n?e=(await Vt(st(ie,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await Vt(st(ie,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=eo,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function aA(n,e=null){if(cr==="firebase"){const t=Ee(e?st(ie,"seasons",e,"players"):st(ie,"players"));return await dn(t,{name:n}),t.id}else{const t=`p${eo.length+1}`;return eo.push({id:t,name:n}),t}}async function G6(n,e=null){if(cr==="firebase"){const t=e?Ee(ie,"seasons",e,"players",n):Ee(ie,"players",n);await Nl(t);const r=e?await Vt(st(ie,"seasons",e,"availability")):await Vt(st(ie,"availability")),s=gv(ie);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else eo=eo.filter(t=>t.id!==n)}async function W6(n,e,t=null){if(cr==="firebase"){const r=t?Ee(ie,"seasons",t,"players",n):Ee(ie,"players",n),s=await Kt(r),i=s.exists()&&s.data().name||null;if(await dn(r,{name:e},{merge:!0}),i&&i!==e){const o=gv(ie);try{const a=t?Ee(ie,"seasons",t,"availability",i):Ee(ie,"availability",i),l=await Kt(a);if(l.exists()){const c=l.data()||{},h=t?Ee(ie,"seasons",t,"availability",e):Ee(ie,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?st(ie,"seasons",t,"selections"):st(ie,"selections");(await Vt(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const m=h.map(v=>v===i?e:v);o.update(c.ref,{players:m})}})}catch{}await o.commit()}}else{const r=eo.findIndex(s=>s.id===n);r!==-1&&(eo[r]={...eo[r],name:e})}}async function Uo(n,e,t=null){if(cr==="firebase"){const r=t?await Vt(st(ie,"seasons",t,"availability")):await Vt(st(ie,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function jo(n=null){if(cr==="firebase"){const e=n?await Vt(st(ie,"seasons",n,"selections")):await Vt(st(ie,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function kb(n,e,t=null){if(cr==="firebase"){const r=t?Ee(ie,"seasons",t,"availability",n):Ee(ie,"availability",n);await dn(r,e)}}async function Q6({seasonId:n,playerName:e,eventId:t,value:r}){if(cr!=="firebase")return;const s=n?Ee(ie,"seasons",n,"availability",e):Ee(ie,"availability",e),i=await Kt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await dn(s,a)}async function Um(n,e,t=null){if(cr==="firebase"){const r=t?Ee(ie,"seasons",t,"selections",n):Ee(ie,"selections",n);await dn(r,{players:e})}}async function J6(n,e=null){if(U.info("Suppression de l'événement",{eventId:n}),cr==="firebase")try{U.debug("Suppression de l'événement dans Firestore");const t=e?Ee(ie,"seasons",e,"events",n):Ee(ie,"events",n);await Nl(t),U.debug("Suppression de la sélection associée");const r=e?Ee(ie,"seasons",e,"selections",n):Ee(ie,"selections",n);await Nl(r),U.debug("Suppression des disponibilités");const s=e?await Vt(st(ie,"seasons",e,"availability")):await Vt(st(ie,"availability")),i=gv(ie);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){U.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),U.info("Opérations de suppression terminées avec succès")}catch(t){throw U.error("Erreur lors de la suppression",t),t}else pa=pa.filter(t=>t.id!==n)}async function Y6(n,e=null){if(cr==="firebase"){const t=Ee(e?st(ie,"seasons",e,"events"):st(ie,"events"));return await dn(t,n),t.id}else{const t=`event${pa.length+1}`;return pa.push({id:t,...n}),t}}async function Db(n,e,t=null){if(cr==="firebase"){const r=t?Ee(ie,"seasons",t,"events",n):Ee(ie,"events",n);await dn(r,e,{merge:!0})}else{const r=pa.findIndex(s=>s.id===n);r!==-1&&(pa[r]={id:n,...e})}}const X6={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},Z6={class:"hero-section relative overflow-hidden pt-24"},eU={class:"hero-content py-16 md:py-24 px-4 relative z-10"},tU={class:"container mx-auto"},nU={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},rU={class:"text-center lg:text-left order-1 lg:order-2"},sU={class:"hero-cta mb-10"},iU={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},oU={class:"seasons-section py-16"},aU={class:"container mx-auto px-4"},lU=["aria-busy"],uU={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},cU={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},dU=["onClick"],hU={class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg overflow-hidden"},fU=["src","alt"],pU={key:1,class:"text-2xl"},mU={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},gU={key:0,class:"text-gray-300 text-sm mb-4 line-clamp-2 leading-relaxed"},vU={class:"flex justify-center gap-6 text-sm"},yU={class:"text-center"},_U={class:"text-white font-semibold"},bU={class:"text-center"},wU={class:"text-white font-semibold"},xU={class:"absolute top-4 right-4"},IU=["onClick","aria-expanded"],EU={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},TU=["onClick"],AU=["onClick"],SU=["onClick"],PU=["onClick"],RU=["onClick"],CU={class:"text-center mt-12"},kU={key:2,class:"text-center py-16"},DU={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},NU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},OU={class:"mb-6"},VU={class:"mb-6"},MU={class:"mb-6"},LU={class:"mb-6"},$U={class:"flex justify-end space-x-3"},FU=["disabled"],UU={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},jU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BU={class:"text-center mb-6"},qU={class:"text-gray-300"},zU={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},HU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},KU={class:"text-center mb-6"},GU={class:"text-gray-300"},WU={class:"mb-6"},QU={class:"mb-6"},JU={class:"mb-6"},YU={key:0,class:"mb-4 text-center"},XU={class:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-white/20"},ZU=["src","alt"],e5=["disabled"],t5={key:0,class:"text-2xl mb-2 animate-spin"},n5={key:1,class:"text-2xl mb-2"},r5={class:"text-sm"},s5={key:0},i5={key:1},o5={key:2},a5={key:2,class:"text-xs text-gray-400 mt-1"},l5={class:"flex justify-end space-x-3"},u5=["disabled"],c5={key:0,class:"flex items-center gap-2"},d5={key:1},h5={__name:"Seasons",setup(n){const e=R([]),t=R(!0),r=Xl(),s=R(null),i=R(!1),o=R(!1),a=R(!1),l=R(""),c=R(""),h=R(""),f=R(""),m=R(""),v=R(""),w=R(null),x=R(""),A=R(null),L=R(null),F=R(!1),$=R(!1),B=R(null),ne=R(""),re=R(!1),T=R(!1),_=R(!1),E=R(!1),k=R(!1);En(async()=>{var j,we;try{U.info("Début du chargement des saisons"),Zv("firebase"),U.info("Mode de stockage défini sur Firebase"),await oA(),U.info("Stockage initialisé"),U.info("Attente de l'initialisation du service d'authentification...");try{P$(),await V1(),U.info("Service d'authentification initialisé")}catch(je){U.warn("Service d'authentification non initialisé, continuation sans authentification:",je.message||"Erreur inconnue")}try{ml(),U.info("Synchronisation forcée effectuée")}catch(je){U.warn("Erreur lors de la synchronisation forcée:",je)}U.info("Chargement des saisons...");try{e.value=await tl(),U.info("Saisons chargées",{count:((j=e.value)==null?void 0:j.length)||0})}catch(je){throw U.error("Erreur lors du chargement des saisons:",je),je}if(e.value.length>0){U.info("Chargement des données des saisons...");const je=await Promise.all(e.value.map(async Ke=>{try{U.debug(`Chargement des données pour la saison: ${Ke.name} (ID: ${Ke.id})`);let at,vt;try{at=await $h(Ke.id),U.debug(`Événements chargés pour ${Ke.name}:`,at)}catch(Tt){U.warn(`Erreur lors du chargement des événements pour ${Ke.name}:`,Tt),at=[]}try{vt=await Xu(Ke.id),U.debug(`Joueurs chargés pour ${Ke.name}:`,vt)}catch(Tt){U.warn(`Erreur lors du chargement des joueurs pour ${Ke.name}:`,Tt),vt=[]}return U.debug(`Saison ${Ke.name}: ${(at==null?void 0:at.length)||0} événements, ${(vt==null?void 0:vt.length)||0} joueurs`),{...Ke,events:at||[],players:vt||[]}}catch(at){return U.warn(`Erreur lors du chargement des données pour la saison ${Ke.id}:`,at),{...Ke,events:[],players:[]}}}));e.value=je,U.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(Ke=>{var at,vt;U.info(`Saison finale ${Ke.name}: ${((at=Ke.events)==null?void 0:at.length)||0} événements, ${((vt=Ke.players)==null?void 0:vt.length)||0} joueurs`)})}Le().catch(je=>U.error("Migration sortOrder échouée",je))}catch(je){U.error("Erreur lors du chargement initial des saisons:",je),U.error("Stack trace:",je.stack);try{U.info("Tentative de fallback pour charger les saisons..."),e.value=await tl(),U.info("Saisons chargées en fallback",{count:((we=e.value)==null?void 0:we.length)||0})}catch(Ke){U.error("Échec du fallback pour charger les saisons:",Ke)}}finally{t.value=!1,U.info("Chargement terminé, isLoading = false")}const ee=()=>{k.value=window.scrollY>10};return window.addEventListener("scroll",ee,{passive:!0}),()=>{window.removeEventListener("scroll",ee)}});const D=Ue(()=>[...e.value].sort((ee,j)=>{var vt,Tt;const we=typeof ee.sortOrder=="number"?ee.sortOrder:Number.MAX_SAFE_INTEGER,je=typeof j.sortOrder=="number"?j.sortOrder:Number.MAX_SAFE_INTEGER;if(we!==je)return we-je;const Ke=(vt=ee.createdAt)!=null&&vt.toMillis?ee.createdAt.toMillis():0,at=(Tt=j.createdAt)!=null&&Tt.toMillis?j.createdAt.toMillis():0;return Ke!==at?at-Ke:(ee.name||"").localeCompare(j.name||"")}));function S(ee){r.push(`/season/${ee}`)}function P(ee){s.value=s.value===ee?null:ee}function ke(){s.value=null}function Re(ee){L.value=ee,m.value=ee.name,v.value=ee.description||"",w.value=null,x.value=ee.logoUrl||"",a.value=!0,ke()}function Pe(){a.value=!1,L.value=null,m.value="",v.value="",w.value=null,x.value="",F.value=!1}async function Ce(){a.value=!1,await pe({type:"editSeason",data:{seasonId:L.value.id,seasonName:L.value.name,newName:m.value.trim(),newDescription:v.value.trim(),newLogo:w.value,newLogoPreview:x.value,oldName:L.value.name,oldDescription:L.value.description||"",oldLogoUrl:L.value.logoUrl||""}})}function _e(){const ee=document.querySelector(".help-section");ee&&ee.scrollIntoView({behavior:"smooth"})}function le(){const ee=document.querySelector(".seasons-section");ee&&ee.scrollIntoView({behavior:"smooth"})}function Je(ee){const j=ee.target.files[0];if(j){w.value=j,F.value=!0;const we=new FileReader;we.onload=je=>{x.value=je.target.result,F.value=!1},we.onerror=()=>{F.value=!1},we.readAsDataURL(j)}}function oe(){console.log("removeLogo appelé"),w.value=null,x.value="",console.log("Logo supprimé")}function Z(){const ee=document.querySelector('input[type="file"][accept="image/*"]');ee?ee.click():console.error("Input file non trouvé pour triggerLogoUpload")}async function Le(){if(!e.value.length)return;const ee=e.value.map(we=>typeof we.sortOrder=="number"?we.sortOrder:null).filter(we=>we!==null);let j=ee.length?Math.max(...ee):0;for(const we of e.value)if(typeof we.sortOrder!="number"){j+=1;try{await Tu(we.id,j),we.sortOrder=j}catch(je){U.error("Erreur migration sortOrder",{seasonName:we==null?void 0:we.name,error:je})}}}async function ut(ee){try{if(!(ee!=null&&ee.id)){alert("Saison introuvable");return}const[j,we]=await Promise.all([$h(ee.id),Xu(ee.id)]),[je,Ke]=await Promise.all([Uo(we,j,ee.id),jo(ee.id)]),at=["Joueur",...j.map(er=>Yt(er))],vt=[];for(const er of we){const tr=(er==null?void 0:er.name)||"",Mn=(je==null?void 0:je[tr])||{},Aa=[tr,...j.map(Sa=>it(Mn[Sa.id],Ke==null?void 0:Ke[Sa.id],tr))];vt.push(Aa)}const Tt=xe([at,...vt]),Cn=new Blob(["\uFEFF"+Tt],{type:"text/csv;charset=utf-8;"}),kn=(ee==null?void 0:ee.name)||(ee==null?void 0:ee.slug)||"saison",Zn=`${De(kn)}-disponibilites.csv`,rt=URL.createObjectURL(Cn),St=document.createElement("a");St.href=rt,St.download=Zn,document.body.appendChild(St),St.click(),document.body.removeChild(St),URL.revokeObjectURL(rt),U.info("Export CSV saison",{seasonId:ee.id,events:j.length,players:we.length})}catch(j){U.error("Erreur export CSV",j),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function At(ee){if(!ee)return null;if(ee instanceof Date)return ee;if(typeof(ee==null?void 0:ee.toDate)=="function")return ee.toDate();if(typeof ee=="string"||typeof ee=="number"){const j=new Date(ee);return isNaN(j.getTime())?null:j}return null}function Yt(ee){const j=At(ee==null?void 0:ee.date),we=j?`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`:"",je=(ee==null?void 0:ee.title)||"Sans titre";return`${we} · ${je}`.trim()}function J(ee){return ee===!0||ee==="oui"?"disponible":ee===!1||ee==="non"?"non disponible":""}function xe(ee){return ee.map(j=>j.map(ve).join(",")).join(`
`)}function ve(ee){const j=String(ee??"");return/[",\n\r]/.test(j)?'"'+j.replace(/"/g,'""')+'"':j}function De(ee){return String(ee||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function it(ee,j,we){return Array.isArray(j)&&j.includes(we)?ee===!1||ee==="non"?"non disponible":"sélectionné":J(ee)}async function gt(ee){if(ke(),ee<=0)return;const j=[...D.value],we=j[ee],je=j[ee-1],Ke=we.sortOrder;we.sortOrder=je.sortOrder,je.sortOrder=Ke;try{await Promise.all([Tu(we.id,we.sortOrder),Tu(je.id,je.sortOrder)])}catch(at){U.error("Erreur lors du déplacement vers le haut",at)}}async function C(ee){ke();const j=[...D.value];if(ee>=j.length-1)return;const we=j[ee],je=j[ee+1],Ke=we.sortOrder;we.sortOrder=je.sortOrder,je.sortOrder=Ke;try{await Promise.all([Tu(we.id,we.sortOrder),Tu(je.id,je.sortOrder)])}catch(at){U.error("Erreur lors du déplacement vers le bas",at)}}function V(){l.value&&(c.value=l.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function H(){f.value=f.value.replace(/[^0-9]/g,""),f.value.length>4&&(f.value=f.value.slice(0,4))}async function K(){if(!l.value.trim()||!c.value.trim()||!f.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(f.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await m$(l.value.trim(),c.value.trim(),f.value.trim(),h.value.trim(),""),e.value=await tl(),await Le(),X()}catch(ee){U.error("Erreur lors de la création de la saison",ee),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function X(){i.value=!1,l.value="",c.value="",h.value="",f.value=""}function ue(ee){A.value=ee,o.value=!0}async function ge(){o.value=!1,await pe({type:"deleteSeason",data:{seasonId:A.value.id,seasonName:A.value.name}})}function me(){o.value=!1,A.value=null}function ye(){return B.value?{deleteSeason:"Suppression de saison - Code PIN requis",editSeason:"Modification de saison - Code PIN requis"}[B.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function pe(ee){const j=ee.type==="editSeason"?ee.data.seasonId:A.value.id;if(Gn.isPinCached(j)){const we=Gn.getCachedPin(j);if(U.debug("PIN en cache trouvé, utilisation automatique"),await Vh(j,we)){await ze(ee);return}else Gn.clearSession()}B.value=ee,$.value=!0}async function Fe(ee){var j,we,je,Ke;U.debug("PIN soumis pour l'opération",{operationType:(j=B.value)==null?void 0:j.type});try{const at=((je=(we=B.value)==null?void 0:we.data)==null?void 0:je.seasonId)||((Ke=A.value)==null?void 0:Ke.id),vt=await Vh(at,ee);if(U.debug("PIN validé",{valid:vt}),vt){Gn.saveSession(at,ee),U.debug("PIN correct, fermeture de la modal et exécution de l'opération"),$.value=!1;const Tt=B.value;B.value=null,U.debug("Appel de executePendingOperation",{operationType:Tt==null?void 0:Tt.type}),await ze(Tt)}else ne.value="Code PIN incorrect",setTimeout(()=>{ne.value=""},3e3)}catch(at){U.error("Erreur lors de la vérification du PIN",at),ne.value="Erreur lors de la vérification du code PIN"}}function Ae(){$.value=!1,B.value=null,ne.value=""}function Oe(){return A.value&&Gn.isPinCached(A.value.id)?{timeRemaining:Gn.getTimeRemaining(),isExpiringSoon:Gn.isExpiringSoon()}:null}async function ze(ee){var je;if(U.debug("executePendingOperation appelé",{hasOperation:!!ee}),!ee){U.warn("Aucune opération à exécuter");return}const{type:j,data:we}=ee;U.info("Exécution de l'opération",{type:j});try{switch(j){case"deleteSeason":U.info("Suppression de la saison",{seasonId:we.seasonId}),await g$(we.seasonId),U.info("Saison supprimée, rechargement de la liste"),e.value=await tl(),U.info("Liste des saisons rechargée",{count:((je=e.value)==null?void 0:je.length)||0});break;case"editSeason":U.info("Modification de la saison",{seasonId:we.seasonId});const Ke=we.newName!==we.oldName,at=we.newDescription!==we.oldDescription,vt=we.newLogo!==null;if(!Ke&&!at&&!vt){U.info("Aucun changement détecté, opération annulée");return}const Tt={};if(we.newName!==we.oldName&&(Tt.name=we.newName),we.newDescription!==we.oldDescription&&(Tt.description=we.newDescription),we.newLogo)try{F.value=!0,U.info("Upload du nouveau logo...");const kn=await O$(we.newLogo,`season-logos/${we.seasonId}`,{resize:!0,maxWidth:64,maxHeight:64,quality:.6});if(Tt.logoUrl=kn,we.oldLogoUrl&&L$(we.oldLogoUrl))try{await M$(we.oldLogoUrl),U.info("Ancien logo supprimé")}catch(Zn){U.warn("Erreur lors de la suppression de l'ancien logo:",Zn)}}catch(kn){throw U.error("Erreur lors de l'upload du logo:",kn),new Error("Erreur lors de l'upload du logo: "+kn.message)}finally{F.value=!1}await v$(we.seasonId,Tt);const Cn=e.value.findIndex(kn=>kn.id===we.seasonId);Cn!==-1&&(Tt.name&&(e.value[Cn].name=we.newName),Tt.description!==void 0&&(e.value[Cn].description=we.newDescription),Tt.logoUrl&&(e.value[Cn].logoUrl=Tt.logoUrl)),U.info("Saison modifiée avec succès",{seasonId:we.seasonId,oldName:we.oldName,newName:we.newName,oldDescription:we.oldDescription,newDescription:we.newDescription});break;default:U.warn("Type d'opération non reconnu",{type:j})}}catch(Ke){U.error("Erreur lors de l'exécution de l'opération",Ke),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function He(){re.value=!0}function Ze(){re.value=!1}function ct(){re.value=!1,Br()}function vn(){T.value=!0}function rn(){T.value=!1}function Hn(){_.value=!0}function qt(){_.value=!1}function Ur(){E.value=!0}function jr(){E.value=!1}function Gt(){U.debug("Gestion de joueur demandée")}async function un(){try{await Ge.signOut(),T.value=!1,U.info("Utilisateur déconnecté avec succès")}catch(ee){U.error("Erreur lors de la déconnexion",ee),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function Br(){try{const ee=await O1();if(ee){r.push(`/season/${ee}`);return}}catch(ee){U.warn("Impossible de récupérer la saison préférée",ee)}le()}return En(()=>(ml(),()=>{})),Rt(()=>r.currentRoute.value.path,async ee=>{var j;if(ee==="/"&&(ml(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await tl(),U.info("Saisons rechargées lors du changement de route",{count:((j=e.value)==null?void 0:j.length)||0})}catch(we){U.error("Erreur lors du rechargement des saisons",we)}finally{t.value=!1}}},{immediate:!0}),(ee,j)=>{var we,je,Ke,at,vt,Tt,Cn,kn,Zn;return N(),O("div",X6,[Ye(d6,{"is-scrolled":k.value,onOpenAccountMenu:vn,onOpenHelp:_e,onOpenNotifications:Hn,onOpenPlayers:Ur,onLogout:un,onOpenLogin:He},null,8,["is-scrolled"]),d("section",Z6,[d("div",eU,[d("div",tU,[d("div",nU,[j[13]||(j[13]=Nn('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+Nm+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",rU,[j[12]||(j[12]=Nn('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",sU,[d("div",iU,[d("button",{onClick:j[0]||(j[0]=rt=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:_e,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},j[10]||(j[10]=[d("span",null,"ℹ️",-1),_t(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:le,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},j[11]||(j[11]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),j[14]||(j[14]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",oU,[d("div",aU,[j[32]||(j[32]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(N(),O("div",uU,[(N(),O(ft,null,Mr(8,rt=>d("div",{key:"skeleton-"+rt,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},j[15]||(j[15]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(N(),O("div",cU,[(N(!0),O(ft,null,Mr(D.value,(rt,St)=>{var er,tr;return N(),O("div",{key:rt.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:Mn=>S(rt.slug),class:"text-center cursor-pointer"},[d("div",hU,[rt.logoUrl?(N(),O("img",{key:0,src:rt.logoUrl,alt:`Logo de ${rt.name}`,class:"w-full h-full object-cover"},null,8,fU)):(N(),O("span",pU,"🎭"))]),d("h2",mU,te(rt.name),1),rt.description?(N(),O("p",gU,te(rt.description),1)):ae("",!0),j[18]||(j[18]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",vU,[d("div",yU,[d("div",_U,te(((er=rt.events)==null?void 0:er.length)||0),1),j[16]||(j[16]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",bU,[d("div",wU,te(((tr=rt.players)==null?void 0:tr.length)||0),1),j[17]||(j[17]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,dU),d("div",xU,[d("div",{class:"relative",onClick:j[1]||(j[1]=pt(()=>{},["stop"]))},[d("button",{onClick:Mn=>P(St),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===St,"aria-haspopup":"true",title:"Options"},j[19]||(j[19]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,IU),s.value===St?(N(),O("div",EU,[d("button",{onClick:Mn=>{ut(rt),ke()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[20]||(j[20]=[d("span",null,"📊",-1),_t(" Exporter CSV ")]),8,TU),j[25]||(j[25]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Mn=>gt(St),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[21]||(j[21]=[d("span",null,"⬆️",-1),_t(" Avancer ")]),8,AU),d("button",{onClick:Mn=>C(St),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[22]||(j[22]=[d("span",null,"⬇️",-1),_t(" Reculer ")]),8,SU),j[26]||(j[26]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Mn=>Re(rt),class:"w-full text-left px-4 py-2 text-sm text-blue-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[23]||(j[23]=[d("span",null,"✏️",-1),_t(" Modifier ")]),8,PU),j[27]||(j[27]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Mn=>ue(rt),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",role:"menuitem"},j[24]||(j[24]=[d("span",null,"🗑️",-1),_t(" Supprimer ")]),8,RU)])):ae("",!0)])])])}),128))])):ae("",!0),d("div",CU,[d("button",{onClick:j[2]||(j[2]=rt=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},j[28]||(j[28]=[d("span",null,"➕",-1),_t(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(N(),O("div",kU,[j[29]||(j[29]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),j[30]||(j[30]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),j[31]||(j[31]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:j[3]||(j[3]=rt=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ae("",!0)],8,lU)])]),i.value?(N(),O("div",DU,[d("div",NU,[j[39]||(j[39]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",OU,[j[33]||(j[33]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),lt(d("input",{"onUpdate:modelValue":j[4]||(j[4]=rt=>l.value=rt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:V},null,544),[[Mt,l.value]])]),d("div",VU,[j[34]||(j[34]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),lt(d("input",{"onUpdate:modelValue":j[5]||(j[5]=rt=>c.value=rt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Mt,c.value]])]),d("div",MU,[j[35]||(j[35]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),lt(d("textarea",{"onUpdate:modelValue":j[6]||(j[6]=rt=>h.value=rt),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Mt,h.value]]),j[36]||(j[36]=d("p",{class:"text-xs text-gray-400 mt-1"},"Une brève description de votre saison",-1))]),d("div",LU,[j[37]||(j[37]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),lt(d("input",{"onUpdate:modelValue":j[7]||(j[7]=rt=>f.value=rt),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:H},null,544),[[Mt,f.value]]),j[38]||(j[38]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",$U,[d("button",{onClick:X,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:K,disabled:!l.value.trim()||!c.value.trim()||!f.value.trim()||f.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,FU)])])])):ae("",!0),o.value?(N(),O("div",UU,[d("div",jU,[d("div",BU,[j[40]||(j[40]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),j[41]||(j[41]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",qU,'Êtes-vous sûr de vouloir supprimer la saison "'+te((we=A.value)==null?void 0:we.name)+'" ?',1)]),j[42]||(j[42]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:me,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ge,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ae("",!0),a.value?(N(),O("div",zU,[d("div",HU,[d("div",KU,[j[43]||(j[43]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"✏️")],-1)),j[44]||(j[44]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Modifier la saison",-1)),d("p",GU,'Modifiez les informations de la saison "'+te((je=L.value)==null?void 0:je.name)+'"',1)]),d("div",WU,[j[45]||(j[45]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),lt(d("input",{"onUpdate:modelValue":j[8]||(j[8]=rt=>m.value=rt),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026"},null,512),[[Mt,m.value]])]),d("div",QU,[j[46]||(j[46]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),lt(d("textarea",{"onUpdate:modelValue":j[9]||(j[9]=rt=>v.value=rt),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Mt,v.value]])]),d("div",JU,[j[47]||(j[47]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Logo de la troupe (optionnel)",-1)),x.value||(Ke=L.value)!=null&&Ke.logoUrl?(N(),O("div",YU,[d("div",XU,[d("img",{src:x.value||((at=L.value)==null?void 0:at.logoUrl),alt:`Logo de ${(vt=L.value)==null?void 0:vt.name}`,class:"w-full h-full object-cover"},null,8,ZU)]),x.value||(Tt=L.value)!=null&&Tt.logoUrl?(N(),O("button",{key:0,onClick:oe,type:"button",class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Supprimer le logo ")):ae("",!0)])):ae("",!0),d("div",{class:wn(["border-2 border-dashed rounded-lg p-6 text-center transition-all duration-300",F.value?"border-blue-500 bg-blue-900/20 animate-pulse":"border-gray-600 hover:border-gray-500"])},[d("input",{ref:"logoFileInput",type:"file",accept:"image/*",onChange:Je,class:"hidden"},null,544),d("button",{onClick:Z,type:"button",disabled:F.value,class:"text-gray-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[F.value?(N(),O("div",t5,"⏳")):(N(),O("div",n5,"📷")),d("div",r5,[F.value?(N(),O("span",s5," Upload en cours... ")):!x.value&&!((Cn=L.value)!=null&&Cn.logoUrl)?(N(),O("span",i5," Cliquez pour ajouter un logo ")):(N(),O("span",o5," Cliquez pour changer le logo "))]),F.value?ae("",!0):(N(),O("div",a5," PNG, JPG, GIF (max 5MB) "))],8,e5)],2)]),j[49]||(j[49]=d("p",{class:"mb-6 text-sm text-blue-400 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20"}," ℹ️ Le slug de l'URL restera inchangé pour préserver les liens existants. ",-1)),d("div",l5,[d("button",{onClick:Pe,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ce,disabled:!m.value.trim()||m.value.trim()===((kn=L.value)==null?void 0:kn.name)&&v.value===(((Zn=L.value)==null?void 0:Zn.description)||"")&&!w.value||F.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"},[F.value?(N(),O("span",c5,j[48]||(j[48]=[d("span",{class:"animate-spin"},"⏳",-1),_t(" Upload en cours... ")]))):(N(),O("span",d5,"Modifier"))],8,u5)])])])):ae("",!0),Ye(L1,{show:$.value,message:ye(),error:ne.value,"session-info":Oe(),onSubmit:Fe,onCancel:Ae},null,8,["show","message","error","session-info"]),j[50]||(j[50]=Nn('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-950 to-black"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8"><div><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+Om+'" alt="Logo HatCast" class="w-full h-full brightness-0 invert"></div></div><p class="text-gray-300 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Feedback</h4><div class="space-y-2"><a href="https://github.com/plamarque/hatcast/issues" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🐛 Signaler un bug </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a></div></div></div><div class="text-center text-xs text-gray-500 pt-6"><span>© Patrice Lamarque 2025</span></div></div></footer>',2)),Ye(F1,{show:re.value,onClose:Ze,onSuccess:ct},null,8,["show"]),Ye(rA,{show:T.value,onClose:rn,onLogoutDevice:un},null,8,["show"]),Ye(sA,{show:_.value,onClose:qt},null,8,["show"]),Ye(iA,{show:E.value,onClose:jr,onManagePlayer:Gt},null,8,["show"])])}}};function f5({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,c;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const h=(i==null?void 0:i.notifyAvailability)!==!1,f=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:h,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:f,title:n==="availability_reminder"?"⏰ Rappel disponibilité":`${t} (${r})`,body:n==="availability_reminder"?`${e}, ${t} (${r})`:`${e}, t'es dispo ?`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilité:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const h=(i==null?void 0:i.notifySelection)!==!1,f=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:h,subject:`🎭 Equipe pour ${t}`},a.push={enabled:f,title:`🎭 Equipe pour ${t}`,body:`${e}, tu fais partie de l'équipe pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de sélection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(l=a.email)==null?void 0:l.enabled,pushEnabled:(c=a.push)==null?void 0:c.enabled}),a}function Nb({recipientName:n,eventTitle:e,eventDate:t}){return{title:`${e} (${t})`,body:`${n}, t'es dispo ?`}}function Ob({recipientName:n,eventTitle:e,eventDate:t}){return{title:`🎭 Equipe pour ${e}`,body:`${n}, tu fais partie de l'équipe pour ${e} le ${t}!`}}function Vb({recipientName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return{subject:`🎭 ${e} · ${t}`,from:"HatCast",to:n,html:H1({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i})}}function Mb({recipientName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s}){return{subject:`🎭 Tu es dans la sélection pour ${e}!`,from:"HatCast",to:n,html:uF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s})}}async function p5({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){var m;if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Kt(Ee(ie,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=f5({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await mF({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(v=>{U.error("notifyRecipientAcrossChannels email error",v),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled?(U.debug("Envoi notification push",{reason:n,recipientEmail:e,title:c.push.title,body:c.push.body}),await nd({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>{U.info("Notification push envoyée avec succès",{reason:n,recipientEmail:e}),h.push({channel:"push",success:!0})}).catch(v=>{U.error("notifyRecipientAcrossChannels push error",v),h.push({channel:"push",success:!1})})):U.debug("Notification push désactivée ou non configurée",{reason:n,recipientEmail:e,hasPayload:!!c.push,enabled:(m=c.push)==null?void 0:m.enabled,prefs:l}),{success:h.some(v=>v.success),results:h}}async function Lb({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(h.name,n));if(v===!0||v===!1)continue}const f={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),w=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${w.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await p5({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:m5(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function $b(n){return _F(n)}function m5(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function g5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function v5(n,e=""){const t=g5(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function y5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function _5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function b5(n,e=""){const t=y5(n,e);window.open(t,"_blank")}function w5(n,e=""){const t=_5(n,e);window.open(t,"_blank")}function x5(n,e,t=""){switch(n){case"ics":v5(e,t);break;case"google":b5(e,t);break;case"outlook":w5(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}const ey=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},I5={class:"space-y-4"},E5={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},T5={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},A5={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},S5={key:0,class:"space-y-2"},P5={class:"flex flex-wrap gap-2"},R5=["onClick","title"],C5={key:1,class:"text-amber-400 text-sm"},k5={key:0,class:"gmail-web-mockup"},D5={class:"email-content-web"},N5={class:"email-header-web"},O5={class:"email-subject-web"},V5={class:"sender-info-web"},M5={class:"sender-details-web"},L5={class:"sender-name-web"},$5={class:"email-body-web"},F5=["innerHTML"],U5=["value"],j5={key:0,class:"phone-mockup-preview"},B5={class:"phone-screen-preview"},q5={class:"notification-preview-area"},z5={class:"notification-card"},H5={class:"notification-content"},K5={class:"notification-title"},G5={class:"notification-body"},W5={class:"notification-actions"},Q5={key:1,class:"action-item"},J5={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},Y5=["value"],X5={key:2,class:"space-y-3"},Z5={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in"},ej={class:"whitespace-pre-wrap font-sans"},tj={__name:"MessagePreview",props:{mode:{type:String,required:!0,validator:n=>["event","selection"].includes(n)},event:{type:Object,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},selectedPlayers:{type:Array,default:()=>[]},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["update:selectedRecipient"],setup(n,{emit:e}){const t=n,r=e,s=R(!1),i=R("email"),o=R(!1),a=R([]),l=R([]),c=R(null),h=R([]),f=Ue(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),m=Ue(()=>{var D,S;try{const P=(D=c.value)!=null&&D.id&&c.value.id!=="ALL"?t.players.find(ke=>ke.id===c.value.id):null;return!P||!((S=t.event)!=null&&S.id)||!t.seasonId?"[lien désistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(P.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien désistement]"}}),v=Ue(()=>{const D=l.value.map(P=>({...P,hasContact:P.id!=="ALL",missingReason:""})),S=h.value.map(P=>({...P,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...D.filter(P=>P.id!=="ALL"),...S]}),w=Ue(()=>{if(!c.value||c.value.id==="ALL")return!0;const D=v.value.find(S=>(S.id||S.name)===(c.value.id||c.value.name));return!!(D!=null&&D.hasContact)}),x=Ue(()=>{var Re,Pe,Ce,_e;if(!t.event)return"";const D=((Re=c.value)==null?void 0:Re.id)==="ALL"?"":((Pe=c.value)==null?void 0:Pe.name)||"[Nom du joueur]",S=E((Ce=t.event)==null?void 0:Ce.date),P=(_e=t.event)==null?void 0:_e.title,ke=f.value;return t.mode==="event"?dF({playerName:D,eventTitle:P,eventDate:S,eventUrl:ke}):hF({playerName:D,eventTitle:P,eventDate:S,eventUrl:ke})}),A=Ue(()=>x.value),L=Ue(()=>x.value),F=Ue(()=>{var P,ke,Re,Pe,Ce;if(!t.event)return"";const D=E((P=t.event)==null?void 0:P.date),S=((ke=c.value)==null?void 0:ke.id)==="ALL"?"":((Re=c.value)==null?void 0:Re.name)||"[Nom du joueur]";return t.mode==="event"?Vb({recipientName:S,eventTitle:(Pe=t.event)==null?void 0:Pe.title,eventDate:D,eventUrl:f.value,yesUrl:`${f.value}?action=available`,noUrl:`${f.value}?action=unavailable`}).subject:Mb({recipientName:S,eventTitle:(Ce=t.event)==null?void 0:Ce.title,eventDate:D,eventUrl:f.value,noUrl:m.value}).subject}),$=Ue(()=>"HatCast"),B=Ue(()=>{var P,ke,Re,Pe,Ce,_e,le;if(!t.event)return"";const D=E((P=t.event)==null?void 0:P.date),S=((ke=c.value)==null?void 0:ke.id)==="ALL"?"":((Re=c.value)==null?void 0:Re.name)||"[Nom du joueur]";return c.value&&c.value.id&&c.value.id!=="ALL"&&!((Pe=v.value.find(Je=>Je.id===c.value.id))!=null&&Pe.hasContact)?cF({playerName:S,eventTitle:(Ce=t.event)==null?void 0:Ce.title,eventDate:D,eventUrl:f.value}):t.mode==="event"?Vb({recipientName:S,eventTitle:(_e=t.event)==null?void 0:_e.title,eventDate:D,eventUrl:f.value,yesUrl:`${f.value}?action=available`,noUrl:`${f.value}?action=unavailable`}).html:Mb({recipientName:S,eventTitle:(le=t.event)==null?void 0:le.title,eventDate:D,eventUrl:f.value,noUrl:m.value}).html}),ne=Ue(()=>{var P,ke,Re,Pe,Ce;if(!t.event)return"";const D=E((P=t.event)==null?void 0:P.date),S=((ke=c.value)==null?void 0:ke.id)==="ALL"?"":((Re=c.value)==null?void 0:Re.name)||"[Nom du joueur]";return t.mode==="event"?Nb({recipientName:S,eventTitle:(Pe=t.event)==null?void 0:Pe.title,eventDate:D}).title:Ob({recipientName:S,eventTitle:(Ce=t.event)==null?void 0:Ce.title,eventDate:D}).title}),re=Ue(()=>{var Re,Pe,Ce,_e,le,Je;if(!t.event)return"";const D=E((Re=t.event)==null?void 0:Re.date),S=((Pe=c.value)==null?void 0:Pe.id)==="ALL"?"":((Ce=c.value)==null?void 0:Ce.name)||"[Nom du joueur]",P=c.value&&c.value.id&&c.value.id!=="ALL",ke=P?!!((_e=v.value.find(oe=>oe.id===c.value.id))!=null&&_e.hasContact):!0;return P&&!ke?x.value:t.mode==="event"?Nb({recipientName:S,eventTitle:(le=t.event)==null?void 0:le.title,eventDate:D}).body:Ob({recipientName:S,eventTitle:(Je=t.event)==null?void 0:Je.title,eventDate:D}).body});function T(D){c.value=D,r("update:selectedRecipient",D)}function _(){navigator.clipboard.writeText(A.value),o.value=!0,setTimeout(()=>{o.value=!1},2e3)}function E(D){if(!D)return"";const S=new Date(D),P={weekday:"long",day:"numeric",month:"long",year:"numeric"};return S.toLocaleDateString("fr-FR",P)}async function k(){if(!t.seasonId)return;let D=[];t.mode==="selection"?(D=t.players.filter(Re=>t.selectedPlayers.includes(Re.name)),console.log("Mode sélection - targetPlayers:",D)):(D=t.players.filter(Re=>{var Ce;return typeof((Ce=t.availabilityByPlayer)==null?void 0:Ce[Re.name])>"u"}),console.log("Mode événement - targetPlayers:",D));const S=[];for(const Re of D)try{const{getPlayerEmail:Pe}=await on(()=>Promise.resolve().then(()=>rd),void 0),Ce=await Pe(Re.id,t.seasonId);console.log(`Email pour ${Re.name}:`,Ce),Ce&&S.push({...Re,email:Ce})}catch(Pe){console.warn(`Impossible de charger l'email pour ${Re.name}:`,Pe)}console.log("Players avec email:",S),a.value=S;const P={id:"ALL",name:"Tous"};l.value=[P,...S];const ke=D.filter(Re=>!S.find(Pe=>Pe.id===Re.id)).map(Re=>({id:Re.id,name:Re.name}));h.value=ke,console.log("Recipients finaux:",{recipients:l.value,nonContactRecipients:h.value,allDisplayRecipients:v.value})}return En(()=>{k()}),Rt(()=>[t.selectedPlayers,t.availabilityByPlayer],()=>{k()},{deep:!0}),(D,S)=>{var P,ke,Re;return N(),O("div",I5,[d("div",null,[d("label",E5,[S[1]||(S[1]=_t(" Personnes à Prévenir ")),d("button",{onClick:S[0]||(S[0]=Pe=>s.value=!s.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),s.value?(N(),O("div",T5,S[2]||(S[2]=[d("p",{class:"text-blue-200 text-sm"},[_t(" Cette liste montre tous les joueurs ciblés: "),d("span",{class:"text-purple-300"},"« Tous »"),_t(", "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),_t(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),_t(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise « Copier le message » pour leur écrire via un autre moyen (l'URL de l'événement est incluse). ")],-1)]))):ae("",!0),d("div",A5,[v.value.length>0?(N(),O("div",S5,[d("div",P5,[(N(!0),O(ft,null,Mr(v.value,Pe=>(N(),O("button",{key:Pe.id||Pe.name,type:"button",onClick:Ce=>T(Pe),class:wn(["px-3 py-1 rounded text-sm border transition-colors",c.value&&c.value.id===Pe.id?"bg-purple-600 border-purple-500 text-white":Pe.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:Pe.hasContact?"Prévisualiser pour "+Pe.name:Pe.missingReason||"Aucun canal actif"},te(Pe.name),11,R5))),128))])])):(N(),O("div",C5," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[S[17]||(S[17]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Message à copier :",-1)),i.value==="email"?(N(),O("div",{key:0,class:wn(w.value||((P=c.value)==null?void 0:P.id)==="ALL"?"":"space-y-3")},[w.value||((ke=c.value)==null?void 0:ke.id)==="ALL"?(N(),O("div",k5,[S[9]||(S[9]=Nn('<div class="gmail-top-bar" data-v-846d0d1f><div class="gmail-nav-left" data-v-846d0d1f><span class="back-arrow" data-v-846d0d1f>←</span></div><div class="gmail-nav-center" data-v-846d0d1f><span class="nav-arrows" data-v-846d0d1f>←</span><span class="email-counter" data-v-846d0d1f>1 sur 1</span><span class="nav-arrows" data-v-846d0d1f>→</span></div><div class="gmail-nav-right" data-v-846d0d1f><span class="action-icon" data-v-846d0d1f>▼</span><span class="action-icon" data-v-846d0d1f>⋮</span></div></div>',1)),d("div",D5,[d("div",N5,[d("div",O5,[d("h1",null,te(F.value),1),S[3]||(S[3]=d("div",{class:"inbox-tag-web"},[_t(" Boîte de réception "),d("span",{class:"close-icon"},"×")],-1))]),d("div",V5,[S[6]||(S[6]=d("div",{class:"sender-avatar-web"},[d("img",{src:Nm,alt:"HatCast",class:"avatar-logo"})],-1)),d("div",M5,[d("div",L5,[_t(te($.value)+" ",1),S[4]||(S[4]=d("span",{class:"sender-email"},"<noreply@hatcast.app>",-1))]),S[5]||(S[5]=d("div",{class:"recipient-info-web"},[_t(" à moi "),d("span",{class:"dropdown-arrow"},"▼")],-1))]),S[7]||(S[7]=d("div",{class:"sender-time-web"},"5:23 PM (il y a 25 minutes)",-1)),S[8]||(S[8]=d("div",{class:"email-actions-web"},[d("span",{class:"action-icon"},"☆"),d("span",{class:"action-icon"},"⋮")],-1))])]),d("div",$5,[d("div",{class:"email-text-web",innerHTML:B.value},null,8,F5)])])])):(N(),O(ft,{key:1},[S[10]||(S[10]=d("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal. ",-1)),d("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:L.value,rows:"5",readonly:""},null,8,U5)],64))],2)):i.value==="push"?(N(),O("div",{key:1,class:wn(c.value&&c.value.id!=="ALL"&&!w.value?"text-white":"")},[c.value&&c.value.id!=="ALL"&&!w.value?(N(),O(ft,{key:1},[d("div",J5,te((Re=c.value)==null?void 0:Re.name)+" n'a pas installé l'appli. Envoie-lui ce message manuellement. ",1),d("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:L.value,rows:"5",readonly:""},null,8,Y5)],64)):(N(),O("div",j5,[d("div",B5,[S[15]||(S[15]=Nn('<div class="phone-status-bar" data-v-846d0d1f><div class="status-left" data-v-846d0d1f><span class="time" data-v-846d0d1f>9:41</span></div><div class="status-right" data-v-846d0d1f><span class="signal" data-v-846d0d1f>📶</span><span class="battery" data-v-846d0d1f>🔋</span><span class="notification-dot" data-v-846d0d1f>🔔</span></div></div>',1)),d("div",q5,[d("div",z5,[S[13]||(S[13]=d("div",{class:"notification-header"},[d("div",{class:"notification-icon"},"🔔"),d("div",{class:"notification-source"},"HatCast • 16 min")],-1)),d("div",H5,[d("div",K5,te(ne.value),1),d("div",G5,te(re.value),1)]),d("div",W5,[n.mode==="event"?(N(),O(ft,{key:0},[S[11]||(S[11]=Nn('<div class="action-item" data-v-846d0d1f><span class="action-icon" data-v-846d0d1f>✅</span><span class="action-text" data-v-846d0d1f>Dispo</span></div><div class="action-item" data-v-846d0d1f><span class="action-icon" data-v-846d0d1f>❌</span><span class="action-text" data-v-846d0d1f>Pas dispo</span></div>',2))],64)):(N(),O("div",Q5,S[12]||(S[12]=[d("span",{class:"action-icon"},"❌",-1),d("span",{class:"action-text"},"Plus dispo",-1)])))]),S[14]||(S[14]=d("div",{class:"notification-avatar"},[d("img",{src:Nm,alt:"HatCast",class:"notification-logo"})],-1))])]),S[16]||(S[16]=d("div",{class:"phone-app-content"},[d("div",{class:"app-header"},[d("h3",null,"📱 HatCast"),d("p",null,"Votre application en arrière-plan")])],-1))])]))],2)):i.value==="copy"?(N(),O("div",X5,[o.value?(N(),O("div",Z5," ✅ Copié ! ")):ae("",!0),d("div",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm cursor-pointer hover:bg-gray-700 transition-colors",onClick:_,title:"Cliquer pour copier le texte"},[d("pre",ej,te(A.value),1)])])):ae("",!0)])])}}},nj=ey(tj,[["__scopeId","data-v-846d0d1f"]]);const rj={class:"relative p-5 pb-4 border-b border-white/10"},sj={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},ij={class:"hidden sm:inline"},oj={key:0,class:"text-sm text-purple-300 mt-1"},aj={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},lj={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},uj={class:"flex items-center gap-2 w-full"},cj=["disabled"],dj={key:0},hj={key:1,class:"inline-flex items-center gap-2"},fj=["title"],pj={key:0},mj={key:1},gj={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e,s=R(!1),i=R("Copier le message"),o=R(!1),a=Ue(()=>t.sending||o.value),l=R(null);function c(){r("close")}function h(w){var A;return w?(typeof w=="string"?new Date(w):((A=w.toDate)==null?void 0:A.call(w))||w).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function f(){const w="Message à copier depuis MessagePreview";navigator.clipboard.writeText(w).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(x=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function m(w){l.value=w}async function v(){if(t.event){o.value=!0;try{const w=l.value&&l.value.id!=="ALL"?"single":"all",x=w==="single"?{id:l.value.id,name:l.value.name,email:l.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:w,recipient:x}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:w,recipient:x})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{setTimeout(()=>{o.value=!1},1e3)}}}return Rt(()=>t.sending,w=>{w||(o.value=!1)}),(w,x)=>n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:c},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:x[0]||(x[0]=pt(()=>{},["stop"]))},[d("div",rj,[d("button",{onClick:c,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",sj,[d("span",ij,te(n.mode==="selection"?"📣":"📢"),1),d("span",null,te(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1)]),n.event?(N(),O("p",oj,te(n.event.title)+" — "+te(h(n.event.date)),1)):ae("",!0)]),d("div",aj,[Ye(nj,{mode:n.mode,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,"selected-players":n.selectedPlayers,"availability-by-player":n.availabilityByPlayer,"onUpdate:selectedRecipient":m},null,8,["mode","event","season-id","season-slug","players","selected-players","availability-by-player"])]),d("div",lj,[d("div",uj,[d("button",{onClick:v,disabled:a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(N(),O("span",hj,x[2]||(x[2]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),_t(" Envoi en cours... ")]))):(N(),O("span",dj,x[1]||(x[1]=[d("span",{class:"hidden sm:inline"},"🔔 Envoyer les notifications",-1),d("span",{class:"sm:hidden"},"🔔 Envoyer",-1)])))],8,cj),d("button",{onClick:f,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(N(),O("span",mj,"✅ Copié")):(N(),O("span",pj,x[3]||(x[3]=[d("span",{class:"hidden sm:inline"},"📋 Copier le message",-1),d("span",{class:"sm:hidden"},"📋 Copier",-1)])))],8,fj)]),d("button",{onClick:c,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ae("",!0)}},lA=ey(gj,[["__scopeId","data-v-ea1d3ed1"]]),vj={class:"relative p-6 pb-4 border-b border-white/10"},yj={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},_j={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=pt(()=>{},["stop"]))},[d("div",vj,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manière simple et apaisée")])],-1))]),s[5]||(s[5]=Nn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),d("div",yj,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ae("",!0)}},bj={class:"text-center mb-6"},wj={class:"text-lg text-gray-300"},xj={class:"mb-6"},Ij={class:"space-y-4"},Ej={class:"flex items-center gap-2 text-gray-300 text-sm"},Tj=["disabled"],Aj={key:0,class:"animate-spin"},Sj={key:1},Pj={class:"mb-6 text-center"},Rj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Cj={class:"text-red-300 text-sm"},kj={class:"text-center mb-6"},Dj={class:"text-lg text-gray-300"},Nj={class:"mb-6"},Oj=["disabled"],Vj={key:0,class:"animate-spin"},Mj={key:1},Lj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},$j={class:"text-red-300 text-sm"},Fj={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Uj={class:"text-green-300 text-sm"},jj={class:"flex justify-center"},ty={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=R(""),i=R(!1),o=R(""),a=R(!1),l=R(""),c=R(""),h=R(null),f=R(!0);async function m(){if(s.value){i.value=!0,o.value="";try{const x=await km(t.seasonId);if(s.value===x){if(f.value)try{ho.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),w();return}if(await eA(t.player.id,s.value,t.seasonId)){if(f.value)try{ho.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),w()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(x){U.error("Erreur lors de la vérification",x),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const x=await nA(t.player.id,t.seasonId);c.value=x.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(x){U.error("Erreur lors de l'envoi de l'email",x),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function w(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Rt(()=>t.show,x=>{x&&Zt(()=>{h.value&&h.value.focus()})}),(x,A)=>{var L,F;return N(),O(ft,null,[n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:w},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[3]||(A[3]=pt(()=>{},["stop"]))},[d("div",bj,[A[7]||(A[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔐")],-1)),A[8]||(A[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),d("p",wj,te((L=n.player)==null?void 0:L.name),1),A[9]||(A[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),d("div",xj,[d("div",Ij,[d("div",null,[A[10]||(A[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(d("input",{"onUpdate:modelValue":A[0]||(A[0]=$=>s.value=$),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:rr(m,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Mt,s.value]])]),d("div",Ej,[lt(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":A[1]||(A[1]=$=>f.value=$),class:"w-4 h-4"},null,512),[[Gi,f.value]]),A[11]||(A[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),d("button",{onClick:m,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(N(),O("span",Aj,"⏳")):(N(),O("span",Sj,"🔓")),d("span",null,te(i.value?"Vérification...":"Vérifier"),1)],8,Tj)]),d("div",Pj,[d("button",{onClick:A[2]||(A[2]=$=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(N(),O("div",Rj,[d("div",Cj,te(o.value),1)])):ae("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ae("",!0),a.value?(N(),O("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:A[6]||(A[6]=$=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[5]||(A[5]=pt(()=>{},["stop"]))},[d("div",kj,[A[12]||(A[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"📧")],-1)),A[13]||(A[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),d("p",Dj,te((F=n.player)==null?void 0:F.name),1)]),d("div",Nj,[A[14]||(A[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(N(),O("span",Vj,"⏳")):(N(),O("span",Mj,"📧")),d("span",null,te(i.value?"Envoi...":"Envoyer l'email"),1)],8,Oj)]),l.value?(N(),O("div",Lj,[d("div",$j,te(l.value),1)])):ae("",!0),c.value?(N(),O("div",Fj,[d("div",Uj,te(c.value),1)])):ae("",!0),d("div",jj,[d("button",{onClick:A[4]||(A[4]=$=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0)],64)}}},Bj={class:"text-center mb-6"},qj={class:"text-sm text-gray-300"},zj={key:0,class:"space-y-4"},Hj={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},Kj={key:1,class:"space-y-4"},Gj=["disabled"],Wj={key:0,class:"animate-spin"},Qj={key:1},Jj={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},Yj={class:"mt-6 flex justify-center gap-3"},Xj=["disabled"],Zj={key:0,class:"animate-spin"},eB={key:1},uA={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=R(1),i=R(""),o=R(""),a=R(""),l=R(!1),c=R(""),h=R(!1),f=Ea(),m=Ue(()=>i.value&&i.value.includes("@")),v=Ue(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function w(){var F,$,B;if(!(!m.value||!((F=t.player)!=null&&F.id))){l.value=!0,c.value="";try{const ne=await Q1({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),re=($=f.params)==null?void 0:$.slug,T=`${ne.url}${re?`&slug=${encodeURIComponent(re)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await gF({toEmail:i.value,playerName:((B=t.player)==null?void 0:B.name)||"joueur",verifyUrl:T}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function x(){try{await Y1({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function A(){var F;try{const $=await Zl((F=t.player)==null?void 0:F.id,t.seasonId);$!=null&&$.email&&($!=null&&$.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}En(()=>{A()}),Rt(()=>t.show,F=>{F&&A()});async function L(){if(v.value){l.value=!0,c.value="";try{await W1(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(F){c.value=(F==null?void 0:F.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(F,$)=>{var B;return n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:$[6]||($[6]=ne=>F.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:$[5]||($[5]=pt(()=>{},["stop"]))},[d("button",{onClick:$[0]||($[0]=ne=>F.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",Bj,[$[7]||($[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),$[8]||($[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",qj,"Pour sécuriser les saisies de "+te((B=n.player)==null?void 0:B.name),1),Ye($1)]),s.value===1?(N(),O("div",zj,[d("div",null,[$[9]||($[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),lt(d("input",{"onUpdate:modelValue":$[1]||($[1]=ne=>i.value=ne),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Mt,i.value]])]),h.value?(N(),O("div",Hj,[$[10]||($[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+te(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ae("",!0)])):s.value===2?(N(),O("div",Kj,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[$[11]||($[11]=d("span",null,"✅",-1)),$[12]||($[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:x,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[$[13]||($[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),lt(d("input",{"onUpdate:modelValue":$[2]||($[2]=ne=>o.value=ne),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Mt,o.value]])]),d("div",null,[$[14]||($[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),lt(d("input",{"onUpdate:modelValue":$[3]||($[3]=ne=>a.value=ne),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Mt,a.value]])]),d("button",{onClick:L,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(N(),O("span",Wj,"⏳")):(N(),O("span",Qj,"🔒")),d("span",null,te(l.value?"Association...":"Associer ce joueur"),1)],8,Gj)])):ae("",!0),c.value?(N(),O("div",Jj,te(c.value),1)):ae("",!0),d("div",Yj,[s.value===1?(N(),O("button",{key:0,onClick:w,disabled:!m.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(N(),O("span",Zj,"⏳")):(N(),O("span",eB,"✉️")),d("span",null,te(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,Xj)):ae("",!0),d("button",{onClick:$[4]||($[4]=ne=>F.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ae("",!0)}}},tB={class:"text-center mb-6"},nB={class:"text-2xl font-bold text-white mb-2"},rB={class:"text-lg text-gray-300"},sB={class:"mb-6"},iB={class:"flex items-center space-x-3"},oB={class:"text-2xl"},aB={class:"font-semibold text-white"},lB={class:"text-sm text-gray-300"},uB={key:0,class:"mb-6"},cB={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},dB={class:"text-red-300 text-sm"},hB={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},fB={class:"text-green-300 text-sm"},pB={class:"flex justify-center gap-3"},mB=["disabled"],gB={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=R(!1),i=R(!1),o=R(!1),a=R(""),l=R(""),c=R(!1);Ea();const h=R(!1);Ue(()=>!1),Ue(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function m(){var L;if((L=t.player)!=null&&L.id){s.value=await Zi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:F}=await on(()=>Promise.resolve().then(()=>rd),void 0);i.value=F(t.player.id)}catch{i.value=!1}}}function v(){var L;a.value="";try{if((L=t.player)!=null&&L.id&&ta(t.player.id)){w();return}}catch{}h.value=!0}async function w(){o.value=!0,a.value="",l.value="";try{const L=await X1(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,L.email&&(email.value=L.email),r("update")}catch(L){logger.error("Erreur lors de la désactivation de la protection",L),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function x(){h.value=!1,w()}function A(){r("close")}return Rt(()=>t.player,()=>{t.show&&t.player&&m()},{immediate:!0}),Rt(()=>t.show,L=>{L&&t.player&&(a.value="",l.value="",h.value=!1,m(),t.onboarding&&Zt(()=>{}))}),(L,F)=>{var $;return N(),O(ft,null,[n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:A},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:F[1]||(F[1]=pt(()=>{},["stop"]))},[d("button",{onClick:A,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",tB,[F[4]||(F[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",nB,te(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",rB,te(($=n.player)==null?void 0:$.name),1)]),d("div",sB,[d("div",{class:wn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",iB,[d("span",oB,te(s.value?"🔒":"🔓"),1),d("div",null,[d("div",aB,te(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),d("div",lB,te(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ae("",!0):(N(),O("div",uB,F[5]||(F[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(N(),O("div",cB,[d("div",dB,te(a.value),1)])):ae("",!0),l.value?(N(),O("div",hB,[d("div",fB,te(l.value),1)])):ae("",!0),d("div",pB,[s.value?(N(),O("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,mB)):(N(),O("button",{key:0,onClick:F[0]||(F[0]=B=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),Ye(uA,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:F[2]||(F[2]=B=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Ye(ty,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:F[3]||(F[3]=B=>h.value=!1),onVerified:x},null,8,["show","player","seasonId"])],64)}}};const vB={class:"relative p-4 md:p-6 border-b border-white/10"},yB={class:"flex items-start gap-4 md:gap-6"},_B={class:"flex-1 min-w-0"},bB={class:"flex items-center gap-3 mb-2"},wB={class:"text-xl md:text-2xl font-bold text-white leading-tight"},xB={class:"flex items-center gap-2"},IB={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},EB={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},TB={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},AB={class:"grid grid-cols-3 gap-3 md:gap-4"},SB={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},PB={class:"text-xl md:text-2xl font-bold text-white"},RB={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},CB={class:"text-xl md:text-2xl font-bold text-white"},kB={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},DB={class:"text-xl md:text-2xl font-bold text-white"},NB={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},OB={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},VB={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},MB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},LB={class:"mb-6"},$B={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=R(!1),o=R(""),a=R(null),l=R(!1),c=R(!1),h=R(null);R(!1);const f=R(!1),m=R(!1),v=R(null),w=R(null),x=R({position:"fixed",top:"0px",left:"0px"}),A=R(null),L=R({position:"fixed",top:"0px",left:"0px"}),F=R(!1),$=R(!1);function B(){s("close"),f.value=!1,m.value=!1,x.value={position:"fixed",top:"0px",left:"0px"},L.value={position:"fixed",top:"0px",left:"0px"}}function ne(){var _e;o.value=((_e=r.player)==null?void 0:_e.name)||"",i.value=!0,Zt(()=>{a.value&&a.value.focus()})}function re(){i.value=!1,o.value=""}async function T(){var le,Je;if(!o.value.trim())return;if(await Zi((le=r.player)==null?void 0:le.id,r.seasonId)){ta((Je=r.player)==null?void 0:Je.id)?_():(h.value="update",c.value=!0);return}_()}function _(){var _e;s("update",{playerId:(_e=r.player)==null?void 0:_e.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function E(){var le,Je;if(await Zi((le=r.player)==null?void 0:le.id,r.seasonId)){ta((Je=r.player)==null?void 0:Je.id)?k():(h.value="delete",c.value=!0);return}k()}function k(){var _e;s("delete",(_e=r.player)==null?void 0:_e.id)}function D(){s("refresh")}function S(_e){h.value==="update"?_():h.value==="delete"&&k(),h.value=null}function P(){try{const _e=v.value;if(!_e)return;const le=_e.getBoundingClientRect(),Je=8;if(window.innerWidth>768){const oe=Math.max(Je,Math.round(le.top-Je)),Z=Math.max(Je,Math.round(le.left));x.value={position:"fixed",top:`${oe}px`,left:`${Z}px`,zIndex:400}}else{const oe=Math.min(window.innerHeight-Je,Math.round(le.bottom+Je)),Z=Math.max(Je,Math.round(le.left));x.value={position:"fixed",top:`${oe}px`,left:`${Z}px`,zIndex:400}}}catch{}}function ke(){try{const oe=Math.max(8,window.innerHeight-8-48-120),Z=Math.max(8,Math.round(window.innerWidth-200-8));L.value={position:"fixed",top:`${oe}px`,left:`${Z}px`,zIndex:400}}catch{}}function Re(){f.value=!f.value,f.value&&Zt(()=>P())}function Pe(){m.value=!m.value,m.value&&Zt(()=>ke())}Rt(()=>r.show,_e=>{var le;_e||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,m.value=!1),_e&&((le=r.player)!=null&&le.id)&&(Zi(r.player.id,r.seasonId).then(Je=>{F.value=!!Je}),on(()=>Promise.resolve().then(()=>rd),void 0).then(Je=>{try{$.value=!!Je.isPlayerPasswordCached(r.player.id)}catch{$.value=!1}}))}),En(()=>{document.addEventListener("click",_e=>{if(f.value){const le=v.value,Je=w.value,oe=le&&le.contains(_e.target),Z=Je&&Je.contains(_e.target);!oe&&!Z&&(f.value=!1)}if(m.value){const le=A.value;le&&le.contains(_e.target)||(m.value=!1)}}),document.addEventListener("keydown",_e=>{_e.key==="Escape"&&(f.value&&(f.value=!1),m.value&&(m.value=!1))}),window.addEventListener("resize",()=>{f.value&&P(),m.value&&ke()}),window.addEventListener("scroll",()=>{f.value&&P(),m.value&&ke()},{passive:!0})}),e({openProtection(){l.value=!0}});const Ce=R({position:null});return Rt(()=>r.show,_e=>{_e&&r.onboardingStep===4?Zt(()=>{const le=document.querySelectorAll("button");let Je=null;if(le.forEach(oe=>{!Je&&oe.textContent&&oe.textContent.includes("Protection")&&(Je=oe)}),Je){const oe=Je.getBoundingClientRect();Ce.value.position={x:Math.round(oe.right+8),y:Math.round(oe.top+window.scrollY-4)}}}):_e||(Ce.value.position=null)}),(_e,le)=>{var Je;return N(),O(ft,null,[n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:B},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:le[6]||(le[6]=pt(()=>{},["stop"]))},[d("div",vB,[d("button",{onClick:B,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",yB,[le[15]||(le[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",_B,[d("div",bB,[d("h2",wB,te((Je=n.player)==null?void 0:Je.name),1),d("div",xB,[n.isProtected?(N(),O("div",IB,le[13]||(le[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ae("",!0),n.isPreferred?(N(),O("div",EB,le[14]||(le[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ae("",!0)])])])])]),d("div",TB,[d("div",null,[d("div",AB,[d("div",SB,[d("div",PB,te(r.stats.availability),1),le[16]||(le[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",RB,[d("div",CB,te(r.stats.selection),1),le[17]||(le[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",kB,[d("div",DB,te(r.stats.ratio),1),le[18]||(le[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",NB,[d("button",{onClick:le[0]||(le[0]=oe=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,te(F.value?"🔓":"🔒"),1),d("span",null,te(F.value?"Déverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[d("button",{onClick:le[1]||(le[1]=oe=>Re()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},le[19]||(le[19]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:B,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(N(),Gs(nc,{to:"body"},[f.value?(N(),O("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:w,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Vr(x.value)},[d("button",{onClick:le[2]||(le[2]=oe=>{ne(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},le[20]||(le[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:le[3]||(le[3]=oe=>{E(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},le[21]||(le[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ae("",!0)]))])]),d("div",OB,[d("button",{onClick:le[4]||(le[4]=oe=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},te(F.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),d("button",{onClick:le[5]||(le[5]=oe=>Pe()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:B,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ae("",!0),(N(),Gs(nc,{to:"body"},[m.value?(N(),O("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:A,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Vr(L.value)},[d("button",{onClick:le[7]||(le[7]=oe=>{ne(),m.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},le[22]||(le[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:le[8]||(le[8]=oe=>{E(),m.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},le[23]||(le[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ae("",!0)])),i.value?(N(),O("div",VB,[d("div",MB,[le[25]||(le[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),d("div",LB,[le[24]||(le[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),lt(d("input",{"onUpdate:modelValue":le[9]||(le[9]=oe=>o.value=oe),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[rr(re,["esc"]),rr(T,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Mt,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:re,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ae("",!0),Ye(gB,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:le[10]||(le[10]=oe=>l.value=!1),onUpdate:D,onOnboardingFinished:le[11]||(le[11]=oe=>_e.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Ye(ty,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:le[12]||(le[12]=oe=>c.value=!1),onVerified:S},null,8,["show","player","seasonId"])],64)}}},FB=ey($B,[["__scopeId","data-v-8237d7ee"]]),UB={class:"relative p-6 pb-4 border-b border-white/10"},jB={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},BB={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=pt(()=>{},["stop"]))},[d("div",UB,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=Nn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",jB,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ae("",!0)}},qB={class:"relative p-4 md:p-6 border-b border-white/10"},zB={class:"flex items-start gap-4 md:gap-6"},HB={class:"flex-1 min-w-0"},KB={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},GB={class:"flex items-center gap-3"},WB={class:"text-base md:text-lg text-purple-300"},QB={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},JB={class:"text-blue-200"},YB={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},XB={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},ZB={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},eq={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},tq={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},nq={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},rq={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},sq={class:"text-xl md:text-2xl font-bold text-yellow-300"},iq={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},oq={class:"text-xl md:text-2xl font-bold text-white"},aq={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},lq={class:"text-xl md:text-2xl font-bold text-white"},uq={class:"mb-3"},cq={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},dq={key:0,class:"flex items-center justify-between gap-2"},hq=["title"],fq={key:0,class:"text-purple-400 mr-2"},pq={key:1,class:"text-green-400 mr-2"},mq={key:2,class:"text-red-400 mr-2"},gq={key:3,class:"text-gray-400 mr-2"},vq=["onClick"],yq={key:1,class:"flex items-center justify-center"},_q=["onChange"],bq=["value"],wq=["onClick"],xq={key:0,class:"mb-3"},Iq={key:1,class:"mb-3"},Eq={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},Tq={class:"flex-1"},Aq={class:"text-blue-300 text-sm font-medium"},Sq={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Pq=["disabled","title"],Rq=["disabled"],Cq={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=R(!1),o=R("Copier le message"),a=R(!1),l=R(!1),c=R(""),h=R(!1),f=R(!1),m=Ue(()=>{var oe;return((oe=r.event)==null?void 0:oe.playerCount)||6}),v=R([]),w=R(null),x=Ue(()=>(r.players||[]).map(oe=>oe.name).filter(oe=>{var Z;return((Z=r.playerAvailability)==null?void 0:Z[oe])===!0}).sort((oe,Z)=>oe.localeCompare(Z,"fr",{sensitivity:"base"})));function A(oe){const Z=new Set(v.value.filter(Boolean)),Le=v.value[oe];return Le&&Z.delete(Le),x.value.filter(ut=>!Z.has(ut))}function L(oe){w.value=oe}function F(){w.value=null}async function $(oe,Z){var ut;const Le=((ut=oe==null?void 0:oe.target)==null?void 0:ut.value)||"";Le&&(v.value[Z]=Le,await D()),w.value=null}async function B(oe){v.value[oe]=null,await D()}Ue(()=>(A(-1).length<m.value,""));const ne=Ue(()=>r.currentSelection&&r.currentSelection.length>0);function re(){var ut;const oe=r.currentSelection||[],Z=((ut=r.event)==null?void 0:ut.playerCount)||6,Le=r.availableCount||0;if(oe.length>0){const At=oe.some(J=>!Re(J)),Yt=Le<Z;if(At||Yt)return{type:"incomplete",hasUnavailablePlayers:At,hasInsufficientPlayers:Yt,unavailablePlayers:oe.filter(J=>!Re(J)),availableCount:Le,requiredCount:Z}}return Le<Z?{type:"insufficient",availableCount:Le,requiredCount:Z}:oe.length===0?{type:"ready",availableCount:Le,requiredCount:Z}:{type:"complete",availableCount:Le,requiredCount:Z}}const T=Ue(()=>{var ut;if(!ne.value)return!1;const oe=r.currentSelection.some(At=>!Re(At)),Z=((ut=r.event)==null?void 0:ut.playerCount)||6,Le=r.availableCount<Z;return oe||Le});Ue(()=>{var Le;if(!T.value)return"";const oe=r.currentSelection.filter(ut=>!Re(ut)),Z=((Le=r.event)==null?void 0:Le.playerCount)||6;return oe.length>0?oe.length===1?`${oe[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${oe.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<Z?`Seulement ${r.availableCount} joueurs disponibles pour ${Z} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),Ue(()=>{if(!r.event||!ne.value)return"";const oe=_(r.event.date),Z=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${oe} : ${Z}`}),Rt(()=>r.show,oe=>{if(oe){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const Z=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Le=m.value;v.value=Array.from({length:Le},(ut,At)=>Z[At]||null),w.value=null}}),Rt([m,()=>r.currentSelection,()=>{var oe;return(oe=r.event)==null?void 0:oe.id}],()=>{if(!r.show)return;const oe=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Z=m.value,Le=Array.from({length:Z},(ut,At)=>oe[At]||v.value[At]||null);v.value=Le.slice(0,Z)});function _(oe){var Le;return oe?(typeof oe=="string"?new Date(oe):((Le=oe.toDate)==null?void 0:Le.call(oe))||oe).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function E(){s("selection")}function k(){s("perfect")}async function D(){var oe;if(!(!((oe=r.event)!=null&&oe.id)||!r.seasonId))try{const Z=v.value.filter(Boolean);await Um(r.event.id,Z,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(Z){console.error("Erreur lors de la sauvegarde automatique:",Z)}}function S(){s("close")}function P(){a.value=!0}function ke(){f.value=!0}function Re(oe){return r.playerAvailability[oe]===!0}function Pe(oe){return r.playerAvailability[oe]===!1}function Ce(oe){return r.currentSelection.includes(oe)&&Re(oe)}function _e(oe=!1,Z=!1){if(h.value=oe,oe){const Le=_(r.event.date),ut=r.currentSelection.join(", ");Z?c.value=`Sélection mise à jour pour ${r.event.title} du ${Le} : ${ut}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Le} : ${ut}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function le(){l.value=!1}e({showSuccess:_e});function Je(oe){s("send-notifications",oe)}return(oe,Z)=>{var Le,ut,At,Yt;return N(),O(ft,null,[n.show?(N(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:S},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:Z[1]||(Z[1]=pt(()=>{},["stop"]))},[d("div",qB,[d("button",{onClick:S,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",zB,[Z[9]||(Z[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",HB,[d("h2",KB,"Sélection pour "+te((Le=n.event)==null?void 0:Le.title),1),d("div",GB,[d("p",WB,te(_((ut=n.event)==null?void 0:ut.date)),1),d("div",QB,[Z[4]||(Z[4]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",JB,te(((At=n.event)==null?void 0:At.playerCount)||6)+" joueurs",1)]),re().type==="ready"?(N(),O("div",YB,Z[5]||(Z[5]=[d("span",{class:"text-blue-300 text-xs"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):re().type==="complete"?(N(),O("div",XB,Z[6]||(Z[6]=[d("span",{class:"text-green-300 text-xs"},"✅",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):re().type==="incomplete"?(N(),O("div",ZB,Z[7]||(Z[7]=[d("span",{class:"text-orange-300 text-xs"},"⚠️",-1),d("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):re().type==="insufficient"?(N(),O("div",eq,Z[8]||(Z[8]=[d("span",{class:"text-red-300 text-xs"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ae("",!0)])])])]),d("div",tq,[d("div",nq,[d("div",rq,[d("div",sq,te(Math.max((((Yt=n.event)==null?void 0:Yt.playerCount)||6)-n.selectedCount,0)),1),Z[10]||(Z[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",iq,[d("div",oq,te(n.availableCount),1),Z[11]||(Z[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",aq,[d("div",lq,te(n.selectedCount),1),Z[12]||(Z[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",uq,[d("div",{class:"flex items-center gap-2 mb-2"},[Z[14]||(Z[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),d("button",{onClick:ke,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},Z[13]||(Z[13]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",cq,[(N(!0),O(ft,null,Mr(v.value,(J,xe)=>(N(),O("div",{key:"sel-slot-"+xe,class:wn(["relative p-3 rounded-lg border text-center transition-colors",J?["bg-gradient-to-r",Pe(J)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":Re(J)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[J?(N(),O("div",dq,[d("div",{class:"flex-1 text-white font-medium truncate",title:J},[Ce(J)?(N(),O("span",fq,"🎭")):Re(J)?(N(),O("span",pq,"✅")):Pe(J)?(N(),O("span",mq,"❌")):(N(),O("span",gq,"–")),_t(" "+te(J),1)],8,hq),d("button",{onClick:ve=>B(xe),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,vq)])):(N(),O("div",yq,[w.value===xe?(N(),O("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:ve=>$(ve,xe),onBlur:Z[0]||(Z[0]=ve=>F())},[Z[15]||(Z[15]=d("option",{value:""},"— Choisir —",-1)),(N(!0),O(ft,null,Mr(A(xe),ve=>(N(),O("option",{key:ve,value:ve},te(ve),9,bq))),128))],40,_q)):(N(),O("button",{key:1,onClick:ve=>L(xe),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},Z[16]||(Z[16]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,wq))]))],2))),128))])]),ne.value?(N(),O("div",xq,Z[17]||(Z[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},"⚠️"),d("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ae("",!0),l.value?(N(),O("div",Iq,[d("div",Eq,[Z[19]||(Z[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",Tq,[d("p",Aq,te(c.value),1)]),d("button",{onClick:le,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},Z[18]||(Z[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ae("",!0)]),d("div",Sq,[d("button",{onClick:E,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":ne.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},Z[20]||(Z[20]=[_t(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,Pq),d("button",{onClick:P,disabled:!ne.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},Z[21]||(Z[21]=[_t(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,Rq),d("button",{onClick:k,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},Z[22]||(Z[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ae("",!0),Ye(lA,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:Z[2]||(Z[2]=J=>a.value=!1),onSendNotifications:Je},null,8,["show","event","season-id","season-slug","players","selected-players"]),Ye(BB,{show:f.value,onClose:Z[3]||(Z[3]=J=>f.value=!1)},null,8,["show"])],64)}}},kq={class:"flex items-center justify-center"},Dq=["title"],Nq={key:0,class:"text-center"},Oq={key:1,class:"text-center"},Vq={key:2,class:"text-center"},Mq={key:3,class:"text-center text-gray-400"},Fb={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=R(!1),i=Ue(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Ue(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(N(),O("div",{class:wn(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",kq,[i.value&&s.value?(N(),O("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},te(n.chancePercent)+"% ",9,Dq)):(N(),O(ft,{key:1},[n.isSelected&&n.isAvailable===!0?(N(),O("span",Nq," Joue ")):n.isAvailable===!0?(N(),O("span",Oq," Disponible ")):n.isAvailable===!1?(N(),O("span",Vq," Pas disponible ")):(N(),O("span",Mq," – "))],64))])],34))}},Lq={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},$q={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},Fq={class:"text-2xl md:text-3xl font-bold text-white mb-3"},Uq={class:"text-gray-300 mb-6"},jq={class:"flex flex-col items-stretch justify-center gap-3"},Bq=["value"],qq={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Ue(()=>`${s}/season/${t.seasonSlug}`),o=R(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Ue(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Ue(()=>a.value>0),c=R(l.value);Rt(a,A=>{c.value=A>0});const h=Ue(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Ue(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function m(){c.value=!1,r("create-event")}function v(){c.value=!1,r("add-player")}function w(){var A;try{(A=navigator.clipboard)==null||A.writeText(i.value)}catch{}r("copy-link")}async function x(){try{if(t.seasonId){const{db:A}=await on(()=>Promise.resolve().then(()=>Xi),void 0),{doc:L,updateDoc:F}=await on(()=>import("./index.esm-22da11e6.js"),[]);await F(L(A,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(A,L)=>l.value&&c.value?(N(),O("div",Lq,[d("div",$q,[L[1]||(L[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",Fq,te(h.value),1),d("p",Uq,te(f.value),1),d("div",jq,[a.value===1?(N(),O("button",{key:0,onClick:m,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(N(),O("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(N(),O(ft,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:L[0]||(L[0]=F=>F.target.select())},null,40,Bq),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:w,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:x,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ae("",!0)])])])):ae("",!0)}},zq={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},Hq={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},Kq={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},Gq={class:"hidden md:flex items-center gap-2"},Wq={class:"md:hidden"},Qq={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=R(null),i=Ue(()=>{var x;return!!s.value&&!((x=s.value)!=null&&x.isAnonymous)}),o=Ue(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(x){s.value=x}En(()=>{s.value=Ge.currentUser;const x=Ge.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=x}),Ks(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function m(){r("open-notifications")}function v(){r("open-players")}function w(){r("logout")}return(x,A)=>(N(),O("div",zq,[d("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},A[0]||(A[0]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",Hq,te(n.seasonName?n.seasonName:"Chargement..."),1),d("div",Kq,[d("div",Gq,[Ye(Fm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:m,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ae("",!0):(N(),O("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},A[1]||(A[1]=[d("span",{class:"text-2xl"},"❓",-1)])))]),d("div",Wq,[Ye(Fm,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:m,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}};const Jq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},Yq={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},Xq={class:"flex items-stretch relative"},Zq={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},e9={class:"flex-1 overflow-hidden"},t9=["data-event-id"],n9=["title","onClick"],r9={class:"flex flex-col items-center flex-1 justify-center"},s9={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},i9={key:0,class:"mt-1 text-xs text-gray-400"},o9={class:"relative"},a9=["onClick","title"],l9={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},u9={class:"p-2"},c9=["onClick"],d9=["onClick"],h9=["onClick"],f9={class:"flex flex-col items-center mt-2"},p9={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},m9=["title","onClick"],g9=["title","onClick"],v9=["title","onClick"],y9=["title","onClick"],_9=["title","aria-label"],b9={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},w9={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},x9={key:0,class:"pointer-events-none"},I9={class:"flex items-center justify-between"},E9={key:1,class:"pointer-events-none"},T9={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},A9={class:"flex items-center justify-between"},S9={key:2,class:"pointer-events-none"},P9={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},R9={class:"flex items-center justify-between"},C9={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},k9=["data-player-id"],D9={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},N9={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},O9={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},V9={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},M9=["onClick","title"],L9={class:"group-hover:text-purple-300 transition-colors duration-200"},$9=["data-event-id"],F9={class:"border-t border-white/10"},U9={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},j9={class:"px-4 md:px-5 flex items-center"},B9=["data-event-id"],q9={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},z9={class:"text-center"},H9={class:"text-white text-lg"},K9={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},G9={class:"text-white/60 text-xs mt-2"},W9={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},Q9={class:"flex items-center space-x-2"},J9={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},Y9={class:"flex items-center space-x-2"},X9={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},Z9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},e8={class:"mb-6"},t8={class:"mb-6"},n8={class:"mb-6"},r8={class:"mb-6 flex items-center gap-3"},s8={class:"mb-6"},i8={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},o8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},a8={class:"mb-6"},l8={class:"flex justify-end space-x-3"},u8={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},c8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},d8={class:"flex justify-end space-x-3"},h8={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},f8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},p8={class:"flex justify-end space-x-3"},m8={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},g8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},v8={class:"text-center mb-6"},y8={class:"text-gray-300"},_8={key:0},b8={key:1},w8={class:"relative p-4 md:p-6 border-b border-white/10"},x8={class:"flex items-start gap-4 md:gap-6"},I8={class:"flex-1 min-w-0"},E8={class:"flex items-center gap-3 mb-2"},T8={class:"text-xl md:text-2xl font-bold text-white leading-tight"},A8={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},S8={class:"text-blue-200"},P8={class:"flex items-center gap-3 mb-3"},R8={class:"text-base md:text-lg text-purple-300"},C8={class:"relative"},k8={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},D8={class:"p-2"},N8={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},O8={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},V8={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},M8={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},L8={class:"text-xl md:text-2xl font-bold text-white"},$8={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},F8={class:"text-xl md:text-2xl font-bold text-white"},U8={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},j8={class:"text-xl md:text-2xl font-bold text-yellow-300"},B8={key:0,class:"mb-4 md:mb-6"},q8={class:"mb-3 flex items-center"},z8=["title"],H8={class:"truncate"},K8={class:"space-y-0.5"},G8={class:"flex items-center min-w-0 gap-1.5"},W8={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},Q8={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},J8=["title"],Y8={class:"flex-0 p-0"},X8={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},Z8=["disabled","title"],ez=["title"],tz={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},nz=["disabled","title"],rz={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},sz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},iz={class:"mb-6"},oz={class:"mb-6"},az={class:"mb-6"},lz={class:"mb-6 flex items-center gap-3"},uz={class:"mb-6"},cz={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},dz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},hz={class:"mb-6"},fz={class:"space-y-4"},pz=["disabled"],mz={key:0,class:"animate-spin"},gz={key:1},vz={class:"mb-6 text-center"},yz={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_z={class:"text-red-300 text-sm"},bz={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},wz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},xz={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},Iz={class:"space-y-4"},Ez={class:"mt-2 text-center"},Tz={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Az={class:"text-red-300 text-sm"},Sz={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},Pz=["disabled"],Rz={key:0,class:"animate-spin"},Cz={key:1},kz={class:"mb-6"},Dz=["disabled"],Nz={key:0,class:"animate-spin"},Oz={key:1},Vz={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Mz={class:"text-red-300 text-sm"},Lz={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},$z={class:"text-green-300 text-sm"},Fz={class:"flex justify-center"},Uz={class:"mb-6"},jz=["disabled"],Bz={key:0,class:"animate-spin"},qz={key:1},zz={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Hz={class:"text-red-300 text-sm"},Kz={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Gz={class:"text-green-300 text-sm"},Wz={class:"flex justify-center"},Qz={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},Jz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},Yz={class:"flex gap-3"},Ub={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Xl(),r=Ea(),s=e.slug,i=R(""),o=R(""),a=R({}),l=R(!1),c=R(!1),h=R(null),f=R(null),m=R(""),v=R(""),w=R(6),x=R(!1),A=R(""),L=R(null),F=R(null),$=R(null),B=R({position:null,side:null}),ne=R({position:null}),re=R({position:null}),T=R(!1),_=R(null),E=R(!1),k=R(null),D=R(null),S=R(!1),P=R(null),ke=R(""),Re=R(!1),Pe=R(null),Ce=R(""),_e=R(""),le=R(!1),Je=R(null),oe=R(!1),Z=R(null),Le=R(""),ut=R(""),At=R(!1),Yt=R(null),J=R(!1),xe=R(!1),ve=R(""),De=R(""),it=R(!1),gt=R(!1),C=R(""),V=R(""),H=R(!1),K=R(null),X=R(""),ue=R(!1),ge=R(!1),me=R(!1),ye=R(null),pe=R(null),Fe=R({position:"fixed",top:"0px",left:"0px"}),Ae=R(null),Oe=R({position:"fixed",top:"0px",left:"0px"}),ze=R(null),He=R(!1);function Ze(){try{const b=ye.value;if(!b)return;const g=b.getBoundingClientRect(),M=8;if(window.innerWidth>768){const Y=Math.max(M,Math.round(g.top-M)),se=Math.max(M,Math.round(g.left));Fe.value={position:"fixed",top:`${Y}px`,left:`${se}px`,zIndex:400}}else{const Y=Math.min(window.innerHeight-M,Math.round(g.bottom+M)),se=Math.max(M,Math.round(g.left));Fe.value={position:"fixed",top:`${Y}px`,left:`${se}px`,zIndex:400}}}catch{}}function ct(){try{const Y=Math.max(8,window.innerHeight-8-48-200),se=Math.max(8,Math.round(window.innerWidth-200-8));Oe.value={position:"fixed",top:`${Y}px`,left:`${se}px`,zIndex:400}}catch{}}function vn(){me.value=!me.value,me.value&&Zt(()=>Ze())}function rn(){ge.value=!ge.value,ge.value&&Zt(()=>ct())}function Hn(b){ze.value===b?ze.value=null:ze.value=b}function qt(){ze.value=null}function Ur(){He.value=!He.value}function jr(){He.value=!1}const Gt=R(!1),un=R(null),Br=R(null),ee=R(null),j=R(0);function we(){var b;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Xe.value.length===0)return;const g=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const Y=((b=Ge==null?void 0:Ge.currentUser)==null?void 0:b.email)||"";Y&&jf(Y).then(async se=>{const fe=se.filter(ce=>ce.seasonId===o.value);if(fe.length>0){const ce=`seasonPreferredPlayer:${o.value}`,Ve=localStorage.getItem(ce);let tt=[];if(Ve)if(Ve.startsWith("["))try{tt=JSON.parse(Ve)||[]}catch{}else tt=[Ve];const ht=new Set(tt);fe.forEach(sn=>ht.add(sn.playerId));const kt=Array.from(ht);localStorage.setItem(ce,JSON.stringify(kt))}}).catch(()=>{})}catch{}const M=localStorage.getItem(`startPlayerTour:${o.value}`);!g&&M&&(j.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),Zt(()=>{const Y=document.querySelector('button[data-onboarding="add-player"]');if(Y){Y.scrollIntoView({behavior:"smooth",block:"end"});const se=Y.getBoundingClientRect(),fe=document.getElementById("coachmark-add"),ce=280,Ve=100,tt=(fe==null?void 0:fe.offsetWidth)||ce,ht=(fe==null?void 0:fe.offsetHeight)||Ve,kt=Math.round(se.right+12);if(kt+tt<=window.innerWidth-12){const _n=se.top+se.height/2-ht/2,bn=-14,Dt=12,Or=window.innerHeight-ht-12,es=Math.max(Dt,Math.min(Math.round(_n+bn),Or));B.value={position:{x:kt,y:es},side:"right"}}else{const _n=Math.round(se.left+se.width/2-tt/2),bn=Math.round(se.top-ht-8),Dt=8,Or=window.innerWidth-tt-8;B.value={position:{x:Math.max(Dt,Math.min(_n,Or)),y:bn},side:null}}}}))}catch{}}const je=R(!1),Ke=R(null),at=R(null),vt=R(!1),Tt=R(null),Cn=R(!1),kn=R(null),Zn=R(!1),rt=R(!1),St=R(!1),er=R(!1),tr=R(!1),Mn=R(!1),Aa=R(null);function Sa(){rt.value=!0}function cs(){rt.value=!1}function Bf(){tr.value=!0}function qf(){tr.value=!1}function Pa(){Mn.value=!0}function sd(){Mn.value=!1}function Ra(){try{const b=Ge==null?void 0:Ge.currentUser;if(!b||b.isAnonymous){let g=null;if(gs.value&&gs.value.size>0){const M=gs.value.values().next().value;g=dt.value.find(Y=>Y.id===M)||null}g||(g=dt.value[0]||null),er.value=!0,g&&(Aa.value=g);return}}catch{}rt.value=!0}async function Ca(){var b;try{const g=(b=Ge==null?void 0:Ge.currentUser)==null?void 0:b.email;if(!g)return;const{resetPlayerPassword:M}=await on(()=>Promise.resolve().then(()=>Xi),void 0);await M(g),Be.value=!0,xt.value="Email de réinitialisation envoyé.",setTimeout(()=>{Be.value=!1},3e3)}catch{kr.value=!0,bi.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{kr.value=!1},3e3)}}async function Yr(){try{await wL(Ge),cs(),Be.value=!0,xt.value="Déconnecté de cet appareil.",setTimeout(()=>{Be.value=!1},2500)}catch{kr.value=!0,bi.value="Déconnexion impossible.",setTimeout(()=>{kr.value=!1},3e3)}}async function id(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function eu(b){var g;cs();try{if(b.seasonId&&b.seasonId!==o.value){const M=Ee(ie,"seasons",b.seasonId),se=(await Vt(st(ie,"seasons"))).docs.find(ce=>ce.id===b.seasonId),fe=(g=se==null?void 0:se.data())==null?void 0:g.slug;if(fe){t.push(`/season/${fe}?player=${encodeURIComponent(b.playerId)}&open=protection`);return}}else{const M=dt.value.find(Y=>Y.id===b.playerId);if(M){Gf(M);return}t.push(`?player=${encodeURIComponent(b.playerId)}&open=protection`)}}catch{}}En(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}const b=()=>{l.value=window.scrollY>10};return window.addEventListener("scroll",b,{passive:!0}),document.addEventListener("click",g=>{if(me.value){const M=ye.value,Y=pe.value,se=M&&M.contains(g.target),fe=Y&&Y.contains(g.target);!se&&!fe&&(me.value=!1)}if(ge.value){const M=Ae.value;M&&M.contains(g.target)||(ge.value=!1)}}),document.addEventListener("keydown",g=>{g.key==="Escape"&&(me.value&&(me.value=!1),ge.value&&(ge.value=!1))}),window.addEventListener("resize",()=>{me.value&&Ze(),ge.value&&ct()}),window.addEventListener("scroll",()=>{me.value&&Ze(),ge.value&&ct()},{passive:!0}),()=>{window.removeEventListener("scroll",b)}});function tu(){Zt(()=>{su()})}const qr=R(new Set),ds=R(!0),Xr=R(0),mi=R("Préparation de la grille"),Rr=R(e.eventId||null),nu=R(!1),gi=R(null);Rt(()=>e.eventId,b=>{if(b)if(Rr.value=b,Xe.value.length>0)cy(b);else{const g=Rt(Xe,M=>{M.length>0&&(cy(b),g())},{immediate:!0})}});const Zr=Ue(()=>dt.value.map(b=>({...b,isProtected:qr.value.has(b.id),email:null}))),Rs=Ue(()=>Rr.value?yn.value.findIndex(b=>b.id===Rr.value):-1);Ue(()=>{if(!Rr.value||Rs.value===-1)return!1;if(window.innerWidth<=768){const b=document.querySelector(`[data-event-id="${Rr.value}"]`);if(b){const g=b.getBoundingClientRect();return g.left>=0&&g.right<=window.innerWidth}}return!0});const vr=R(null),od=R(!1),ru=R(!1),ka=R(0),ad=R(null),Kn=R(null),vi=R(null);function Cr(){const b=vr.value;if(!b)return;const{scrollLeft:g,scrollWidth:M,clientWidth:Y}=b;od.value=g>2,ru.value=g<M-Y-2}function su(){var b;try{Cr(),ka.value=((b=vr.value)==null?void 0:b.scrollLeft)||0}catch{}}function ld(b){const g=vr.value;if(!g)return;let M=0;const Y=g.querySelector("tbody tr td[data-event-id]");if(Y)M=Y.getBoundingClientRect().width;else if(Kn!=null&&Kn.value){const fe=Kn.value.querySelector(".col-event");fe&&(M=fe.getBoundingClientRect().width)}(!M||!isFinite(M))&&(M=g.clientWidth*.6);const se=g.scrollLeft+b*M;g.scrollTo({left:se,behavior:"smooth"})}const _o=R(null);R(0);const yi=R(!1),bo=R(!1),_i=R(0);function hs(b,g){g&&typeof g.preventDefault=="function"&&g.preventDefault(),_r(),ld(b)}function yr(b,g){if(g&&typeof g.preventDefault=="function"&&g.preventDefault(),yi.value)return;yi.value=!0,_i.value=b,bo.value=!1;const M=vr.value;if(!M)return;let Y=0;const se=M.querySelector("tbody tr td[data-event-id]");if(se)Y=se.getBoundingClientRect().width;else if(Kn!=null&&Kn.value){const tt=Kn.value.querySelector(".col-event");tt&&(Y=tt.getBoundingClientRect().width)}(!Y||!isFinite(Y))&&(Y=M.clientWidth*.6);const fe=Y/6,ce=120,Ve=()=>{if(!yi.value||_i.value===0)return;bo.value||(bo.value=!0);const tt=M.scrollLeft+_i.value*fe;M.scrollTo({left:tt,behavior:"auto"}),_o.value=window.setTimeout(Ve,ce)};_o.value=window.setTimeout(Ve,250)}function _r(b){b&&typeof b.preventDefault=="function"&&b.preventDefault();const g=yi.value,M=bo.value;if(yi.value=!1,_o.value&&(clearTimeout(_o.value),_o.value=null),b&&typeof b.type=="string"&&b.type.startsWith("touch")&&!M){const Y=_i.value||0;Y!==0&&ld(Y),_i.value=0;return}_i.value=0,g&&M&&Da()}function Da(){const b=vr.value;if(!b)return;let g=0;const M=b.querySelector("tbody tr td[data-event-id]");if(M)g=M.getBoundingClientRect().width;else if(Kn!=null&&Kn.value){const ce=Kn.value.querySelector(".col-event");ce&&(g=ce.getBoundingClientRect().width)}if(!g||!isFinite(g)||g<=0)return;const Y=b.scrollLeft,fe=Math.round(Y/g)*g;b.scrollTo({left:fe,behavior:"smooth"})}function ud(b){L.value=b;const g=document.querySelector(`[data-player-id="${b}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"}),Be.value=!0,xt.value="Nouveau joueur ajouté !",setTimeout(()=>{Be.value=!1},3e3)}function Ft(){if(j.value!==1)return;const b=document.querySelector('button[data-onboarding="add-player"]');if(!b)return;const g=b.getBoundingClientRect(),M=document.getElementById("coachmark-add"),Y=280,se=100,fe=M!=null&&M.offsetWidth&&M.offsetWidth>0?M.offsetWidth:Y,ce=M!=null&&M.offsetHeight&&M.offsetHeight>0?M.offsetHeight:se,Ve=Math.round(g.right+12);if(Ve+fe<=window.innerWidth-12){const ht=g.top+g.height/2-ce/2,sn=wo(ht+-14,ce);B.value={position:{x:Ve,y:sn},side:"right"}}else{const ht=Math.round(g.left+g.width/2-fe/2),kt=wo(g.top-ce-8,ce),sn=8,_n=window.innerWidth-fe-8;B.value={position:{x:Math.max(sn,Math.min(ht,_n)),y:kt},side:null}}}function wo(b,g){const M=pageHeaderRef==null?void 0:pageHeaderRef.value,Y=M?Math.max(0,Math.round(M.getBoundingClientRect().height||0)):0,se=Math.max(12,Y+8),fe=window.innerHeight-g-12;return Math.max(se,Math.min(Math.round(b),fe))}function fs(){var b;j.value===1&&((b=B.value)!=null&&b.position)&&Ft()}En(()=>{window.addEventListener("scroll",fs,{passive:!0}),window.addEventListener("resize",fs)}),Ks(()=>{window.removeEventListener("scroll",fs),window.removeEventListener("resize",fs)});function ps(b){return qr.value.has(b)}async function iu(){if(o.value)try{const b=await $m(o.value),g=new Set;b.forEach(M=>{M.isProtected&&g.add(M.playerId||M.id)}),qr.value=g}catch{const g=new Set;for(const M of dt.value)await Zi(M.id,o.value)&&g.add(M.id);qr.value=g}}const Be=R(!1),xt=R(""),kr=R(!1),bi=R("");function zf(){try{const b=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(b),Be.value=!0,xt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Be.value=!1},2500)}catch{kr.value=!0,bi.value="Impossible de copier le lien",setTimeout(()=>{kr.value=!1},2500)}}async function wi(b){await I({type:"deleteEvent",data:{eventId:b}})}async function ms(b=null){const g=b||h.value;if(console.debug("deleteEventConfirmed"),!g){console.error("Aucun événement à supprimer");return}try{await J6(g,o.value),Xe.value=Xe.value.filter(M=>M.id!==g),await Promise.all([$h(o.value),Uo(dt.value,Xe.value,o.value),jo(o.value)]).then(([M,Y,se])=>{Xe.value=M,Xt.value=Y,Qe.value=se}),c.value=!1,h.value=null,Be.value=!0,xt.value="Événement supprimé avec succès !",setTimeout(()=>{Be.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function cd(){c.value=!1,h.value=null}async function Na(){if(!f.value||!m.value.trim()||!v.value)return;const b=parseInt(w.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const g={title:m.value.trim(),date:v.value,description:X.value.trim()||"",playerCount:b,archived:!!ue.value};await Db(f.value,g,o.value),!g.archived&&dt.value.length>0&&qr.value.size>0&&(kn.value={id:f.value,...g},Cn.value=!0),await Promise.all([$h(o.value),Uo(dt.value,Xe.value,o.value),jo(o.value)]).then(([M,Y,se])=>{Xe.value=M,Xt.value=Y,Qe.value=se}),f.value=null,m.value="",v.value="",X.value="",w.value=6,ue.value=!1,Be.value=!0,xt.value="Événement mis à jour avec succès !",setTimeout(()=>{Be.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function dd(){if(A.value.trim())try{const b=A.value.trim(),g=await aA(b,o.value);await Promise.all([Xu(o.value),Uo(dt.value,Xe.value,o.value),jo(o.value)]).then(([M,Y,se])=>{dt.value=M,Xt.value=Y,Qe.value=se,iu();const fe=dt.value.find(Ve=>Ve.id===g);ud(g),F.value=g,$.value=yn.value&&yn.value[0]&&yn.value[0].id?yn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,g)}catch{}try{typeof j<"u"&&(j.value=2)}catch{}const ce=document.querySelector(`[data-player-id="${g}"]`);ce&&ce.scrollIntoView({behavior:"smooth",block:"center"}),Zt(()=>{const Ve=`[data-player-id="${F.value}"] td[data-event-id="${$.value}"]`,tt=document.querySelector(Ve);if(tt){const ht=tt.getBoundingClientRect();ne.value.position={x:Math.round(ht.left),y:Math.round(ht.top+window.scrollY-48)}}}),Be.value=!0,xt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Be.value=!1},3e3),setTimeout(()=>{Be.value=!1,xt.value=""},5e3)}),x.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function zr(){f.value=null,m.value="",v.value="",X.value="",w.value=6}R(null);const Oa=R(!1),xi=R(""),Ii=R(""),br=R(""),xo=R(6),Va=R(!1);async function Ma(){if(!xi.value.trim()||!Ii.value){alert("Veuillez remplir le titre et la date de l'événement");return}const b=parseInt(xo.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const g={title:xi.value.trim(),date:Ii.value,description:br.value.trim()||"",playerCount:b,archived:!!Va.value};await La(g)}async function La(b){try{const g=await Y6(b,o.value);Xe.value=[...Xe.value,{id:g,...b}];const M={};for(const Y of dt.value)M[Y.name]=Xt.value[Y.name]||{},M[Y.name][g]=null,await kb(Y.name,M[Y.name],o.value);xi.value="",Ii.value="",br.value="",xo.value=6,Va.value=!1,Oa.value=!1,await Promise.resolve(),Be.value=!0,xt.value="Événement créé avec succès !",!b.archived&&dt.value.length>0&&qr.value.size>0&&(kn.value={id:g,...b},Cn.value=!0),setTimeout(()=>{Be.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function hd(){xi.value="",Ii.value="",br.value="",xo.value=6,Oa.value=!1}async function Ei(){await I({type:"addEvent",data:{}})}const Xe=R([]),dt=R([]),Xt=R({}),Qe=R({}),Hf=R({}),ou=R({});Rt([()=>Xe.value.length,()=>dt.value.length,ds],()=>{ds.value||Zt(()=>{su()})}),Rt([()=>dt.value.length,()=>Xe.value.length,o],()=>{we()}),En(async()=>{try{Zv("firebase"),await oA();const g=Ic(st(ie,"seasons"),Ch("slug","==",e.slug)),M=await Vt(g);if(M.empty){t.push("/seasons");return}else{const ce=M.docs[0];o.value=ce.id;const Ve=ce.data();i.value=Ve.name,a.value=Ve,document.title=`Saison : ${i.value}`,I$(e.slug)}if(o.value){mi.value="Chargement des événements de la saison",Xr.value=20;const ce=await Vt(st(ie,"seasons",o.value,"events"));Xe.value=ce.docs.map(Dt=>({id:Dt.id,...Dt.data(),playerCount:Dt.data().playerCount||6})),mi.value="Chargement des joueurs",Xr.value=45;const Ve=await Vt(st(ie,"seasons",o.value,"players"));dt.value=Ve.docs.map(Dt=>({id:Dt.id,...Dt.data()})),mi.value="Chargement des disponibilités",Xr.value=70;const tt=await Vt(st(ie,"seasons",o.value,"availability")),ht={};tt.docs.forEach(Dt=>{const Or=Dt.data(),es={};Object.keys(Or).forEach(ko=>{const qa=Or[ko];es[ko]=qa==="oui"?!0:qa==="non"?!1:qa}),ht[Dt.id]=es}),Xt.value=ht,mi.value="Chargement des sélections",Xr.value=85;const kt=await Vt(st(ie,"seasons",o.value,"selections")),sn={};kt.docs.forEach(Dt=>{sn[Dt.id]=Dt.data().players||[]}),Qe.value=sn;const _n=await $m(o.value),bn=new Set;Array.isArray(_n)&&_n.forEach(Dt=>{Dt.isProtected&&bn.add(Dt.playerId||Dt.id)}),qr.value=bn}const Y=ce=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>ce()):setTimeout(ce,0)};mi.value="Préparation de l'interface",Xr.value=95,Y(()=>{hu(),ja()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await Zt(),Xr.value=100,ds.value=!1,Zt(()=>{Cr(),requestAnimationFrame(()=>Cr()),setTimeout(()=>Cr(),250);const ce=vr.value;ce&&(ce.addEventListener("scroll",Ve=>{Cr(),ka.value=ce.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Cr),typeof ResizeObserver<"u"&&(vi.value=new ResizeObserver(()=>{Cr()}),vi.value.observe(ce)))});const se=r.query.event;if(se&&Xe.value.length>0){const ce=Xe.value.find(Ve=>Ve.id===se);ce?(console.debug("Événement trouvé depuis l'URL"),await Jf(se,ce)):(console.warn("Événement non trouvé avec l'ID"),kr.value=!0,bi.value="Événement non trouvé",setTimeout(()=>{kr.value=!1},3e3))}const fe=r.query.player;if(fe&&dt.value.length>0){const ce=dt.value.find(Ve=>Ve.id===fe);ce&&(Gf(ce),await Zt(),r.query.verified==="1"&&(Be.value=!0,xt.value="Joueur associé à votre compte.",setTimeout(()=>{Be.value=!1},2500)))}}catch(b){console.error("Erreur lors du chargement de la grille:",b),kr.value=!0,bi.value="Erreur lors du chargement des données",setTimeout(()=>{kr.value=!1},5e3),ds.value=!1}}),Rt(()=>r.params.eventId,b=>{if(b){const g=()=>{const M=Xe.value.find(Y=>Y.id===b);return M?(ny(M),!0):!1};if(Xe.value.length>0)g();else{const M=Rt(Xe,Y=>{Y.length>0&&g()&&M()},{immediate:!0})}}},{immediate:!0});function au(b){if(!b)return null;if(b instanceof Date)return b;if(typeof(b==null?void 0:b.toDate)=="function")return b.toDate();if(typeof b=="string"||typeof b=="number"){const g=new Date(b);return isNaN(g.getTime())?null:g}return null}const Cs=Ue(()=>{let b=null;try{o.value&&(b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const g=[...dt.value].sort((ce,Ve)=>(ce.name||"").localeCompare(Ve.name||"","fr",{sensitivity:"base"}));if(!b)return g;let M=[];try{b.startsWith("[")?M=JSON.parse(b):b&&(M=[b])}catch{M=[]}const Y=new Set(M);if(Y.size===0)return g;const se=g.filter(ce=>Y.has(ce.id)),fe=g.filter(ce=>!Y.has(ce.id));return[...se,...fe]}),gs=Ue(()=>{try{if(o.value){const b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!b)return new Set;if(b.startsWith("[")){const g=JSON.parse(b);return new Set(Array.isArray(g)?g:[])}return new Set([b])}}catch{}return new Set}),$a=Ue(()=>[...Xe.value].sort((b,g)=>{const M=au(b.date),Y=au(g.date),se=M?M.getTime():Number.POSITIVE_INFINITY,fe=Y?Y.getTime():Number.POSITIVE_INFINITY;return se!==fe?se-fe:(b.title||"").localeCompare(g.title||"","fr",{sensitivity:"base"})})),ks=R(!1),yn=Ue(()=>{const b=$a.value;return ks.value?b:b.filter(g=>!g.archived)});function fd(){ks.value=!ks.value}const lu=R("selected"),Io=Ue(()=>{var M;if(!K.value)return Cs.value;const b=K.value.id,g=new Set(((M=Qe.value)==null?void 0:M[b])||[]);return Cs.value.filter(Y=>{var Ve;const se=Y.name,fe=(Ve=Xt.value[se])==null?void 0:Ve[b],ce=g.has(se);switch(lu.value){case"selected":return ce;case"available":return fe===!0&&!ce;case"unavailable":return fe===!1;case"unknown":return fe!==!0&&fe!==!1;case"all":default:return!0}})}),pd=Ue(()=>K.value?Ro(K.value.id):null),uu=Ue(()=>{if(!K.value)return!1;const b=Ro(K.value.id);return b.type==="incomplete"||b.type==="insufficient"}),Eo=Ue(()=>K.value?pu(K.value.id):"");async function To(b,g){const M=dt.value.find(fe=>fe.name===b);if(!M){console.error("Joueur non trouvé");return}const Y=Xe.value.find(fe=>fe.id===g);if(!Y){console.error("Événement non trouvé");return}if(Y.archived){Be.value=!0,xt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Be.value=!1},3e3);return}if(ps(M.id)){const fe=ta(M.id),ce=ee.value===M.id;console.debug("Joueur protégé:",{playerId:M.id,hasCachedPassword:fe,wasRecentlyVerified:ce,recentlyVerifiedPlayer:ee.value}),fe||ce?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),ce&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),ee.value=null),Ti(M,g)):(console.debug("Pas de session, affichage de la modal de vérification"),Br.value={playerName:b,eventId:g},un.value=M,Gt.value=!0);return}Ti(M,g)}function Ti(b,g){var se,fe,ce;const M=(se=Xt.value[b.name])==null?void 0:se[g];console.debug("toggleAvailability");let Y;M===!0?Y=!1:M===!1?Y=void 0:Y=!0,Y===void 0?Xt.value[b.name]&&delete Xt.value[b.name][g]:(Xt.value[b.name]||(Xt.value[b.name]={}),Xt.value[b.name][g]=Y);try{typeof j<"u"&&j.value===1&&b.id===(F.value||((fe=Cs.value[0])==null?void 0:fe.id))&&g===($.value||((ce=yn.value[0])==null?void 0:ce.id))&&(j.value=3,Zt(()=>{const tt=document.querySelector(`[data-player-id="${b.id}"]`);if(tt){const ht=tt.querySelector(".player-name");if(ht){const kt=ht.getBoundingClientRect();re.value.position={x:Math.round(kt.right+8),y:Math.round(kt.top+window.scrollY-4)}}}}),Ks(()=>{try{window.removeEventListener("resize",Cr)}catch{}try{vi.value&&vi.value.disconnect()}catch{}}))}catch{}kb(b.name,Xt.value[b.name],o.value).then(async()=>{await Zt(),ja(),Be.value=!0,xt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Be.value=!1},3e3)}).catch(Ve=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function wr(b,g){var M;return(M=Xt.value[b])==null?void 0:M[g]}function md(b,g){var se;const M=Qe.value[g]||[],Y=(se=Xt.value[b])==null?void 0:se[g];return M.includes(b)&&Y===!0}async function Ao(b,g=6){const M=Xe.value.find(ce=>ce.id===b),Y=(M==null?void 0:M.playerCount)||6,se=Qe.value[b]||[];if(se.length>0&&se.every(ce=>wr(ce,b))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Ve=dt.value.filter(kt=>wr(kt.name,b)).map(kt=>{const sn=Ds(kt.name);return{name:kt.name,weight:1/(1+sn)}}),tt=[],ht=[...Ve];for(;tt.length<Y&&ht.length>0;){const kt=ht.reduce((bn,Dt)=>bn+Dt.weight,0);let sn=Math.random()*kt;const _n=ht.findIndex(bn=>(sn-=bn.weight,sn<=0));_n>=0&&(tt.push(ht[_n].name),ht.splice(_n,1))}Qe.value[b]=tt}else{const ce=se.filter(tt=>wr(tt,b)),Ve=Y-ce.length;if(Ve<=0)Qe.value[b]=ce;else{const tt=new Set(ce),kt=dt.value.filter(bn=>wr(bn.name,b)&&!tt.has(bn.name)).map(bn=>{const Dt=Ds(bn.name);return{name:bn.name,weight:1/(1+Dt)}}),sn=[],_n=[...kt];for(;sn.length<Ve&&_n.length>0;){const bn=_n.reduce((es,ko)=>es+ko.weight,0);let Dt=Math.random()*bn;const Or=_n.findIndex(es=>(Dt-=es.weight,Dt<=0));Or>=0&&(sn.push(_n[Or].name),_n.splice(Or,1))}Qe.value[b]=[...ce,...sn]}}await Um(b,Qe.value[b],o.value),hu(),ja()}async function cu(b,g=6){var ce,Ve;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const M=je.value,Y=(ce=Ke.value)==null?void 0:ce.id,se=Qe.value[b]&&Qe.value[b].length>0,fe=se?[...Qe.value[b]]:[];if(await Ao(b,g),console.debug("etat modal selection apres"),M&&!je.value&&(console.debug("Restauration de la popin de sélection..."),je.value=!0,Ke.value=Xe.value.find(tt=>tt.id===Y)),je.value&&((Ve=Ke.value)==null?void 0:Ve.id)===b)if(console.debug("Popin de sélection ouverte, mise à jour..."),await Zt(),at.value&&at.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const tt=Qe.value[b]||[],ht=fe.filter(sn=>tt.includes(sn)),kt=ht.length>0&&ht.length<fe.length;at.value.showSuccess(se,kt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Be.value=!0,Xe.value.find(tt=>tt.id===b),Qe.value[b],se?xt.value="Sélection mise à jour avec succès !":xt.value="Sélection effectuée avec succès !",setTimeout(()=>{Be.value=!1},3e3)}function Fa(b){b===0?B.value.position=null:b===1?ne.value.position=null:b===2&&(re.value.position=null)}function du(b){var M;return b?(typeof b=="string"?new Date(b):((M=b.toDate)==null?void 0:M.call(b))||b).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Ua(b){var M;return b?(typeof b=="string"?new Date(b):((M=b.toDate)==null?void 0:M.call(b))||b).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Ds(b){return Object.values(Qe.value).filter(g=>g.includes(b)).length}function Ai(b){const g=Xt.value[b]||{};return Object.values(g).filter(M=>M===!0).length}function So(b){return b?Object.values(Xt.value).filter(g=>g[b]===!0).length:0}function Po(b){return b?(Qe.value[b]||[]).length:0}function vs(b){const g=Xe.value.find(Y=>Y.id===b),M=(g==null?void 0:g.playerCount)||6;return Po(b)>=M}function gd(b){const g=Ai(b),M=Ds(b);return g===0?0:M/g}function vd(b){Hf.value[b]={availability:Ai(b),selection:Ds(b),ratio:gd(b)}}function hu(){dt.value.forEach(b=>vd(b.name))}function ja(){const b={};Xe.value.forEach(g=>{const M=g.playerCount||6,se=dt.value.filter(ce=>wr(ce.name,g.id)===!0).map(ce=>{const Ve=Ds(ce.name);return{name:ce.name,weight:1/(1+Ve)}}),fe=se.reduce((ce,Ve)=>ce+Ve.weight,0);se.forEach(ce=>{const Ve=Math.min(1,ce.weight/fe*M);b[ce.name]||(b[ce.name]={}),b[ce.name][g.id]=Math.round(Ve*100)})}),ou.value=b}const Ns=R(null),Ln=R(!1);async function yd(b=null){const g=b||Ns.value;if(!g){console.error("Aucun joueur à supprimer");return}try{await G6(g,o.value),dt.value=dt.value.filter(M=>M.id!==g),Ln.value=!1,Ns.value=null,Be.value=!0,xt.value="Joueur supprimé avec succès !",setTimeout(()=>{Be.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function _d(){Ln.value=!1,Ns.value=null}async function Si(b){oy(),await Zi(b,o.value)?await q({type:"deletePlayer",data:{playerId:b}}):await I({type:"deletePlayer",data:{playerId:b}})}async function u(){if(_.value){const b=Xe.value.find(M=>M.id===_.value),g=(b==null?void 0:b.playerCount)||6;await cu(_.value,g),T.value=!1,_.value=null}}function p(){T.value=!1,_.value=null}function y(){return P.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[P.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function I(b){if(Gn.isPinCached(o.value)){const g=Gn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await Vh(o.value,g)){await Nr(b);return}else Gn.clearSession()}P.value=b,S.value=!0}async function q(b){const g=b.data.playerId;try{if(Gn.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await Nr(b);return}}catch{}if(ta(g)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Nr(b);return}Pe.value=b,Re.value=!0}async function Q(b){try{if(await Vh(o.value,b)){Gn.saveSession(o.value,b),S.value=!1;const M=P.value;P.value=null,await Nr(M)}else ke.value="Code PIN incorrect",setTimeout(()=>{ke.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),ke.value="Erreur lors de la vérification du code PIN"}}function Ie(){S.value=!1,P.value=null,ke.value=""}async function Ct(b){if(b){le.value=!0,Ce.value="";try{const g=Pe.value.data.playerId,M=await km(o.value);if(b===M){try{Gn.saveSession(o.value,b)}catch{}try{ho.saveSession(Pe.value.data.playerId)}catch{}Re.value=!1;const se=Pe.value;Pe.value=null,_e.value="",await Nr(se);return}if(await verifyPlayerPassword(g,b,o.value)){Re.value=!1;const se=Pe.value;Pe.value=null,_e.value="",await Nr(se)}else Ce.value="Mot de passe incorrect",setTimeout(()=>{Ce.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Ce.value="Erreur lors de la vérification du mot de passe"}finally{le.value=!1}}}function Dn(){Re.value=!1,Pe.value=null,Ce.value="",_e.value="",le.value=!1}async function It(b){if(b){At.value=!0,Le.value="";try{const g=Z.value.data.player,M=await km(o.value);if(b===M){try{Gn.saveSession(o.value,b)}catch{}try{ho.saveSession(Z.value.data.player.id)}catch{}oe.value=!1;const se=Z.value;Z.value=null,ut.value="",await Nr(se);return}if(await verifyPlayerPassword(g.id,b,o.value)){oe.value=!1;const se=Z.value;Z.value=null,ut.value="",await Nr(se)}else Le.value="Mot de passe incorrect",setTimeout(()=>{Le.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Le.value="Erreur lors de la vérification du mot de passe"}finally{At.value=!1}}}function $n(){oe.value=!1,Z.value=null,Le.value="",ut.value="",At.value=!1}async function Fn(){xe.value=!0,ve.value="",De.value="";try{const b=Z.value.data.player,g=await sendPasswordResetEmail(b.id,o.value);De.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ve.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{xe.value=!1}}async function Pi(){gt.value=!0,C.value="",V.value="";try{const b=Pe.value.data.playerId,g=await sendPasswordResetEmail(b,o.value);V.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),C.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{gt.value=!1}}function Dr(){return Gn.isPinCached(o.value)?{timeRemaining:Gn.getTimeRemaining(),isExpiringSoon:Gn.isExpiringSoon()}:null}async function Nr(b){var Y;if(!b)return;const{type:g,data:M}=b;try{switch(g){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),h.value=M.eventId,c.value=!0;break;case"addEvent":Oa.value=!0;break;case"deletePlayer":Ns.value=M.playerId,Ln.value=!0;break;case"launchSelection":Qe.value[M.eventId]&&Qe.value[M.eventId].length>0?(_.value=M.eventId,T.value=!0,H.value=!1):(await cu(M.eventId,M.count),H.value=!1);break;case"toggleAvailability":Ti(M.player,M.eventId);break;case"toggleArchive":await setEventArchived(M.eventId,M.archived,o.value);{const se=Xe.value.findIndex(fe=>fe.id===M.eventId);se!==-1&&(Xe.value[se]={...Xe.value[se],archived:!!M.archived}),ue.value=!!M.archived}break;case"updateSelection":{const{eventId:se,players:fe}=M,ce=[...Qe.value[se]||[]],Ve=Array.isArray(fe)?fe:[];await Um(se,Ve,o.value),Qe.value[se]=Ve;try{const tt=ce.filter(ht=>!Ve.includes(ht));if(tt.length>0){const ht=Xe.value.find(kt=>kt.id===se);await bF({eventId:se,eventData:ht,removedPlayers:tt,newSelectedPlayers:Ve,seasonId:o.value,seasonSlug:s,players:Zr.value})}}catch{}try{(Y=at.value)==null||Y.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Be.value=!0,xt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Be.value=!1},3e3)}}function fu(){t.push("/seasons")}Ks(()=>{const b=vr.value;b&&b.removeEventListener("scroll",Cr),window.removeEventListener("resize",Cr)});async function ny(b){K.value=b,X.value=b.description||"",ue.value=!!b.archived;try{const[g,M]=await Promise.all([Uo(dt.value,Xe.value,o.value),jo(o.value)]);Xt.value=g,Qe.value=M}catch(g){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",g)}H.value=!0}function Kf(){H.value=!1,K.value=null,X.value="",ge.value=!1,me.value=!1,qt(),jr(),Fe.value={position:"fixed",top:"0px",left:"0px"},Oe.value={position:"fixed",top:"0px",left:"0px"}}function Ba(b,g=null){const M=g||K.value;if(M)try{x5(b,M,i.value),Be.value=!0,b==="ics"?xt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":b==="google"?xt.value="Google Calendar ouvert dans un nouvel onglet":b==="outlook"&&(xt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Be.value=!1},3e3)}catch(Y){console.error("Erreur lors de l'ajout au calendrier:",Y),Be.value=!0,xt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Be.value=!1},3e3)}}function ry(){Kf(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function dA(b,g){console.debug("handleAvailabilityToggle appelé");const M=dt.value.find(fe=>fe.name===b);if(!M){console.error("Joueur non trouvé");return}const Y=Xe.value.find(fe=>fe.id===g);if(Y!=null&&Y.archived){Be.value=!0,xt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Be.value=!1},3e3);return}console.debug("Joueur trouvé");const se=ps(M.id);if(console.debug("Joueur protégé"),se){ta(M.id)?(console.debug("Session active, procéder au toggle"),await To(b,g)):(console.debug("Demande du mot de passe pour joueur protégé"),Br.value={playerName:b,eventId:g},un.value=M,Gt.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await To(b,g)}function hA(b,g){return(Qe.value[g]||[]).includes(b)}async function fA(b){if(console.debug("Mot de passe vérifié"),un.value&&(ee.value=un.value.id,console.debug("Joueur marqué comme récemment vérifié")),Br.value){const{playerName:g,eventId:M}=Br.value;console.debug("Exécution de l'action en attente"),await To(g,M),Br.value=null}else console.debug("Aucune action en attente trouvée");Gt.value=!1,un.value=null}function sy(){f.value=K.value.id,m.value=K.value.title,v.value=K.value.date,X.value=K.value.description||"",w.value=K.value.playerCount||6,H.value=!1}async function iy(){if(K.value)try{const b=!K.value.archived,g={...K.value,archived:b};await Db(K.value.id,g,o.value),K.value.archived=b;const M=Xe.value.findIndex(Y=>Y.id===K.value.id);M!==-1&&(Xe.value[M].archived=b),Be.value=!0,xt.value=b?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Be.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Gf(b){k.value=b,E.value=!0;try{typeof j<"u"&&j.value}catch{}}function oy(){E.value=!1,k.value=null}async function pA({playerId:b,newName:g}){try{await W6(b,g,o.value),await Promise.all([Xu(o.value),Uo(dt.value,Xe.value,o.value),jo(o.value)]).then(([M,Y,se])=>{if(dt.value=M,Xt.value=Y,Qe.value=se,iu(),k.value&&k.value.id===b){const fe=M.find(ce=>ce.id===b);fe&&(k.value=fe)}}),Be.value=!0,xt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Be.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function mA(){try{await Promise.all([Xu(o.value),Uo(dt.value,Xe.value,o.value),jo(o.value)]).then(([b,g,M])=>{if(dt.value=b,Xt.value=g,Qe.value=M,iu(),k.value){const Y=b.find(se=>se.id===k.value.id);Y&&(k.value=Y)}}),Be.value=!0,xt.value="Données mises à jour !",setTimeout(()=>{Be.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function gA(b){if(!b)return{availability:0,selection:0,ratio:0};const g=Ai(b.name),M=Ds(b.name),Y=g===0?0:Math.round(M/g*100);return{availability:g,selection:M,ratio:Y}}function Ro(b){const g=Qe.value[b]||[],M=Xe.value.find(fe=>fe.id===b),Y=(M==null?void 0:M.playerCount)||6,se=So(b);if(g.length>0){const fe=g.some(Ve=>!wr(Ve,b)),ce=se<Y;if(fe||ce)return{type:"incomplete",hasUnavailablePlayers:fe,hasInsufficientPlayers:ce,unavailablePlayers:g.filter(Ve=>!wr(Ve,b)),availableCount:se,requiredCount:Y}}return se<Y?{type:"insufficient",availableCount:se,requiredCount:Y}:g.length===0?{type:"ready",availableCount:se,requiredCount:Y}:{type:"complete",availableCount:se,requiredCount:Y}}function pu(b){const g=Ro(b);switch(g.type){case"incomplete":return g.hasUnavailablePlayers?g.unavailablePlayers.length===1?`Sélection incomplète : ${g.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${g.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${g.availableCount} joueurs disponibles pour ${g.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${g.availableCount} disponibles pour ${g.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${g.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${g.availableCount} joueurs disponibles`;default:return""}}async function vA(){const b=[];for(const g of dt.value){if(!await Zi(g.id,o.value))continue;const Y=await Z1(g.id,o.value);Y&&b.push({...g,email:Y})}return b}function bd(b){if(b!=null&&b.archived){Be.value=!0,xt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Be.value=!1},3e3);return}ay(),Tt.value=b,vt.value=!0;try{const g=new URLSearchParams(window.location.search);g.set("modal","announce"),g.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${g.toString()}`)}catch{}}function yA(){vt.value=!1,Tt.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="announce"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}function ay(){Cn.value=!1,kn.value=null}const Wf=R(!1);async function ly({eventId:b,eventData:g,reason:M,selectedPlayers:Y,scope:se="all",recipient:fe=null}){Wf.value=!0;try{M==="selection"?(se==="single"&&(fe!=null&&fe.email)?await $b({eventId:b,eventData:g,selectedPlayers:[fe.name],seasonId:o.value,seasonSlug:s,players:Zr.value}):await $b({eventId:b,eventData:g,selectedPlayers:Y,seasonId:o.value,seasonSlug:s,players:Zr.value}),Be.value=!0,xt.value=se==="single"?`Notification envoyée à ${(fe==null?void 0:fe.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Be.value=!1},3e3)):(se==="single"&&(fe!=null&&fe.email)?await Lb({eventId:b,eventData:g,players:[fe],seasonId:o.value,seasonSlug:s,createMagicLink:Vm,reminder:!1,getAvailabilityForEvent:(ce,Ve)=>wr(ce,Ve)}):await Lb({eventId:b,eventData:g,players:await vA(),seasonId:o.value,seasonSlug:s,createMagicLink:Vm,reminder:!1,getAvailabilityForEvent:(ce,Ve)=>wr(ce,Ve)}),Be.value=!0,xt.value=se==="single"?`Notification envoyée à ${(fe==null?void 0:fe.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Be.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Be.value=!0,xt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Be.value=!1},3e3)}Wf.value=!1}function Qf(b){if(!b)return{};const g={};return dt.value.forEach(M=>{g[M.name]=wr(M.name,b)}),g}function Co(b){if(b!=null&&b.archived){Be.value=!0,xt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Be.value=!1},3e3);return}Ke.value=b,je.value=!0;try{const g=new URLSearchParams(window.location.search);g.set("modal","selection"),g.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${g.toString()}`)}catch{}}function uy(){je.value=!1,Ke.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="selection"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}async function _A(){if(!Ke.value)return;const b=Ke.value.id,g=Ke.value.playerCount||6;if(So(b)===0){Be.value=!0,xt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Be.value=!1},3e3);return}await I({type:"launchSelection",data:{eventId:b,count:g}})}function bA(){uy(),Be.value=!0,xt.value="Sélection validée !",setTimeout(()=>{Be.value=!1},3e3)}async function wA(b){if(!b||!b.eventId)return;const{eventId:g,players:M}=b;await I({type:"updateSelection",data:{eventId:g,players:M}})}async function Jf(b,g){if(!b||!g)return;dy(),Rr.value=b,nu.value=!0,await Zt();const M=document.querySelector(`[data-event-id="${b}"]`);if(!M){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(ce=>{ce.classList.remove("focused-event-highlight")});const Y=document.querySelectorAll(`[data-event-id="${b}"]`);Y.forEach(ce=>{ce.classList.add("focused-event-highlight")});const se=Y[0],fe=Y[Y.length-1];se&&se.classList.add("focused-event-column-start"),fe&&fe.classList.add("focused-event-column-end"),await xA(M),Be.value=!0,xt.value=`Événement ciblé : ${g.title}`,setTimeout(()=>{Be.value=!1},4e3),gi.value=setTimeout(()=>{dy()},8e3)}function cy(b){if(!b)return;const g=Xe.value.find(M=>M.id===b);if(!g){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const M=Xe.value.find(Y=>Y.id===b);M?Jf(b,M):console.error("Événement toujours introuvable après retry")},500);return}Jf(b,g)}Rt(Xe,b=>{try{const g=new URLSearchParams(window.location.search),M=g.get("modal"),Y=g.get("event");if(!M||!Y)return;const se=b.find(fe=>fe.id===Y);if(!se)return;M==="announce"&&bd(se),M==="selection"&&Co(se)}catch{}},{immediate:!0});async function xA(b){if(!b)return;if(await new Promise(M=>setTimeout(M,100)),window.innerWidth<=768){const M=vr.value;if(M){const Y=b.offsetLeft,se=b.offsetWidth,fe=M.clientWidth,ce=Y-fe/2+se/2,Ve=M.scrollWidth-fe,tt=Math.max(0,Math.min(ce,Ve));M.scrollTo({left:tt,behavior:"smooth"}),setTimeout(()=>{const ht=b.getBoundingClientRect();if(ht.left<0||ht.right>window.innerWidth){const kt=Y-20;M.scrollTo({left:Math.max(0,kt),behavior:"smooth"})}},500)}}else b.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const g=vr.value;g&&setTimeout(()=>{const M=document.querySelector(`[data-event-id="${Rr.value}"]`);if(M&&M.closest("tbody")){const Y=M.offsetLeft,se=M.offsetWidth,fe=g.clientWidth,ce=Y-fe/2+se/2,Ve=g.scrollWidth-fe,tt=Math.max(0,Math.min(ce,Ve));g.scrollTo({left:tt,behavior:"smooth"})}},300)}function dy(){gi.value&&(clearTimeout(gi.value),gi.value=null),Rr.value=null,nu.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(b=>{b.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(b=>{b.classList.remove("focused-event-column-start","focused-event-column-end")})}return(b,g)=>{var M,Y,se,fe,ce,Ve,tt,ht,kt,sn,_n,bn,Dt,Or,es,ko,qa,hy,fy,py,my,gy,vy,yy;return N(),O(ft,null,[d("div",Jq,[Ye(Qq,{"season-name":i.value,"is-scrolled":l.value,onGoBack:fu,onOpenAccountMenu:Sa,onOpenHelp:g[0]||(g[0]=G=>Zn.value=!0),onOpenNotifications:Bf,onOpenPlayers:Pa,onLogout:Yr,onOpenLogin:Ra,onOpenAccount:Ra},null,8,["season-name","is-scrolled"]),d("div",Yq,[d("div",{ref_key:"headerBarRef",ref:ad,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",Xq,[Xe.value.length===0&&dt.value.length===0?ae("",!0):(N(),O("div",Zq,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:Ei,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},g[74]||(g[74]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),d("span",{class:"sm:hidden"},"Événement",-1)]))])])),d("div",e9,[d("div",{ref_key:"headerEventsRef",ref:Kn,class:"flex relative z-[60]",style:Vr({transform:`translateX(-${ka.value}px)`})},[(N(!0),O(ft,null,Mr(yn.value,G=>(N(),O("div",{key:"h-"+G.id,"data-event-id":G.id,class:wn(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":G.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:G.title+" - Cliquez pour voir les détails",onClick:pt(cn=>ny(G),["stop"])},[d("div",r9,[d("div",s9,te(G.title||"Sans titre"),1),G.archived?(N(),O("div",i9,"(Archivé)")):ae("",!0)]),d("div",o9,[d("div",{onClick:pt(cn=>Hn(G.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:Ua(G.date)+" - Cliquez pour ajouter à votre agenda"},te(du(G.date)),9,a9),ze.value===G.id?(N(),O("div",l9,[d("div",u9,[d("button",{onClick:pt(cn=>{Ba("google",G),qt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},g[75]||(g[75]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)]),8,c9),d("button",{onClick:pt(cn=>{Ba("outlook",G),qt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},g[76]||(g[76]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)]),8,d9),d("button",{onClick:pt(cn=>{Ba("ics",G),qt()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},g[77]||(g[77]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]),8,h9)])])):ae("",!0)])],8,n9),d("div",f9,[G.archived?(N(),O("div",p9,g[78]||(g[78]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):Ro(G.id).type==="ready"?(N(),O("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:pu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(cn=>Co(G),["stop"])},g[79]||(g[79]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,m9)):Ro(G.id).type==="complete"?(N(),O("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:pu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(cn=>Co(G),["stop"])},g[80]||(g[80]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,g9)):Ro(G.id).type==="incomplete"?(N(),O("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:pu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(cn=>Co(G),["stop"])},g[81]||(g[81]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,v9)):Ro(G.id).type==="insufficient"?(N(),O("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:pu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:pt(cn=>Co(G),["stop"])},g[82]||(g[82]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,y9)):ae("",!0)])],10,t9))),128))],4)]),g[85]||(g[85]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:fd,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:ks.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":ks.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(N(),O("svg",b9,[g[83]||(g[83]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),g[84]||(g[84]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),ks.value?ae("",!0):(N(),O("path",w9))]))],8,_9),lt(d("button",{onClick:g[1]||(g[1]=pt(G=>hs(-1,G),["prevent"])),onMousedown:g[2]||(g[2]=pt(G=>yr(-1,G),["prevent"])),onMouseup:g[3]||(g[3]=G=>_r(G)),onMouseleave:g[4]||(g[4]=G=>_r(G)),onTouchstart:g[5]||(g[5]=pt(G=>yr(-1,G),["prevent"])),onTouchend:g[6]||(g[6]=G=>_r(G)),onTouchcancel:g[7]||(g[7]=G=>_r(G)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[lp,od.value]]),lt(d("button",{onClick:g[8]||(g[8]=pt(G=>hs(1,G),["prevent"])),onMousedown:g[9]||(g[9]=pt(G=>yr(1,G),["prevent"])),onMouseup:g[10]||(g[10]=G=>_r(G)),onMouseleave:g[11]||(g[11]=G=>_r(G)),onTouchstart:g[12]||(g[12]=pt(G=>yr(1,G),["prevent"])),onTouchend:g[13]||(g[13]=G=>_r(G)),onTouchcancel:g[14]||(g[14]=G=>_r(G)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[lp,ru.value]])])],512),lt(d("div",{ref_key:"gridboardRef",ref:vr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[j.value===1?(N(),O("div",x9,[B.value.position?(N(),O("div",{key:0,class:"fixed z-[400]",style:Vr({left:B.value.position.x+"px",top:B.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:wn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":B.value.side==="right","coachmark-left":B.value.side==="left"}])},[g[87]||(g[87]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),g[88]||(g[88]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",I9,[g[86]||(g[86]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:g[15]||(g[15]=G=>Fa(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ae("",!0)])):ae("",!0),j.value===2&&F.value&&$.value?(N(),O("div",E9,[ne.value.position?(N(),O("div",{key:0,class:"fixed z-[400]",style:Vr({position:"absolute",left:ne.value.position.x+"px",top:ne.value.position.y+"px"})},[d("div",T9,[g[90]||(g[90]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),g[91]||(g[91]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",A9,[g[89]||(g[89]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:g[16]||(g[16]=G=>Fa(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ae("",!0)])):ae("",!0),j.value===3&&F.value?(N(),O("div",S9,[re.value.position?(N(),O("div",{key:0,class:"fixed z-[400]",style:Vr({position:"absolute",left:re.value.position.x+"px",top:re.value.position.y+"px"})},[d("div",P9,[g[93]||(g[93]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),g[94]||(g[94]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",R9,[g[92]||(g[92]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:g[17]||(g[17]=G=>Fa(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ae("",!0)])):ae("",!0),d("table",C9,[d("colgroup",null,[g[95]||(g[95]=d("col",{class:"col-left"},null,-1)),(N(!0),O(ft,null,Mr(yn.value,(G,cn)=>(N(),O("col",{key:"c"+cn,class:"col-event"}))),128)),g[96]||(g[96]=d("col",{class:"col-right"},null,-1))]),g[100]||(g[100]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(N(!0),O(ft,null,Mr(Cs.value,G=>{var cn;return N(),O("tr",{key:G.id,class:wn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":G.id===L.value,"preferred-player":gs.value.has(G.id)}]),"data-player-id":G.id},[d("td",D9,[d("div",N9,[gs.value.has(G.id)?(N(),O("span",O9," ⭐ ")):ps(G.id)?(N(),O("span",V9," 🔒 ")):ae("",!0),d("div",{onClick:xr=>Gf(G),class:wn(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":j.value===3&&G.id===(F.value||((cn=Cs.value[0])==null?void 0:cn.id))}]),title:"Cliquez pour voir les détails : "+G.name},[d("span",L9,te(G.name),1)],10,M9)])]),(N(!0),O(ft,null,Mr(yn.value,xr=>{var _y,by,wy;return N(),O("td",{key:xr.id,"data-event-id":xr.id,class:wn(["p-0",xr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":j.value===2&&G.id===(F.value||((_y=Cs.value[0])==null?void 0:_y.id))&&xr.id===($.value||((by=yn.value[0])==null?void 0:by.id))}])},[Ye(Fb,{"player-name":G.name,"event-id":xr.id,"is-available":wr(G.name,xr.id),"is-selected":md(G.name,xr.id),"chance-percent":((wy=ou.value[G.name])==null?void 0:wy[xr.id])??null,"show-selected-chance":vs(xr.id),disabled:xr.archived===!0,onToggle:To},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,$9)}),128)),g[97]||(g[97]=d("td",{class:"p-3 md:p-4"},null,-1))],10,k9)}),128)),d("tr",F9,[d("td",U9,[d("div",j9,[d("button",{onClick:g[18]||(g[18]=G=>x.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},g[98]||(g[98]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(N(!0),O(ft,null,Mr(yn.value,G=>(N(),O("td",{key:"add-row-"+G.id,"data-event-id":G.id,class:wn(["p-3 md:p-5",G.archived?"archived-col":""])},null,10,B9))),128)),g[99]||(g[99]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[lp,!ds.value]])])]),ds.value?(N(),O("div",q9,[d("div",z9,[g[101]||(g[101]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",H9,te(mi.value)+"…",1),d("div",K9,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Vr({width:Xr.value+"%"})},null,4)]),d("p",G9,te(Xr.value)+"%",1)])])):ae("",!0),ds.value?ae("",!0):(N(),Gs(qq,{key:1,"season-id":o.value,"season-slug":rs(s),"players-count":dt.value.length,"events-count":Xe.value.length,"onboarding-done":((M=a.value)==null?void 0:M.onboardingCreatorDone)===!0,onCreateEvent:Ei,onAddPlayer:g[19]||(g[19]=()=>{x.value=!0}),onCopyLink:zf,onDismissed:tu},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ae("",!0),Be.value?(N(),O("div",W9,[d("div",Q9,[g[102]||(g[102]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,te(xt.value),1)])])):ae("",!0),kr.value?(N(),O("div",J9,[d("div",Y9,[g[103]||(g[103]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,te(bi.value),1)])])):ae("",!0),Oa.value?(N(),O("div",X9,[d("div",Z9,[g[109]||(g[109]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),d("div",e8,[g[104]||(g[104]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),lt(d("input",{"onUpdate:modelValue":g[20]||(g[20]=G=>xi.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Mt,xi.value]])]),d("div",t8,[g[105]||(g[105]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),lt(d("input",{"onUpdate:modelValue":g[21]||(g[21]=G=>Ii.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Mt,Ii.value]])]),d("div",n8,[g[106]||(g[106]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),lt(d("textarea",{"onUpdate:modelValue":g[22]||(g[22]=G=>br.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Mt,br.value]])]),d("div",r8,[lt(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":g[23]||(g[23]=G=>Va.value=G),class:"w-4 h-4"},null,512),[[Gi,Va.value]]),g[107]||(g[107]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",s8,[g[108]||(g[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),lt(d("input",{"onUpdate:modelValue":g[24]||(g[24]=G=>xo.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Mt,xo.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:hd,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ma,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ae("",!0),x.value?(N(),O("div",i8,[d("div",o8,[g[111]||(g[111]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),d("div",a8,[g[110]||(g[110]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),lt(d("input",{"onUpdate:modelValue":g[25]||(g[25]=G=>A.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Mt,A.value]])]),d("div",l8,[d("button",{onClick:g[26]||(g[26]=G=>x.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:dd,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ae("",!0),c.value?(N(),O("div",u8,[d("div",c8,[g[112]||(g[112]=Nn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),d("div",d8,[d("button",{onClick:cd,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:g[27]||(g[27]=()=>ms()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ae("",!0),Ln.value?(N(),O("div",h8,[d("div",f8,[g[113]||(g[113]=Nn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",p8,[d("button",{onClick:_d,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:g[28]||(g[28]=()=>yd()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ae("",!0),T.value?(N(),O("div",m8,[d("div",g8,[d("div",v8,[g[114]||(g[114]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),g[115]||(g[115]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",y8,[_.value&&Qe.value[_.value]&&Qe.value[_.value].every(G=>wr(G,_.value))?(N(),O("span",_8,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(N(),O("span",b8,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:p,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:u,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ae("",!0),H.value?(N(),O("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Kf},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:g[42]||(g[42]=pt(()=>{},["stop"]))},[d("div",w8,[d("button",{onClick:Kf,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",x8,[g[121]||(g[121]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",I8,[d("div",E8,[d("h2",T8,te((Y=K.value)==null?void 0:Y.title),1),d("div",A8,[g[116]||(g[116]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",S8,te(((se=K.value)==null?void 0:se.playerCount)||6)+" joueurs",1)])]),d("div",P8,[d("p",R8,te(Ua((fe=K.value)==null?void 0:fe.date)),1),d("div",C8,[d("button",{onClick:g[29]||(g[29]=G=>Ur()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},g[117]||(g[117]=[d("span",null,"📅",-1),d("span",null,"Agenda",-1)])),He.value?(N(),O("div",k8,[d("div",D8,[d("button",{onClick:g[30]||(g[30]=G=>{Ba("google"),jr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},g[118]||(g[118]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:g[31]||(g[31]=G=>{Ba("outlook"),jr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},g[119]||(g[119]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:g[32]||(g[32]=G=>{Ba("ics"),jr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},g[120]||(g[120]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):ae("",!0)])]),(ce=K.value)!=null&&ce.description?(N(),O("div",N8,te(K.value.description),1)):ae("",!0)])])]),d("div",O8,[d("div",V8,[d("div",M8,[d("div",L8,te(So((Ve=K.value)==null?void 0:Ve.id)),1),g[122]||(g[122]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",$8,[d("div",F8,te(Po((tt=K.value)==null?void 0:tt.id)),1),g[123]||(g[123]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",U8,[d("div",j8,te(Math.max((((ht=K.value)==null?void 0:ht.playerCount)||6)-Po((kt=K.value)==null?void 0:kt.id),0)),1),g[124]||(g[124]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),K.value?(N(),O("div",B8,[d("div",q8,[uu.value?(N(),O("div",{key:0,class:wn(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((sn=pd.value)==null?void 0:sn.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:Eo.value},[g[125]||(g[125]=d("span",null,"⚠️",-1)),d("span",H8,te(Eo.value),1)],10,z8)):ae("",!0),lt(d("select",{"onUpdate:modelValue":g[33]||(g[33]=G=>lu.value=G),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},g[126]||(g[126]=[Nn('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[zP,lu.value]])]),d("div",K8,[(N(!0),O(ft,null,Mr(Io.value,G=>{var cn,xr;return N(),O("div",{key:G.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",G8,[gs.value.has(G.id)?(N(),O("span",W8," ⭐ ")):ps(G.id)?(N(),O("span",Q8," 🔒 ")):ae("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:G.name},te(G.name),9,J8)]),d("div",Y8,[Ye(Fb,{"player-name":G.name,"event-id":K.value.id,"is-available":Qf(K.value.id)[G.name],"is-selected":hA(G.name,K.value.id),"chance-percent":((cn=ou.value[G.name])==null?void 0:cn[K.value.id])??null,"show-selected-chance":vs(K.value.id),disabled:((xr=K.value)==null?void 0:xr.archived)===!0,compact:!0,onToggle:dA},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ae("",!0),d("div",X8,[d("button",{onClick:g[34]||(g[34]=G=>Co(K.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},g[127]||(g[127]=[d("span",null,"🎭",-1),d("span",null,"Sélectionner",-1)])),d("button",{onClick:g[35]||(g[35]=G=>bd(K.value)),disabled:(_n=K.value)==null?void 0:_n.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(bn=K.value)!=null&&bn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[128]||(g[128]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,Z8),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:ye},[d("button",{onClick:g[36]||(g[36]=G=>vn()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},g[129]||(g[129]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:ry,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(N(),Gs(nc,{to:"body"},[me.value?(N(),O("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:pe,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Vr(Fe.value)},[d("button",{onClick:g[37]||(g[37]=G=>{sy(),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},g[130]||(g[130]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:g[38]||(g[38]=G=>{iy(),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Dt=K.value)!=null&&Dt.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,te((Or=K.value)!=null&&Or.archived?"📂":"📁"),1),d("span",null,te((es=K.value)!=null&&es.archived?"Désarchiver":"Archiver"),1)],8,ez),d("button",{onClick:g[39]||(g[39]=G=>{var cn;wi((cn=K.value)==null?void 0:cn.id),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[131]||(g[131]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ae("",!0)]))])]),d("div",tz,[d("button",{onClick:g[40]||(g[40]=G=>Co(K.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),d("button",{onClick:ry,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:g[41]||(g[41]=G=>rn()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ae("",!0),(N(),Gs(nc,{to:"body"},[ge.value?(N(),O("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Ae,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Vr(Oe.value)},[d("button",{onClick:g[43]||(g[43]=G=>{bd(K.value),ge.value=!1}),disabled:(ko=K.value)==null?void 0:ko.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(qa=K.value)!=null&&qa.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[132]||(g[132]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,nz),d("button",{onClick:g[44]||(g[44]=G=>{sy(),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},g[133]||(g[133]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:g[45]||(g[45]=G=>{iy(),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,te((hy=K.value)!=null&&hy.archived?"📂":"📁"),1),d("span",null,te((fy=K.value)!=null&&fy.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:g[46]||(g[46]=G=>{var cn;wi((cn=K.value)==null?void 0:cn.id),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[134]||(g[134]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ae("",!0)])),Ye(ty,{show:Gt.value,player:un.value,seasonId:o.value,onClose:g[47]||(g[47]=G=>Gt.value=!1),onVerified:fA},null,8,["show","player","seasonId"]),f.value?(N(),O("div",rz,[d("div",sz,[g[140]||(g[140]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),d("div",iz,[g[135]||(g[135]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),lt(d("input",{"onUpdate:modelValue":g[48]||(g[48]=G=>m.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[rr(zr,["esc"]),rr(Na,["enter"])],ref:"editTitleInput"},null,544),[[Mt,m.value]])]),d("div",oz,[g[136]||(g[136]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),lt(d("input",{"onUpdate:modelValue":g[49]||(g[49]=G=>v.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[rr(zr,["esc"]),rr(Na,["enter"])]},null,544),[[Mt,v.value]])]),d("div",az,[g[137]||(g[137]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),lt(d("textarea",{"onUpdate:modelValue":g[50]||(g[50]=G=>X.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:rr(zr,["esc"])},null,544),[[Mt,X.value]])]),d("div",lz,[lt(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":g[51]||(g[51]=G=>ue.value=G),class:"w-4 h-4"},null,512),[[Gi,ue.value]]),g[138]||(g[138]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),d("div",uz,[g[139]||(g[139]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),lt(d("input",{"onUpdate:modelValue":g[52]||(g[52]=G=>w.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:rr(zr,["esc"])},null,544),[[Mt,w.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:zr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Na,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ae("",!0),Ye(L1,{show:S.value,message:y(),error:ke.value,"session-info":Dr(),onSubmit:Q,onCancel:Ie},null,8,["show","message","error","session-info"]),Re.value?(N(),O("div",cz,[d("div",dz,[g[142]||(g[142]=Nn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",hz,[d("div",fz,[d("div",null,[g[141]||(g[141]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(d("input",{"onUpdate:modelValue":g[53]||(g[53]=G=>_e.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[54]||(g[54]=rr(G=>Ct(_e.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Je},null,544),[[Mt,_e.value]])])]),d("button",{onClick:g[55]||(g[55]=G=>Ct(_e.value)),disabled:!_e.value||le.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[le.value?(N(),O("span",mz,"⏳")):(N(),O("span",gz,"🔓")),d("span",null,te(le.value?"Vérification...":"Vérifier et supprimer"),1)],8,pz)]),d("div",vz,[d("button",{onClick:g[56]||(g[56]=G=>it.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),Ce.value?(N(),O("div",yz,[d("div",_z,te(Ce.value),1)])):ae("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:Dn,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ae("",!0),oe.value?(N(),O("div",bz,[d("div",wz,[g[145]||(g[145]=Nn('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",xz,[d("div",Iz,[d("div",null,[g[143]||(g[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(d("input",{"onUpdate:modelValue":g[57]||(g[57]=G=>ut.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[58]||(g[58]=rr(G=>It(ut.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Yt},null,544),[[Mt,ut.value]])])]),d("div",Ez,[d("button",{onClick:g[59]||(g[59]=G=>J.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Le.value?(N(),O("div",Tz,[d("div",Az,te(Le.value),1)])):ae("",!0)]),d("div",Sz,[d("button",{onClick:$n,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:g[60]||(g[60]=G=>It(ut.value)),disabled:!ut.value||At.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[At.value?(N(),O("span",Rz,"⏳")):(N(),O("span",Cz,"🔓")),d("span",null,[_t(te(At.value?"Vérification...":"Vérifier"),1),g[144]||(g[144]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,Pz)])])])):ae("",!0),J.value?(N(),O("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[63]||(g[63]=G=>J.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[62]||(g[62]=pt(()=>{},["stop"]))},[g[147]||(g[147]=Nn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",kz,[g[146]||(g[146]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:Fn,disabled:xe.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[xe.value?(N(),O("span",Nz,"⏳")):(N(),O("span",Oz,"📧")),d("span",null,te(xe.value?"Envoi...":"Envoyer l'email"),1)],8,Dz)]),ve.value?(N(),O("div",Vz,[d("div",Mz,te(ve.value),1)])):ae("",!0),De.value?(N(),O("div",Lz,[d("div",$z,te(De.value),1)])):ae("",!0),d("div",Fz,[d("button",{onClick:g[61]||(g[61]=G=>J.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),it.value?(N(),O("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[66]||(g[66]=G=>it.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[65]||(g[65]=pt(()=>{},["stop"]))},[g[149]||(g[149]=Nn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),d("div",Uz,[g[148]||(g[148]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:Pi,disabled:gt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[gt.value?(N(),O("span",Bz,"⏳")):(N(),O("span",qz,"📧")),d("span",null,te(gt.value?"Envoi...":"Envoyer l'email"),1)],8,jz)]),C.value?(N(),O("div",zz,[d("div",Hz,te(C.value),1)])):ae("",!0),V.value?(N(),O("div",Kz,[d("div",Gz,te(V.value),1)])):ae("",!0),d("div",Wz,[d("button",{onClick:g[64]||(g[64]=G=>it.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ae("",!0),Ye(FB,{ref_key:"playerModalRef",ref:D,show:E.value,player:k.value,stats:gA(k.value),seasonId:o.value,"onboarding-step":j.value,"onboarding-player-id":F.value,"is-protected":k.value?qr.value.has(k.value.id):!1,"is-preferred":k.value?gs.value.has(k.value.id):!1,onClose:oy,onUpdate:pA,onDelete:Si,onRefresh:mA,onAdvanceOnboarding:g[67]||(g[67]=G=>{try{typeof j.value<"u"&&(j.value.value=G)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Ye(Cq,{ref_key:"selectionModalRef",ref:at,show:je.value,event:Ke.value,"current-selection":Qe.value[(py=Ke.value)==null?void 0:py.id]||[],"available-count":So((my=Ke.value)==null?void 0:my.id),"selected-count":Po((gy=Ke.value)==null?void 0:gy.id),"player-availability":Qf((vy=Ke.value)==null?void 0:vy.id),"season-id":o.value,"season-slug":rs(s),players:Zr.value,onClose:uy,onSelection:_A,onPerfect:bA,onSendNotifications:ly,onUpdateSelection:wA},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Ye(lA,{show:vt.value,event:Tt.value,"season-id":o.value,"season-slug":rs(s),players:Zr.value,sending:Wf.value,"availability-by-player":Qf((yy=Tt.value)==null?void 0:yy.id),onClose:yA,onSendNotifications:ly},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Ye(_j,{show:Zn.value,onClose:g[68]||(g[68]=G=>Zn.value=!1)},null,8,["show"]),Ye(rA,{show:rt.value,"season-id":o.value,onClose:cs,onManagePlayer:eu,onChangePassword:Ca,onLogoutDevice:Yr,onDeleteAccount:id},null,8,["show","season-id"]),Ye(sA,{show:tr.value,onClose:qf},null,8,["show"]),Ye(iA,{show:Mn.value,onClose:sd,onManagePlayer:eu},null,8,["show"]),Ye(uA,{show:St.value,player:Aa.value,"season-id":o.value,onClose:g[69]||(g[69]=G=>St.value=!1),onSuccess:g[70]||(g[70]=()=>{St.value=!1,rt.value=!0})},null,8,["show","player","season-id"]),Ye(F1,{show:er.value,onClose:g[71]||(g[71]=G=>er.value=!1),onSuccess:g[72]||(g[72]=()=>{er.value=!1,rt.value=!0})},null,8,["show"]),Cn.value?(N(),O("div",Qz,[d("div",Jz,[g[150]||(g[150]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),g[151]||(g[151]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),d("div",Yz,[d("button",{onClick:g[73]||(g[73]=G=>bd(kn.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:ay,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ae("",!0)],64)}}},Xz={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},Zz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},eH={key:0,class:"text-center py-8"},tH={key:1,class:"text-center py-8"},nH={class:"text-gray-300 mb-6"},rH={key:2,class:"space-y-6"},sH={class:"text-center"},iH={class:"text-gray-300"},oH={class:"font-semibold text-white"},aH={class:"space-y-4"},lH=["disabled"],uH={key:0,class:"animate-spin"},cH={key:1},dH={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},hH={class:"text-red-300 text-sm"},fH={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},pH={class:"text-green-300 text-sm"},mH={__name:"PasswordReset",setup(n){const e=Ea(),t=Xl(),r=R(!0),s=R(""),i=R(""),o=R(""),a=R(""),l=R(""),c=R(!1),h=R(""),f=R(""),m=Ue(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);En(async()=>{try{const{oobCode:x}=e.query;if(U.debug("Token reçu (masqué)"),!x){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=x,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(x){U.error("Erreur lors de la vérification du lien",x),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function v(){if(m.value){c.value=!0,h.value="",f.value="";try{U.debug("Début réinitialisation avec token (masqué)"),await sL(Ge,o.value,a.value),U.info("Mot de passe Firebase Auth mis à jour"),U.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{w()},3e3)}catch(x){U.error("Erreur lors de la réinitialisation",x),x.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":x.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function w(){t.push("/seasons")}return(x,A)=>(N(),O("div",Xz,[d("div",Zz,[A[8]||(A[8]=Nn('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(N(),O("div",eH,A[2]||(A[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(N(),O("div",tH,[A[3]||(A[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),A[4]||(A[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",nH,te(s.value),1),d("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(N(),O("div",rH,[d("div",sH,[d("p",iH,[A[5]||(A[5]=_t("Email : ")),d("span",oH,te(i.value),1)])]),d("div",aH,[d("div",null,[A[6]||(A[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),lt(d("input",{"onUpdate:modelValue":A[0]||(A[0]=L=>a.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:rr(v,["enter"])},null,544),[[Mt,a.value]])]),d("div",null,[A[7]||(A[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),lt(d("input",{"onUpdate:modelValue":A[1]||(A[1]=L=>l.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:rr(v,["enter"])},null,544),[[Mt,l.value]])])]),d("button",{onClick:v,disabled:!m.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(N(),O("span",uH,"⏳")):(N(),O("span",cH,"🔑")),d("span",null,te(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,lH),h.value?(N(),O("div",dH,[d("div",hH,te(h.value),1)])):ae("",!0),f.value?(N(),O("div",fH,[d("div",pH,te(f.value),1)])):ae("",!0)])):ae("",!0)])]))}},gH={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},vH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},yH={class:"text-3xl"},_H={class:"text-2xl font-bold text-white mb-2"},bH={class:"text-gray-300 mb-6"},wH={__name:"MagicLink",setup(n){const e=Ea(),t=Xl(),r=R("loading"),s=R("Traitement en cours..."),i=R("Merci de patienter pendant la validation du lien."),o=Ue(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return En(async()=>{var l;try{Zv("firebase");const c=String(e.query.sid||""),h=String(e.query.pid||"");let f=String(e.query.eid||"");const m=String(e.query.t||""),v=String(e.query.a||""),w=String(e.query.slug||"");if(!m||!v){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(v==="account_email_update"){const B=await q1({token:m});if(!B.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await cL(Ge.currentUser,B.data.newEmail),await z1({token:m}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(v==="verify_email"&&(f="protection"),!(await j1({seasonId:c,playerId:h,eventId:f,token:m,action:v})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(v==="verify_email"){await J1({playerId:h,seasonId:c});try{await tA({playerId:h,seasonId:c})}catch{}await Mm({seasonId:c,playerId:h,eventId:"protection",action:v}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(w?()=>t.push(`/season/${w}?player=${encodeURIComponent(h)}&verified=1`):()=>t.push("/seasons"),800);return}const A=Ee(ie,"seasons",c,"players",h),L=await Kt(A),F=L.exists()&&L.data().name||"";if(!F){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await Q6({seasonId:c,playerName:F,eventId:f,value:v==="yes"}),v==="no")try{const B=Ee(ie,"seasons",c,"selections",f),ne=await Kt(B);if(ne.exists()){const re=Array.isArray((l=ne.data())==null?void 0:l.players)?ne.data().players:[],T=re.filter(_=>_!==F);T.length!==re.length&&await setDoc(B,{players:T},{merge:!0})}}catch{}await Mm({seasonId:c,playerId:h,eventId:f,action:v}),r.value="ok",s.value="Merci !",i.value=v==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(w?()=>t.push(`/season/${w}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){U.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(N(),O("div",gH,[d("div",vH,[d("div",{class:wn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",yH,te(o.value),1)],2),d("h1",_H,te(s.value),1),d("p",bH,te(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},xH={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},IH={class:"text-center py-12 px-4"},EH={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},TH={class:"container mx-auto px-4 pb-16"},AH={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},SH={class:"space-y-5"},PH=["onKeydown"],RH={class:"flex items-center justify-end gap-3 pt-2"},CH=["disabled"],kH={key:0,class:"mt-6 text-sm text-gray-200"},DH={__name:"JoinSeason",setup(n){const e=Ea(),t=Xl(),r=e.params.slug,s=R(""),i=R(""),o=R(""),a=R(!1),l=R("");En(async()=>{const f=Ic(st(ie,"seasons"),Ch("slug","==",r)),m=await Vt(f);if(m.empty)l.value="Saison introuvable";else{const v=m.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await aA(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){U.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,m)=>(N(),O("div",xH,[d("div",IH,[d("h1",EH,te(i.value||"Rejoindre la saison"),1),m[1]||(m[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",TH,[d("div",AH,[m[3]||(m[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",SH,[d("div",null,[m[2]||(m[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),lt(d("input",{"onUpdate:modelValue":m[0]||(m[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:rr(pt(h,["prevent"]),["enter"])},null,40,PH),[[Mt,o.value]])]),d("div",RH,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,CH)])]),l.value?(N(),O("div",kH,te(l.value),1)):ae("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const NH=[{path:"/",component:D$},{path:"/seasons",component:h5},{path:"/season/:slug",component:Ub,props:!0},{path:"/season/:slug/event/:eventId",component:Ub,props:!0},{path:"/season/:slug/join",component:DH,props:!0},{path:"/reset-password",component:mH},{path:"/magic",component:wH}],OH=c$({history:F3("/"),routes:NH});let nl;window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),nl=n,console.log("Événement beforeinstallprompt capturé")});window.addEventListener("appinstalled",n=>{console.log("Application installée"),nl=null});window.triggerInstall=()=>{nl&&(nl.prompt(),nl.userChoice.then(n=>{n.outcome==="accepted"?console.log("Utilisateur a accepté l'installation"):console.log("Utilisateur a refusé l'installation"),nl=null}))};window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches&&console.log("Application déjà installée en mode standalone");const cA=JP(l3);cA.use(OH);cA.mount("#app");p$({immediate:!0,onRegistered(n){window.__swReg=n}});export{st as $,sT as A,ha as B,Ss as C,An as D,$K as E,va as F,iv as G,LK as H,FH as I,Qr as J,aO as K,uO as L,Ql as M,dK as N,hK as O,OO as P,Xn as Q,nK as R,zH as S,an as T,RK as U,vf as V,kO as W,NO as X,cK as Y,GH as Z,Wx as _,bc as a,Zc as a$,BH as a0,lO as a1,bO as a2,MK as a3,Nl as a4,PK as a5,JH as a6,VK as a7,Ee as a8,eK as a9,ZH as aA,yK as aB,_K as aC,tK as aD,yO as aE,EK as aF,TK as aG,RO as aH,Ic as aI,zE as aJ,qH as aK,SK as aL,ri as aM,dn as aN,DK as aO,VH as aP,fK as aQ,oK as aR,iK as aS,uK as aT,YH as aU,wa as aV,kK as aW,WH as aX,Ch as aY,gv as aZ,zK as a_,dO as aa,KH as ab,QH as ac,OK as ad,lK as ae,aK as af,ln as ag,Qc as ah,xO as ai,bK as aj,Kt as ak,pK as al,mK as am,Vt as an,gK as ao,vK as ap,cO as aq,NK as ar,CK as as,HH as at,rK as au,sK as av,XH as aw,wK as ax,IK as ay,xK as az,hO as b,GT as b$,Xc as b0,KK as b1,Sc as b2,xa as b3,qi as b4,UK as b5,Hi as b6,zi as b7,oi as b8,nh as b9,lM as bA,fG as bB,AG as bC,Q_ as bD,UL as bE,RM as bF,aG as bG,eG as bH,eL as bI,vG as bJ,xG as bK,TG as bL,pG as bM,bL as bN,yL as bO,WK as bP,YV as bQ,tL as bR,yG as bS,wG as bT,EG as bU,dM as bV,dG as bW,rG as bX,rL as bY,ZK as bZ,vL as b_,qK as ba,ea as bb,pl as bc,q4 as bd,jK as be,mG as bf,Tm as bg,BK as bh,z4 as bi,qv as bj,Ki as bk,YK as bl,_L as bm,n1 as bn,B4 as bo,s1 as bp,iL as bq,sL as br,kM as bs,oL as bt,HK as bu,hG as bv,nG as bw,oG as bx,Y4 as by,GK as bz,kl as c,Dv as c0,JK as c1,aL as c2,tG as c3,gG as c4,bG as c5,IG as c6,wL as c7,QK as c8,cG as c9,cL as ca,dL as cb,_G as cc,iG as cd,uG as ce,lG as cf,sG as cg,XK as ch,ya as d,Bt as e,he as f,Wl as g,Gc as h,Zd as i,Ef as j,Wc as k,xf as l,pv as m,Dl as n,If as o,Wo as p,DO as q,fn as r,sa as s,Se as t,LH as u,e2 as v,tn as w,FK as x,mt as y,MH as z};
