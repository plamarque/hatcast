(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function qp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Ct={},wa=[],Mr=()=>{},lx=()=>!1,nh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),zp=n=>n.startsWith("onUpdate:"),xn=Object.assign,Kp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},ux=Object.prototype.hasOwnProperty,bt=(n,e)=>ux.call(n,e),Ue=Array.isArray,Ia=n=>Gu(n)==="[object Map]",Za=n=>Gu(n)==="[object Set]",av=n=>Gu(n)==="[object Date]",Qe=n=>typeof n=="function",un=n=>typeof n=="string",rs=n=>typeof n=="symbol",Ot=n=>n!==null&&typeof n=="object",d0=n=>(Ot(n)||Qe(n))&&Qe(n.then)&&Qe(n.catch),h0=Object.prototype.toString,Gu=n=>h0.call(n),cx=n=>Gu(n).slice(8,-1),f0=n=>Gu(n)==="[object Object]",Gp=n=>un(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,tu=qp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),rh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},dx=/-(\w)/g,Tr=rh(n=>n.replace(dx,(e,t)=>t?t.toUpperCase():"")),hx=/\B([A-Z])/g,Mi=rh(n=>n.replace(hx,"-$1").toLowerCase()),sh=rh(n=>n.charAt(0).toUpperCase()+n.slice(1)),cf=rh(n=>n?`on${sh(n)}`:""),bi=(n,e)=>!Object.is(n,e),ed=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},Gf=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Id=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let lv;const ih=()=>lv||(lv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ys(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=un(r)?gx(r):ys(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(un(n)||Ot(n))return n}const fx=/;(?![^(]*\))/g,px=/:([^]+)/,mx=/\/\*[^]*?\*\//g;function gx(n){const e={};return n.replace(mx,"").split(fx).forEach(t=>{if(t){const r=t.split(px);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function At(n){let e="";if(un(n))e=n;else if(Ue(n))for(let t=0;t<n.length;t++){const r=At(n[t]);r&&(e+=r+" ")}else if(Ot(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const vx="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",yx=qp(vx);function p0(n){return!!n||n===""}function _x(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Hu(n[r],e[r]);return t}function Hu(n,e){if(n===e)return!0;let t=av(n),r=av(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=rs(n),r=rs(e),t||r)return n===e;if(t=Ue(n),r=Ue(e),t||r)return t&&r?_x(n,e):!1;if(t=Ot(n),r=Ot(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Hu(n[o],e[o]))return!1}}return String(n)===String(e)}function Hp(n,e){return n.findIndex(t=>Hu(t,e))}const m0=n=>!!(n&&n.__v_isRef===!0),ce=n=>un(n)?n:n==null?"":Ue(n)||Ot(n)&&(n.toString===h0||!Qe(n.toString))?m0(n)?ce(n.value):JSON.stringify(n,g0,2):String(n),g0=(n,e)=>m0(e)?g0(n,e.value):Ia(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[df(r,i)+" =>"]=s,t),{})}:Za(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>df(t))}:rs(e)?df(e):Ot(e)&&!Ue(e)&&!f0(e)?String(e):e,df=(n,e="")=>{var t;return rs(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ir;class bx{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ir,!e&&ir&&(this.index=(ir.scopes||(ir.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=ir;try{return ir=this,e()}finally{ir=t}}}on(){++this._on===1&&(this.prevScope=ir,ir=this)}off(){this._on>0&&--this._on===0&&(ir=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function wx(){return ir}let Dt;const hf=new WeakSet;class v0{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ir&&ir.active&&ir.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,hf.has(this)&&(hf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||_0(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,uv(this),b0(this);const e=Dt,t=Lr;Dt=this,Lr=!0;try{return this.fn()}finally{w0(this),Dt=e,Lr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Jp(e);this.deps=this.depsTail=void 0,uv(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?hf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Hf(this)&&this.run()}get dirty(){return Hf(this)}}let y0=0,nu,ru;function _0(n,e=!1){if(n.flags|=8,e){n.next=ru,ru=n;return}n.next=nu,nu=n}function Wp(){y0++}function Qp(){if(--y0>0)return;if(ru){let e=ru;for(ru=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;nu;){let e=nu;for(nu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function b0(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function w0(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Jp(r),Ix(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Hf(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(I0(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function I0(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===vu)||(n.globalVersion=vu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Hf(n))))return;n.flags|=2;const e=n.dep,t=Dt,r=Lr;Dt=n,Lr=!0;try{b0(n);const s=n.fn(n._value);(e.version===0||bi(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Dt=t,Lr=r,w0(n),n.flags&=-3}}function Jp(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Jp(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function Ix(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Lr=!0;const E0=[];function Ps(){E0.push(Lr),Lr=!1}function Rs(){const n=E0.pop();Lr=n===void 0?!0:n}function uv(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Dt;Dt=void 0;try{e()}finally{Dt=t}}}let vu=0;class Ex{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Yp{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Dt||!Lr||Dt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Dt)t=this.activeLink=new Ex(Dt,this),Dt.deps?(t.prevDep=Dt.depsTail,Dt.depsTail.nextDep=t,Dt.depsTail=t):Dt.deps=Dt.depsTail=t,T0(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Dt.depsTail,t.nextDep=void 0,Dt.depsTail.nextDep=t,Dt.depsTail=t,Dt.deps===t&&(Dt.deps=r)}return t}trigger(e){this.version++,vu++,this.notify(e)}notify(e){Wp();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Qp()}}}function T0(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)T0(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Wf=new WeakMap,Io=Symbol(""),Qf=Symbol(""),yu=Symbol("");function Fn(n,e,t){if(Lr&&Dt){let r=Wf.get(n);r||Wf.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Yp),s.map=r,s.key=t),s.track()}}function _s(n,e,t,r,s,i){const o=Wf.get(n);if(!o){vu++;return}const a=l=>{l&&l.trigger()};if(Wp(),e==="clear")o.forEach(a);else{const l=Ue(n),c=l&&Gp(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===yu||!rs(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(yu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Io)),Ia(n)&&a(o.get(Qf)));break;case"delete":l||(a(o.get(Io)),Ia(n)&&a(o.get(Qf)));break;case"set":Ia(n)&&a(o.get(Io));break}}Qp()}function ua(n){const e=_t(n);return e===n?e:(Fn(e,"iterate",yu),Ir(n)?e:e.map(Pn))}function oh(n){return Fn(n=_t(n),"iterate",yu),n}const Tx={__proto__:null,[Symbol.iterator](){return ff(this,Symbol.iterator,Pn)},concat(...n){return ua(this).concat(...n.map(e=>Ue(e)?ua(e):e))},entries(){return ff(this,"entries",n=>(n[1]=Pn(n[1]),n))},every(n,e){return ps(this,"every",n,e,void 0,arguments)},filter(n,e){return ps(this,"filter",n,e,t=>t.map(Pn),arguments)},find(n,e){return ps(this,"find",n,e,Pn,arguments)},findIndex(n,e){return ps(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return ps(this,"findLast",n,e,Pn,arguments)},findLastIndex(n,e){return ps(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return ps(this,"forEach",n,e,void 0,arguments)},includes(...n){return pf(this,"includes",n)},indexOf(...n){return pf(this,"indexOf",n)},join(n){return ua(this).join(n)},lastIndexOf(...n){return pf(this,"lastIndexOf",n)},map(n,e){return ps(this,"map",n,e,void 0,arguments)},pop(){return Ml(this,"pop")},push(...n){return Ml(this,"push",n)},reduce(n,...e){return cv(this,"reduce",n,e)},reduceRight(n,...e){return cv(this,"reduceRight",n,e)},shift(){return Ml(this,"shift")},some(n,e){return ps(this,"some",n,e,void 0,arguments)},splice(...n){return Ml(this,"splice",n)},toReversed(){return ua(this).toReversed()},toSorted(n){return ua(this).toSorted(n)},toSpliced(...n){return ua(this).toSpliced(...n)},unshift(...n){return Ml(this,"unshift",n)},values(){return ff(this,"values",Pn)}};function ff(n,e,t){const r=oh(n),s=r[e]();return r!==n&&!Ir(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const xx=Array.prototype;function ps(n,e,t,r,s,i){const o=oh(n),a=o!==n&&!Ir(n),l=o[e];if(l!==xx[e]){const f=l.apply(n,i);return a?Pn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Pn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function cv(n,e,t,r){const s=oh(n);let i=t;return s!==n&&(Ir(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Pn(a),l,n)}),s[e](i,...r)}function pf(n,e,t){const r=_t(n);Fn(r,"iterate",yu);const s=r[e](...t);return(s===-1||s===!1)&&em(t[0])?(t[0]=_t(t[0]),r[e](...t)):s}function Ml(n,e,t=[]){Ps(),Wp();const r=_t(n)[e].apply(n,t);return Qp(),Rs(),r}const Ax=qp("__proto__,__v_isRef,__isVue"),x0=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(rs));function Sx(n){rs(n)||(n=String(n));const e=_t(this);return Fn(e,"has",n),e.hasOwnProperty(n)}class A0{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?Lx:C0:i?R0:P0).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ue(e);if(!s){let l;if(o&&(l=Tx[t]))return l;if(t==="hasOwnProperty")return Sx}const a=Reflect.get(e,t,Un(e)?e:r);return(rs(t)?x0.has(t):Ax(t))||(s||Fn(e,"get",t),i)?a:Un(a)?o&&Gp(t)?a:a.value:Ot(a)?s?D0(a):ah(a):a}}class S0 extends A0{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=xi(i);if(!Ir(r)&&!xi(r)&&(i=_t(i),r=_t(r)),!Ue(e)&&Un(i)&&!Un(r))return l?!1:(i.value=r,!0)}const o=Ue(e)&&Gp(t)?Number(t)<e.length:bt(e,t),a=Reflect.set(e,t,r,Un(e)?e:s);return e===_t(s)&&(o?bi(r,i)&&_s(e,"set",t,r):_s(e,"add",t,r)),a}deleteProperty(e,t){const r=bt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&_s(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!rs(t)||!x0.has(t))&&Fn(e,"has",t),r}ownKeys(e){return Fn(e,"iterate",Ue(e)?"length":Io),Reflect.ownKeys(e)}}class Px extends A0{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const Rx=new S0,Cx=new Px,kx=new S0(!0);const Jf=n=>n,Uc=n=>Reflect.getPrototypeOf(n);function Dx(n,e,t){return function(...r){const s=this.__v_raw,i=_t(s),o=Ia(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?Jf:e?Ed:Pn;return!e&&Fn(i,"iterate",l?Qf:Io),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function jc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function Nx(n,e){const t={get(s){const i=this.__v_raw,o=_t(i),a=_t(s);n||(bi(s,a)&&Fn(o,"get",s),Fn(o,"get",a));const{has:l}=Uc(o),c=e?Jf:n?Ed:Pn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Fn(_t(s),"iterate",Io),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=_t(i),a=_t(s);return n||(bi(s,a)&&Fn(o,"has",s),Fn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=_t(a),c=e?Jf:n?Ed:Pn;return!n&&Fn(l,"iterate",Io),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return xn(t,n?{add:jc("add"),set:jc("set"),delete:jc("delete"),clear:jc("clear")}:{add(s){!e&&!Ir(s)&&!xi(s)&&(s=_t(s));const i=_t(this);return Uc(i).has.call(i,s)||(i.add(s),_s(i,"add",s,s)),this},set(s,i){!e&&!Ir(i)&&!xi(i)&&(i=_t(i));const o=_t(this),{has:a,get:l}=Uc(o);let c=a.call(o,s);c||(s=_t(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?bi(i,d)&&_s(o,"set",s,i):_s(o,"add",s,i),this},delete(s){const i=_t(this),{has:o,get:a}=Uc(i);let l=o.call(i,s);l||(s=_t(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&_s(i,"delete",s,void 0),c},clear(){const s=_t(this),i=s.size!==0,o=s.clear();return i&&_s(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=Dx(s,n,e)}),t}function Xp(n,e){const t=Nx(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(bt(t,s)&&s in r?t:r,s,i)}const Vx={get:Xp(!1,!1)},Ox={get:Xp(!1,!0)},Mx={get:Xp(!0,!1)};const P0=new WeakMap,R0=new WeakMap,C0=new WeakMap,Lx=new WeakMap;function Fx(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function $x(n){return n.__v_skip||!Object.isExtensible(n)?0:Fx(cx(n))}function ah(n){return xi(n)?n:Zp(n,!1,Rx,Vx,P0)}function k0(n){return Zp(n,!1,kx,Ox,R0)}function D0(n){return Zp(n,!0,Cx,Mx,C0)}function Zp(n,e,t,r,s){if(!Ot(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=$x(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function Ea(n){return xi(n)?Ea(n.__v_raw):!!(n&&n.__v_isReactive)}function xi(n){return!!(n&&n.__v_isReadonly)}function Ir(n){return!!(n&&n.__v_isShallow)}function em(n){return n?!!n.__v_raw:!1}function _t(n){const e=n&&n.__v_raw;return e?_t(e):n}function Ux(n){return!bt(n,"__v_skip")&&Object.isExtensible(n)&&Gf(n,"__v_skip",!0),n}const Pn=n=>Ot(n)?ah(n):n,Ed=n=>Ot(n)?D0(n):n;function Un(n){return n?n.__v_isRef===!0:!1}function k(n){return N0(n,!1)}function jx(n){return N0(n,!0)}function N0(n,e){return Un(n)?n:new Bx(n,e)}class Bx{constructor(e,t){this.dep=new Yp,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:_t(e),this._value=t?e:Pn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Ir(e)||xi(e);e=r?e:_t(e),bi(e,t)&&(this._rawValue=e,this._value=r?e:Pn(e),this.dep.trigger())}}function Zr(n){return Un(n)?n.value:n}const qx={get:(n,e,t)=>e==="__v_raw"?n:Zr(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Un(s)&&!Un(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function V0(n){return Ea(n)?n:new Proxy(n,qx)}class zx{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Yp(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=vu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Dt!==this)return _0(this,!0),!0}get value(){const e=this.dep.track();return I0(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Kx(n,e,t=!1){let r,s;return Qe(n)?r=n:(r=n.get,s=n.set),new zx(r,s,t)}const Bc={},Td=new WeakMap;let uo;function Gx(n,e=!1,t=uo){if(t){let r=Td.get(t);r||Td.set(t,r=[]),r.push(n)}}function Hx(n,e,t=Ct){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=z=>s?z:Ir(z)||s===!1||s===0?bs(z,1):bs(z);let d,f,g,y,T=!1,A=!1;if(Un(n)?(f=()=>n.value,T=Ir(n)):Ea(n)?(f=()=>c(n),T=!0):Ue(n)?(A=!0,T=n.some(z=>Ea(z)||Ir(z)),f=()=>n.map(z=>{if(Un(z))return z.value;if(Ea(z))return c(z);if(Qe(z))return l?l(z,2):z()})):Qe(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Ps();try{g()}finally{Rs()}}const z=uo;uo=d;try{return l?l(n,3,[y]):n(y)}finally{uo=z}}:f=Mr,e&&s){const z=f,fe=s===!0?1/0:s;f=()=>bs(z(),fe)}const P=wx(),U=()=>{d.stop(),P&&P.active&&Kp(P.effects,d)};if(i&&e){const z=e;e=(...fe)=>{z(...fe),U()}}let q=A?new Array(n.length).fill(Bc):Bc;const L=z=>{if(!(!(d.flags&1)||!d.dirty&&!z))if(e){const fe=d.run();if(s||T||(A?fe.some((me,x)=>bi(me,q[x])):bi(fe,q))){g&&g();const me=uo;uo=d;try{const x=[fe,q===Bc?void 0:A&&q[0]===Bc?[]:q,y];q=fe,l?l(e,3,x):e(...x)}finally{uo=me}}}else d.run()};return a&&a(L),d=new v0(f),d.scheduler=o?()=>o(L,!1):L,y=z=>Gx(z,!1,d),g=d.onStop=()=>{const z=Td.get(d);if(z){if(l)l(z,4);else for(const fe of z)fe();Td.delete(d)}},e?r?L(!0):q=d.run():o?o(L.bind(null,!0),!0):d.run(),U.pause=d.pause.bind(d),U.resume=d.resume.bind(d),U.stop=U,U}function bs(n,e=1/0,t){if(e<=0||!Ot(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Un(n))bs(n.value,e,t);else if(Ue(n))for(let r=0;r<n.length;r++)bs(n[r],e,t);else if(Za(n)||Ia(n))n.forEach(r=>{bs(r,e,t)});else if(f0(n)){for(const r in n)bs(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&bs(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Wu(n,e,t,r){try{return r?n(...r):n()}catch(s){lh(s,e,t)}}function ss(n,e,t,r){if(Qe(n)){const s=Wu(n,e,t,r);return s&&d0(s)&&s.catch(i=>{lh(i,e,t)}),s}if(Ue(n)){const s=[];for(let i=0;i<n.length;i++)s.push(ss(n[i],e,t,r));return s}}function lh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Ct;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){Ps(),Wu(i,null,10,[n,l,c]),Rs();return}}Wx(n,t,s,r,o)}function Wx(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Yn=[];let Wr=-1;const Ta=[];let ai=null,pa=0;const O0=Promise.resolve();let xd=null;function pn(n){const e=xd||O0;return n?e.then(this?n.bind(this):n):e}function Qx(n){let e=Wr+1,t=Yn.length;for(;e<t;){const r=e+t>>>1,s=Yn[r],i=_u(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function tm(n){if(!(n.flags&1)){const e=_u(n),t=Yn[Yn.length-1];!t||!(n.flags&2)&&e>=_u(t)?Yn.push(n):Yn.splice(Qx(e),0,n),n.flags|=1,M0()}}function M0(){xd||(xd=O0.then(F0))}function Jx(n){Ue(n)?Ta.push(...n):ai&&n.id===-1?ai.splice(pa+1,0,n):n.flags&1||(Ta.push(n),n.flags|=1),M0()}function dv(n,e,t=Wr+1){for(;t<Yn.length;t++){const r=Yn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Yn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function L0(n){if(Ta.length){const e=[...new Set(Ta)].sort((t,r)=>_u(t)-_u(r));if(Ta.length=0,ai){ai.push(...e);return}for(ai=e,pa=0;pa<ai.length;pa++){const t=ai[pa];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ai=null,pa=0}}const _u=n=>n.id==null?n.flags&2?-1:1/0:n.id;function F0(n){const e=Mr;try{for(Wr=0;Wr<Yn.length;Wr++){const t=Yn[Wr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Wu(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Wr<Yn.length;Wr++){const t=Yn[Wr];t&&(t.flags&=-2)}Wr=-1,Yn.length=0,L0(),xd=null,(Yn.length||Ta.length)&&F0()}}let hr=null,$0=null;function Ad(n){const e=hr;return hr=n,$0=n&&n.type.__scopeId||null,e}function Yx(n,e=hr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Ev(-1);const i=Ad(e);let o;try{o=n(...s)}finally{Ad(i),r._d&&Ev(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function nt(n,e){if(hr===null)return n;const t=hh(hr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Ct]=e[s];i&&(Qe(i)&&(i={mounted:i,updated:i}),i.deep&&bs(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function oo(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Ps(),ss(l,t,8,[n.el,a,n,e]),Rs())}}const U0=Symbol("_vte"),Xx=n=>n.__isTeleport,su=n=>n&&(n.disabled||n.disabled===""),hv=n=>n&&(n.defer||n.defer===""),fv=n=>typeof SVGElement<"u"&&n instanceof SVGElement,pv=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Yf=(n,e)=>{const t=n&&n.to;return un(t)?e?e(t):null:t},j0={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:d,pc:f,pbc:g,o:{insert:y,querySelector:T,createText:A,createComment:P}}=c,U=su(e.props);let{shapeFlag:q,children:L,dynamicChildren:z}=e;if(n==null){const fe=e.el=A(""),me=e.anchor=A("");y(fe,t,r),y(me,t,r);const x=(w,C)=>{q&16&&(s&&s.isCE&&(s.ce._teleportTarget=w),d(L,w,C,s,i,o,a,l))},I=()=>{const w=e.target=Yf(e.props,T),C=B0(w,e,A,y);w&&(o!=="svg"&&fv(w)?o="svg":o!=="mathml"&&pv(w)&&(o="mathml"),U||(x(w,C),td(e,!1)))};U&&(x(t,me),td(e,!0)),hv(e.props)?(e.el.__isMounted=!1,Qn(()=>{I(),delete e.el.__isMounted},i)):I()}else{if(hv(e.props)&&n.el.__isMounted===!1){Qn(()=>{j0.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const fe=e.anchor=n.anchor,me=e.target=n.target,x=e.targetAnchor=n.targetAnchor,I=su(n.props),w=I?t:me,C=I?fe:x;if(o==="svg"||fv(me)?o="svg":(o==="mathml"||pv(me))&&(o="mathml"),z?(g(n.dynamicChildren,z,w,s,i,o,a),om(n,e,!0)):l||f(n,e,w,C,s,i,o,a,!1),U)I?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):qc(e,t,fe,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const V=e.target=Yf(e.props,T);V&&qc(e,V,null,c,0)}else I&&qc(e,me,x,c,1);td(e,U)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:d,target:f,props:g}=n;if(f&&(s(c),s(d)),i&&s(l),o&16){const y=i||!su(g);for(let T=0;T<a.length;T++){const A=a[T];r(A,e,t,y,!!A.dynamicChildren)}}},move:qc,hydrate:Zx};function qc(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:d}=n,f=i===2;if(f&&r(o,e,t),(!f||su(d))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function Zx(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:d}},f){const g=e.target=Yf(e.props,l);if(g){const y=su(e.props),T=g._lpa||g.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=T,e.targetAnchor=T&&o(T);else{e.anchor=o(n);let A=T;for(;A;){if(A&&A.nodeType===8){if(A.data==="teleport start anchor")e.targetStart=A;else if(A.data==="teleport anchor"){e.targetAnchor=A,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}A=o(A)}e.targetAnchor||B0(g,e,d,c),f(T&&o(T),e,g,t,r,s,i)}td(e,y)}return e.anchor&&o(e.anchor)}const eA=j0;function td(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function B0(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[U0]=i,n&&(r(s,n),r(i,n)),i}function nm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,nm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function q0(n,e){return Qe(n)?(()=>xn({name:n.name},e,{setup:n}))():n}function z0(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function iu(n,e,t,r,s=!1){if(Ue(n)){n.forEach((T,A)=>iu(T,e&&(Ue(e)?e[A]:e),t,r,s));return}if(ou(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&iu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?hh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===Ct?a.refs={}:a.refs,f=a.setupState,g=_t(f),y=f===Ct?()=>!1:T=>bt(g,T);if(c!=null&&c!==l&&(un(c)?(d[c]=null,y(c)&&(f[c]=null)):Un(c)&&(c.value=null)),Qe(l))Wu(l,a,12,[o,d]);else{const T=un(l),A=Un(l);if(T||A){const P=()=>{if(n.f){const U=T?y(l)?f[l]:d[l]:l.value;s?Ue(U)&&Kp(U,i):Ue(U)?U.includes(i)||U.push(i):T?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else T?(d[l]=o,y(l)&&(f[l]=o)):A&&(l.value=o,n.k&&(d[n.k]=o))};o?(P.id=-1,Qn(P,t)):P()}}}ih().requestIdleCallback;ih().cancelIdleCallback;const ou=n=>!!n.type.__asyncLoader,K0=n=>n.type.__isKeepAlive;function tA(n,e){G0(n,"a",e)}function nA(n,e){G0(n,"da",e)}function G0(n,e,t=$n){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(uh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)K0(s.parent.vnode)&&rA(r,e,t,s),s=s.parent}}function rA(n,e,t,r){const s=uh(e,n,r,!0);ba(()=>{Kp(r[e],s)},t)}function uh(n,e,t=$n,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Ps();const a=Qu(t),l=ss(e,t,n,o);return a(),Rs(),l});return r?s.unshift(i):s.push(i),i}}const Ms=n=>(e,t=$n)=>{(!wu||n==="sp")&&uh(n,(...r)=>e(...r),t)},sA=Ms("bm"),Xn=Ms("m"),iA=Ms("bu"),oA=Ms("u"),H0=Ms("bum"),ba=Ms("um"),aA=Ms("sp"),lA=Ms("rtg"),uA=Ms("rtc");function cA(n,e=$n){uh("ec",n,e)}const W0="components";function dA(n,e){return fA(W0,n,!0,e)||n}const hA=Symbol.for("v-ndc");function fA(n,e,t=!0,r=!1){const s=hr||$n;if(s){const i=s.type;if(n===W0){const a=ZA(i,!1);if(a&&(a===e||a===Tr(e)||a===sh(Tr(e))))return i}const o=mv(s[n]||i[n],e)||mv(s.appContext[n],e);return!o&&r?i:o}}function mv(n,e){return n&&(n[e]||n[Tr(e)]||n[sh(Tr(e))])}function wr(n,e,t,r){let s;const i=t&&t[r],o=Ue(n);if(o||un(n)){const a=o&&Ea(n);let l=!1,c=!1;a&&(l=!Ir(n),c=xi(n),n=oh(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?Ed(Pn(n[d])):Pn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Ot(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const Xf=n=>n?hb(n)?hh(n):Xf(n.parent):null,au=xn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Xf(n.parent),$root:n=>Xf(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>rm(n),$forceUpdate:n=>n.f||(n.f=()=>{tm(n.update)}),$nextTick:n=>n.n||(n.n=pn.bind(n.proxy)),$watch:n=>VA.bind(n)}),mf=(n,e)=>n!==Ct&&!n.__isScriptSetup&&bt(n,e),pA={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(mf(r,e))return o[e]=1,r[e];if(s!==Ct&&bt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&bt(c,e))return o[e]=3,i[e];if(t!==Ct&&bt(t,e))return o[e]=4,t[e];Zf&&(o[e]=0)}}const d=au[e];let f,g;if(d)return e==="$attrs"&&Fn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Ct&&bt(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,bt(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return mf(s,e)?(s[e]=t,!0):r!==Ct&&bt(r,e)?(r[e]=t,!0):bt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Ct&&bt(n,o)||mf(e,o)||(a=i[0])&&bt(a,o)||bt(r,o)||bt(au,o)||bt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:bt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function gv(n){return Ue(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Zf=!0;function mA(n){const e=rm(n),t=n.proxy,r=n.ctx;Zf=!1,e.beforeCreate&&vv(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:y,updated:T,activated:A,deactivated:P,beforeDestroy:U,beforeUnmount:q,destroyed:L,unmounted:z,render:fe,renderTracked:me,renderTriggered:x,errorCaptured:I,serverPrefetch:w,expose:C,inheritAttrs:V,components:B,directives:R,filters:It}=e;if(c&&gA(c,r,null),o)for(const j in o){const ne=o[j];Qe(ne)&&(r[j]=ne.bind(t))}if(s){const j=s.call(t,t);Ot(j)&&(n.data=ah(j))}if(Zf=!0,i)for(const j in i){const ne=i[j],Ke=Qe(ne)?ne.bind(t,t):Qe(ne.get)?ne.get.bind(t,t):Mr,Be=!Qe(ne)&&Qe(ne.set)?ne.set.bind(t):Mr,Ge=Oe({get:Ke,set:Be});Object.defineProperty(r,j,{enumerable:!0,configurable:!0,get:()=>Ge.value,set:re=>Ge.value=re})}if(a)for(const j in a)Q0(a[j],r,t,j);if(l){const j=Qe(l)?l.call(t):l;Reflect.ownKeys(j).forEach(ne=>{nd(ne,j[ne])})}d&&vv(d,n,"c");function Y(j,ne){Ue(ne)?ne.forEach(Ke=>j(Ke.bind(t))):ne&&j(ne.bind(t))}if(Y(sA,f),Y(Xn,g),Y(iA,y),Y(oA,T),Y(tA,A),Y(nA,P),Y(cA,I),Y(uA,me),Y(lA,x),Y(H0,q),Y(ba,z),Y(aA,w),Ue(C))if(C.length){const j=n.exposed||(n.exposed={});C.forEach(ne=>{Object.defineProperty(j,ne,{get:()=>t[ne],set:Ke=>t[ne]=Ke})})}else n.exposed||(n.exposed={});fe&&n.render===Mr&&(n.render=fe),V!=null&&(n.inheritAttrs=V),B&&(n.components=B),R&&(n.directives=R),w&&z0(n)}function gA(n,e,t=Mr){Ue(n)&&(n=ep(n));for(const r in n){const s=n[r];let i;Ot(s)?"default"in s?i=Fr(s.from||r,s.default,!0):i=Fr(s.from||r):i=Fr(s),Un(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function vv(n,e,t){ss(Ue(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Q0(n,e,t,r){let s=r.includes(".")?ab(t,r):()=>t[r];if(un(n)){const i=e[n];Qe(i)&&St(s,i)}else if(Qe(n))St(s,n.bind(t));else if(Ot(n))if(Ue(n))n.forEach(i=>Q0(i,e,t,r));else{const i=Qe(n.handler)?n.handler.bind(t):e[n.handler];Qe(i)&&St(s,i,n)}}function rm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Sd(l,c,o,!0)),Sd(l,e,o)),Ot(e)&&i.set(e,l),l}function Sd(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Sd(n,i,t,!0),s&&s.forEach(o=>Sd(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=vA[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const vA={data:yv,props:_v,emits:_v,methods:Hl,computed:Hl,beforeCreate:Wn,created:Wn,beforeMount:Wn,mounted:Wn,beforeUpdate:Wn,updated:Wn,beforeDestroy:Wn,beforeUnmount:Wn,destroyed:Wn,unmounted:Wn,activated:Wn,deactivated:Wn,errorCaptured:Wn,serverPrefetch:Wn,components:Hl,directives:Hl,watch:_A,provide:yv,inject:yA};function yv(n,e){return e?n?function(){return xn(Qe(n)?n.call(this,this):n,Qe(e)?e.call(this,this):e)}:e:n}function yA(n,e){return Hl(ep(n),ep(e))}function ep(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Wn(n,e){return n?[...new Set([].concat(n,e))]:e}function Hl(n,e){return n?xn(Object.create(null),n,e):e}function _v(n,e){return n?Ue(n)&&Ue(e)?[...new Set([...n,...e])]:xn(Object.create(null),gv(n),gv(e??{})):e}function _A(n,e){if(!n)return e;if(!e)return n;const t=xn(Object.create(null),n);for(const r in e)t[r]=Wn(n[r],e[r]);return t}function J0(){return{app:null,config:{isNativeTag:lx,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let bA=0;function wA(n,e){return function(r,s=null){Qe(r)||(r=xn({},r)),s!=null&&!Ot(s)&&(s=null);const i=J0(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:bA++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:tS,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&Qe(d.install)?(o.add(d),d.install(c,...f)):Qe(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!l){const y=c._ceVNode||ct(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,d):n(y,d,g),l=!0,c._container=d,d.__vue_app__=c,hh(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(ss(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=xa;xa=c;try{return d()}finally{xa=f}}};return c}}let xa=null;function nd(n,e){if($n){let t=$n.provides;const r=$n.parent&&$n.parent.provides;r===t&&(t=$n.provides=Object.create(r)),t[n]=e}}function Fr(n,e,t=!1){const r=$n||hr;if(r||xa){let s=xa?xa._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Qe(e)?e.call(r&&r.proxy):e}}const Y0={},X0=()=>Object.create(Y0),Z0=n=>Object.getPrototypeOf(n)===Y0;function IA(n,e,t,r=!1){const s={},i=X0();n.propsDefaults=Object.create(null),eb(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:k0(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function EA(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=_t(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(ch(n.emitsOptions,g))continue;const y=e[g];if(l)if(bt(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const T=Tr(g);s[T]=tp(l,a,T,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{eb(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!bt(e,f)&&((d=Mi(f))===f||!bt(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=tp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!bt(e,f))&&(delete i[f],c=!0)}c&&_s(n.attrs,"set","")}function eb(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(tu(l))continue;const c=e[l];let d;s&&bt(s,d=Tr(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:ch(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=_t(t),c=a||Ct;for(let d=0;d<i.length;d++){const f=i[d];t[f]=tp(s,l,f,c[f],n,!bt(c,f))}}return o}function tp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=bt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Qe(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=Qu(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Mi(t))&&(r=!0))}return r}const TA=new WeakMap;function tb(n,e,t=!1){const r=t?TA:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Qe(n)){const d=f=>{l=!0;const[g,y]=tb(f,e,!0);xn(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Ot(n)&&r.set(n,wa),wa;if(Ue(i))for(let d=0;d<i.length;d++){const f=Tr(i[d]);bv(f)&&(o[f]=Ct)}else if(i)for(const d in i){const f=Tr(d);if(bv(f)){const g=i[d],y=o[f]=Ue(g)||Qe(g)?{type:g}:xn({},g),T=y.type;let A=!1,P=!0;if(Ue(T))for(let U=0;U<T.length;++U){const q=T[U],L=Qe(q)&&q.name;if(L==="Boolean"){A=!0;break}else L==="String"&&(P=!1)}else A=Qe(T)&&T.name==="Boolean";y[0]=A,y[1]=P,(A||bt(y,"default"))&&a.push(f)}}const c=[o,a];return Ot(n)&&r.set(n,c),c}function bv(n){return n[0]!=="$"&&!tu(n)}const sm=n=>n[0]==="_"||n==="$stable",im=n=>Ue(n)?n.map(Qr):[Qr(n)],xA=(n,e,t)=>{if(e._n)return e;const r=Yx((...s)=>im(e(...s)),t);return r._c=!1,r},nb=(n,e,t)=>{const r=n._ctx;for(const s in n){if(sm(s))continue;const i=n[s];if(Qe(i))e[s]=xA(s,i,r);else if(i!=null){const o=im(i);e[s]=()=>o}}},rb=(n,e)=>{const t=im(e);n.slots.default=()=>t},sb=(n,e,t)=>{for(const r in e)(t||!sm(r))&&(n[r]=e[r])},AA=(n,e,t)=>{const r=n.slots=X0();if(n.vnode.shapeFlag&32){const s=e.__;s&&Gf(r,"__",s,!0);const i=e._;i?(sb(r,e,t),t&&Gf(r,"_",i,!0)):nb(e,r)}else e&&rb(n,e)},SA=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Ct;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:sb(s,e,t):(i=!e.$stable,nb(e,s)),o=e}else e&&(rb(n,e),o={default:1});if(i)for(const a in s)!sm(a)&&o[a]==null&&delete s[a]},Qn=jA;function PA(n){return RA(n)}function RA(n,e){const t=ih();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:y=Mr,insertStaticContent:T}=n,A=(E,S,M,oe=null,Z=null,ue=null,be=void 0,ye=null,_e=!!S.dynamicChildren)=>{if(E===S)return;E&&!Ll(E,S)&&(oe=D(E),re(E,Z,ue,!0),E=null),S.patchFlag===-2&&(_e=!1,S.dynamicChildren=null);const{type:pe,ref:Se,shapeFlag:Te}=S;switch(pe){case dh:P(E,S,M,oe);break;case Ai:U(E,S,M,oe);break;case rd:E==null&&q(S,M,oe,be);break;case dt:B(E,S,M,oe,Z,ue,be,ye,_e);break;default:Te&1?fe(E,S,M,oe,Z,ue,be,ye,_e):Te&6?R(E,S,M,oe,Z,ue,be,ye,_e):(Te&64||Te&128)&&pe.process(E,S,M,oe,Z,ue,be,ye,_e,se)}Se!=null&&Z?iu(Se,E&&E.ref,ue,S||E,!S):Se==null&&E&&E.ref!=null&&iu(E.ref,null,ue,E,!0)},P=(E,S,M,oe)=>{if(E==null)r(S.el=a(S.children),M,oe);else{const Z=S.el=E.el;S.children!==E.children&&c(Z,S.children)}},U=(E,S,M,oe)=>{E==null?r(S.el=l(S.children||""),M,oe):S.el=E.el},q=(E,S,M,oe)=>{[E.el,E.anchor]=T(E.children,S,M,oe,E.el,E.anchor)},L=({el:E,anchor:S},M,oe)=>{let Z;for(;E&&E!==S;)Z=g(E),r(E,M,oe),E=Z;r(S,M,oe)},z=({el:E,anchor:S})=>{let M;for(;E&&E!==S;)M=g(E),s(E),E=M;s(S)},fe=(E,S,M,oe,Z,ue,be,ye,_e)=>{S.type==="svg"?be="svg":S.type==="math"&&(be="mathml"),E==null?me(S,M,oe,Z,ue,be,ye,_e):w(E,S,Z,ue,be,ye,_e)},me=(E,S,M,oe,Z,ue,be,ye)=>{let _e,pe;const{props:Se,shapeFlag:Te,transition:Pe,dirs:De}=E;if(_e=E.el=o(E.type,ue,Se&&Se.is,Se),Te&8?d(_e,E.children):Te&16&&I(E.children,_e,null,oe,Z,gf(E,ue),be,ye),De&&oo(E,null,oe,"created"),x(_e,E,E.scopeId,be,oe),Se){for(const He in Se)He!=="value"&&!tu(He)&&i(_e,He,null,Se[He],ue,oe);"value"in Se&&i(_e,"value",null,Se.value,ue),(pe=Se.onVnodeBeforeMount)&&Hr(pe,oe,E)}De&&oo(E,null,oe,"beforeMount");const Le=CA(Z,Pe);Le&&Pe.beforeEnter(_e),r(_e,S,M),((pe=Se&&Se.onVnodeMounted)||Le||De)&&Qn(()=>{pe&&Hr(pe,oe,E),Le&&Pe.enter(_e),De&&oo(E,null,oe,"mounted")},Z)},x=(E,S,M,oe,Z)=>{if(M&&y(E,M),oe)for(let ue=0;ue<oe.length;ue++)y(E,oe[ue]);if(Z){let ue=Z.subTree;if(S===ue||ub(ue.type)&&(ue.ssContent===S||ue.ssFallback===S)){const be=Z.vnode;x(E,be,be.scopeId,be.slotScopeIds,Z.parent)}}},I=(E,S,M,oe,Z,ue,be,ye,_e=0)=>{for(let pe=_e;pe<E.length;pe++){const Se=E[pe]=ye?li(E[pe]):Qr(E[pe]);A(null,Se,S,M,oe,Z,ue,be,ye)}},w=(E,S,M,oe,Z,ue,be)=>{const ye=S.el=E.el;let{patchFlag:_e,dynamicChildren:pe,dirs:Se}=S;_e|=E.patchFlag&16;const Te=E.props||Ct,Pe=S.props||Ct;let De;if(M&&ao(M,!1),(De=Pe.onVnodeBeforeUpdate)&&Hr(De,M,S,E),Se&&oo(S,E,M,"beforeUpdate"),M&&ao(M,!0),(Te.innerHTML&&Pe.innerHTML==null||Te.textContent&&Pe.textContent==null)&&d(ye,""),pe?C(E.dynamicChildren,pe,ye,M,oe,gf(S,Z),ue):be||ne(E,S,ye,null,M,oe,gf(S,Z),ue,!1),_e>0){if(_e&16)V(ye,Te,Pe,M,Z);else if(_e&2&&Te.class!==Pe.class&&i(ye,"class",null,Pe.class,Z),_e&4&&i(ye,"style",Te.style,Pe.style,Z),_e&8){const Le=S.dynamicProps;for(let He=0;He<Le.length;He++){const Ze=Le[He],Yt=Te[Ze],Bt=Pe[Ze];(Bt!==Yt||Ze==="value")&&i(ye,Ze,Yt,Bt,Z,M)}}_e&1&&E.children!==S.children&&d(ye,S.children)}else!be&&pe==null&&V(ye,Te,Pe,M,Z);((De=Pe.onVnodeUpdated)||Se)&&Qn(()=>{De&&Hr(De,M,S,E),Se&&oo(S,E,M,"updated")},oe)},C=(E,S,M,oe,Z,ue,be)=>{for(let ye=0;ye<S.length;ye++){const _e=E[ye],pe=S[ye],Se=_e.el&&(_e.type===dt||!Ll(_e,pe)||_e.shapeFlag&198)?f(_e.el):M;A(_e,pe,Se,null,oe,Z,ue,be,!0)}},V=(E,S,M,oe,Z)=>{if(S!==M){if(S!==Ct)for(const ue in S)!tu(ue)&&!(ue in M)&&i(E,ue,S[ue],null,Z,oe);for(const ue in M){if(tu(ue))continue;const be=M[ue],ye=S[ue];be!==ye&&ue!=="value"&&i(E,ue,ye,be,Z,oe)}"value"in M&&i(E,"value",S.value,M.value,Z)}},B=(E,S,M,oe,Z,ue,be,ye,_e)=>{const pe=S.el=E?E.el:a(""),Se=S.anchor=E?E.anchor:a("");let{patchFlag:Te,dynamicChildren:Pe,slotScopeIds:De}=S;De&&(ye=ye?ye.concat(De):De),E==null?(r(pe,M,oe),r(Se,M,oe),I(S.children||[],M,Se,Z,ue,be,ye,_e)):Te>0&&Te&64&&Pe&&E.dynamicChildren?(C(E.dynamicChildren,Pe,M,Z,ue,be,ye),(S.key!=null||Z&&S===Z.subTree)&&om(E,S,!0)):ne(E,S,M,Se,Z,ue,be,ye,_e)},R=(E,S,M,oe,Z,ue,be,ye,_e)=>{S.slotScopeIds=ye,E==null?S.shapeFlag&512?Z.ctx.activate(S,M,oe,be,_e):It(S,M,oe,Z,ue,be,_e):vt(E,S,_e)},It=(E,S,M,oe,Z,ue,be)=>{const ye=E.component=WA(E,oe,Z);if(K0(E)&&(ye.ctx.renderer=se),QA(ye,!1,be),ye.asyncDep){if(Z&&Z.registerDep(ye,Y,be),!E.el){const _e=ye.subTree=ct(Ai);U(null,_e,S,M)}}else Y(ye,E,S,M,Z,ue,be)},vt=(E,S,M)=>{const oe=S.component=E.component;if($A(E,S,M))if(oe.asyncDep&&!oe.asyncResolved){j(oe,S,M);return}else oe.next=S,oe.update();else S.el=E.el,oe.vnode=S},Y=(E,S,M,oe,Z,ue,be)=>{const ye=()=>{if(E.isMounted){let{next:Te,bu:Pe,u:De,parent:Le,vnode:He}=E;{const Lt=ib(E);if(Lt){Te&&(Te.el=He.el,j(E,Te,be)),Lt.asyncDep.then(()=>{E.isUnmounted||ye()});return}}let Ze=Te,Yt;ao(E,!1),Te?(Te.el=He.el,j(E,Te,be)):Te=He,Pe&&ed(Pe),(Yt=Te.props&&Te.props.onVnodeBeforeUpdate)&&Hr(Yt,Le,Te,He),ao(E,!0);const Bt=vf(E),_n=E.subTree;E.subTree=Bt,A(_n,Bt,f(_n.el),D(_n),E,Z,ue),Te.el=Bt.el,Ze===null&&UA(E,Bt.el),De&&Qn(De,Z),(Yt=Te.props&&Te.props.onVnodeUpdated)&&Qn(()=>Hr(Yt,Le,Te,He),Z)}else{let Te;const{el:Pe,props:De}=S,{bm:Le,m:He,parent:Ze,root:Yt,type:Bt}=E,_n=ou(S);if(ao(E,!1),Le&&ed(Le),!_n&&(Te=De&&De.onVnodeBeforeMount)&&Hr(Te,Ze,S),ao(E,!0),Pe&&$e){const Lt=()=>{E.subTree=vf(E),$e(Pe,E.subTree,E,Z,null)};_n&&Bt.__asyncHydrate?Bt.__asyncHydrate(Pe,E,Lt):Lt()}else{Yt.ce&&Yt.ce._def.shadowRoot!==!1&&Yt.ce._injectChildStyle(Bt);const Lt=E.subTree=vf(E);A(null,Lt,M,oe,E,Z,ue),S.el=Lt.el}if(He&&Qn(He,Z),!_n&&(Te=De&&De.onVnodeMounted)){const Lt=S;Qn(()=>Hr(Te,Ze,Lt),Z)}(S.shapeFlag&256||Ze&&ou(Ze.vnode)&&Ze.vnode.shapeFlag&256)&&E.a&&Qn(E.a,Z),E.isMounted=!0,S=M=oe=null}};E.scope.on();const _e=E.effect=new v0(ye);E.scope.off();const pe=E.update=_e.run.bind(_e),Se=E.job=_e.runIfDirty.bind(_e);Se.i=E,Se.id=E.uid,_e.scheduler=()=>tm(Se),ao(E,!0),pe()},j=(E,S,M)=>{S.component=E;const oe=E.vnode.props;E.vnode=S,E.next=null,EA(E,S.props,oe,M),SA(E,S.children,M),Ps(),dv(E),Rs()},ne=(E,S,M,oe,Z,ue,be,ye,_e=!1)=>{const pe=E&&E.children,Se=E?E.shapeFlag:0,Te=S.children,{patchFlag:Pe,shapeFlag:De}=S;if(Pe>0){if(Pe&128){Be(pe,Te,M,oe,Z,ue,be,ye,_e);return}else if(Pe&256){Ke(pe,Te,M,oe,Z,ue,be,ye,_e);return}}De&8?(Se&16&&ht(pe,Z,ue),Te!==pe&&d(M,Te)):Se&16?De&16?Be(pe,Te,M,oe,Z,ue,be,ye,_e):ht(pe,Z,ue,!0):(Se&8&&d(M,""),De&16&&I(Te,M,oe,Z,ue,be,ye,_e))},Ke=(E,S,M,oe,Z,ue,be,ye,_e)=>{E=E||wa,S=S||wa;const pe=E.length,Se=S.length,Te=Math.min(pe,Se);let Pe;for(Pe=0;Pe<Te;Pe++){const De=S[Pe]=_e?li(S[Pe]):Qr(S[Pe]);A(E[Pe],De,M,null,Z,ue,be,ye,_e)}pe>Se?ht(E,Z,ue,!0,!1,Te):I(S,M,oe,Z,ue,be,ye,_e,Te)},Be=(E,S,M,oe,Z,ue,be,ye,_e)=>{let pe=0;const Se=S.length;let Te=E.length-1,Pe=Se-1;for(;pe<=Te&&pe<=Pe;){const De=E[pe],Le=S[pe]=_e?li(S[pe]):Qr(S[pe]);if(Ll(De,Le))A(De,Le,M,null,Z,ue,be,ye,_e);else break;pe++}for(;pe<=Te&&pe<=Pe;){const De=E[Te],Le=S[Pe]=_e?li(S[Pe]):Qr(S[Pe]);if(Ll(De,Le))A(De,Le,M,null,Z,ue,be,ye,_e);else break;Te--,Pe--}if(pe>Te){if(pe<=Pe){const De=Pe+1,Le=De<Se?S[De].el:oe;for(;pe<=Pe;)A(null,S[pe]=_e?li(S[pe]):Qr(S[pe]),M,Le,Z,ue,be,ye,_e),pe++}}else if(pe>Pe)for(;pe<=Te;)re(E[pe],Z,ue,!0),pe++;else{const De=pe,Le=pe,He=new Map;for(pe=Le;pe<=Pe;pe++){const cn=S[pe]=_e?li(S[pe]):Qr(S[pe]);cn.key!=null&&He.set(cn.key,pe)}let Ze,Yt=0;const Bt=Pe-Le+1;let _n=!1,Lt=0;const mr=new Array(Bt);for(pe=0;pe<Bt;pe++)mr[pe]=0;for(pe=De;pe<=Te;pe++){const cn=E[pe];if(Yt>=Bt){re(cn,Z,ue,!0);continue}let kn;if(cn.key!=null)kn=He.get(cn.key);else for(Ze=Le;Ze<=Pe;Ze++)if(mr[Ze-Le]===0&&Ll(cn,S[Ze])){kn=Ze;break}kn===void 0?re(cn,Z,ue,!0):(mr[kn-Le]=pe+1,kn>=Lt?Lt=kn:_n=!0,A(cn,S[kn],M,null,Z,ue,be,ye,_e),Yt++)}const jr=_n?kA(mr):wa;for(Ze=jr.length-1,pe=Bt-1;pe>=0;pe--){const cn=Le+pe,kn=S[cn],zi=cn+1<Se?S[cn+1].el:oe;mr[pe]===0?A(null,kn,M,zi,Z,ue,be,ye,_e):_n&&(Ze<0||pe!==jr[Ze]?Ge(kn,M,zi,2):Ze--)}}},Ge=(E,S,M,oe,Z=null)=>{const{el:ue,type:be,transition:ye,children:_e,shapeFlag:pe}=E;if(pe&6){Ge(E.component.subTree,S,M,oe);return}if(pe&128){E.suspense.move(S,M,oe);return}if(pe&64){be.move(E,S,M,se);return}if(be===dt){r(ue,S,M);for(let Te=0;Te<_e.length;Te++)Ge(_e[Te],S,M,oe);r(E.anchor,S,M);return}if(be===rd){L(E,S,M);return}if(oe!==2&&pe&1&&ye)if(oe===0)ye.beforeEnter(ue),r(ue,S,M),Qn(()=>ye.enter(ue),Z);else{const{leave:Te,delayLeave:Pe,afterLeave:De}=ye,Le=()=>{E.ctx.isUnmounted?s(ue):r(ue,S,M)},He=()=>{Te(ue,()=>{Le(),De&&De()})};Pe?Pe(ue,Le,He):He()}else r(ue,S,M)},re=(E,S,M,oe=!1,Z=!1)=>{const{type:ue,props:be,ref:ye,children:_e,dynamicChildren:pe,shapeFlag:Se,patchFlag:Te,dirs:Pe,cacheIndex:De}=E;if(Te===-2&&(Z=!1),ye!=null&&(Ps(),iu(ye,null,M,E,!0),Rs()),De!=null&&(S.renderCache[De]=void 0),Se&256){S.ctx.deactivate(E);return}const Le=Se&1&&Pe,He=!ou(E);let Ze;if(He&&(Ze=be&&be.onVnodeBeforeUnmount)&&Hr(Ze,S,E),Se&6)Xe(E.component,M,oe);else{if(Se&128){E.suspense.unmount(M,oe);return}Le&&oo(E,null,S,"beforeUnmount"),Se&64?E.type.remove(E,S,M,se,oe):pe&&!pe.hasOnce&&(ue!==dt||Te>0&&Te&64)?ht(pe,S,M,!1,!0):(ue===dt&&Te&384||!Z&&Se&16)&&ht(_e,S,M),oe&&ee(E)}(He&&(Ze=be&&be.onVnodeUnmounted)||Le)&&Qn(()=>{Ze&&Hr(Ze,S,E),Le&&oo(E,null,S,"unmounted")},M)},ee=E=>{const{type:S,el:M,anchor:oe,transition:Z}=E;if(S===dt){je(M,oe);return}if(S===rd){z(E);return}const ue=()=>{s(M),Z&&!Z.persisted&&Z.afterLeave&&Z.afterLeave()};if(E.shapeFlag&1&&Z&&!Z.persisted){const{leave:be,delayLeave:ye}=Z,_e=()=>be(M,ue);ye?ye(E.el,ue,_e):_e()}else ue()},je=(E,S)=>{let M;for(;E!==S;)M=g(E),s(E),E=M;s(S)},Xe=(E,S,M)=>{const{bum:oe,scope:Z,job:ue,subTree:be,um:ye,m:_e,a:pe,parent:Se,slots:{__:Te}}=E;wv(_e),wv(pe),oe&&ed(oe),Se&&Ue(Te)&&Te.forEach(Pe=>{Se.renderCache[Pe]=void 0}),Z.stop(),ue&&(ue.flags|=8,re(be,E,S,M)),ye&&Qn(ye,S),Qn(()=>{E.isUnmounted=!0},S),S&&S.pendingBranch&&!S.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===S.pendingId&&(S.deps--,S.deps===0&&S.resolve())},ht=(E,S,M,oe=!1,Z=!1,ue=0)=>{for(let be=ue;be<E.length;be++)re(E[be],S,M,oe,Z)},D=E=>{if(E.shapeFlag&6)return D(E.component.subTree);if(E.shapeFlag&128)return E.suspense.next();const S=g(E.anchor||E.el),M=S&&S[U0];return M?g(M):S};let $=!1;const X=(E,S,M)=>{E==null?S._vnode&&re(S._vnode,null,null,!0):A(S._vnode||null,E,S,null,null,null,M),S._vnode=E,$||($=!0,dv(),L0(),$=!1)},se={p:A,um:re,m:Ge,r:ee,mt:It,mc:I,pc:ne,pbc:C,n:D,o:n};let ke,$e;return e&&([ke,$e]=e(se)),{render:X,hydrate:ke,createApp:wA(X,ke)}}function gf({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function ao({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function CA(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function om(n,e,t=!1){const r=n.children,s=e.children;if(Ue(r)&&Ue(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=li(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&om(o,a)),a.type===dh&&(a.el=o.el),a.type===Ai&&!a.el&&(a.el=o.el)}}function kA(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function ib(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:ib(e)}function wv(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const DA=Symbol.for("v-scx"),NA=()=>Fr(DA);function St(n,e,t){return ob(n,e,t)}function ob(n,e,t=Ct){const{immediate:r,deep:s,flush:i,once:o}=t,a=xn({},t),l=e&&r||!e&&i!=="post";let c;if(wu){if(i==="sync"){const y=NA();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=Mr,y.resume=Mr,y.pause=Mr,y}}const d=$n;a.call=(y,T,A)=>ss(y,d,T,A);let f=!1;i==="post"?a.scheduler=y=>{Qn(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,T)=>{T?y():tm(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const g=Hx(n,e,a);return wu&&(c?c.push(g):l&&g()),g}function VA(n,e,t){const r=this.proxy,s=un(n)?n.includes(".")?ab(r,n):()=>r[n]:n.bind(r,r);let i;Qe(e)?i=e:(i=e.handler,t=e);const o=Qu(this),a=ob(s,i.bind(r),t);return o(),a}function ab(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const OA=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Tr(e)}Modifiers`]||n[`${Mi(e)}Modifiers`];function MA(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Ct;let s=t;const i=e.startsWith("update:"),o=i&&OA(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>un(d)?d.trim():d)),o.number&&(s=t.map(Id)));let a,l=r[a=cf(e)]||r[a=cf(Tr(e))];!l&&i&&(l=r[a=cf(Mi(e))]),l&&ss(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ss(c,n,6,s)}}function lb(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Qe(n)){const l=c=>{const d=lb(c,e,!0);d&&(a=!0,xn(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Ot(n)&&r.set(n,null),null):(Ue(i)?i.forEach(l=>o[l]=null):xn(o,i),Ot(n)&&r.set(n,o),o)}function ch(n,e){return!n||!nh(e)?!1:(e=e.slice(2).replace(/Once$/,""),bt(n,e[0].toLowerCase()+e.slice(1))||bt(n,Mi(e))||bt(n,e))}function vf(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:g,setupState:y,ctx:T,inheritAttrs:A}=n,P=Ad(n);let U,q;try{if(t.shapeFlag&4){const z=s||r,fe=z;U=Qr(c.call(fe,z,d,f,y,g,T)),q=a}else{const z=e;U=Qr(z.length>1?z(f,{attrs:a,slots:o,emit:l}):z(f,null)),q=e.props?a:LA(a)}}catch(z){lu.length=0,lh(z,n,1),U=ct(Ai)}let L=U;if(q&&A!==!1){const z=Object.keys(q),{shapeFlag:fe}=L;z.length&&fe&7&&(i&&z.some(zp)&&(q=FA(q,i)),L=Da(L,q,!1,!0))}return t.dirs&&(L=Da(L,null,!1,!0),L.dirs=L.dirs?L.dirs.concat(t.dirs):t.dirs),t.transition&&nm(L,t.transition),U=L,Ad(P),U}const LA=n=>{let e;for(const t in n)(t==="class"||t==="style"||nh(t))&&((e||(e={}))[t]=n[t]);return e},FA=(n,e)=>{const t={};for(const r in n)(!zp(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function $A(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Iv(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!ch(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Iv(r,o,c):!0:!!o;return!1}function Iv(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!ch(t,i))return!0}return!1}function UA({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const ub=n=>n.__isSuspense;function jA(n,e){e&&e.pendingBranch?Ue(n)?e.effects.push(...n):e.effects.push(n):Jx(n)}const dt=Symbol.for("v-fgt"),dh=Symbol.for("v-txt"),Ai=Symbol.for("v-cmt"),rd=Symbol.for("v-stc"),lu=[];let fr=null;function O(n=!1){lu.push(fr=n?null:[])}function BA(){lu.pop(),fr=lu[lu.length-1]||null}let bu=1;function Ev(n,e=!1){bu+=n,n<0&&fr&&e&&(fr.hasOnce=!0)}function cb(n){return n.dynamicChildren=bu>0?fr||wa:null,BA(),bu>0&&fr&&fr.push(n),n}function F(n,e,t,r,s,i){return cb(h(n,e,t,r,s,i,!0))}function Pd(n,e,t,r,s){return cb(ct(n,e,t,r,s,!0))}function Rd(n){return n?n.__v_isVNode===!0:!1}function Ll(n,e){return n.type===e.type&&n.key===e.key}const db=({key:n})=>n??null,sd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?un(n)||Un(n)||Qe(n)?{i:hr,r:n,k:e,f:!!t}:n:null);function h(n,e=null,t=null,r=0,s=null,i=n===dt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&db(e),ref:e&&sd(e),scopeId:$0,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:hr};return a?(am(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=un(t)?8:16),bu>0&&!o&&fr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&fr.push(l),l}const ct=qA;function qA(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===hA)&&(n=Ai),Rd(n)){const a=Da(n,e,!0);return t&&am(a,t),bu>0&&!i&&fr&&(a.shapeFlag&6?fr[fr.indexOf(n)]=a:fr.push(a)),a.patchFlag=-2,a}if(eS(n)&&(n=n.__vccOpts),e){e=zA(e);let{class:a,style:l}=e;a&&!un(a)&&(e.class=At(a)),Ot(l)&&(em(l)&&!Ue(l)&&(l=xn({},l)),e.style=ys(l))}const o=un(n)?1:ub(n)?128:Xx(n)?64:Ot(n)?4:Qe(n)?2:0;return h(n,e,t,r,s,o,i,!0)}function zA(n){return n?em(n)||Z0(n)?xn({},n):n:null}function Da(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?KA(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&db(c),ref:e&&e.ref?t&&i?Ue(i)?i.concat(sd(e)):[i,sd(e)]:sd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==dt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Da(n.ssContent),ssFallback:n.ssFallback&&Da(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&nm(d,l.clone(d)),d}function Vt(n=" ",e=0){return ct(dh,null,n,e)}function Jn(n,e){const t=ct(rd,null,n);return t.staticCount=e,t}function ve(n="",e=!1){return e?(O(),Pd(Ai,null,n)):ct(Ai,null,n)}function Qr(n){return n==null||typeof n=="boolean"?ct(Ai):Ue(n)?ct(dt,null,n.slice()):Rd(n)?li(n):ct(dh,null,String(n))}function li(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Da(n)}function am(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ue(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),am(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Z0(e)?e._ctx=hr:s===3&&hr&&(hr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Qe(e)?(e={default:e,_ctx:hr},t=32):(e=String(e),r&64?(t=16,e=[Vt(e)]):t=8);n.children=e,n.shapeFlag|=t}function KA(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=At([e.class,r.class]));else if(s==="style")e.style=ys([e.style,r.style]);else if(nh(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ue(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Hr(n,e,t,r=null){ss(n,e,7,[t,r])}const GA=J0();let HA=0;function WA(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||GA,i={uid:HA++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new bx(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:tb(r,s),emitsOptions:lb(r,s),emit:null,emitted:null,propsDefaults:Ct,inheritAttrs:r.inheritAttrs,ctx:Ct,data:Ct,props:Ct,attrs:Ct,slots:Ct,refs:Ct,setupState:Ct,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=MA.bind(null,i),n.ce&&n.ce(i),i}let $n=null,Cd,np;{const n=ih(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Cd=e("__VUE_INSTANCE_SETTERS__",t=>$n=t),np=e("__VUE_SSR_SETTERS__",t=>wu=t)}const Qu=n=>{const e=$n;return Cd(n),n.scope.on(),()=>{n.scope.off(),Cd(e)}},Tv=()=>{$n&&$n.scope.off(),Cd(null)};function hb(n){return n.vnode.shapeFlag&4}let wu=!1;function QA(n,e=!1,t=!1){e&&np(e);const{props:r,children:s}=n.vnode,i=hb(n);IA(n,r,i,e),AA(n,s,t||e);const o=i?JA(n,e):void 0;return e&&np(!1),o}function JA(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,pA);const{setup:r}=t;if(r){Ps();const s=n.setupContext=r.length>1?XA(n):null,i=Qu(n),o=Wu(r,n,0,[n.props,s]),a=d0(o);if(Rs(),i(),(a||n.sp)&&!ou(n)&&z0(n),a){if(o.then(Tv,Tv),e)return o.then(l=>{xv(n,l,e)}).catch(l=>{lh(l,n,0)});n.asyncDep=o}else xv(n,o,e)}else fb(n,e)}function xv(n,e,t){Qe(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Ot(e)&&(n.setupState=V0(e)),fb(n,t)}let Av;function fb(n,e,t){const r=n.type;if(!n.render){if(!e&&Av&&!r.render){const s=r.template||rm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=xn(xn({isCustomElement:i,delimiters:a},o),l);r.render=Av(s,c)}}n.render=r.render||Mr}{const s=Qu(n);Ps();try{mA(n)}finally{Rs(),s()}}}const YA={get(n,e){return Fn(n,"get",""),n[e]}};function XA(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,YA),slots:n.slots,emit:n.emit,expose:e}}function hh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(V0(Ux(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in au)return au[t](n)},has(e,t){return t in e||t in au}})):n.proxy}function ZA(n,e=!0){return Qe(n)?n.displayName||n.name:n.name||e&&n.__name}function eS(n){return Qe(n)&&"__vccOpts"in n}const Oe=(n,e)=>Kx(n,e,wu);function pb(n,e,t){const r=arguments.length;return r===2?Ot(e)&&!Ue(e)?Rd(e)?ct(n,null,[e]):ct(n,e):ct(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Rd(t)&&(t=[t]),ct(n,e,t))}const tS="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let rp;const Sv=typeof window<"u"&&window.trustedTypes;if(Sv)try{rp=Sv.createPolicy("vue",{createHTML:n=>n})}catch{}const mb=rp?n=>rp.createHTML(n):n=>n,nS="http://www.w3.org/2000/svg",rS="http://www.w3.org/1998/Math/MathML",gs=typeof document<"u"?document:null,Pv=gs&&gs.createElement("template"),sS={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?gs.createElementNS(nS,n):e==="mathml"?gs.createElementNS(rS,n):t?gs.createElement(n,{is:t}):gs.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>gs.createTextNode(n),createComment:n=>gs.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>gs.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Pv.innerHTML=mb(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Pv.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},iS=Symbol("_vtc");function oS(n,e,t){const r=n[iS];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const kd=Symbol("_vod"),gb=Symbol("_vsh"),yf={beforeMount(n,{value:e},{transition:t}){n[kd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Fl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Fl(n,!0),r.enter(n)):r.leave(n,()=>{Fl(n,!1)}):Fl(n,e))},beforeUnmount(n,{value:e}){Fl(n,e)}};function Fl(n,e){n.style.display=e?n[kd]:"none",n[gb]=!e}const aS=Symbol(""),lS=/(^|;)\s*display\s*:/;function uS(n,e,t){const r=n.style,s=un(t);let i=!1;if(t&&!s){if(e)if(un(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&id(r,a,"")}else for(const o in e)t[o]==null&&id(r,o,"");for(const o in t)o==="display"&&(i=!0),id(r,o,t[o])}else if(s){if(e!==t){const o=r[aS];o&&(t+=";"+o),r.cssText=t,i=lS.test(t)}}else e&&n.removeAttribute("style");kd in n&&(n[kd]=i?r.display:"",n[gb]&&(r.display="none"))}const Rv=/\s*!important$/;function id(n,e,t){if(Ue(t))t.forEach(r=>id(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=cS(n,e);Rv.test(t)?n.setProperty(Mi(r),t.replace(Rv,""),"important"):n[r]=t}}const Cv=["Webkit","Moz","ms"],_f={};function cS(n,e){const t=_f[e];if(t)return t;let r=Tr(e);if(r!=="filter"&&r in n)return _f[e]=r;r=sh(r);for(let s=0;s<Cv.length;s++){const i=Cv[s]+r;if(i in n)return _f[e]=i}return e}const kv="http://www.w3.org/1999/xlink";function Dv(n,e,t,r,s,i=yx(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(kv,e.slice(6,e.length)):n.setAttributeNS(kv,e,t):t==null||i&&!p0(t)?n.removeAttribute(e):n.setAttribute(e,i?"":rs(t)?String(t):t)}function Nv(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?mb(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=p0(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function ci(n,e,t,r){n.addEventListener(e,t,r)}function dS(n,e,t,r){n.removeEventListener(e,t,r)}const Vv=Symbol("_vei");function hS(n,e,t,r,s=null){const i=n[Vv]||(n[Vv]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=fS(e);if(r){const c=i[e]=gS(r,s);ci(n,a,c,l)}else o&&(dS(n,a,o,l),i[e]=void 0)}}const Ov=/(?:Once|Passive|Capture)$/;function fS(n){let e;if(Ov.test(n)){e={};let r;for(;r=n.match(Ov);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Mi(n.slice(2)),e]}let bf=0;const pS=Promise.resolve(),mS=()=>bf||(pS.then(()=>bf=0),bf=Date.now());function gS(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ss(vS(r,t.value),e,5,[r])};return t.value=n,t.attached=mS(),t}function vS(n,e){if(Ue(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Mv=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,yS=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?oS(n,r,o):e==="style"?uS(n,t,r):nh(e)?zp(e)||hS(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):_S(n,e,r,o))?(Nv(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Dv(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!un(r))?Nv(n,Tr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Dv(n,e,r,o))};function _S(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Mv(e)&&Qe(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Mv(e)&&un(t)?!1:e in n}const Na=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ue(e)?t=>ed(e,t):e};function bS(n){n.target.composing=!0}function Lv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const xs=Symbol("_assign"),Nt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[xs]=Na(s);const i=r||s.props&&s.props.type==="number";ci(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Id(a)),n[xs](a)}),t&&ci(n,"change",()=>{n.value=n.value.trim()}),e||(ci(n,"compositionstart",bS),ci(n,"compositionend",Lv),ci(n,"change",Lv))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[xs]=Na(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Id(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},yi={deep:!0,created(n,e,t){n[xs]=Na(t),ci(n,"change",()=>{const r=n._modelValue,s=Iu(n),i=n.checked,o=n[xs];if(Ue(r)){const a=Hp(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Za(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(vb(n,i))})},mounted:Fv,beforeUpdate(n,e,t){n[xs]=Na(t),Fv(n,e,t)}};function Fv(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ue(e))s=Hp(e,r.props.value)>-1;else if(Za(e))s=e.has(r.props.value);else{if(e===t)return;s=Hu(e,vb(n,!0))}n.checked!==s&&(n.checked=s)}const wS={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Za(e);ci(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Id(Iu(o)):Iu(o));n[xs](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,pn(()=>{n._assigning=!1})}),n[xs]=Na(r)},mounted(n,{value:e}){$v(n,e)},beforeUpdate(n,e,t){n[xs]=Na(t)},updated(n,{value:e}){n._assigning||$v(n,e)}};function $v(n,e){const t=n.multiple,r=Ue(e);if(!(t&&!r&&!Za(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=Iu(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Hp(e,a)>-1}else o.selected=e.has(a);else if(Hu(Iu(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function Iu(n){return"_value"in n?n._value:n.value}function vb(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const IS=["ctrl","shift","alt","meta"],ES={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>IS.some(t=>n[`${t}Key`]&&!e.includes(t))},xt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=ES[e[o]];if(a&&a(s,e))return}return n(s,...i)})},TS={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Mn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Mi(s.key);if(e.some(o=>o===i||TS[o]===i))return n(s)})},xS=xn({patchProp:yS},sS);let Uv;function AS(){return Uv||(Uv=PA(xS))}const SS=(...n)=>{const e=AS().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=RS(r);if(!s)return;const i=e._component;!Qe(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,PS(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function PS(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function RS(n){return un(n)?document.querySelector(n):n}const CS={__name:"App",setup(n){const e=k(null),t=k(!1);function r(o){o.preventDefault(),e.value=o,t.value=!0}async function s(){e.value&&(e.value.prompt(),await e.value.userChoice,t.value=!1,e.value=null)}function i(){t.value=!1,e.value=null}return Xn(()=>{window.addEventListener("beforeinstallprompt",r),window.addEventListener("appinstalled",i)}),H0(()=>{window.removeEventListener("beforeinstallprompt",r),window.removeEventListener("appinstalled",i)}),(o,a)=>{const l=dA("router-view");return O(),F(dt,null,[ct(l),t.value?(O(),F("button",{key:0,class:"fixed bottom-4 right-4 z-50 rounded-full bg-sky-600 text-white px-4 py-2 shadow-lg hover:bg-sky-700 active:bg-sky-800",onClick:s}," Installer l’app ")):ve("",!0)],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const ma=typeof document<"u";function yb(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function kS(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&yb(n.default)}const yt=Object.assign;function wf(n,e){const t={};for(const r in e){const s=e[r];t[r]=$r(s)?s.map(n):n(s)}return t}const uu=()=>{},$r=Array.isArray,_b=/#/g,DS=/&/g,NS=/\//g,VS=/=/g,OS=/\?/g,bb=/\+/g,MS=/%5B/g,LS=/%5D/g,wb=/%5E/g,FS=/%60/g,Ib=/%7B/g,$S=/%7C/g,Eb=/%7D/g,US=/%20/g;function lm(n){return encodeURI(""+n).replace($S,"|").replace(MS,"[").replace(LS,"]")}function jS(n){return lm(n).replace(Ib,"{").replace(Eb,"}").replace(wb,"^")}function sp(n){return lm(n).replace(bb,"%2B").replace(US,"+").replace(_b,"%23").replace(DS,"%26").replace(FS,"`").replace(Ib,"{").replace(Eb,"}").replace(wb,"^")}function BS(n){return sp(n).replace(VS,"%3D")}function qS(n){return lm(n).replace(_b,"%23").replace(OS,"%3F")}function zS(n){return n==null?"":qS(n).replace(NS,"%2F")}function Eu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const KS=/\/$/,GS=n=>n.replace(KS,"");function If(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=JS(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Eu(o)}}function HS(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function jv(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function WS(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Va(e.matched[r],t.matched[s])&&Tb(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Va(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function Tb(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!QS(n[t],e[t]))return!1;return!0}function QS(n,e){return $r(n)?Bv(n,e):$r(e)?Bv(e,n):n===e}function Bv(n,e){return $r(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function JS(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const ri={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Tu;(function(n){n.pop="pop",n.push="push"})(Tu||(Tu={}));var cu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(cu||(cu={}));function YS(n){if(!n)if(ma){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),GS(n)}const XS=/^[^#]+#/;function ZS(n,e){return n.replace(XS,"#")+e}function e1(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const fh=()=>({left:window.scrollX,top:window.scrollY});function t1(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=e1(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function qv(n,e){return(history.state?history.state.position-e:-1)+n}const ip=new Map;function n1(n,e){ip.set(n,e)}function r1(n){const e=ip.get(n);return ip.delete(n),e}let s1=()=>location.protocol+"//"+location.host;function xb(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),jv(l,"")}return jv(t,n)+r+s}function i1(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=xb(n,location),T=t.value,A=e.value;let P=0;if(g){if(t.value=y,e.value=g,o&&o===T){o=null;return}P=A?g.position-A.position:0}else r(y);s.forEach(U=>{U(t.value,T,{delta:P,type:Tu.pop,direction:P?P>0?cu.forward:cu.back:cu.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const T=s.indexOf(g);T>-1&&s.splice(T,1)};return i.push(y),y}function d(){const{history:g}=window;g.state&&g.replaceState(yt({},g.state,{scroll:fh()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function zv(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?fh():null}}function o1(n){const{history:e,location:t}=window,r={value:xb(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:s1()+n+l;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](g)}}function o(l,c){const d=yt({},e.state,zv(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=yt({},s.value,e.state,{forward:l,scroll:fh()});i(d.current,d,!0);const f=yt({},zv(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function a1(n){n=YS(n);const e=o1(n),t=i1(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=yt({location:"",base:n,go:r,createHref:ZS.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function l1(n){return typeof n=="string"||n&&typeof n=="object"}function Ab(n){return typeof n=="string"||typeof n=="symbol"}const Sb=Symbol("");var Kv;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Kv||(Kv={}));function Oa(n,e){return yt(new Error,{type:n,[Sb]:!0},e)}function ms(n,e){return n instanceof Error&&Sb in n&&(e==null||!!(n.type&e))}const Gv="[^/]+?",u1={sensitive:!1,strict:!1,start:!0,end:!0},c1=/[.+*?^${}()[\]/\\]/g;function d1(n,e){const t=yt({},u1,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(c1,"\\$&"),y+=40;else if(g.type===1){const{value:T,repeatable:A,optional:P,regexp:U}=g;i.push({name:T,repeatable:A,optional:P});const q=U||Gv;if(q!==Gv){y+=10;try{new RegExp(`(${q})`)}catch(z){throw new Error(`Invalid custom RegExp for param "${T}" (${q}): `+z.message)}}let L=A?`((?:${q})(?:/(?:${q}))*)`:`(${q})`;f||(L=P&&c.length<2?`(?:/${L})`:"/"+L),P&&(L+="?"),s+=L,y+=20,P&&(y+=-8),A&&(y+=-20),q===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const y=d[g]||"",T=i[g-1];f[T.name]=y&&T.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of g)if(y.type===0)d+=y.value;else if(y.type===1){const{value:T,repeatable:A,optional:P}=y,U=T in c?c[T]:"";if($r(U)&&!A)throw new Error(`Provided param "${T}" is an array but it is not repeatable (* or + modifiers)`);const q=$r(U)?U.join("/"):U;if(!q)if(P)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${T}"`);d+=q}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function h1(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function Pb(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=h1(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(Hv(r))return 1;if(Hv(s))return-1}return s.length-r.length}function Hv(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const f1={type:0,value:""},p1=/[a-zA-Z0-9_]/;function m1(n){if(!n)return[[]];if(n==="/")return[[f1]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:p1.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function g1(n,e,t){const r=d1(m1(n.path),t),s=yt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function v1(n,e){const t=[],r=new Map;e=Yv({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const T=!y,A=Qv(f);A.aliasOf=y&&y.record;const P=Yv(e,f),U=[A];if("alias"in f){const z=typeof f.alias=="string"?[f.alias]:f.alias;for(const fe of z)U.push(Qv(yt({},A,{components:y?y.record.components:A.components,path:fe,aliasOf:y?y.record:A})))}let q,L;for(const z of U){const{path:fe}=z;if(g&&fe[0]!=="/"){const me=g.record.path,x=me[me.length-1]==="/"?"":"/";z.path=g.record.path+(fe&&x+fe)}if(q=g1(z,g,P),y?y.alias.push(q):(L=L||q,L!==q&&L.alias.push(q),T&&f.name&&!Jv(q)&&o(f.name)),Rb(q)&&l(q),A.children){const me=A.children;for(let x=0;x<me.length;x++)i(me[x],q,y&&y.children[x])}y=y||q}return L?()=>{o(L)}:uu}function o(f){if(Ab(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=b1(f,t);t.splice(g,0,f),f.record.name&&!Jv(f)&&r.set(f.record.name,f)}function c(f,g){let y,T={},A,P;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Oa(1,{location:f});P=y.record.name,T=yt(Wv(g.params,y.keys.filter(L=>!L.optional).concat(y.parent?y.parent.keys.filter(L=>L.optional):[]).map(L=>L.name)),f.params&&Wv(f.params,y.keys.map(L=>L.name))),A=y.stringify(T)}else if(f.path!=null)A=f.path,y=t.find(L=>L.re.test(A)),y&&(T=y.parse(A),P=y.record.name);else{if(y=g.name?r.get(g.name):t.find(L=>L.re.test(g.path)),!y)throw Oa(1,{location:f,currentLocation:g});P=y.record.name,T=yt({},g.params,f.params),A=y.stringify(T)}const U=[];let q=y;for(;q;)U.unshift(q.record),q=q.parent;return{name:P,path:A,params:T,matched:U,meta:_1(U)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function Wv(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Qv(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:y1(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function y1(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Jv(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function _1(n){return n.reduce((e,t)=>yt(e,t.meta),{})}function Yv(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function b1(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;Pb(n,e[i])<0?r=i:t=i+1}const s=w1(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function w1(n){let e=n;for(;e=e.parent;)if(Rb(e)&&Pb(n,e)===0)return e}function Rb({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function I1(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(bb," "),o=i.indexOf("="),a=Eu(o<0?i:i.slice(0,o)),l=o<0?null:Eu(i.slice(o+1));if(a in e){let c=e[a];$r(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Xv(n){let e="";for(let t in n){const r=n[t];if(t=BS(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}($r(r)?r.map(i=>i&&sp(i)):[r&&sp(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function E1(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=$r(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const T1=Symbol(""),Zv=Symbol(""),ph=Symbol(""),um=Symbol(""),op=Symbol("");function $l(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function ui(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(Oa(4,{from:t,to:e})):g instanceof Error?l(g):l1(g)?l(Oa(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function Ef(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(yb(l)){const d=(l.__vccOpts||l)[e];d&&i.push(ui(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=kS(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&ui(y,t,r,o,a,s)()}))}}return i}function ey(n){const e=Fr(ph),t=Fr(um),r=Oe(()=>{const l=Zr(n.to);return e.resolve(l)}),s=Oe(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(Va.bind(null,d));if(g>-1)return g;const y=ty(l[c-2]);return c>1&&ty(d)===y&&f[f.length-1].path!==y?f.findIndex(Va.bind(null,l[c-2])):g}),i=Oe(()=>s.value>-1&&R1(t.params,r.value.params)),o=Oe(()=>s.value>-1&&s.value===t.matched.length-1&&Tb(t.params,r.value.params));function a(l={}){if(P1(l)){const c=e[Zr(n.replace)?"replace":"push"](Zr(n.to)).catch(uu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Oe(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function x1(n){return n.length===1?n[0]:n}const A1=q0({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:ey,setup(n,{slots:e}){const t=ah(ey(n)),{options:r}=Fr(ph),s=Oe(()=>({[ny(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[ny(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&x1(e.default(t));return n.custom?i:pb("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),S1=A1;function P1(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function R1(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!$r(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function ty(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const ny=(n,e,t)=>n??e??t,C1=q0({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Fr(op),s=Oe(()=>n.route||r.value),i=Fr(Zv,0),o=Oe(()=>{let c=Zr(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=Oe(()=>s.value.matched[o.value]);nd(Zv,Oe(()=>o.value+1)),nd(T1,a),nd(op,s);const l=k();return St(()=>[l.value,a.value,n.name],([c,d,f],[g,y,T])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!Va(d,y)||!g)&&(d.enterCallbacks[f]||[]).forEach(A=>A(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return ry(t.default,{Component:g,route:c});const y=f.props[d],T=y?y===!0?c.params:typeof y=="function"?y(c):y:null,P=pb(g,yt({},T,e,{onVnodeUnmounted:U=>{U.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return ry(t.default,{Component:P,route:c})||P}}});function ry(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const k1=C1;function D1(n){const e=v1(n.routes,n),t=n.parseQuery||I1,r=n.stringifyQuery||Xv,s=n.history,i=$l(),o=$l(),a=$l(),l=jx(ri);let c=ri;ma&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=wf.bind(null,D=>""+D),f=wf.bind(null,zS),g=wf.bind(null,Eu);function y(D,$){let X,se;return Ab(D)?(X=e.getRecordMatcher(D),se=$):se=D,e.addRoute(se,X)}function T(D){const $=e.getRecordMatcher(D);$&&e.removeRoute($)}function A(){return e.getRoutes().map(D=>D.record)}function P(D){return!!e.getRecordMatcher(D)}function U(D,$){if($=yt({},$||l.value),typeof D=="string"){const S=If(t,D,$.path),M=e.resolve({path:S.path},$),oe=s.createHref(S.fullPath);return yt(S,M,{params:g(M.params),hash:Eu(S.hash),redirectedFrom:void 0,href:oe})}let X;if(D.path!=null)X=yt({},D,{path:If(t,D.path,$.path).path});else{const S=yt({},D.params);for(const M in S)S[M]==null&&delete S[M];X=yt({},D,{params:f(S)}),$.params=f($.params)}const se=e.resolve(X,$),ke=D.hash||"";se.params=d(g(se.params));const $e=HS(r,yt({},D,{hash:jS(ke),path:se.path})),E=s.createHref($e);return yt({fullPath:$e,hash:ke,query:r===Xv?E1(D.query):D.query||{}},se,{redirectedFrom:void 0,href:E})}function q(D){return typeof D=="string"?If(t,D,l.value.path):yt({},D)}function L(D,$){if(c!==D)return Oa(8,{from:$,to:D})}function z(D){return x(D)}function fe(D){return z(yt(q(D),{replace:!0}))}function me(D){const $=D.matched[D.matched.length-1];if($&&$.redirect){const{redirect:X}=$;let se=typeof X=="function"?X(D):X;return typeof se=="string"&&(se=se.includes("?")||se.includes("#")?se=q(se):{path:se},se.params={}),yt({query:D.query,hash:D.hash,params:se.path!=null?{}:D.params},se)}}function x(D,$){const X=c=U(D),se=l.value,ke=D.state,$e=D.force,E=D.replace===!0,S=me(X);if(S)return x(yt(q(S),{state:typeof S=="object"?yt({},ke,S.state):ke,force:$e,replace:E}),$||X);const M=X;M.redirectedFrom=$;let oe;return!$e&&WS(r,se,X)&&(oe=Oa(16,{to:M,from:se}),Ge(se,se,!0,!1)),(oe?Promise.resolve(oe):C(M,se)).catch(Z=>ms(Z)?ms(Z,2)?Z:Be(Z):ne(Z,M,se)).then(Z=>{if(Z){if(ms(Z,2))return x(yt({replace:E},q(Z.to),{state:typeof Z.to=="object"?yt({},ke,Z.to.state):ke,force:$e}),$||M)}else Z=B(M,se,!0,E,ke);return V(M,se,Z),Z})}function I(D,$){const X=L(D,$);return X?Promise.reject(X):Promise.resolve()}function w(D){const $=je.values().next().value;return $&&typeof $.runWithContext=="function"?$.runWithContext(D):D()}function C(D,$){let X;const[se,ke,$e]=N1(D,$);X=Ef(se.reverse(),"beforeRouteLeave",D,$);for(const S of se)S.leaveGuards.forEach(M=>{X.push(ui(M,D,$))});const E=I.bind(null,D,$);return X.push(E),ht(X).then(()=>{X=[];for(const S of i.list())X.push(ui(S,D,$));return X.push(E),ht(X)}).then(()=>{X=Ef(ke,"beforeRouteUpdate",D,$);for(const S of ke)S.updateGuards.forEach(M=>{X.push(ui(M,D,$))});return X.push(E),ht(X)}).then(()=>{X=[];for(const S of $e)if(S.beforeEnter)if($r(S.beforeEnter))for(const M of S.beforeEnter)X.push(ui(M,D,$));else X.push(ui(S.beforeEnter,D,$));return X.push(E),ht(X)}).then(()=>(D.matched.forEach(S=>S.enterCallbacks={}),X=Ef($e,"beforeRouteEnter",D,$,w),X.push(E),ht(X))).then(()=>{X=[];for(const S of o.list())X.push(ui(S,D,$));return X.push(E),ht(X)}).catch(S=>ms(S,8)?S:Promise.reject(S))}function V(D,$,X){a.list().forEach(se=>w(()=>se(D,$,X)))}function B(D,$,X,se,ke){const $e=L(D,$);if($e)return $e;const E=$===ri,S=ma?history.state:{};X&&(se||E?s.replace(D.fullPath,yt({scroll:E&&S&&S.scroll},ke)):s.push(D.fullPath,ke)),l.value=D,Ge(D,$,X,E),Be()}let R;function It(){R||(R=s.listen((D,$,X)=>{if(!Xe.listening)return;const se=U(D),ke=me(se);if(ke){x(yt(ke,{replace:!0,force:!0}),se).catch(uu);return}c=se;const $e=l.value;ma&&n1(qv($e.fullPath,X.delta),fh()),C(se,$e).catch(E=>ms(E,12)?E:ms(E,2)?(x(yt(q(E.to),{force:!0}),se).then(S=>{ms(S,20)&&!X.delta&&X.type===Tu.pop&&s.go(-1,!1)}).catch(uu),Promise.reject()):(X.delta&&s.go(-X.delta,!1),ne(E,se,$e))).then(E=>{E=E||B(se,$e,!1),E&&(X.delta&&!ms(E,8)?s.go(-X.delta,!1):X.type===Tu.pop&&ms(E,20)&&s.go(-1,!1)),V(se,$e,E)}).catch(uu)}))}let vt=$l(),Y=$l(),j;function ne(D,$,X){Be(D);const se=Y.list();return se.length?se.forEach(ke=>ke(D,$,X)):console.error(D),Promise.reject(D)}function Ke(){return j&&l.value!==ri?Promise.resolve():new Promise((D,$)=>{vt.add([D,$])})}function Be(D){return j||(j=!D,It(),vt.list().forEach(([$,X])=>D?X(D):$()),vt.reset()),D}function Ge(D,$,X,se){const{scrollBehavior:ke}=n;if(!ma||!ke)return Promise.resolve();const $e=!X&&r1(qv(D.fullPath,0))||(se||!X)&&history.state&&history.state.scroll||null;return pn().then(()=>ke(D,$,$e)).then(E=>E&&t1(E)).catch(E=>ne(E,D,$))}const re=D=>s.go(D);let ee;const je=new Set,Xe={currentRoute:l,listening:!0,addRoute:y,removeRoute:T,clearRoutes:e.clearRoutes,hasRoute:P,getRoutes:A,resolve:U,options:n,push:z,replace:fe,go:re,back:()=>re(-1),forward:()=>re(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Y.add,isReady:Ke,install(D){const $=this;D.component("RouterLink",S1),D.component("RouterView",k1),D.config.globalProperties.$router=$,Object.defineProperty(D.config.globalProperties,"$route",{enumerable:!0,get:()=>Zr(l)}),ma&&!ee&&l.value===ri&&(ee=!0,z(s.location).catch(ke=>{}));const X={};for(const ke in ri)Object.defineProperty(X,ke,{get:()=>l.value[ke],enumerable:!0});D.provide(ph,$),D.provide(um,k0(X)),D.provide(op,l);const se=D.unmount;je.add(D),D.unmount=function(){je.delete(D),je.size<1&&(c=ri,R&&R(),R=null,l.value=ri,ee=!1,j=!1),se()}}};function ht(D){return D.reduce(($,X)=>$.then(()=>w(X)),Promise.resolve())}return Xe}function N1(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Va(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Va(c,l))||s.push(l))}return[t,r,s]}function el(){return Fr(ph)}function tl(n){return Fr(um)}const V1="modulepreload",O1=function(n){return"/"+n},sy={},Xt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=O1(i),i in sy)return;sy[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":V1,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function M1(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function d(){if("serviceWorker"in navigator){const{Workbox:f}=await Xt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=d(),c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},L1=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},kb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[d],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Cb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):L1(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new F1;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const T=c<<6&192|f;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class F1 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $1=function(n){const e=Cb(n);return kb.encodeByteArray(e,!0)},Dd=function(n){return $1(n).replace(/\./g,"")},Db=function(n){try{return kb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U1(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j1=()=>U1().__FIREBASE_DEFAULTS__,B1=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},q1=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Db(n[1]);return e&&JSON.parse(e)},mh=()=>{try{return j1()||B1()||q1()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Nb=n=>{var e,t;return(t=(e=mh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},z1=n=>{const e=Nb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Vb=()=>{var n;return(n=mh())===null||n===void 0?void 0:n.config},Ob=n=>{var e;return(e=mh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G1(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Dd(JSON.stringify(t)),Dd(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function H1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(vn())}function W1(){var n;const e=(n=mh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Q1(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function J1(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Y1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function X1(){const n=vn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Mb(){return!W1()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function cm(){try{return typeof indexedDB=="object"}catch{return!1}}function Lb(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function Z1(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP="FirebaseError";class as extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=eP,Object.setPrototypeOf(this,as.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$o.prototype.create)}}class $o{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?tP(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new as(s,a,r)}}function tP(n,e){return n.replace(nP,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const nP=/\{\$([^}]+)}/g;function rP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Si(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(iy(i)&&iy(o)){if(!Si(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function iy(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Wl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ql(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function sP(n,e){const t=new iP(n,e);return t.subscribe.bind(t)}class iP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");oP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Tf),s.error===void 0&&(s.error=Tf),s.complete===void 0&&(s.complete=Tf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function oP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Tf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n){return n&&n._delegate?n._delegate:n}class Ur{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const co="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new K1;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(uP(e))try{this.getOrInitializeService({instanceIdentifier:co})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=co){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=co){return this.instances.has(e)}getOptions(e=co){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:lP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=co){return this.component?this.component.multipleInstances?e:co:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lP(n){return n===co?void 0:n}function uP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new aP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(st||(st={}));const dP={debug:st.DEBUG,verbose:st.VERBOSE,info:st.INFO,warn:st.WARN,error:st.ERROR,silent:st.SILENT},hP=st.INFO,fP={[st.DEBUG]:"log",[st.VERBOSE]:"log",[st.INFO]:"info",[st.WARN]:"warn",[st.ERROR]:"error"},pP=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=fP[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class dm{constructor(e){this.name=e,this._logLevel=hP,this._logHandler=pP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in st))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?dP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,st.DEBUG,...e),this._logHandler(this,st.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,st.VERBOSE,...e),this._logHandler(this,st.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,st.INFO,...e),this._logHandler(this,st.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,st.WARN,...e),this._logHandler(this,st.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,st.ERROR,...e),this._logHandler(this,st.ERROR,...e)}}const mP=(n,e)=>e.some(t=>n instanceof t);let oy,ay;function gP(){return oy||(oy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vP(){return ay||(ay=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fb=new WeakMap,ap=new WeakMap,$b=new WeakMap,xf=new WeakMap,hm=new WeakMap;function yP(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(As(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Fb.set(t,n)}).catch(()=>{}),hm.set(e,n),e}function _P(n){if(ap.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});ap.set(n,e)}let lp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ap.get(n);if(e==="objectStoreNames")return n.objectStoreNames||$b.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return As(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function bP(n){lp=n(lp)}function wP(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Af(this),e,...t);return $b.set(r,e.sort?e.sort():[e]),As(r)}:vP().includes(n)?function(...e){return n.apply(Af(this),e),As(Fb.get(this))}:function(...e){return As(n.apply(Af(this),e))}}function IP(n){return typeof n=="function"?wP(n):(n instanceof IDBTransaction&&_P(n),mP(n,gP())?new Proxy(n,lp):n)}function As(n){if(n instanceof IDBRequest)return yP(n);if(xf.has(n))return xf.get(n);const e=IP(n);return e!==n&&(xf.set(n,e),hm.set(e,n)),e}const Af=n=>hm.get(n);function gh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=As(o);return r&&o.addEventListener("upgradeneeded",l=>{r(As(o.result),l.oldVersion,l.newVersion,As(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Sf(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),As(t).then(()=>{})}const EP=["get","getKey","getAll","getAllKeys","count"],TP=["put","add","delete","clear"],Pf=new Map;function ly(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Pf.get(e))return Pf.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=TP.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||EP.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Pf.set(e,i),i}bP(n=>({...n,get:(e,t,r)=>ly(e,t)||n.get(e,t,r),has:(e,t)=>!!ly(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(AP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function AP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const up="@firebase/app",uy="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs=new dm("@firebase/app"),SP="@firebase/app-compat",PP="@firebase/analytics-compat",RP="@firebase/analytics",CP="@firebase/app-check-compat",kP="@firebase/app-check",DP="@firebase/auth",NP="@firebase/auth-compat",VP="@firebase/database",OP="@firebase/data-connect",MP="@firebase/database-compat",LP="@firebase/functions",FP="@firebase/functions-compat",$P="@firebase/installations",UP="@firebase/installations-compat",jP="@firebase/messaging",BP="@firebase/messaging-compat",qP="@firebase/performance",zP="@firebase/performance-compat",KP="@firebase/remote-config",GP="@firebase/remote-config-compat",HP="@firebase/storage",WP="@firebase/storage-compat",QP="@firebase/firestore",JP="@firebase/vertexai-preview",YP="@firebase/firestore-compat",XP="firebase",ZP="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nd="[DEFAULT]",eR={[up]:"fire-core",[SP]:"fire-core-compat",[RP]:"fire-analytics",[PP]:"fire-analytics-compat",[kP]:"fire-app-check",[CP]:"fire-app-check-compat",[DP]:"fire-auth",[NP]:"fire-auth-compat",[VP]:"fire-rtdb",[OP]:"fire-data-connect",[MP]:"fire-rtdb-compat",[LP]:"fire-fn",[FP]:"fire-fn-compat",[$P]:"fire-iid",[UP]:"fire-iid-compat",[jP]:"fire-fcm",[BP]:"fire-fcm-compat",[qP]:"fire-perf",[zP]:"fire-perf-compat",[KP]:"fire-rc",[GP]:"fire-rc-compat",[HP]:"fire-gcs",[WP]:"fire-gcs-compat",[QP]:"fire-fst",[YP]:"fire-fst-compat",[JP]:"fire-vertex","fire-js":"fire-js",[XP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vd=new Map,tR=new Map,cp=new Map;function cy(n,e){try{n.container.addComponent(e)}catch(t){Cs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function is(n){const e=n.name;if(cp.has(e))return Cs.debug(`There were multiple attempts to register component ${e}.`),!1;cp.set(e,n);for(const t of Vd.values())cy(t,n);for(const t of tR.values())cy(t,n);return!0}function Li(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function nR(n,e,t=Nd){Li(n,e).clearInstance(t)}function on(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rR={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},wi=new $o("app","Firebase",rR);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ur("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw wi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl=ZP;function Ub(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Nd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw wi.create("bad-app-name",{appName:String(s)});if(t||(t=Vb()),!t)throw wi.create("no-options");const i=Vd.get(s);if(i){if(Si(t,i.options)&&Si(r,i.config))return i;throw wi.create("duplicate-app",{appName:s})}const o=new cP(s);for(const l of cp.values())o.addComponent(l);const a=new sR(t,r,o);return Vd.set(s,a),a}function fm(n=Nd){const e=Vd.get(n);if(!e&&n===Nd&&Vb())return Ub();if(!e)throw wi.create("no-app",{appName:n});return e}function Er(n,e,t){var r;let s=(r=eR[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Cs.warn(a.join(" "));return}is(new Ur(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR="firebase-heartbeat-database",oR=1,xu="firebase-heartbeat-store";let Rf=null;function jb(){return Rf||(Rf=gh(iR,oR,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(xu)}catch(t){console.warn(t)}}}}).catch(n=>{throw wi.create("idb-open",{originalErrorMessage:n.message})})),Rf}async function aR(n){try{const t=(await jb()).transaction(xu),r=await t.objectStore(xu).get(Bb(n));return await t.done,r}catch(e){if(e instanceof as)Cs.warn(e.message);else{const t=wi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Cs.warn(t.message)}}}async function dy(n,e){try{const r=(await jb()).transaction(xu,"readwrite");await r.objectStore(xu).put(e,Bb(n)),await r.done}catch(t){if(t instanceof as)Cs.warn(t.message);else{const r=wi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Cs.warn(r.message)}}}function Bb(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lR=1024,uR=30*24*60*60*1e3;class cR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new hR(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=hy();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=uR}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Cs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=hy(),{heartbeatsToSend:r,unsentEntries:s}=dR(this._heartbeatsCache.heartbeats),i=Dd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Cs.warn(t),""}}}function hy(){return new Date().toISOString().substring(0,10)}function dR(n,e=lR){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),fy(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),fy(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class hR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return cm()?Lb().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await aR(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return dy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return dy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function fy(n){return Dd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fR(n){is(new Ur("platform-logger",e=>new xP(e),"PRIVATE")),is(new Ur("heartbeat",e=>new cR(e),"PRIVATE")),Er(up,uy,n),Er(up,uy,"esm2017"),Er("fire-js","")}fR("");var pR="firebase",mR="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Er(pR,mR,"app");var py=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Eo,qb;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(x,I){function w(){}w.prototype=I.prototype,x.D=I.prototype,x.prototype=new w,x.prototype.constructor=x,x.C=function(C,V,B){for(var R=Array(arguments.length-2),It=2;It<arguments.length;It++)R[It-2]=arguments[It];return I.prototype[V].apply(C,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(x,I,w){w||(w=0);var C=Array(16);if(typeof I=="string")for(var V=0;16>V;++V)C[V]=I.charCodeAt(w++)|I.charCodeAt(w++)<<8|I.charCodeAt(w++)<<16|I.charCodeAt(w++)<<24;else for(V=0;16>V;++V)C[V]=I[w++]|I[w++]<<8|I[w++]<<16|I[w++]<<24;I=x.g[0],w=x.g[1],V=x.g[2];var B=x.g[3],R=I+(B^w&(V^B))+C[0]+3614090360&4294967295;I=w+(R<<7&4294967295|R>>>25),R=B+(V^I&(w^V))+C[1]+3905402710&4294967295,B=I+(R<<12&4294967295|R>>>20),R=V+(w^B&(I^w))+C[2]+606105819&4294967295,V=B+(R<<17&4294967295|R>>>15),R=w+(I^V&(B^I))+C[3]+3250441966&4294967295,w=V+(R<<22&4294967295|R>>>10),R=I+(B^w&(V^B))+C[4]+4118548399&4294967295,I=w+(R<<7&4294967295|R>>>25),R=B+(V^I&(w^V))+C[5]+1200080426&4294967295,B=I+(R<<12&4294967295|R>>>20),R=V+(w^B&(I^w))+C[6]+2821735955&4294967295,V=B+(R<<17&4294967295|R>>>15),R=w+(I^V&(B^I))+C[7]+4249261313&4294967295,w=V+(R<<22&4294967295|R>>>10),R=I+(B^w&(V^B))+C[8]+1770035416&4294967295,I=w+(R<<7&4294967295|R>>>25),R=B+(V^I&(w^V))+C[9]+2336552879&4294967295,B=I+(R<<12&4294967295|R>>>20),R=V+(w^B&(I^w))+C[10]+4294925233&4294967295,V=B+(R<<17&4294967295|R>>>15),R=w+(I^V&(B^I))+C[11]+2304563134&4294967295,w=V+(R<<22&4294967295|R>>>10),R=I+(B^w&(V^B))+C[12]+1804603682&4294967295,I=w+(R<<7&4294967295|R>>>25),R=B+(V^I&(w^V))+C[13]+4254626195&4294967295,B=I+(R<<12&4294967295|R>>>20),R=V+(w^B&(I^w))+C[14]+2792965006&4294967295,V=B+(R<<17&4294967295|R>>>15),R=w+(I^V&(B^I))+C[15]+1236535329&4294967295,w=V+(R<<22&4294967295|R>>>10),R=I+(V^B&(w^V))+C[1]+4129170786&4294967295,I=w+(R<<5&4294967295|R>>>27),R=B+(w^V&(I^w))+C[6]+3225465664&4294967295,B=I+(R<<9&4294967295|R>>>23),R=V+(I^w&(B^I))+C[11]+643717713&4294967295,V=B+(R<<14&4294967295|R>>>18),R=w+(B^I&(V^B))+C[0]+3921069994&4294967295,w=V+(R<<20&4294967295|R>>>12),R=I+(V^B&(w^V))+C[5]+3593408605&4294967295,I=w+(R<<5&4294967295|R>>>27),R=B+(w^V&(I^w))+C[10]+38016083&4294967295,B=I+(R<<9&4294967295|R>>>23),R=V+(I^w&(B^I))+C[15]+3634488961&4294967295,V=B+(R<<14&4294967295|R>>>18),R=w+(B^I&(V^B))+C[4]+3889429448&4294967295,w=V+(R<<20&4294967295|R>>>12),R=I+(V^B&(w^V))+C[9]+568446438&4294967295,I=w+(R<<5&4294967295|R>>>27),R=B+(w^V&(I^w))+C[14]+3275163606&4294967295,B=I+(R<<9&4294967295|R>>>23),R=V+(I^w&(B^I))+C[3]+4107603335&4294967295,V=B+(R<<14&4294967295|R>>>18),R=w+(B^I&(V^B))+C[8]+1163531501&4294967295,w=V+(R<<20&4294967295|R>>>12),R=I+(V^B&(w^V))+C[13]+2850285829&4294967295,I=w+(R<<5&4294967295|R>>>27),R=B+(w^V&(I^w))+C[2]+4243563512&4294967295,B=I+(R<<9&4294967295|R>>>23),R=V+(I^w&(B^I))+C[7]+1735328473&4294967295,V=B+(R<<14&4294967295|R>>>18),R=w+(B^I&(V^B))+C[12]+2368359562&4294967295,w=V+(R<<20&4294967295|R>>>12),R=I+(w^V^B)+C[5]+4294588738&4294967295,I=w+(R<<4&4294967295|R>>>28),R=B+(I^w^V)+C[8]+2272392833&4294967295,B=I+(R<<11&4294967295|R>>>21),R=V+(B^I^w)+C[11]+1839030562&4294967295,V=B+(R<<16&4294967295|R>>>16),R=w+(V^B^I)+C[14]+4259657740&4294967295,w=V+(R<<23&4294967295|R>>>9),R=I+(w^V^B)+C[1]+2763975236&4294967295,I=w+(R<<4&4294967295|R>>>28),R=B+(I^w^V)+C[4]+1272893353&4294967295,B=I+(R<<11&4294967295|R>>>21),R=V+(B^I^w)+C[7]+4139469664&4294967295,V=B+(R<<16&4294967295|R>>>16),R=w+(V^B^I)+C[10]+3200236656&4294967295,w=V+(R<<23&4294967295|R>>>9),R=I+(w^V^B)+C[13]+681279174&4294967295,I=w+(R<<4&4294967295|R>>>28),R=B+(I^w^V)+C[0]+3936430074&4294967295,B=I+(R<<11&4294967295|R>>>21),R=V+(B^I^w)+C[3]+3572445317&4294967295,V=B+(R<<16&4294967295|R>>>16),R=w+(V^B^I)+C[6]+76029189&4294967295,w=V+(R<<23&4294967295|R>>>9),R=I+(w^V^B)+C[9]+3654602809&4294967295,I=w+(R<<4&4294967295|R>>>28),R=B+(I^w^V)+C[12]+3873151461&4294967295,B=I+(R<<11&4294967295|R>>>21),R=V+(B^I^w)+C[15]+530742520&4294967295,V=B+(R<<16&4294967295|R>>>16),R=w+(V^B^I)+C[2]+3299628645&4294967295,w=V+(R<<23&4294967295|R>>>9),R=I+(V^(w|~B))+C[0]+4096336452&4294967295,I=w+(R<<6&4294967295|R>>>26),R=B+(w^(I|~V))+C[7]+1126891415&4294967295,B=I+(R<<10&4294967295|R>>>22),R=V+(I^(B|~w))+C[14]+2878612391&4294967295,V=B+(R<<15&4294967295|R>>>17),R=w+(B^(V|~I))+C[5]+4237533241&4294967295,w=V+(R<<21&4294967295|R>>>11),R=I+(V^(w|~B))+C[12]+1700485571&4294967295,I=w+(R<<6&4294967295|R>>>26),R=B+(w^(I|~V))+C[3]+2399980690&4294967295,B=I+(R<<10&4294967295|R>>>22),R=V+(I^(B|~w))+C[10]+4293915773&4294967295,V=B+(R<<15&4294967295|R>>>17),R=w+(B^(V|~I))+C[1]+2240044497&4294967295,w=V+(R<<21&4294967295|R>>>11),R=I+(V^(w|~B))+C[8]+1873313359&4294967295,I=w+(R<<6&4294967295|R>>>26),R=B+(w^(I|~V))+C[15]+4264355552&4294967295,B=I+(R<<10&4294967295|R>>>22),R=V+(I^(B|~w))+C[6]+2734768916&4294967295,V=B+(R<<15&4294967295|R>>>17),R=w+(B^(V|~I))+C[13]+1309151649&4294967295,w=V+(R<<21&4294967295|R>>>11),R=I+(V^(w|~B))+C[4]+4149444226&4294967295,I=w+(R<<6&4294967295|R>>>26),R=B+(w^(I|~V))+C[11]+3174756917&4294967295,B=I+(R<<10&4294967295|R>>>22),R=V+(I^(B|~w))+C[2]+718787259&4294967295,V=B+(R<<15&4294967295|R>>>17),R=w+(B^(V|~I))+C[9]+3951481745&4294967295,x.g[0]=x.g[0]+I&4294967295,x.g[1]=x.g[1]+(V+(R<<21&4294967295|R>>>11))&4294967295,x.g[2]=x.g[2]+V&4294967295,x.g[3]=x.g[3]+B&4294967295}r.prototype.u=function(x,I){I===void 0&&(I=x.length);for(var w=I-this.blockSize,C=this.B,V=this.h,B=0;B<I;){if(V==0)for(;B<=w;)s(this,x,B),B+=this.blockSize;if(typeof x=="string"){for(;B<I;)if(C[V++]=x.charCodeAt(B++),V==this.blockSize){s(this,C),V=0;break}}else for(;B<I;)if(C[V++]=x[B++],V==this.blockSize){s(this,C),V=0;break}}this.h=V,this.o+=I},r.prototype.v=function(){var x=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);x[0]=128;for(var I=1;I<x.length-8;++I)x[I]=0;var w=8*this.o;for(I=x.length-8;I<x.length;++I)x[I]=w&255,w/=256;for(this.u(x),x=Array(16),I=w=0;4>I;++I)for(var C=0;32>C;C+=8)x[w++]=this.g[I]>>>C&255;return x};function i(x,I){var w=a;return Object.prototype.hasOwnProperty.call(w,x)?w[x]:w[x]=I(x)}function o(x,I){this.h=I;for(var w=[],C=!0,V=x.length-1;0<=V;V--){var B=x[V]|0;C&&B==I||(w[V]=B,C=!1)}this.g=w}var a={};function l(x){return-128<=x&&128>x?i(x,function(I){return new o([I|0],0>I?-1:0)}):new o([x|0],0>x?-1:0)}function c(x){if(isNaN(x)||!isFinite(x))return f;if(0>x)return P(c(-x));for(var I=[],w=1,C=0;x>=w;C++)I[C]=x/w|0,w*=4294967296;return new o(I,0)}function d(x,I){if(x.length==0)throw Error("number format error: empty string");if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(x.charAt(0)=="-")return P(d(x.substring(1),I));if(0<=x.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=c(Math.pow(I,8)),C=f,V=0;V<x.length;V+=8){var B=Math.min(8,x.length-V),R=parseInt(x.substring(V,V+B),I);8>B?(B=c(Math.pow(I,B)),C=C.j(B).add(c(R))):(C=C.j(w),C=C.add(c(R)))}return C}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-P(this).m();for(var x=0,I=1,w=0;w<this.g.length;w++){var C=this.i(w);x+=(0<=C?C:4294967296+C)*I,I*=4294967296}return x},n.toString=function(x){if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(T(this))return"0";if(A(this))return"-"+P(this).toString(x);for(var I=c(Math.pow(x,6)),w=this,C="";;){var V=z(w,I).g;w=U(w,V.j(I));var B=((0<w.g.length?w.g[0]:w.h)>>>0).toString(x);if(w=V,T(w))return B+C;for(;6>B.length;)B="0"+B;C=B+C}},n.i=function(x){return 0>x?0:x<this.g.length?this.g[x]:this.h};function T(x){if(x.h!=0)return!1;for(var I=0;I<x.g.length;I++)if(x.g[I]!=0)return!1;return!0}function A(x){return x.h==-1}n.l=function(x){return x=U(this,x),A(x)?-1:T(x)?0:1};function P(x){for(var I=x.g.length,w=[],C=0;C<I;C++)w[C]=~x.g[C];return new o(w,~x.h).add(g)}n.abs=function(){return A(this)?P(this):this},n.add=function(x){for(var I=Math.max(this.g.length,x.g.length),w=[],C=0,V=0;V<=I;V++){var B=C+(this.i(V)&65535)+(x.i(V)&65535),R=(B>>>16)+(this.i(V)>>>16)+(x.i(V)>>>16);C=R>>>16,B&=65535,R&=65535,w[V]=R<<16|B}return new o(w,w[w.length-1]&-2147483648?-1:0)};function U(x,I){return x.add(P(I))}n.j=function(x){if(T(this)||T(x))return f;if(A(this))return A(x)?P(this).j(P(x)):P(P(this).j(x));if(A(x))return P(this.j(P(x)));if(0>this.l(y)&&0>x.l(y))return c(this.m()*x.m());for(var I=this.g.length+x.g.length,w=[],C=0;C<2*I;C++)w[C]=0;for(C=0;C<this.g.length;C++)for(var V=0;V<x.g.length;V++){var B=this.i(C)>>>16,R=this.i(C)&65535,It=x.i(V)>>>16,vt=x.i(V)&65535;w[2*C+2*V]+=R*vt,q(w,2*C+2*V),w[2*C+2*V+1]+=B*vt,q(w,2*C+2*V+1),w[2*C+2*V+1]+=R*It,q(w,2*C+2*V+1),w[2*C+2*V+2]+=B*It,q(w,2*C+2*V+2)}for(C=0;C<I;C++)w[C]=w[2*C+1]<<16|w[2*C];for(C=I;C<2*I;C++)w[C]=0;return new o(w,0)};function q(x,I){for(;(x[I]&65535)!=x[I];)x[I+1]+=x[I]>>>16,x[I]&=65535,I++}function L(x,I){this.g=x,this.h=I}function z(x,I){if(T(I))throw Error("division by zero");if(T(x))return new L(f,f);if(A(x))return I=z(P(x),I),new L(P(I.g),P(I.h));if(A(I))return I=z(x,P(I)),new L(P(I.g),I.h);if(30<x.g.length){if(A(x)||A(I))throw Error("slowDivide_ only works with positive integers.");for(var w=g,C=I;0>=C.l(x);)w=fe(w),C=fe(C);var V=me(w,1),B=me(C,1);for(C=me(C,2),w=me(w,2);!T(C);){var R=B.add(C);0>=R.l(x)&&(V=V.add(w),B=R),C=me(C,1),w=me(w,1)}return I=U(x,V.j(I)),new L(V,I)}for(V=f;0<=x.l(I);){for(w=Math.max(1,Math.floor(x.m()/I.m())),C=Math.ceil(Math.log(w)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),B=c(w),R=B.j(I);A(R)||0<R.l(x);)w-=C,B=c(w),R=B.j(I);T(B)&&(B=g),V=V.add(B),x=U(x,R)}return new L(V,x)}n.A=function(x){return z(this,x).h},n.and=function(x){for(var I=Math.max(this.g.length,x.g.length),w=[],C=0;C<I;C++)w[C]=this.i(C)&x.i(C);return new o(w,this.h&x.h)},n.or=function(x){for(var I=Math.max(this.g.length,x.g.length),w=[],C=0;C<I;C++)w[C]=this.i(C)|x.i(C);return new o(w,this.h|x.h)},n.xor=function(x){for(var I=Math.max(this.g.length,x.g.length),w=[],C=0;C<I;C++)w[C]=this.i(C)^x.i(C);return new o(w,this.h^x.h)};function fe(x){for(var I=x.g.length+1,w=[],C=0;C<I;C++)w[C]=x.i(C)<<1|x.i(C-1)>>>31;return new o(w,x.h)}function me(x,I){var w=I>>5;I%=32;for(var C=x.g.length-w,V=[],B=0;B<C;B++)V[B]=0<I?x.i(B+w)>>>I|x.i(B+w+1)<<32-I:x.i(B+w);return new o(V,x.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,qb=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,Eo=o}).apply(typeof py<"u"?py:typeof self<"u"?self:typeof window<"u"?window:{});var zc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var zb,Jl,Kb,od,dp,Gb,Hb,Wb;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof zc=="object"&&zc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var K=u[b];if(!(K in v))break e;v=v[K]}u=u[u.length-1],b=v[u],p=p(b),p!=b&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,b=!1,K={next:function(){if(!b&&v<u.length){var Q=v++;return{value:p(Q,u[Q]),done:!1}}return b=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function d(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var K=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(K,b),u.apply(p,K)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var b=v.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function T(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(b,K,Q){for(var Ie=Array(arguments.length-2),Et=2;Et<arguments.length;Et++)Ie[Et-2]=arguments[Et];return p.prototype[K].apply(b,Ie)}}function A(u){const p=u.length;if(0<p){const v=Array(p);for(let b=0;b<p;b++)v[b]=u[b];return v}return[]}function P(u,p){for(let v=1;v<arguments.length;v++){const b=arguments[v];if(l(b)){const K=u.length||0,Q=b.length||0;u.length=K+Q;for(let Ie=0;Ie<Q;Ie++)u[K+Ie]=b[Ie]}else u.push(b)}}class U{constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function q(u){return/^[\s\xa0]*$/.test(u)}function L(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function z(u){return z[" "](u),u}z[" "]=function(){};var fe=L().indexOf("Gecko")!=-1&&!(L().toLowerCase().indexOf("webkit")!=-1&&L().indexOf("Edge")==-1)&&!(L().indexOf("Trident")!=-1||L().indexOf("MSIE")!=-1)&&L().indexOf("Edge")==-1;function me(u,p,v){for(const b in u)p.call(v,u[b],b,u)}function x(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function I(u){const p={};for(const v in u)p[v]=u[v];return p}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,p){let v,b;for(let K=1;K<arguments.length;K++){b=arguments[K];for(v in b)u[v]=b[v];for(let Q=0;Q<w.length;Q++)v=w[Q],Object.prototype.hasOwnProperty.call(b,v)&&(u[v]=b[v])}}function V(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function B(u){a.setTimeout(()=>{throw u},0)}function R(){var u=Ke;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class It{constructor(){this.h=this.g=null}add(p,v){const b=vt.get();b.set(p,v),this.h?this.h.next=b:this.g=b,this.h=b}}var vt=new U(()=>new Y,u=>u.reset());class Y{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let j,ne=!1,Ke=new It,Be=()=>{const u=a.Promise.resolve(void 0);j=()=>{u.then(Ge)}};var Ge=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(v){B(v)}var p=vt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}ne=!1};function re(){this.s=this.s,this.C=this.C}re.prototype.s=!1,re.prototype.ma=function(){this.s||(this.s=!0,this.N())},re.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ee(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}ee.prototype.h=function(){this.defaultPrevented=!0};var je=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function Xe(u,p){if(ee.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(fe){e:{try{z(p.nodeName);var K=!0;break e}catch{}K=!1}K||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:ht[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Xe.aa.h.call(this)}}T(Xe,ee);var ht={2:"touch",3:"pen",4:"mouse"};Xe.prototype.h=function(){Xe.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var D="closure_listenable_"+(1e6*Math.random()|0),$=0;function X(u,p,v,b,K){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!b,this.ha=K,this.key=++$,this.da=this.fa=!1}function se(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function ke(u){this.src=u,this.g={},this.h=0}ke.prototype.add=function(u,p,v,b,K){var Q=u.toString();u=this.g[Q],u||(u=this.g[Q]=[],this.h++);var Ie=E(u,p,b,K);return-1<Ie?(p=u[Ie],v||(p.fa=!1)):(p=new X(p,this.src,Q,!!b,K),p.fa=v,u.push(p)),p};function $e(u,p){var v=p.type;if(v in u.g){var b=u.g[v],K=Array.prototype.indexOf.call(b,p,void 0),Q;(Q=0<=K)&&Array.prototype.splice.call(b,K,1),Q&&(se(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function E(u,p,v,b){for(var K=0;K<u.length;++K){var Q=u[K];if(!Q.da&&Q.listener==p&&Q.capture==!!v&&Q.ha==b)return K}return-1}var S="closure_lm_"+(1e6*Math.random()|0),M={};function oe(u,p,v,b,K){if(b&&b.once)return be(u,p,v,b,K);if(Array.isArray(p)){for(var Q=0;Q<p.length;Q++)oe(u,p[Q],v,b,K);return null}return v=De(v),u&&u[D]?u.K(p,v,c(b)?!!b.capture:!!b,K):Z(u,p,v,!1,b,K)}function Z(u,p,v,b,K,Q){if(!p)throw Error("Invalid event type");var Ie=c(K)?!!K.capture:!!K,Et=Te(u);if(Et||(u[S]=Et=new ke(u)),v=Et.add(p,v,b,Ie,Q),v.proxy)return v;if(b=ue(),v.proxy=b,b.src=u,b.listener=v,u.addEventListener)je||(K=Ie),K===void 0&&(K=!1),u.addEventListener(p.toString(),b,K);else if(u.attachEvent)u.attachEvent(pe(p.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return v}function ue(){function u(v){return p.call(u.src,u.listener,v)}const p=Se;return u}function be(u,p,v,b,K){if(Array.isArray(p)){for(var Q=0;Q<p.length;Q++)be(u,p[Q],v,b,K);return null}return v=De(v),u&&u[D]?u.L(p,v,c(b)?!!b.capture:!!b,K):Z(u,p,v,!0,b,K)}function ye(u,p,v,b,K){if(Array.isArray(p))for(var Q=0;Q<p.length;Q++)ye(u,p[Q],v,b,K);else b=c(b)?!!b.capture:!!b,v=De(v),u&&u[D]?(u=u.i,p=String(p).toString(),p in u.g&&(Q=u.g[p],v=E(Q,v,b,K),-1<v&&(se(Q[v]),Array.prototype.splice.call(Q,v,1),Q.length==0&&(delete u.g[p],u.h--)))):u&&(u=Te(u))&&(p=u.g[p.toString()],u=-1,p&&(u=E(p,v,b,K)),(v=-1<u?p[u]:null)&&_e(v))}function _e(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[D])$e(p.i,u);else{var v=u.type,b=u.proxy;p.removeEventListener?p.removeEventListener(v,b,u.capture):p.detachEvent?p.detachEvent(pe(v),b):p.addListener&&p.removeListener&&p.removeListener(b),(v=Te(p))?($e(v,u),v.h==0&&(v.src=null,p[S]=null)):se(u)}}}function pe(u){return u in M?M[u]:M[u]="on"+u}function Se(u,p){if(u.da)u=!0;else{p=new Xe(p,this);var v=u.listener,b=u.ha||u.src;u.fa&&_e(u),u=v.call(b,p)}return u}function Te(u){return u=u[S],u instanceof ke?u:null}var Pe="__closure_events_fn_"+(1e9*Math.random()>>>0);function De(u){return typeof u=="function"?u:(u[Pe]||(u[Pe]=function(p){return u.handleEvent(p)}),u[Pe])}function Le(){re.call(this),this.i=new ke(this),this.M=this,this.F=null}T(Le,re),Le.prototype[D]=!0,Le.prototype.removeEventListener=function(u,p,v,b){ye(this,u,p,v,b)};function He(u,p){var v,b=u.F;if(b)for(v=[];b;b=b.F)v.push(b);if(u=u.M,b=p.type||p,typeof p=="string")p=new ee(p,u);else if(p instanceof ee)p.target=p.target||u;else{var K=p;p=new ee(b,u),C(p,K)}if(K=!0,v)for(var Q=v.length-1;0<=Q;Q--){var Ie=p.g=v[Q];K=Ze(Ie,b,!0,p)&&K}if(Ie=p.g=u,K=Ze(Ie,b,!0,p)&&K,K=Ze(Ie,b,!1,p)&&K,v)for(Q=0;Q<v.length;Q++)Ie=p.g=v[Q],K=Ze(Ie,b,!1,p)&&K}Le.prototype.N=function(){if(Le.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],b=0;b<v.length;b++)se(v[b]);delete u.g[p],u.h--}}this.F=null},Le.prototype.K=function(u,p,v,b){return this.i.add(String(u),p,!1,v,b)},Le.prototype.L=function(u,p,v,b){return this.i.add(String(u),p,!0,v,b)};function Ze(u,p,v,b){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var K=!0,Q=0;Q<p.length;++Q){var Ie=p[Q];if(Ie&&!Ie.da&&Ie.capture==v){var Et=Ie.listener,dn=Ie.ha||Ie.src;Ie.fa&&$e(u.i,Ie),K=Et.call(dn,b)!==!1&&K}}return K&&!b.defaultPrevented}function Yt(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Bt(u){u.g=Yt(()=>{u.g=null,u.i&&(u.i=!1,Bt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class _n extends re{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Bt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lt(u){re.call(this),this.h=u,this.g={}}T(Lt,re);var mr=[];function jr(u){me(u.g,function(p,v){this.g.hasOwnProperty(v)&&_e(p)},u),u.g={}}Lt.prototype.N=function(){Lt.aa.N.call(this),jr(this)},Lt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cn=a.JSON.stringify,kn=a.JSON.parse,zi=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function bl(){}bl.prototype.h=null;function yc(u){return u.h||(u.h=u.i())}function _c(){}var Ki={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function wl(){ee.call(this,"d")}T(wl,ee);function Sr(){ee.call(this,"c")}T(Sr,ee);var tr={},Pr=null;function Rr(){return Pr=Pr||new Le}tr.La="serverreachability";function Cr(u){ee.call(this,tr.La,u)}T(Cr,ee);function qs(u){const p=Rr();He(p,new Cr(p))}tr.STAT_EVENT="statevent";function Gi(u,p){ee.call(this,tr.STAT_EVENT,u),this.stat=p}T(Gi,ee);function nn(u){const p=Rr();He(p,new Gi(p,u))}tr.Ma="timingevent";function bc(u,p){ee.call(this,tr.Ma,u),this.size=p}T(bc,ee);function Dn(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function zs(){this.g=!0}zs.prototype.xa=function(){this.g=!1};function wc(u,p,v,b,K,Q){u.info(function(){if(u.g)if(Q)for(var Ie="",Et=Q.split("&"),dn=0;dn<Et.length;dn++){var lt=Et[dn].split("=");if(1<lt.length){var hn=lt[0];lt=lt[1];var gn=hn.split("_");Ie=2<=gn.length&&gn[1]=="type"?Ie+(hn+"="+lt+"&"):Ie+(hn+"=redacted&")}}else Ie=null;else Ie=Q;return"XMLHTTP REQ ("+b+") [attempt "+K+"]: "+p+`
`+v+`
`+Ie})}function Il(u,p,v,b,K,Q,Ie){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+K+"]: "+p+`
`+v+`
`+Q+" "+Ie})}function Ks(u,p,v,b){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+Go(u,v)+(b?" "+b:"")})}function zn(u,p){u.info(function(){return"TIMEOUT: "+p})}zs.prototype.info=function(){};function Go(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var b=v[u];if(!(2>b.length)){var K=b[1];if(Array.isArray(K)&&!(1>K.length)){var Q=K[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(var Ie=1;Ie<K.length;Ie++)K[Ie]=""}}}}return cn(v)}catch{return p}}var Kn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},El={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ho;function Br(){}T(Br,bl),Br.prototype.g=function(){return new XMLHttpRequest},Br.prototype.i=function(){return{}},Ho=new Br;function nr(u,p,v,b){this.j=u,this.i=p,this.l=v,this.R=b||1,this.U=new Lt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Hi}function Hi(){this.i=null,this.g="",this.h=!1}var ls={},Wo={};function Gs(u,p,v){u.L=1,u.v=zr(_r(p)),u.m=v,u.P=!0,gr(u,null)}function gr(u,p){u.F=Date.now(),Qo(u),u.A=_r(u.v);var v=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),Ht(v.i,"t",b),u.C=0,v=u.j.J,u.h=new Hi,u.g=Vl(u.j,v?p:null,!u.m),0<u.O&&(u.M=new _n(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,b=u.ca;var K="readystatechange";Array.isArray(K)||(K&&(mr[0]=K.toString()),K=mr);for(var Q=0;Q<K.length;Q++){var Ie=oe(v,K[Q],b||p.handleEvent,!1,p.h||p);if(!Ie)break;p.g[Ie.key]=Ie}p=u.H?I(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),qs(),wc(u.i,u.u,u.A,u.l,u.R,u.m)}nr.prototype.ca=function(u){u=u.target;const p=this.M;p&&Nr(u)==3?p.j():this.Y(u)},nr.prototype.Y=function(u){try{if(u==this.g)e:{const gn=Nr(this.g);var p=this.g.Ba();const ti=this.g.Z();if(!(3>gn)&&(gn!=3||this.g&&(this.h.h||this.g.oa()||kl(this.g)))){this.J||gn!=4||p==7||(p==8||0>=ti?qs(3):qs(2)),vr(this);var v=this.g.Z();this.X=v;t:if(Ic(this)){var b=kl(this.g);u="";var K=b.length,Q=Nr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){qr(this),us(this);var Ie="";break t}this.h.i=new a.TextDecoder}for(p=0;p<K;p++)this.h.h=!0,u+=this.h.i.decode(b[p],{stream:!(Q&&p==K-1)});b.length=0,this.h.g+=u,this.C=0,Ie=this.h.g}else Ie=this.g.oa();if(this.o=v==200,Il(this.i,this.u,this.A,this.l,this.R,gn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var Et,dn=this.g;if((Et=dn.g?dn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(Et)){var lt=Et;break t}}lt=null}if(v=lt)Ks(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Jo(this,v);else{this.o=!1,this.s=3,nn(12),qr(this),us(this);break e}}if(this.P){v=!0;let cr;for(;!this.J&&this.C<Ie.length;)if(cr=tf(this,Ie),cr==Wo){gn==4&&(this.s=4,nn(14),v=!1),Ks(this.i,this.l,null,"[Incomplete Response]");break}else if(cr==ls){this.s=4,nn(15),Ks(this.i,this.l,Ie,"[Invalid Chunk]"),v=!1;break}else Ks(this.i,this.l,cr,null),Jo(this,cr);if(Ic(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),gn!=4||Ie.length!=0||this.h.h||(this.s=1,nn(16),v=!1),this.o=this.o&&v,!v)Ks(this.i,this.l,Ie,"[Invalid Chunked Response]"),qr(this),us(this);else if(0<Ie.length&&!this.W){this.W=!0;var hn=this.j;hn.g==this&&hn.ba&&!hn.M&&(hn.j.info("Great, no buffering proxy detected. Bytes received: "+Ie.length),Nl(hn),hn.M=!0,nn(11))}}else Ks(this.i,this.l,Ie,null),Jo(this,Ie);gn==4&&qr(this),this.o&&!this.J&&(gn==4?Nc(this.j,this):(this.o=!1,Qo(this)))}else Ys(this.g),v==400&&0<Ie.indexOf("Unknown SID")?(this.s=3,nn(12)):(this.s=0,nn(13)),qr(this),us(this)}}}catch{}finally{}};function Ic(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function tf(u,p){var v=u.C,b=p.indexOf(`
`,v);return b==-1?Wo:(v=Number(p.substring(v,b)),isNaN(v)?ls:(b+=1,b+v>p.length?Wo:(p=p.slice(b,b+v),u.C=b+v,p)))}nr.prototype.cancel=function(){this.J=!0,qr(this)};function Qo(u){u.S=Date.now()+u.I,Tl(u,u.I)}function Tl(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Dn(g(u.ba,u),p)}function vr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}nr.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(zn(this.i,this.A),this.L!=2&&(qs(),nn(17)),qr(this),this.s=2,us(this)):Tl(this,this.S-u)};function us(u){u.j.G==0||u.J||Nc(u.j,u)}function qr(u){vr(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,jr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Jo(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Xo(v.h,u))){if(!u.K&&Xo(v.h,u)&&v.G==3){try{var b=v.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var K=b;if(K[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)aa(v),no(v);else break e;Dl(v),nn(18)}}else v.za=K[1],0<v.za-v.T&&37500>K[2]&&v.F&&v.v==0&&!v.C&&(v.C=Dn(g(v.Za,v),6e3));if(1>=Al(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else fs(v,11)}else if((u.K||v.g==u)&&aa(v),!q(p))for(K=v.Da.g.parse(p),p=0;p<K.length;p++){let lt=K[p];if(v.T=lt[0],lt=lt[1],v.G==2)if(lt[0]=="c"){v.K=lt[1],v.ia=lt[2];const hn=lt[3];hn!=null&&(v.la=hn,v.j.info("VER="+v.la));const gn=lt[4];gn!=null&&(v.Aa=gn,v.j.info("SVER="+v.Aa));const ti=lt[5];ti!=null&&typeof ti=="number"&&0<ti&&(b=1.5*ti,v.L=b,v.j.info("backChannelRequestTimeoutMs_="+b)),b=v;const cr=u.g;if(cr){const la=cr.g?cr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(la){var Q=b.h;Q.g||la.indexOf("spdy")==-1&&la.indexOf("quic")==-1&&la.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(Hs(Q,Q.h),Q.h=null))}if(b.D){const Vr=cr.g?cr.g.getResponseHeader("X-HTTP-Session-Id"):null;Vr&&(b.ya=Vr,Rt(b.I,b.D,Vr))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),b=v;var Ie=u;if(b.qa=Oc(b,b.J?b.ia:null,b.W),Ie.K){Wi(b.h,Ie);var Et=Ie,dn=b.L;dn&&(Et.I=dn),Et.B&&(vr(Et),Qo(Et)),b.g=Ie}else kc(b);0<v.i.length&&ia(v)}else lt[0]!="stop"&&lt[0]!="close"||fs(v,7);else v.G==3&&(lt[0]=="stop"||lt[0]=="close"?lt[0]=="stop"?fs(v,7):Xs(v):lt[0]!="noop"&&v.l&&v.l.ta(lt),v.v=0)}}qs(4)}catch{}}var xl=class{constructor(u,p){this.g=u,this.map=p}};function Ec(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Yo(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Al(u){return u.h?1:u.g?u.g.size:0}function Xo(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Hs(u,p){u.g?u.g.add(p):u.h=p}function Wi(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Ec.prototype.cancel=function(){if(this.i=Qi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Qi(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return A(u.i)}function Sl(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,b=0;b<v;b++)p.push(u[b]);return p}p=[],v=0;for(b in u)p[v++]=u[b];return p}function Fe(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const b in u)p[v++]=b;return p}}}function pt(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=Fe(u),b=Sl(u),K=b.length,Q=0;Q<K;Q++)p.call(void 0,b[Q],v&&v[Q],u)}var yr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ji(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var b=u[v].indexOf("="),K=null;if(0<=b){var Q=u[v].substring(0,b);K=u[v].substring(b+1)}else Q=u[v];p(Q,K?decodeURIComponent(K.replace(/\+/g," ")):"")}}}function cs(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof cs){this.h=u.h,Zo(this,u.j),this.o=u.o,this.g=u.g,ea(this,u.s),this.l=u.l;var p=u.i,v=new Xi;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),ta(this,v),this.m=u.m}else u&&(p=String(u).match(yr))?(this.h=!1,Zo(this,p[1]||"",!0),this.o=Kr(p[2]||""),this.g=Kr(p[3]||"",!0),ea(this,p[4]),this.l=Kr(p[5]||"",!0),ta(this,p[6]||"",!0),this.m=Kr(p[7]||"")):(this.h=!1,this.i=new Xi(null,this.h))}cs.prototype.toString=function(){var u=[],p=this.j;p&&u.push(br(p,Qs,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(br(p,Qs,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(br(v,v.charAt(0)=="/"?na:Yi,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",br(v,rf)),u.join("")};function _r(u){return new cs(u)}function Zo(u,p,v){u.j=v?Kr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ea(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function ta(u,p,v){p instanceof Xi?(u.i=p,sf(u.i,u.h)):(v||(p=br(p,nf)),u.i=new Xi(p,u.h))}function Rt(u,p,v){u.i.set(p,v)}function zr(u){return Rt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Kr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function br(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,Ws),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Ws(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Qs=/[#\/\?@]/g,Yi=/[#\?:]/g,na=/[#\?]/g,nf=/[#\?@]/g,rf=/#/g;function Xi(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function kr(u){u.g||(u.g=new Map,u.h=0,u.i&&Ji(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=Xi.prototype,n.add=function(u,p){kr(this),this.i=null,u=at(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function qe(u,p){kr(u),p=at(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function et(u,p){return kr(u),p=at(u,p),u.g.has(p)}n.forEach=function(u,p){kr(this),this.g.forEach(function(v,b){v.forEach(function(K){u.call(p,K,b,this)},this)},this)},n.na=function(){kr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let b=0;b<p.length;b++){const K=u[b];for(let Q=0;Q<K.length;Q++)v.push(p[b])}return v},n.V=function(u){kr(this);let p=[];if(typeof u=="string")et(this,u)&&(p=p.concat(this.g.get(at(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return kr(this),this.i=null,u=at(this,u),et(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Ht(u,p,v){qe(u,p),0<v.length&&(u.i=null,u.g.set(at(u,p),A(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var b=p[v];const Q=encodeURIComponent(String(b)),Ie=this.V(b);for(b=0;b<Ie.length;b++){var K=Q;Ie[b]!==""&&(K+="="+encodeURIComponent(String(Ie[b]))),u.push(K)}}return this.i=u.join("&")};function at(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function sf(u,p){p&&!u.j&&(kr(u),u.i=null,u.g.forEach(function(v,b){var K=b.toLowerCase();b!=K&&(qe(this,b),Ht(this,K,v))},u)),u.j=p}function Pl(u,p){const v=new zs;if(a.Image){const b=new Image;b.onload=y(Gn,v,"TestLoadImage: loaded",!0,p,b),b.onerror=y(Gn,v,"TestLoadImage: error",!1,p,b),b.onabort=y(Gn,v,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(Gn,v,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else p(!1)}function Tc(u,p){const v=new zs,b=new AbortController,K=setTimeout(()=>{b.abort(),Gn(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:b.signal}).then(Q=>{clearTimeout(K),Q.ok?Gn(v,"TestPingServer: ok",!0,p):Gn(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(K),Gn(v,"TestPingServer: error",!1,p)})}function Gn(u,p,v,b,K){try{K&&(K.onload=null,K.onerror=null,K.onabort=null,K.ontimeout=null),b(v)}catch{}}function Js(){this.g=new zi}function of(u,p,v){const b=v||"";try{pt(u,function(K,Q){let Ie=K;c(K)&&(Ie=cn(K)),p.push(b+Q+"="+encodeURIComponent(Ie))})}catch(K){throw p.push(b+"type="+encodeURIComponent("_badmap")),K}}function Dr(u){this.l=u.Ub||null,this.j=u.eb||!1}T(Dr,bl),Dr.prototype.g=function(){return new Nn(this.l,this.j)},Dr.prototype.i=function(u){return function(){return u}}({});function Nn(u,p){Le.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}T(Nn,Le),n=Nn.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Zi(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ds(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Zi(this)),this.g&&(this.readyState=3,Zi(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;xc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function xc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?ds(this):Zi(this),this.readyState==3&&xc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,ds(this))},n.Qa=function(u){this.g&&(this.response=u,ds(this))},n.ga=function(){this.g&&ds(this)};function ds(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Zi(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function Zi(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Nn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Ac(u){let p="";return me(u,function(v,b){p+=b,p+=":",p+=v,p+=`\r
`}),p}function Rl(u,p,v){e:{for(b in v){var b=!1;break e}b=!0}b||(v=Ac(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):Rt(u,p,v))}function Ft(u){Le.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}T(Ft,Le);var ra=/^https?$/i,Cl=["POST","PUT"];n=Ft.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ho.g(),this.v=this.o?yc(this.o):yc(Ho),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(Q){rr(this,Q);return}if(u=v||"",v=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var K in b)v.set(K,b[K]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const Q of b.keys())v.set(Q,b.get(Q));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(v.keys()).find(Q=>Q.toLowerCase()=="content-type"),K=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Cl,p,void 0))||b||K||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,Ie]of v)this.g.setRequestHeader(Q,Ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{sa(this),this.u=!0,this.g.send(u),this.u=!1}catch(Q){rr(this,Q)}};function rr(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Sc(u),eo(u)}function Sc(u){u.A||(u.A=!0,He(u,"complete"),He(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,He(this,"complete"),He(this,"abort"),eo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),eo(this,!0)),Ft.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Pc(this):this.bb())},n.bb=function(){Pc(this)};function Pc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Nr(u)!=4||u.Z()!=2)){if(u.u&&Nr(u)==4)Yt(u.Ea,0,u);else if(He(u,"readystatechange"),Nr(u)==4){u.h=!1;try{const Ie=u.Z();e:switch(Ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var b;if(b=Ie===0){var K=String(u.D).match(yr)[1]||null;!K&&a.self&&a.self.location&&(K=a.self.location.protocol.slice(0,-1)),b=!ra.test(K?K.toLowerCase():"")}v=b}if(v)He(u,"complete"),He(u,"success");else{u.m=6;try{var Q=2<Nr(u)?u.g.statusText:""}catch{Q=""}u.l=Q+" ["+u.Z()+"]",Sc(u)}}finally{eo(u)}}}}function eo(u,p){if(u.g){sa(u);const v=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||He(u,"ready");try{v.onreadystatechange=b}catch{}}}function sa(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Nr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Nr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),kn(p)}};function kl(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Ys(u){const p={};u=(u.g&&2<=Nr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(q(u[b]))continue;var v=V(u[b]);const K=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const Q=p[K]||[];p[K]=Q,Q.push(v)}x(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function hs(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function to(u){this.Aa=0,this.i=[],this.j=new zs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=hs("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=hs("baseRetryDelayMs",5e3,u),this.cb=hs("retryDelaySeedMs",1e4,u),this.Wa=hs("forwardChannelMaxRetries",2,u),this.wa=hs("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Ec(u&&u.concurrentRequestLimit),this.Da=new Js,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=to.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,b){nn(0),this.W=u,this.H=p||{},v&&b!==void 0&&(this.H.OSID=v,this.H.OAID=b),this.F=this.X,this.I=Oc(this,null,this.W),ia(this)};function Xs(u){if(Rc(u),u.G==3){var p=u.U++,v=_r(u.I);if(Rt(v,"SID",u.K),Rt(v,"RID",p),Rt(v,"TYPE","terminate"),Gr(u,v),p=new nr(u,u.j,p),p.L=2,p.v=zr(_r(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=Vl(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Qo(p)}Vc(u)}function no(u){u.g&&(Nl(u),u.g.cancel(),u.g=null)}function Rc(u){no(u),u.u&&(a.clearTimeout(u.u),u.u=null),aa(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function ia(u){if(!Yo(u.h)&&!u.s){u.s=!0;var p=u.Ga;j||Be(),ne||(j(),ne=!0),Ke.add(p,u),u.B=0}}function Cc(u,p){return Al(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Dn(g(u.Ga,u,p),Zs(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const K=new nr(this,this.j,u);let Q=this.o;if(this.S&&(Q?(Q=I(Q),C(Q,this.S)):Q=this.S),this.m!==null||this.O||(K.H=Q,Q=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var b=this.i[v];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=ro(this,K,p),v=_r(this.I),Rt(v,"RID",u),Rt(v,"CVER",22),this.D&&Rt(v,"X-HTTP-Session-Id",this.D),Gr(this,v),Q&&(this.O?p="headers="+encodeURIComponent(String(Ac(Q)))+"&"+p:this.m&&Rl(v,this.m,Q)),Hs(this.h,K),this.Ua&&Rt(v,"TYPE","init"),this.P?(Rt(v,"$req",p),Rt(v,"SID","null"),K.T=!0,Gs(K,v,null)):Gs(K,v,p),this.G=2}}else this.G==3&&(u?oa(this,u):this.i.length==0||Yo(this.h)||oa(this))};function oa(u,p){var v;p?v=p.l:v=u.U++;const b=_r(u.I);Rt(b,"SID",u.K),Rt(b,"RID",v),Rt(b,"AID",u.T),Gr(u,b),u.m&&u.o&&Rl(b,u.m,u.o),v=new nr(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=ro(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Hs(u.h,v),Gs(v,b,p)}function Gr(u,p){u.H&&me(u.H,function(v,b){Rt(p,b,v)}),u.l&&pt({},function(v,b){Rt(p,b,v)})}function ro(u,p,v){v=Math.min(u.i.length,v);var b=u.l?g(u.l.Na,u.l,u):null;e:{var K=u.i;let Q=-1;for(;;){const Ie=["count="+v];Q==-1?0<v?(Q=K[0].g,Ie.push("ofs="+Q)):Q=0:Ie.push("ofs="+Q);let Et=!0;for(let dn=0;dn<v;dn++){let lt=K[dn].g;const hn=K[dn].map;if(lt-=Q,0>lt)Q=Math.max(0,K[dn].g-100),Et=!1;else try{of(hn,Ie,"req"+lt+"_")}catch{b&&b(hn)}}if(Et){b=Ie.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,b}function kc(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;j||Be(),ne||(j(),ne=!0),Ke.add(p,u),u.v=0}}function Dl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Dn(g(u.Fa,u),Zs(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Dc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Dn(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,nn(10),no(this),Dc(this))};function Nl(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Dc(u){u.g=new nr(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=_r(u.qa);Rt(p,"RID","rpc"),Rt(p,"SID",u.K),Rt(p,"AID",u.T),Rt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Rt(p,"TO",u.ja),Rt(p,"TYPE","xmlhttp"),Gr(u,p),u.m&&u.o&&Rl(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=zr(_r(p)),v.m=null,v.P=!0,gr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,no(this),Dl(this),nn(19))};function aa(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function Nc(u,p){var v=null;if(u.g==p){aa(u),Nl(u),u.g=null;var b=2}else if(Xo(u.h,p))v=p.D,Wi(u.h,p),b=1;else return;if(u.G!=0){if(p.o)if(b==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var K=u.B;b=Rr(),He(b,new bc(b,v)),ia(u)}else kc(u);else if(K=p.s,K==3||K==0&&0<p.X||!(b==1&&Cc(u,p)||b==2&&Dl(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),K){case 1:fs(u,5);break;case 4:fs(u,10);break;case 3:fs(u,6);break;default:fs(u,2)}}}function Zs(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function fs(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),b=u.Xa;const K=!b;b=new cs(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Zo(b,"https"),zr(b),K?Pl(b.toString(),v):Tc(b.toString(),v)}else nn(2);u.G=0,u.l&&u.l.sa(p),Vc(u),Rc(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),nn(2)):(this.j.info("Failed to ping google.com"),nn(1))};function Vc(u){if(u.G=0,u.ka=[],u.l){const p=Qi(u.h);(p.length!=0||u.i.length!=0)&&(P(u.ka,p),P(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function Oc(u,p,v){var b=v instanceof cs?_r(v):new cs(v);if(b.g!="")p&&(b.g=p+"."+b.g),ea(b,b.s);else{var K=a.location;b=K.protocol,p=p?p+"."+K.hostname:K.hostname,K=+K.port;var Q=new cs(null);b&&Zo(Q,b),p&&(Q.g=p),K&&ea(Q,K),v&&(Q.l=v),b=Q}return v=u.D,p=u.ya,v&&p&&Rt(b,v,p),Rt(b,"VER",u.la),Gr(u,b),b}function Vl(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Ft(new Dr({eb:v})):new Ft(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mc(){}n=Mc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function so(){}so.prototype.g=function(u,p){return new Hn(u,p)};function Hn(u,p){Le.call(this),this.g=new to(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!q(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!q(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new ei(this)}T(Hn,Le),Hn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Hn.prototype.close=function(){Xs(this.g)},Hn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=cn(u),u=v);p.i.push(new xl(p.Ya++,u)),p.G==3&&ia(p)},Hn.prototype.N=function(){this.g.l=null,delete this.j,Xs(this.g),delete this.g,Hn.aa.N.call(this)};function Lc(u){wl.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}T(Lc,wl);function Fc(){Sr.call(this),this.status=1}T(Fc,Sr);function ei(u){this.g=u}T(ei,Mc),ei.prototype.ua=function(){He(this.g,"a")},ei.prototype.ta=function(u){He(this.g,new Lc(u))},ei.prototype.sa=function(u){He(this.g,new Fc)},ei.prototype.ra=function(){He(this.g,"b")},so.prototype.createWebChannel=so.prototype.g,Hn.prototype.send=Hn.prototype.o,Hn.prototype.open=Hn.prototype.m,Hn.prototype.close=Hn.prototype.close,Wb=function(){return new so},Hb=function(){return Rr()},Gb=tr,dp={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Kn.NO_ERROR=0,Kn.TIMEOUT=8,Kn.HTTP_ERROR=6,od=Kn,El.COMPLETE="complete",Kb=El,_c.EventType=Ki,Ki.OPEN="a",Ki.CLOSE="b",Ki.ERROR="c",Ki.MESSAGE="d",Le.prototype.listen=Le.prototype.K,Jl=_c,Ft.prototype.listenOnce=Ft.prototype.L,Ft.prototype.getLastError=Ft.prototype.Ka,Ft.prototype.getLastErrorCode=Ft.prototype.Ba,Ft.prototype.getStatus=Ft.prototype.Z,Ft.prototype.getResponseJson=Ft.prototype.Oa,Ft.prototype.getResponseText=Ft.prototype.oa,Ft.prototype.send=Ft.prototype.ea,Ft.prototype.setWithCredentials=Ft.prototype.Ha,zb=Ft}).apply(typeof zc<"u"?zc:typeof self<"u"?self:typeof window<"u"?window:{});const my="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}In.UNAUTHENTICATED=new In(null),In.GOOGLE_CREDENTIALS=new In("google-credentials-uid"),In.FIRST_PARTY=new In("first-party-uid"),In.MOCK_USER=new In("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pi=new dm("@firebase/firestore");function ga(){return Pi.logLevel}function yj(n){Pi.setLogLevel(n)}function de(n,...e){if(Pi.logLevel<=st.DEBUG){const t=e.map(pm);Pi.debug(`Firestore (${sl}): ${n}`,...t)}}function sn(n,...e){if(Pi.logLevel<=st.ERROR){const t=e.map(pm);Pi.error(`Firestore (${sl}): ${n}`,...t)}}function xr(n,...e){if(Pi.logLevel<=st.WARN){const t=e.map(pm);Pi.warn(`Firestore (${sl}): ${n}`,...t)}}function pm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Re(n="Unexpected state"){const e=`FIRESTORE (${sl}) INTERNAL ASSERTION FAILED: `+n;throw sn(e),new Error(e)}function Ce(n,e){n||Re()}function _j(n,e){n||Re()}function Ee(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends as{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qb{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class gR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(In.UNAUTHENTICATED))}shutdown(){}}class vR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class yR{constructor(e){this.t=e,this.currentUser=In.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ce(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new En;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new En,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{de("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(de("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new En)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(de("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ce(typeof r.accessToken=="string"),new Qb(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ce(e===null||typeof e=="string"),new In(e)}}class _R{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=In.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class bR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new _R(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(In.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Jb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class wR{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Ce(this.o===void 0);const r=i=>{i.error!=null&&de("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,de("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{de("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):de("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ce(typeof t.token=="string"),this.R=t.token,new Jb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class bj{getToken(){return Promise.resolve(new Jb(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IR(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=IR(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function ze(n,e){return n<e?-1:n>e?1:0}function Ma(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function Xb(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new he(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new he(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new he(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new he(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Qt.fromMillis(Date.now())}static fromDate(e){return Qt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Qt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ze(this.nanoseconds,e.nanoseconds):ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Me{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Me(e)}static min(){return new Me(new Qt(0,0))}static max(){return new Me(new Qt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,t,r){t===void 0?t=0:t>e.length&&Re(),r===void 0?r=e.length-t:r>e.length-t&&Re(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Au.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Au?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class it extends Au{construct(e,t,r){return new it(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new he(H.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new it(t)}static emptyPath(){return new it([])}}const ER=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zt extends Au{construct(e,t,r){return new zt(e,t,r)}static isValidIdentifier(e){return ER.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new zt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new he(H.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new he(H.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new he(H.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new he(H.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new zt(t)}static emptyPath(){return new zt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{constructor(e){this.path=e}static fromPath(e){return new Ae(it.fromString(e))}static fromName(e){return new Ae(it.fromString(e).popFirst(5))}static empty(){return new Ae(it.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&it.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return it.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ae(new it(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function hp(n){return n.fields.find(e=>e.kind===2)}function ho(n){return n.fields.filter(e=>e.kind!==2)}function TR(n,e){let t=ze(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=xR(n.fields[r],e.fields[r]),t!==0)return t;return ze(n.fields.length,e.fields.length)}La.UNKNOWN_ID=-1;class To{constructor(e,t){this.fieldPath=e,this.kind=t}}function xR(n,e){const t=zt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:ze(n.kind,e.kind)}class Fa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Fa(0,pr.min())}}function Zb(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Me.fromTimestamp(r===1e9?new Qt(t+1,0):new Qt(t,r));return new pr(s,Ae.empty(),e)}function ew(n){return new pr(n.readTime,n.key,-1)}class pr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new pr(Me.min(),Ae.empty(),-1)}static max(){return new pr(Me.max(),Ae.empty(),-1)}}function mm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ae.comparator(n.documentKey,e.documentKey),t!==0?t:ze(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nw{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fi(n){if(n.code!==H.FAILED_PRECONDITION||n.message!==tw)throw n;de("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Re(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new G((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof G?t:G.resolve(t)}catch(t){return G.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):G.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):G.reject(t)}static resolve(e){return new G((t,r)=>{t(e)})}static reject(e){return new G((t,r)=>{r(e)})}static waitFor(e){return new G((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=G.resolve(!1);for(const r of e)t=t.next(s=>s?G.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new G((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new G((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new En,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new du(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=gm(r.target.error);this.V.reject(new du(e,s))}}static open(e,t,r,s){try{return new vh(t,e.transaction(s,r))}catch(i){throw new du(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(de("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new SR(t)}}class es{constructor(e,t,r){this.name=e,this.version=t,this.p=r,es.S(vn())===12.2&&sn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return de("SimpleDb","Removing database:",e),mo(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!cm())return!1;if(es.v())return!0;const e=vn(),t=es.S(e),r=0<t&&t<10,s=rw(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(de("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new du(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new he(H.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new he(H.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new du(e,o))},s.onupgradeneeded=i=>{de("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{de("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=vh.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),G.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(de("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function rw(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class AR{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return mo(this.B.delete())}}class du extends he{constructor(e,t){super(H.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function $i(n){return n.name==="IndexedDbTransactionError"}class SR{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(de("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(de("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),mo(r)}add(e){return de("SimpleDb","ADD",this.store.name,e,e),mo(this.store.add(e))}get(e){return mo(this.store.get(e)).next(t=>(t===void 0&&(t=null),de("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return de("SimpleDb","DELETE",this.store.name,e),mo(this.store.delete(e))}count(){return de("SimpleDb","COUNT",this.store.name),mo(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new G((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new G((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){de("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new G((r,s)=>{t.onerror=i=>{const o=gm(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new G((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new AR(a),c=t(a.primaryKey,a.value,l);if(c instanceof G){const d=c.catch(f=>(l.done(),G.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>G.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function mo(n){return new G((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=gm(r.target.error);t(s)}})}let gy=!1;function gm(n){const e=es.S(vn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new he("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return gy||(gy=!0,setTimeout(()=>{throw r},0)),r}}return n}class PR{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){de("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{de("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){$i(t)?de("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Fi(t)}await this.X(6e4)})}}class RR{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return G.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return de("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(de("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=ew(i);mm(o,r)>0&&(r=o)}),new pr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}or.oe=-1;function Ju(n){return n==null}function Su(n){return n===0&&1/n==-1/0}function sw(n){return typeof n=="number"&&Number.isInteger(n)&&!Su(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=vy(e)),e=CR(n.get(t),e);return vy(e)}function CR(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function vy(n){return n+""}function Jr(n){const e=n.length;if(Ce(e>=2),e===2)return Ce(n.charAt(0)===""&&n.charAt(1)===""),it.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Re(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Re()}i=o+2}return new it(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ad(n,e){return[n,jn(e)]}function iw(n,e,t){return[n,jn(e),t]}const kR={},DR=["prefixPath","collectionGroup","readTime","documentId"],NR=["prefixPath","collectionGroup","documentId"],VR=["collectionGroup","readTime","prefixPath","documentId"],OR=["canonicalId","targetId"],MR=["targetId","path"],LR=["path","targetId"],FR=["collectionId","parent"],$R=["indexId","uid"],UR=["uid","sequenceNumber"],jR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],BR=["indexId","uid","orderedDocumentKey"],qR=["userId","collectionPath","documentId"],zR=["userId","collectionPath","largestBatchId"],KR=["userId","collectionGroup","largestBatchId"],ow=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],GR=[...ow,"documentOverlays"],aw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],lw=aw,vm=[...lw,"indexConfiguration","indexState","indexEntries"],HR=vm,WR=[...vm,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp extends nw{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function yn(n,e){const t=Ee(n);return es.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ui(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function uw(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function cw(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,t){this.comparator=e,this.root=t||Sn.EMPTY}insert(e,t){return new Mt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Sn.BLACK,null,null))}remove(e){return new Mt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Sn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Kc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Kc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Kc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Kc(this.root,e,this.comparator,!0)}}class Kc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Sn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Sn.RED,this.left=s??Sn.EMPTY,this.right=i??Sn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Sn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Sn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Sn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Sn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Sn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Re();const e=this.left.check();if(e!==this.right.check())throw Re();return e+(this.isRed()?0:1)}}Sn.EMPTY=null,Sn.RED=!0,Sn.BLACK=!1;Sn.EMPTY=new class{constructor(){this.size=0}get key(){throw Re()}get value(){throw Re()}get color(){throw Re()}get left(){throw Re()}get right(){throw Re()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Sn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e){this.comparator=e,this.data=new Mt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new by(this.data.getIterator())}getIteratorFrom(e){return new by(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Pt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Pt(this.comparator);return t.data=e,t}}class by{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ca(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(e){this.fields=e,e.sort(zt.comparator)}static empty(){return new ar([])}unionWith(e){let t=new Pt(zt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ar(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ma(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ij(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new dw("Invalid base64 string: "+i):i}}(e);return new en(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new en(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}en.EMPTY_BYTE_STRING=new en("");const QR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ks(n){if(Ce(!!n),typeof n=="string"){let e=0;const t=QR.exec(n);if(Ce(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:qt(n.seconds),nanos:qt(n.nanos)}}function qt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ds(n){return typeof n=="string"?en.fromBase64String(n):en.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function _h(n){const e=n.mapValue.fields.__previous_value__;return yh(e)?_h(e):e}function Pu(n){const e=ks(n.mapValue.fields.__local_write_time__.timestampValue);return new Qt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JR{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class So{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new So("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof So&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ld={nullValue:"NULL_VALUE"};function Ri(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?yh(n)?4:hw(n)?9007199254740991:bh(n)?10:11:Re()}function os(n,e){if(n===e)return!0;const t=Ri(n);if(t!==Ri(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Pu(n).isEqual(Pu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ks(s.timestampValue),a=ks(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ds(s.bytesValue).isEqual(Ds(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return qt(s.geoPointValue.latitude)===qt(i.geoPointValue.latitude)&&qt(s.geoPointValue.longitude)===qt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return qt(s.integerValue)===qt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=qt(s.doubleValue),a=qt(i.doubleValue);return o===a?Su(o)===Su(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ma(n.arrayValue.values||[],e.arrayValue.values||[],os);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(_y(o)!==_y(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!os(o[l],a[l])))return!1;return!0}(n,e);default:return Re()}}function Ru(n,e){return(n.values||[]).find(t=>os(t,e))!==void 0}function Ci(n,e){if(n===e)return 0;const t=Ri(n),r=Ri(e);if(t!==r)return ze(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ze(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=qt(i.integerValue||i.doubleValue),l=qt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return wy(n.timestampValue,e.timestampValue);case 4:return wy(Pu(n),Pu(e));case 5:return ze(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ds(i),l=Ds(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=ze(a[c],l[c]);if(d!==0)return d}return ze(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=ze(qt(i.latitude),qt(o.latitude));return a!==0?a:ze(qt(i.longitude),qt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Iy(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,T=(l=g.value)===null||l===void 0?void 0:l.arrayValue,A=ze(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=T==null?void 0:T.values)===null||d===void 0?void 0:d.length)||0);return A!==0?A:Iy(y,T)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===_i.mapValue&&o===_i.mapValue)return 0;if(i===_i.mapValue)return 1;if(o===_i.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=ze(l[f],d[f]);if(g!==0)return g;const y=Ci(a[l[f]],c[d[f]]);if(y!==0)return y}return ze(l.length,d.length)}(n.mapValue,e.mapValue);default:throw Re()}}function wy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ze(n,e);const t=ks(n),r=ks(e),s=ze(t.seconds,r.seconds);return s!==0?s:ze(t.nanos,r.nanos)}function Iy(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ci(t[s],r[s]);if(i)return i}return ze(t.length,r.length)}function $a(n){return pp(n)}function pp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ks(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ds(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ae.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=pp(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${pp(t.fields[o])}`;return s+"}"}(n.mapValue):Re()}function ud(n){switch(Ri(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_h(n);return e?16+ud(e):16;case 5:return 2*n.stringValue.length;case 6:return Ds(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+ud(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Ui(r.fields,(i,o)=>{s+=i.length+ud(o)}),s}(n.mapValue);default:throw Re()}}function Po(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function mp(n){return!!n&&"integerValue"in n}function Cu(n){return!!n&&"arrayValue"in n}function Ey(n){return!!n&&"nullValue"in n}function Ty(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function cd(n){return!!n&&"mapValue"in n}function bh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function hu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ui(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=hu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=hu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function hw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const fw={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function YR(n){return"nullValue"in n?ld:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Po(So.empty(),Ae.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?bh(n)?fw:{mapValue:{}}:Re()}function XR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Po(So.empty(),Ae.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?fw:"mapValue"in n?bh(n)?{mapValue:{}}:_i:Re()}function xy(n,e){const t=Ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Ay(n,e){const t=Ci(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e){this.value=e}static empty(){return new Rn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!cd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hu(t)}setAll(e){let t=zt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=hu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());cd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return os(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];cd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Ui(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Rn(hu(this.value))}}function pw(n){const e=[];return Ui(n.fields,(t,r)=>{const s=new zt([t]);if(cd(r)){const i=pw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new ar(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new $t(e,0,Me.min(),Me.min(),Me.min(),Rn.empty(),0)}static newFoundDocument(e,t,r,s){return new $t(e,1,t,Me.min(),r,s,0)}static newNoDocument(e,t){return new $t(e,2,t,Me.min(),Me.min(),Rn.empty(),0)}static newUnknownDocument(e,t){return new $t(e,3,t,Me.min(),Me.min(),Rn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(e,t){this.position=e,this.inclusive=t}}function Sy(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ae.comparator(Ae.fromName(o.referenceValue),t.key):r=Ci(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Py(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!os(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(e,t="asc"){this.field=e,this.dir=t}}function ZR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mw{}class ot extends mw{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new eC(e,t,r):t==="array-contains"?new rC(e,r):t==="in"?new ww(e,r):t==="not-in"?new sC(e,r):t==="array-contains-any"?new iC(e,r):new ot(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new tC(e,r):new nC(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ci(t,this.value)):t!==null&&Ri(this.value)===Ri(t)&&this.matchesComparison(Ci(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Re()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Tt extends mw{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Tt(e,t)}matches(e){return Ua(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ua(n){return n.op==="and"}function gp(n){return n.op==="or"}function ym(n){return gw(n)&&Ua(n)}function gw(n){for(const e of n.filters)if(e instanceof Tt)return!1;return!0}function vp(n){if(n instanceof ot)return n.field.canonicalString()+n.op.toString()+$a(n.value);if(ym(n))return n.filters.map(e=>vp(e)).join(",");{const e=n.filters.map(t=>vp(t)).join(",");return`${n.op}(${e})`}}function vw(n,e){return n instanceof ot?function(r,s){return s instanceof ot&&r.op===s.op&&r.field.isEqual(s.field)&&os(r.value,s.value)}(n,e):n instanceof Tt?function(r,s){return s instanceof Tt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&vw(o,s.filters[a]),!0):!1}(n,e):void Re()}function yw(n,e){const t=n.filters.concat(e);return Tt.create(t,n.op)}function _w(n){return n instanceof ot?function(t){return`${t.field.canonicalString()} ${t.op} ${$a(t.value)}`}(n):n instanceof Tt?function(t){return t.op.toString()+" {"+t.getFilters().map(_w).join(" ,")+"}"}(n):"Filter"}class eC extends ot{constructor(e,t,r){super(e,t,r),this.key=Ae.fromName(r.referenceValue)}matches(e){const t=Ae.comparator(e.key,this.key);return this.matchesComparison(t)}}class tC extends ot{constructor(e,t){super(e,"in",t),this.keys=bw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nC extends ot{constructor(e,t){super(e,"not-in",t),this.keys=bw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function bw(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ae.fromName(r.referenceValue))}class rC extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Cu(t)&&Ru(t.arrayValue,this.value)}}class ww extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ru(this.value.arrayValue,t)}}class sC extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ru(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Ru(this.value.arrayValue,t)}}class iC extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Cu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ru(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function yp(n,e=null,t=[],r=[],s=null,i=null,o=null){return new oC(n,e,t,r,s,i,o)}function Ro(n){const e=Ee(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>vp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Ju(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>$a(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>$a(r)).join(",")),e.ue=t}return e.ue}function Yu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ZR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!vw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Py(n.startAt,e.startAt)&&Py(n.endAt,e.endAt)}function Od(n){return Ae.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Md(n,e){return n.filters.filter(t=>t instanceof ot&&t.field.isEqual(e))}function Ry(n,e,t){let r=ld,s=!0;for(const i of Md(n,e)){let o=ld,a=!0;switch(i.op){case"<":case"<=":o=YR(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=ld}xy({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];xy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Cy(n,e,t){let r=_i,s=!0;for(const i of Md(n,e)){let o=_i,a=!0;switch(i.op){case">=":case">":o=XR(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=_i}Ay({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Ay({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Iw(n,e,t,r,s,i,o,a){return new Ls(n,e,t,r,s,i,o,a)}function il(n){return new Ls(n)}function ky(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function _m(n){return n.collectionGroup!==null}function Aa(n){const e=Ee(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Pt(zt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ku(i,r))}),t.has(zt.keyField().canonicalString())||e.ce.push(new ku(zt.keyField(),r))}return e.ce}function Bn(n){const e=Ee(n);return e.le||(e.le=Tw(e,Aa(n))),e.le}function Ew(n){const e=Ee(n);return e.he||(e.he=Tw(e,n.explicitOrderBy)),e.he}function Tw(n,e){if(n.limitType==="F")return yp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ku(s.field,i)});const t=n.endAt?new ki(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ki(n.startAt.position,n.startAt.inclusive):null;return yp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function _p(n,e){const t=n.filters.concat([e]);return new Ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ld(n,e,t){return new Ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Xu(n,e){return Yu(Bn(n),Bn(e))&&n.limitType===e.limitType}function xw(n){return`${Ro(Bn(n))}|lt:${n.limitType}`}function va(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>_w(s)).join(", ")}]`),Ju(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>$a(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>$a(s)).join(",")),`Target(${r})`}(Bn(n))}; limitType=${n.limitType})`}function Zu(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ae.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Aa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=Sy(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,Aa(r),s)||r.endAt&&!function(o,a,l){const c=Sy(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,Aa(r),s))}(n,e)}function Aw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Sw(n){return(e,t)=>{let r=!1;for(const s of Aa(n)){const i=aC(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function aC(n,e,t){const r=n.field.isKeyField()?Ae.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Ci(l,c):Re()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Re()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ui(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return cw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lC=new Mt(Ae.comparator);function lr(){return lC}const Pw=new Mt(Ae.comparator);function Yl(...n){let e=Pw;for(const t of n)e=e.insert(t.key,t);return e}function Rw(n){let e=Pw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Yr(){return fu()}function Cw(){return fu()}function fu(){return new Fs(n=>n.toString(),(n,e)=>n.isEqual(e))}const uC=new Mt(Ae.comparator),cC=new Pt(Ae.comparator);function Ye(...n){let e=cC;for(const t of n)e=e.add(t);return e}const dC=new Pt(ze);function bm(){return dC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Su(e)?"-0":e}}function kw(n){return{integerValue:""+n}}function Dw(n,e){return sw(e)?kw(e):wm(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(){this._=void 0}}function hC(n,e,t){return n instanceof ja?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&yh(i)&&(i=_h(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Co?Vw(n,e):n instanceof ko?Ow(n,e):function(s,i){const o=Nw(s,i),a=Dy(o)+Dy(s.Pe);return mp(o)&&mp(s.Pe)?kw(a):wm(s.serializer,a)}(n,e)}function fC(n,e,t){return n instanceof Co?Vw(n,e):n instanceof ko?Ow(n,e):t}function Nw(n,e){return n instanceof Ba?function(r){return mp(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ja extends wh{}class Co extends wh{constructor(e){super(),this.elements=e}}function Vw(n,e){const t=Mw(e);for(const r of n.elements)t.some(s=>os(s,r))||t.push(r);return{arrayValue:{values:t}}}class ko extends wh{constructor(e){super(),this.elements=e}}function Ow(n,e){let t=Mw(e);for(const r of n.elements)t=t.filter(s=>!os(s,r));return{arrayValue:{values:t}}}class Ba extends wh{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Dy(n){return qt(n.integerValue||n.doubleValue)}function Mw(n){return Cu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e,t){this.field=e,this.transform=t}}function pC(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Co&&s instanceof Co||r instanceof ko&&s instanceof ko?Ma(r.elements,s.elements,os):r instanceof Ba&&s instanceof Ba?os(r.Pe,s.Pe):r instanceof ja&&s instanceof ja}(n.transform,e.transform)}class mC{constructor(e,t){this.version=e,this.transformResults=t}}class Kt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Kt}static exists(e){return new Kt(void 0,e)}static updateTime(e){return new Kt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function dd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ih{}function Lw(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new al(n.key,Kt.none()):new ol(n.key,n.data,Kt.none());{const t=n.data,r=Rn.empty();let s=new Pt(zt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new $s(n.key,r,new ar(s.toArray()),Kt.none())}}function gC(n,e,t){n instanceof ol?function(s,i,o){const a=s.value.clone(),l=Vy(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof $s?function(s,i,o){if(!dd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Vy(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Fw(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function pu(n,e,t,r){return n instanceof ol?function(i,o,a,l){if(!dd(i.precondition,o))return a;const c=i.value.clone(),d=Oy(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof $s?function(i,o,a,l){if(!dd(i.precondition,o))return a;const c=Oy(i.fieldTransforms,l,o),d=o.data;return d.setAll(Fw(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return dd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function vC(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Nw(r.transform,s||null);i!=null&&(t===null&&(t=Rn.empty()),t.set(r.field,i))}return t||null}function Ny(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ma(r,s,(i,o)=>pC(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ol extends Ih{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class $s extends Ih{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Fw(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Vy(n,e,t){const r=new Map;Ce(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,fC(o,a,t[s]))}return r}function Oy(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,hC(i,o,e))}return r}class al extends Ih{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Im extends Ih{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&gC(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=pu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=pu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Cw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=Lw(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Me.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ye())}isEqual(e){return this.batchId===e.batchId&&Ma(this.mutations,e.mutations,(t,r)=>Ny(t,r))&&Ma(this.baseMutations,e.baseMutations,(t,r)=>Ny(t,r))}}class Tm{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ce(e.mutations.length===r.length);let s=function(){return uC}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Tm(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fn,ft;function Uw(n){switch(n){default:return Re();case H.CANCELLED:case H.UNKNOWN:case H.DEADLINE_EXCEEDED:case H.RESOURCE_EXHAUSTED:case H.INTERNAL:case H.UNAVAILABLE:case H.UNAUTHENTICATED:return!1;case H.INVALID_ARGUMENT:case H.NOT_FOUND:case H.ALREADY_EXISTS:case H.PERMISSION_DENIED:case H.FAILED_PRECONDITION:case H.ABORTED:case H.OUT_OF_RANGE:case H.UNIMPLEMENTED:case H.DATA_LOSS:return!0}}function jw(n){if(n===void 0)return sn("GRPC error has no .code"),H.UNKNOWN;switch(n){case fn.OK:return H.OK;case fn.CANCELLED:return H.CANCELLED;case fn.UNKNOWN:return H.UNKNOWN;case fn.DEADLINE_EXCEEDED:return H.DEADLINE_EXCEEDED;case fn.RESOURCE_EXHAUSTED:return H.RESOURCE_EXHAUSTED;case fn.INTERNAL:return H.INTERNAL;case fn.UNAVAILABLE:return H.UNAVAILABLE;case fn.UNAUTHENTICATED:return H.UNAUTHENTICATED;case fn.INVALID_ARGUMENT:return H.INVALID_ARGUMENT;case fn.NOT_FOUND:return H.NOT_FOUND;case fn.ALREADY_EXISTS:return H.ALREADY_EXISTS;case fn.PERMISSION_DENIED:return H.PERMISSION_DENIED;case fn.FAILED_PRECONDITION:return H.FAILED_PRECONDITION;case fn.ABORTED:return H.ABORTED;case fn.OUT_OF_RANGE:return H.OUT_OF_RANGE;case fn.UNIMPLEMENTED:return H.UNIMPLEMENTED;case fn.DATA_LOSS:return H.DATA_LOSS;default:return Re()}}(ft=fn||(fn={}))[ft.OK=0]="OK",ft[ft.CANCELLED=1]="CANCELLED",ft[ft.UNKNOWN=2]="UNKNOWN",ft[ft.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ft[ft.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ft[ft.NOT_FOUND=5]="NOT_FOUND",ft[ft.ALREADY_EXISTS=6]="ALREADY_EXISTS",ft[ft.PERMISSION_DENIED=7]="PERMISSION_DENIED",ft[ft.UNAUTHENTICATED=16]="UNAUTHENTICATED",ft[ft.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ft[ft.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ft[ft.ABORTED=10]="ABORTED",ft[ft.OUT_OF_RANGE=11]="OUT_OF_RANGE",ft[ft.UNIMPLEMENTED=12]="UNIMPLEMENTED",ft[ft.INTERNAL=13]="INTERNAL",ft[ft.UNAVAILABLE=14]="UNAVAILABLE",ft[ft.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bw(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _C=new Eo([4294967295,4294967295],0);function My(n){const e=Bw().encode(n),t=new qb;return t.update(e),new Uint8Array(t.digest())}function Ly(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Eo([t,r],0),new Eo([s,i],0)]}class Am{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Xl(`Invalid padding: ${t}`);if(r<0)throw new Xl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Xl(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Xl(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Eo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Eo.fromNumber(r)));return s.compare(_C)===1&&(s=new Eo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=My(e),[r,s]=Ly(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Am(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=My(e),[r,s]=Ly(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Xl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,nc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new tc(Me.min(),s,new Mt(ze),lr(),Ye())}}class nc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new nc(r,t,Ye(),Ye(),Ye())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class qw{constructor(e,t){this.targetId=e,this.me=t}}class zw{constructor(e,t,r=en.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Fy{constructor(){this.fe=0,this.ge=Uy(),this.pe=en.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ye(),t=Ye(),r=Ye();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Re()}}),new nc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Uy()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ce(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class bC{constructor(e){this.Le=e,this.Be=new Map,this.ke=lr(),this.qe=$y(),this.Qe=new Mt(ze)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Re()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Od(i))if(r===0){const o=new Ae(i.path);this.Ue(t,o,$t.newNoDocument(o,Me.min()))}else Ce(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}Fd==null||Fd.et(function(d,f,g,y,T){var A,P,U,q,L,z;const fe={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},me=f.unchangedNames;return me&&(fe.bloomFilter={applied:T===0,hashCount:(A=me==null?void 0:me.hashCount)!==null&&A!==void 0?A:0,bitmapLength:(q=(U=(P=me==null?void 0:me.bits)===null||P===void 0?void 0:P.bitmap)===null||U===void 0?void 0:U.length)!==null&&q!==void 0?q:0,padding:(z=(L=me==null?void 0:me.bits)===null||L===void 0?void 0:L.padding)!==null&&z!==void 0?z:0,mightContain:x=>{var I;return(I=y==null?void 0:y.mightContain(x))!==null&&I!==void 0&&I}}),fe}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ds(r).toUint8Array()}catch(l){if(l instanceof dw)return xr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Am(o,s,i)}catch(l){return xr(l instanceof Xl?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&Od(a.target)){const l=new Ae(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,$t.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Ye();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new tc(e,t,this.Qe,this.ke,r);return this.ke=lr(),this.qe=$y(),this.Qe=new Mt(ze),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Fy,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Pt(ze),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||de("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Fy),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function $y(){return new Mt(Ae.comparator)}function Uy(){return new Mt(Ae.comparator)}const wC=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),IC=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),EC=(()=>({and:"AND",or:"OR"}))();class TC{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function bp(n,e){return n.useProto3Json||Ju(e)?e:{value:e}}function qa(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Kw(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function xC(n,e){return qa(n,e.toTimestamp())}function an(n){return Ce(!!n),Me.fromTimestamp(function(t){const r=ks(t);return new Qt(r.seconds,r.nanos)}(n))}function Sm(n,e){return wp(n,e).canonicalString()}function wp(n,e){const t=function(s){return new it(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Gw(n){const e=it.fromString(n);return Ce(nI(e)),e}function Du(n,e){return Sm(n.databaseId,e.path)}function ts(n,e){const t=Gw(e);if(t.get(1)!==n.databaseId.projectId)throw new he(H.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new he(H.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ae(Qw(t))}function Hw(n,e){return Sm(n.databaseId,e)}function Ww(n){const e=Gw(n);return e.length===4?it.emptyPath():Qw(e)}function Ip(n){return new it(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Qw(n){return Ce(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function jy(n,e,t){return{name:Du(n,e),fields:t.value.mapValue.fields}}function Jw(n,e,t){const r=ts(n,e.name),s=an(e.updateTime),i=e.createTime?an(e.createTime):Me.min(),o=new Rn({mapValue:{fields:e.fields}}),a=$t.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function AC(n,e){return"found"in e?function(r,s){Ce(!!s.found),s.found.name,s.found.updateTime;const i=ts(r,s.found.name),o=an(s.found.updateTime),a=s.found.createTime?an(s.found.createTime):Me.min(),l=new Rn({mapValue:{fields:s.found.fields}});return $t.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Ce(!!s.missing),Ce(!!s.readTime);const i=ts(r,s.missing),o=an(s.readTime);return $t.newNoDocument(i,o)}(n,e):Re()}function SC(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Re()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Ce(d===void 0||typeof d=="string"),en.fromBase64String(d||"")):(Ce(d===void 0||d instanceof Buffer||d instanceof Uint8Array),en.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?H.UNKNOWN:jw(c.code);return new he(d,c.message||"")}(o);t=new zw(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ts(n,r.document.name),i=an(r.document.updateTime),o=r.document.createTime?an(r.document.createTime):Me.min(),a=new Rn({mapValue:{fields:r.document.fields}}),l=$t.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new hd(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ts(n,r.document),i=r.readTime?an(r.readTime):Me.min(),o=$t.newNoDocument(s,i),a=r.removedTargetIds||[];t=new hd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ts(n,r.document),i=r.removedTargetIds||[];t=new hd([],i,s,null)}else{if(!("filter"in e))return Re();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new yC(s,i),a=r.targetId;t=new qw(a,o)}}return t}function Nu(n,e){let t;if(e instanceof ol)t={update:jy(n,e.key,e.value)};else if(e instanceof al)t={delete:Du(n,e.key)};else if(e instanceof $s)t={update:jy(n,e.key,e.data),updateMask:NC(e.fieldMask)};else{if(!(e instanceof Im))return Re();t={verify:Du(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof ja)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Co)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ko)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ba)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Re()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:xC(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Re()}(n,e.precondition)),t}function Ep(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Kt.updateTime(an(i.updateTime)):i.exists!==void 0?Kt.exists(i.exists):Kt.none()}(e.currentDocument):Kt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Ce(a.setToServerValue==="REQUEST_TIME"),l=new ja;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new Co(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new ko(d)}else"increment"in a?l=new Ba(o,a.increment):Re();const c=zt.fromServerFormat(a.fieldPath);return new ec(c,l)}(n,s)):[];if(e.update){e.update.name;const s=ts(n,e.update.name),i=new Rn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new ar(c.map(d=>zt.fromServerFormat(d)))}(e.updateMask);return new $s(s,i,o,t,r)}return new ol(s,i,t,r)}if(e.delete){const s=ts(n,e.delete);return new al(s,t)}if(e.verify){const s=ts(n,e.verify);return new Im(s,t)}return Re()}function PC(n,e){return n&&n.length>0?(Ce(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?an(s.updateTime):an(i);return o.isEqual(Me.min())&&(o=an(i)),new mC(o,s.transformResults||[])}(t,e))):[]}function Yw(n,e){return{documents:[Hw(n,e.path)]}}function Eh(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Hw(n,s);const i=function(c){if(c.length!==0)return tI(Tt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:di(g.field),direction:CC(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=bp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function Xw(n,e,t,r){const{_t:s,parent:i}=Eh(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:di(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:di(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function Zw(n){let e=Ww(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ce(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=eI(f);return g instanceof Tt&&ym(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(T){return new ku(ya(T.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Ju(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new ki(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new ki(y,g)}(t.endAt)),Iw(e,s,o,i,a,"F",l,c)}function RC(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Re()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function eI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ya(t.unaryFilter.field);return ot.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=ya(t.unaryFilter.field);return ot.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ya(t.unaryFilter.field);return ot.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=ya(t.unaryFilter.field);return ot.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Re()}}(n):n.fieldFilter!==void 0?function(t){return ot.create(ya(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Re()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Tt.create(t.compositeFilter.filters.map(r=>eI(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Re()}}(t.compositeFilter.op))}(n):Re()}function CC(n){return wC[n]}function kC(n){return IC[n]}function DC(n){return EC[n]}function di(n){return{fieldPath:n.canonicalString()}}function ya(n){return zt.fromServerFormat(n.fieldPath)}function tI(n){return n instanceof ot?function(t){if(t.op==="=="){if(Ty(t.value))return{unaryFilter:{field:di(t.field),op:"IS_NAN"}};if(Ey(t.value))return{unaryFilter:{field:di(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ty(t.value))return{unaryFilter:{field:di(t.field),op:"IS_NOT_NAN"}};if(Ey(t.value))return{unaryFilter:{field:di(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:di(t.field),op:kC(t.op),value:t.value}}}(n):n instanceof Tt?function(t){const r=t.getFilters().map(s=>tI(s));return r.length===1?r[0]:{compositeFilter:{op:DC(t.op),filters:r}}}(n):Re()}function NC(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function nI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,t,r,s,i=Me.min(),o=Me.min(),a=en.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ws(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ws(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ws(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ws(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e){this.ct=e}}function VC(n,e){let t;if(e.document)t=Jw(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Ae.fromSegments(e.noDocument.path),s=No(e.noDocument.readTime);t=$t.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Re();{const r=Ae.fromSegments(e.unknownDocument.path),s=No(e.unknownDocument.version);t=$t.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Qt(s[0],s[1]);return Me.fromTimestamp(i)}(e.readTime)),t}function By(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:$d(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Du(i,o.key),fields:o.data.value.mapValue.fields,updateTime:qa(i,o.version.toTimestamp()),createTime:qa(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Do(e.version)};else{if(!e.isUnknownDocument())return Re();r.unknownDocument={path:t.path.toArray(),version:Do(e.version)}}return r}function $d(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Do(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function No(n){const e=new Qt(n.seconds,n.nanoseconds);return Me.fromTimestamp(e)}function go(n,e){const t=(e.baseMutations||[]).map(i=>Ep(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Ep(n.ct,i)),s=Qt.fromMillis(e.localWriteTimeMs);return new Em(e.batchId,s,t,r)}function Zl(n){const e=No(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?No(n.lastLimboFreeSnapshotVersion):Me.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Ce(i.documents.length===1),Bn(il(Ww(i.documents[0])))}(n.query):function(i){return Bn(Zw(i))}(n.query),new ws(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,en.fromBase64String(n.resumeToken))}function sI(n,e){const t=Do(e.snapshotVersion),r=Do(e.lastLimboFreeSnapshotVersion);let s;s=Od(e.target)?Yw(n.ct,e.target):Eh(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ro(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Pm(n){const e=Zw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ld(e,e.limit,"L"):e}function Cf(n,e){return new xm(e.largestBatchId,Ep(n.ct,e.overlayMutation))}function qy(n,e){const t=e.path.lastSegment();return[n,jn(e.path.popLast()),t]}function zy(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Do(r.readTime),documentKey:jn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{getBundleMetadata(e,t){return Ky(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:No(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Ky(e).put(function(s){return{bundleId:s.id,createTime:Do(an(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Gy(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Pm(i.bundledQuery),readTime:No(i.readTime)}}(r)})}saveNamedQuery(e,t){return Gy(e).put(function(s){return{name:s.name,readTime:Do(an(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Ky(n){return yn(n,"bundles")}function Gy(n){return yn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Th(e,r)}getOverlay(e,t){return Ul(e).get(qy(this.userId,t)).next(r=>r?Cf(this.serializer,r):null)}getOverlays(e,t){const r=Yr();return G.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new xm(t,o);s.push(this.ht(e,a))}),G.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(jn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Ul(e).j("collectionPathOverlayIndex",a))}),G.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Yr(),i=jn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ul(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Cf(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Yr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ul(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=Cf(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return Ul(e).put(function(s,i,o){const[a,l,c]=qy(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Nu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Ul(n){return yn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{Pt(e){return yn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?en.fromUint8Array(r):en.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(qt(e.integerValue));else if("doubleValue"in e){const r=qt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Su(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ks(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Ds(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?hw(e)?this.dt(t,Number.MAX_SAFE_INTEGER):bh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Re()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(qt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Ae.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}vo.vt=new vo;function LC(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Hy(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=LC(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class FC{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=Hy(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=Hy(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class $C{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class UC{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class jl{constructor(){this.jt=new FC,this.Ht=new $C(this.jt),this.Jt=new UC(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new yo(this.indexId,this.documentKey,this.arrayValue,r)}}function si(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Wy(n.arrayValue,e.arrayValue),t!==0?t:(t=Wy(n.directionalValue,e.directionalValue),t!==0?t:Ae.comparator(n.documentKey,e.documentKey)))}function Wy(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(e){this.Xt=new Pt((t,r)=>zt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Ce(e.collectionGroup===this.collectionId),this.nn)return!1;const t=hp(e);if(t!==void 0&&!this.sn(t))return!1;const r=ho(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Pt(zt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new To(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new To(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new To(r.field,r.dir==="asc"?0:1)));return new La(La.UNKNOWN_ID,this.collectionId,t,Fa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iI(n){var e,t;if(Ce(n instanceof ot||n instanceof Tt),n instanceof ot){if(n instanceof ww){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>ot.create(n.field,"==",i)))||[];return Tt.create(s,"or")}return n}const r=n.filters.map(s=>iI(s));return Tt.create(r,n.op)}function jC(n){if(n.getFilters().length===0)return[];const e=Ap(iI(n));return Ce(oI(e)),Tp(e)||xp(e)?[e]:e.getFilters()}function Tp(n){return n instanceof ot}function xp(n){return n instanceof Tt&&ym(n)}function oI(n){return Tp(n)||xp(n)||function(t){if(t instanceof Tt&&gp(t)){for(const r of t.getFilters())if(!Tp(r)&&!xp(r))return!1;return!0}return!1}(n)}function Ap(n){if(Ce(n instanceof ot||n instanceof Tt),n instanceof ot)return n;if(n.filters.length===1)return Ap(n.filters[0]);const e=n.filters.map(r=>Ap(r));let t=Tt.create(e,n.op);return t=Ud(t),oI(t)?t:(Ce(t instanceof Tt),Ce(Ua(t)),Ce(t.filters.length>1),t.filters.reduce((r,s)=>Rm(r,s)))}function Rm(n,e){let t;return Ce(n instanceof ot||n instanceof Tt),Ce(e instanceof ot||e instanceof Tt),t=n instanceof ot?e instanceof ot?function(s,i){return Tt.create([s,i],"and")}(n,e):Jy(n,e):e instanceof ot?Jy(e,n):function(s,i){if(Ce(s.filters.length>0&&i.filters.length>0),Ua(s)&&Ua(i))return yw(s,i.getFilters());const o=gp(s)?s:i,a=gp(s)?i:s,l=o.filters.map(c=>Rm(c,a));return Tt.create(l,"or")}(n,e),Ud(t)}function Jy(n,e){if(Ua(e))return yw(e,n.getFilters());{const t=e.filters.map(r=>Rm(n,r));return Tt.create(t,"or")}}function Ud(n){if(Ce(n instanceof ot||n instanceof Tt),n instanceof ot)return n;const e=n.getFilters();if(e.length===1)return Ud(e[0]);if(gw(n))return n;const t=e.map(s=>Ud(s)),r=[];return t.forEach(s=>{s instanceof ot?r.push(s):s instanceof Tt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Tt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(){this.un=new Cm}addToCollectionParentIndex(e,t){return this.un.add(t),G.resolve()}getCollectionParents(e,t){return G.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return G.resolve()}deleteFieldIndex(e,t){return G.resolve()}deleteAllFieldIndexes(e){return G.resolve()}createTargetIndexes(e,t){return G.resolve()}getDocumentsMatchingTarget(e,t){return G.resolve(null)}getIndexType(e,t){return G.resolve(0)}getFieldIndexes(e,t){return G.resolve([])}getNextCollectionGroupToUpdate(e){return G.resolve(null)}getMinOffset(e,t){return G.resolve(pr.min())}getMinOffsetFromCollectionGroup(e,t){return G.resolve(pr.min())}updateCollectionGroup(e,t,r){return G.resolve()}updateIndexEntries(e,t){return G.resolve()}}class Cm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Pt(it.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Pt(it.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gc=new Uint8Array(0);class qC{constructor(e,t){this.databaseId=t,this.cn=new Cm,this.ln=new Fs(r=>Ro(r),(r,s)=>Yu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:jn(s)};return Yy(e).put(i)}return G.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[Xb(t),""],!1,!0);return Yy(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Jr(o.parent))}return r})}addFieldIndex(e,t){const r=Bl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=ha(e);return i.next(a=>{o.put(zy(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Bl(e),s=ha(e),i=da(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Bl(e),r=da(e),s=ha(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return G.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Qy(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=da(e);let s=!0;const i=new Map;return G.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ye();const a=[];return G.forEach(i,(l,c)=>{de("IndexedDbIndexManager",`Using index ${function(L){return`id=${L.indexId}|cg=${L.collectionGroup}|f=${L.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(l)} to execute ${Ro(t)}`);const d=function(L,z){const fe=hp(z);if(fe===void 0)return null;for(const me of Md(L,fe.fieldPath))switch(me.op){case"array-contains-any":return me.value.arrayValue.values||[];case"array-contains":return[me.value]}return null}(c,l),f=function(L,z){const fe=new Map;for(const me of ho(z))for(const x of Md(L,me.fieldPath))switch(x.op){case"==":case"in":fe.set(me.fieldPath.canonicalString(),x.value);break;case"not-in":case"!=":return fe.set(me.fieldPath.canonicalString(),x.value),Array.from(fe.values())}return null}(c,l),g=function(L,z){const fe=[];let me=!0;for(const x of ho(z)){const I=x.kind===0?Ry(L,x.fieldPath,L.startAt):Cy(L,x.fieldPath,L.startAt);fe.push(I.value),me&&(me=I.inclusive)}return new ki(fe,me)}(c,l),y=function(L,z){const fe=[];let me=!0;for(const x of ho(z)){const I=x.kind===0?Cy(L,x.fieldPath,L.endAt):Ry(L,x.fieldPath,L.endAt);fe.push(I.value),me&&(me=I.inclusive)}return new ki(fe,me)}(c,l),T=this.In(l,c,g),A=this.In(l,c,y),P=this.Tn(l,c,f),U=this.En(l.indexId,d,T,g.inclusive,A,y.inclusive,P);return G.forEach(U,q=>r.G(q,t.limit).next(L=>{L.forEach(z=>{const fe=Ae.fromSegments(z.documentKey);o.has(fe)||(o=o.add(fe),a.push(fe))})}))}).next(()=>a)}return G.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=jC(Tt.create(e.filters,"and")).map(r=>yp(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Gc,y=this.An(e,g,r[f%c],s),T=this.Rn(e,g,i[f%c],o),A=a.map(P=>this.An(e,g,P,!0));d.push(...this.createRange(y,T,A))}return d}An(e,t,r,s){const i=new yo(e,Ae.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new yo(e,Ae.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Qy(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return G.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Pt(zt.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new jl;for(const s of ho(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);vo.vt.It(i,o)}return r.zt()}dn(e){const t=new jl;return vo.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new jl;return vo.vt.It(Po(this.databaseId,t),r.Yt(function(i){const o=ho(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new jl);let i=0;for(const o of ho(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&Cu(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);vo.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new jl;l.seed(a.zt()),vo.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof ot&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Bl(e),s=ha(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return G.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new Fa(f.sequenceNumber,new pr(No(f.readTime),new Ae(Jr(f.documentKey)),f.largestBatchId)):Fa.empty(),y=d.fields.map(([T,A])=>new To(zt.fromServerFormat(T),A));return new La(d.indexId,d.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ze(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Bl(e),i=ha(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>G.forEach(a,l=>i.put(zy(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return G.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?G.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),G.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?G.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return da(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return da(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=da(e);let i=new Pt(si);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new yo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Pt(si);const s=this.Vn(t,e);if(s==null)return r;const i=hp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Cu(o))for(const a of o.arrayValue.values||[])r=r.add(new yo(t.indexId,e.key,this.dn(a),s))}else r=r.add(new yo(t.indexId,e.key,Gc,s));return r}bn(e,t,r,s,i){de("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,g){const y=l.getIterator(),T=c.getIterator();let A=ca(y),P=ca(T);for(;A||P;){let U=!1,q=!1;if(A&&P){const L=d(A,P);L<0?q=!0:L>0&&(U=!0)}else A!=null?q=!0:U=!0;U?(f(P),P=ca(T)):q?(g(A),A=ca(y)):(A=ca(y),P=ca(T))}}(s,i,si,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),G.waitFor(o)}yn(e){let t=1;return ha(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>si(o,a)).filter((o,a,l)=>!a||si(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=si(o,e),l=si(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Gc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Gc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return si(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Xy)}getMinOffset(e,t){return G.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Re())).next(Xy)}}function Yy(n){return yn(n,"collectionParents")}function da(n){return yn(n,"indexEntries")}function Bl(n){return yn(n,"indexConfiguration")}function ha(n){return yn(n,"indexState")}function Xy(n){Ce(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;mm(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new pr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ln{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ln(e,Ln.DEFAULT_COLLECTION_PERCENTILE,Ln.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Ce(a===1)}));const c=[];for(const d of t.mutations){const f=iw(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return G.waitFor(i).next(()=>c)}function jd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Re();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ln.DEFAULT_COLLECTION_PERCENTILE=10,Ln.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ln.DEFAULT=new Ln(41943040,Ln.DEFAULT_COLLECTION_PERCENTILE,Ln.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ln.DISABLED=new Ln(-1,0,0);class xh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Ce(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new xh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ii(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=_a(e),o=ii(e);return o.add({}).next(a=>{Ce(typeof a=="number");const l=new Em(a,t,r,s),c=function(y,T,A){const P=A.baseMutations.map(q=>Nu(y.ct,q)),U=A.mutations.map(q=>Nu(y.ct,q));return{userId:T,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:P,mutations:U}}(this.serializer,this.userId,l),d=[];let f=new Pt((g,y)=>ze(g.canonicalString(),y.canonicalString()));for(const g of s){const y=iw(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,kR))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),G.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return ii(e).get(t).next(r=>r?(Ce(r.userId===this.userId),go(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?G.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ii(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Ce(a.batchId>=r),i=go(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ii(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ii(e).U("userMutationsIndex",t).next(r=>r.map(s=>go(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=ad(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return _a(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,g=Jr(d);if(c===this.userId&&t.path.isEqual(g))return ii(e).get(f).next(y=>{if(!y)throw Re();Ce(y.userId===this.userId),i.push(go(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Pt(ze);const s=[];return t.forEach(i=>{const o=ad(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=_a(e).J({range:a},(c,d,f)=>{const[g,y,T]=c,A=Jr(y);g===this.userId&&i.path.isEqual(A)?r=r.add(T):f.done()});s.push(l)}),G.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=ad(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Pt(ze);return _a(e).J({range:o},(l,c,d)=>{const[f,g,y]=l,T=Jr(g);f===this.userId&&r.isPrefixOf(T)?T.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ii(e).get(i).next(o=>{if(o===null)throw Re();Ce(o.userId===this.userId),r.push(go(this.serializer,o))}))}),G.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return aI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),G.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return G.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return _a(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Jr(i[1]);s.push(l)}else a.done()}).next(()=>{Ce(s.length===0)})})}containsKey(e,t){return lI(e,this.userId,t)}Nn(e){return uI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function lI(n,e,t){const r=ad(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return _a(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function ii(n){return yn(n,"mutations")}function _a(n){return yn(n,"documentMutations")}function uI(n){return yn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Vo(0)}static kn(){return new Vo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Vo(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Me.fromTimestamp(new Qt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>fa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Ce(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return fa(e).J((o,a)=>{const l=Zl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>G.waitFor(i)).next(()=>s)}forEachTarget(e,t){return fa(e).J((r,s)=>{const i=Zl(s);t(i)})}qn(e){return e_(e).get("targetGlobalKey").next(t=>(Ce(t!==null),t))}Qn(e,t){return e_(e).put("targetGlobalKey",t)}Kn(e,t){return fa(e).put(sI(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ro(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return fa(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Zl(a);Yu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=hi(e);return t.forEach(o=>{const a=jn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),G.waitFor(s)}removeMatchingKeys(e,t,r){const s=hi(e);return G.forEach(t,i=>{const o=jn(i.path);return G.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=hi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=hi(e);let i=Ye();return s.J({range:r,H:!0},(o,a,l)=>{const c=Jr(o[1]),d=new Ae(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=jn(t.path),s=IDBKeyRange.bound([r],[Xb(r)],!1,!0);let i=0;return hi(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return fa(e).get(t).next(r=>r?Zl(r):null)}}function fa(n){return yn(n,"targets")}function e_(n){return yn(n,"targetGlobal")}function hi(n){return yn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t_([n,e],[t,r]){const s=ze(n,t);return s===0?ze(e,r):s}class KC{constructor(e){this.Un=e,this.buffer=new Pt(t_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();t_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cI{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){de("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){$i(t)?de("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Fi(t)}await this.Hn(3e5)})}}class GC{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return G.resolve(or.oe);const r=new KC(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(de("LruGarbageCollector","Garbage collection skipped; disabled"),G.resolve(Zy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(de("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Zy):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(de("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),ga()<=st.DEBUG&&de("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),G.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function dI(n,e){return new GC(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HC{constructor(e,t){this.db=e,this.garbageCollector=dI(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Hc(e,r)}removeReference(e,t,r){return Hc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Hc(e,t)}nr(e,t){return function(s,i){let o=!1;return uI(s).Y(a=>lI(s,a,i).next(l=>(l&&(o=!0),G.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Me.min()),hi(e).delete(function(f){return[0,jn(f.path)]}(o))))});s.push(l)}}).next(()=>G.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Hc(e,t)}tr(e,t){const r=hi(e);let s,i=or.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==or.oe&&t(new Ae(Jr(s)),i),i=c,s=l):i=or.oe}).next(()=>{i!==or.oe&&t(new Ae(Jr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Hc(n,e){return hi(n).put(function(r,s){return{targetId:0,path:jn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hI{constructor(){this.changes=new Fs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?G.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WC{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return lo(e).put(r)}removeEntry(e,t,r){return lo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],$d(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=$t.newInvalidDocument(t);return lo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ql(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:$t.newInvalidDocument(t)};return lo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ql(t))},(s,i)=>{r={document:this.ir(t,i),size:jd(i)}}).next(()=>r)}getEntries(e,t){let r=lr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=lr(),s=new Mt(Ae.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,jd(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return G.resolve();let s=new Pt(s_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(ql(s.first()),ql(s.last())),o=s.getIterator();let a=o.getNext();return lo(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=Ae.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&s_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(ql(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),$d(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return lo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=lr();for(const f of c){const g=this.ir(Ae.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Zu(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=lr();const o=r_(t,r),a=r_(t,pr.max());return lo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(Ae.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new QC(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return n_(e).get("remoteDocumentGlobalKey").next(t=>(Ce(!!t),t))}rr(e,t){return n_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=VC(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Me.min())))return r}return $t.newInvalidDocument(e)}}function fI(n){return new WC(n)}class QC extends hI{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Fs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Pt((i,o)=>ze(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=By(this.cr.serializer,o);s=s.add(i.path.popLast());const c=jd(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=By(this.cr.serializer,o.convertToNoDocument(Me.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),G.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function n_(n){return yn(n,"remoteDocumentGlobal")}function lo(n){return yn(n,"remoteDocumentsV14")}function ql(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function r_(n,e){const t=e.documentKey.path.toArray();return[n,$d(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function s_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=ze(t[i],r[i]),s)return s;return s=ze(t.length,r.length),s||(s=ze(t[t.length-2],r[r.length-2]),s||ze(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&pu(r.mutation,s,ar.empty(),Qt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ye()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ye()){const s=Yr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Yl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Yr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ye()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=lr();const o=fu(),a=function(){return fu()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof $s)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),pu(d.mutation,c,d.mutation.getFieldMask(),Qt.now())):o.set(c.key,ar.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new JC(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=fu();let s=new Mt((o,a)=>o-a),i=Ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||ar.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||Ye()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=Cw();d.forEach(g=>{if(!i.has(g)){const y=Lw(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return G.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ae.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):_m(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):G.resolve(Yr());let a=-1,l=i;return o.next(c=>G.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?G.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Ye())).next(d=>({batchId:a,changes:Rw(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ae(t)).next(r=>{let s=Yl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Yl();return this.indexManager.getCollectionParents(e,i).next(a=>G.forEach(a,l=>{const c=function(f,g){return new Ls(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,$t.newInvalidDocument(d)))});let a=Yl();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&pu(d.mutation,c,ar.empty(),Qt.now()),Zu(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return G.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:an(s.createTime)}}(t)),G.resolve()}getNamedQuery(e,t){return G.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Pm(s.bundledQuery),readTime:an(s.readTime)}}(t)),G.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XC{constructor(){this.overlays=new Mt(Ae.comparator),this.Ir=new Map}getOverlay(e,t){return G.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Yr();return G.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),G.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),G.resolve()}getOverlaysForCollection(e,t,r){const s=Yr(),i=t.length+1,o=new Ae(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return G.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Mt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Yr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Yr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return G.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new xm(t,r));let i=this.Ir.get(t);i===void 0&&(i=Ye(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(){this.sessionToken=en.EMPTY_BYTE_STRING}getSessionToken(e){return G.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,G.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(){this.Tr=new Pt(wn.Er),this.dr=new Pt(wn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new wn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new wn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ae(new it([])),r=new wn(t,e),s=new wn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ae(new it([])),r=new wn(t,e),s=new wn(t,e+1);let i=Ye();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new wn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class wn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ae.comparator(e.key,t.key)||ze(e.wr,t.wr)}static Ar(e,t){return ze(e.wr,t.wr)||Ae.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Pt(wn.Er)}checkEmpty(e){return G.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Em(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new wn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return G.resolve(o)}lookupMutationBatch(e,t){return G.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return G.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return G.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return G.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new wn(t,0),s=new wn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),G.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Pt(ze);return t.forEach(s=>{const i=new wn(s,0),o=new wn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),G.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ae.isDocumentKey(i)||(i=i.child(""));const o=new wn(new Ae(i),0);let a=new Pt(ze);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),G.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ce(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return G.forEach(t.mutations,s=>{const i=new wn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new wn(t,0),s=this.br.firstAfterOrEqual(r);return G.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,G.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e){this.Mr=e,this.docs=function(){return new Mt(Ae.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return G.resolve(r?r.document.mutableCopy():$t.newInvalidDocument(t))}getEntries(e,t){let r=lr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():$t.newInvalidDocument(s))}),G.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=lr();const o=t.path,a=new Ae(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||mm(ew(d),r)<=0||(s.has(d.key)||Zu(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return G.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Re()}Or(e,t){return G.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new nk(this)}getSize(e){return G.resolve(this.size)}}class nk extends hI{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),G.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e){this.persistence=e,this.Nr=new Fs(t=>Ro(t),Yu),this.lastRemoteSnapshotVersion=Me.min(),this.highestTargetId=0,this.Lr=0,this.Br=new km,this.targetCount=0,this.kr=Vo.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),G.resolve()}getLastRemoteSnapshotVersion(e){return G.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return G.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),G.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),G.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Vo(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,G.resolve()}updateTargetData(e,t){return this.Kn(t),G.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,G.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),G.waitFor(i).next(()=>s)}getTargetCount(e){return G.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return G.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),G.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),G.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),G.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return G.resolve(r)}containsKey(e,t){return G.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e,t){this.qr={},this.overlays={},this.Qr=new or(0),this.Kr=!1,this.Kr=!0,this.$r=new ZC,this.referenceDelegate=e(this),this.Ur=new rk(this),this.indexManager=new BC,this.remoteDocumentCache=function(s){return new tk(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new rI(t),this.Gr=new YC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new XC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new ek(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){de("MemoryPersistence","Starting transaction:",e);const s=new sk(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return G.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class sk extends nw{constructor(e){super(),this.currentSequenceNumber=e}}class Ah{constructor(e){this.persistence=e,this.Jr=new km,this.Yr=null}static Zr(e){return new Ah(e)}get Xr(){if(this.Yr)return this.Yr;throw Re()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),G.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),G.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),G.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return G.forEach(this.Xr,r=>{const s=Ae.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Me.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return G.or([()=>G.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Bd{constructor(e,t){this.persistence=e,this.ti=new Fs(r=>jn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=dI(this,t)}static Zr(e,t){return new Bd(e,t)}zr(){}jr(e){return G.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return G.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?G.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Me.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),G.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),G.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),G.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),G.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ud(e.data.value)),t}nr(e,t,r){return G.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return G.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ik{constructor(e){this.serializer=e}O(e,t,r,s){const i=new vh("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yy,{unique:!0}),l.createObjectStore("documentMutations")}(e),i_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=G.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),i_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Me.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",yy,{unique:!0});const f=c.store("mutations"),g=d.map(y=>f.put(y));return G.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:qR});c.createIndex("collectionPathOverlayIndex",zR,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",KR,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:DR});c.createIndex("documentKeyIndex",NR),c.createIndex("collectionGroupIndex",VR)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:$R}).createIndex("sequenceNumberIndex",UR,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:jR}).createIndex("documentKeyIndex",BR,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=jd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>G.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>G.forEach(a,l=>{Ce(l.userId===i.userId);const c=go(this.serializer,l);return aI(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new it(o),c=function(f){return[0,jn(f)]}(l);i.push(t.get(c).next(d=>d?G.resolve():(f=>t.put({targetId:0,path:jn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>G.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:FR});const r=t.store("collectionParents"),s=new Cm,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:jn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new it(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=Jr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Zl(s),o=sI(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Ae(it.fromString(f.document.name).popFirst(5)):f.noDocument?Ae.fromSegments(f.noDocument.path):f.unknownDocument?Ae.fromSegments(f.unknownDocument.path):Re()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>G.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=fI(this.serializer),i=new Dm(Ah.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:Ye();go(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),G.forEach(a,(l,c)=>{const d=new In(c),f=Th.lt(this.serializer,d),g=i.getIndexManager(d),y=xh.lt(d,this.serializer,g,i.referenceDelegate);return new pI(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new fp(t,or.oe),l).next()})})}}function i_(n){n.createObjectStore("targetDocuments",{keyPath:MR}).createIndex("documentTargetsIndex",LR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",OR,{unique:!0}),n.createObjectStore("targetGlobal")}const kf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Nm{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Nm.D())throw new he(H.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new HC(this,s),this.Ai=t+"main",this.serializer=new rI(l),this.Ri=new es(this.Ai,this.hi,new ik(this.serializer)),this.$r=new MC,this.Ur=new zC(this.referenceDelegate,this.serializer),this.remoteDocumentCache=fI(this.serializer),this.Gr=new OC,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&sn("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new he(H.FAILED_PRECONDITION,kf);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new or(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Wc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if($i(e))return de("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return de("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return zl(e).get("owner").next(t=>G.resolve(this.vi(t)))}Ci(e){return Wc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=yn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return G.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?G.resolve(!0):zl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new he(H.FAILED_PRECONDITION,kf);return!1}}return!(!this.networkEnabled||!this.inForeground)||Wc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&de("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new fp(e,or.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Wc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return xh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new qC(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Th.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){de("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?WR:l===16?HR:l===15?vm:l===14?lw:l===13?aw:l===12?GR:l===11?ow:void Re()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new fp(a,this.Qr?this.Qr.next():or.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw sn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new he(H.FAILED_PRECONDITION,tw);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return zl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new he(H.FAILED_PRECONDITION,kf)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return zl(e).put("owner",t)}static D(){return es.D()}bi(e){const t=zl(e);return t.get("owner").next(r=>this.vi(r)?(de("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):G.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(sn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Mb()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return de("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return sn("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){sn("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function zl(n){return yn(n,"owner")}function Wc(n){return yn(n,"clientMetadata")}function Vm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Ye(),s=Ye();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Om(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Mb()?8:rw(vn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new ok;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(ga()<=st.DEBUG&&de("QueryEngine","SDK will not create cache indexes for query:",va(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),G.resolve()):(ga()<=st.DEBUG&&de("QueryEngine","Query:",va(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(ga()<=st.DEBUG&&de("QueryEngine","The SDK decides to create cache indexes for query:",va(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Bn(t))):G.resolve())}Yi(e,t){if(ky(t))return G.resolve(null);let r=Bn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Ld(t,null,"F"),r=Bn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ye(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,Ld(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return ky(t)||s.isEqual(Me.min())?G.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?G.resolve(null):(ga()<=st.DEBUG&&de("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),va(t)),this.rs(e,o,t,Zb(s,-1)).next(a=>a))})}ts(e,t){let r=new Pt(Sw(e));return t.forEach((s,i)=>{Zu(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return ga()<=st.DEBUG&&de("QueryEngine","Using full collection scan to execute query:",va(t)),this.Ji.getDocumentsMatchingQuery(e,t,pr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Mt(ze),this._s=new Fs(i=>Ro(i),Yu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new pI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function gI(n,e,t,r){return new ak(n,e,t,r)}async function vI(n,e){const t=Ee(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Ye();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function lk(n,e){const t=Ee(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,g=f.keys();let y=G.resolve();return g.forEach(T=>{y=y.next(()=>d.getEntry(l,T)).next(A=>{const P=c.docVersions.get(T);Ce(P!==null),A.version.compareTo(P)<0&&(f.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),d.addEntry(A)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Ye();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function yI(n){const e=Ee(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function uk(n,e){const t=Ee(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(en.EMPTY_BYTE_STRING,Me.min()).withLastLimboFreeSnapshotVersion(Me.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(A,P,U){return A.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(g,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=lr(),c=Ye();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(_I(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(Me.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return G.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function _I(n,e,t){let r=Ye(),s=Ye();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=lr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Me.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):de("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function ck(n,e){const t=Ee(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function za(n,e){const t=Ee(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,G.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new ws(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Ka(n,e,t){const r=Ee(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!$i(o))throw o;de("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function qd(n,e,t){const r=Ee(n);let s=Me.min(),i=Ye();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=Ee(l),g=f._s.get(d);return g!==void 0?G.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,Bn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Me.min(),t?i:Ye())).next(a=>(II(r,Aw(e),a),{documents:a,Ts:i})))}function bI(n,e){const t=Ee(n),r=Ee(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function wI(n,e){const t=Ee(n),r=t.us.get(e)||Me.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,Zb(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(II(t,e,s),s))}function II(n,e,t){let r=n.us.get(e)||Me.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function dk(n,e,t,r){const s=Ee(n);let i=Ye(),o=lr();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await za(s,function(d){return Bn(il(it.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>_I(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function hk(n,e,t=Ye()){const r=await za(n,Bn(Pm(e.bundledQuery))),s=Ee(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=an(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(en.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function o_(n,e){return`firestore_clients_${n}_${e}`}function a_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Df(n,e){return`firestore_targets_${n}_${e}`}class zd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new he(s.error.code,s.error.message))),o?new zd(e,t,s.state,i):(sn("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class mu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new he(r.error.code,r.error.message))),i?new mu(e,r.state,s):(sn("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=bm();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=sw(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Kd(e,i):(sn("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Mm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Mm(t.clientId,t.onlineState):(sn("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Sp{constructor(){this.activeTargetIds=bm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Nf{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Mt(ze),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=o_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Sp),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(o_(this.persistenceKey,r));if(s){const i=Kd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Df(this.persistenceKey,e));if(s){const i=mu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Df(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return de("SharedClientState","READ",e,t),t}setItem(e,t){de("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){de("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(de("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void sn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=or.oe;if(i!=null)try{const a=JSON.parse(i);Ce(typeof a=="number"),o=a}catch(a){sn("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==or.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new zd(this.currentUser,e,t,r),i=a_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=a_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Df(this.persistenceKey,e),i=new mu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Kd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return zd.Rs(new In(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return mu.Rs(s,t)}Ls(e){return Mm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);de("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=bm();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class EI{constructor(){this.so=new Sp,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Sp,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){de("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){de("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qc=null;function Vf(){return Qc===null?Qc=function(){return 268435456+Math.round(2147483648*Math.random())}():Qc++,"0x"+Qc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On="WebChannelConnection";class gk extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Vf(),l=this.xo(t,r.toUriEncodedString());de("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(de("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw xr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+sl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=pk[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Vf();return new Promise((o,a)=>{const l=new zb;l.setWithCredentials(!0),l.listenOnce(Kb.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case od.NO_ERROR:const d=l.getResponseJson();de(On,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case od.TIMEOUT:de(On,`RPC '${e}' ${i} timed out`),a(new he(H.DEADLINE_EXCEEDED,"Request time out"));break;case od.HTTP_ERROR:const f=l.getStatus();if(de(On,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const T=function(P){const U=P.toLowerCase().replace(/_/g,"-");return Object.values(H).indexOf(U)>=0?U:H.UNKNOWN}(y.status);a(new he(T,y.message))}else a(new he(H.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new he(H.UNAVAILABLE,"Connection failed."));break;default:Re()}}finally{de(On,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);de(On,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Vf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Wb(),a=Hb(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");de(On,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,y=!1;const T=new mk({Io:P=>{y?de(On,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(g||(de(On,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),de(On,`RPC '${e}' stream ${s} sending:`,P),f.send(P))},To:()=>f.close()}),A=(P,U,q)=>{P.listen(U,L=>{try{q(L)}catch(z){setTimeout(()=>{throw z},0)}})};return A(f,Jl.EventType.OPEN,()=>{y||(de(On,`RPC '${e}' stream ${s} transport opened.`),T.yo())}),A(f,Jl.EventType.CLOSE,()=>{y||(y=!0,de(On,`RPC '${e}' stream ${s} transport closed`),T.So())}),A(f,Jl.EventType.ERROR,P=>{y||(y=!0,xr(On,`RPC '${e}' stream ${s} transport errored:`,P),T.So(new he(H.UNAVAILABLE,"The operation could not be completed")))}),A(f,Jl.EventType.MESSAGE,P=>{var U;if(!y){const q=P.data[0];Ce(!!q);const L=q,z=L.error||((U=L[0])===null||U===void 0?void 0:U.error);if(z){de(On,`RPC '${e}' stream ${s} received error:`,z);const fe=z.status;let me=function(w){const C=fn[w];if(C!==void 0)return jw(C)}(fe),x=z.message;me===void 0&&(me=H.INTERNAL,x="Unknown error status: "+fe+" with message "+z.message),y=!0,T.So(new he(me,x)),f.close()}else de(On,`RPC '${e}' stream ${s} received:`,q),T.bo(q)}}),A(a,Gb.STAT_EVENT,P=>{P.stat===dp.PROXY?de(On,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===dp.NOPROXY&&de(On,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{T.wo()},0),T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TI(){return typeof window<"u"?window:null}function fd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(n){return new TC(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lm{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&de("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Lm(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===H.RESOURCE_EXHAUSTED?(sn(t.toString()),sn("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===H.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new he(H.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return de("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(de("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class vk extends xI{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=SC(this.serializer,e),r=function(i){if(!("targetChange"in i))return Me.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Me.min():o.readTime?an(o.readTime):Me.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Ip(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Od(l)?{documents:Yw(i,l)}:{query:Eh(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Kw(i,o.resumeToken);const c=bp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Me.min())>0){a.readTime=qa(i,o.snapshotVersion.toTimestamp());const c=bp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=RC(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Ip(this.serializer),t.removeTarget=e,this.a_(t)}}class yk extends xI{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Ce(!!e.streamToken),this.lastStreamToken=e.streamToken,Ce(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ce(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=PC(e.writeResults,e.commitTime),r=an(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Ip(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Nu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new he(H.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,wp(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new he(H.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,wp(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new he(H.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class bk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(sn(t),this.D_=!1):de("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{ji(this)&&(de("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Ee(l);c.L_.add(4),await ll(c),c.q_.set("Unknown"),c.L_.delete(4),await sc(c)}(this))})}),this.q_=new bk(r,s)}}async function sc(n){if(ji(n))for(const e of n.B_)await e(!0)}async function ll(n){for(const e of n.B_)await e(!1)}function Sh(n,e){const t=Ee(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Um(t)?$m(t):cl(t).r_()&&Fm(t,e))}function Ga(n,e){const t=Ee(n),r=cl(t);t.N_.delete(e),r.r_()&&AI(t,e),t.N_.size===0&&(r.r_()?r.o_():ji(t)&&t.q_.set("Unknown"))}function Fm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Me.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}cl(n).A_(e)}function AI(n,e){n.Q_.xe(e),cl(n).R_(e)}function $m(n){n.Q_=new bC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),cl(n).start(),n.q_.v_()}function Um(n){return ji(n)&&!cl(n).n_()&&n.N_.size>0}function ji(n){return Ee(n).L_.size===0}function SI(n){n.Q_=void 0}async function Ik(n){n.q_.set("Online")}async function Ek(n){n.N_.forEach((e,t)=>{Fm(n,e)})}async function Tk(n,e){SI(n),Um(n)?(n.q_.M_(e),$m(n)):n.q_.set("Unknown")}async function xk(n,e,t){if(n.q_.set("Online"),e instanceof zw&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){de("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Gd(n,r)}else if(e instanceof hd?n.Q_.Ke(e):e instanceof qw?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Me.min()))try{const r=await yI(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(en.EMPTY_BYTE_STRING,d.snapshotVersion)),AI(i,l);const f=new ws(d.target,l,c,d.sequenceNumber);Fm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){de("RemoteStore","Failed to raise snapshot:",r),await Gd(n,r)}}async function Gd(n,e,t){if(!$i(e))throw e;n.L_.add(1),await ll(n),n.q_.set("Offline"),t||(t=()=>yI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{de("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await sc(n)})}function PI(n,e){return e().catch(t=>Gd(n,t,e))}async function ul(n){const e=Ee(n),t=Di(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Ak(e);)try{const s=await ck(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,Sk(e,s)}catch(s){await Gd(e,s)}RI(e)&&CI(e)}function Ak(n){return ji(n)&&n.O_.length<10}function Sk(n,e){n.O_.push(e);const t=Di(n);t.r_()&&t.V_&&t.m_(e.mutations)}function RI(n){return ji(n)&&!Di(n).n_()&&n.O_.length>0}function CI(n){Di(n).start()}async function Pk(n){Di(n).p_()}async function Rk(n){const e=Di(n);for(const t of n.O_)e.m_(t.mutations)}async function Ck(n,e,t){const r=n.O_.shift(),s=Tm.from(r,e,t);await PI(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await ul(n)}async function kk(n,e){e&&Di(n).V_&&await async function(r,s){if(function(o){return Uw(o)&&o!==H.ABORTED}(s.code)){const i=r.O_.shift();Di(r).s_(),await PI(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await ul(r)}}(n,e),RI(n)&&CI(n)}async function u_(n,e){const t=Ee(n);t.asyncQueue.verifyOperationInProgress(),de("RemoteStore","RemoteStore received new credentials");const r=ji(t);t.L_.add(3),await ll(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await sc(t)}async function Pp(n,e){const t=Ee(n);e?(t.L_.delete(2),await sc(t)):e||(t.L_.add(2),await ll(t),t.q_.set("Unknown"))}function cl(n){return n.K_||(n.K_=function(t,r,s){const i=Ee(t);return i.w_(),new vk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:Ik.bind(null,n),Ro:Ek.bind(null,n),mo:Tk.bind(null,n),d_:xk.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Um(n)?$m(n):n.q_.set("Unknown")):(await n.K_.stop(),SI(n))})),n.K_}function Di(n){return n.U_||(n.U_=function(t,r,s){const i=Ee(t);return i.w_(),new yk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Pk.bind(null,n),mo:kk.bind(null,n),f_:Rk.bind(null,n),g_:Ck.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await ul(n)):(await n.U_.stop(),n.O_.length>0&&(de("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new En,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new jm(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new he(H.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function dl(n,e){if(sn("AsyncQueue",`${e}: ${n}`),$i(n))return new he(H.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ae.comparator(t.key,r.key):(t,r)=>Ae.comparator(t.key,r.key),this.keyedMap=Yl(),this.sortedSet=new Mt(this.comparator)}static emptySet(e){return new Sa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Sa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(){this.W_=new Mt(Ae.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Re():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ha{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ha(e,t,Sa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Nk{constructor(){this.queries=d_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ee(t),i=s.queries;s.queries=d_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new he(H.ABORTED,"Firestore shutting down"))}}function d_(){return new Fs(n=>xw(n),Xu)}async function Bm(n,e){const t=Ee(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new Dk,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=dl(o,`Initialization of query '${va(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&zm(t)}async function qm(n,e){const t=Ee(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Vk(n,e){const t=Ee(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&zm(t)}function Ok(n,e,t){const r=Ee(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function zm(n){n.Y_.forEach(e=>{e.next()})}var Rp,h_;(h_=Rp||(Rp={})).ea="default",h_.Cache="cache";class Km{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ha(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ha.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Rp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(e){this.serializer=e}Es(e){return ts(this.serializer,e)}ds(e){return e.metadata.exists?Jw(this.serializer,e.document,!1):$t.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return an(e)}}class Lk{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=kI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=it.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new f_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ye()).add(i);t.set(o,a)}}return t}async complete(){const e=await dk(this.localStore,new f_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await hk(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function kI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DI{constructor(e){this.key=e}}class NI{constructor(e){this.key=e}}class VI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ye(),this.mutatedKeys=Ye(),this.Aa=Sw(e),this.Ra=new Sa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new c_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),y=Zu(this.query,f)?f:null,T=!!g&&this.mutatedKeys.has(g.key),A=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let P=!1;g&&y?g.data.isEqual(y.data)?T!==A&&(r.track({type:3,doc:y}),P=!0):this.ga(g,y)||(r.track({type:2,doc:y}),P=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),P=!0):g&&!y&&(r.track({type:1,doc:g}),P=!0,(l||c)&&(a=!0)),P&&(y?(o=o.add(y),i=A?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,T){const A=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Re()}};return A(y)-A(T)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Ha(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new c_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ye(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new NI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new DI(r))}),t}ba(e){this.Ta=e.Ts,this.da=Ye();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ha.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Fk{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class $k{constructor(e){this.key=e,this.va=!1}}class Uk{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Fs(a=>xw(a),Xu),this.Ma=new Map,this.xa=new Set,this.Oa=new Mt(Ae.comparator),this.Na=new Map,this.La=new km,this.Ba={},this.ka=new Map,this.qa=Vo.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function jk(n,e,t=!0){const r=Ph(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await OI(r,e,t,!0),s}async function Bk(n,e){const t=Ph(n);await OI(t,e,!0,!1)}async function OI(n,e,t,r){const s=await za(n.localStore,Bn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Gm(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Sh(n.remoteStore,s),a}async function Gm(n,e,t,r,s){n.Ka=(f,g,y)=>async function(A,P,U,q){let L=P.view.ma(U);L.ns&&(L=await qd(A.localStore,P.query,!1).then(({documents:x})=>P.view.ma(x,L)));const z=q&&q.targetChanges.get(P.targetId),fe=q&&q.targetMismatches.get(P.targetId)!=null,me=P.view.applyChanges(L,A.isPrimaryClient,z,fe);return Cp(A,P.targetId,me.wa),me.snapshot}(n,f,g,y);const i=await qd(n.localStore,e,!0),o=new VI(e,i.Ts),a=o.ma(i.documents),l=nc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Cp(n,t,c.wa);const d=new Fk(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function qk(n,e,t){const r=Ee(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Xu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ka(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Ga(r.remoteStore,s.targetId),Wa(r,s.targetId)}).catch(Fi)):(Wa(r,s.targetId),await Ka(r.localStore,s.targetId,!0))}async function zk(n,e){const t=Ee(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ga(t.remoteStore,r.targetId))}async function Kk(n,e,t){const r=Jm(n);try{const s=await function(o,a){const l=Ee(o),c=Qt.now(),d=a.reduce((y,T)=>y.add(T.key),Ye());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let T=lr(),A=Ye();return l.cs.getEntries(y,d).next(P=>{T=P,T.forEach((U,q)=>{q.isValidDocument()||(A=A.add(U))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,T)).next(P=>{f=P;const U=[];for(const q of a){const L=vC(q,f.get(q.key).overlayedDocument);L!=null&&U.push(new $s(q.key,L,pw(L.value.mapValue),Kt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,U,a)}).next(P=>{g=P;const U=P.applyToLocalDocumentSet(f,A);return l.documentOverlayCache.saveOverlays(y,P.batchId,U)})}).then(()=>({batchId:g.batchId,changes:Rw(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Mt(ze)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Us(r,s.changes),await ul(r.remoteStore)}catch(s){const i=dl(s,"Failed to persist write");t.reject(i)}}async function MI(n,e){const t=Ee(n);try{const r=await uk(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Ce(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ce(o.va):s.removedDocuments.size>0&&(Ce(o.va),o.va=!1))}),await Us(t,r,e)}catch(r){await Fi(r)}}function p_(n,e,t){const r=Ee(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ee(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&zm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Gk(n,e,t){const r=Ee(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Mt(Ae.comparator);o=o.insert(i,$t.newNoDocument(i,Me.min()));const a=Ye().add(i),l=new tc(Me.min(),new Map,new Mt(ze),o,a);await MI(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Qm(r)}else await Ka(r.localStore,e,!1).then(()=>Wa(r,e,t)).catch(Fi)}async function Hk(n,e){const t=Ee(n),r=e.batch.batchId;try{const s=await lk(t.localStore,e);Wm(t,r,null),Hm(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Us(t,s)}catch(s){await Fi(s)}}async function Wk(n,e,t){const r=Ee(n);try{const s=await function(o,a){const l=Ee(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Ce(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);Wm(r,e,t),Hm(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Us(r,s)}catch(s){await Fi(s)}}async function Qk(n,e){const t=Ee(n);ji(t.remoteStore)||de("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ee(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=dl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Hm(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Wm(n,e,t){const r=Ee(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Wa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||LI(n,r)})}function LI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Ga(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Qm(n))}function Cp(n,e,t){for(const r of t)r instanceof DI?(n.La.addReference(r.key,e),Jk(n,r)):r instanceof NI?(de("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||LI(n,r.key)):Re()}function Jk(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(de("SyncEngine","New document in limbo: "+t),n.xa.add(r),Qm(n))}function Qm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ae(it.fromString(e)),r=n.qa.next();n.Na.set(r,new $k(t)),n.Oa=n.Oa.insert(t,r),Sh(n.remoteStore,new ws(Bn(il(t.path)),r,"TargetPurposeLimboResolution",or.oe))}}async function Us(n,e,t){const r=Ee(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Om.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=Ee(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>G.forEach(c,g=>G.forEach(g.$i,y=>d.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>G.forEach(g.Ui,y=>d.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!$i(f))throw f;de("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=d.os.get(g),T=y.snapshotVersion,A=y.withLastLimboFreeSnapshotVersion(T);d.os=d.os.insert(g,A)}}}(r.localStore,i))}async function Yk(n,e){const t=Ee(n);if(!t.currentUser.isEqual(e)){de("SyncEngine","User change. New user:",e.toKey());const r=await vI(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new he(H.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Us(t,r.hs)}}function Xk(n,e){const t=Ee(n),r=t.Na.get(e);if(r&&r.va)return Ye().add(r.key);{let s=Ye();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function Zk(n,e){const t=Ee(n),r=await qd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Cp(t,e.targetId,s.wa),s}async function eD(n,e){const t=Ee(n);return wI(t.localStore,e).then(r=>Us(t,r))}async function tD(n,e,t,r){const s=Ee(n),i=await function(a,l){const c=Ee(a),d=Ee(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):G.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await ul(s.remoteStore):t==="acknowledged"||t==="rejected"?(Wm(s,e,r||null),Hm(s,e),function(a,l){Ee(Ee(a).mutationQueue).On(l)}(s.localStore,e)):Re(),await Us(s,i)):de("SyncEngine","Cannot apply mutation batch with id: "+e)}async function nD(n,e){const t=Ee(n);if(Ph(t),Jm(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await m_(t,r.toArray());t.Qa=!0,await Pp(t.remoteStore,!0);for(const i of s)Sh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Wa(t,o),Ka(t.localStore,o,!0))),Ga(t.remoteStore,o)}),await s,await m_(t,r),function(o){const a=Ee(o);a.Na.forEach((l,c)=>{Ga(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Mt(Ae.comparator)}(t),t.Qa=!1,await Pp(t.remoteStore,!1)}}async function m_(n,e,t){const r=Ee(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await za(r.localStore,Bn(l[0]));for(const c of l){const d=r.Fa.get(c),f=await Zk(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await bI(r.localStore,o);a=await za(r.localStore,c),await Gm(r,FI(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function FI(n){return Iw(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function rD(n){return function(t){return Ee(Ee(t).persistence).Qi()}(Ee(n).localStore)}async function sD(n,e,t,r){const s=Ee(n);if(s.Qa)return void de("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await wI(s.localStore,Aw(i[0])),a=tc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",en.EMPTY_BYTE_STRING);await Us(s,o,a);break}case"rejected":await Ka(s.localStore,e,!0),Wa(s,e,r);break;default:Re()}}async function iD(n,e,t){const r=Ph(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){de("SyncEngine","Adding an already active target "+s);continue}const i=await bI(r.localStore,s),o=await za(r.localStore,i);await Gm(r,FI(i),o.targetId,!1,o.resumeToken),Sh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Ka(r.localStore,s,!1).then(()=>{Ga(r.remoteStore,s),Wa(r,s)}).catch(Fi)}}function Ph(n){const e=Ee(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=MI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xk.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Gk.bind(null,e),e.Ca.d_=Vk.bind(null,e.eventManager),e.Ca.$a=Ok.bind(null,e.eventManager),e}function Jm(n){const e=Ee(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Hk.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Wk.bind(null,e),e}function oD(n,e,t){const r=Ee(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,T){const A=Ee(y),P=an(T.createTime);return A.persistence.runTransaction("hasNewerBundle","readonly",U=>A.Gr.getBundleMetadata(U,T.id)).then(U=>!!U&&U.createTime.compareTo(P)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(kI(l));const c=new Lk(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await Us(i,f.Ia,void 0),await function(y,T){const A=Ee(y);return A.persistence.runTransaction("Save bundle","readwrite",P=>A.Gr.saveBundleMetadata(P,T))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return xr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Ni{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=rc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return gI(this.persistence,new mI,e.initialUser,this.serializer)}Ga(e){return new Dm(Ah.Zr,this.serializer)}Wa(e){return new EI}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ni.provider={build:()=>new Ni};class aD extends Ni{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Ce(this.persistence.referenceDelegate instanceof Bd);const r=this.persistence.referenceDelegate.garbageCollector;return new cI(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?Ln.withCacheSize(this.cacheSizeBytes):Ln.DEFAULT;return new Dm(r=>Bd.Zr(r,t),this.serializer)}}class Ym extends Ni{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Jm(this.Ja.syncEngine),await ul(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return gI(this.persistence,new mI,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new cI(r,e.asyncQueue,t)}Ha(e,t){const r=new RR(t,this.persistence);return new PR(e.asyncQueue,r)}Ga(e){const t=Vm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ln.withCacheSize(this.cacheSizeBytes):Ln.DEFAULT;return new Nm(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,TI(),fd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new EI}}class $I extends Ym{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Nf&&(this.sharedClientState.syncEngine={no:tD.bind(null,t),ro:sD.bind(null,t),io:iD.bind(null,t),Qi:rD.bind(null,t),eo:eD.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await nD(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=TI();if(!Nf.D(t))throw new he(H.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Vm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Nf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Vi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>p_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Yk.bind(null,this.syncEngine),await Pp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Nk}()}createDatastore(e){const t=rc(e.databaseInfo.databaseId),r=function(i){return new gk(i)}(e.databaseInfo);return function(i,o,a,l){return new _k(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new wk(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>p_(this.syncEngine,t,0),function(){return l_.D()?new l_:new fk}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new Uk(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ee(s);de("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await ll(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Vi.provider={build:()=>new Vi};function g_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):sn("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new En,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new Mk(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uD{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new he(H.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ee(s),a={documents:i.map(f=>Du(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,it.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=AC(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());Ce(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new al(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ae.fromPath(r);this.mutations.push(new Im(s,this.precondition(s)))}),await async function(r,s){const i=Ee(r),o={writes:s.map(a=>Nu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,it.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Re();t=Me.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new he(H.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Me.min())?Kt.exists(!1):Kt.updateTime(t):Kt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Me.min()))throw new he(H.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Kt.updateTime(t)}return Kt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Lm(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new uD(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Ju(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Uw(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dD{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=In.UNAUTHENTICATED,this.clientId=Yb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{de("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(de("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new En;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=dl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Of(n,e){n.asyncQueue.verifyOperationInProgress(),de("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await vI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function v_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Xm(n);de("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>u_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>u_(e.remoteStore,s)),n._onlineComponents=e}async function Xm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){de("FirestoreClient","Using user provided OfflineComponentProvider");try{await Of(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===H.FAILED_PRECONDITION||s.code===H.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;xr("Error using user provided cache. Falling back to memory cache: "+t),await Of(n,new Ni)}}else de("FirestoreClient","Using default OfflineComponentProvider"),await Of(n,new Ni);return n._offlineComponents}async function Ch(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(de("FirestoreClient","Using user provided OnlineComponentProvider"),await v_(n,n._uninitializedComponentsProvider._online)):(de("FirestoreClient","Using default OnlineComponentProvider"),await v_(n,new Vi))),n._onlineComponents}function UI(n){return Xm(n).then(e=>e.persistence)}function hl(n){return Xm(n).then(e=>e.localStore)}function jI(n){return Ch(n).then(e=>e.remoteStore)}function Zm(n){return Ch(n).then(e=>e.syncEngine)}function BI(n){return Ch(n).then(e=>e.datastore)}async function Qa(n){const e=await Ch(n),t=e.eventManager;return t.onListen=jk.bind(null,e.syncEngine),t.onUnlisten=qk.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Bk.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=zk.bind(null,e.syncEngine),t}function hD(n){return n.asyncQueue.enqueue(async()=>{const e=await UI(n),t=await jI(n);return e.setNetworkEnabled(!0),function(s){const i=Ee(s);return i.L_.delete(0),sc(i)}(t)})}function fD(n){return n.asyncQueue.enqueue(async()=>{const e=await UI(n),t=await jI(n);return e.setNetworkEnabled(!1),async function(s){const i=Ee(s);i.L_.add(0),await ll(i),i.q_.set("Offline")}(t)})}function pD(n,e){const t=new En;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=Ee(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new he(H.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=dl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await hl(n),e,t)),t.promise}function qI(n,e,t={}){const r=new En;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Rh({next:g=>{d.Za(),o.enqueueAndForget(()=>qm(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new he(H.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new he(H.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Km(il(a.path),d,{includeMetadataChanges:!0,_a:!0});return Bm(i,f)}(await Qa(n),n.asyncQueue,e,t,r)),r.promise}function mD(n,e){const t=new En;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await qd(s,i,!0),l=new VI(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=dl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await hl(n),e,t)),t.promise}function zI(n,e,t={}){const r=new En;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Rh({next:g=>{d.Za(),o.enqueueAndForget(()=>qm(i,f)),g.fromCache&&l.source==="server"?c.reject(new he(H.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Km(a,d,{includeMetadataChanges:!0,_a:!0});return Bm(i,f)}(await Qa(n),n.asyncQueue,e,t,r)),r.promise}function gD(n,e,t){const r=new En;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await BI(n);r.resolve(async function(o,a,l){var c;const d=Ee(o),{request:f,ut:g,parent:y}=Xw(d.serializer,Ew(a),l);d.connection.Fo||delete f.parent;const T=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(P=>!!P.result);Ce(T.length===1);const A=(c=T[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(A).reduce((P,U)=>(P[g[U]]=A[U],P),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function vD(n,e){const t=new Rh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ee(s).Y_.add(i),i.next()}(await Qa(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ee(s).Y_.delete(i)}(await Qa(n),t))}}function yD(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?Bw().encode(o):o,function(d,f){return new lD(d,f)}(function(d,f){if(d instanceof Uint8Array)return g_(d,f);if(d instanceof ArrayBuffer)return g_(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,rc(e));n.asyncQueue.enqueueAndForget(async()=>{oD(await Zm(n),s,r)})}function _D(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ee(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await hl(n),e))}function bD(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ee(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,T,A){f=[...f],g=[...g],f.sort(y),g.sort(y);const P=f.length,U=g.length;let q=0,L=0;for(;q<U&&L<P;){const z=y(f[L],g[q]);z<0?A(f[L++]):z>0?T(g[q++]):(q++,L++)}for(;q<U;)T(g[q++]);for(;L<P;)A(f[L++])}(c,s,TR,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>G.waitFor(a)))}(await hl(n),e))}function wD(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ee(r).ss.zi=s}(await hl(n),e))}function ID(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ee(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await hl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KI(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(n,e,t){if(!t)throw new he(H.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ED(n,e,t,r){if(e===!0&&r===!0)throw new he(H.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function __(n){if(!Ae.isDocumentKey(n))throw new he(H.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function b_(n){if(Ae.isDocumentKey(n))throw new he(H.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function kh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Re()}function rt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new he(H.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=kh(n);throw new he(H.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function GI(n,e){if(e<=0)throw new he(H.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new he(H.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new he(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ED("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=KI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new he(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new he(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new he(H.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ic{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new w_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(H.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new he(H.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new w_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new gR;switch(r.type){case"firstParty":return new bR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new he(H.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=y_.get(t);r&&(de("ComponentProvider","Removing Datastore"),y_.delete(t),r.terminate())}(this),Promise.resolve()}}function TD(n,e,t,r={}){var s;const i=(n=rt(n,ic))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=In.MOCK_USER;else{a=G1(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new he(H.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new In(c)}n._authCredentials=new vR(new Qb(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Cn(this.firestore,e,this._query)}}class ln{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ns(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ln(this.firestore,e,this._key)}}class ns extends Cn{constructor(e,t,r){super(e,t,il(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ln(this.firestore,null,new Ae(e))}withConverter(e){return new ns(this.firestore,e,this._path)}}function Je(n,e,...t){if(n=Ne(n),eg("collection","path",e),n instanceof ic){const r=it.fromString(e,...t);return b_(r),new ns(n,null,r)}{if(!(n instanceof ln||n instanceof ns))throw new he(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return b_(r),new ns(n.firestore,null,r)}}function xj(n,e){if(n=rt(n,ic),eg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new he(H.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Cn(n,null,function(r){return new Ls(it.emptyPath(),r)}(e))}function xe(n,e,...t){if(n=Ne(n),arguments.length===1&&(e=Yb.newId()),eg("doc","path",e),n instanceof ic){const r=it.fromString(e,...t);return __(r),new ln(n,null,new Ae(r))}{if(!(n instanceof ln||n instanceof ns))throw new he(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return __(r),new ln(n.firestore,n instanceof ns?n.converter:null,new Ae(r))}}function Aj(n,e){return n=Ne(n),e=Ne(e),(n instanceof ln||n instanceof ns)&&(e instanceof ln||e instanceof ns)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function HI(n,e){return n=Ne(n),e=Ne(e),n instanceof Cn&&e instanceof Cn&&n.firestore===e.firestore&&Xu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Lm(this,"async_queue_retry"),this.Vu=()=>{const r=fd();r&&de("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=fd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=fd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new En;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!$i(e))throw e;de("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw sn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=jm.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Re()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function kp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class xD{constructor(){this._progressObserver={},this._taskCompletionResolver=new En,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sj=-1;class kt extends ic{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new I_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new I_(e),this._firestoreClient=void 0,await e}}}function Pj(n,e,t){t||(t="(default)");const r=Li(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Si(i,e))return s;throw new he(H.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new he(H.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new he(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function AD(n,e){const t=typeof n=="object"?n:fm(),r=typeof n=="string"?n:e||"(default)",s=Li(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=z1("firestore");i&&TD(s,...i)}return s}function Jt(n){if(n._terminated)throw new he(H.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||WI(n),n._firestoreClient}function WI(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new JR(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,KI(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new dD(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function SD(n,e){xr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return QI(n,Vi.provider,{build:r=>new Ym(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function Rj(n){xr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();QI(n,Vi.provider,{build:t=>new $I(t,e.cacheSizeBytes)})}function QI(n,e,t){if((n=rt(n,kt))._firestoreClient||n._terminated)throw new he(H.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new he(H.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},WI(n)}function Cj(n){if(n._initialized&&!n._terminated)throw new he(H.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new En;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!es.D())return Promise.resolve();const s=r+"main";await es.delete(s)}(Vm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function kj(n){return function(t){const r=new En;return t.asyncQueue.enqueueAndForget(async()=>Qk(await Zm(t),r)),r.promise}(Jt(n=rt(n,kt)))}function Dj(n){return hD(Jt(n=rt(n,kt)))}function Nj(n){return fD(Jt(n=rt(n,kt)))}function Vj(n){return nR(n.app,"firestore",n._databaseId.database),n._delete()}function Oj(n,e){const t=Jt(n=rt(n,kt)),r=new xD;return yD(t,n._databaseId,e,r),r}function Mj(n,e){return _D(Jt(n=rt(n,kt)),e).then(t=>t?new Cn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vu{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class PD{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Oo(en.fromBase64String(e))}catch(t){throw new he(H.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Oo(en.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new he(H.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function Lj(){return new Uo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new he(H.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new he(H.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ze(this._lat,e._lat)||ze(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RD=/^__.*__$/;class CD{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new $s(e,this.data,this.fieldMask,t,this.fieldTransforms):new ol(e,this.data,t,this.fieldTransforms)}}class JI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new $s(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function YI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Re()}}class Nh{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Nh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Hd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(YI(this.Cu)&&RD.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class kD{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||rc(e)}Qu(e,t,r,s=!1){return new Nh({Cu:e,methodName:t,qu:r,path:zt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bo(n){const e=n._freezeSettings(),t=rc(n._databaseId);return new kD(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Vh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);lg("Data must be an object, but it was:",o,r);const a=eE(r,o);let l,c;if(i.merge)l=new ar(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=Ou(e,f,t);if(!o.contains(g))throw new he(H.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);nE(d,g)||d.push(g)}l=new ar(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new CD(new Rn(a),l,c)}class oc extends jo{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof oc}}function XI(n,e,t){return new Nh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ng extends jo{_toFieldTransform(e){return new ec(e.path,new ja)}isEqual(e){return e instanceof ng}}class rg extends jo{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=XI(this,e,!0),r=this.Ku.map(i=>qo(i,t)),s=new Co(r);return new ec(e.path,s)}isEqual(e){return e instanceof rg&&Si(this.Ku,e.Ku)}}class sg extends jo{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=XI(this,e,!0),r=this.Ku.map(i=>qo(i,t)),s=new ko(r);return new ec(e.path,s)}isEqual(e){return e instanceof sg&&Si(this.Ku,e.Ku)}}class ig extends jo{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Ba(e.serializer,Dw(e.serializer,this.$u));return new ec(e.path,t)}isEqual(e){return e instanceof ig&&this.$u===e.$u}}function og(n,e,t,r){const s=n.Qu(1,e,t);lg("Data must be an object, but it was:",s,r);const i=[],o=Rn.empty();Ui(r,(l,c)=>{const d=Oh(e,l,t);c=Ne(c);const f=s.Nu(d);if(c instanceof oc)i.push(d);else{const g=qo(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new ar(i);return new JI(o,a,s.fieldTransforms)}function ag(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Ou(e,r,t)],l=[s];if(i.length%2!=0)throw new he(H.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(Ou(e,i[g])),l.push(i[g+1]);const c=[],d=Rn.empty();for(let g=a.length-1;g>=0;--g)if(!nE(c,a[g])){const y=a[g];let T=l[g];T=Ne(T);const A=o.Nu(y);if(T instanceof oc)c.push(y);else{const P=qo(T,A);P!=null&&(c.push(y),d.set(y,P))}}const f=new ar(c);return new JI(d,f,o.fieldTransforms)}function ZI(n,e,t,r=!1){return qo(t,n.Qu(r?4:3,e))}function qo(n,e){if(tE(n=Ne(n)))return lg("Unsupported field value:",e,n),eE(n,e);if(n instanceof jo)return function(r,s){if(!YI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=qo(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Dw(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Qt.fromDate(r);return{timestampValue:qa(s.serializer,i)}}if(r instanceof Qt){const i=new Qt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:qa(s.serializer,i)}}if(r instanceof tg)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Oo)return{bytesValue:Kw(s.serializer,r._byteString)};if(r instanceof ln){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Sm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Dh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return wm(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${kh(r)}`)}(n,e)}function eE(n,e){const t={};return cw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ui(n,(r,s)=>{const i=qo(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function tE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Qt||n instanceof tg||n instanceof Oo||n instanceof ln||n instanceof jo||n instanceof Dh)}function lg(n,e,t){if(!tE(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=kh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Ou(n,e,t){if((e=Ne(e))instanceof Uo)return e._internalPath;if(typeof e=="string")return Oh(n,e);throw Hd("Field path arguments must be of type string or ",n,!1,void 0,t)}const DD=new RegExp("[~\\*/\\[\\]]");function Oh(n,e,t){if(e.search(DD)>=0)throw Hd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Uo(...e.split("."))._internalPath}catch{throw Hd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Hd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new he(H.INVALID_ARGUMENT,a+n+l)}function nE(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ln(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ND(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Mh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ND extends Mu{data(){return super.data()}}function Mh(n,e){return typeof e=="string"?Oh(n,e):e instanceof Uo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new he(H.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ug{}class ac extends ug{}function Lu(n,e,...t){let r=[];e instanceof ug&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof fl).length,a=i.filter(l=>l instanceof lc).length;if(o>1||o>0&&a>0)throw new he(H.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class lc extends ac{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new lc(e,t,r)}_apply(e){const t=this._parse(e);return iE(e._query,t),new Cn(e.firestore,e.converter,_p(e._query,t))}_parse(e){const t=Bo(e.firestore);return function(i,o,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new he(H.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){T_(f,d);const y=[];for(const T of f)y.push(E_(l,i,T));g={arrayValue:{values:y}}}else g=E_(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||T_(f,d),g=ZI(a,o,f,d==="in"||d==="not-in");return ot.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Wd(n,e,t){const r=e,s=Mh("where",n);return lc._create(s,r,t)}class fl extends ug{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new fl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Tt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)iE(o,l),o=_p(o,l)}(e._query,t),new Cn(e.firestore,e.converter,_p(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function Fj(...n){return n.forEach(e=>oE("or",e)),fl._create("or",n)}function $j(...n){return n.forEach(e=>oE("and",e)),fl._create("and",n)}class cg extends ac{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cg(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new he(H.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new he(H.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ku(i,o)}(e._query,this._field,this._direction);return new Cn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ls(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function VD(n,e="asc"){const t=e,r=Mh("orderBy",n);return cg._create(r,t)}class Lh extends ac{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Lh(e,t,r)}_apply(e){return new Cn(e.firestore,e.converter,Ld(e._query,this._limit,this._limitType))}}function Uj(n){return GI("limit",n),Lh._create("limit",n,"F")}function jj(n){return GI("limitToLast",n),Lh._create("limitToLast",n,"L")}class Fh extends ac{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Fh(e,t,r)}_apply(e){const t=sE(e,this.type,this._docOrFields,this._inclusive);return new Cn(e.firestore,e.converter,function(s,i){return new Ls(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function Bj(...n){return Fh._create("startAt",n,!0)}function qj(...n){return Fh._create("startAfter",n,!1)}class $h extends ac{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new $h(e,t,r)}_apply(e){const t=sE(e,this.type,this._docOrFields,this._inclusive);return new Cn(e.firestore,e.converter,function(s,i){return new Ls(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function zj(...n){return $h._create("endBefore",n,!1)}function Kj(...n){return $h._create("endAt",n,!0)}function sE(n,e,t,r){if(t[0]=Ne(t[0]),t[0]instanceof Mu)return function(i,o,a,l,c){if(!l)throw new he(H.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of Aa(i))if(f.field.isKeyField())d.push(Po(o,l.key));else{const g=l.data.field(f.field);if(yh(g))throw new he(H.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new he(H.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new ki(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Bo(n.firestore);return function(o,a,l,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new he(H.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let T=0;T<d.length;T++){const A=d[T];if(g[T].field.isKeyField()){if(typeof A!="string")throw new he(H.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!_m(o)&&A.indexOf("/")!==-1)throw new he(H.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const P=o.path.child(it.fromString(A));if(!Ae.isDocumentKey(P))throw new he(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${P}' is not because it contains an odd number of segments.`);const U=new Ae(P);y.push(Po(a,U))}else{const P=ZI(l,c,A);y.push(P)}}return new ki(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function E_(n,e,t){if(typeof(t=Ne(t))=="string"){if(t==="")throw new he(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!_m(e)&&t.indexOf("/")!==-1)throw new he(H.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(it.fromString(t));if(!Ae.isDocumentKey(r))throw new he(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Po(n,new Ae(r))}if(t instanceof ln)return Po(n,t._key);throw new he(H.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${kh(t)}.`)}function T_(n,e){if(!Array.isArray(n)||n.length===0)throw new he(H.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function iE(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new he(H.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new he(H.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function oE(n,e){if(!(e instanceof lc||e instanceof fl))throw new he(H.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class aE{convertValue(e,t="none"){switch(Ri(e)){case 0:return null;case 1:return e.booleanValue;case 2:return qt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ds(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Re()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ui(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>qt(o.doubleValue));return new Dh(i)}convertGeoPoint(e){return new tg(qt(e.latitude),qt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=_h(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Pu(e));default:return null}}convertTimestamp(e){const t=ks(e);return new Qt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=it.fromString(e);Ce(nI(r));const s=new So(r.get(1),r.get(3)),i=new Ae(r.popFirst(5));return s.isEqual(t)||sn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class OD extends aE{constructor(e){super(),this.firestore=e}convertBytes(e){return new Oo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ln(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gj(n){return new Vu("sum",Ou("sum",n))}function Hj(n){return new Vu("avg",Ou("average",n))}function MD(){return new Vu("count")}function Wj(n,e){var t,r;return n instanceof Vu&&e instanceof Vu&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function Qj(n,e){return HI(n.query,e.query)&&Si(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ja extends Mu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new pd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Mh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class pd extends Ja{data(e={}){return super.data(e)}}class Ya{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new _o(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new pd(this._firestore,this._userDataWriter,r.key,r,new _o(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new he(H.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new pd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new _o(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new pd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new _o(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:LD(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function LD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Re()}}function Jj(n,e){return n instanceof Ja&&e instanceof Ja?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ya&&e instanceof Ya&&n._firestore===e._firestore&&HI(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gt(n){n=rt(n,ln);const e=rt(n.firestore,kt);return qI(Jt(e),n._key).then(t=>dg(e,n,t))}class Bi extends aE{constructor(e){super(),this.firestore=e}convertBytes(e){return new Oo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ln(this.firestore,null,t)}}function Yj(n){n=rt(n,ln);const e=rt(n.firestore,kt),t=Jt(e),r=new Bi(e);return pD(t,n._key).then(s=>new Ja(e,r,n._key,s,new _o(s!==null&&s.hasLocalMutations,!0),n.converter))}function Xj(n){n=rt(n,ln);const e=rt(n.firestore,kt);return qI(Jt(e),n._key,{source:"server"}).then(t=>dg(e,n,t))}function wt(n){n=rt(n,Cn);const e=rt(n.firestore,kt),t=Jt(e),r=new Bi(e);return rE(n._query),zI(t,n._query).then(s=>new Ya(e,r,n,s))}function Zj(n){n=rt(n,Cn);const e=rt(n.firestore,kt),t=Jt(e),r=new Bi(e);return mD(t,n._query).then(s=>new Ya(e,r,n,s))}function eB(n){n=rt(n,Cn);const e=rt(n.firestore,kt),t=Jt(e),r=new Bi(e);return zI(t,n._query,{source:"server"}).then(s=>new Ya(e,r,n,s))}function Zt(n,e,t){n=rt(n,ln);const r=rt(n.firestore,kt),s=Uh(n.converter,e,t);return uc(r,[Vh(Bo(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Kt.none())])}function pl(n,e,t,...r){n=rt(n,ln);const s=rt(n.firestore,kt),i=Bo(s);let o;return o=typeof(e=Ne(e))=="string"||e instanceof Uo?ag(i,"updateDoc",n._key,e,t,r):og(i,"updateDoc",n._key,e),uc(s,[o.toMutation(n._key,Kt.exists(!0))])}function Xa(n){return uc(rt(n.firestore,kt),[new al(n._key,Kt.none())])}function ml(n,e){const t=rt(n.firestore,kt),r=xe(n),s=Uh(n.converter,e);return uc(t,[Vh(Bo(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Kt.exists(!1))]).then(()=>r)}function tB(n,...e){var t,r,s;n=Ne(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||kp(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(kp(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof ln)c=rt(n.firestore,kt),d=il(n._key.path),l={next:f=>{e[o]&&e[o](dg(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=rt(n,Cn);c=rt(f.firestore,kt),d=f._query;const g=new Bi(c);l={next:y=>{e[o]&&e[o](new Ya(c,g,f,y))},error:e[o+1],complete:e[o+2]},rE(n._query)}return function(g,y,T,A){const P=new Rh(A),U=new Km(y,P,T);return g.asyncQueue.enqueueAndForget(async()=>Bm(await Qa(g),U)),()=>{P.Za(),g.asyncQueue.enqueueAndForget(async()=>qm(await Qa(g),U))}}(Jt(c),d,a,l)}function nB(n,e){return vD(Jt(n=rt(n,kt)),kp(e)?e:{next:e})}function uc(n,e){return function(r,s){const i=new En;return r.asyncQueue.enqueueAndForget(async()=>Kk(await Zm(r),s,i)),i.promise}(Jt(n),e)}function dg(n,e,t){const r=t.docs.get(e._key),s=new Bi(n);return new Ja(n,s,e._key,r,new _o(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rB(n){return FD(n,{count:MD()})}function FD(n,e){const t=rt(n.firestore,kt),r=Jt(t),s=uw(e,(i,o)=>new $w(o,i.aggregateType,i._internalFieldPath));return gD(r,n._query,s).then(i=>function(a,l,c){const d=new Bi(a);return new PD(l,d,c)}(t,n,i))}class $D{constructor(e){this.kind="memory",this._onlineComponentProvider=Vi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Ni.provider}toJSON(){return{kind:this.kind}}}class UD{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=KD(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class jD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Ni.provider}toJSON(){return{kind:this.kind}}}class BD{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new aD(e)}}toJSON(){return{kind:this.kind}}}function sB(){return new jD}function iB(n){return new BD(n==null?void 0:n.cacheSizeBytes)}function oB(n){return new $D(n)}function aB(n){return new UD(n)}class qD{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vi.provider,this._offlineComponentProvider={build:t=>new Ym(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class zD{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vi.provider,this._offlineComponentProvider={build:t=>new $I(t,e==null?void 0:e.cacheSizeBytes)}}}function KD(n){return new qD(n==null?void 0:n.forceOwnership)}function lB(){return new zD}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Bo(e)}set(e,t,r){this._verifyNotCommitted();const s=fi(e,this._firestore),i=Uh(s.converter,t,r),o=Vh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Kt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=fi(e,this._firestore);let o;return o=typeof(t=Ne(t))=="string"||t instanceof Uo?ag(this._dataReader,"WriteBatch.update",i._key,t,r,s):og(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Kt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=fi(e,this._firestore);return this._mutations=this._mutations.concat(new al(t._key,Kt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new he(H.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function fi(n,e){if((n=Ne(n)).firestore!==e)throw new he(H.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WD extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Bo(t)}get(t){const r=fi(t,this._firestore),s=new OD(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Re();const o=i[0];if(o.isFoundDocument())return new Mu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Mu(this._firestore,s,r._key,null,r.converter);throw Re()})}set(t,r,s){const i=fi(t,this._firestore),o=Uh(i.converter,r,s),a=Vh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=fi(t,this._firestore);let a;return a=typeof(r=Ne(r))=="string"||r instanceof Uo?ag(this._dataReader,"Transaction.update",o._key,r,s,i):og(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=fi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=fi(e,this._firestore),r=new Bi(this._firestore);return super.get(e).then(s=>new Ja(this._firestore,r,t._key,s._document,new _o(!1,!1),t.converter))}}function cB(n,e,t){n=rt(n,kt);const r=Object.assign(Object.assign({},GD),t);return function(i){if(i.maxAttempts<1)throw new he(H.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new En;return i.asyncQueue.enqueueAndForget(async()=>{const c=await BI(i);new cD(i.asyncQueue,c,a,o,l).au()}),l.promise}(Jt(n),s=>e(new WD(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dB(){return new oc("deleteField")}function qi(){return new ng("serverTimestamp")}function QD(...n){return new rg("arrayUnion",n)}function hB(...n){return new sg("arrayRemove",n)}function fB(n){return new ig("increment",n)}function pB(n){return new Dh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hg(n){return Jt(n=rt(n,kt)),new HD(n,e=>uc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mB(n,e){const t=Jt(n=rt(n,kt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return xr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new he(H.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=x_(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Oh("setIndexConfiguration",x_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new To(g,2)):f.order==="ASCENDING"?d.push(new To(g,0)):f.order==="DESCENDING"&&d.push(new To(g,1))}a.push(new La(La.UNKNOWN_ID,c,d,Fa.empty()))}return a}(e);return bD(t,r)}function x_(n,e){if(typeof n[e]!="string")throw new he(H.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function gB(n){var e;n=rt(n,kt);const t=A_.get(n);if(t)return t;if(((e=Jt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new JD(n);return A_.set(n,r),r}function vB(n){lE(n,!0)}function yB(n){lE(n,!1)}function _B(n){ID(Jt(n._firestore)).then(e=>de("deleting all persistent cache indexes succeeded")).catch(e=>xr("deleting all persistent cache indexes failed",e))}function lE(n,e){wD(Jt(n._firestore),e).then(t=>de(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>xr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const A_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bB(n){var e;const t=(e=Jt(rt(n.firestore,kt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Eh(t,Bn(n._query))._t}function wB(n,e){var t;const r=uw(e,(i,o)=>new $w(o,i.aggregateType,i._internalFieldPath)),s=(t=Jt(rt(n.firestore,kt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:Xw(s,Ew(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IB{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return fg.instance.onExistenceFilterMismatch(e)}}class fg{constructor(){this.Uu=new Map}static get instance(){return Jc||(Jc=new fg,function(t){if(Fd)throw new Error("a TestingHooksSpi instance is already set");Fd=t}(Jc)),Jc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Jc=null;(function(e,t=!0){(function(s){sl=s})(rl),is(new Ur("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new kt(new yR(r.getProvider("auth-internal")),new wR(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new he(H.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new So(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Er(my,"4.7.3",e),Er(my,"4.7.3","esm2017")})();function pg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EB={PHONE:"phone",TOTP:"totp"},TB={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},xB={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},AB={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},SB={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YD(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function uE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const PB=YD,XD=uE,cE=new $o("auth","Firebase",uE()),RB={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qd=new dm("@firebase/auth");function ZD(n,...e){Qd.logLevel<=st.WARN&&Qd.warn(`Auth (${rl}): ${n}`,...e)}function md(n,...e){Qd.logLevel<=st.ERROR&&Qd.error(`Auth (${rl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ur(n,...e){throw gg(n,...e)}function Zn(n,...e){return gg(n,...e)}function mg(n,e,t){const r=Object.assign(Object.assign({},XD()),{[e]:t});return new $o("auth","Firebase",r).create(e,{appName:n.name})}function Tn(n){return mg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function gl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&ur(n,"argument-error"),mg(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function gg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return cE.create(n,...e)}function we(n,e,...t){if(!n)throw gg(e,...t)}function Xr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw md(e),new Error(e)}function Ns(n,e){n||Xr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function vg(){return S_()==="http:"||S_()==="https:"}function S_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(vg()||J1()||"connection"in navigator)?navigator.onLine:!0}function t2(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ns(t>e,"Short delay should be less than long delay!"),this.isMobile=H1()||Y1()}get(){return e2()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yg(n,e){Ns(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Xr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Xr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Xr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n2={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r2=new cc(3e4,6e4);function Ut(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function jt(n,e,t,r,s={}){return hE(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=nl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return Q1()||(c.referrerPolicy="no-referrer"),dE.fetch()(fE(n,n.config.apiHost,t,a),c)})}async function hE(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},n2),e);try{const s=new i2(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw eu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw eu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw eu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw eu(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw mg(n,d,c);ur(n,d)}}catch(s){if(s instanceof as)throw s;ur(n,"network-request-failed",{message:String(s)})}}async function js(n,e,t,r,s={}){const i=await jt(n,e,t,r,s);return"mfaPendingCredential"in i&&ur(n,"multi-factor-auth-required",{_serverResponse:i}),i}function fE(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?yg(n.config,s):`${n.config.apiScheme}://${s}`}function s2(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class i2{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Zn(this.auth,"network-request-failed")),r2.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function eu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Zn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P_(n){return n!==void 0&&n.getResponse!==void 0}function R_(n){return n!==void 0&&n.enterprise!==void 0}class pE{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return s2(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o2(n){return(await jt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function mE(n,e){return jt(n,"GET","/v2/recaptchaConfig",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a2(n,e){return jt(n,"POST","/v1/accounts:delete",e)}async function l2(n,e){return jt(n,"POST","/v1/accounts:update",e)}async function gE(n,e){return jt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CB(n,e=!1){return Ne(n).getIdToken(e)}async function u2(n,e=!1){const t=Ne(n),r=await t.getIdToken(e),s=jh(r);we(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:gu(Mf(s.auth_time)),issuedAtTime:gu(Mf(s.iat)),expirationTime:gu(Mf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Mf(n){return Number(n)*1e3}function jh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return md("JWT malformed, contained fewer than 3 sections"),null;try{const s=Db(t);return s?JSON.parse(s):(md("Failed to decode base64 JWT payload"),null)}catch(s){return md("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function C_(n){const e=jh(n);return we(e,"internal-error"),we(typeof e.exp<"u","internal-error"),we(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof as&&c2(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function c2({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=gu(this.lastLoginAt),this.creationTime=gu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $u(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Vs(n,gE(t,{idToken:r}));we(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?vE(i.providerUserInfo):[],a=f2(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Dp(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function h2(n){const e=Ne(n);await $u(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function f2(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function vE(n){return n.map(e=>{var{providerId:t}=e,r=pg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p2(n,e){const t=await hE(n,{},async()=>{const r=nl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=fE(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",dE.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function m2(n,e){return jt(n,"POST","/v2/accounts:revokeToken",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){we(e.idToken,"internal-error"),we(typeof e.idToken<"u","internal-error"),we(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):C_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){we(e.length!==0,"internal-error");const t=C_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(we(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await p2(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Pa;return r&&(we(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(we(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(we(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pa,this.toJSON())}_performRefresh(){return Xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oi(n,e){we(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Is{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=pg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new d2(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Dp(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Vs(this,this.stsTokenManager.getToken(this.auth,e));return we(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return u2(this,e)}reload(){return h2(this)}_assign(e){this!==e&&(we(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Is(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){we(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await $u(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(on(this.auth.app))return Promise.reject(Tn(this.auth));const e=await this.getIdToken();return await Vs(this,a2(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,T=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(a=t.tenantId)!==null&&a!==void 0?a:void 0,P=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,U=(c=t.createdAt)!==null&&c!==void 0?c:void 0,q=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:L,emailVerified:z,isAnonymous:fe,providerData:me,stsTokenManager:x}=t;we(L&&x,e,"internal-error");const I=Pa.fromJSON(this.name,x);we(typeof L=="string",e,"internal-error"),oi(f,e.name),oi(g,e.name),we(typeof z=="boolean",e,"internal-error"),we(typeof fe=="boolean",e,"internal-error"),oi(y,e.name),oi(T,e.name),oi(A,e.name),oi(P,e.name),oi(U,e.name),oi(q,e.name);const w=new Is({uid:L,auth:e,email:g,emailVerified:z,displayName:f,isAnonymous:fe,photoURL:T,phoneNumber:y,tenantId:A,stsTokenManager:I,createdAt:U,lastLoginAt:q});return me&&Array.isArray(me)&&(w.providerData=me.map(C=>Object.assign({},C))),P&&(w._redirectEventId=P),w}static async _fromIdTokenResponse(e,t,r=!1){const s=new Pa;s.updateFromServerResponse(t);const i=new Is({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await $u(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];we(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?vE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Pa;a.updateFromIdToken(r);const l=new Is({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Dp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k_=new Map;function Es(n){Ns(n instanceof Function,"Expected a class definition");let e=k_.get(n);return e?(Ns(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,k_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}yE.type="NONE";const D_=yE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gd(n,e,t){return`firebase:${n}:${e}:${t}`}class Ra{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=gd(this.userKey,s.apiKey,i),this.fullPersistenceKey=gd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Is._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ra(Es(D_),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Es(D_);const o=gd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=Is._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ra(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Ra(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(IE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_E(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(TE(e))return"Blackberry";if(xE(e))return"Webos";if(bE(e))return"Safari";if((e.includes("chrome/")||wE(e))&&!e.includes("edge/"))return"Chrome";if(EE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function _E(n=vn()){return/firefox\//i.test(n)}function bE(n=vn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function wE(n=vn()){return/crios\//i.test(n)}function IE(n=vn()){return/iemobile/i.test(n)}function EE(n=vn()){return/android/i.test(n)}function TE(n=vn()){return/blackberry/i.test(n)}function xE(n=vn()){return/webos/i.test(n)}function _g(n=vn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function g2(n=vn()){var e;return _g(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function v2(){return X1()&&document.documentMode===10}function AE(n=vn()){return _g(n)||EE(n)||xE(n)||TE(n)||/windows phone/i.test(n)||IE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SE(n,e=[]){let t;switch(n){case"Browser":t=N_(vn());break;case"Worker":t=`${N_(vn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${rl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y2{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _2(n,e={}){return jt(n,"GET","/v2/passwordPolicy",Ut(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b2=6;class w2{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:b2,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I2{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new V_(this),this.idTokenSubscription=new V_(this),this.beforeStateQueue=new y2(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=cE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Es(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ra.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await gE(this,{idToken:e}),r=await Is._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(on(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return we(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await $u(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=t2()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(on(this.app))return Promise.reject(Tn(this));const t=e?Ne(e):null;return t&&we(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&we(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return on(this.app)?Promise.reject(Tn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return on(this.app)?Promise.reject(Tn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Es(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await _2(this),t=new w2(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new $o("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await m2(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Es(e)||this._popupRedirectResolver;we(t,this,"argument-error"),this.redirectPersistenceManager=await Ra.create(this,[Es(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(we(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return we(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=SE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&ZD(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function tn(n){return Ne(n)}class V_{constructor(e){this.auth=e,this.observer=null,this.addObserver=sP(t=>this.observer=t)}get next(){return we(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function E2(n){dc=n}function bg(n){return dc.loadJS(n)}function T2(){return dc.recaptchaV2Script}function x2(){return dc.recaptchaEnterpriseScript}function A2(){return dc.gapiScript}function PE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const S2="recaptcha-enterprise",P2="NO_RECAPTCHA";class RE{constructor(e){this.type=S2,this.auth=tn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{mE(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new pE(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;R_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(P2)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&R_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=x2();l.length!==0&&(l+=a),bg(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function O_(n,e,t,r=!1){const s=new RE(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Uu(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await O_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await O_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function R2(n){const e=tn(n),t=await mE(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new pE(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new RE(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C2(n,e){const t=Li(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Si(i,e??{}))return s;ur(s,"already-initialized")}return t.initialize({options:e})}function k2(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Es);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function D2(n,e,t){const r=tn(n);we(r._canInitEmulator,r,"emulator-config-failed"),we(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=CE(e),{host:o,port:a}=N2(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||V2()}function CE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function N2(n){const e=CE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:M_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:M_(o)}}}function M_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function V2(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Xr("not implemented")}_getIdTokenResponse(e){return Xr("not implemented")}_linkToIdToken(e,t){return Xr("not implemented")}_getReauthenticationResolver(e){return Xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kE(n,e){return jt(n,"POST","/v1/accounts:resetPassword",Ut(n,e))}async function O2(n,e){return jt(n,"POST","/v1/accounts:update",e)}async function M2(n,e){return jt(n,"POST","/v1/accounts:signUp",e)}async function L2(n,e){return jt(n,"POST","/v1/accounts:update",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F2(n,e){return js(n,"POST","/v1/accounts:signInWithPassword",Ut(n,e))}async function Bh(n,e){return jt(n,"POST","/v1/accounts:sendOobCode",Ut(n,e))}async function $2(n,e){return Bh(n,e)}async function U2(n,e){return Bh(n,e)}async function j2(n,e){return Bh(n,e)}async function B2(n,e){return Bh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q2(n,e){return js(n,"POST","/v1/accounts:signInWithEmailLink",Ut(n,e))}async function z2(n,e){return js(n,"POST","/v1/accounts:signInWithEmailLink",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju extends hc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new ju(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ju(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Uu(e,t,"signInWithPassword",F2);case"emailLink":return q2(e,{email:this._email,oobCode:this._password});default:ur(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Uu(e,r,"signUpPassword",M2);case"emailLink":return z2(e,{idToken:t,email:this._email,oobCode:this._password});default:ur(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ss(n,e){return js(n,"POST","/v1/accounts:signInWithIdp",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2="http://localhost";class Os extends hc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Os(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ur("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=pg(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Os(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ss(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ss(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ss(e,t)}buildRequest(){const e={requestUri:K2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=nl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G2(n,e){return jt(n,"POST","/v1/accounts:sendVerificationCode",Ut(n,e))}async function H2(n,e){return js(n,"POST","/v1/accounts:signInWithPhoneNumber",Ut(n,e))}async function W2(n,e){const t=await js(n,"POST","/v1/accounts:signInWithPhoneNumber",Ut(n,e));if(t.temporaryProof)throw eu(n,"account-exists-with-different-credential",t);return t}const Q2={USER_NOT_FOUND:"user-not-found"};async function J2(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return js(n,"POST","/v1/accounts:signInWithPhoneNumber",Ut(n,t),Q2)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo extends hc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new xo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new xo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return H2(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return W2(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return J2(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new xo({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y2(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function X2(n){const e=Wl(Ql(n)).link,t=e?Wl(Ql(e)).deep_link_id:null,r=Wl(Ql(n)).deep_link_id;return(r?Wl(Ql(r)).link:null)||r||t||e||n}class fc{constructor(e){var t,r,s,i,o,a;const l=Wl(Ql(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=Y2((s=l.mode)!==null&&s!==void 0?s:null);we(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=X2(e);try{return new fc(t)}catch{return null}}}function kB(n){return fc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(){this.providerId=zo.PROVIDER_ID}static credential(e,t){return ju._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=fc.parseLink(t);return we(r,"argument-error"),ju._fromEmailAndCode(e,r.code,r.tenantId)}}zo.PROVIDER_ID="password";zo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";zo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl extends Bs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class vd extends vl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return we("providerId"in t&&"signInMethod"in t,"argument-error"),Os._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return we(e.idToken||e.accessToken,"argument-error"),Os._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return vd.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return vd.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new vd(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi extends vl{constructor(){super("facebook.com")}static credential(e){return Os._fromParams({providerId:pi.PROVIDER_ID,signInMethod:pi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pi.credentialFromTaggedObject(e)}static credentialFromError(e){return pi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pi.credential(e.oauthAccessToken)}catch{return null}}}pi.FACEBOOK_SIGN_IN_METHOD="facebook.com";pi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi extends vl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Os._fromParams({providerId:mi.PROVIDER_ID,signInMethod:mi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return mi.credentialFromTaggedObject(e)}static credentialFromError(e){return mi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return mi.credential(t,r)}catch{return null}}}mi.GOOGLE_SIGN_IN_METHOD="google.com";mi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi extends vl{constructor(){super("github.com")}static credential(e){return Os._fromParams({providerId:gi.PROVIDER_ID,signInMethod:gi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gi.credentialFromTaggedObject(e)}static credentialFromError(e){return gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gi.credential(e.oauthAccessToken)}catch{return null}}}gi.GITHUB_SIGN_IN_METHOD="github.com";gi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2="http://localhost";class Bu extends hc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ss(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ss(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ss(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Bu(r,i)}static _create(e,t){return new Bu(e,t)}buildRequest(){return{requestUri:Z2,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eN="saml.";class Np extends Bs{constructor(e){we(e.startsWith(eN),"argument-error"),super(e)}static credentialFromResult(e){return Np.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Np.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Bu.fromJSON(e);return we(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Bu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi extends vl{constructor(){super("twitter.com")}static credential(e,t){return Os._fromParams({providerId:vi.PROVIDER_ID,signInMethod:vi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return vi.credentialFromTaggedObject(e)}static credentialFromError(e){return vi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return vi.credential(t,r)}catch{return null}}}vi.TWITTER_SIGN_IN_METHOD="twitter.com";vi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DE(n,e){return js(n,"POST","/v1/accounts:signUp",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Is._fromIdTokenResponse(e,r,s),o=L_(r);return new Ar({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=L_(r);return new Ar({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function L_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tN(n){var e;if(on(n.app))return Promise.reject(Tn(n));const t=tn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Ar({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await DE(t,{returnSecureToken:!0}),s=await Ar._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd extends as{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Jd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Jd(e,t,r,s)}}function NE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Jd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VE(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DB(n,e){const t=Ne(n);await qh(!0,t,e);const{providerUserInfo:r}=await l2(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=VE(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function wg(n,e,t=!1){const r=await Vs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ar._forOperation(n,"link",r)}async function qh(n,e,t){await $u(e);const r=VE(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";we(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OE(n,e,t=!1){const{auth:r}=n;if(on(r.app))return Promise.reject(Tn(r));const s="reauthenticate";try{const i=await Vs(n,NE(r,s,e,n),t);we(i.idToken,r,"internal-error");const o=jh(i.idToken);we(o,r,"internal-error");const{sub:a}=o;return we(n.uid===a,r,"user-mismatch"),Ar._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ur(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ME(n,e,t=!1){if(on(n.app))return Promise.reject(Tn(n));const r="signIn",s=await NE(n,r,e),i=await Ar._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Ig(n,e){return ME(tn(n),e)}async function nN(n,e){const t=Ne(n);return await qh(!1,t,e.providerId),wg(t,e)}async function rN(n,e){return OE(Ne(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sN(n,e){return js(n,"POST","/v1/accounts:signInWithCustomToken",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NB(n,e){if(on(n.app))return Promise.reject(Tn(n));const t=tn(n),r=await sN(t,{token:e,returnSecureToken:!0}),s=await Ar._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Eg._fromServerResponse(e,t):"totpInfo"in t?Tg._fromServerResponse(e,t):ur(e,"internal-error")}}class Eg extends pc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Eg(t)}}class Tg extends pc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Tg(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zh(n,e,t){var r;we(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),we(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(we(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(we(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xg(n){const e=tn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function iN(n,e,t){const r=tn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&zh(r,s,t),await Uu(r,s,"getOobCode",U2)}async function oN(n,e,t){await kE(Ne(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&xg(n),r})}async function VB(n,e){await L2(Ne(n),{oobCode:e})}async function aN(n,e){const t=Ne(n),r=await kE(t,{oobCode:e}),s=r.requestType;switch(we(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":we(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":we(r.mfaInfo,t,"internal-error");default:we(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=pc._fromServerResponse(tn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function OB(n,e){const{data:t}=await aN(Ne(n),e);return t.email}async function lN(n,e,t){if(on(n.app))return Promise.reject(Tn(n));const r=tn(n),o=await Uu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",DE).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&xg(n),l}),a=await Ar._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function uN(n,e,t){return on(n.app)?Promise.reject(Tn(n)):Ig(Ne(n),zo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&xg(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MB(n,e,t){const r=tn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){we(a.handleCodeInApp,r,"argument-error"),a&&zh(r,o,a)}i(s,t),await Uu(r,s,"getOobCode",j2)}function LB(n,e){const t=fc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function FB(n,e,t){if(on(n.app))return Promise.reject(Tn(n));const r=Ne(n),s=zo.credentialWithLink(e,t||Fu());return we(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Ig(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cN(n,e){return jt(n,"POST","/v1/accounts:createAuthUri",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $B(n,e){const t=vg()?Fu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await cN(Ne(n),r);return s||[]}async function UB(n,e){const t=Ne(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&zh(t.auth,s,e);const{email:i}=await $2(t.auth,s);i!==n.email&&await n.reload()}async function jB(n,e,t){const r=Ne(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&zh(r.auth,i,t);const{email:o}=await B2(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dN(n,e){return jt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BB(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ne(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Vs(r,dN(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function hN(n,e){const t=Ne(n);return on(t.auth.app)?Promise.reject(Tn(t.auth)):LE(t,e,null)}function fN(n,e){return LE(Ne(n),null,e)}async function LE(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Vs(n,O2(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pN(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=jh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Ca(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new mN(i,s);case"github.com":return new gN(i,s);case"google.com":return new vN(i,s);case"twitter.com":return new yN(i,s,n.screenName||null);case"custom":case"anonymous":return new Ca(i,null);default:return new Ca(i,r,s)}}class Ca{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class FE extends Ca{constructor(e,t,r,s){super(e,t,r),this.username=s}}class mN extends Ca{constructor(e,t){super(e,"facebook.com",t)}}class gN extends FE{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class vN extends Ca{constructor(e,t){super(e,"google.com",t)}}class yN extends FE{constructor(e,t,r){super(e,"twitter.com",t,r)}}function qB(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:pN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _N(n,e){return Ne(n).setPersistence(e)}function zB(n){return R2(n)}async function KB(n,e){return tn(n).validatePassword(e)}function bN(n,e,t,r){return Ne(n).onIdTokenChanged(e,t,r)}function wN(n,e,t){return Ne(n).beforeAuthStateChanged(e,t)}function IN(n,e,t,r){return Ne(n).onAuthStateChanged(e,t,r)}function GB(n){Ne(n).useDeviceLanguage()}function HB(n,e){return Ne(n).updateCurrentUser(e)}function EN(n){return Ne(n).signOut()}function WB(n,e){return tn(n).revokeAccessToken(e)}async function QB(n){return Ne(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new bo("enroll",e,t)}static _fromMfaPendingCredential(e){return new bo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return bo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return bo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=tn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>pc._fromServerResponse(r,a));we(s.mfaPendingCredential,r,"internal-error");const o=bo._fromMfaPendingCredential(s.mfaPendingCredential);return new Ag(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await Ar._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return we(t.user,r,"internal-error"),Ar._forOperation(t.user,t.operationType,c);default:ur(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function JB(n,e){var t;const r=Ne(n),s=e;return we(e.customData.operationType,r,"argument-error"),we((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Ag._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TN(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:start",Ut(n,e))}function xN(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ut(n,e))}function AN(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:start",Ut(n,e))}function SN(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ut(n,e))}function PN(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ut(n,e))}class Sg{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>pc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Sg(e)}async getSession(){return bo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Vs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Vs(this.user,PN(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Lf=new WeakMap;function YB(n){const e=Ne(n);return Lf.has(e)||Lf.set(e,Sg._fromUser(e)),Lf.get(e)}const Yd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Yd,"1"),this.storage.removeItem(Yd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RN=1e3,CN=10;class UE extends $E{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=AE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);v2()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,CN):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},RN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}UE.type="LOCAL";const jE=UE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BE extends $E{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}BE.type="SESSION";const qE=BE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kN(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Kh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await kN(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Kh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Gh("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mn(){return window}function NN(n){mn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pg(){return typeof mn().WorkerGlobalScope<"u"&&typeof mn().importScripts=="function"}async function VN(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ON(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function MN(){return Pg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zE="firebaseLocalStorageDb",LN=1,Xd="firebaseLocalStorage",KE="fbase_key";class mc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Hh(n,e){return n.transaction([Xd],e?"readwrite":"readonly").objectStore(Xd)}function FN(){const n=indexedDB.deleteDatabase(zE);return new mc(n).toPromise()}function Vp(){const n=indexedDB.open(zE,LN);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Xd,{keyPath:KE})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Xd)?e(r):(r.close(),await FN(),e(await Vp()))})})}async function F_(n,e,t){const r=Hh(n,!0).put({[KE]:e,value:t});return new mc(r).toPromise()}async function $N(n,e){const t=Hh(n,!1).get(e),r=await new mc(t).toPromise();return r===void 0?null:r.value}function $_(n,e){const t=Hh(n,!0).delete(e);return new mc(t).toPromise()}const UN=800,jN=3;class GE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Vp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>jN)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Pg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Kh._getInstance(MN()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await VN(),!this.activeServiceWorker)return;this.sender=new DN(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ON()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Vp();return await F_(e,Yd,"1"),await $_(e,Yd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>F_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>$N(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>$_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Hh(s,!1).getAll();return new mc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),UN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}GE.type="LOCAL";const BN=GE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qN(n,e){return jt(n,"POST","/v2/accounts/mfaSignIn:start",Ut(n,e))}function zN(n,e){return jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Ut(n,e))}function KN(n,e){return jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GN=500,HN=6e4,Yc=1e12;class WN{constructor(e){this.auth=e,this.counter=Yc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new QN(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Yc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Yc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Yc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class QN{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;we(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=JN(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},HN)},GN))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function JN(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ff=PE("rcb"),YN=new cc(3e4,6e4);class XN{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=mn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return we(ZN(t),e,"argument-error"),this.shouldResolveImmediately(t)&&P_(mn().grecaptcha)?Promise.resolve(mn().grecaptcha):new Promise((r,s)=>{const i=mn().setTimeout(()=>{s(Zn(e,"network-request-failed"))},YN.get());mn()[Ff]=()=>{mn().clearTimeout(i),delete mn()[Ff];const a=mn().grecaptcha;if(!a||!P_(a)){s(Zn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${T2()}?${nl({onload:Ff,render:"explicit",hl:t})}`;bg(o).catch(()=>{clearTimeout(i),s(Zn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=mn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function ZN(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class eV{async load(e){return new WN(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HE="recaptcha",tV={theme:"light",type:"image"};class XB{constructor(e,t,r=Object.assign({},tV)){this.parameters=r,this.type=HE,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=tn(e),this.isInvisible=this.parameters.size==="invisible",we(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;we(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new eV:new XN,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){we(!this.parameters.sitekey,this.auth,"argument-error"),we(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),we(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=mn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){we(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){we(vg()&&!Pg(),this.auth,"internal-error"),await nV(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await o2(this.auth);we(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return we(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function nV(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=xo._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function ZB(n,e,t){if(on(n.app))return Promise.reject(Tn(n));const r=tn(n),s=await Wh(r,e,Ne(t));return new Rg(s,i=>Ig(r,i))}async function eq(n,e,t){const r=Ne(n);await qh(!1,r,"phone");const s=await Wh(r.auth,e,Ne(t));return new Rg(s,i=>nN(r,i))}async function tq(n,e,t){const r=Ne(n);if(on(r.auth.app))return Promise.reject(Tn(r.auth));const s=await Wh(r.auth,e,Ne(t));return new Rg(s,i=>rN(r,i))}async function Wh(n,e,t){var r;const s=await t.verify();try{we(typeof s=="string",n,"argument-error"),we(t.type===HE,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return we(o.type==="enroll",n,"internal-error"),(await TN(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{we(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return we(a,n,"missing-multi-factor-info"),(await qN(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await G2(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function nq(n,e){const t=Ne(n);if(on(t.auth.app))return Promise.reject(Tn(t.auth));await wg(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e){this.providerId=ka.PROVIDER_ID,this.auth=tn(e)}verifyPhoneNumber(e,t){return Wh(this.auth,e,Ne(t))}static credential(e,t){return xo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ka.credentialFromTaggedObject(t)}static credentialFromError(e){return ka.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?xo._fromTokenResponse(t,r):null}}ka.PROVIDER_ID="phone";ka.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(n,e){return e?Es(e):(we(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg extends hc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ss(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ss(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ss(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rV(n){return ME(n.auth,new Cg(n),n.bypassAuthState)}function sV(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),OE(t,new Cg(n),n.bypassAuthState)}async function iV(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),wg(t,new Cg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rV;case"linkViaPopup":case"linkViaRedirect":return iV;case"reauthViaPopup":case"reauthViaRedirect":return sV;default:ur(this.auth,"internal-error")}}resolve(e){Ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oV=new cc(2e3,1e4);async function rq(n,e,t){if(on(n.app))return Promise.reject(Zn(n,"operation-not-supported-in-this-environment"));const r=tn(n);gl(n,e,Bs);const s=Ko(r,t);return new Ts(r,"signInViaPopup",e,s).executeNotNull()}async function sq(n,e,t){const r=Ne(n);if(on(r.auth.app))return Promise.reject(Zn(r.auth,"operation-not-supported-in-this-environment"));gl(r.auth,e,Bs);const s=Ko(r.auth,t);return new Ts(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function iq(n,e,t){const r=Ne(n);gl(r.auth,e,Bs);const s=Ko(r.auth,t);return new Ts(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Ts extends WE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ts.currentPopupAction&&Ts.currentPopupAction.cancel(),Ts.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return we(e,this.auth,"internal-error"),e}async onExecution(){Ns(this.filter.length===1,"Popup operations only handle one event");const e=Gh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Zn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Zn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ts.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Zn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,oV.get())};e()}}Ts.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aV="pendingRedirect",yd=new Map;class lV extends WE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=yd.get(this.auth._key());if(!e){try{const r=await uV(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}yd.set(this.auth._key(),e)}return this.bypassAuthState||yd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function uV(n,e){const t=JE(e),r=QE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function kg(n,e){return QE(n)._set(JE(e),"true")}function cV(n,e){yd.set(n._key(),e)}function QE(n){return Es(n._redirectPersistence)}function JE(n){return gd(aV,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oq(n,e,t){return dV(n,e,t)}async function dV(n,e,t){if(on(n.app))return Promise.reject(Tn(n));const r=tn(n);gl(n,e,Bs),await r._initializationPromise;const s=Ko(r,t);return await kg(s,r),s._openRedirect(r,e,"signInViaRedirect")}function aq(n,e,t){return hV(n,e,t)}async function hV(n,e,t){const r=Ne(n);if(gl(r.auth,e,Bs),on(r.auth.app))return Promise.reject(Tn(r.auth));await r.auth._initializationPromise;const s=Ko(r.auth,t);await kg(s,r.auth);const i=await XE(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function lq(n,e,t){return fV(n,e,t)}async function fV(n,e,t){const r=Ne(n);gl(r.auth,e,Bs),await r.auth._initializationPromise;const s=Ko(r.auth,t);await qh(!1,r,e.providerId),await kg(s,r.auth);const i=await XE(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function uq(n,e){return await tn(n)._initializationPromise,YE(n,e,!1)}async function YE(n,e,t=!1){if(on(n.app))return Promise.reject(Tn(n));const r=tn(n),s=Ko(r,e),o=await new lV(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function XE(n){const e=Gh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pV=10*60*1e3;class mV{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!gV(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!ZE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Zn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=pV&&this.cachedEventUids.clear(),this.cachedEventUids.has(U_(e))}saveEventToCache(e){this.cachedEventUids.add(U_(e)),this.lastProcessedEventTime=Date.now()}}function U_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function ZE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function gV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ZE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vV(n,e={}){return jt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_V=/^https?/;async function bV(n){if(n.config.emulator)return;const{authorizedDomains:e}=await vV(n);for(const t of e)try{if(wV(t))return}catch{}ur(n,"unauthorized-domain")}function wV(n){const e=Fu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!_V.test(t))return!1;if(yV.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IV=new cc(3e4,6e4);function j_(){const n=mn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function EV(n){return new Promise((e,t)=>{var r,s,i;function o(){j_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{j_(),t(Zn(n,"network-request-failed"))},timeout:IV.get()})}if(!((s=(r=mn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=mn().gapi)===null||i===void 0)&&i.load)o();else{const a=PE("iframefcb");return mn()[a]=()=>{gapi.load?o():t(Zn(n,"network-request-failed"))},bg(`${A2()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw _d=null,e})}let _d=null;function TV(n){return _d=_d||EV(n),_d}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xV=new cc(5e3,15e3),AV="__/auth/iframe",SV="emulator/auth/iframe",PV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},RV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function CV(n){const e=n.config;we(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?yg(e,SV):`https://${n.config.authDomain}/${AV}`,r={apiKey:e.apiKey,appName:n.name,v:rl},s=RV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${nl(r).slice(1)}`}async function kV(n){const e=await TV(n),t=mn().gapi;return we(t,n,"internal-error"),e.open({where:document.body,url:CV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:PV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Zn(n,"network-request-failed"),a=mn().setTimeout(()=>{i(o)},xV.get());function l(){mn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},NV=500,VV=600,OV="_blank",MV="http://localhost";class B_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function LV(n,e,t,r=NV,s=VV){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},DV),{width:r.toString(),height:s.toString(),top:i,left:o}),c=vn().toLowerCase();t&&(a=wE(c)?OV:t),_E(c)&&(e=e||MV,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[y,T])=>`${g}${y}=${T},`,"");if(g2(c)&&a!=="_self")return FV(e||"",a),new B_(null);const f=window.open(e||"",a,d);we(f,n,"popup-blocked");try{f.focus()}catch{}return new B_(f)}function FV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $V="__/auth/handler",UV="emulator/auth/handler",jV=encodeURIComponent("fac");async function q_(n,e,t,r,s,i){we(n.config.authDomain,n,"auth-domain-config-required"),we(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:rl,eventId:s};if(e instanceof Bs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",rP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof vl){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${jV}=${encodeURIComponent(l)}`:"";return`${BV(n)}?${nl(a).slice(1)}${c}`}function BV({config:n}){return n.emulator?yg(n,UV):`https://${n.authDomain}/${$V}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f="webStorageSupport";class qV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=qE,this._completeRedirectFn=YE,this._overrideRedirectResult=cV}async _openPopup(e,t,r,s){var i;Ns((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await q_(e,t,r,Fu(),s);return LV(e,o,Gh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await q_(e,t,r,Fu(),s);return NN(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ns(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await kV(e),r=new mV(e);return t.register("authEvent",s=>(we(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send($f,{type:$f},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[$f];o!==void 0&&t(!!o),ur(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=bV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return AE()||bE()||_g()}}const zV=qV;class eT{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Xr("unexpected MultiFactorSessionType")}}}class Dg extends eT{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Dg(e)}_finalizeEnroll(e,t,r){return xN(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return zN(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class KV{constructor(){}static assertion(e){return Dg._fromCredential(e)}}KV.FACTOR_ID="phone";class GV{static assertionForEnrollment(e,t){return qu._fromSecret(e,t)}static assertionForSignIn(e,t){return qu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;we(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await AN(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Ng._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}GV.FACTOR_ID="totp";class qu extends eT{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new qu(t,void 0,e)}static _fromEnrollmentId(e,t){return new qu(t,e)}async _finalizeEnroll(e,t,r){return we(typeof this.secret<"u",e,"argument-error"),SN(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){we(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return KN(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Ng{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Ng(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Xc(e)||Xc(t))&&(s=!0),s&&(Xc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Xc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Xc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var z_="@firebase/auth",K_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){we(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function QV(n){is(new Ur("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;we(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:SE(n)},c=new I2(r,s,i,l);return k2(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),is(new Ur("auth-internal",e=>{const t=tn(e.getProvider("auth").getImmediate());return(r=>new HV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Er(z_,K_,WV(n)),Er(z_,K_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JV=5*60,YV=Ob("authIdTokenMaxAge")||JV;let G_=null;const XV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>YV)return;const s=t==null?void 0:t.token;G_!==s&&(G_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function ZV(n=fm()){const e=Li(n,"auth");if(e.isInitialized())return e.getImmediate();const t=C2(n,{popupRedirectResolver:zV,persistence:[BN,jE,qE]}),r=Ob("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=XV(i.toString());wN(t,o,()=>o(t.currentUser)),bN(t,a=>o(a))}}const s=Nb("auth");return s&&D2(t,`http://${s}`),t}function eO(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}E2({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Zn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",eO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});QV("Browser");const tO={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Qh=Ub(tO),ae=AD(Qh),gt=ZV(Qh);try{SD(ae)}catch{}try{_N(gt,jE)}catch{}IN(gt,n=>{n||tN(gt)});async function nO(n,e){try{return(await lN(gt,n,e)).user}catch(t){throw t}}async function tT(n,e){try{return(await uN(gt,n,e)).user}catch(t){throw t}}async function nT(n){try{await iN(gt,n)}catch(e){throw e}}async function rO(n){try{const e=gt.currentUser;if(e)await fN(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Ii=Object.freeze(Object.defineProperty({__proto__:null,app:Qh,auth:gt,createPlayerAccount:nO,db:ae,resetPlayerPassword:nT,signInPlayer:tT,updatePlayerPassword:rO},Symbol.toStringTag,{value:"Module"})),yl="seasons";async function sO(n,e,t){return await ml(Je(ae,yl),{name:n,slug:e,pinCode:t,createdAt:qi()})}async function iO(n){return await Xa(xe(ae,yl,n))}async function bd(){const n=Lu(Je(ae,yl),VD("createdAt","desc"));return(await wt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Zd(n,e){const t=await Gt(xe(ae,yl,n));return t.exists()?t.data().pinCode===e:!1}async function Op(n){const e=await Gt(xe(ae,yl,n));return e.exists()?e.data().pinCode:null}async function Kl(n,e){const t=xe(ae,yl,n);await pl(t,{sortOrder:e})}const oO=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function aO(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function rT(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function lO(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function sT(n){if(!n)return!1;const e=String(n).toLowerCase();return oO.some(t=>e.includes(t.toLowerCase()))}function Mp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?lO(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Mp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=sT(t)?"••••":Mp(r);return e}return n}function uO(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&sT(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Mp(r))}return e}const cO=rT(aO());function Zc(n,e){const t=rT(n);return(...r)=>{if(t<cO)return;const s=uO(r);console[e](...s)}}const le={debug:Zc("debug","log"),info:Zc("info","info"),warn:Zc("warn","warn"),error:Zc("error","error")},Vg="lastVisitedSeason",iT="lastVisitedSeasonTimestamp";async function dO(n){if(n)try{const e=gt.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(Vg,n),localStorage.setItem(iT,Date.now().toString())}catch(r){le.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=xe(ae,"userPreferences",t);await Zt(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),le.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){le.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){le.error("Erreur lors de la mémorisation de la saison",e)}}async function hO(){try{const n=gt.currentUser,e=n==null?void 0:n.email;if(e)try{const t=xe(ae,"userPreferences",e),r=await Gt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return le.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){le.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(Vg);if(t)return le.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){le.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return le.error("Erreur lors de la récupération de la dernière saison",n),null}}async function fO(n=null){var e;try{const t=n||((e=gt.currentUser)==null?void 0:e.email);try{localStorage.removeItem(Vg),localStorage.removeItem(iT)}catch(r){le.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=xe(ae,"userPreferences",t);await Zt(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),le.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){le.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){le.error("Erreur lors du nettoyage des préférences",t)}}function pO(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const mO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},gO={class:"text-center"},vO={class:"text-white text-lg"},yO={__name:"SeasonResolver",setup(n){const e=el(),t=k("Chargement...");return Xn(async()=>{try{t.value="Vérification de votre session...",await new Promise(o=>{const a=gt.onAuthStateChanged(l=>{a(),o(l)})});const r=gt.currentUser,s=r==null?void 0:r.email;if(!s){le.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const i=await hO();if(!i){le.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const o=await bd();if(!pO(i,o)){le.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await fO(s),e.replace("/seasons");return}}catch(o){le.error("Erreur lors de la vérification des saisons",o),e.replace("/seasons");return}le.info("Redirection vers la saison mémorisée",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){le.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(O(),F("div",mO,[h("div",gO,[s[0]||(s[0]=h("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),h("p",vO,ce(t.value),1)])]))}},Uf=7*24*60*60*1e3,Gl="impro_selector_pin_session";class _O{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Gl);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Uf){try{t.timestamp=Date.now(),localStorage.setItem(Gl,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Gl,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Uf;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Gl,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Gl),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Uf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const An=new _O,bO={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},wO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},IO={class:"text-center mb-6"},EO={class:"text-gray-300"},TO={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},xO={class:"text-sm text-green-400"},AO={class:"mb-6"},SO={class:"mb-4"},PO={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},RO={class:"flex justify-end space-x-3"},CO=["disabled"],oT={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=k(""),i=k(""),o=k(null);St(()=>t.show,d=>{d&&(s.value="",i.value="",pn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(O(),F("div",bO,[h("div",wO,[h("div",IO,[f[1]||(f[1]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),h("p",EO,ce(n.message),1),n.sessionInfo?(O(),F("div",TO,[h("p",xO," Session active : "+ce(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ve("",!0)]),h("div",AO,[h("div",SO,[f[3]||(f[3]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),nt(h("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Mn(l,["enter"]),Mn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Nt,s.value]])]),f[4]||(f[4]=h("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(O(),F("div",PO,ce(i.value||t.error),1)):ve("",!0),h("div",RO,[h("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,CO)])])])):ve("",!0)}},kO={class:"relative p-6 pb-4 border-b border-white/10"},DO={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},aT={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=xt(()=>{},["stop"]))},[h("div",kO,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),h("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=Jn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),h("div",DO,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ve("",!0)}};let qn="mock",Ei=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Mo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function lT(n){qn=n}async function NO(){if(qn!=="firebase"||!(await wt(Je(ae,"seasons"))).empty)return;const e=xe(Je(ae,"seasons"));await Zt(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:qi()});const t=await wt(Je(ae,"players"));for(const o of t.docs)await Zt(xe(e,"players",o.id),o.data());const r=await wt(Je(ae,"events"));for(const o of r.docs)await Zt(xe(e,"events",o.id),o.data());const s=await wt(Je(ae,"availability"));for(const o of s.docs)await Zt(xe(e,"availability",o.id),o.data());const i=await wt(Je(ae,"selections"));for(const o of i.docs)await Zt(xe(e,"selections",o.id),o.data())}async function VO(){qn==="firebase"&&await NO()}async function Lp(n=null){return(qn==="firebase"?n?(await wt(Je(ae,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await wt(Je(ae,"events"))).docs.map(t=>({id:t.id,...t.data()})):Mo).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function wd(n=null){return(qn==="firebase"?n?(await wt(Je(ae,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await wt(Je(ae,"players"))).docs.map(t=>({id:t.id,...t.data()})):Ei).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function uT(n,e=null){if(qn==="firebase"){const t=xe(e?Je(ae,"seasons",e,"players"):Je(ae,"players"));return await Zt(t,{name:n}),t.id}else{const t=`p${Ei.length+1}`;return Ei.push({id:t,name:n}),t}}async function OO(n,e=null){if(qn==="firebase"){const t=e?xe(ae,"seasons",e,"players",n):xe(ae,"players",n);await Xa(t);const r=e?await wt(Je(ae,"seasons",e,"availability")):await wt(Je(ae,"availability")),s=hg(ae);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else Ei=Ei.filter(t=>t.id!==n)}async function MO(n,e,t=null){if(qn==="firebase"){const r=t?xe(ae,"seasons",t,"players",n):xe(ae,"players",n),s=await Gt(r),i=s.exists()&&s.data().name||null;if(await Zt(r,{name:e},{merge:!0}),i&&i!==e){const o=hg(ae);try{const a=t?xe(ae,"seasons",t,"availability",i):xe(ae,"availability",i),l=await Gt(a);if(l.exists()){const c=l.data()||{},d=t?xe(ae,"seasons",t,"availability",e):xe(ae,"availability",e);o.set(d,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?Je(ae,"seasons",t,"selections"):Je(ae,"selections");(await wt(a)).forEach(c=>{var f;const d=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(d.includes(i)){const g=d.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=Ei.findIndex(s=>s.id===n);r!==-1&&(Ei[r]={...Ei[r],name:e})}}async function fo(n,e,t=null){if(qn==="firebase"){const r=t?await wt(Je(ae,"seasons",t,"availability")):await wt(Je(ae,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function po(n=null){if(qn==="firebase"){const e=n?await wt(Je(ae,"seasons",n,"selections")):await wt(Je(ae,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function H_(n,e,t=null){if(qn==="firebase"){const r=t?xe(ae,"seasons",t,"availability",n):xe(ae,"availability",n);await Zt(r,e)}}async function LO({seasonId:n,playerName:e,eventId:t,value:r}){if(qn!=="firebase")return;const s=n?xe(ae,"seasons",n,"availability",e):xe(ae,"availability",e),i=await Gt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Zt(s,a)}async function W_(n,e,t=null){if(qn==="firebase"){const r=t?xe(ae,"seasons",t,"selections",n):xe(ae,"selections",n);await Zt(r,{players:e})}}async function FO(n,e=null){if(le.info("Suppression de l'événement",{eventId:n}),qn==="firebase")try{le.debug("Suppression de l'événement dans Firestore");const t=e?xe(ae,"seasons",e,"events",n):xe(ae,"events",n);await Xa(t),le.debug("Suppression de la sélection associée");const r=e?xe(ae,"seasons",e,"selections",n):xe(ae,"selections",n);await Xa(r),le.debug("Suppression des disponibilités");const s=e?await wt(Je(ae,"seasons",e,"availability")):await wt(Je(ae,"availability")),i=hg(ae);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){le.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),le.info("Opérations de suppression terminées avec succès")}catch(t){throw le.error("Erreur lors de la suppression",t),t}else Mo=Mo.filter(t=>t.id!==n)}async function $O(n,e=null){if(qn==="firebase"){const t=xe(e?Je(ae,"seasons",e,"events"):Je(ae,"events"));return await Zt(t,n),t.id}else{const t=`event${Mo.length+1}`;return Mo.push({id:t,...n}),t}}async function Q_(n,e,t=null){if(qn==="firebase"){const r=t?xe(ae,"seasons",t,"events",n):xe(ae,"events",n);await Zt(r,e,{merge:!0})}else{const r=Mo.findIndex(s=>s.id===n);r!==-1&&(Mo[r]={id:n,...e})}}const UO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},jO={class:"text-center py-16 px-4 relative"},BO=["aria-busy"],qO={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},zO={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},KO=["onClick"],GO={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},HO={class:"absolute top-4 right-4"},WO=["onClick","aria-expanded"],QO={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},JO=["onClick"],YO=["onClick"],XO=["onClick"],ZO=["onClick"],eM={key:2,class:"flex justify-center mt-12"},tM={key:3,class:"text-center py-16"},nM={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},rM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},sM={class:"mb-6"},iM={class:"mb-6"},oM={class:"mb-6"},aM={class:"flex justify-end space-x-3"},lM=["disabled"],uM={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},cM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},dM={class:"text-center mb-6"},hM={class:"text-gray-300"},fM={__name:"Seasons",setup(n){const e=k([]),t=k(!0),r=el(),s=k(null),i=k(!1),o=k(!1),a=k(""),l=k(""),c=k(""),d=k(null),f=k(!1),g=k(null),y=k(""),T=k(!1);Xn(async()=>{var D;try{e.value=await bd(),le.info("Saisons chargées",{count:((D=e.value)==null?void 0:D.length)||0}),L().catch($=>le.error("Migration sortOrder échouée",$))}finally{t.value=!1}});const A=Oe(()=>[...e.value].sort((D,$)=>{var E,S;const X=typeof D.sortOrder=="number"?D.sortOrder:Number.MAX_SAFE_INTEGER,se=typeof $.sortOrder=="number"?$.sortOrder:Number.MAX_SAFE_INTEGER;if(X!==se)return X-se;const ke=(E=D.createdAt)!=null&&E.toMillis?D.createdAt.toMillis():0,$e=(S=$.createdAt)!=null&&S.toMillis?$.createdAt.toMillis():0;return ke!==$e?$e-ke:(D.name||"").localeCompare($.name||"")}));function P(D){r.push(`/season/${D}`)}function U(D){s.value=s.value===D?null:D}function q(){s.value=null}async function L(){if(!e.value.length)return;const D=e.value.map(X=>typeof X.sortOrder=="number"?X.sortOrder:null).filter(X=>X!==null);let $=D.length?Math.max(...D):0;for(const X of e.value)if(typeof X.sortOrder!="number"){$+=1;try{await Kl(X.id,$),X.sortOrder=$}catch(se){le.error("Erreur migration sortOrder",{seasonName:X==null?void 0:X.name,error:se})}}}async function z(D){try{if(!(D!=null&&D.id)){alert("Saison introuvable");return}const[$,X]=await Promise.all([Lp(D.id),wd(D.id)]),[se,ke]=await Promise.all([fo(X,$,D.id),po(D.id)]),$e=["Joueur",...$.map(ye=>me(ye))],E=[];for(const ye of X){const _e=(ye==null?void 0:ye.name)||"",pe=(se==null?void 0:se[_e])||{},Se=[_e,...$.map(Te=>V(pe[Te.id],ke==null?void 0:ke[Te.id],_e))];E.push(Se)}const S=I([$e,...E]),M=new Blob(["\uFEFF"+S],{type:"text/csv;charset=utf-8;"}),oe=(D==null?void 0:D.name)||(D==null?void 0:D.slug)||"saison",Z=`${C(oe)}-disponibilites.csv`,ue=URL.createObjectURL(M),be=document.createElement("a");be.href=ue,be.download=Z,document.body.appendChild(be),be.click(),document.body.removeChild(be),URL.revokeObjectURL(ue),le.info("Export CSV saison",{seasonId:D.id,events:$.length,players:X.length})}catch($){le.error("Erreur export CSV",$),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function fe(D){if(!D)return null;if(D instanceof Date)return D;if(typeof(D==null?void 0:D.toDate)=="function")return D.toDate();if(typeof D=="string"||typeof D=="number"){const $=new Date(D);return isNaN($.getTime())?null:$}return null}function me(D){const $=fe(D==null?void 0:D.date),X=$?`${$.getFullYear()}-${String($.getMonth()+1).padStart(2,"0")}-${String($.getDate()).padStart(2,"0")}`:"",se=(D==null?void 0:D.title)||"Sans titre";return`${X} · ${se}`.trim()}function x(D){return D===!0||D==="oui"?"disponible":D===!1||D==="non"?"non disponible":""}function I(D){return D.map($=>$.map(w).join(",")).join(`
`)}function w(D){const $=String(D??"");return/[",\n\r]/.test($)?'"'+$.replace(/"/g,'""')+'"':$}function C(D){return String(D||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function V(D,$,X){return Array.isArray($)&&$.includes(X)?D===!1||D==="non"?"non disponible":"sélectionné":x(D)}async function B(D){if(q(),D<=0)return;const $=[...A.value],X=$[D],se=$[D-1],ke=X.sortOrder;X.sortOrder=se.sortOrder,se.sortOrder=ke;try{await Promise.all([Kl(X.id,X.sortOrder),Kl(se.id,se.sortOrder)])}catch($e){le.error("Erreur lors du déplacement vers le haut",$e)}}async function R(D){q();const $=[...A.value];if(D>=$.length-1)return;const X=$[D],se=$[D+1],ke=X.sortOrder;X.sortOrder=se.sortOrder,se.sortOrder=ke;try{await Promise.all([Kl(X.id,X.sortOrder),Kl(se.id,se.sortOrder)])}catch($e){le.error("Erreur lors du déplacement vers le bas",$e)}}function It(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function vt(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function Y(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await sO(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await bd(),await L(),j()}catch(D){le.error("Erreur lors de la création de la saison",D),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function j(){i.value=!1,a.value="",l.value="",c.value=""}function ne(D){d.value=D,o.value=!0}async function Ke(){o.value=!1,await re({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function Be(){o.value=!1,d.value=null}function Ge(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function re(D){if(An.isPinCached(d.value.id)){const $=An.getCachedPin(d.value.id);if(le.debug("PIN en cache trouvé, utilisation automatique"),await Zd(d.value.id,$)){await ht(D);return}else An.clearSession()}g.value=D,f.value=!0}async function ee(D){var $,X,se,ke;le.debug("PIN soumis pour l'opération",{operationType:($=g.value)==null?void 0:$.type});try{const $e=((se=(X=g.value)==null?void 0:X.data)==null?void 0:se.seasonId)||((ke=d.value)==null?void 0:ke.id),E=await Zd($e,D);if(le.debug("PIN validé",{valid:E}),E){An.saveSession($e,D),le.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const S=g.value;g.value=null,le.debug("Appel de executePendingOperation",{operationType:S==null?void 0:S.type}),await ht(S)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch($e){le.error("Erreur lors de la vérification du PIN",$e),y.value="Erreur lors de la vérification du code PIN"}}function je(){f.value=!1,g.value=null,y.value=""}function Xe(){return d.value&&An.isPinCached(d.value.id)?{timeRemaining:An.getTimeRemaining(),isExpiringSoon:An.isExpiringSoon()}:null}async function ht(D){var se;if(le.debug("executePendingOperation appelé",{hasOperation:!!D}),!D){le.warn("Aucune opération à exécuter");return}const{type:$,data:X}=D;le.info("Exécution de l'opération",{type:$});try{switch($){case"deleteSeason":le.info("Suppression de la saison",{seasonId:X.seasonId}),await iO(X.seasonId),le.info("Saison supprimée, rechargement de la liste"),e.value=await bd(),le.info("Liste des saisons rechargée",{count:((se=e.value)==null?void 0:se.length)||0});break;default:le.warn("Type d'opération non reconnu",{type:$})}}catch(ke){le.error("Erreur lors de l'exécution de l'opération",ke),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(D,$)=>{var X;return O(),F("div",UO,[h("div",jO,[h("button",{onClick:$[0]||($[0]=se=>T.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},$[8]||($[8]=[h("span",{class:"text-2xl"},"❓",-1)])),$[9]||($[9]=h("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Tu joues quand ? ",-1)),$[10]||($[10]=h("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui sera sur scène quand. Laissez chacun indiquer ses dispos et le hasard choisir pour vous !",-1))]),h("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(O(),F("div",qO,[(O(),F(dt,null,wr(8,se=>h("div",{key:"skeleton-"+se,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},$[11]||($[11]=[h("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),h("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),h("div",{class:"h-px bg-white/10 mb-4"},null,-1),h("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(O(),F("div",zO,[(O(!0),F(dt,null,wr(A.value,(se,ke)=>(O(),F("div",{key:se.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[h("div",{onClick:$e=>P(se.slug),class:"text-center cursor-pointer"},[$[12]||($[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[h("span",{class:"text-2xl"},"🎭")],-1)),h("h2",GO,ce(se.name),1),$[13]||($[13]=h("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),$[14]||($[14]=h("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,KO),h("div",HO,[h("div",{class:"relative",onClick:$[1]||($[1]=xt(()=>{},["stop"]))},[h("button",{onClick:$e=>U(ke),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===ke,"aria-haspopup":"true",title:"Options"},$[15]||($[15]=[h("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,WO),s.value===ke?(O(),F("div",QO,[h("button",{onClick:$e=>{z(se),q()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,JO),$[16]||($[16]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:$e=>B(ke),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,YO),h("button",{onClick:$e=>R(ke),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,XO),$[17]||($[17]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:$e=>ne(se),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,ZO)])):ve("",!0)])])]))),128))])):ve("",!0),!t.value&&e.value.length>0?(O(),F("div",eM,[h("button",{onClick:$[2]||($[2]=se=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):ve("",!0),!t.value&&e.value.length===0?(O(),F("div",tM,[$[18]||($[18]=h("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-4xl"},"🎪")],-1)),$[19]||($[19]=h("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),$[20]||($[20]=h("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),h("button",{onClick:$[3]||($[3]=se=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ve("",!0)],8,BO),i.value?(O(),F("div",nM,[h("div",rM,[$[25]||($[25]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),h("div",sM,[$[21]||($[21]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),nt(h("input",{"onUpdate:modelValue":$[4]||($[4]=se=>a.value=se),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:It},null,544),[[Nt,a.value]])]),h("div",iM,[$[22]||($[22]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),nt(h("input",{"onUpdate:modelValue":$[5]||($[5]=se=>l.value=se),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Nt,l.value]])]),h("div",oM,[$[23]||($[23]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),nt(h("input",{"onUpdate:modelValue":$[6]||($[6]=se=>c.value=se),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:vt},null,544),[[Nt,c.value]]),$[24]||($[24]=h("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),h("div",aM,[h("button",{onClick:j,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Y,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,lM)])])])):ve("",!0),o.value?(O(),F("div",uM,[h("div",cM,[h("div",dM,[$[26]||($[26]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"⚠️")],-1)),$[27]||($[27]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",hM,'Êtes-vous sûr de vouloir supprimer la saison "'+ce((X=d.value)==null?void 0:X.name)+'" ?',1)]),$[28]||($[28]=h("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Be,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Ke,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ve("",!0),ct(oT,{show:f.value,message:Ge(),error:y.value,"session-info":Xe(),onSubmit:ee,onCancel:je},null,8,["show","message","error","session-info"]),ct(aT,{show:T.value,onClose:$[7]||($[7]=se=>T.value=!1)},null,8,["show"]),$[29]||($[29]=Jn('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},Jh="magicLinks";function Yh({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Og(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Fp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Yh({seasonId:n,playerId:e,eventId:t,action:r}),i=Og(40),o=xe(ae,Jh,s),a=Date.now()+1e3*60*60*24*7;await Zt(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function cT({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Yh({seasonId:n,playerId:e,eventId:r,action:s}),o=Og(40),a=xe(ae,Jh,i),l=Date.now()+1e3*60*60*24*7;await Zt(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function dT({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Yh({seasonId:n,playerId:e,eventId:t,action:s}),o=xe(ae,Jh,i),a=await Gt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function $p({seasonId:n,playerId:e,eventId:t,action:r}){const s=Yh({seasonId:n,playerId:e,eventId:t,action:r}),i=xe(ae,Jh,s);await Xa(i)}const Mg="accountMagicLinks";function Xh(n){return`account__${n}`}async function hT({currentEmail:n,newEmail:e}){const t=Og(40),r=Xh(t),s=xe(ae,Mg,r),i=Date.now()+1e3*60*60*24*7;await Zt(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function fT({token:n}){const e=Xh(n),t=xe(ae,Mg,e),r=await Gt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function pT({token:n}){const e=Xh(n),t=xe(ae,Mg,e);await Xa(t)}const pM=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Xh,consumeAccountEmailUpdateLink:pT,consumeMagicLink:$p,createAccountEmailUpdateLink:hT,createEmailVerificationLink:cT,createMagicLink:Fp,verifyAccountEmailUpdateLink:fT,verifyMagicLink:dT},Symbol.toStringTag,{value:"Module"})),J_="impro_selector_trusted_players",Y_=180*24*60*60*1e3;class mM{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(J_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(J_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<Y_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>Y_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Oi=new mM;function Lg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function mT(n){return`seasonPreferredPlayer:${n||"global"}`}function Up(n,e){try{const t=mT(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function gM(n,e){try{const t=mT(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function gT(n,e,t,r=null){try{le.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await _l(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Xt(()=>import("./index.esm-b15ef6e4.js"),[]),{db:c}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(L=>L.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");le.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await Xt(()=>import("./index.esm-90433e20.js"),[]),{auth:T}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0),A=await y(T,e,t);le.info("Compte Firebase Auth créé",{uid:A.user.uid});const P=Lg(t),U=r?xe(c,"seasons",r,"playerProtection",n):xe(c,"playerProtection",n);return await Zt(U,{playerId:n,email:e,passwordHash:P,firebaseUid:A.user.uid,isProtected:!0,createdAt:new Date}),le.info("Protection sauvegardée dans Firestore"),r&&Up(r,n),{success:!0}}catch(s){throw le.error("Erreur lors de la protection du joueur",s),s}}async function vT({playerId:n,email:e,seasonId:t=null}){const r=t?xe(ae,"seasons",t,"playerProtection",n):xe(ae,"playerProtection",n);(await Gt(r)).exists()?await pl(r,{email:e,updatedAt:new Date}):await Zt(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await cT({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function yT({playerId:n,seasonId:e=null}){const t=e?xe(ae,"seasons",e,"playerProtection",n):xe(ae,"playerProtection",n);if(!(await Gt(t)).exists())throw new Error("Protection introuvable");return await pl(t,{emailVerifiedAt:new Date}),{success:!0}}async function _T({playerId:n,seasonId:e=null}){const t=e?xe(ae,"seasons",e,"playerProtection",n):xe(ae,"playerProtection",n);return await pl(t,{emailVerifiedAt:null}),{success:!0}}async function bT(n,e=null){try{const t=e?xe(ae,"seasons",e,"playerProtection",n):xe(ae,"playerProtection",n);return await Zt(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&gM(e,n),{success:!0,email:""}}catch(t){throw le.error("Erreur lors de la suppression de la protection",t),t}}async function Ti(n,e=null){try{const t=e?xe(ae,"seasons",e,"playerProtection",n):xe(ae,"playerProtection",n),r=await Gt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return le.error("Erreur lors de la vérification de protection",t),!1}}async function _l(n,e=null){try{const t=e?xe(ae,"seasons",e,"playerProtection",n):xe(ae,"playerProtection",n),r=await Gt(t);return r.exists()?r.data():null}catch(t){return le.error("Erreur lors de la récupération des données de protection",t),null}}async function wT(n,e=null){try{const t=await _l(n,e);return(t==null?void 0:t.email)||""}catch(t){return le.error("Erreur lors de la récupération de l'email",t),""}}async function jp(n=null){try{const e=n?Je(ae,"seasons",n,"playerProtection"):Je(ae,"playerProtection");return(await wt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return le.error("Erreur lors du chargement des protections",e),[]}}async function Fg(n){try{const e=[],t=Lu(Je(ae,"playerProtection"),Wd("email","==",n));(await wt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await wt(Je(ae,"seasons"));for(const i of s.docs){const o=i.id,a=Lu(Je(ae,"seasons",o,"playerProtection"),Wd("email","==",n));(await wt(a)).forEach(c=>{var f;const d=c.data();d!=null&&d.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...d})})}return e}catch(e){return le.error("Erreur listAssociationsForEmail",e),[]}}async function IT(n,e,t=null){try{const r=await _l(n,t);if(!r||!r.isProtected)return!1;if(r.email){le.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Xt(()=>import("./index.esm-90433e20.js"),[]),{auth:i}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0);return await s(i,r.email,e),le.debug("Mot de passe Firebase Auth valide"),Oi.saveSession(n),t&&Up(t,n),!0}catch(s){return le.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{le.debug("Vérification avec hash local");const s=Lg(e),i=r.passwordHash===s;return i&&(Oi.saveSession(n),t&&Up(t,n)),i}}catch(r){return le.error("Erreur lors de la vérification du mot de passe",r),!1}}async function ET({playerId:n,seasonId:e=null}){const t=e?xe(ae,"seasons",e,"playerProtection",n):xe(ae,"playerProtection",n),r=await Gt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await pl(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function Ao(n){return Oi.isPasswordCached(n)}function vM(n){return null}async function TT(n,e=null){try{le.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await _l(n,e);if(le.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(le.debug("Email à utiliser (masqué)"),t.firebaseUid){le.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Xt(()=>import("./index.esm-90433e20.js"),[]),{auth:s}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0);le.debug("Tentative d'envoi d'email"),await r(s,t.email),le.info("Email envoyé avec succès via Firebase Auth")}else{le.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Xt(()=>import("./index.esm-90433e20.js"),[]),{auth:i}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);le.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),le.info("Email envoyé avec succès");const{updateDoc:l}=await Xt(()=>import("./index.esm-b15ef6e4.js"),[]),{db:c}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0),d=e?xe(c,"seasons",e,"playerProtection",n):xe(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")le.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),le.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw le.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function yM(n,e,t=null){try{const r=Lg(e),s=t?xe(ae,"seasons",t,"playerProtection",n):xe(ae,"playerProtection",n);return await pl(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw le.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function _M(n){return new Promise((e,t)=>{le.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const gc=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:_T,finalizeProtectionAfterVerification:ET,getCachedPlayerPassword:vM,getPlayerEmail:wT,getPlayerProtectionData:_l,isPlayerPasswordCached:Ao,isPlayerProtected:Ti,listAssociationsForEmail:Fg,listProtectedPlayers:jp,markEmailVerifiedForProtection:yT,protectPlayer:gT,requirePlayerPasswordForAvailability:_M,sendPasswordResetEmail:TT,startEmailVerificationForProtection:vT,unprotectPlayer:bT,updatePlayerPasswordInFirestore:yM,verifyPlayerPassword:IT},Symbol.toStringTag,{value:"Module"}));async function vc({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:qi()};return await ml(Je(ae,"pushQueue"),i),{success:!0}}async function bM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const g=xe(ae,"userPreferences",n),y=await Gt(g);if(y.exists()){const T=y.data();if((T==null?void 0:T.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Nouvel événement programmé!</strong></p>
      <p style="margin: 12px 0 2px 0; font-weight: 600;">${t}</p>
      <p style="margin: 0 0 16px 0; color:#374151;">${r}</p>
      <p>Nous avons besoin de savoir si tu es disponible.</p>
      <p style="margin-top: 12px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px;">Merci!!</p>
    </div>
  `,d=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:d,html:c},createdAt:qi(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}};l&&(f.from=l,f.replyTo=l),await ml(Je(ae,"mail"),f);try{const g=xe(ae,"userPreferences",n),y=await Gt(g),T=y.exists()?y.data():{};if((T==null?void 0:T.notifyAvailabilityPush)!==!1){const A=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,P=`${e}, t'es dispo ?`;await vc({toEmail:n,title:A,body:P,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function xT({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",d=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:d,html:f},createdAt:qi(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await ml(Je(ae,"mail"),g)}async function wM({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return xT({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function IM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=xe(ae,"userPreferences",n),g=await Gt(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}le.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;le.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:qi(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),le.debug("queueSelectionEmail firestore payload ready");try{await ml(Je(ae,"mail"),d);try{const f=xe(ae,"userPreferences",n),g=await Gt(f),y=g.exists()?g.data():{};(y==null?void 0:y.notifySelectionPush)!==!1&&await vc({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin},reason:"selection"})}catch{}return le.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw le.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function EM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const y=xe(ae,"userPreferences",n),T=await Gt(y);if(T.exists()){const A=T.data();if((A==null?void 0:A.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",d=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:d},createdAt:qi(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}};l&&(g.from=l,g.replyTo=l),await ml(Je(ae,"mail"),g);try{const y=xe(ae,"userPreferences",n),T=await Gt(y),A=T.exists()?T.data():{};(A==null?void 0:A.notifySelectionPush)!==!1&&await vc({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function TM({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(le.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await Xt(()=>Promise.resolve().then(()=>gc),void 0),{createMagicLink:a}=await Xt(()=>Promise.resolve().then(()=>pM),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,d=[];for(const f of t){le.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(q=>q.name===f);if(!g){le.warn("Joueur non trouvé",{playerName:f});continue}le.debug("Joueur trouvé");const y=await o(g.id,r);if(!y){le.warn("Pas d'email pour le joueur",{playerName:f});continue}le.debug("Email trouvé pour joueur");const A=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,P=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${eh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${A}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;le.debug("HTML généré pour joueur");const U=IM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:eh(e.date),eventUrl:l,html:P,subject:c});d.push(U),le.info("Email ajouté à la queue",{playerName:f})}catch(g){le.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return le.info("Nombre total d'emails à envoyer",{count:d.length}),await Promise.all(d),le.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:d.length}}async function xM({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(le.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await Xt(()=>Promise.resolve().then(()=>gc),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],d=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(A=>A.name===f);if(!g){le.warn("Joueur retiré non trouvé",{playerName:f});continue}const y=await a(g.id,s);if(!y){le.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const T=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${eh(e.date)}) 😔.</p>
          ${d?`<p>Nouvelle sélection: <strong>${d}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(EM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:eh(e.date),eventUrl:l,newSelectedPlayers:r,html:T}))}catch(g){le.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(c),le.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function eh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function AM({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const l=(i==null?void 0:i.notifyAvailability)!==!1,c=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:l,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:c,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🗓️ Disponibilité demandée",body:`${e}, ${t} (${r})`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}}}if(n==="selection"){const l=(i==null?void 0:i.notifySelection)!==!1,c=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:l,subject:`🎭 Sélection confirmée · ${t}`},a.push={enabled:c,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s.eventUrl}}}return a}async function SM({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Gt(xe(ae,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=AM({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),d=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await bM({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>d.push({channel:"email",success:!0})).catch(g=>{le.error("notifyRecipientAcrossChannels email error",g),d.push({channel:"email",success:!1})}):n==="selection"&&d.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled&&await vc({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>d.push({channel:"push",success:!0})).catch(g=>{le.error("notifyRecipientAcrossChannels push error",g),d.push({channel:"push",success:!1})}),{success:d.some(g=>g.success),results:d}}async function X_({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const d of t)try{if(o&&typeof a=="function"){const y=await Promise.resolve(a(d.name,n));if(y===!0||y===!1)continue}const f={};if(typeof i=="function"){const y=await i({seasonId:r,playerId:d.id,eventId:n,action:"yes"}),T=await i({seasonId:r,playerId:d.id,eventId:n,action:"no"});f.yesUrl=`${y.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${T.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await SM({reason:o?"availability_reminder":"availability_request",recipientEmail:d.email,recipientName:d.name,eventTitle:e.title,eventDate:PM(e.date),urls:f})).success||l.push(d.id)}catch{l.push(d.id)}return{success:!0,failures:l}}async function Z_(n){return TM(n)}function PM(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const RM="/icons/manifest-icon-192.maskable.png",CM={class:"relative p-5 pb-4 border-b border-white/10"},kM={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},DM={key:0,class:"text-sm text-purple-300 mt-1"},NM={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},VM={class:"space-y-4"},OM={class:"inline-flex bg-gray-800 rounded-lg overflow-hidden border border-gray-700 mb-3"},MM={class:"text-sm text-gray-300"},LM={class:"text-sm text-gray-300"},FM={class:"text-sm text-gray-300"},$M=["innerHTML"],UM=["value"],jM={class:"mt-3"},BM={class:"text-lg font-semibold leading-snug"},qM={class:"mt-2 text-base whitespace-pre-line text-white/90"},zM={class:"mt-4 flex items-center gap-4 text-base"},KM={key:1,class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-100 text-gray-900 border border-white/20"},GM={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},HM=["value"],WM={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},QM={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},JM={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},YM={key:0,class:"space-y-2"},XM={class:"flex flex-wrap gap-2"},ZM=["onClick","title"],eL={key:1,class:"text-amber-400 text-sm"},tL={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},nL={class:"flex items-center gap-2 w-full"},rL=["disabled"],sL={key:0},iL={key:1,class:"inline-flex items-center gap-2"},oL=["title"],aL={key:0},lL={key:1},AT={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e;k("notify");const s=k(!1),i=k("Copier le message"),o=k(!1),a=Oe(()=>t.sending||o.value),l=k(!1),c=k("email"),d=Oe(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=Oe(()=>{if(!t.event)return"";if(c.value==="push"){const j=P.value,ne=U.value;if(t.mode==="event"){const Ke=`

Lien direct: ${d.value}`;return`${j}
${ne}
✅ Dispo
❌ Pas dispo${Ke}`}return`${j}
${ne}
Ouvrir`}const Y=`

Lien direct: ${d.value}`;return`Objet: ${g.value}

${A.value}${Y}`}),g=Oe(()=>{var j,ne,Ke;const Y=B((j=t.event)==null?void 0:j.date);return t.mode==="event"?`${(ne=t.event)==null?void 0:ne.title} (${Y})`:`🎭 Sélection confirmée · ${(Ke=t.event)==null?void 0:Ke.title}`}),y=Oe(()=>"impropick@gmail.com"),T=Oe(()=>{var ne,Ke,Be,Ge,re,ee,je;const Y=((ne=z.value)==null?void 0:ne.id)==="ALL"?"<joueur>":((Ke=z.value)==null?void 0:Ke.name)||"[Nom du joueur]",j=B((Be=t.event)==null?void 0:Be.date);return z.value&&z.value.id&&z.value.id!=="ALL"&&!((Ge=me.value.find(Xe=>Xe.id===z.value.id))!=null&&Ge.hasContact)?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${Y}</strong> n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
        <p style="margin-top: 8px; font-weight: 600;">${(re=t.event)==null?void 0:re.title}</p>
        <p style="color:#374151;">${j}</p>
        <p style="margin-top: 8px;">Lien direct : ${d.value}</p>
      </div>
    `:t.mode==="event"?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${Y}</strong>, un nouvel événement est prévu.</p>
        <p style="margin: 12px 0 2px 0; font-weight: 600;">${(ee=t.event)==null?void 0:ee.title}</p>
        <p style="margin: 0 0 16px 0; color:#374151;">${j}</p>
        <p>Nous avons besoin de savoir si tu es disponible.</p>
        <p style="margin-top: 12px;">
          <a href="#yes" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
          <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
        </p>
        <p style="margin-top: 16px;">Merci!!</p>
      </div>
    `:`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${Y},</p>
      <p>Tu as été sélectionné(e) pour <strong>${(je=t.event)==null?void 0:je.title}</strong> (${j}).</p>
      <p>Un imprévu ?</p>
      <p>
        <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
        <a href="#event" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
    </div>
  `}),A=Oe(()=>T.value.replace(/<\/?div[^>]*>/g,`
`).replace(/<\/?p[^>]*>/g,`
`).replace(/<br\s*\/?>(\n)?/g,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`).trim()),P=Oe(()=>{var Y,j;return t.mode==="event"?`${(Y=t.event)==null?void 0:Y.title} (${B((j=t.event)==null?void 0:j.date)})`:"🎭 Sélection confirmée"}),U=Oe(()=>{var Be,Ge,re,ee,je,Xe;const Y=B((Be=t.event)==null?void 0:Be.date),j=((Ge=z.value)==null?void 0:Ge.id)==="ALL"?"<joueur>":((re=z.value)==null?void 0:re.name)||"[Nom du joueur]",ne=z.value&&z.value.id&&z.value.id!=="ALL",Ke=ne?!!((ee=me.value.find(ht=>ht.id===z.value.id))!=null&&ee.hasContact):!0;return ne&&!Ke?`${j} n'a pas installé l'appli. Envoie-lui ce message manuellement.
${(je=t.event)==null?void 0:je.title} (${Y})
Lien: ${d.value}`:t.mode==="event"?`${j}, t'es dispo ?`:`${j}, tu as été sélectionné(e) pour ${(Xe=t.event)==null?void 0:Xe.title} (${Y}) 🎉`}),q=k([]),L=k([]),z=k(null),fe=k([]),me=Oe(()=>{const Y=L.value.map(ne=>({...ne,hasContact:ne.id!=="ALL",missingReason:""})),j=fe.value.map(ne=>({...ne,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...Y.filter(ne=>ne.id!=="ALL"),...j]}),x=Oe(()=>{if(!z.value||z.value.id==="ALL")return!0;const Y=me.value.find(j=>(j.id||j.name)===(z.value.id||z.value.name));return!!(Y!=null&&Y.hasContact)}),I=Oe(()=>{var ne,Ke,Be,Ge,re;const Y=((ne=z.value)==null?void 0:ne.id)==="ALL"?"<joueur>":((Ke=z.value)==null?void 0:Ke.name)||"[Nom du joueur]",j=B((Be=t.event)==null?void 0:Be.date);return t.mode==="selection"?`Bonjour ${Y},
Tu as été sélectionné(e) pour ${(Ge=t.event)==null?void 0:Ge.title} (${j})
Un imprévu ? ${w.value}
Détails : ${d.value}`:`Bonjour ${Y},
${(re=t.event)==null?void 0:re.title} (${j})
Peux-tu indiquer ta disponibilité ?
Lien : ${d.value}`}),w=Oe(()=>{var Y,j;try{const ne=(Y=z.value)!=null&&Y.id&&z.value.id!=="ALL"?t.players.find(Ke=>Ke.id===z.value.id):null;return!ne||!((j=t.event)!=null&&j.id)||!t.seasonId?"[lien désistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(ne.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien désistement]"}});async function C(){if(!t.seasonId)return;let Y=[];t.mode==="selection"?Y=t.players.filter(Be=>t.selectedPlayers.includes(Be.name)):Y=t.players.filter(Be=>{var re;return typeof((re=t.availabilityByPlayer)==null?void 0:re[Be.name])>"u"});const j=[];for(const Be of Y)try{const{getPlayerEmail:Ge}=await Xt(()=>Promise.resolve().then(()=>gc),void 0),re=await Ge(Be.id,t.seasonId);re&&j.push({...Be,email:re})}catch(Ge){console.warn(`Impossible de charger l'email pour ${Be.name}:`,Ge)}q.value=j;const ne={id:"ALL",name:"Tous"};L.value=[ne,...j];const Ke=Y.filter(Be=>!j.find(Ge=>Ge.id===Be.id)).map(Be=>({id:Be.id,name:Be.name}));fe.value=Ke,z.value||(z.value=ne)}function V(){r("close")}function B(Y){var ne;return Y?(typeof Y=="string"?new Date(Y):((ne=Y.toDate)==null?void 0:ne.call(Y))||Y).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function R(){const Y=f.value;navigator.clipboard.writeText(Y).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(j=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function It(Y){z.value=Y}async function vt(){if(!(!t.event||L.value.length===0)){o.value=!0;try{const Y=z.value&&z.value.id!=="ALL"?"single":"all",j=Y==="single"?{id:z.value.id,name:z.value.name,email:z.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:Y,recipient:j}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:Y,recipient:j})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}}}return Xn(()=>{t.show&&C()}),St(()=>t.show,Y=>{Y&&C()}),St(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&C()}),St(()=>t.availabilityByPlayer,()=>{t.show&&t.mode==="event"&&C()},{deep:!0}),St(()=>t.sending,Y=>{Y||(o.value=!1)}),(Y,j)=>{var ne,Ke,Be,Ge,re;return n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:V},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:j[3]||(j[3]=xt(()=>{},["stop"]))},[h("div",CM,[h("button",{onClick:V,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("h2",kM,[h("span",null,ce(n.mode==="selection"?"📣":"📢"),1),h("span",null,ce(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1)]),n.event?(O(),F("p",DM,ce(n.event.title)+" — "+ce(B(n.event.date)),1)):ve("",!0)]),h("div",NM,[h("div",VM,[h("div",null,[j[11]||(j[11]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),h("div",OM,[h("button",{class:At(["px-3 py-2 text-sm transition-colors",c.value==="email"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:j[0]||(j[0]=ee=>c.value="email"),title:"Prévisualiser l'email"},"📧",2),h("button",{class:At(["px-3 py-2 text-sm transition-colors",c.value==="push"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:j[1]||(j[1]=ee=>c.value="push"),title:"Prévisualiser la notification push"},"🔔",2)]),c.value==="email"?(O(),F("div",{key:0,class:At(x.value||((ne=z.value)==null?void 0:ne.id)==="ALL"?"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white space-y-3":"space-y-3")},[x.value||((Ke=z.value)==null?void 0:Ke.id)==="ALL"?(O(),F(dt,{key:0},[h("div",MM,[j[4]||(j[4]=h("span",{class:"font-semibold"},"De:",-1)),Vt(" "+ce(y.value),1)]),h("div",LM,[j[5]||(j[5]=h("span",{class:"font-semibold"},"À:",-1)),Vt(" "+ce(((Be=z.value)==null?void 0:Be.id)==="ALL"?"<joueur>":((Ge=z.value)==null?void 0:Ge.name)||"[Nom du joueur]"),1)]),h("div",FM,[j[6]||(j[6]=h("span",{class:"font-semibold"},"Objet:",-1)),Vt(" "+ce(g.value),1)]),h("div",{class:"bg-white text-black rounded-md p-4",innerHTML:T.value},null,8,$M)],64)):(O(),F(dt,{key:1},[j[7]||(j[7]=h("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal. ",-1)),h("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:I.value,rows:"5",readonly:""},null,8,UM)],64))],2)):(O(),F("div",{key:1,class:At(z.value&&z.value.id!=="ALL"&&!x.value?"text-white":"bg-gray-900 border border-gray-700 rounded-xl p-4 text-white")},[z.value&&z.value.id!=="ALL"&&!x.value?(O(),F(dt,{key:1},[h("div",GM,ce((re=z.value)==null?void 0:re.name)+" n'a pas installé l'appli. Envoie-lui ce message manuellement. ",1),h("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:I.value,rows:"5",readonly:""},null,8,HM)],64)):(O(),F(dt,{key:0},[j[10]||(j[10]=Jn('<div class="flex items-center justify-between text-xs text-white/70"><div class="flex items-center gap-2 min-w-0"><div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center">🔔</div><div class="truncate">Impropick</div><span class="opacity-60">•</span><span>il y a 1 min</span></div><img src="'+RM+'" alt="App icon" class="w-10 h-10 rounded-full shadow"></div>',1)),h("div",jM,[h("div",BM,ce(P.value),1),h("div",qM,ce(U.value),1)]),h("div",zM,[t.mode==="event"?(O(),F(dt,{key:0},[j[8]||(j[8]=h("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600/20 text-green-300 border border-green-600/40"},"✅ Dispo",-1)),j[9]||(j[9]=h("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-red-600/20 text-red-300 border border-red-600/40"},"❌ Pas dispo",-1))],64)):(O(),F("span",KM,"Ouvrir"))])],64))],2))]),h("div",null,[h("label",WM,[j[12]||(j[12]=Vt(" Destinataires ")),h("button",{onClick:j[2]||(j[2]=ee=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(O(),F("div",QM,j[13]||(j[13]=[h("p",{class:"text-blue-200 text-sm"},[Vt(" Cette liste montre tous les joueurs ciblés: "),h("span",{class:"text-purple-300"},"« Tous »"),Vt(", "),h("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),Vt(" et "),h("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),Vt(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise « Copier le message » pour leur écrire via un autre moyen (l'URL de l'événement est incluse). ")],-1)]))):ve("",!0),h("div",JM,[me.value.length>0?(O(),F("div",YM,[h("div",XM,[(O(!0),F(dt,null,wr(me.value,ee=>(O(),F("button",{key:ee.id||ee.name,type:"button",onClick:je=>It(ee),class:At(["px-3 py-1 rounded text-sm border transition-colors",z.value&&z.value.id===ee.id?"bg-purple-600 border-purple-500 text-white":ee.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:ee.hasContact?"Prévisualiser pour "+ee.name:ee.missingReason||"Aucun canal actif"},ce(ee.name),11,ZM))),128))])])):(O(),F("div",eL," ⚠️ Aucun destinataire disponible. "))])])])]),h("div",tL,[h("div",nL,[h("button",{onClick:vt,disabled:L.value.length===0||a.value||z.value&&z.value.id!=="ALL"&&!x.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(O(),F("span",iL,j[14]||(j[14]=[h("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[h("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),h("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),Vt(" Envoi en cours... ")]))):(O(),F("span",sL,[z.value&&z.value.id!=="ALL"?(O(),F("span",{key:0,class:At(x.value?"":"opacity-60")},"🔔 Notifier "+ce(z.value.name),3)):(O(),F(dt,{key:1},[Vt("🔔 Envoyer les notifications")],64))]))],8,rL),h("button",{onClick:R,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(O(),F("span",lL,"✅ Copié")):(O(),F("span",aL,"📋 Copier le message"))],8,oL)]),h("button",{onClick:V,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ve("",!0)}}},uL={class:"text-center mb-6"},cL={class:"text-lg text-gray-300"},dL={class:"mb-6"},hL={class:"space-y-4"},fL={class:"flex items-center gap-2 text-gray-300 text-sm"},pL=["disabled"],mL={key:0,class:"animate-spin"},gL={key:1},vL={class:"mb-6 text-center"},yL={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_L={class:"text-red-300 text-sm"},bL={class:"text-center mb-6"},wL={class:"text-lg text-gray-300"},IL={class:"mb-6"},EL=["disabled"],TL={key:0,class:"animate-spin"},xL={key:1},AL={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},SL={class:"text-red-300 text-sm"},PL={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},RL={class:"text-green-300 text-sm"},CL={class:"flex justify-center"},$g={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=k(""),i=k(!1),o=k(""),a=k(!1),l=k(""),c=k(""),d=k(null),f=k(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const A=await Op(t.seasonId);if(s.value===A){if(f.value)try{Oi.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),T();return}if(await IT(t.player.id,s.value,t.seasonId)){if(f.value)try{Oi.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),T()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(A){le.error("Erreur lors de la vérification",A),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const A=await TT(t.player.id,t.seasonId);c.value=A.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(A){le.error("Erreur lors de l'envoi de l'email",A),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function T(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return St(()=>t.show,A=>{A&&pn(()=>{d.value&&d.value.focus()})}),(A,P)=>{var U,q;return O(),F(dt,null,[n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:T},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[3]||(P[3]=xt(()=>{},["stop"]))},[h("div",uL,[P[7]||(P[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔐")],-1)),P[8]||(P[8]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),h("p",cL,ce((U=n.player)==null?void 0:U.name),1),P[9]||(P[9]=h("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),h("div",dL,[h("div",hL,[h("div",null,[P[10]||(P[10]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),nt(h("input",{"onUpdate:modelValue":P[0]||(P[0]=L=>s.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Mn(g,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Nt,s.value]])]),h("div",fL,[nt(h("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":P[1]||(P[1]=L=>f.value=L),class:"w-4 h-4"},null,512),[[yi,f.value]]),P[11]||(P[11]=h("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),h("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(O(),F("span",mL,"⏳")):(O(),F("span",gL,"🔓")),h("span",null,ce(i.value?"Vérification...":"Vérifier"),1)],8,pL)]),h("div",vL,[h("button",{onClick:P[2]||(P[2]=L=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(O(),F("div",yL,[h("div",_L,ce(o.value),1)])):ve("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ve("",!0),a.value?(O(),F("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:P[6]||(P[6]=L=>a.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[5]||(P[5]=xt(()=>{},["stop"]))},[h("div",bL,[P[12]||(P[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"📧")],-1)),P[13]||(P[13]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),h("p",wL,ce((q=n.player)==null?void 0:q.name),1)]),h("div",IL,[P[14]||(P[14]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(O(),F("span",TL,"⏳")):(O(),F("span",xL,"📧")),h("span",null,ce(i.value?"Envoi...":"Envoyer l'email"),1)],8,EL)]),l.value?(O(),F("div",AL,[h("div",SL,ce(l.value),1)])):ve("",!0),c.value?(O(),F("div",PL,[h("div",RL,ce(c.value),1)])):ve("",!0),h("div",CL,[h("button",{onClick:P[4]||(P[4]=L=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ve("",!0)],64)}}},kL={class:"text-center mb-6"},DL={class:"text-sm text-gray-300"},NL={key:0,class:"space-y-4"},VL={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},OL={key:1,class:"space-y-4"},ML=["disabled"],LL={key:0,class:"animate-spin"},FL={key:1},$L={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},UL={class:"mt-6 flex justify-center gap-3"},jL=["disabled"],BL={key:0,class:"animate-spin"},qL={key:1},ST={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=k(1),i=k(""),o=k(""),a=k(""),l=k(!1),c=k(""),d=k(!1),f=tl(),g=Oe(()=>i.value&&i.value.includes("@")),y=Oe(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function T(){var q,L,z;if(!(!g.value||!((q=t.player)!=null&&q.id))){l.value=!0,c.value="";try{const fe=await vT({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),me=(L=f.params)==null?void 0:L.slug,x=`${fe.url}${me?`&slug=${encodeURIComponent(me)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await wM({toEmail:i.value,playerName:((z=t.player)==null?void 0:z.name)||"joueur",verifyUrl:x}),d.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function A(){try{await _T({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,d.value=!1,i.value="",o.value="",a.value=""}async function P(){var q;try{const L=await _l((q=t.player)==null?void 0:q.id,t.seasonId);L!=null&&L.email&&(L!=null&&L.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}Xn(()=>{P()}),St(()=>t.show,q=>{q&&P()});async function U(){if(y.value){l.value=!0,c.value="";try{await gT(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(q){c.value=(q==null?void 0:q.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(q,L)=>{var z;return n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:L[6]||(L[6]=fe=>q.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:L[5]||(L[5]=xt(()=>{},["stop"]))},[h("button",{onClick:L[0]||(L[0]=fe=>q.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",kL,[L[7]||(L[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"👤")],-1)),L[8]||(L[8]=h("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),h("p",DL,"Pour sécuriser les saisies de "+ce((z=n.player)==null?void 0:z.name),1)]),s.value===1?(O(),F("div",NL,[h("div",null,[L[9]||(L[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),nt(h("input",{"onUpdate:modelValue":L[1]||(L[1]=fe=>i.value=fe),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Nt,i.value]])]),d.value?(O(),F("div",VL,[L[10]||(L[10]=h("span",null,"✅",-1)),h("span",null,"Un email a été envoyé à "+ce(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ve("",!0)])):s.value===2?(O(),F("div",OL,[h("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[L[11]||(L[11]=h("span",null,"✅",-1)),L[12]||(L[12]=h("span",null,"Adresse email vérifiée",-1)),h("button",{type:"button",onClick:A,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),h("div",null,[L[13]||(L[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),nt(h("input",{"onUpdate:modelValue":L[2]||(L[2]=fe=>o.value=fe),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Nt,o.value]])]),h("div",null,[L[14]||(L[14]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),nt(h("input",{"onUpdate:modelValue":L[3]||(L[3]=fe=>a.value=fe),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Nt,a.value]])]),h("button",{onClick:U,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(O(),F("span",LL,"⏳")):(O(),F("span",FL,"🔒")),h("span",null,ce(l.value?"Association...":"Associer ce joueur"),1)],8,ML)])):ve("",!0),c.value?(O(),F("div",$L,ce(c.value),1)):ve("",!0),h("div",UL,[h("button",{onClick:L[4]||(L[4]=fe=>q.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),s.value===1?(O(),F("button",{key:0,onClick:T,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(O(),F("span",BL,"⏳")):(O(),F("span",qL,"✉️")),h("span",null,ce(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,jL)):ve("",!0)])])])):ve("",!0)}}},zL={class:"mt-4"},KL={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},PT={__name:"AccountBenefitsHint",setup(n){const e=k(!1);return(t,r)=>(O(),F("div",zL,[h("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=h("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),h("span",{class:At(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(O(),F("div",KL,r[2]||(r[2]=[h("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),h("div",null,[Vt("• "),h("span",{class:"text-blue-300"},"Protégez vos saisies :"),Vt(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),h("div",null,[Vt("• "),h("span",{class:"text-blue-300"},"Notifications :"),Vt(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),h("div",null,[Vt("• "),h("span",{class:"text-blue-300"},"Saisie simplifiée :"),Vt(" votre joueur reste toujours en haut de la liste")],-1)]))):ve("",!0)]))}},GL={class:"text-center mb-6"},HL={class:"text-2xl font-bold text-white mb-2"},WL={class:"text-lg text-gray-300"},QL={class:"mb-6"},JL={class:"flex items-center space-x-3"},YL={class:"text-2xl"},XL={class:"font-semibold text-white"},ZL={class:"text-sm text-gray-300"},eF={key:0,class:"mb-6"},tF={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},nF={class:"text-red-300 text-sm"},rF={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},sF={class:"text-green-300 text-sm"},iF={class:"flex justify-center gap-3"},oF=["disabled"],aF={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=k(!1),i=k(!1),o=k(!1),a=k(""),l=k(""),c=k(!1);tl();const d=k(!1);Oe(()=>!1),Oe(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var U;if((U=t.player)!=null&&U.id){s.value=await Ti(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:q}=await Xt(()=>Promise.resolve().then(()=>gc),void 0);i.value=q(t.player.id)}catch{i.value=!1}}}function y(){var U;a.value="";try{if((U=t.player)!=null&&U.id&&Ao(t.player.id)){T();return}}catch{}d.value=!0}async function T(){o.value=!0,a.value="",l.value="";try{const U=await bT(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,U.email&&(email.value=U.email),r("update")}catch(U){logger.error("Erreur lors de la désactivation de la protection",U),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function A(){d.value=!1,T()}function P(){r("close")}return St(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),St(()=>t.show,U=>{U&&t.player&&(a.value="",l.value="",d.value=!1,g(),t.onboarding&&pn(()=>{}))}),(U,q)=>{var L;return O(),F(dt,null,[n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:P},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:q[1]||(q[1]=xt(()=>{},["stop"]))},[h("button",{onClick:P,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",GL,[q[4]||(q[4]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),h("h2",HL,ce(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),h("p",WL,ce((L=n.player)==null?void 0:L.name),1)]),h("div",QL,[h("div",{class:At(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[h("div",JL,[h("span",YL,ce(s.value?"🔒":"🔓"),1),h("div",null,[h("div",XL,ce(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),h("div",ZL,ce(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ve("",!0):(O(),F("div",eF,q[5]||(q[5]=[h("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(O(),F("div",tF,[h("div",nF,ce(a.value),1)])):ve("",!0),l.value?(O(),F("div",rF,[h("div",sF,ce(l.value),1)])):ve("",!0),h("div",iF,[h("button",{onClick:P,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),s.value?(O(),F("button",{key:1,onClick:y,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,oF)):(O(),F("button",{key:0,onClick:q[0]||(q[0]=z=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte "))]),s.value?ve("",!0):(O(),Pd(PT,{key:3}))])])):ve("",!0),ct(ST,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:q[2]||(q[2]=z=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),ct($g,{show:d.value,player:n.player,seasonId:n.seasonId,onClose:q[3]||(q[3]=z=>d.value=!1),onVerified:A},null,8,["show","player","seasonId"])],64)}}};const lF=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},uF={class:"relative text-center p-6 pb-4 border-b border-white/10"},cF={class:"text-2xl md:text-3xl font-bold text-white mb-1"},dF={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},hF={class:"grid grid-cols-3 gap-3 md:gap-4"},fF={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},pF={class:"text-xl md:text-2xl font-bold text-white"},mF={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},gF={class:"text-xl md:text-2xl font-bold text-white"},vF={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},yF={class:"text-xl md:text-2xl font-bold text-white"},_F={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},bF={key:0,class:"md:hidden mt-3 space-y-2"},wF={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},IF={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},EF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},TF={class:"mb-6"},xF={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=k(!1),o=k(""),a=k(null),l=k(!1),c=k(!1),d=k(null),f=k(!1),g=k(!1),y=k(!1);function T(){s("close")}function A(){var I;o.value=((I=r.player)==null?void 0:I.name)||"",i.value=!0,pn(()=>{a.value&&a.value.focus()})}function P(){i.value=!1,o.value=""}async function U(){var w,C;if(!o.value.trim())return;if(await Ti((w=r.player)==null?void 0:w.id,r.seasonId)){Ao((C=r.player)==null?void 0:C.id)?q():(d.value="update",c.value=!0);return}q()}function q(){var I;s("update",{playerId:(I=r.player)==null?void 0:I.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function L(){var w,C;if(await Ti((w=r.player)==null?void 0:w.id,r.seasonId)){Ao((C=r.player)==null?void 0:C.id)?z():(d.value="delete",c.value=!0);return}z()}function z(){var I;s("delete",(I=r.player)==null?void 0:I.id)}function fe(){s("refresh")}function me(I){d.value==="update"?q():d.value==="delete"&&z(),d.value=null}St(()=>r.show,I=>{var w;I||(i.value=!1,o.value="",d.value=null,l.value=!1),I&&((w=r.player)!=null&&w.id)&&(Ti(r.player.id,r.seasonId).then(C=>{g.value=!!C}),Xt(()=>Promise.resolve().then(()=>gc),void 0).then(C=>{try{y.value=!!C.isPlayerPasswordCached(r.player.id)}catch{y.value=!1}}))}),e({openProtection(){l.value=!0}});const x=k({position:null});return St(()=>r.show,I=>{I&&r.onboardingStep===4?pn(()=>{const w=document.querySelectorAll("button");let C=null;if(w.forEach(V=>{!C&&V.textContent&&V.textContent.includes("Protection")&&(C=V)}),C){const V=C.getBoundingClientRect();x.value.position={x:Math.round(V.right+8),y:Math.round(V.top+window.scrollY-4)}}}):I||(x.value.position=null)}),(I,w)=>{var C;return O(),F(dt,null,[n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:T},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:w[5]||(w[5]=xt(()=>{},["stop"]))},[h("div",uF,[h("button",{onClick:T,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),w[10]||(w[10]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),h("h2",cF,ce((C=n.player)==null?void 0:C.name),1)]),h("div",dF,[h("div",null,[h("div",hF,[h("div",fF,[h("div",pF,ce(r.stats.availability),1),w[11]||(w[11]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),h("div",mF,[h("div",gF,ce(r.stats.selection),1),w[12]||(w[12]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),h("div",vF,[h("div",yF,ce(r.stats.ratio),1),w[13]||(w[13]=h("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),h("div",_F,[h("button",{onClick:A,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},w[14]||(w[14]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:w[0]||(w[0]=V=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[h("span",null,ce(g.value?"🔓":"🔒"),1),h("span",null,ce(g.value?"Déverrouiller":"Verrouiller"),1)]),h("button",{onClick:L,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},w[15]||(w[15]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:T,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(O(),F("div",bF,[h("button",{onClick:w[1]||(w[1]=V=>{A(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Renommer "),h("button",{onClick:w[2]||(w[2]=V=>{L(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):ve("",!0)]),h("div",wF,[h("button",{onClick:w[3]||(w[3]=V=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ce(g.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),h("button",{onClick:T,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),h("button",{onClick:w[4]||(w[4]=V=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):ve("",!0),i.value?(O(),F("div",IF,[h("div",EF,[w[17]||(w[17]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),h("div",TF,[w[16]||(w[16]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),nt(h("input",{"onUpdate:modelValue":w[6]||(w[6]=V=>o.value=V),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Mn(P,["esc"]),Mn(U,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Nt,o.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:P,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:U,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ve("",!0),ct(aF,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:w[7]||(w[7]=V=>l.value=!1),onUpdate:fe,onOnboardingFinished:w[8]||(w[8]=V=>I.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),ct($g,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:w[9]||(w[9]=V=>c.value=!1),onVerified:me},null,8,["show","player","seasonId"])],64)}}},AF=lF(xF,[["__scopeId","data-v-731bb3fb"]]),SF={class:"relative p-6 pb-4 border-b border-white/10"},PF={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},RF={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=xt(()=>{},["stop"]))},[h("div",SF,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),h("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=Jn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),h("div",PF,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ve("",!0)}},CF={class:"relative text-center p-6 pb-4 border-b border-white/10"},kF={class:"text-2xl md:text-3xl font-bold text-white mb-1"},DF={class:"text-sm md:text-base text-purple-300"},NF={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},VF={class:"mb-3"},OF={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},MF={key:0,class:"flex items-center justify-between gap-2"},LF=["title"],FF={key:0,class:"text-purple-400 mr-2"},$F={key:1,class:"text-green-400 mr-2"},UF={key:2,class:"text-red-400 mr-2"},jF={key:3,class:"text-gray-400 mr-2"},BF=["onClick"],qF={key:1,class:"flex items-center justify-center"},zF=["onChange"],KF=["value"],GF=["onClick"],HF={key:0,class:"mb-3"},WF={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},QF={class:"p-3 md:p-3 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},JF={class:"text-yellow-300 text-lg md:text-xl font-semibold"},YF={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},XF={class:"text-green-400 text-lg md:text-xl font-semibold"},ZF={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},e4={class:"text-purple-400 text-lg md:text-xl font-semibold"},t4={key:1,class:"mb-3"},n4={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},r4={class:"flex-1"},s4={class:"text-blue-300 text-sm font-medium"},i4={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},o4=["disabled","title"],a4=["disabled"],l4=["disabled"],u4={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","update-selection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=k(!1),o=k("Copier le message"),a=k(!1),l=k(!1),c=k(""),d=k(!1),f=k(!1),g=Oe(()=>{var re;return((re=r.event)==null?void 0:re.playerCount)||6}),y=k([]),T=k(null),A=Oe(()=>Array.from({length:g.value},(ee,je)=>{var Xe;return((Xe=r.currentSelection)==null?void 0:Xe[je])||null})),P=Oe(()=>JSON.stringify(y.value)!==JSON.stringify(A.value)),U=Oe(()=>(r.players||[]).map(re=>re.name).filter(re=>{var ee;return((ee=r.playerAvailability)==null?void 0:ee[re])===!0}).sort((re,ee)=>re.localeCompare(ee,"fr",{sensitivity:"base"})));function q(re){const ee=new Set(y.value.filter(Boolean)),je=y.value[re];return je&&ee.delete(je),U.value.filter(Xe=>!ee.has(Xe))}function L(re){T.value=re}function z(){T.value=null}function fe(re,ee){var Xe;const je=((Xe=re==null?void 0:re.target)==null?void 0:Xe.value)||"";je&&(y.value[ee]=je),T.value=null}function me(re){y.value[re]=null}Oe(()=>(q(-1).length<g.value,""));const x=Oe(()=>r.currentSelection&&r.currentSelection.length>0),I=Oe(()=>{var Xe;if(!x.value)return!1;const re=r.currentSelection.some(ht=>!Y(ht)),ee=((Xe=r.event)==null?void 0:Xe.playerCount)||6,je=r.availableCount<ee;return re||je});Oe(()=>{var je;if(!I.value)return"";const re=r.currentSelection.filter(Xe=>!Y(Xe)),ee=((je=r.event)==null?void 0:je.playerCount)||6;return re.length>0?re.length===1?`${re[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${re.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<ee?`Seulement ${r.availableCount} joueurs disponibles pour ${ee} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),Oe(()=>{if(!r.event||!x.value)return"";const re=w(r.event.date),ee=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${re} : ${ee}`}),St(()=>r.show,re=>{if(re){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const ee=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],je=g.value;y.value=Array.from({length:je},(Xe,ht)=>ee[ht]||null),T.value=null}}),St([g,()=>r.currentSelection,()=>{var re;return(re=r.event)==null?void 0:re.id}],()=>{if(!r.show)return;const re=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],ee=g.value,je=Array.from({length:ee},(Xe,ht)=>re[ht]||y.value[ht]||null);y.value=je.slice(0,ee)});function w(re){var je;return re?(typeof re=="string"?new Date(re):((je=re.toDate)==null?void 0:je.call(re))||re).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function C(){s("selection")}function V(){s("perfect")}function B(){var ee;if(!((ee=r.event)!=null&&ee.id))return;const re=y.value.filter(Boolean);s("update-selection",{eventId:r.event.id,players:re})}function R(){s("close")}function It(){a.value=!0}function vt(){f.value=!0}function Y(re){return r.playerAvailability[re]===!0}function j(re){return r.playerAvailability[re]===!1}function ne(re){return r.currentSelection.includes(re)&&Y(re)}function Ke(re=!1,ee=!1){if(d.value=re,re){const je=w(r.event.date),Xe=r.currentSelection.join(", ");ee?c.value=`Sélection mise à jour pour ${r.event.title} du ${je} : ${Xe}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${je} : ${Xe}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function Be(){l.value=!1}e({showSuccess:Ke});function Ge(re){s("send-notifications",re)}return(re,ee)=>{var je,Xe,ht;return O(),F(dt,null,[n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:R},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:ee[1]||(ee[1]=xt(()=>{},["stop"]))},[h("div",CF,[h("button",{onClick:R,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),ee[5]||(ee[5]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("h2",kF,"Sélection pour "+ce((je=n.event)==null?void 0:je.title),1),h("p",DF,ce(w((Xe=n.event)==null?void 0:Xe.date)),1),h("div",{class:"mt-3"},[h("button",{onClick:vt,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},ee[4]||(ee[4]=[h("span",null,"❓",-1),Vt(),h("span",null,"Kezako ?",-1)]))])]),h("div",NF,[h("div",VF,[ee[8]||(ee[8]=h("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),h("div",OF,[(O(!0),F(dt,null,wr(y.value,(D,$)=>(O(),F("div",{key:"sel-slot-"+$,class:At(["relative p-3 rounded-lg border text-center transition-colors",D?["bg-gradient-to-r",j(D)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":Y(D)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[D?(O(),F("div",MF,[h("div",{class:"flex-1 text-white font-medium truncate",title:D},[ne(D)?(O(),F("span",FF,"🎭")):Y(D)?(O(),F("span",$F,"✅")):j(D)?(O(),F("span",UF,"❌")):(O(),F("span",jF,"–")),Vt(" "+ce(D),1)],8,LF),h("button",{onClick:X=>me($),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,BF)])):(O(),F("div",qF,[T.value===$?(O(),F("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:X=>fe(X,$),onBlur:ee[0]||(ee[0]=X=>z())},[ee[6]||(ee[6]=h("option",{value:""},"— Choisir —",-1)),(O(!0),F(dt,null,wr(q($),X=>(O(),F("option",{key:X,value:X},ce(X),9,KF))),128))],40,zF)):(O(),F("button",{key:1,onClick:X=>L($),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},ee[7]||(ee[7]=[h("span",{class:"text-lg"},"＋",-1),h("span",{class:"text-sm"},"Ajouter",-1)]),8,GF))]))],2))),128))])]),I.value?(O(),F("div",HF,ee[9]||(ee[9]=[h("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[h("div",{class:"text-yellow-400"},"⚠️"),h("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):ve("",!0),h("div",WF,[h("div",QF,[h("div",JF,ce(Math.max((((ht=n.event)==null?void 0:ht.playerCount)||6)-n.selectedCount,0)),1),ee[10]||(ee[10]=h("div",{class:"text-xs md:text-sm text-yellow-300"},"manquants",-1))]),h("div",YF,[h("div",XF,ce(n.availableCount),1),ee[11]||(ee[11]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),h("div",ZF,[h("div",e4,ce(n.selectedCount),1),ee[12]||(ee[12]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(O(),F("div",t4,[h("div",n4,[ee[14]||(ee[14]=h("div",{class:"text-blue-400 text-xl"},"✨",-1)),h("div",r4,[h("p",s4,ce(c.value),1)]),h("button",{onClick:Be,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},ee[13]||(ee[13]=[h("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ve("",!0)]),h("div",i4,[h("button",{onClick:C,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":x.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},ee[15]||(ee[15]=[Vt(" ✨ "),h("span",{class:"hidden sm:inline"},"Sélection Auto",-1),h("span",{class:"sm:hidden"},"Auto",-1)]),8,o4),h("button",{onClick:B,disabled:!P.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",title:"Enregistrer cette composition manuelle"},ee[16]||(ee[16]=[Vt(" 💾 "),h("span",{class:"hidden sm:inline"},"Enregistrer",-1),h("span",{class:"sm:hidden"},"Save",-1)]),8,a4),h("button",{onClick:It,disabled:!x.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},ee[17]||(ee[17]=[Vt(" 📣 "),h("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,l4),x.value?(O(),F("button",{key:0,onClick:V,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap"},ee[18]||(ee[18]=[Vt(" 👍 "),h("span",{class:"hidden sm:inline"},"Fermer",-1)]))):ve("",!0)])])])):ve("",!0),ct(AT,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:ee[2]||(ee[2]=D=>a.value=!1),onSendNotifications:Ge},null,8,["show","event","season-id","season-slug","players","selected-players"]),ct(RF,{show:f.value,onClose:ee[3]||(ee[3]=D=>f.value=!1)},null,8,["show"])],64)}}},c4={class:"flex items-center justify-center gap-2"},d4=["title"],h4=["title"],f4=["title"],p4=["title"],m4=["title"],e0={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=k(!1),i=Oe(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Oe(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(O(),F("div",{class:At(["flex items-center justify-center transition-all duration-200",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-white/10",n.compact?"min-h-0 p-1 md:p-2":"min-h-20 p-3 md:p-5"]]),onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[h("div",c4,[i.value&&s.value?(O(),F("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ce(n.chancePercent)+"% ",9,d4)):(O(),F(dt,{key:1},[n.isSelected&&n.isAvailable===!0?(O(),F("span",{key:0,class:At([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," 🎭 ",10,h4)):n.isAvailable===!0?(O(),F("span",{key:1,class:At([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," ✅ ",10,f4)):n.isAvailable===!1?(O(),F("span",{key:2,class:At([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," ❌ ",10,p4)):(O(),F("span",{key:3,class:At(["text-gray-500 transition-colors duration-200",[n.compact?"text-base md:text-lg":"text-xl md:text-2xl",n.disabled?"":"hover:text-white"]]),title:o.value}," – ",10,m4))],64))])],34))}},g4={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},v4={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},y4={class:"text-2xl md:text-3xl font-bold text-white mb-3"},_4={class:"text-gray-300 mb-6"},b4={class:"flex flex-col items-stretch justify-center gap-3"},w4=["value"],I4={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Oe(()=>`${s}/season/${t.seasonSlug}`),o=k(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Oe(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Oe(()=>a.value>0),c=k(l.value);St(a,P=>{c.value=P>0});const d=Oe(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Oe(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function T(){var P;try{(P=navigator.clipboard)==null||P.writeText(i.value)}catch{}r("copy-link")}async function A(){try{if(t.seasonId){const{db:P}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0),{doc:U,updateDoc:q}=await Xt(()=>import("./index.esm-b15ef6e4.js"),[]);await q(U(P,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(P,U)=>l.value&&c.value?(O(),F("div",g4,[h("div",v4,[U[1]||(U[1]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎬")],-1)),h("h2",y4,ce(d.value),1),h("p",_4,ce(f.value),1),h("div",b4,[a.value===1?(O(),F("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(O(),F("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(O(),F(dt,{key:2},[h("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:U[0]||(U[0]=q=>q.target.select())},null,40,w4),h("div",{class:"flex gap-3 justify-center"},[h("button",{onClick:T,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),h("button",{onClick:A,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ve("",!0)])])])):ve("",!0)}},RT="@firebase/installations",Ug="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CT=1e4,kT=`w:${Ug}`,DT="FIS_v2",E4="https://firebaseinstallations.googleapis.com/v1",T4=60*60*1e3,x4="installations",A4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Lo=new $o(x4,A4,S4);function NT(n){return n instanceof as&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VT({projectId:n}){return`${E4}/projects/${n}/installations`}function OT(n){return{token:n.token,requestStatus:2,expiresIn:R4(n.expiresIn),creationTime:Date.now()}}async function MT(n,e){const r=(await e.json()).error;return Lo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function LT({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function P4(n,{refreshToken:e}){const t=LT(n);return t.append("Authorization",C4(e)),t}async function FT(n){const e=await n();return e.status>=500&&e.status<600?n():e}function R4(n){return Number(n.replace("s","000"))}function C4(n){return`${DT} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k4({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=VT(n),s=LT(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:DT,appId:n.appId,sdkVersion:kT},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await FT(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:OT(c.authToken)}}else throw await MT("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $T(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D4(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N4=/^[cdef][\w-]{21}$/,Bp="";function V4(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=O4(n);return N4.test(t)?t:Bp}catch{return Bp}}function O4(n){return D4(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zh(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UT=new Map;function jT(n,e){const t=Zh(n);BT(t,e),M4(t,e)}function BT(n,e){const t=UT.get(n);if(t)for(const r of t)r(e)}function M4(n,e){const t=L4();t&&t.postMessage({key:n,fid:e}),F4()}let wo=null;function L4(){return!wo&&"BroadcastChannel"in self&&(wo=new BroadcastChannel("[Firebase] FID Change"),wo.onmessage=n=>{BT(n.data.key,n.data.fid)}),wo}function F4(){UT.size===0&&wo&&(wo.close(),wo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $4="firebase-installations-database",U4=1,Fo="firebase-installations-store";let jf=null;function jg(){return jf||(jf=gh($4,U4,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Fo)}}})),jf}async function th(n,e){const t=Zh(n),s=(await jg()).transaction(Fo,"readwrite"),i=s.objectStore(Fo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&jT(n,e.fid),e}async function qT(n){const e=Zh(n),r=(await jg()).transaction(Fo,"readwrite");await r.objectStore(Fo).delete(e),await r.done}async function ef(n,e){const t=Zh(n),s=(await jg()).transaction(Fo,"readwrite"),i=s.objectStore(Fo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&jT(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bg(n){let e;const t=await ef(n.appConfig,r=>{const s=j4(r),i=B4(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Bp?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function j4(n){const e=n||{fid:V4(),registrationStatus:0};return zT(e)}function B4(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Lo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=q4(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:z4(n)}:{installationEntry:e}}async function q4(n,e){try{const t=await k4(n,e);return th(n.appConfig,t)}catch(t){throw NT(t)&&t.customData.serverCode===409?await qT(n.appConfig):await th(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function z4(n){let e=await t0(n.appConfig);for(;e.registrationStatus===1;)await $T(100),e=await t0(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Bg(n);return r||t}return e}function t0(n){return ef(n,e=>{if(!e)throw Lo.create("installation-not-found");return zT(e)})}function zT(n){return K4(n)?{fid:n.fid,registrationStatus:0}:n}function K4(n){return n.registrationStatus===1&&n.registrationTime+CT<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G4({appConfig:n,heartbeatServiceProvider:e},t){const r=H4(n,t),s=P4(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:kT,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await FT(()=>fetch(r,a));if(l.ok){const c=await l.json();return OT(c)}else throw await MT("Generate Auth Token",l)}function H4(n,{fid:e}){return`${VT(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qg(n,e=!1){let t;const r=await ef(n.appConfig,i=>{if(!KT(i))throw Lo.create("not-registered");const o=i.authToken;if(!e&&J4(o))return i;if(o.requestStatus===1)return t=W4(n,e),i;{if(!navigator.onLine)throw Lo.create("app-offline");const a=X4(i);return t=Q4(n,a),a}});return t?await t:r.authToken}async function W4(n,e){let t=await n0(n.appConfig);for(;t.authToken.requestStatus===1;)await $T(100),t=await n0(n.appConfig);const r=t.authToken;return r.requestStatus===0?qg(n,e):r}function n0(n){return ef(n,e=>{if(!KT(e))throw Lo.create("not-registered");const t=e.authToken;return Z4(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function Q4(n,e){try{const t=await G4(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await th(n.appConfig,r),t}catch(t){if(NT(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await qT(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await th(n.appConfig,r)}throw t}}function KT(n){return n!==void 0&&n.registrationStatus===2}function J4(n){return n.requestStatus===2&&!Y4(n)}function Y4(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+T4}function X4(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function Z4(n){return n.requestStatus===1&&n.requestTime+CT<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e3(n){const e=n,{installationEntry:t,registrationPromise:r}=await Bg(e);return r?r.catch(console.error):qg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t3(n,e=!1){const t=n;return await n3(t),(await qg(t,e)).token}async function n3(n){const{registrationPromise:e}=await Bg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r3(n){if(!n||!n.options)throw Bf("App Configuration");if(!n.name)throw Bf("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Bf(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Bf(n){return Lo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GT="installations",s3="installations-internal",i3=n=>{const e=n.getProvider("app").getImmediate(),t=r3(e),r=Li(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},o3=n=>{const e=n.getProvider("app").getImmediate(),t=Li(e,GT).getImmediate();return{getId:()=>e3(t),getToken:s=>t3(t,s)}};function a3(){is(new Ur(GT,i3,"PUBLIC")),is(new Ur(s3,o3,"PRIVATE"))}a3();Er(RT,Ug);Er(RT,Ug,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l3="/firebase-messaging-sw.js",u3="/firebase-cloud-messaging-push-scope",HT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",c3="https://fcmregistrations.googleapis.com/v1",WT="google.c.a.c_id",d3="google.c.a.c_l",h3="google.c.a.ts",f3="google.c.a.e";var r0;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(r0||(r0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var zu;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(zu||(zu={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vs(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function p3(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qf="fcm_token_details_db",m3=5,s0="fcm_token_object_Store";async function g3(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(qf))return null;let e=null;return(await gh(qf,m3,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(s0))return;const l=o.objectStore(s0),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const d=c;if(!d.auth||!d.p256dh||!d.endpoint)return;e={token:d.fcmToken,createTime:(a=d.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:d.auth,p256dh:d.p256dh,endpoint:d.endpoint,swScope:d.swScope,vapidKey:typeof d.vapidKey=="string"?d.vapidKey:vs(d.vapidKey)}}}else if(s===3){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:vs(d.auth),p256dh:vs(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:vs(d.vapidKey)}}}else if(s===4){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:vs(d.auth),p256dh:vs(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:vs(d.vapidKey)}}}}}})).close(),await Sf(qf),await Sf("fcm_vapid_details_db"),await Sf("undefined"),v3(e)?e:null}function v3(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y3="firebase-messaging-database",_3=1,Ku="firebase-messaging-store";let zf=null;function QT(){return zf||(zf=gh(y3,_3,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ku)}}})),zf}async function b3(n){const e=JT(n),r=await(await QT()).transaction(Ku).objectStore(Ku).get(e);if(r)return r;{const s=await g3(n.appConfig.senderId);if(s)return await zg(n,s),s}}async function zg(n,e){const t=JT(n),s=(await QT()).transaction(Ku,"readwrite");return await s.objectStore(Ku).put(e,t),await s.done,e}function JT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w3={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},er=new $o("messaging","Messaging",w3);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I3(n,e){const t=await Gg(n),r=YT(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(Kg(n.appConfig),s)).json()}catch(o){throw er.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw er.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw er.create("token-subscribe-no-token");return i.token}async function E3(n,e){const t=await Gg(n),r=YT(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${Kg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw er.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw er.create("token-update-failed",{errorInfo:o})}if(!i.token)throw er.create("token-update-no-token");return i.token}async function T3(n,e){const r={method:"DELETE",headers:await Gg(n)};try{const i=await(await fetch(`${Kg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw er.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw er.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Kg({projectId:n}){return`${c3}/projects/${n}/registrations`}async function Gg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function YT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==HT&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x3=7*24*60*60*1e3;async function A3(n){const e=await P3(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:vs(e.getKey("auth")),p256dh:vs(e.getKey("p256dh"))},r=await b3(n.firebaseDependencies);if(r){if(R3(r.subscriptionOptions,t))return Date.now()>=r.createTime+x3?S3(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await T3(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return i0(n.firebaseDependencies,t)}else return i0(n.firebaseDependencies,t)}async function S3(n,e){try{const t=await E3(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await zg(n.firebaseDependencies,r),t}catch(t){throw t}}async function i0(n,e){const r={token:await I3(n,e),createTime:Date.now(),subscriptionOptions:e};return await zg(n,r),r.token}async function P3(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:p3(e)})}function R3(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return C3(e,n),k3(e,n),D3(e,n),e}function C3(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function k3(n,e){e.data&&(n.data=e.data)}function D3(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N3(n){return typeof n=="object"&&!!n&&WT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */V3("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function V3(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O3(n){if(!n||!n.options)throw Kf("App Configuration Object");if(!n.name)throw Kf("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Kf(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Kf(n){return er.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M3{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=O3(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L3(n){try{n.swRegistration=await navigator.serviceWorker.register(l3,{scope:u3}),n.swRegistration.update().catch(()=>{})}catch(e){throw er.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F3(n,e){if(!e&&!n.swRegistration&&await L3(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw er.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $3(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=HT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XT(n,e){if(!navigator)throw er.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw er.create("permission-blocked");return await $3(n,e==null?void 0:e.vapidKey),await F3(n,e==null?void 0:e.serviceWorkerRegistration),A3(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U3(n,e,t){const r=j3(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[WT],message_name:t[d3],message_time:t[h3],message_device_time:Math.floor(Date.now()/1e3)})}function j3(n){switch(n){case zu.NOTIFICATION_CLICKED:return"notification_open";case zu.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B3(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===zu.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(o0(t)):n.onMessageHandler.next(o0(t)));const r=t.data;N3(r)&&r[f3]==="1"&&await U3(n,t.messageType,r)}const a0="@firebase/messaging",l0="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q3=n=>{const e=new M3(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>B3(e,t)),e},z3=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>XT(e,r)}};function K3(){is(new Ur("messaging",q3,"PUBLIC")),is(new Ur("messaging-internal",z3,"PRIVATE")),Er(a0,l0),Er(a0,l0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZT(){try{await Lb()}catch{return!1}return typeof window<"u"&&cm()&&Z1()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G3(n=fm()){return ZT().then(e=>{if(!e)throw er.create("unsupported-browser")},e=>{throw er.create("indexed-db-unsupported")}),Li(Ne(n),"messaging").getImmediate()}async function H3(n,e){return n=Ne(n),XT(n,e)}K3();const u0="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function ex(){try{return await ZT()}catch{return!1}}async function W3(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.ready;if(n!=null&&n.active&&n.active.state==="activated")return n;const e=(n==null?void 0:n.installing)||(n==null?void 0:n.waiting);return!e||e.state==="activated"||await new Promise(t=>{const r=()=>{e.state==="activated"&&(e.removeEventListener("statechange",r),t())};e.addEventListener("statechange",r)}),n}async function Q3(n){var i;if(!await ex()||await Notification.requestPermission()!=="granted")return null;const t=G3(Qh);let r=n||await W3();const s=await H3(t,r?{vapidKey:u0,serviceWorkerRegistration:r}:{vapidKey:u0});try{const o=((i=gt==null?void 0:gt.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await Zt(xe(ae,"userPushTokens",o),{tokens:QD(s),lastToken:s,email:o,updatedAt:qi(),userAgent:navigator.userAgent},{merge:!0})}catch{}return s}const J3={class:"flex justify-center gap-2 mb-4"},Y3={class:"space-y-3"},X3={key:0},Z3={key:0,class:"text-sm text-gray-400"},e$={key:1,class:"space-y-2"},t$={class:"flex items-center justify-between gap-3"},n$={class:"truncate"},r$={class:"text-white font-semibold"},s$={class:"text-gray-400 text-xs"},i$=["onClick"],o$={key:1,class:"text-sm text-gray-300 space-y-3"},a$={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},l$={class:"flex items-center justify-between"},u$={class:"flex items-center gap-2"},c$={class:"flex items-center justify-between"},d$={class:"flex items-center gap-2"},h$={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},f$={class:"flex items-center justify-between"},p$={class:"flex items-center gap-2"},m$={class:"flex items-center justify-between"},g$={class:"flex items-center gap-2"},v$={class:"flex items-center justify-between pt-2 border-t border-white/10"},y$=["disabled"],_$={key:1,class:"inline-flex items-center text-xs text-gray-300"},b$={class:"flex items-center justify-between pt-2"},w$=["disabled"],I$={key:0,class:"text-xs text-green-300"},E$={key:1,class:"text-xs text-red-300"},T$={key:2,class:"text-[10px] text-gray-400 break-all"},x$={class:"text-[10px] text-gray-500"},A$={class:"text-right"},S$=["disabled"],P$={key:0,class:"text-xs text-red-300"},R$={key:1,class:"text-xs text-green-300"},C$={key:2,class:"flex flex-col gap-3"},k$={class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},D$={class:"flex items-center gap-2"},N$=["disabled"],V$={key:0,class:"mt-2 text-xs text-red-300"},O$={key:1,class:"mt-2 text-xs text-green-300"},M$={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","manage-player","change-password","logout-device","delete-account"],setup(n,{emit:e}){const t=n,r=e,s=k(""),i=k([]),o=k("players");function a(Y){return["px-4 py-2 rounded-full text-sm transition-colors",o.value===Y?"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"]}function l(Y){return`${Y.seasonId||"global"}__${Y.playerId}`}async function c(){var Y;try{s.value=((Y=gt==null?void 0:gt.currentUser)==null?void 0:Y.email)||""}catch{}try{const j=s.value?await Fg(s.value):[],ne=[];for(const Ke of j){let Be=Ke.playerId;try{if(Ke.seasonId){const Ge=xe(ae,"seasons",Ke.seasonId,"players",Ke.playerId),re=await Gt(Ge);re.exists()&&(Be=re.data().name||Be)}}catch{}ne.push({...Ke,playerName:Be})}i.value=ne}catch{i.value=[]}}function d(){r("close")}St(()=>t.show,Y=>{Y&&(c(),B())}),Xn(()=>{t.show&&(c(),B())});const f=k(""),g=k(!1),y=k(""),T=k(""),A=k(!1);St(s,Y=>{f.value=Y||""}),St(f,Y=>{A.value=!!Y&&Y.includes("@")&&Y!==s.value});async function P(){if(A.value){g.value=!0,y.value="",T.value="";try{const Y=await hT({currentEmail:s.value,newEmail:f.value.trim()});await xT({toEmail:f.value.trim(),verifyUrl:Y.url,purpose:"account_email_update",displayName:"utilisateur"}),T.value=`Un email de vérification a été envoyé à ${f.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(Y){y.value=(Y==null?void 0:Y.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{g.value=!1}}}const U=k({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),q=k(!1),L=k(""),z=k(""),fe=k(!1),me=k(""),x=k(""),I=k(!1),w=k(localStorage.getItem("fcmToken")||""),C=k(!1),V=function(j){try{return j?j.length>20?j.slice(0,8)+"…"+j.slice(-6):j:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");async function B(){try{if(!s.value)return;const Y=xe(ae,"userPreferences",s.value),j=await Gt(Y);if(j.exists()){const ne=j.data()||{};U.value.notifyAvailability=ne.notifyAvailability!==!1,U.value.notifySelection=ne.notifySelection!==!1,U.value.notifySelectionPush=ne.notifySelectionPush!==!1,U.value.notifyAvailabilityPush=ne.notifyAvailabilityPush!==!1}else U.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function R(){if(s.value){fe.value=!0,x.value="",me.value="";try{await vc({toEmail:s.value,title:"Test Impro Selector",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),me.value="OK"}catch{x.value="Échec de l'envoi du test"}finally{fe.value=!1}}}async function It(){try{if(I.value=!0,!await ex()){x.value="Push non supporté sur cet appareil";return}const j=window.__swReg,ne=await Q3(j);if(ne){w.value=ne;try{localStorage.setItem("fcmToken",ne)}catch{}C.value=!0}}catch(Y){const j=typeof Notification<"u"?Notification.permission:"unknown",ne=Y&&(Y.message||Y.code)?` (${Y.message||Y.code})`:"";x.value=`Activation impossible – permission: ${j}${ne}`}finally{I.value=!1}}Xn(()=>{try{C.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken")}catch{C.value=!1}});async function vt(){if(s.value){q.value=!0,L.value="",z.value="";try{const Y=xe(ae,"userPreferences",s.value);await Zt(Y,{...U.value},{merge:!0}),z.value="Préférences sauvegardées"}catch{L.value="Impossible de sauvegarder vos préférences"}finally{q.value=!1}}}return(Y,j)=>n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:d},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:j[11]||(j[11]=xt(()=>{},["stop"]))},[h("button",{onClick:d,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),j[25]||(j[25]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Gérez votre compte et vos préférences</p></div>',1)),h("div",J3,[h("button",{onClick:j[0]||(j[0]=ne=>o.value="manage"),class:At(a("manage"))},"Gérer",2),h("button",{onClick:j[1]||(j[1]=ne=>o.value="notifications"),class:At(a("notifications"))},"Notifications",2),h("button",{onClick:j[2]||(j[2]=ne=>o.value="players"),class:At(a("players"))},"Joueurs",2)]),h("div",Y3,[o.value==="players"?(O(),F("div",X3,[j[12]||(j[12]=h("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(O(),F("div",Z3,"Aucun joueur associé pour le moment.")):(O(),F("ul",e$,[(O(!0),F(dt,null,wr(i.value,ne=>(O(),F("li",{key:l(ne),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[h("div",t$,[h("div",n$,[h("div",r$,ce(ne.seasonName||ne.seasonId||"—"),1),h("div",s$,"Joueur : "+ce(ne.playerName||"—"),1)]),h("button",{onClick:Ke=>Y.$emit("manage-player",ne),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,i$)])]))),128))]))])):o.value==="notifications"?(O(),F("div",o$,[h("div",a$,[j[15]||(j[15]=h("div",{class:"text-white font-semibold text-sm mb-1"},"Emails",-1)),h("div",l$,[h("label",u$,[nt(h("input",{type:"checkbox","onUpdate:modelValue":j[3]||(j[3]=ne=>U.value.notifyAvailability=ne),class:"w-4 h-4"},null,512),[[yi,U.value.notifyAvailability]]),j[13]||(j[13]=h("span",null,"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),h("div",c$,[h("label",d$,[nt(h("input",{type:"checkbox","onUpdate:modelValue":j[4]||(j[4]=ne=>U.value.notifySelection=ne),class:"w-4 h-4"},null,512),[[yi,U.value.notifySelection]]),j[14]||(j[14]=h("span",null,"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])]),h("div",h$,[j[21]||(j[21]=h("div",{class:"text-white font-semibold text-sm mb-1"},"Push (expérimental)",-1)),j[22]||(j[22]=h("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),h("div",f$,[h("label",p$,[nt(h("input",{type:"checkbox","onUpdate:modelValue":j[5]||(j[5]=ne=>U.value.notifySelectionPush=ne),class:"w-4 h-4"},null,512),[[yi,U.value.notifySelectionPush]]),j[16]||(j[16]=h("span",null,"Me notifier lorsque je suis concerné par une sélection",-1))])]),h("div",m$,[h("label",g$,[nt(h("input",{type:"checkbox","onUpdate:modelValue":j[6]||(j[6]=ne=>U.value.notifyAvailabilityPush=ne),class:"w-4 h-4"},null,512),[[yi,U.value.notifyAvailabilityPush]]),j[17]||(j[17]=h("span",null,"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),h("div",v$,[j[19]||(j[19]=h("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),C.value?(O(),F("span",_$,j[18]||(j[18]=[h("span",{class:"mr-1 text-emerald-400"},"✓",-1),Vt(" Actif ")]))):(O(),F("button",{key:0,onClick:It,disabled:I.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ce(I.value?"...":"Activer"),9,y$))]),h("div",b$,[j[20]||(j[20]=h("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),h("button",{onClick:R,disabled:fe.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ce(fe.value?"Envoi…":"Envoyer un test"),9,w$)]),me.value?(O(),F("div",I$,"Notification test envoyée (vérifiez votre appareil)")):ve("",!0),x.value?(O(),F("div",E$,ce(x.value),1)):ve("",!0),w.value?(O(),F("div",T$,"FCM token: "+ce(w.value),1)):ve("",!0),h("div",x$,"VAPID: "+ce(Zr(V)||"indisponible"),1)]),h("div",A$,[h("button",{onClick:vt,disabled:q.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},ce(q.value?"⏳":"Sauvegarder"),9,S$)]),L.value?(O(),F("div",P$,ce(L.value),1)):ve("",!0),z.value?(O(),F("div",R$,ce(z.value),1)):ve("",!0)])):(O(),F("div",C$,[h("div",k$,[j[23]||(j[23]=h("label",{class:"block text-xs text-gray-400 mb-2"},"Email",-1)),h("div",D$,[nt(h("input",{"onUpdate:modelValue":j[7]||(j[7]=ne=>f.value=ne),type:"email",class:"flex-1 p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"nouvel@email.com"},null,512),[[Nt,f.value]]),h("button",{onClick:P,disabled:!A.value||g.value,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},ce(g.value?"⏳":"Mettre à jour"),9,N$)]),y.value?(O(),F("div",V$,ce(y.value),1)):ve("",!0),T.value?(O(),F("div",O$,ce(T.value),1)):ve("",!0)]),j[24]||(j[24]=h("div",{class:"text-sm text-gray-400"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),h("button",{onClick:j[8]||(j[8]=ne=>Y.$emit("change-password")),class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500"},"Changer de mot de passe"),h("button",{onClick:j[9]||(j[9]=ne=>Y.$emit("logout-device")),class:"w-full px-4 py-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600"},"Déconnexion de cet appareil"),h("button",{onClick:j[10]||(j[10]=ne=>Y.$emit("delete-account")),class:"w-full px-4 py-3 rounded-lg bg-red-600 text-white hover:bg-red-500"},"Supprimer mon compte")]))]),h("div",{class:"mt-6 text-center"},[h("button",{onClick:d,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ve("",!0)}},L$={class:"space-y-4"},F$={class:"flex items-center justify-between"},$$={class:"flex items-center gap-2 text-gray-300 text-sm"},U$={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},j$={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},B$={class:"flex justify-center gap-3 mt-2"},q$=["disabled"],z$={key:0,class:"animate-spin"},K$={key:1},G$={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=k(""),s=k(""),i=k(!1),o=k(""),a=k(""),l=k(!0),c=Oe(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function d(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await tT(r.value.trim(),s.value),l.value)try{Oi.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await nT(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,y)=>n.show?(O(),F("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=T=>g.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=xt(()=>{},["stop"]))},[h("button",{onClick:y[0]||(y[0]=T=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),h("div",L$,[ct(PT),h("div",null,[y[7]||(y[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),nt(h("input",{"onUpdate:modelValue":y[1]||(y[1]=T=>r.value=T),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Nt,r.value]])]),h("div",null,[y[8]||(y[8]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),nt(h("input",{"onUpdate:modelValue":y[2]||(y[2]=T=>s.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Nt,s.value]])]),h("div",F$,[h("label",$$,[nt(h("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=T=>l.value=T),class:"w-4 h-4"},null,512),[[yi,l.value]]),y[9]||(y[9]=h("span",null,"Rester connecté sur cet appareil",-1))]),h("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(O(),F("div",U$,ce(o.value),1)):ve("",!0),a.value?(O(),F("div",j$,ce(a.value),1)):ve("",!0),h("div",B$,[h("button",{onClick:y[4]||(y[4]=T=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),h("button",{onClick:d,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(O(),F("span",z$,"⏳")):(O(),F("span",K$,"Se connecter"))],8,q$)])])])])):ve("",!0)}};const H$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},W$={ref:"pageHeaderRef",class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},Q$={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},J$={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},Y$={class:"hidden md:flex items-center gap-2"},X$={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},Z$={class:"flex items-stretch relative"},e6={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},t6={class:"flex-1 overflow-hidden"},n6=["data-event-id"],r6=["title","onClick"],s6={class:"flex flex-col items-center flex-1 justify-center"},i6={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},o6={key:0,class:"mt-1 text-xs text-gray-400"},a6=["title"],l6={class:"flex flex-col items-center mt-2"},u6={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},c6=["title","onClick"],d6=["title","onClick"],h6=["title","onClick"],f6=["title","onClick"],p6=["title","aria-label"],m6={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},g6={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},v6={key:0,class:"pointer-events-none"},y6={class:"flex items-center justify-between"},_6={key:1,class:"pointer-events-none"},b6={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},w6={class:"flex items-center justify-between"},I6={key:2,class:"pointer-events-none"},E6={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},T6={class:"flex items-center justify-between"},x6={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},A6=["data-player-id"],S6={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},P6={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},R6={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},C6={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},k6=["onClick","title"],D6={class:"group-hover:text-purple-300 transition-colors duration-200"},N6=["data-event-id"],V6={class:"border-t border-white/10"},O6={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},M6={class:"px-4 md:px-5 flex items-center"},L6=["data-event-id"],F6={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},$6={class:"text-center"},U6={class:"text-white text-lg"},j6={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},B6={class:"text-white/60 text-xs mt-2"},q6={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},z6={class:"flex items-center space-x-2"},K6={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},G6={class:"flex items-center space-x-2"},H6={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},W6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Q6={class:"mb-6"},J6={class:"mb-6"},Y6={class:"mb-6"},X6={class:"mb-6 flex items-center gap-3"},Z6={class:"mb-6"},eU={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},tU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},nU={class:"mb-6"},rU={class:"flex justify-end space-x-3"},sU={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},iU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},oU={class:"flex justify-end space-x-3"},aU={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},lU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},uU={class:"flex justify-end space-x-3"},cU={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},dU={class:"relative text-center p-6 pb-4 border-b border-white/10"},hU={class:"text-2xl md:text-3xl font-bold text-white mb-1"},fU={class:"text-sm md:text-base text-purple-300"},pU={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},mU={key:0,class:"mb-4 md:mb-6"},gU={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},vU={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},yU={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},_U={class:"text-xl md:text-2xl font-bold text-white"},bU={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},wU={class:"text-xl md:text-2xl font-bold text-white"},IU={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},EU={class:"text-xl md:text-2xl font-bold text-yellow-300"},TU={key:1,class:"mb-4 md:mb-6"},xU={class:"mb-3 flex items-center"},AU=["title"],SU={class:"truncate"},PU={class:"space-y-0.5"},RU={class:"flex items-center min-w-0 gap-1.5"},CU={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},kU={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},DU=["title"],NU={class:"flex-0 p-0"},VU={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},OU=["disabled","title"],MU=["title"],LU={key:2,class:"md:hidden mt-3 space-y-2"},FU=["disabled","title"],$U={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},UU={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},jU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BU={class:"mb-6"},qU={class:"mb-6"},zU={class:"mb-6"},KU={class:"mb-6 flex items-center gap-3"},GU={class:"mb-6"},HU={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},WU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},QU={class:"mb-6"},JU={class:"space-y-4"},YU=["disabled"],XU={key:0,class:"animate-spin"},ZU={key:1},e5={class:"mb-6 text-center"},t5={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},n5={class:"text-red-300 text-sm"},r5={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},s5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},i5={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},o5={class:"space-y-4"},a5={class:"mt-2 text-center"},l5={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},u5={class:"text-red-300 text-sm"},c5={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},d5=["disabled"],h5={key:0,class:"animate-spin"},f5={key:1},p5={class:"mb-6"},m5=["disabled"],g5={key:0,class:"animate-spin"},v5={key:1},y5={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_5={class:"text-red-300 text-sm"},b5={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},w5={class:"text-green-300 text-sm"},I5={class:"flex justify-center"},E5={class:"mb-6"},T5=["disabled"],x5={key:0,class:"animate-spin"},A5={key:1},S5={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},P5={class:"text-red-300 text-sm"},R5={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},C5={class:"text-green-300 text-sm"},k5={class:"flex justify-center"},D5={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},N5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},V5={class:"flex gap-3"},c0={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=el(),r=tl(),s=e.slug,i=k(""),o=k(""),a=k({}),l=k(!1),c=k(null),d=k(null),f=k(""),g=k(""),y=k(6),T=k(!1),A=k(""),P=k(null),U=k(null),q=k(null),L=k({position:null,side:null}),z=k({position:null}),fe=k({position:null}),me=k(!1),x=k(null),I=k(!1),w=k(null),C=k(null),V=k(!1),B=k(null),R=k(""),It=k(!1),vt=k(null),Y=k(""),j=k(""),ne=k(!1),Ke=k(null),Be=k(!1),Ge=k(null),re=k(""),ee=k(""),je=k(!1),Xe=k(null),ht=k(!1),D=k(!1),$=k(""),X=k(""),se=k(!1),ke=k(!1),$e=k(""),E=k(""),S=k(!1),M=k(null),oe=k(""),Z=k(!1),ue=k(!1),be=k(!1),ye=k(null),_e=k(null),pe=k(null),Se=k(0);function Te(){var _;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||qe.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const J=((_=gt==null?void 0:gt.currentUser)==null?void 0:_.email)||"";J&&Fg(J).then(async ie=>{const te=ie.filter(ge=>ge.seasonId===o.value);if(te.length>0){const ge=`seasonPreferredPlayer:${o.value}`,Ve=localStorage.getItem(ge);let We=[];if(Ve)if(Ve.startsWith("["))try{We=JSON.parse(Ve)||[]}catch{}else We=[Ve];const tt=new Set(We);te.forEach(Wt=>tt.add(Wt.playerId));const mt=Array.from(tt);localStorage.setItem(ge,JSON.stringify(mt))}}).catch(()=>{})}catch{}const N=localStorage.getItem(`startPlayerTour:${o.value}`);!m&&N&&(Se.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),pn(()=>{const J=document.querySelector('button[data-onboarding="add-player"]');if(J){J.scrollIntoView({behavior:"smooth",block:"end"});const ie=J.getBoundingClientRect(),te=document.getElementById("coachmark-add"),ge=280,Ve=100,We=(te==null?void 0:te.offsetWidth)||ge,tt=(te==null?void 0:te.offsetHeight)||Ve,mt=Math.round(ie.right+12);if(mt+We<=window.innerWidth-12){const rn=ie.top+ie.height/2-tt/2,ut=-14,Vn=12,dr=window.innerHeight-tt-12,Or=Math.max(Vn,Math.min(Math.round(rn+ut),dr));L.value={position:{x:mt,y:Or},side:"right"}}else{const rn=Math.round(ie.left+ie.width/2-We/2),ut=Math.round(ie.top-tt-8),Vn=8,dr=window.innerWidth-We-8;L.value={position:{x:Math.max(Vn,Math.min(rn,dr)),y:ut},side:null}}}}))}catch{}}const Pe=k(!1),De=k(null),Le=k(null),He=k(!1),Ze=k(null),Yt=k(!1),Bt=k(null),_n=k(!1),Lt=k(!1),mr=k(!1),jr=k(!1),cn=k(null);function kn(){Lt.value=!1}function zi(){try{const _=gt==null?void 0:gt.currentUser;if(!_||_.isAnonymous){let m=null;if(Js.value&&Js.value.size>0){const N=Js.value.values().next().value;m=et.value.find(J=>J.id===N)||null}m||(m=et.value[0]||null),jr.value=!0,m&&(cn.value=m);return}}catch{}Lt.value=!0}async function bl(){var _;try{const m=(_=gt==null?void 0:gt.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:N}=await Xt(()=>Promise.resolve().then(()=>Ii),void 0);await N(m),Fe.value=!0,pt.value="Email de réinitialisation envoyé.",setTimeout(()=>{Fe.value=!1},3e3)}catch{yr.value=!0,Ji.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{yr.value=!1},3e3)}}async function yc(){try{await EN(gt),kn(),Fe.value=!0,pt.value="Déconnecté de cet appareil.",setTimeout(()=>{Fe.value=!1},2500)}catch{yr.value=!0,Ji.value="Déconnexion impossible.",setTimeout(()=>{yr.value=!1},3e3)}}async function _c(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Ki(_){var m;kn();try{if(_.seasonId&&_.seasonId!==o.value){const N=xe(ae,"seasons",_.seasonId),ie=(await wt(Je(ae,"seasons"))).docs.find(ge=>ge.id===_.seasonId),te=(m=ie==null?void 0:ie.data())==null?void 0:m.slug;if(te){t.push(`/season/${te}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const N=et.value.find(J=>J.id===_.playerId);if(N){hn(N);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}Xn(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function wl(){pn(()=>{El()})}const Sr=k(new Set),tr=k(!0),Pr=k(0),Rr=k("Préparation de la grille"),Cr=k(e.eventId||null),qs=k(!1),Gi=k(null);St(()=>e.eventId,_=>{if(_)if(Cr.value=_,qe.value.length>0)Jg(_);else{const m=St(qe,N=>{N.length>0&&(Jg(_),m())},{immediate:!0})}});const nn=Oe(()=>et.value.map(_=>({..._,isProtected:Sr.value.has(_.id),email:null}))),bc=Oe(()=>Cr.value?Nn.value.findIndex(_=>_.id===Cr.value):-1);Oe(()=>{if(!Cr.value||bc.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Cr.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Dn=k(null),zs=k(!1),wc=k(!1),Il=k(0),Ks=k(null),zn=k(null),Go=k(null);function Kn(){const _=Dn.value;if(!_)return;const{scrollLeft:m,scrollWidth:N,clientWidth:J}=_;zs.value=m>2,wc.value=m<N-J-2}function El(){var _;try{Kn(),Il.value=((_=Dn.value)==null?void 0:_.scrollLeft)||0}catch{}}function Ho(_){const m=Dn.value;if(!m)return;let N=0;const J=m.querySelector("tbody tr td[data-event-id]");if(J)N=J.getBoundingClientRect().width;else if(zn!=null&&zn.value){const te=zn.value.querySelector(".col-event");te&&(N=te.getBoundingClientRect().width)}(!N||!isFinite(N))&&(N=m.clientWidth*.6);const ie=m.scrollLeft+_*N;m.scrollTo({left:ie,behavior:"smooth"})}const Br=k(null);k(0);const nr=k(!1),Hi=k(!1),ls=k(0);function Wo(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),gr(),Ho(_)}function Gs(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),nr.value)return;nr.value=!0,ls.value=_,Hi.value=!1;const N=Dn.value;if(!N)return;let J=0;const ie=N.querySelector("tbody tr td[data-event-id]");if(ie)J=ie.getBoundingClientRect().width;else if(zn!=null&&zn.value){const We=zn.value.querySelector(".col-event");We&&(J=We.getBoundingClientRect().width)}(!J||!isFinite(J))&&(J=N.clientWidth*.6);const te=J/6,ge=120,Ve=()=>{if(!nr.value||ls.value===0)return;Hi.value||(Hi.value=!0);const We=N.scrollLeft+ls.value*te;N.scrollTo({left:We,behavior:"auto"}),Br.value=window.setTimeout(Ve,ge)};Br.value=window.setTimeout(Ve,250)}function gr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=nr.value,N=Hi.value;if(nr.value=!1,Br.value&&(clearTimeout(Br.value),Br.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!N){const J=ls.value||0;J!==0&&Ho(J),ls.value=0;return}ls.value=0,m&&N&&Ic()}function Ic(){const _=Dn.value;if(!_)return;let m=0;const N=_.querySelector("tbody tr td[data-event-id]");if(N)m=N.getBoundingClientRect().width;else if(zn!=null&&zn.value){const ge=zn.value.querySelector(".col-event");ge&&(m=ge.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const J=_.scrollLeft,te=Math.round(J/m)*m;_.scrollTo({left:te,behavior:"smooth"})}function tf(_){P.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Fe.value=!0,pt.value="Nouveau joueur ajouté !",setTimeout(()=>{Fe.value=!1},3e3)}function Qo(){if(Se.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),N=document.getElementById("coachmark-add"),J=280,ie=100,te=N!=null&&N.offsetWidth&&N.offsetWidth>0?N.offsetWidth:J,ge=N!=null&&N.offsetHeight&&N.offsetHeight>0?N.offsetHeight:ie,Ve=Math.round(m.right+12);if(Ve+te<=window.innerWidth-12){const tt=m.top+m.height/2-ge/2,Wt=Tl(tt+-14,ge);L.value={position:{x:Ve,y:Wt},side:"right"}}else{const tt=Math.round(m.left+m.width/2-te/2),mt=Tl(m.top-ge-8,ge),Wt=8,rn=window.innerWidth-te-8;L.value={position:{x:Math.max(Wt,Math.min(tt,rn)),y:mt},side:null}}}function Tl(_,m){const N=pageHeaderRef==null?void 0:pageHeaderRef.value,J=N?Math.max(0,Math.round(N.getBoundingClientRect().height||0)):0,ie=Math.max(12,J+8),te=window.innerHeight-m-12;return Math.max(ie,Math.min(Math.round(_),te))}const vr=k(!1),us=k(null),qr=k(null),Jo=k({position:"fixed",top:"0px",right:"0px"});function xl(){try{const _=us.value;if(!_)return;const m=_.getBoundingClientRect(),N=8,J=Math.max(N,Math.round(m.bottom+N)),ie=Math.max(N,Math.round(window.innerWidth-m.right));Jo.value={position:"fixed",top:`${J}px`,right:`${ie}px`,zIndex:400}}catch{}}function Ec(){vr.value=!vr.value,vr.value&&pn(()=>xl())}function Yo(){vr.value=!1}function Al(_){if(!vr.value)return;const m=us.value,N=qr.value,J=m&&m.contains(_.target),ie=N&&N.contains(_.target);!J&&!ie&&(vr.value=!1)}function Xo(_){_.key==="Escape"&&Yo()}function Hs(){vr.value&&xl()}Xn(()=>{document.addEventListener("click",Al),document.addEventListener("keydown",Xo),window.addEventListener("scroll",Hs,{passive:!0}),window.addEventListener("resize",Hs)}),ba(()=>{document.removeEventListener("click",Al),document.removeEventListener("keydown",Xo),window.removeEventListener("scroll",Hs),window.removeEventListener("resize",Hs)});function Wi(){var _;Se.value===1&&((_=L.value)!=null&&_.position)&&Qo()}Xn(()=>{window.addEventListener("scroll",Wi,{passive:!0}),window.addEventListener("resize",Wi)}),ba(()=>{window.removeEventListener("scroll",Wi),window.removeEventListener("resize",Wi)});function Qi(_){return Sr.value.has(_)}async function Sl(){if(o.value)try{const _=await jp(o.value),m=new Set;_.forEach(N=>{N.isProtected&&m.add(N.playerId||N.id)}),Sr.value=m}catch{const m=new Set;for(const N of et.value)await Ti(N.id,o.value)&&m.add(N.id);Sr.value=m}}const Fe=k(!1),pt=k(""),yr=k(!1),Ji=k("");function cs(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Fe.value=!0,pt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Fe.value=!1},2500)}catch{yr.value=!0,Ji.value="Impossible de copier le lien",setTimeout(()=>{yr.value=!1},2500)}}async function _r(_){await Zs({type:"deleteEvent",data:{eventId:_}})}async function Zo(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await FO(m,o.value),qe.value=qe.value.filter(N=>N.id!==m),await Promise.all([Lp(o.value),fo(et.value,qe.value,o.value),po(o.value)]).then(([N,J,ie])=>{qe.value=N,Ht.value=J,at.value=ie}),l.value=!1,c.value=null,Fe.value=!0,pt.value="Événement supprimé avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function ea(){l.value=!1,c.value=null}async function ta(){if(!d.value||!f.value.trim()||!g.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:g.value,description:oe.value.trim()||"",playerCount:_,archived:!!Z.value};await Q_(d.value,m,o.value),!m.archived&&et.value.length>0&&Sr.value.size>0&&(Bt.value={id:d.value,...m},Yt.value=!0),await Promise.all([Lp(o.value),fo(et.value,qe.value,o.value),po(o.value)]).then(([N,J,ie])=>{qe.value=N,Ht.value=J,at.value=ie}),d.value=null,f.value="",g.value="",oe.value="",y.value=6,Z.value=!1,Fe.value=!0,pt.value="Événement mis à jour avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Rt(){if(A.value.trim())try{const _=A.value.trim(),m=await uT(_,o.value);await Promise.all([wd(o.value),fo(et.value,qe.value,o.value),po(o.value)]).then(([N,J,ie])=>{et.value=N,Ht.value=J,at.value=ie,Sl();const te=et.value.find(Ve=>Ve.id===m);tf(m),U.value=m,q.value=Nn.value&&Nn.value[0]&&Nn.value[0].id?Nn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Se<"u"&&(Se.value=2)}catch{}const ge=document.querySelector(`[data-player-id="${m}"]`);ge&&ge.scrollIntoView({behavior:"smooth",block:"center"}),pn(()=>{const Ve=`[data-player-id="${U.value}"] td[data-event-id="${q.value}"]`,We=document.querySelector(Ve);if(We){const tt=We.getBoundingClientRect();z.value.position={x:Math.round(tt.left),y:Math.round(tt.top+window.scrollY-48)}}}),Fe.value=!0,pt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Fe.value=!1},3e3),setTimeout(()=>{Fe.value=!1,pt.value=""},5e3)}),T.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function zr(){d.value=null,f.value="",g.value="",oe.value="",y.value=6}k(null);const Kr=k(!1),br=k(""),Ws=k(""),Qs=k(""),Yi=k(6),na=k(!1);async function nf(){if(!br.value.trim()||!Ws.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Yi.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:br.value.trim(),date:Ws.value,description:Qs.value.trim()||"",playerCount:_,archived:!!na.value};await rf(m)}async function rf(_){try{const m=await $O(_,o.value);qe.value=[...qe.value,{id:m,..._}];const N={};for(const J of et.value)N[J.name]=Ht.value[J.name]||{},N[J.name][m]=null,await H_(J.name,N[J.name],o.value);br.value="",Ws.value="",Qs.value="",Yi.value=6,na.value=!1,Kr.value=!1,await Promise.resolve(),Fe.value=!0,pt.value="Événement créé avec succès !",!_.archived&&et.value.length>0&&Sr.value.size>0&&(Bt.value={id:m,..._},Yt.value=!0),setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Xi(){br.value="",Ws.value="",Qs.value="",Yi.value=6,Kr.value=!1}async function kr(){await Zs({type:"addEvent",data:{}})}const qe=k([]),et=k([]),Ht=k({}),at=k({}),sf=k({}),Pl=k({});St([()=>qe.value.length,()=>et.value.length,tr],()=>{tr.value||pn(()=>{El()})}),St([()=>et.value.length,()=>qe.value.length,o],()=>{Te()}),Xn(async()=>{lT("firebase"),await VO();const _=Lu(Je(ae,"seasons"),Wd("slug","==",e.slug)),m=await wt(_);if(m.empty){t.push("/seasons");return}else{const te=m.docs[0];o.value=te.id;const ge=te.data();i.value=ge.name,a.value=ge,document.title=`Saison : ${i.value}`,dO(e.slug)}if(o.value){Rr.value="Chargement des événements de la saison",Pr.value=20;const te=await wt(Je(ae,"seasons",o.value,"events"));qe.value=te.docs.map(ut=>({id:ut.id,...ut.data(),playerCount:ut.data().playerCount||6})),Rr.value="Chargement des joueurs",Pr.value=45;const ge=await wt(Je(ae,"seasons",o.value,"players"));et.value=ge.docs.map(ut=>({id:ut.id,...ut.data()})),Rr.value="Chargement des disponibilités",Pr.value=70;const Ve=await wt(Je(ae,"seasons",o.value,"availability")),We={};Ve.docs.forEach(ut=>{const Vn=ut.data(),dr={};Object.keys(Vn).forEach(Or=>{const ni=Vn[Or];dr[Or]=ni==="oui"?!0:ni==="non"?!1:ni}),We[ut.id]=dr}),Ht.value=We,Rr.value="Chargement des sélections",Pr.value=85;const tt=await wt(Je(ae,"seasons",o.value,"selections")),mt={};tt.docs.forEach(ut=>{mt[ut.id]=ut.data().players||[]}),at.value=mt;const Wt=await jp(o.value),rn=new Set;Array.isArray(Wt)&&Wt.forEach(ut=>{ut.isProtected&&rn.add(ut.playerId||ut.id)}),Sr.value=rn}const N=te=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>te()):setTimeout(te,0)};Rr.value="Préparation de l'interface",Pr.value=95,N(()=>{Cc(),oa()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await pn(),Pr.value=100,tr.value=!1,pn(()=>{Kn(),requestAnimationFrame(()=>Kn()),setTimeout(()=>Kn(),250);const te=Dn.value;te&&(te.addEventListener("scroll",ge=>{Kn(),Il.value=te.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Kn),typeof ResizeObserver<"u"&&(Go.value=new ResizeObserver(()=>{Kn()}),Go.value.observe(te)))});const J=r.query.event;if(J&&qe.value.length>0){const te=qe.value.find(ge=>ge.id===J);te?(console.debug("Événement trouvé depuis l'URL"),await uf(J,te)):(console.warn("Événement non trouvé avec l'ID"),yr.value=!0,Ji.value="Événement non trouvé",setTimeout(()=>{yr.value=!1},3e3))}const ie=r.query.player;if(ie&&et.value.length>0){const te=et.value.find(ge=>ge.id===ie);te&&(hn(te),await pn(),r.query.verified==="1"&&(Fe.value=!0,pt.value="Joueur associé à votre compte.",setTimeout(()=>{Fe.value=!1},2500)))}}),St(()=>r.params.eventId,_=>{if(_){const m=()=>{const N=qe.value.find(J=>J.id===_);return N?(v(N),!0):!1};if(qe.value.length>0)m();else{const N=St(qe,J=>{J.length>0&&m()&&N()},{immediate:!0})}}},{immediate:!0});function Tc(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Gn=Oe(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...et.value].sort((ge,Ve)=>(ge.name||"").localeCompare(Ve.name||"","fr",{sensitivity:"base"}));if(!_)return m;let N=[];try{_.startsWith("[")?N=JSON.parse(_):_&&(N=[_])}catch{N=[]}const J=new Set(N);if(J.size===0)return m;const ie=m.filter(ge=>J.has(ge.id)),te=m.filter(ge=>!J.has(ge.id));return[...ie,...te]}),Js=Oe(()=>{try{if(o.value){const _=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),of=Oe(()=>[...qe.value].sort((_,m)=>{const N=Tc(_.date),J=Tc(m.date),ie=N?N.getTime():Number.POSITIVE_INFINITY,te=J?J.getTime():Number.POSITIVE_INFINITY;return ie!==te?ie-te:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),Dr=k(!1),Nn=Oe(()=>{const _=of.value;return Dr.value?_:_.filter(m=>!m.archived)});function xc(){Dr.value=!Dr.value}const ds=k("selected"),Zi=Oe(()=>{var N;if(!M.value)return Gn.value;const _=M.value.id,m=new Set(((N=at.value)==null?void 0:N[_])||[]);return Gn.value.filter(J=>{var Ve;const ie=J.name,te=(Ve=Ht.value[ie])==null?void 0:Ve[_],ge=m.has(ie);switch(ds.value){case"selected":return ge;case"available":return te===!0&&!ge;case"unavailable":return te===!1;case"unknown":return te!==!0&&te!==!1;case"all":default:return!0}})}),Ac=Oe(()=>M.value?Vr(M.value.id):null),Rl=Oe(()=>{if(!M.value)return!1;const _=Vr(M.value.id);return _.type==="incomplete"||_.type==="insufficient"}),Ft=Oe(()=>M.value?Ol(M.value.id):"");async function ra(_,m){const N=et.value.find(te=>te.name===_);if(!N){console.error("Joueur non trouvé");return}const J=qe.value.find(te=>te.id===m);if(!J){console.error("Événement non trouvé");return}if(J.archived){Fe.value=!0,pt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Fe.value=!1},3e3);return}if(Qi(N.id)){const te=Ao(N.id),ge=pe.value===N.id;console.debug("Joueur protégé:",{playerId:N.id,hasCachedPassword:te,wasRecentlyVerified:ge,recentlyVerifiedPlayer:pe.value}),te||ge?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),ge&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),pe.value=null),Cl(N,m)):(console.debug("Pas de session, affichage de la modal de vérification"),_e.value={playerName:_,eventId:m},ye.value=N,be.value=!0);return}Cl(N,m)}function Cl(_,m){var ie,te,ge;const N=(ie=Ht.value[_.name])==null?void 0:ie[m];console.debug("toggleAvailability");let J;N===!0?J=!1:N===!1?J=void 0:J=!0,J===void 0?Ht.value[_.name]&&delete Ht.value[_.name][m]:(Ht.value[_.name]||(Ht.value[_.name]={}),Ht.value[_.name][m]=J);try{typeof Se<"u"&&Se.value===1&&_.id===(U.value||((te=Gn.value[0])==null?void 0:te.id))&&m===(q.value||((ge=Nn.value[0])==null?void 0:ge.id))&&(Se.value=3,pn(()=>{const We=document.querySelector(`[data-player-id="${_.id}"]`);if(We){const tt=We.querySelector(".player-name");if(tt){const mt=tt.getBoundingClientRect();fe.value.position={x:Math.round(mt.right+8),y:Math.round(mt.top+window.scrollY-4)}}}}),ba(()=>{try{window.removeEventListener("resize",Kn)}catch{}try{Go.value&&Go.value.disconnect()}catch{}}))}catch{}H_(_.name,Ht.value[_.name],o.value).then(async()=>{await pn(),oa(),Fe.value=!0,pt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}).catch(Ve=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function rr(_,m){var N;return(N=Ht.value[_])==null?void 0:N[m]}function Sc(_,m){var ie;const N=at.value[m]||[],J=(ie=Ht.value[_])==null?void 0:ie[m];return N.includes(_)&&J===!0}async function Pc(_,m=6){const N=qe.value.find(ge=>ge.id===_),J=(N==null?void 0:N.playerCount)||6,ie=at.value[_]||[];if(ie.length>0&&ie.every(ge=>rr(ge,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Ve=et.value.filter(mt=>rr(mt.name,_)).map(mt=>{const Wt=Ys(mt.name);return{name:mt.name,weight:1/(1+Wt)}}),We=[],tt=[...Ve];for(;We.length<J&&tt.length>0;){const mt=tt.reduce((ut,Vn)=>ut+Vn.weight,0);let Wt=Math.random()*mt;const rn=tt.findIndex(ut=>(Wt-=ut.weight,Wt<=0));rn>=0&&(We.push(tt[rn].name),tt.splice(rn,1))}at.value[_]=We}else{const ge=ie.filter(We=>rr(We,_)),Ve=J-ge.length;if(Ve<=0)at.value[_]=ge;else{const We=new Set(ge),mt=et.value.filter(ut=>rr(ut.name,_)&&!We.has(ut.name)).map(ut=>{const Vn=Ys(ut.name);return{name:ut.name,weight:1/(1+Vn)}}),Wt=[],rn=[...mt];for(;Wt.length<Ve&&rn.length>0;){const ut=rn.reduce((Or,ni)=>Or+ni.weight,0);let Vn=Math.random()*ut;const dr=rn.findIndex(Or=>(Vn-=Or.weight,Vn<=0));dr>=0&&(Wt.push(rn[dr].name),rn.splice(dr,1))}at.value[_]=[...ge,...Wt]}}await W_(_,at.value[_],o.value),Cc(),oa()}async function eo(_,m=6){var ge,Ve;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const N=Pe.value,J=(ge=De.value)==null?void 0:ge.id,ie=at.value[_]&&at.value[_].length>0,te=ie?[...at.value[_]]:[];if(await Pc(_,m),console.debug("etat modal selection apres"),N&&!Pe.value&&(console.debug("Restauration de la popin de sélection..."),Pe.value=!0,De.value=qe.value.find(We=>We.id===J)),Pe.value&&((Ve=De.value)==null?void 0:Ve.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await pn(),Le.value&&Le.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const We=at.value[_]||[],tt=te.filter(Wt=>We.includes(Wt)),mt=tt.length>0&&tt.length<te.length;Le.value.showSuccess(ie,mt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Fe.value=!0,qe.value.find(We=>We.id===_),at.value[_],ie?pt.value="Sélection mise à jour avec succès !":pt.value="Sélection effectuée avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}function sa(_){_===0?L.value.position=null:_===1?z.value.position=null:_===2&&(fe.value.position=null)}function Nr(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function kl(_){var N;return _?(typeof _=="string"?new Date(_):((N=_.toDate)==null?void 0:N.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Ys(_){return Object.values(at.value).filter(m=>m.includes(_)).length}function hs(_){const m=Ht.value[_]||{};return Object.values(m).filter(N=>N===!0).length}function to(_){return _?Object.values(Ht.value).filter(m=>m[_]===!0).length:0}function Xs(_){return _?(at.value[_]||[]).length:0}function no(_){const m=qe.value.find(J=>J.id===_),N=(m==null?void 0:m.playerCount)||6;return Xs(_)>=N}function Rc(_){const m=hs(_),N=Ys(_);return m===0?0:N/m}function ia(_){sf.value[_]={availability:hs(_),selection:Ys(_),ratio:Rc(_)}}function Cc(){et.value.forEach(_=>ia(_.name))}function oa(){const _={};qe.value.forEach(m=>{const N=m.playerCount||6,ie=et.value.filter(ge=>rr(ge.name,m.id)===!0).map(ge=>{const Ve=Ys(ge.name);return{name:ge.name,weight:1/(1+Ve)}}),te=ie.reduce((ge,Ve)=>ge+Ve.weight,0);ie.forEach(ge=>{const Ve=Math.min(1,ge.weight/te*N);_[ge.name]||(_[ge.name]={}),_[ge.name][m.id]=Math.round(Ve*100)})}),Pl.value=_}const Gr=k(null),ro=k(!1);async function kc(_=null){const m=_||Gr.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await OO(m,o.value),et.value=et.value.filter(N=>N.id!==m),ro.value=!1,Gr.value=null,Fe.value=!0,pt.value="Joueur supprimé avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function Dl(){ro.value=!1,Gr.value=null}async function Nl(_){gn(),await Ti(_,o.value)?await fs({type:"deletePlayer",data:{playerId:_}}):await Zs({type:"deletePlayer",data:{playerId:_}})}async function Dc(){if(x.value){const _=qe.value.find(N=>N.id===x.value),m=(_==null?void 0:_.playerCount)||6;await eo(x.value,m),me.value=!1,x.value=null}}function aa(){me.value=!1,x.value=null}function Nc(){return B.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[B.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Zs(_){if(An.isPinCached(o.value)){const m=An.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await Zd(o.value,m)){await u(_);return}else An.clearSession()}B.value=_,V.value=!0}async function fs(_){const m=_.data.playerId;try{if(An.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await u(_);return}}catch{}if(Ao(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await u(_);return}vt.value=_,It.value=!0}async function Vc(_){try{if(await Zd(o.value,_)){An.saveSession(o.value,_),V.value=!1;const N=B.value;B.value=null,await u(N)}else R.value="Code PIN incorrect",setTimeout(()=>{R.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),R.value="Erreur lors de la vérification du code PIN"}}function Oc(){V.value=!1,B.value=null,R.value=""}async function Vl(_){if(_){ne.value=!0,Y.value="";try{const m=vt.value.data.playerId,N=await Op(o.value);if(_===N){try{An.saveSession(o.value,_)}catch{}try{Oi.saveSession(vt.value.data.playerId)}catch{}It.value=!1;const ie=vt.value;vt.value=null,j.value="",await u(ie);return}if(await verifyPlayerPassword(m,_,o.value)){It.value=!1;const ie=vt.value;vt.value=null,j.value="",await u(ie)}else Y.value="Mot de passe incorrect",setTimeout(()=>{Y.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Y.value="Erreur lors de la vérification du mot de passe"}finally{ne.value=!1}}}function Mc(){It.value=!1,vt.value=null,Y.value="",j.value="",ne.value=!1}async function so(_){if(_){je.value=!0,re.value="";try{const m=Ge.value.data.player,N=await Op(o.value);if(_===N){try{An.saveSession(o.value,_)}catch{}try{Oi.saveSession(Ge.value.data.player.id)}catch{}Be.value=!1;const ie=Ge.value;Ge.value=null,ee.value="",await u(ie);return}if(await verifyPlayerPassword(m.id,_,o.value)){Be.value=!1;const ie=Ge.value;Ge.value=null,ee.value="",await u(ie)}else re.value="Mot de passe incorrect",setTimeout(()=>{re.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),re.value="Erreur lors de la vérification du mot de passe"}finally{je.value=!1}}}function Hn(){Be.value=!1,Ge.value=null,re.value="",ee.value="",je.value=!1}async function Lc(){D.value=!0,$.value="",X.value="";try{const _=Ge.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);X.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),$.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{D.value=!1}}async function Fc(){ke.value=!0,$e.value="",E.value="";try{const _=vt.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);E.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),$e.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{ke.value=!1}}function ei(){return An.isPinCached(o.value)?{timeRemaining:An.getTimeRemaining(),isExpiringSoon:An.isExpiringSoon()}:null}async function u(_){var J;if(!_)return;const{type:m,data:N}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=N.eventId,l.value=!0;break;case"addEvent":Kr.value=!0;break;case"deletePlayer":Gr.value=N.playerId,ro.value=!0;break;case"launchSelection":at.value[N.eventId]&&at.value[N.eventId].length>0?(x.value=N.eventId,me.value=!0,S.value=!1):(await eo(N.eventId,N.count),S.value=!1);break;case"toggleAvailability":Cl(N.player,N.eventId);break;case"toggleArchive":await setEventArchived(N.eventId,N.archived,o.value);{const ie=qe.value.findIndex(te=>te.id===N.eventId);ie!==-1&&(qe.value[ie]={...qe.value[ie],archived:!!N.archived}),Z.value=!!N.archived}break;case"updateSelection":{const{eventId:ie,players:te}=N,ge=[...at.value[ie]||[]],Ve=Array.isArray(te)?te:[];await W_(ie,Ve,o.value),at.value[ie]=Ve;try{const We=ge.filter(tt=>!Ve.includes(tt));if(We.length>0){const tt=qe.value.find(mt=>mt.id===ie);await xM({eventId:ie,eventData:tt,removedPlayers:We,newSelectedPlayers:Ve,seasonId:o.value,seasonSlug:s,players:nn.value})}}catch{}try{(J=Le.value)==null||J.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Fe.value=!0,pt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Fe.value=!1},3e3)}}function p(){t.push("/seasons")}ba(()=>{const _=Dn.value;_&&_.removeEventListener("scroll",Kn),window.removeEventListener("resize",Kn)});async function v(_){M.value=_,oe.value=_.description||"",Z.value=!!_.archived;try{const[m,N]=await Promise.all([fo(et.value,qe.value,o.value),po(o.value)]);Ht.value=m,at.value=N}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}S.value=!0}function b(){S.value=!1,M.value=null,oe.value="",ue.value=!1}function K(){b(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function Q(_,m){console.debug("handleAvailabilityToggle appelé");const N=et.value.find(te=>te.name===_);if(!N){console.error("Joueur non trouvé");return}const J=qe.value.find(te=>te.id===m);if(J!=null&&J.archived){Fe.value=!0,pt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Fe.value=!1},3e3);return}console.debug("Joueur trouvé");const ie=Qi(N.id);if(console.debug("Joueur protégé"),ie){Ao(N.id)?(console.debug("Session active, procéder au toggle"),await ra(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),_e.value={playerName:_,eventId:m},ye.value=N,be.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await ra(_,m)}function Ie(_,m){return(at.value[m]||[]).includes(_)}async function Et(_){if(console.debug("Mot de passe vérifié"),ye.value&&(pe.value=ye.value.id,console.debug("Joueur marqué comme récemment vérifié")),_e.value){const{playerName:m,eventId:N}=_e.value;console.debug("Exécution de l'action en attente"),await ra(m,N),_e.value=null}else console.debug("Aucune action en attente trouvée");be.value=!1,ye.value=null}function dn(){d.value=M.value.id,f.value=M.value.title,g.value=M.value.date,oe.value=M.value.description||"",y.value=M.value.playerCount||6,S.value=!1}async function lt(){if(M.value)try{const _=!M.value.archived,m={...M.value,archived:_};await Q_(M.value.id,m,o.value),M.value.archived=_;const N=qe.value.findIndex(J=>J.id===M.value.id);N!==-1&&(qe.value[N].archived=_),Fe.value=!0,pt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function hn(_){w.value=_,I.value=!0;try{typeof Se<"u"&&Se.value}catch{}}function gn(){I.value=!1,w.value=null}async function ti({playerId:_,newName:m}){try{await MO(_,m,o.value),await Promise.all([wd(o.value),fo(et.value,qe.value,o.value),po(o.value)]).then(([N,J,ie])=>{if(et.value=N,Ht.value=J,at.value=ie,Sl(),w.value&&w.value.id===_){const te=N.find(ge=>ge.id===_);te&&(w.value=te)}}),Fe.value=!0,pt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function cr(){try{await Promise.all([wd(o.value),fo(et.value,qe.value,o.value),po(o.value)]).then(([_,m,N])=>{if(et.value=_,Ht.value=m,at.value=N,Sl(),w.value){const J=_.find(ie=>ie.id===w.value.id);J&&(w.value=J)}}),Fe.value=!0,pt.value="Données mises à jour !",setTimeout(()=>{Fe.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function la(_){if(!_)return{availability:0,selection:0,ratio:0};const m=hs(_.name),N=Ys(_.name),J=m===0?0:Math.round(N/m*100);return{availability:m,selection:N,ratio:J}}function Vr(_){const m=at.value[_]||[],N=qe.value.find(te=>te.id===_),J=(N==null?void 0:N.playerCount)||6,ie=to(_);if(m.length>0){const te=m.some(Ve=>!rr(Ve,_)),ge=ie<J;if(te||ge)return{type:"incomplete",hasUnavailablePlayers:te,hasInsufficientPlayers:ge,unavailablePlayers:m.filter(Ve=>!rr(Ve,_)),availableCount:ie,requiredCount:J}}return ie<J?{type:"insufficient",availableCount:ie,requiredCount:J}:m.length===0?{type:"ready",availableCount:ie,requiredCount:J}:{type:"complete",availableCount:ie,requiredCount:J}}function Ol(_){const m=Vr(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function nx(){const _=[];for(const m of et.value){if(!await Ti(m.id,o.value))continue;const J=await wT(m.id,o.value);J&&_.push({...m,email:J})}return _}function $c(_){if(_!=null&&_.archived){Fe.value=!0,pt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Fe.value=!1},3e3);return}Hg(),Ze.value=_,He.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function rx(){He.value=!1,Ze.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function Hg(){Yt.value=!1,Bt.value=null}const af=k(!1);async function Wg({eventId:_,eventData:m,reason:N,selectedPlayers:J,scope:ie="all",recipient:te=null}){af.value=!0;try{N==="selection"?(ie==="single"&&(te!=null&&te.email)?await Z_({eventId:_,eventData:m,selectedPlayers:[te.name],seasonId:o.value,seasonSlug:s,players:nn.value}):await Z_({eventId:_,eventData:m,selectedPlayers:J,seasonId:o.value,seasonSlug:s,players:nn.value}),Fe.value=!0,pt.value=ie==="single"?`Notification envoyée à ${(te==null?void 0:te.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Fe.value=!1},3e3)):(ie==="single"&&(te!=null&&te.email)?await X_({eventId:_,eventData:m,players:[te],seasonId:o.value,seasonSlug:s,createMagicLink:Fp,reminder:!1,getAvailabilityForEvent:(ge,Ve)=>rr(ge,Ve)}):await X_({eventId:_,eventData:m,players:await nx(),seasonId:o.value,seasonSlug:s,createMagicLink:Fp,reminder:!1,getAvailabilityForEvent:(ge,Ve)=>rr(ge,Ve)}),Fe.value=!0,pt.value=ie==="single"?`Notification envoyée à ${(te==null?void 0:te.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Fe.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Fe.value=!0,pt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Fe.value=!1},3e3)}af.value=!1}function lf(_){if(!_)return{};const m={};return et.value.forEach(N=>{m[N.name]=rr(N.name,_)}),m}function io(_){if(_!=null&&_.archived){Fe.value=!0,pt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Fe.value=!1},3e3);return}De.value=_,Pe.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function Qg(){Pe.value=!1,De.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function sx(){if(!De.value)return;const _=De.value.id,m=De.value.playerCount||6;if(to(_)===0){Fe.value=!0,pt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Fe.value=!1},3e3);return}await Zs({type:"launchSelection",data:{eventId:_,count:m}})}function ix(){Qg(),Fe.value=!0,pt.value="Sélection validée !",setTimeout(()=>{Fe.value=!1},3e3)}async function ox(_){if(!_||!_.eventId)return;const{eventId:m,players:N}=_;await Zs({type:"updateSelection",data:{eventId:m,players:N}})}async function uf(_,m){if(!_||!m)return;Yg(),Cr.value=_,qs.value=!0,await pn();const N=document.querySelector(`[data-event-id="${_}"]`);if(!N){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(ge=>{ge.classList.remove("focused-event-highlight")});const J=document.querySelectorAll(`[data-event-id="${_}"]`);J.forEach(ge=>{ge.classList.add("focused-event-highlight")});const ie=J[0],te=J[J.length-1];ie&&ie.classList.add("focused-event-column-start"),te&&te.classList.add("focused-event-column-end"),await ax(N),Fe.value=!0,pt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Fe.value=!1},4e3),Gi.value=setTimeout(()=>{Yg()},8e3)}function Jg(_){if(!_)return;const m=qe.value.find(N=>N.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const N=qe.value.find(J=>J.id===_);N?uf(_,N):console.error("Événement toujours introuvable après retry")},500);return}uf(_,m)}St(qe,_=>{try{const m=new URLSearchParams(window.location.search),N=m.get("modal"),J=m.get("event");if(!N||!J)return;const ie=_.find(te=>te.id===J);if(!ie)return;N==="announce"&&$c(ie),N==="selection"&&io(ie)}catch{}},{immediate:!0});async function ax(_){if(!_)return;if(await new Promise(N=>setTimeout(N,100)),window.innerWidth<=768){const N=Dn.value;if(N){const J=_.offsetLeft,ie=_.offsetWidth,te=N.clientWidth,ge=J-te/2+ie/2,Ve=N.scrollWidth-te,We=Math.max(0,Math.min(ge,Ve));N.scrollTo({left:We,behavior:"smooth"}),setTimeout(()=>{const tt=_.getBoundingClientRect();if(tt.left<0||tt.right>window.innerWidth){const mt=J-20;N.scrollTo({left:Math.max(0,mt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Dn.value;m&&setTimeout(()=>{const N=document.querySelector(`[data-event-id="${Cr.value}"]`);if(N&&N.closest("tbody")){const J=N.offsetLeft,ie=N.offsetWidth,te=m.clientWidth,ge=J-te/2+ie/2,Ve=m.scrollWidth-te,We=Math.max(0,Math.min(ge,Ve));m.scrollTo({left:We,behavior:"smooth"})}},300)}function Yg(){Gi.value&&(clearTimeout(Gi.value),Gi.value=null),Cr.value=null,qs.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var N,J,ie,te,ge,Ve,We,tt,mt,Wt,rn,ut,Vn,dr,Or,ni,Xg,Zg,ev,tv,nv,rv;return O(),F(dt,null,[h("div",H$,[h("div",W$,[h("button",{onClick:p,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},m[70]||(m[70]=[h("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),h("h1",Q$,ce(i.value?i.value:"Chargement..."),1),h("div",J$,[h("div",Y$,[h("button",{onClick:zi,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},m[71]||(m[71]=[h("span",{class:"text-2xl"},"👤",-1)])),h("button",{onClick:m[0]||(m[0]=W=>_n.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},m[72]||(m[72]=[h("span",{class:"text-2xl"},"❓",-1)]))]),h("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:us},[h("button",{onClick:m[1]||(m[1]=xt(W=>{Ec(),xl()},["stop"])),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[73]||(m[73]=[h("span",{class:"text-2xl"},"⋯",-1)]))],512),(O(),Pd(eA,{to:"body"},[vr.value?(O(),F("div",{key:0,ref_key:"headerMenuDropdownRef",ref:qr,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:ys(Jo.value)},[h("button",{onClick:m[2]||(m[2]=W=>{zi(),Yo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[74]||(m[74]=[h("span",null,"👤",-1),h("span",{class:"text-sm"},"Mon compte",-1)])),h("button",{onClick:m[3]||(m[3]=W=>{_n.value=!0,Yo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[75]||(m[75]=[h("span",null,"❓",-1),h("span",{class:"text-sm"},"Kezako ?",-1)]))],4)):ve("",!0)]))])],512),h("div",X$,[h("div",{ref_key:"headerBarRef",ref:Ks,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[h("div",Z$,[qe.value.length===0&&et.value.length===0?ve("",!0):(O(),F("div",e6,[h("div",{class:"flex items-center justify-center h-full gap-2"},[h("button",{onClick:kr,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[76]||(m[76]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),h("span",{class:"sm:hidden"},"Événement",-1)]))])])),h("div",t6,[h("div",{ref_key:"headerEventsRef",ref:zn,class:"flex relative z-[60]",style:ys({transform:`translateX(-${Il.value}px)`})},[(O(!0),F(dt,null,wr(Nn.value,W=>(O(),F("div",{key:"h-"+W.id,"data-event-id":W.id,class:At(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":W.archived}])},[h("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:W.title+" - Cliquez pour voir les détails",onClick:xt(bn=>v(W),["stop"])},[h("div",s6,[h("div",i6,ce(W.title||"Sans titre"),1),W.archived?(O(),F("div",o6,"(Archivé)")):ve("",!0)]),h("div",{class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200",title:kl(W.date)},ce(Nr(W.date)),9,a6)],8,r6),h("div",l6,[W.archived?(O(),F("div",u6,m[77]||(m[77]=[h("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),h("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):Vr(W.id).type==="ready"?(O(),F("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:Ol(W.id)+" - Cliquez pour ouvrir la sélection",onClick:xt(bn=>io(W),["stop"])},m[78]||(m[78]=[h("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),h("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,c6)):Vr(W.id).type==="complete"?(O(),F("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:Ol(W.id)+" - Cliquez pour ouvrir la sélection",onClick:xt(bn=>io(W),["stop"])},m[79]||(m[79]=[h("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),h("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,d6)):Vr(W.id).type==="incomplete"?(O(),F("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:Ol(W.id)+" - Cliquez pour ouvrir la sélection",onClick:xt(bn=>io(W),["stop"])},m[80]||(m[80]=[h("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),h("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,h6)):Vr(W.id).type==="insufficient"?(O(),F("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:Ol(W.id)+" - Cliquez pour ouvrir la sélection",onClick:xt(bn=>io(W),["stop"])},m[81]||(m[81]=[h("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),h("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,f6)):ve("",!0)])],10,n6))),128))],4)]),m[84]||(m[84]=h("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),h("button",{onClick:xc,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:Dr.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":Dr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(O(),F("svg",m6,[m[82]||(m[82]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[83]||(m[83]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),Dr.value?ve("",!0):(O(),F("path",g6))]))],8,p6),nt(h("button",{onClick:m[4]||(m[4]=xt(W=>Wo(-1,W),["prevent"])),onMousedown:m[5]||(m[5]=xt(W=>Gs(-1,W),["prevent"])),onMouseup:m[6]||(m[6]=W=>gr(W)),onMouseleave:m[7]||(m[7]=W=>gr(W)),onTouchstart:m[8]||(m[8]=xt(W=>Gs(-1,W),["prevent"])),onTouchend:m[9]||(m[9]=W=>gr(W)),onTouchcancel:m[10]||(m[10]=W=>gr(W)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[yf,zs.value]]),nt(h("button",{onClick:m[11]||(m[11]=xt(W=>Wo(1,W),["prevent"])),onMousedown:m[12]||(m[12]=xt(W=>Gs(1,W),["prevent"])),onMouseup:m[13]||(m[13]=W=>gr(W)),onMouseleave:m[14]||(m[14]=W=>gr(W)),onTouchstart:m[15]||(m[15]=xt(W=>Gs(1,W),["prevent"])),onTouchend:m[16]||(m[16]=W=>gr(W)),onTouchcancel:m[17]||(m[17]=W=>gr(W)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[yf,wc.value]])])],512),nt(h("div",{ref_key:"gridboardRef",ref:Dn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Se.value===1?(O(),F("div",v6,[L.value.position?(O(),F("div",{key:0,class:"fixed z-[400]",style:ys({left:L.value.position.x+"px",top:L.value.position.y+"px"})},[h("div",{id:"coachmark-add",class:At(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":L.value.side==="right","coachmark-left":L.value.side==="left"}])},[m[86]||(m[86]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[87]||(m[87]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),h("div",y6,[m[85]||(m[85]=h("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),h("button",{onClick:m[18]||(m[18]=W=>sa(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ve("",!0)])):ve("",!0),Se.value===2&&U.value&&q.value?(O(),F("div",_6,[z.value.position?(O(),F("div",{key:0,class:"fixed z-[400]",style:ys({position:"absolute",left:z.value.position.x+"px",top:z.value.position.y+"px"})},[h("div",b6,[m[89]||(m[89]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[90]||(m[90]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),h("div",w6,[m[88]||(m[88]=h("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),h("button",{onClick:m[19]||(m[19]=W=>sa(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ve("",!0)])):ve("",!0),Se.value===3&&U.value?(O(),F("div",I6,[fe.value.position?(O(),F("div",{key:0,class:"fixed z-[400]",style:ys({position:"absolute",left:fe.value.position.x+"px",top:fe.value.position.y+"px"})},[h("div",E6,[m[92]||(m[92]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[93]||(m[93]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),h("div",T6,[m[91]||(m[91]=h("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),h("button",{onClick:m[20]||(m[20]=W=>sa(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ve("",!0)])):ve("",!0),h("table",x6,[h("colgroup",null,[m[94]||(m[94]=h("col",{class:"col-left"},null,-1)),(O(!0),F(dt,null,wr(Nn.value,(W,bn)=>(O(),F("col",{key:"c"+bn,class:"col-event"}))),128)),m[95]||(m[95]=h("col",{class:"col-right"},null,-1))]),m[99]||(m[99]=h("thead",{class:"hidden"},null,-1)),h("tbody",null,[(O(!0),F(dt,null,wr(Gn.value,W=>{var bn;return O(),F("tr",{key:W.id,class:At(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":W.id===P.value,"preferred-player":Js.value.has(W.id)}]),"data-player-id":W.id},[h("td",S6,[h("div",P6,[Js.value.has(W.id)?(O(),F("span",R6," ⭐ ")):Qi(W.id)?(O(),F("span",C6," 🔒 ")):ve("",!0),h("div",{onClick:sr=>hn(W),class:At(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Se.value===3&&W.id===(U.value||((bn=Gn.value[0])==null?void 0:bn.id))}]),title:"Cliquez pour voir les détails : "+W.name},[h("span",D6,ce(W.name),1)],10,k6)])]),(O(!0),F(dt,null,wr(Nn.value,sr=>{var sv,iv,ov;return O(),F("td",{key:sr.id,"data-event-id":sr.id,class:At(["p-0",sr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Se.value===2&&W.id===(U.value||((sv=Gn.value[0])==null?void 0:sv.id))&&sr.id===(q.value||((iv=Nn.value[0])==null?void 0:iv.id))}])},[ct(e0,{"player-name":W.name,"event-id":sr.id,"is-available":rr(W.name,sr.id),"is-selected":Sc(W.name,sr.id),"chance-percent":((ov=Pl.value[W.name])==null?void 0:ov[sr.id])??null,"show-selected-chance":no(sr.id),disabled:sr.archived===!0,onToggle:ra},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,N6)}),128)),m[96]||(m[96]=h("td",{class:"p-3 md:p-4"},null,-1))],10,A6)}),128)),h("tr",V6,[h("td",O6,[h("div",M6,[h("button",{onClick:m[21]||(m[21]=W=>T.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[97]||(m[97]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),h("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(O(!0),F(dt,null,wr(Nn.value,W=>(O(),F("td",{key:"add-row-"+W.id,"data-event-id":W.id,class:At(["p-3 md:p-5",W.archived?"archived-col":""])},null,10,L6))),128)),m[98]||(m[98]=h("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[yf,!tr.value]])])]),tr.value?(O(),F("div",F6,[h("div",$6,[m[100]||(m[100]=h("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("p",U6,ce(Rr.value)+"…",1),h("div",j6,[h("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:ys({width:Pr.value+"%"})},null,4)]),h("p",B6,ce(Pr.value)+"%",1)])])):ve("",!0),tr.value?ve("",!0):(O(),Pd(I4,{key:1,"season-id":o.value,"season-slug":Zr(s),"players-count":et.value.length,"events-count":qe.value.length,"onboarding-done":((N=a.value)==null?void 0:N.onboardingCreatorDone)===!0,onCreateEvent:kr,onAddPlayer:m[22]||(m[22]=()=>{T.value=!0}),onCopyLink:cs,onDismissed:wl},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ve("",!0),Fe.value?(O(),F("div",q6,[h("div",z6,[m[101]||(m[101]=h("span",{class:"text-xl"},"✨",-1)),h("span",null,ce(pt.value),1)])])):ve("",!0),yr.value?(O(),F("div",K6,[h("div",G6,[m[102]||(m[102]=h("span",{class:"text-xl"},"⚠️",-1)),h("span",null,ce(Ji.value),1)])])):ve("",!0),Kr.value?(O(),F("div",H6,[h("div",W6,[m[108]||(m[108]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),h("div",Q6,[m[103]||(m[103]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),nt(h("input",{"onUpdate:modelValue":m[23]||(m[23]=W=>br.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Nt,br.value]])]),h("div",J6,[m[104]||(m[104]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),nt(h("input",{"onUpdate:modelValue":m[24]||(m[24]=W=>Ws.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Nt,Ws.value]])]),h("div",Y6,[m[105]||(m[105]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),nt(h("textarea",{"onUpdate:modelValue":m[25]||(m[25]=W=>Qs.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Nt,Qs.value]])]),h("div",X6,[nt(h("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[26]||(m[26]=W=>na.value=W),class:"w-4 h-4"},null,512),[[yi,na.value]]),m[106]||(m[106]=h("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),h("div",Z6,[m[107]||(m[107]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),nt(h("input",{"onUpdate:modelValue":m[27]||(m[27]=W=>Yi.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Nt,Yi.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Xi,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:nf,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ve("",!0),T.value?(O(),F("div",eU,[h("div",tU,[m[110]||(m[110]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),h("div",nU,[m[109]||(m[109]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),nt(h("input",{"onUpdate:modelValue":m[28]||(m[28]=W=>A.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Nt,A.value]])]),h("div",rU,[h("button",{onClick:m[29]||(m[29]=W=>T.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Rt,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ve("",!0),l.value?(O(),F("div",sU,[h("div",iU,[m[111]||(m[111]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),h("div",oU,[h("button",{onClick:ea,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:m[30]||(m[30]=()=>Zo()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ve("",!0),ro.value?(O(),F("div",aU,[h("div",lU,[m[112]||(m[112]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),h("div",uU,[h("button",{onClick:Dl,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:m[31]||(m[31]=()=>kc()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ve("",!0),me.value?(O(),F("div",cU,[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[m[113]||(m[113]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:aa,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:Dc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ve("",!0),S.value?(O(),F("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:b},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[42]||(m[42]=xt(()=>{},["stop"]))},[h("div",dU,[h("button",{onClick:b,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),m[114]||(m[114]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),h("h2",hU,ce((J=M.value)==null?void 0:J.title),1),h("p",fU,ce(kl((ie=M.value)==null?void 0:ie.date)),1)]),h("div",pU,[(te=M.value)!=null&&te.description?(O(),F("div",mU,[h("p",gU,ce(M.value.description),1)])):ve("",!0),h("div",vU,[h("div",yU,[h("div",_U,ce(to((ge=M.value)==null?void 0:ge.id)),1),m[115]||(m[115]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",bU,[h("div",wU,ce(Xs((Ve=M.value)==null?void 0:Ve.id)),1),m[116]||(m[116]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",IU,[h("div",EU,ce(Math.max((((We=M.value)==null?void 0:We.playerCount)||6)-Xs((tt=M.value)==null?void 0:tt.id),0)),1),m[117]||(m[117]=h("div",{class:"text-xs md:text-sm text-yellow-300"},"manquants",-1))])]),M.value?(O(),F("div",TU,[h("div",xU,[Rl.value?(O(),F("div",{key:0,class:At(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((mt=Ac.value)==null?void 0:mt.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:Ft.value},[m[118]||(m[118]=h("span",null,"⚠️",-1)),h("span",SU,ce(Ft.value),1)],10,AU)):ve("",!0),nt(h("select",{"onUpdate:modelValue":m[32]||(m[32]=W=>ds.value=W),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[119]||(m[119]=[Jn('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[wS,ds.value]])]),h("div",PU,[(O(!0),F(dt,null,wr(Zi.value,W=>{var bn,sr;return O(),F("div",{key:W.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[h("div",RU,[Js.value.has(W.id)?(O(),F("span",CU," ⭐ ")):Qi(W.id)?(O(),F("span",kU," 🔒 ")):ve("",!0),h("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:W.name},ce(W.name),9,DU)]),h("div",NU,[ct(e0,{"player-name":W.name,"event-id":M.value.id,"is-available":lf(M.value.id)[W.name],"is-selected":Ie(W.name,M.value.id),"chance-percent":((bn=Pl.value[W.name])==null?void 0:bn[M.value.id])??null,"show-selected-chance":no(M.value.id),disabled:((sr=M.value)==null?void 0:sr.archived)===!0,compact:!0,onToggle:Q},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ve("",!0),h("div",VU,[h("button",{onClick:dn,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},m[120]||(m[120]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[33]||(m[33]=W=>$c(M.value)),disabled:(Wt=M.value)==null?void 0:Wt.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(rn=M.value)!=null&&rn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[121]||(m[121]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,OU),h("button",{onClick:lt,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(ut=M.value)!=null&&ut.archived?"Désarchiver cet événement":"Archiver cet événement"},[h("span",null,ce((Vn=M.value)!=null&&Vn.archived?"📂":"📁"),1),h("span",null,ce((dr=M.value)!=null&&dr.archived?"Désarchiver":"Archiver"),1)],8,MU),h("button",{onClick:m[34]||(m[34]=W=>io(M.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[122]||(m[122]=[h("span",null,"🎭",-1),h("span",null,"Sélectionner",-1)])),h("button",{onClick:m[35]||(m[35]=W=>{var bn;return _r((bn=M.value)==null?void 0:bn.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},m[123]||(m[123]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:K,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),ue.value?(O(),F("div",LU,[h("button",{onClick:m[36]||(m[36]=W=>{dn(),ue.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),h("button",{onClick:m[37]||(m[37]=W=>{$c(M.value),ue.value=!1}),disabled:(Or=M.value)==null?void 0:Or.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(ni=M.value)!=null&&ni.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[124]||(m[124]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,FU),h("button",{onClick:m[38]||(m[38]=W=>{lt(),ue.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},ce((Xg=M.value)!=null&&Xg.archived?"📂 Désarchiver":"📁 Archiver"),1),h("button",{onClick:m[39]||(m[39]=W=>{var bn;_r((bn=M.value)==null?void 0:bn.id),ue.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):ve("",!0)]),h("div",$U,[h("button",{onClick:m[40]||(m[40]=W=>io(M.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),h("button",{onClick:K,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),h("button",{onClick:m[41]||(m[41]=W=>ue.value=!ue.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ve("",!0),ct($g,{show:be.value,player:ye.value,seasonId:o.value,onClose:m[43]||(m[43]=W=>be.value=!1),onVerified:Et},null,8,["show","player","seasonId"]),d.value?(O(),F("div",UU,[h("div",jU,[m[130]||(m[130]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),h("div",BU,[m[125]||(m[125]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),nt(h("input",{"onUpdate:modelValue":m[44]||(m[44]=W=>f.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Mn(zr,["esc"]),Mn(ta,["enter"])],ref:"editTitleInput"},null,544),[[Nt,f.value]])]),h("div",qU,[m[126]||(m[126]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),nt(h("input",{"onUpdate:modelValue":m[45]||(m[45]=W=>g.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Mn(zr,["esc"]),Mn(ta,["enter"])]},null,544),[[Nt,g.value]])]),h("div",zU,[m[127]||(m[127]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),nt(h("textarea",{"onUpdate:modelValue":m[46]||(m[46]=W=>oe.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Mn(zr,["esc"])},null,544),[[Nt,oe.value]])]),h("div",KU,[nt(h("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[47]||(m[47]=W=>Z.value=W),class:"w-4 h-4"},null,512),[[yi,Z.value]]),m[128]||(m[128]=h("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),h("div",GU,[m[129]||(m[129]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),nt(h("input",{"onUpdate:modelValue":m[48]||(m[48]=W=>y.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Mn(zr,["esc"])},null,544),[[Nt,y.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:zr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ta,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ve("",!0),ct(oT,{show:V.value,message:Nc(),error:R.value,"session-info":ei(),onSubmit:Vc,onCancel:Oc},null,8,["show","message","error","session-info"]),It.value?(O(),F("div",HU,[h("div",WU,[m[132]||(m[132]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",QU,[h("div",JU,[h("div",null,[m[131]||(m[131]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),nt(h("input",{"onUpdate:modelValue":m[49]||(m[49]=W=>j.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[50]||(m[50]=Mn(W=>Vl(j.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Ke},null,544),[[Nt,j.value]])])]),h("button",{onClick:m[51]||(m[51]=W=>Vl(j.value)),disabled:!j.value||ne.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[ne.value?(O(),F("span",XU,"⏳")):(O(),F("span",ZU,"🔓")),h("span",null,ce(ne.value?"Vérification...":"Vérifier et supprimer"),1)],8,YU)]),h("div",e5,[h("button",{onClick:m[52]||(m[52]=W=>se.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),Y.value?(O(),F("div",t5,[h("div",n5,ce(Y.value),1)])):ve("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:Mc,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ve("",!0),Be.value?(O(),F("div",r5,[h("div",s5,[m[135]||(m[135]=Jn('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",i5,[h("div",o5,[h("div",null,[m[133]||(m[133]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),nt(h("input",{"onUpdate:modelValue":m[53]||(m[53]=W=>ee.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[54]||(m[54]=Mn(W=>so(ee.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Xe},null,544),[[Nt,ee.value]])])]),h("div",a5,[h("button",{onClick:m[55]||(m[55]=W=>ht.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),re.value?(O(),F("div",l5,[h("div",u5,ce(re.value),1)])):ve("",!0)]),h("div",c5,[h("button",{onClick:Hn,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),h("button",{onClick:m[56]||(m[56]=W=>so(ee.value)),disabled:!ee.value||je.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[je.value?(O(),F("span",h5,"⏳")):(O(),F("span",f5,"🔓")),h("span",null,[Vt(ce(je.value?"Vérification...":"Vérifier"),1),m[134]||(m[134]=h("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,d5)])])])):ve("",!0),ht.value?(O(),F("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[59]||(m[59]=W=>ht.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[58]||(m[58]=xt(()=>{},["stop"]))},[m[137]||(m[137]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),h("div",p5,[m[136]||(m[136]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:Lc,disabled:D.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[D.value?(O(),F("span",g5,"⏳")):(O(),F("span",v5,"📧")),h("span",null,ce(D.value?"Envoi...":"Envoyer l'email"),1)],8,m5)]),$.value?(O(),F("div",y5,[h("div",_5,ce($.value),1)])):ve("",!0),X.value?(O(),F("div",b5,[h("div",w5,ce(X.value),1)])):ve("",!0),h("div",I5,[h("button",{onClick:m[57]||(m[57]=W=>ht.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ve("",!0),se.value?(O(),F("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[62]||(m[62]=W=>se.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[61]||(m[61]=xt(()=>{},["stop"]))},[m[139]||(m[139]=Jn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),h("div",E5,[m[138]||(m[138]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:Fc,disabled:ke.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[ke.value?(O(),F("span",x5,"⏳")):(O(),F("span",A5,"📧")),h("span",null,ce(ke.value?"Envoi...":"Envoyer l'email"),1)],8,T5)]),$e.value?(O(),F("div",S5,[h("div",P5,ce($e.value),1)])):ve("",!0),E.value?(O(),F("div",R5,[h("div",C5,ce(E.value),1)])):ve("",!0),h("div",k5,[h("button",{onClick:m[60]||(m[60]=W=>se.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ve("",!0),ct(AF,{ref_key:"playerModalRef",ref:C,show:I.value,player:w.value,stats:la(w.value),seasonId:o.value,"onboarding-step":Se.value,"onboarding-player-id":U.value,onClose:gn,onUpdate:ti,onDelete:Nl,onRefresh:cr,onAdvanceOnboarding:m[63]||(m[63]=W=>{try{typeof Se.value<"u"&&(Se.value.value=W)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),ct(u4,{ref_key:"selectionModalRef",ref:Le,show:Pe.value,event:De.value,"current-selection":at.value[(Zg=De.value)==null?void 0:Zg.id]||[],"available-count":to((ev=De.value)==null?void 0:ev.id),"selected-count":Xs((tv=De.value)==null?void 0:tv.id),"player-availability":lf((nv=De.value)==null?void 0:nv.id),"season-id":o.value,"season-slug":Zr(s),players:nn.value,onClose:Qg,onSelection:sx,onPerfect:ix,onSendNotifications:Wg,onUpdateSelection:ox},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),ct(AT,{show:He.value,event:Ze.value,"season-id":o.value,"season-slug":Zr(s),players:nn.value,sending:af.value,"availability-by-player":lf((rv=Ze.value)==null?void 0:rv.id),onClose:rx,onSendNotifications:Wg},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),ct(aT,{show:_n.value,onClose:m[64]||(m[64]=W=>_n.value=!1)},null,8,["show"]),ct(M$,{show:Lt.value,"season-id":o.value,onClose:kn,onManagePlayer:Ki,onChangePassword:bl,onLogoutDevice:yc,onDeleteAccount:_c},null,8,["show","season-id"]),ct(ST,{show:mr.value,player:cn.value,"season-id":o.value,onClose:m[65]||(m[65]=W=>mr.value=!1),onSuccess:m[66]||(m[66]=()=>{mr.value=!1,Lt.value=!0})},null,8,["show","player","season-id"]),ct(G$,{show:jr.value,onClose:m[67]||(m[67]=W=>jr.value=!1),onSuccess:m[68]||(m[68]=()=>{jr.value=!1,Lt.value=!0})},null,8,["show"]),Yt.value?(O(),F("div",D5,[h("div",N5,[m[140]||(m[140]=h("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[141]||(m[141]=h("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),h("div",V5,[h("button",{onClick:m[69]||(m[69]=W=>$c(Bt.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),h("button",{onClick:Hg,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ve("",!0)],64)}}},O5={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},M5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},L5={key:0,class:"text-center py-8"},F5={key:1,class:"text-center py-8"},$5={class:"text-gray-300 mb-6"},U5={key:2,class:"space-y-6"},j5={class:"text-center"},B5={class:"text-gray-300"},q5={class:"font-semibold text-white"},z5={class:"space-y-4"},K5=["disabled"],G5={key:0,class:"animate-spin"},H5={key:1},W5={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Q5={class:"text-red-300 text-sm"},J5={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Y5={class:"text-green-300 text-sm"},X5={__name:"PasswordReset",setup(n){const e=tl(),t=el(),r=k(!0),s=k(""),i=k(""),o=k(""),a=k(""),l=k(""),c=k(!1),d=k(""),f=k(""),g=Oe(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Xn(async()=>{try{const{oobCode:A}=e.query;if(le.debug("Token reçu (masqué)"),!A){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=A,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(A){le.error("Erreur lors de la vérification du lien",A),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,d.value="",f.value="";try{le.debug("Début réinitialisation avec token (masqué)"),await oN(gt,o.value,a.value),le.info("Mot de passe Firebase Auth mis à jour"),le.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{T()},3e3)}catch(A){le.error("Erreur lors de la réinitialisation",A),A.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":A.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function T(){t.push("/seasons")}return(A,P)=>(O(),F("div",O5,[h("div",M5,[P[8]||(P[8]=Jn('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(O(),F("div",L5,P[2]||(P[2]=[h("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),h("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(O(),F("div",F5,[P[3]||(P[3]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"❌")],-1)),P[4]||(P[4]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),h("p",$5,ce(s.value),1),h("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(O(),F("div",U5,[h("div",j5,[h("p",B5,[P[5]||(P[5]=Vt("Email : ")),h("span",q5,ce(i.value),1)])]),h("div",z5,[h("div",null,[P[6]||(P[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),nt(h("input",{"onUpdate:modelValue":P[0]||(P[0]=U=>a.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Mn(y,["enter"])},null,544),[[Nt,a.value]])]),h("div",null,[P[7]||(P[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),nt(h("input",{"onUpdate:modelValue":P[1]||(P[1]=U=>l.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Mn(y,["enter"])},null,544),[[Nt,l.value]])])]),h("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(O(),F("span",G5,"⏳")):(O(),F("span",H5,"🔑")),h("span",null,ce(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,K5),d.value?(O(),F("div",W5,[h("div",Q5,ce(d.value),1)])):ve("",!0),f.value?(O(),F("div",J5,[h("div",Y5,ce(f.value),1)])):ve("",!0)])):ve("",!0)])]))}},Z5={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},ej={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},tj={class:"text-3xl"},nj={class:"text-2xl font-bold text-white mb-2"},rj={class:"text-gray-300 mb-6"},sj={__name:"MagicLink",setup(n){const e=tl(),t=el(),r=k("loading"),s=k("Traitement en cours..."),i=k("Merci de patienter pendant la validation du lien."),o=Oe(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return Xn(async()=>{var l;try{lT("firebase");const c=String(e.query.sid||""),d=String(e.query.pid||"");let f=String(e.query.eid||"");const g=String(e.query.t||""),y=String(e.query.a||""),T=String(e.query.slug||"");if(!g||!y){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(y==="account_email_update"){const z=await fT({token:g});if(!z.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await hN(gt.currentUser,z.data.newEmail),await pT({token:g}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(y==="verify_email"&&(f="protection"),!(await dT({seasonId:c,playerId:d,eventId:f,token:g,action:y})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(y==="verify_email"){await yT({playerId:d,seasonId:c});try{await ET({playerId:d,seasonId:c})}catch{}await $p({seasonId:c,playerId:d,eventId:"protection",action:y}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(T?()=>t.push(`/season/${T}?player=${encodeURIComponent(d)}&verified=1`):()=>t.push("/seasons"),800);return}const P=xe(ae,"seasons",c,"players",d),U=await Gt(P),q=U.exists()&&U.data().name||"";if(!q){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await LO({seasonId:c,playerName:q,eventId:f,value:y==="yes"}),y==="no")try{const z=xe(ae,"seasons",c,"selections",f),fe=await Gt(z);if(fe.exists()){const me=Array.isArray((l=fe.data())==null?void 0:l.players)?fe.data().players:[],x=me.filter(I=>I!==q);x.length!==me.length&&await setDoc(z,{players:x},{merge:!0})}}catch{}await $p({seasonId:c,playerId:d,eventId:f,action:y}),r.value="ok",s.value="Merci !",i.value=y==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(T?()=>t.push(`/season/${T}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){le.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(O(),F("div",Z5,[h("div",ej,[h("div",{class:At(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[h("span",tj,ce(o.value),1)],2),h("h1",nj,ce(s.value),1),h("p",rj,ce(i.value),1),h("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},ij={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},oj={class:"text-center py-12 px-4"},aj={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},lj={class:"container mx-auto px-4 pb-16"},uj={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},cj={class:"space-y-5"},dj=["onKeydown"],hj={class:"flex items-center justify-end gap-3 pt-2"},fj=["disabled"],pj={key:0,class:"mt-6 text-sm text-gray-200"},mj={__name:"JoinSeason",setup(n){const e=tl(),t=el(),r=e.params.slug,s=k(""),i=k(""),o=k(""),a=k(!1),l=k("");Xn(async()=>{const f=Lu(Je(ae,"seasons"),Wd("slug","==",r)),g=await wt(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await uT(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){le.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(O(),F("div",ij,[h("div",oj,[h("h1",aj,ce(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=h("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),h("div",lj,[h("div",uj,[g[3]||(g[3]=h("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),h("div",cj,[h("div",null,[g[2]||(g[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),nt(h("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Mn(xt(d,["prevent"]),["enter"])},null,40,dj),[[Nt,o.value]])]),h("div",hj,[h("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,fj)])]),l.value?(O(),F("div",pj,ce(l.value),1)):ve("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const gj=[{path:"/",component:yO},{path:"/seasons",component:fM},{path:"/season/:slug",component:c0,props:!0},{path:"/season/:slug/event/:eventId",component:c0,props:!0},{path:"/season/:slug/join",component:mj,props:!0},{path:"/reset-password",component:X5},{path:"/magic",component:sj}],vj=D1({history:a1("/"),routes:gj}),tx=SS(CS);tx.use(vj);tx.mount("#app");M1({immediate:!0,onRegistered(n){window.__swReg=n}});export{Je as $,aE as A,Oo as B,ns as C,ln as D,wB as E,Uo as F,tg as G,bB as H,Ij as I,xr as J,ED as K,xD as L,ml as M,Wj as N,Qj as O,JD as P,Cn as Q,$j as R,Sj as S,Qt as T,hB as U,Dh as V,HD as W,QD as X,Hj as Y,Cj as Z,Yb as _,Vu as a,fc as a$,xj as a0,TD as a1,MD as a2,_B as a3,Xa as a4,dB as a5,Nj as a6,yB as a7,xe as a8,Lj as a9,Mj as aA,tB as aB,nB as aC,Fj as aD,VD as aE,aB as aF,lB as aG,KD as aH,Lu as aI,HI as aJ,Aj as aK,cB as aL,qi as aM,Zt as aN,mB as aO,yj as aP,Jj as aQ,qj as aR,Bj as aS,Gj as aT,Vj as aU,pl as aV,pB as aW,kj as aX,Wd as aY,hg as aZ,SB as a_,SD as aa,Rj as ab,Dj as ac,vB as ad,Kj as ae,zj as af,Jt as ag,uc as ah,FD as ai,rB as aj,Gt as ak,Yj as al,Xj as am,wt as an,Zj as ao,eB as ap,AD as aq,gB as ar,fB as as,Pj as at,Uj as au,jj as av,Oj as aw,sB as ax,oB as ay,iB as az,PD as b,tN as b$,hc as b0,RB as b1,ju as b2,zo as b3,pi as b4,EB as b5,gi as b6,mi as b7,Os as b8,vd as b9,u2 as bA,JB as bB,uq as bC,D_ as bD,BN as bE,C2 as bF,zB as bG,LB as bH,nN as bI,eq as bJ,iq as bK,lq as bL,YB as bM,IN as bN,bN as bO,kB as bP,XD as bQ,rN as bR,tq as bS,sq as bT,aq as bU,h2 as bV,WB as bW,UB as bX,iN as bY,MB as bZ,_N as b_,AB as ba,xo as bb,ka as bc,KV as bd,TB as be,XB as bf,Np as bg,xB as bh,GV as bi,Ng as bj,vi as bk,VB as bl,wN as bm,jE as bn,zV as bo,qE as bp,aN as bq,oN as br,D2 as bs,lN as bt,PB as bu,QB as bv,$B as bw,qB as bx,ZV as by,CB as bz,Ja as c,Ig as c0,NB as c1,uN as c2,FB as c3,ZB as c4,rq as c5,oq as c6,EN as c7,DB as c8,HB as c9,hN as ca,fN as cb,nq as cc,BB as cd,GB as ce,KB as cf,jB as cg,OB as ch,jo as d,kt as e,he as f,fl as g,ac as h,pd as i,$h as j,lc as k,Lh as l,cg as m,Ya as n,Fh as o,_o as p,WD as q,en as r,So as s,Ae as t,bj as u,gR as v,zt as w,IB as x,rt as y,_j as z};
