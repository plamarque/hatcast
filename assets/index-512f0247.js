(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Bm(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Bt={},tl=[],os=()=>{},$1=()=>!1,Uh=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),qm=n=>n.startsWith("onUpdate:"),Nn=Object.assign,zm=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},F1=Object.prototype.hasOwnProperty,Mt=(n,e)=>F1.call(n,e),He=Array.isArray,nl=n=>Mc(n)==="[object Map]",Ol=n=>Mc(n)==="[object Set]",Cy=n=>Mc(n)==="[object Date]",et=n=>typeof n=="function",pn=n=>typeof n=="string",cs=n=>typeof n=="symbol",qt=n=>n!==null&&typeof n=="object",Kb=n=>(qt(n)||et(n))&&et(n.then)&&et(n.catch),Gb=Object.prototype.toString,Mc=n=>Gb.call(n),U1=n=>Mc(n).slice(8,-1),Wb=n=>Mc(n)==="[object Object]",Hm=n=>pn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Fu=Bm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),jh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},j1=/-(\w)/g,Xr=jh(n=>n.replace(j1,(e,t)=>t?t.toUpperCase():"")),B1=/\B([A-Z])/g,uo=jh(n=>n.replace(B1,"-$1").toLowerCase()),Bh=jh(n=>n.charAt(0).toUpperCase()+n.slice(1)),ep=jh(n=>n?`on${Bh(n)}`:""),Wi=(n,e)=>!Object.is(n,e),$d=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},jp=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},ih=n=>{const e=parseFloat(n);return isNaN(e)?n:e},q1=n=>{const e=pn(n)?Number(n):NaN;return isNaN(e)?n:e};let ky;const qh=()=>ky||(ky=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ur(n){if(He(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=pn(r)?G1(r):Ur(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(pn(n)||qt(n))return n}const z1=/;(?![^(]*\))/g,H1=/:([^]+)/,K1=/\/\*[^]*?\*\//g;function G1(n){const e={};return n.replace(K1,"").split(z1).forEach(t=>{if(t){const r=t.split(H1);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function cn(n){let e="";if(pn(n))e=n;else if(He(n))for(let t=0;t<n.length;t++){const r=cn(n[t]);r&&(e+=r+" ")}else if(qt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const W1="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Q1=Bm(W1);function Qb(n){return!!n||n===""}function J1(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Lc(n[r],e[r]);return t}function Lc(n,e){if(n===e)return!0;let t=Cy(n),r=Cy(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=cs(n),r=cs(e),t||r)return n===e;if(t=He(n),r=He(e),t||r)return t&&r?J1(n,e):!1;if(t=qt(n),r=qt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Lc(n[o],e[o]))return!1}}return String(n)===String(e)}function Km(n,e){return n.findIndex(t=>Lc(t,e))}const Jb=n=>!!(n&&n.__v_isRef===!0),ee=n=>pn(n)?n:n==null?"":He(n)||qt(n)&&(n.toString===Gb||!et(n.toString))?Jb(n)?ee(n.value):JSON.stringify(n,Yb,2):String(n),Yb=(n,e)=>Jb(e)?Yb(n,e.value):nl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[tp(r,i)+" =>"]=s,t),{})}:Ol(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>tp(t))}:cs(e)?tp(e):qt(e)&&!He(e)&&!Wb(e)?String(e):e,tp=(n,e="")=>{var t;return cs(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Rr;class Y1{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Rr,!e&&Rr&&(this.index=(Rr.scopes||(Rr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Rr;try{return Rr=this,e()}finally{Rr=t}}}on(){++this._on===1&&(this.prevScope=Rr,Rr=this)}off(){this._on>0&&--this._on===0&&(Rr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function X1(){return Rr}let Kt;const np=new WeakSet;class Xb{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Rr&&Rr.active&&Rr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,np.has(this)&&(np.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||ew(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Dy(this),tw(this);const e=Kt,t=as;Kt=this,as=!0;try{return this.fn()}finally{nw(this),Kt=e,as=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Qm(e);this.deps=this.depsTail=void 0,Dy(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?np.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Bp(this)&&this.run()}get dirty(){return Bp(this)}}let Zb=0,Uu,ju;function ew(n,e=!1){if(n.flags|=8,e){n.next=ju,ju=n;return}n.next=Uu,Uu=n}function Gm(){Zb++}function Wm(){if(--Zb>0)return;if(ju){let e=ju;for(ju=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Uu;){let e=Uu;for(Uu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function tw(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function nw(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Qm(r),Z1(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Bp(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(rw(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function rw(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===rc)||(n.globalVersion=rc,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Bp(n))))return;n.flags|=2;const e=n.dep,t=Kt,r=as;Kt=n,as=!0;try{tw(n);const s=n.fn(n._value);(e.version===0||Wi(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Kt=t,as=r,nw(n),n.flags&=-3}}function Qm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Qm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function Z1(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let as=!0;const sw=[];function ti(){sw.push(as),as=!1}function ni(){const n=sw.pop();as=n===void 0?!0:n}function Dy(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Kt;Kt=void 0;try{e()}finally{Kt=t}}}let rc=0;class eS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Jm{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Kt||!as||Kt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Kt)t=this.activeLink=new eS(Kt,this),Kt.deps?(t.prevDep=Kt.depsTail,Kt.depsTail.nextDep=t,Kt.depsTail=t):Kt.deps=Kt.depsTail=t,iw(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Kt.depsTail,t.nextDep=void 0,Kt.depsTail.nextDep=t,Kt.depsTail=t,Kt.deps===t&&(Kt.deps=r)}return t}trigger(e){this.version++,rc++,this.notify(e)}notify(e){Gm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Wm()}}}function iw(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)iw(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const qp=new WeakMap,zo=Symbol(""),zp=Symbol(""),sc=Symbol("");function or(n,e,t){if(as&&Kt){let r=qp.get(n);r||qp.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Jm),s.map=r,s.key=t),s.track()}}function Bs(n,e,t,r,s,i){const o=qp.get(n);if(!o){rc++;return}const a=l=>{l&&l.trigger()};if(Gm(),e==="clear")o.forEach(a);else{const l=He(n),c=l&&Hm(t);if(l&&t==="length"){const h=Number(r);o.forEach((f,m)=>{(m==="length"||m===sc||!cs(m)&&m>=h)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(sc)),e){case"add":l?c&&a(o.get("length")):(a(o.get(zo)),nl(n)&&a(o.get(zp)));break;case"delete":l||(a(o.get(zo)),nl(n)&&a(o.get(zp)));break;case"set":nl(n)&&a(o.get(zo));break}}Wm()}function Ba(n){const e=Ct(n);return e===n?e:(or(e,"iterate",sc),Yr(n)?e:e.map(Gn))}function zh(n){return or(n=Ct(n),"iterate",sc),n}const tS={__proto__:null,[Symbol.iterator](){return rp(this,Symbol.iterator,Gn)},concat(...n){return Ba(this).concat(...n.map(e=>He(e)?Ba(e):e))},entries(){return rp(this,"entries",n=>(n[1]=Gn(n[1]),n))},every(n,e){return Ls(this,"every",n,e,void 0,arguments)},filter(n,e){return Ls(this,"filter",n,e,t=>t.map(Gn),arguments)},find(n,e){return Ls(this,"find",n,e,Gn,arguments)},findIndex(n,e){return Ls(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Ls(this,"findLast",n,e,Gn,arguments)},findLastIndex(n,e){return Ls(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Ls(this,"forEach",n,e,void 0,arguments)},includes(...n){return sp(this,"includes",n)},indexOf(...n){return sp(this,"indexOf",n)},join(n){return Ba(this).join(n)},lastIndexOf(...n){return sp(this,"lastIndexOf",n)},map(n,e){return Ls(this,"map",n,e,void 0,arguments)},pop(){return _u(this,"pop")},push(...n){return _u(this,"push",n)},reduce(n,...e){return Ny(this,"reduce",n,e)},reduceRight(n,...e){return Ny(this,"reduceRight",n,e)},shift(){return _u(this,"shift")},some(n,e){return Ls(this,"some",n,e,void 0,arguments)},splice(...n){return _u(this,"splice",n)},toReversed(){return Ba(this).toReversed()},toSorted(n){return Ba(this).toSorted(n)},toSpliced(...n){return Ba(this).toSpliced(...n)},unshift(...n){return _u(this,"unshift",n)},values(){return rp(this,"values",Gn)}};function rp(n,e,t){const r=zh(n),s=r[e]();return r!==n&&!Yr(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const nS=Array.prototype;function Ls(n,e,t,r,s,i){const o=zh(n),a=o!==n&&!Yr(n),l=o[e];if(l!==nS[e]){const f=l.apply(n,i);return a?Gn(f):f}let c=t;o!==n&&(a?c=function(f,m){return t.call(this,Gn(f),m,n)}:t.length>2&&(c=function(f,m){return t.call(this,f,m,n)}));const h=l.call(o,c,r);return a&&s?s(h):h}function Ny(n,e,t,r){const s=zh(n);let i=t;return s!==n&&(Yr(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Gn(a),l,n)}),s[e](i,...r)}function sp(n,e,t){const r=Ct(n);or(r,"iterate",sc);const s=r[e](...t);return(s===-1||s===!1)&&Zm(t[0])?(t[0]=Ct(t[0]),r[e](...t)):s}function _u(n,e,t=[]){ti(),Gm();const r=Ct(n)[e].apply(n,t);return Wm(),ni(),r}const rS=Bm("__proto__,__v_isRef,__isVue"),ow=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(cs));function sS(n){cs(n)||(n=String(n));const e=Ct(this);return or(e,"has",n),e.hasOwnProperty(n)}class aw{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?pS:dw:i?cw:uw).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=He(e);if(!s){let l;if(o&&(l=tS[t]))return l;if(t==="hasOwnProperty")return sS}const a=Reflect.get(e,t,lr(e)?e:r);return(cs(t)?ow.has(t):rS(t))||(s||or(e,"get",t),i)?a:lr(a)?o&&Hm(t)?a:a.value:qt(a)?s?fw(a):Hh(a):a}}class lw extends aw{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Xi(i);if(!Yr(r)&&!Xi(r)&&(i=Ct(i),r=Ct(r)),!He(e)&&lr(i)&&!lr(r))return l?!1:(i.value=r,!0)}const o=He(e)&&Hm(t)?Number(t)<e.length:Mt(e,t),a=Reflect.set(e,t,r,lr(e)?e:s);return e===Ct(s)&&(o?Wi(r,i)&&Bs(e,"set",t,r):Bs(e,"add",t,r)),a}deleteProperty(e,t){const r=Mt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Bs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!cs(t)||!ow.has(t))&&or(e,"has",t),r}ownKeys(e){return or(e,"iterate",He(e)?"length":zo),Reflect.ownKeys(e)}}class iS extends aw{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const oS=new lw,aS=new iS,lS=new lw(!0);const Hp=n=>n,wd=n=>Reflect.getPrototypeOf(n);function uS(n,e,t){return function(...r){const s=this.__v_raw,i=Ct(s),o=nl(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),h=t?Hp:e?oh:Gn;return!e&&or(i,"iterate",l?zp:zo),{next(){const{value:f,done:m}=c.next();return m?{value:f,done:m}:{value:a?[h(f[0]),h(f[1])]:h(f),done:m}},[Symbol.iterator](){return this}}}}function xd(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function cS(n,e){const t={get(s){const i=this.__v_raw,o=Ct(i),a=Ct(s);n||(Wi(s,a)&&or(o,"get",s),or(o,"get",a));const{has:l}=wd(o),c=e?Hp:n?oh:Gn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&or(Ct(s),"iterate",zo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Ct(i),a=Ct(s);return n||(Wi(s,a)&&or(o,"has",s),or(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Ct(a),c=e?Hp:n?oh:Gn;return!n&&or(l,"iterate",zo),a.forEach((h,f)=>s.call(i,c(h),c(f),o))}};return Nn(t,n?{add:xd("add"),set:xd("set"),delete:xd("delete"),clear:xd("clear")}:{add(s){!e&&!Yr(s)&&!Xi(s)&&(s=Ct(s));const i=Ct(this);return wd(i).has.call(i,s)||(i.add(s),Bs(i,"add",s,s)),this},set(s,i){!e&&!Yr(i)&&!Xi(i)&&(i=Ct(i));const o=Ct(this),{has:a,get:l}=wd(o);let c=a.call(o,s);c||(s=Ct(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,i),c?Wi(i,h)&&Bs(o,"set",s,i):Bs(o,"add",s,i),this},delete(s){const i=Ct(this),{has:o,get:a}=wd(i);let l=o.call(i,s);l||(s=Ct(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&Bs(i,"delete",s,void 0),c},clear(){const s=Ct(this),i=s.size!==0,o=s.clear();return i&&Bs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=uS(s,n,e)}),t}function Ym(n,e){const t=cS(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Mt(t,s)&&s in r?t:r,s,i)}const dS={get:Ym(!1,!1)},hS={get:Ym(!1,!0)},fS={get:Ym(!0,!1)};const uw=new WeakMap,cw=new WeakMap,dw=new WeakMap,pS=new WeakMap;function mS(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function gS(n){return n.__v_skip||!Object.isExtensible(n)?0:mS(U1(n))}function Hh(n){return Xi(n)?n:Xm(n,!1,oS,dS,uw)}function hw(n){return Xm(n,!1,lS,hS,cw)}function fw(n){return Xm(n,!0,aS,fS,dw)}function Xm(n,e,t,r,s){if(!qt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=gS(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function rl(n){return Xi(n)?rl(n.__v_raw):!!(n&&n.__v_isReactive)}function Xi(n){return!!(n&&n.__v_isReadonly)}function Yr(n){return!!(n&&n.__v_isShallow)}function Zm(n){return n?!!n.__v_raw:!1}function Ct(n){const e=n&&n.__v_raw;return e?Ct(e):n}function vS(n){return!Mt(n,"__v_skip")&&Object.isExtensible(n)&&jp(n,"__v_skip",!0),n}const Gn=n=>qt(n)?Hh(n):n,oh=n=>qt(n)?fw(n):n;function lr(n){return n?n.__v_isRef===!0:!1}function S(n){return pw(n,!1)}function yS(n){return pw(n,!0)}function pw(n,e){return lr(n)?n:new _S(n,e)}class _S{constructor(e,t){this.dep=new Jm,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ct(e),this._value=t?e:Gn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Yr(e)||Xi(e);e=r?e:Ct(e),Wi(e,t)&&(this._rawValue=e,this._value=r?e:Gn(e),this.dep.trigger())}}function Br(n){return lr(n)?n.value:n}const bS={get:(n,e,t)=>e==="__v_raw"?n:Br(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return lr(s)&&!lr(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function mw(n){return rl(n)?n:new Proxy(n,bS)}class wS{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Jm(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=rc-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Kt!==this)return ew(this,!0),!0}get value(){const e=this.dep.track();return rw(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function xS(n,e,t=!1){let r,s;return et(n)?r=n:(r=n.get,s=n.set),new wS(r,s,t)}const Id={},ah=new WeakMap;let ko;function IS(n,e=!1,t=ko){if(t){let r=ah.get(t);r||ah.set(t,r=[]),r.push(n)}}function ES(n,e,t=Bt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=q=>s?q:Yr(q)||s===!1||s===0?qs(q,1):qs(q);let h,f,m,v,w=!1,x=!1;if(lr(n)?(f=()=>n.value,w=Yr(n)):rl(n)?(f=()=>c(n),w=!0):He(n)?(x=!0,w=n.some(q=>rl(q)||Yr(q)),f=()=>n.map(q=>{if(lr(q))return q.value;if(rl(q))return c(q);if(et(q))return l?l(q,2):q()})):et(n)?e?f=l?()=>l(n,2):n:f=()=>{if(m){ti();try{m()}finally{ni()}}const q=ko;ko=h;try{return l?l(n,3,[v]):n(v)}finally{ko=q}}:f=os,e&&s){const q=f,te=s===!0?1/0:s;f=()=>qs(q(),te)}const I=X1(),O=()=>{h.stop(),I&&I.active&&zm(I.effects,h)};if(i&&e){const q=e;e=(...te)=>{q(...te),O()}}let L=x?new Array(n.length).fill(Id):Id;const U=q=>{if(!(!(h.flags&1)||!h.dirty&&!q))if(e){const te=h.run();if(s||w||(x?te.some((X,A)=>Wi(X,L[A])):Wi(te,L))){m&&m();const X=ko;ko=h;try{const A=[te,L===Id?void 0:x&&L[0]===Id?[]:L,v];L=te,l?l(e,3,A):e(...A)}finally{ko=X}}}else h.run()};return a&&a(U),h=new Xb(f),h.scheduler=o?()=>o(U,!1):U,v=q=>IS(q,!1,h),m=h.onStop=()=>{const q=ah.get(h);if(q){if(l)l(q,4);else for(const te of q)te();ah.delete(h)}},e?r?U(!0):L=h.run():o?o(U.bind(null,!0),!0):h.run(),O.pause=h.pause.bind(h),O.resume=h.resume.bind(h),O.stop=O,O}function qs(n,e=1/0,t){if(e<=0||!qt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,lr(n))qs(n.value,e,t);else if(He(n))for(let r=0;r<n.length;r++)qs(n[r],e,t);else if(Ol(n)||nl(n))n.forEach(r=>{qs(r,e,t)});else if(Wb(n)){for(const r in n)qs(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&qs(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function $c(n,e,t,r){try{return r?n(...r):n()}catch(s){Kh(s,e,t)}}function ds(n,e,t,r){if(et(n)){const s=$c(n,e,t,r);return s&&Kb(s)&&s.catch(i=>{Kh(i,e,t)}),s}if(He(n)){const s=[];for(let i=0;i<n.length;i++)s.push(ds(n[i],e,t,r));return s}}function Kh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Bt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const h=a.ec;if(h){for(let f=0;f<h.length;f++)if(h[f](n,l,c)===!1)return}a=a.parent}if(i){ti(),$c(i,null,10,[n,l,c]),ni();return}}TS(n,t,s,r,o)}function TS(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const _r=[];let Es=-1;const sl=[];let Di=null,Ga=0;const gw=Promise.resolve();let lh=null;function tn(n){const e=lh||gw;return n?e.then(this?n.bind(this):n):e}function AS(n){let e=Es+1,t=_r.length;for(;e<t;){const r=e+t>>>1,s=_r[r],i=ic(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function eg(n){if(!(n.flags&1)){const e=ic(n),t=_r[_r.length-1];!t||!(n.flags&2)&&e>=ic(t)?_r.push(n):_r.splice(AS(e),0,n),n.flags|=1,vw()}}function vw(){lh||(lh=gw.then(_w))}function SS(n){He(n)?sl.push(...n):Di&&n.id===-1?Di.splice(Ga+1,0,n):n.flags&1||(sl.push(n),n.flags|=1),vw()}function Oy(n,e,t=Es+1){for(;t<_r.length;t++){const r=_r[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;_r.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function yw(n){if(sl.length){const e=[...new Set(sl)].sort((t,r)=>ic(t)-ic(r));if(sl.length=0,Di){Di.push(...e);return}for(Di=e,Ga=0;Ga<Di.length;Ga++){const t=Di[Ga];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Di=null,Ga=0}}const ic=n=>n.id==null?n.flags&2?-1:1/0:n.id;function _w(n){const e=os;try{for(Es=0;Es<_r.length;Es++){const t=_r[Es];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),$c(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Es<_r.length;Es++){const t=_r[Es];t&&(t.flags&=-2)}Es=-1,_r.length=0,yw(),lh=null,(_r.length||sl.length)&&_w()}}let Bn=null,bw=null;function uh(n){const e=Bn;return Bn=n,bw=n&&n.type.__scopeId||null,e}function Fd(n,e=Bn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Gy(-1);const i=uh(e);let o;try{o=n(...s)}finally{uh(i),r._d&&Gy(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function st(n,e){if(Bn===null)return n;const t=Yh(Bn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Bt]=e[s];i&&(et(i)&&(i={mounted:i,updated:i}),i.deep&&qs(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Ao(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(ti(),ds(l,t,8,[n.el,a,n,e]),ni())}}const ww=Symbol("_vte"),xw=n=>n.__isTeleport,Bu=n=>n&&(n.disabled||n.disabled===""),Vy=n=>n&&(n.defer||n.defer===""),My=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Ly=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Kp=(n,e)=>{const t=n&&n.to;return pn(t)?e?e(t):null:t},Iw={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:h,pc:f,pbc:m,o:{insert:v,querySelector:w,createText:x,createComment:I}}=c,O=Bu(e.props);let{shapeFlag:L,children:U,dynamicChildren:q}=e;if(n==null){const te=e.el=x(""),X=e.anchor=x("");v(te,t,r),v(X,t,r);const A=(T,k)=>{L&16&&(s&&s.isCE&&(s.ce._teleportTarget=T),h(U,T,k,s,i,o,a,l))},_=()=>{const T=e.target=Kp(e.props,w),k=Ew(T,e,x,v);T&&(o!=="svg"&&My(T)?o="svg":o!=="mathml"&&Ly(T)&&(o="mathml"),O||(A(T,k),Ud(e,!1)))};O&&(A(t,X),Ud(e,!0)),Vy(e.props)?(e.el.__isMounted=!1,yr(()=>{_(),delete e.el.__isMounted},i)):_()}else{if(Vy(e.props)&&n.el.__isMounted===!1){yr(()=>{Iw.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const te=e.anchor=n.anchor,X=e.target=n.target,A=e.targetAnchor=n.targetAnchor,_=Bu(n.props),T=_?t:X,k=_?te:A;if(o==="svg"||My(X)?o="svg":(o==="mathml"||Ly(X))&&(o="mathml"),q?(m(n.dynamicChildren,q,T,s,i,o,a),ig(n,e,!0)):l||f(n,e,T,k,s,i,o,a,!1),O)_?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Ed(e,t,te,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const $=e.target=Kp(e.props,w);$&&Ed(e,$,null,c,0)}else _&&Ed(e,X,A,c,1);Ud(e,O)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:h,target:f,props:m}=n;if(f&&(s(c),s(h)),i&&s(l),o&16){const v=i||!Bu(m);for(let w=0;w<a.length;w++){const x=a[w];r(x,e,t,v,!!x.dynamicChildren)}}},move:Ed,hydrate:PS};function Ed(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=i===2;if(f&&r(o,e,t),(!f||Bu(h))&&l&16)for(let m=0;m<c.length;m++)s(c[m],e,t,2);f&&r(a,e,t)}function PS(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:h}},f){const m=e.target=Kp(e.props,l);if(m){const v=Bu(e.props),w=m._lpa||m.firstChild;if(e.shapeFlag&16)if(v)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=w,e.targetAnchor=w&&o(w);else{e.anchor=o(n);let x=w;for(;x;){if(x&&x.nodeType===8){if(x.data==="teleport start anchor")e.targetStart=x;else if(x.data==="teleport anchor"){e.targetAnchor=x,m._lpa=e.targetAnchor&&o(e.targetAnchor);break}}x=o(x)}e.targetAnchor||Ew(m,e,h,c),f(w&&o(w),e,m,t,r,s,i)}Ud(e,v)}return e.anchor&&o(e.anchor)}const oc=Iw;function Ud(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function Ew(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[ww]=i,n&&(r(s,n),r(i,n)),i}const Ni=Symbol("_leaveCb"),Td=Symbol("_enterCb");function RS(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Tn(()=>{n.isMounted=!0}),tg(()=>{n.isUnmounting=!0}),n}const Jr=[Function,Array],Tw={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Jr,onEnter:Jr,onAfterEnter:Jr,onEnterCancelled:Jr,onBeforeLeave:Jr,onLeave:Jr,onAfterLeave:Jr,onLeaveCancelled:Jr,onBeforeAppear:Jr,onAppear:Jr,onAfterAppear:Jr,onAppearCancelled:Jr},Aw=n=>{const e=n.subTree;return e.component?Aw(e.component):e},CS={name:"BaseTransition",props:Tw,setup(n,{slots:e}){const t=SP(),r=RS();return()=>{const s=e.default&&Rw(e.default(),!0);if(!s||!s.length)return;const i=Sw(s),o=Ct(n),{mode:a}=o;if(r.isLeaving)return ip(i);const l=$y(i);if(!l)return ip(i);let c=Gp(l,o,r,t,f=>c=f);l.type!==ar&&ac(l,c);let h=t.subTree&&$y(t.subTree);if(h&&h.type!==ar&&!Mo(l,h)&&Aw(t).type!==ar){let f=Gp(h,o,r,t);if(ac(h,f),a==="out-in"&&l.type!==ar)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,h=void 0},ip(i);a==="in-out"&&l.type!==ar?f.delayLeave=(m,v,w)=>{const x=Pw(r,h);x[String(h.key)]=h,m[Ni]=()=>{v(),m[Ni]=void 0,delete c.delayedLeave,h=void 0},c.delayedLeave=()=>{w(),delete c.delayedLeave,h=void 0}}:h=void 0}else h&&(h=void 0);return i}}};function Sw(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==ar){e=t;break}}return e}const kS=CS;function Pw(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function Gp(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:h,onEnterCancelled:f,onBeforeLeave:m,onLeave:v,onAfterLeave:w,onLeaveCancelled:x,onBeforeAppear:I,onAppear:O,onAfterAppear:L,onAppearCancelled:U}=e,q=String(n.key),te=Pw(t,n),X=(T,k)=>{T&&ds(T,r,9,k)},A=(T,k)=>{const $=k[1];X(T,k),He(T)?T.every(V=>V.length<=1)&&$():T.length<=1&&$()},_={mode:o,persisted:a,beforeEnter(T){let k=l;if(!t.isMounted)if(i)k=I||l;else return;T[Ni]&&T[Ni](!0);const $=te[q];$&&Mo(n,$)&&$.el[Ni]&&$.el[Ni](),X(k,[T])},enter(T){let k=c,$=h,V=f;if(!t.isMounted)if(i)k=O||c,$=L||h,V=U||f;else return;let R=!1;const Ke=T[Td]=ut=>{R||(R=!0,ut?X(V,[T]):X($,[T]),_.delayedLeave&&_.delayedLeave(),T[Td]=void 0)};k?A(k,[T,Ke]):Ke()},leave(T,k){const $=String(n.key);if(T[Td]&&T[Td](!0),t.isUnmounting)return k();X(m,[T]);let V=!1;const R=T[Ni]=Ke=>{V||(V=!0,k(),Ke?X(x,[T]):X(w,[T]),T[Ni]=void 0,te[$]===n&&delete te[$])};te[$]=n,v?A(v,[T,R]):R()},clone(T){const k=Gp(T,e,t,r,s);return s&&s(k),k}};return _}function ip(n){if(Gh(n))return n=Zi(n),n.children=null,n}function $y(n){if(!Gh(n))return xw(n.type)&&n.children?Sw(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&et(t.default))return t.default()}}function ac(n,e){n.shapeFlag&6&&n.component?(n.transition=e,ac(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function Rw(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===mt?(o.patchFlag&128&&s++,r=r.concat(Rw(o.children,e,a))):(e||o.type!==ar)&&r.push(a!=null?Zi(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function Cw(n,e){return et(n)?(()=>Nn({name:n.name},e,{setup:n}))():n}function kw(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function qu(n,e,t,r,s=!1){if(He(n)){n.forEach((w,x)=>qu(w,e&&(He(e)?e[x]:e),t,r,s));return}if(il(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&qu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Yh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Bt?a.refs={}:a.refs,f=a.setupState,m=Ct(f),v=f===Bt?()=>!1:w=>Mt(m,w);if(c!=null&&c!==l&&(pn(c)?(h[c]=null,v(c)&&(f[c]=null)):lr(c)&&(c.value=null)),et(l))$c(l,a,12,[o,h]);else{const w=pn(l),x=lr(l);if(w||x){const I=()=>{if(n.f){const O=w?v(l)?f[l]:h[l]:l.value;s?He(O)&&zm(O,i):He(O)?O.includes(i)||O.push(i):w?(h[l]=[i],v(l)&&(f[l]=h[l])):(l.value=[i],n.k&&(h[n.k]=l.value))}else w?(h[l]=o,v(l)&&(f[l]=o)):x&&(l.value=o,n.k&&(h[n.k]=o))};o?(I.id=-1,yr(I,t)):I()}}}qh().requestIdleCallback;qh().cancelIdleCallback;const il=n=>!!n.type.__asyncLoader,Gh=n=>n.type.__isKeepAlive;function DS(n,e){Dw(n,"a",e)}function NS(n,e){Dw(n,"da",e)}function Dw(n,e,t=Wn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Wh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Gh(s.parent.vnode)&&OS(r,e,t,s),s=s.parent}}function OS(n,e,t,r){const s=Wh(e,n,r,!0);Qs(()=>{zm(r[e],s)},t)}function Wh(n,e,t=Wn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{ti();const a=Fc(t),l=ds(e,t,n,o);return a(),ni(),l});return r?s.unshift(i):s.push(i),i}}const ui=n=>(e,t=Wn)=>{(!cc||n==="sp")&&Wh(n,(...r)=>e(...r),t)},VS=ui("bm"),Tn=ui("m"),MS=ui("bu"),LS=ui("u"),tg=ui("bum"),Qs=ui("um"),$S=ui("sp"),FS=ui("rtg"),US=ui("rtc");function jS(n,e=Wn){Wh("ec",n,e)}const Nw="components";function BS(n,e){return zS(Nw,n,!0,e)||n}const qS=Symbol.for("v-ndc");function zS(n,e,t=!0,r=!1){const s=Bn||Wn;if(s){const i=s.type;if(n===Nw){const a=DP(i,!1);if(a&&(a===e||a===Xr(e)||a===Bh(Xr(e))))return i}const o=Fy(s[n]||i[n],e)||Fy(s.appContext[n],e);return!o&&r?i:o}}function Fy(n,e){return n&&(n[e]||n[Xr(e)]||n[Bh(Xr(e))])}function jr(n,e,t,r){let s;const i=t&&t[r],o=He(n);if(o||pn(n)){const a=o&&rl(n);let l=!1,c=!1;a&&(l=!Yr(n),c=Xi(n),n=zh(n)),s=new Array(n.length);for(let h=0,f=n.length;h<f;h++)s[h]=e(l?c?oh(Gn(n[h])):Gn(n[h]):n[h],h,void 0,i&&i[h])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(qt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const h=a[l];s[l]=e(n[h],h,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function HS(n,e,t={},r,s){if(Bn.ce||Bn.parent&&il(Bn.parent)&&Bn.parent.ce)return e!=="default"&&(t.name=e),C(),Js(mt,null,[Be("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),C();const o=i&&Ow(i(t)),a=t.key||o&&o.key,l=Js(mt,{key:(a&&!cs(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function Ow(n){return n.some(e=>uc(e)?!(e.type===ar||e.type===mt&&!Ow(e.children)):!0)?n:null}const Wp=n=>n?Xw(n)?Yh(n):Wp(n.parent):null,zu=Nn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Wp(n.parent),$root:n=>Wp(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>ng(n),$forceUpdate:n=>n.f||(n.f=()=>{eg(n.update)}),$nextTick:n=>n.n||(n.n=tn.bind(n.proxy)),$watch:n=>hP.bind(n)}),op=(n,e)=>n!==Bt&&!n.__isScriptSetup&&Mt(n,e),KS={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(op(r,e))return o[e]=1,r[e];if(s!==Bt&&Mt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&Mt(c,e))return o[e]=3,i[e];if(t!==Bt&&Mt(t,e))return o[e]=4,t[e];Qp&&(o[e]=0)}}const h=zu[e];let f,m;if(h)return e==="$attrs"&&or(n.attrs,"get",""),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Bt&&Mt(t,e))return o[e]=4,t[e];if(m=l.config.globalProperties,Mt(m,e))return m[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return op(s,e)?(s[e]=t,!0):r!==Bt&&Mt(r,e)?(r[e]=t,!0):Mt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Bt&&Mt(n,o)||op(e,o)||(a=i[0])&&Mt(a,o)||Mt(r,o)||Mt(zu,o)||Mt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Mt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Uy(n){return He(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Qp=!0;function GS(n){const e=ng(n),t=n.proxy,r=n.ctx;Qp=!1,e.beforeCreate&&jy(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:m,beforeUpdate:v,updated:w,activated:x,deactivated:I,beforeDestroy:O,beforeUnmount:L,destroyed:U,unmounted:q,render:te,renderTracked:X,renderTriggered:A,errorCaptured:_,serverPrefetch:T,expose:k,inheritAttrs:$,components:V,directives:R,filters:Ke}=e;if(c&&WS(c,r,null),o)for(const Ge in o){const Ae=o[Ge];et(Ae)&&(r[Ge]=Ae.bind(t))}if(s){const Ge=s.call(t,t);qt(Ge)&&(n.data=Hh(Ge))}if(Qp=!0,i)for(const Ge in i){const Ae=i[Ge],fe=et(Ae)?Ae.bind(t,t):et(Ae.get)?Ae.get.bind(t,t):os,Je=!et(Ae)&&et(Ae.set)?Ae.set.bind(t):os,ae=qe({get:fe,set:Je});Object.defineProperty(r,Ge,{enumerable:!0,configurable:!0,get:()=>ae.value,set:ne=>ae.value=ne})}if(a)for(const Ge in a)Vw(a[Ge],r,t,Ge);if(l){const Ge=et(l)?l.call(t):l;Reflect.ownKeys(Ge).forEach(Ae=>{jd(Ae,Ge[Ae])})}h&&jy(h,n,"c");function ct(Ge,Ae){He(Ae)?Ae.forEach(fe=>Ge(fe.bind(t))):Ae&&Ge(Ae.bind(t))}if(ct(VS,f),ct(Tn,m),ct(MS,v),ct(LS,w),ct(DS,x),ct(NS,I),ct(jS,_),ct(US,X),ct(FS,A),ct(tg,L),ct(Qs,q),ct($S,T),He(k))if(k.length){const Ge=n.exposed||(n.exposed={});k.forEach(Ae=>{Object.defineProperty(Ge,Ae,{get:()=>t[Ae],set:fe=>t[Ae]=fe})})}else n.exposed||(n.exposed={});te&&n.render===os&&(n.render=te),$!=null&&(n.inheritAttrs=$),V&&(n.components=V),R&&(n.directives=R),T&&kw(n)}function WS(n,e,t=os){He(n)&&(n=Jp(n));for(const r in n){const s=n[r];let i;qt(s)?"default"in s?i=ls(s.from||r,s.default,!0):i=ls(s.from||r):i=ls(s),lr(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function jy(n,e,t){ds(He(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Vw(n,e,t,r){let s=r.includes(".")?Gw(t,r):()=>t[r];if(pn(n)){const i=e[n];et(i)&&kt(s,i)}else if(et(n))kt(s,n.bind(t));else if(qt(n))if(He(n))n.forEach(i=>Vw(i,e,t,r));else{const i=et(n.handler)?n.handler.bind(t):e[n.handler];et(i)&&kt(s,i,n)}}function ng(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>ch(l,c,o,!0)),ch(l,e,o)),qt(e)&&i.set(e,l),l}function ch(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&ch(n,i,t,!0),s&&s.forEach(o=>ch(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=QS[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const QS={data:By,props:qy,emits:qy,methods:ku,computed:ku,beforeCreate:vr,created:vr,beforeMount:vr,mounted:vr,beforeUpdate:vr,updated:vr,beforeDestroy:vr,beforeUnmount:vr,destroyed:vr,unmounted:vr,activated:vr,deactivated:vr,errorCaptured:vr,serverPrefetch:vr,components:ku,directives:ku,watch:YS,provide:By,inject:JS};function By(n,e){return e?n?function(){return Nn(et(n)?n.call(this,this):n,et(e)?e.call(this,this):e)}:e:n}function JS(n,e){return ku(Jp(n),Jp(e))}function Jp(n){if(He(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function vr(n,e){return n?[...new Set([].concat(n,e))]:e}function ku(n,e){return n?Nn(Object.create(null),n,e):e}function qy(n,e){return n?He(n)&&He(e)?[...new Set([...n,...e])]:Nn(Object.create(null),Uy(n),Uy(e??{})):e}function YS(n,e){if(!n)return e;if(!e)return n;const t=Nn(Object.create(null),n);for(const r in e)t[r]=vr(n[r],e[r]);return t}function Mw(){return{app:null,config:{isNativeTag:$1,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let XS=0;function ZS(n,e){return function(r,s=null){et(r)||(r=Nn({},r)),s!=null&&!qt(s)&&(s=null);const i=Mw(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:XS++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:OP,get config(){return i.config},set config(h){},use(h,...f){return o.has(h)||(h&&et(h.install)?(o.add(h),h.install(c,...f)):et(h)&&(o.add(h),h(c,...f))),c},mixin(h){return i.mixins.includes(h)||i.mixins.push(h),c},component(h,f){return f?(i.components[h]=f,c):i.components[h]},directive(h,f){return f?(i.directives[h]=f,c):i.directives[h]},mount(h,f,m){if(!l){const v=c._ceVNode||Be(r,s);return v.appContext=i,m===!0?m="svg":m===!1&&(m=void 0),f&&e?e(v,h):n(v,h,m),l=!0,c._container=h,h.__vue_app__=c,Yh(v.component)}},onUnmount(h){a.push(h)},unmount(){l&&(ds(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,f){return i.provides[h]=f,c},runWithContext(h){const f=ol;ol=c;try{return h()}finally{ol=f}}};return c}}let ol=null;function jd(n,e){if(Wn){let t=Wn.provides;const r=Wn.parent&&Wn.parent.provides;r===t&&(t=Wn.provides=Object.create(r)),t[n]=e}}function ls(n,e,t=!1){const r=Wn||Bn;if(r||ol){let s=ol?ol._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&et(e)?e.call(r&&r.proxy):e}}const Lw={},$w=()=>Object.create(Lw),Fw=n=>Object.getPrototypeOf(n)===Lw;function eP(n,e,t,r=!1){const s={},i=$w();n.propsDefaults=Object.create(null),Uw(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:hw(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function tP(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Ct(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let m=h[f];if(Qh(n.emitsOptions,m))continue;const v=e[m];if(l)if(Mt(i,m))v!==i[m]&&(i[m]=v,c=!0);else{const w=Xr(m);s[w]=Yp(l,a,w,v,n,!1)}else v!==i[m]&&(i[m]=v,c=!0)}}}else{Uw(n,e,s,i)&&(c=!0);let h;for(const f in a)(!e||!Mt(e,f)&&((h=uo(f))===f||!Mt(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=Yp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!Mt(e,f))&&(delete i[f],c=!0)}c&&Bs(n.attrs,"set","")}function Uw(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Fu(l))continue;const c=e[l];let h;s&&Mt(s,h=Xr(l))?!i||!i.includes(h)?t[h]=c:(a||(a={}))[h]=c:Qh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=Ct(t),c=a||Bt;for(let h=0;h<i.length;h++){const f=i[h];t[f]=Yp(s,l,f,c[f],n,!Mt(c,f))}}return o}function Yp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Mt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&et(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const h=Fc(s);r=c[t]=l.call(null,e),h()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===uo(t))&&(r=!0))}return r}const nP=new WeakMap;function jw(n,e,t=!1){const r=t?nP:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!et(n)){const h=f=>{l=!0;const[m,v]=jw(f,e,!0);Nn(o,m),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!i&&!l)return qt(n)&&r.set(n,tl),tl;if(He(i))for(let h=0;h<i.length;h++){const f=Xr(i[h]);zy(f)&&(o[f]=Bt)}else if(i)for(const h in i){const f=Xr(h);if(zy(f)){const m=i[h],v=o[f]=He(m)||et(m)?{type:m}:Nn({},m),w=v.type;let x=!1,I=!0;if(He(w))for(let O=0;O<w.length;++O){const L=w[O],U=et(L)&&L.name;if(U==="Boolean"){x=!0;break}else U==="String"&&(I=!1)}else x=et(w)&&w.name==="Boolean";v[0]=x,v[1]=I,(x||Mt(v,"default"))&&a.push(f)}}const c=[o,a];return qt(n)&&r.set(n,c),c}function zy(n){return n[0]!=="$"&&!Fu(n)}const rg=n=>n[0]==="_"||n==="$stable",sg=n=>He(n)?n.map(Ts):[Ts(n)],rP=(n,e,t)=>{if(e._n)return e;const r=Fd((...s)=>sg(e(...s)),t);return r._c=!1,r},Bw=(n,e,t)=>{const r=n._ctx;for(const s in n){if(rg(s))continue;const i=n[s];if(et(i))e[s]=rP(s,i,r);else if(i!=null){const o=sg(i);e[s]=()=>o}}},qw=(n,e)=>{const t=sg(e);n.slots.default=()=>t},zw=(n,e,t)=>{for(const r in e)(t||!rg(r))&&(n[r]=e[r])},sP=(n,e,t)=>{const r=n.slots=$w();if(n.vnode.shapeFlag&32){const s=e.__;s&&jp(r,"__",s,!0);const i=e._;i?(zw(r,e,t),t&&jp(r,"_",i,!0)):Bw(e,r)}else e&&qw(n,e)},iP=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Bt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:zw(s,e,t):(i=!e.$stable,Bw(e,s)),o=e}else e&&(qw(n,e),o={default:1});if(i)for(const a in s)!rg(a)&&o[a]==null&&delete s[a]},yr=_P;function oP(n){return aP(n)}function aP(n,e){const t=qh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:m,setScopeId:v=os,insertStaticContent:w}=n,x=(P,N,H,K=null,Z=null,ue=null,ge=void 0,me=null,ye=!!N.dynamicChildren)=>{if(P===N)return;P&&!Mo(P,N)&&(K=Y(P),ne(P,Z,ue,!0),P=null),N.patchFlag===-2&&(ye=!1,N.dynamicChildren=null);const{type:pe,ref:Ve,shapeFlag:Te}=N;switch(pe){case Jh:I(P,N,H,K);break;case ar:O(P,N,H,K);break;case Bd:P==null&&L(N,H,K,ge);break;case mt:V(P,N,H,K,Z,ue,ge,me,ye);break;default:Te&1?te(P,N,H,K,Z,ue,ge,me,ye):Te&6?R(P,N,H,K,Z,ue,ge,me,ye):(Te&64||Te&128)&&pe.process(P,N,H,K,Z,ue,ge,me,ye,Pe)}Ve!=null&&Z?qu(Ve,P&&P.ref,ue,N||P,!N):Ve==null&&P&&P.ref!=null&&qu(P.ref,null,ue,P,!0)},I=(P,N,H,K)=>{if(P==null)r(N.el=a(N.children),H,K);else{const Z=N.el=P.el;N.children!==P.children&&c(Z,N.children)}},O=(P,N,H,K)=>{P==null?r(N.el=l(N.children||""),H,K):N.el=P.el},L=(P,N,H,K)=>{[P.el,P.anchor]=w(P.children,N,H,K,P.el,P.anchor)},U=({el:P,anchor:N},H,K)=>{let Z;for(;P&&P!==N;)Z=m(P),r(P,H,K),P=Z;r(N,H,K)},q=({el:P,anchor:N})=>{let H;for(;P&&P!==N;)H=m(P),s(P),P=H;s(N)},te=(P,N,H,K,Z,ue,ge,me,ye)=>{N.type==="svg"?ge="svg":N.type==="math"&&(ge="mathml"),P==null?X(N,H,K,Z,ue,ge,me,ye):T(P,N,Z,ue,ge,me,ye)},X=(P,N,H,K,Z,ue,ge,me)=>{let ye,pe;const{props:Ve,shapeFlag:Te,transition:Ce,dirs:Fe}=P;if(ye=P.el=o(P.type,ue,Ve&&Ve.is,Ve),Te&8?h(ye,P.children):Te&16&&_(P.children,ye,null,K,Z,ap(P,ue),ge,me),Fe&&Ao(P,null,K,"created"),A(ye,P,P.scopeId,ge,K),Ve){for(const We in Ve)We!=="value"&&!Fu(We)&&i(ye,We,null,Ve[We],ue,K);"value"in Ve&&i(ye,"value",null,Ve.value,ue),(pe=Ve.onVnodeBeforeMount)&&Is(pe,K,P)}Fe&&Ao(P,null,K,"beforeMount");const Ue=lP(Z,Ce);Ue&&Ce.beforeEnter(ye),r(ye,N,H),((pe=Ve&&Ve.onVnodeMounted)||Ue||Fe)&&yr(()=>{pe&&Is(pe,K,P),Ue&&Ce.enter(ye),Fe&&Ao(P,null,K,"mounted")},Z)},A=(P,N,H,K,Z)=>{if(H&&v(P,H),K)for(let ue=0;ue<K.length;ue++)v(P,K[ue]);if(Z){let ue=Z.subTree;if(N===ue||Qw(ue.type)&&(ue.ssContent===N||ue.ssFallback===N)){const ge=Z.vnode;A(P,ge,ge.scopeId,ge.slotScopeIds,Z.parent)}}},_=(P,N,H,K,Z,ue,ge,me,ye=0)=>{for(let pe=ye;pe<P.length;pe++){const Ve=P[pe]=me?Oi(P[pe]):Ts(P[pe]);x(null,Ve,N,H,K,Z,ue,ge,me)}},T=(P,N,H,K,Z,ue,ge)=>{const me=N.el=P.el;let{patchFlag:ye,dynamicChildren:pe,dirs:Ve}=N;ye|=P.patchFlag&16;const Te=P.props||Bt,Ce=N.props||Bt;let Fe;if(H&&So(H,!1),(Fe=Ce.onVnodeBeforeUpdate)&&Is(Fe,H,N,P),Ve&&Ao(N,P,H,"beforeUpdate"),H&&So(H,!0),(Te.innerHTML&&Ce.innerHTML==null||Te.textContent&&Ce.textContent==null)&&h(me,""),pe?k(P.dynamicChildren,pe,me,H,K,ap(N,Z),ue):ge||Ae(P,N,me,null,H,K,ap(N,Z),ue,!1),ye>0){if(ye&16)$(me,Te,Ce,H,Z);else if(ye&2&&Te.class!==Ce.class&&i(me,"class",null,Ce.class,Z),ye&4&&i(me,"style",Te.style,Ce.style,Z),ye&8){const Ue=N.dynamicProps;for(let We=0;We<Ue.length;We++){const rt=Ue[We],an=Te[rt],Ht=Ce[rt];(Ht!==an||rt==="value")&&i(me,rt,an,Ht,Z,H)}}ye&1&&P.children!==N.children&&h(me,N.children)}else!ge&&pe==null&&$(me,Te,Ce,H,Z);((Fe=Ce.onVnodeUpdated)||Ve)&&yr(()=>{Fe&&Is(Fe,H,N,P),Ve&&Ao(N,P,H,"updated")},K)},k=(P,N,H,K,Z,ue,ge)=>{for(let me=0;me<N.length;me++){const ye=P[me],pe=N[me],Ve=ye.el&&(ye.type===mt||!Mo(ye,pe)||ye.shapeFlag&198)?f(ye.el):H;x(ye,pe,Ve,null,K,Z,ue,ge,!0)}},$=(P,N,H,K,Z)=>{if(N!==H){if(N!==Bt)for(const ue in N)!Fu(ue)&&!(ue in H)&&i(P,ue,N[ue],null,Z,K);for(const ue in H){if(Fu(ue))continue;const ge=H[ue],me=N[ue];ge!==me&&ue!=="value"&&i(P,ue,me,ge,Z,K)}"value"in H&&i(P,"value",N.value,H.value,Z)}},V=(P,N,H,K,Z,ue,ge,me,ye)=>{const pe=N.el=P?P.el:a(""),Ve=N.anchor=P?P.anchor:a("");let{patchFlag:Te,dynamicChildren:Ce,slotScopeIds:Fe}=N;Fe&&(me=me?me.concat(Fe):Fe),P==null?(r(pe,H,K),r(Ve,H,K),_(N.children||[],H,Ve,Z,ue,ge,me,ye)):Te>0&&Te&64&&Ce&&P.dynamicChildren?(k(P.dynamicChildren,Ce,H,Z,ue,ge,me),(N.key!=null||Z&&N===Z.subTree)&&ig(P,N,!0)):Ae(P,N,H,Ve,Z,ue,ge,me,ye)},R=(P,N,H,K,Z,ue,ge,me,ye)=>{N.slotScopeIds=me,P==null?N.shapeFlag&512?Z.ctx.activate(N,H,K,ge,ye):Ke(N,H,K,Z,ue,ge,ye):ut(P,N,ye)},Ke=(P,N,H,K,Z,ue,ge)=>{const me=P.component=AP(P,K,Z);if(Gh(P)&&(me.ctx.renderer=Pe),PP(me,!1,ge),me.asyncDep){if(Z&&Z.registerDep(me,ct,ge),!P.el){const ye=me.subTree=Be(ar);O(null,ye,N,H)}}else ct(me,P,N,H,Z,ue,ge)},ut=(P,N,H)=>{const K=N.component=P.component;if(vP(P,N,H))if(K.asyncDep&&!K.asyncResolved){Ge(K,N,H);return}else K.next=N,K.update();else N.el=P.el,K.vnode=N},ct=(P,N,H,K,Z,ue,ge)=>{const me=()=>{if(P.isMounted){let{next:Te,bu:Ce,u:Fe,parent:Ue,vnode:We}=P;{const Qt=Hw(P);if(Qt){Te&&(Te.el=We.el,Ge(P,Te,ge)),Qt.asyncDep.then(()=>{P.isUnmounted||me()});return}}let rt=Te,an;So(P,!1),Te?(Te.el=We.el,Ge(P,Te,ge)):Te=We,Ce&&$d(Ce),(an=Te.props&&Te.props.onVnodeBeforeUpdate)&&Is(an,Ue,Te,We),So(P,!0);const Ht=lp(P),On=P.subTree;P.subTree=Ht,x(On,Ht,f(On.el),Y(On),P,Z,ue),Te.el=Ht.el,rt===null&&yP(P,Ht.el),Fe&&yr(Fe,Z),(an=Te.props&&Te.props.onVnodeUpdated)&&yr(()=>Is(an,Ue,Te,We),Z)}else{let Te;const{el:Ce,props:Fe}=N,{bm:Ue,m:We,parent:rt,root:an,type:Ht}=P,On=il(N);if(So(P,!1),Ue&&$d(Ue),!On&&(Te=Fe&&Fe.onVnodeBeforeMount)&&Is(Te,rt,N),So(P,!0),Ce&&vt){const Qt=()=>{P.subTree=lp(P),vt(Ce,P.subTree,P,Z,null)};On&&Ht.__asyncHydrate?Ht.__asyncHydrate(Ce,P,Qt):Qt()}else{an.ce&&an.ce._def.shadowRoot!==!1&&an.ce._injectChildStyle(Ht);const Qt=P.subTree=lp(P);x(null,Qt,H,K,P,Z,ue),N.el=Qt.el}if(We&&yr(We,Z),!On&&(Te=Fe&&Fe.onVnodeMounted)){const Qt=N;yr(()=>Is(Te,rt,Qt),Z)}(N.shapeFlag&256||rt&&il(rt.vnode)&&rt.vnode.shapeFlag&256)&&P.a&&yr(P.a,Z),P.isMounted=!0,N=H=K=null}};P.scope.on();const ye=P.effect=new Xb(me);P.scope.off();const pe=P.update=ye.run.bind(ye),Ve=P.job=ye.runIfDirty.bind(ye);Ve.i=P,Ve.id=P.uid,ye.scheduler=()=>eg(Ve),So(P,!0),pe()},Ge=(P,N,H)=>{N.component=P;const K=P.vnode.props;P.vnode=N,P.next=null,tP(P,N.props,K,H),iP(P,N.children,H),ti(),Oy(P),ni()},Ae=(P,N,H,K,Z,ue,ge,me,ye=!1)=>{const pe=P&&P.children,Ve=P?P.shapeFlag:0,Te=N.children,{patchFlag:Ce,shapeFlag:Fe}=N;if(Ce>0){if(Ce&128){Je(pe,Te,H,K,Z,ue,ge,me,ye);return}else if(Ce&256){fe(pe,Te,H,K,Z,ue,ge,me,ye);return}}Fe&8?(Ve&16&&en(pe,Z,ue),Te!==pe&&h(H,Te)):Ve&16?Fe&16?Je(pe,Te,H,K,Z,ue,ge,me,ye):en(pe,Z,ue,!0):(Ve&8&&h(H,""),Fe&16&&_(Te,H,K,Z,ue,ge,me,ye))},fe=(P,N,H,K,Z,ue,ge,me,ye)=>{P=P||tl,N=N||tl;const pe=P.length,Ve=N.length,Te=Math.min(pe,Ve);let Ce;for(Ce=0;Ce<Te;Ce++){const Fe=N[Ce]=ye?Oi(N[Ce]):Ts(N[Ce]);x(P[Ce],Fe,H,null,Z,ue,ge,me,ye)}pe>Ve?en(P,Z,ue,!0,!1,Te):_(N,H,K,Z,ue,ge,me,ye,Te)},Je=(P,N,H,K,Z,ue,ge,me,ye)=>{let pe=0;const Ve=N.length;let Te=P.length-1,Ce=Ve-1;for(;pe<=Te&&pe<=Ce;){const Fe=P[pe],Ue=N[pe]=ye?Oi(N[pe]):Ts(N[pe]);if(Mo(Fe,Ue))x(Fe,Ue,H,null,Z,ue,ge,me,ye);else break;pe++}for(;pe<=Te&&pe<=Ce;){const Fe=P[Te],Ue=N[Ce]=ye?Oi(N[Ce]):Ts(N[Ce]);if(Mo(Fe,Ue))x(Fe,Ue,H,null,Z,ue,ge,me,ye);else break;Te--,Ce--}if(pe>Te){if(pe<=Ce){const Fe=Ce+1,Ue=Fe<Ve?N[Fe].el:K;for(;pe<=Ce;)x(null,N[pe]=ye?Oi(N[pe]):Ts(N[pe]),H,Ue,Z,ue,ge,me,ye),pe++}}else if(pe>Ce)for(;pe<=Te;)ne(P[pe],Z,ue,!0),pe++;else{const Fe=pe,Ue=pe,We=new Map;for(pe=Ue;pe<=Ce;pe++){const _n=N[pe]=ye?Oi(N[pe]):Ts(N[pe]);_n.key!=null&&We.set(_n.key,pe)}let rt,an=0;const Ht=Ce-Ue+1;let On=!1,Qt=0;const Kr=new Array(Ht);for(pe=0;pe<Ht;pe++)Kr[pe]=0;for(pe=Fe;pe<=Te;pe++){const _n=P[pe];if(an>=Ht){ne(_n,Z,ue,!0);continue}let Pn;if(_n.key!=null)Pn=We.get(_n.key);else for(rt=Ue;rt<=Ce;rt++)if(Kr[rt-Ue]===0&&Mo(_n,N[rt])){Pn=rt;break}Pn===void 0?ne(_n,Z,ue,!0):(Kr[Pn-Ue]=pe+1,Pn>=Qt?Qt=Pn:On=!0,x(_n,N[Pn],H,null,Z,ue,ge,me,ye),an++)}const Os=On?uP(Kr):tl;for(rt=Os.length-1,pe=Ht-1;pe>=0;pe--){const _n=Ue+pe,Pn=N[_n],vi=_n+1<Ve?N[_n+1].el:K;Kr[pe]===0?x(null,Pn,H,vi,Z,ue,ge,me,ye):On&&(rt<0||pe!==Os[rt]?ae(Pn,H,vi,2):rt--)}}},ae=(P,N,H,K,Z=null)=>{const{el:ue,type:ge,transition:me,children:ye,shapeFlag:pe}=P;if(pe&6){ae(P.component.subTree,N,H,K);return}if(pe&128){P.suspense.move(N,H,K);return}if(pe&64){ge.move(P,N,H,Pe);return}if(ge===mt){r(ue,N,H);for(let Te=0;Te<ye.length;Te++)ae(ye[Te],N,H,K);r(P.anchor,N,H);return}if(ge===Bd){U(P,N,H);return}if(K!==2&&pe&1&&me)if(K===0)me.beforeEnter(ue),r(ue,N,H),yr(()=>me.enter(ue),Z);else{const{leave:Te,delayLeave:Ce,afterLeave:Fe}=me,Ue=()=>{P.ctx.isUnmounted?s(ue):r(ue,N,H)},We=()=>{Te(ue,()=>{Ue(),Fe&&Fe()})};Ce?Ce(ue,Ue,We):We()}else r(ue,N,H)},ne=(P,N,H,K=!1,Z=!1)=>{const{type:ue,props:ge,ref:me,children:ye,dynamicChildren:pe,shapeFlag:Ve,patchFlag:Te,dirs:Ce,cacheIndex:Fe}=P;if(Te===-2&&(Z=!1),me!=null&&(ti(),qu(me,null,H,P,!0),ni()),Fe!=null&&(N.renderCache[Fe]=void 0),Ve&256){N.ctx.deactivate(P);return}const Ue=Ve&1&&Ce,We=!il(P);let rt;if(We&&(rt=ge&&ge.onVnodeBeforeUnmount)&&Is(rt,N,P),Ve&6)Pt(P.component,H,K);else{if(Ve&128){P.suspense.unmount(H,K);return}Ue&&Ao(P,null,N,"beforeUnmount"),Ve&64?P.type.remove(P,N,H,Pe,K):pe&&!pe.hasOnce&&(ue!==mt||Te>0&&Te&64)?en(pe,N,H,!1,!0):(ue===mt&&Te&384||!Z&&Ve&16)&&en(ye,N,H),K&&Ne(P)}(We&&(rt=ge&&ge.onVnodeUnmounted)||Ue)&&yr(()=>{rt&&Is(rt,N,P),Ue&&Ao(P,null,N,"unmounted")},H)},Ne=P=>{const{type:N,el:H,anchor:K,transition:Z}=P;if(N===mt){dt(H,K);return}if(N===Bd){q(P);return}const ue=()=>{s(H),Z&&!Z.persisted&&Z.afterLeave&&Z.afterLeave()};if(P.shapeFlag&1&&Z&&!Z.persisted){const{leave:ge,delayLeave:me}=Z,ye=()=>ge(H,ue);me?me(P.el,ue,ye):ye()}else ue()},dt=(P,N)=>{let H;for(;P!==N;)H=m(P),s(P),P=H;s(N)},Pt=(P,N,H)=>{const{bum:K,scope:Z,job:ue,subTree:ge,um:me,m:ye,a:pe,parent:Ve,slots:{__:Te}}=P;Hy(ye),Hy(pe),K&&$d(K),Ve&&He(Te)&&Te.forEach(Ce=>{Ve.renderCache[Ce]=void 0}),Z.stop(),ue&&(ue.flags|=8,ne(ge,P,N,H)),me&&yr(me,N),yr(()=>{P.isUnmounted=!0},N),N&&N.pendingBranch&&!N.isUnmounted&&P.asyncDep&&!P.asyncResolved&&P.suspenseId===N.pendingId&&(N.deps--,N.deps===0&&N.resolve())},en=(P,N,H,K=!1,Z=!1,ue=0)=>{for(let ge=ue;ge<P.length;ge++)ne(P[ge],N,H,K,Z)},Y=P=>{if(P.shapeFlag&6)return Y(P.component.subTree);if(P.shapeFlag&128)return P.suspense.next();const N=m(P.anchor||P.el),H=N&&N[ww];return H?m(H):N};let xe=!1;const ve=(P,N,H)=>{P==null?N._vnode&&ne(N._vnode,null,null,!0):x(N._vnode||null,P,N,null,null,null,H),N._vnode=P,xe||(xe=!0,Oy(),yw(),xe=!1)},Pe={p:x,um:ne,m:ae,r:Ne,mt:Ke,mc:_,pc:Ae,pbc:k,n:Y,o:n};let nt,vt;return e&&([nt,vt]=e(Pe)),{render:ve,hydrate:nt,createApp:ZS(ve,nt)}}function ap({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function So({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function lP(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function ig(n,e,t=!1){const r=n.children,s=e.children;if(He(r)&&He(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Oi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&ig(o,a)),a.type===Jh&&(a.el=o.el),a.type===ar&&!a.el&&(a.el=o.el)}}function uP(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Hw(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Hw(e)}function Hy(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const cP=Symbol.for("v-scx"),dP=()=>ls(cP);function kt(n,e,t){return Kw(n,e,t)}function Kw(n,e,t=Bt){const{immediate:r,deep:s,flush:i,once:o}=t,a=Nn({},t),l=e&&r||!e&&i!=="post";let c;if(cc){if(i==="sync"){const v=dP();c=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=os,v.resume=os,v.pause=os,v}}const h=Wn;a.call=(v,w,x)=>ds(v,h,w,x);let f=!1;i==="post"?a.scheduler=v=>{yr(v,h&&h.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(v,w)=>{w?v():eg(v)}),a.augmentJob=v=>{e&&(v.flags|=4),f&&(v.flags|=2,h&&(v.id=h.uid,v.i=h))};const m=ES(n,e,a);return cc&&(c?c.push(m):l&&m()),m}function hP(n,e,t){const r=this.proxy,s=pn(n)?n.includes(".")?Gw(r,n):()=>r[n]:n.bind(r,r);let i;et(e)?i=e:(i=e.handler,t=e);const o=Fc(this),a=Kw(s,i.bind(r),t);return o(),a}function Gw(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const fP=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Xr(e)}Modifiers`]||n[`${uo(e)}Modifiers`];function pP(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Bt;let s=t;const i=e.startsWith("update:"),o=i&&fP(r,e.slice(7));o&&(o.trim&&(s=t.map(h=>pn(h)?h.trim():h)),o.number&&(s=t.map(ih)));let a,l=r[a=ep(e)]||r[a=ep(Xr(e))];!l&&i&&(l=r[a=ep(uo(e))]),l&&ds(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ds(c,n,6,s)}}function Ww(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!et(n)){const l=c=>{const h=Ww(c,e,!0);h&&(a=!0,Nn(o,h))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(qt(n)&&r.set(n,null),null):(He(i)?i.forEach(l=>o[l]=null):Nn(o,i),qt(n)&&r.set(n,o),o)}function Qh(n,e){return!n||!Uh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Mt(n,e[0].toLowerCase()+e.slice(1))||Mt(n,uo(e))||Mt(n,e))}function lp(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:f,data:m,setupState:v,ctx:w,inheritAttrs:x}=n,I=uh(n);let O,L;try{if(t.shapeFlag&4){const q=s||r,te=q;O=Ts(c.call(te,q,h,f,v,m,w)),L=a}else{const q=e;O=Ts(q.length>1?q(f,{attrs:a,slots:o,emit:l}):q(f,null)),L=e.props?a:mP(a)}}catch(q){Hu.length=0,Kh(q,n,1),O=Be(ar)}let U=O;if(L&&x!==!1){const q=Object.keys(L),{shapeFlag:te}=U;q.length&&te&7&&(i&&q.some(qm)&&(L=gP(L,i)),U=Zi(U,L,!1,!0))}return t.dirs&&(U=Zi(U,null,!1,!0),U.dirs=U.dirs?U.dirs.concat(t.dirs):t.dirs),t.transition&&ac(U,t.transition),O=U,uh(I),O}const mP=n=>{let e;for(const t in n)(t==="class"||t==="style"||Uh(t))&&((e||(e={}))[t]=n[t]);return e},gP=(n,e)=>{const t={};for(const r in n)(!qm(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function vP(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Ky(r,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const m=h[f];if(o[m]!==r[m]&&!Qh(c,m))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Ky(r,o,c):!0:!!o;return!1}function Ky(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Qh(t,i))return!0}return!1}function yP({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Qw=n=>n.__isSuspense;function _P(n,e){e&&e.pendingBranch?He(n)?e.effects.push(...n):e.effects.push(n):SS(n)}const mt=Symbol.for("v-fgt"),Jh=Symbol.for("v-txt"),ar=Symbol.for("v-cmt"),Bd=Symbol.for("v-stc"),Hu=[];let qr=null;function C(n=!1){Hu.push(qr=n?null:[])}function bP(){Hu.pop(),qr=Hu[Hu.length-1]||null}let lc=1;function Gy(n,e=!1){lc+=n,n<0&&qr&&e&&(qr.hasOnce=!0)}function Jw(n){return n.dynamicChildren=lc>0?qr||tl:null,bP(),lc>0&&qr&&qr.push(n),n}function D(n,e,t,r,s,i){return Jw(d(n,e,t,r,s,i,!0))}function Js(n,e,t,r,s){return Jw(Be(n,e,t,r,s,!0))}function uc(n){return n?n.__v_isVNode===!0:!1}function Mo(n,e){return n.type===e.type&&n.key===e.key}const Yw=({key:n})=>n??null,qd=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?pn(n)||lr(n)||et(n)?{i:Bn,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===mt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Yw(e),ref:e&&qd(e),scopeId:bw,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Bn};return a?(og(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=pn(t)?8:16),lc>0&&!o&&qr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&qr.push(l),l}const Be=wP;function wP(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===qS)&&(n=ar),uc(n)){const a=Zi(n,e,!0);return t&&og(a,t),lc>0&&!i&&qr&&(a.shapeFlag&6?qr[qr.indexOf(n)]=a:qr.push(a)),a.patchFlag=-2,a}if(NP(n)&&(n=n.__vccOpts),e){e=xP(e);let{class:a,style:l}=e;a&&!pn(a)&&(e.class=cn(a)),qt(l)&&(Zm(l)&&!He(l)&&(l=Nn({},l)),e.style=Ur(l))}const o=pn(n)?1:Qw(n)?128:xw(n)?64:qt(n)?4:et(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function xP(n){return n?Zm(n)||Fw(n)?Nn({},n):n:null}function Zi(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?IP(s||{},e):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Yw(c),ref:e&&e.ref?t&&i?He(i)?i.concat(qd(e)):[i,qd(e)]:qd(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==mt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Zi(n.ssContent),ssFallback:n.ssFallback&&Zi(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&ac(h,l.clone(h)),h}function lt(n=" ",e=0){return Be(Jh,null,n,e)}function ir(n,e){const t=Be(Bd,null,n);return t.staticCount=e,t}function ie(n="",e=!1){return e?(C(),Js(ar,null,n)):Be(ar,null,n)}function Ts(n){return n==null||typeof n=="boolean"?Be(ar):He(n)?Be(mt,null,n.slice()):uc(n)?Oi(n):Be(Jh,null,String(n))}function Oi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Zi(n)}function og(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(He(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),og(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Fw(e)?e._ctx=Bn:s===3&&Bn&&(Bn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else et(e)?(e={default:e,_ctx:Bn},t=32):(e=String(e),r&64?(t=16,e=[lt(e)]):t=8);n.children=e,n.shapeFlag|=t}function IP(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=cn([e.class,r.class]));else if(s==="style")e.style=Ur([e.style,r.style]);else if(Uh(s)){const i=e[s],o=r[s];o&&i!==o&&!(He(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Is(n,e,t,r=null){ds(n,e,7,[t,r])}const EP=Mw();let TP=0;function AP(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||EP,i={uid:TP++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Y1(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:jw(r,s),emitsOptions:Ww(r,s),emit:null,emitted:null,propsDefaults:Bt,inheritAttrs:r.inheritAttrs,ctx:Bt,data:Bt,props:Bt,attrs:Bt,slots:Bt,refs:Bt,setupState:Bt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=pP.bind(null,i),n.ce&&n.ce(i),i}let Wn=null;const SP=()=>Wn||Bn;let dh,Xp;{const n=qh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};dh=e("__VUE_INSTANCE_SETTERS__",t=>Wn=t),Xp=e("__VUE_SSR_SETTERS__",t=>cc=t)}const Fc=n=>{const e=Wn;return dh(n),n.scope.on(),()=>{n.scope.off(),dh(e)}},Wy=()=>{Wn&&Wn.scope.off(),dh(null)};function Xw(n){return n.vnode.shapeFlag&4}let cc=!1;function PP(n,e=!1,t=!1){e&&Xp(e);const{props:r,children:s}=n.vnode,i=Xw(n);eP(n,r,i,e),sP(n,s,t||e);const o=i?RP(n,e):void 0;return e&&Xp(!1),o}function RP(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,KS);const{setup:r}=t;if(r){ti();const s=n.setupContext=r.length>1?kP(n):null,i=Fc(n),o=$c(r,n,0,[n.props,s]),a=Kb(o);if(ni(),i(),(a||n.sp)&&!il(n)&&kw(n),a){if(o.then(Wy,Wy),e)return o.then(l=>{Qy(n,l,e)}).catch(l=>{Kh(l,n,0)});n.asyncDep=o}else Qy(n,o,e)}else Zw(n,e)}function Qy(n,e,t){et(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:qt(e)&&(n.setupState=mw(e)),Zw(n,t)}let Jy;function Zw(n,e,t){const r=n.type;if(!n.render){if(!e&&Jy&&!r.render){const s=r.template||ng(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Nn(Nn({isCustomElement:i,delimiters:a},o),l);r.render=Jy(s,c)}}n.render=r.render||os}{const s=Fc(n);ti();try{GS(n)}finally{ni(),s()}}}const CP={get(n,e){return or(n,"get",""),n[e]}};function kP(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,CP),slots:n.slots,emit:n.emit,expose:e}}function Yh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(mw(vS(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in zu)return zu[t](n)},has(e,t){return t in e||t in zu}})):n.proxy}function DP(n,e=!0){return et(n)?n.displayName||n.name:n.name||e&&n.__name}function NP(n){return et(n)&&"__vccOpts"in n}const qe=(n,e)=>xS(n,e,cc);function ag(n,e,t){const r=arguments.length;return r===2?qt(e)&&!He(e)?uc(e)?Be(n,null,[e]):Be(n,e):Be(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&uc(t)&&(t=[t]),Be(n,e,t))}const OP="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Zp;const Yy=typeof window<"u"&&window.trustedTypes;if(Yy)try{Zp=Yy.createPolicy("vue",{createHTML:n=>n})}catch{}const ex=Zp?n=>Zp.createHTML(n):n=>n,VP="http://www.w3.org/2000/svg",MP="http://www.w3.org/1998/Math/MathML",Us=typeof document<"u"?document:null,Xy=Us&&Us.createElement("template"),LP={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Us.createElementNS(VP,n):e==="mathml"?Us.createElementNS(MP,n):t?Us.createElement(n,{is:t}):Us.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Us.createTextNode(n),createComment:n=>Us.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Us.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Xy.innerHTML=ex(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Xy.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Si="transition",bu="animation",dc=Symbol("_vtc"),tx={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},$P=Nn({},Tw,tx),FP=n=>(n.displayName="Transition",n.props=$P,n),up=FP((n,{slots:e})=>ag(kS,UP(n),e)),Po=(n,e=[])=>{He(n)?n.forEach(t=>t(...e)):n&&n(...e)},Zy=n=>n?He(n)?n.some(e=>e.length>1):n.length>1:!1;function UP(n){const e={};for(const V in n)V in tx||(e[V]=n[V]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=o,appearToClass:h=a,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:m=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,w=jP(s),x=w&&w[0],I=w&&w[1],{onBeforeEnter:O,onEnter:L,onEnterCancelled:U,onLeave:q,onLeaveCancelled:te,onBeforeAppear:X=O,onAppear:A=L,onAppearCancelled:_=U}=e,T=(V,R,Ke,ut)=>{V._enterCancelled=ut,Ro(V,R?h:a),Ro(V,R?c:o),Ke&&Ke()},k=(V,R)=>{V._isLeaving=!1,Ro(V,f),Ro(V,v),Ro(V,m),R&&R()},$=V=>(R,Ke)=>{const ut=V?A:L,ct=()=>T(R,V,Ke);Po(ut,[R,ct]),e0(()=>{Ro(R,V?l:i),$s(R,V?h:a),Zy(ut)||t0(R,r,x,ct)})};return Nn(e,{onBeforeEnter(V){Po(O,[V]),$s(V,i),$s(V,o)},onBeforeAppear(V){Po(X,[V]),$s(V,l),$s(V,c)},onEnter:$(!1),onAppear:$(!0),onLeave(V,R){V._isLeaving=!0;const Ke=()=>k(V,R);$s(V,f),V._enterCancelled?($s(V,m),s0()):(s0(),$s(V,m)),e0(()=>{V._isLeaving&&(Ro(V,f),$s(V,v),Zy(q)||t0(V,r,I,Ke))}),Po(q,[V,Ke])},onEnterCancelled(V){T(V,!1,void 0,!0),Po(U,[V])},onAppearCancelled(V){T(V,!0,void 0,!0),Po(_,[V])},onLeaveCancelled(V){k(V),Po(te,[V])}})}function jP(n){if(n==null)return null;if(qt(n))return[cp(n.enter),cp(n.leave)];{const e=cp(n);return[e,e]}}function cp(n){return q1(n)}function $s(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[dc]||(n[dc]=new Set)).add(e)}function Ro(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[dc];t&&(t.delete(e),t.size||(n[dc]=void 0))}function e0(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let BP=0;function t0(n,e,t,r){const s=n._endId=++BP,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=qP(n,e);if(!o)return r();const c=o+"end";let h=0;const f=()=>{n.removeEventListener(c,m),i()},m=v=>{v.target===n&&++h>=l&&f()};setTimeout(()=>{h<l&&f()},a+1),n.addEventListener(c,m)}function qP(n,e){const t=window.getComputedStyle(n),r=w=>(t[w]||"").split(", "),s=r(`${Si}Delay`),i=r(`${Si}Duration`),o=n0(s,i),a=r(`${bu}Delay`),l=r(`${bu}Duration`),c=n0(a,l);let h=null,f=0,m=0;e===Si?o>0&&(h=Si,f=o,m=i.length):e===bu?c>0&&(h=bu,f=c,m=l.length):(f=Math.max(o,c),h=f>0?o>c?Si:bu:null,m=h?h===Si?i.length:l.length:0);const v=h===Si&&/\b(transform|all)(,|$)/.test(r(`${Si}Property`).toString());return{type:h,timeout:f,propCount:m,hasTransform:v}}function n0(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>r0(t)+r0(n[r])))}function r0(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function s0(){return document.body.offsetHeight}function zP(n,e,t){const r=n[dc];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const hh=Symbol("_vod"),nx=Symbol("_vsh"),dp={beforeMount(n,{value:e},{transition:t}){n[hh]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):wu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),wu(n,!0),r.enter(n)):r.leave(n,()=>{wu(n,!1)}):wu(n,e))},beforeUnmount(n,{value:e}){wu(n,e)}};function wu(n,e){n.style.display=e?n[hh]:"none",n[nx]=!e}const HP=Symbol(""),KP=/(^|;)\s*display\s*:/;function GP(n,e,t){const r=n.style,s=pn(t);let i=!1;if(t&&!s){if(e)if(pn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&zd(r,a,"")}else for(const o in e)t[o]==null&&zd(r,o,"");for(const o in t)o==="display"&&(i=!0),zd(r,o,t[o])}else if(s){if(e!==t){const o=r[HP];o&&(t+=";"+o),r.cssText=t,i=KP.test(t)}}else e&&n.removeAttribute("style");hh in n&&(n[hh]=i?r.display:"",n[nx]&&(r.display="none"))}const i0=/\s*!important$/;function zd(n,e,t){if(He(t))t.forEach(r=>zd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=WP(n,e);i0.test(t)?n.setProperty(uo(r),t.replace(i0,""),"important"):n[r]=t}}const o0=["Webkit","Moz","ms"],hp={};function WP(n,e){const t=hp[e];if(t)return t;let r=Xr(e);if(r!=="filter"&&r in n)return hp[e]=r;r=Bh(r);for(let s=0;s<o0.length;s++){const i=o0[s]+r;if(i in n)return hp[e]=i}return e}const a0="http://www.w3.org/1999/xlink";function l0(n,e,t,r,s,i=Q1(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(a0,e.slice(6,e.length)):n.setAttributeNS(a0,e,t):t==null||i&&!Qb(t)?n.removeAttribute(e):n.setAttribute(e,i?"":cs(t)?String(t):t)}function u0(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?ex(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Qb(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Mi(n,e,t,r){n.addEventListener(e,t,r)}function QP(n,e,t,r){n.removeEventListener(e,t,r)}const c0=Symbol("_vei");function JP(n,e,t,r,s=null){const i=n[c0]||(n[c0]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=YP(e);if(r){const c=i[e]=eR(r,s);Mi(n,a,c,l)}else o&&(QP(n,a,o,l),i[e]=void 0)}}const d0=/(?:Once|Passive|Capture)$/;function YP(n){let e;if(d0.test(n)){e={};let r;for(;r=n.match(d0);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):uo(n.slice(2)),e]}let fp=0;const XP=Promise.resolve(),ZP=()=>fp||(XP.then(()=>fp=0),fp=Date.now());function eR(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ds(tR(r,t.value),e,5,[r])};return t.value=n,t.attached=ZP(),t}function tR(n,e){if(He(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const h0=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,nR=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?zP(n,r,o):e==="style"?GP(n,t,r):Uh(e)?qm(e)||JP(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):rR(n,e,r,o))?(u0(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&l0(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!pn(r))?u0(n,Xr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),l0(n,e,r,o))};function rR(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&h0(e)&&et(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return h0(e)&&pn(t)?!1:e in n}const pl=n=>{const e=n.props["onUpdate:modelValue"]||!1;return He(e)?t=>$d(e,t):e};function sR(n){n.target.composing=!0}function f0(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ys=Symbol("_assign"),Lt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Ys]=pl(s);const i=r||s.props&&s.props.type==="number";Mi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=ih(a)),n[Ys](a)}),t&&Mi(n,"change",()=>{n.value=n.value.trim()}),e||(Mi(n,"compositionstart",sR),Mi(n,"compositionend",f0),Mi(n,"change",f0))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Ys]=pl(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?ih(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Hi={deep:!0,created(n,e,t){n[Ys]=pl(t),Mi(n,"change",()=>{const r=n._modelValue,s=hc(n),i=n.checked,o=n[Ys];if(He(r)){const a=Km(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Ol(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(rx(n,i))})},mounted:p0,beforeUpdate(n,e,t){n[Ys]=pl(t),p0(n,e,t)}};function p0(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(He(e))s=Km(e,r.props.value)>-1;else if(Ol(e))s=e.has(r.props.value);else{if(e===t)return;s=Lc(e,rx(n,!0))}n.checked!==s&&(n.checked=s)}const iR={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Ol(e);Mi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?ih(hc(o)):hc(o));n[Ys](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,tn(()=>{n._assigning=!1})}),n[Ys]=pl(r)},mounted(n,{value:e}){m0(n,e)},beforeUpdate(n,e,t){n[Ys]=pl(t)},updated(n,{value:e}){n._assigning||m0(n,e)}};function m0(n,e){const t=n.multiple,r=He(e);if(!(t&&!r&&!Ol(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=hc(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Km(e,a)>-1}else o.selected=e.has(a);else if(Lc(hc(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function hc(n){return"_value"in n?n._value:n.value}function rx(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const oR=["ctrl","shift","alt","meta"],aR={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>oR.some(t=>n[`${t}Key`]&&!e.includes(t))},ft=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=aR[e[o]];if(a&&a(s,e))return}return n(s,...i)})},lR={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},rr=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=uo(s.key);if(e.some(o=>o===i||lR[o]===i))return n(s)})},uR=Nn({patchProp:nR},LP);let g0;function cR(){return g0||(g0=oP(uR))}const dR=(...n)=>{const e=cR().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=fR(r);if(!s)return;const i=e._component;!et(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,hR(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function hR(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function fR(n){return pn(n)?document.querySelector(n):n}const pR="/icons/icon-48x48.png";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sx=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},mR=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},ix={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(m=64)),r.push(t[h],t[f],t[m],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(sx(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):mR(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new gR;const m=i<<2|a>>4;if(r.push(m),c!==64){const v=a<<4&240|c>>2;if(r.push(v),f!==64){const w=c<<6&192|f;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class gR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vR=function(n){const e=sx(n);return ix.encodeByteArray(e,!0)},fh=function(n){return vR(n).replace(/\./g,"")},ox=function(n){try{return ix.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yR(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _R=()=>yR().__FIREBASE_DEFAULTS__,bR=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},wR=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ox(n[1]);return e&&JSON.parse(e)},Xh=()=>{try{return _R()||bR()||wR()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ax=n=>{var e,t;return(t=(e=Xh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},lx=n=>{const e=ax(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},ux=()=>{var n;return(n=Xh())===null||n===void 0?void 0:n.config},cx=n=>{var e;return(e=Xh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dx(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[fh(JSON.stringify(t)),fh(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function IR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ln())}function ER(){var n;const e=(n=Xh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function TR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function AR(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function SR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function PR(){const n=Ln();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function hx(){return!ER()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function lg(){try{return typeof indexedDB=="object"}catch{return!1}}function fx(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function RR(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CR="FirebaseError";class ps extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=CR,Object.setPrototypeOf(this,ps.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ua.prototype.create)}}class ua{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?kR(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ps(s,a,r)}}function kR(n,e){return n.replace(DR,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const DR=/\{\$([^}]+)}/g;function NR(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function eo(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(v0(i)&&v0(o)){if(!eo(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function v0(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Du(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Nu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function OR(n,e){const t=new VR(n,e);return t.subscribe.bind(t)}class VR{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");MR(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=pp),s.error===void 0&&(s.error=pp),s.complete===void 0&&(s.complete=pp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function MR(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function pp(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function De(n){return n&&n._delegate?n._delegate:n}class Zr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Do="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new xR;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(FR(e))try{this.getOrInitializeService({instanceIdentifier:Do})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Do){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Do){return this.instances.has(e)}getOptions(e=Do){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:$R(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Do){return this.component?this.component.multipleInstances?e:Do:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $R(n){return n===Do?void 0:n}function FR(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new LR(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(_t||(_t={}));const jR={debug:_t.DEBUG,verbose:_t.VERBOSE,info:_t.INFO,warn:_t.WARN,error:_t.ERROR,silent:_t.SILENT},BR=_t.INFO,qR={[_t.DEBUG]:"log",[_t.VERBOSE]:"log",[_t.INFO]:"info",[_t.WARN]:"warn",[_t.ERROR]:"error"},zR=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=qR[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ug{constructor(e){this.name=e,this._logLevel=BR,this._logHandler=zR,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _t))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?jR[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_t.DEBUG,...e),this._logHandler(this,_t.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_t.VERBOSE,...e),this._logHandler(this,_t.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_t.INFO,...e),this._logHandler(this,_t.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_t.WARN,...e),this._logHandler(this,_t.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_t.ERROR,...e),this._logHandler(this,_t.ERROR,...e)}}const HR=(n,e)=>e.some(t=>n instanceof t);let y0,_0;function KR(){return y0||(y0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function GR(){return _0||(_0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const px=new WeakMap,em=new WeakMap,mx=new WeakMap,mp=new WeakMap,cg=new WeakMap;function WR(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Xs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&px.set(t,n)}).catch(()=>{}),cg.set(e,n),e}function QR(n){if(em.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});em.set(n,e)}let tm={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return em.get(n);if(e==="objectStoreNames")return n.objectStoreNames||mx.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Xs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function JR(n){tm=n(tm)}function YR(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(gp(this),e,...t);return mx.set(r,e.sort?e.sort():[e]),Xs(r)}:GR().includes(n)?function(...e){return n.apply(gp(this),e),Xs(px.get(this))}:function(...e){return Xs(n.apply(gp(this),e))}}function XR(n){return typeof n=="function"?YR(n):(n instanceof IDBTransaction&&QR(n),HR(n,KR())?new Proxy(n,tm):n)}function Xs(n){if(n instanceof IDBRequest)return WR(n);if(mp.has(n))return mp.get(n);const e=XR(n);return e!==n&&(mp.set(n,e),cg.set(e,n)),e}const gp=n=>cg.get(n);function Zh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Xs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Xs(o.result),l.oldVersion,l.newVersion,Xs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function vp(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Xs(t).then(()=>{})}const ZR=["get","getKey","getAll","getAllKeys","count"],eC=["put","add","delete","clear"],yp=new Map;function b0(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(yp.get(e))return yp.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=eC.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ZR.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return yp.set(e,i),i}JR(n=>({...n,get:(e,t,r)=>b0(e,t)||n.get(e,t,r),has:(e,t)=>!!b0(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(nC(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function nC(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const nm="@firebase/app",w0="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ri=new ug("@firebase/app"),rC="@firebase/app-compat",sC="@firebase/analytics-compat",iC="@firebase/analytics",oC="@firebase/app-check-compat",aC="@firebase/app-check",lC="@firebase/auth",uC="@firebase/auth-compat",cC="@firebase/database",dC="@firebase/data-connect",hC="@firebase/database-compat",fC="@firebase/functions",pC="@firebase/functions-compat",mC="@firebase/installations",gC="@firebase/installations-compat",vC="@firebase/messaging",yC="@firebase/messaging-compat",_C="@firebase/performance",bC="@firebase/performance-compat",wC="@firebase/remote-config",xC="@firebase/remote-config-compat",IC="@firebase/storage",EC="@firebase/storage-compat",TC="@firebase/firestore",AC="@firebase/vertexai-preview",SC="@firebase/firestore-compat",PC="firebase",RC="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph="[DEFAULT]",CC={[nm]:"fire-core",[rC]:"fire-core-compat",[iC]:"fire-analytics",[sC]:"fire-analytics-compat",[aC]:"fire-app-check",[oC]:"fire-app-check-compat",[lC]:"fire-auth",[uC]:"fire-auth-compat",[cC]:"fire-rtdb",[dC]:"fire-data-connect",[hC]:"fire-rtdb-compat",[fC]:"fire-fn",[pC]:"fire-fn-compat",[mC]:"fire-iid",[gC]:"fire-iid-compat",[vC]:"fire-fcm",[yC]:"fire-fcm-compat",[_C]:"fire-perf",[bC]:"fire-perf-compat",[wC]:"fire-rc",[xC]:"fire-rc-compat",[IC]:"fire-gcs",[EC]:"fire-gcs-compat",[TC]:"fire-fst",[SC]:"fire-fst-compat",[AC]:"fire-vertex","fire-js":"fire-js",[PC]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh=new Map,kC=new Map,rm=new Map;function x0(n,e){try{n.container.addComponent(e)}catch(t){ri.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function hs(n){const e=n.name;if(rm.has(e))return ri.debug(`There were multiple attempts to register component ${e}.`),!1;rm.set(e,n);for(const t of mh.values())x0(t,n);for(const t of kC.values())x0(t,n);return!0}function ci(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function DC(n,e,t=ph){ci(n,e).clearInstance(t)}function En(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Qi=new ua("app","Firebase",NC);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Zr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ca=RC;function gx(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ph,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Qi.create("bad-app-name",{appName:String(s)});if(t||(t=ux()),!t)throw Qi.create("no-options");const i=mh.get(s);if(i){if(eo(t,i.options)&&eo(r,i.config))return i;throw Qi.create("duplicate-app",{appName:s})}const o=new UR(s);for(const l of rm.values())o.addComponent(l);const a=new OC(t,r,o);return mh.set(s,a),a}function Ml(n=ph){const e=mh.get(n);if(!e&&n===ph&&ux())return gx();if(!e)throw Qi.create("no-app",{appName:n});return e}function Nr(n,e,t){var r;let s=(r=CC[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ri.warn(a.join(" "));return}hs(new Zr(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VC="firebase-heartbeat-database",MC=1,fc="firebase-heartbeat-store";let _p=null;function vx(){return _p||(_p=Zh(VC,MC,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fc)}catch(t){console.warn(t)}}}}).catch(n=>{throw Qi.create("idb-open",{originalErrorMessage:n.message})})),_p}async function LC(n){try{const t=(await vx()).transaction(fc),r=await t.objectStore(fc).get(yx(n));return await t.done,r}catch(e){if(e instanceof ps)ri.warn(e.message);else{const t=Qi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ri.warn(t.message)}}}async function I0(n,e){try{const r=(await vx()).transaction(fc,"readwrite");await r.objectStore(fc).put(e,yx(n)),await r.done}catch(t){if(t instanceof ps)ri.warn(t.message);else{const r=Qi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});ri.warn(r.message)}}}function yx(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C=1024,FC=30*24*60*60*1e3;class UC{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new BC(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=E0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=FC}),this._storage.overwrite(this._heartbeatsCache))}catch(r){ri.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=E0(),{heartbeatsToSend:r,unsentEntries:s}=jC(this._heartbeatsCache.heartbeats),i=fh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return ri.warn(t),""}}}function E0(){return new Date().toISOString().substring(0,10)}function jC(n,e=$C){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),T0(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),T0(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class BC{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lg()?fx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await LC(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return I0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return I0(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function T0(n){return fh(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qC(n){hs(new Zr("platform-logger",e=>new tC(e),"PRIVATE")),hs(new Zr("heartbeat",e=>new UC(e),"PRIVATE")),Nr(nm,w0,n),Nr(nm,w0,"esm2017"),Nr("fire-js","")}qC("");const _x="@firebase/installations",dg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx=1e4,wx=`w:${dg}`,xx="FIS_v2",zC="https://firebaseinstallations.googleapis.com/v1",HC=60*60*1e3,KC="installations",GC="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WC={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Jo=new ua(KC,GC,WC);function Ix(n){return n instanceof ps&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ex({projectId:n}){return`${zC}/projects/${n}/installations`}function Tx(n){return{token:n.token,requestStatus:2,expiresIn:JC(n.expiresIn),creationTime:Date.now()}}async function Ax(n,e){const r=(await e.json()).error;return Jo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function Sx({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function QC(n,{refreshToken:e}){const t=Sx(n);return t.append("Authorization",YC(e)),t}async function Px(n){const e=await n();return e.status>=500&&e.status<600?n():e}function JC(n){return Number(n.replace("s","000"))}function YC(n){return`${xx} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XC({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=Ex(n),s=Sx(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:xx,appId:n.appId,sdkVersion:wx},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Px(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:Tx(c.authToken)}}else throw await Ax("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rx(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZC(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek=/^[cdef][\w-]{21}$/,sm="";function tk(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=nk(n);return ek.test(t)?t:sm}catch{return sm}}function nk(n){return ZC(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ef(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cx=new Map;function kx(n,e){const t=ef(n);Dx(t,e),rk(t,e)}function Dx(n,e){const t=Cx.get(n);if(t)for(const r of t)r(e)}function rk(n,e){const t=sk();t&&t.postMessage({key:n,fid:e}),ik()}let jo=null;function sk(){return!jo&&"BroadcastChannel"in self&&(jo=new BroadcastChannel("[Firebase] FID Change"),jo.onmessage=n=>{Dx(n.data.key,n.data.fid)}),jo}function ik(){Cx.size===0&&jo&&(jo.close(),jo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok="firebase-installations-database",ak=1,Yo="firebase-installations-store";let bp=null;function hg(){return bp||(bp=Zh(ok,ak,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Yo)}}})),bp}async function gh(n,e){const t=ef(n),s=(await hg()).transaction(Yo,"readwrite"),i=s.objectStore(Yo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&kx(n,e.fid),e}async function Nx(n){const e=ef(n),r=(await hg()).transaction(Yo,"readwrite");await r.objectStore(Yo).delete(e),await r.done}async function tf(n,e){const t=ef(n),s=(await hg()).transaction(Yo,"readwrite"),i=s.objectStore(Yo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&kx(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fg(n){let e;const t=await tf(n.appConfig,r=>{const s=lk(r),i=uk(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===sm?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function lk(n){const e=n||{fid:tk(),registrationStatus:0};return Ox(e)}function uk(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Jo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=ck(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:dk(n)}:{installationEntry:e}}async function ck(n,e){try{const t=await XC(n,e);return gh(n.appConfig,t)}catch(t){throw Ix(t)&&t.customData.serverCode===409?await Nx(n.appConfig):await gh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function dk(n){let e=await A0(n.appConfig);for(;e.registrationStatus===1;)await Rx(100),e=await A0(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await fg(n);return r||t}return e}function A0(n){return tf(n,e=>{if(!e)throw Jo.create("installation-not-found");return Ox(e)})}function Ox(n){return hk(n)?{fid:n.fid,registrationStatus:0}:n}function hk(n){return n.registrationStatus===1&&n.registrationTime+bx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fk({appConfig:n,heartbeatServiceProvider:e},t){const r=pk(n,t),s=QC(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:wx,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Px(()=>fetch(r,a));if(l.ok){const c=await l.json();return Tx(c)}else throw await Ax("Generate Auth Token",l)}function pk(n,{fid:e}){return`${Ex(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pg(n,e=!1){let t;const r=await tf(n.appConfig,i=>{if(!Vx(i))throw Jo.create("not-registered");const o=i.authToken;if(!e&&vk(o))return i;if(o.requestStatus===1)return t=mk(n,e),i;{if(!navigator.onLine)throw Jo.create("app-offline");const a=_k(i);return t=gk(n,a),a}});return t?await t:r.authToken}async function mk(n,e){let t=await S0(n.appConfig);for(;t.authToken.requestStatus===1;)await Rx(100),t=await S0(n.appConfig);const r=t.authToken;return r.requestStatus===0?pg(n,e):r}function S0(n){return tf(n,e=>{if(!Vx(e))throw Jo.create("not-registered");const t=e.authToken;return bk(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function gk(n,e){try{const t=await fk(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await gh(n.appConfig,r),t}catch(t){if(Ix(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Nx(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await gh(n.appConfig,r)}throw t}}function Vx(n){return n!==void 0&&n.registrationStatus===2}function vk(n){return n.requestStatus===2&&!yk(n)}function yk(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+HC}function _k(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function bk(n){return n.requestStatus===1&&n.requestTime+bx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wk(n){const e=n,{installationEntry:t,registrationPromise:r}=await fg(e);return r?r.catch(console.error):pg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xk(n,e=!1){const t=n;return await Ik(t),(await pg(t,e)).token}async function Ik(n){const{registrationPromise:e}=await fg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ek(n){if(!n||!n.options)throw wp("App Configuration");if(!n.name)throw wp("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw wp(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function wp(n){return Jo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx="installations",Tk="installations-internal",Ak=n=>{const e=n.getProvider("app").getImmediate(),t=Ek(e),r=ci(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},Sk=n=>{const e=n.getProvider("app").getImmediate(),t=ci(e,Mx).getImmediate();return{getId:()=>wk(t),getToken:s=>xk(t,s)}};function Pk(){hs(new Zr(Mx,Ak,"PUBLIC")),hs(new Zr(Tk,Sk,"PRIVATE"))}Pk();Nr(_x,dg);Nr(_x,dg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk="/firebase-messaging-sw.js",Ck="/firebase-cloud-messaging-push-scope",Lx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",kk="https://fcmregistrations.googleapis.com/v1",$x="google.c.a.c_id",Dk="google.c.a.c_l",Nk="google.c.a.ts",Ok="google.c.a.e";var P0;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(P0||(P0={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var pc;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(pc||(pc={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function js(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Vk(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xp="fcm_token_details_db",Mk=5,R0="fcm_token_object_Store";async function Lk(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(xp))return null;let e=null;return(await Zh(xp,Mk,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(R0))return;const l=o.objectStore(R0),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const h=c;if(!h.auth||!h.p256dh||!h.endpoint)return;e={token:h.fcmToken,createTime:(a=h.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:h.auth,p256dh:h.p256dh,endpoint:h.endpoint,swScope:h.swScope,vapidKey:typeof h.vapidKey=="string"?h.vapidKey:js(h.vapidKey)}}}else if(s===3){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:js(h.auth),p256dh:js(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:js(h.vapidKey)}}}else if(s===4){const h=c;e={token:h.fcmToken,createTime:h.createTime,subscriptionOptions:{auth:js(h.auth),p256dh:js(h.p256dh),endpoint:h.endpoint,swScope:h.swScope,vapidKey:js(h.vapidKey)}}}}}})).close(),await vp(xp),await vp("fcm_vapid_details_db"),await vp("undefined"),$k(e)?e:null}function $k(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk="firebase-messaging-database",Uk=1,mc="firebase-messaging-store";let Ip=null;function Fx(){return Ip||(Ip=Zh(Fk,Uk,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(mc)}}})),Ip}async function jk(n){const e=Ux(n),r=await(await Fx()).transaction(mc).objectStore(mc).get(e);if(r)return r;{const s=await Lk(n.appConfig.senderId);if(s)return await mg(n,s),s}}async function mg(n,e){const t=Ux(n),s=(await Fx()).transaction(mc,"readwrite");return await s.objectStore(mc).put(e,t),await s.done,e}function Ux({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bk={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},br=new ua("messaging","Messaging",Bk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qk(n,e){const t=await vg(n),r=jx(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(gg(n.appConfig),s)).json()}catch(o){throw br.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw br.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw br.create("token-subscribe-no-token");return i.token}async function zk(n,e){const t=await vg(n),r=jx(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${gg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw br.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw br.create("token-update-failed",{errorInfo:o})}if(!i.token)throw br.create("token-update-no-token");return i.token}async function Hk(n,e){const r={method:"DELETE",headers:await vg(n)};try{const i=await(await fetch(`${gg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw br.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw br.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function gg({projectId:n}){return`${kk}/projects/${n}/registrations`}async function vg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function jx({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==Lx&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=7*24*60*60*1e3;async function Gk(n){const e=await Qk(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:js(e.getKey("auth")),p256dh:js(e.getKey("p256dh"))},r=await jk(n.firebaseDependencies);if(r){if(Jk(r.subscriptionOptions,t))return Date.now()>=r.createTime+Kk?Wk(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await Hk(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return C0(n.firebaseDependencies,t)}else return C0(n.firebaseDependencies,t)}async function Wk(n,e){try{const t=await zk(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await mg(n.firebaseDependencies,r),t}catch(t){throw t}}async function C0(n,e){const r={token:await qk(n,e),createTime:Date.now(),subscriptionOptions:e};return await mg(n,r),r.token}async function Qk(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Vk(e)})}function Jk(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return Yk(e,n),Xk(e,n),Zk(e,n),e}function Yk(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function Xk(n,e){e.data&&(n.data=e.data)}function Zk(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(n){return typeof n=="object"&&!!n&&$x in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */t2("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function t2(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n2(n){if(!n||!n.options)throw Ep("App Configuration Object");if(!n.name)throw Ep("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Ep(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Ep(n){return br.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r2{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=n2(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s2(n){try{n.swRegistration=await navigator.serviceWorker.register(Rk,{scope:Ck}),n.swRegistration.update().catch(()=>{})}catch(e){throw br.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i2(n,e){if(!e&&!n.swRegistration&&await s2(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw br.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o2(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=Lx)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bx(n,e){if(!navigator)throw br.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw br.create("permission-blocked");return await o2(n,e==null?void 0:e.vapidKey),await i2(n,e==null?void 0:e.serviceWorkerRegistration),Gk(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a2(n,e,t){const r=l2(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[$x],message_name:t[Dk],message_time:t[Nk],message_device_time:Math.floor(Date.now()/1e3)})}function l2(n){switch(n){case pc.NOTIFICATION_CLICKED:return"notification_open";case pc.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u2(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===pc.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(k0(t)):n.onMessageHandler.next(k0(t)));const r=t.data;e2(r)&&r[Ok]==="1"&&await a2(n,t.messageType,r)}const D0="@firebase/messaging",N0="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c2=n=>{const e=new r2(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>u2(e,t)),e},d2=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>Bx(e,r)}};function h2(){hs(new Zr("messaging",c2,"PUBLIC")),hs(new Zr("messaging-internal",d2,"PRIVATE")),Nr(D0,N0),Nr(D0,N0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qx(){try{await fx()}catch{return!1}return typeof window<"u"&&lg()&&RR()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yg(n=Ml()){return qx().then(e=>{if(!e)throw br.create("unsupported-browser")},e=>{throw br.create("indexed-db-unsupported")}),ci(De(n),"messaging").getImmediate()}async function zx(n,e){return n=De(n),Bx(n,e)}h2();var f2="firebase",p2="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Nr(f2,p2,"app");var O0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ho,Hx;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,_){function T(){}T.prototype=_.prototype,A.D=_.prototype,A.prototype=new T,A.prototype.constructor=A,A.C=function(k,$,V){for(var R=Array(arguments.length-2),Ke=2;Ke<arguments.length;Ke++)R[Ke-2]=arguments[Ke];return _.prototype[$].apply(k,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,_,T){T||(T=0);var k=Array(16);if(typeof _=="string")for(var $=0;16>$;++$)k[$]=_.charCodeAt(T++)|_.charCodeAt(T++)<<8|_.charCodeAt(T++)<<16|_.charCodeAt(T++)<<24;else for($=0;16>$;++$)k[$]=_[T++]|_[T++]<<8|_[T++]<<16|_[T++]<<24;_=A.g[0],T=A.g[1],$=A.g[2];var V=A.g[3],R=_+(V^T&($^V))+k[0]+3614090360&4294967295;_=T+(R<<7&4294967295|R>>>25),R=V+($^_&(T^$))+k[1]+3905402710&4294967295,V=_+(R<<12&4294967295|R>>>20),R=$+(T^V&(_^T))+k[2]+606105819&4294967295,$=V+(R<<17&4294967295|R>>>15),R=T+(_^$&(V^_))+k[3]+3250441966&4294967295,T=$+(R<<22&4294967295|R>>>10),R=_+(V^T&($^V))+k[4]+4118548399&4294967295,_=T+(R<<7&4294967295|R>>>25),R=V+($^_&(T^$))+k[5]+1200080426&4294967295,V=_+(R<<12&4294967295|R>>>20),R=$+(T^V&(_^T))+k[6]+2821735955&4294967295,$=V+(R<<17&4294967295|R>>>15),R=T+(_^$&(V^_))+k[7]+4249261313&4294967295,T=$+(R<<22&4294967295|R>>>10),R=_+(V^T&($^V))+k[8]+1770035416&4294967295,_=T+(R<<7&4294967295|R>>>25),R=V+($^_&(T^$))+k[9]+2336552879&4294967295,V=_+(R<<12&4294967295|R>>>20),R=$+(T^V&(_^T))+k[10]+4294925233&4294967295,$=V+(R<<17&4294967295|R>>>15),R=T+(_^$&(V^_))+k[11]+2304563134&4294967295,T=$+(R<<22&4294967295|R>>>10),R=_+(V^T&($^V))+k[12]+1804603682&4294967295,_=T+(R<<7&4294967295|R>>>25),R=V+($^_&(T^$))+k[13]+4254626195&4294967295,V=_+(R<<12&4294967295|R>>>20),R=$+(T^V&(_^T))+k[14]+2792965006&4294967295,$=V+(R<<17&4294967295|R>>>15),R=T+(_^$&(V^_))+k[15]+1236535329&4294967295,T=$+(R<<22&4294967295|R>>>10),R=_+($^V&(T^$))+k[1]+4129170786&4294967295,_=T+(R<<5&4294967295|R>>>27),R=V+(T^$&(_^T))+k[6]+3225465664&4294967295,V=_+(R<<9&4294967295|R>>>23),R=$+(_^T&(V^_))+k[11]+643717713&4294967295,$=V+(R<<14&4294967295|R>>>18),R=T+(V^_&($^V))+k[0]+3921069994&4294967295,T=$+(R<<20&4294967295|R>>>12),R=_+($^V&(T^$))+k[5]+3593408605&4294967295,_=T+(R<<5&4294967295|R>>>27),R=V+(T^$&(_^T))+k[10]+38016083&4294967295,V=_+(R<<9&4294967295|R>>>23),R=$+(_^T&(V^_))+k[15]+3634488961&4294967295,$=V+(R<<14&4294967295|R>>>18),R=T+(V^_&($^V))+k[4]+3889429448&4294967295,T=$+(R<<20&4294967295|R>>>12),R=_+($^V&(T^$))+k[9]+568446438&4294967295,_=T+(R<<5&4294967295|R>>>27),R=V+(T^$&(_^T))+k[14]+3275163606&4294967295,V=_+(R<<9&4294967295|R>>>23),R=$+(_^T&(V^_))+k[3]+4107603335&4294967295,$=V+(R<<14&4294967295|R>>>18),R=T+(V^_&($^V))+k[8]+1163531501&4294967295,T=$+(R<<20&4294967295|R>>>12),R=_+($^V&(T^$))+k[13]+2850285829&4294967295,_=T+(R<<5&4294967295|R>>>27),R=V+(T^$&(_^T))+k[2]+4243563512&4294967295,V=_+(R<<9&4294967295|R>>>23),R=$+(_^T&(V^_))+k[7]+1735328473&4294967295,$=V+(R<<14&4294967295|R>>>18),R=T+(V^_&($^V))+k[12]+2368359562&4294967295,T=$+(R<<20&4294967295|R>>>12),R=_+(T^$^V)+k[5]+4294588738&4294967295,_=T+(R<<4&4294967295|R>>>28),R=V+(_^T^$)+k[8]+2272392833&4294967295,V=_+(R<<11&4294967295|R>>>21),R=$+(V^_^T)+k[11]+1839030562&4294967295,$=V+(R<<16&4294967295|R>>>16),R=T+($^V^_)+k[14]+4259657740&4294967295,T=$+(R<<23&4294967295|R>>>9),R=_+(T^$^V)+k[1]+2763975236&4294967295,_=T+(R<<4&4294967295|R>>>28),R=V+(_^T^$)+k[4]+1272893353&4294967295,V=_+(R<<11&4294967295|R>>>21),R=$+(V^_^T)+k[7]+4139469664&4294967295,$=V+(R<<16&4294967295|R>>>16),R=T+($^V^_)+k[10]+3200236656&4294967295,T=$+(R<<23&4294967295|R>>>9),R=_+(T^$^V)+k[13]+681279174&4294967295,_=T+(R<<4&4294967295|R>>>28),R=V+(_^T^$)+k[0]+3936430074&4294967295,V=_+(R<<11&4294967295|R>>>21),R=$+(V^_^T)+k[3]+3572445317&4294967295,$=V+(R<<16&4294967295|R>>>16),R=T+($^V^_)+k[6]+76029189&4294967295,T=$+(R<<23&4294967295|R>>>9),R=_+(T^$^V)+k[9]+3654602809&4294967295,_=T+(R<<4&4294967295|R>>>28),R=V+(_^T^$)+k[12]+3873151461&4294967295,V=_+(R<<11&4294967295|R>>>21),R=$+(V^_^T)+k[15]+530742520&4294967295,$=V+(R<<16&4294967295|R>>>16),R=T+($^V^_)+k[2]+3299628645&4294967295,T=$+(R<<23&4294967295|R>>>9),R=_+($^(T|~V))+k[0]+4096336452&4294967295,_=T+(R<<6&4294967295|R>>>26),R=V+(T^(_|~$))+k[7]+1126891415&4294967295,V=_+(R<<10&4294967295|R>>>22),R=$+(_^(V|~T))+k[14]+2878612391&4294967295,$=V+(R<<15&4294967295|R>>>17),R=T+(V^($|~_))+k[5]+4237533241&4294967295,T=$+(R<<21&4294967295|R>>>11),R=_+($^(T|~V))+k[12]+1700485571&4294967295,_=T+(R<<6&4294967295|R>>>26),R=V+(T^(_|~$))+k[3]+2399980690&4294967295,V=_+(R<<10&4294967295|R>>>22),R=$+(_^(V|~T))+k[10]+4293915773&4294967295,$=V+(R<<15&4294967295|R>>>17),R=T+(V^($|~_))+k[1]+2240044497&4294967295,T=$+(R<<21&4294967295|R>>>11),R=_+($^(T|~V))+k[8]+1873313359&4294967295,_=T+(R<<6&4294967295|R>>>26),R=V+(T^(_|~$))+k[15]+4264355552&4294967295,V=_+(R<<10&4294967295|R>>>22),R=$+(_^(V|~T))+k[6]+2734768916&4294967295,$=V+(R<<15&4294967295|R>>>17),R=T+(V^($|~_))+k[13]+1309151649&4294967295,T=$+(R<<21&4294967295|R>>>11),R=_+($^(T|~V))+k[4]+4149444226&4294967295,_=T+(R<<6&4294967295|R>>>26),R=V+(T^(_|~$))+k[11]+3174756917&4294967295,V=_+(R<<10&4294967295|R>>>22),R=$+(_^(V|~T))+k[2]+718787259&4294967295,$=V+(R<<15&4294967295|R>>>17),R=T+(V^($|~_))+k[9]+3951481745&4294967295,A.g[0]=A.g[0]+_&4294967295,A.g[1]=A.g[1]+($+(R<<21&4294967295|R>>>11))&4294967295,A.g[2]=A.g[2]+$&4294967295,A.g[3]=A.g[3]+V&4294967295}r.prototype.u=function(A,_){_===void 0&&(_=A.length);for(var T=_-this.blockSize,k=this.B,$=this.h,V=0;V<_;){if($==0)for(;V<=T;)s(this,A,V),V+=this.blockSize;if(typeof A=="string"){for(;V<_;)if(k[$++]=A.charCodeAt(V++),$==this.blockSize){s(this,k),$=0;break}}else for(;V<_;)if(k[$++]=A[V++],$==this.blockSize){s(this,k),$=0;break}}this.h=$,this.o+=_},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var _=1;_<A.length-8;++_)A[_]=0;var T=8*this.o;for(_=A.length-8;_<A.length;++_)A[_]=T&255,T/=256;for(this.u(A),A=Array(16),_=T=0;4>_;++_)for(var k=0;32>k;k+=8)A[T++]=this.g[_]>>>k&255;return A};function i(A,_){var T=a;return Object.prototype.hasOwnProperty.call(T,A)?T[A]:T[A]=_(A)}function o(A,_){this.h=_;for(var T=[],k=!0,$=A.length-1;0<=$;$--){var V=A[$]|0;k&&V==_||(T[$]=V,k=!1)}this.g=T}var a={};function l(A){return-128<=A&&128>A?i(A,function(_){return new o([_|0],0>_?-1:0)}):new o([A|0],0>A?-1:0)}function c(A){if(isNaN(A)||!isFinite(A))return f;if(0>A)return I(c(-A));for(var _=[],T=1,k=0;A>=T;k++)_[k]=A/T|0,T*=4294967296;return new o(_,0)}function h(A,_){if(A.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(A.charAt(0)=="-")return I(h(A.substring(1),_));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var T=c(Math.pow(_,8)),k=f,$=0;$<A.length;$+=8){var V=Math.min(8,A.length-$),R=parseInt(A.substring($,$+V),_);8>V?(V=c(Math.pow(_,V)),k=k.j(V).add(c(R))):(k=k.j(T),k=k.add(c(R)))}return k}var f=l(0),m=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(x(this))return-I(this).m();for(var A=0,_=1,T=0;T<this.g.length;T++){var k=this.i(T);A+=(0<=k?k:4294967296+k)*_,_*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(w(this))return"0";if(x(this))return"-"+I(this).toString(A);for(var _=c(Math.pow(A,6)),T=this,k="";;){var $=q(T,_).g;T=O(T,$.j(_));var V=((0<T.g.length?T.g[0]:T.h)>>>0).toString(A);if(T=$,w(T))return V+k;for(;6>V.length;)V="0"+V;k=V+k}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function w(A){if(A.h!=0)return!1;for(var _=0;_<A.g.length;_++)if(A.g[_]!=0)return!1;return!0}function x(A){return A.h==-1}n.l=function(A){return A=O(this,A),x(A)?-1:w(A)?0:1};function I(A){for(var _=A.g.length,T=[],k=0;k<_;k++)T[k]=~A.g[k];return new o(T,~A.h).add(m)}n.abs=function(){return x(this)?I(this):this},n.add=function(A){for(var _=Math.max(this.g.length,A.g.length),T=[],k=0,$=0;$<=_;$++){var V=k+(this.i($)&65535)+(A.i($)&65535),R=(V>>>16)+(this.i($)>>>16)+(A.i($)>>>16);k=R>>>16,V&=65535,R&=65535,T[$]=R<<16|V}return new o(T,T[T.length-1]&-2147483648?-1:0)};function O(A,_){return A.add(I(_))}n.j=function(A){if(w(this)||w(A))return f;if(x(this))return x(A)?I(this).j(I(A)):I(I(this).j(A));if(x(A))return I(this.j(I(A)));if(0>this.l(v)&&0>A.l(v))return c(this.m()*A.m());for(var _=this.g.length+A.g.length,T=[],k=0;k<2*_;k++)T[k]=0;for(k=0;k<this.g.length;k++)for(var $=0;$<A.g.length;$++){var V=this.i(k)>>>16,R=this.i(k)&65535,Ke=A.i($)>>>16,ut=A.i($)&65535;T[2*k+2*$]+=R*ut,L(T,2*k+2*$),T[2*k+2*$+1]+=V*ut,L(T,2*k+2*$+1),T[2*k+2*$+1]+=R*Ke,L(T,2*k+2*$+1),T[2*k+2*$+2]+=V*Ke,L(T,2*k+2*$+2)}for(k=0;k<_;k++)T[k]=T[2*k+1]<<16|T[2*k];for(k=_;k<2*_;k++)T[k]=0;return new o(T,0)};function L(A,_){for(;(A[_]&65535)!=A[_];)A[_+1]+=A[_]>>>16,A[_]&=65535,_++}function U(A,_){this.g=A,this.h=_}function q(A,_){if(w(_))throw Error("division by zero");if(w(A))return new U(f,f);if(x(A))return _=q(I(A),_),new U(I(_.g),I(_.h));if(x(_))return _=q(A,I(_)),new U(I(_.g),_.h);if(30<A.g.length){if(x(A)||x(_))throw Error("slowDivide_ only works with positive integers.");for(var T=m,k=_;0>=k.l(A);)T=te(T),k=te(k);var $=X(T,1),V=X(k,1);for(k=X(k,2),T=X(T,2);!w(k);){var R=V.add(k);0>=R.l(A)&&($=$.add(T),V=R),k=X(k,1),T=X(T,1)}return _=O(A,$.j(_)),new U($,_)}for($=f;0<=A.l(_);){for(T=Math.max(1,Math.floor(A.m()/_.m())),k=Math.ceil(Math.log(T)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),V=c(T),R=V.j(_);x(R)||0<R.l(A);)T-=k,V=c(T),R=V.j(_);w(V)&&(V=m),$=$.add(V),A=O(A,R)}return new U($,A)}n.A=function(A){return q(this,A).h},n.and=function(A){for(var _=Math.max(this.g.length,A.g.length),T=[],k=0;k<_;k++)T[k]=this.i(k)&A.i(k);return new o(T,this.h&A.h)},n.or=function(A){for(var _=Math.max(this.g.length,A.g.length),T=[],k=0;k<_;k++)T[k]=this.i(k)|A.i(k);return new o(T,this.h|A.h)},n.xor=function(A){for(var _=Math.max(this.g.length,A.g.length),T=[],k=0;k<_;k++)T[k]=this.i(k)^A.i(k);return new o(T,this.h^A.h)};function te(A){for(var _=A.g.length+1,T=[],k=0;k<_;k++)T[k]=A.i(k)<<1|A.i(k-1)>>>31;return new o(T,A.h)}function X(A,_){var T=_>>5;_%=32;for(var k=A.g.length-T,$=[],V=0;V<k;V++)$[V]=0<_?A.i(V+T)>>>_|A.i(V+T+1)<<32-_:A.i(V+T);return new o($,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Hx=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=h,Ho=o}).apply(typeof O0<"u"?O0:typeof self<"u"?self:typeof window<"u"?window:{});var Ad=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Kx,Ou,Gx,Hd,im,Wx,Qx,Jx;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,y){return u==Array.prototype||u==Object.prototype||(u[p]=y.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ad=="object"&&Ad];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var E=0;E<u.length-1;E++){var B=u[E];if(!(B in y))break e;y=y[B]}u=u[u.length-1],E=y[u],p=p(E),p!=E&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var y=0,E=!1,B={next:function(){if(!E&&y<u.length){var J=y++;return{value:p(J,u[J]),done:!1}}return E=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,y){return y})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function h(u,p,y){return u.call.apply(u.bind,arguments)}function f(u,p,y){if(!u)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,E),u.apply(p,B)}}return function(){return u.apply(p,arguments)}}function m(u,p,y){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:f,m.apply(null,arguments)}function v(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var E=y.slice();return E.push.apply(E,arguments),u.apply(this,E)}}function w(u,p){function y(){}y.prototype=p.prototype,u.aa=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Qb=function(E,B,J){for(var Ie=Array(arguments.length-2),St=2;St<arguments.length;St++)Ie[St-2]=arguments[St];return p.prototype[B].apply(E,Ie)}}function x(u){const p=u.length;if(0<p){const y=Array(p);for(let E=0;E<p;E++)y[E]=u[E];return y}return[]}function I(u,p){for(let y=1;y<arguments.length;y++){const E=arguments[y];if(l(E)){const B=u.length||0,J=E.length||0;u.length=B+J;for(let Ie=0;Ie<J;Ie++)u[B+Ie]=E[Ie]}else u.push(E)}}class O{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function L(u){return/^[\s\xa0]*$/.test(u)}function U(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function q(u){return q[" "](u),u}q[" "]=function(){};var te=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function X(u,p,y){for(const E in u)p.call(y,u[E],E,u)}function A(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function _(u){const p={};for(const y in u)p[y]=u[y];return p}const T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(u,p){let y,E;for(let B=1;B<arguments.length;B++){E=arguments[B];for(y in E)u[y]=E[y];for(let J=0;J<T.length;J++)y=T[J],Object.prototype.hasOwnProperty.call(E,y)&&(u[y]=E[y])}}function $(u){var p=1;u=u.split(":");const y=[];for(;0<p&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function V(u){a.setTimeout(()=>{throw u},0)}function R(){var u=fe;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Ke{constructor(){this.h=this.g=null}add(p,y){const E=ut.get();E.set(p,y),this.h?this.h.next=E:this.g=E,this.h=E}}var ut=new O(()=>new ct,u=>u.reset());class ct{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let Ge,Ae=!1,fe=new Ke,Je=()=>{const u=a.Promise.resolve(void 0);Ge=()=>{u.then(ae)}};var ae=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(y){V(y)}var p=ut;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Ae=!1};function ne(){this.s=this.s,this.C=this.C}ne.prototype.s=!1,ne.prototype.ma=function(){this.s||(this.s=!0,this.N())},ne.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ne(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Ne.prototype.h=function(){this.defaultPrevented=!0};var dt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function Pt(u,p){if(Ne.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var y=this.type=u.type,E=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(te){e:{try{q(p.nodeName);var B=!0;break e}catch{}B=!1}B||(p=null)}}else y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement);this.relatedTarget=p,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:en[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Pt.aa.h.call(this)}}w(Pt,Ne);var en={2:"touch",3:"pen",4:"mouse"};Pt.prototype.h=function(){Pt.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Y="closure_listenable_"+(1e6*Math.random()|0),xe=0;function ve(u,p,y,E,B){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!E,this.ha=B,this.key=++xe,this.da=this.fa=!1}function Pe(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function nt(u){this.src=u,this.g={},this.h=0}nt.prototype.add=function(u,p,y,E,B){var J=u.toString();u=this.g[J],u||(u=this.g[J]=[],this.h++);var Ie=P(u,p,E,B);return-1<Ie?(p=u[Ie],y||(p.fa=!1)):(p=new ve(p,this.src,J,!!E,B),p.fa=y,u.push(p)),p};function vt(u,p){var y=p.type;if(y in u.g){var E=u.g[y],B=Array.prototype.indexOf.call(E,p,void 0),J;(J=0<=B)&&Array.prototype.splice.call(E,B,1),J&&(Pe(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function P(u,p,y,E){for(var B=0;B<u.length;++B){var J=u[B];if(!J.da&&J.listener==p&&J.capture==!!y&&J.ha==E)return B}return-1}var N="closure_lm_"+(1e6*Math.random()|0),H={};function K(u,p,y,E,B){if(E&&E.once)return ge(u,p,y,E,B);if(Array.isArray(p)){for(var J=0;J<p.length;J++)K(u,p[J],y,E,B);return null}return y=Fe(y),u&&u[Y]?u.K(p,y,c(E)?!!E.capture:!!E,B):Z(u,p,y,!1,E,B)}function Z(u,p,y,E,B,J){if(!p)throw Error("Invalid event type");var Ie=c(B)?!!B.capture:!!B,St=Te(u);if(St||(u[N]=St=new nt(u)),y=St.add(p,y,E,Ie,J),y.proxy)return y;if(E=ue(),y.proxy=E,E.src=u,E.listener=y,u.addEventListener)dt||(B=Ie),B===void 0&&(B=!1),u.addEventListener(p.toString(),E,B);else if(u.attachEvent)u.attachEvent(pe(p.toString()),E);else if(u.addListener&&u.removeListener)u.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return y}function ue(){function u(y){return p.call(u.src,u.listener,y)}const p=Ve;return u}function ge(u,p,y,E,B){if(Array.isArray(p)){for(var J=0;J<p.length;J++)ge(u,p[J],y,E,B);return null}return y=Fe(y),u&&u[Y]?u.L(p,y,c(E)?!!E.capture:!!E,B):Z(u,p,y,!0,E,B)}function me(u,p,y,E,B){if(Array.isArray(p))for(var J=0;J<p.length;J++)me(u,p[J],y,E,B);else E=c(E)?!!E.capture:!!E,y=Fe(y),u&&u[Y]?(u=u.i,p=String(p).toString(),p in u.g&&(J=u.g[p],y=P(J,y,E,B),-1<y&&(Pe(J[y]),Array.prototype.splice.call(J,y,1),J.length==0&&(delete u.g[p],u.h--)))):u&&(u=Te(u))&&(p=u.g[p.toString()],u=-1,p&&(u=P(p,y,E,B)),(y=-1<u?p[u]:null)&&ye(y))}function ye(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[Y])vt(p.i,u);else{var y=u.type,E=u.proxy;p.removeEventListener?p.removeEventListener(y,E,u.capture):p.detachEvent?p.detachEvent(pe(y),E):p.addListener&&p.removeListener&&p.removeListener(E),(y=Te(p))?(vt(y,u),y.h==0&&(y.src=null,p[N]=null)):Pe(u)}}}function pe(u){return u in H?H[u]:H[u]="on"+u}function Ve(u,p){if(u.da)u=!0;else{p=new Pt(p,this);var y=u.listener,E=u.ha||u.src;u.fa&&ye(u),u=y.call(E,p)}return u}function Te(u){return u=u[N],u instanceof nt?u:null}var Ce="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fe(u){return typeof u=="function"?u:(u[Ce]||(u[Ce]=function(p){return u.handleEvent(p)}),u[Ce])}function Ue(){ne.call(this),this.i=new nt(this),this.M=this,this.F=null}w(Ue,ne),Ue.prototype[Y]=!0,Ue.prototype.removeEventListener=function(u,p,y,E){me(this,u,p,y,E)};function We(u,p){var y,E=u.F;if(E)for(y=[];E;E=E.F)y.push(E);if(u=u.M,E=p.type||p,typeof p=="string")p=new Ne(p,u);else if(p instanceof Ne)p.target=p.target||u;else{var B=p;p=new Ne(E,u),k(p,B)}if(B=!0,y)for(var J=y.length-1;0<=J;J--){var Ie=p.g=y[J];B=rt(Ie,E,!0,p)&&B}if(Ie=p.g=u,B=rt(Ie,E,!0,p)&&B,B=rt(Ie,E,!1,p)&&B,y)for(J=0;J<y.length;J++)Ie=p.g=y[J],B=rt(Ie,E,!1,p)&&B}Ue.prototype.N=function(){if(Ue.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var y=u.g[p],E=0;E<y.length;E++)Pe(y[E]);delete u.g[p],u.h--}}this.F=null},Ue.prototype.K=function(u,p,y,E){return this.i.add(String(u),p,!1,y,E)},Ue.prototype.L=function(u,p,y,E){return this.i.add(String(u),p,!0,y,E)};function rt(u,p,y,E){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var B=!0,J=0;J<p.length;++J){var Ie=p[J];if(Ie&&!Ie.da&&Ie.capture==y){var St=Ie.listener,Vn=Ie.ha||Ie.src;Ie.fa&&vt(u.i,Ie),B=St.call(Vn,E)!==!1&&B}}return B&&!E.defaultPrevented}function an(u,p,y){if(typeof u=="function")y&&(u=m(u,y));else if(u&&typeof u.handleEvent=="function")u=m(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Ht(u){u.g=an(()=>{u.g=null,u.i&&(u.i=!1,Ht(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class On extends ne{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Ht(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qt(u){ne.call(this),this.h=u,this.g={}}w(Qt,ne);var Kr=[];function Os(u){X(u.g,function(p,y){this.g.hasOwnProperty(y)&&ye(p)},u),u.g={}}Qt.prototype.N=function(){Qt.aa.N.call(this),Os(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var _n=a.JSON.stringify,Pn=a.JSON.parse,vi=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function re(){}re.prototype.h=null;function j(u){return u.h||(u.h=u.i())}function _e(){}var Le={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Qe(){Ne.call(this,"d")}w(Qe,Ne);function ze(){Ne.call(this,"c")}w(ze,Ne);var It={},yt=null;function Ut(){return yt=yt||new Ue}It.La="serverreachability";function Rn(u){Ne.call(this,It.La,u)}w(Rn,Ne);function Yn(u){const p=Ut();We(p,new Rn(p))}It.STAT_EVENT="statevent";function ot(u,p){Ne.call(this,It.STAT_EVENT,u),this.stat=p}w(ot,Ne);function Rt(u){const p=Ut();We(p,new ot(p,u))}It.Ma="timingevent";function Xn(u,p){Ne.call(this,It.Ma,u),this.size=p}w(Xn,Ne);function Zn(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function bn(){this.g=!0}bn.prototype.xa=function(){this.g=!1};function vo(u,p,y,E,B,J){u.info(function(){if(u.g)if(J)for(var Ie="",St=J.split("&"),Vn=0;Vn<St.length;Vn++){var Et=St[Vn].split("=");if(1<Et.length){var Fn=Et[0];Et=Et[1];var Mn=Fn.split("_");Ie=2<=Mn.length&&Mn[1]=="type"?Ie+(Fn+"="+Et+"&"):Ie+(Fn+"=redacted&")}}else Ie=null;else Ie=J;return"XMLHTTP REQ ("+E+") [attempt "+B+"]: "+p+`
`+y+`
`+Ie})}function ms(u,p,y,E,B,J,Ie){u.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+B+"]: "+p+`
`+y+`
`+J+" "+Ie})}function gs(u,p,y,E){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+ud(u,y)+(E?" "+E:"")})}function Jl(u,p){u.info(function(){return"TIMEOUT: "+p})}bn.prototype.info=function(){};function ud(u,p){if(!u.g)return p;if(!p)return null;try{var y=JSON.parse(p);if(y){for(u=0;u<y.length;u++)if(Array.isArray(y[u])){var E=y[u];if(!(2>E.length)){var B=E[1];if(Array.isArray(B)&&!(1>B.length)){var J=B[0];if(J!="noop"&&J!="stop"&&J!="close")for(var Ie=1;Ie<B.length;Ie++)B[Ie]=""}}}}return _n(y)}catch{return p}}var wa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},xa={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Yl;function Ia(){}w(Ia,re),Ia.prototype.g=function(){return new XMLHttpRequest},Ia.prototype.i=function(){return{}},Yl=new Ia;function vs(u,p,y,E){this.j=u,this.i=p,this.l=y,this.R=E||1,this.U=new Qt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new cd}function cd(){this.i=null,this.g="",this.h=!1}var Xl={},Zl={};function Ea(u,p,y){u.L=1,u.v=Ir(fr(p)),u.m=y,u.P=!0,dd(u,null)}function dd(u,p){u.F=Date.now(),Vr(u),u.A=fr(u.v);var y=u.A,E=u.R;Array.isArray(E)||(E=[String(E)]),iu(y.i,"t",E),u.C=0,y=u.j.J,u.h=new cd,u.g=xo(u.j,y?p:null,!u.m),0<u.O&&(u.M=new On(m(u.Y,u,u.g),u.O)),p=u.U,y=u.g,E=u.ca;var B="readystatechange";Array.isArray(B)||(B&&(Kr[0]=B.toString()),B=Kr);for(var J=0;J<B.length;J++){var Ie=K(y,B[J],E||p.handleEvent,!1,p.h||p);if(!Ie)break;p.g[Ie.key]=Ie}p=u.H?_(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Yn(),vo(u.i,u.u,u.A,u.l,u.R,u.m)}vs.prototype.ca=function(u){u=u.target;const p=this.M;p&&tr(u)==3?p.j():this.Y(u)},vs.prototype.Y=function(u){try{if(u==this.g)e:{const Mn=tr(this.g);var p=this.g.Ba();const Ti=this.g.Z();if(!(3>Mn)&&(Mn!=3||this.g&&(this.h.h||this.g.oa()||ws(this.g)))){this.J||Mn!=4||p==7||(p==8||0>=Ti?Yn(3):Yn(2)),Gr(this);var y=this.g.Z();this.X=y;t:if(eu(this)){var E=ws(this.g);u="";var B=E.length,J=tr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){er(this),Wr(this);var Ie="";break t}this.h.i=new a.TextDecoder}for(p=0;p<B;p++)this.h.h=!0,u+=this.h.i.decode(E[p],{stream:!(J&&p==B-1)});E.length=0,this.h.g+=u,this.C=0,Ie=this.h.g}else Ie=this.g.oa();if(this.o=y==200,ms(this.i,this.u,this.A,this.l,this.R,Mn,y),this.o){if(this.T&&!this.K){t:{if(this.g){var St,Vn=this.g;if((St=Vn.g?Vn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(St)){var Et=St;break t}}Et=null}if(y=Et)gs(this.i,this.l,y,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ta(this,y);else{this.o=!1,this.s=3,Rt(12),er(this),Wr(this);break e}}if(this.P){y=!0;let Sr;for(;!this.J&&this.C<Ie.length;)if(Sr=qf(this,Ie),Sr==Zl){Mn==4&&(this.s=4,Rt(14),y=!1),gs(this.i,this.l,null,"[Incomplete Response]");break}else if(Sr==Xl){this.s=4,Rt(15),gs(this.i,this.l,Ie,"[Invalid Chunk]"),y=!1;break}else gs(this.i,this.l,Sr,null),Ta(this,Sr);if(eu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Mn!=4||Ie.length!=0||this.h.h||(this.s=1,Rt(16),y=!1),this.o=this.o&&y,!y)gs(this.i,this.l,Ie,"[Invalid Chunked Response]"),er(this),Wr(this);else if(0<Ie.length&&!this.W){this.W=!0;var Fn=this.j;Fn.g==this&&Fn.ba&&!Fn.M&&(Fn.j.info("Great, no buffering proxy detected. Bytes received: "+Ie.length),hu(Fn),Fn.M=!0,Rt(11))}}else gs(this.i,this.l,Ie,null),Ta(this,Ie);Mn==4&&er(this),this.o&&!this.J&&(Mn==4?_d(this.j,this):(this.o=!1,Vr(this)))}else Gf(this.g),y==400&&0<Ie.indexOf("Unknown SID")?(this.s=3,Rt(12)):(this.s=0,Rt(13)),er(this),Wr(this)}}}catch{}finally{}};function eu(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function qf(u,p){var y=u.C,E=p.indexOf(`
`,y);return E==-1?Zl:(y=Number(p.substring(y,E)),isNaN(y)?Xl:(E+=1,E+y>p.length?Zl:(p=p.slice(E,E+y),u.C=E+y,p)))}vs.prototype.cancel=function(){this.J=!0,er(this)};function Vr(u){u.S=Date.now()+u.I,ys(u,u.I)}function ys(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Zn(m(u.ba,u),p)}function Gr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}vs.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Jl(this.i,this.A),this.L!=2&&(Yn(),Rt(17)),er(this),this.s=2,Wr(this)):ys(this,this.S-u)};function Wr(u){u.j.G==0||u.J||_d(u.j,u)}function er(u){Gr(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Os(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Ta(u,p){try{var y=u.j;if(y.G!=0&&(y.g==u||Sa(y.h,u))){if(!u.K&&Sa(y.h,u)&&y.G==3){try{var E=y.Da.g.parse(p)}catch{E=null}if(Array.isArray(E)&&E.length==3){var B=E;if(B[0]==0){e:if(!y.u){if(y.g)if(y.g.F+3e3<u.F)Ei(y),Ii(y);else break e;du(y),Rt(18)}}else y.za=B[1],0<y.za-y.T&&37500>B[2]&&y.F&&y.v==0&&!y.C&&(y.C=Zn(m(y.Za,y),6e3));if(1>=Mr(y.h)&&y.ca){try{y.ca()}catch{}y.ca=void 0}}else Ar(y,11)}else if((u.K||y.g==u)&&Ei(y),!L(p))for(B=y.Da.g.parse(p),p=0;p<B.length;p++){let Et=B[p];if(y.T=Et[0],Et=Et[1],y.G==2)if(Et[0]=="c"){y.K=Et[1],y.ia=Et[2];const Fn=Et[3];Fn!=null&&(y.la=Fn,y.j.info("VER="+y.la));const Mn=Et[4];Mn!=null&&(y.Aa=Mn,y.j.info("SVER="+y.Aa));const Ti=Et[5];Ti!=null&&typeof Ti=="number"&&0<Ti&&(E=1.5*Ti,y.L=E,y.j.info("backChannelRequestTimeoutMs_="+E)),E=y;const Sr=u.g;if(Sr){const Fa=Sr.g?Sr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fa){var J=E.h;J.g||Fa.indexOf("spdy")==-1&&Fa.indexOf("quic")==-1&&Fa.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(Pa(J,J.h),J.h=null))}if(E.D){const vu=Sr.g?Sr.g.getResponseHeader("X-HTTP-Session-Id"):null;vu&&(E.ya=vu,Dt(E.I,E.D,vu))}}y.G=3,y.l&&y.l.ua(),y.ba&&(y.R=Date.now()-u.F,y.j.info("Handshake RTT: "+y.R+"ms")),E=y;var Ie=u;if(E.qa=wo(E,E.J?E.ia:null,E.W),Ie.K){Ra(E.h,Ie);var St=Ie,Vn=E.L;Vn&&(St.I=Vn),St.B&&(Gr(St),Vr(St)),E.g=Ie}else pr(E);0<y.i.length&&Oa(y)}else Et[0]!="stop"&&Et[0]!="close"||Ar(y,7);else y.G==3&&(Et[0]=="stop"||Et[0]=="close"?Et[0]=="stop"?Ar(y,7):uu(y):Et[0]!="noop"&&y.l&&y.l.ta(Et),y.v=0)}}Yn(4)}catch{}}var Aa=class{constructor(u,p){this.g=u,this.map=p}};function yi(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function hd(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Mr(u){return u.h?1:u.g?u.g.size:0}function Sa(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Pa(u,p){u.g?u.g.add(p):u.h=p}function Ra(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}yi.prototype.cancel=function(){if(this.i=fd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function fd(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.D);return p}return x(u.i)}function hr(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],y=u.length,E=0;E<y;E++)p.push(u[E]);return p}p=[],y=0;for(E in u)p[y++]=u[E];return p}function Ca(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var y=0;y<u;y++)p.push(y);return p}p=[],y=0;for(const E in u)p[y++]=E;return p}}}function Lr(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var y=Ca(u),E=hr(u),B=E.length,J=0;J<B;J++)p.call(void 0,E[J],y&&y[J],u)}var tu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pd(u,p){if(u){u=u.split("&");for(var y=0;y<u.length;y++){var E=u[y].indexOf("="),B=null;if(0<=E){var J=u[y].substring(0,E);B=u[y].substring(E+1)}else J=u[y];p(J,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function $r(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof $r){this.h=u.h,Vs(this,u.j),this.o=u.o,this.g=u.g,ns(this,u.s),this.l=u.l;var p=u.i,y=new at;y.i=p.i,p.g&&(y.g=new Map(p.g),y.h=p.h),nu(this,y),this.m=u.m}else u&&(p=String(u).match(tu))?(this.h=!1,Vs(this,p[1]||"",!0),this.o=yo(p[2]||""),this.g=yo(p[3]||"",!0),ns(this,p[4]),this.l=yo(p[5]||"",!0),nu(this,p[6]||"",!0),this.m=yo(p[7]||"")):(this.h=!1,this.i=new at(null,this.h))}$r.prototype.toString=function(){var u=[],p=this.j;p&&u.push(_o(p,ru,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(_o(p,ru,!0),"@"),u.push(encodeURIComponent(String(y)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.s,y!=null&&u.push(":",String(y))),(y=this.l)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(_o(y,y.charAt(0)=="/"?Da:ka,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",_o(y,Me)),u.join("")};function fr(u){return new $r(u)}function Vs(u,p,y){u.j=y?yo(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ns(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function nu(u,p,y){p instanceof at?(u.i=p,Hf(u.i,u.h)):(y||(p=_o(p,su)),u.i=new at(p,u.h))}function Dt(u,p,y){u.i.set(p,y)}function Ir(u){return Dt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function yo(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function _o(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,zf),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function zf(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var ru=/[#\/\?@]/g,ka=/[#\?:]/g,Da=/[#\?]/g,su=/[#\?@]/g,Me=/#/g;function at(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Cn(u){u.g||(u.g=new Map,u.h=0,u.i&&pd(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}n=at.prototype,n.add=function(u,p){Cn(this),this.i=null,u=_i(this,u);var y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function Ms(u,p){Cn(u),p=_i(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function md(u,p){return Cn(u),p=_i(u,p),u.g.has(p)}n.forEach=function(u,p){Cn(this),this.g.forEach(function(y,E){y.forEach(function(B){u.call(p,B,E,this)},this)},this)},n.na=function(){Cn(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),y=[];for(let E=0;E<p.length;E++){const B=u[E];for(let J=0;J<B.length;J++)y.push(p[E])}return y},n.V=function(u){Cn(this);let p=[];if(typeof u=="string")md(this,u)&&(p=p.concat(this.g.get(_i(this,u))));else{u=Array.from(this.g.values());for(let y=0;y<u.length;y++)p=p.concat(u[y])}return p},n.set=function(u,p){return Cn(this),this.i=null,u=_i(this,u),md(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function iu(u,p,y){Ms(u,p),0<y.length&&(u.i=null,u.g.set(_i(u,p),x(y)),u.h+=y.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var y=0;y<p.length;y++){var E=p[y];const J=encodeURIComponent(String(E)),Ie=this.V(E);for(E=0;E<Ie.length;E++){var B=J;Ie[E]!==""&&(B+="="+encodeURIComponent(String(Ie[E]))),u.push(B)}}return this.i=u.join("&")};function _i(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Hf(u,p){p&&!u.j&&(Cn(u),u.i=null,u.g.forEach(function(y,E){var B=E.toLowerCase();E!=B&&(Ms(this,E),iu(this,B,y))},u)),u.j=p}function ou(u,p){const y=new bn;if(a.Image){const E=new Image;E.onload=v(Er,y,"TestLoadImage: loaded",!0,p,E),E.onerror=v(Er,y,"TestLoadImage: error",!1,p,E),E.onabort=v(Er,y,"TestLoadImage: abort",!1,p,E),E.ontimeout=v(Er,y,"TestLoadImage: timeout",!1,p,E),a.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=u}else p(!1)}function Kf(u,p){const y=new bn,E=new AbortController,B=setTimeout(()=>{E.abort(),Er(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:E.signal}).then(J=>{clearTimeout(B),J.ok?Er(y,"TestPingServer: ok",!0,p):Er(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(B),Er(y,"TestPingServer: error",!1,p)})}function Er(u,p,y,E,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),E(y)}catch{}}function Na(){this.g=new vi}function bi(u,p,y){const E=y||"";try{Lr(u,function(B,J){let Ie=B;c(B)&&(Ie=_n(B)),p.push(E+J+"="+encodeURIComponent(Ie))})}catch(B){throw p.push(E+"type="+encodeURIComponent("_badmap")),B}}function rs(u){this.l=u.Ub||null,this.j=u.eb||!1}w(rs,re),rs.prototype.g=function(){return new _s(this.l,this.j)},rs.prototype.i=function(u){return function(){return u}}({});function _s(u,p){Ue.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(_s,Ue),n=_s.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,bo(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bs(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,bo(this)),this.g&&(this.readyState=3,bo(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;wi(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function wi(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?bs(this):bo(this),this.readyState==3&&wi(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,bs(this))},n.Qa=function(u){this.g&&(this.response=u,bs(this))},n.ga=function(){this.g&&bs(this)};function bs(u){u.readyState=4,u.l=null,u.j=null,u.v=null,bo(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function bo(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(_s.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function gd(u){let p="";return X(u,function(y,E){p+=E,p+=":",p+=y,p+=`\r
`}),p}function au(u,p,y){e:{for(E in y){var E=!1;break e}E=!0}E||(y=gd(y),typeof u=="string"?y!=null&&encodeURIComponent(String(y)):Dt(u,p,y))}function Jt(u){Ue.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(Jt,Ue);var Xe=/^https?$/i,pt=["POST","PUT"];n=Jt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,y,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Yl.g(),this.v=this.o?j(this.o):j(Yl),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(J){ln(this,J);return}if(u=y||"",y=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var B in E)y.set(B,E[B]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const J of E.keys())y.set(J,E.get(J));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(y.keys()).find(J=>J.toLowerCase()=="content-type"),B=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(pt,p,void 0))||E||B||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,Ie]of y)this.g.setRequestHeader(J,Ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{lu(this),this.u=!0,this.g.send(u),this.u=!1}catch(J){ln(this,J)}};function ln(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,At(u),xi(u)}function At(u){u.A||(u.A=!0,We(u,"complete"),We(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,We(this,"complete"),We(this,"abort"),xi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xi(this,!0)),Jt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?vd(this):this.bb())},n.bb=function(){vd(this)};function vd(u){if(u.h&&typeof o<"u"&&(!u.v[1]||tr(u)!=4||u.Z()!=2)){if(u.u&&tr(u)==4)an(u.Ea,0,u);else if(We(u,"readystatechange"),tr(u)==4){u.h=!1;try{const Ie=u.Z();e:switch(Ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var E;if(E=Ie===0){var B=String(u.D).match(tu)[1]||null;!B&&a.self&&a.self.location&&(B=a.self.location.protocol.slice(0,-1)),E=!Xe.test(B?B.toLowerCase():"")}y=E}if(y)We(u,"complete"),We(u,"success");else{u.m=6;try{var J=2<tr(u)?u.g.statusText:""}catch{J=""}u.l=J+" ["+u.Z()+"]",At(u)}}finally{xi(u)}}}}function xi(u,p){if(u.g){lu(u);const y=u.g,E=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||We(u,"ready");try{y.onreadystatechange=E}catch{}}}function lu(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function tr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<tr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Pn(p)}};function ws(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Gf(u){const p={};u=(u.g&&2<=tr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<u.length;E++){if(L(u[E]))continue;var y=$(u[E]);const B=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const J=p[B]||[];p[B]=J,J.push(y)}A(p,function(E){return E.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qr(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function Tr(u){this.Aa=0,this.i=[],this.j=new bn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qr("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qr("baseRetryDelayMs",5e3,u),this.cb=Qr("retryDelaySeedMs",1e4,u),this.Wa=Qr("forwardChannelMaxRetries",2,u),this.wa=Qr("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new yi(u&&u.concurrentRequestLimit),this.Da=new Na,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Tr.prototype,n.la=8,n.G=1,n.connect=function(u,p,y,E){Rt(0),this.W=u,this.H=p||{},y&&E!==void 0&&(this.H.OSID=y,this.H.OAID=E),this.F=this.X,this.I=wo(this,null,this.W),Oa(this)};function uu(u){if(yd(u),u.G==3){var p=u.U++,y=fr(u.I);if(Dt(y,"SID",u.K),Dt(y,"RID",p),Dt(y,"TYPE","terminate"),xs(u,y),p=new vs(u,u.j,p),p.L=2,p.v=Ir(fr(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.v,y=!0),y||(p.g=xo(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Vr(p)}Ma(u)}function Ii(u){u.g&&(hu(u),u.g.cancel(),u.g=null)}function yd(u){Ii(u),u.u&&(a.clearTimeout(u.u),u.u=null),Ei(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Oa(u){if(!hd(u.h)&&!u.s){u.s=!0;var p=u.Ga;Ge||Je(),Ae||(Ge(),Ae=!0),fe.add(p,u),u.B=0}}function Wf(u,p){return Mr(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Zn(m(u.Ga,u,p),pu(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const B=new vs(this,this.j,u);let J=this.o;if(this.S&&(J?(J=_(J),k(J,this.S)):J=this.S),this.m!==null||this.O||(B.H=J,J=null),this.P)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var E=this.i[y];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(p+=E,4096<p){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=Va(this,B,p),y=fr(this.I),Dt(y,"RID",u),Dt(y,"CVER",22),this.D&&Dt(y,"X-HTTP-Session-Id",this.D),xs(this,y),J&&(this.O?p="headers="+encodeURIComponent(String(gd(J)))+"&"+p:this.m&&au(y,this.m,J)),Pa(this.h,B),this.Ua&&Dt(y,"TYPE","init"),this.P?(Dt(y,"$req",p),Dt(y,"SID","null"),B.T=!0,Ea(B,y,null)):Ea(B,y,p),this.G=2}}else this.G==3&&(u?cu(this,u):this.i.length==0||hd(this.h)||cu(this))};function cu(u,p){var y;p?y=p.l:y=u.U++;const E=fr(u.I);Dt(E,"SID",u.K),Dt(E,"RID",y),Dt(E,"AID",u.T),xs(u,E),u.m&&u.o&&au(E,u.m,u.o),y=new vs(u,u.j,y,u.B+1),u.m===null&&(y.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Va(u,y,1e3),y.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Pa(u.h,y),Ea(y,E,p)}function xs(u,p){u.H&&X(u.H,function(y,E){Dt(p,E,y)}),u.l&&Lr({},function(y,E){Dt(p,E,y)})}function Va(u,p,y){y=Math.min(u.i.length,y);var E=u.l?m(u.l.Na,u.l,u):null;e:{var B=u.i;let J=-1;for(;;){const Ie=["count="+y];J==-1?0<y?(J=B[0].g,Ie.push("ofs="+J)):J=0:Ie.push("ofs="+J);let St=!0;for(let Vn=0;Vn<y;Vn++){let Et=B[Vn].g;const Fn=B[Vn].map;if(Et-=J,0>Et)J=Math.max(0,B[Vn].g-100),St=!1;else try{bi(Fn,Ie,"req"+Et+"_")}catch{E&&E(Fn)}}if(St){E=Ie.join("&");break e}}}return u=u.i.splice(0,y),p.D=u,E}function pr(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Ge||Je(),Ae||(Ge(),Ae=!0),fe.add(p,u),u.v=0}}function du(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Zn(m(u.Fa,u),pu(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,fu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Zn(m(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Rt(10),Ii(this),fu(this))};function hu(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function fu(u){u.g=new vs(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=fr(u.qa);Dt(p,"RID","rpc"),Dt(p,"SID",u.K),Dt(p,"AID",u.T),Dt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Dt(p,"TO",u.ja),Dt(p,"TYPE","xmlhttp"),xs(u,p),u.m&&u.o&&au(p,u.m,u.o),u.L&&(u.g.I=u.L);var y=u.g;u=u.ia,y.L=1,y.v=Ir(fr(p)),y.m=null,y.P=!0,dd(y,u)}n.Za=function(){this.C!=null&&(this.C=null,Ii(this),du(this),Rt(19))};function Ei(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function _d(u,p){var y=null;if(u.g==p){Ei(u),hu(u),u.g=null;var E=2}else if(Sa(u.h,p))y=p.D,Ra(u.h,p),E=1;else return;if(u.G!=0){if(p.o)if(E==1){y=p.m?p.m.length:0,p=Date.now()-p.F;var B=u.B;E=Ut(),We(E,new Xn(E,y)),Oa(u)}else pr(u);else if(B=p.s,B==3||B==0&&0<p.X||!(E==1&&Wf(u,p)||E==2&&du(u)))switch(y&&0<y.length&&(p=u.h,p.i=p.i.concat(y)),B){case 1:Ar(u,5);break;case 4:Ar(u,10);break;case 3:Ar(u,6);break;default:Ar(u,2)}}}function pu(u,p){let y=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(y*=2),y*p}function Ar(u,p){if(u.j.info("Error code "+p),p==2){var y=m(u.fb,u),E=u.Xa;const B=!E;E=new $r(E||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Vs(E,"https"),Ir(E),B?ou(E.toString(),y):Kf(E.toString(),y)}else Rt(2);u.G=0,u.l&&u.l.sa(p),Ma(u),yd(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Rt(2)):(this.j.info("Failed to ping google.com"),Rt(1))};function Ma(u){if(u.G=0,u.ka=[],u.l){const p=fd(u.h);(p.length!=0||u.i.length!=0)&&(I(u.ka,p),I(u.ka,u.i),u.h.i.length=0,x(u.i),u.i.length=0),u.l.ra()}}function wo(u,p,y){var E=y instanceof $r?fr(y):new $r(y);if(E.g!="")p&&(E.g=p+"."+E.g),ns(E,E.s);else{var B=a.location;E=B.protocol,p=p?p+"."+B.hostname:B.hostname,B=+B.port;var J=new $r(null);E&&Vs(J,E),p&&(J.g=p),B&&ns(J,B),y&&(J.l=y),E=J}return y=u.D,p=u.ya,y&&p&&Dt(E,y,p),Dt(E,"VER",u.la),xs(u,E),E}function xo(u,p,y){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Jt(new rs({eb:y})):new Jt(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function mu(){}n=mu.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function La(){}La.prototype.g=function(u,p){return new mr(u,p)};function mr(u,p){Ue.call(this),this.g=new Tr(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!L(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!L(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new ss(this)}w(mr,Ue),mr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mr.prototype.close=function(){uu(this.g)},mr.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.u&&(y={},y.__data__=_n(u),u=y);p.i.push(new Aa(p.Ya++,u)),p.G==3&&Oa(p)},mr.prototype.N=function(){this.g.l=null,delete this.j,uu(this.g),delete this.g,mr.aa.N.call(this)};function gu(u){Qe.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}w(gu,Qe);function $a(){ze.call(this),this.status=1}w($a,ze);function ss(u){this.g=u}w(ss,mu),ss.prototype.ua=function(){We(this.g,"a")},ss.prototype.ta=function(u){We(this.g,new gu(u))},ss.prototype.sa=function(u){We(this.g,new $a)},ss.prototype.ra=function(){We(this.g,"b")},La.prototype.createWebChannel=La.prototype.g,mr.prototype.send=mr.prototype.o,mr.prototype.open=mr.prototype.m,mr.prototype.close=mr.prototype.close,Jx=function(){return new La},Qx=function(){return Ut()},Wx=It,im={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},wa.NO_ERROR=0,wa.TIMEOUT=8,wa.HTTP_ERROR=6,Hd=wa,xa.COMPLETE="complete",Gx=xa,_e.EventType=Le,Le.OPEN="a",Le.CLOSE="b",Le.ERROR="c",Le.MESSAGE="d",Ue.prototype.listen=Ue.prototype.K,Ou=_e,Jt.prototype.listenOnce=Jt.prototype.L,Jt.prototype.getLastError=Jt.prototype.Ka,Jt.prototype.getLastErrorCode=Jt.prototype.Ba,Jt.prototype.getStatus=Jt.prototype.Z,Jt.prototype.getResponseJson=Jt.prototype.Oa,Jt.prototype.getResponseText=Jt.prototype.oa,Jt.prototype.send=Jt.prototype.ea,Jt.prototype.setWithCredentials=Jt.prototype.Ha,Kx=Jt}).apply(typeof Ad<"u"?Ad:typeof self<"u"?self:typeof window<"u"?window:{});const V0="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}jn.UNAUTHENTICATED=new jn(null),jn.GOOGLE_CREDENTIALS=new jn("google-credentials-uid"),jn.FIRST_PARTY=new jn("first-party-uid"),jn.MOCK_USER=new jn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ll="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const to=new ug("@firebase/firestore");function Wa(){return to.logLevel}function TK(n){to.setLogLevel(n)}function ce(n,...e){if(to.logLevel<=_t.DEBUG){const t=e.map(_g);to.debug(`Firestore (${Ll}): ${n}`,...t)}}function In(n,...e){if(to.logLevel<=_t.ERROR){const t=e.map(_g);to.error(`Firestore (${Ll}): ${n}`,...t)}}function es(n,...e){if(to.logLevel<=_t.WARN){const t=e.map(_g);to.warn(`Firestore (${Ll}): ${n}`,...t)}}function _g(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Re(n="Unexpected state"){const e=`FIRESTORE (${Ll}) INTERNAL ASSERTION FAILED: `+n;throw In(e),new Error(e)}function Oe(n,e){n||Re()}function AK(n,e){n||Re()}function Ee(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class de extends ps{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class m2{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(jn.UNAUTHENTICATED))}shutdown(){}}class g2{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class v2{constructor(e){this.t=e,this.currentUser=jn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Oe(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new qn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new qn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{ce("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ce("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new qn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ce("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Oe(typeof r.accessToken=="string"),new Yx(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Oe(e===null||typeof e=="string"),new jn(e)}}class y2{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=jn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class _2{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new y2(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(jn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Xx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class b2{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Oe(this.o===void 0);const r=i=>{i.error!=null&&ce("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,ce("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ce("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):ce("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Oe(typeof t.token=="string"),this.R=t.token,new Xx(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class SK{getToken(){return Promise.resolve(new Xx(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=w2(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ye(n,e){return n<e?-1:n>e?1:0}function ml(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function eI(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new de(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new de(W.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new de(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new de(W.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return dn.fromMillis(Date.now())}static fromDate(e){return dn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new dn(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ye(this.nanoseconds,e.nanoseconds):Ye(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.timestamp=e}static fromTimestamp(e){return new $e(e)}static min(){return new $e(new dn(0,0))}static max(){return new $e(new dn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e,t,r){t===void 0?t=0:t>e.length&&Re(),r===void 0?r=e.length-t:r>e.length-t&&Re(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return gc.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof gc?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class bt extends gc{construct(e,t,r){return new bt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new de(W.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new bt(t)}static emptyPath(){return new bt([])}}const x2=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rn extends gc{construct(e,t,r){return new rn(e,t,r)}static isValidIdentifier(e){return x2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new rn(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new de(W.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new de(W.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new de(W.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new de(W.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rn(t)}static emptyPath(){return new rn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.path=e}static fromPath(e){return new Se(bt.fromString(e))}static fromName(e){return new Se(bt.fromString(e).popFirst(5))}static empty(){return new Se(bt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&bt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return bt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Se(new bt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function om(n){return n.fields.find(e=>e.kind===2)}function No(n){return n.fields.filter(e=>e.kind!==2)}function I2(n,e){let t=Ye(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=E2(n.fields[r],e.fields[r]),t!==0)return t;return Ye(n.fields.length,e.fields.length)}gl.UNKNOWN_ID=-1;class Ko{constructor(e,t){this.fieldPath=e,this.kind=t}}function E2(n,e){const t=rn.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ye(n.kind,e.kind)}class vl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new vl(0,Hr.min())}}function tI(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=$e.fromTimestamp(r===1e9?new dn(t+1,0):new dn(t,r));return new Hr(s,Se.empty(),e)}function nI(n){return new Hr(n.readTime,n.key,-1)}class Hr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Hr($e.min(),Se.empty(),-1)}static max(){return new Hr($e.max(),Se.empty(),-1)}}function bg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Se.comparator(n.documentKey,e.documentKey),t!==0?t:Ye(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function co(n){if(n.code!==W.FAILED_PRECONDITION||n.message!==rI)throw n;ce("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Re(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(h=>{o[c]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new qn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ku(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=wg(r.target.error);this.V.reject(new Ku(e,s))}}static open(e,t,r,s){try{return new nf(t,e.transaction(s,r))}catch(i){throw new Ku(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ce("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new A2(t)}}class Cs{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Cs.S(Ln())===12.2&&In("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ce("SimpleDb","Removing database:",e),Lo(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!lg())return!1;if(Cs.v())return!0;const e=Ln(),t=Cs.S(e),r=0<t&&t<10,s=iI(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(ce("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Ku(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new de(W.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new de(W.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ku(e,o))},s.onupgradeneeded=i=>{ce("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{ce("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=nf.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(ce("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function iI(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class T2{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Lo(this.B.delete())}}class Ku extends de{constructor(e,t){super(W.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ho(n){return n.name==="IndexedDbTransactionError"}class A2{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ce("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(ce("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Lo(r)}add(e){return ce("SimpleDb","ADD",this.store.name,e,e),Lo(this.store.add(e))}get(e){return Lo(this.store.get(e)).next(t=>(t===void 0&&(t=null),ce("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ce("SimpleDb","DELETE",this.store.name,e),Lo(this.store.delete(e))}count(){return ce("SimpleDb","COUNT",this.store.name),Lo(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){ce("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=wg(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new T2(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const h=c.catch(f=>(l.done(),z.reject(f)));r.push(h)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Lo(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=wg(r.target.error);t(s)}})}let M0=!1;function wg(n){const e=Cs.S(Ln());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new de("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return M0||(M0=!0,setTimeout(()=>{throw r},0)),r}}return n}class S2{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){ce("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ce("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){ho(t)?ce("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await co(t)}await this.X(6e4)})}}class P2{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return ce("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(ce("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=nI(i);bg(o,r)>0&&(r=o)}),new Hr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Cr.oe=-1;function Uc(n){return n==null}function vc(n){return n===0&&1/n==-1/0}function oI(n){return typeof n=="number"&&Number.isInteger(n)&&!vc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ur(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=L0(e)),e=R2(n.get(t),e);return L0(e)}function R2(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function L0(n){return n+""}function As(n){const e=n.length;if(Oe(e>=2),e===2)return Oe(n.charAt(0)===""&&n.charAt(1)===""),bt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Re(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Re()}i=o+2}return new bt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $0=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kd(n,e){return[n,ur(e)]}function aI(n,e,t){return[n,ur(e),t]}const C2={},k2=["prefixPath","collectionGroup","readTime","documentId"],D2=["prefixPath","collectionGroup","documentId"],N2=["collectionGroup","readTime","prefixPath","documentId"],O2=["canonicalId","targetId"],V2=["targetId","path"],M2=["path","targetId"],L2=["collectionId","parent"],$2=["indexId","uid"],F2=["uid","sequenceNumber"],U2=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],j2=["indexId","uid","orderedDocumentKey"],B2=["userId","collectionPath","documentId"],q2=["userId","collectionPath","largestBatchId"],z2=["userId","collectionGroup","largestBatchId"],lI=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],H2=[...lI,"documentOverlays"],uI=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],cI=uI,xg=[...cI,"indexConfiguration","indexState","indexEntries"],K2=xg,G2=[...xg,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am extends sI{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function $n(n,e){const t=Ee(n);return Cs.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F0(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function fo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function dI(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function hI(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,t){this.comparator=e,this.root=t||Kn.EMPTY}insert(e,t){return new Gt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Kn.BLACK,null,null))}remove(e){return new Gt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Sd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Sd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Sd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Sd(this.root,e,this.comparator,!0)}}class Sd{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Kn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Kn.RED,this.left=s??Kn.EMPTY,this.right=i??Kn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Kn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Kn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Kn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Kn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Kn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Re();const e=this.left.check();if(e!==this.right.check())throw Re();return e+(this.isRed()?0:1)}}Kn.EMPTY=null,Kn.RED=!0,Kn.BLACK=!1;Kn.EMPTY=new class{constructor(){this.size=0}get key(){throw Re()}get value(){throw Re()}get color(){throw Re()}get left(){throw Re()}get right(){throw Re()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Kn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.comparator=e,this.data=new Gt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new U0(this.data.getIterator())}getIteratorFrom(e){return new U0(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof jt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new jt(this.comparator);return t.data=e,t}}class U0{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function qa(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e){this.fields=e,e.sort(rn.comparator)}static empty(){return new kr([])}unionWith(e){let t=new jt(rn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new kr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ml(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RK(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new fI("Invalid base64 string: "+i):i}}(e);return new mn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new mn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ye(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}mn.EMPTY_BYTE_STRING=new mn("");const W2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function si(n){if(Oe(!!n),typeof n=="string"){let e=0;const t=W2.exec(n);if(Oe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:nn(n.seconds),nanos:nn(n.nanos)}}function nn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ii(n){return typeof n=="string"?mn.fromBase64String(n):mn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function sf(n){const e=n.mapValue.fields.__previous_value__;return rf(e)?sf(e):e}function yc(n){const e=si(n.mapValue.fields.__local_write_time__.timestampValue);return new dn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Xo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Xo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Xo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ki={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Gd={nullValue:"NULL_VALUE"};function no(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?rf(n)?4:pI(n)?9007199254740991:of(n)?10:11:Re()}function Ns(n,e){if(n===e)return!0;const t=no(n);if(t!==no(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yc(n).isEqual(yc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=si(s.timestampValue),a=si(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return ii(s.bytesValue).isEqual(ii(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return nn(s.geoPointValue.latitude)===nn(i.geoPointValue.latitude)&&nn(s.geoPointValue.longitude)===nn(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return nn(s.integerValue)===nn(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=nn(s.doubleValue),a=nn(i.doubleValue);return o===a?vc(o)===vc(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ml(n.arrayValue.values||[],e.arrayValue.values||[],Ns);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(F0(o)!==F0(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ns(o[l],a[l])))return!1;return!0}(n,e);default:return Re()}}function _c(n,e){return(n.values||[]).find(t=>Ns(t,e))!==void 0}function ro(n,e){if(n===e)return 0;const t=no(n),r=no(e);if(t!==r)return Ye(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ye(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=nn(i.integerValue||i.doubleValue),l=nn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return j0(n.timestampValue,e.timestampValue);case 4:return j0(yc(n),yc(e));case 5:return Ye(n.stringValue,e.stringValue);case 6:return function(i,o){const a=ii(i),l=ii(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const h=Ye(a[c],l[c]);if(h!==0)return h}return Ye(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ye(nn(i.latitude),nn(o.latitude));return a!==0?a:Ye(nn(i.longitude),nn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return B0(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,h;const f=i.fields||{},m=o.fields||{},v=(a=f.value)===null||a===void 0?void 0:a.arrayValue,w=(l=m.value)===null||l===void 0?void 0:l.arrayValue,x=Ye(((c=v==null?void 0:v.values)===null||c===void 0?void 0:c.length)||0,((h=w==null?void 0:w.values)===null||h===void 0?void 0:h.length)||0);return x!==0?x:B0(v,w)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ki.mapValue&&o===Ki.mapValue)return 0;if(i===Ki.mapValue)return 1;if(o===Ki.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},h=Object.keys(c);l.sort(),h.sort();for(let f=0;f<l.length&&f<h.length;++f){const m=Ye(l[f],h[f]);if(m!==0)return m;const v=ro(a[l[f]],c[h[f]]);if(v!==0)return v}return Ye(l.length,h.length)}(n.mapValue,e.mapValue);default:throw Re()}}function j0(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ye(n,e);const t=si(n),r=si(e),s=Ye(t.seconds,r.seconds);return s!==0?s:Ye(t.nanos,r.nanos)}function B0(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=ro(t[s],r[s]);if(i)return i}return Ye(t.length,r.length)}function yl(n){return lm(n)}function lm(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=si(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ii(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Se.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=lm(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${lm(t.fields[o])}`;return s+"}"}(n.mapValue):Re()}function Wd(n){switch(no(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=sf(n);return e?16+Wd(e):16;case 5:return 2*n.stringValue.length;case 6:return ii(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Wd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return fo(r.fields,(i,o)=>{s+=i.length+Wd(o)}),s}(n.mapValue);default:throw Re()}}function Zo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function um(n){return!!n&&"integerValue"in n}function bc(n){return!!n&&"arrayValue"in n}function q0(n){return!!n&&"nullValue"in n}function z0(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Qd(n){return!!n&&"mapValue"in n}function of(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Gu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return fo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Gu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function pI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const mI={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function J2(n){return"nullValue"in n?Gd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Zo(Xo.empty(),Se.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?of(n)?mI:{mapValue:{}}:Re()}function Y2(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Zo(Xo.empty(),Se.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?mI:"mapValue"in n?of(n)?{mapValue:{}}:Ki:Re()}function H0(n,e){const t=ro(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function K0(n,e){const t=ro(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e){this.value=e}static empty(){return new Qn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Qd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gu(t)}setAll(e){let t=rn.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Gu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Qd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ns(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Qd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){fo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Qn(Gu(this.value))}}function gI(n){const e=[];return fo(n.fields,(t,r)=>{const s=new rn([t]);if(Qd(r)){const i=gI(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new kr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Yt(e,0,$e.min(),$e.min(),$e.min(),Qn.empty(),0)}static newFoundDocument(e,t,r,s){return new Yt(e,1,t,$e.min(),r,s,0)}static newNoDocument(e,t){return new Yt(e,2,t,$e.min(),$e.min(),Qn.empty(),0)}static newUnknownDocument(e,t){return new Yt(e,3,t,$e.min(),$e.min(),Qn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Yt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Yt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(e,t){this.position=e,this.inclusive=t}}function G0(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Se.comparator(Se.fromName(o.referenceValue),t.key):r=ro(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function W0(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ns(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,t="asc"){this.field=e,this.dir=t}}function X2(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{}class wt extends vI{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Z2(e,t,r):t==="array-contains"?new nD(e,r):t==="in"?new II(e,r):t==="not-in"?new rD(e,r):t==="array-contains-any"?new sD(e,r):new wt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new eD(e,r):new tD(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ro(t,this.value)):t!==null&&no(this.value)===no(t)&&this.matchesComparison(ro(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Re()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ft extends vI{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Ft(e,t)}matches(e){return _l(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function _l(n){return n.op==="and"}function cm(n){return n.op==="or"}function Ig(n){return yI(n)&&_l(n)}function yI(n){for(const e of n.filters)if(e instanceof Ft)return!1;return!0}function dm(n){if(n instanceof wt)return n.field.canonicalString()+n.op.toString()+yl(n.value);if(Ig(n))return n.filters.map(e=>dm(e)).join(",");{const e=n.filters.map(t=>dm(t)).join(",");return`${n.op}(${e})`}}function _I(n,e){return n instanceof wt?function(r,s){return s instanceof wt&&r.op===s.op&&r.field.isEqual(s.field)&&Ns(r.value,s.value)}(n,e):n instanceof Ft?function(r,s){return s instanceof Ft&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&_I(o,s.filters[a]),!0):!1}(n,e):void Re()}function bI(n,e){const t=n.filters.concat(e);return Ft.create(t,n.op)}function wI(n){return n instanceof wt?function(t){return`${t.field.canonicalString()} ${t.op} ${yl(t.value)}`}(n):n instanceof Ft?function(t){return t.op.toString()+" {"+t.getFilters().map(wI).join(" ,")+"}"}(n):"Filter"}class Z2 extends wt{constructor(e,t,r){super(e,t,r),this.key=Se.fromName(r.referenceValue)}matches(e){const t=Se.comparator(e.key,this.key);return this.matchesComparison(t)}}class eD extends wt{constructor(e,t){super(e,"in",t),this.keys=xI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class tD extends wt{constructor(e,t){super(e,"not-in",t),this.keys=xI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function xI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Se.fromName(r.referenceValue))}class nD extends wt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bc(t)&&_c(t.arrayValue,this.value)}}class II extends wt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&_c(this.value.arrayValue,t)}}class rD extends wt{constructor(e,t){super(e,"not-in",t)}matches(e){if(_c(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!_c(this.value.arrayValue,t)}}class sD extends wt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>_c(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function hm(n,e=null,t=[],r=[],s=null,i=null,o=null){return new iD(n,e,t,r,s,i,o)}function ea(n){const e=Ee(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>dm(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Uc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>yl(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>yl(r)).join(",")),e.ue=t}return e.ue}function jc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!X2(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!_I(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!W0(n.startAt,e.startAt)&&W0(n.endAt,e.endAt)}function vh(n){return Se.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function yh(n,e){return n.filters.filter(t=>t instanceof wt&&t.field.isEqual(e))}function Q0(n,e,t){let r=Gd,s=!0;for(const i of yh(n,e)){let o=Gd,a=!0;switch(i.op){case"<":case"<=":o=J2(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Gd}H0({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];H0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function J0(n,e,t){let r=Ki,s=!0;for(const i of yh(n,e)){let o=Ki,a=!0;switch(i.op){case">=":case">":o=Y2(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ki}K0({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];K0({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function EI(n,e,t,r,s,i,o,a){return new di(n,e,t,r,s,i,o,a)}function $l(n){return new di(n)}function Y0(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Eg(n){return n.collectionGroup!==null}function al(n){const e=Ee(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new jt(rn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new wc(i,r))}),t.has(rn.keyField().canonicalString())||e.ce.push(new wc(rn.keyField(),r))}return e.ce}function cr(n){const e=Ee(n);return e.le||(e.le=AI(e,al(n))),e.le}function TI(n){const e=Ee(n);return e.he||(e.he=AI(e,n.explicitOrderBy)),e.he}function AI(n,e){if(n.limitType==="F")return hm(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new wc(s.field,i)});const t=n.endAt?new so(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new so(n.startAt.position,n.startAt.inclusive):null;return hm(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function fm(n,e){const t=n.filters.concat([e]);return new di(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function _h(n,e,t){return new di(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Bc(n,e){return jc(cr(n),cr(e))&&n.limitType===e.limitType}function SI(n){return`${ea(cr(n))}|lt:${n.limitType}`}function Qa(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>wI(s)).join(", ")}]`),Uc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>yl(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>yl(s)).join(",")),`Target(${r})`}(cr(n))}; limitType=${n.limitType})`}function qc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of al(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=G0(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,al(r),s)||r.endAt&&!function(o,a,l){const c=G0(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,al(r),s))}(n,e)}function PI(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function RI(n){return(e,t)=>{let r=!1;for(const s of al(n)){const i=oD(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function oD(n,e,t){const r=n.field.isKeyField()?Se.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?ro(l,c):Re()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Re()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){fo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return hI(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD=new Gt(Se.comparator);function Dr(){return aD}const CI=new Gt(Se.comparator);function Vu(...n){let e=CI;for(const t of n)e=e.insert(t.key,t);return e}function kI(n){let e=CI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ss(){return Wu()}function DI(){return Wu()}function Wu(){return new hi(n=>n.toString(),(n,e)=>n.isEqual(e))}const lD=new Gt(Se.comparator),uD=new jt(Se.comparator);function it(...n){let e=uD;for(const t of n)e=e.add(t);return e}const cD=new jt(Ye);function Tg(){return cD}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vc(e)?"-0":e}}function NI(n){return{integerValue:""+n}}function OI(n,e){return oI(e)?NI(e):Ag(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af{constructor(){this._=void 0}}function dD(n,e,t){return n instanceof bl?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&rf(i)&&(i=sf(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof ta?MI(n,e):n instanceof na?LI(n,e):function(s,i){const o=VI(s,i),a=X0(o)+X0(s.Pe);return um(o)&&um(s.Pe)?NI(a):Ag(s.serializer,a)}(n,e)}function hD(n,e,t){return n instanceof ta?MI(n,e):n instanceof na?LI(n,e):t}function VI(n,e){return n instanceof wl?function(r){return um(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class bl extends af{}class ta extends af{constructor(e){super(),this.elements=e}}function MI(n,e){const t=$I(e);for(const r of n.elements)t.some(s=>Ns(s,r))||t.push(r);return{arrayValue:{values:t}}}class na extends af{constructor(e){super(),this.elements=e}}function LI(n,e){let t=$I(e);for(const r of n.elements)t=t.filter(s=>!Ns(s,r));return{arrayValue:{values:t}}}class wl extends af{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function X0(n){return nn(n.integerValue||n.doubleValue)}function $I(n){return bc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc{constructor(e,t){this.field=e,this.transform=t}}function fD(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof ta&&s instanceof ta||r instanceof na&&s instanceof na?ml(r.elements,s.elements,Ns):r instanceof wl&&s instanceof wl?Ns(r.Pe,s.Pe):r instanceof bl&&s instanceof bl}(n.transform,e.transform)}class pD{constructor(e,t){this.version=e,this.transformResults=t}}class sn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sn}static exists(e){return new sn(void 0,e)}static updateTime(e){return new sn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Jd(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class lf{}function FI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ul(n.key,sn.none()):new Fl(n.key,n.data,sn.none());{const t=n.data,r=Qn.empty();let s=new jt(rn.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new fi(n.key,r,new kr(s.toArray()),sn.none())}}function mD(n,e,t){n instanceof Fl?function(s,i,o){const a=s.value.clone(),l=e_(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof fi?function(s,i,o){if(!Jd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=e_(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(UI(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Qu(n,e,t,r){return n instanceof Fl?function(i,o,a,l){if(!Jd(i.precondition,o))return a;const c=i.value.clone(),h=t_(i.fieldTransforms,l,o);return c.setAll(h),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof fi?function(i,o,a,l){if(!Jd(i.precondition,o))return a;const c=t_(i.fieldTransforms,l,o),h=o.data;return h.setAll(UI(i)),h.setAll(c),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Jd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function gD(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=VI(r.transform,s||null);i!=null&&(t===null&&(t=Qn.empty()),t.set(r.field,i))}return t||null}function Z0(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ml(r,s,(i,o)=>fD(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Fl extends lf{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class fi extends lf{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function UI(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function e_(n,e,t){const r=new Map;Oe(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,hD(o,a,t[s]))}return r}function t_(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,dD(i,o,e))}return r}class Ul extends lf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Sg extends lf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&mD(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Qu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Qu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=DI();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=FI(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument($e.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),it())}isEqual(e){return this.batchId===e.batchId&&ml(this.mutations,e.mutations,(t,r)=>Z0(t,r))&&ml(this.baseMutations,e.baseMutations,(t,r)=>Z0(t,r))}}class Rg{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Oe(e.mutations.length===r.length);let s=function(){return lD}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Rg(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jI{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kn,Tt;function BI(n){switch(n){default:return Re();case W.CANCELLED:case W.UNKNOWN:case W.DEADLINE_EXCEEDED:case W.RESOURCE_EXHAUSTED:case W.INTERNAL:case W.UNAVAILABLE:case W.UNAUTHENTICATED:return!1;case W.INVALID_ARGUMENT:case W.NOT_FOUND:case W.ALREADY_EXISTS:case W.PERMISSION_DENIED:case W.FAILED_PRECONDITION:case W.ABORTED:case W.OUT_OF_RANGE:case W.UNIMPLEMENTED:case W.DATA_LOSS:return!0}}function qI(n){if(n===void 0)return In("GRPC error has no .code"),W.UNKNOWN;switch(n){case kn.OK:return W.OK;case kn.CANCELLED:return W.CANCELLED;case kn.UNKNOWN:return W.UNKNOWN;case kn.DEADLINE_EXCEEDED:return W.DEADLINE_EXCEEDED;case kn.RESOURCE_EXHAUSTED:return W.RESOURCE_EXHAUSTED;case kn.INTERNAL:return W.INTERNAL;case kn.UNAVAILABLE:return W.UNAVAILABLE;case kn.UNAUTHENTICATED:return W.UNAUTHENTICATED;case kn.INVALID_ARGUMENT:return W.INVALID_ARGUMENT;case kn.NOT_FOUND:return W.NOT_FOUND;case kn.ALREADY_EXISTS:return W.ALREADY_EXISTS;case kn.PERMISSION_DENIED:return W.PERMISSION_DENIED;case kn.FAILED_PRECONDITION:return W.FAILED_PRECONDITION;case kn.ABORTED:return W.ABORTED;case kn.OUT_OF_RANGE:return W.OUT_OF_RANGE;case kn.UNIMPLEMENTED:return W.UNIMPLEMENTED;case kn.DATA_LOSS:return W.DATA_LOSS;default:return Re()}}(Tt=kn||(kn={}))[Tt.OK=0]="OK",Tt[Tt.CANCELLED=1]="CANCELLED",Tt[Tt.UNKNOWN=2]="UNKNOWN",Tt[Tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Tt[Tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Tt[Tt.NOT_FOUND=5]="NOT_FOUND",Tt[Tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Tt[Tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Tt[Tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Tt[Tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Tt[Tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Tt[Tt.ABORTED=10]="ABORTED",Tt[Tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Tt[Tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Tt[Tt.INTERNAL=13]="INTERNAL",Tt[Tt.UNAVAILABLE=14]="UNAVAILABLE",Tt[Tt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bh=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yD=new Ho([4294967295,4294967295],0);function n_(n){const e=zI().encode(n),t=new Hx;return t.update(e),new Uint8Array(t.digest())}function r_(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ho([t,r],0),new Ho([s,i],0)]}class kg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Mu(`Invalid padding: ${t}`);if(r<0)throw new Mu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Mu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Mu(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Ho.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Ho.fromNumber(r)));return s.compare(yD)===1&&(s=new Ho([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=n_(e),[r,s]=r_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new kg(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=n_(e),[r,s]=r_(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Mu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Kc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Hc($e.min(),s,new Gt(Ye),Dr(),it())}}class Kc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Kc(r,t,it(),it(),it())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class HI{constructor(e,t){this.targetId=e,this.me=t}}class KI{constructor(e,t,r=mn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class s_{constructor(){this.fe=0,this.ge=o_(),this.pe=mn.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=it(),t=it(),r=it();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Re()}}),new Kc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=o_()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Oe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class _D{constructor(e){this.Le=e,this.Be=new Map,this.ke=Dr(),this.qe=i_(),this.Qe=new Gt(Ye)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Re()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(vh(i))if(r===0){const o=new Se(i.path);this.Ue(t,o,Yt.newNoDocument(o,$e.min()))}else Oe(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}bh==null||bh.et(function(h,f,m,v,w){var x,I,O,L,U,q;const te={localCacheCount:h,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},X=f.unchangedNames;return X&&(te.bloomFilter={applied:w===0,hashCount:(x=X==null?void 0:X.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(L=(O=(I=X==null?void 0:X.bits)===null||I===void 0?void 0:I.bitmap)===null||O===void 0?void 0:O.length)!==null&&L!==void 0?L:0,padding:(q=(U=X==null?void 0:X.bits)===null||U===void 0?void 0:U.padding)!==null&&q!==void 0?q:0,mightContain:A=>{var _;return(_=v==null?void 0:v.mightContain(A))!==null&&_!==void 0&&_}}),te}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=ii(r).toUint8Array()}catch(l){if(l instanceof fI)return es("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new kg(o,s,i)}catch(l){return es(l instanceof Mu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&vh(a.target)){const l=new Se(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Yt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=it();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Hc(e,t,this.Qe,this.ke,r);return this.ke=Dr(),this.qe=i_(),this.Qe=new Gt(Ye),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new s_,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new jt(Ye),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||ce("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new s_),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function i_(){return new Gt(Se.comparator)}function o_(){return new Gt(Se.comparator)}const bD=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),wD=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),xD=(()=>({and:"AND",or:"OR"}))();class ID{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pm(n,e){return n.useProto3Json||Uc(e)?e:{value:e}}function xl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function GI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ED(n,e){return xl(n,e.toTimestamp())}function An(n){return Oe(!!n),$e.fromTimestamp(function(t){const r=si(t);return new dn(r.seconds,r.nanos)}(n))}function Dg(n,e){return mm(n,e).canonicalString()}function mm(n,e){const t=function(s){return new bt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function WI(n){const e=bt.fromString(n);return Oe(sE(e)),e}function xc(n,e){return Dg(n.databaseId,e.path)}function ks(n,e){const t=WI(e);if(t.get(1)!==n.databaseId.projectId)throw new de(W.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new de(W.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Se(YI(t))}function QI(n,e){return Dg(n.databaseId,e)}function JI(n){const e=WI(n);return e.length===4?bt.emptyPath():YI(e)}function gm(n){return new bt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function YI(n){return Oe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function a_(n,e,t){return{name:xc(n,e),fields:t.value.mapValue.fields}}function XI(n,e,t){const r=ks(n,e.name),s=An(e.updateTime),i=e.createTime?An(e.createTime):$e.min(),o=new Qn({mapValue:{fields:e.fields}}),a=Yt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function TD(n,e){return"found"in e?function(r,s){Oe(!!s.found),s.found.name,s.found.updateTime;const i=ks(r,s.found.name),o=An(s.found.updateTime),a=s.found.createTime?An(s.found.createTime):$e.min(),l=new Qn({mapValue:{fields:s.found.fields}});return Yt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Oe(!!s.missing),Oe(!!s.readTime);const i=ks(r,s.missing),o=An(s.readTime);return Yt.newNoDocument(i,o)}(n,e):Re()}function AD(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Re()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,h){return c.useProto3Json?(Oe(h===void 0||typeof h=="string"),mn.fromBase64String(h||"")):(Oe(h===void 0||h instanceof Buffer||h instanceof Uint8Array),mn.fromUint8Array(h||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const h=c.code===void 0?W.UNKNOWN:qI(c.code);return new de(h,c.message||"")}(o);t=new KI(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ks(n,r.document.name),i=An(r.document.updateTime),o=r.document.createTime?An(r.document.createTime):$e.min(),a=new Qn({mapValue:{fields:r.document.fields}}),l=Yt.newFoundDocument(s,i,o,a),c=r.targetIds||[],h=r.removedTargetIds||[];t=new Yd(c,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ks(n,r.document),i=r.readTime?An(r.readTime):$e.min(),o=Yt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Yd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ks(n,r.document),i=r.removedTargetIds||[];t=new Yd([],i,s,null)}else{if(!("filter"in e))return Re();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new vD(s,i),a=r.targetId;t=new HI(a,o)}}return t}function Ic(n,e){let t;if(e instanceof Fl)t={update:a_(n,e.key,e.value)};else if(e instanceof Ul)t={delete:xc(n,e.key)};else if(e instanceof fi)t={update:a_(n,e.key,e.data),updateMask:DD(e.fieldMask)};else{if(!(e instanceof Sg))return Re();t={verify:xc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof bl)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ta)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof na)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof wl)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Re()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:ED(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Re()}(n,e.precondition)),t}function vm(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?sn.updateTime(An(i.updateTime)):i.exists!==void 0?sn.exists(i.exists):sn.none()}(e.currentDocument):sn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Oe(a.setToServerValue==="REQUEST_TIME"),l=new bl;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];l=new ta(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];l=new na(h)}else"increment"in a?l=new wl(o,a.increment):Re();const c=rn.fromServerFormat(a.fieldPath);return new zc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=ks(n,e.update.name),i=new Qn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new kr(c.map(h=>rn.fromServerFormat(h)))}(e.updateMask);return new fi(s,i,o,t,r)}return new Fl(s,i,t,r)}if(e.delete){const s=ks(n,e.delete);return new Ul(s,t)}if(e.verify){const s=ks(n,e.verify);return new Sg(s,t)}return Re()}function SD(n,e){return n&&n.length>0?(Oe(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?An(s.updateTime):An(i);return o.isEqual($e.min())&&(o=An(i)),new pD(o,s.transformResults||[])}(t,e))):[]}function ZI(n,e){return{documents:[QI(n,e.path)]}}function uf(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=QI(n,s);const i=function(c){if(c.length!==0)return rE(Ft.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(h=>function(m){return{field:Li(m.field),direction:RD(m.dir)}}(h))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=pm(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function eE(n,e,t,r){const{_t:s,parent:i}=uf(n,e),o={},a=[];let l=0;return t.forEach(c=>{const h=r?c.alias:"aggregate_"+l++;o[h]=c.alias,c.aggregateType==="count"?a.push({alias:h,count:{}}):c.aggregateType==="avg"?a.push({alias:h,avg:{field:Li(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:h,sum:{field:Li(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function tE(n){let e=JI(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Oe(r===1);const h=t.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];t.where&&(i=function(f){const m=nE(f);return m instanceof Ft&&Ig(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(w){return new wc(Ja(w.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Uc(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){const m=!!f.before,v=f.values||[];return new so(v,m)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const m=!f.before,v=f.values||[];return new so(v,m)}(t.endAt)),EI(e,s,o,i,a,"F",l,c)}function PD(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Re()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function nE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ja(t.unaryFilter.field);return wt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ja(t.unaryFilter.field);return wt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ja(t.unaryFilter.field);return wt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ja(t.unaryFilter.field);return wt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Re()}}(n):n.fieldFilter!==void 0?function(t){return wt.create(Ja(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Re()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ft.create(t.compositeFilter.filters.map(r=>nE(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Re()}}(t.compositeFilter.op))}(n):Re()}function RD(n){return bD[n]}function CD(n){return wD[n]}function kD(n){return xD[n]}function Li(n){return{fieldPath:n.canonicalString()}}function Ja(n){return rn.fromServerFormat(n.fieldPath)}function rE(n){return n instanceof wt?function(t){if(t.op==="=="){if(z0(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NAN"}};if(q0(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(z0(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NOT_NAN"}};if(q0(t.value))return{unaryFilter:{field:Li(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Li(t.field),op:CD(t.op),value:t.value}}}(n):n instanceof Ft?function(t){const r=t.getFilters().map(s=>rE(s));return r.length===1?r[0]:{compositeFilter:{op:kD(t.op),filters:r}}}(n):Re()}function DD(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function sE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e,t,r,s,i=$e.min(),o=$e.min(),a=mn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Hs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Hs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Hs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Hs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iE{constructor(e){this.ct=e}}function ND(n,e){let t;if(e.document)t=XI(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Se.fromSegments(e.noDocument.path),s=sa(e.noDocument.readTime);t=Yt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Re();{const r=Se.fromSegments(e.unknownDocument.path),s=sa(e.unknownDocument.version);t=Yt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new dn(s[0],s[1]);return $e.fromTimestamp(i)}(e.readTime)),t}function l_(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:wh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:xc(i,o.key),fields:o.data.value.mapValue.fields,updateTime:xl(i,o.version.toTimestamp()),createTime:xl(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ra(e.version)};else{if(!e.isUnknownDocument())return Re();r.unknownDocument={path:t.path.toArray(),version:ra(e.version)}}return r}function wh(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ra(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function sa(n){const e=new dn(n.seconds,n.nanoseconds);return $e.fromTimestamp(e)}function $o(n,e){const t=(e.baseMutations||[]).map(i=>vm(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>vm(n.ct,i)),s=dn.fromMillis(e.localWriteTimeMs);return new Pg(e.batchId,s,t,r)}function Lu(n){const e=sa(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?sa(n.lastLimboFreeSnapshotVersion):$e.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Oe(i.documents.length===1),cr($l(JI(i.documents[0])))}(n.query):function(i){return cr(tE(i))}(n.query),new Hs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,mn.fromBase64String(n.resumeToken))}function oE(n,e){const t=ra(e.snapshotVersion),r=ra(e.lastLimboFreeSnapshotVersion);let s;s=vh(e.target)?ZI(n.ct,e.target):uf(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ea(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Ng(n){const e=tE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_h(e,e.limit,"L"):e}function Tp(n,e){return new Cg(e.largestBatchId,vm(n.ct,e.overlayMutation))}function u_(n,e){const t=e.path.lastSegment();return[n,ur(e.path.popLast()),t]}function c_(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ra(r.readTime),documentKey:ur(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{getBundleMetadata(e,t){return d_(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:sa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return d_(e).put(function(s){return{bundleId:s.id,createTime:ra(An(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return h_(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Ng(i.bundledQuery),readTime:sa(i.readTime)}}(r)})}saveNamedQuery(e,t){return h_(e).put(function(s){return{name:s.name,readTime:ra(An(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function d_(n){return $n(n,"bundles")}function h_(n){return $n(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new cf(e,r)}getOverlay(e,t){return xu(e).get(u_(this.userId,t)).next(r=>r?Tp(this.serializer,r):null)}getOverlays(e,t){const r=Ss();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Cg(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(ur(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(xu(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Ss(),i=ur(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return xu(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Tp(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Ss();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return xu(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,h)=>{const f=Tp(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}ht(e,t){return xu(e).put(function(s,i,o){const[a,l,c]=u_(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ic(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function xu(n){return $n(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VD{Pt(e){return $n(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?mn.fromUint8Array(r):mn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(nn(e.integerValue));else if("doubleValue"in e){const r=nn(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),vc(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=si(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(ii(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?pI(e)?this.dt(t,Number.MAX_SAFE_INTEGER):of(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Re()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(nn(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Se.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Fo.vt=new Fo;function MD(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function f_(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=MD(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class LD{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=f_(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=f_(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class $D{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class FD{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Iu{constructor(){this.jt=new LD,this.Ht=new $D(this.jt),this.Jt=new FD(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Uo(this.indexId,this.documentKey,this.arrayValue,r)}}function Pi(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=p_(n.arrayValue,e.arrayValue),t!==0?t:(t=p_(n.directionalValue,e.directionalValue),t!==0?t:Se.comparator(n.documentKey,e.documentKey)))}function p_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m_{constructor(e){this.Xt=new jt((t,r)=>rn.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Oe(e.collectionGroup===this.collectionId),this.nn)return!1;const t=om(e);if(t!==void 0&&!this.sn(t))return!1;const r=No(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new jt(rn.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ko(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ko(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ko(r.field,r.dir==="asc"?0:1)));return new gl(gl.UNKNOWN_ID,this.collectionId,t,vl.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aE(n){var e,t;if(Oe(n instanceof wt||n instanceof Ft),n instanceof wt){if(n instanceof II){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>wt.create(n.field,"==",i)))||[];return Ft.create(s,"or")}return n}const r=n.filters.map(s=>aE(s));return Ft.create(r,n.op)}function UD(n){if(n.getFilters().length===0)return[];const e=bm(aE(n));return Oe(lE(e)),ym(e)||_m(e)?[e]:e.getFilters()}function ym(n){return n instanceof wt}function _m(n){return n instanceof Ft&&Ig(n)}function lE(n){return ym(n)||_m(n)||function(t){if(t instanceof Ft&&cm(t)){for(const r of t.getFilters())if(!ym(r)&&!_m(r))return!1;return!0}return!1}(n)}function bm(n){if(Oe(n instanceof wt||n instanceof Ft),n instanceof wt)return n;if(n.filters.length===1)return bm(n.filters[0]);const e=n.filters.map(r=>bm(r));let t=Ft.create(e,n.op);return t=xh(t),lE(t)?t:(Oe(t instanceof Ft),Oe(_l(t)),Oe(t.filters.length>1),t.filters.reduce((r,s)=>Og(r,s)))}function Og(n,e){let t;return Oe(n instanceof wt||n instanceof Ft),Oe(e instanceof wt||e instanceof Ft),t=n instanceof wt?e instanceof wt?function(s,i){return Ft.create([s,i],"and")}(n,e):g_(n,e):e instanceof wt?g_(e,n):function(s,i){if(Oe(s.filters.length>0&&i.filters.length>0),_l(s)&&_l(i))return bI(s,i.getFilters());const o=cm(s)?s:i,a=cm(s)?i:s,l=o.filters.map(c=>Og(c,a));return Ft.create(l,"or")}(n,e),xh(t)}function g_(n,e){if(_l(e))return bI(e,n.getFilters());{const t=e.filters.map(r=>Og(n,r));return Ft.create(t,"or")}}function xh(n){if(Oe(n instanceof wt||n instanceof Ft),n instanceof wt)return n;const e=n.getFilters();if(e.length===1)return xh(e[0]);if(yI(n))return n;const t=e.map(s=>xh(s)),r=[];return t.forEach(s=>{s instanceof wt?r.push(s):s instanceof Ft&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ft.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(){this.un=new Vg}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(Hr.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(Hr.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class Vg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new jt(bt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new jt(bt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd=new Uint8Array(0);class BD{constructor(e,t){this.databaseId=t,this.cn=new Vg,this.ln=new hi(r=>ea(r),(r,s)=>jc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:ur(s)};return v_(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[eI(t),""],!1,!0);return v_(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(As(o.parent))}return r})}addFieldIndex(e,t){const r=Eu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ha(e);return i.next(a=>{o.put(c_(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Eu(e),s=Ha(e),i=za(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Eu(e),r=za(e),s=Ha(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new m_(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=za(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=it();const a=[];return z.forEach(i,(l,c)=>{ce("IndexedDbIndexManager",`Using index ${function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(q=>`${q.fieldPath}:${q.kind}`).join(",")}`}(l)} to execute ${ea(t)}`);const h=function(U,q){const te=om(q);if(te===void 0)return null;for(const X of yh(U,te.fieldPath))switch(X.op){case"array-contains-any":return X.value.arrayValue.values||[];case"array-contains":return[X.value]}return null}(c,l),f=function(U,q){const te=new Map;for(const X of No(q))for(const A of yh(U,X.fieldPath))switch(A.op){case"==":case"in":te.set(X.fieldPath.canonicalString(),A.value);break;case"not-in":case"!=":return te.set(X.fieldPath.canonicalString(),A.value),Array.from(te.values())}return null}(c,l),m=function(U,q){const te=[];let X=!0;for(const A of No(q)){const _=A.kind===0?Q0(U,A.fieldPath,U.startAt):J0(U,A.fieldPath,U.startAt);te.push(_.value),X&&(X=_.inclusive)}return new so(te,X)}(c,l),v=function(U,q){const te=[];let X=!0;for(const A of No(q)){const _=A.kind===0?J0(U,A.fieldPath,U.endAt):Q0(U,A.fieldPath,U.endAt);te.push(_.value),X&&(X=_.inclusive)}return new so(te,X)}(c,l),w=this.In(l,c,m),x=this.In(l,c,v),I=this.Tn(l,c,f),O=this.En(l.indexId,h,w,m.inclusive,x,v.inclusive,I);return z.forEach(O,L=>r.G(L,t.limit).next(U=>{U.forEach(q=>{const te=Se.fromSegments(q.documentKey);o.has(te)||(o=o.add(te),a.push(te))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=UD(Ft.create(e.filters,"and")).map(r=>hm(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),h=[];for(let f=0;f<l;++f){const m=t?this.dn(t[f/c]):Pd,v=this.An(e,m,r[f%c],s),w=this.Rn(e,m,i[f%c],o),x=a.map(I=>this.An(e,m,I,!0));h.push(...this.createRange(v,w,x))}return h}An(e,t,r,s){const i=new Uo(e,Se.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Uo(e,Se.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new m_(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new jt(rn.comparator),h=!1;for(const f of l.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:c=c.add(m.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Iu;for(const s of No(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Fo.vt.It(i,o)}return r.zt()}dn(e){const t=new Iu;return Fo.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Iu;return Fo.vt.It(Zo(this.databaseId,t),r.Yt(function(i){const o=No(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Iu);let i=0;for(const o of No(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&bc(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Fo.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Iu;l.seed(a.zt()),Fo.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof wt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Eu(e),s=Ha(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(h,f){const m=f?new vl(f.sequenceNumber,new Hr(sa(f.readTime),new Se(As(f.documentKey)),f.largestBatchId)):vl.empty(),v=h.fields.map(([w,x])=>new Ko(rn.fromServerFormat(w),x));return new gl(h.indexId,h.collectionGroup,v,m)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ye(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Eu(e),i=Ha(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(c_(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const h=this.Sn(i,l);return c.isEqual(h)?z.resolve():this.bn(e,i,l,c,h)}))))})}Dn(e,t,r,s){return za(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return za(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=za(e);let i=new jt(Pi);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Uo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new jt(Pi);const s=this.Vn(t,e);if(s==null)return r;const i=om(t);if(i!=null){const o=e.data.field(i.fieldPath);if(bc(o))for(const a of o.arrayValue.values||[])r=r.add(new Uo(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Uo(t.indexId,e.key,Pd,s));return r}bn(e,t,r,s,i){ce("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,h,f,m){const v=l.getIterator(),w=c.getIterator();let x=qa(v),I=qa(w);for(;x||I;){let O=!1,L=!1;if(x&&I){const U=h(x,I);U<0?L=!0:U>0&&(O=!0)}else x!=null?L=!0:O=!0;O?(f(I),I=qa(w)):L?(m(x),x=qa(v)):(x=qa(v),I=qa(w))}}(s,i,Pi,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return Ha(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Pi(o,a)).filter((o,a,l)=>!a||Pi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Pi(o,e),l=Pi(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Pd,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Pd,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Pi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(y_)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Re())).next(y_)}}function v_(n){return $n(n,"collectionParents")}function za(n){return $n(n,"indexEntries")}function Eu(n){return $n(n,"indexConfiguration")}function Ha(n){return $n(n,"indexState")}function y_(n){Oe(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;bg(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Hr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const __={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sr{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new sr(e,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uE(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(h,f,m)=>(a++,m.delete()));i.push(l.next(()=>{Oe(a===1)}));const c=[];for(const h of t.mutations){const f=aI(e,h.key.path,t.batchId);i.push(s.delete(f)),c.push(h.key)}return z.waitFor(i).next(()=>c)}function Ih(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Re();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sr.DEFAULT_COLLECTION_PERCENTILE=10,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sr.DEFAULT=new sr(41943040,sr.DEFAULT_COLLECTION_PERCENTILE,sr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sr.DISABLED=new sr(-1,0,0);class df{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Oe(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new df(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ri(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ya(e),o=Ri(e);return o.add({}).next(a=>{Oe(typeof a=="number");const l=new Pg(a,t,r,s),c=function(v,w,x){const I=x.baseMutations.map(L=>Ic(v.ct,L)),O=x.mutations.map(L=>Ic(v.ct,L));return{userId:w,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:I,mutations:O}}(this.serializer,this.userId,l),h=[];let f=new jt((m,v)=>Ye(m.canonicalString(),v.canonicalString()));for(const m of s){const v=aI(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(c)),h.push(i.put(v,C2))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(h).next(()=>l)})}lookupMutationBatch(e,t){return Ri(e).get(t).next(r=>r?(Oe(r.userId===this.userId),$o(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Ri(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Oe(a.batchId>=r),i=$o(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Ri(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ri(e).U("userMutationsIndex",t).next(r=>r.map(s=>$o(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Kd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ya(e).J({range:s},(o,a,l)=>{const[c,h,f]=o,m=As(h);if(c===this.userId&&t.path.isEqual(m))return Ri(e).get(f).next(v=>{if(!v)throw Re();Oe(v.userId===this.userId),i.push($o(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new jt(Ye);const s=[];return t.forEach(i=>{const o=Kd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ya(e).J({range:a},(c,h,f)=>{const[m,v,w]=c,x=As(v);m===this.userId&&i.path.isEqual(x)?r=r.add(w):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Kd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new jt(Ye);return Ya(e).J({range:o},(l,c,h)=>{const[f,m,v]=l,w=As(m);f===this.userId&&r.isPrefixOf(w)?w.length===s&&(a=a.add(v)):h.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Ri(e).get(i).next(o=>{if(o===null)throw Re();Oe(o.userId===this.userId),r.push($o(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return uE(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ya(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=As(i[1]);s.push(l)}else a.done()}).next(()=>{Oe(s.length===0)})})}containsKey(e,t){return cE(e,this.userId,t)}Nn(e){return dE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function cE(n,e,t){const r=Kd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ya(n).J({range:i,H:!0},(a,l,c)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Ri(n){return $n(n,"mutations")}function Ya(n){return $n(n,"documentMutations")}function dE(n){return $n(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ia(0)}static kn(){return new ia(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new ia(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>$e.fromTimestamp(new dn(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ka(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Oe(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Ka(e).J((o,a)=>{const l=Lu(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Ka(e).J((r,s)=>{const i=Lu(s);t(i)})}qn(e){return b_(e).get("targetGlobalKey").next(t=>(Oe(t!==null),t))}Qn(e,t){return b_(e).put("targetGlobalKey",t)}Kn(e,t){return Ka(e).put(oE(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=ea(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ka(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Lu(a);jc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=$i(e);return t.forEach(o=>{const a=ur(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=$i(e);return z.forEach(t,i=>{const o=ur(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=$i(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=$i(e);let i=it();return s.J({range:r,H:!0},(o,a,l)=>{const c=As(o[1]),h=new Se(c);i=i.add(h)}).next(()=>i)}containsKey(e,t){const r=ur(t.path),s=IDBKeyRange.bound([r],[eI(r)],!1,!0);let i=0;return $i(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Ka(e).get(t).next(r=>r?Lu(r):null)}}function Ka(n){return $n(n,"targets")}function b_(n){return $n(n,"targetGlobal")}function $i(n){return $n(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w_([n,e],[t,r]){const s=Ye(n,t);return s===0?Ye(e,r):s}class zD{constructor(e){this.Un=e,this.buffer=new jt(w_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();w_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class hE{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){ce("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ho(t)?ce("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await co(t)}await this.Hn(3e5)})}}class HD{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(Cr.oe);const r=new zD(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ce("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve(__)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ce("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),__):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(ce("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Wa()<=_t.DEBUG&&ce("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-h}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function fE(n,e){return new HD(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(e,t){this.db=e,this.garbageCollector=fE(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Rd(e,r)}removeReference(e,t,r){return Rd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Rd(e,t)}nr(e,t){return function(s,i){let o=!1;return dE(s).Y(a=>cE(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,$e.min()),$i(e).delete(function(f){return[0,ur(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Rd(e,t)}tr(e,t){const r=$i(e);let s,i=Cr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Cr.oe&&t(new Se(As(s)),i),i=c,s=l):i=Cr.oe}).next(()=>{i!==Cr.oe&&t(new Se(As(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Rd(n,e){return $i(n).put(function(r,s){return{targetId:0,path:ur(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pE{constructor(){this.changes=new hi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Yt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Co(e).put(r)}removeEntry(e,t,r){return Co(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],wh(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Yt.newInvalidDocument(t);return Co(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Tu(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Yt.newInvalidDocument(t)};return Co(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Tu(t))},(s,i)=>{r={document:this.ir(t,i),size:Ih(i)}}).next(()=>r)}getEntries(e,t){let r=Dr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Dr(),s=new Gt(Se.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Ih(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new jt(E_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Tu(s.first()),Tu(s.last())),o=s.getIterator();let a=o.getNext();return Co(e).J({index:"documentKeyIndex",range:i},(l,c,h)=>{const f=Se.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&E_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?h.$(Tu(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),wh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Co(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let h=Dr();for(const f of c){const m=this.ir(Se.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(qc(t,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,t,r,s){let i=Dr();const o=I_(t,r),a=I_(t,Hr.max());return Co(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,h)=>{const f=this.ir(Se.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new WD(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return x_(e).get("remoteDocumentGlobalKey").next(t=>(Oe(!!t),t))}rr(e,t){return x_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=ND(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual($e.min())))return r}return Yt.newInvalidDocument(e)}}function mE(n){return new GD(n)}class WD extends pE{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new hi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new jt((i,o)=>Ye(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=l_(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Ih(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=l_(this.cr.serializer,o.convertToNoDocument($e.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function x_(n){return $n(n,"remoteDocumentGlobal")}function Co(n){return $n(n,"remoteDocumentsV14")}function Tu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function I_(n,e){const t=e.documentKey.path.toArray();return[n,wh(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function E_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ye(t[i],r[i]),s)return s;return s=Ye(t.length,r.length),s||(s=Ye(t[t.length-2],r[r.length-2]),s||Ye(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gE{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Qu(r.mutation,s,kr.empty(),dn.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,it()).next(()=>r))}getLocalViewOfDocuments(e,t,r=it()){const s=Ss();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Vu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ss();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,it()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Dr();const o=Wu(),a=function(){return Wu()}();return t.forEach((l,c)=>{const h=r.get(c.key);s.has(c.key)&&(h===void 0||h.mutation instanceof fi)?i=i.insert(c.key,c):h!==void 0?(o.set(c.key,h.mutation.getFieldMask()),Qu(h.mutation,c,h.mutation.getFieldMask(),dn.now())):o.set(c.key,kr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,h)=>o.set(c,h)),t.forEach((c,h)=>{var f;return a.set(c,new QD(h,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Wu();let s=new Gt((o,a)=>o-a),i=it();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let h=r.get(l)||kr.empty();h=a.applyToLocalView(c,h),r.set(l,h);const f=(s.get(a.batchId)||it()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,h=l.value,f=DI();h.forEach(m=>{if(!i.has(m)){const v=FI(t.get(m),r.get(m));v!==null&&f.set(m,v),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Eg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(Ss());let a=-1,l=i;return o.next(c=>z.forEach(c,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?z.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{l=l.insert(h,m)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,it())).next(h=>({batchId:a,changes:kI(h)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Se(t)).next(r=>{let s=Vu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Vu();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,m){return new di(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const h=c.getKey();o.get(h)===null&&(o=o.insert(h,Yt.newInvalidDocument(h)))});let a=Vu();return o.forEach((l,c)=>{const h=i.get(l);h!==void 0&&Qu(h.mutation,c,kr.empty(),dn.now()),qc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:An(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Ng(s.bundledQuery),readTime:An(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YD{constructor(){this.overlays=new Gt(Se.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ss();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=Ss(),i=t.length+1,o=new Se(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Gt((c,h)=>c-h);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let h=i.get(c.largestBatchId);h===null&&(h=Ss(),i=i.insert(c.largestBatchId,h)),h.set(c.getKey(),c)}}const a=Ss(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,h)=>a.set(c,h)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Cg(t,r));let i=this.Ir.get(t);i===void 0&&(i=it(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XD{constructor(){this.sessionToken=mn.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mg{constructor(){this.Tr=new jt(Un.Er),this.dr=new jt(Un.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Un(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Un(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Se(new bt([])),r=new Un(t,e),s=new Un(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Se(new bt([])),r=new Un(t,e),s=new Un(t,e+1);let i=it();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Un(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Un{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Se.comparator(e.key,t.key)||Ye(e.wr,t.wr)}static Ar(e,t){return Ye(e.wr,t.wr)||Se.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new jt(Un.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Pg(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new Un(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Un(t,0),s=new Un(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new jt(Ye);return t.forEach(s=>{const i=new Un(s,0),o=new Un(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Se.isDocumentKey(i)||(i=i.child(""));const o=new Un(new Se(i),0);let a=new jt(Ye);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Oe(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new Un(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Un(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(e){this.Mr=e,this.docs=function(){return new Gt(Se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():Yt.newInvalidDocument(t))}getEntries(e,t){let r=Dr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Yt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Dr();const o=t.path,a=new Se(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:h}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||bg(nI(h),r)<=0||(s.has(h.key)||qc(t,h))&&(i=i.insert(h.key,h.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Re()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new tN(this)}getSize(e){return z.resolve(this.size)}}class tN extends pE{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(e){this.persistence=e,this.Nr=new hi(t=>ea(t),jc),this.lastRemoteSnapshotVersion=$e.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Mg,this.targetCount=0,this.kr=ia.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new ia(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Cr(0),this.Kr=!1,this.Kr=!0,this.$r=new XD,this.referenceDelegate=e(this),this.Ur=new nN(this),this.indexManager=new jD,this.remoteDocumentCache=function(s){return new eN(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new iE(t),this.Gr=new JD(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new YD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new ZD(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){ce("MemoryPersistence","Starting transaction:",e);const s=new rN(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class rN extends sI{constructor(e){super(),this.currentSequenceNumber=e}}class hf{constructor(e){this.persistence=e,this.Jr=new Mg,this.Yr=null}static Zr(e){return new hf(e)}get Xr(){if(this.Yr)return this.Yr;throw Re()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=Se.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,$e.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Eh{constructor(e,t){this.persistence=e,this.ti=new hi(r=>ur(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=fE(this,t)}static Zr(e,t){return new Eh(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,$e.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Wd(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sN{constructor(e){this.serializer=e}O(e,t,r,s){const i=new nf("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$0,{unique:!0}),l.createObjectStore("documentMutations")}(e),T_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),T_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$e.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(h=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",$0,{unique:!0});const f=c.store("mutations"),m=h.map(v=>f.put(v));return z.waitFor(m)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:B2});c.createIndex("collectionPathOverlayIndex",q2,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",z2,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:k2});c.createIndex("documentKeyIndex",D2),c.createIndex("collectionGroupIndex",N2)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:$2}).createIndex("sequenceNumberIndex",F2,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:U2}).createIndex("documentKeyIndex",j2,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Ih(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{Oe(l.userId===i.userId);const c=$o(this.serializer,l);return uE(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new bt(o),c=function(f){return[0,ur(f)]}(l);i.push(t.get(c).next(h=>h?z.resolve():(f=>t.put({targetId:0,path:ur(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:L2});const r=t.store("collectionParents"),s=new Vg,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:ur(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new bt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const h=As(a);return i(h.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Lu(s),o=oE(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Se(bt.fromString(f.document.name).popFirst(5)):f.noDocument?Se.fromSegments(f.noDocument.path):f.unknownDocument?Se.fromSegments(f.unknownDocument.path):Re()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=mE(this.serializer),i=new Lg(hf.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let h=(c=a.get(l.userId))!==null&&c!==void 0?c:it();$o(this.serializer,l).keys().forEach(f=>h=h.add(f)),a.set(l.userId,h)}),z.forEach(a,(l,c)=>{const h=new jn(c),f=cf.lt(this.serializer,h),m=i.getIndexManager(h),v=df.lt(h,this.serializer,m,i.referenceDelegate);return new gE(s,v,f,m).recalculateAndSaveOverlaysForDocumentKeys(new am(t,Cr.oe),l).next()})})}}function T_(n){n.createObjectStore("targetDocuments",{keyPath:V2}).createIndex("documentTargetsIndex",M2,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",O2,{unique:!0}),n.createObjectStore("targetGlobal")}const Ap="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class $g{constructor(e,t,r,s,i,o,a,l,c,h,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=h,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!$g.D())throw new de(W.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new KD(this,s),this.Ai=t+"main",this.serializer=new iE(l),this.Ri=new Cs(this.Ai,this.hi,new sN(this.serializer)),this.$r=new VD,this.Ur=new qD(this.referenceDelegate,this.serializer),this.remoteDocumentCache=mE(this.serializer),this.Gr=new OD,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,h===!1&&In("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new de(W.FAILED_PRECONDITION,Ap);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Cr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Cd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ho(e))return ce("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ce("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Au(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return Cd(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=$n(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):Au(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new de(W.FAILED_PRECONDITION,Ap);return!1}}return!(!this.networkEnabled||!this.inForeground)||Cd(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ce("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new am(e,Cr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Cd(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return df.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new BD(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return cf.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){ce("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?G2:l===16?K2:l===15?xg:l===14?cI:l===13?uI:l===12?H2:l===11?lI:void Re()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new am(a,this.Qr?this.Qr.next():Cr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw In(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new de(W.FAILED_PRECONDITION,rI);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Au(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new de(W.FAILED_PRECONDITION,Ap)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Au(e).put("owner",t)}static D(){return Cs.D()}bi(e){const t=Au(e);return t.get("owner").next(r=>this.vi(r)?(ce("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(In(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;hx()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return ce("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return In("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){In("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Au(n){return $n(n,"owner")}function Cd(n){return $n(n,"clientMetadata")}function Fg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=it(),s=it();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Ug(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vE{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return hx()?8:iI(Ln())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new iN;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Wa()<=_t.DEBUG&&ce("QueryEngine","SDK will not create cache indexes for query:",Qa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(Wa()<=_t.DEBUG&&ce("QueryEngine","Query:",Qa(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Wa()<=_t.DEBUG&&ce("QueryEngine","The SDK decides to create cache indexes for query:",Qa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,cr(t))):z.resolve())}Yi(e,t){if(Y0(t))return z.resolve(null);let r=cr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=_h(t,null,"F"),r=cr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=it(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,_h(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Y0(t)||s.isEqual($e.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(Wa()<=_t.DEBUG&&ce("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Qa(t)),this.rs(e,o,t,tI(s,-1)).next(a=>a))})}ts(e,t){let r=new jt(RI(e));return t.forEach((s,i)=>{qc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Wa()<=_t.DEBUG&&ce("QueryEngine","Using full collection scan to execute query:",Qa(t)),this.Ji.getDocumentsMatchingQuery(e,t,Hr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oN{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Gt(Ye),this._s=new hi(i=>ea(i),jc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gE(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function yE(n,e,t,r){return new oN(n,e,t,r)}async function _E(n,e){const t=Ee(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=it();for(const c of s){o.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}for(const c of i){a.push(c.batchId);for(const h of c.mutations)l=l.add(h.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function aN(n,e){const t=Ee(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,h){const f=c.batch,m=f.keys();let v=z.resolve();return m.forEach(w=>{v=v.next(()=>h.getEntry(l,w)).next(x=>{const I=c.docVersions.get(w);Oe(I!==null),x.version.compareTo(I)<0&&(f.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),h.addEntry(x)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=it();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function bE(n){const e=Ee(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function lN(n,e){const t=Ee(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(i,h.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,h.addedDocuments,f)));let v=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?v=v.withResumeToken(mn.EMPTY_BYTE_STRING,$e.min()).withLastLimboFreeSnapshotVersion($e.min()):h.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(h.resumeToken,r)),s=s.insert(f,v),function(x,I,O){return x.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(m,v,h)&&a.push(t.Ur.updateTargetData(i,v))});let l=Dr(),c=it();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(wE(i,o,e.documentUpdates).next(h=>{l=h.Ps,c=h.Is})),!r.isEqual($e.min())){const h=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function wE(n,e,t){let r=it(),s=it();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Dr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual($e.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ce("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function uN(n,e){const t=Ee(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Il(n,e){const t=Ee(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Hs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function El(n,e,t){const r=Ee(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!ho(o))throw o;ce("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Th(n,e,t){const r=Ee(n);let s=$e.min(),i=it();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,h){const f=Ee(l),m=f._s.get(h);return m!==void 0?z.resolve(f.os.get(m)):f.Ur.getTargetData(c,h)}(r,o,cr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:$e.min(),t?i:it())).next(a=>(EE(r,PI(e),a),{documents:a,Ts:i})))}function xE(n,e){const t=Ee(n),r=Ee(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function IE(n,e){const t=Ee(n),r=t.us.get(e)||$e.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,tI(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(EE(t,e,s),s))}function EE(n,e,t){let r=n.us.get(e)||$e.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function cN(n,e,t,r){const s=Ee(n);let i=it(),o=Dr();for(const c of t){const h=e.Es(c.metadata.name);c.document&&(i=i.add(h));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(h,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Il(s,function(h){return cr($l(bt.fromString(`__bundle__/docs/${h}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>wE(c,a,o).next(h=>(a.apply(c),h)).next(h=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,h.Ps,h.Is)).next(()=>h.Ps)))}async function dN(n,e,t=it()){const r=await Il(n,cr(Ng(e.bundledQuery))),s=Ee(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=An(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(mn.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function A_(n,e){return`firestore_clients_${n}_${e}`}function S_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Sp(n,e){return`firestore_targets_${n}_${e}`}class Ah{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new de(s.error.code,s.error.message))),o?new Ah(e,t,s.state,i):(In("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ju{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new de(r.error.code,r.error.message))),i?new Ju(e,r.state,s):(In("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Sh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Tg();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=oI(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Sh(e,i):(In("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class jg{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new jg(t.clientId,t.onlineState):(In("SharedClientState",`Failed to parse online state: ${e}`),null)}}class wm{constructor(){this.activeTargetIds=Tg()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Pp{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Gt(Ye),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=A_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new wm),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(A_(this.persistenceKey,r));if(s){const i=Sh.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Sp(this.persistenceKey,e));if(s){const i=Ju.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Sp(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ce("SharedClientState","READ",e,t),t}setItem(e,t){ce("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ce("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(ce("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void In("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Cr.oe;if(i!=null)try{const a=JSON.parse(i);Oe(typeof a=="number"),o=a}catch(a){In("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Cr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Ah(this.currentUser,e,t,r),i=S_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=S_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Sp(this.persistenceKey,e),i=new Ju(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Sh.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Ah.Rs(new jn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Ju.Rs(s,t)}Ls(e){return jg.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);ce("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Tg();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class TE{constructor(){this.so=new wm,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new wm,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ce("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ce("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kd=null;function Rp(){return kd===null?kd=function(){return 268435456+Math.round(2147483648*Math.random())}():kd++,"0x"+kd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pN{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr="WebChannelConnection";class mN extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=Rp(),l=this.xo(t,r.toUriEncodedString());ce("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(h=>(ce("RestConnection",`Received RPC '${t}' ${a}: `,h),h),h=>{throw es("RestConnection",`RPC '${t}' ${a} failed with error: `,h,"url: ",l,"request:",s),h})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ll}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=fN[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=Rp();return new Promise((o,a)=>{const l=new Kx;l.setWithCredentials(!0),l.listenOnce(Gx.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Hd.NO_ERROR:const h=l.getResponseJson();ce(nr,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(h)),o(h);break;case Hd.TIMEOUT:ce(nr,`RPC '${e}' ${i} timed out`),a(new de(W.DEADLINE_EXCEEDED,"Request time out"));break;case Hd.HTTP_ERROR:const f=l.getStatus();if(ce(nr,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let m=l.getResponseJson();Array.isArray(m)&&(m=m[0]);const v=m==null?void 0:m.error;if(v&&v.status&&v.message){const w=function(I){const O=I.toLowerCase().replace(/_/g,"-");return Object.values(W).indexOf(O)>=0?O:W.UNKNOWN}(v.status);a(new de(w,v.message))}else a(new de(W.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new de(W.UNAVAILABLE,"Connection failed."));break;default:Re()}}finally{ce(nr,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);ce(nr,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=Rp(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Jx(),a=Qx(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const h=i.join("");ce(nr,`Creating RPC '${e}' stream ${s}: ${h}`,l);const f=o.createWebChannel(h,l);let m=!1,v=!1;const w=new pN({Io:I=>{v?ce(nr,`Not sending because RPC '${e}' stream ${s} is closed:`,I):(m||(ce(nr,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),ce(nr,`RPC '${e}' stream ${s} sending:`,I),f.send(I))},To:()=>f.close()}),x=(I,O,L)=>{I.listen(O,U=>{try{L(U)}catch(q){setTimeout(()=>{throw q},0)}})};return x(f,Ou.EventType.OPEN,()=>{v||(ce(nr,`RPC '${e}' stream ${s} transport opened.`),w.yo())}),x(f,Ou.EventType.CLOSE,()=>{v||(v=!0,ce(nr,`RPC '${e}' stream ${s} transport closed`),w.So())}),x(f,Ou.EventType.ERROR,I=>{v||(v=!0,es(nr,`RPC '${e}' stream ${s} transport errored:`,I),w.So(new de(W.UNAVAILABLE,"The operation could not be completed")))}),x(f,Ou.EventType.MESSAGE,I=>{var O;if(!v){const L=I.data[0];Oe(!!L);const U=L,q=U.error||((O=U[0])===null||O===void 0?void 0:O.error);if(q){ce(nr,`RPC '${e}' stream ${s} received error:`,q);const te=q.status;let X=function(T){const k=kn[T];if(k!==void 0)return qI(k)}(te),A=q.message;X===void 0&&(X=W.INTERNAL,A="Unknown error status: "+te+" with message "+q.message),v=!0,w.So(new de(X,A)),f.close()}else ce(nr,`RPC '${e}' stream ${s} received:`,L),w.bo(L)}}),x(a,Wx.STAT_EVENT,I=>{I.stat===im.PROXY?ce(nr,`RPC '${e}' stream ${s} detected buffering proxy`):I.stat===im.NOPROXY&&ce(nr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.wo()},0),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AE(){return typeof window<"u"?window:null}function Xd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gc(n){return new ID(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&ce("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SE{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Bg(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===W.RESOURCE_EXHAUSTED?(In(t.toString()),In("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===W.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new de(W.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ce("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ce("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gN extends SE{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=AD(this.serializer,e),r=function(i){if(!("targetChange"in i))return $e.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?$e.min():o.readTime?An(o.readTime):$e.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=gm(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=vh(l)?{documents:ZI(i,l)}:{query:uf(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=GI(i,o.resumeToken);const c=pm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo($e.min())>0){a.readTime=xl(i,o.snapshotVersion.toTimestamp());const c=pm(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=PD(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=gm(this.serializer),t.removeTarget=e,this.a_(t)}}class vN extends SE{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Oe(!!e.streamToken),this.lastStreamToken=e.streamToken,Oe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Oe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=SD(e.writeResults,e.commitTime),r=An(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=gm(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Ic(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new de(W.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,mm(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new de(W.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,mm(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===W.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new de(W.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class _N{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(In(t),this.D_=!1):ce("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{po(this)&&(ce("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Ee(l);c.L_.add(4),await jl(c),c.q_.set("Unknown"),c.L_.delete(4),await Wc(c)}(this))})}),this.q_=new _N(r,s)}}async function Wc(n){if(po(n))for(const e of n.B_)await e(!0)}async function jl(n){for(const e of n.B_)await e(!1)}function ff(n,e){const t=Ee(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Hg(t)?zg(t):ql(t).r_()&&qg(t,e))}function Tl(n,e){const t=Ee(n),r=ql(t);t.N_.delete(e),r.r_()&&PE(t,e),t.N_.size===0&&(r.r_()?r.o_():po(t)&&t.q_.set("Unknown"))}function qg(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($e.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ql(n).A_(e)}function PE(n,e){n.Q_.xe(e),ql(n).R_(e)}function zg(n){n.Q_=new _D({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ql(n).start(),n.q_.v_()}function Hg(n){return po(n)&&!ql(n).n_()&&n.N_.size>0}function po(n){return Ee(n).L_.size===0}function RE(n){n.Q_=void 0}async function wN(n){n.q_.set("Online")}async function xN(n){n.N_.forEach((e,t)=>{qg(n,e)})}async function IN(n,e){RE(n),Hg(n)?(n.q_.M_(e),zg(n)):n.q_.set("Unknown")}async function EN(n,e,t){if(n.q_.set("Online"),e instanceof KI&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){ce("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ph(n,r)}else if(e instanceof Yd?n.Q_.Ke(e):e instanceof HI?n.Q_.He(e):n.Q_.We(e),!t.isEqual($e.min()))try{const r=await bE(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const h=i.N_.get(c);h&&i.N_.set(c,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const h=i.N_.get(l);if(!h)return;i.N_.set(l,h.withResumeToken(mn.EMPTY_BYTE_STRING,h.snapshotVersion)),PE(i,l);const f=new Hs(h.target,l,c,h.sequenceNumber);qg(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ce("RemoteStore","Failed to raise snapshot:",r),await Ph(n,r)}}async function Ph(n,e,t){if(!ho(e))throw e;n.L_.add(1),await jl(n),n.q_.set("Offline"),t||(t=()=>bE(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ce("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Wc(n)})}function CE(n,e){return e().catch(t=>Ph(n,t,e))}async function Bl(n){const e=Ee(n),t=io(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;TN(e);)try{const s=await uN(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,AN(e,s)}catch(s){await Ph(e,s)}kE(e)&&DE(e)}function TN(n){return po(n)&&n.O_.length<10}function AN(n,e){n.O_.push(e);const t=io(n);t.r_()&&t.V_&&t.m_(e.mutations)}function kE(n){return po(n)&&!io(n).n_()&&n.O_.length>0}function DE(n){io(n).start()}async function SN(n){io(n).p_()}async function PN(n){const e=io(n);for(const t of n.O_)e.m_(t.mutations)}async function RN(n,e,t){const r=n.O_.shift(),s=Rg.from(r,e,t);await CE(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Bl(n)}async function CN(n,e){e&&io(n).V_&&await async function(r,s){if(function(o){return BI(o)&&o!==W.ABORTED}(s.code)){const i=r.O_.shift();io(r).s_(),await CE(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Bl(r)}}(n,e),kE(n)&&DE(n)}async function R_(n,e){const t=Ee(n);t.asyncQueue.verifyOperationInProgress(),ce("RemoteStore","RemoteStore received new credentials");const r=po(t);t.L_.add(3),await jl(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Wc(t)}async function xm(n,e){const t=Ee(n);e?(t.L_.delete(2),await Wc(t)):e||(t.L_.add(2),await jl(t),t.q_.set("Unknown"))}function ql(n){return n.K_||(n.K_=function(t,r,s){const i=Ee(t);return i.w_(),new gN(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:wN.bind(null,n),Ro:xN.bind(null,n),mo:IN.bind(null,n),d_:EN.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Hg(n)?zg(n):n.q_.set("Unknown")):(await n.K_.stop(),RE(n))})),n.K_}function io(n){return n.U_||(n.U_=function(t,r,s){const i=Ee(t);return i.w_(),new vN(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:SN.bind(null,n),mo:CN.bind(null,n),f_:PN.bind(null,n),g_:RN.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Bl(n)):(await n.U_.stop(),n.O_.length>0&&(ce("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new qn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Kg(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new de(W.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zl(n,e){if(In("AsyncQueue",`${e}: ${n}`),ho(n))return new de(W.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Se.comparator(t.key,r.key):(t,r)=>Se.comparator(t.key,r.key),this.keyedMap=Vu(),this.sortedSet=new Gt(this.comparator)}static emptySet(e){return new ll(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ll)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ll;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(){this.W_=new Gt(Se.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Re():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Al{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Al(e,t,ll.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Bc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class DN{constructor(){this.queries=k_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ee(t),i=s.queries;s.queries=k_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new de(W.ABORTED,"Firestore shutting down"))}}function k_(){return new hi(n=>SI(n),Bc)}async function Gg(n,e){const t=Ee(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new kN,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=zl(o,`Initialization of query '${Qa(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Qg(t)}async function Wg(n,e){const t=Ee(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function NN(n,e){const t=Ee(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Qg(t)}function ON(n,e,t){const r=Ee(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Qg(n){n.Y_.forEach(e=>{e.next()})}var Im,D_;(D_=Im||(Im={})).ea="default",D_.Cache="cache";class Jg{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Al(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Al.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Im.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VN{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_{constructor(e){this.serializer=e}Es(e){return ks(this.serializer,e)}ds(e){return e.metadata.exists?XI(this.serializer,e.document,!1):Yt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return An(e)}}class MN{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=NE(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=bt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new N_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||it()).add(i);t.set(o,a)}}return t}async complete(){const e=await cN(this.localStore,new N_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await dN(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function NE(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(e){this.key=e}}class VE{constructor(e){this.key=e}}class ME{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=it(),this.mutatedKeys=it(),this.Aa=RI(e),this.Ra=new ll(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new C_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),v=qc(this.query,f)?f:null,w=!!m&&this.mutatedKeys.has(m.key),x=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let I=!1;m&&v?m.data.isEqual(v.data)?w!==x&&(r.track({type:3,doc:v}),I=!0):this.ga(m,v)||(r.track({type:2,doc:v}),I=!0,(l&&this.Aa(v,l)>0||c&&this.Aa(v,c)<0)&&(a=!0)):!m&&v?(r.track({type:0,doc:v}),I=!0):m&&!v&&(r.track({type:1,doc:m}),I=!0,(l||c)&&(a=!0)),I&&(v?(o=o.add(v),i=x?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((h,f)=>function(v,w){const x=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Re()}};return x(v)-x(w)}(h.type,f.type)||this.Aa(h.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Al(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new C_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=it(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new VE(r))}),this.da.forEach(r=>{e.has(r)||t.push(new OE(r))}),t}ba(e){this.Ta=e.Ts,this.da=it();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Al.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class LN{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class $N{constructor(e){this.key=e,this.va=!1}}class FN{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new hi(a=>SI(a),Bc),this.Ma=new Map,this.xa=new Set,this.Oa=new Gt(Se.comparator),this.Na=new Map,this.La=new Mg,this.Ba={},this.ka=new Map,this.qa=ia.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function UN(n,e,t=!0){const r=pf(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await LE(r,e,t,!0),s}async function jN(n,e){const t=pf(n);await LE(t,e,!0,!1)}async function LE(n,e,t,r){const s=await Il(n.localStore,cr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Yg(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&ff(n.remoteStore,s),a}async function Yg(n,e,t,r,s){n.Ka=(f,m,v)=>async function(x,I,O,L){let U=I.view.ma(O);U.ns&&(U=await Th(x.localStore,I.query,!1).then(({documents:A})=>I.view.ma(A,U)));const q=L&&L.targetChanges.get(I.targetId),te=L&&L.targetMismatches.get(I.targetId)!=null,X=I.view.applyChanges(U,x.isPrimaryClient,q,te);return Em(x,I.targetId,X.wa),X.snapshot}(n,f,m,v);const i=await Th(n.localStore,e,!0),o=new ME(e,i.Ts),a=o.ma(i.documents),l=Kc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Em(n,t,c.wa);const h=new LN(e,t,o);return n.Fa.set(e,h),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function BN(n,e,t){const r=Ee(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Bc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await El(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Tl(r.remoteStore,s.targetId),Sl(r,s.targetId)}).catch(co)):(Sl(r,s.targetId),await El(r.localStore,s.targetId,!0))}async function qN(n,e){const t=Ee(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Tl(t.remoteStore,r.targetId))}async function zN(n,e,t){const r=tv(n);try{const s=await function(o,a){const l=Ee(o),c=dn.now(),h=a.reduce((v,w)=>v.add(w.key),it());let f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let w=Dr(),x=it();return l.cs.getEntries(v,h).next(I=>{w=I,w.forEach((O,L)=>{L.isValidDocument()||(x=x.add(O))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,w)).next(I=>{f=I;const O=[];for(const L of a){const U=gD(L,f.get(L.key).overlayedDocument);U!=null&&O.push(new fi(L.key,U,gI(U.value.mapValue),sn.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,O,a)}).next(I=>{m=I;const O=I.applyToLocalDocumentSet(f,x);return l.documentOverlayCache.saveOverlays(v,I.batchId,O)})}).then(()=>({batchId:m.batchId,changes:kI(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Gt(Ye)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await pi(r,s.changes),await Bl(r.remoteStore)}catch(s){const i=zl(s,"Failed to persist write");t.reject(i)}}async function $E(n,e){const t=Ee(n);try{const r=await lN(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Oe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Oe(o.va):s.removedDocuments.size>0&&(Oe(o.va),o.va=!1))}),await pi(t,r,e)}catch(r){await co(r)}}function O_(n,e,t){const r=Ee(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ee(o);l.onlineState=a;let c=!1;l.queries.forEach((h,f)=>{for(const m of f.j_)m.Z_(a)&&(c=!0)}),c&&Qg(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function HN(n,e,t){const r=Ee(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Gt(Se.comparator);o=o.insert(i,Yt.newNoDocument(i,$e.min()));const a=it().add(i),l=new Hc($e.min(),new Map,new Gt(Ye),o,a);await $E(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),ev(r)}else await El(r.localStore,e,!1).then(()=>Sl(r,e,t)).catch(co)}async function KN(n,e){const t=Ee(n),r=e.batch.batchId;try{const s=await aN(t.localStore,e);Zg(t,r,null),Xg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await pi(t,s)}catch(s){await co(s)}}async function GN(n,e,t){const r=Ee(n);try{const s=await function(o,a){const l=Ee(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let h;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Oe(f!==null),h=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,h)).next(()=>l.localDocuments.getDocuments(c,h))})}(r.localStore,e);Zg(r,e,t),Xg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await pi(r,s)}catch(s){await co(s)}}async function WN(n,e){const t=Ee(n);po(t.remoteStore)||ce("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ee(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=zl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Xg(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Zg(n,e,t){const r=Ee(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Sl(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||FE(n,r)})}function FE(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Tl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),ev(n))}function Em(n,e,t){for(const r of t)r instanceof OE?(n.La.addReference(r.key,e),QN(n,r)):r instanceof VE?(ce("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||FE(n,r.key)):Re()}function QN(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(ce("SyncEngine","New document in limbo: "+t),n.xa.add(r),ev(n))}function ev(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Se(bt.fromString(e)),r=n.qa.next();n.Na.set(r,new $N(t)),n.Oa=n.Oa.insert(t,r),ff(n.remoteStore,new Hs(cr($l(t.path)),r,"TargetPurposeLimboResolution",Cr.oe))}}async function pi(n,e,t){const r=Ee(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var h;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(h=t==null?void 0:t.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Ug.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const h=Ee(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,m=>z.forEach(m.$i,v=>h.persistence.referenceDelegate.addReference(f,m.targetId,v)).next(()=>z.forEach(m.Ui,v=>h.persistence.referenceDelegate.removeReference(f,m.targetId,v)))))}catch(f){if(!ho(f))throw f;ce("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const m=f.targetId;if(!f.fromCache){const v=h.os.get(m),w=v.snapshotVersion,x=v.withLastLimboFreeSnapshotVersion(w);h.os=h.os.insert(m,x)}}}(r.localStore,i))}async function JN(n,e){const t=Ee(n);if(!t.currentUser.isEqual(e)){ce("SyncEngine","User change. New user:",e.toKey());const r=await _E(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new de(W.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await pi(t,r.hs)}}function YN(n,e){const t=Ee(n),r=t.Na.get(e);if(r&&r.va)return it().add(r.key);{let s=it();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function XN(n,e){const t=Ee(n),r=await Th(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Em(t,e.targetId,s.wa),s}async function ZN(n,e){const t=Ee(n);return IE(t.localStore,e).then(r=>pi(t,r))}async function eO(n,e,t,r){const s=Ee(n),i=await function(a,l){const c=Ee(a),h=Ee(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>h.Mn(f,l).next(m=>m?c.localDocuments.getDocuments(f,m):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Bl(s.remoteStore):t==="acknowledged"||t==="rejected"?(Zg(s,e,r||null),Xg(s,e),function(a,l){Ee(Ee(a).mutationQueue).On(l)}(s.localStore,e)):Re(),await pi(s,i)):ce("SyncEngine","Cannot apply mutation batch with id: "+e)}async function tO(n,e){const t=Ee(n);if(pf(t),tv(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await V_(t,r.toArray());t.Qa=!0,await xm(t.remoteStore,!0);for(const i of s)ff(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Sl(t,o),El(t.localStore,o,!0))),Tl(t.remoteStore,o)}),await s,await V_(t,r),function(o){const a=Ee(o);a.Na.forEach((l,c)=>{Tl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Gt(Se.comparator)}(t),t.Qa=!1,await xm(t.remoteStore,!1)}}async function V_(n,e,t){const r=Ee(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Il(r.localStore,cr(l[0]));for(const c of l){const h=r.Fa.get(c),f=await XN(r,h);f.snapshot&&i.push(f.snapshot)}}else{const c=await xE(r.localStore,o);a=await Il(r.localStore,c),await Yg(r,UE(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function UE(n){return EI(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function nO(n){return function(t){return Ee(Ee(t).persistence).Qi()}(Ee(n).localStore)}async function rO(n,e,t,r){const s=Ee(n);if(s.Qa)return void ce("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await IE(s.localStore,PI(i[0])),a=Hc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",mn.EMPTY_BYTE_STRING);await pi(s,o,a);break}case"rejected":await El(s.localStore,e,!0),Sl(s,e,r);break;default:Re()}}async function sO(n,e,t){const r=pf(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){ce("SyncEngine","Adding an already active target "+s);continue}const i=await xE(r.localStore,s),o=await Il(r.localStore,i);await Yg(r,UE(i),o.targetId,!1,o.resumeToken),ff(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await El(r.localStore,s,!1).then(()=>{Tl(r.remoteStore,s),Sl(r,s)}).catch(co)}}function pf(n){const e=Ee(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=$E.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=YN.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=HN.bind(null,e),e.Ca.d_=NN.bind(null,e.eventManager),e.Ca.$a=ON.bind(null,e.eventManager),e}function tv(n){const e=Ee(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=KN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=GN.bind(null,e),e}function iO(n,e,t){const r=Ee(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,w){const x=Ee(v),I=An(w.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",O=>x.Gr.getBundleMetadata(O,w.id)).then(O=>!!O&&O.createTime.compareTo(I)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(NE(l));const c=new MN(l,i.localStore,o.serializer);let h=await o.Ua();for(;h;){const m=await c.la(h);m&&a._updateProgress(m),h=await o.Ua()}const f=await c.complete();return await pi(i,f.Ia,void 0),await function(v,w){const x=Ee(v);return x.persistence.runTransaction("Save bundle","readwrite",I=>x.Gr.saveBundleMetadata(I,w))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return es("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class oo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Gc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return yE(this.persistence,new vE,e.initialUser,this.serializer)}Ga(e){return new Lg(hf.Zr,this.serializer)}Wa(e){return new TE}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}oo.provider={build:()=>new oo};class oO extends oo{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Oe(this.persistence.referenceDelegate instanceof Eh);const r=this.persistence.referenceDelegate.garbageCollector;return new hE(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new Lg(r=>Eh.Zr(r,t),this.serializer)}}class nv extends oo{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await tv(this.Ja.syncEngine),await Bl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return yE(this.persistence,new vE,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new hE(r,e.asyncQueue,t)}Ha(e,t){const r=new P2(t,this.persistence);return new S2(e.asyncQueue,r)}Ga(e){const t=Fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?sr.withCacheSize(this.cacheSizeBytes):sr.DEFAULT;return new $g(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,AE(),Xd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new TE}}class jE extends nv{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Pp&&(this.sharedClientState.syncEngine={no:eO.bind(null,t),ro:rO.bind(null,t),io:sO.bind(null,t),Qi:nO.bind(null,t),eo:ZN.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await tO(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=AE();if(!Pp.D(t))throw new de(W.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Fg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Pp(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ao{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>O_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=JN.bind(null,this.syncEngine),await xm(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new DN}()}createDatastore(e){const t=Gc(e.databaseInfo.databaseId),r=function(i){return new mN(i)}(e.databaseInfo);return function(i,o,a,l){return new yN(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new bN(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>O_(this.syncEngine,t,0),function(){return P_.D()?new P_:new hN}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,h){const f=new FN(s,i,o,a,l,c);return h&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ee(s);ce("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await jl(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ao.provider={build:()=>new ao};function M_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):In("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new qn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new VN(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new de(W.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ee(s),a={documents:i.map(f=>xc(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,bt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const m=TD(o.serializer,f);c.set(m.key.toString(),m)});const h=[];return i.forEach(f=>{const m=c.get(f.toString());Oe(!!m),h.push(m)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ul(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Se.fromPath(r);this.mutations.push(new Sg(s,this.precondition(s)))}),await async function(r,s){const i=Ee(r),o={writes:s.map(a=>Ic(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,bt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Re();t=$e.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new de(W.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($e.min())?sn.exists(!1):sn.updateTime(t):sn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($e.min()))throw new de(W.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return sn.updateTime(t)}return sn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uO{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Bg(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new lO(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Uc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!BI(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=jn.UNAUTHENTICATED,this.clientId=Zx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ce("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ce("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new qn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=zl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Cp(n,e){n.asyncQueue.verifyOperationInProgress(),ce("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await _E(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function L_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await rv(n);ce("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>R_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>R_(e.remoteStore,s)),n._onlineComponents=e}async function rv(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ce("FirestoreClient","Using user provided OfflineComponentProvider");try{await Cp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===W.FAILED_PRECONDITION||s.code===W.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;es("Error using user provided cache. Falling back to memory cache: "+t),await Cp(n,new oo)}}else ce("FirestoreClient","Using default OfflineComponentProvider"),await Cp(n,new oo);return n._offlineComponents}async function gf(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ce("FirestoreClient","Using user provided OnlineComponentProvider"),await L_(n,n._uninitializedComponentsProvider._online)):(ce("FirestoreClient","Using default OnlineComponentProvider"),await L_(n,new ao))),n._onlineComponents}function BE(n){return rv(n).then(e=>e.persistence)}function Hl(n){return rv(n).then(e=>e.localStore)}function qE(n){return gf(n).then(e=>e.remoteStore)}function sv(n){return gf(n).then(e=>e.syncEngine)}function zE(n){return gf(n).then(e=>e.datastore)}async function Pl(n){const e=await gf(n),t=e.eventManager;return t.onListen=UN.bind(null,e.syncEngine),t.onUnlisten=BN.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=jN.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=qN.bind(null,e.syncEngine),t}function dO(n){return n.asyncQueue.enqueue(async()=>{const e=await BE(n),t=await qE(n);return e.setNetworkEnabled(!0),function(s){const i=Ee(s);return i.L_.delete(0),Wc(i)}(t)})}function hO(n){return n.asyncQueue.enqueue(async()=>{const e=await BE(n),t=await qE(n);return e.setNetworkEnabled(!1),async function(s){const i=Ee(s);i.L_.add(0),await jl(i),i.q_.set("Offline")}(t)})}function fO(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,h){const f=Ee(c);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,h))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new de(W.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=zl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Hl(n),e,t)),t.promise}function HE(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new mf({next:m=>{h.Za(),o.enqueueAndForget(()=>Wg(i,f));const v=m.docs.has(a);!v&&m.fromCache?c.reject(new de(W.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&m.fromCache&&l&&l.source==="server"?c.reject(new de(W.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Jg($l(a.path),h,{includeMetadataChanges:!0,_a:!0});return Gg(i,f)}(await Pl(n),n.asyncQueue,e,t,r)),r.promise}function pO(n,e){const t=new qn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Th(s,i,!0),l=new ME(i,a.Ts),c=l.ma(a.documents),h=l.applyChanges(c,!1);o.resolve(h.snapshot)}catch(a){const l=zl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Hl(n),e,t)),t.promise}function KE(n,e,t={}){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const h=new mf({next:m=>{h.Za(),o.enqueueAndForget(()=>Wg(i,f)),m.fromCache&&l.source==="server"?c.reject(new de(W.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Jg(a,h,{includeMetadataChanges:!0,_a:!0});return Gg(i,f)}(await Pl(n),n.asyncQueue,e,t,r)),r.promise}function mO(n,e,t){const r=new qn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await zE(n);r.resolve(async function(o,a,l){var c;const h=Ee(o),{request:f,ut:m,parent:v}=eE(h.serializer,TI(a),l);h.connection.Fo||delete f.parent;const w=(await h.Lo("RunAggregationQuery",h.serializer.databaseId,v,f,1)).filter(I=>!!I.result);Oe(w.length===1);const x=(c=w[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(x).reduce((I,O)=>(I[m[O]]=x[O],I),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function gO(n,e){const t=new mf(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ee(s).Y_.add(i),i.next()}(await Pl(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ee(s).Y_.delete(i)}(await Pl(n),t))}}function vO(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?zI().encode(o):o,function(h,f){return new aO(h,f)}(function(h,f){if(h instanceof Uint8Array)return M_(h,f);if(h instanceof ArrayBuffer)return M_(new Uint8Array(h),f);if(h instanceof ReadableStream)return h.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Gc(e));n.asyncQueue.enqueueAndForget(async()=>{iO(await sv(n),s,r)})}function yO(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ee(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Hl(n),e))}function _O(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ee(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,m,v,w,x){f=[...f],m=[...m],f.sort(v),m.sort(v);const I=f.length,O=m.length;let L=0,U=0;for(;L<O&&U<I;){const q=v(f[U],m[L]);q<0?x(f[U++]):q>0?w(m[L++]):(L++,U++)}for(;L<O;)w(m[L++]);for(;U<I;)x(f[U++])}(c,s,I2,h=>{a.push(o.addFieldIndex(l,h))},h=>{a.push(o.deleteFieldIndex(l,h))})).next(()=>z.waitFor(a)))}(await Hl(n),e))}function bO(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ee(r).ss.zi=s}(await Hl(n),e))}function wO(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ee(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Hl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iv(n,e,t){if(!t)throw new de(W.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function xO(n,e,t,r){if(e===!0&&r===!0)throw new de(W.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function F_(n){if(!Se.isDocumentKey(n))throw new de(W.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function U_(n){if(Se.isDocumentKey(n))throw new de(W.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vf(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Re()}function gt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new de(W.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=vf(n);throw new de(W.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function WE(n,e){if(e<=0)throw new de(W.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new de(W.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new de(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}xO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=GE((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new de(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new de(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new de(W.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Qc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new j_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new de(W.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new de(W.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new j_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new m2;switch(r.type){case"firstParty":return new _2(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new de(W.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=$_.get(t);r&&(ce("ComponentProvider","Removing Datastore"),$_.delete(t),r.terminate())}(this),Promise.resolve()}}function IO(n,e,t,r={}){var s;const i=(n=gt(n,Qc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&es("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=jn.MOCK_USER;else{a=dx(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new de(W.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new jn(c)}n._authCredentials=new g2(new Yx(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Jn(this.firestore,e,this._query)}}class Sn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ds(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Sn(this.firestore,e,this._key)}}class Ds extends Jn{constructor(e,t,r){super(e,t,$l(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Sn(this.firestore,null,new Se(e))}withConverter(e){return new Ds(this.firestore,e,this._path)}}function tt(n,e,...t){if(n=De(n),iv("collection","path",e),n instanceof Qc){const r=bt.fromString(e,...t);return U_(r),new Ds(n,null,r)}{if(!(n instanceof Sn||n instanceof Ds))throw new de(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(e,...t));return U_(r),new Ds(n.firestore,null,r)}}function DK(n,e){if(n=gt(n,Qc),iv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new de(W.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Jn(n,null,function(r){return new di(bt.emptyPath(),r)}(e))}function be(n,e,...t){if(n=De(n),arguments.length===1&&(e=Zx.newId()),iv("doc","path",e),n instanceof Qc){const r=bt.fromString(e,...t);return F_(r),new Sn(n,null,new Se(r))}{if(!(n instanceof Sn||n instanceof Ds))throw new de(W.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(bt.fromString(e,...t));return F_(r),new Sn(n.firestore,n instanceof Ds?n.converter:null,new Se(r))}}function NK(n,e){return n=De(n),e=De(e),(n instanceof Sn||n instanceof Ds)&&(e instanceof Sn||e instanceof Ds)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function QE(n,e){return n=De(n),e=De(e),n instanceof Jn&&e instanceof Jn&&n.firestore===e.firestore&&Bc(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Bg(this,"async_queue_retry"),this.Vu=()=>{const r=Xd();r&&ce("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Xd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Xd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new qn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ho(e))throw e;ce("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw In("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Kg.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Re()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Tm(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class EO{constructor(){this._progressObserver={},this._taskCompletionResolver=new qn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OK=-1;class zt extends Qc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new B_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new B_(e),this._firestoreClient=void 0,await e}}}function VK(n,e,t){t||(t="(default)");const r=ci(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(eo(i,e))return s;throw new de(W.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new de(W.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new de(W.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function TO(n,e){const t=typeof n=="object"?n:Ml(),r=typeof n=="string"?n:e||"(default)",s=ci(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=lx("firestore");i&&IO(s,...i)}return s}function hn(n){if(n._terminated)throw new de(W.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||JE(n),n._firestoreClient}function JE(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,h){return new Q2(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,GE(h.experimentalLongPollingOptions),h.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new cO(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function AO(n,e){es("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return YE(n,ao.provider,{build:r=>new nv(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function MK(n){es("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();YE(n,ao.provider,{build:t=>new jE(t,e.cacheSizeBytes)})}function YE(n,e,t){if((n=gt(n,zt))._firestoreClient||n._terminated)throw new de(W.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new de(W.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},JE(n)}function LK(n){if(n._initialized&&!n._terminated)throw new de(W.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new qn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Cs.D())return Promise.resolve();const s=r+"main";await Cs.delete(s)}(Fg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function $K(n){return function(t){const r=new qn;return t.asyncQueue.enqueueAndForget(async()=>WN(await sv(t),r)),r.promise}(hn(n=gt(n,zt)))}function FK(n){return dO(hn(n=gt(n,zt)))}function UK(n){return hO(hn(n=gt(n,zt)))}function jK(n){return DC(n.app,"firestore",n._databaseId.database),n._delete()}function BK(n,e){const t=hn(n=gt(n,zt)),r=new EO;return vO(t,n._databaseId,e,r),r}function qK(n,e){return yO(hn(n=gt(n,zt)),e).then(t=>t?new Jn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class SO{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e){this._byteString=e}static fromBase64String(e){try{return new oa(mn.fromBase64String(e))}catch(t){throw new de(W.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new oa(mn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new de(W.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function zK(){return new da("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new de(W.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new de(W.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ye(this._lat,e._lat)||Ye(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PO=/^__.*__$/;class RO{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new fi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fl(e,this.data,t,this.fieldTransforms)}}class XE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new fi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ZE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Re()}}class _f{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new _f(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Rh(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(ZE(this.Cu)&&PO.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class CO{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Gc(e)}Qu(e,t,r,s=!1){return new _f({Cu:e,methodName:t,qu:r,path:rn.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fa(n){const e=n._freezeSettings(),t=Gc(n._databaseId);return new CO(n._databaseId,!!e.ignoreUndefinedProperties,t)}function bf(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);fv("Data must be an object, but it was:",o,r);const a=nT(r,o);let l,c;if(i.merge)l=new kr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=Tc(e,f,t);if(!o.contains(m))throw new de(W.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);sT(h,m)||h.push(m)}l=new kr(h),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new RO(new Qn(a),l,c)}class Jc extends ha{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Jc}}function eT(n,e,t){return new _f({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class av extends ha{_toFieldTransform(e){return new zc(e.path,new bl)}isEqual(e){return e instanceof av}}class lv extends ha{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=eT(this,e,!0),r=this.Ku.map(i=>pa(i,t)),s=new ta(r);return new zc(e.path,s)}isEqual(e){return e instanceof lv&&eo(this.Ku,e.Ku)}}class uv extends ha{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=eT(this,e,!0),r=this.Ku.map(i=>pa(i,t)),s=new na(r);return new zc(e.path,s)}isEqual(e){return e instanceof uv&&eo(this.Ku,e.Ku)}}class cv extends ha{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new wl(e.serializer,OI(e.serializer,this.$u));return new zc(e.path,t)}isEqual(e){return e instanceof cv&&this.$u===e.$u}}function dv(n,e,t,r){const s=n.Qu(1,e,t);fv("Data must be an object, but it was:",s,r);const i=[],o=Qn.empty();fo(r,(l,c)=>{const h=wf(e,l,t);c=De(c);const f=s.Nu(h);if(c instanceof Jc)i.push(h);else{const m=pa(c,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new kr(i);return new XE(o,a,s.fieldTransforms)}function hv(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Tc(e,r,t)],l=[s];if(i.length%2!=0)throw new de(W.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Tc(e,i[m])),l.push(i[m+1]);const c=[],h=Qn.empty();for(let m=a.length-1;m>=0;--m)if(!sT(c,a[m])){const v=a[m];let w=l[m];w=De(w);const x=o.Nu(v);if(w instanceof Jc)c.push(v);else{const I=pa(w,x);I!=null&&(c.push(v),h.set(v,I))}}const f=new kr(c);return new XE(h,f,o.fieldTransforms)}function tT(n,e,t,r=!1){return pa(t,n.Qu(r?4:3,e))}function pa(n,e){if(rT(n=De(n)))return fv("Unsupported field value:",e,n),nT(n,e);if(n instanceof ha)return function(r,s){if(!ZE(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=pa(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=De(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return OI(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=dn.fromDate(r);return{timestampValue:xl(s.serializer,i)}}if(r instanceof dn){const i=new dn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:xl(s.serializer,i)}}if(r instanceof ov)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof oa)return{bytesValue:GI(s.serializer,r._byteString)};if(r instanceof Sn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Dg(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof yf)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Ag(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${vf(r)}`)}(n,e)}function nT(n,e){const t={};return hI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):fo(n,(r,s)=>{const i=pa(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function rT(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof dn||n instanceof ov||n instanceof oa||n instanceof Sn||n instanceof ha||n instanceof yf)}function fv(n,e,t){if(!rT(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=vf(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Tc(n,e,t){if((e=De(e))instanceof da)return e._internalPath;if(typeof e=="string")return wf(n,e);throw Rh("Field path arguments must be of type string or ",n,!1,void 0,t)}const kO=new RegExp("[~\\*/\\[\\]]");function wf(n,e,t){if(e.search(kO)>=0)throw Rh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new da(...e.split("."))._internalPath}catch{throw Rh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rh(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new de(W.INVALID_ARGUMENT,a+n+l)}function sT(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ac{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Sn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new DO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(xf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class DO extends Ac{data(){return super.data()}}function xf(n,e){return typeof e=="string"?wf(n,e):e instanceof da?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new de(W.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class pv{}class Yc extends pv{}function Sc(n,e,...t){let r=[];e instanceof pv&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Kl).length,a=i.filter(l=>l instanceof Xc).length;if(o>1||o>0&&a>0)throw new de(W.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Xc extends Yc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Xc(e,t,r)}_apply(e){const t=this._parse(e);return aT(e._query,t),new Jn(e.firestore,e.converter,fm(e._query,t))}_parse(e){const t=fa(e.firestore);return function(i,o,a,l,c,h,f){let m;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new de(W.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){z_(f,h);const v=[];for(const w of f)v.push(q_(l,i,w));m={arrayValue:{values:v}}}else m=q_(l,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||z_(f,h),m=tT(a,o,f,h==="in"||h==="not-in");return wt.create(c,h,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ch(n,e,t){const r=e,s=xf("where",n);return Xc._create(s,r,t)}class Kl extends pv{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Kl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ft.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)aT(o,l),o=fm(o,l)}(e._query,t),new Jn(e.firestore,e.converter,fm(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function HK(...n){return n.forEach(e=>lT("or",e)),Kl._create("or",n)}function KK(...n){return n.forEach(e=>lT("and",e)),Kl._create("and",n)}class mv extends Yc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new mv(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new de(W.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new de(W.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new wc(i,o)}(e._query,this._field,this._direction);return new Jn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new di(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function NO(n,e="asc"){const t=e,r=xf("orderBy",n);return mv._create(r,t)}class If extends Yc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new If(e,t,r)}_apply(e){return new Jn(e.firestore,e.converter,_h(e._query,this._limit,this._limitType))}}function GK(n){return WE("limit",n),If._create("limit",n,"F")}function WK(n){return WE("limitToLast",n),If._create("limitToLast",n,"L")}class Ef extends Yc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ef(e,t,r)}_apply(e){const t=oT(e,this.type,this._docOrFields,this._inclusive);return new Jn(e.firestore,e.converter,function(s,i){return new di(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function QK(...n){return Ef._create("startAt",n,!0)}function JK(...n){return Ef._create("startAfter",n,!1)}class Tf extends Yc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Tf(e,t,r)}_apply(e){const t=oT(e,this.type,this._docOrFields,this._inclusive);return new Jn(e.firestore,e.converter,function(s,i){return new di(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function YK(...n){return Tf._create("endBefore",n,!1)}function XK(...n){return Tf._create("endAt",n,!0)}function oT(n,e,t,r){if(t[0]=De(t[0]),t[0]instanceof Ac)return function(i,o,a,l,c){if(!l)throw new de(W.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of al(i))if(f.field.isKeyField())h.push(Zo(o,l.key));else{const m=l.data.field(f.field);if(rf(m))throw new de(W.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const v=f.field.canonicalString();throw new de(W.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}h.push(m)}return new so(h,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=fa(n.firestore);return function(o,a,l,c,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new de(W.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let w=0;w<h.length;w++){const x=h[w];if(m[w].field.isKeyField()){if(typeof x!="string")throw new de(W.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof x}`);if(!Eg(o)&&x.indexOf("/")!==-1)throw new de(W.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${x}' contains a slash.`);const I=o.path.child(bt.fromString(x));if(!Se.isDocumentKey(I))throw new de(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const O=new Se(I);v.push(Zo(a,O))}else{const I=tT(l,c,x);v.push(I)}}return new so(v,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function q_(n,e,t){if(typeof(t=De(t))=="string"){if(t==="")throw new de(W.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Eg(e)&&t.indexOf("/")!==-1)throw new de(W.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(bt.fromString(t));if(!Se.isDocumentKey(r))throw new de(W.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Zo(n,new Se(r))}if(t instanceof Sn)return Zo(n,t._key);throw new de(W.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vf(t)}.`)}function z_(n,e){if(!Array.isArray(n)||n.length===0)throw new de(W.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function aT(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new de(W.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new de(W.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function lT(n,e){if(!(e instanceof Xc||e instanceof Kl))throw new de(W.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class uT{convertValue(e,t="none"){switch(no(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ii(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Re()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return fo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>nn(o.doubleValue));return new yf(i)}convertGeoPoint(e){return new ov(nn(e.latitude),nn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=sf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(yc(e));default:return null}}convertTimestamp(e){const t=si(e);return new dn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=bt.fromString(e);Oe(sE(r));const s=new Xo(r.get(1),r.get(3)),i=new Se(r.popFirst(5));return s.isEqual(t)||In(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class OO extends uT{constructor(e){super(),this.firestore=e}convertBytes(e){return new oa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Sn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZK(n){return new Ec("sum",Tc("sum",n))}function eG(n){return new Ec("avg",Tc("average",n))}function VO(){return new Ec("count")}function tG(n,e){var t,r;return n instanceof Ec&&e instanceof Ec&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function nG(n,e){return QE(n.query,e.query)&&eo(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Rl extends Ac{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Zd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(xf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Zd extends Rl{data(e={}){return super.data(e)}}class Cl{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Bo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Zd(this._firestore,this._userDataWriter,r.key,r,new Bo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new de(W.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Zd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Bo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Zd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Bo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,h=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:MO(a.type),doc:l,oldIndex:c,newIndex:h}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function MO(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Re()}}function rG(n,e){return n instanceof Rl&&e instanceof Rl?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Cl&&e instanceof Cl&&n._firestore===e._firestore&&QE(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(n){n=gt(n,Sn);const e=gt(n.firestore,zt);return HE(hn(e),n._key).then(t=>gv(e,n,t))}class mo extends uT{constructor(e){super(),this.firestore=e}convertBytes(e){return new oa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Sn(this.firestore,null,t)}}function sG(n){n=gt(n,Sn);const e=gt(n.firestore,zt),t=hn(e),r=new mo(e);return fO(t,n._key).then(s=>new Rl(e,r,n._key,s,new Bo(s!==null&&s.hasLocalMutations,!0),n.converter))}function iG(n){n=gt(n,Sn);const e=gt(n.firestore,zt);return HE(hn(e),n._key,{source:"server"}).then(t=>gv(e,n,t))}function $t(n){n=gt(n,Jn);const e=gt(n.firestore,zt),t=hn(e),r=new mo(e);return iT(n._query),KE(t,n._query).then(s=>new Cl(e,r,n,s))}function oG(n){n=gt(n,Jn);const e=gt(n.firestore,zt),t=hn(e),r=new mo(e);return pO(t,n._query).then(s=>new Cl(e,r,n,s))}function aG(n){n=gt(n,Jn);const e=gt(n.firestore,zt),t=hn(e),r=new mo(e);return KE(t,n._query,{source:"server"}).then(s=>new Cl(e,r,n,s))}function on(n,e,t){n=gt(n,Sn);const r=gt(n.firestore,zt),s=Af(n.converter,e,t);return Zc(r,[bf(fa(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,sn.none())])}function go(n,e,t,...r){n=gt(n,Sn);const s=gt(n.firestore,zt),i=fa(s);let o;return o=typeof(e=De(e))=="string"||e instanceof da?hv(i,"updateDoc",n._key,e,t,r):dv(i,"updateDoc",n._key,e),Zc(s,[o.toMutation(n._key,sn.exists(!0))])}function kl(n){return Zc(gt(n.firestore,zt),[new Ul(n._key,sn.none())])}function ma(n,e){const t=gt(n.firestore,zt),r=be(n),s=Af(n.converter,e);return Zc(t,[bf(fa(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,sn.exists(!1))]).then(()=>r)}function lG(n,...e){var t,r,s;n=De(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Tm(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Tm(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,h;if(n instanceof Sn)c=gt(n.firestore,zt),h=$l(n._key.path),l={next:f=>{e[o]&&e[o](gv(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=gt(n,Jn);c=gt(f.firestore,zt),h=f._query;const m=new mo(c);l={next:v=>{e[o]&&e[o](new Cl(c,m,f,v))},error:e[o+1],complete:e[o+2]},iT(n._query)}return function(m,v,w,x){const I=new mf(x),O=new Jg(v,I,w);return m.asyncQueue.enqueueAndForget(async()=>Gg(await Pl(m),O)),()=>{I.Za(),m.asyncQueue.enqueueAndForget(async()=>Wg(await Pl(m),O))}}(hn(c),h,a,l)}function uG(n,e){return gO(hn(n=gt(n,zt)),Tm(e)?e:{next:e})}function Zc(n,e){return function(r,s){const i=new qn;return r.asyncQueue.enqueueAndForget(async()=>zN(await sv(r),s,i)),i.promise}(hn(n),e)}function gv(n,e,t){const r=t.docs.get(e._key),s=new mo(n);return new Rl(n,s,e._key,r,new Bo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cG(n){return LO(n,{count:VO()})}function LO(n,e){const t=gt(n.firestore,zt),r=hn(t),s=dI(e,(i,o)=>new jI(o,i.aggregateType,i._internalFieldPath));return mO(r,n._query,s).then(i=>function(a,l,c){const h=new mo(a);return new SO(l,h,c)}(t,n,i))}class $O{constructor(e){this.kind="memory",this._onlineComponentProvider=ao.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=oo.provider}toJSON(){return{kind:this.kind}}}class FO{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=zO(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class UO{constructor(){this.kind="memoryEager",this._offlineComponentProvider=oo.provider}toJSON(){return{kind:this.kind}}}class jO{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new oO(e)}}toJSON(){return{kind:this.kind}}}function dG(){return new UO}function hG(n){return new jO(n==null?void 0:n.cacheSizeBytes)}function fG(n){return new $O(n)}function pG(n){return new FO(n)}class BO{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ao.provider,this._offlineComponentProvider={build:t=>new nv(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class qO{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ao.provider,this._offlineComponentProvider={build:t=>new jE(t,e==null?void 0:e.cacheSizeBytes)}}}function zO(n){return new BO(n==null?void 0:n.forceOwnership)}function mG(){return new qO}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HO={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fa(e)}set(e,t,r){this._verifyNotCommitted();const s=Fi(e,this._firestore),i=Af(s.converter,t,r),o=bf(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,sn.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Fi(e,this._firestore);let o;return o=typeof(t=De(t))=="string"||t instanceof da?hv(this._dataReader,"WriteBatch.update",i._key,t,r,s):dv(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,sn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Fi(e,this._firestore);return this._mutations=this._mutations.concat(new Ul(t._key,sn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new de(W.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Fi(n,e){if((n=De(n)).firestore!==e)throw new de(W.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GO extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=fa(t)}get(t){const r=Fi(t,this._firestore),s=new OO(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Re();const o=i[0];if(o.isFoundDocument())return new Ac(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Ac(this._firestore,s,r._key,null,r.converter);throw Re()})}set(t,r,s){const i=Fi(t,this._firestore),o=Af(i.converter,r,s),a=bf(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Fi(t,this._firestore);let a;return a=typeof(r=De(r))=="string"||r instanceof da?hv(this._dataReader,"Transaction.update",o._key,r,s,i):dv(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Fi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Fi(e,this._firestore),r=new mo(this._firestore);return super.get(e).then(s=>new Rl(this._firestore,r,t._key,s._document,new Bo(!1,!1),t.converter))}}function vG(n,e,t){n=gt(n,zt);const r=Object.assign(Object.assign({},HO),t);return function(i){if(i.maxAttempts<1)throw new de(W.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new qn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await zE(i);new uO(i.asyncQueue,c,a,o,l).au()}),l.promise}(hn(n),s=>e(new GO(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yG(){return new Jc("deleteField")}function xr(){return new av("serverTimestamp")}function WO(...n){return new lv("arrayUnion",n)}function _G(...n){return new uv("arrayRemove",n)}function bG(n){return new cv("increment",n)}function wG(n){return new yf(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vv(n){return hn(n=gt(n,zt)),new KO(n,e=>Zc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xG(n,e){const t=hn(n=gt(n,zt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return es("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(h){throw new de(W.INVALID_ARGUMENT,"Failed to parse JSON: "+(h==null?void 0:h.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=H_(l,"collectionGroup"),h=[];if(Array.isArray(l.fields))for(const f of l.fields){const m=wf("setIndexConfiguration",H_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?h.push(new Ko(m,2)):f.order==="ASCENDING"?h.push(new Ko(m,0)):f.order==="DESCENDING"&&h.push(new Ko(m,1))}a.push(new gl(gl.UNKNOWN_ID,c,h,vl.empty()))}return a}(e);return _O(t,r)}function H_(n,e){if(typeof n[e]!="string")throw new de(W.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QO{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function IG(n){var e;n=gt(n,zt);const t=K_.get(n);if(t)return t;if(((e=hn(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new QO(n);return K_.set(n,r),r}function EG(n){cT(n,!0)}function TG(n){cT(n,!1)}function AG(n){wO(hn(n._firestore)).then(e=>ce("deleting all persistent cache indexes succeeded")).catch(e=>es("deleting all persistent cache indexes failed",e))}function cT(n,e){bO(hn(n._firestore),e).then(t=>ce(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>es(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const K_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SG(n){var e;const t=(e=hn(gt(n.firestore,zt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:uf(t,cr(n._query))._t}function PG(n,e){var t;const r=dI(e,(i,o)=>new jI(o,i.aggregateType,i._internalFieldPath)),s=(t=hn(gt(n.firestore,zt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:eE(s,TI(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RG{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return yv.instance.onExistenceFilterMismatch(e)}}class yv{constructor(){this.Uu=new Map}static get instance(){return Dd||(Dd=new yv,function(t){if(bh)throw new Error("a TestingHooksSpi instance is already set");bh=t}(Dd)),Dd}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Dd=null;(function(e,t=!0){(function(s){Ll=s})(ca),hs(new Zr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new zt(new v2(r.getProvider("auth-internal")),new b2(r.getProvider("app-check-internal")),function(c,h){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new de(W.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xo(c.options.projectId,h)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Nr(V0,"4.7.3",e),Nr(V0,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dT="firebasestorage.googleapis.com",hT="storageBucket",JO=2*60*1e3,YO=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vn extends ps{constructor(e,t,r=0){super(kp(e),`Firebase Storage: ${t} (${kp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return kp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var gn;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(gn||(gn={}));function kp(n){return"storage/"+n}function _v(){const n="An unknown error occurred, please check the error payload for server response.";return new vn(gn.UNKNOWN,n)}function XO(n){return new vn(gn.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function ZO(n){return new vn(gn.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function eV(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new vn(gn.UNAUTHENTICATED,n)}function tV(){return new vn(gn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function nV(n){return new vn(gn.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function rV(){return new vn(gn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function sV(){return new vn(gn.CANCELED,"User canceled the upload/download.")}function iV(n){return new vn(gn.INVALID_URL,"Invalid URL '"+n+"'.")}function oV(n){return new vn(gn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function aV(){return new vn(gn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+hT+"' property when initializing the app?")}function lV(){return new vn(gn.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function uV(){return new vn(gn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function cV(n){return new vn(gn.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Am(n){return new vn(gn.INVALID_ARGUMENT,n)}function fT(){return new vn(gn.APP_DELETED,"The Firebase app was deleted.")}function dV(n){return new vn(gn.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Yu(n,e){return new vn(gn.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Su(n){throw new vn(gn.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=zr.makeFromUrl(e,t)}catch{return new zr(e,"")}if(r.path==="")return r;throw oV(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(q){q.path.charAt(q.path.length-1)==="/"&&(q.path_=q.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(q){q.path_=decodeURIComponent(q.path)}const h="v[A-Za-z0-9_]+",f=t.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",v=new RegExp(`^https?://${f}/${h}/b/${s}/o${m}`,"i"),w={bucket:1,path:3},x=t===dT?"(?:storage.googleapis.com|storage.cloud.google.com)":t,I="([^?#]*)",O=new RegExp(`^https?://${x}/${s}/${I}`,"i"),U=[{regex:a,indices:l,postModify:i},{regex:v,indices:w,postModify:c},{regex:O,indices:{bucket:1,path:2},postModify:c}];for(let q=0;q<U.length;q++){const te=U[q],X=te.regex.exec(e);if(X){const A=X[te.indices.bucket];let _=X[te.indices.path];_||(_=""),r=new zr(A,_),te.postModify(r);break}}if(r==null)throw iV(e);return r}}class hV{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fV(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function h(...I){c||(c=!0,e.apply(null,I))}function f(I){s=setTimeout(()=>{s=null,n(v,l())},I)}function m(){i&&clearTimeout(i)}function v(I,...O){if(c){m();return}if(I){m(),h.call(null,I,...O);return}if(l()||o){m(),h.call(null,I,...O);return}r<64&&(r*=2);let U;a===1?(a=2,U=0):U=(r+Math.random())*1e3,f(U)}let w=!1;function x(I){w||(w=!0,m(),!c&&(s!==null?(I||(a=2),clearTimeout(s),f(0)):I||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,x(!0)},t),x}function pV(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mV(n){return n!==void 0}function gV(n){return typeof n=="object"&&!Array.isArray(n)}function bv(n){return typeof n=="string"||n instanceof String}function G_(n){return wv()&&n instanceof Blob}function wv(){return typeof Blob<"u"}function W_(n,e,t,r){if(r<e)throw Am(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw Am(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sf(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function pT(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var Go;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Go||(Go={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vV(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(e,t,r,s,i,o,a,l,c,h,f,m=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=f,this.retry=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((v,w)=>{this.resolve_=v,this.reject_=w,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Nd(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Go.NO_ERROR,l=i.getStatus();if(!a||vV(l,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===Go.ABORT;r(!1,new Nd(!1,null,h));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new Nd(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());mV(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=_v();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?fT():sV();o(l)}else{const l=rV();o(l)}};this.canceled_?t(!1,new Nd(!1,null,!0)):this.backoffId_=fV(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&pV(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Nd{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function _V(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function bV(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function wV(n,e){e&&(n["X-Firebase-GMPID"]=e)}function xV(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function IV(n,e,t,r,s,i,o=!0){const a=pT(n.urlParams),l=n.url+a,c=Object.assign({},n.headers);return wV(c,e),_V(c,t),bV(c,i),xV(c,r),new yV(l,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EV(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function TV(...n){const e=EV();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(wv())return new Blob(n);throw new vn(gn.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function AV(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SV(n){if(typeof atob>"u")throw cV("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Dp{constructor(e,t){this.data=e,this.contentType=t||null}}function PV(n,e){switch(n){case Ps.RAW:return new Dp(mT(e));case Ps.BASE64:case Ps.BASE64URL:return new Dp(gT(n,e));case Ps.DATA_URL:return new Dp(CV(e),kV(e))}throw _v()}function mT(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function RV(n){let e;try{e=decodeURIComponent(n)}catch{throw Yu(Ps.DATA_URL,"Malformed data URL.")}return mT(e)}function gT(n,e){switch(n){case Ps.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Yu(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Ps.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Yu(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=SV(e)}catch(s){throw s.message.includes("polyfill")?s:Yu(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class vT{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Yu(Ps.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=DV(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function CV(n){const e=new vT(n);return e.base64?gT(Ps.BASE64,e.rest):RV(e.rest)}function kV(n){return new vT(n).contentType}function DV(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(e,t){let r=0,s="";G_(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(G_(this.data_)){const r=this.data_,s=AV(r,e,t);return s===null?null:new Ui(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Ui(r,!0)}}static getBlob(...e){if(wv()){const t=e.map(r=>r instanceof Ui?r.data_:r);return new Ui(TV.apply(null,t))}else{const t=e.map(o=>bv(o)?PV(Ps.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Ui(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yT(n){let e;try{e=JSON.parse(n)}catch{return null}return gV(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NV(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function OV(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function _T(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VV(n,e){return e}class gr{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||VV}}let Od=null;function MV(n){return!bv(n)||n.length<2?n:_T(n)}function bT(){if(Od)return Od;const n=[];n.push(new gr("bucket")),n.push(new gr("generation")),n.push(new gr("metageneration")),n.push(new gr("name","fullPath",!0));function e(i,o){return MV(o)}const t=new gr("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new gr("size");return s.xform=r,n.push(s),n.push(new gr("timeCreated")),n.push(new gr("updated")),n.push(new gr("md5Hash",null,!0)),n.push(new gr("cacheControl",null,!0)),n.push(new gr("contentDisposition",null,!0)),n.push(new gr("contentEncoding",null,!0)),n.push(new gr("contentLanguage",null,!0)),n.push(new gr("contentType",null,!0)),n.push(new gr("metadata","customMetadata",!0)),Od=n,Od}function LV(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new zr(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function $V(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return LV(r,n),r}function wT(n,e,t){const r=yT(e);return r===null?null:$V(n,r,t)}function FV(n,e,t,r){const s=yT(e);if(s===null||!bv(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const h=n.bucket,f=n.fullPath,m="/b/"+o(h)+"/o/"+o(f),v=Sf(m,t,r),w=pT({alt:"media",token:c});return v+w})[0]}function UV(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class xv{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xT(n){if(!n)throw _v()}function jV(n,e){function t(r,s){const i=wT(n,s,e);return xT(i!==null),i}return t}function BV(n,e){function t(r,s){const i=wT(n,s,e);return xT(i!==null),FV(i,s,n.host,n._protocol)}return t}function IT(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=tV():s=eV():t.getStatus()===402?s=ZO(n.bucket):t.getStatus()===403?s=nV(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function ET(n){const e=IT(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=XO(n.path)),i.serverResponse=s.serverResponse,i}return t}function qV(n,e,t){const r=e.fullServerUrl(),s=Sf(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new xv(s,i,BV(n,t),o);return a.errorHandler=ET(e),a}function zV(n,e){const t=e.fullServerUrl(),r=Sf(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,c){}const a=new xv(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=ET(e),a}function HV(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function KV(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=HV(null,e)),r}function GV(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let U="";for(let q=0;q<2;q++)U=U+Math.random().toString().slice(2);return U}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=KV(e,r,s),h=UV(c,t),f="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,m=`\r
--`+l+"--",v=Ui.getBlob(f,r,m);if(v===null)throw lV();const w={name:c.fullPath},x=Sf(i,n.host,n._protocol),I="POST",O=n.maxUploadRetryTime,L=new xv(x,I,jV(n,t),O);return L.urlParams=w,L.headers=o,L.body=v.uploadData(),L.errorHandler=IT(e),L}class WV{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Go.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Go.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Go.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s){if(this.sent_)throw Su("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Su("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Su("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Su("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Su("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class QV extends WV{initXhr(){this.xhr_.responseType="text"}}function Iv(){return new QV}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e,t){this._service=e,t instanceof zr?this._location=t:this._location=zr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new aa(e,t)}get root(){const e=new zr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return _T(this._location.path)}get storage(){return this._service}get parent(){const e=NV(this._location.path);if(e===null)return null;const t=new zr(this._location.bucket,e);return new aa(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw dV(e)}}function JV(n,e,t){n._throwIfRoot("uploadBytes");const r=GV(n.storage,n._location,bT(),new Ui(e,!0),t);return n.storage.makeRequestWithTokens(r,Iv).then(s=>({metadata:s,ref:n}))}function YV(n){n._throwIfRoot("getDownloadURL");const e=qV(n.storage,n._location,bT());return n.storage.makeRequestWithTokens(e,Iv).then(t=>{if(t===null)throw uV();return t})}function XV(n){n._throwIfRoot("deleteObject");const e=zV(n.storage,n._location);return n.storage.makeRequestWithTokens(e,Iv)}function ZV(n,e){const t=OV(n._location.path,e),r=new zr(n._location.bucket,t);return new aa(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eM(n){return/^[A-Za-z]+:\/\//.test(n)}function tM(n,e){return new aa(n,e)}function TT(n,e){if(n instanceof Ev){const t=n;if(t._bucket==null)throw aV();const r=new aa(t,t._bucket);return e!=null?TT(r,e):r}else return e!==void 0?ZV(n,e):n}function nM(n,e){if(e&&eM(e)){if(n instanceof Ev)return tM(n,e);throw Am("To use ref(service, url), the first argument must be a Storage instance.")}else return TT(n,e)}function Q_(n,e){const t=e==null?void 0:e[hT];return t==null?null:zr.makeFromBucketSpec(t,n)}function rM(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken=typeof s=="string"?s:dx(s,n.app.options.projectId))}class Ev{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=dT,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=JO,this._maxUploadRetryTime=YO,this._requests=new Set,s!=null?this._bucket=zr.makeFromBucketSpec(s,this._host):this._bucket=Q_(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=zr.makeFromBucketSpec(this._url,e):this._bucket=Q_(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){W_("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){W_("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new aa(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new hV(fT());{const o=IV(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const J_="@firebase/storage",Y_="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT="storage";function sM(n,e,t){return n=De(n),JV(n,e,t)}function iM(n){return n=De(n),YV(n)}function oM(n){return n=De(n),XV(n)}function ST(n,e){return n=De(n),nM(n,e)}function aM(n=Ml(),e){n=De(n);const r=ci(n,AT).getImmediate({identifier:e}),s=lx("storage");return s&&lM(r,...s),r}function lM(n,e,t,r={}){rM(n,e,t,r)}function uM(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Ev(t,r,s,e,ca)}function cM(){hs(new Zr(AT,uM,"PUBLIC").setMultipleInstances(!0)),Nr(J_,Y_,""),Nr(J_,Y_,"esm2017")}cM();function Tv(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CG={PHONE:"phone",TOTP:"totp"},kG={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},DG={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},NG={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},OG={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dM(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function PT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const VG=dM,hM=PT,RT=new ua("auth","Firebase",PT()),MG={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kh=new ug("@firebase/auth");function fM(n,...e){kh.logLevel<=_t.WARN&&kh.warn(`Auth (${ca}): ${n}`,...e)}function eh(n,...e){kh.logLevel<=_t.ERROR&&kh.error(`Auth (${ca}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Or(n,...e){throw Sv(n,...e)}function wr(n,...e){return Sv(n,...e)}function Av(n,e,t){const r=Object.assign(Object.assign({},hM()),{[e]:t});return new ua("auth","Firebase",r).create(e,{appName:n.name})}function zn(n){return Av(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Gl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Or(n,"argument-error"),Av(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Sv(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return RT.create(n,...e)}function we(n,e,...t){if(!n)throw Sv(e,...t)}function Rs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw eh(e),new Error(e)}function oi(n,e){n||Rs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Pv(){return X_()==="http:"||X_()==="https:"}function X_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pM(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Pv()||AR()||"connection"in navigator)?navigator.onLine:!0}function mM(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e,t){this.shortDelay=e,this.longDelay=t,oi(t>e,"Short delay should be less than long delay!"),this.isMobile=IR()||SR()}get(){return pM()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rv(n,e){oi(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Rs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Rs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Rs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vM=new ed(3e4,6e4);function Xt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Zt(n,e,t,r,s={}){return kT(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Vl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return TR()||(c.referrerPolicy="no-referrer"),CT.fetch()(DT(n,n.config.apiHost,t,a),c)})}async function kT(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},gM),e);try{const s=new _M(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw $u(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw $u(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw $u(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw $u(n,"user-disabled",o);const h=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Av(n,h,c);Or(n,h)}}catch(s){if(s instanceof ps)throw s;Or(n,"network-request-failed",{message:String(s)})}}async function mi(n,e,t,r,s={}){const i=await Zt(n,e,t,r,s);return"mfaPendingCredential"in i&&Or(n,"multi-factor-auth-required",{_serverResponse:i}),i}function DT(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Rv(n.config,s):`${n.config.apiScheme}://${s}`}function yM(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _M{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(wr(this.auth,"network-request-failed")),vM.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function $u(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=wr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z_(n){return n!==void 0&&n.getResponse!==void 0}function eb(n){return n!==void 0&&n.enterprise!==void 0}class NT{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return yM(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bM(n){return(await Zt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function OT(n,e){return Zt(n,"GET","/v2/recaptchaConfig",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wM(n,e){return Zt(n,"POST","/v1/accounts:delete",e)}async function xM(n,e){return Zt(n,"POST","/v1/accounts:update",e)}async function VT(n,e){return Zt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LG(n,e=!1){return De(n).getIdToken(e)}async function IM(n,e=!1){const t=De(n),r=await t.getIdToken(e),s=Pf(r);we(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Xu(Np(s.auth_time)),issuedAtTime:Xu(Np(s.iat)),expirationTime:Xu(Np(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Np(n){return Number(n)*1e3}function Pf(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return eh("JWT malformed, contained fewer than 3 sections"),null;try{const s=ox(t);return s?JSON.parse(s):(eh("Failed to decode base64 JWT payload"),null)}catch(s){return eh("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function tb(n){const e=Pf(n);return we(e,"internal-error"),we(typeof e.exp<"u","internal-error"),we(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ai(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ps&&EM(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function EM({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TM{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xu(this.lastLoginAt),this.creationTime=Xu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rc(n){var e;const t=n.auth,r=await n.getIdToken(),s=await ai(n,VT(t,{idToken:r}));we(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?MT(i.providerUserInfo):[],a=SM(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),h=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Sm(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(n,f)}async function AM(n){const e=De(n);await Rc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function SM(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function MT(n){return n.map(e=>{var{providerId:t}=e,r=Tv(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PM(n,e){const t=await kT(n,{},async()=>{const r=Vl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=DT(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",CT.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function RM(n,e){return Zt(n,"POST","/v2/accounts:revokeToken",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ul{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){we(e.idToken,"internal-error"),we(typeof e.idToken<"u","internal-error"),we(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):tb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){we(e.length!==0,"internal-error");const t=tb(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(we(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await PM(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ul;return r&&(we(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(we(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(we(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ul,this.toJSON())}_performRefresh(){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ci(n,e){we(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ks{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Tv(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new TM(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Sm(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ai(this,this.stsTokenManager.getToken(this.auth,e));return we(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return IM(this,e)}reload(){return AM(this)}_assign(e){this!==e&&(we(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ks(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){we(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Rc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(En(this.auth.app))return Promise.reject(zn(this.auth));const e=await this.getIdToken();return await ai(this,wM(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,h;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,m=(s=t.email)!==null&&s!==void 0?s:void 0,v=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,w=(o=t.photoURL)!==null&&o!==void 0?o:void 0,x=(a=t.tenantId)!==null&&a!==void 0?a:void 0,I=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,O=(c=t.createdAt)!==null&&c!==void 0?c:void 0,L=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:U,emailVerified:q,isAnonymous:te,providerData:X,stsTokenManager:A}=t;we(U&&A,e,"internal-error");const _=ul.fromJSON(this.name,A);we(typeof U=="string",e,"internal-error"),Ci(f,e.name),Ci(m,e.name),we(typeof q=="boolean",e,"internal-error"),we(typeof te=="boolean",e,"internal-error"),Ci(v,e.name),Ci(w,e.name),Ci(x,e.name),Ci(I,e.name),Ci(O,e.name),Ci(L,e.name);const T=new Ks({uid:U,auth:e,email:m,emailVerified:q,displayName:f,isAnonymous:te,photoURL:w,phoneNumber:v,tenantId:x,stsTokenManager:_,createdAt:O,lastLoginAt:L});return X&&Array.isArray(X)&&(T.providerData=X.map(k=>Object.assign({},k))),I&&(T._redirectEventId=I),T}static async _fromIdTokenResponse(e,t,r=!1){const s=new ul;s.updateFromServerResponse(t);const i=new Ks({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Rc(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];we(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?MT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ul;a.updateFromIdToken(r);const l=new Ks({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Sm(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nb=new Map;function Gs(n){oi(n instanceof Function,"Expected a class definition");let e=nb.get(n);return e?(oi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,nb.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}LT.type="NONE";const rb=LT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function th(n,e,t){return`firebase:${n}:${e}:${t}`}class cl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=th(this.userKey,s.apiKey,i),this.fullPersistenceKey=th("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ks._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new cl(Gs(rb),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Gs(rb);const o=th(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const h=await c._get(o);if(h){const f=Ks._fromJSON(e,h);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new cl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new cl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sb(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(jT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($T(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(qT(e))return"Blackberry";if(zT(e))return"Webos";if(FT(e))return"Safari";if((e.includes("chrome/")||UT(e))&&!e.includes("edge/"))return"Chrome";if(BT(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function $T(n=Ln()){return/firefox\//i.test(n)}function FT(n=Ln()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function UT(n=Ln()){return/crios\//i.test(n)}function jT(n=Ln()){return/iemobile/i.test(n)}function BT(n=Ln()){return/android/i.test(n)}function qT(n=Ln()){return/blackberry/i.test(n)}function zT(n=Ln()){return/webos/i.test(n)}function Cv(n=Ln()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function CM(n=Ln()){var e;return Cv(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function kM(){return PR()&&document.documentMode===10}function HT(n=Ln()){return Cv(n)||BT(n)||zT(n)||qT(n)||/windows phone/i.test(n)||jT(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KT(n,e=[]){let t;switch(n){case"Browser":t=sb(Ln());break;case"Worker":t=`${sb(Ln())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ca}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DM{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NM(n,e={}){return Zt(n,"GET","/v2/passwordPolicy",Xt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OM=6;class VM{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:OM,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MM{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ib(this),this.idTokenSubscription=new ib(this),this.beforeStateQueue=new DM(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=RT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Gs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await cl.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await VT(this,{idToken:e}),r=await Ks._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(En(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return we(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Rc(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=mM()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(En(this.app))return Promise.reject(zn(this));const t=e?De(e):null;return t&&we(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&we(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return En(this.app)?Promise.reject(zn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return En(this.app)?Promise.reject(zn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Gs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await NM(this),t=new VM(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ua("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await RM(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Gs(e)||this._popupRedirectResolver;we(t,this,"argument-error"),this.redirectPersistenceManager=await cl.create(this,[Gs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(we(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return we(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=KT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&fM(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function yn(n){return De(n)}class ib{constructor(e){this.auth=e,this.observer=null,this.addObserver=OR(t=>this.observer=t)}get next(){return we(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let td={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function LM(n){td=n}function kv(n){return td.loadJS(n)}function $M(){return td.recaptchaV2Script}function FM(){return td.recaptchaEnterpriseScript}function UM(){return td.gapiScript}function GT(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const jM="recaptcha-enterprise",BM="NO_RECAPTCHA";class WT{constructor(e){this.type=jM,this.auth=yn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{OT(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new NT(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;eb(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(BM)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&eb(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=FM();l.length!==0&&(l+=a),kv(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function ob(n,e,t,r=!1){const s=new WT(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Cc(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await ob(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await ob(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function qM(n){const e=yn(n),t=await OT(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new NT(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new WT(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zM(n,e){const t=ci(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(eo(i,e??{}))return s;Or(s,"already-initialized")}return t.initialize({options:e})}function HM(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Gs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function KM(n,e,t){const r=yn(n);we(r._canInitEmulator,r,"emulator-config-failed"),we(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=QT(e),{host:o,port:a}=GM(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||WM()}function QT(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function GM(n){const e=QT(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ab(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ab(o)}}}function ab(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function WM(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Rs("not implemented")}_getIdTokenResponse(e){return Rs("not implemented")}_linkToIdToken(e,t){return Rs("not implemented")}_getReauthenticationResolver(e){return Rs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JT(n,e){return Zt(n,"POST","/v1/accounts:resetPassword",Xt(n,e))}async function QM(n,e){return Zt(n,"POST","/v1/accounts:update",e)}async function JM(n,e){return Zt(n,"POST","/v1/accounts:signUp",e)}async function YM(n,e){return Zt(n,"POST","/v1/accounts:update",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XM(n,e){return mi(n,"POST","/v1/accounts:signInWithPassword",Xt(n,e))}async function Rf(n,e){return Zt(n,"POST","/v1/accounts:sendOobCode",Xt(n,e))}async function ZM(n,e){return Rf(n,e)}async function eL(n,e){return Rf(n,e)}async function tL(n,e){return Rf(n,e)}async function nL(n,e){return Rf(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rL(n,e){return mi(n,"POST","/v1/accounts:signInWithEmailLink",Xt(n,e))}async function sL(n,e){return mi(n,"POST","/v1/accounts:signInWithEmailLink",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc extends nd{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new kc(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new kc(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cc(e,t,"signInWithPassword",XM);case"emailLink":return rL(e,{email:this._email,oobCode:this._password});default:Or(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Cc(e,r,"signUpPassword",JM);case"emailLink":return sL(e,{idToken:t,email:this._email,oobCode:this._password});default:Or(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zs(n,e){return mi(n,"POST","/v1/accounts:signInWithIdp",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iL="http://localhost";class li extends nd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new li(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Or("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Tv(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new li(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Zs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Zs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Zs(e,t)}buildRequest(){const e={requestUri:iL,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Vl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oL(n,e){return Zt(n,"POST","/v1/accounts:sendVerificationCode",Xt(n,e))}async function aL(n,e){return mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Xt(n,e))}async function lL(n,e){const t=await mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Xt(n,e));if(t.temporaryProof)throw $u(n,"account-exists-with-different-credential",t);return t}const uL={USER_NOT_FOUND:"user-not-found"};async function cL(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return mi(n,"POST","/v1/accounts:signInWithPhoneNumber",Xt(n,t),uL)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo extends nd{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Wo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Wo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return aL(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return lL(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return cL(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Wo({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dL(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function hL(n){const e=Du(Nu(n)).link,t=e?Du(Nu(e)).deep_link_id:null,r=Du(Nu(n)).deep_link_id;return(r?Du(Nu(r)).link:null)||r||t||e||n}class rd{constructor(e){var t,r,s,i,o,a;const l=Du(Nu(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,h=(r=l.oobCode)!==null&&r!==void 0?r:null,f=dL((s=l.mode)!==null&&s!==void 0?s:null);we(c&&h&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=h,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=hL(e);try{return new rd(t)}catch{return null}}}function $G(n){return rd.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(){this.providerId=ga.PROVIDER_ID}static credential(e,t){return kc._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=rd.parseLink(t);return we(r,"argument-error"),kc._fromEmailAndCode(e,r.code,r.tenantId)}}ga.PROVIDER_ID="password";ga.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ga.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wl extends gi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nh extends Wl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return we("providerId"in t&&"signInMethod"in t,"argument-error"),li._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return we(e.idToken||e.accessToken,"argument-error"),li._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return nh.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return nh.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new nh(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji extends Wl{constructor(){super("facebook.com")}static credential(e){return li._fromParams({providerId:ji.PROVIDER_ID,signInMethod:ji.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ji.credentialFromTaggedObject(e)}static credentialFromError(e){return ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ji.credential(e.oauthAccessToken)}catch{return null}}}ji.FACEBOOK_SIGN_IN_METHOD="facebook.com";ji.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi extends Wl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return li._fromParams({providerId:Bi.PROVIDER_ID,signInMethod:Bi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Bi.credentialFromTaggedObject(e)}static credentialFromError(e){return Bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Bi.credential(t,r)}catch{return null}}}Bi.GOOGLE_SIGN_IN_METHOD="google.com";Bi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi extends Wl{constructor(){super("github.com")}static credential(e){return li._fromParams({providerId:qi.PROVIDER_ID,signInMethod:qi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qi.credentialFromTaggedObject(e)}static credentialFromError(e){return qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qi.credential(e.oauthAccessToken)}catch{return null}}}qi.GITHUB_SIGN_IN_METHOD="github.com";qi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fL="http://localhost";class Dc extends nd{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Zs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Zs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Zs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Dc(r,i)}static _create(e,t){return new Dc(e,t)}buildRequest(){return{requestUri:fL,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pL="saml.";class Pm extends gi{constructor(e){we(e.startsWith(pL),"argument-error"),super(e)}static credentialFromResult(e){return Pm.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Pm.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Dc.fromJSON(e);return we(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Dc._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi extends Wl{constructor(){super("twitter.com")}static credential(e,t){return li._fromParams({providerId:zi.PROVIDER_ID,signInMethod:zi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return zi.credentialFromTaggedObject(e)}static credentialFromError(e){return zi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return zi.credential(t,r)}catch{return null}}}zi.TWITTER_SIGN_IN_METHOD="twitter.com";zi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YT(n,e){return mi(n,"POST","/v1/accounts:signUp",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Ks._fromIdTokenResponse(e,r,s),o=lb(r);return new ts({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=lb(r);return new ts({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function lb(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XT(n){var e;if(En(n.app))return Promise.reject(zn(n));const t=yn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new ts({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await YT(t,{returnSecureToken:!0}),s=await ts._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh extends ps{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Dh.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Dh(e,t,r,s)}}function ZT(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Dh._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eA(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FG(n,e){const t=De(n);await Cf(!0,t,e);const{providerUserInfo:r}=await xM(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=eA(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Dv(n,e,t=!1){const r=await ai(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ts._forOperation(n,"link",r)}async function Cf(n,e,t){await Rc(e);const r=eA(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";we(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tA(n,e,t=!1){const{auth:r}=n;if(En(r.app))return Promise.reject(zn(r));const s="reauthenticate";try{const i=await ai(n,ZT(r,s,e,n),t);we(i.idToken,r,"internal-error");const o=Pf(i.idToken);we(o,r,"internal-error");const{sub:a}=o;return we(n.uid===a,r,"user-mismatch"),ts._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Or(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nA(n,e,t=!1){if(En(n.app))return Promise.reject(zn(n));const r="signIn",s=await ZT(n,r,e),i=await ts._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Nv(n,e){return nA(yn(n),e)}async function mL(n,e){const t=De(n);return await Cf(!1,t,e.providerId),Dv(t,e)}async function gL(n,e){return tA(De(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vL(n,e){return mi(n,"POST","/v1/accounts:signInWithCustomToken",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UG(n,e){if(En(n.app))return Promise.reject(zn(n));const t=yn(n),r=await vL(t,{token:e,returnSecureToken:!0}),s=await ts._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Ov._fromServerResponse(e,t):"totpInfo"in t?Vv._fromServerResponse(e,t):Or(e,"internal-error")}}class Ov extends sd{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Ov(t)}}class Vv extends sd{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Vv(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kf(n,e,t){var r;we(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),we(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(we(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(we(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mv(n){const e=yn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function yL(n,e,t){const r=yn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&kf(r,s,t),await Cc(r,s,"getOobCode",eL)}async function _L(n,e,t){await JT(De(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Mv(n),r})}async function jG(n,e){await YM(De(n),{oobCode:e})}async function bL(n,e){const t=De(n),r=await JT(t,{oobCode:e}),s=r.requestType;switch(we(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":we(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":we(r.mfaInfo,t,"internal-error");default:we(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=sd._fromServerResponse(yn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function wL(n,e){const{data:t}=await bL(De(n),e);return t.email}async function xL(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=yn(n),o=await Cc(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",YT).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Mv(n),l}),a=await ts._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function rA(n,e,t){return En(n.app)?Promise.reject(zn(n)):Nv(De(n),ga.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Mv(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BG(n,e,t){const r=yn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){we(a.handleCodeInApp,r,"argument-error"),a&&kf(r,o,a)}i(s,t),await Cc(r,s,"getOobCode",tL)}function qG(n,e){const t=rd.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function zG(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=De(n),s=ga.credentialWithLink(e,t||Pc());return we(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Nv(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IL(n,e){return Zt(n,"POST","/v1/accounts:createAuthUri",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HG(n,e){const t=Pv()?Pc():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await IL(De(n),r);return s||[]}async function KG(n,e){const t=De(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&kf(t.auth,s,e);const{email:i}=await ZM(t.auth,s);i!==n.email&&await n.reload()}async function GG(n,e,t){const r=De(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&kf(r.auth,i,t);const{email:o}=await nL(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EL(n,e){return Zt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WG(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=De(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await ai(r,EL(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function TL(n,e){const t=De(n);return En(t.auth.app)?Promise.reject(zn(t.auth)):sA(t,e,null)}function AL(n,e){return sA(De(n),null,e)}async function sA(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await ai(n,QM(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SL(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Pf(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new dl(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new PL(i,s);case"github.com":return new RL(i,s);case"google.com":return new CL(i,s);case"twitter.com":return new kL(i,s,n.screenName||null);case"custom":case"anonymous":return new dl(i,null);default:return new dl(i,r,s)}}class dl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class iA extends dl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class PL extends dl{constructor(e,t){super(e,"facebook.com",t)}}class RL extends iA{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class CL extends dl{constructor(e,t){super(e,"google.com",t)}}class kL extends iA{constructor(e,t,r){super(e,"twitter.com",t,r)}}function QG(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:SL(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DL(n,e){return De(n).setPersistence(e)}function JG(n){return qM(n)}async function YG(n,e){return yn(n).validatePassword(e)}function NL(n,e,t,r){return De(n).onIdTokenChanged(e,t,r)}function OL(n,e,t){return De(n).beforeAuthStateChanged(e,t)}function VL(n,e,t,r){return De(n).onAuthStateChanged(e,t,r)}function XG(n){De(n).useDeviceLanguage()}function ZG(n,e){return De(n).updateCurrentUser(e)}function ML(n){return De(n).signOut()}function e7(n,e){return yn(n).revokeAccessToken(e)}async function t7(n){return De(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new qo("enroll",e,t)}static _fromMfaPendingCredential(e){return new qo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return qo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return qo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=yn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>sd._fromServerResponse(r,a));we(s.mfaPendingCredential,r,"internal-error");const o=qo._fromMfaPendingCredential(s.mfaPendingCredential);return new Lv(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const h=await ts._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(h.user),h;case"reauthenticate":return we(t.user,r,"internal-error"),ts._forOperation(t.user,t.operationType,c);default:Or(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function n7(n,e){var t;const r=De(n),s=e;return we(e.customData.operationType,r,"argument-error"),we((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Lv._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LL(n,e){return Zt(n,"POST","/v2/accounts/mfaEnrollment:start",Xt(n,e))}function $L(n,e){return Zt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Xt(n,e))}function FL(n,e){return Zt(n,"POST","/v2/accounts/mfaEnrollment:start",Xt(n,e))}function UL(n,e){return Zt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Xt(n,e))}function jL(n,e){return Zt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Xt(n,e))}class $v{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>sd._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new $v(e)}async getSession(){return qo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await ai(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await ai(this.user,jL(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Op=new WeakMap;function r7(n){const e=De(n);return Op.has(e)||Op.set(e,$v._fromUser(e)),Op.get(e)}const Nh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Nh,"1"),this.storage.removeItem(Nh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BL=1e3,qL=10;class aA extends oA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=HT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);kM()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,qL):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},BL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}aA.type="LOCAL";const lA=aA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uA extends oA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}uA.type="SESSION";const cA=uA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zL(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Df(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await zL(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Df.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HL{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Nf("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===c)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(){return window}function KL(n){Dn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fv(){return typeof Dn().WorkerGlobalScope<"u"&&typeof Dn().importScripts=="function"}async function GL(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function WL(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function QL(){return Fv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dA="firebaseLocalStorageDb",JL=1,Oh="firebaseLocalStorage",hA="fbase_key";class id{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Of(n,e){return n.transaction([Oh],e?"readwrite":"readonly").objectStore(Oh)}function YL(){const n=indexedDB.deleteDatabase(dA);return new id(n).toPromise()}function Rm(){const n=indexedDB.open(dA,JL);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Oh,{keyPath:hA})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Oh)?e(r):(r.close(),await YL(),e(await Rm()))})})}async function ub(n,e,t){const r=Of(n,!0).put({[hA]:e,value:t});return new id(r).toPromise()}async function XL(n,e){const t=Of(n,!1).get(e),r=await new id(t).toPromise();return r===void 0?null:r.value}function cb(n,e){const t=Of(n,!0).delete(e);return new id(t).toPromise()}const ZL=800,e4=3;class fA{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Rm(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>e4)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Df._getInstance(QL()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await GL(),!this.activeServiceWorker)return;this.sender=new HL(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||WL()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Rm();return await ub(e,Nh,"1"),await cb(e,Nh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>ub(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>XL(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>cb(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Of(s,!1).getAll();return new id(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ZL)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}fA.type="LOCAL";const t4=fA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n4(n,e){return Zt(n,"POST","/v2/accounts/mfaSignIn:start",Xt(n,e))}function r4(n,e){return Zt(n,"POST","/v2/accounts/mfaSignIn:finalize",Xt(n,e))}function s4(n,e){return Zt(n,"POST","/v2/accounts/mfaSignIn:finalize",Xt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i4=500,o4=6e4,Vd=1e12;class a4{constructor(e){this.auth=e,this.counter=Vd,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new l4(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Vd;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Vd;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Vd;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class l4{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;we(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=u4(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},o4)},i4))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function u4(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vp=GT("rcb"),c4=new ed(3e4,6e4);class d4{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Dn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return we(h4(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Z_(Dn().grecaptcha)?Promise.resolve(Dn().grecaptcha):new Promise((r,s)=>{const i=Dn().setTimeout(()=>{s(wr(e,"network-request-failed"))},c4.get());Dn()[Vp]=()=>{Dn().clearTimeout(i),delete Dn()[Vp];const a=Dn().grecaptcha;if(!a||!Z_(a)){s(wr(e,"internal-error"));return}const l=a.render;a.render=(c,h)=>{const f=l(c,h);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${$M()}?${Vl({onload:Vp,render:"explicit",hl:t})}`;kv(o).catch(()=>{clearTimeout(i),s(wr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Dn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function h4(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class f4{async load(e){return new a4(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pA="recaptcha",p4={theme:"light",type:"image"};class s7{constructor(e,t,r=Object.assign({},p4)){this.parameters=r,this.type=pA,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=yn(e),this.isInvisible=this.parameters.size==="invisible",we(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;we(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new f4:new d4,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){we(!this.parameters.sitekey,this.auth,"argument-error"),we(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),we(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Dn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){we(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){we(Pv()&&!Fv(),this.auth,"internal-error"),await m4(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await bM(this.auth);we(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return we(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function m4(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Wo._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function i7(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=yn(n),s=await Vf(r,e,De(t));return new Uv(s,i=>Nv(r,i))}async function o7(n,e,t){const r=De(n);await Cf(!1,r,"phone");const s=await Vf(r.auth,e,De(t));return new Uv(s,i=>mL(r,i))}async function a7(n,e,t){const r=De(n);if(En(r.auth.app))return Promise.reject(zn(r.auth));const s=await Vf(r.auth,e,De(t));return new Uv(s,i=>gL(r,i))}async function Vf(n,e,t){var r;const s=await t.verify();try{we(typeof s=="string",n,"argument-error"),we(t.type===pA,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return we(o.type==="enroll",n,"internal-error"),(await LL(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{we(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return we(a,n,"missing-multi-factor-info"),(await n4(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await oL(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function l7(n,e){const t=De(n);if(En(t.auth.app))return Promise.reject(zn(t.auth));await Dv(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this.providerId=hl.PROVIDER_ID,this.auth=yn(e)}verifyPhoneNumber(e,t){return Vf(this.auth,e,De(t))}static credential(e,t){return Wo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return hl.credentialFromTaggedObject(t)}static credentialFromError(e){return hl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Wo._fromTokenResponse(t,r):null}}hl.PROVIDER_ID="phone";hl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function va(n,e){return e?Gs(e):(we(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jv extends nd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Zs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Zs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Zs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function g4(n){return nA(n.auth,new jv(n),n.bypassAuthState)}function v4(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),tA(t,new jv(n),n.bypassAuthState)}async function y4(n){const{auth:e,user:t}=n;return we(t,e,"internal-error"),Dv(t,new jv(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mA{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return g4;case"linkViaPopup":case"linkViaRedirect":return y4;case"reauthViaPopup":case"reauthViaRedirect":return v4;default:Or(this.auth,"internal-error")}}resolve(e){oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4=new ed(2e3,1e4);async function u7(n,e,t){if(En(n.app))return Promise.reject(wr(n,"operation-not-supported-in-this-environment"));const r=yn(n);Gl(n,e,gi);const s=va(r,t);return new Ws(r,"signInViaPopup",e,s).executeNotNull()}async function c7(n,e,t){const r=De(n);if(En(r.auth.app))return Promise.reject(wr(r.auth,"operation-not-supported-in-this-environment"));Gl(r.auth,e,gi);const s=va(r.auth,t);return new Ws(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function d7(n,e,t){const r=De(n);Gl(r.auth,e,gi);const s=va(r.auth,t);return new Ws(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Ws extends mA{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ws.currentPopupAction&&Ws.currentPopupAction.cancel(),Ws.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return we(e,this.auth,"internal-error"),e}async onExecution(){oi(this.filter.length===1,"Popup operations only handle one event");const e=Nf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(wr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(wr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ws.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(wr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,_4.get())};e()}}Ws.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4="pendingRedirect",rh=new Map;class w4 extends mA{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=rh.get(this.auth._key());if(!e){try{const r=await x4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}rh.set(this.auth._key(),e)}return this.bypassAuthState||rh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function x4(n,e){const t=vA(e),r=gA(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Bv(n,e){return gA(n)._set(vA(e),"true")}function I4(n,e){rh.set(n._key(),e)}function gA(n){return Gs(n._redirectPersistence)}function vA(n){return th(b4,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h7(n,e,t){return E4(n,e,t)}async function E4(n,e,t){if(En(n.app))return Promise.reject(zn(n));const r=yn(n);Gl(n,e,gi),await r._initializationPromise;const s=va(r,t);return await Bv(s,r),s._openRedirect(r,e,"signInViaRedirect")}function f7(n,e,t){return T4(n,e,t)}async function T4(n,e,t){const r=De(n);if(Gl(r.auth,e,gi),En(r.auth.app))return Promise.reject(zn(r.auth));await r.auth._initializationPromise;const s=va(r.auth,t);await Bv(s,r.auth);const i=await _A(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function p7(n,e,t){return A4(n,e,t)}async function A4(n,e,t){const r=De(n);Gl(r.auth,e,gi),await r.auth._initializationPromise;const s=va(r.auth,t);await Cf(!1,r,e.providerId),await Bv(s,r.auth);const i=await _A(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function m7(n,e){return await yn(n)._initializationPromise,yA(n,e,!1)}async function yA(n,e,t=!1){if(En(n.app))return Promise.reject(zn(n));const r=yn(n),s=va(r,e),o=await new w4(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function _A(n){const e=Nf(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S4=10*60*1e3;class P4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!R4(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!bA(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(wr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=S4&&this.cachedEventUids.clear(),this.cachedEventUids.has(db(e))}saveEventToCache(e){this.cachedEventUids.add(db(e)),this.lastProcessedEventTime=Date.now()}}function db(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function bA({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function R4(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bA(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C4(n,e={}){return Zt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,D4=/^https?/;async function N4(n){if(n.config.emulator)return;const{authorizedDomains:e}=await C4(n);for(const t of e)try{if(O4(t))return}catch{}Or(n,"unauthorized-domain")}function O4(n){const e=Pc(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!D4.test(t))return!1;if(k4.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V4=new ed(3e4,6e4);function hb(){const n=Dn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function M4(n){return new Promise((e,t)=>{var r,s,i;function o(){hb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{hb(),t(wr(n,"network-request-failed"))},timeout:V4.get()})}if(!((s=(r=Dn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Dn().gapi)===null||i===void 0)&&i.load)o();else{const a=GT("iframefcb");return Dn()[a]=()=>{gapi.load?o():t(wr(n,"network-request-failed"))},kv(`${UM()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw sh=null,e})}let sh=null;function L4(n){return sh=sh||M4(n),sh}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $4=new ed(5e3,15e3),F4="__/auth/iframe",U4="emulator/auth/iframe",j4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},B4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function q4(n){const e=n.config;we(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Rv(e,U4):`https://${n.config.authDomain}/${F4}`,r={apiKey:e.apiKey,appName:n.name,v:ca},s=B4.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Vl(r).slice(1)}`}async function z4(n){const e=await L4(n),t=Dn().gapi;return we(t,n,"internal-error"),e.open({where:document.body,url:q4(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:j4,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=wr(n,"network-request-failed"),a=Dn().setTimeout(()=>{i(o)},$4.get());function l(){Dn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},K4=500,G4=600,W4="_blank",Q4="http://localhost";class fb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function J4(n,e,t,r=K4,s=G4){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},H4),{width:r.toString(),height:s.toString(),top:i,left:o}),c=Ln().toLowerCase();t&&(a=UT(c)?W4:t),$T(c)&&(e=e||Q4,l.scrollbars="yes");const h=Object.entries(l).reduce((m,[v,w])=>`${m}${v}=${w},`,"");if(CM(c)&&a!=="_self")return Y4(e||"",a),new fb(null);const f=window.open(e||"",a,h);we(f,n,"popup-blocked");try{f.focus()}catch{}return new fb(f)}function Y4(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X4="__/auth/handler",Z4="emulator/auth/handler",e3=encodeURIComponent("fac");async function pb(n,e,t,r,s,i){we(n.config.authDomain,n,"auth-domain-config-required"),we(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ca,eventId:s};if(e instanceof gi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",NR(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries(i||{}))o[h]=f}if(e instanceof Wl){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),c=l?`#${e3}=${encodeURIComponent(l)}`:"";return`${t3(n)}?${Vl(a).slice(1)}${c}`}function t3({config:n}){return n.emulator?Rv(n,Z4):`https://${n.authDomain}/${X4}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mp="webStorageSupport";class n3{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cA,this._completeRedirectFn=yA,this._overrideRedirectResult=I4}async _openPopup(e,t,r,s){var i;oi((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await pb(e,t,r,Pc(),s);return J4(e,o,Nf())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await pb(e,t,r,Pc(),s);return KL(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(oi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await z4(e),r=new P4(e);return t.register("authEvent",s=>(we(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Mp,{type:Mp},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Mp];o!==void 0&&t(!!o),Or(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=N4(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return HT()||FT()||Cv()}}const r3=n3;class wA{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Rs("unexpected MultiFactorSessionType")}}}class qv extends wA{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new qv(e)}_finalizeEnroll(e,t,r){return $L(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return r4(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class s3{constructor(){}static assertion(e){return qv._fromCredential(e)}}s3.FACTOR_ID="phone";class i3{static assertionForEnrollment(e,t){return Nc._fromSecret(e,t)}static assertionForSignIn(e,t){return Nc._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;we(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await FL(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return zv._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}i3.FACTOR_ID="totp";class Nc extends wA{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Nc(t,void 0,e)}static _fromEnrollmentId(e,t){return new Nc(t,e)}async _finalizeEnroll(e,t,r){return we(typeof this.secret<"u",e,"argument-error"),UL(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){we(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return s4(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class zv{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new zv(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Md(e)||Md(t))&&(s=!0),s&&(Md(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Md(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Md(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var mb="@firebase/auth",gb="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o3{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){we(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a3(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function l3(n){hs(new Zr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;we(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:KT(n)},c=new MM(r,s,i,l);return HM(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),hs(new Zr("auth-internal",e=>{const t=yn(e.getProvider("auth").getImmediate());return(r=>new o3(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Nr(mb,gb,a3(n)),Nr(mb,gb,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u3=5*60,c3=cx("authIdTokenMaxAge")||u3;let vb=null;const d3=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>c3)return;const s=t==null?void 0:t.token;vb!==s&&(vb=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function h3(n=Ml()){const e=ci(n,"auth");if(e.isInitialized())return e.getImmediate();const t=zM(n,{popupRedirectResolver:r3,persistence:[t4,lA,cA]}),r=cx("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=d3(i.toString());OL(t,o,()=>o(t.currentUser)),NL(t,a=>o(a))}}const s=ax("auth");return s&&KM(t,`http://${s}`),t}function f3(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}LM({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=wr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",f3().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});l3("Browser");const p3={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Hv=gx(p3),se=TO(Hv),Kv=aM(Hv),je=h3(Hv);try{AO(se)}catch{}try{DL(je,lA)}catch{}VL(je,n=>{n||XT(je)});async function m3(n,e){try{return(await xL(je,n,e)).user}catch(t){throw t}}async function xA(n,e){try{return(await rA(je,n,e)).user}catch(t){throw t}}async function Gv(n){try{await yL(je,n)}catch(e){throw e}}async function g3(n){try{const e=je.currentUser;if(e)await AL(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const us=Object.freeze(Object.defineProperty({__proto__:null,auth:je,createPlayerAccount:m3,db:se,getMessaging:yg,resetPlayerPassword:Gv,signInPlayer:xA,storage:Kv,updatePlayerPassword:g3},Symbol.toStringTag,{value:"Module"})),Cm="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function Wv(){try{return await qx()}catch{return!1}}async function IA(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function EA(n){var i;if(!await Wv()||await Notification.requestPermission()!=="granted")return null;const t=yg(Ml());let r=n||await IA();const s=await zx(t,r?{vapidKey:Cm,serviceWorkerRegistration:r}:{vapidKey:Cm});try{const o=((i=je==null?void 0:je.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await on(be(se,"userPushTokens",o),{tokens:WO(s),lastToken:s,email:o,updatedAt:xr(),userAgent:navigator.userAgent,lastActivation:xr()},{merge:!0})}catch{}return s}async function Zu(){try{const n=localStorage.getItem("fcmToken");if(n){const r=yg(Ml());try{const s=await zx(r,{vapidKey:Cm});if(s===n)return{active:!0,token:s}}catch{}}const e=await IA(),t=await EA(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function v3(){setInterval(async()=>{try{const n=await Zu();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const y3={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},_3={class:"flex items-center space-x-3"},b3={class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-6 mx-4 max-w-sm w-full transform hover:scale-105 transition-all duration-300 cursor-pointer"},w3={class:"flex justify-center"},x3={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm"},I3={__name:"App",setup(n){const e=S(null),t=S(!1),r=S(!1),s=S(!1),i=S(!1);function o(v){v.preventDefault(),e.value=v,t.value=!0;const w=localStorage.getItem("hatcast-pwa-banner-last-shown"),x=Date.now(),I=24*60*60*1e3;w&&x-parseInt(w)<I?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",x.toString())}async function a(){if(e.value){try{e.value.prompt();const{outcome:v}=await e.value.userChoice;v==="accepted"?(console.log("PWA installée avec succès"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refusée par l'utilisateur")}catch(v){console.error("Erreur lors de l'installation PWA:",v)}t.value=!1,e.value=null,i.value=!0}}function l(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function c(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function h(){const v=localStorage.getItem("hatcast-pwa-installed"),w=localStorage.getItem("hatcast-pwa-banner-dismissed");if(v==="true"){t.value=!1;return}if(w){const x=Date.now(),I=60*60*1e3;x-parseInt(w)<I&&(i.value=!0)}}function f(){s.value=!0,console.log("🚀 Début de la mise à jour PWA..."),setTimeout(async()=>{try{if(console.log("📡 Vérification du service worker..."),"serviceWorker"in navigator){const v=await navigator.serviceWorker.getRegistration();console.log("🔍 Enregistrement SW trouvé:",v),v&&v.active?(console.log("✅ Service worker actif trouvé, envoi du message SKIP_WAITING..."),v.active.postMessage({type:"SKIP_WAITING"}),console.log("📤 Message SKIP_WAITING envoyé"),await new Promise(w=>setTimeout(w,500)),console.log("⏳ Attente de 500ms terminée"),v.waiting?(console.log("🔄 Service worker en attente détecté, attente de l'activation..."),await new Promise(w=>{const x=()=>{v.waiting?(console.log("⏳ Service worker toujours en attente, nouvelle vérification dans 100ms..."),setTimeout(x,100)):(console.log("✅ Service worker activé avec succès"),w())};x()})):console.log("ℹ️ Aucun service worker en attente")):console.warn("⚠️ Aucun service worker actif trouvé")}else console.warn("⚠️ Service Worker non supporté sur cet appareil");console.log("🔄 Rechargement de la page..."),window.location.reload()}catch(v){console.error("❌ Erreur lors de la mise à jour:",v),s.value=!1,alert(`Erreur lors de la mise à jour: ${v.message}

Veuillez rafraîchir manuellement la page.`)}},1e3)}function m(){r.value=!0}return Tn(()=>{h(),Zu().then(v=>{v.active?console.log("Notifications push actives au démarrage"):console.log("Notifications push inactives au démarrage:",v.error)}),window.addEventListener("beforeinstallprompt",o),window.addEventListener("appinstalled",c),window.addEventListener("pwa-update-test",m),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",v=>{v.data&&v.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise à jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(v=>{v&&v.update()})},60*60*1e3))}),tg(()=>{window.removeEventListener("beforeinstallprompt",o),window.removeEventListener("appinstalled",c),window.removeEventListener("pwa-update-test",m)}),(v,w)=>{const x=BS("router-view");return C(),D(mt,null,[Be(x),Be(up,{name:"install-banner",appear:""},{default:Fd(()=>[t.value&&!i.value?(C(),D("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:a},[d("div",y3,[w[1]||(w[1]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:pR,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure expérience ")])],-1)),d("div",_3,[d("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:ft(a,["stop"])}," Installer "),d("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:ft(l,["stop"]),"aria-label":"Fermer la barre d'installation"},w[0]||(w[0]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):ie("",!0)]),_:1}),Be(up,{name:"update-banner",appear:""},{default:Fd(()=>[r.value&&!s.value?(C(),D("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:f},[d("div",b3,[w[3]||(w[3]=d("div",{class:"flex justify-center mb-4"},[d("div",{class:"w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])],-1)),w[4]||(w[4]=d("div",{class:"text-center mb-6"},[d("h3",{class:"text-xl font-bold text-gray-900 mb-2"}," 🎉 Nouvelle version disponible ! "),d("p",{class:"text-gray-600 leading-relaxed"}," HatCast a été amélioré avec de nouvelles fonctionnalités et corrections. Mettez à jour maintenant pour profiter des dernières améliorations. ")],-1)),d("div",w3,[d("button",{class:"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-200 flex items-center space-x-2",onClick:ft(f,["stop"])},w[2]||(w[2]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),d("span",null,"Mettre à jour maintenant",-1)]))]),w[5]||(w[5]=d("p",{class:"text-center text-xs text-gray-400 mt-4"}," Cliquez n'importe où pour fermer ",-1))])])):ie("",!0)]),_:1}),Be(up,{name:"update-progress",appear:""},{default:Fd(()=>[s.value?(C(),D("div",x3,w[6]||(w[6]=[d("div",{class:"bg-white rounded-2xl shadow-2xl border border-gray-100 p-8 mx-4 max-w-sm w-full text-center"},[d("div",{class:"flex justify-center mb-6"},[d("div",{class:"w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center shadow-lg"},[d("svg",{class:"w-10 h-10 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])])]),d("h3",{class:"text-xl font-bold text-gray-900 mb-3"}," Mise à jour en cours... "),d("p",{class:"text-gray-600"}," Veuillez patienter pendant qu'HatCast se met à jour "),d("div",{class:"mt-6 bg-gray-200 rounded-full h-2 overflow-hidden"},[d("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full animate-pulse"})])],-1)]))):ie("",!0)]),_:1})],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Xa=typeof document<"u";function TA(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function E3(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&TA(n.default)}const Vt=Object.assign;function Lp(n,e){const t={};for(const r in e){const s=e[r];t[r]=fs(s)?s.map(n):n(s)}return t}const ec=()=>{},fs=Array.isArray,AA=/#/g,T3=/&/g,A3=/\//g,S3=/=/g,P3=/\?/g,SA=/\+/g,R3=/%5B/g,C3=/%5D/g,PA=/%5E/g,k3=/%60/g,RA=/%7B/g,D3=/%7C/g,CA=/%7D/g,N3=/%20/g;function Qv(n){return encodeURI(""+n).replace(D3,"|").replace(R3,"[").replace(C3,"]")}function O3(n){return Qv(n).replace(RA,"{").replace(CA,"}").replace(PA,"^")}function km(n){return Qv(n).replace(SA,"%2B").replace(N3,"+").replace(AA,"%23").replace(T3,"%26").replace(k3,"`").replace(RA,"{").replace(CA,"}").replace(PA,"^")}function V3(n){return km(n).replace(S3,"%3D")}function M3(n){return Qv(n).replace(AA,"%23").replace(P3,"%3F")}function L3(n){return n==null?"":M3(n).replace(A3,"%2F")}function Oc(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const $3=/\/$/,F3=n=>n.replace($3,"");function $p(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=q3(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Oc(o)}}function U3(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function yb(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function j3(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Dl(e.matched[r],t.matched[s])&&kA(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Dl(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function kA(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!B3(n[t],e[t]))return!1;return!0}function B3(n,e){return fs(n)?_b(n,e):fs(e)?_b(e,n):n===e}function _b(n,e){return fs(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function q3(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const ki={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Vc;(function(n){n.pop="pop",n.push="push"})(Vc||(Vc={}));var tc;(function(n){n.back="back",n.forward="forward",n.unknown=""})(tc||(tc={}));function z3(n){if(!n)if(Xa){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),F3(n)}const H3=/^[^#]+#/;function K3(n,e){return n.replace(H3,"#")+e}function G3(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Mf=()=>({left:window.scrollX,top:window.scrollY});function W3(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=G3(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function bb(n,e){return(history.state?history.state.position-e:-1)+n}const Dm=new Map;function Q3(n,e){Dm.set(n,e)}function J3(n){const e=Dm.get(n);return Dm.delete(n),e}let Y3=()=>location.protocol+"//"+location.host;function DA(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),yb(l,"")}return yb(t,n)+r+s}function X3(n,e,t,r){let s=[],i=[],o=null;const a=({state:m})=>{const v=DA(n,location),w=t.value,x=e.value;let I=0;if(m){if(t.value=v,e.value=m,o&&o===w){o=null;return}I=x?m.position-x.position:0}else r(v);s.forEach(O=>{O(t.value,w,{delta:I,type:Vc.pop,direction:I?I>0?tc.forward:tc.back:tc.unknown})})};function l(){o=t.value}function c(m){s.push(m);const v=()=>{const w=s.indexOf(m);w>-1&&s.splice(w,1)};return i.push(v),v}function h(){const{history:m}=window;m.state&&m.replaceState(Vt({},m.state,{scroll:Mf()}),"")}function f(){for(const m of i)m();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",h,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function wb(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Mf():null}}function Z3(n){const{history:e,location:t}=window,r={value:DA(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,h){const f=n.indexOf("#"),m=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:Y3()+n+l;try{e[h?"replaceState":"pushState"](c,"",m),s.value=c}catch(v){console.error(v),t[h?"replace":"assign"](m)}}function o(l,c){const h=Vt({},e.state,wb(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,h,!0),r.value=l}function a(l,c){const h=Vt({},s.value,e.state,{forward:l,scroll:Mf()});i(h.current,h,!0);const f=Vt({},wb(r.value,l,null),{position:h.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function e$(n){n=z3(n);const e=Z3(n),t=X3(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Vt({location:"",base:n,go:r,createHref:K3.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function t$(n){return typeof n=="string"||n&&typeof n=="object"}function NA(n){return typeof n=="string"||typeof n=="symbol"}const OA=Symbol("");var xb;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(xb||(xb={}));function Nl(n,e){return Vt(new Error,{type:n,[OA]:!0},e)}function Fs(n,e){return n instanceof Error&&OA in n&&(e==null||!!(n.type&e))}const Ib="[^/]+?",n$={sensitive:!1,strict:!1,start:!0,end:!0},r$=/[.+*?^${}()[\]/\\]/g;function s$(n,e){const t=Vt({},n$,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const m=c[f];let v=40+(t.sensitive?.25:0);if(m.type===0)f||(s+="/"),s+=m.value.replace(r$,"\\$&"),v+=40;else if(m.type===1){const{value:w,repeatable:x,optional:I,regexp:O}=m;i.push({name:w,repeatable:x,optional:I});const L=O||Ib;if(L!==Ib){v+=10;try{new RegExp(`(${L})`)}catch(q){throw new Error(`Invalid custom RegExp for param "${w}" (${L}): `+q.message)}}let U=x?`((?:${L})(?:/(?:${L}))*)`:`(${L})`;f||(U=I&&c.length<2?`(?:/${U})`:"/"+U),I&&(U+="?"),s+=U,v+=20,I&&(v+=-8),x&&(v+=-20),L===".*"&&(v+=-50)}h.push(v)}r.push(h)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let m=1;m<h.length;m++){const v=h[m]||"",w=i[m-1];f[w.name]=v&&w.repeatable?v.split("/"):v}return f}function l(c){let h="",f=!1;for(const m of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const v of m)if(v.type===0)h+=v.value;else if(v.type===1){const{value:w,repeatable:x,optional:I}=v,O=w in c?c[w]:"";if(fs(O)&&!x)throw new Error(`Provided param "${w}" is an array but it is not repeatable (* or + modifiers)`);const L=fs(O)?O.join("/"):O;if(!L)if(I)m.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${w}"`);h+=L}}return h||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function i$(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function VA(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=i$(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(Eb(r))return 1;if(Eb(s))return-1}return s.length-r.length}function Eb(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const o$={type:0,value:""},a$=/[a-zA-Z0-9_]/;function l$(n){if(!n)return[[]];if(n==="/")return[[o$]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${c}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",h="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function m(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):m();break;case 4:m(),t=r;break;case 1:l==="("?t=2:a$.test(l)?m():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function u$(n,e,t){const r=s$(l$(n.path),t),s=Vt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function c$(n,e){const t=[],r=new Map;e=Pb({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,m,v){const w=!v,x=Ab(f);x.aliasOf=v&&v.record;const I=Pb(e,f),O=[x];if("alias"in f){const q=typeof f.alias=="string"?[f.alias]:f.alias;for(const te of q)O.push(Ab(Vt({},x,{components:v?v.record.components:x.components,path:te,aliasOf:v?v.record:x})))}let L,U;for(const q of O){const{path:te}=q;if(m&&te[0]!=="/"){const X=m.record.path,A=X[X.length-1]==="/"?"":"/";q.path=m.record.path+(te&&A+te)}if(L=u$(q,m,I),v?v.alias.push(L):(U=U||L,U!==L&&U.alias.push(L),w&&f.name&&!Sb(L)&&o(f.name)),MA(L)&&l(L),x.children){const X=x.children;for(let A=0;A<X.length;A++)i(X[A],L,v&&v.children[A])}v=v||L}return U?()=>{o(U)}:ec}function o(f){if(NA(f)){const m=r.get(f);m&&(r.delete(f),t.splice(t.indexOf(m),1),m.children.forEach(o),m.alias.forEach(o))}else{const m=t.indexOf(f);m>-1&&(t.splice(m,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const m=f$(f,t);t.splice(m,0,f),f.record.name&&!Sb(f)&&r.set(f.record.name,f)}function c(f,m){let v,w={},x,I;if("name"in f&&f.name){if(v=r.get(f.name),!v)throw Nl(1,{location:f});I=v.record.name,w=Vt(Tb(m.params,v.keys.filter(U=>!U.optional).concat(v.parent?v.parent.keys.filter(U=>U.optional):[]).map(U=>U.name)),f.params&&Tb(f.params,v.keys.map(U=>U.name))),x=v.stringify(w)}else if(f.path!=null)x=f.path,v=t.find(U=>U.re.test(x)),v&&(w=v.parse(x),I=v.record.name);else{if(v=m.name?r.get(m.name):t.find(U=>U.re.test(m.path)),!v)throw Nl(1,{location:f,currentLocation:m});I=v.record.name,w=Vt({},m.params,f.params),x=v.stringify(w)}const O=[];let L=v;for(;L;)O.unshift(L.record),L=L.parent;return{name:I,path:x,params:w,matched:O,meta:h$(O)}}n.forEach(f=>i(f));function h(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:h,getRoutes:a,getRecordMatcher:s}}function Tb(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Ab(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:d$(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function d$(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Sb(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function h$(n){return n.reduce((e,t)=>Vt(e,t.meta),{})}function Pb(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function f$(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;VA(n,e[i])<0?r=i:t=i+1}const s=p$(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function p$(n){let e=n;for(;e=e.parent;)if(MA(e)&&VA(n,e)===0)return e}function MA({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function m$(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(SA," "),o=i.indexOf("="),a=Oc(o<0?i:i.slice(0,o)),l=o<0?null:Oc(i.slice(o+1));if(a in e){let c=e[a];fs(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Rb(n){let e="";for(let t in n){const r=n[t];if(t=V3(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(fs(r)?r.map(i=>i&&km(i)):[r&&km(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function g$(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=fs(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const v$=Symbol(""),Cb=Symbol(""),Lf=Symbol(""),Jv=Symbol(""),Nm=Symbol("");function Pu(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Vi(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=m=>{m===!1?l(Nl(4,{from:t,to:e})):m instanceof Error?l(m):t$(m)?l(Nl(2,{from:e,to:m})):(o&&r.enterCallbacks[s]===o&&typeof m=="function"&&o.push(m),a())},h=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(h);n.length<3&&(f=f.then(c)),f.catch(m=>l(m))})}function Fp(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(TA(l)){const h=(l.__vccOpts||l)[e];h&&i.push(Vi(h,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(h=>{if(!h)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=E3(h)?h.default:h;o.mods[a]=h,o.components[a]=f;const v=(f.__vccOpts||f)[e];return v&&Vi(v,t,r,o,a,s)()}))}}return i}function kb(n){const e=ls(Lf),t=ls(Jv),r=qe(()=>{const l=Br(n.to);return e.resolve(l)}),s=qe(()=>{const{matched:l}=r.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const m=f.findIndex(Dl.bind(null,h));if(m>-1)return m;const v=Db(l[c-2]);return c>1&&Db(h)===v&&f[f.length-1].path!==v?f.findIndex(Dl.bind(null,l[c-2])):m}),i=qe(()=>s.value>-1&&x$(t.params,r.value.params)),o=qe(()=>s.value>-1&&s.value===t.matched.length-1&&kA(t.params,r.value.params));function a(l={}){if(w$(l)){const c=e[Br(n.replace)?"replace":"push"](Br(n.to)).catch(ec);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:qe(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function y$(n){return n.length===1?n[0]:n}const _$=Cw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:kb,setup(n,{slots:e}){const t=Hh(kb(n)),{options:r}=ls(Lf),s=qe(()=>({[Nb(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Nb(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&y$(e.default(t));return n.custom?i:ag("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),b$=_$;function w$(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function x$(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!fs(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function Db(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Nb=(n,e,t)=>n??e??t,I$=Cw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=ls(Nm),s=qe(()=>n.route||r.value),i=ls(Cb,0),o=qe(()=>{let c=Br(i);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=qe(()=>s.value.matched[o.value]);jd(Cb,qe(()=>o.value+1)),jd(v$,a),jd(Nm,s);const l=S();return kt(()=>[l.value,a.value,n.name],([c,h,f],[m,v,w])=>{h&&(h.instances[f]=c,v&&v!==h&&c&&c===m&&(h.leaveGuards.size||(h.leaveGuards=v.leaveGuards),h.updateGuards.size||(h.updateGuards=v.updateGuards))),c&&h&&(!v||!Dl(h,v)||!m)&&(h.enterCallbacks[f]||[]).forEach(x=>x(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,m=f&&f.components[h];if(!m)return Ob(t.default,{Component:m,route:c});const v=f.props[h],w=v?v===!0?c.params:typeof v=="function"?v(c):v:null,I=ag(m,Vt({},w,e,{onVnodeUnmounted:O=>{O.component.isUnmounted&&(f.instances[h]=null)},ref:l}));return Ob(t.default,{Component:I,route:c})||I}}});function Ob(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const E$=I$;function T$(n){const e=c$(n.routes,n),t=n.parseQuery||m$,r=n.stringifyQuery||Rb,s=n.history,i=Pu(),o=Pu(),a=Pu(),l=yS(ki);let c=ki;Xa&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Lp.bind(null,Y=>""+Y),f=Lp.bind(null,L3),m=Lp.bind(null,Oc);function v(Y,xe){let ve,Pe;return NA(Y)?(ve=e.getRecordMatcher(Y),Pe=xe):Pe=Y,e.addRoute(Pe,ve)}function w(Y){const xe=e.getRecordMatcher(Y);xe&&e.removeRoute(xe)}function x(){return e.getRoutes().map(Y=>Y.record)}function I(Y){return!!e.getRecordMatcher(Y)}function O(Y,xe){if(xe=Vt({},xe||l.value),typeof Y=="string"){const N=$p(t,Y,xe.path),H=e.resolve({path:N.path},xe),K=s.createHref(N.fullPath);return Vt(N,H,{params:m(H.params),hash:Oc(N.hash),redirectedFrom:void 0,href:K})}let ve;if(Y.path!=null)ve=Vt({},Y,{path:$p(t,Y.path,xe.path).path});else{const N=Vt({},Y.params);for(const H in N)N[H]==null&&delete N[H];ve=Vt({},Y,{params:f(N)}),xe.params=f(xe.params)}const Pe=e.resolve(ve,xe),nt=Y.hash||"";Pe.params=h(m(Pe.params));const vt=U3(r,Vt({},Y,{hash:O3(nt),path:Pe.path})),P=s.createHref(vt);return Vt({fullPath:vt,hash:nt,query:r===Rb?g$(Y.query):Y.query||{}},Pe,{redirectedFrom:void 0,href:P})}function L(Y){return typeof Y=="string"?$p(t,Y,l.value.path):Vt({},Y)}function U(Y,xe){if(c!==Y)return Nl(8,{from:xe,to:Y})}function q(Y){return A(Y)}function te(Y){return q(Vt(L(Y),{replace:!0}))}function X(Y){const xe=Y.matched[Y.matched.length-1];if(xe&&xe.redirect){const{redirect:ve}=xe;let Pe=typeof ve=="function"?ve(Y):ve;return typeof Pe=="string"&&(Pe=Pe.includes("?")||Pe.includes("#")?Pe=L(Pe):{path:Pe},Pe.params={}),Vt({query:Y.query,hash:Y.hash,params:Pe.path!=null?{}:Y.params},Pe)}}function A(Y,xe){const ve=c=O(Y),Pe=l.value,nt=Y.state,vt=Y.force,P=Y.replace===!0,N=X(ve);if(N)return A(Vt(L(N),{state:typeof N=="object"?Vt({},nt,N.state):nt,force:vt,replace:P}),xe||ve);const H=ve;H.redirectedFrom=xe;let K;return!vt&&j3(r,Pe,ve)&&(K=Nl(16,{to:H,from:Pe}),ae(Pe,Pe,!0,!1)),(K?Promise.resolve(K):k(H,Pe)).catch(Z=>Fs(Z)?Fs(Z,2)?Z:Je(Z):Ae(Z,H,Pe)).then(Z=>{if(Z){if(Fs(Z,2))return A(Vt({replace:P},L(Z.to),{state:typeof Z.to=="object"?Vt({},nt,Z.to.state):nt,force:vt}),xe||H)}else Z=V(H,Pe,!0,P,nt);return $(H,Pe,Z),Z})}function _(Y,xe){const ve=U(Y,xe);return ve?Promise.reject(ve):Promise.resolve()}function T(Y){const xe=dt.values().next().value;return xe&&typeof xe.runWithContext=="function"?xe.runWithContext(Y):Y()}function k(Y,xe){let ve;const[Pe,nt,vt]=A$(Y,xe);ve=Fp(Pe.reverse(),"beforeRouteLeave",Y,xe);for(const N of Pe)N.leaveGuards.forEach(H=>{ve.push(Vi(H,Y,xe))});const P=_.bind(null,Y,xe);return ve.push(P),en(ve).then(()=>{ve=[];for(const N of i.list())ve.push(Vi(N,Y,xe));return ve.push(P),en(ve)}).then(()=>{ve=Fp(nt,"beforeRouteUpdate",Y,xe);for(const N of nt)N.updateGuards.forEach(H=>{ve.push(Vi(H,Y,xe))});return ve.push(P),en(ve)}).then(()=>{ve=[];for(const N of vt)if(N.beforeEnter)if(fs(N.beforeEnter))for(const H of N.beforeEnter)ve.push(Vi(H,Y,xe));else ve.push(Vi(N.beforeEnter,Y,xe));return ve.push(P),en(ve)}).then(()=>(Y.matched.forEach(N=>N.enterCallbacks={}),ve=Fp(vt,"beforeRouteEnter",Y,xe,T),ve.push(P),en(ve))).then(()=>{ve=[];for(const N of o.list())ve.push(Vi(N,Y,xe));return ve.push(P),en(ve)}).catch(N=>Fs(N,8)?N:Promise.reject(N))}function $(Y,xe,ve){a.list().forEach(Pe=>T(()=>Pe(Y,xe,ve)))}function V(Y,xe,ve,Pe,nt){const vt=U(Y,xe);if(vt)return vt;const P=xe===ki,N=Xa?history.state:{};ve&&(Pe||P?s.replace(Y.fullPath,Vt({scroll:P&&N&&N.scroll},nt)):s.push(Y.fullPath,nt)),l.value=Y,ae(Y,xe,ve,P),Je()}let R;function Ke(){R||(R=s.listen((Y,xe,ve)=>{if(!Pt.listening)return;const Pe=O(Y),nt=X(Pe);if(nt){A(Vt(nt,{replace:!0,force:!0}),Pe).catch(ec);return}c=Pe;const vt=l.value;Xa&&Q3(bb(vt.fullPath,ve.delta),Mf()),k(Pe,vt).catch(P=>Fs(P,12)?P:Fs(P,2)?(A(Vt(L(P.to),{force:!0}),Pe).then(N=>{Fs(N,20)&&!ve.delta&&ve.type===Vc.pop&&s.go(-1,!1)}).catch(ec),Promise.reject()):(ve.delta&&s.go(-ve.delta,!1),Ae(P,Pe,vt))).then(P=>{P=P||V(Pe,vt,!1),P&&(ve.delta&&!Fs(P,8)?s.go(-ve.delta,!1):ve.type===Vc.pop&&Fs(P,20)&&s.go(-1,!1)),$(Pe,vt,P)}).catch(ec)}))}let ut=Pu(),ct=Pu(),Ge;function Ae(Y,xe,ve){Je(Y);const Pe=ct.list();return Pe.length?Pe.forEach(nt=>nt(Y,xe,ve)):console.error(Y),Promise.reject(Y)}function fe(){return Ge&&l.value!==ki?Promise.resolve():new Promise((Y,xe)=>{ut.add([Y,xe])})}function Je(Y){return Ge||(Ge=!Y,Ke(),ut.list().forEach(([xe,ve])=>Y?ve(Y):xe()),ut.reset()),Y}function ae(Y,xe,ve,Pe){const{scrollBehavior:nt}=n;if(!Xa||!nt)return Promise.resolve();const vt=!ve&&J3(bb(Y.fullPath,0))||(Pe||!ve)&&history.state&&history.state.scroll||null;return tn().then(()=>nt(Y,xe,vt)).then(P=>P&&W3(P)).catch(P=>Ae(P,Y,xe))}const ne=Y=>s.go(Y);let Ne;const dt=new Set,Pt={currentRoute:l,listening:!0,addRoute:v,removeRoute:w,clearRoutes:e.clearRoutes,hasRoute:I,getRoutes:x,resolve:O,options:n,push:q,replace:te,go:ne,back:()=>ne(-1),forward:()=>ne(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:ct.add,isReady:fe,install(Y){const xe=this;Y.component("RouterLink",b$),Y.component("RouterView",E$),Y.config.globalProperties.$router=xe,Object.defineProperty(Y.config.globalProperties,"$route",{enumerable:!0,get:()=>Br(l)}),Xa&&!Ne&&l.value===ki&&(Ne=!0,q(s.location).catch(nt=>{}));const ve={};for(const nt in ki)Object.defineProperty(ve,nt,{get:()=>l.value[nt],enumerable:!0});Y.provide(Lf,xe),Y.provide(Jv,hw(ve)),Y.provide(Nm,l);const Pe=Y.unmount;dt.add(Y),Y.unmount=function(){dt.delete(Y),dt.size<1&&(c=ki,R&&R(),R=null,l.value=ki,Ne=!1,Ge=!1),Pe()}}};function en(Y){return Y.reduce((xe,ve)=>xe.then(()=>T(ve)),Promise.resolve())}return Pt}function A$(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Dl(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Dl(c,l))||s.push(l))}return[t,r,s]}function ya(){return ls(Lf)}function _a(n){return ls(Jv)}const S$="modulepreload",P$=function(n){return"/"+n},Vb={},xt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=P$(i),i in Vb)return;Vb[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const f=s[h];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":S$,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((h,f)=>{c.addEventListener("load",h),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function R$(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function h(){if("serviceWorker"in navigator){const{Workbox:f}=await xt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),a.addEventListener("installed",m=>{m.isUpdate||r==null||r()}),a.register({immediate:e}).then(m=>{i?i("/service-worker.js",m):s==null||s(m)}).catch(m=>{o==null||o(m)})}}return l=h(),c}const ba="seasons";async function C$(n,e,t,r="",s=""){return await ma(tt(se,ba),{name:n,slug:e,pinCode:t,description:r,logoUrl:s,createdAt:xr()})}async function k$(n){return await kl(be(se,ba,n))}async function Za(){const n=Sc(tt(se,ba),NO("createdAt","desc"));return(await $t(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Vh(n,e){const t=await Wt(be(se,ba,n));return t.exists()?t.data().pinCode===e:!1}async function Om(n){const e=await Wt(be(se,ba,n));return e.exists()?e.data().pinCode:null}async function Ru(n,e){const t=be(se,ba,n);await go(t,{sortOrder:e})}async function D$(n,e){const t=be(se,ba,n);await go(t,e)}const N$=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function O$(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function LA(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function V$(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function $A(n){if(!n)return!1;const e=String(n).toLowerCase();return N$.some(t=>e.includes(t.toLowerCase()))}function Vm(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?V$(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Vm(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=$A(t)?"••••":Vm(r);return e}return n}function M$(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&$A(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Vm(r))}return e}const L$=LA(O$());function Ld(n,e){const t=LA(n);return(...r)=>{if(t<L$)return;const s=M$(r);console[e](...s)}}const F={debug:Ld("debug","log"),info:Ld("info","info"),warn:Ld("warn","warn"),error:Ld("error","error")},Yv="lastVisitedSeason",FA="lastVisitedSeasonTimestamp";async function $$(n){if(n)try{const e=je.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(Yv,n),localStorage.setItem(FA,Date.now().toString())}catch(r){F.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=be(se,"userPreferences",t);await on(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),F.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){F.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){F.error("Erreur lors de la mémorisation de la saison",e)}}async function UA(){try{const n=je.currentUser,e=n==null?void 0:n.email;if(e)try{const t=be(se,"userPreferences",e),r=await Wt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return F.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){F.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(Yv);if(t)return F.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){F.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return F.error("Erreur lors de la récupération de la dernière saison",n),null}}async function F$(n=null){var e;try{const t=n||((e=je.currentUser)==null?void 0:e.email);try{localStorage.removeItem(Yv),localStorage.removeItem(FA)}catch(r){F.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=be(se,"userPreferences",t);await on(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),F.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){F.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){F.error("Erreur lors du nettoyage des préférences",t)}}function U$(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const ei=S(null),Gi=S(!1),zs=S(!1),j$=qe(()=>{var n;return!!ei.value&&!((n=ei.value)!=null&&n.isAnonymous)});qe(()=>!!ei.value);function fl(){var n;try{const e=je.currentUser;e!==ei.value&&(ei.value=e,F.debug("Synchronisation forcée de l'état d'authentification",{user:((n=ei.value)==null?void 0:n.email)||"non connecté"}))}catch(e){F.error("Erreur lors de la synchronisation forcée",e)}}function B$(){var n;if(F.debug("Tentative d'initialisation du service d'authentification",{isInitialized:Gi.value,isInitializing:zs.value}),Gi.value||zs.value){F.debug("Service déjà initialisé ou en cours d'initialisation, sortie");return}zs.value=!0,F.debug("Marquage du service comme en cours d'initialisation");try{ei.value=je.currentUser,F.debug("État initial de l'utilisateur:",((n=ei.value)==null?void 0:n.email)||"non connecté");const e=je.onAuthStateChanged(t=>{ei.value=t,Gi.value=!0,zs.value=!1,F.debug("État d'authentification changé",{isLoggedIn:!!t,email:(t==null?void 0:t.email)||"non connecté"})});window._authStateUnsubscribe=e,F.info("Service d'état d'authentification initialisé avec succès")}catch(e){F.error("Erreur lors de l'initialisation du service d'authentification:",e),zs.value=!1}}function jA(){return new Promise((n,e)=>{if(F.debug("waitForInitialization appelé",{isInitialized:Gi.value,isInitializing:zs.value}),Gi.value){F.debug("Service déjà initialisé, résolution immédiate"),n();return}if(!zs.value){F.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{F.debug("Vérification de l'initialisation...",{isInitialized:Gi.value,isInitializing:zs.value}),Gi.value&&(clearInterval(t),F.debug("Service initialisé, résolution"),n())},100);setTimeout(()=>{clearInterval(t),F.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function q$(){F.debug("Initialisation forcée demandée"),!Gi.value&&!zs.value&&Mh()}function Mh(){if(F.debug("Tentative d'auto-initialisation du service d'authentification"),typeof je>"u"||!je){F.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(Mh,500);return}try{B$()}catch(n){F.error("Erreur lors de l'auto-initialisation:",n),setTimeout(Mh,1e3)}}setTimeout(Mh,100);const z$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},H$={class:"text-center"},K$={class:"text-white text-lg"},G$={__name:"SeasonResolver",setup(n){const e=ya(),t=S("Chargement...");return Tn(async()=>{try{if(new URLSearchParams(window.location.search).get("p")==="reset-password"){F.info("Redirection vers la page de reset password"),e.replace("/reset-password");return}t.value="Vérification de votre session...",fl(),await jA();const i=await new Promise((l,c)=>{const h=setTimeout(()=>{c(new Error("Timeout Firebase Auth"))},3e3),f=je.onAuthStateChanged(m=>{clearTimeout(h),f(),l(m)});je.currentUser&&(clearTimeout(h),f(),l(je.currentUser))}),o=i==null?void 0:i.email;if(!o){F.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const a=await UA();if(!a){F.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const l=await Za();if(!U$(a,l)){F.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await F$(o),e.replace("/seasons");return}}catch(l){F.error("Erreur lors de la vérification des saisons",l),e.replace("/seasons");return}F.info("Redirection vers la saison mémorisée",{seasonSlug:a}),e.replace(`/season/${a}`)}catch(r){F.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(C(),D("div",z$,[d("div",H$,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",K$,ee(t.value),1)])]))}},W$="/logos/hatcast-mask.png",Mm="/logos/hatcast-logo-mobile.png";async function Q$(n,e=800,t=800,r=.8){return new Promise((s,i)=>{const o=document.createElement("canvas"),a=o.getContext("2d"),l=new Image;l.onload=()=>{let{width:c,height:h}=l;c>e&&(h=h*e/c,c=e),h>t&&(c=c*t/h,h=t),o.width=c,o.height=h,a.drawImage(l,0,0,c,h),o.toBlob(f=>{if(f){const m=new File([f],n.name,{type:"image/jpeg",lastModified:Date.now()});s(m)}else i(new Error("Erreur lors du redimensionnement"))},"image/jpeg",r)},l.onerror=()=>i(new Error("Erreur lors du chargement de l'image")),l.src=URL.createObjectURL(n)})}async function BA(){if(!je.currentUser){F.info("Aucun utilisateur connecté, tentative de connexion anonyme...");try{await XT(je),F.info("Connexion anonyme réussie")}catch(n){throw F.error("Erreur lors de la connexion anonyme:",n),new Error("Impossible de s'authentifier: "+n.message)}}await new Promise(n=>setTimeout(n,1e3))}async function J$(n,e,t={}){var r;try{if(F.info("Début upload image",{fileName:n.name,path:e,originalSize:`${(n.size/1024/1024).toFixed(2)}MB`}),await BA(),!n.type.startsWith("image/"))throw new Error("Le fichier doit être une image");if(n.size>10*1024*1024)throw new Error("L'image est trop volumineuse (max 10MB)");let s=n;if(t.resize!==!1&&(n.size>1024*1024||t.forceResize)){F.info("Redimensionnement de l'image pour optimiser les performances...");try{s=await Q$(n,t.maxWidth||800,t.maxHeight||800,t.quality||.8),F.info("Image redimensionnée",{newSize:`${(s.size/1024/1024).toFixed(2)}MB`,compression:`${((1-s.size/n.size)*100).toFixed(1)}%`})}catch(w){F.warn("Erreur lors du redimensionnement, utilisation du fichier original:",w),s=n}}const a=`${Date.now()}_${n.name}`,l=`${e}/${a}`,c=ST(Kv,l);F.info("Tentative d'upload vers Firebase Storage...",{fullPath:l,user:(r=je.currentUser)==null?void 0:r.uid,isAuthenticated:!!je.currentUser,finalSize:`${(s.size/1024/1024).toFixed(2)}MB`});const h=sM(c,s),f=new Promise((w,x)=>setTimeout(()=>x(new Error("Timeout: Upload trop long")),3e4)),m=await Promise.race([h,f]);F.info("Image uploadée avec succès",{fullPath:l});const v=await iM(m.ref);return F.info("URL de téléchargement récupérée",{downloadURL:v}),v}catch(s){if(F.error("Erreur lors de l'upload de l'image",s),s.message.includes("CORS")||s.message.includes("preflight")||s.message.includes("permission")||s.message.includes("unauthenticated")||s.message.includes("ERR_FAILED")||s.message.includes("Timeout"))return F.warn("Erreur d'accès détectée, utilisation du stockage local temporaire",s.message),await Y$(n,e);throw s}}async function Y$(n,e){return new Promise((t,r)=>{const s=new FileReader;s.onload=i=>{const o=i.target.result;F.info("Image stockée localement en base64",{path:e}),t(o)},s.onerror=()=>r(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(n)})}async function X$(n){var e;try{if(F.info("Début suppression image",{imageUrl:n}),n.startsWith("data:image/")){F.info("Image locale (base64), suppression ignorée");return}await BA();const r=(e=new URL(n).pathname.split("/o/")[1])==null?void 0:e.split("?")[0];if(!r)throw new Error("Impossible d'extraire le chemin de l'image");const s=decodeURIComponent(r),i=ST(Kv,s);await oM(i),F.info("Image supprimée avec succès",{decodedPath:s})}catch(t){throw F.error("Erreur lors de la suppression de l'image",t),t}}function Z$(n){return n&&n.includes("firebasestorage.googleapis.com")}const Up=7*24*60*60*1e3,Cu="hatcast_pin_session";class eF{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Cu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Up){try{t.timestamp=Date.now(),localStorage.setItem(Cu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Cu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Up;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Cu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Cu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Up-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Hn=new eF,tF={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},nF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},rF={class:"text-center mb-6"},sF={class:"text-gray-300"},iF={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},oF={class:"text-sm text-green-400"},aF={class:"mb-6"},lF={class:"mb-4"},uF={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},cF={class:"flex justify-end space-x-3"},dF=["disabled"],qA={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(null);kt(()=>t.show,h=>{h&&(s.value="",i.value="",tn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(h,f)=>n.show?(C(),D("div",tF,[d("div",nF,[d("div",rF,[f[1]||(f[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",sF,ee(n.message),1),n.sessionInfo?(C(),D("div",iF,[d("p",oF," Session active : "+ee(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ie("",!0)]),d("div",aF,[d("div",lF,[f[3]||(f[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),st(d("input",{"onUpdate:modelValue":f[0]||(f[0]=m=>s.value=m),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[rr(l,["enter"]),rr(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Lt,s.value]])]),f[4]||(f[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(C(),D("div",uF,ee(i.value||t.error),1)):ie("",!0),d("div",cF,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,dF)])])])):ie("",!0)}},Mb="hatcast_trusted_players",Lb=180*24*60*60*1e3;class hF{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(Mb);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(Mb,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<Lb;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>Lb&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const lo=new hF,$f=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},fF={};function pF(n,e){return C(),D(mt,null,[e[0]||(e[0]=d("div",{class:"text-gray-300"},"🎭 Ça marche déjà super bien sans, mais avec un compte, c'est encore plus cool :",-1)),e[1]||(e[1]=d("div",null,[lt("• "),d("span",{class:"text-blue-300"},"🔒 Tes dispos sont à l'abri :"),lt(" plus personne ne peut modifier tes choix à ta place")],-1)),e[2]||(e[2]=d("div",null,[lt("• "),d("span",{class:"text-blue-300"},"📧 Alertes VIP :"),lt(" sois le premier informé des nouveaux spectacles et sélections")],-1)),e[3]||(e[3]=d("div",null,[lt("• "),d("span",{class:"text-blue-300"},"⚡ Saisie express :"),lt(" ton nom reste en haut de la liste, plus besoin de le chercher")],-1))],64)}const $b=$f(fF,[["render",pF]]),mF={key:0,class:"mt-4"},gF={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},vF={key:1},yF={key:0,class:"mt-3 pt-3 border-t border-blue-500/20 text-sm text-gray-300 space-y-2"},Xv={__name:"AccountBenefitsHint",props:{inline:{type:Boolean,default:!1}},setup(n){const e=S(!1);return(t,r)=>n.inline?(C(),D("div",vF,[d("button",{onClick:r[1]||(r[1]=s=>e.value=!e.value),class:"text-blue-300 hover:text-blue-200 text-sm font-medium flex items-center gap-2 transition-colors"},[r[3]||(r[3]=d("span",null,"À quoi sert un compte ?",-1)),d("span",{class:cn(["transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(C(),D("div",yF,[Be($b)])):ie("",!0)])):(C(),D("div",mF,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[2]||(r[2]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 À quoi sert un compte ?",-1)),d("span",{class:cn(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(C(),D("div",gF,[Be($b)])):ie("",!0)]))}},_F={class:"space-y-4"},bF={class:"flex items-center justify-between"},wF={class:"flex items-center gap-2 text-gray-300 text-sm"},xF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},IF={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},EF={class:"flex justify-center gap-3 mt-2"},TF=["disabled"],AF={key:0,class:"animate-spin"},SF={key:1},zA={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=S(""),s=S(""),i=S(!1),o=S(""),a=S(""),l=S(!0),c=qe(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function h(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await xA(r.value.trim(),s.value),l.value)try{lo.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await Gv(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(m,v)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:v[6]||(v[6]=w=>m.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[5]||(v[5]=ft(()=>{},["stop"]))},[d("button",{onClick:v[0]||(v[0]=w=>m.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),v[10]||(v[10]=ir('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",_F,[Be(Xv),d("div",null,[v[7]||(v[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),st(d("input",{"onUpdate:modelValue":v[1]||(v[1]=w=>r.value=w),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Lt,r.value]])]),d("div",null,[v[8]||(v[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),st(d("input",{"onUpdate:modelValue":v[2]||(v[2]=w=>s.value=w),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Lt,s.value]])]),d("div",bF,[d("label",wF,[st(d("input",{type:"checkbox","onUpdate:modelValue":v[3]||(v[3]=w=>l.value=w),class:"w-4 h-4"},null,512),[[Hi,l.value]]),v[9]||(v[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(C(),D("div",xF,ee(o.value),1)):ie("",!0),a.value?(C(),D("div",IF,ee(a.value),1)):ie("",!0),d("div",EF,[d("button",{onClick:h,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(C(),D("span",AF,"⏳")):(C(),D("span",SF,"Se connecter"))],8,TF),d("button",{onClick:v[4]||(v[4]=w=>m.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ie("",!0)}},Ff="magicLinks";function Uf({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Zv(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Lh({seasonId:n,playerId:e,eventId:t,action:r,slug:s}){const i=Uf({seasonId:n,playerId:e,eventId:t,action:r}),o=Zv(40),a=be(se,Ff,i),l=Date.now()+1e3*60*60*24*7;await on(a,{seasonId:n,playerId:e,eventId:t,token:o,action:r,expiresAt:l});let h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(r)}`;return s&&(h+=`&slug=${encodeURIComponent(s)}`),{id:i,token:o,url:h}}async function HA({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Uf({seasonId:n,playerId:e,eventId:r,action:s}),o=Zv(40),a=be(se,Ff,i),l=Date.now()+1e3*60*60*24*7;await on(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const h=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:h}}async function KA({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Uf({seasonId:n,playerId:e,eventId:t,action:s}),o=be(se,Ff,i),a=await Wt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Lm({seasonId:n,playerId:e,eventId:t,action:r}){const s=Uf({seasonId:n,playerId:e,eventId:t,action:r}),i=be(se,Ff,s);await kl(i)}const ey="accountMagicLinks";function jf(n){return`account__${n}`}async function GA({currentEmail:n,newEmail:e}){const t=Zv(40),r=jf(t),s=be(se,ey,r),i=Date.now()+1e3*60*60*24*7;await on(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function WA({token:n}){const e=jf(n),t=be(se,ey,e),r=await Wt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function QA({token:n}){const e=jf(n),t=be(se,ey,e);await kl(t)}const JA=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:jf,consumeAccountEmailUpdateLink:QA,consumeMagicLink:Lm,createAccountEmailUpdateLink:GA,createEmailVerificationLink:HA,createMagicLink:Lh,verifyAccountEmailUpdateLink:WA,verifyMagicLink:KA},Symbol.toStringTag,{value:"Module"}));async function od({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:xr()};return await ma(tt(se,"pushQueue"),i),{success:!0}}function PF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🎯 <strong>Nouveau spectacle à l'horizon !</strong></p>
      <p>Es-tu dispo le ${t} pour <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a> ?</p>
      <p>🎭 <em>On a besoin de toi pour que ça brille ! ✨</em></p>
      <p style="margin-top: 12px; text-align: center;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails : <a href="${r}" style="color:#3b82f6;text-decoration:underline;">${r}</a></p>
    </div>
  `}function RF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`${n}`:"Hello"},

🎯 Nouveau spectacle à l'horizon ! 

Es-tu dispo le ${t} pour ${e} ?

🎭 On a besoin de toi pour que ça brille ! ✨

✅ Dispo ❌ Pas dispo

Lien direct : ${r}`}function CF({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`Bonjour ${n}`:"Hello"},

Tu es sélectionné(e) pour ${e} le ${t}!

🕺 Prépares-toi à briller, toute l'équipe compte sur toi!

Un imprévu ?😬 
Pas de souci, signales vite ton indisponibilité ici pour qu'on relance la sélection du spectacle : ${r}`}function kF({playerName:n,eventTitle:e,eventUrl:t,activationUrl:r,seasonTitle:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🔔 <strong>Active tes notifications pour ne rien rater !</strong></p>
      <p>Tu veux être informé(e) en temps réel de <strong>tous tes événements</strong> de la saison <strong>${s}</strong> ?</p>
      <p>🎯 <em>Clique sur le bouton ci-dessous pour activer tes notifications et recevoir des alertes pour tes événements !</em></p>
      <p style="margin-top: 16px; text-align: center;">
        <a href="${r}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #8b5cf6, #ec4899);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(139, 92, 246, 0.3);">🔔 Activer mes notifications</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280; font-size: 14px;">
        <em>En activant tes notifications, tu recevras des alertes pour :</em><br>
        • Les demandes de disponibilité<br>
        • Les sélections de joueurs<br>
        • Les changements d'horaires<br>
        • Les annonces importantes
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails de l'événement : <a href="${t}" style="color:#3b82f6;text-decoration:underline;">${t}</a></p>
    </div>
  `}const DF="HatCast <impropick@gmail.com>",NF="impropick@gmail.com";function ad(n=null){return{from:n||DF,replyTo:n||NF}}async function OF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=be(se,"userPreferences",n),w=await Wt(v);if(w.exists()){const x=w.data();if((x==null?void 0:x.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=PF({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),h=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:h,html:c},createdAt:xr(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},m=ad(l);f.from=m.from,f.replyTo=m.replyTo,await ma(tt(se,"mail"),f);try{const v=be(se,"userPreferences",n),w=await Wt(v),x=w.exists()?w.data():{};if((x==null?void 0:x.notifyAvailabilityPush)!==!1){const I=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,O=`${e}, t'es dispo ?`;await od({toEmail:n,title:I,body:O,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function YA({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",h=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,m={to:n,message:{subject:h,html:f},createdAt:xr(),meta:{reason:t,displayName:r}},v=ad(s);m.from=v.from,m.replyTo=v.replyTo,await ma(tt(se,"mail"),m)}async function VF({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return YA({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function MF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0}){try{const v=be(se,"userPreferences",n),w=await Wt(v);if(w.exists()){const x=w.data();if((x==null?void 0:x.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}F.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const c=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,h=o||`🎭 Sélection confirmée · ${t}`;F.debug("queueSelectionEmail html/subject ready");const f={to:n,message:{subject:h,html:c},createdAt:xr(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},m=ad(a);f.from=m.from,f.replyTo=m.replyTo,F.debug("queueSelectionEmail firestore payload ready");try{await ma(tt(se,"mail"),f);try{const v=be(se,"userPreferences",n),w=await Wt(v),x=w.exists()?w.data():{};console.log("Préférences utilisateur pour notifications push",{toEmail:n,prefs:x,notifySelectionPush:x==null?void 0:x.notifySelectionPush,shouldSendPush:(x==null?void 0:x.notifySelectionPush)!==!1}),(x==null?void 0:x.notifySelectionPush)!==!1?(console.log("Envoi notification push de sélection",{toEmail:n,playerName:e,eventTitle:t}),await od({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin,noUrl:l},reason:"selection"}),console.log("Notification push de sélection envoyée avec succès")):console.log("Notification push de sélection désactivée par préférences utilisateur")}catch(v){console.error("Erreur lors de l'envoi de la notification push de sélection",v)}return F.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(v){throw F.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:v}),v}}async function LF({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const w=be(se,"userPreferences",n),x=await Wt(w);if(x.exists()){const I=x.data();if((I==null?void 0:I.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",h=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,m={to:n,message:{subject:f,html:h},createdAt:xr(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=ad(l);m.from=v.from,m.replyTo=v.replyTo,await ma(tt(se,"mail"),m);try{const w=be(se,"userPreferences",n),x=await Wt(w),I=x.exists()?x.data():{};(I==null?void 0:I.notifySelectionPush)!==!1&&await od({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function $F({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(F.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await xt(()=>Promise.resolve().then(()=>ld),void 0),{createMagicLink:a}=await xt(()=>Promise.resolve().then(()=>JA),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,h=[];for(const f of t){F.debug("Traitement du joueur",{playerName:f});try{const m=i==null?void 0:i.find(L=>L.name===f);if(!m){F.warn("Joueur non trouvé",{playerName:f});continue}F.debug("Joueur trouvé");const v=await o(m.id,r);if(!v){F.warn("Pas d'email pour le joueur",{playerName:f});continue}F.debug("Email trouvé pour joueur");const x=`${(await a({seasonId:r,playerId:m.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,I=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${$h(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${x}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;F.debug("HTML généré pour joueur");const O=MF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:$h(e.date),eventUrl:l,html:I,subject:c,noUrl:x});h.push(O),F.info("Email ajouté à la queue",{playerName:f})}catch(m){F.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:m})}}return F.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),F.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function FF({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(F.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await xt(()=>Promise.resolve().then(()=>ld),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],h=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const m=o==null?void 0:o.find(x=>x.name===f);if(!m){F.warn("Joueur retiré non trouvé",{playerName:f});continue}const v=await a(m.id,s);if(!v){F.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const w=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${$h(e.date)}) 😔.</p>
          ${h?`<p>Nouvelle sélection: <strong>${h}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(LF({toEmail:v,playerName:f,eventTitle:e.title,eventDate:$h(e.date),eventUrl:l,newSelectedPlayers:r,html:w}))}catch(m){F.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:m})}return await Promise.all(c),F.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function $h(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function UF({toEmail:n,playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i,fromEmail:o=void 0}){const a=kF({playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i}),l=`🔔 Active tes notifications pour ${t}`,c={to:n,message:{subject:l,html:a},createdAt:xr(),meta:{reason:"notification_activation",eventTitle:t,playerName:e}},h=ad(o);c.from=h.from,c.replyTo=h.replyTo;try{return await ma(tt(se,"mail"),c),F.info("Email d'activation des notifications ajouté à la queue",{toEmail:n,playerName:e}),{success:!0}}catch(f){throw F.error("Erreur lors de l'ajout de l'email d'activation à la queue",f),f}}function ty(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function XA(n){return`seasonPreferredPlayer:${n||"global"}`}function $m(n,e){try{const t=XA(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function jF(n,e){try{const t=XA(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function ZA(n,e,t,r=null){try{F.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Ql(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await xt(()=>import("./index.esm-8019458b.js"),[]),{db:c}=await xt(()=>Promise.resolve().then(()=>us),void 0),h=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(h,a("email","==",e)),m=await l(f);if(!m.empty&&m.docs.find(U=>U.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");F.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await xt(()=>import("./index.esm-183b5cd6.js"),[]),{auth:w}=await xt(()=>Promise.resolve().then(()=>us),void 0),x=await v(w,e,t);F.info("Compte Firebase Auth créé",{uid:x.user.uid});const I=ty(t),O=r?be(c,"seasons",r,"playerProtection",n):be(c,"playerProtection",n);return await on(O,{playerId:n,email:e,passwordHash:I,firebaseUid:x.user.uid,isProtected:!0,createdAt:new Date}),F.info("Protection sauvegardée dans Firestore"),r&&$m(r,n),{success:!0}}catch(s){throw F.error("Erreur lors de la protection du joueur",s),s}}async function e1({playerId:n,email:e,seasonId:t=null}){const r=t?be(se,"seasons",t,"playerProtection",n):be(se,"playerProtection",n);(await Wt(r)).exists()?await go(r,{email:e,updatedAt:new Date}):await on(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await HA({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function t1({playerId:n,seasonId:e=null}){const t=e?be(se,"seasons",e,"playerProtection",n):be(se,"playerProtection",n);if(!(await Wt(t)).exists())throw new Error("Protection introuvable");return await go(t,{emailVerifiedAt:new Date}),{success:!0}}async function n1({playerId:n,seasonId:e=null}){const t=e?be(se,"seasons",e,"playerProtection",n):be(se,"playerProtection",n);return await go(t,{emailVerifiedAt:null}),{success:!0}}async function r1(n,e=null){try{const t=e?be(se,"seasons",e,"playerProtection",n):be(se,"playerProtection",n);return await on(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&jF(e,n),{success:!0,email:""}}catch(t){throw F.error("Erreur lors de la suppression de la protection",t),t}}async function Ji(n,e=null){try{const t=e?be(se,"seasons",e,"playerProtection",n):be(se,"playerProtection",n),r=await Wt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return F.error("Erreur lors de la vérification de protection",t),!1}}async function Ql(n,e=null){try{const t=e?be(se,"seasons",e,"playerProtection",n):be(se,"playerProtection",n),r=await Wt(t);return r.exists()?r.data():null}catch(t){return F.error("Erreur lors de la récupération des données de protection",t),null}}async function s1(n,e=null){try{const t=await Ql(n,e);return(t==null?void 0:t.email)||""}catch(t){return F.error("Erreur lors de la récupération de l'email",t),""}}async function Fm(n=null){try{const e=n?tt(se,"seasons",n,"playerProtection"):tt(se,"playerProtection");return(await $t(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return F.error("Erreur lors du chargement des protections",e),[]}}async function Bf(n){try{const e=[],t=Sc(tt(se,"playerProtection"),Ch("email","==",n));(await $t(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await $t(tt(se,"seasons"));for(const i of s.docs){const o=i.id,a=Sc(tt(se,"seasons",o,"playerProtection"),Ch("email","==",n));(await $t(a)).forEach(c=>{var f;const h=c.data();h!=null&&h.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...h})})}return e}catch(e){return F.error("Erreur listAssociationsForEmail",e),[]}}async function i1(n,e,t=null){try{const r=await Ql(n,t);if(!r||!r.isProtected)return!1;if(r.email){F.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await xt(()=>import("./index.esm-183b5cd6.js"),[]),{auth:i}=await xt(()=>Promise.resolve().then(()=>us),void 0);return await s(i,r.email,e),F.debug("Mot de passe Firebase Auth valide"),lo.saveSession(n),t&&$m(t,n),!0}catch(s){return F.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{F.debug("Vérification avec hash local");const s=ty(e),i=r.passwordHash===s;return i&&(lo.saveSession(n),t&&$m(t,n)),i}}catch(r){return F.error("Erreur lors de la vérification du mot de passe",r),!1}}async function o1({playerId:n,seasonId:e=null}){const t=e?be(se,"seasons",e,"playerProtection",n):be(se,"playerProtection",n),r=await Wt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await go(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function Qo(n){return lo.isPasswordCached(n)}function BF(n){return null}async function a1(n,e=null){try{F.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Ql(n,e);if(F.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(F.debug("Email à utiliser (masqué)"),t.firebaseUid){F.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await xt(()=>import("./index.esm-183b5cd6.js"),[]),{auth:s}=await xt(()=>Promise.resolve().then(()=>us),void 0);F.debug("Tentative d'envoi d'email"),await r(s,t.email),F.info("Email envoyé avec succès via Firebase Auth")}else{F.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await xt(()=>import("./index.esm-183b5cd6.js"),[]),{auth:i}=await xt(()=>Promise.resolve().then(()=>us),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);F.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),F.info("Email envoyé avec succès");const{updateDoc:l}=await xt(()=>import("./index.esm-8019458b.js"),[]),{db:c}=await xt(()=>Promise.resolve().then(()=>us),void 0),h=e?be(c,"seasons",e,"playerProtection",n):be(c,"playerProtection",n);await l(h,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")F.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),F.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw F.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function qF(n,e,t=null){try{const r=ty(e),s=t?be(se,"seasons",t,"playerProtection",n):be(se,"playerProtection",n);return await go(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw F.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function zF(n){return new Promise((e,t)=>{F.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const ld=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:n1,finalizeProtectionAfterVerification:o1,getCachedPlayerPassword:BF,getPlayerEmail:s1,getPlayerProtectionData:Ql,isPlayerPasswordCached:Qo,isPlayerProtected:Ji,listAssociationsForEmail:Bf,listProtectedPlayers:Fm,markEmailVerifiedForProtection:t1,protectPlayer:ZA,requirePlayerPasswordForAvailability:zF,sendPasswordResetEmail:a1,startEmailVerificationForProtection:e1,unprotectPlayer:r1,updatePlayerPasswordInFirestore:qF,verifyPlayerPassword:i1},Symbol.toStringTag,{value:"Module"})),HF={class:"mb-4 md:mb-6"},KF={class:"flex items-start gap-4"},GF={class:"flex items-center gap-3"},WF={class:"space-y-2"},QF={class:"flex items-center gap-2"},JF={class:"text-gray-400 text-xs md:text-sm"},YF={key:0,class:"flex items-center gap-2"},XF=["title"],ZF={class:"text-blue-200"},e6={class:"space-y-4 md:space-y-6"},t6={class:"space-y-2 md:space-y-3"},n6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},r6=["disabled"],s6={key:0,class:"mt-2 text-xs text-red-300"},i6={key:1,class:"mt-2 text-xs text-green-300"},o6={class:"space-y-2 md:space-y-3"},a6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},l6={class:"flex items-center justify-between mb-4"},u6={class:"space-y-4"},c6=["disabled"],d6={key:0,class:"text-xs text-red-300 text-center"},h6={key:1,class:"text-xs text-green-300 text-center"},f6={class:"flex items-center justify-between mb-4"},p6={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},m6={class:"space-y-3"},g6={key:0,class:"text-sm text-gray-400 text-center py-4"},v6={key:1,class:"space-y-2"},y6={class:"flex items-center gap-2 min-w-0 flex-1"},_6={class:"truncate"},b6={class:"text-white font-medium text-sm"},w6={class:"text-gray-400 text-xs"},x6=["onClick"],l1={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(""),o=S(!1),a=S(""),l=S(""),c=S(!1),h=S(!1),f=S(""),m=S(""),v=S([]),w=S(!1),x=S(!1);kt(s,A=>{i.value=A||""}),kt(i,A=>{c.value=!!A&&A.includes("@")&&A!==s.value});async function I(){if(c.value){o.value=!0,a.value="",l.value="";try{const A=await GA({currentEmail:s.value,newEmail:i.value.trim()});await YA({toEmail:i.value.trim(),verifyUrl:A.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(A){a.value=(A==null?void 0:A.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function O(){if(s.value){h.value=!0,f.value="",m.value="";try{await Gv(s.value),m.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{f.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{h.value=!1}}}function L(A){return`${A.seasonId||"global"}__${A.playerId}`}async function U(){try{const A=s.value?await Bf(s.value):[],_=[];for(const T of A){let k=T.playerId,$=T.seasonId||"—";try{if(T.seasonId){const V=be(se,"seasons",T.seasonId,"players",T.playerId),R=await Wt(V);R.exists()&&(k=R.data().name||k);const Ke=be(se,"seasons",T.seasonId),ut=await Wt(Ke);ut.exists()&&($=ut.data().name||$)}}catch{}_.push({...T,playerName:k,seasonName:$})}v.value=_}catch{v.value=[]}}async function q(A){if(confirm(`Êtes-vous sûr de vouloir dissocier le joueur "${A.playerName}" de votre compte ?`))try{const{deleteDoc:_}=await xt(()=>import("./index.esm-8019458b.js"),[]);if(A.seasonId){const k=be(se,"seasons",A.seasonId,"playerProtection",A.playerId);await _(k)}else{const k=be(se,"playerProtection",A.playerId);await _(k)}try{if(A.seasonId){const k=`seasonPreferredPlayer:${A.seasonId}`,$=localStorage.getItem(k);if($)if($.startsWith("[")){const R=(JSON.parse($)||[]).filter(Ke=>Ke!==A.playerId);localStorage.setItem(k,JSON.stringify(R))}else $===A.playerId&&localStorage.removeItem(k)}}catch{}await U();const T=`Joueur "${A.playerName}" dissocié avec succès`}catch(_){console.error("Erreur lors de la dissociation:",_),alert(`Erreur lors de la dissociation: ${_.message||"Veuillez réessayer"}`)}}function te(A){r("open-player",A),X()}function X(){r("close")}return kt(()=>t.show,A=>{var _;if(A)try{s.value=((_=je==null?void 0:je.currentUser)==null?void 0:_.email)||"",U()}catch{}}),Tn(()=>{var A;if(t.show)try{s.value=((A=je==null?void 0:je.currentUser)==null?void 0:A.email)||"",U()}catch{}}),(A,_)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:X},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:_[3]||(_[3]=ft(()=>{},["stop"]))},[d("button",{onClick:X,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),d("div",HF,[d("div",KF,[d("div",GF,[_[13]||(_[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"👤")],-1)),d("div",WF,[_[12]||(_[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",QF,[d("span",JF,ee(s.value||"Non défini"),1),d("button",{onClick:_[0]||(_[0]=T=>w.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),v.value.length>0?(C(),D("div",YF,[d("button",{onClick:_[1]||(_[1]=T=>v.value.length===1?te(v.value[0]):x.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Gérer mes joueurs"},[_[11]||(_[11]=d("span",{class:"text-blue-300"},"⭐",-1)),d("span",ZF,ee(v.value.length===1?v.value[0].playerName:`${v.value.length} joueurs`),1)],8,XF)])):ie("",!0)])])])]),_[18]||(_[18]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",e6,[d("div",t6,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},"🔑"),lt(" Mot de passe ")],-1)),d("div",n6,[_[14]||(_[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:O,disabled:h.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ee(h.value?"⏳":"Changer de mot de passe"),9,r6),f.value?(C(),D("div",s6,ee(f.value),1)):ie("",!0),m.value?(C(),D("div",i6,ee(m.value),1)):ie("",!0)])]),d("div",o6,[_[17]||(_[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},"⚠️"),lt(" Suppression de compte ")],-1)),d("div",a6,[_[16]||(_[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),d("button",{onClick:_[2]||(_[2]=T=>A.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])])]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:X,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),w.value?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[7]||(_[7]=T=>w.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:_[6]||(_[6]=ft(()=>{},["stop"]))},[d("div",l6,[_[19]||(_[19]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},"📧"),lt(" Modifier l'email ")],-1)),d("button",{onClick:_[4]||(_[4]=T=>w.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",u6,[d("div",null,[_[20]||(_[20]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),st(d("input",{"onUpdate:modelValue":_[5]||(_[5]=T=>i.value=T),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Lt,i.value]])]),d("button",{onClick:I,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ee(o.value?"⏳":"Mettre à jour"),9,c6),a.value?(C(),D("div",d6,ee(a.value),1)):ie("",!0),l.value?(C(),D("div",h6,ee(l.value),1)):ie("",!0)])])])):ie("",!0),x.value?(C(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:_[10]||(_[10]=T=>x.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:_[9]||(_[9]=ft(()=>{},["stop"]))},[d("div",f6,[d("h3",p6,[_[21]||(_[21]=d("span",{class:"text-yellow-400"},"⭐",-1)),lt(" "+ee(v.value.length<=1?"Mon joueur":"Mes joueurs"),1)]),d("button",{onClick:_[8]||(_[8]=T=>x.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",m6,[v.value.length===0?(C(),D("div",g6," Aucun joueur associé pour le moment. ")):(C(),D("div",v6,[(C(!0),D(mt,null,jr(v.value,T=>(C(),D("div",{key:L(T),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",y6,[_[22]||(_[22]=d("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),d("div",_6,[d("div",b6,ee(T.playerName||"—"),1),d("div",w6,ee(T.seasonName||T.seasonId||"—"),1)])]),d("button",{onClick:k=>q(T),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier ce joueur","aria-label":"Dissocier ce joueur"}," 🗑️ ",8,x6)]))),128))]))])])])):ie("",!0)])):ie("",!0)}},Fb="/logos/hatcast-logo-desktop.png",I6={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},E6=["aria-expanded"],Um={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!0),o=S(null),a=S({});kt(()=>t.isConnected,I=>{i.value=!1},{immediate:!0}),Tn(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&tn(()=>h())}function h(){if(o.value){const I=o.value.getBoundingClientRect();a.value={top:`${I.bottom+8}px`,right:`${window.innerWidth-I.right}px`}}}function f(){s.value=!1,r("open-account-menu")}function m(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function w(){s.value=!1;try{await je.signOut(),r("logout")}catch(I){console.error("Erreur lors de la déconnexion:",I)}}function x(){s.value=!1}return Tn(()=>{document.addEventListener("click",x),window.addEventListener("resize",h),window.addEventListener("scroll",h,{passive:!0})}),Qs(()=>{document.removeEventListener("click",x),window.removeEventListener("resize",h),window.removeEventListener("scroll",h)}),(I,O)=>(C(),D("div",{class:"relative",onClick:O[0]||(O[0]=ft(()=>{},["stop"]))},[i.value?(C(),D("div",I6)):n.isConnected?(C(),D("button",{key:2,onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},O[1]||(O[1]=[d("span",{class:"text-2xl"},"👤",-1)]),8,E6)):(C(),D("button",{key:1,onClick:l,class:cn(["px-4 py-2 rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])}," Connexion ",2)),(C(),Js(oc,{to:"body"},[s.value&&n.isConnected?(C(),D("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:Ur(a.value),role:"menu"},[d("button",{onClick:f,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},O[2]||(O[2]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},O[3]||(O[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:m,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},O[4]||(O[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),d("span",{class:"truncate"},"Aide",-1)])),O[6]||(O[6]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:w,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},O[5]||(O[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),d("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):ie("",!0)]))]))}},T6={class:"container mx-auto px-4 py-4"},A6={class:"flex items-center justify-between"},S6={class:"flex items-center"},P6={href:"/",class:"flex items-center"},R6={class:"relative w-48 h-12 md:w-56 md:h-14"},C6={class:"flex items-center gap-2"},k6={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login"],setup(n,{emit:e}){const t=n,r=e,s=_a(),i=qe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");kt(()=>s.path,()=>{fl(),setTimeout(()=>{fl()},100)},{immediate:!0}),Qs(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function h(){r("logout")}function f(){r("open-login")}return(m,v)=>(C(),D("header",{class:cn(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-transparent"])},[d("nav",T6,[d("div",A6,[d("div",S6,[d("a",P6,[d("div",R6,[n.isScrolled?(C(),D(mt,{key:1},[v[2]||(v[2]=d("img",{src:Mm,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"},null,-1)),v[3]||(v[3]=d("img",{src:Fb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"},null,-1))],64)):(C(),D(mt,{key:0},[v[0]||(v[0]=d("img",{src:Mm,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden brightness-0 invert"},null,-1)),v[1]||(v[1]=d("img",{src:Fb,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block brightness-0 invert"},null,-1))],64))])])]),d("div",C6,[Be(Um,{"is-connected":Br(j$),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:h,onOpenLogin:f},null,8,["is-connected","button-class"]),HS(m.$slots,"actions")])])])],2))}},D6={class:"space-y-4 md:space-y-6"},N6={class:"space-y-2 md:space-y-3"},O6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},V6={class:"flex items-center justify-between"},M6={class:"flex items-center gap-2"},L6={class:"flex items-center justify-between"},$6={class:"flex items-center gap-2"},F6={class:"space-y-2 md:space-y-3"},U6={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},j6={class:"flex items-center justify-between"},B6={class:"flex items-center gap-2"},q6={class:"flex items-center justify-between"},z6={class:"flex items-center gap-2"},H6={class:"flex items-center justify-between pt-2 border-t border-white/10"},K6=["disabled"],G6={key:1,class:"inline-flex items-center text-xs text-gray-300"},W6={class:"flex items-center justify-between pt-2"},Q6=["disabled"],J6={key:0,class:"text-xs text-green-300"},Y6={key:1,class:"text-xs text-red-300"},X6={key:2,class:"text-[10px] text-gray-400 break-all"},Z6={class:"text-[10px] text-gray-500"},eU={key:0,class:"text-xs text-red-300"},tU={key:1,class:"text-xs text-green-300"},nU={class:"mt-6 flex justify-between items-center"},rU=["disabled"],u1={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),o=S(!1),a=S(""),l=S(""),c=S(!1),h=S(""),f=S(""),m=S(!1),v=S(localStorage.getItem("fcmToken")||""),w=S(!1),x=function(_){try{return _?_.length>20?_.slice(0,8)+"…"+_.slice(-6):_:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");function I(A){const{active:_,token:T}=A.detail;_&&T?(v.value=T,w.value=!0,localStorage.setItem("fcmToken",T),console.log("Notifications push réactivées automatiquement")):(w.value=!1,v.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push désactivées"))}async function O(){try{if(!s.value)return;const A=be(se,"userPreferences",s.value),_=await Wt(A);if(_.exists()){const T=_.data()||{};i.value.notifyAvailability=T.notifyAvailability!==!1,i.value.notifySelection=T.notifySelection!==!1,i.value.notifySelectionPush=T.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=T.notifyAvailabilityPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function L(){if(s.value){c.value=!0,f.value="",h.value="";try{if(!(await Zu()).active){f.value="Notifications push non actives sur cet appareil";return}await od({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),h.value="OK"}catch{f.value="Échec de l'envoi du test"}finally{c.value=!1}}}function U(){const A=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(A),alert(`🧪 Test de mise à jour PWA déclenché !

Vérifiez que la modal de mise à jour apparaît dans l'interface principale.`)}async function q(){try{if(m.value=!0,!await Wv()){f.value="Push non supporté sur cet appareil";return}const _=await Zu();_.active?(v.value=_.token,w.value=!0,localStorage.setItem("fcmToken",_.token),console.log("Notifications push activées avec succès")):f.value=`Activation impossible: ${_.error}`}catch(A){const _=typeof Notification<"u"?Notification.permission:"unknown",T=A&&(A.message||A.code)?` (${A.message||A.code})`:"";f.value=`Activation impossible – permission: ${_}${T}`}finally{m.value=!1}}async function te(){if(s.value){o.value=!0,a.value="",l.value="";try{const A=be(se,"userPreferences",s.value);await on(A,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function X(){r("close")}return kt(()=>t.show,A=>{A&&O()}),Tn(()=>{var A;try{s.value=((A=je==null?void 0:je.currentUser)==null?void 0:A.email)||"",w.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),v3(),window.addEventListener("push-status-changed",I),Zu().then(_=>{_.active&&(v.value=_.token,w.value=!0,localStorage.setItem("fcmToken",_.token))})}catch{}t.show&&O()}),Qs(()=>{window.removeEventListener("push-status-changed",I)}),(A,_)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:X},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:_[4]||(_[4]=ft(()=>{},["stop"]))},[d("button",{onClick:X,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),_[16]||(_[16]=ir('<div class="mb-4 md:mb-6"><div class="flex items-start gap-4"><div class="flex items-center gap-3"><div class="w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"><span class="text-lg md:text-xl">🔔</span></div><div class="space-y-2"><h3 class="text-white font-semibold text-base md:text-lg">Notifications</h3><p class="text-gray-400 text-xs md:text-sm">Ne ratez rien, soyez le premier prévenu !</p></div></div></div></div><div class="border-t border-white/10 mb-4 md:mb-6"></div>',2)),d("div",D6,[d("div",N6,[_[7]||(_[7]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-blue-400"},"📧"),lt(" Emails ")],-1)),d("div",O6,[d("div",V6,[d("label",M6,[st(d("input",{type:"checkbox","onUpdate:modelValue":_[0]||(_[0]=T=>i.value.notifyAvailability=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifyAvailability]]),_[5]||(_[5]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),d("div",L6,[d("label",$6,[st(d("input",{type:"checkbox","onUpdate:modelValue":_[1]||(_[1]=T=>i.value.notifySelection=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifySelection]]),_[6]||(_[6]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),d("div",F6,[_[15]||(_[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-emerald-400"},"📱"),lt(" Mobile (expérimental) ")],-1)),d("div",U6,[_[14]||(_[14]=d("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),d("div",j6,[d("label",B6,[st(d("input",{type:"checkbox","onUpdate:modelValue":_[2]||(_[2]=T=>i.value.notifySelectionPush=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifySelectionPush]]),_[8]||(_[8]=d("span",{class:"text-sm text-white"},"Me notifier lorsque je suis concerné par une sélection",-1))])]),d("div",q6,[d("label",z6,[st(d("input",{type:"checkbox","onUpdate:modelValue":_[3]||(_[3]=T=>i.value.notifyAvailabilityPush=T),class:"w-4 h-4"},null,512),[[Hi,i.value.notifyAvailabilityPush]]),_[9]||(_[9]=d("span",{class:"text-sm text-white"},"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),d("div",H6,[_[11]||(_[11]=d("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),w.value?(C(),D("span",G6,_[10]||(_[10]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),lt(" Actif ")]))):(C(),D("button",{key:0,onClick:q,disabled:m.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ee(m.value?"...":"Activer"),9,K6))]),d("div",W6,[_[12]||(_[12]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:L,disabled:c.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ee(c.value?"Envoi…":"Envoyer un test"),9,Q6)]),d("div",{class:"flex items-center justify-between pt-2"},[_[13]||(_[13]=d("div",{class:"text-xs text-gray-400"},"Test de mise à jour PWA",-1)),d("button",{onClick:U,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"}," 🧪 Simuler maj ")]),h.value?(C(),D("div",J6,"Notification test envoyée (vérifiez votre appareil)")):ie("",!0),f.value?(C(),D("div",Y6,ee(f.value),1)):ie("",!0),v.value?(C(),D("div",X6,"FCM token: "+ee(v.value),1)):ie("",!0),d("div",Z6,"VAPID: "+ee(Br(x)||"indisponible"),1)])]),a.value?(C(),D("div",eU,ee(a.value),1)):ie("",!0),l.value?(C(),D("div",tU,ee(l.value),1)):ie("",!0)]),d("div",nU,[d("button",{onClick:te,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},ee(o.value?"⏳":"Sauvegarder"),9,rU),d("button",{onClick:X,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ie("",!0)}},sU={class:"space-y-3"},iU={key:0,class:"text-sm text-gray-400"},oU={key:1,class:"space-y-2"},aU={class:"flex items-center justify-between gap-3"},lU={class:"truncate"},uU={class:"text-white font-semibold"},cU={class:"text-gray-400 text-xs"},dU=["onClick"],c1={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S([]);function o(h){return`${h.seasonId||"global"}__${h.playerId}`}async function a(){var h;try{s.value=((h=je==null?void 0:je.currentUser)==null?void 0:h.email)||""}catch{}try{const f=s.value?await Bf(s.value):[],m=[];for(const v of f){let w=v.playerId;try{if(v.seasonId){const x=be(se,"seasons",v.seasonId,"players",v.playerId),I=await Wt(x);I.exists()&&(w=I.data().name||w)}}catch{}m.push({...v,playerName:w})}i.value=m}catch{i.value=[]}}function l(h){r("manage-player",h),c()}function c(){r("close")}return kt(()=>t.show,h=>{h&&a()}),Tn(()=>{t.show&&a()}),(h,f)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:f[0]||(f[0]=ft(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),f[2]||(f[2]=ir('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes joueurs</h2><p class="text-sm text-gray-300">Gérez vos associations de joueurs</p></div>',1)),d("div",sU,[f[1]||(f[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(C(),D("div",iU,"Aucun joueur associé pour le moment.")):(C(),D("ul",oU,[(C(!0),D(mt,null,jr(i.value,m=>(C(),D("li",{key:o(m),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",aU,[d("div",lU,[d("div",uU,ee(m.seasonName||m.seasonId||"—"),1),d("div",cU,"Joueur : "+ee(m.playerName||"—"),1)]),d("button",{onClick:v=>l(m),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,dU)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ie("",!0)}};let dr="mock",Yi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],la=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function ny(n){dr=n}async function hU(){if(dr!=="firebase"||!(await $t(tt(se,"seasons"))).empty)return;const e=be(tt(se,"seasons"));await on(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:xr()});const t=await $t(tt(se,"players"));for(const o of t.docs)await on(be(e,"players",o.id),o.data());const r=await $t(tt(se,"events"));for(const o of r.docs)await on(be(e,"events",o.id),o.data());const s=await $t(tt(se,"availability"));for(const o of s.docs)await on(be(e,"availability",o.id),o.data());const i=await $t(tt(se,"selections"));for(const o of i.docs)await on(be(e,"selections",o.id),o.data())}async function d1(){dr==="firebase"&&await hU()}async function Fh(n=null){let e;return dr==="firebase"?n?e=(await $t(tt(se,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await $t(tt(se,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=la,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const h=new Date(c);return isNaN(h.getTime())?null:h},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function nc(n=null){let e;return dr==="firebase"?n?e=(await $t(tt(se,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await $t(tt(se,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=Yi,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function h1(n,e=null){if(dr==="firebase"){const t=be(e?tt(se,"seasons",e,"players"):tt(se,"players"));return await on(t,{name:n}),t.id}else{const t=`p${Yi.length+1}`;return Yi.push({id:t,name:n}),t}}async function fU(n,e=null){if(dr==="firebase"){const t=e?be(se,"seasons",e,"players",n):be(se,"players",n);await kl(t);const r=e?await $t(tt(se,"seasons",e,"availability")):await $t(tt(se,"availability")),s=vv(se);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else Yi=Yi.filter(t=>t.id!==n)}async function pU(n,e,t=null){if(dr==="firebase"){const r=t?be(se,"seasons",t,"players",n):be(se,"players",n),s=await Wt(r),i=s.exists()&&s.data().name||null;if(await on(r,{name:e},{merge:!0}),i&&i!==e){const o=vv(se);try{const a=t?be(se,"seasons",t,"availability",i):be(se,"availability",i),l=await Wt(a);if(l.exists()){const c=l.data()||{},h=t?be(se,"seasons",t,"availability",e):be(se,"availability",e);o.set(h,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?tt(se,"seasons",t,"selections"):tt(se,"selections");(await $t(a)).forEach(c=>{var f;const h=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(h.includes(i)){const m=h.map(v=>v===i?e:v);o.update(c.ref,{players:m})}})}catch{}await o.commit()}}else{const r=Yi.findIndex(s=>s.id===n);r!==-1&&(Yi[r]={...Yi[r],name:e})}}async function Oo(n,e,t=null){if(dr==="firebase"){const r=t?await $t(tt(se,"seasons",t,"availability")):await $t(tt(se,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Vo(n=null){if(dr==="firebase"){const e=n?await $t(tt(se,"seasons",n,"selections")):await $t(tt(se,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Ub(n,e,t=null){if(dr==="firebase"){const r=t?be(se,"seasons",t,"availability",n):be(se,"availability",n);await on(r,e)}}async function mU({seasonId:n,playerName:e,eventId:t,value:r}){if(dr!=="firebase")return;const s=n?be(se,"seasons",n,"availability",e):be(se,"availability",e),i=await Wt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await on(s,a)}async function jm(n,e,t=null){if(dr==="firebase"){const r=t?be(se,"seasons",t,"selections",n):be(se,"selections",n);await on(r,{players:e})}}async function gU(n,e=null){if(F.info("Suppression de l'événement",{eventId:n}),dr==="firebase")try{F.debug("Suppression de l'événement dans Firestore");const t=e?be(se,"seasons",e,"events",n):be(se,"events",n);await kl(t),F.debug("Suppression de la sélection associée");const r=e?be(se,"seasons",e,"selections",n):be(se,"selections",n);await kl(r),F.debug("Suppression des disponibilités");const s=e?await $t(tt(se,"seasons",e,"availability")):await $t(tt(se,"availability")),i=vv(se);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){F.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),F.info("Opérations de suppression terminées avec succès")}catch(t){throw F.error("Erreur lors de la suppression",t),t}else la=la.filter(t=>t.id!==n)}async function vU(n,e=null){if(dr==="firebase"){const t=be(e?tt(se,"seasons",e,"events"):tt(se,"events"));return await on(t,n),t.id}else{const t=`event${la.length+1}`;return la.push({id:t,...n}),t}}async function jb(n,e,t=null){if(dr==="firebase"){const r=t?be(se,"seasons",t,"events",n):be(se,"events",n);await on(r,e,{merge:!0})}else{const r=la.findIndex(s=>s.id===n);r!==-1&&(la[r]={id:n,...e})}}const yU={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},_U={class:"hero-section relative overflow-hidden pt-24"},bU={class:"hero-content py-16 md:py-24 px-4 relative z-10"},wU={class:"container mx-auto"},xU={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},IU={class:"text-center lg:text-left order-1 lg:order-2"},EU={class:"hero-cta mb-10"},TU={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},AU={class:"seasons-section py-16"},SU={class:"container mx-auto px-4"},PU=["aria-busy"],RU={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},CU={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},kU=["onClick"],DU={class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg overflow-hidden"},NU=["src","alt"],OU={key:1,class:"text-2xl"},VU={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},MU={key:0,class:"text-gray-300 text-sm mb-4 line-clamp-2 leading-relaxed"},LU={class:"flex justify-center gap-6 text-sm"},$U={class:"text-center"},FU={class:"text-white font-semibold"},UU={class:"text-center"},jU={class:"text-white font-semibold"},BU={class:"absolute top-4 right-4"},qU=["onClick","aria-expanded"],zU={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},HU=["onClick"],KU=["onClick"],GU=["onClick"],WU=["onClick"],QU=["onClick"],JU={class:"text-center mt-12"},YU={key:2,class:"text-center py-16"},XU={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},ZU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},e5={class:"mb-6"},t5={class:"mb-6"},n5={class:"mb-6"},r5={class:"mb-6"},s5={class:"flex justify-end space-x-3"},i5=["disabled"],o5={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},a5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},l5={class:"text-center mb-6"},u5={class:"text-gray-300"},c5={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},d5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},h5={class:"text-center mb-6"},f5={class:"text-gray-300"},p5={class:"mb-6"},m5={class:"mb-6"},g5={class:"mb-6"},v5={key:0,class:"mb-4 text-center"},y5={class:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-white/20"},_5=["src","alt"],b5=["disabled"],w5={key:0,class:"text-2xl mb-2 animate-spin"},x5={key:1,class:"text-2xl mb-2"},I5={class:"text-sm"},E5={key:0},T5={key:1},A5={key:2},S5={key:2,class:"text-xs text-gray-400 mt-1"},P5={class:"flex justify-end space-x-3"},R5=["disabled"],C5={key:0,class:"flex items-center gap-2"},k5={key:1},D5={__name:"Seasons",setup(n){const e=S([]),t=S(!0),r=ya(),s=S(null),i=S(!1),o=S(!1),a=S(!1),l=S(""),c=S(""),h=S(""),f=S(""),m=S(""),v=S(""),w=S(null),x=S(""),I=S(null),O=S(null),L=S(!1),U=S(!1),q=S(null),te=S(""),X=S(!1),A=S(!1),_=S(!1),T=S(!1),k=S(!1);Tn(async()=>{var j,_e;try{F.info("Début du chargement des saisons"),ny("firebase"),F.info("Mode de stockage défini sur Firebase"),await d1(),F.info("Stockage initialisé"),F.info("Attente de l'initialisation du service d'authentification...");try{q$(),await jA(),F.info("Service d'authentification initialisé")}catch(Le){F.warn("Service d'authentification non initialisé, continuation sans authentification:",Le.message||"Erreur inconnue")}try{fl(),F.info("Synchronisation forcée effectuée")}catch(Le){F.warn("Erreur lors de la synchronisation forcée:",Le)}F.info("Chargement des saisons...");try{e.value=await Za(),F.info("Saisons chargées",{count:((j=e.value)==null?void 0:j.length)||0})}catch(Le){throw F.error("Erreur lors du chargement des saisons:",Le),Le}if(e.value.length>0){F.info("Chargement des données des saisons...");const Le=await Promise.all(e.value.map(async Qe=>{try{F.debug(`Chargement des données pour la saison: ${Qe.name} (ID: ${Qe.id})`);let ze,It;try{ze=await Fh(Qe.id),F.debug(`Événements chargés pour ${Qe.name}:`,ze)}catch(yt){F.warn(`Erreur lors du chargement des événements pour ${Qe.name}:`,yt),ze=[]}try{It=await nc(Qe.id),F.debug(`Joueurs chargés pour ${Qe.name}:`,It)}catch(yt){F.warn(`Erreur lors du chargement des joueurs pour ${Qe.name}:`,yt),It=[]}return F.debug(`Saison ${Qe.name}: ${(ze==null?void 0:ze.length)||0} événements, ${(It==null?void 0:It.length)||0} joueurs`),{...Qe,events:ze||[],players:It||[]}}catch(ze){return F.warn(`Erreur lors du chargement des données pour la saison ${Qe.id}:`,ze),{...Qe,events:[],players:[]}}}));e.value=Le,F.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(Qe=>{var ze,It;F.info(`Saison finale ${Qe.name}: ${((ze=Qe.events)==null?void 0:ze.length)||0} événements, ${((It=Qe.players)==null?void 0:It.length)||0} joueurs`)})}Ne().catch(Le=>F.error("Migration sortOrder échouée",Le))}catch(Le){F.error("Erreur lors du chargement initial des saisons:",Le),F.error("Stack trace:",Le.stack);try{F.info("Tentative de fallback pour charger les saisons..."),e.value=await Za(),F.info("Saisons chargées en fallback",{count:((_e=e.value)==null?void 0:_e.length)||0})}catch(Qe){F.error("Échec du fallback pour charger les saisons:",Qe)}}finally{t.value=!1,F.info("Chargement terminé, isLoading = false")}const re=()=>{k.value=window.scrollY>10};return window.addEventListener("scroll",re,{passive:!0}),()=>{window.removeEventListener("scroll",re)}});const $=qe(()=>[...e.value].sort((re,j)=>{var It,yt;const _e=typeof re.sortOrder=="number"?re.sortOrder:Number.MAX_SAFE_INTEGER,Le=typeof j.sortOrder=="number"?j.sortOrder:Number.MAX_SAFE_INTEGER;if(_e!==Le)return _e-Le;const Qe=(It=re.createdAt)!=null&&It.toMillis?re.createdAt.toMillis():0,ze=(yt=j.createdAt)!=null&&yt.toMillis?j.createdAt.toMillis():0;return Qe!==ze?ze-Qe:(re.name||"").localeCompare(j.name||"")}));function V(re){r.push(`/season/${re}`)}function R(re){s.value=s.value===re?null:re}function Ke(){s.value=null}function ut(re){O.value=re,m.value=re.name,v.value=re.description||"",w.value=null,x.value=re.logoUrl||"",a.value=!0,Ke()}function ct(){a.value=!1,O.value=null,m.value="",v.value="",w.value=null,x.value="",L.value=!1}async function Ge(){a.value=!1,await pe({type:"editSeason",data:{seasonId:O.value.id,seasonName:O.value.name,newName:m.value.trim(),newDescription:v.value.trim(),newLogo:w.value,newLogoPreview:x.value,oldName:O.value.name,oldDescription:O.value.description||"",oldLogoUrl:O.value.logoUrl||""}})}function Ae(){const re=document.querySelector(".help-section");re&&re.scrollIntoView({behavior:"smooth"})}function fe(){const re=document.querySelector(".seasons-section");re&&re.scrollIntoView({behavior:"smooth"})}function Je(re){const j=re.target.files[0];if(j){w.value=j,L.value=!0;const _e=new FileReader;_e.onload=Le=>{x.value=Le.target.result,L.value=!1},_e.onerror=()=>{L.value=!1},_e.readAsDataURL(j)}}function ae(){console.log("removeLogo appelé"),w.value=null,x.value="",console.log("Logo supprimé")}function ne(){const re=document.querySelector('input[type="file"][accept="image/*"]');re?re.click():console.error("Input file non trouvé pour triggerLogoUpload")}async function Ne(){if(!e.value.length)return;const re=e.value.map(_e=>typeof _e.sortOrder=="number"?_e.sortOrder:null).filter(_e=>_e!==null);let j=re.length?Math.max(...re):0;for(const _e of e.value)if(typeof _e.sortOrder!="number"){j+=1;try{await Ru(_e.id,j),_e.sortOrder=j}catch(Le){F.error("Erreur migration sortOrder",{seasonName:_e==null?void 0:_e.name,error:Le})}}}async function dt(re){try{if(!(re!=null&&re.id)){alert("Saison introuvable");return}const[j,_e]=await Promise.all([Fh(re.id),nc(re.id)]),[Le,Qe]=await Promise.all([Oo(_e,j,re.id),Vo(re.id)]),ze=["Joueur",...j.map(Xn=>en(Xn))],It=[];for(const Xn of _e){const Zn=(Xn==null?void 0:Xn.name)||"",bn=(Le==null?void 0:Le[Zn])||{},vo=[Zn,...j.map(ms=>nt(bn[ms.id],Qe==null?void 0:Qe[ms.id],Zn))];It.push(vo)}const yt=xe([ze,...It]),Ut=new Blob(["\uFEFF"+yt],{type:"text/csv;charset=utf-8;"}),Rn=(re==null?void 0:re.name)||(re==null?void 0:re.slug)||"saison",Yn=`${Pe(Rn)}-disponibilites.csv`,ot=URL.createObjectURL(Ut),Rt=document.createElement("a");Rt.href=ot,Rt.download=Yn,document.body.appendChild(Rt),Rt.click(),document.body.removeChild(Rt),URL.revokeObjectURL(ot),F.info("Export CSV saison",{seasonId:re.id,events:j.length,players:_e.length})}catch(j){F.error("Erreur export CSV",j),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function Pt(re){if(!re)return null;if(re instanceof Date)return re;if(typeof(re==null?void 0:re.toDate)=="function")return re.toDate();if(typeof re=="string"||typeof re=="number"){const j=new Date(re);return isNaN(j.getTime())?null:j}return null}function en(re){const j=Pt(re==null?void 0:re.date),_e=j?`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`:"",Le=(re==null?void 0:re.title)||"Sans titre";return`${_e} · ${Le}`.trim()}function Y(re){return re===!0||re==="oui"?"disponible":re===!1||re==="non"?"non disponible":""}function xe(re){return re.map(j=>j.map(ve).join(",")).join(`
`)}function ve(re){const j=String(re??"");return/[",\n\r]/.test(j)?'"'+j.replace(/"/g,'""')+'"':j}function Pe(re){return String(re||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function nt(re,j,_e){return Array.isArray(j)&&j.includes(_e)?re===!1||re==="non"?"non disponible":"sélectionné":Y(re)}async function vt(re){if(Ke(),re<=0)return;const j=[...$.value],_e=j[re],Le=j[re-1],Qe=_e.sortOrder;_e.sortOrder=Le.sortOrder,Le.sortOrder=Qe;try{await Promise.all([Ru(_e.id,_e.sortOrder),Ru(Le.id,Le.sortOrder)])}catch(ze){F.error("Erreur lors du déplacement vers le haut",ze)}}async function P(re){Ke();const j=[...$.value];if(re>=j.length-1)return;const _e=j[re],Le=j[re+1],Qe=_e.sortOrder;_e.sortOrder=Le.sortOrder,Le.sortOrder=Qe;try{await Promise.all([Ru(_e.id,_e.sortOrder),Ru(Le.id,Le.sortOrder)])}catch(ze){F.error("Erreur lors du déplacement vers le bas",ze)}}function N(){l.value&&(c.value=l.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function H(){f.value=f.value.replace(/[^0-9]/g,""),f.value.length>4&&(f.value=f.value.slice(0,4))}async function K(){if(!l.value.trim()||!c.value.trim()||!f.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(f.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await C$(l.value.trim(),c.value.trim(),f.value.trim(),h.value.trim(),""),e.value=await Za(),await Ne(),Z()}catch(re){F.error("Erreur lors de la création de la saison",re),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function Z(){i.value=!1,l.value="",c.value="",h.value="",f.value=""}function ue(re){I.value=re,o.value=!0}async function ge(){o.value=!1,await pe({type:"deleteSeason",data:{seasonId:I.value.id,seasonName:I.value.name}})}function me(){o.value=!1,I.value=null}function ye(){return q.value?{deleteSeason:"Suppression de saison - Code PIN requis",editSeason:"Modification de saison - Code PIN requis"}[q.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function pe(re){const j=re.type==="editSeason"?re.data.seasonId:I.value.id;if(Hn.isPinCached(j)){const _e=Hn.getCachedPin(j);if(F.debug("PIN en cache trouvé, utilisation automatique"),await Vh(j,_e)){await Fe(re);return}else Hn.clearSession()}q.value=re,U.value=!0}async function Ve(re){var j,_e,Le,Qe;F.debug("PIN soumis pour l'opération",{operationType:(j=q.value)==null?void 0:j.type});try{const ze=((Le=(_e=q.value)==null?void 0:_e.data)==null?void 0:Le.seasonId)||((Qe=I.value)==null?void 0:Qe.id),It=await Vh(ze,re);if(F.debug("PIN validé",{valid:It}),It){Hn.saveSession(ze,re),F.debug("PIN correct, fermeture de la modal et exécution de l'opération"),U.value=!1;const yt=q.value;q.value=null,F.debug("Appel de executePendingOperation",{operationType:yt==null?void 0:yt.type}),await Fe(yt)}else te.value="Code PIN incorrect",setTimeout(()=>{te.value=""},3e3)}catch(ze){F.error("Erreur lors de la vérification du PIN",ze),te.value="Erreur lors de la vérification du code PIN"}}function Te(){U.value=!1,q.value=null,te.value=""}function Ce(){return I.value&&Hn.isPinCached(I.value.id)?{timeRemaining:Hn.getTimeRemaining(),isExpiringSoon:Hn.isExpiringSoon()}:null}async function Fe(re){var Le;if(F.debug("executePendingOperation appelé",{hasOperation:!!re}),!re){F.warn("Aucune opération à exécuter");return}const{type:j,data:_e}=re;F.info("Exécution de l'opération",{type:j});try{switch(j){case"deleteSeason":F.info("Suppression de la saison",{seasonId:_e.seasonId}),await k$(_e.seasonId),F.info("Saison supprimée, rechargement de la liste"),e.value=await Za(),F.info("Liste des saisons rechargée",{count:((Le=e.value)==null?void 0:Le.length)||0});break;case"editSeason":F.info("Modification de la saison",{seasonId:_e.seasonId});const Qe=_e.newName!==_e.oldName,ze=_e.newDescription!==_e.oldDescription,It=_e.newLogo!==null;if(!Qe&&!ze&&!It){F.info("Aucun changement détecté, opération annulée");return}const yt={};if(_e.newName!==_e.oldName&&(yt.name=_e.newName),_e.newDescription!==_e.oldDescription&&(yt.description=_e.newDescription),_e.newLogo)try{L.value=!0,F.info("Upload du nouveau logo...");const Rn=await J$(_e.newLogo,`season-logos/${_e.seasonId}`,{resize:!0,maxWidth:64,maxHeight:64,quality:.6});if(yt.logoUrl=Rn,_e.oldLogoUrl&&Z$(_e.oldLogoUrl))try{await X$(_e.oldLogoUrl),F.info("Ancien logo supprimé")}catch(Yn){F.warn("Erreur lors de la suppression de l'ancien logo:",Yn)}}catch(Rn){throw F.error("Erreur lors de l'upload du logo:",Rn),new Error("Erreur lors de l'upload du logo: "+Rn.message)}finally{L.value=!1}await D$(_e.seasonId,yt);const Ut=e.value.findIndex(Rn=>Rn.id===_e.seasonId);Ut!==-1&&(yt.name&&(e.value[Ut].name=_e.newName),yt.description!==void 0&&(e.value[Ut].description=_e.newDescription),yt.logoUrl&&(e.value[Ut].logoUrl=yt.logoUrl)),F.info("Saison modifiée avec succès",{seasonId:_e.seasonId,oldName:_e.oldName,newName:_e.newName,oldDescription:_e.oldDescription,newDescription:_e.newDescription});break;default:F.warn("Type d'opération non reconnu",{type:j})}}catch(Qe){F.error("Erreur lors de l'exécution de l'opération",Qe),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function Ue(){X.value=!0}function We(){X.value=!1}function rt(){X.value=!1,vi()}function an(){A.value=!0}function Ht(){A.value=!1}function On(){_.value=!0}function Qt(){_.value=!1}function Kr(){T.value=!0}function Os(){T.value=!1}function _n(){F.debug("Gestion de joueur demandée")}async function Pn(){try{await je.signOut(),A.value=!1,F.info("Utilisateur déconnecté avec succès")}catch(re){F.error("Erreur lors de la déconnexion",re),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function vi(){try{const re=await UA();if(re){r.push(`/season/${re}`);return}}catch(re){F.warn("Impossible de récupérer la saison préférée",re)}fe()}return Tn(()=>(fl(),()=>{})),kt(()=>r.currentRoute.value.path,async re=>{var j;if(re==="/"&&(fl(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await Za(),F.info("Saisons rechargées lors du changement de route",{count:((j=e.value)==null?void 0:j.length)||0})}catch(_e){F.error("Erreur lors du rechargement des saisons",_e)}finally{t.value=!1}}},{immediate:!0}),(re,j)=>{var _e,Le,Qe,ze,It,yt,Ut,Rn,Yn;return C(),D("div",yU,[Be(k6,{"is-scrolled":k.value,onOpenAccountMenu:an,onOpenHelp:Ae,onOpenNotifications:On,onOpenPlayers:Kr,onLogout:Pn,onOpenLogin:Ue},null,8,["is-scrolled"]),d("section",_U,[d("div",bU,[d("div",wU,[d("div",xU,[j[13]||(j[13]=ir('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+W$+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",IU,[j[12]||(j[12]=ir('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",EU,[d("div",TU,[d("button",{onClick:j[0]||(j[0]=ot=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:Ae,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},j[10]||(j[10]=[d("span",null,"ℹ️",-1),lt(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:fe,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},j[11]||(j[11]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),j[14]||(j[14]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",AU,[d("div",SU,[j[32]||(j[32]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(C(),D("div",RU,[(C(),D(mt,null,jr(8,ot=>d("div",{key:"skeleton-"+ot,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},j[15]||(j[15]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(C(),D("div",CU,[(C(!0),D(mt,null,jr($.value,(ot,Rt)=>{var Xn,Zn;return C(),D("div",{key:ot.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:bn=>V(ot.slug),class:"text-center cursor-pointer"},[d("div",DU,[ot.logoUrl?(C(),D("img",{key:0,src:ot.logoUrl,alt:`Logo de ${ot.name}`,class:"w-full h-full object-cover"},null,8,NU)):(C(),D("span",OU,"🎭"))]),d("h2",VU,ee(ot.name),1),ot.description?(C(),D("p",MU,ee(ot.description),1)):ie("",!0),j[18]||(j[18]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",LU,[d("div",$U,[d("div",FU,ee(((Xn=ot.events)==null?void 0:Xn.length)||0),1),j[16]||(j[16]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",UU,[d("div",jU,ee(((Zn=ot.players)==null?void 0:Zn.length)||0),1),j[17]||(j[17]=d("div",{class:"text-gray-400 text-xs"},"Joueurs",-1))])])],8,kU),d("div",BU,[d("div",{class:"relative",onClick:j[1]||(j[1]=ft(()=>{},["stop"]))},[d("button",{onClick:bn=>R(Rt),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Rt,"aria-haspopup":"true",title:"Options"},j[19]||(j[19]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,qU),s.value===Rt?(C(),D("div",zU,[d("button",{onClick:bn=>{dt(ot),Ke()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[20]||(j[20]=[d("span",null,"📊",-1),lt(" Exporter CSV ")]),8,HU),j[25]||(j[25]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:bn=>vt(Rt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[21]||(j[21]=[d("span",null,"⬆️",-1),lt(" Avancer ")]),8,KU),d("button",{onClick:bn=>P(Rt),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[22]||(j[22]=[d("span",null,"⬇️",-1),lt(" Reculer ")]),8,GU),j[26]||(j[26]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:bn=>ut(ot),class:"w-full text-left px-4 py-2 text-sm text-blue-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},j[23]||(j[23]=[d("span",null,"✏️",-1),lt(" Modifier ")]),8,WU),j[27]||(j[27]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:bn=>ue(ot),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",role:"menuitem"},j[24]||(j[24]=[d("span",null,"🗑️",-1),lt(" Supprimer ")]),8,QU)])):ie("",!0)])])])}),128))])):ie("",!0),d("div",JU,[d("button",{onClick:j[2]||(j[2]=ot=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},j[28]||(j[28]=[d("span",null,"➕",-1),lt(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(C(),D("div",YU,[j[29]||(j[29]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),j[30]||(j[30]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),j[31]||(j[31]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:j[3]||(j[3]=ot=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ie("",!0)],8,PU)])]),i.value?(C(),D("div",XU,[d("div",ZU,[j[39]||(j[39]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",e5,[j[33]||(j[33]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),st(d("input",{"onUpdate:modelValue":j[4]||(j[4]=ot=>l.value=ot),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:N},null,544),[[Lt,l.value]])]),d("div",t5,[j[34]||(j[34]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),st(d("input",{"onUpdate:modelValue":j[5]||(j[5]=ot=>c.value=ot),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Lt,c.value]])]),d("div",n5,[j[35]||(j[35]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),st(d("textarea",{"onUpdate:modelValue":j[6]||(j[6]=ot=>h.value=ot),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Lt,h.value]]),j[36]||(j[36]=d("p",{class:"text-xs text-gray-400 mt-1"},"Une brève description de votre saison",-1))]),d("div",r5,[j[37]||(j[37]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),st(d("input",{"onUpdate:modelValue":j[7]||(j[7]=ot=>f.value=ot),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:H},null,544),[[Lt,f.value]]),j[38]||(j[38]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",s5,[d("button",{onClick:Z,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:K,disabled:!l.value.trim()||!c.value.trim()||!f.value.trim()||f.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,i5)])])])):ie("",!0),o.value?(C(),D("div",o5,[d("div",a5,[d("div",l5,[j[40]||(j[40]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),j[41]||(j[41]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",u5,'Êtes-vous sûr de vouloir supprimer la saison "'+ee((_e=I.value)==null?void 0:_e.name)+'" ?',1)]),j[42]||(j[42]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:me,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ge,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ie("",!0),a.value?(C(),D("div",c5,[d("div",d5,[d("div",h5,[j[43]||(j[43]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"✏️")],-1)),j[44]||(j[44]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Modifier la saison",-1)),d("p",f5,'Modifiez les informations de la saison "'+ee((Le=O.value)==null?void 0:Le.name)+'"',1)]),d("div",p5,[j[45]||(j[45]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),st(d("input",{"onUpdate:modelValue":j[8]||(j[8]=ot=>m.value=ot),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026"},null,512),[[Lt,m.value]])]),d("div",m5,[j[46]||(j[46]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),st(d("textarea",{"onUpdate:modelValue":j[9]||(j[9]=ot=>v.value=ot),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Lt,v.value]])]),d("div",g5,[j[47]||(j[47]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Logo de la troupe (optionnel)",-1)),x.value||(Qe=O.value)!=null&&Qe.logoUrl?(C(),D("div",v5,[d("div",y5,[d("img",{src:x.value||((ze=O.value)==null?void 0:ze.logoUrl),alt:`Logo de ${(It=O.value)==null?void 0:It.name}`,class:"w-full h-full object-cover"},null,8,_5)]),x.value||(yt=O.value)!=null&&yt.logoUrl?(C(),D("button",{key:0,onClick:ae,type:"button",class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Supprimer le logo ")):ie("",!0)])):ie("",!0),d("div",{class:cn(["border-2 border-dashed rounded-lg p-6 text-center transition-all duration-300",L.value?"border-blue-500 bg-blue-900/20 animate-pulse":"border-gray-600 hover:border-gray-500"])},[d("input",{ref:"logoFileInput",type:"file",accept:"image/*",onChange:Je,class:"hidden"},null,544),d("button",{onClick:ne,type:"button",disabled:L.value,class:"text-gray-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[L.value?(C(),D("div",w5,"⏳")):(C(),D("div",x5,"📷")),d("div",I5,[L.value?(C(),D("span",E5," Upload en cours... ")):!x.value&&!((Ut=O.value)!=null&&Ut.logoUrl)?(C(),D("span",T5," Cliquez pour ajouter un logo ")):(C(),D("span",A5," Cliquez pour changer le logo "))]),L.value?ie("",!0):(C(),D("div",S5," PNG, JPG, GIF (max 5MB) "))],8,b5)],2)]),j[49]||(j[49]=d("p",{class:"mb-6 text-sm text-blue-400 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20"}," ℹ️ Le slug de l'URL restera inchangé pour préserver les liens existants. ",-1)),d("div",P5,[d("button",{onClick:ct,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Ge,disabled:!m.value.trim()||m.value.trim()===((Rn=O.value)==null?void 0:Rn.name)&&v.value===(((Yn=O.value)==null?void 0:Yn.description)||"")&&!w.value||L.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"},[L.value?(C(),D("span",C5,j[48]||(j[48]=[d("span",{class:"animate-spin"},"⏳",-1),lt(" Upload en cours... ")]))):(C(),D("span",k5,"Modifier"))],8,R5)])])])):ie("",!0),Be(qA,{show:U.value,message:ye(),error:te.value,"session-info":Ce(),onSubmit:Ve,onCancel:Te},null,8,["show","message","error","session-info"]),j[50]||(j[50]=ir('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de joueurs vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque joueur indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-950 to-black"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8"><div><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+Mm+'" alt="Logo HatCast" class="w-full h-full brightness-0 invert"></div></div><p class="text-gray-300 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos joueurs d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Feedback</h4><div class="space-y-2"><a href="https://github.com/plamarque/hatcast/issues" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🐛 Signaler un bug </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a></div></div></div><div class="text-center text-xs text-gray-500 pt-6"><span>© Patrice Lamarque 2025</span></div></div></footer>',2)),Be(zA,{show:X.value,onClose:We,onSuccess:rt},null,8,["show"]),Be(l1,{show:A.value,onClose:Ht,onLogoutDevice:Pn},null,8,["show"]),Be(u1,{show:_.value,onClose:Qt},null,8,["show"]),Be(c1,{show:T.value,onClose:Os,onManagePlayer:_n},null,8,["show"])])}}};function N5({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,c;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const h=(i==null?void 0:i.notifyAvailability)!==!1,f=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:h,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:f,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🎯 Nouveau spectacle !",body:n==="availability_reminder"?`${e}, ${t} (${r})`:`🎭 On a besoin de toi pour ${t} le ${r} !`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilité:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const h=(i==null?void 0:i.notifySelection)!==!1,f=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:h,subject:`🎭 Equipe pour ${t}`},a.push={enabled:f,title:"🎭 Tu es sélectionné(e) !",body:`🕺 Prépares-toi à briller pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de sélection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(l=a.email)==null?void 0:l.enabled,pushEnabled:(c=a.push)==null?void 0:c.enabled}),a}async function O5({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){var m;if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Wt(be(se,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=N5({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),h=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await OF({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>h.push({channel:"email",success:!0})).catch(v=>{F.error("notifyRecipientAcrossChannels email error",v),h.push({channel:"email",success:!1})}):n==="selection"&&h.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled?(F.debug("Envoi notification push",{reason:n,recipientEmail:e,title:c.push.title,body:c.push.body}),await od({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>{F.info("Notification push envoyée avec succès",{reason:n,recipientEmail:e}),h.push({channel:"push",success:!0})}).catch(v=>{F.error("notifyRecipientAcrossChannels push error",v),h.push({channel:"push",success:!1})})):F.debug("Notification push désactivée ou non configurée",{reason:n,recipientEmail:e,hasPayload:!!c.push,enabled:(m=c.push)==null?void 0:m.enabled,prefs:l}),{success:h.some(v=>v.success),results:h}}async function Bb({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const h of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(h.name,n));if(v===!0||v===!1)continue}const f={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:h.id,eventId:n,action:"yes"}),w=await i({seasonId:r,playerId:h.id,eventId:n,action:"no"});f.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${w.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await O5({reason:o?"availability_reminder":"availability_request",recipientEmail:h.email,recipientName:h.name,eventTitle:e.title,eventDate:V5(e.date),urls:f})).success||l.push(h.id)}catch{l.push(h.id)}return{success:!0,failures:l}}async function qb(n){return $F(n)}function V5(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function M5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function L5(n,e=""){const t=M5(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function $5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function F5(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function U5(n,e=""){const t=$5(n,e);window.open(t,"_blank")}function j5(n,e=""){const t=F5(n,e);window.open(t,"_blank")}function B5(n,e,t=""){switch(n){case"ics":L5(e,t);break;case"google":U5(e,t);break;case"outlook":j5(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}function f1(){const n=!!localStorage.getItem("fcmToken")||!!localStorage.getItem("userEmail")||!!localStorage.getItem("authUser"),e=Notification.permission==="granted"&&!!localStorage.getItem("fcmToken");return!n&&!e}async function p1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{const o=await Lh({seasonId:n,playerId:"notification_activation",eventId:e,action:"activate_notifications",slug:i}),a=`${n}_${e}_${r.replace(/[^a-zA-Z0-9]/g,"_")}`;return await on(be(se,"notificationActivations",a),{seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i,magicLinkId:o.id,magicLinkUrl:o.url,requestedAt:xr(),status:"pending"}),await UF({toEmail:r,playerName:t,eventTitle:s,eventUrl:`${window.location.origin}/season/${i}/event/${e}`,activationUrl:o.url,seasonTitle:i}),F.info("Demande d'activation des notifications créée",{activationId:a,email:r,playerName:t,eventId:e}),{success:!0,activationId:a,magicLink:o}}catch(o){throw F.error("Erreur lors de la création de la demande d'activation",o),o}}async function q5(n){try{const e=await z5(n);if(!e)throw new Error("Données d'activation introuvables");const{verifyMagicLink:t}=await xt(()=>Promise.resolve().then(()=>JA),void 0);if(!(await t({seasonId:e.seasonId,playerId:"notification_activation",eventId:e.eventId,token:n,action:"activate_notifications"})).valid)throw new Error("Magic link invalide ou expiré");const s=await m1(),i=await G5(e.email);return await g1(e.email,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await H5(e.activationId),await v1(e),F.info("Notifications activées avec succès",{email:e.email,playerName:e.playerName,pushStatus:s}),{success:!0,email:e.email,playerName:e.playerName,pushStatus:s,accountStatus:i}}catch(e){throw F.error("Erreur lors de l'activation des notifications",e),e}}async function z5(n){try{const{collection:e,query:t,where:r,getDocs:s}=await xt(()=>import("./index.esm-8019458b.js"),[]),i=t(e(se,"notificationActivations"),r("status","==","pending")),o=await s(i);for(const a of o.docs){const l=a.data();if(l.magicLinkUrl&&l.magicLinkUrl.includes(n))return{...l,activationId:a.id}}return null}catch(e){return F.error("Erreur lors de la récupération des données d'activation",e),null}}async function m1(){try{if(!await Wv())return{active:!1,reason:"not_supported"};if(await Notification.requestPermission()!=="granted")return{active:!1,reason:"permission_denied"};const e=await EA();return e?{active:!0,token:e}:{active:!1,reason:"token_failed"}}catch(n){return F.error("Erreur lors de l'activation des notifications push",n),{active:!1,reason:"error",error:n.message}}}async function g1(n,e){try{await on(be(se,"userPreferences",n),{...e,updatedAt:xr(),notificationActivatedAt:xr()},{merge:!0})}catch(t){throw F.error("Erreur lors de la mise à jour des préférences",t),t}}async function H5(n){try{await go(be(se,"notificationActivations",n),{status:"completed",completedAt:xr()})}catch(e){F.error("Erreur lors de la finalisation de l'activation",e)}}async function v1(n){try{const{collection:e,query:t,where:r,getDocs:s,setDoc:i}=await xt(()=>import("./index.esm-8019458b.js"),[]),o=t(e(se,"playerAssociations"),r("email","==",n.email),r("seasonId","==",n.seasonId));if(!(await s(o)).empty){F.info("Association joueur-email déjà existante",{email:n.email,seasonId:n.seasonId});return}await i(be(se,"playerAssociations",`${n.seasonId}_${n.email}`),{email:n.email,seasonId:n.seasonId,playerName:n.playerName,associatedAt:xr(),source:"notification_activation"}),F.info("Joueur associé à l'email",{email:n.email,playerName:n.playerName,seasonId:n.seasonId})}catch(e){F.error("Erreur lors de l'association du joueur",e)}}async function K5({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{console.log("🔔 Activation directe des notifications pour utilisateur connecté");const o=await m1();return await g1(r,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await v1({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}),F.info("Notifications activées directement pour utilisateur connecté",{email:r,playerName:t,eventId:e,pushStatus:o}),{success:!0,email:r,playerName:t,pushStatus:o,directActivation:!0}}catch(o){throw F.error("Erreur lors de l'activation directe des notifications",o),o}}async function G5(n){try{const{auth:e}=await xt(()=>Promise.resolve().then(()=>us),void 0),{signInWithEmailAndPassword:t,createUserWithEmailAndPassword:r}=await xt(()=>import("./index.esm-183b5cd6.js"),[]);try{return await t(e,n,"temp_password_123"),F.info("Compte Firebase Auth existant trouvé",{email:n}),{created:!1,reason:"already_exists"}}catch(s){if(s.code==="auth/user-not-found")try{const i=await r(e,n,"temp_password_123"),{sendPasswordResetEmail:o}=await xt(()=>import("./index.esm-183b5cd6.js"),[]);return await o(e,n),F.info("Compte Firebase Auth créé avec succès",{email:n,uid:i.user.uid}),{created:!0,reason:"new_account_created",uid:i.user.uid,passwordResetSent:!0}}catch(i){return F.error("Erreur lors de la création du compte Firebase Auth",i),{created:!1,reason:"creation_failed",error:i.message}}else return F.warn("Erreur de connexion Firebase Auth",{email:n,error:s.code}),{created:!1,reason:"auth_error",error:s.code}}}catch(e){return F.error("Erreur lors de la vérification/création du compte Firebase Auth",e),{created:!1,reason:"general_error",error:e.message}}}const y1=Object.freeze(Object.defineProperty({__proto__:null,activateNotificationsForConnectedUser:K5,createNotificationActivationRequest:p1,processNotificationActivation:q5,shouldPromptForNotifications:f1},Symbol.toStringTag,{value:"Module"}));const W5={class:"space-y-4"},Q5={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},J5={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},Y5={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},X5={key:0,class:"space-y-3"},Z5={class:"text-gray-300 text-sm mb-3"},ej={class:"text-white font-medium"},tj={class:"text-green-400 font-medium"},nj={class:"text-yellow-400 font-medium"},rj={class:"flex flex-wrap gap-2"},sj=["title"],ij={key:0,class:"text-green-400 text-xs"},oj={key:1,class:"text-yellow-400 text-xs"},aj={key:1,class:"text-amber-400 text-sm"},lj={class:"space-y-3"},uj={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in"},cj={class:"whitespace-pre-wrap font-sans"},dj={__name:"MessagePreview",props:{mode:{type:String,required:!0,validator:n=>["event","selection"].includes(n)},event:{type:Object,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},selectedPlayers:{type:Array,default:()=>[]},availabilityByPlayer:{type:Object,default:()=>({})}},setup(n){const e=n,t=S(!1),r=S(!1),s=S([]),i=S([]),o=S([]),a=qe(()=>!e.event||!e.seasonSlug?"":`${window.location.origin}/season/${e.seasonSlug}/event/${e.event.id}`),l=qe(()=>{const w=i.value.map(I=>({...I,hasContact:I.id!=="ALL",missingReason:""})),x=o.value.map(I=>({...I,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...w.filter(I=>I.id!=="ALL"),...x]}),c=qe(()=>{var O,L;if(!e.event)return"";const w=m((O=e.event)==null?void 0:O.date),x=(L=e.event)==null?void 0:L.title,I=a.value;return e.mode==="event"?RF({playerName:"",eventTitle:x,eventDate:w,eventUrl:I}):CF({playerName:"",eventTitle:x,eventDate:w,eventUrl:I})}),h=qe(()=>c.value);function f(){navigator.clipboard.writeText(h.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}function m(w){if(!w)return"";const x=new Date(w),I={weekday:"long",day:"numeric",month:"long",year:"numeric"};return x.toLocaleDateString("fr-FR",I)}async function v(){if(!e.seasonId)return;let w=[];e.mode==="selection"?(w=e.players.filter(L=>e.selectedPlayers.includes(L.name)),console.log("Mode sélection - targetPlayers:",w)):(w=e.players,console.log("Mode événement - targetPlayers (tous):",w));const x=[];for(const L of w)try{const{getPlayerEmail:U}=await xt(()=>Promise.resolve().then(()=>ld),void 0),q=await U(L.id,e.seasonId);console.log(`Email pour ${L.name}:`,q),q&&x.push({...L,email:q})}catch(U){console.warn(`Impossible de charger l'email pour ${L.name}:`,U)}console.log("Players avec email:",x),s.value=x;const I={id:"ALL",name:"Tous"};i.value=[I,...x];const O=w.filter(L=>!x.find(U=>U.id===L.id)).map(L=>({id:L.id,name:L.name}));o.value=O,console.log("Recipients finaux:",{recipients:i.value,nonContactRecipients:o.value,allDisplayRecipients:l.value})}return Tn(()=>{v()}),kt(()=>[e.selectedPlayers,e.availabilityByPlayer],()=>{v()},{deep:!0}),(w,x)=>(C(),D("div",W5,[d("div",null,[d("label",Q5,[x[1]||(x[1]=lt(" Personnes à Prévenir ")),d("button",{onClick:x[0]||(x[0]=I=>t.value=!t.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),t.value?(C(),D("div",J5,x[2]||(x[2]=[d("p",{class:"text-blue-200 text-sm"},[lt(" Cette liste montre tous les joueurs ciblés: "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),lt(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),lt(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise le message ci-dessous pour les contacter manuellement. ")],-1)]))):ie("",!0),d("div",Y5,[l.value.length>0?(C(),D("div",X5,[d("div",Z5,[d("span",ej,ee(l.value.length-1),1),x[3]||(x[3]=lt(" personnes à prévenir. ")),d("span",tj,ee(s.value.length),1),x[4]||(x[4]=lt(" seront notifiées, ")),d("span",nj,ee(o.value.length),1),x[5]||(x[5]=lt(" devront être prévenues manuellement. "))]),d("div",rj,[(C(!0),D(mt,null,jr(l.value.filter(I=>I.id!=="ALL"),I=>(C(),D("span",{key:I.id||I.name,class:cn(["px-3 py-1 rounded text-sm border flex items-center gap-1",I.hasContact?"bg-gray-700 border-gray-600 text-white":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 opacity-75"]),title:I.hasContact?"Peut être notifié automatiquement":"Aucun canal actif - notification manuelle requise"},[lt(ee(I.name)+" ",1),I.hasContact?(C(),D("span",ij,"✓")):(C(),D("span",oj,"⚠️"))],10,sj))),128))])])):(C(),D("div",aj," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[x[6]||(x[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Message à copier pour les contacts manuels :",-1)),d("div",lj,[r.value?(C(),D("div",uj," ✅ Copié ! ")):ie("",!0),d("div",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm cursor-pointer hover:bg-gray-700 transition-colors",onClick:f,title:"Cliquer pour copier le texte"},[d("pre",cj,ee(h.value),1)])])])]))}},hj=$f(dj,[["__scopeId","data-v-88cc77b7"]]);const fj={class:"relative p-5 pb-4 border-b border-white/10"},pj={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},mj={class:"hidden sm:inline"},gj={key:0,class:"text-sm text-purple-300 mt-1"},vj={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},yj={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},_j={class:"flex items-center gap-2 w-full"},bj=["disabled"],wj={key:0},xj={key:1,class:"inline-flex items-center gap-2"},Ij={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=qe(()=>t.sending||s.value);function o(){r("close")}function a(c){var f;return c?(typeof c=="string"?new Date(c):((f=c.toDate)==null?void 0:f.call(c))||c).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function l(){if(t.event){s.value=!0;try{r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:t.mode==="selection"?"selection":"event",selectedPlayers:t.selectedPlayers,scope:"all"})}catch(c){console.error("Erreur lors de l'envoi des notifications:",c),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer."),s.value=!1}}}return kt(()=>t.sending,c=>{c||(s.value=!1)}),(c,h)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:o},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:h[0]||(h[0]=ft(()=>{},["stop"]))},[d("div",fj,[d("button",{onClick:o,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",pj,[d("span",mj,ee(n.mode==="selection"?"📣":"📢"),1),d("span",null,ee(n.mode==="selection"?"Confirmer la sélection":"Confirmer l'événement"),1)]),n.event?(C(),D("p",gj,ee(n.event.title)+" — "+ee(a(n.event.date)),1)):ie("",!0)]),d("div",vj,[Be(hj,{mode:n.mode,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,"selected-players":n.selectedPlayers,"availability-by-player":n.availabilityByPlayer},null,8,["mode","event","season-id","season-slug","players","selected-players","availability-by-player"])]),d("div",yj,[d("div",_j,[d("button",{onClick:l,disabled:i.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[i.value?(C(),D("span",xj,h[2]||(h[2]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),lt(" Envoi en cours... ")]))):(C(),D("span",wj,h[1]||(h[1]=[d("span",{class:"hidden sm:inline"},"🔔 Confirmer et notifier",-1),d("span",{class:"sm:hidden"},"🔔 Confirmer",-1)])))],8,bj)]),d("button",{onClick:o,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ie("",!0)}},_1=$f(Ij,[["__scopeId","data-v-4b6a7b48"]]),Ej={class:"relative p-6 pb-4 border-b border-white/10"},Tj={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},Aj={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ft(()=>{},["stop"]))},[d("div",Ej,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manière simple et apaisée")])],-1))]),s[5]||(s[5]=ir('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),d("div",Tj,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ie("",!0)}},Sj={class:"text-center mb-6"},Pj={class:"text-lg text-gray-300"},Rj={class:"mb-6"},Cj={class:"space-y-4"},kj={class:"flex items-center gap-2 text-gray-300 text-sm"},Dj=["disabled"],Nj={key:0,class:"animate-spin"},Oj={key:1},Vj={class:"mb-6 text-center"},Mj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Lj={class:"text-red-300 text-sm"},$j={class:"text-center mb-6"},Fj={class:"text-lg text-gray-300"},Uj={class:"mb-6"},jj=["disabled"],Bj={key:0,class:"animate-spin"},qj={key:1},zj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Hj={class:"text-red-300 text-sm"},Kj={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Gj={class:"text-green-300 text-sm"},Wj={class:"flex justify-center"},ry={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=S(""),c=S(""),h=S(null),f=S(!0);async function m(){if(s.value){i.value=!0,o.value="";try{const x=await Om(t.seasonId);if(s.value===x){if(f.value)try{lo.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),w();return}if(await i1(t.player.id,s.value,t.seasonId)){if(f.value)try{lo.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),w()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(x){F.error("Erreur lors de la vérification",x),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const x=await a1(t.player.id,t.seasonId);c.value=x.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(x){F.error("Erreur lors de l'envoi de l'email",x),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function w(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return kt(()=>t.show,x=>{x&&tn(()=>{h.value&&h.value.focus()})}),(x,I)=>{var O,L;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:w},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:I[3]||(I[3]=ft(()=>{},["stop"]))},[d("div",Sj,[I[7]||(I[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔐")],-1)),I[8]||(I[8]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),d("p",Pj,ee((O=n.player)==null?void 0:O.name),1),I[9]||(I[9]=d("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),d("div",Rj,[d("div",Cj,[d("div",null,[I[10]||(I[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),st(d("input",{"onUpdate:modelValue":I[0]||(I[0]=U=>s.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:rr(m,["enter"]),ref_key:"passwordInput",ref:h},null,544),[[Lt,s.value]])]),d("div",kj,[st(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":I[1]||(I[1]=U=>f.value=U),class:"w-4 h-4"},null,512),[[Hi,f.value]]),I[11]||(I[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),d("button",{onClick:m,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(C(),D("span",Nj,"⏳")):(C(),D("span",Oj,"🔓")),d("span",null,ee(i.value?"Vérification...":"Vérifier"),1)],8,Dj)]),d("div",Vj,[d("button",{onClick:I[2]||(I[2]=U=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(C(),D("div",Mj,[d("div",Lj,ee(o.value),1)])):ie("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ie("",!0),a.value?(C(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:I[6]||(I[6]=U=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:I[5]||(I[5]=ft(()=>{},["stop"]))},[d("div",$j,[I[12]||(I[12]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"📧")],-1)),I[13]||(I[13]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),d("p",Fj,ee((L=n.player)==null?void 0:L.name),1)]),d("div",Uj,[I[14]||(I[14]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:v,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(C(),D("span",Bj,"⏳")):(C(),D("span",qj,"📧")),d("span",null,ee(i.value?"Envoi...":"Envoyer l'email"),1)],8,jj)]),l.value?(C(),D("div",zj,[d("div",Hj,ee(l.value),1)])):ie("",!0),c.value?(C(),D("div",Kj,[d("div",Gj,ee(c.value),1)])):ie("",!0),d("div",Wj,[d("button",{onClick:I[4]||(I[4]=U=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0)],64)}}},Qj={class:"text-center mb-6"},Jj={class:"text-sm text-gray-300"},Yj={key:0,class:"space-y-4"},Xj={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},Zj={key:1,class:"space-y-4"},eB=["disabled"],tB={key:0,class:"animate-spin"},nB={key:1},rB={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},sB={class:"mt-6 flex justify-center gap-3"},iB=["disabled"],oB={key:0,class:"animate-spin"},aB={key:1},b1={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(1),i=S(""),o=S(""),a=S(""),l=S(!1),c=S(""),h=S(!1),f=_a(),m=qe(()=>i.value&&i.value.includes("@")),v=qe(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function w(){var L,U,q;if(!(!m.value||!((L=t.player)!=null&&L.id))){l.value=!0,c.value="";try{const te=await e1({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),X=(U=f.params)==null?void 0:U.slug,A=`${te.url}${X?`&slug=${encodeURIComponent(X)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await VF({toEmail:i.value,playerName:((q=t.player)==null?void 0:q.name)||"joueur",verifyUrl:A}),h.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function x(){try{await n1({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,h.value=!1,i.value="",o.value="",a.value=""}async function I(){var L;try{const U=await Ql((L=t.player)==null?void 0:L.id,t.seasonId);U!=null&&U.email&&(U!=null&&U.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}Tn(()=>{I()}),kt(()=>t.show,L=>{L&&I()});async function O(){if(v.value){l.value=!0,c.value="";try{await ZA(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(L){c.value=(L==null?void 0:L.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(L,U)=>{var q;return n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:U[6]||(U[6]=te=>L.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:U[5]||(U[5]=ft(()=>{},["stop"]))},[d("button",{onClick:U[0]||(U[0]=te=>L.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",Qj,[U[7]||(U[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),U[8]||(U[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",Jj,"Pour sécuriser les saisies de "+ee((q=n.player)==null?void 0:q.name),1),Be(Xv)]),s.value===1?(C(),D("div",Yj,[d("div",null,[U[9]||(U[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),st(d("input",{"onUpdate:modelValue":U[1]||(U[1]=te=>i.value=te),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Lt,i.value]])]),h.value?(C(),D("div",Xj,[U[10]||(U[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+ee(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ie("",!0)])):s.value===2?(C(),D("div",Zj,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[U[11]||(U[11]=d("span",null,"✅",-1)),U[12]||(U[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:x,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[U[13]||(U[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),st(d("input",{"onUpdate:modelValue":U[2]||(U[2]=te=>o.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Lt,o.value]])]),d("div",null,[U[14]||(U[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),st(d("input",{"onUpdate:modelValue":U[3]||(U[3]=te=>a.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Lt,a.value]])]),d("button",{onClick:O,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(C(),D("span",tB,"⏳")):(C(),D("span",nB,"🔒")),d("span",null,ee(l.value?"Association...":"Associer ce joueur"),1)],8,eB)])):ie("",!0),c.value?(C(),D("div",rB,ee(c.value),1)):ie("",!0),d("div",sB,[s.value===1?(C(),D("button",{key:0,onClick:w,disabled:!m.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(C(),D("span",oB,"⏳")):(C(),D("span",aB,"✉️")),d("span",null,ee(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,iB)):ie("",!0),d("button",{onClick:U[4]||(U[4]=te=>L.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ie("",!0)}}},lB={class:"text-center mb-6"},uB={class:"text-2xl font-bold text-white mb-2"},cB={class:"text-lg text-gray-300"},dB={class:"mb-6"},hB={class:"flex items-center space-x-3"},fB={class:"text-2xl"},pB={class:"font-semibold text-white"},mB={class:"text-sm text-gray-300"},gB={key:0,class:"mb-6"},vB={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},yB={class:"text-red-300 text-sm"},_B={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},bB={class:"text-green-300 text-sm"},wB={class:"flex justify-center gap-3"},xB=["disabled"],IB={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=S(!1),o=S(!1),a=S(""),l=S(""),c=S(!1);_a();const h=S(!1);qe(()=>!1),qe(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function m(){var O;if((O=t.player)!=null&&O.id){s.value=await Ji(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:L}=await xt(()=>Promise.resolve().then(()=>ld),void 0);i.value=L(t.player.id)}catch{i.value=!1}}}function v(){var O;a.value="";try{if((O=t.player)!=null&&O.id&&Qo(t.player.id)){w();return}}catch{}h.value=!0}async function w(){o.value=!0,a.value="",l.value="";try{const O=await r1(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,O.email&&(email.value=O.email),r("update")}catch(O){logger.error("Erreur lors de la désactivation de la protection",O),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function x(){h.value=!1,w()}function I(){r("close")}return kt(()=>t.player,()=>{t.show&&t.player&&m()},{immediate:!0}),kt(()=>t.show,O=>{O&&t.player&&(a.value="",l.value="",h.value=!1,m(),t.onboarding&&tn(()=>{}))}),(O,L)=>{var U;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:I},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:L[1]||(L[1]=ft(()=>{},["stop"]))},[d("button",{onClick:I,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",lB,[L[4]||(L[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",uB,ee(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),d("p",cB,ee((U=n.player)==null?void 0:U.name),1)]),d("div",dB,[d("div",{class:cn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",hB,[d("span",fB,ee(s.value?"🔒":"🔓"),1),d("div",null,[d("div",pB,ee(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),d("div",mB,ee(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ie("",!0):(C(),D("div",gB,L[5]||(L[5]=[d("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(C(),D("div",vB,[d("div",yB,ee(a.value),1)])):ie("",!0),l.value?(C(),D("div",_B,[d("div",bB,ee(l.value),1)])):ie("",!0),d("div",wB,[s.value?(C(),D("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,xB)):(C(),D("button",{key:0,onClick:L[0]||(L[0]=q=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),d("button",{onClick:I,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),Be(b1,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:L[2]||(L[2]=q=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),Be(ry,{show:h.value,player:n.player,seasonId:n.seasonId,onClose:L[3]||(L[3]=q=>h.value=!1),onVerified:x},null,8,["show","player","seasonId"])],64)}}};const EB={class:"relative p-4 md:p-6 border-b border-white/10"},TB={class:"flex items-start gap-4 md:gap-6"},AB={class:"flex-1 min-w-0"},SB={class:"flex items-center gap-3 mb-2"},PB={class:"text-xl md:text-2xl font-bold text-white leading-tight"},RB={class:"flex items-center gap-2"},CB={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},kB={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},DB={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},NB={class:"grid grid-cols-3 gap-3 md:gap-4"},OB={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},VB={class:"text-xl md:text-2xl font-bold text-white"},MB={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},LB={class:"text-xl md:text-2xl font-bold text-white"},$B={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},FB={class:"text-xl md:text-2xl font-bold text-white"},UB={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},jB={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},BB={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},qB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},zB={class:"mb-6"},HB={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S(""),a=S(null),l=S(!1),c=S(!1),h=S(null);S(!1);const f=S(!1),m=S(!1),v=S(null),w=S(null),x=S({position:"fixed",top:"0px",left:"0px"}),I=S(null),O=S({position:"fixed",top:"0px",left:"0px"}),L=S(!1),U=S(!1);function q(){s("close"),f.value=!1,m.value=!1,x.value={position:"fixed",top:"0px",left:"0px"},O.value={position:"fixed",top:"0px",left:"0px"}}function te(){var Ae;o.value=((Ae=r.player)==null?void 0:Ae.name)||"",i.value=!0,tn(()=>{a.value&&a.value.focus()})}function X(){i.value=!1,o.value=""}async function A(){var fe,Je;if(!o.value.trim())return;if(await Ji((fe=r.player)==null?void 0:fe.id,r.seasonId)){Qo((Je=r.player)==null?void 0:Je.id)?_():(h.value="update",c.value=!0);return}_()}function _(){var Ae;s("update",{playerId:(Ae=r.player)==null?void 0:Ae.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function T(){var fe,Je;if(await Ji((fe=r.player)==null?void 0:fe.id,r.seasonId)){Qo((Je=r.player)==null?void 0:Je.id)?k():(h.value="delete",c.value=!0);return}k()}function k(){var Ae;s("delete",(Ae=r.player)==null?void 0:Ae.id)}function $(){s("refresh")}function V(Ae){h.value==="update"?_():h.value==="delete"&&k(),h.value=null}function R(){try{const Ae=v.value;if(!Ae)return;const fe=Ae.getBoundingClientRect(),Je=8;if(window.innerWidth>768){const ae=Math.max(Je,Math.round(fe.top-Je)),ne=Math.max(Je,Math.round(fe.left));x.value={position:"fixed",top:`${ae}px`,left:`${ne}px`,zIndex:400}}else{const ae=Math.min(window.innerHeight-Je,Math.round(fe.bottom+Je)),ne=Math.max(Je,Math.round(fe.left));x.value={position:"fixed",top:`${ae}px`,left:`${ne}px`,zIndex:400}}}catch{}}function Ke(){try{const ae=Math.max(8,window.innerHeight-8-48-120),ne=Math.max(8,Math.round(window.innerWidth-200-8));O.value={position:"fixed",top:`${ae}px`,left:`${ne}px`,zIndex:400}}catch{}}function ut(){f.value=!f.value,f.value&&tn(()=>R())}function ct(){m.value=!m.value,m.value&&tn(()=>Ke())}kt(()=>r.show,Ae=>{var fe;Ae||(i.value=!1,o.value="",h.value=null,l.value=!1,f.value=!1,m.value=!1),Ae&&((fe=r.player)!=null&&fe.id)&&(Ji(r.player.id,r.seasonId).then(Je=>{L.value=!!Je}),xt(()=>Promise.resolve().then(()=>ld),void 0).then(Je=>{try{U.value=!!Je.isPlayerPasswordCached(r.player.id)}catch{U.value=!1}}))}),Tn(()=>{document.addEventListener("click",Ae=>{if(f.value){const fe=v.value,Je=w.value,ae=fe&&fe.contains(Ae.target),ne=Je&&Je.contains(Ae.target);!ae&&!ne&&(f.value=!1)}if(m.value){const fe=I.value;fe&&fe.contains(Ae.target)||(m.value=!1)}}),document.addEventListener("keydown",Ae=>{Ae.key==="Escape"&&(f.value&&(f.value=!1),m.value&&(m.value=!1))}),window.addEventListener("resize",()=>{f.value&&R(),m.value&&Ke()}),window.addEventListener("scroll",()=>{f.value&&R(),m.value&&Ke()},{passive:!0})}),e({openProtection(){l.value=!0}});const Ge=S({position:null});return kt(()=>r.show,Ae=>{Ae&&r.onboardingStep===4?tn(()=>{const fe=document.querySelectorAll("button");let Je=null;if(fe.forEach(ae=>{!Je&&ae.textContent&&ae.textContent.includes("Protection")&&(Je=ae)}),Je){const ae=Je.getBoundingClientRect();Ge.value.position={x:Math.round(ae.right+8),y:Math.round(ae.top+window.scrollY-4)}}}):Ae||(Ge.value.position=null)}),(Ae,fe)=>{var Je;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:q},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:fe[6]||(fe[6]=ft(()=>{},["stop"]))},[d("div",EB,[d("button",{onClick:q,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",TB,[fe[15]||(fe[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",AB,[d("div",SB,[d("h2",PB,ee((Je=n.player)==null?void 0:Je.name),1),d("div",RB,[n.isProtected?(C(),D("div",CB,fe[13]||(fe[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ie("",!0),n.isPreferred?(C(),D("div",kB,fe[14]||(fe[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ie("",!0)])])])])]),d("div",DB,[d("div",null,[d("div",NB,[d("div",OB,[d("div",VB,ee(r.stats.availability),1),fe[16]||(fe[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",MB,[d("div",LB,ee(r.stats.selection),1),fe[17]||(fe[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",$B,[d("div",FB,ee(r.stats.ratio),1),fe[18]||(fe[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",UB,[d("button",{onClick:fe[0]||(fe[0]=ae=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,ee(L.value?"🔓":"🔒"),1),d("span",null,ee(L.value?"Déverrouiller":"Verrouiller"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[d("button",{onClick:fe[1]||(fe[1]=ae=>ut()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},fe[19]||(fe[19]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:q,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(C(),Js(oc,{to:"body"},[f.value?(C(),D("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:w,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Ur(x.value)},[d("button",{onClick:fe[2]||(fe[2]=ae=>{te(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},fe[20]||(fe[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:fe[3]||(fe[3]=ae=>{T(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},fe[21]||(fe[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)]))])]),d("div",jB,[d("button",{onClick:fe[4]||(fe[4]=ae=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ee(L.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),d("button",{onClick:fe[5]||(fe[5]=ae=>ct()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:q,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ie("",!0),(C(),Js(oc,{to:"body"},[m.value?(C(),D("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:I,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Ur(O.value)},[d("button",{onClick:fe[7]||(fe[7]=ae=>{te(),m.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},fe[22]||(fe[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:fe[8]||(fe[8]=ae=>{T(),m.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},fe[23]||(fe[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)])),i.value?(C(),D("div",BB,[d("div",qB,[fe[25]||(fe[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),d("div",zB,[fe[24]||(fe[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),st(d("input",{"onUpdate:modelValue":fe[9]||(fe[9]=ae=>o.value=ae),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[rr(X,["esc"]),rr(A,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Lt,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:X,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:A,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ie("",!0),Be(IB,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:fe[10]||(fe[10]=ae=>l.value=!1),onUpdate:$,onOnboardingFinished:fe[11]||(fe[11]=ae=>Ae.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),Be(ry,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:fe[12]||(fe[12]=ae=>c.value=!1),onVerified:V},null,8,["show","player","seasonId"])],64)}}},KB=$f(HB,[["__scopeId","data-v-8237d7ee"]]),GB={class:"relative p-6 pb-4 border-b border-white/10"},WB={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},QB={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=ft(()=>{},["stop"]))},[d("div",GB,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=ir('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",WB,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ie("",!0)}},JB={class:"relative p-4 md:p-6 border-b border-white/10"},YB={class:"flex items-start gap-4 md:gap-6"},XB={class:"flex-1 min-w-0"},ZB={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},eq={class:"flex items-center gap-3"},tq={class:"text-base md:text-lg text-purple-300"},nq={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},rq={class:"text-blue-200"},sq={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},iq={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},oq={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},aq={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},lq={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},uq={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},cq={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},dq={class:"text-xl md:text-2xl font-bold text-yellow-300"},hq={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},fq={class:"text-xl md:text-2xl font-bold text-white"},pq={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},mq={class:"text-xl md:text-2xl font-bold text-white"},gq={class:"mb-3"},vq={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},yq={key:0,class:"flex items-center justify-between gap-2"},_q=["title"],bq={key:0,class:"text-purple-400 mr-2"},wq={key:1,class:"text-green-400 mr-2"},xq={key:2,class:"text-red-400 mr-2"},Iq={key:3,class:"text-gray-400 mr-2"},Eq=["onClick"],Tq={key:1,class:"flex items-center justify-center"},Aq=["onChange"],Sq=["value"],Pq=["onClick"],Rq={key:0,class:"mb-3"},Cq={key:1,class:"mb-3"},kq={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},Dq={class:"flex-1"},Nq={class:"text-blue-300 text-sm font-medium"},Oq={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Vq=["disabled","title"],Mq=["disabled"],Lq={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications","updateSelection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=S(!1),o=S("Copier le message"),a=S(!1),l=S(!1),c=S(""),h=S(!1),f=S(!1),m=qe(()=>{var ae;return((ae=r.event)==null?void 0:ae.playerCount)||6}),v=S([]),w=S(null),x=qe(()=>(r.players||[]).map(ae=>ae.name).filter(ae=>{var ne;return((ne=r.playerAvailability)==null?void 0:ne[ae])===!0}).sort((ae,ne)=>ae.localeCompare(ne,"fr",{sensitivity:"base"})));function I(ae){const ne=new Set(v.value.filter(Boolean)),Ne=v.value[ae];return Ne&&ne.delete(Ne),x.value.filter(dt=>!ne.has(dt))}function O(ae){w.value=ae}function L(){w.value=null}async function U(ae,ne){var dt;const Ne=((dt=ae==null?void 0:ae.target)==null?void 0:dt.value)||"";Ne&&(v.value[ne]=Ne,await $()),w.value=null}async function q(ae){v.value[ae]=null,await $()}qe(()=>(I(-1).length<m.value,""));const te=qe(()=>r.currentSelection&&r.currentSelection.length>0);function X(){var dt;const ae=r.currentSelection||[],ne=((dt=r.event)==null?void 0:dt.playerCount)||6,Ne=r.availableCount||0;if(ae.length>0){const Pt=ae.some(Y=>!ut(Y)),en=Ne<ne;if(Pt||en)return{type:"incomplete",hasUnavailablePlayers:Pt,hasInsufficientPlayers:en,unavailablePlayers:ae.filter(Y=>!ut(Y)),availableCount:Ne,requiredCount:ne}}return Ne<ne?{type:"insufficient",availableCount:Ne,requiredCount:ne}:ae.length===0?{type:"ready",availableCount:Ne,requiredCount:ne}:{type:"complete",availableCount:Ne,requiredCount:ne}}const A=qe(()=>{var dt;if(!te.value)return!1;const ae=r.currentSelection.some(Pt=>!ut(Pt)),ne=((dt=r.event)==null?void 0:dt.playerCount)||6,Ne=r.availableCount<ne;return ae||Ne});qe(()=>{var Ne;if(!A.value)return"";const ae=r.currentSelection.filter(dt=>!ut(dt)),ne=((Ne=r.event)==null?void 0:Ne.playerCount)||6;return ae.length>0?ae.length===1?`${ae[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${ae.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<ne?`Seulement ${r.availableCount} joueurs disponibles pour ${ne} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),qe(()=>{if(!r.event||!te.value)return"";const ae=_(r.event.date),ne=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${ae} : ${ne}`}),kt(()=>r.show,ae=>{if(ae){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",h.value=!1,a.value=!1;const ne=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ne=m.value;v.value=Array.from({length:Ne},(dt,Pt)=>ne[Pt]||null),w.value=null}}),kt([m,()=>r.currentSelection,()=>{var ae;return(ae=r.event)==null?void 0:ae.id}],()=>{if(!r.show)return;const ae=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],ne=m.value,Ne=Array.from({length:ne},(dt,Pt)=>ae[Pt]||v.value[Pt]||null);v.value=Ne.slice(0,ne)});function _(ae){var Ne;return ae?(typeof ae=="string"?new Date(ae):((Ne=ae.toDate)==null?void 0:Ne.call(ae))||ae).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function T(){s("selection")}function k(){s("perfect")}async function $(){var ae;if(!(!((ae=r.event)!=null&&ae.id)||!r.seasonId))try{const ne=v.value.filter(Boolean);await jm(r.event.id,ne,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(ne){console.error("Erreur lors de la sauvegarde automatique:",ne)}}function V(){s("close")}function R(){a.value=!0}function Ke(){f.value=!0}function ut(ae){return r.playerAvailability[ae]===!0}function ct(ae){return r.playerAvailability[ae]===!1}function Ge(ae){return r.currentSelection.includes(ae)&&ut(ae)}function Ae(ae=!1,ne=!1){if(h.value=ae,ae){const Ne=_(r.event.date),dt=r.currentSelection.join(", ");ne?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ne} : ${dt}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ne} : ${dt}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function fe(){l.value=!1}e({showSuccess:Ae});function Je(ae){s("send-notifications",ae)}return(ae,ne)=>{var Ne,dt,Pt,en;return C(),D(mt,null,[n.show?(C(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:V},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:ne[1]||(ne[1]=ft(()=>{},["stop"]))},[d("div",JB,[d("button",{onClick:V,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",YB,[ne[9]||(ne[9]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",XB,[d("h2",ZB,"Sélection pour "+ee((Ne=n.event)==null?void 0:Ne.title),1),d("div",eq,[d("p",tq,ee(_((dt=n.event)==null?void 0:dt.date)),1),d("div",nq,[ne[4]||(ne[4]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",rq,ee(((Pt=n.event)==null?void 0:Pt.playerCount)||6)+" joueurs",1)]),X().type==="ready"?(C(),D("div",sq,ne[5]||(ne[5]=[d("span",{class:"text-blue-300 text-xs"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):X().type==="complete"?(C(),D("div",iq,ne[6]||(ne[6]=[d("span",{class:"text-green-300 text-xs"},"✅",-1),d("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):X().type==="incomplete"?(C(),D("div",oq,ne[7]||(ne[7]=[d("span",{class:"text-orange-300 text-xs"},"⚠️",-1),d("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):X().type==="insufficient"?(C(),D("div",aq,ne[8]||(ne[8]=[d("span",{class:"text-red-300 text-xs"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ie("",!0)])])])]),d("div",lq,[d("div",uq,[d("div",cq,[d("div",dq,ee(Math.max((((en=n.event)==null?void 0:en.playerCount)||6)-n.selectedCount,0)),1),ne[10]||(ne[10]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",hq,[d("div",fq,ee(n.availableCount),1),ne[11]||(ne[11]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",pq,[d("div",mq,ee(n.selectedCount),1),ne[12]||(ne[12]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",gq,[d("div",{class:"flex items-center gap-2 mb-2"},[ne[14]||(ne[14]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),d("button",{onClick:Ke,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},ne[13]||(ne[13]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",vq,[(C(!0),D(mt,null,jr(v.value,(Y,xe)=>(C(),D("div",{key:"sel-slot-"+xe,class:cn(["relative p-3 rounded-lg border text-center transition-colors",Y?["bg-gradient-to-r",ct(Y)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":ut(Y)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[Y?(C(),D("div",yq,[d("div",{class:"flex-1 text-white font-medium truncate",title:Y},[Ge(Y)?(C(),D("span",bq,"🎭")):ut(Y)?(C(),D("span",wq,"✅")):ct(Y)?(C(),D("span",xq,"❌")):(C(),D("span",Iq,"–")),lt(" "+ee(Y),1)],8,_q),d("button",{onClick:ve=>q(xe),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,Eq)])):(C(),D("div",Tq,[w.value===xe?(C(),D("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:ve=>U(ve,xe),onBlur:ne[0]||(ne[0]=ve=>L())},[ne[15]||(ne[15]=d("option",{value:""},"— Choisir —",-1)),(C(!0),D(mt,null,jr(I(xe),ve=>(C(),D("option",{key:ve,value:ve},ee(ve),9,Sq))),128))],40,Aq)):(C(),D("button",{key:1,onClick:ve=>O(xe),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},ne[16]||(ne[16]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,Pq))]))],2))),128))])]),te.value?(C(),D("div",Rq,ne[17]||(ne[17]=[d("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[d("div",{class:"text-yellow-400"},"⚠️"),d("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ie("",!0),l.value?(C(),D("div",Cq,[d("div",kq,[ne[19]||(ne[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",Dq,[d("p",Nq,ee(c.value),1)]),d("button",{onClick:fe,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},ne[18]||(ne[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ie("",!0)]),d("div",Oq,[d("button",{onClick:T,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":te.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},ne[20]||(ne[20]=[lt(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,Vq),d("button",{onClick:R,disabled:!te.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},ne[21]||(ne[21]=[lt(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]),8,Mq),d("button",{onClick:k,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},ne[22]||(ne[22]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ie("",!0),Be(_1,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:ne[2]||(ne[2]=Y=>a.value=!1),onSendNotifications:Je},null,8,["show","event","season-id","season-slug","players","selected-players"]),Be(QB,{show:f.value,onClose:ne[3]||(ne[3]=Y=>f.value=!1)},null,8,["show"])],64)}}},$q={class:"flex items-center justify-center"},Fq=["title"],Uq={key:0,class:"text-center"},jq={key:1,class:"text-center"},Bq={key:2,class:"text-center"},qq={key:3,class:"text-center text-gray-400"},zb={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=S(!1),i=qe(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=qe(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(C(),D("div",{class:cn(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:c[0]||(c[0]=h=>s.value=!0),onMouseleave:c[1]||(c[1]=h=>s.value=!1)},[d("div",$q,[i.value&&s.value?(C(),D("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ee(n.chancePercent)+"% ",9,Fq)):(C(),D(mt,{key:1},[n.isSelected&&n.isAvailable===!0?(C(),D("span",Uq," Joue ")):n.isAvailable===!0?(C(),D("span",jq," Disponible ")):n.isAvailable===!1?(C(),D("span",Bq," Pas disponible ")):(C(),D("span",qq," – "))],64))])],34))}},zq={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},Hq={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},Kq={class:"text-2xl md:text-3xl font-bold text-white mb-3"},Gq={class:"text-gray-300 mb-6"},Wq={class:"flex flex-col items-stretch justify-center gap-3"},Qq=["value"],Jq={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=qe(()=>`${s}/season/${t.seasonSlug}`),o=S(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=qe(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=qe(()=>a.value>0),c=S(l.value);kt(a,I=>{c.value=I>0});const h=qe(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=qe(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function m(){c.value=!1,r("create-event")}function v(){c.value=!1,r("add-player")}function w(){var I;try{(I=navigator.clipboard)==null||I.writeText(i.value)}catch{}r("copy-link")}async function x(){try{if(t.seasonId){const{db:I}=await xt(()=>Promise.resolve().then(()=>us),void 0),{doc:O,updateDoc:L}=await xt(()=>import("./index.esm-8019458b.js"),[]);await L(O(I,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(I,O)=>l.value&&c.value?(C(),D("div",zq,[d("div",Hq,[O[1]||(O[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",Kq,ee(h.value),1),d("p",Gq,ee(f.value),1),d("div",Wq,[a.value===1?(C(),D("button",{key:0,onClick:m,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(C(),D("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(C(),D(mt,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:O[0]||(O[0]=L=>L.target.select())},null,40,Qq),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:w,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:x,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ie("",!0)])])])):ie("",!0)}},Yq={class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},Xq={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},Zq={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},e9={class:"hidden md:flex items-center gap-2"},t9={class:"md:hidden"},n9={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account"],setup(n,{emit:e}){const t=n,r=e,s=S(null),i=qe(()=>{var x;return!!s.value&&!((x=s.value)!=null&&x.isAnonymous)}),o=qe(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(x){s.value=x}Tn(()=>{s.value=je.currentUser;const x=je.onAuthStateChanged(a);window._seasonHeaderUnsubscribe=x}),Qs(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function l(){r("go-back")}function c(){r("open-account-menu")}function h(){r("open-login")}function f(){r("open-help")}function m(){r("open-notifications")}function v(){r("open-players")}function w(){r("logout")}return(x,I)=>(C(),D("div",Yq,[d("button",{onClick:l,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},I[0]||(I[0]=[d("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",Xq,ee(n.seasonName?n.seasonName:"Chargement..."),1),d("div",Zq,[d("div",e9,[Be(Um,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:m,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?ie("",!0):(C(),D("button",{key:0,onClick:f,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},I[1]||(I[1]=[d("span",{class:"text-2xl"},"❓",-1)])))]),d("div",t9,[Be(Um,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:c,onOpenHelp:f,onOpenNotifications:m,onOpenPlayers:v,onLogout:w,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}},r9={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/50"},s9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-2xl shadow-2xl w-full max-w-md p-6 relative"},i9={class:"text-center mb-6"},o9={class:"text-gray-300 text-sm"},a9={class:"font-medium text-white"},l9={key:0,class:"space-y-4"},u9=["disabled"],c9={key:0,class:"mt-2 text-xs"},d9={key:0,class:"text-green-400"},h9={key:1,class:"text-red-400"},f9={class:"flex gap-3"},p9=["disabled"],m9={key:0,class:"animate-spin"},g9={key:1},v9={key:1,class:"text-center"},y9={class:"text-green-400 text-sm mb-4"},_9={class:"font-medium text-white"},b9={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg"},w9={class:"text-red-300 text-sm"},x9={__name:"NotificationPromptModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},eventTitle:{type:String,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,required:!0}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=S(""),i=S(!1),o=S(""),a=S(!1),l=qe(()=>{const h=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,f=s.value,m=h.test(f),v=i.value;return f&&m&&!v});async function c(){var h;if(l.value){i.value=!0,o.value="";try{console.log("🚀 Début de l'activation des notifications...");const{auth:f}=await xt(()=>Promise.resolve().then(()=>us),void 0),m=((h=f.currentUser)==null?void 0:h.email)===s.value;if(m){console.log("✅ Utilisateur déjà connecté, activation directe...");const{activateNotificationsForConnectedUser:v}=await xt(()=>Promise.resolve().then(()=>y1),void 0),w=await v({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Notifications activées directement:",w),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!0})}else{console.log("📧 Utilisateur non connecté, envoi de l'email d'activation...");const v=await p1({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Résultat de la création:",v),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!1})}F.info("Activation des notifications terminée",{email:s.value,playerName:t.playerName,eventId:t.eventId,directActivation:m})}catch(f){console.error("❌ Erreur lors de l'activation:",f),F.error("Erreur lors de l'activation des notifications",f),o.value="Impossible d'activer les notifications. Veuillez réessayer."}finally{i.value=!1}}}return(h,f)=>n.show?(C(),D("div",r9,[d("div",s9,[d("button",{onClick:f[0]||(f[0]=m=>h.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10",title:"Fermer"},f[3]||(f[3]=[d("span",{class:"text-xl"},"✖️",-1)])),d("div",i9,[f[5]||(f[5]=d("div",{class:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-600"},[d("span",{class:"text-2xl"},"🔔")],-1)),f[6]||(f[6]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Ne rates rien !",-1)),d("p",o9,[d("span",a9,ee(n.playerName),1),f[4]||(f[4]=lt(", active tes notifications pour recevoir des alertes en temps réel sur tes événements. "))])]),a.value?(C(),D("div",v9,[d("p",y9,[f[8]||(f[8]=lt(" Email envoyé à ")),d("span",_9,ee(s.value),1)]),f[9]||(f[9]=d("p",{class:"text-gray-300 text-xs"}," Clique sur le lien qu'il contient pour activer tes notifications ",-1))])):(C(),D("div",l9,[d("div",null,[f[7]||(f[7]=d("label",{for:"email",class:"block text-sm font-medium text-gray-300 mb-2"}," Ton adresse email ",-1)),st(d("input",{id:"email","onUpdate:modelValue":f[1]||(f[1]=m=>s.value=m),type:"email",placeholder:"votre@email.com",class:cn(["w-full px-4 py-3 bg-gray-800 border rounded-lg text-white placeholder-gray-400 focus:outline-none transition-colors",[s.value&&!l.value?"border-red-500 focus:border-red-500":s.value&&l.value?"border-green-500 focus:border-green-500":"border-white/20 focus:border-purple-500"]]),disabled:i.value},null,10,u9),[[Lt,s.value]]),s.value&&!i.value?(C(),D("div",c9,[l.value?(C(),D("span",d9,"✅ Email valide")):(C(),D("span",h9,"❌ Format d'email invalide"))])):ie("",!0)]),d("div",f9,[d("button",{onClick:c,disabled:!l.value||i.value,class:cn(["flex-1 px-6 py-3 rounded-lg transition-all duration-300 font-medium",[l.value&&!i.value?"bg-gradient-to-r from-purple-500 to-pink-600 text-white hover:from-purple-600 hover:to-pink-700":"bg-gray-600 text-gray-300 cursor-not-allowed"]])},[i.value?(C(),D("span",m9,"⏳")):(C(),D("span",g9,"Activer les notifications"))],10,p9),d("button",{onClick:f[2]||(f[2]=m=>h.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"}," Fermer ")])])),o.value?(C(),D("div",b9,[d("div",w9,ee(o.value),1)])):ie("",!0)])])):ie("",!0)}},I9={key:0,class:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60"},E9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center relative"},T9={class:"text-gray-300 mb-6"},A9={class:"font-semibold text-white"},S9={class:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 mb-6"},P9={class:"flex items-start gap-3"},R9={class:"text-left flex-1"},C9={key:0,class:"mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},k9={class:"flex items-start gap-3"},D9={class:"text-left"},N9={class:"text-green-200 text-sm"},O9={class:"font-mono"},V9={class:"flex gap-3"},M9=["disabled"],L9={key:0,class:"animate-spin"},$9={key:1},F9={__name:"NotificationSuccessModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},email:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,default:null}},emits:["close","createPassword"],setup(n,{emit:e}){const t=n;ya();const r=S(!1),s=S(!1);async function i(){s.value=!0;try{const{createUserWithEmailAndPassword:o,sendPasswordResetEmail:a}=await xt(()=>import("./index.esm-183b5cd6.js"),[]),{auth:l}=await xt(()=>Promise.resolve().then(()=>us),void 0);console.log("🚀 Tentative de création de compte pour:",t.email);const c="TempPass123!",h=await o(l,t.email,c);console.log("✅ Compte créé avec succès, UID:",h.user.uid),console.log("📧 Envoi de l'email de réinitialisation..."),await a(l,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),await l.signOut(),r.value=!0}catch(o){if(console.error("❌ Erreur lors de la création du compte:",o),o.code==="auth/email-already-in-use")try{console.log("📧 Utilisateur existant, envoi direct de l'email de réinitialisation...");const{sendPasswordResetEmail:a}=await xt(()=>import("./index.esm-183b5cd6.js"),[]);await a(auth,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),r.value=!0}catch(a){console.error("❌ Erreur lors de l'envoi de l'email de réinitialisation:",a)}else o.code==="auth/weak-password"?console.error("❌ Mot de passe temporaire trop faible"):o.code==="auth/invalid-email"?console.error("❌ Email invalide"):console.error("❌ Erreur inconnue:",o.message)}finally{s.value=!1}}return(o,a)=>n.show?(C(),D("div",I9,[d("div",E9,[d("button",{onClick:a[0]||(a[0]=l=>o.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200 text-xl font-bold",title:"Fermer"}," ✖️ "),a[9]||(a[9]=d("div",{class:"w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center bg-green-500"},[d("span",{class:"text-3xl"},"✅")],-1)),a[10]||(a[10]=d("h1",{class:"text-2xl font-bold text-white mb-4"},"Notifications activées !",-1)),d("p",T9,[a[2]||(a[2]=lt(" Nous enverrons désormais les alertes spectacle à ")),d("span",A9,ee(n.email),1)]),d("div",S9,[d("div",P9,[a[4]||(a[4]=d("span",{class:"text-blue-400 text-lg"},"💡",-1)),d("div",R9,[a[3]||(a[3]=d("p",{class:"text-blue-300 text-sm font-medium mb-3"}," Psst... tant que tu y es : ajoute un mot de passe pour sécuriser ton compte ! ",-1)),Be(Xv,{inline:!0})])])]),r.value?(C(),D("div",C9,[d("div",k9,[a[8]||(a[8]=d("span",{class:"text-green-400 text-lg"},"✅",-1)),d("div",D9,[a[7]||(a[7]=d("p",{class:"text-green-300 text-sm font-medium mb-1"},"Email envoyé !",-1)),d("p",N9,[a[5]||(a[5]=lt(" Vérifie ta boîte mail à ")),d("span",O9,ee(n.email),1),a[6]||(a[6]=lt(" et clique sur le lien pour créer ton mot de passe. "))])])])])):ie("",!0),d("div",V9,[d("button",{onClick:i,class:cn(["flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 font-medium",{"opacity-50 cursor-not-allowed":r.value||s.value}]),disabled:r.value||s.value},[s.value?(C(),D("span",L9,"⏳")):(C(),D("span",$9,"🔐 Créer mon mot de passe"))],10,M9),d("button",{onClick:a[1]||(a[1]=l=>o.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"},ee(r.value?"Fermer":"Plus tard"),1)])])])):ie("",!0)}};const U9={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},j9={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},B9={class:"flex items-stretch relative"},q9={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},z9={class:"flex-1 overflow-hidden"},H9=["data-event-id"],K9=["title","onClick"],G9={class:"flex flex-col items-center flex-1 justify-center"},W9={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},Q9={key:0,class:"mt-1 text-xs text-gray-400"},J9={class:"relative"},Y9=["onClick","title"],X9={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},Z9={class:"p-2"},ez=["onClick"],tz=["onClick"],nz=["onClick"],rz={class:"flex flex-col items-center mt-2"},sz={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},iz=["title","onClick"],oz=["title","onClick"],az=["title","onClick"],lz=["title","onClick"],uz=["title","aria-label"],cz={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dz={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},hz={key:0,class:"pointer-events-none"},fz={class:"flex items-center justify-between"},pz={key:1,class:"pointer-events-none"},mz={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},gz={class:"flex items-center justify-between"},vz={key:2,class:"pointer-events-none"},yz={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},_z={class:"flex items-center justify-between"},bz={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},wz=["data-player-id"],xz={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},Iz={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},Ez={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},Tz={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},Az=["onClick","title"],Sz={class:"group-hover:text-purple-300 transition-colors duration-200"},Pz=["data-event-id"],Rz={class:"border-t border-white/10"},Cz={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},kz={class:"px-4 md:px-5 flex items-center"},Dz=["data-event-id"],Nz={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},Oz={class:"text-center"},Vz={class:"text-white text-lg"},Mz={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},Lz={class:"text-white/60 text-xs mt-2"},$z={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},Fz={class:"flex items-center space-x-2"},Uz={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},jz={class:"flex items-center space-x-2"},Bz={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},qz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},zz={class:"mb-6"},Hz={class:"mb-6"},Kz={class:"mb-6"},Gz={class:"mb-6 flex items-center gap-3"},Wz={class:"mb-6"},Qz={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},Jz={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Yz={class:"mb-6"},Xz={class:"flex justify-end space-x-3"},Zz={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},e8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},t8={class:"flex justify-end space-x-3"},n8={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},r8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},s8={class:"flex justify-end space-x-3"},i8={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},o8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},a8={class:"text-center mb-6"},l8={class:"text-gray-300"},u8={key:0},c8={key:1},d8={class:"relative p-4 md:p-6 border-b border-white/10"},h8={class:"flex items-start gap-4 md:gap-6"},f8={class:"flex-1 min-w-0"},p8={class:"flex items-center gap-3 mb-2"},m8={class:"text-xl md:text-2xl font-bold text-white leading-tight"},g8={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},v8={class:"text-blue-200"},y8={class:"flex items-center gap-3 mb-3"},_8={class:"text-base md:text-lg text-purple-300"},b8={class:"relative"},w8={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},x8={class:"p-2"},I8={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},E8={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},T8={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},A8={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},S8={class:"text-xl md:text-2xl font-bold text-white"},P8={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},R8={class:"text-xl md:text-2xl font-bold text-white"},C8={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},k8={class:"text-xl md:text-2xl font-bold text-yellow-300"},D8={key:0,class:"mb-4 md:mb-6"},N8={class:"mb-3 flex items-center"},O8=["title"],V8={class:"truncate"},M8={class:"space-y-0.5"},L8={class:"flex items-center min-w-0 gap-1.5"},$8={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},F8={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},U8=["title"],j8={class:"flex-0 p-0"},B8={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},q8=["disabled","title"],z8=["title"],H8={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},K8=["disabled","title"],G8={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},W8={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Q8={class:"mb-6"},J8={class:"mb-6"},Y8={class:"mb-6"},X8={class:"mb-6 flex items-center gap-3"},Z8={class:"mb-6"},eH={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},tH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},nH={class:"mb-6"},rH={class:"space-y-4"},sH=["disabled"],iH={key:0,class:"animate-spin"},oH={key:1},aH={class:"mb-6 text-center"},lH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},uH={class:"text-red-300 text-sm"},cH={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},dH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},hH={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},fH={class:"space-y-4"},pH={class:"mt-2 text-center"},mH={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},gH={class:"text-red-300 text-sm"},vH={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},yH=["disabled"],_H={key:0,class:"animate-spin"},bH={key:1},wH={class:"mb-6"},xH=["disabled"],IH={key:0,class:"animate-spin"},EH={key:1},TH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},AH={class:"text-red-300 text-sm"},SH={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},PH={class:"text-green-300 text-sm"},RH={class:"flex justify-center"},CH={class:"mb-6"},kH=["disabled"],DH={key:0,class:"animate-spin"},NH={key:1},OH={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},VH={class:"text-red-300 text-sm"},MH={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},LH={class:"text-green-300 text-sm"},$H={class:"flex justify-center"},FH={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},UH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},jH={class:"flex gap-3"},Hb={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=ya(),r=_a(),s=e.slug,i=S(""),o=S(""),a=S({}),l=S(!1),c=S(!1),h=S(null),f=S(null),m=S(""),v=S(""),w=S(6),x=S(!1),I=S(""),O=S(null),L=S(null),U=S(null),q=S({position:null,side:null}),te=S({position:null}),X=S({position:null}),A=S(!1),_=S(null),T=S(!1),k=S(null),$=S(null),V=S(!1),R=S(null),Ke=S(""),ut=S(!1),ct=S(null),Ge=S(""),Ae=S(""),fe=S(!1),Je=S(null),ae=S(!1),ne=S(null),Ne=S(""),dt=S(""),Pt=S(!1),en=S(null),Y=S(!1),xe=S(!1),ve=S(""),Pe=S(""),nt=S(!1),vt=S(!1),P=S(""),N=S(""),H=S(!1),K=S(null),Z=S(""),ue=S(!1),ge=S(!1),me=S(!1),ye=S(null),pe=S(null),Ve=S({position:"fixed",top:"0px",left:"0px"}),Te=S(null),Ce=S({position:"fixed",top:"0px",left:"0px"}),Fe=S(null),Ue=S(!1),We=S(!1),rt=S(null),an=S(!1),Ht=S(null);function On(){try{const b=ye.value;if(!b)return;const g=b.getBoundingClientRect(),M=8;if(window.innerWidth>768){const Q=Math.max(M,Math.round(g.top-M)),oe=Math.max(M,Math.round(g.left));Ve.value={position:"fixed",top:`${Q}px`,left:`${oe}px`,zIndex:400}}else{const Q=Math.min(window.innerHeight-M,Math.round(g.bottom+M)),oe=Math.max(M,Math.round(g.left));Ve.value={position:"fixed",top:`${Q}px`,left:`${oe}px`,zIndex:400}}}catch{}}function Qt(){try{const Q=Math.max(8,window.innerHeight-8-48-200),oe=Math.max(8,Math.round(window.innerWidth-200-8));Ce.value={position:"fixed",top:`${Q}px`,left:`${oe}px`,zIndex:400}}catch{}}function Kr(){me.value=!me.value,me.value&&tn(()=>On())}function Os(){ge.value=!ge.value,ge.value&&tn(()=>Qt())}function _n(b){Fe.value===b?Fe.value=null:Fe.value=b}function Pn(){Fe.value=null}function vi(){Ue.value=!Ue.value}function re(){Ue.value=!1}const j=S(!1),_e=S(null),Le=S(null),Qe=S(null),ze=S(0);function It(){var b;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Xe.value.length===0)return;const g=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const Q=((b=je==null?void 0:je.currentUser)==null?void 0:b.email)||"";Q&&Bf(Q).then(async oe=>{const he=oe.filter(le=>le.seasonId===o.value);if(he.length>0){const le=`seasonPreferredPlayer:${o.value}`,ke=localStorage.getItem(le);let Ze=[];if(ke)if(ke.startsWith("["))try{Ze=JSON.parse(ke)||[]}catch{}else Ze=[ke];const ht=new Set(Ze);he.forEach(un=>ht.add(un.playerId));const Nt=Array.from(ht);localStorage.setItem(le,JSON.stringify(Nt))}}).catch(()=>{})}catch{}const M=localStorage.getItem(`startPlayerTour:${o.value}`);!g&&M&&(ze.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),tn(()=>{const Q=document.querySelector('button[data-onboarding="add-player"]');if(Q){Q.scrollIntoView({behavior:"smooth",block:"end"});const oe=Q.getBoundingClientRect(),he=document.getElementById("coachmark-add"),le=280,ke=100,Ze=(he==null?void 0:he.offsetWidth)||le,ht=(he==null?void 0:he.offsetHeight)||ke,Nt=Math.round(oe.right+12);if(Nt+Ze<=window.innerWidth-12){const wn=oe.top+oe.height/2-ht/2,xn=-14,Ot=12,Fr=window.innerHeight-ht-12,is=Math.max(Ot,Math.min(Math.round(wn+xn),Fr));q.value={position:{x:Nt,y:is},side:"right"}}else{const wn=Math.round(oe.left+oe.width/2-Ze/2),xn=Math.round(oe.top-ht-8),Ot=8,Fr=window.innerWidth-Ze-8;q.value={position:{x:Math.max(Ot,Math.min(wn,Fr)),y:xn},side:null}}}}))}catch{}}const yt=S(!1),Ut=S(null),Rn=S(null),Yn=S(!1),ot=S(null),Rt=S(!1),Xn=S(null),Zn=S(!1),bn=S(!1),vo=S(!1),ms=S(!1),gs=S(!1),Jl=S(!1),ud=S(null);function wa(){bn.value=!0}function xa(){bn.value=!1}function Yl(){gs.value=!0}function Ia(){gs.value=!1}function vs(){Jl.value=!0}function cd(){Jl.value=!1}function Xl(){try{const b=je==null?void 0:je.currentUser;if(!b||b.isAnonymous){let g=null;if(ws.value&&ws.value.size>0){const M=ws.value.values().next().value;g=pt.value.find(Q=>Q.id===M)||null}g||(g=pt.value[0]||null),ms.value=!0,g&&(ud.value=g);return}}catch{}bn.value=!0}async function Zl(){var b;try{const g=(b=je==null?void 0:je.currentUser)==null?void 0:b.email;if(!g)return;const{resetPlayerPassword:M}=await xt(()=>Promise.resolve().then(()=>us),void 0);await M(g),Me.value=!0,at.value="Email de réinitialisation envoyé.",setTimeout(()=>{Me.value=!1},3e3)}catch{Cn.value=!0,Ms.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{Cn.value=!1},3e3)}}async function Ea(){try{await ML(je),xa(),Me.value=!0,at.value="Déconnecté de cet appareil.",setTimeout(()=>{Me.value=!1},2500)}catch{Cn.value=!0,Ms.value="Déconnexion impossible.",setTimeout(()=>{Cn.value=!1},3e3)}}async function dd(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function eu(b){var g;xa();try{if(b.seasonId&&b.seasonId!==o.value){const M=be(se,"seasons",b.seasonId),oe=(await $t(tt(se,"seasons"))).docs.find(le=>le.id===b.seasonId),he=(g=oe==null?void 0:oe.data())==null?void 0:g.slug;if(he){t.push(`/season/${he}?player=${encodeURIComponent(b.playerId)}&open=protection`);return}}else{const M=pt.value.find(Q=>Q.id===b.playerId);if(M){Jf(M);return}t.push(`?player=${encodeURIComponent(b.playerId)}&open=protection`)}}catch{}}Tn(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}const b=()=>{l.value=window.scrollY>10};return window.addEventListener("scroll",b,{passive:!0}),document.addEventListener("click",g=>{if(me.value){const M=ye.value,Q=pe.value,oe=M&&M.contains(g.target),he=Q&&Q.contains(g.target);!oe&&!he&&(me.value=!1)}if(ge.value){const M=Te.value;M&&M.contains(g.target)||(ge.value=!1)}}),document.addEventListener("keydown",g=>{g.key==="Escape"&&(me.value&&(me.value=!1),ge.value&&(ge.value=!1))}),window.addEventListener("resize",()=>{me.value&&On(),ge.value&&Qt()}),window.addEventListener("scroll",()=>{me.value&&On(),ge.value&&Qt()},{passive:!0}),()=>{window.removeEventListener("scroll",b)}});function qf(){tn(()=>{tu()})}const Vr=S(new Set),ys=S(!0),Gr=S(0),Wr=S("Préparation de la grille"),er=S(e.eventId||null),Ta=S(!1),Aa=S(null);kt(()=>e.eventId,b=>{if(b)if(er.value=b,Xe.value.length>0)hy(b);else{const g=kt(Xe,M=>{M.length>0&&(hy(b),g())},{immediate:!0})}});const yi=qe(()=>pt.value.map(b=>({...b,isProtected:Vr.value.has(b.id),email:null}))),hd=qe(()=>er.value?Tr.value.findIndex(b=>b.id===er.value):-1);qe(()=>{if(!er.value||hd.value===-1)return!1;if(window.innerWidth<=768){const b=document.querySelector(`[data-event-id="${er.value}"]`);if(b){const g=b.getBoundingClientRect();return g.left>=0&&g.right<=window.innerWidth}}return!0});const Mr=S(null),Sa=S(!1),Pa=S(!1),Ra=S(0),fd=S(null),hr=S(null),Ca=S(null);function Lr(){const b=Mr.value;if(!b)return;const{scrollLeft:g,scrollWidth:M,clientWidth:Q}=b;Sa.value=g>2,Pa.value=g<M-Q-2}function tu(){var b;try{Lr(),Ra.value=((b=Mr.value)==null?void 0:b.scrollLeft)||0}catch{}}function pd(b){const g=Mr.value;if(!g)return;let M=0;const Q=g.querySelector("tbody tr td[data-event-id]");if(Q)M=Q.getBoundingClientRect().width;else if(hr!=null&&hr.value){const he=hr.value.querySelector(".col-event");he&&(M=he.getBoundingClientRect().width)}(!M||!isFinite(M))&&(M=g.clientWidth*.6);const oe=g.scrollLeft+b*M;g.scrollTo({left:oe,behavior:"smooth"})}const $r=S(null);S(0);const fr=S(!1),Vs=S(!1),ns=S(0);function nu(b,g){g&&typeof g.preventDefault=="function"&&g.preventDefault(),Ir(),pd(b)}function Dt(b,g){if(g&&typeof g.preventDefault=="function"&&g.preventDefault(),fr.value)return;fr.value=!0,ns.value=b,Vs.value=!1;const M=Mr.value;if(!M)return;let Q=0;const oe=M.querySelector("tbody tr td[data-event-id]");if(oe)Q=oe.getBoundingClientRect().width;else if(hr!=null&&hr.value){const Ze=hr.value.querySelector(".col-event");Ze&&(Q=Ze.getBoundingClientRect().width)}(!Q||!isFinite(Q))&&(Q=M.clientWidth*.6);const he=Q/6,le=120,ke=()=>{if(!fr.value||ns.value===0)return;Vs.value||(Vs.value=!0);const Ze=M.scrollLeft+ns.value*he;M.scrollTo({left:Ze,behavior:"auto"}),$r.value=window.setTimeout(ke,le)};$r.value=window.setTimeout(ke,250)}function Ir(b){b&&typeof b.preventDefault=="function"&&b.preventDefault();const g=fr.value,M=Vs.value;if(fr.value=!1,$r.value&&(clearTimeout($r.value),$r.value=null),b&&typeof b.type=="string"&&b.type.startsWith("touch")&&!M){const Q=ns.value||0;Q!==0&&pd(Q),ns.value=0;return}ns.value=0,g&&M&&yo()}function yo(){const b=Mr.value;if(!b)return;let g=0;const M=b.querySelector("tbody tr td[data-event-id]");if(M)g=M.getBoundingClientRect().width;else if(hr!=null&&hr.value){const le=hr.value.querySelector(".col-event");le&&(g=le.getBoundingClientRect().width)}if(!g||!isFinite(g)||g<=0)return;const Q=b.scrollLeft,he=Math.round(Q/g)*g;b.scrollTo({left:he,behavior:"smooth"})}function _o(b){O.value=b;const g=document.querySelector(`[data-player-id="${b}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"}),Me.value=!0,at.value="Nouveau joueur ajouté !",setTimeout(()=>{Me.value=!1},3e3)}function zf(){if(ze.value!==1)return;const b=document.querySelector('button[data-onboarding="add-player"]');if(!b)return;const g=b.getBoundingClientRect(),M=document.getElementById("coachmark-add"),Q=280,oe=100,he=M!=null&&M.offsetWidth&&M.offsetWidth>0?M.offsetWidth:Q,le=M!=null&&M.offsetHeight&&M.offsetHeight>0?M.offsetHeight:oe,ke=Math.round(g.right+12);if(ke+he<=window.innerWidth-12){const ht=g.top+g.height/2-le/2,un=ru(ht+-14,le);q.value={position:{x:ke,y:un},side:"right"}}else{const ht=Math.round(g.left+g.width/2-he/2),Nt=ru(g.top-le-8,le),un=8,wn=window.innerWidth-he-8;q.value={position:{x:Math.max(un,Math.min(ht,wn)),y:Nt},side:null}}}function ru(b,g){const M=pageHeaderRef==null?void 0:pageHeaderRef.value,Q=M?Math.max(0,Math.round(M.getBoundingClientRect().height||0)):0,oe=Math.max(12,Q+8),he=window.innerHeight-g-12;return Math.max(oe,Math.min(Math.round(b),he))}function ka(){var b;ze.value===1&&((b=q.value)!=null&&b.position)&&zf()}Tn(()=>{window.addEventListener("scroll",ka,{passive:!0}),window.addEventListener("resize",ka)}),Qs(()=>{window.removeEventListener("scroll",ka),window.removeEventListener("resize",ka)});function Da(b){return Vr.value.has(b)}async function su(){if(o.value)try{const b=await Fm(o.value),g=new Set;b.forEach(M=>{M.isProtected&&g.add(M.playerId||M.id)}),Vr.value=g}catch{const g=new Set;for(const M of pt.value)await Ji(M.id,o.value)&&g.add(M.id);Vr.value=g}}const Me=S(!1),at=S(""),Cn=S(!1),Ms=S("");function md(){try{const b=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(b),Me.value=!0,at.value="Lien copié dans le presse-papiers",setTimeout(()=>{Me.value=!1},2500)}catch{Cn.value=!0,Ms.value="Impossible de copier le lien",setTimeout(()=>{Cn.value=!1},2500)}}async function iu(b){await St({type:"deleteEvent",data:{eventId:b}})}async function _i(b=null){const g=b||h.value;if(console.debug("deleteEventConfirmed"),!g){console.error("Aucun événement à supprimer");return}try{await gU(g,o.value),Xe.value=Xe.value.filter(M=>M.id!==g),await Promise.all([Fh(o.value),Oo(pt.value,Xe.value,o.value),Vo(o.value)]).then(([M,Q,oe])=>{Xe.value=M,ln.value=Q,At.value=oe}),c.value=!1,h.value=null,Me.value=!0,at.value="Événement supprimé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Hf(){c.value=!1,h.value=null}async function ou(){if(!f.value||!m.value.trim()||!v.value)return;const b=parseInt(w.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const g={title:m.value.trim(),date:v.value,description:Z.value.trim()||"",playerCount:b,archived:!!ue.value};await jb(f.value,g,o.value),!g.archived&&pt.value.length>0&&Vr.value.size>0&&(Xn.value={id:f.value,...g},Rt.value=!0),await Promise.all([Fh(o.value),Oo(pt.value,Xe.value,o.value),Vo(o.value)]).then(([M,Q,oe])=>{Xe.value=M,ln.value=Q,At.value=oe}),f.value=null,m.value="",v.value="",Z.value="",w.value=6,ue.value=!1,Me.value=!0,at.value="Événement mis à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Kf(){if(I.value.trim())try{const b=I.value.trim(),g=await h1(b,o.value);await Promise.all([nc(o.value),Oo(pt.value,Xe.value,o.value),Vo(o.value)]).then(([M,Q,oe])=>{pt.value=M,ln.value=Q,At.value=oe,su();const he=pt.value.find(ke=>ke.id===g);_o(g),L.value=g,U.value=Tr.value&&Tr.value[0]&&Tr.value[0].id?Tr.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,g)}catch{}try{typeof ze<"u"&&(ze.value=2)}catch{}const le=document.querySelector(`[data-player-id="${g}"]`);le&&le.scrollIntoView({behavior:"smooth",block:"center"}),tn(()=>{const ke=`[data-player-id="${L.value}"] td[data-event-id="${U.value}"]`,Ze=document.querySelector(ke);if(Ze){const ht=Ze.getBoundingClientRect();te.value.position={x:Math.round(ht.left),y:Math.round(ht.top+window.scrollY-48)}}}),Me.value=!0,at.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Me.value=!1},3e3),setTimeout(()=>{Me.value=!1,at.value=""},5e3)}),x.value=!1,I.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Er(){f.value=null,m.value="",v.value="",Z.value="",w.value=6}S(null);const Na=S(!1),bi=S(""),rs=S(""),_s=S(""),wi=S(6),bs=S(!1);async function bo(){if(!bi.value.trim()||!rs.value){alert("Veuillez remplir le titre et la date de l'événement");return}const b=parseInt(wi.value);if(isNaN(b)||b<1||b>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const g={title:bi.value.trim(),date:rs.value,description:_s.value.trim()||"",playerCount:b,archived:!!bs.value};await gd(g)}async function gd(b){try{const g=await vU(b,o.value);Xe.value=[...Xe.value,{id:g,...b}];const M={};for(const Q of pt.value)M[Q.name]=ln.value[Q.name]||{},M[Q.name][g]=null,await Ub(Q.name,M[Q.name],o.value);bi.value="",rs.value="",_s.value="",wi.value=6,bs.value=!1,Na.value=!1,await Promise.resolve(),Me.value=!0,at.value="Événement créé avec succès !",!b.archived&&pt.value.length>0&&Vr.value.size>0&&(Xn.value={id:g,...b},Rt.value=!0),setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function au(){bi.value="",rs.value="",_s.value="",wi.value=6,Na.value=!1}async function Jt(){await St({type:"addEvent",data:{}})}const Xe=S([]),pt=S([]),ln=S({}),At=S({}),vd=S({}),xi=S({});kt([()=>Xe.value.length,()=>pt.value.length,ys],()=>{ys.value||tn(()=>{tu()})}),kt([()=>pt.value.length,()=>Xe.value.length,o],()=>{It()}),Tn(async()=>{try{ny("firebase"),await d1();const g=Sc(tt(se,"seasons"),Ch("slug","==",e.slug)),M=await $t(g);if(M.empty){t.push("/seasons");return}else{const le=M.docs[0];o.value=le.id;const ke=le.data();i.value=ke.name,a.value=ke,document.title=`Saison : ${i.value}`,$$(e.slug)}if(o.value){Wr.value="Chargement des événements de la saison",Gr.value=20;const le=await $t(tt(se,"seasons",o.value,"events"));Xe.value=le.docs.map(Ot=>({id:Ot.id,...Ot.data(),playerCount:Ot.data().playerCount||6})),Wr.value="Chargement des joueurs",Gr.value=45;const ke=await $t(tt(se,"seasons",o.value,"players"));pt.value=ke.docs.map(Ot=>({id:Ot.id,...Ot.data()})),Wr.value="Chargement des disponibilités",Gr.value=70;const Ze=await $t(tt(se,"seasons",o.value,"availability")),ht={};Ze.docs.forEach(Ot=>{const Fr=Ot.data(),is={};Object.keys(Fr).forEach(To=>{const ja=Fr[To];is[To]=ja==="oui"?!0:ja==="non"?!1:ja}),ht[Ot.id]=is}),ln.value=ht,Wr.value="Chargement des sélections",Gr.value=85;const Nt=await $t(tt(se,"seasons",o.value,"selections")),un={};Nt.docs.forEach(Ot=>{un[Ot.id]=Ot.data().players||[]}),At.value=un;const wn=await Fm(o.value),xn=new Set;Array.isArray(wn)&&wn.forEach(Ot=>{Ot.isProtected&&xn.add(Ot.playerId||Ot.id)}),Vr.value=xn}const Q=le=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>le()):setTimeout(le,0)};Wr.value="Préparation de l'interface",Gr.value=95,Q(()=>{gu(),$a()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),r.query.notificationSuccess==="1"&&(Ht.value={email:decodeURIComponent(r.query.email||""),playerName:decodeURIComponent(r.query.playerName||""),eventId:r.query.eventId||null},an.value=!0,t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}})),await tn(),Gr.value=100,ys.value=!1,tn(()=>{Lr(),requestAnimationFrame(()=>Lr()),setTimeout(()=>Lr(),250);const le=Mr.value;le&&(le.addEventListener("scroll",ke=>{Lr(),Ra.value=le.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Lr),typeof ResizeObserver<"u"&&(Ca.value=new ResizeObserver(()=>{Lr()}),Ca.value.observe(le)))});const oe=r.query.event;if(oe&&Xe.value.length>0){const le=Xe.value.find(ke=>ke.id===oe);le?(console.debug("Événement trouvé depuis l'URL"),await Zf(oe,le)):(console.warn("Événement non trouvé avec l'ID"),Cn.value=!0,Ms.value="Événement non trouvé",setTimeout(()=>{Cn.value=!1},3e3))}const he=r.query.player;if(he&&pt.value.length>0){const le=pt.value.find(ke=>ke.id===he);le&&(Jf(le),await tn(),r.query.verified==="1"&&(Me.value=!0,at.value="Joueur associé à votre compte.",setTimeout(()=>{Me.value=!1},2500)))}}catch(b){console.error("Erreur lors du chargement de la grille:",b),Cn.value=!0,Ms.value="Erreur lors du chargement des données",setTimeout(()=>{Cn.value=!1},5e3),ys.value=!1}}),kt(()=>r.params.eventId,b=>{if(b){const g=()=>{const M=Xe.value.find(Q=>Q.id===b);return M?(sy(M),!0):!1};if(Xe.value.length>0)g();else{const M=kt(Xe,Q=>{Q.length>0&&g()&&M()},{immediate:!0})}}},{immediate:!0});function lu(b){if(!b)return null;if(b instanceof Date)return b;if(typeof(b==null?void 0:b.toDate)=="function")return b.toDate();if(typeof b=="string"||typeof b=="number"){const g=new Date(b);return isNaN(g.getTime())?null:g}return null}const tr=qe(()=>{let b=null;try{o.value&&(b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const g=[...pt.value].sort((le,ke)=>(le.name||"").localeCompare(ke.name||"","fr",{sensitivity:"base"}));if(!b)return g;let M=[];try{b.startsWith("[")?M=JSON.parse(b):b&&(M=[b])}catch{M=[]}const Q=new Set(M);if(Q.size===0)return g;const oe=g.filter(le=>Q.has(le.id)),he=g.filter(le=>!Q.has(le.id));return[...oe,...he]}),ws=qe(()=>{try{if(o.value){const b=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!b)return new Set;if(b.startsWith("[")){const g=JSON.parse(b);return new Set(Array.isArray(g)?g:[])}return new Set([b])}}catch{}return new Set}),Gf=qe(()=>[...Xe.value].sort((b,g)=>{const M=lu(b.date),Q=lu(g.date),oe=M?M.getTime():Number.POSITIVE_INFINITY,he=Q?Q.getTime():Number.POSITIVE_INFINITY;return oe!==he?oe-he:(b.title||"").localeCompare(g.title||"","fr",{sensitivity:"base"})})),Qr=S(!1),Tr=qe(()=>{const b=Gf.value;return Qr.value?b:b.filter(g=>!g.archived)});function uu(){Qr.value=!Qr.value}const Ii=S("selected"),yd=qe(()=>{var M;if(!K.value)return tr.value;const b=K.value.id,g=new Set(((M=At.value)==null?void 0:M[b])||[]);return tr.value.filter(Q=>{var ke;const oe=Q.name,he=(ke=ln.value[oe])==null?void 0:ke[b],le=g.has(oe);switch(Ii.value){case"selected":return le;case"available":return he===!0&&!le;case"unavailable":return he===!1;case"unknown":return he!==!0&&he!==!1;case"all":default:return!0}})}),Oa=qe(()=>K.value?Io(K.value.id):null),Wf=qe(()=>{if(!K.value)return!1;const b=Io(K.value.id);return b.type==="incomplete"||b.type==="insufficient"}),cu=qe(()=>K.value?yu(K.value.id):"");async function xs(b,g){const M=pt.value.find(he=>he.name===b);if(!M){console.error("Joueur non trouvé");return}const Q=Xe.value.find(he=>he.id===g);if(!Q){console.error("Événement non trouvé");return}if(Q.archived){Me.value=!0,at.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Me.value=!1},3e3);return}if(Da(M.id)){const he=Qo(M.id),le=Qe.value===M.id;console.debug("Joueur protégé:",{playerId:M.id,hasCachedPassword:he,wasRecentlyVerified:le,recentlyVerifiedPlayer:Qe.value}),he||le?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),le&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),Qe.value=null),Va(M,g)):(console.debug("Pas de session, affichage de la modal de vérification"),Le.value={playerName:b,eventId:g},_e.value=M,j.value=!0);return}Va(M,g)}function Va(b,g){var oe,he,le;const M=(oe=ln.value[b.name])==null?void 0:oe[g];console.debug("toggleAvailability");let Q;M===!0?Q=!1:M===!1?Q=void 0:Q=!0,Q===void 0?ln.value[b.name]&&delete ln.value[b.name][g]:(ln.value[b.name]||(ln.value[b.name]={}),ln.value[b.name][g]=Q);try{typeof ze<"u"&&ze.value===1&&b.id===(L.value||((he=tr.value[0])==null?void 0:he.id))&&g===(U.value||((le=Tr.value[0])==null?void 0:le.id))&&(ze.value=3,tn(()=>{const Ze=document.querySelector(`[data-player-id="${b.id}"]`);if(Ze){const ht=Ze.querySelector(".player-name");if(ht){const Nt=ht.getBoundingClientRect();X.value.position={x:Math.round(Nt.right+8),y:Math.round(Nt.top+window.scrollY-4)}}}}),Qs(()=>{try{window.removeEventListener("resize",Lr)}catch{}try{Ca.value&&Ca.value.disconnect()}catch{}}))}catch{}Ub(b.name,ln.value[b.name],o.value).then(async()=>{await tn(),$a(),Me.value=!0,at.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}).catch(ke=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function pr(b,g){var M;return(M=ln.value[b])==null?void 0:M[g]}function du(b,g){var oe;const M=At.value[g]||[],Q=(oe=ln.value[b])==null?void 0:oe[g];return M.includes(b)&&Q===!0}async function hu(b,g=6){const M=Xe.value.find(le=>le.id===b),Q=(M==null?void 0:M.playerCount)||6,oe=At.value[b]||[];if(oe.length>0&&oe.every(le=>pr(le,b))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const ke=pt.value.filter(Nt=>pr(Nt.name,b)).map(Nt=>{const un=Ar(Nt.name);return{name:Nt.name,weight:1/(1+un)}}),Ze=[],ht=[...ke];for(;Ze.length<Q&&ht.length>0;){const Nt=ht.reduce((xn,Ot)=>xn+Ot.weight,0);let un=Math.random()*Nt;const wn=ht.findIndex(xn=>(un-=xn.weight,un<=0));wn>=0&&(Ze.push(ht[wn].name),ht.splice(wn,1))}At.value[b]=Ze}else{const le=oe.filter(Ze=>pr(Ze,b)),ke=Q-le.length;if(ke<=0)At.value[b]=le;else{const Ze=new Set(le),Nt=pt.value.filter(xn=>pr(xn.name,b)&&!Ze.has(xn.name)).map(xn=>{const Ot=Ar(xn.name);return{name:xn.name,weight:1/(1+Ot)}}),un=[],wn=[...Nt];for(;un.length<ke&&wn.length>0;){const xn=wn.reduce((is,To)=>is+To.weight,0);let Ot=Math.random()*xn;const Fr=wn.findIndex(is=>(Ot-=is.weight,Ot<=0));Fr>=0&&(un.push(wn[Fr].name),wn.splice(Fr,1))}At.value[b]=[...le,...un]}}await jm(b,At.value[b],o.value),gu(),$a()}async function fu(b,g=6){var le,ke;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const M=yt.value,Q=(le=Ut.value)==null?void 0:le.id,oe=At.value[b]&&At.value[b].length>0,he=oe?[...At.value[b]]:[];if(await hu(b,g),console.debug("etat modal selection apres"),M&&!yt.value&&(console.debug("Restauration de la popin de sélection..."),yt.value=!0,Ut.value=Xe.value.find(Ze=>Ze.id===Q)),yt.value&&((ke=Ut.value)==null?void 0:ke.id)===b)if(console.debug("Popin de sélection ouverte, mise à jour..."),await tn(),Rn.value&&Rn.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const Ze=At.value[b]||[],ht=he.filter(un=>Ze.includes(un)),Nt=ht.length>0&&ht.length<he.length;Rn.value.showSuccess(oe,Nt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Me.value=!0,Xe.value.find(Ze=>Ze.id===b),At.value[b],oe?at.value="Sélection mise à jour avec succès !":at.value="Sélection effectuée avec succès !",setTimeout(()=>{Me.value=!1},3e3)}function Ei(b){b===0?q.value.position=null:b===1?te.value.position=null:b===2&&(X.value.position=null)}function _d(b){var M;return b?(typeof b=="string"?new Date(b):((M=b.toDate)==null?void 0:M.call(b))||b).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function pu(b){var M;return b?(typeof b=="string"?new Date(b):((M=b.toDate)==null?void 0:M.call(b))||b).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Ar(b){return Object.values(At.value).filter(g=>g.includes(b)).length}function Ma(b){const g=ln.value[b]||{};return Object.values(g).filter(M=>M===!0).length}function wo(b){return b?Object.values(ln.value).filter(g=>g[b]===!0).length:0}function xo(b){return b?(At.value[b]||[]).length:0}function mu(b){const g=Xe.value.find(Q=>Q.id===b),M=(g==null?void 0:g.playerCount)||6;return xo(b)>=M}function La(b){const g=Ma(b),M=Ar(b);return g===0?0:M/g}function mr(b){vd.value[b]={availability:Ma(b),selection:Ar(b),ratio:La(b)}}function gu(){pt.value.forEach(b=>mr(b.name))}function $a(){const b={};Xe.value.forEach(g=>{const M=g.playerCount||6,oe=pt.value.filter(le=>pr(le.name,g.id)===!0).map(le=>{const ke=Ar(le.name);return{name:le.name,weight:1/(1+ke)}}),he=oe.reduce((le,ke)=>le+ke.weight,0);oe.forEach(le=>{const ke=Math.min(1,le.weight/he*M);b[le.name]||(b[le.name]={}),b[le.name][g.id]=Math.round(ke*100)})}),xi.value=b}const ss=S(null),u=S(!1);async function p(b=null){const g=b||ss.value;if(!g){console.error("Aucun joueur à supprimer");return}try{await fU(g,o.value),pt.value=pt.value.filter(M=>M.id!==g),u.value=!1,ss.value=null,Me.value=!0,at.value="Joueur supprimé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function y(){u.value=!1,ss.value=null}async function E(b){ly(),await Ji(b,o.value)?await Vn({type:"deletePlayer",data:{playerId:b}}):await St({type:"deletePlayer",data:{playerId:b}})}async function B(){if(_.value){const b=Xe.value.find(M=>M.id===_.value),g=(b==null?void 0:b.playerCount)||6;await fu(_.value,g),A.value=!1,_.value=null}}function J(){A.value=!1,_.value=null}function Ie(){return R.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[R.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function St(b){if(Hn.isPinCached(o.value)){const g=Hn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await Vh(o.value,g)){await Ai(b);return}else Hn.clearSession()}R.value=b,V.value=!0}async function Vn(b){const g=b.data.playerId;try{if(Hn.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await Ai(b);return}}catch{}if(Qo(g)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Ai(b);return}ct.value=b,ut.value=!0}async function Et(b){try{if(await Vh(o.value,b)){Hn.saveSession(o.value,b),V.value=!1;const M=R.value;R.value=null,await Ai(M)}else Ke.value="Code PIN incorrect",setTimeout(()=>{Ke.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),Ke.value="Erreur lors de la vérification du code PIN"}}function Fn(){V.value=!1,R.value=null,Ke.value=""}async function Mn(b){if(b){fe.value=!0,Ge.value="";try{const g=ct.value.data.playerId,M=await Om(o.value);if(b===M){try{Hn.saveSession(o.value,b)}catch{}try{lo.saveSession(ct.value.data.playerId)}catch{}ut.value=!1;const oe=ct.value;ct.value=null,Ae.value="",await Ai(oe);return}if(await verifyPlayerPassword(g,b,o.value)){ut.value=!1;const oe=ct.value;ct.value=null,Ae.value="",await Ai(oe)}else Ge.value="Mot de passe incorrect",setTimeout(()=>{Ge.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Ge.value="Erreur lors de la vérification du mot de passe"}finally{fe.value=!1}}}function Ti(){ut.value=!1,ct.value=null,Ge.value="",Ae.value="",fe.value=!1}async function Sr(b){if(b){Pt.value=!0,Ne.value="";try{const g=ne.value.data.player,M=await Om(o.value);if(b===M){try{Hn.saveSession(o.value,b)}catch{}try{lo.saveSession(ne.value.data.player.id)}catch{}ae.value=!1;const oe=ne.value;ne.value=null,dt.value="",await Ai(oe);return}if(await verifyPlayerPassword(g.id,b,o.value)){ae.value=!1;const oe=ne.value;ne.value=null,dt.value="",await Ai(oe)}else Ne.value="Mot de passe incorrect",setTimeout(()=>{Ne.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Ne.value="Erreur lors de la vérification du mot de passe"}finally{Pt.value=!1}}}function Fa(){ae.value=!1,ne.value=null,Ne.value="",dt.value="",Pt.value=!1}async function vu(){xe.value=!0,ve.value="",Pe.value="";try{const b=ne.value.data.player,g=await sendPasswordResetEmail(b.id,o.value);Pe.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ve.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{xe.value=!1}}async function x1(){vt.value=!0,P.value="",N.value="";try{const b=ct.value.data.playerId,g=await sendPasswordResetEmail(b,o.value);N.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),P.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{vt.value=!1}}function I1(){return Hn.isPinCached(o.value)?{timeRemaining:Hn.getTimeRemaining(),isExpiringSoon:Hn.isExpiringSoon()}:null}async function Ai(b){var Q;if(!b)return;const{type:g,data:M}=b;try{switch(g){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),h.value=M.eventId,c.value=!0;break;case"addEvent":Na.value=!0;break;case"deletePlayer":ss.value=M.playerId,u.value=!0;break;case"launchSelection":At.value[M.eventId]&&At.value[M.eventId].length>0?(_.value=M.eventId,A.value=!0,H.value=!1):(await fu(M.eventId,M.count),H.value=!1);break;case"toggleAvailability":Va(M.player,M.eventId);break;case"toggleArchive":await setEventArchived(M.eventId,M.archived,o.value);{const oe=Xe.value.findIndex(he=>he.id===M.eventId);oe!==-1&&(Xe.value[oe]={...Xe.value[oe],archived:!!M.archived}),ue.value=!!M.archived}break;case"updateSelection":{const{eventId:oe,players:he}=M,le=[...At.value[oe]||[]],ke=Array.isArray(he)?he:[];await jm(oe,ke,o.value),At.value[oe]=ke;try{const Ze=le.filter(ht=>!ke.includes(ht));if(Ze.length>0){const ht=Xe.value.find(Nt=>Nt.id===oe);await FF({eventId:oe,eventData:ht,removedPlayers:Ze,newSelectedPlayers:ke,seasonId:o.value,seasonSlug:s,players:yi.value})}}catch{}try{(Q=Rn.value)==null||Q.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Me.value=!0,at.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Me.value=!1},3e3)}}function E1(){t.push("/seasons")}Qs(()=>{const b=Mr.value;b&&b.removeEventListener("scroll",Lr),window.removeEventListener("resize",Lr)});async function sy(b){K.value=b,Z.value=b.description||"",ue.value=!!b.archived;try{const[g,M]=await Promise.all([Oo(pt.value,Xe.value,o.value),Vo(o.value)]);ln.value=g,At.value=M}catch(g){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",g)}H.value=!0}function Qf(){H.value=!1,K.value=null,Z.value="",ge.value=!1,me.value=!1,Pn(),re(),Ve.value={position:"fixed",top:"0px",left:"0px"},Ce.value={position:"fixed",top:"0px",left:"0px"}}function Ua(b,g=null){const M=g||K.value;if(M)try{B5(b,M,i.value),Me.value=!0,b==="ics"?at.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":b==="google"?at.value="Google Calendar ouvert dans un nouvel onglet":b==="outlook"&&(at.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Me.value=!1},3e3)}catch(Q){console.error("Erreur lors de l'ajout au calendrier:",Q),Me.value=!0,at.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Me.value=!1},3e3)}}function iy(){Qf(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function T1(b,g){var he;console.debug("handleAvailabilityToggle appelé");const M=pt.value.find(le=>le.name===b);if(!M){console.error("Joueur non trouvé");return}const Q=Xe.value.find(le=>le.id===g);if(Q!=null&&Q.archived){Me.value=!0,at.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Me.value=!1},3e3);return}if(console.debug("Joueur trouvé"),!((he=je.currentUser)!=null&&he.email))if(f1()){rt.value={playerName:b,eventTitle:(Q==null?void 0:Q.title)||"cet événement",eventId:g},We.value=!0;return}else{ms.value=!0;return}const oe=Da(M.id);if(console.debug("Joueur protégé"),oe){Qo(M.id)?(console.debug("Session active, procéder au toggle"),await xs(b,g)):(console.debug("Demande du mot de passe pour joueur protégé"),Le.value={playerName:b,eventId:g},_e.value=M,j.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await xs(b,g)}function A1(b,g){return(At.value[g]||[]).includes(b)}async function S1(b){if(console.debug("Mot de passe vérifié"),_e.value&&(Qe.value=_e.value.id,console.debug("Joueur marqué comme récemment vérifié")),Le.value){const{playerName:g,eventId:M}=Le.value;console.debug("Exécution de l'action en attente"),await xs(g,M),Le.value=null}else console.debug("Aucune action en attente trouvée");j.value=!1,_e.value=null}function oy(){f.value=K.value.id,m.value=K.value.title,v.value=K.value.date,Z.value=K.value.description||"",w.value=K.value.playerCount||6,H.value=!1}async function ay(){if(K.value)try{const b=!K.value.archived,g={...K.value,archived:b};await jb(K.value.id,g,o.value),K.value.archived=b;const M=Xe.value.findIndex(Q=>Q.id===K.value.id);M!==-1&&(Xe.value[M].archived=b),Me.value=!0,at.value=b?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Jf(b){k.value=b,T.value=!0;try{typeof ze<"u"&&ze.value}catch{}}function ly(){T.value=!1,k.value=null}async function P1({playerId:b,newName:g}){try{await pU(b,g,o.value),await Promise.all([nc(o.value),Oo(pt.value,Xe.value,o.value),Vo(o.value)]).then(([M,Q,oe])=>{if(pt.value=M,ln.value=Q,At.value=oe,su(),k.value&&k.value.id===b){const he=M.find(le=>le.id===b);he&&(k.value=he)}}),Me.value=!0,at.value="Joueur mis à jour avec succès !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function R1(){try{await Promise.all([nc(o.value),Oo(pt.value,Xe.value,o.value),Vo(o.value)]).then(([b,g,M])=>{if(pt.value=b,ln.value=g,At.value=M,su(),k.value){const Q=b.find(oe=>oe.id===k.value.id);Q&&(k.value=Q)}}),Me.value=!0,at.value="Données mises à jour !",setTimeout(()=>{Me.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function C1(b){if(!b)return{availability:0,selection:0,ratio:0};const g=Ma(b.name),M=Ar(b.name),Q=g===0?0:Math.round(M/g*100);return{availability:g,selection:M,ratio:Q}}function Io(b){const g=At.value[b]||[],M=Xe.value.find(he=>he.id===b),Q=(M==null?void 0:M.playerCount)||6,oe=wo(b);if(g.length>0){const he=g.some(ke=>!pr(ke,b)),le=oe<Q;if(he||le)return{type:"incomplete",hasUnavailablePlayers:he,hasInsufficientPlayers:le,unavailablePlayers:g.filter(ke=>!pr(ke,b)),availableCount:oe,requiredCount:Q}}return oe<Q?{type:"insufficient",availableCount:oe,requiredCount:Q}:g.length===0?{type:"ready",availableCount:oe,requiredCount:Q}:{type:"complete",availableCount:oe,requiredCount:Q}}function yu(b){const g=Io(b);switch(g.type){case"incomplete":return g.hasUnavailablePlayers?g.unavailablePlayers.length===1?`Sélection incomplète : ${g.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${g.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${g.availableCount} joueurs disponibles pour ${g.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${g.availableCount} disponibles pour ${g.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${g.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${g.availableCount} joueurs disponibles`;default:return""}}async function k1(){const b=[];for(const g of pt.value){if(!await Ji(g.id,o.value))continue;const Q=await s1(g.id,o.value);Q&&b.push({...g,email:Q})}return b}function bd(b){if(b!=null&&b.archived){Me.value=!0,at.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Me.value=!1},3e3);return}uy(),ot.value=b,Yn.value=!0;try{const g=new URLSearchParams(window.location.search);g.set("modal","announce"),g.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${g.toString()}`)}catch{}}function D1(){Yn.value=!1,ot.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="announce"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}function uy(){Rt.value=!1,Xn.value=null}const Yf=S(!1);async function cy({eventId:b,eventData:g,reason:M,selectedPlayers:Q,scope:oe="all",recipient:he=null}){Yf.value=!0;try{M==="selection"?(oe==="single"&&(he!=null&&he.email)?await qb({eventId:b,eventData:g,selectedPlayers:[he.name],seasonId:o.value,seasonSlug:s,players:yi.value}):await qb({eventId:b,eventData:g,selectedPlayers:Q,seasonId:o.value,seasonSlug:s,players:yi.value}),Me.value=!0,at.value=oe==="single"?`Notification envoyée à ${(he==null?void 0:he.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Me.value=!1},3e3)):(oe==="single"&&(he!=null&&he.email)?await Bb({eventId:b,eventData:g,players:[he],seasonId:o.value,seasonSlug:s,createMagicLink:Lh,reminder:!1,getAvailabilityForEvent:(le,ke)=>pr(le,ke)}):await Bb({eventId:b,eventData:g,players:await k1(),seasonId:o.value,seasonSlug:s,createMagicLink:Lh,reminder:!1,getAvailabilityForEvent:(le,ke)=>pr(le,ke)}),Me.value=!0,at.value=oe==="single"?`Notification envoyée à ${(he==null?void 0:he.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Me.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Me.value=!0,at.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Me.value=!1},3e3)}Yf.value=!1}function Xf(b){if(!b)return{};const g={};return pt.value.forEach(M=>{g[M.name]=pr(M.name,b)}),g}function Eo(b){if(b!=null&&b.archived){Me.value=!0,at.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Me.value=!1},3e3);return}Ut.value=b,yt.value=!0;try{const g=new URLSearchParams(window.location.search);g.set("modal","selection"),g.set("event",(b==null?void 0:b.id)||""),history.replaceState(null,"",`${window.location.pathname}?${g.toString()}`)}catch{}}function dy(){yt.value=!1,Ut.value=null;try{const b=new URLSearchParams(window.location.search);b.get("modal")==="selection"&&(b.delete("modal"),b.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${b.toString()}`))}catch{}}async function N1(){if(!Ut.value)return;const b=Ut.value.id,g=Ut.value.playerCount||6;if(wo(b)===0){Me.value=!0,at.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Me.value=!1},3e3);return}await St({type:"launchSelection",data:{eventId:b,count:g}})}function O1(){dy(),Me.value=!0,at.value="Sélection validée !",setTimeout(()=>{Me.value=!1},3e3)}async function V1(b){if(!b||!b.eventId)return;const{eventId:g,players:M}=b;await St({type:"updateSelection",data:{eventId:g,players:M}})}async function Zf(b,g){if(!b||!g)return;fy(),er.value=b,Ta.value=!0,await tn();const M=document.querySelector(`[data-event-id="${b}"]`);if(!M){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(le=>{le.classList.remove("focused-event-highlight")});const Q=document.querySelectorAll(`[data-event-id="${b}"]`);Q.forEach(le=>{le.classList.add("focused-event-highlight")});const oe=Q[0],he=Q[Q.length-1];oe&&oe.classList.add("focused-event-column-start"),he&&he.classList.add("focused-event-column-end"),await M1(M),Me.value=!0,at.value=`Événement ciblé : ${g.title}`,setTimeout(()=>{Me.value=!1},4e3),Aa.value=setTimeout(()=>{fy()},8e3)}function hy(b){if(!b)return;const g=Xe.value.find(M=>M.id===b);if(!g){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const M=Xe.value.find(Q=>Q.id===b);M?Zf(b,M):console.error("Événement toujours introuvable après retry")},500);return}Zf(b,g)}kt(Xe,b=>{try{const g=new URLSearchParams(window.location.search),M=g.get("modal"),Q=g.get("event");if(!M||!Q)return;const oe=b.find(he=>he.id===Q);if(!oe)return;M==="announce"&&bd(oe),M==="selection"&&Eo(oe)}catch{}},{immediate:!0});async function M1(b){if(!b)return;if(await new Promise(M=>setTimeout(M,100)),window.innerWidth<=768){const M=Mr.value;if(M){const Q=b.offsetLeft,oe=b.offsetWidth,he=M.clientWidth,le=Q-he/2+oe/2,ke=M.scrollWidth-he,Ze=Math.max(0,Math.min(le,ke));M.scrollTo({left:Ze,behavior:"smooth"}),setTimeout(()=>{const ht=b.getBoundingClientRect();if(ht.left<0||ht.right>window.innerWidth){const Nt=Q-20;M.scrollTo({left:Math.max(0,Nt),behavior:"smooth"})}},500)}}else b.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const g=Mr.value;g&&setTimeout(()=>{const M=document.querySelector(`[data-event-id="${er.value}"]`);if(M&&M.closest("tbody")){const Q=M.offsetLeft,oe=M.offsetWidth,he=g.clientWidth,le=Q-he/2+oe/2,ke=g.scrollWidth-he,Ze=Math.max(0,Math.min(le,ke));g.scrollTo({left:Ze,behavior:"smooth"})}},300)}function fy(){Aa.value&&(clearTimeout(Aa.value),Aa.value=null),er.value=null,Ta.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(b=>{b.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(b=>{b.classList.remove("focused-event-column-start","focused-event-column-end")})}function L1(b){We.value=!1,rt.value=null,Me.value=!0,b.directActivation?at.value=`Notifications activées directement pour ${b.playerName} !`:at.value=`Email envoyé à ${b.email} pour activer les notifications !`,setTimeout(()=>{Me.value=!1},4e3),F.info("Activation des notifications terminée avec succès",b)}return(b,g)=>{var M,Q,oe,he,le,ke,Ze,ht,Nt,un,wn,xn,Ot,Fr,is,To,ja,py,my,gy,vy,yy,_y,by,wy,xy,Iy,Ey,Ty,Ay;return C(),D(mt,null,[d("div",U9,[Be(n9,{"season-name":i.value,"is-scrolled":l.value,onGoBack:E1,onOpenAccountMenu:wa,onOpenHelp:g[0]||(g[0]=G=>Zn.value=!0),onOpenNotifications:Yl,onOpenPlayers:vs,onLogout:Ea,onOpenLogin:Xl,onOpenAccount:Xl},null,8,["season-name","is-scrolled"]),d("div",j9,[d("div",{ref_key:"headerBarRef",ref:fd,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[d("div",B9,[Xe.value.length===0&&pt.value.length===0?ie("",!0):(C(),D("div",q9,[d("div",{class:"flex items-center justify-center h-full gap-2"},[d("button",{onClick:Jt,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},g[76]||(g[76]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),d("span",{class:"sm:hidden"},"Événement",-1)]))])])),d("div",z9,[d("div",{ref_key:"headerEventsRef",ref:hr,class:"flex relative z-[60]",style:Ur({transform:`translateX(-${Ra.value}px)`})},[(C(!0),D(mt,null,jr(Tr.value,G=>(C(),D("div",{key:"h-"+G.id,"data-event-id":G.id,class:cn(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":G.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:G.title+" - Cliquez pour voir les détails",onClick:ft(fn=>sy(G),["stop"])},[d("div",G9,[d("div",W9,ee(G.title||"Sans titre"),1),G.archived?(C(),D("div",Q9,"(Archivé)")):ie("",!0)]),d("div",J9,[d("div",{onClick:ft(fn=>_n(G.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:pu(G.date)+" - Cliquez pour ajouter à votre agenda"},ee(_d(G.date)),9,Y9),Fe.value===G.id?(C(),D("div",X9,[d("div",Z9,[d("button",{onClick:ft(fn=>{Ua("google",G),Pn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},g[77]||(g[77]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)]),8,ez),d("button",{onClick:ft(fn=>{Ua("outlook",G),Pn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},g[78]||(g[78]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)]),8,tz),d("button",{onClick:ft(fn=>{Ua("ics",G),Pn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},g[79]||(g[79]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]),8,nz)])])):ie("",!0)])],8,K9),d("div",rz,[G.archived?(C(),D("div",sz,g[80]||(g[80]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):Io(G.id).type==="ready"?(C(),D("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:yu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>Eo(G),["stop"])},g[81]||(g[81]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,iz)):Io(G.id).type==="complete"?(C(),D("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:yu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>Eo(G),["stop"])},g[82]||(g[82]=[d("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),d("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,oz)):Io(G.id).type==="incomplete"?(C(),D("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:yu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>Eo(G),["stop"])},g[83]||(g[83]=[d("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),d("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,az)):Io(G.id).type==="insufficient"?(C(),D("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:yu(G.id)+" - Cliquez pour ouvrir la sélection",onClick:ft(fn=>Eo(G),["stop"])},g[84]||(g[84]=[d("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),d("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,lz)):ie("",!0)])],10,H9))),128))],4)]),g[87]||(g[87]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),d("button",{onClick:uu,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:Qr.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":Qr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(C(),D("svg",cz,[g[85]||(g[85]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),g[86]||(g[86]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),Qr.value?ie("",!0):(C(),D("path",dz))]))],8,uz),st(d("button",{onClick:g[1]||(g[1]=ft(G=>nu(-1,G),["prevent"])),onMousedown:g[2]||(g[2]=ft(G=>Dt(-1,G),["prevent"])),onMouseup:g[3]||(g[3]=G=>Ir(G)),onMouseleave:g[4]||(g[4]=G=>Ir(G)),onTouchstart:g[5]||(g[5]=ft(G=>Dt(-1,G),["prevent"])),onTouchend:g[6]||(g[6]=G=>Ir(G)),onTouchcancel:g[7]||(g[7]=G=>Ir(G)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[dp,Sa.value]]),st(d("button",{onClick:g[8]||(g[8]=ft(G=>nu(1,G),["prevent"])),onMousedown:g[9]||(g[9]=ft(G=>Dt(1,G),["prevent"])),onMouseup:g[10]||(g[10]=G=>Ir(G)),onMouseleave:g[11]||(g[11]=G=>Ir(G)),onTouchstart:g[12]||(g[12]=ft(G=>Dt(1,G),["prevent"])),onTouchend:g[13]||(g[13]=G=>Ir(G)),onTouchcancel:g[14]||(g[14]=G=>Ir(G)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[dp,Pa.value]])])],512),st(d("div",{ref_key:"gridboardRef",ref:Mr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[ze.value===1?(C(),D("div",hz,[q.value.position?(C(),D("div",{key:0,class:"fixed z-[400]",style:Ur({left:q.value.position.x+"px",top:q.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:cn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":q.value.side==="right","coachmark-left":q.value.side==="left"}])},[g[89]||(g[89]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),g[90]||(g[90]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),d("div",fz,[g[88]||(g[88]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:g[15]||(g[15]=G=>Ei(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ie("",!0)])):ie("",!0),ze.value===2&&L.value&&U.value?(C(),D("div",pz,[te.value.position?(C(),D("div",{key:0,class:"fixed z-[400]",style:Ur({position:"absolute",left:te.value.position.x+"px",top:te.value.position.y+"px"})},[d("div",mz,[g[92]||(g[92]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),g[93]||(g[93]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",gz,[g[91]||(g[91]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:g[16]||(g[16]=G=>Ei(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ie("",!0)])):ie("",!0),ze.value===3&&L.value?(C(),D("div",vz,[X.value.position?(C(),D("div",{key:0,class:"fixed z-[400]",style:Ur({position:"absolute",left:X.value.position.x+"px",top:X.value.position.y+"px"})},[d("div",yz,[g[95]||(g[95]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),g[96]||(g[96]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",_z,[g[94]||(g[94]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:g[17]||(g[17]=G=>Ei(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ie("",!0)])):ie("",!0),d("table",bz,[d("colgroup",null,[g[97]||(g[97]=d("col",{class:"col-left"},null,-1)),(C(!0),D(mt,null,jr(Tr.value,(G,fn)=>(C(),D("col",{key:"c"+fn,class:"col-event"}))),128)),g[98]||(g[98]=d("col",{class:"col-right"},null,-1))]),g[102]||(g[102]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(C(!0),D(mt,null,jr(tr.value,G=>{var fn;return C(),D("tr",{key:G.id,class:cn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":G.id===O.value,"preferred-player":ws.value.has(G.id)}]),"data-player-id":G.id},[d("td",xz,[d("div",Iz,[ws.value.has(G.id)?(C(),D("span",Ez," ⭐ ")):Da(G.id)?(C(),D("span",Tz," 🔒 ")):ie("",!0),d("div",{onClick:Pr=>Jf(G),class:cn(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":ze.value===3&&G.id===(L.value||((fn=tr.value[0])==null?void 0:fn.id))}]),title:"Cliquez pour voir les détails : "+G.name},[d("span",Sz,ee(G.name),1)],10,Az)])]),(C(!0),D(mt,null,jr(Tr.value,Pr=>{var Sy,Py,Ry;return C(),D("td",{key:Pr.id,"data-event-id":Pr.id,class:cn(["p-0",Pr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":ze.value===2&&G.id===(L.value||((Sy=tr.value[0])==null?void 0:Sy.id))&&Pr.id===(U.value||((Py=Tr.value[0])==null?void 0:Py.id))}])},[Be(zb,{"player-name":G.name,"event-id":Pr.id,"is-available":pr(G.name,Pr.id),"is-selected":du(G.name,Pr.id),"chance-percent":((Ry=xi.value[G.name])==null?void 0:Ry[Pr.id])??null,"show-selected-chance":mu(Pr.id),disabled:Pr.archived===!0,onToggle:xs},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,Pz)}),128)),g[99]||(g[99]=d("td",{class:"p-3 md:p-4"},null,-1))],10,wz)}),128)),d("tr",Rz,[d("td",Cz,[d("div",kz,[d("button",{onClick:g[18]||(g[18]=G=>x.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},g[100]||(g[100]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),d("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(C(!0),D(mt,null,jr(Tr.value,G=>(C(),D("td",{key:"add-row-"+G.id,"data-event-id":G.id,class:cn(["p-3 md:p-5",G.archived?"archived-col":""])},null,10,Dz))),128)),g[101]||(g[101]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[dp,!ys.value]])])]),ys.value?(C(),D("div",Nz,[d("div",Oz,[g[103]||(g[103]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",Vz,ee(Wr.value)+"…",1),d("div",Mz,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Ur({width:Gr.value+"%"})},null,4)]),d("p",Lz,ee(Gr.value)+"%",1)])])):ie("",!0),ys.value?ie("",!0):(C(),Js(Jq,{key:1,"season-id":o.value,"season-slug":Br(s),"players-count":pt.value.length,"events-count":Xe.value.length,"onboarding-done":((M=a.value)==null?void 0:M.onboardingCreatorDone)===!0,onCreateEvent:Jt,onAddPlayer:g[19]||(g[19]=()=>{x.value=!0}),onCopyLink:md,onDismissed:qf},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ie("",!0),Me.value?(C(),D("div",$z,[d("div",Fz,[g[104]||(g[104]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,ee(at.value),1)])])):ie("",!0),Cn.value?(C(),D("div",Uz,[d("div",jz,[g[105]||(g[105]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,ee(Ms.value),1)])])):ie("",!0),Na.value?(C(),D("div",Bz,[d("div",qz,[g[111]||(g[111]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),d("div",zz,[g[106]||(g[106]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),st(d("input",{"onUpdate:modelValue":g[20]||(g[20]=G=>bi.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Lt,bi.value]])]),d("div",Hz,[g[107]||(g[107]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),st(d("input",{"onUpdate:modelValue":g[21]||(g[21]=G=>rs.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Lt,rs.value]])]),d("div",Kz,[g[108]||(g[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),st(d("textarea",{"onUpdate:modelValue":g[22]||(g[22]=G=>_s.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Lt,_s.value]])]),d("div",Gz,[st(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":g[23]||(g[23]=G=>bs.value=G),class:"w-4 h-4"},null,512),[[Hi,bs.value]]),g[109]||(g[109]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",Wz,[g[110]||(g[110]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),st(d("input",{"onUpdate:modelValue":g[24]||(g[24]=G=>wi.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Lt,wi.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:au,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:bo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ie("",!0),x.value?(C(),D("div",Qz,[d("div",Jz,[g[113]||(g[113]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),d("div",Yz,[g[112]||(g[112]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),st(d("input",{"onUpdate:modelValue":g[25]||(g[25]=G=>I.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Lt,I.value]])]),d("div",Xz,[d("button",{onClick:g[26]||(g[26]=G=>x.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:Kf,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ie("",!0),c.value?(C(),D("div",Zz,[d("div",e8,[g[114]||(g[114]=ir('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),d("div",t8,[d("button",{onClick:Hf,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:g[27]||(g[27]=()=>_i()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ie("",!0),u.value?(C(),D("div",n8,[d("div",r8,[g[115]||(g[115]=ir('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),d("div",s8,[d("button",{onClick:y,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:g[28]||(g[28]=()=>p()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ie("",!0),A.value?(C(),D("div",i8,[d("div",o8,[d("div",a8,[g[116]||(g[116]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),g[117]||(g[117]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",l8,[_.value&&At.value[_.value]&&At.value[_.value].every(G=>pr(G,_.value))?(C(),D("span",u8,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(C(),D("span",c8,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:J,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:B,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ie("",!0),H.value?(C(),D("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Qf},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:g[42]||(g[42]=ft(()=>{},["stop"]))},[d("div",d8,[d("button",{onClick:Qf,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",h8,[g[123]||(g[123]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",f8,[d("div",p8,[d("h2",m8,ee((Q=K.value)==null?void 0:Q.title),1),d("div",g8,[g[118]||(g[118]=d("span",{class:"text-blue-300"},"👥",-1)),d("span",v8,ee(((oe=K.value)==null?void 0:oe.playerCount)||6)+" joueurs",1)])]),d("div",y8,[d("p",_8,ee(pu((he=K.value)==null?void 0:he.date)),1),d("div",b8,[d("button",{onClick:g[29]||(g[29]=G=>vi()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},g[119]||(g[119]=[d("span",null,"📅",-1),d("span",null,"Agenda",-1)])),Ue.value?(C(),D("div",w8,[d("div",x8,[d("button",{onClick:g[30]||(g[30]=G=>{Ua("google"),re()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},g[120]||(g[120]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:g[31]||(g[31]=G=>{Ua("outlook"),re()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},g[121]||(g[121]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:g[32]||(g[32]=G=>{Ua("ics"),re()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},g[122]||(g[122]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):ie("",!0)])]),(le=K.value)!=null&&le.description?(C(),D("div",I8,ee(K.value.description),1)):ie("",!0)])])]),d("div",E8,[d("div",T8,[d("div",A8,[d("div",S8,ee(wo((ke=K.value)==null?void 0:ke.id)),1),g[124]||(g[124]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",P8,[d("div",R8,ee(xo((Ze=K.value)==null?void 0:Ze.id)),1),g[125]||(g[125]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",C8,[d("div",k8,ee(Math.max((((ht=K.value)==null?void 0:ht.playerCount)||6)-xo((Nt=K.value)==null?void 0:Nt.id),0)),1),g[126]||(g[126]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),K.value?(C(),D("div",D8,[d("div",N8,[Wf.value?(C(),D("div",{key:0,class:cn(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((un=Oa.value)==null?void 0:un.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:cu.value},[g[127]||(g[127]=d("span",null,"⚠️",-1)),d("span",V8,ee(cu.value),1)],10,O8)):ie("",!0),st(d("select",{"onUpdate:modelValue":g[33]||(g[33]=G=>Ii.value=G),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},g[128]||(g[128]=[ir('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[iR,Ii.value]])]),d("div",M8,[(C(!0),D(mt,null,jr(yd.value,G=>{var fn,Pr;return C(),D("div",{key:G.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",L8,[ws.value.has(G.id)?(C(),D("span",$8," ⭐ ")):Da(G.id)?(C(),D("span",F8," 🔒 ")):ie("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:G.name},ee(G.name),9,U8)]),d("div",j8,[Be(zb,{"player-name":G.name,"event-id":K.value.id,"is-available":Xf(K.value.id)[G.name],"is-selected":A1(G.name,K.value.id),"chance-percent":((fn=xi.value[G.name])==null?void 0:fn[K.value.id])??null,"show-selected-chance":mu(K.value.id),disabled:((Pr=K.value)==null?void 0:Pr.archived)===!0,compact:!0,onToggle:T1},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ie("",!0),d("div",B8,[d("button",{onClick:g[34]||(g[34]=G=>Eo(K.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},g[129]||(g[129]=[d("span",null,"🎭",-1),d("span",null,"Sélectionner",-1)])),d("button",{onClick:g[35]||(g[35]=G=>bd(K.value)),disabled:(wn=K.value)==null?void 0:wn.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(xn=K.value)!=null&&xn.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[130]||(g[130]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,q8),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:ye},[d("button",{onClick:g[36]||(g[36]=G=>Kr()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},g[131]||(g[131]=[d("span",null,"⋯",-1),d("span",null,"Plus",-1)]))],512),d("button",{onClick:iy,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(C(),Js(oc,{to:"body"},[me.value?(C(),D("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:pe,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Ur(Ve.value)},[d("button",{onClick:g[37]||(g[37]=G=>{oy(),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},g[132]||(g[132]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:g[38]||(g[38]=G=>{ay(),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(Ot=K.value)!=null&&Ot.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,ee((Fr=K.value)!=null&&Fr.archived?"📂":"📁"),1),d("span",null,ee((is=K.value)!=null&&is.archived?"Désarchiver":"Archiver"),1)],8,z8),d("button",{onClick:g[39]||(g[39]=G=>{var fn;iu((fn=K.value)==null?void 0:fn.id),me.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[133]||(g[133]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)]))])]),d("div",H8,[d("button",{onClick:g[40]||(g[40]=G=>Eo(K.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),d("button",{onClick:iy,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:g[41]||(g[41]=G=>Os()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ie("",!0),(C(),Js(oc,{to:"body"},[ge.value?(C(),D("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Te,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Ur(Ce.value)},[d("button",{onClick:g[43]||(g[43]=G=>{bd(K.value),ge.value=!1}),disabled:(To=K.value)==null?void 0:To.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(ja=K.value)!=null&&ja.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[134]||(g[134]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,K8),d("button",{onClick:g[44]||(g[44]=G=>{oy(),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},g[135]||(g[135]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:g[45]||(g[45]=G=>{ay(),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,ee((py=K.value)!=null&&py.archived?"📂":"📁"),1),d("span",null,ee((my=K.value)!=null&&my.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:g[46]||(g[46]=G=>{var fn;iu((fn=K.value)==null?void 0:fn.id),ge.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[136]||(g[136]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):ie("",!0)])),Be(ry,{show:j.value,player:_e.value,seasonId:o.value,onClose:g[47]||(g[47]=G=>j.value=!1),onVerified:S1},null,8,["show","player","seasonId"]),f.value?(C(),D("div",G8,[d("div",W8,[g[142]||(g[142]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),d("div",Q8,[g[137]||(g[137]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),st(d("input",{"onUpdate:modelValue":g[48]||(g[48]=G=>m.value=G),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[rr(Er,["esc"]),rr(ou,["enter"])],ref:"editTitleInput"},null,544),[[Lt,m.value]])]),d("div",J8,[g[138]||(g[138]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),st(d("input",{"onUpdate:modelValue":g[49]||(g[49]=G=>v.value=G),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[rr(Er,["esc"]),rr(ou,["enter"])]},null,544),[[Lt,v.value]])]),d("div",Y8,[g[139]||(g[139]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),st(d("textarea",{"onUpdate:modelValue":g[50]||(g[50]=G=>Z.value=G),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:rr(Er,["esc"])},null,544),[[Lt,Z.value]])]),d("div",X8,[st(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":g[51]||(g[51]=G=>ue.value=G),class:"w-4 h-4"},null,512),[[Hi,ue.value]]),g[140]||(g[140]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),d("div",Z8,[g[141]||(g[141]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),st(d("input",{"onUpdate:modelValue":g[52]||(g[52]=G=>w.value=G),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:rr(Er,["esc"])},null,544),[[Lt,w.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:Er,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ou,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ie("",!0),Be(qA,{show:V.value,message:Ie(),error:Ke.value,"session-info":I1(),onSubmit:Et,onCancel:Fn},null,8,["show","message","error","session-info"]),ut.value?(C(),D("div",eH,[d("div",tH,[g[144]||(g[144]=ir('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",nH,[d("div",rH,[d("div",null,[g[143]||(g[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),st(d("input",{"onUpdate:modelValue":g[53]||(g[53]=G=>Ae.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[54]||(g[54]=rr(G=>Mn(Ae.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Je},null,544),[[Lt,Ae.value]])])]),d("button",{onClick:g[55]||(g[55]=G=>Mn(Ae.value)),disabled:!Ae.value||fe.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[fe.value?(C(),D("span",iH,"⏳")):(C(),D("span",oH,"🔓")),d("span",null,ee(fe.value?"Vérification...":"Vérifier et supprimer"),1)],8,sH)]),d("div",aH,[d("button",{onClick:g[56]||(g[56]=G=>nt.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),Ge.value?(C(),D("div",lH,[d("div",uH,ee(Ge.value),1)])):ie("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:Ti,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ie("",!0),ae.value?(C(),D("div",cH,[d("div",dH,[g[147]||(g[147]=ir('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),d("div",hH,[d("div",fH,[d("div",null,[g[145]||(g[145]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),st(d("input",{"onUpdate:modelValue":g[57]||(g[57]=G=>dt.value=G),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[58]||(g[58]=rr(G=>Sr(dt.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:en},null,544),[[Lt,dt.value]])])]),d("div",pH,[d("button",{onClick:g[59]||(g[59]=G=>Y.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Ne.value?(C(),D("div",mH,[d("div",gH,ee(Ne.value),1)])):ie("",!0)]),d("div",vH,[d("button",{onClick:Fa,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:g[60]||(g[60]=G=>Sr(dt.value)),disabled:!dt.value||Pt.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Pt.value?(C(),D("span",_H,"⏳")):(C(),D("span",bH,"🔓")),d("span",null,[lt(ee(Pt.value?"Vérification...":"Vérifier"),1),g[146]||(g[146]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,yH)])])])):ie("",!0),Y.value?(C(),D("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[63]||(g[63]=G=>Y.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[62]||(g[62]=ft(()=>{},["stop"]))},[g[149]||(g[149]=ir('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",wH,[g[148]||(g[148]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:vu,disabled:xe.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[xe.value?(C(),D("span",IH,"⏳")):(C(),D("span",EH,"📧")),d("span",null,ee(xe.value?"Envoi...":"Envoyer l'email"),1)],8,xH)]),ve.value?(C(),D("div",TH,[d("div",AH,ee(ve.value),1)])):ie("",!0),Pe.value?(C(),D("div",SH,[d("div",PH,ee(Pe.value),1)])):ie("",!0),d("div",RH,[d("button",{onClick:g[61]||(g[61]=G=>Y.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),nt.value?(C(),D("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[66]||(g[66]=G=>nt.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[65]||(g[65]=ft(()=>{},["stop"]))},[g[151]||(g[151]=ir('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),d("div",CH,[g[150]||(g[150]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),d("button",{onClick:x1,disabled:vt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[vt.value?(C(),D("span",DH,"⏳")):(C(),D("span",NH,"📧")),d("span",null,ee(vt.value?"Envoi...":"Envoyer l'email"),1)],8,kH)]),P.value?(C(),D("div",OH,[d("div",VH,ee(P.value),1)])):ie("",!0),N.value?(C(),D("div",MH,[d("div",LH,ee(N.value),1)])):ie("",!0),d("div",$H,[d("button",{onClick:g[64]||(g[64]=G=>nt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ie("",!0),Be(KB,{ref_key:"playerModalRef",ref:$,show:T.value,player:k.value,stats:C1(k.value),seasonId:o.value,"onboarding-step":ze.value,"onboarding-player-id":L.value,"is-protected":k.value?Vr.value.has(k.value.id):!1,"is-preferred":k.value?ws.value.has(k.value.id):!1,onClose:ly,onUpdate:P1,onDelete:E,onRefresh:R1,onAdvanceOnboarding:g[67]||(g[67]=G=>{try{typeof ze.value<"u"&&(ze.value.value=G)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),Be(Lq,{ref_key:"selectionModalRef",ref:Rn,show:yt.value,event:Ut.value,"current-selection":At.value[(gy=Ut.value)==null?void 0:gy.id]||[],"available-count":wo((vy=Ut.value)==null?void 0:vy.id),"selected-count":xo((yy=Ut.value)==null?void 0:yy.id),"player-availability":Xf((_y=Ut.value)==null?void 0:_y.id),"season-id":o.value,"season-slug":Br(s),players:yi.value,onClose:dy,onSelection:N1,onPerfect:O1,onSendNotifications:cy,onUpdateSelection:V1},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),Be(_1,{show:Yn.value,event:ot.value,"season-id":o.value,"season-slug":Br(s),players:yi.value,sending:Yf.value,"availability-by-player":Xf((by=ot.value)==null?void 0:by.id),onClose:D1,onSendNotifications:cy},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),Be(Aj,{show:Zn.value,onClose:g[68]||(g[68]=G=>Zn.value=!1)},null,8,["show"]),Be(l1,{show:bn.value,"season-id":o.value,onClose:xa,onManagePlayer:eu,onChangePassword:Zl,onLogoutDevice:Ea,onDeleteAccount:dd},null,8,["show","season-id"]),Be(u1,{show:gs.value,onClose:Ia},null,8,["show"]),Be(c1,{show:Jl.value,onClose:cd,onManagePlayer:eu},null,8,["show"]),Be(x9,{show:We.value,"player-name":((wy=rt.value)==null?void 0:wy.playerName)||"","event-title":((xy=rt.value)==null?void 0:xy.eventTitle)||"","season-id":o.value,"season-slug":Br(s),"event-id":((Iy=rt.value)==null?void 0:Iy.eventId)||"",onClose:g[69]||(g[69]=G=>We.value=!1),onSuccess:L1},null,8,["show","player-name","event-title","season-id","season-slug","event-id"]),Be(F9,{show:an.value,"player-name":((Ey=Ht.value)==null?void 0:Ey.playerName)||"",email:((Ty=Ht.value)==null?void 0:Ty.email)||"","season-slug":Br(s),"event-id":((Ay=Ht.value)==null?void 0:Ay.eventId)||null,onClose:g[70]||(g[70]=G=>an.value=!1)},null,8,["show","player-name","email","season-slug","event-id"]),Be(b1,{show:vo.value,player:ud.value,"season-id":o.value,onClose:g[71]||(g[71]=G=>vo.value=!1),onSuccess:g[72]||(g[72]=()=>{vo.value=!1,bn.value=!0})},null,8,["show","player","season-id"]),Be(zA,{show:ms.value,onClose:g[73]||(g[73]=G=>ms.value=!1),onSuccess:g[74]||(g[74]=()=>{ms.value=!1,bn.value=!0})},null,8,["show"]),Rt.value?(C(),D("div",FH,[d("div",UH,[g[152]||(g[152]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),g[153]||(g[153]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),d("div",jH,[d("button",{onClick:g[75]||(g[75]=G=>bd(Xn.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:uy,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ie("",!0)],64)}}},BH={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},qH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},zH={key:0,class:"text-center py-8"},HH={key:1,class:"text-center py-8"},KH={class:"text-gray-300 mb-6"},GH={key:2,class:"space-y-6"},WH={class:"text-center"},QH={class:"text-gray-300 mb-4"},JH={class:"font-semibold text-white"},YH={class:"space-y-4"},XH=["disabled"],ZH={key:0,class:"animate-spin"},eK={key:1},tK={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},nK={class:"text-red-300 text-sm"},rK={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},sK={class:"text-green-300 text-sm"},iK={__name:"PasswordReset",setup(n){const e=_a(),t=ya(),r=S(!0),s=S(""),i=S(""),o=S(""),a=S(""),l=S(""),c=S(!1),h=S(""),f=S(""),m=qe(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Tn(async()=>{try{const{oobCode:I}=e.query;if(F.debug("Token reçu (masqué)"),!I){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=I;try{F.debug("Vérification du token et récupération de l'email...");const O=await wL(je,I);i.value=O,F.info("Email récupéré depuis le token:",O)}catch(O){F.error("Erreur lors de la vérification du token:",O),s.value="Lien de réinitialisation invalide ou expiré",r.value=!1;return}r.value=!1}catch(I){F.error("Erreur lors de la vérification du lien",I),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function v(){if(m.value){c.value=!0,h.value="",f.value="";try{F.debug("Début réinitialisation avec token (masqué)"),await _L(je,o.value,a.value),F.info("Mot de passe Firebase Auth mis à jour"),F.info("Réinitialisation terminée avec Firebase Auth");try{F.debug("Tentative de connexion automatique...");const I=await rA(je,i.value,a.value);F.info("Connexion automatique réussie après reset",{uid:I.user.uid}),f.value="Mot de passe réinitialisé et connexion réussie ! Redirection...",setTimeout(()=>{w()},2e3)}catch(I){F.error("Erreur lors de la connexion automatique",I),f.value="Mot de passe réinitialisé ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{w()},3e3)}}catch(I){F.error("Erreur lors de la réinitialisation",I),I.code==="auth/weak-password"?h.value="Le mot de passe doit contenir au moins 6 caractères":I.code==="auth/invalid-action-code"?h.value="Lien de réinitialisation invalide ou expiré":h.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function w(){const{returnTo:I}=e.query;I&&x(I)?(F.info("Redirection vers la page spécifiée:",I),t.push(I)):(F.info("Aucun paramètre de retour valide, redirection vers les saisons"),t.push("/seasons"))}function x(I){return!(!I||["/reset-password","/magic","/join"].some(L=>I.startsWith(L))||I===window.location.pathname)}return(I,O)=>(C(),D("div",BH,[d("div",qH,[O[8]||(O[8]=ir('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(C(),D("div",zH,O[2]||(O[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(C(),D("div",HH,[O[3]||(O[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),O[4]||(O[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",KH,ee(s.value),1),d("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):o.value?(C(),D("div",GH,[d("div",WH,[d("p",QH,[O[5]||(O[5]=lt(" Réinitialisation pour ")),d("span",JH,ee(i.value),1)])]),d("div",YH,[d("div",null,[O[6]||(O[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),st(d("input",{"onUpdate:modelValue":O[0]||(O[0]=L=>a.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:rr(v,["enter"])},null,544),[[Lt,a.value]])]),d("div",null,[O[7]||(O[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),st(d("input",{"onUpdate:modelValue":O[1]||(O[1]=L=>l.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:rr(v,["enter"])},null,544),[[Lt,l.value]])])]),d("button",{onClick:v,disabled:!m.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(C(),D("span",ZH,"⏳")):(C(),D("span",eK,"🔑")),d("span",null,ee(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,XH),h.value?(C(),D("div",tK,[d("div",nK,ee(h.value),1)])):ie("",!0),f.value?(C(),D("div",rK,[d("div",sK,ee(f.value),1)])):ie("",!0)])):ie("",!0)])]))}},oK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},aK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},lK={class:"text-3xl"},uK={class:"text-2xl font-bold text-white mb-2"},cK={class:"text-gray-300 mb-6"},dK={__name:"MagicLink",setup(n){const e=_a(),t=ya(),r=S("loading"),s=S("Traitement en cours..."),i=S("Merci de patienter pendant la validation du lien."),o=qe(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return Tn(async()=>{var l,c;try{ny("firebase");const h=String(e.query.sid||""),f=String(e.query.pid||"");let m=String(e.query.eid||"");const v=String(e.query.t||""),w=String(e.query.a||""),x=String(e.query.slug||"");if(!v||!w){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(w==="account_email_update"){const te=await WA({token:v});if(!te.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await TL(je.currentUser,te.data.newEmail),await QA({token:v}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(w==="verify_email"&&(m="protection"),!(await KA({seasonId:h,playerId:f,eventId:m,token:v,action:w})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(w==="verify_email"){await t1({playerId:f,seasonId:h});try{await o1({playerId:f,seasonId:h})}catch{}await Lm({seasonId:h,playerId:f,eventId:"protection",action:w}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(x?()=>t.push(`/season/${x}?player=${encodeURIComponent(f)}&verified=1`):()=>t.push("/seasons"),800);return}if(w==="activate_notifications"){try{const{processNotificationActivation:te}=await xt(()=>Promise.resolve().then(()=>y1),void 0),X=await te(v);if(X.success)r.value="ok",s.value="Notifications activées !",(l=X.accountStatus)!=null&&l.created?i.value=`Parfait ! Tes notifications sont maintenant actives pour ${X.playerName}. Un compte a été créé avec ton email et tu recevras un email pour définir ton mot de passe.`:i.value=`Parfait ! Tes notifications sont maintenant actives pour ${X.playerName}. Tu recevras des alertes pour tes événements.`,i.value+=`

💡 Conseil : Pour une meilleure expérience, tu peux créer un mot de passe pour ton compte et te connecter directement à l'avenir.`,x&&m?t.push(`/season/${x}/event/${m}?notificationSuccess=1&email=${encodeURIComponent(X.email)}&playerName=${encodeURIComponent(X.playerName)}`):x?t.push(`/season/${x}?notificationSuccess=1&email=${encodeURIComponent(X.email)}&playerName=${encodeURIComponent(X.playerName)}`):t.push("/seasons");else throw new Error("Échec de l'activation des notifications")}catch(te){F.error("Erreur lors de l'activation des notifications",te),r.value="error",s.value="Erreur d'activation",i.value="Impossible d'activer tes notifications. Veuillez réessayer."}return}const O=be(se,"seasons",h,"players",f),L=await Wt(O),U=L.exists()&&L.data().name||"";if(!U){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await mU({seasonId:h,playerName:U,eventId:m,value:w==="yes"}),w==="no")try{const te=be(se,"seasons",h,"selections",m),X=await Wt(te);if(X.exists()){const A=Array.isArray((c=X.data())==null?void 0:c.players)?X.data().players:[],_=A.filter(T=>T!==U);_.length!==A.length&&await setDoc(te,{players:_},{merge:!0})}}catch{}await Lm({seasonId:h,playerId:f,eventId:m,action:w}),r.value="ok",s.value="Merci !",i.value=w==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(x?()=>t.push(`/season/${x}/event/${m}`):()=>t.push("/seasons"),1200)}catch(h){F.error("Magic link error",h),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(C(),D("div",oK,[d("div",aK,[d("div",{class:cn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",lK,ee(o.value),1)],2),d("h1",uK,ee(s.value),1),d("p",cK,ee(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},hK={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},fK={class:"text-center py-12 px-4"},pK={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},mK={class:"container mx-auto px-4 pb-16"},gK={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},vK={class:"space-y-5"},yK=["onKeydown"],_K={class:"flex items-center justify-end gap-3 pt-2"},bK=["disabled"],wK={key:0,class:"mt-6 text-sm text-gray-200"},xK={__name:"JoinSeason",setup(n){const e=_a(),t=ya(),r=e.params.slug,s=S(""),i=S(""),o=S(""),a=S(!1),l=S("");Tn(async()=>{const f=Sc(tt(se,"seasons"),Ch("slug","==",r)),m=await $t(f);if(m.empty)l.value="Saison introuvable";else{const v=m.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function h(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await h1(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){F.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,m)=>(C(),D("div",hK,[d("div",fK,[d("h1",pK,ee(i.value||"Rejoindre la saison"),1),m[1]||(m[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",mK,[d("div",gK,[m[3]||(m[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",vK,[d("div",null,[m[2]||(m[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),st(d("input",{"onUpdate:modelValue":m[0]||(m[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:rr(ft(h,["prevent"]),["enter"])},null,40,yK),[[Lt,o.value]])]),d("div",_K,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:h,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,bK)])]),l.value?(C(),D("div",wK,ee(l.value),1)):ie("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const IK=[{path:"/",component:G$},{path:"/seasons",component:D5},{path:"/season/:slug",component:Hb,props:!0},{path:"/season/:slug/event/:eventId",component:Hb,props:!0},{path:"/season/:slug/join",component:xK,props:!0},{path:"/reset-password",component:iK},{path:"/magic",component:dK}],EK=T$({history:e$("/"),routes:IK});let el;window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),el=n,console.log("Événement beforeinstallprompt capturé")});window.addEventListener("appinstalled",n=>{console.log("Application installée"),el=null});window.triggerInstall=()=>{el&&(el.prompt(),el.userChoice.then(n=>{n.outcome==="accepted"?console.log("Utilisateur a accepté l'installation"):console.log("Utilisateur a refusé l'installation"),el=null}))};window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches&&console.log("Application déjà installée en mode standalone");const w1=dR(I3);w1.use(EK);w1.mount("#app");R$({immediate:!0,onRegistered(n){window.__swReg=n}});export{tt as $,uT as A,oa as B,Ds as C,Sn as D,PG as E,da as F,ov as G,SG as H,RK as I,es as J,xO as K,EO as L,ma as M,tG as N,nG as O,QO as P,Jn as Q,KK as R,OK as S,dn as T,_G as U,yf as V,KO as W,WO as X,eG as Y,LK as Z,Zx as _,Ec as a,rd as a$,DK as a0,IO as a1,VO as a2,AG as a3,kl as a4,yG as a5,UK as a6,TG as a7,be as a8,zK as a9,qK as aA,lG as aB,uG as aC,HK as aD,NO as aE,pG as aF,mG as aG,zO as aH,Sc as aI,QE as aJ,NK as aK,vG as aL,xr as aM,on as aN,xG as aO,TK as aP,rG as aQ,JK as aR,QK as aS,ZK as aT,jK as aU,go as aV,wG as aW,$K as aX,Ch as aY,vv as aZ,OG as a_,AO as aa,MK as ab,FK as ac,EG as ad,XK as ae,YK as af,hn as ag,Zc as ah,LO as ai,cG as aj,Wt as ak,sG as al,iG as am,$t as an,oG as ao,aG as ap,TO as aq,IG as ar,bG as as,VK as at,GK as au,WK as av,BK as aw,dG as ax,fG as ay,hG as az,SO as b,XT as b$,nd as b0,MG as b1,kc as b2,ga as b3,ji as b4,CG as b5,qi as b6,Bi as b7,li as b8,nh as b9,IM as bA,n7 as bB,m7 as bC,rb as bD,t4 as bE,zM as bF,JG as bG,qG as bH,mL as bI,o7 as bJ,d7 as bK,p7 as bL,r7 as bM,VL as bN,NL as bO,$G as bP,hM as bQ,gL as bR,a7 as bS,c7 as bT,f7 as bU,AM as bV,e7 as bW,KG as bX,yL as bY,BG as bZ,DL as b_,NG as ba,Wo as bb,hl as bc,s3 as bd,kG as be,s7 as bf,Pm as bg,DG as bh,i3 as bi,zv as bj,zi as bk,jG as bl,OL as bm,lA as bn,r3 as bo,cA as bp,bL as bq,_L as br,KM as bs,xL as bt,VG as bu,t7 as bv,HG as bw,QG as bx,h3 as by,LG as bz,Rl as c,Nv as c0,UG as c1,rA as c2,zG as c3,i7 as c4,u7 as c5,h7 as c6,ML as c7,FG as c8,ZG as c9,TL as ca,AL as cb,l7 as cc,WG as cd,XG as ce,YG as cf,GG as cg,wL as ch,ha as d,zt as e,de as f,Kl as g,Yc as h,Zd as i,Tf as j,Xc as k,If as l,mv as m,Cl as n,Ef as o,Bo as p,GO as q,mn as r,Xo as s,Se as t,SK as u,m2 as v,rn as w,RG as x,gt as y,AK as z};
