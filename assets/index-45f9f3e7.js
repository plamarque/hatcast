(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function dp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const At={},sa=[],Rr=()=>{},yE=()=>!1,Vd=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),hp=n=>n.startsWith("onUpdate:"),In=Object.assign,fp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},_E=Object.prototype.hasOwnProperty,_t=(n,e)=>_E.call(n,e),Fe=Array.isArray,ia=n=>Au(n)==="[object Map]",Nd=n=>Au(n)==="[object Set]",cg=n=>Au(n)==="[object Date]",Ke=n=>typeof n=="function",an=n=>typeof n=="string",Qr=n=>typeof n=="symbol",kt=n=>n!==null&&typeof n=="object",Zy=n=>(kt(n)||Ke(n))&&Ke(n.then)&&Ke(n.catch),e_=Object.prototype.toString,Au=n=>e_.call(n),bE=n=>Au(n).slice(8,-1),t_=n=>Au(n)==="[object Object]",pp=n=>an(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Fl=dp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Od=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},wE=/-(\w)/g,br=Od(n=>n.replace(wE,(e,t)=>t?t.toUpperCase():"")),IE=/\B([A-Z])/g,Ti=Od(n=>n.replace(IE,"-$1").toLowerCase()),Md=Od(n=>n.charAt(0).toUpperCase()+n.slice(1)),Lh=Od(n=>n?`on${Md(n)}`:""),ai=(n,e)=>!Object.is(n,e),Oc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},vf=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},yf=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let dg;const Ld=()=>dg||(dg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Xs(n){if(Fe(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=an(r)?AE(r):Xs(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(an(n)||kt(n))return n}const EE=/;(?![^(]*\))/g,TE=/:([^]+)/,xE=/\/\*[^]*?\*\//g;function AE(n){const e={};return n.replace(xE,"").split(EE).forEach(t=>{if(t){const r=t.split(TE);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Hn(n){let e="";if(an(n))e=n;else if(Fe(n))for(let t=0;t<n.length;t++){const r=Hn(n[t]);r&&(e+=r+" ")}else if(kt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const SE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",PE=dp(SE);function n_(n){return!!n||n===""}function RE(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Fd(n[r],e[r]);return t}function Fd(n,e){if(n===e)return!0;let t=cg(n),r=cg(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Qr(n),r=Qr(e),t||r)return n===e;if(t=Fe(n),r=Fe(e),t||r)return t&&r?RE(n,e):!1;if(t=kt(n),r=kt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Fd(n[o],e[o]))return!1}}return String(n)===String(e)}function r_(n,e){return n.findIndex(t=>Fd(t,e))}const s_=n=>!!(n&&n.__v_isRef===!0),ie=n=>an(n)?n:n==null?"":Fe(n)||kt(n)&&(n.toString===e_||!Ke(n.toString))?s_(n)?ie(n.value):JSON.stringify(n,i_,2):String(n),i_=(n,e)=>s_(e)?i_(n,e.value):ia(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Fh(r,i)+" =>"]=s,t),{})}:Nd(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Fh(t))}:Qr(e)?Fh(e):kt(e)&&!Fe(e)&&!t_(e)?String(e):e,Fh=(n,e="")=>{var t;return Qr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Zn;class CE{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Zn,!e&&Zn&&(this.index=(Zn.scopes||(Zn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Zn;try{return Zn=this,e()}finally{Zn=t}}}on(){++this._on===1&&(this.prevScope=Zn,Zn=this)}off(){this._on>0&&--this._on===0&&(Zn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function kE(){return Zn}let Rt;const $h=new WeakSet;class o_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Zn&&Zn.active&&Zn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,$h.has(this)&&($h.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||l_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,hg(this),u_(this);const e=Rt,t=Cr;Rt=this,Cr=!0;try{return this.fn()}finally{c_(this),Rt=e,Cr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)vp(e);this.deps=this.depsTail=void 0,hg(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?$h.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){_f(this)&&this.run()}get dirty(){return _f(this)}}let a_=0,$l,Ul;function l_(n,e=!1){if(n.flags|=8,e){n.next=Ul,Ul=n;return}n.next=$l,$l=n}function mp(){a_++}function gp(){if(--a_>0)return;if(Ul){let e=Ul;for(Ul=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;$l;){let e=$l;for($l=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function u_(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function c_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),vp(r),DE(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function _f(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(d_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function d_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===eu)||(n.globalVersion=eu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!_f(n))))return;n.flags|=2;const e=n.dep,t=Rt,r=Cr;Rt=n,Cr=!0;try{u_(n);const s=n.fn(n._value);(e.version===0||ai(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Rt=t,Cr=r,c_(n),n.flags&=-3}}function vp(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)vp(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function DE(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Cr=!0;const h_=[];function ws(){h_.push(Cr),Cr=!1}function Is(){const n=h_.pop();Cr=n===void 0?!0:n}function hg(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Rt;Rt=void 0;try{e()}finally{Rt=t}}}let eu=0;class VE{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class yp{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Rt||!Cr||Rt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Rt)t=this.activeLink=new VE(Rt,this),Rt.deps?(t.prevDep=Rt.depsTail,Rt.depsTail.nextDep=t,Rt.depsTail=t):Rt.deps=Rt.depsTail=t,f_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Rt.depsTail,t.nextDep=void 0,Rt.depsTail.nextDep=t,Rt.depsTail=t,Rt.deps===t&&(Rt.deps=r)}return t}trigger(e){this.version++,eu++,this.notify(e)}notify(e){mp();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{gp()}}}function f_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)f_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const bf=new WeakMap,so=Symbol(""),wf=Symbol(""),tu=Symbol("");function Nn(n,e,t){if(Cr&&Rt){let r=bf.get(n);r||bf.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new yp),s.map=r,s.key=t),s.track()}}function fs(n,e,t,r,s,i){const o=bf.get(n);if(!o){eu++;return}const a=l=>{l&&l.trigger()};if(mp(),e==="clear")o.forEach(a);else{const l=Fe(n),c=l&&pp(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===tu||!Qr(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(tu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(so)),ia(n)&&a(o.get(wf)));break;case"delete":l||(a(o.get(so)),ia(n)&&a(o.get(wf)));break;case"set":ia(n)&&a(o.get(so));break}}gp()}function Go(n){const e=yt(n);return e===n?e:(Nn(e,"iterate",tu),_r(n)?e:e.map(Tn))}function $d(n){return Nn(n=yt(n),"iterate",tu),n}const NE={__proto__:null,[Symbol.iterator](){return Uh(this,Symbol.iterator,Tn)},concat(...n){return Go(this).concat(...n.map(e=>Fe(e)?Go(e):e))},entries(){return Uh(this,"entries",n=>(n[1]=Tn(n[1]),n))},every(n,e){return cs(this,"every",n,e,void 0,arguments)},filter(n,e){return cs(this,"filter",n,e,t=>t.map(Tn),arguments)},find(n,e){return cs(this,"find",n,e,Tn,arguments)},findIndex(n,e){return cs(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return cs(this,"findLast",n,e,Tn,arguments)},findLastIndex(n,e){return cs(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return cs(this,"forEach",n,e,void 0,arguments)},includes(...n){return jh(this,"includes",n)},indexOf(...n){return jh(this,"indexOf",n)},join(n){return Go(this).join(n)},lastIndexOf(...n){return jh(this,"lastIndexOf",n)},map(n,e){return cs(this,"map",n,e,void 0,arguments)},pop(){return bl(this,"pop")},push(...n){return bl(this,"push",n)},reduce(n,...e){return fg(this,"reduce",n,e)},reduceRight(n,...e){return fg(this,"reduceRight",n,e)},shift(){return bl(this,"shift")},some(n,e){return cs(this,"some",n,e,void 0,arguments)},splice(...n){return bl(this,"splice",n)},toReversed(){return Go(this).toReversed()},toSorted(n){return Go(this).toSorted(n)},toSpliced(...n){return Go(this).toSpliced(...n)},unshift(...n){return bl(this,"unshift",n)},values(){return Uh(this,"values",Tn)}};function Uh(n,e,t){const r=$d(n),s=r[e]();return r!==n&&!_r(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const OE=Array.prototype;function cs(n,e,t,r,s,i){const o=$d(n),a=o!==n&&!_r(n),l=o[e];if(l!==OE[e]){const f=l.apply(n,i);return a?Tn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Tn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function fg(n,e,t,r){const s=$d(n);let i=t;return s!==n&&(_r(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Tn(a),l,n)}),s[e](i,...r)}function jh(n,e,t){const r=yt(n);Nn(r,"iterate",tu);const s=r[e](...t);return(s===-1||s===!1)&&wp(t[0])?(t[0]=yt(t[0]),r[e](...t)):s}function bl(n,e,t=[]){ws(),mp();const r=yt(n)[e].apply(n,t);return gp(),Is(),r}const ME=dp("__proto__,__v_isRef,__isVue"),p_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Qr));function LE(n){Qr(n)||(n=String(n));const e=yt(this);return Nn(e,"has",n),e.hasOwnProperty(n)}class m_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?HE:__:i?y_:v_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Fe(e);if(!s){let l;if(o&&(l=NE[t]))return l;if(t==="hasOwnProperty")return LE}const a=Reflect.get(e,t,Ln(e)?e:r);return(Qr(t)?p_.has(t):ME(t))||(s||Nn(e,"get",t),i)?a:Ln(a)?o&&pp(t)?a:a.value:kt(a)?s?w_(a):Ud(a):a}}class g_ extends m_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=pi(i);if(!_r(r)&&!pi(r)&&(i=yt(i),r=yt(r)),!Fe(e)&&Ln(i)&&!Ln(r))return l?!1:(i.value=r,!0)}const o=Fe(e)&&pp(t)?Number(t)<e.length:_t(e,t),a=Reflect.set(e,t,r,Ln(e)?e:s);return e===yt(s)&&(o?ai(r,i)&&fs(e,"set",t,r):fs(e,"add",t,r)),a}deleteProperty(e,t){const r=_t(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&fs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Qr(t)||!p_.has(t))&&Nn(e,"has",t),r}ownKeys(e){return Nn(e,"iterate",Fe(e)?"length":so),Reflect.ownKeys(e)}}class FE extends m_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const $E=new g_,UE=new FE,jE=new g_(!0);const If=n=>n,Ic=n=>Reflect.getPrototypeOf(n);function BE(n,e,t){return function(...r){const s=this.__v_raw,i=yt(s),o=ia(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?If:e?ed:Tn;return!e&&Nn(i,"iterate",l?wf:so),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function Ec(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function qE(n,e){const t={get(s){const i=this.__v_raw,o=yt(i),a=yt(s);n||(ai(s,a)&&Nn(o,"get",s),Nn(o,"get",a));const{has:l}=Ic(o),c=e?If:n?ed:Tn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Nn(yt(s),"iterate",so),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=yt(i),a=yt(s);return n||(ai(s,a)&&Nn(o,"has",s),Nn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=yt(a),c=e?If:n?ed:Tn;return!n&&Nn(l,"iterate",so),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return In(t,n?{add:Ec("add"),set:Ec("set"),delete:Ec("delete"),clear:Ec("clear")}:{add(s){!e&&!_r(s)&&!pi(s)&&(s=yt(s));const i=yt(this);return Ic(i).has.call(i,s)||(i.add(s),fs(i,"add",s,s)),this},set(s,i){!e&&!_r(i)&&!pi(i)&&(i=yt(i));const o=yt(this),{has:a,get:l}=Ic(o);let c=a.call(o,s);c||(s=yt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?ai(i,d)&&fs(o,"set",s,i):fs(o,"add",s,i),this},delete(s){const i=yt(this),{has:o,get:a}=Ic(i);let l=o.call(i,s);l||(s=yt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&fs(i,"delete",s,void 0),c},clear(){const s=yt(this),i=s.size!==0,o=s.clear();return i&&fs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=BE(s,n,e)}),t}function _p(n,e){const t=qE(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(_t(t,s)&&s in r?t:r,s,i)}const zE={get:_p(!1,!1)},GE={get:_p(!1,!0)},KE={get:_p(!0,!1)};const v_=new WeakMap,y_=new WeakMap,__=new WeakMap,HE=new WeakMap;function WE(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function QE(n){return n.__v_skip||!Object.isExtensible(n)?0:WE(bE(n))}function Ud(n){return pi(n)?n:bp(n,!1,$E,zE,v_)}function b_(n){return bp(n,!1,jE,GE,y_)}function w_(n){return bp(n,!0,UE,KE,__)}function bp(n,e,t,r,s){if(!kt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=QE(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function oa(n){return pi(n)?oa(n.__v_raw):!!(n&&n.__v_isReactive)}function pi(n){return!!(n&&n.__v_isReadonly)}function _r(n){return!!(n&&n.__v_isShallow)}function wp(n){return n?!!n.__v_raw:!1}function yt(n){const e=n&&n.__v_raw;return e?yt(e):n}function JE(n){return!_t(n,"__v_skip")&&Object.isExtensible(n)&&vf(n,"__v_skip",!0),n}const Tn=n=>kt(n)?Ud(n):n,ed=n=>kt(n)?w_(n):n;function Ln(n){return n?n.__v_isRef===!0:!1}function N(n){return I_(n,!1)}function YE(n){return I_(n,!0)}function I_(n,e){return Ln(n)?n:new XE(n,e)}class XE{constructor(e,t){this.dep=new yp,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:yt(e),this._value=t?e:Tn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||_r(e)||pi(e);e=r?e:yt(e),ai(e,t)&&(this._rawValue=e,this._value=r?e:Tn(e),this.dep.trigger())}}function _s(n){return Ln(n)?n.value:n}const ZE={get:(n,e,t)=>e==="__v_raw"?n:_s(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Ln(s)&&!Ln(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function E_(n){return oa(n)?n:new Proxy(n,ZE)}class eT{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new yp(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=eu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Rt!==this)return l_(this,!0),!0}get value(){const e=this.dep.track();return d_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function tT(n,e,t=!1){let r,s;return Ke(n)?r=n:(r=n.get,s=n.set),new eT(r,s,t)}const Tc={},td=new WeakMap;let Wi;function nT(n,e=!1,t=Wi){if(t){let r=td.get(t);r||td.set(t,r=[]),r.push(n)}}function rT(n,e,t=At){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=q=>s?q:_r(q)||s===!1||s===0?ps(q,1):ps(q);let d,f,g,y,R=!1,x=!1;if(Ln(n)?(f=()=>n.value,R=_r(n)):oa(n)?(f=()=>c(n),R=!0):Fe(n)?(x=!0,R=n.some(q=>oa(q)||_r(q)),f=()=>n.map(q=>{if(Ln(q))return q.value;if(oa(q))return c(q);if(Ke(q))return l?l(q,2):q()})):Ke(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){ws();try{g()}finally{Is()}}const q=Wi;Wi=d;try{return l?l(n,3,[y]):n(y)}finally{Wi=q}}:f=Rr,e&&s){const q=f,X=s===!0?1/0:s;f=()=>ps(q(),X)}const V=kE(),B=()=>{d.stop(),V&&V.active&&fp(V.effects,d)};if(i&&e){const q=e;e=(...X)=>{q(...X),B()}}let F=x?new Array(n.length).fill(Tc):Tc;const P=q=>{if(!(!(d.flags&1)||!d.dirty&&!q))if(e){const X=d.run();if(s||R||(x?X.some((pe,T)=>ai(pe,F[T])):ai(X,F))){g&&g();const pe=Wi;Wi=d;try{const T=[X,F===Tc?void 0:x&&F[0]===Tc?[]:F,y];F=X,l?l(e,3,T):e(...T)}finally{Wi=pe}}}else d.run()};return a&&a(P),d=new o_(f),d.scheduler=o?()=>o(P,!1):P,y=q=>nT(q,!1,d),g=d.onStop=()=>{const q=td.get(d);if(q){if(l)l(q,4);else for(const X of q)X();td.delete(d)}},e?r?P(!0):F=d.run():o?o(P.bind(null,!0),!0):d.run(),B.pause=d.pause.bind(d),B.resume=d.resume.bind(d),B.stop=B,B}function ps(n,e=1/0,t){if(e<=0||!kt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Ln(n))ps(n.value,e,t);else if(Fe(n))for(let r=0;r<n.length;r++)ps(n[r],e,t);else if(Nd(n)||ia(n))n.forEach(r=>{ps(r,e,t)});else if(t_(n)){for(const r in n)ps(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&ps(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Su(n,e,t,r){try{return r?n(...r):n()}catch(s){jd(s,e,t)}}function Jr(n,e,t,r){if(Ke(n)){const s=Su(n,e,t,r);return s&&Zy(s)&&s.catch(i=>{jd(i,e,t)}),s}if(Fe(n)){const s=[];for(let i=0;i<n.length;i++)s.push(Jr(n[i],e,t,r));return s}}function jd(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||At;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){ws(),Su(i,null,10,[n,l,c]),Is();return}}sT(n,t,s,r,o)}function sT(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Kn=[];let jr=-1;const aa=[];let Qs=null,Xo=0;const T_=Promise.resolve();let nd=null;function hn(n){const e=nd||T_;return n?e.then(this?n.bind(this):n):e}function iT(n){let e=jr+1,t=Kn.length;for(;e<t;){const r=e+t>>>1,s=Kn[r],i=nu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Ip(n){if(!(n.flags&1)){const e=nu(n),t=Kn[Kn.length-1];!t||!(n.flags&2)&&e>=nu(t)?Kn.push(n):Kn.splice(iT(e),0,n),n.flags|=1,x_()}}function x_(){nd||(nd=T_.then(S_))}function oT(n){Fe(n)?aa.push(...n):Qs&&n.id===-1?Qs.splice(Xo+1,0,n):n.flags&1||(aa.push(n),n.flags|=1),x_()}function pg(n,e,t=jr+1){for(;t<Kn.length;t++){const r=Kn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Kn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function A_(n){if(aa.length){const e=[...new Set(aa)].sort((t,r)=>nu(t)-nu(r));if(aa.length=0,Qs){Qs.push(...e);return}for(Qs=e,Xo=0;Xo<Qs.length;Xo++){const t=Qs[Xo];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Qs=null,Xo=0}}const nu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function S_(n){const e=Rr;try{for(jr=0;jr<Kn.length;jr++){const t=Kn[jr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Su(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;jr<Kn.length;jr++){const t=Kn[jr];t&&(t.flags&=-2)}jr=-1,Kn.length=0,A_(),nd=null,(Kn.length||aa.length)&&S_()}}let hr=null,P_=null;function rd(n){const e=hr;return hr=n,P_=n&&n.type.__scopeId||null,e}function aT(n,e=hr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Eg(-1);const i=rd(e);let o;try{o=n(...s)}finally{rd(i),r._d&&Eg(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function ct(n,e){if(hr===null)return n;const t=Gd(hr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=At]=e[s];i&&(Ke(i)&&(i={mounted:i,updated:i}),i.deep&&ps(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Gi(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(ws(),Jr(l,t,8,[n.el,a,n,e]),Is())}}const lT=Symbol("_vte"),uT=n=>n.__isTeleport;function Ep(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Ep(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function R_(n,e){return Ke(n)?(()=>In({name:n.name},e,{setup:n}))():n}function C_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function jl(n,e,t,r,s=!1){if(Fe(n)){n.forEach((R,x)=>jl(R,e&&(Fe(e)?e[x]:e),t,r,s));return}if(Bl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&jl(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Gd(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===At?a.refs={}:a.refs,f=a.setupState,g=yt(f),y=f===At?()=>!1:R=>_t(g,R);if(c!=null&&c!==l&&(an(c)?(d[c]=null,y(c)&&(f[c]=null)):Ln(c)&&(c.value=null)),Ke(l))Su(l,a,12,[o,d]);else{const R=an(l),x=Ln(l);if(R||x){const V=()=>{if(n.f){const B=R?y(l)?f[l]:d[l]:l.value;s?Fe(B)&&fp(B,i):Fe(B)?B.includes(i)||B.push(i):R?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else R?(d[l]=o,y(l)&&(f[l]=o)):x&&(l.value=o,n.k&&(d[n.k]=o))};o?(V.id=-1,ur(V,t)):V()}}}Ld().requestIdleCallback;Ld().cancelIdleCallback;const Bl=n=>!!n.type.__asyncLoader,k_=n=>n.type.__isKeepAlive;function cT(n,e){D_(n,"a",e)}function dT(n,e){D_(n,"da",e)}function D_(n,e,t=Mn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Bd(e,r,t),t){let s=t.parent;for(;s&&s.parent;)k_(s.parent.vnode)&&hT(r,e,t,s),s=s.parent}}function hT(n,e,t,r){const s=Bd(e,n,r,!0);ql(()=>{fp(r[e],s)},t)}function Bd(n,e,t=Mn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{ws();const a=Pu(t),l=Jr(e,t,n,o);return a(),Is(),l});return r?s.unshift(i):s.push(i),i}}const Rs=n=>(e,t=Mn)=>{(!su||n==="sp")&&Bd(n,(...r)=>e(...r),t)},fT=Rs("bm"),yr=Rs("m"),pT=Rs("bu"),mT=Rs("u"),gT=Rs("bum"),ql=Rs("um"),vT=Rs("sp"),yT=Rs("rtg"),_T=Rs("rtc");function bT(n,e=Mn){Bd("ec",n,e)}const V_="components";function wT(n,e){return ET(V_,n,!0,e)||n}const IT=Symbol.for("v-ndc");function ET(n,e,t=!0,r=!1){const s=hr||Mn;if(s){const i=s.type;if(n===V_){const a=ux(i,!1);if(a&&(a===e||a===br(e)||a===Md(br(e))))return i}const o=mg(s[n]||i[n],e)||mg(s.appContext[n],e);return!o&&r?i:o}}function mg(n,e){return n&&(n[e]||n[br(e)]||n[Md(br(e))])}function dr(n,e,t,r){let s;const i=t&&t[r],o=Fe(n);if(o||an(n)){const a=o&&oa(n);let l=!1,c=!1;a&&(l=!_r(n),c=pi(n),n=$d(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?ed(Tn(n[d])):Tn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(kt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const Ef=n=>n?X_(n)?Gd(n):Ef(n.parent):null,zl=In(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Ef(n.parent),$root:n=>Ef(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Tp(n),$forceUpdate:n=>n.f||(n.f=()=>{Ip(n.update)}),$nextTick:n=>n.n||(n.n=hn.bind(n.proxy)),$watch:n=>zT.bind(n)}),Bh=(n,e)=>n!==At&&!n.__isScriptSetup&&_t(n,e),TT={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Bh(r,e))return o[e]=1,r[e];if(s!==At&&_t(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&_t(c,e))return o[e]=3,i[e];if(t!==At&&_t(t,e))return o[e]=4,t[e];Tf&&(o[e]=0)}}const d=zl[e];let f,g;if(d)return e==="$attrs"&&Nn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==At&&_t(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,_t(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Bh(s,e)?(s[e]=t,!0):r!==At&&_t(r,e)?(r[e]=t,!0):_t(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==At&&_t(n,o)||Bh(e,o)||(a=i[0])&&_t(a,o)||_t(r,o)||_t(zl,o)||_t(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:_t(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function gg(n){return Fe(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Tf=!0;function xT(n){const e=Tp(n),t=n.proxy,r=n.ctx;Tf=!1,e.beforeCreate&&vg(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:y,updated:R,activated:x,deactivated:V,beforeDestroy:B,beforeUnmount:F,destroyed:P,unmounted:q,render:X,renderTracked:pe,renderTriggered:T,errorCaptured:w,serverPrefetch:I,expose:C,inheritAttrs:k,components:$,directives:A,filters:Vt}=e;if(c&&AT(c,r,null),o)for(const $e in o){const Ue=o[$e];Ke(Ue)&&(r[$e]=Ue.bind(t))}if(s){const $e=s.call(t,t);kt($e)&&(n.data=Ud($e))}if(Tf=!0,i)for(const $e in i){const Ue=i[$e],De=Ke(Ue)?Ue.bind(t,t):Ke(Ue.get)?Ue.get.bind(t,t):Rr,te=!Ke(Ue)&&Ke(Ue.set)?Ue.set.bind(t):Rr,Ve=ze({get:De,set:te});Object.defineProperty(r,$e,{enumerable:!0,configurable:!0,get:()=>Ve.value,set:W=>Ve.value=W})}if(a)for(const $e in a)N_(a[$e],r,t,$e);if(l){const $e=Ke(l)?l.call(t):l;Reflect.ownKeys($e).forEach(Ue=>{Mc(Ue,$e[Ue])})}d&&vg(d,n,"c");function tt($e,Ue){Fe(Ue)?Ue.forEach(De=>$e(De.bind(t))):Ue&&$e(Ue.bind(t))}if(tt(fT,f),tt(yr,g),tt(pT,y),tt(mT,R),tt(cT,x),tt(dT,V),tt(bT,w),tt(_T,pe),tt(yT,T),tt(gT,F),tt(ql,q),tt(vT,I),Fe(C))if(C.length){const $e=n.exposed||(n.exposed={});C.forEach(Ue=>{Object.defineProperty($e,Ue,{get:()=>t[Ue],set:De=>t[Ue]=De})})}else n.exposed||(n.exposed={});X&&n.render===Rr&&(n.render=X),k!=null&&(n.inheritAttrs=k),$&&(n.components=$),A&&(n.directives=A),I&&C_(n)}function AT(n,e,t=Rr){Fe(n)&&(n=xf(n));for(const r in n){const s=n[r];let i;kt(s)?"default"in s?i=kr(s.from||r,s.default,!0):i=kr(s.from||r):i=kr(s),Ln(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function vg(n,e,t){Jr(Fe(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function N_(n,e,t,r){let s=r.includes(".")?H_(t,r):()=>t[r];if(an(n)){const i=e[n];Ke(i)&&Ft(s,i)}else if(Ke(n))Ft(s,n.bind(t));else if(kt(n))if(Fe(n))n.forEach(i=>N_(i,e,t,r));else{const i=Ke(n.handler)?n.handler.bind(t):e[n.handler];Ke(i)&&Ft(s,i,n)}}function Tp(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>sd(l,c,o,!0)),sd(l,e,o)),kt(e)&&i.set(e,l),l}function sd(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&sd(n,i,t,!0),s&&s.forEach(o=>sd(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=ST[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const ST={data:yg,props:_g,emits:_g,methods:Cl,computed:Cl,beforeCreate:Gn,created:Gn,beforeMount:Gn,mounted:Gn,beforeUpdate:Gn,updated:Gn,beforeDestroy:Gn,beforeUnmount:Gn,destroyed:Gn,unmounted:Gn,activated:Gn,deactivated:Gn,errorCaptured:Gn,serverPrefetch:Gn,components:Cl,directives:Cl,watch:RT,provide:yg,inject:PT};function yg(n,e){return e?n?function(){return In(Ke(n)?n.call(this,this):n,Ke(e)?e.call(this,this):e)}:e:n}function PT(n,e){return Cl(xf(n),xf(e))}function xf(n){if(Fe(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Gn(n,e){return n?[...new Set([].concat(n,e))]:e}function Cl(n,e){return n?In(Object.create(null),n,e):e}function _g(n,e){return n?Fe(n)&&Fe(e)?[...new Set([...n,...e])]:In(Object.create(null),gg(n),gg(e??{})):e}function RT(n,e){if(!n)return e;if(!e)return n;const t=In(Object.create(null),n);for(const r in e)t[r]=Gn(n[r],e[r]);return t}function O_(){return{app:null,config:{isNativeTag:yE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let CT=0;function kT(n,e){return function(r,s=null){Ke(r)||(r=In({},r)),s!=null&&!kt(s)&&(s=null);const i=O_(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:CT++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:dx,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&Ke(d.install)?(o.add(d),d.install(c,...f)):Ke(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!l){const y=c._ceVNode||dt(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,d):n(y,d,g),l=!0,c._container=d,d.__vue_app__=c,Gd(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(Jr(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=la;la=c;try{return d()}finally{la=f}}};return c}}let la=null;function Mc(n,e){if(Mn){let t=Mn.provides;const r=Mn.parent&&Mn.parent.provides;r===t&&(t=Mn.provides=Object.create(r)),t[n]=e}}function kr(n,e,t=!1){const r=Mn||hr;if(r||la){let s=la?la._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Ke(e)?e.call(r&&r.proxy):e}}const M_={},L_=()=>Object.create(M_),F_=n=>Object.getPrototypeOf(n)===M_;function DT(n,e,t,r=!1){const s={},i=L_();n.propsDefaults=Object.create(null),$_(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:b_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function VT(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=yt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(qd(n.emitsOptions,g))continue;const y=e[g];if(l)if(_t(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const R=br(g);s[R]=Af(l,a,R,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{$_(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!_t(e,f)&&((d=Ti(f))===f||!_t(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=Af(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!_t(e,f))&&(delete i[f],c=!0)}c&&fs(n.attrs,"set","")}function $_(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Fl(l))continue;const c=e[l];let d;s&&_t(s,d=br(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:qd(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=yt(t),c=a||At;for(let d=0;d<i.length;d++){const f=i[d];t[f]=Af(s,l,f,c[f],n,!_t(c,f))}}return o}function Af(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=_t(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ke(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=Pu(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Ti(t))&&(r=!0))}return r}const NT=new WeakMap;function U_(n,e,t=!1){const r=t?NT:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Ke(n)){const d=f=>{l=!0;const[g,y]=U_(f,e,!0);In(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return kt(n)&&r.set(n,sa),sa;if(Fe(i))for(let d=0;d<i.length;d++){const f=br(i[d]);bg(f)&&(o[f]=At)}else if(i)for(const d in i){const f=br(d);if(bg(f)){const g=i[d],y=o[f]=Fe(g)||Ke(g)?{type:g}:In({},g),R=y.type;let x=!1,V=!0;if(Fe(R))for(let B=0;B<R.length;++B){const F=R[B],P=Ke(F)&&F.name;if(P==="Boolean"){x=!0;break}else P==="String"&&(V=!1)}else x=Ke(R)&&R.name==="Boolean";y[0]=x,y[1]=V,(x||_t(y,"default"))&&a.push(f)}}const c=[o,a];return kt(n)&&r.set(n,c),c}function bg(n){return n[0]!=="$"&&!Fl(n)}const xp=n=>n[0]==="_"||n==="$stable",Ap=n=>Fe(n)?n.map(Br):[Br(n)],OT=(n,e,t)=>{if(e._n)return e;const r=aT((...s)=>Ap(e(...s)),t);return r._c=!1,r},j_=(n,e,t)=>{const r=n._ctx;for(const s in n){if(xp(s))continue;const i=n[s];if(Ke(i))e[s]=OT(s,i,r);else if(i!=null){const o=Ap(i);e[s]=()=>o}}},B_=(n,e)=>{const t=Ap(e);n.slots.default=()=>t},q_=(n,e,t)=>{for(const r in e)(t||!xp(r))&&(n[r]=e[r])},MT=(n,e,t)=>{const r=n.slots=L_();if(n.vnode.shapeFlag&32){const s=e.__;s&&vf(r,"__",s,!0);const i=e._;i?(q_(r,e,t),t&&vf(r,"_",i,!0)):j_(e,r)}else e&&B_(n,e)},LT=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=At;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:q_(s,e,t):(i=!e.$stable,j_(e,s)),o=e}else e&&(B_(n,e),o={default:1});if(i)for(const a in s)!xp(a)&&o[a]==null&&delete s[a]},ur=YT;function FT(n){return $T(n)}function $T(n,e){const t=Ld();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:y=Rr,insertStaticContent:R}=n,x=(E,S,O,Z=null,J=null,ee=null,ve=void 0,de=null,ue=!!S.dynamicChildren)=>{if(E===S)return;E&&!wl(E,S)&&(Z=K(E),W(E,J,ee,!0),E=null),S.patchFlag===-2&&(ue=!1,S.dynamicChildren=null);const{type:oe,ref:Ee,shapeFlag:we}=S;switch(oe){case zd:V(E,S,O,Z);break;case mi:B(E,S,O,Z);break;case Lc:E==null&&F(S,O,Z,ve);break;case It:$(E,S,O,Z,J,ee,ve,de,ue);break;default:we&1?X(E,S,O,Z,J,ee,ve,de,ue):we&6?A(E,S,O,Z,J,ee,ve,de,ue):(we&64||we&128)&&oe.process(E,S,O,Z,J,ee,ve,de,ue,Ae)}Ee!=null&&J?jl(Ee,E&&E.ref,ee,S||E,!S):Ee==null&&E&&E.ref!=null&&jl(E.ref,null,ee,E,!0)},V=(E,S,O,Z)=>{if(E==null)r(S.el=a(S.children),O,Z);else{const J=S.el=E.el;S.children!==E.children&&c(J,S.children)}},B=(E,S,O,Z)=>{E==null?r(S.el=l(S.children||""),O,Z):S.el=E.el},F=(E,S,O,Z)=>{[E.el,E.anchor]=R(E.children,S,O,Z,E.el,E.anchor)},P=({el:E,anchor:S},O,Z)=>{let J;for(;E&&E!==S;)J=g(E),r(E,O,Z),E=J;r(S,O,Z)},q=({el:E,anchor:S})=>{let O;for(;E&&E!==S;)O=g(E),s(E),E=O;s(S)},X=(E,S,O,Z,J,ee,ve,de,ue)=>{S.type==="svg"?ve="svg":S.type==="math"&&(ve="mathml"),E==null?pe(S,O,Z,J,ee,ve,de,ue):I(E,S,J,ee,ve,de,ue)},pe=(E,S,O,Z,J,ee,ve,de)=>{let ue,oe;const{props:Ee,shapeFlag:we,transition:Te,dirs:Re}=E;if(ue=E.el=o(E.type,ee,Ee&&Ee.is,Ee),we&8?d(ue,E.children):we&16&&w(E.children,ue,null,Z,J,qh(E,ee),ve,de),Re&&Gi(E,null,Z,"created"),T(ue,E,E.scopeId,ve,Z),Ee){for(const Be in Ee)Be!=="value"&&!Fl(Be)&&i(ue,Be,null,Ee[Be],ee,Z);"value"in Ee&&i(ue,"value",null,Ee.value,ee),(oe=Ee.onVnodeBeforeMount)&&Ur(oe,Z,E)}Re&&Gi(E,null,Z,"beforeMount");const Oe=UT(J,Te);Oe&&Te.beforeEnter(ue),r(ue,S,O),((oe=Ee&&Ee.onVnodeMounted)||Oe||Re)&&ur(()=>{oe&&Ur(oe,Z,E),Oe&&Te.enter(ue),Re&&Gi(E,null,Z,"mounted")},J)},T=(E,S,O,Z,J)=>{if(O&&y(E,O),Z)for(let ee=0;ee<Z.length;ee++)y(E,Z[ee]);if(J){let ee=J.subTree;if(S===ee||Q_(ee.type)&&(ee.ssContent===S||ee.ssFallback===S)){const ve=J.vnode;T(E,ve,ve.scopeId,ve.slotScopeIds,J.parent)}}},w=(E,S,O,Z,J,ee,ve,de,ue=0)=>{for(let oe=ue;oe<E.length;oe++){const Ee=E[oe]=de?Js(E[oe]):Br(E[oe]);x(null,Ee,S,O,Z,J,ee,ve,de)}},I=(E,S,O,Z,J,ee,ve)=>{const de=S.el=E.el;let{patchFlag:ue,dynamicChildren:oe,dirs:Ee}=S;ue|=E.patchFlag&16;const we=E.props||At,Te=S.props||At;let Re;if(O&&Ki(O,!1),(Re=Te.onVnodeBeforeUpdate)&&Ur(Re,O,S,E),Ee&&Gi(S,E,O,"beforeUpdate"),O&&Ki(O,!0),(we.innerHTML&&Te.innerHTML==null||we.textContent&&Te.textContent==null)&&d(de,""),oe?C(E.dynamicChildren,oe,de,O,Z,qh(S,J),ee):ve||Ue(E,S,de,null,O,Z,qh(S,J),ee,!1),ue>0){if(ue&16)k(de,we,Te,O,J);else if(ue&2&&we.class!==Te.class&&i(de,"class",null,Te.class,J),ue&4&&i(de,"style",we.style,Te.style,J),ue&8){const Oe=S.dynamicProps;for(let Be=0;Be<Oe.length;Be++){const Xe=Oe[Be],Wt=we[Xe],Bt=Te[Xe];(Bt!==Wt||Xe==="value")&&i(de,Xe,Wt,Bt,J,O)}}ue&1&&E.children!==S.children&&d(de,S.children)}else!ve&&oe==null&&k(de,we,Te,O,J);((Re=Te.onVnodeUpdated)||Ee)&&ur(()=>{Re&&Ur(Re,O,S,E),Ee&&Gi(S,E,O,"updated")},Z)},C=(E,S,O,Z,J,ee,ve)=>{for(let de=0;de<S.length;de++){const ue=E[de],oe=S[de],Ee=ue.el&&(ue.type===It||!wl(ue,oe)||ue.shapeFlag&198)?f(ue.el):O;x(ue,oe,Ee,null,Z,J,ee,ve,!0)}},k=(E,S,O,Z,J)=>{if(S!==O){if(S!==At)for(const ee in S)!Fl(ee)&&!(ee in O)&&i(E,ee,S[ee],null,J,Z);for(const ee in O){if(Fl(ee))continue;const ve=O[ee],de=S[ee];ve!==de&&ee!=="value"&&i(E,ee,de,ve,J,Z)}"value"in O&&i(E,"value",S.value,O.value,J)}},$=(E,S,O,Z,J,ee,ve,de,ue)=>{const oe=S.el=E?E.el:a(""),Ee=S.anchor=E?E.anchor:a("");let{patchFlag:we,dynamicChildren:Te,slotScopeIds:Re}=S;Re&&(de=de?de.concat(Re):Re),E==null?(r(oe,O,Z),r(Ee,O,Z),w(S.children||[],O,Ee,J,ee,ve,de,ue)):we>0&&we&64&&Te&&E.dynamicChildren?(C(E.dynamicChildren,Te,O,J,ee,ve,de),(S.key!=null||J&&S===J.subTree)&&z_(E,S,!0)):Ue(E,S,O,Ee,J,ee,ve,de,ue)},A=(E,S,O,Z,J,ee,ve,de,ue)=>{S.slotScopeIds=de,E==null?S.shapeFlag&512?J.ctx.activate(S,O,Z,ve,ue):Vt(S,O,Z,J,ee,ve,ue):Pt(E,S,ue)},Vt=(E,S,O,Z,J,ee,ve)=>{const de=E.component=sx(E,Z,J);if(k_(E)&&(de.ctx.renderer=Ae),ix(de,!1,ve),de.asyncDep){if(J&&J.registerDep(de,tt,ve),!E.el){const ue=de.subTree=dt(mi);B(null,ue,S,O)}}else tt(de,E,S,O,J,ee,ve)},Pt=(E,S,O)=>{const Z=S.component=E.component;if(QT(E,S,O))if(Z.asyncDep&&!Z.asyncResolved){$e(Z,S,O);return}else Z.next=S,Z.update();else S.el=E.el,Z.vnode=S},tt=(E,S,O,Z,J,ee,ve)=>{const de=()=>{if(E.isMounted){let{next:we,bu:Te,u:Re,parent:Oe,vnode:Be}=E;{const Nt=G_(E);if(Nt){we&&(we.el=Be.el,$e(E,we,ve)),Nt.asyncDep.then(()=>{E.isUnmounted||de()});return}}let Xe=we,Wt;Ki(E,!1),we?(we.el=Be.el,$e(E,we,ve)):we=Be,Te&&Oc(Te),(Wt=we.props&&we.props.onVnodeBeforeUpdate)&&Ur(Wt,Oe,we,Be),Ki(E,!0);const Bt=zh(E),gn=E.subTree;E.subTree=Bt,x(gn,Bt,f(gn.el),K(gn),E,J,ee),we.el=Bt.el,Xe===null&&JT(E,Bt.el),Re&&ur(Re,J),(Wt=we.props&&we.props.onVnodeUpdated)&&ur(()=>Ur(Wt,Oe,we,Be),J)}else{let we;const{el:Te,props:Re}=S,{bm:Oe,m:Be,parent:Xe,root:Wt,type:Bt}=E,gn=Bl(S);if(Ki(E,!1),Oe&&Oc(Oe),!gn&&(we=Re&&Re.onVnodeBeforeMount)&&Ur(we,Xe,S),Ki(E,!0),Te&&ut){const Nt=()=>{E.subTree=zh(E),ut(Te,E.subTree,E,J,null)};gn&&Bt.__asyncHydrate?Bt.__asyncHydrate(Te,E,Nt):Nt()}else{Wt.ce&&Wt.ce._def.shadowRoot!==!1&&Wt.ce._injectChildStyle(Bt);const Nt=E.subTree=zh(E);x(null,Nt,O,Z,E,J,ee),S.el=Nt.el}if(Be&&ur(Be,J),!gn&&(we=Re&&Re.onVnodeMounted)){const Nt=S;ur(()=>Ur(we,Xe,Nt),J)}(S.shapeFlag&256||Xe&&Bl(Xe.vnode)&&Xe.vnode.shapeFlag&256)&&E.a&&ur(E.a,J),E.isMounted=!0,S=O=Z=null}};E.scope.on();const ue=E.effect=new o_(de);E.scope.off();const oe=E.update=ue.run.bind(ue),Ee=E.job=ue.runIfDirty.bind(ue);Ee.i=E,Ee.id=E.uid,ue.scheduler=()=>Ip(Ee),Ki(E,!0),oe()},$e=(E,S,O)=>{S.component=E;const Z=E.vnode.props;E.vnode=S,E.next=null,VT(E,S.props,Z,O),LT(E,S.children,O),ws(),pg(E),Is()},Ue=(E,S,O,Z,J,ee,ve,de,ue=!1)=>{const oe=E&&E.children,Ee=E?E.shapeFlag:0,we=S.children,{patchFlag:Te,shapeFlag:Re}=S;if(Te>0){if(Te&128){te(oe,we,O,Z,J,ee,ve,de,ue);return}else if(Te&256){De(oe,we,O,Z,J,ee,ve,de,ue);return}}Re&8?(Ee&16&&Ze(oe,J,ee),we!==oe&&d(O,we)):Ee&16?Re&16?te(oe,we,O,Z,J,ee,ve,de,ue):Ze(oe,J,ee,!0):(Ee&8&&d(O,""),Re&16&&w(we,O,Z,J,ee,ve,de,ue))},De=(E,S,O,Z,J,ee,ve,de,ue)=>{E=E||sa,S=S||sa;const oe=E.length,Ee=S.length,we=Math.min(oe,Ee);let Te;for(Te=0;Te<we;Te++){const Re=S[Te]=ue?Js(S[Te]):Br(S[Te]);x(E[Te],Re,O,null,J,ee,ve,de,ue)}oe>Ee?Ze(E,J,ee,!0,!1,we):w(S,O,Z,J,ee,ve,de,ue,we)},te=(E,S,O,Z,J,ee,ve,de,ue)=>{let oe=0;const Ee=S.length;let we=E.length-1,Te=Ee-1;for(;oe<=we&&oe<=Te;){const Re=E[oe],Oe=S[oe]=ue?Js(S[oe]):Br(S[oe]);if(wl(Re,Oe))x(Re,Oe,O,null,J,ee,ve,de,ue);else break;oe++}for(;oe<=we&&oe<=Te;){const Re=E[we],Oe=S[Te]=ue?Js(S[Te]):Br(S[Te]);if(wl(Re,Oe))x(Re,Oe,O,null,J,ee,ve,de,ue);else break;we--,Te--}if(oe>we){if(oe<=Te){const Re=Te+1,Oe=Re<Ee?S[Re].el:Z;for(;oe<=Te;)x(null,S[oe]=ue?Js(S[oe]):Br(S[oe]),O,Oe,J,ee,ve,de,ue),oe++}}else if(oe>Te)for(;oe<=we;)W(E[oe],J,ee,!0),oe++;else{const Re=oe,Oe=oe,Be=new Map;for(oe=Oe;oe<=Te;oe++){const nn=S[oe]=ue?Js(S[oe]):Br(S[oe]);nn.key!=null&&Be.set(nn.key,oe)}let Xe,Wt=0;const Bt=Te-Oe+1;let gn=!1,Nt=0;const mr=new Array(Bt);for(oe=0;oe<Bt;oe++)mr[oe]=0;for(oe=Re;oe<=we;oe++){const nn=E[oe];if(Wt>=Bt){W(nn,J,ee,!0);continue}let Pn;if(nn.key!=null)Pn=Be.get(nn.key);else for(Xe=Oe;Xe<=Te;Xe++)if(mr[Xe-Oe]===0&&wl(nn,S[Xe])){Pn=Xe;break}Pn===void 0?W(nn,J,ee,!0):(mr[Pn-Oe]=oe+1,Pn>=Nt?Nt=Pn:gn=!0,x(nn,S[Pn],O,null,J,ee,ve,de,ue),Wt++)}const Vr=gn?jT(mr):sa;for(Xe=Vr.length-1,oe=Bt-1;oe>=0;oe--){const nn=Oe+oe,Pn=S[nn],Ci=nn+1<Ee?S[nn+1].el:Z;mr[oe]===0?x(null,Pn,O,Ci,J,ee,ve,de,ue):gn&&(Xe<0||oe!==Vr[Xe]?Ve(Pn,O,Ci,2):Xe--)}}},Ve=(E,S,O,Z,J=null)=>{const{el:ee,type:ve,transition:de,children:ue,shapeFlag:oe}=E;if(oe&6){Ve(E.component.subTree,S,O,Z);return}if(oe&128){E.suspense.move(S,O,Z);return}if(oe&64){ve.move(E,S,O,Ae);return}if(ve===It){r(ee,S,O);for(let we=0;we<ue.length;we++)Ve(ue[we],S,O,Z);r(E.anchor,S,O);return}if(ve===Lc){P(E,S,O);return}if(Z!==2&&oe&1&&de)if(Z===0)de.beforeEnter(ee),r(ee,S,O),ur(()=>de.enter(ee),J);else{const{leave:we,delayLeave:Te,afterLeave:Re}=de,Oe=()=>{E.ctx.isUnmounted?s(ee):r(ee,S,O)},Be=()=>{we(ee,()=>{Oe(),Re&&Re()})};Te?Te(ee,Oe,Be):Be()}else r(ee,S,O)},W=(E,S,O,Z=!1,J=!1)=>{const{type:ee,props:ve,ref:de,children:ue,dynamicChildren:oe,shapeFlag:Ee,patchFlag:we,dirs:Te,cacheIndex:Re}=E;if(we===-2&&(J=!1),de!=null&&(ws(),jl(de,null,O,E,!0),Is()),Re!=null&&(S.renderCache[Re]=void 0),Ee&256){S.ctx.deactivate(E);return}const Oe=Ee&1&&Te,Be=!Bl(E);let Xe;if(Be&&(Xe=ve&&ve.onVnodeBeforeUnmount)&&Ur(Xe,S,E),Ee&6)Je(E.component,O,Z);else{if(Ee&128){E.suspense.unmount(O,Z);return}Oe&&Gi(E,null,S,"beforeUnmount"),Ee&64?E.type.remove(E,S,O,Ae,Z):oe&&!oe.hasOnce&&(ee!==It||we>0&&we&64)?Ze(oe,S,O,!1,!0):(ee===It&&we&384||!J&&Ee&16)&&Ze(ue,S,O),Z&&Y(E)}(Be&&(Xe=ve&&ve.onVnodeUnmounted)||Oe)&&ur(()=>{Xe&&Ur(Xe,S,E),Oe&&Gi(E,null,S,"unmounted")},O)},Y=E=>{const{type:S,el:O,anchor:Z,transition:J}=E;if(S===It){Ne(O,Z);return}if(S===Lc){q(E);return}const ee=()=>{s(O),J&&!J.persisted&&J.afterLeave&&J.afterLeave()};if(E.shapeFlag&1&&J&&!J.persisted){const{leave:ve,delayLeave:de}=J,ue=()=>ve(O,ee);de?de(E.el,ee,ue):ue()}else ee()},Ne=(E,S)=>{let O;for(;E!==S;)O=g(E),s(E),E=O;s(S)},Je=(E,S,O)=>{const{bum:Z,scope:J,job:ee,subTree:ve,um:de,m:ue,a:oe,parent:Ee,slots:{__:we}}=E;wg(ue),wg(oe),Z&&Oc(Z),Ee&&Fe(we)&&we.forEach(Te=>{Ee.renderCache[Te]=void 0}),J.stop(),ee&&(ee.flags|=8,W(ve,E,S,O)),de&&ur(de,S),ur(()=>{E.isUnmounted=!0},S),S&&S.pendingBranch&&!S.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===S.pendingId&&(S.deps--,S.deps===0&&S.resolve())},Ze=(E,S,O,Z=!1,J=!1,ee=0)=>{for(let ve=ee;ve<E.length;ve++)W(E[ve],S,O,Z,J)},K=E=>{if(E.shapeFlag&6)return K(E.component.subTree);if(E.shapeFlag&128)return E.suspense.next();const S=g(E.anchor||E.el),O=S&&S[lT];return O?g(O):S};let be=!1;const ce=(E,S,O)=>{E==null?S._vnode&&W(S._vnode,null,null,!0):x(S._vnode||null,E,S,null,null,null,O),S._vnode=E,be||(be=!0,pg(),A_(),be=!1)},Ae={p:x,um:W,m:Ve,r:Y,mt:Vt,mc:w,pc:Ue,pbc:C,n:K,o:n};let We,ut;return e&&([We,ut]=e(Ae)),{render:ce,hydrate:We,createApp:kT(ce,We)}}function qh({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ki({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function UT(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function z_(n,e,t=!1){const r=n.children,s=e.children;if(Fe(r)&&Fe(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Js(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&z_(o,a)),a.type===zd&&(a.el=o.el),a.type===mi&&!a.el&&(a.el=o.el)}}function jT(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function G_(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:G_(e)}function wg(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const BT=Symbol.for("v-scx"),qT=()=>kr(BT);function Ft(n,e,t){return K_(n,e,t)}function K_(n,e,t=At){const{immediate:r,deep:s,flush:i,once:o}=t,a=In({},t),l=e&&r||!e&&i!=="post";let c;if(su){if(i==="sync"){const y=qT();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=Rr,y.resume=Rr,y.pause=Rr,y}}const d=Mn;a.call=(y,R,x)=>Jr(y,d,R,x);let f=!1;i==="post"?a.scheduler=y=>{ur(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,R)=>{R?y():Ip(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const g=rT(n,e,a);return su&&(c?c.push(g):l&&g()),g}function zT(n,e,t){const r=this.proxy,s=an(n)?n.includes(".")?H_(r,n):()=>r[n]:n.bind(r,r);let i;Ke(e)?i=e:(i=e.handler,t=e);const o=Pu(this),a=K_(s,i.bind(r),t);return o(),a}function H_(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const GT=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${br(e)}Modifiers`]||n[`${Ti(e)}Modifiers`];function KT(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||At;let s=t;const i=e.startsWith("update:"),o=i&&GT(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>an(d)?d.trim():d)),o.number&&(s=t.map(yf)));let a,l=r[a=Lh(e)]||r[a=Lh(br(e))];!l&&i&&(l=r[a=Lh(Ti(e))]),l&&Jr(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Jr(c,n,6,s)}}function W_(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Ke(n)){const l=c=>{const d=W_(c,e,!0);d&&(a=!0,In(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(kt(n)&&r.set(n,null),null):(Fe(i)?i.forEach(l=>o[l]=null):In(o,i),kt(n)&&r.set(n,o),o)}function qd(n,e){return!n||!Vd(e)?!1:(e=e.slice(2).replace(/Once$/,""),_t(n,e[0].toLowerCase()+e.slice(1))||_t(n,Ti(e))||_t(n,e))}function zh(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:g,setupState:y,ctx:R,inheritAttrs:x}=n,V=rd(n);let B,F;try{if(t.shapeFlag&4){const q=s||r,X=q;B=Br(c.call(X,q,d,f,y,g,R)),F=a}else{const q=e;B=Br(q.length>1?q(f,{attrs:a,slots:o,emit:l}):q(f,null)),F=e.props?a:HT(a)}}catch(q){Gl.length=0,jd(q,n,1),B=dt(mi)}let P=B;if(F&&x!==!1){const q=Object.keys(F),{shapeFlag:X}=P;q.length&&X&7&&(i&&q.some(hp)&&(F=WT(F,i)),P=ga(P,F,!1,!0))}return t.dirs&&(P=ga(P,null,!1,!0),P.dirs=P.dirs?P.dirs.concat(t.dirs):t.dirs),t.transition&&Ep(P,t.transition),B=P,rd(V),B}const HT=n=>{let e;for(const t in n)(t==="class"||t==="style"||Vd(t))&&((e||(e={}))[t]=n[t]);return e},WT=(n,e)=>{const t={};for(const r in n)(!hp(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function QT(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Ig(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!qd(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Ig(r,o,c):!0:!!o;return!1}function Ig(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!qd(t,i))return!0}return!1}function JT({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Q_=n=>n.__isSuspense;function YT(n,e){e&&e.pendingBranch?Fe(n)?e.effects.push(...n):e.effects.push(n):oT(n)}const It=Symbol.for("v-fgt"),zd=Symbol.for("v-txt"),mi=Symbol.for("v-cmt"),Lc=Symbol.for("v-stc"),Gl=[];let fr=null;function M(n=!1){Gl.push(fr=n?null:[])}function XT(){Gl.pop(),fr=Gl[Gl.length-1]||null}let ru=1;function Eg(n,e=!1){ru+=n,n<0&&fr&&e&&(fr.hasOnce=!0)}function J_(n){return n.dynamicChildren=ru>0?fr||sa:null,XT(),ru>0&&fr&&fr.push(n),n}function L(n,e,t,r,s,i){return J_(h(n,e,t,r,s,i,!0))}function Sp(n,e,t,r,s){return J_(dt(n,e,t,r,s,!0))}function id(n){return n?n.__v_isVNode===!0:!1}function wl(n,e){return n.type===e.type&&n.key===e.key}const Y_=({key:n})=>n??null,Fc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?an(n)||Ln(n)||Ke(n)?{i:hr,r:n,k:e,f:!!t}:n:null);function h(n,e=null,t=null,r=0,s=null,i=n===It?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Y_(e),ref:e&&Fc(e),scopeId:P_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:hr};return a?(Pp(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=an(t)?8:16),ru>0&&!o&&fr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&fr.push(l),l}const dt=ZT;function ZT(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===IT)&&(n=mi),id(n)){const a=ga(n,e,!0);return t&&Pp(a,t),ru>0&&!i&&fr&&(a.shapeFlag&6?fr[fr.indexOf(n)]=a:fr.push(a)),a.patchFlag=-2,a}if(cx(n)&&(n=n.__vccOpts),e){e=ex(e);let{class:a,style:l}=e;a&&!an(a)&&(e.class=Hn(a)),kt(l)&&(wp(l)&&!Fe(l)&&(l=In({},l)),e.style=Xs(l))}const o=an(n)?1:Q_(n)?128:uT(n)?64:kt(n)?4:Ke(n)?2:0;return h(n,e,t,r,s,o,i,!0)}function ex(n){return n?wp(n)||F_(n)?In({},n):n:null}function ga(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?tx(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Y_(c),ref:e&&e.ref?t&&i?Fe(i)?i.concat(Fc(e)):[i,Fc(e)]:Fc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==It?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&ga(n.ssContent),ssFallback:n.ssFallback&&ga(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&Ep(d,l.clone(d)),d}function On(n=" ",e=0){return dt(zd,null,n,e)}function cr(n,e){const t=dt(Lc,null,n);return t.staticCount=e,t}function le(n="",e=!1){return e?(M(),Sp(mi,null,n)):dt(mi,null,n)}function Br(n){return n==null||typeof n=="boolean"?dt(mi):Fe(n)?dt(It,null,n.slice()):id(n)?Js(n):dt(zd,null,String(n))}function Js(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:ga(n)}function Pp(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Fe(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),Pp(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!F_(e)?e._ctx=hr:s===3&&hr&&(hr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ke(e)?(e={default:e,_ctx:hr},t=32):(e=String(e),r&64?(t=16,e=[On(e)]):t=8);n.children=e,n.shapeFlag|=t}function tx(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Hn([e.class,r.class]));else if(s==="style")e.style=Xs([e.style,r.style]);else if(Vd(s)){const i=e[s],o=r[s];o&&i!==o&&!(Fe(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Ur(n,e,t,r=null){Jr(n,e,7,[t,r])}const nx=O_();let rx=0;function sx(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||nx,i={uid:rx++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new CE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:U_(r,s),emitsOptions:W_(r,s),emit:null,emitted:null,propsDefaults:At,inheritAttrs:r.inheritAttrs,ctx:At,data:At,props:At,attrs:At,slots:At,refs:At,setupState:At,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=KT.bind(null,i),n.ce&&n.ce(i),i}let Mn=null,od,Sf;{const n=Ld(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};od=e("__VUE_INSTANCE_SETTERS__",t=>Mn=t),Sf=e("__VUE_SSR_SETTERS__",t=>su=t)}const Pu=n=>{const e=Mn;return od(n),n.scope.on(),()=>{n.scope.off(),od(e)}},Tg=()=>{Mn&&Mn.scope.off(),od(null)};function X_(n){return n.vnode.shapeFlag&4}let su=!1;function ix(n,e=!1,t=!1){e&&Sf(e);const{props:r,children:s}=n.vnode,i=X_(n);DT(n,r,i,e),MT(n,s,t||e);const o=i?ox(n,e):void 0;return e&&Sf(!1),o}function ox(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,TT);const{setup:r}=t;if(r){ws();const s=n.setupContext=r.length>1?lx(n):null,i=Pu(n),o=Su(r,n,0,[n.props,s]),a=Zy(o);if(Is(),i(),(a||n.sp)&&!Bl(n)&&C_(n),a){if(o.then(Tg,Tg),e)return o.then(l=>{xg(n,l,e)}).catch(l=>{jd(l,n,0)});n.asyncDep=o}else xg(n,o,e)}else Z_(n,e)}function xg(n,e,t){Ke(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:kt(e)&&(n.setupState=E_(e)),Z_(n,t)}let Ag;function Z_(n,e,t){const r=n.type;if(!n.render){if(!e&&Ag&&!r.render){const s=r.template||Tp(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=In(In({isCustomElement:i,delimiters:a},o),l);r.render=Ag(s,c)}}n.render=r.render||Rr}{const s=Pu(n);ws();try{xT(n)}finally{Is(),s()}}}const ax={get(n,e){return Nn(n,"get",""),n[e]}};function lx(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,ax),slots:n.slots,emit:n.emit,expose:e}}function Gd(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(E_(JE(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in zl)return zl[t](n)},has(e,t){return t in e||t in zl}})):n.proxy}function ux(n,e=!0){return Ke(n)?n.displayName||n.name:n.name||e&&n.__name}function cx(n){return Ke(n)&&"__vccOpts"in n}const ze=(n,e)=>tT(n,e,su);function e0(n,e,t){const r=arguments.length;return r===2?kt(e)&&!Fe(e)?id(e)?dt(n,null,[e]):dt(n,e):dt(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&id(t)&&(t=[t]),dt(n,e,t))}const dx="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Pf;const Sg=typeof window<"u"&&window.trustedTypes;if(Sg)try{Pf=Sg.createPolicy("vue",{createHTML:n=>n})}catch{}const t0=Pf?n=>Pf.createHTML(n):n=>n,hx="http://www.w3.org/2000/svg",fx="http://www.w3.org/1998/Math/MathML",hs=typeof document<"u"?document:null,Pg=hs&&hs.createElement("template"),px={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?hs.createElementNS(hx,n):e==="mathml"?hs.createElementNS(fx,n):t?hs.createElement(n,{is:t}):hs.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>hs.createTextNode(n),createComment:n=>hs.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>hs.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Pg.innerHTML=t0(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Pg.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},mx=Symbol("_vtc");function gx(n,e,t){const r=n[mx];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const ad=Symbol("_vod"),n0=Symbol("_vsh"),Gh={beforeMount(n,{value:e},{transition:t}){n[ad]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Il(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Il(n,!0),r.enter(n)):r.leave(n,()=>{Il(n,!1)}):Il(n,e))},beforeUnmount(n,{value:e}){Il(n,e)}};function Il(n,e){n.style.display=e?n[ad]:"none",n[n0]=!e}const vx=Symbol(""),yx=/(^|;)\s*display\s*:/;function _x(n,e,t){const r=n.style,s=an(t);let i=!1;if(t&&!s){if(e)if(an(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&$c(r,a,"")}else for(const o in e)t[o]==null&&$c(r,o,"");for(const o in t)o==="display"&&(i=!0),$c(r,o,t[o])}else if(s){if(e!==t){const o=r[vx];o&&(t+=";"+o),r.cssText=t,i=yx.test(t)}}else e&&n.removeAttribute("style");ad in n&&(n[ad]=i?r.display:"",n[n0]&&(r.display="none"))}const Rg=/\s*!important$/;function $c(n,e,t){if(Fe(t))t.forEach(r=>$c(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=bx(n,e);Rg.test(t)?n.setProperty(Ti(r),t.replace(Rg,""),"important"):n[r]=t}}const Cg=["Webkit","Moz","ms"],Kh={};function bx(n,e){const t=Kh[e];if(t)return t;let r=br(e);if(r!=="filter"&&r in n)return Kh[e]=r;r=Md(r);for(let s=0;s<Cg.length;s++){const i=Cg[s]+r;if(i in n)return Kh[e]=i}return e}const kg="http://www.w3.org/1999/xlink";function Dg(n,e,t,r,s,i=PE(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(kg,e.slice(6,e.length)):n.setAttributeNS(kg,e,t):t==null||i&&!n_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Qr(t)?String(t):t)}function Vg(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?t0(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=n_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function Yi(n,e,t,r){n.addEventListener(e,t,r)}function wx(n,e,t,r){n.removeEventListener(e,t,r)}const Ng=Symbol("_vei");function Ix(n,e,t,r,s=null){const i=n[Ng]||(n[Ng]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=Ex(e);if(r){const c=i[e]=Ax(r,s);Yi(n,a,c,l)}else o&&(wx(n,a,o,l),i[e]=void 0)}}const Og=/(?:Once|Passive|Capture)$/;function Ex(n){let e;if(Og.test(n)){e={};let r;for(;r=n.match(Og);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Ti(n.slice(2)),e]}let Hh=0;const Tx=Promise.resolve(),xx=()=>Hh||(Tx.then(()=>Hh=0),Hh=Date.now());function Ax(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Jr(Sx(r,t.value),e,5,[r])};return t.value=n,t.attached=xx(),t}function Sx(n,e){if(Fe(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Mg=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,Px=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?gx(n,r,o):e==="style"?_x(n,t,r):Vd(e)?hp(e)||Ix(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Rx(n,e,r,o))?(Vg(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Dg(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!an(r))?Vg(n,br(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Dg(n,e,r,o))};function Rx(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Mg(e)&&Ke(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Mg(e)&&an(t)?!1:e in n}const ld=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Fe(e)?t=>Oc(e,t):e};function Cx(n){n.target.composing=!0}function Lg(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const ua=Symbol("_assign"),Ct={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[ua]=ld(s);const i=r||s.props&&s.props.type==="number";Yi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=yf(a)),n[ua](a)}),t&&Yi(n,"change",()=>{n.value=n.value.trim()}),e||(Yi(n,"compositionstart",Cx),Yi(n,"compositionend",Lg),Yi(n,"change",Lg))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[ua]=ld(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?yf(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},ud={deep:!0,created(n,e,t){n[ua]=ld(t),Yi(n,"change",()=>{const r=n._modelValue,s=kx(n),i=n.checked,o=n[ua];if(Fe(r)){const a=r_(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Nd(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(r0(n,i))})},mounted:Fg,beforeUpdate(n,e,t){n[ua]=ld(t),Fg(n,e,t)}};function Fg(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Fe(e))s=r_(e,r.props.value)>-1;else if(Nd(e))s=e.has(r.props.value);else{if(e===t)return;s=Fd(e,r0(n,!0))}n.checked!==s&&(n.checked=s)}function kx(n){return"_value"in n?n._value:n.value}function r0(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const Dx=["ctrl","shift","alt","meta"],Vx={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>Dx.some(t=>n[`${t}Key`]&&!e.includes(t))},Lt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=Vx[e[o]];if(a&&a(s,e))return}return n(s,...i)})},Nx={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Dn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Ti(s.key);if(e.some(o=>o===i||Nx[o]===i))return n(s)})},Ox=In({patchProp:Px},px);let $g;function Mx(){return $g||($g=FT(Ox))}const Lx=(...n)=>{const e=Mx().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=$x(r);if(!s)return;const i=e._component;!Ke(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,Fx(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function Fx(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function $x(n){return an(n)?document.querySelector(n):n}const Ux={__name:"App",setup(n){return(e,t)=>{const r=wT("router-view");return M(),Sp(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Zo=typeof document<"u";function s0(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function jx(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&s0(n.default)}const vt=Object.assign;function Wh(n,e){const t={};for(const r in e){const s=e[r];t[r]=Dr(s)?s.map(n):n(s)}return t}const Kl=()=>{},Dr=Array.isArray,i0=/#/g,Bx=/&/g,qx=/\//g,zx=/=/g,Gx=/\?/g,o0=/\+/g,Kx=/%5B/g,Hx=/%5D/g,a0=/%5E/g,Wx=/%60/g,l0=/%7B/g,Qx=/%7C/g,u0=/%7D/g,Jx=/%20/g;function Rp(n){return encodeURI(""+n).replace(Qx,"|").replace(Kx,"[").replace(Hx,"]")}function Yx(n){return Rp(n).replace(l0,"{").replace(u0,"}").replace(a0,"^")}function Rf(n){return Rp(n).replace(o0,"%2B").replace(Jx,"+").replace(i0,"%23").replace(Bx,"%26").replace(Wx,"`").replace(l0,"{").replace(u0,"}").replace(a0,"^")}function Xx(n){return Rf(n).replace(zx,"%3D")}function Zx(n){return Rp(n).replace(i0,"%23").replace(Gx,"%3F")}function eA(n){return n==null?"":Zx(n).replace(qx,"%2F")}function iu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const tA=/\/$/,nA=n=>n.replace(tA,"");function Qh(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=oA(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:iu(o)}}function rA(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Ug(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function sA(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&va(e.matched[r],t.matched[s])&&c0(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function va(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function c0(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!iA(n[t],e[t]))return!1;return!0}function iA(n,e){return Dr(n)?jg(n,e):Dr(e)?jg(e,n):n===e}function jg(n,e){return Dr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function oA(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Gs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var ou;(function(n){n.pop="pop",n.push="push"})(ou||(ou={}));var Hl;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Hl||(Hl={}));function aA(n){if(!n)if(Zo){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),nA(n)}const lA=/^[^#]+#/;function uA(n,e){return n.replace(lA,"#")+e}function cA(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Kd=()=>({left:window.scrollX,top:window.scrollY});function dA(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=cA(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Bg(n,e){return(history.state?history.state.position-e:-1)+n}const Cf=new Map;function hA(n,e){Cf.set(n,e)}function fA(n){const e=Cf.get(n);return Cf.delete(n),e}let pA=()=>location.protocol+"//"+location.host;function d0(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Ug(l,"")}return Ug(t,n)+r+s}function mA(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=d0(n,location),R=t.value,x=e.value;let V=0;if(g){if(t.value=y,e.value=g,o&&o===R){o=null;return}V=x?g.position-x.position:0}else r(y);s.forEach(B=>{B(t.value,R,{delta:V,type:ou.pop,direction:V?V>0?Hl.forward:Hl.back:Hl.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const R=s.indexOf(g);R>-1&&s.splice(R,1)};return i.push(y),y}function d(){const{history:g}=window;g.state&&g.replaceState(vt({},g.state,{scroll:Kd()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function qg(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Kd():null}}function gA(n){const{history:e,location:t}=window,r={value:d0(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:pA()+n+l;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](g)}}function o(l,c){const d=vt({},e.state,qg(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=vt({},s.value,e.state,{forward:l,scroll:Kd()});i(d.current,d,!0);const f=vt({},qg(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function vA(n){n=aA(n);const e=gA(n),t=mA(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=vt({location:"",base:n,go:r,createHref:uA.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function yA(n){return typeof n=="string"||n&&typeof n=="object"}function h0(n){return typeof n=="string"||typeof n=="symbol"}const f0=Symbol("");var zg;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(zg||(zg={}));function ya(n,e){return vt(new Error,{type:n,[f0]:!0},e)}function ds(n,e){return n instanceof Error&&f0 in n&&(e==null||!!(n.type&e))}const Gg="[^/]+?",_A={sensitive:!1,strict:!1,start:!0,end:!0},bA=/[.+*?^${}()[\]/\\]/g;function wA(n,e){const t=vt({},_A,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(bA,"\\$&"),y+=40;else if(g.type===1){const{value:R,repeatable:x,optional:V,regexp:B}=g;i.push({name:R,repeatable:x,optional:V});const F=B||Gg;if(F!==Gg){y+=10;try{new RegExp(`(${F})`)}catch(q){throw new Error(`Invalid custom RegExp for param "${R}" (${F}): `+q.message)}}let P=x?`((?:${F})(?:/(?:${F}))*)`:`(${F})`;f||(P=V&&c.length<2?`(?:/${P})`:"/"+P),V&&(P+="?"),s+=P,y+=20,V&&(y+=-8),x&&(y+=-20),F===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const y=d[g]||"",R=i[g-1];f[R.name]=y&&R.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of g)if(y.type===0)d+=y.value;else if(y.type===1){const{value:R,repeatable:x,optional:V}=y,B=R in c?c[R]:"";if(Dr(B)&&!x)throw new Error(`Provided param "${R}" is an array but it is not repeatable (* or + modifiers)`);const F=Dr(B)?B.join("/"):B;if(!F)if(V)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${R}"`);d+=F}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function IA(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function p0(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=IA(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(Kg(r))return 1;if(Kg(s))return-1}return s.length-r.length}function Kg(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const EA={type:0,value:""},TA=/[a-zA-Z0-9_]/;function xA(n){if(!n)return[[]];if(n==="/")return[[EA]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:TA.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function AA(n,e,t){const r=wA(xA(n.path),t),s=vt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function SA(n,e){const t=[],r=new Map;e=Jg({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const R=!y,x=Wg(f);x.aliasOf=y&&y.record;const V=Jg(e,f),B=[x];if("alias"in f){const q=typeof f.alias=="string"?[f.alias]:f.alias;for(const X of q)B.push(Wg(vt({},x,{components:y?y.record.components:x.components,path:X,aliasOf:y?y.record:x})))}let F,P;for(const q of B){const{path:X}=q;if(g&&X[0]!=="/"){const pe=g.record.path,T=pe[pe.length-1]==="/"?"":"/";q.path=g.record.path+(X&&T+X)}if(F=AA(q,g,V),y?y.alias.push(F):(P=P||F,P!==F&&P.alias.push(F),R&&f.name&&!Qg(F)&&o(f.name)),m0(F)&&l(F),x.children){const pe=x.children;for(let T=0;T<pe.length;T++)i(pe[T],F,y&&y.children[T])}y=y||F}return P?()=>{o(P)}:Kl}function o(f){if(h0(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=CA(f,t);t.splice(g,0,f),f.record.name&&!Qg(f)&&r.set(f.record.name,f)}function c(f,g){let y,R={},x,V;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw ya(1,{location:f});V=y.record.name,R=vt(Hg(g.params,y.keys.filter(P=>!P.optional).concat(y.parent?y.parent.keys.filter(P=>P.optional):[]).map(P=>P.name)),f.params&&Hg(f.params,y.keys.map(P=>P.name))),x=y.stringify(R)}else if(f.path!=null)x=f.path,y=t.find(P=>P.re.test(x)),y&&(R=y.parse(x),V=y.record.name);else{if(y=g.name?r.get(g.name):t.find(P=>P.re.test(g.path)),!y)throw ya(1,{location:f,currentLocation:g});V=y.record.name,R=vt({},g.params,f.params),x=y.stringify(R)}const B=[];let F=y;for(;F;)B.unshift(F.record),F=F.parent;return{name:V,path:x,params:R,matched:B,meta:RA(B)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function Hg(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Wg(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:PA(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function PA(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Qg(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function RA(n){return n.reduce((e,t)=>vt(e,t.meta),{})}function Jg(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function CA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;p0(n,e[i])<0?r=i:t=i+1}const s=kA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function kA(n){let e=n;for(;e=e.parent;)if(m0(e)&&p0(n,e)===0)return e}function m0({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function DA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(o0," "),o=i.indexOf("="),a=iu(o<0?i:i.slice(0,o)),l=o<0?null:iu(i.slice(o+1));if(a in e){let c=e[a];Dr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Yg(n){let e="";for(let t in n){const r=n[t];if(t=Xx(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Dr(r)?r.map(i=>i&&Rf(i)):[r&&Rf(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function VA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Dr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const NA=Symbol(""),Xg=Symbol(""),Hd=Symbol(""),Cp=Symbol(""),kf=Symbol("");function El(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Ys(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(ya(4,{from:t,to:e})):g instanceof Error?l(g):yA(g)?l(ya(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function Jh(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(s0(l)){const d=(l.__vccOpts||l)[e];d&&i.push(Ys(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=jx(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&Ys(y,t,r,o,a,s)()}))}}return i}function Zg(n){const e=kr(Hd),t=kr(Cp),r=ze(()=>{const l=_s(n.to);return e.resolve(l)}),s=ze(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(va.bind(null,d));if(g>-1)return g;const y=ev(l[c-2]);return c>1&&ev(d)===y&&f[f.length-1].path!==y?f.findIndex(va.bind(null,l[c-2])):g}),i=ze(()=>s.value>-1&&$A(t.params,r.value.params)),o=ze(()=>s.value>-1&&s.value===t.matched.length-1&&c0(t.params,r.value.params));function a(l={}){if(FA(l)){const c=e[_s(n.replace)?"replace":"push"](_s(n.to)).catch(Kl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:ze(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function OA(n){return n.length===1?n[0]:n}const MA=R_({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Zg,setup(n,{slots:e}){const t=Ud(Zg(n)),{options:r}=kr(Hd),s=ze(()=>({[tv(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[tv(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&OA(e.default(t));return n.custom?i:e0("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),LA=MA;function FA(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function $A(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Dr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function ev(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const tv=(n,e,t)=>n??e??t,UA=R_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=kr(kf),s=ze(()=>n.route||r.value),i=kr(Xg,0),o=ze(()=>{let c=_s(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=ze(()=>s.value.matched[o.value]);Mc(Xg,ze(()=>o.value+1)),Mc(NA,a),Mc(kf,s);const l=N();return Ft(()=>[l.value,a.value,n.name],([c,d,f],[g,y,R])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!va(d,y)||!g)&&(d.enterCallbacks[f]||[]).forEach(x=>x(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return nv(t.default,{Component:g,route:c});const y=f.props[d],R=y?y===!0?c.params:typeof y=="function"?y(c):y:null,V=e0(g,vt({},R,e,{onVnodeUnmounted:B=>{B.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return nv(t.default,{Component:V,route:c})||V}}});function nv(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const jA=UA;function BA(n){const e=SA(n.routes,n),t=n.parseQuery||DA,r=n.stringifyQuery||Yg,s=n.history,i=El(),o=El(),a=El(),l=YE(Gs);let c=Gs;Zo&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=Wh.bind(null,K=>""+K),f=Wh.bind(null,eA),g=Wh.bind(null,iu);function y(K,be){let ce,Ae;return h0(K)?(ce=e.getRecordMatcher(K),Ae=be):Ae=K,e.addRoute(Ae,ce)}function R(K){const be=e.getRecordMatcher(K);be&&e.removeRoute(be)}function x(){return e.getRoutes().map(K=>K.record)}function V(K){return!!e.getRecordMatcher(K)}function B(K,be){if(be=vt({},be||l.value),typeof K=="string"){const S=Qh(t,K,be.path),O=e.resolve({path:S.path},be),Z=s.createHref(S.fullPath);return vt(S,O,{params:g(O.params),hash:iu(S.hash),redirectedFrom:void 0,href:Z})}let ce;if(K.path!=null)ce=vt({},K,{path:Qh(t,K.path,be.path).path});else{const S=vt({},K.params);for(const O in S)S[O]==null&&delete S[O];ce=vt({},K,{params:f(S)}),be.params=f(be.params)}const Ae=e.resolve(ce,be),We=K.hash||"";Ae.params=d(g(Ae.params));const ut=rA(r,vt({},K,{hash:Yx(We),path:Ae.path})),E=s.createHref(ut);return vt({fullPath:ut,hash:We,query:r===Yg?VA(K.query):K.query||{}},Ae,{redirectedFrom:void 0,href:E})}function F(K){return typeof K=="string"?Qh(t,K,l.value.path):vt({},K)}function P(K,be){if(c!==K)return ya(8,{from:be,to:K})}function q(K){return T(K)}function X(K){return q(vt(F(K),{replace:!0}))}function pe(K){const be=K.matched[K.matched.length-1];if(be&&be.redirect){const{redirect:ce}=be;let Ae=typeof ce=="function"?ce(K):ce;return typeof Ae=="string"&&(Ae=Ae.includes("?")||Ae.includes("#")?Ae=F(Ae):{path:Ae},Ae.params={}),vt({query:K.query,hash:K.hash,params:Ae.path!=null?{}:K.params},Ae)}}function T(K,be){const ce=c=B(K),Ae=l.value,We=K.state,ut=K.force,E=K.replace===!0,S=pe(ce);if(S)return T(vt(F(S),{state:typeof S=="object"?vt({},We,S.state):We,force:ut,replace:E}),be||ce);const O=ce;O.redirectedFrom=be;let Z;return!ut&&sA(r,Ae,ce)&&(Z=ya(16,{to:O,from:Ae}),Ve(Ae,Ae,!0,!1)),(Z?Promise.resolve(Z):C(O,Ae)).catch(J=>ds(J)?ds(J,2)?J:te(J):Ue(J,O,Ae)).then(J=>{if(J){if(ds(J,2))return T(vt({replace:E},F(J.to),{state:typeof J.to=="object"?vt({},We,J.to.state):We,force:ut}),be||O)}else J=$(O,Ae,!0,E,We);return k(O,Ae,J),J})}function w(K,be){const ce=P(K,be);return ce?Promise.reject(ce):Promise.resolve()}function I(K){const be=Ne.values().next().value;return be&&typeof be.runWithContext=="function"?be.runWithContext(K):K()}function C(K,be){let ce;const[Ae,We,ut]=qA(K,be);ce=Jh(Ae.reverse(),"beforeRouteLeave",K,be);for(const S of Ae)S.leaveGuards.forEach(O=>{ce.push(Ys(O,K,be))});const E=w.bind(null,K,be);return ce.push(E),Ze(ce).then(()=>{ce=[];for(const S of i.list())ce.push(Ys(S,K,be));return ce.push(E),Ze(ce)}).then(()=>{ce=Jh(We,"beforeRouteUpdate",K,be);for(const S of We)S.updateGuards.forEach(O=>{ce.push(Ys(O,K,be))});return ce.push(E),Ze(ce)}).then(()=>{ce=[];for(const S of ut)if(S.beforeEnter)if(Dr(S.beforeEnter))for(const O of S.beforeEnter)ce.push(Ys(O,K,be));else ce.push(Ys(S.beforeEnter,K,be));return ce.push(E),Ze(ce)}).then(()=>(K.matched.forEach(S=>S.enterCallbacks={}),ce=Jh(ut,"beforeRouteEnter",K,be,I),ce.push(E),Ze(ce))).then(()=>{ce=[];for(const S of o.list())ce.push(Ys(S,K,be));return ce.push(E),Ze(ce)}).catch(S=>ds(S,8)?S:Promise.reject(S))}function k(K,be,ce){a.list().forEach(Ae=>I(()=>Ae(K,be,ce)))}function $(K,be,ce,Ae,We){const ut=P(K,be);if(ut)return ut;const E=be===Gs,S=Zo?history.state:{};ce&&(Ae||E?s.replace(K.fullPath,vt({scroll:E&&S&&S.scroll},We)):s.push(K.fullPath,We)),l.value=K,Ve(K,be,ce,E),te()}let A;function Vt(){A||(A=s.listen((K,be,ce)=>{if(!Je.listening)return;const Ae=B(K),We=pe(Ae);if(We){T(vt(We,{replace:!0,force:!0}),Ae).catch(Kl);return}c=Ae;const ut=l.value;Zo&&hA(Bg(ut.fullPath,ce.delta),Kd()),C(Ae,ut).catch(E=>ds(E,12)?E:ds(E,2)?(T(vt(F(E.to),{force:!0}),Ae).then(S=>{ds(S,20)&&!ce.delta&&ce.type===ou.pop&&s.go(-1,!1)}).catch(Kl),Promise.reject()):(ce.delta&&s.go(-ce.delta,!1),Ue(E,Ae,ut))).then(E=>{E=E||$(Ae,ut,!1),E&&(ce.delta&&!ds(E,8)?s.go(-ce.delta,!1):ce.type===ou.pop&&ds(E,20)&&s.go(-1,!1)),k(Ae,ut,E)}).catch(Kl)}))}let Pt=El(),tt=El(),$e;function Ue(K,be,ce){te(K);const Ae=tt.list();return Ae.length?Ae.forEach(We=>We(K,be,ce)):console.error(K),Promise.reject(K)}function De(){return $e&&l.value!==Gs?Promise.resolve():new Promise((K,be)=>{Pt.add([K,be])})}function te(K){return $e||($e=!K,Vt(),Pt.list().forEach(([be,ce])=>K?ce(K):be()),Pt.reset()),K}function Ve(K,be,ce,Ae){const{scrollBehavior:We}=n;if(!Zo||!We)return Promise.resolve();const ut=!ce&&fA(Bg(K.fullPath,0))||(Ae||!ce)&&history.state&&history.state.scroll||null;return hn().then(()=>We(K,be,ut)).then(E=>E&&dA(E)).catch(E=>Ue(E,K,be))}const W=K=>s.go(K);let Y;const Ne=new Set,Je={currentRoute:l,listening:!0,addRoute:y,removeRoute:R,clearRoutes:e.clearRoutes,hasRoute:V,getRoutes:x,resolve:B,options:n,push:q,replace:X,go:W,back:()=>W(-1),forward:()=>W(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:tt.add,isReady:De,install(K){const be=this;K.component("RouterLink",LA),K.component("RouterView",jA),K.config.globalProperties.$router=be,Object.defineProperty(K.config.globalProperties,"$route",{enumerable:!0,get:()=>_s(l)}),Zo&&!Y&&l.value===Gs&&(Y=!0,q(s.location).catch(We=>{}));const ce={};for(const We in Gs)Object.defineProperty(ce,We,{get:()=>l.value[We],enumerable:!0});K.provide(Hd,be),K.provide(Cp,b_(ce)),K.provide(kf,l);const Ae=K.unmount;Ne.add(K),K.unmount=function(){Ne.delete(K),Ne.size<1&&(c=Gs,A&&A(),A=null,l.value=Gs,Y=!1,$e=!1),Ae()}}};function Ze(K){return K.reduce((be,ce)=>be.then(()=>I(ce)),Promise.resolve())}return Je}function qA(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>va(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>va(c,l))||s.push(l))}return[t,r,s]}function Ru(){return kr(Hd)}function Fa(n){return kr(Cp)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g0=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},zA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},v0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[d],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(g0(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):zA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new GA;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const R=c<<6&192|f;r.push(R)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class GA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const KA=function(n){const e=g0(n);return v0.encodeByteArray(e,!0)},cd=function(n){return KA(n).replace(/\./g,"")},y0=function(n){try{return v0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WA=()=>HA().__FIREBASE_DEFAULTS__,QA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},JA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&y0(n[1]);return e&&JSON.parse(e)},Wd=()=>{try{return WA()||QA()||JA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},_0=n=>{var e,t;return(t=(e=Wd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},YA=n=>{const e=_0(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},b0=()=>{var n;return(n=Wd())===null||n===void 0?void 0:n.config},w0=n=>{var e;return(e=Wd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[cd(JSON.stringify(t)),cd(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function eS(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pn())}function tS(){var n;const e=(n=Wd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function nS(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function rS(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function sS(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function iS(){const n=pn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function I0(){return!tS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E0(){try{return typeof indexedDB=="object"}catch{return!1}}function oS(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS="FirebaseError";class Cs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=aS,Object.setPrototypeOf(this,Cs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Cu.prototype.create)}}class Cu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?lS(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Cs(s,a,r)}}function lS(n,e){return n.replace(uS,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const uS=/\{\$([^}]+)}/g;function cS(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function gi(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(rv(i)&&rv(o)){if(!gi(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function rv(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $a(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function kl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Dl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function dS(n,e){const t=new hS(n,e);return t.subscribe.bind(t)}class hS{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");fS(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Yh),s.error===void 0&&(s.error=Yh),s.complete===void 0&&(s.complete=Yh);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function fS(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Yh(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(n){return n&&n._delegate?n._delegate:n}class uo{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pS{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new XA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gS(e))try{this.getOrInitializeService({instanceIdentifier:Qi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Qi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Qi){return this.instances.has(e)}getOptions(e=Qi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:mS(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Qi){return this.component?this.component.multipleInstances?e:Qi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mS(n){return n===Qi?void 0:n}function gS(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new pS(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var st;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(st||(st={}));const yS={debug:st.DEBUG,verbose:st.VERBOSE,info:st.INFO,warn:st.WARN,error:st.ERROR,silent:st.SILENT},_S=st.INFO,bS={[st.DEBUG]:"log",[st.VERBOSE]:"log",[st.INFO]:"info",[st.WARN]:"warn",[st.ERROR]:"error"},wS=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=bS[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class kp{constructor(e){this.name=e,this._logLevel=_S,this._logHandler=wS,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in st))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?yS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,st.DEBUG,...e),this._logHandler(this,st.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,st.VERBOSE,...e),this._logHandler(this,st.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,st.INFO,...e),this._logHandler(this,st.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,st.WARN,...e),this._logHandler(this,st.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,st.ERROR,...e),this._logHandler(this,st.ERROR,...e)}}const IS=(n,e)=>e.some(t=>n instanceof t);let sv,iv;function ES(){return sv||(sv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function TS(){return iv||(iv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const T0=new WeakMap,Df=new WeakMap,x0=new WeakMap,Xh=new WeakMap,Dp=new WeakMap;function xS(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(li(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&T0.set(t,n)}).catch(()=>{}),Dp.set(e,n),e}function AS(n){if(Df.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Df.set(n,e)}let Vf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Df.get(n);if(e==="objectStoreNames")return n.objectStoreNames||x0.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return li(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function SS(n){Vf=n(Vf)}function PS(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Zh(this),e,...t);return x0.set(r,e.sort?e.sort():[e]),li(r)}:TS().includes(n)?function(...e){return n.apply(Zh(this),e),li(T0.get(this))}:function(...e){return li(n.apply(Zh(this),e))}}function RS(n){return typeof n=="function"?PS(n):(n instanceof IDBTransaction&&AS(n),IS(n,ES())?new Proxy(n,Vf):n)}function li(n){if(n instanceof IDBRequest)return xS(n);if(Xh.has(n))return Xh.get(n);const e=RS(n);return e!==n&&(Xh.set(n,e),Dp.set(e,n)),e}const Zh=n=>Dp.get(n);function CS(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=li(o);return r&&o.addEventListener("upgradeneeded",l=>{r(li(o.result),l.oldVersion,l.newVersion,li(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const kS=["get","getKey","getAll","getAllKeys","count"],DS=["put","add","delete","clear"],ef=new Map;function ov(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ef.get(e))return ef.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=DS.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||kS.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return ef.set(e,i),i}SS(n=>({...n,get:(e,t,r)=>ov(e,t)||n.get(e,t,r),has:(e,t)=>!!ov(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(NS(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function NS(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Nf="@firebase/app",av="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Es=new kp("@firebase/app"),OS="@firebase/app-compat",MS="@firebase/analytics-compat",LS="@firebase/analytics",FS="@firebase/app-check-compat",$S="@firebase/app-check",US="@firebase/auth",jS="@firebase/auth-compat",BS="@firebase/database",qS="@firebase/data-connect",zS="@firebase/database-compat",GS="@firebase/functions",KS="@firebase/functions-compat",HS="@firebase/installations",WS="@firebase/installations-compat",QS="@firebase/messaging",JS="@firebase/messaging-compat",YS="@firebase/performance",XS="@firebase/performance-compat",ZS="@firebase/remote-config",eP="@firebase/remote-config-compat",tP="@firebase/storage",nP="@firebase/storage-compat",rP="@firebase/firestore",sP="@firebase/vertexai-preview",iP="@firebase/firestore-compat",oP="firebase",aP="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dd="[DEFAULT]",lP={[Nf]:"fire-core",[OS]:"fire-core-compat",[LS]:"fire-analytics",[MS]:"fire-analytics-compat",[$S]:"fire-app-check",[FS]:"fire-app-check-compat",[US]:"fire-auth",[jS]:"fire-auth-compat",[BS]:"fire-rtdb",[qS]:"fire-data-connect",[zS]:"fire-rtdb-compat",[GS]:"fire-fn",[KS]:"fire-fn-compat",[HS]:"fire-iid",[WS]:"fire-iid-compat",[QS]:"fire-fcm",[JS]:"fire-fcm-compat",[YS]:"fire-perf",[XS]:"fire-perf-compat",[ZS]:"fire-rc",[eP]:"fire-rc-compat",[tP]:"fire-gcs",[nP]:"fire-gcs-compat",[rP]:"fire-fst",[iP]:"fire-fst-compat",[sP]:"fire-vertex","fire-js":"fire-js",[oP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hd=new Map,uP=new Map,Of=new Map;function lv(n,e){try{n.container.addComponent(e)}catch(t){Es.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function _a(n){const e=n.name;if(Of.has(e))return Es.debug(`There were multiple attempts to register component ${e}.`),!1;Of.set(e,n);for(const t of hd.values())lv(t,n);for(const t of uP.values())lv(t,n);return!0}function ku(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function cP(n,e,t=dd){ku(n,e).clearInstance(t)}function Zt(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ui=new Cu("app","Firebase",dP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new uo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ui.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua=aP;function A0(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:dd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw ui.create("bad-app-name",{appName:String(s)});if(t||(t=b0()),!t)throw ui.create("no-options");const i=hd.get(s);if(i){if(gi(t,i.options)&&gi(r,i.config))return i;throw ui.create("duplicate-app",{appName:s})}const o=new vS(s);for(const l of Of.values())o.addComponent(l);const a=new hP(t,r,o);return hd.set(s,a),a}function S0(n=dd){const e=hd.get(n);if(!e&&n===dd&&b0())return A0();if(!e)throw ui.create("no-app",{appName:n});return e}function ci(n,e,t){var r;let s=(r=lP[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Es.warn(a.join(" "));return}_a(new uo(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fP="firebase-heartbeat-database",pP=1,au="firebase-heartbeat-store";let tf=null;function P0(){return tf||(tf=CS(fP,pP,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(au)}catch(t){console.warn(t)}}}}).catch(n=>{throw ui.create("idb-open",{originalErrorMessage:n.message})})),tf}async function mP(n){try{const t=(await P0()).transaction(au),r=await t.objectStore(au).get(R0(n));return await t.done,r}catch(e){if(e instanceof Cs)Es.warn(e.message);else{const t=ui.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Es.warn(t.message)}}}async function uv(n,e){try{const r=(await P0()).transaction(au,"readwrite");await r.objectStore(au).put(e,R0(n)),await r.done}catch(t){if(t instanceof Cs)Es.warn(t.message);else{const r=ui.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Es.warn(r.message)}}}function R0(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gP=1024,vP=30*24*60*60*1e3;class yP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new bP(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=cv();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=vP}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Es.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=cv(),{heartbeatsToSend:r,unsentEntries:s}=_P(this._heartbeatsCache.heartbeats),i=cd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Es.warn(t),""}}}function cv(){return new Date().toISOString().substring(0,10)}function _P(n,e=gP){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),dv(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),dv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class bP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return E0()?oS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await mP(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return uv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return uv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function dv(n){return cd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wP(n){_a(new uo("platform-logger",e=>new VS(e),"PRIVATE")),_a(new uo("heartbeat",e=>new yP(e),"PRIVATE")),ci(Nf,av,n),ci(Nf,av,"esm2017"),ci("fire-js","")}wP("");var IP="firebase",EP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ci(IP,EP,"app");var hv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var io,C0;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,w){function I(){}I.prototype=w.prototype,T.D=w.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(C,k,$){for(var A=Array(arguments.length-2),Vt=2;Vt<arguments.length;Vt++)A[Vt-2]=arguments[Vt];return w.prototype[k].apply(C,A)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,w,I){I||(I=0);var C=Array(16);if(typeof w=="string")for(var k=0;16>k;++k)C[k]=w.charCodeAt(I++)|w.charCodeAt(I++)<<8|w.charCodeAt(I++)<<16|w.charCodeAt(I++)<<24;else for(k=0;16>k;++k)C[k]=w[I++]|w[I++]<<8|w[I++]<<16|w[I++]<<24;w=T.g[0],I=T.g[1],k=T.g[2];var $=T.g[3],A=w+($^I&(k^$))+C[0]+3614090360&4294967295;w=I+(A<<7&4294967295|A>>>25),A=$+(k^w&(I^k))+C[1]+3905402710&4294967295,$=w+(A<<12&4294967295|A>>>20),A=k+(I^$&(w^I))+C[2]+606105819&4294967295,k=$+(A<<17&4294967295|A>>>15),A=I+(w^k&($^w))+C[3]+3250441966&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+($^I&(k^$))+C[4]+4118548399&4294967295,w=I+(A<<7&4294967295|A>>>25),A=$+(k^w&(I^k))+C[5]+1200080426&4294967295,$=w+(A<<12&4294967295|A>>>20),A=k+(I^$&(w^I))+C[6]+2821735955&4294967295,k=$+(A<<17&4294967295|A>>>15),A=I+(w^k&($^w))+C[7]+4249261313&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+($^I&(k^$))+C[8]+1770035416&4294967295,w=I+(A<<7&4294967295|A>>>25),A=$+(k^w&(I^k))+C[9]+2336552879&4294967295,$=w+(A<<12&4294967295|A>>>20),A=k+(I^$&(w^I))+C[10]+4294925233&4294967295,k=$+(A<<17&4294967295|A>>>15),A=I+(w^k&($^w))+C[11]+2304563134&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+($^I&(k^$))+C[12]+1804603682&4294967295,w=I+(A<<7&4294967295|A>>>25),A=$+(k^w&(I^k))+C[13]+4254626195&4294967295,$=w+(A<<12&4294967295|A>>>20),A=k+(I^$&(w^I))+C[14]+2792965006&4294967295,k=$+(A<<17&4294967295|A>>>15),A=I+(w^k&($^w))+C[15]+1236535329&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(k^$&(I^k))+C[1]+4129170786&4294967295,w=I+(A<<5&4294967295|A>>>27),A=$+(I^k&(w^I))+C[6]+3225465664&4294967295,$=w+(A<<9&4294967295|A>>>23),A=k+(w^I&($^w))+C[11]+643717713&4294967295,k=$+(A<<14&4294967295|A>>>18),A=I+($^w&(k^$))+C[0]+3921069994&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^$&(I^k))+C[5]+3593408605&4294967295,w=I+(A<<5&4294967295|A>>>27),A=$+(I^k&(w^I))+C[10]+38016083&4294967295,$=w+(A<<9&4294967295|A>>>23),A=k+(w^I&($^w))+C[15]+3634488961&4294967295,k=$+(A<<14&4294967295|A>>>18),A=I+($^w&(k^$))+C[4]+3889429448&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^$&(I^k))+C[9]+568446438&4294967295,w=I+(A<<5&4294967295|A>>>27),A=$+(I^k&(w^I))+C[14]+3275163606&4294967295,$=w+(A<<9&4294967295|A>>>23),A=k+(w^I&($^w))+C[3]+4107603335&4294967295,k=$+(A<<14&4294967295|A>>>18),A=I+($^w&(k^$))+C[8]+1163531501&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^$&(I^k))+C[13]+2850285829&4294967295,w=I+(A<<5&4294967295|A>>>27),A=$+(I^k&(w^I))+C[2]+4243563512&4294967295,$=w+(A<<9&4294967295|A>>>23),A=k+(w^I&($^w))+C[7]+1735328473&4294967295,k=$+(A<<14&4294967295|A>>>18),A=I+($^w&(k^$))+C[12]+2368359562&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(I^k^$)+C[5]+4294588738&4294967295,w=I+(A<<4&4294967295|A>>>28),A=$+(w^I^k)+C[8]+2272392833&4294967295,$=w+(A<<11&4294967295|A>>>21),A=k+($^w^I)+C[11]+1839030562&4294967295,k=$+(A<<16&4294967295|A>>>16),A=I+(k^$^w)+C[14]+4259657740&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^$)+C[1]+2763975236&4294967295,w=I+(A<<4&4294967295|A>>>28),A=$+(w^I^k)+C[4]+1272893353&4294967295,$=w+(A<<11&4294967295|A>>>21),A=k+($^w^I)+C[7]+4139469664&4294967295,k=$+(A<<16&4294967295|A>>>16),A=I+(k^$^w)+C[10]+3200236656&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^$)+C[13]+681279174&4294967295,w=I+(A<<4&4294967295|A>>>28),A=$+(w^I^k)+C[0]+3936430074&4294967295,$=w+(A<<11&4294967295|A>>>21),A=k+($^w^I)+C[3]+3572445317&4294967295,k=$+(A<<16&4294967295|A>>>16),A=I+(k^$^w)+C[6]+76029189&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^$)+C[9]+3654602809&4294967295,w=I+(A<<4&4294967295|A>>>28),A=$+(w^I^k)+C[12]+3873151461&4294967295,$=w+(A<<11&4294967295|A>>>21),A=k+($^w^I)+C[15]+530742520&4294967295,k=$+(A<<16&4294967295|A>>>16),A=I+(k^$^w)+C[2]+3299628645&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(k^(I|~$))+C[0]+4096336452&4294967295,w=I+(A<<6&4294967295|A>>>26),A=$+(I^(w|~k))+C[7]+1126891415&4294967295,$=w+(A<<10&4294967295|A>>>22),A=k+(w^($|~I))+C[14]+2878612391&4294967295,k=$+(A<<15&4294967295|A>>>17),A=I+($^(k|~w))+C[5]+4237533241&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~$))+C[12]+1700485571&4294967295,w=I+(A<<6&4294967295|A>>>26),A=$+(I^(w|~k))+C[3]+2399980690&4294967295,$=w+(A<<10&4294967295|A>>>22),A=k+(w^($|~I))+C[10]+4293915773&4294967295,k=$+(A<<15&4294967295|A>>>17),A=I+($^(k|~w))+C[1]+2240044497&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~$))+C[8]+1873313359&4294967295,w=I+(A<<6&4294967295|A>>>26),A=$+(I^(w|~k))+C[15]+4264355552&4294967295,$=w+(A<<10&4294967295|A>>>22),A=k+(w^($|~I))+C[6]+2734768916&4294967295,k=$+(A<<15&4294967295|A>>>17),A=I+($^(k|~w))+C[13]+1309151649&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~$))+C[4]+4149444226&4294967295,w=I+(A<<6&4294967295|A>>>26),A=$+(I^(w|~k))+C[11]+3174756917&4294967295,$=w+(A<<10&4294967295|A>>>22),A=k+(w^($|~I))+C[2]+718787259&4294967295,k=$+(A<<15&4294967295|A>>>17),A=I+($^(k|~w))+C[9]+3951481745&4294967295,T.g[0]=T.g[0]+w&4294967295,T.g[1]=T.g[1]+(k+(A<<21&4294967295|A>>>11))&4294967295,T.g[2]=T.g[2]+k&4294967295,T.g[3]=T.g[3]+$&4294967295}r.prototype.u=function(T,w){w===void 0&&(w=T.length);for(var I=w-this.blockSize,C=this.B,k=this.h,$=0;$<w;){if(k==0)for(;$<=I;)s(this,T,$),$+=this.blockSize;if(typeof T=="string"){for(;$<w;)if(C[k++]=T.charCodeAt($++),k==this.blockSize){s(this,C),k=0;break}}else for(;$<w;)if(C[k++]=T[$++],k==this.blockSize){s(this,C),k=0;break}}this.h=k,this.o+=w},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var w=1;w<T.length-8;++w)T[w]=0;var I=8*this.o;for(w=T.length-8;w<T.length;++w)T[w]=I&255,I/=256;for(this.u(T),T=Array(16),w=I=0;4>w;++w)for(var C=0;32>C;C+=8)T[I++]=this.g[w]>>>C&255;return T};function i(T,w){var I=a;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=w(T)}function o(T,w){this.h=w;for(var I=[],C=!0,k=T.length-1;0<=k;k--){var $=T[k]|0;C&&$==w||(I[k]=$,C=!1)}this.g=I}var a={};function l(T){return-128<=T&&128>T?i(T,function(w){return new o([w|0],0>w?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return V(c(-T));for(var w=[],I=1,C=0;T>=I;C++)w[C]=T/I|0,I*=4294967296;return new o(w,0)}function d(T,w){if(T.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(T.charAt(0)=="-")return V(d(T.substring(1),w));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=c(Math.pow(w,8)),C=f,k=0;k<T.length;k+=8){var $=Math.min(8,T.length-k),A=parseInt(T.substring(k,k+$),w);8>$?($=c(Math.pow(w,$)),C=C.j($).add(c(A))):(C=C.j(I),C=C.add(c(A)))}return C}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(x(this))return-V(this).m();for(var T=0,w=1,I=0;I<this.g.length;I++){var C=this.i(I);T+=(0<=C?C:4294967296+C)*w,w*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(R(this))return"0";if(x(this))return"-"+V(this).toString(T);for(var w=c(Math.pow(T,6)),I=this,C="";;){var k=q(I,w).g;I=B(I,k.j(w));var $=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=k,R(I))return $+C;for(;6>$.length;)$="0"+$;C=$+C}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function R(T){if(T.h!=0)return!1;for(var w=0;w<T.g.length;w++)if(T.g[w]!=0)return!1;return!0}function x(T){return T.h==-1}n.l=function(T){return T=B(this,T),x(T)?-1:R(T)?0:1};function V(T){for(var w=T.g.length,I=[],C=0;C<w;C++)I[C]=~T.g[C];return new o(I,~T.h).add(g)}n.abs=function(){return x(this)?V(this):this},n.add=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0,k=0;k<=w;k++){var $=C+(this.i(k)&65535)+(T.i(k)&65535),A=($>>>16)+(this.i(k)>>>16)+(T.i(k)>>>16);C=A>>>16,$&=65535,A&=65535,I[k]=A<<16|$}return new o(I,I[I.length-1]&-2147483648?-1:0)};function B(T,w){return T.add(V(w))}n.j=function(T){if(R(this)||R(T))return f;if(x(this))return x(T)?V(this).j(V(T)):V(V(this).j(T));if(x(T))return V(this.j(V(T)));if(0>this.l(y)&&0>T.l(y))return c(this.m()*T.m());for(var w=this.g.length+T.g.length,I=[],C=0;C<2*w;C++)I[C]=0;for(C=0;C<this.g.length;C++)for(var k=0;k<T.g.length;k++){var $=this.i(C)>>>16,A=this.i(C)&65535,Vt=T.i(k)>>>16,Pt=T.i(k)&65535;I[2*C+2*k]+=A*Pt,F(I,2*C+2*k),I[2*C+2*k+1]+=$*Pt,F(I,2*C+2*k+1),I[2*C+2*k+1]+=A*Vt,F(I,2*C+2*k+1),I[2*C+2*k+2]+=$*Vt,F(I,2*C+2*k+2)}for(C=0;C<w;C++)I[C]=I[2*C+1]<<16|I[2*C];for(C=w;C<2*w;C++)I[C]=0;return new o(I,0)};function F(T,w){for(;(T[w]&65535)!=T[w];)T[w+1]+=T[w]>>>16,T[w]&=65535,w++}function P(T,w){this.g=T,this.h=w}function q(T,w){if(R(w))throw Error("division by zero");if(R(T))return new P(f,f);if(x(T))return w=q(V(T),w),new P(V(w.g),V(w.h));if(x(w))return w=q(T,V(w)),new P(V(w.g),w.h);if(30<T.g.length){if(x(T)||x(w))throw Error("slowDivide_ only works with positive integers.");for(var I=g,C=w;0>=C.l(T);)I=X(I),C=X(C);var k=pe(I,1),$=pe(C,1);for(C=pe(C,2),I=pe(I,2);!R(C);){var A=$.add(C);0>=A.l(T)&&(k=k.add(I),$=A),C=pe(C,1),I=pe(I,1)}return w=B(T,k.j(w)),new P(k,w)}for(k=f;0<=T.l(w);){for(I=Math.max(1,Math.floor(T.m()/w.m())),C=Math.ceil(Math.log(I)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),$=c(I),A=$.j(w);x(A)||0<A.l(T);)I-=C,$=c(I),A=$.j(w);R($)&&($=g),k=k.add($),T=B(T,A)}return new P(k,T)}n.A=function(T){return q(this,T).h},n.and=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0;C<w;C++)I[C]=this.i(C)&T.i(C);return new o(I,this.h&T.h)},n.or=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0;C<w;C++)I[C]=this.i(C)|T.i(C);return new o(I,this.h|T.h)},n.xor=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],C=0;C<w;C++)I[C]=this.i(C)^T.i(C);return new o(I,this.h^T.h)};function X(T){for(var w=T.g.length+1,I=[],C=0;C<w;C++)I[C]=T.i(C)<<1|T.i(C-1)>>>31;return new o(I,T.h)}function pe(T,w){var I=w>>5;w%=32;for(var C=T.g.length-I,k=[],$=0;$<C;$++)k[$]=0<w?T.i($+I)>>>w|T.i($+I+1)<<32-w:T.i($+I);return new o(k,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,C0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,io=o}).apply(typeof hv<"u"?hv:typeof self<"u"?self:typeof window<"u"?window:{});var xc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var k0,Vl,D0,Uc,Mf,V0,N0,O0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof xc=="object"&&xc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var U=u[b];if(!(U in v))break e;v=v[U]}u=u[u.length-1],b=v[u],p=p(b),p!=b&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,b=!1,U={next:function(){if(!b&&v<u.length){var G=v++;return{value:p(G,u[G]),done:!1}}return b=!0,{done:!0,value:void 0}}};return U[Symbol.iterator]=function(){return U},U}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function d(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var U=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(U,b),u.apply(p,U)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var b=v.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function R(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(b,U,G){for(var me=Array(arguments.length-2),mt=2;mt<arguments.length;mt++)me[mt-2]=arguments[mt];return p.prototype[U].apply(b,me)}}function x(u){const p=u.length;if(0<p){const v=Array(p);for(let b=0;b<p;b++)v[b]=u[b];return v}return[]}function V(u,p){for(let v=1;v<arguments.length;v++){const b=arguments[v];if(l(b)){const U=u.length||0,G=b.length||0;u.length=U+G;for(let me=0;me<G;me++)u[U+me]=b[me]}else u.push(b)}}class B{constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function F(u){return/^[\s\xa0]*$/.test(u)}function P(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function q(u){return q[" "](u),u}q[" "]=function(){};var X=P().indexOf("Gecko")!=-1&&!(P().toLowerCase().indexOf("webkit")!=-1&&P().indexOf("Edge")==-1)&&!(P().indexOf("Trident")!=-1||P().indexOf("MSIE")!=-1)&&P().indexOf("Edge")==-1;function pe(u,p,v){for(const b in u)p.call(v,u[b],b,u)}function T(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function w(u){const p={};for(const v in u)p[v]=u[v];return p}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,p){let v,b;for(let U=1;U<arguments.length;U++){b=arguments[U];for(v in b)u[v]=b[v];for(let G=0;G<I.length;G++)v=I[G],Object.prototype.hasOwnProperty.call(b,v)&&(u[v]=b[v])}}function k(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function $(u){a.setTimeout(()=>{throw u},0)}function A(){var u=De;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Vt{constructor(){this.h=this.g=null}add(p,v){const b=Pt.get();b.set(p,v),this.h?this.h.next=b:this.g=b,this.h=b}}var Pt=new B(()=>new tt,u=>u.reset());class tt{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let $e,Ue=!1,De=new Vt,te=()=>{const u=a.Promise.resolve(void 0);$e=()=>{u.then(Ve)}};var Ve=()=>{for(var u;u=A();){try{u.h.call(u.g)}catch(v){$(v)}var p=Pt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Ue=!1};function W(){this.s=this.s,this.C=this.C}W.prototype.s=!1,W.prototype.ma=function(){this.s||(this.s=!0,this.N())},W.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Y(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Y.prototype.h=function(){this.defaultPrevented=!0};var Ne=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function Je(u,p){if(Y.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(X){e:{try{q(p.nodeName);var U=!0;break e}catch{}U=!1}U||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Ze[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Je.aa.h.call(this)}}R(Je,Y);var Ze={2:"touch",3:"pen",4:"mouse"};Je.prototype.h=function(){Je.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),be=0;function ce(u,p,v,b,U){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!b,this.ha=U,this.key=++be,this.da=this.fa=!1}function Ae(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function We(u){this.src=u,this.g={},this.h=0}We.prototype.add=function(u,p,v,b,U){var G=u.toString();u=this.g[G],u||(u=this.g[G]=[],this.h++);var me=E(u,p,b,U);return-1<me?(p=u[me],v||(p.fa=!1)):(p=new ce(p,this.src,G,!!b,U),p.fa=v,u.push(p)),p};function ut(u,p){var v=p.type;if(v in u.g){var b=u.g[v],U=Array.prototype.indexOf.call(b,p,void 0),G;(G=0<=U)&&Array.prototype.splice.call(b,U,1),G&&(Ae(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function E(u,p,v,b){for(var U=0;U<u.length;++U){var G=u[U];if(!G.da&&G.listener==p&&G.capture==!!v&&G.ha==b)return U}return-1}var S="closure_lm_"+(1e6*Math.random()|0),O={};function Z(u,p,v,b,U){if(b&&b.once)return ve(u,p,v,b,U);if(Array.isArray(p)){for(var G=0;G<p.length;G++)Z(u,p[G],v,b,U);return null}return v=Re(v),u&&u[K]?u.K(p,v,c(b)?!!b.capture:!!b,U):J(u,p,v,!1,b,U)}function J(u,p,v,b,U,G){if(!p)throw Error("Invalid event type");var me=c(U)?!!U.capture:!!U,mt=we(u);if(mt||(u[S]=mt=new We(u)),v=mt.add(p,v,b,me,G),v.proxy)return v;if(b=ee(),v.proxy=b,b.src=u,b.listener=v,u.addEventListener)Ne||(U=me),U===void 0&&(U=!1),u.addEventListener(p.toString(),b,U);else if(u.attachEvent)u.attachEvent(oe(p.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return v}function ee(){function u(v){return p.call(u.src,u.listener,v)}const p=Ee;return u}function ve(u,p,v,b,U){if(Array.isArray(p)){for(var G=0;G<p.length;G++)ve(u,p[G],v,b,U);return null}return v=Re(v),u&&u[K]?u.L(p,v,c(b)?!!b.capture:!!b,U):J(u,p,v,!0,b,U)}function de(u,p,v,b,U){if(Array.isArray(p))for(var G=0;G<p.length;G++)de(u,p[G],v,b,U);else b=c(b)?!!b.capture:!!b,v=Re(v),u&&u[K]?(u=u.i,p=String(p).toString(),p in u.g&&(G=u.g[p],v=E(G,v,b,U),-1<v&&(Ae(G[v]),Array.prototype.splice.call(G,v,1),G.length==0&&(delete u.g[p],u.h--)))):u&&(u=we(u))&&(p=u.g[p.toString()],u=-1,p&&(u=E(p,v,b,U)),(v=-1<u?p[u]:null)&&ue(v))}function ue(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[K])ut(p.i,u);else{var v=u.type,b=u.proxy;p.removeEventListener?p.removeEventListener(v,b,u.capture):p.detachEvent?p.detachEvent(oe(v),b):p.addListener&&p.removeListener&&p.removeListener(b),(v=we(p))?(ut(v,u),v.h==0&&(v.src=null,p[S]=null)):Ae(u)}}}function oe(u){return u in O?O[u]:O[u]="on"+u}function Ee(u,p){if(u.da)u=!0;else{p=new Je(p,this);var v=u.listener,b=u.ha||u.src;u.fa&&ue(u),u=v.call(b,p)}return u}function we(u){return u=u[S],u instanceof We?u:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function Re(u){return typeof u=="function"?u:(u[Te]||(u[Te]=function(p){return u.handleEvent(p)}),u[Te])}function Oe(){W.call(this),this.i=new We(this),this.M=this,this.F=null}R(Oe,W),Oe.prototype[K]=!0,Oe.prototype.removeEventListener=function(u,p,v,b){de(this,u,p,v,b)};function Be(u,p){var v,b=u.F;if(b)for(v=[];b;b=b.F)v.push(b);if(u=u.M,b=p.type||p,typeof p=="string")p=new Y(p,u);else if(p instanceof Y)p.target=p.target||u;else{var U=p;p=new Y(b,u),C(p,U)}if(U=!0,v)for(var G=v.length-1;0<=G;G--){var me=p.g=v[G];U=Xe(me,b,!0,p)&&U}if(me=p.g=u,U=Xe(me,b,!0,p)&&U,U=Xe(me,b,!1,p)&&U,v)for(G=0;G<v.length;G++)me=p.g=v[G],U=Xe(me,b,!1,p)&&U}Oe.prototype.N=function(){if(Oe.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],b=0;b<v.length;b++)Ae(v[b]);delete u.g[p],u.h--}}this.F=null},Oe.prototype.K=function(u,p,v,b){return this.i.add(String(u),p,!1,v,b)},Oe.prototype.L=function(u,p,v,b){return this.i.add(String(u),p,!0,v,b)};function Xe(u,p,v,b){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var U=!0,G=0;G<p.length;++G){var me=p[G];if(me&&!me.da&&me.capture==v){var mt=me.listener,un=me.ha||me.src;me.fa&&ut(u.i,me),U=mt.call(un,b)!==!1&&U}}return U&&!b.defaultPrevented}function Wt(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function Bt(u){u.g=Wt(()=>{u.g=null,u.i&&(u.i=!1,Bt(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class gn extends W{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Bt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Nt(u){W.call(this),this.h=u,this.g={}}R(Nt,W);var mr=[];function Vr(u){pe(u.g,function(p,v){this.g.hasOwnProperty(v)&&ue(p)},u),u.g={}}Nt.prototype.N=function(){Nt.aa.N.call(this),Vr(this)},Nt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var nn=a.JSON.stringify,Pn=a.JSON.parse,Ci=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function nl(){}nl.prototype.h=null;function Zu(u){return u.h||(u.h=u.i())}function ec(){}var ki={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function rl(){Y.call(this,"d")}R(rl,Y);function Er(){Y.call(this,"c")}R(Er,Y);var Qn={},Tr=null;function xr(){return Tr=Tr||new Oe}Qn.La="serverreachability";function Ar(u){Y.call(this,Qn.La,u)}R(Ar,Y);function Ls(u){const p=xr();Be(p,new Ar(p))}Qn.STAT_EVENT="statevent";function Di(u,p){Y.call(this,Qn.STAT_EVENT,u),this.stat=p}R(Di,Y);function ln(u){const p=xr();Be(p,new Di(p,u))}Qn.Ma="timingevent";function tc(u,p){Y.call(this,Qn.Ma,u),this.size=p}R(tc,Y);function Rn(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function Fs(){this.g=!0}Fs.prototype.xa=function(){this.g=!1};function nc(u,p,v,b,U,G){u.info(function(){if(u.g)if(G)for(var me="",mt=G.split("&"),un=0;un<mt.length;un++){var nt=mt[un].split("=");if(1<nt.length){var cn=nt[0];nt=nt[1];var dn=cn.split("_");me=2<=dn.length&&dn[1]=="type"?me+(cn+"="+nt+"&"):me+(cn+"=redacted&")}}else me=null;else me=G;return"XMLHTTP REQ ("+b+") [attempt "+U+"]: "+p+`
`+v+`
`+me})}function sl(u,p,v,b,U,G,me){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+U+"]: "+p+`
`+v+`
`+G+" "+me})}function $s(u,p,v,b){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+Us(u,v)+(b?" "+b:"")})}function jn(u,p){u.info(function(){return"TIMEOUT: "+p})}Fs.prototype.info=function(){};function Us(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var b=v[u];if(!(2>b.length)){var U=b[1];if(Array.isArray(U)&&!(1>U.length)){var G=U[0];if(G!="noop"&&G!="stop"&&G!="close")for(var me=1;me<U.length;me++)U[me]=""}}}}return nn(v)}catch{return p}}var Vi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},il={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Xr;function Nr(){}R(Nr,nl),Nr.prototype.g=function(){return new XMLHttpRequest},Nr.prototype.i=function(){return{}},Xr=new Nr;function ir(u,p,v,b){this.j=u,this.i=p,this.l=v,this.R=b||1,this.U=new Nt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zr}function Zr(){this.i=null,this.g="",this.h=!1}var ol={},js={};function or(u,p,v){u.L=1,u.v=Or(Bn(p)),u.m=v,u.P=!0,rc(u,null)}function rc(u,p){u.F=Date.now(),Ni(u),u.A=Bn(u.v);var v=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),qs(v.i,"t",b),u.C=0,v=u.j.J,u.h=new Zr,u.g=Bo(u.j,v?p:null,!u.m),0<u.O&&(u.M=new gn(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,b=u.ca;var U="readystatechange";Array.isArray(U)||(U&&(mr[0]=U.toString()),U=mr);for(var G=0;G<U.length;G++){var me=Z(v,U[G],b||p.handleEvent,!1,p.h||p);if(!me)break;p.g[me.key]=me}p=u.H?w(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Ls(),nc(u.i,u.u,u.A,u.l,u.R,u.m)}ir.prototype.ca=function(u){u=u.target;const p=this.M;p&&ar(u)==3?p.j():this.Y(u)},ir.prototype.Y=function(u){try{if(u==this.g)e:{const dn=ar(this.g);var p=this.g.Ba();const os=this.g.Z();if(!(3>dn)&&(dn!=3||this.g&&(this.h.h||this.g.oa()||$i(this.g)))){this.J||dn!=4||p==7||(p==8||0>=os?Ls(3):Ls(2)),So(this);var v=this.g.Z();this.X=v;t:if(sc(this)){var b=$i(this.g);u="";var U=b.length,G=ar(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){gr(this),Oi(this);var me="";break t}this.h.i=new a.TextDecoder}for(p=0;p<U;p++)this.h.h=!0,u+=this.h.i.decode(b[p],{stream:!(G&&p==U-1)});b.length=0,this.h.g+=u,this.C=0,me=this.h.g}else me=this.g.oa();if(this.o=v==200,sl(this.i,this.u,this.A,this.l,this.R,dn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var mt,un=this.g;if((mt=un.g?un.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(mt)){var nt=mt;break t}}nt=null}if(v=nt)$s(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Po(this,v);else{this.o=!1,this.s=3,ln(12),gr(this),Oi(this);break e}}if(this.P){v=!0;let Xn;for(;!this.J&&this.C<me.length;)if(Xn=Dh(this,me),Xn==js){dn==4&&(this.s=4,ln(14),v=!1),$s(this.i,this.l,null,"[Incomplete Response]");break}else if(Xn==ol){this.s=4,ln(15),$s(this.i,this.l,me,"[Invalid Chunk]"),v=!1;break}else $s(this.i,this.l,Xn,null),Po(this,Xn);if(sc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),dn!=4||me.length!=0||this.h.h||(this.s=1,ln(16),v=!1),this.o=this.o&&v,!v)$s(this.i,this.l,me,"[Invalid Chunked Response]"),gr(this),Oi(this);else if(0<me.length&&!this.W){this.W=!0;var cn=this.j;cn.g==this&&cn.ba&&!cn.M&&(cn.j.info("Great, no buffering proxy detected. Bytes received: "+me.length),Uo(cn),cn.M=!0,ln(11))}}else $s(this.i,this.l,me,null),Po(this,me);dn==4&&gr(this),this.o&&!this.J&&(dn==4?yc(this.j,this):(this.o=!1,Ni(this)))}else Lo(this.g),v==400&&0<me.indexOf("Unknown SID")?(this.s=3,ln(12)):(this.s=0,ln(13)),gr(this),Oi(this)}}}catch{}finally{}};function sc(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Dh(u,p){var v=u.C,b=p.indexOf(`
`,v);return b==-1?js:(v=Number(p.substring(v,b)),isNaN(v)?ol:(b+=1,b+v>p.length?js:(p=p.slice(b,b+v),u.C=b+v,p)))}ir.prototype.cancel=function(){this.J=!0,gr(this)};function Ni(u){u.S=Date.now()+u.I,es(u,u.I)}function es(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Rn(g(u.ba,u),p)}function So(u){u.B&&(a.clearTimeout(u.B),u.B=null)}ir.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(jn(this.i,this.A),this.L!=2&&(Ls(),ln(17)),gr(this),this.s=2,Oi(this)):es(this,this.S-u)};function Oi(u){u.j.G==0||u.J||yc(u.j,u)}function gr(u){So(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Vr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Po(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Le(v.h,u))){if(!u.K&&Le(v.h,u)&&v.G==3){try{var b=v.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var U=b;if(U[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)jo(v),Fo(v);else break e;gl(v),ln(18)}}else v.za=U[1],0<v.za-v.T&&37500>U[2]&&v.F&&v.v==0&&!v.C&&(v.C=Rn(g(v.Za,v),6e3));if(1>=Co(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else qn(v,11)}else if((u.K||v.g==u)&&jo(v),!F(p))for(U=v.Da.g.parse(p),p=0;p<U.length;p++){let nt=U[p];if(v.T=nt[0],nt=nt[1],v.G==2)if(nt[0]=="c"){v.K=nt[1],v.ia=nt[2];const cn=nt[3];cn!=null&&(v.la=cn,v.j.info("VER="+v.la));const dn=nt[4];dn!=null&&(v.Aa=dn,v.j.info("SVER="+v.Aa));const os=nt[5];os!=null&&typeof os=="number"&&0<os&&(b=1.5*os,v.L=b,v.j.info("backChannelRequestTimeoutMs_="+b)),b=v;const Xn=u.g;if(Xn){const as=Xn.g?Xn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(as){var G=b.h;G.g||as.indexOf("spdy")==-1&&as.indexOf("quic")==-1&&as.indexOf("h2")==-1||(G.j=G.l,G.g=new Set,G.h&&(ft(G,G.h),G.h=null))}if(b.D){const qi=Xn.g?Xn.g.getResponseHeader("X-HTTP-Session-Id"):null;qi&&(b.ya=qi,pt(b.I,b.D,qi))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),b=v;var me=u;if(b.qa=vl(b,b.J?b.ia:null,b.W),me.K){vr(b.h,me);var mt=me,un=b.L;un&&(mt.I=un),mt.B&&(So(mt),Ni(mt)),b.g=me}else ml(b);0<v.i.length&&$o(v)}else nt[0]!="stop"&&nt[0]!="close"||qn(v,7);else v.G==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?qn(v,7):pl(v):nt[0]!="noop"&&v.l&&v.l.ta(nt),v.v=0)}}Ls(4)}catch{}}var Ro=class{constructor(u,p){this.g=u,this.map=p}};function al(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mi(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Co(u){return u.h?1:u.g?u.g.size:0}function Le(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function ft(u,p){u.g?u.g.add(p):u.h=p}function vr(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}al.prototype.cancel=function(){if(this.i=Bs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Bs(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return x(u.i)}function Vh(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,b=0;b<v;b++)p.push(u[b]);return p}p=[],v=0;for(b in u)p[v++]=u[b];return p}function ic(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const b in u)p[v++]=b;return p}}}function oc(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=ic(u),b=Vh(u),U=b.length,G=0;G<U;G++)p.call(void 0,b[G],v&&v[G],u)}var ac=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ll(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var b=u[v].indexOf("="),U=null;if(0<=b){var G=u[v].substring(0,b);U=u[v].substring(b+1)}else G=u[v];p(G,U?decodeURIComponent(U.replace(/\+/g," ")):"")}}}function ts(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof ts){this.h=u.h,ns(this,u.j),this.o=u.o,this.g=u.g,Sr(this,u.s),this.l=u.l;var p=u.i,v=new ht;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),rs(this,v),this.m=u.m}else u&&(p=String(u).match(ac))?(this.h=!1,ns(this,p[1]||"",!0),this.o=Mr(p[2]||""),this.g=Mr(p[3]||"",!0),Sr(this,p[4]),this.l=Mr(p[5]||"",!0),rs(this,p[6]||"",!0),this.m=Mr(p[7]||"")):(this.h=!1,this.i=new ht(null,this.h))}ts.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Li(p,lc,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Li(p,lc,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(Li(v,v.charAt(0)=="/"?Ge:uc,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",Li(v,Yt)),u.join("")};function Bn(u){return new ts(u)}function ns(u,p,v){u.j=v?Mr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function Sr(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function rs(u,p,v){p instanceof ht?(u.i=p,Oh(u.i,u.h)):(v||(p=Li(p,Ye)),u.i=new ht(p,u.h))}function pt(u,p,v){u.i.set(p,v)}function Or(u){return pt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Mr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Li(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,Nh),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Nh(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var lc=/[#\/\?@]/g,uc=/[#\?:]/g,Ge=/[#\?]/g,Ye=/[#\?@]/g,Yt=/#/g;function ht(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Lr(u){u.g||(u.g=new Map,u.h=0,u.i&&ll(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=ht.prototype,n.add=function(u,p){Lr(this),this.i=null,u=Fr(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function ko(u,p){Lr(u),p=Fr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function ul(u,p){return Lr(u),p=Fr(u,p),u.g.has(p)}n.forEach=function(u,p){Lr(this),this.g.forEach(function(v,b){v.forEach(function(U){u.call(p,U,b,this)},this)},this)},n.na=function(){Lr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let b=0;b<p.length;b++){const U=u[b];for(let G=0;G<U.length;G++)v.push(p[b])}return v},n.V=function(u){Lr(this);let p=[];if(typeof u=="string")ul(this,u)&&(p=p.concat(this.g.get(Fr(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return Lr(this),this.i=null,u=Fr(this,u),ul(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function qs(u,p,v){ko(u,p),0<v.length&&(u.i=null,u.g.set(Fr(u,p),x(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var b=p[v];const G=encodeURIComponent(String(b)),me=this.V(b);for(b=0;b<me.length;b++){var U=G;me[b]!==""&&(U+="="+encodeURIComponent(String(me[b]))),u.push(U)}}return this.i=u.join("&")};function Fr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Oh(u,p){p&&!u.j&&(Lr(u),u.i=null,u.g.forEach(function(v,b){var U=b.toLowerCase();b!=U&&(ko(this,b),qs(this,U,v))},u)),u.j=p}function $r(u,p){const v=new Fs;if(a.Image){const b=new Image;b.onload=y(Pr,v,"TestLoadImage: loaded",!0,p,b),b.onerror=y(Pr,v,"TestLoadImage: error",!1,p,b),b.onabort=y(Pr,v,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(Pr,v,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else p(!1)}function Jn(u,p){const v=new Fs,b=new AbortController,U=setTimeout(()=>{b.abort(),Pr(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:b.signal}).then(G=>{clearTimeout(U),G.ok?Pr(v,"TestPingServer: ok",!0,p):Pr(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(U),Pr(v,"TestPingServer: error",!1,p)})}function Pr(u,p,v,b,U){try{U&&(U.onload=null,U.onerror=null,U.onabort=null,U.ontimeout=null),b(v)}catch{}}function Do(){this.g=new Ci}function cl(u,p,v){const b=v||"";try{oc(u,function(U,G){let me=U;c(U)&&(me=nn(U)),p.push(b+G+"="+encodeURIComponent(me))})}catch(U){throw p.push(b+"type="+encodeURIComponent("_badmap")),U}}function Yn(u){this.l=u.Ub||null,this.j=u.eb||!1}R(Yn,nl),Yn.prototype.g=function(){return new Vo(this.l,this.j)},Yn.prototype.i=function(u){return function(){return u}}({});function Vo(u,p){Oe.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}R(Vo,Oe),n=Vo.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,ss(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,zs(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,ss(this)),this.g&&(this.readyState=3,ss(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function cc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?zs(this):ss(this),this.readyState==3&&cc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,zs(this))},n.Qa=function(u){this.g&&(this.response=u,zs(this))},n.ga=function(){this.g&&zs(this)};function zs(u){u.readyState=4,u.l=null,u.j=null,u.v=null,ss(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function ss(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Vo.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function dc(u){let p="";return pe(u,function(v,b){p+=b,p+=":",p+=v,p+=`\r
`}),p}function Fi(u,p,v){e:{for(b in v){var b=!1;break e}b=!0}b||(v=dc(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):pt(u,p,v))}function wt(u){Oe.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}R(wt,Oe);var dl=/^https?$/i,No=["POST","PUT"];n=wt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Xr.g(),this.v=this.o?Zu(this.o):Zu(Xr),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(G){Oo(this,G);return}if(u=v||"",v=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var U in b)v.set(U,b[U]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const G of b.keys())v.set(G,b.get(G));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(v.keys()).find(G=>G.toLowerCase()=="content-type"),U=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(No,p,void 0))||b||U||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[G,me]of v)this.g.setRequestHeader(G,me);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{fl(this),this.u=!0,this.g.send(u),this.u=!1}catch(G){Oo(this,G)}};function Oo(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,hl(u),Mo(u)}function hl(u){u.A||(u.A=!0,Be(u,"complete"),Be(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Be(this,"complete"),Be(this,"abort"),Mo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Mo(this,!0)),wt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?hc(this):this.bb())},n.bb=function(){hc(this)};function hc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||ar(u)!=4||u.Z()!=2)){if(u.u&&ar(u)==4)Wt(u.Ea,0,u);else if(Be(u,"readystatechange"),ar(u)==4){u.h=!1;try{const me=u.Z();e:switch(me){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var b;if(b=me===0){var U=String(u.D).match(ac)[1]||null;!U&&a.self&&a.self.location&&(U=a.self.location.protocol.slice(0,-1)),b=!dl.test(U?U.toLowerCase():"")}v=b}if(v)Be(u,"complete"),Be(u,"success");else{u.m=6;try{var G=2<ar(u)?u.g.statusText:""}catch{G=""}u.l=G+" ["+u.Z()+"]",hl(u)}}finally{Mo(u)}}}}function Mo(u,p){if(u.g){fl(u);const v=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Be(u,"ready");try{v.onreadystatechange=b}catch{}}}function fl(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function ar(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<ar(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Pn(p)}};function $i(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Lo(u){const p={};u=(u.g&&2<=ar(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(F(u[b]))continue;var v=k(u[b]);const U=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const G=p[U]||[];p[U]=G,G.push(v)}T(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ui(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function fc(u){this.Aa=0,this.i=[],this.j=new Fs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ui("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ui("baseRetryDelayMs",5e3,u),this.cb=Ui("retryDelaySeedMs",1e4,u),this.Wa=Ui("forwardChannelMaxRetries",2,u),this.wa=Ui("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new al(u&&u.concurrentRequestLimit),this.Da=new Do,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=fc.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,b){ln(0),this.W=u,this.H=p||{},v&&b!==void 0&&(this.H.OSID=v,this.H.OAID=b),this.F=this.X,this.I=vl(this,null,this.W),$o(this)};function pl(u){if(pc(u),u.G==3){var p=u.U++,v=Bn(u.I);if(pt(v,"SID",u.K),pt(v,"RID",p),pt(v,"TYPE","terminate"),Bi(u,v),p=new ir(u,u.j,p),p.L=2,p.v=Or(Bn(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=Bo(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Ni(p)}bc(u)}function Fo(u){u.g&&(Uo(u),u.g.cancel(),u.g=null)}function pc(u){Fo(u),u.u&&(a.clearTimeout(u.u),u.u=null),jo(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function $o(u){if(!Mi(u.h)&&!u.s){u.s=!0;var p=u.Ga;$e||te(),Ue||($e(),Ue=!0),De.add(p,u),u.B=0}}function ji(u,p){return Co(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Rn(g(u.Ga,u,p),_c(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const U=new ir(this,this.j,u);let G=this.o;if(this.S&&(G?(G=w(G),C(G,this.S)):G=this.S),this.m!==null||this.O||(U.H=G,G=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var b=this.i[v];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=gc(this,U,p),v=Bn(this.I),pt(v,"RID",u),pt(v,"CVER",22),this.D&&pt(v,"X-HTTP-Session-Id",this.D),Bi(this,v),G&&(this.O?p="headers="+encodeURIComponent(String(dc(G)))+"&"+p:this.m&&Fi(v,this.m,G)),ft(this.h,U),this.Ua&&pt(v,"TYPE","init"),this.P?(pt(v,"$req",p),pt(v,"SID","null"),U.T=!0,or(U,v,null)):or(U,v,p),this.G=2}}else this.G==3&&(u?mc(this,u):this.i.length==0||Mi(this.h)||mc(this))};function mc(u,p){var v;p?v=p.l:v=u.U++;const b=Bn(u.I);pt(b,"SID",u.K),pt(b,"RID",v),pt(b,"AID",u.T),Bi(u,b),u.m&&u.o&&Fi(b,u.m,u.o),v=new ir(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=gc(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),ft(u.h,v),or(v,b,p)}function Bi(u,p){u.H&&pe(u.H,function(v,b){pt(p,b,v)}),u.l&&oc({},function(v,b){pt(p,b,v)})}function gc(u,p,v){v=Math.min(u.i.length,v);var b=u.l?g(u.l.Na,u.l,u):null;e:{var U=u.i;let G=-1;for(;;){const me=["count="+v];G==-1?0<v?(G=U[0].g,me.push("ofs="+G)):G=0:me.push("ofs="+G);let mt=!0;for(let un=0;un<v;un++){let nt=U[un].g;const cn=U[un].map;if(nt-=G,0>nt)G=Math.max(0,U[un].g-100),mt=!1;else try{cl(cn,me,"req"+nt+"_")}catch{b&&b(cn)}}if(mt){b=me.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,b}function ml(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;$e||te(),Ue||($e(),Ue=!0),De.add(p,u),u.v=0}}function gl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Rn(g(u.Fa,u),_c(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,vc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Rn(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ln(10),Fo(this),vc(this))};function Uo(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function vc(u){u.g=new ir(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=Bn(u.qa);pt(p,"RID","rpc"),pt(p,"SID",u.K),pt(p,"AID",u.T),pt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&pt(p,"TO",u.ja),pt(p,"TYPE","xmlhttp"),Bi(u,p),u.m&&u.o&&Fi(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=Or(Bn(p)),v.m=null,v.P=!0,rc(v,u)}n.Za=function(){this.C!=null&&(this.C=null,Fo(this),gl(this),ln(19))};function jo(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function yc(u,p){var v=null;if(u.g==p){jo(u),Uo(u),u.g=null;var b=2}else if(Le(u.h,p))v=p.D,vr(u.h,p),b=1;else return;if(u.G!=0){if(p.o)if(b==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var U=u.B;b=xr(),Be(b,new tc(b,v)),$o(u)}else ml(u);else if(U=p.s,U==3||U==0&&0<p.X||!(b==1&&ji(u,p)||b==2&&gl(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),U){case 1:qn(u,5);break;case 4:qn(u,10);break;case 3:qn(u,6);break;default:qn(u,2)}}}function _c(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function qn(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),b=u.Xa;const U=!b;b=new ts(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ns(b,"https"),Or(b),U?$r(b.toString(),v):Jn(b.toString(),v)}else ln(2);u.G=0,u.l&&u.l.sa(p),bc(u),pc(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),ln(2)):(this.j.info("Failed to ping google.com"),ln(1))};function bc(u){if(u.G=0,u.ka=[],u.l){const p=Bs(u.h);(p.length!=0||u.i.length!=0)&&(V(u.ka,p),V(u.ka,u.i),u.h.i.length=0,x(u.i),u.i.length=0),u.l.ra()}}function vl(u,p,v){var b=v instanceof ts?Bn(v):new ts(v);if(b.g!="")p&&(b.g=p+"."+b.g),Sr(b,b.s);else{var U=a.location;b=U.protocol,p=p?p+"."+U.hostname:U.hostname,U=+U.port;var G=new ts(null);b&&ns(G,b),p&&(G.g=p),U&&Sr(G,U),v&&(G.l=v),b=G}return v=u.D,p=u.ya,v&&p&&pt(b,v,p),pt(b,"VER",u.la),Bi(u,b),b}function Bo(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new wt(new Yn({eb:v})):new wt(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function yl(){}n=yl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function qo(){}qo.prototype.g=function(u,p){return new zn(u,p)};function zn(u,p){Oe.call(this),this.g=new fc(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!F(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!F(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new is(this)}R(zn,Oe),zn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},zn.prototype.close=function(){pl(this.g)},zn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=nn(u),u=v);p.i.push(new Ro(p.Ya++,u)),p.G==3&&$o(p)},zn.prototype.N=function(){this.g.l=null,delete this.j,pl(this.g),delete this.g,zn.aa.N.call(this)};function wc(u){rl.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}R(wc,rl);function _l(){Er.call(this),this.status=1}R(_l,Er);function is(u){this.g=u}R(is,yl),is.prototype.ua=function(){Be(this.g,"a")},is.prototype.ta=function(u){Be(this.g,new wc(u))},is.prototype.sa=function(u){Be(this.g,new _l)},is.prototype.ra=function(){Be(this.g,"b")},qo.prototype.createWebChannel=qo.prototype.g,zn.prototype.send=zn.prototype.o,zn.prototype.open=zn.prototype.m,zn.prototype.close=zn.prototype.close,O0=function(){return new qo},N0=function(){return xr()},V0=Qn,Mf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vi.NO_ERROR=0,Vi.TIMEOUT=8,Vi.HTTP_ERROR=6,Uc=Vi,il.COMPLETE="complete",D0=il,ec.EventType=ki,ki.OPEN="a",ki.CLOSE="b",ki.ERROR="c",ki.MESSAGE="d",Oe.prototype.listen=Oe.prototype.K,Vl=ec,wt.prototype.listenOnce=wt.prototype.L,wt.prototype.getLastError=wt.prototype.Ka,wt.prototype.getLastErrorCode=wt.prototype.Ba,wt.prototype.getStatus=wt.prototype.Z,wt.prototype.getResponseJson=wt.prototype.Oa,wt.prototype.getResponseText=wt.prototype.oa,wt.prototype.send=wt.prototype.ea,wt.prototype.setWithCredentials=wt.prototype.Ha,k0=wt}).apply(typeof xc<"u"?xc:typeof self<"u"?self:typeof window<"u"?window:{});const fv="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}yn.UNAUTHENTICATED=new yn(null),yn.GOOGLE_CREDENTIALS=new yn("google-credentials-uid"),yn.FIRST_PARTY=new yn("first-party-uid"),yn.MOCK_USER=new yn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ja="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi=new kp("@firebase/firestore");function ea(){return vi.logLevel}function a6(n){vi.setLogLevel(n)}function re(n,...e){if(vi.logLevel<=st.DEBUG){const t=e.map(Vp);vi.debug(`Firestore (${ja}): ${n}`,...t)}}function Xt(n,...e){if(vi.logLevel<=st.ERROR){const t=e.map(Vp);vi.error(`Firestore (${ja}): ${n}`,...t)}}function wr(n,...e){if(vi.logLevel<=st.WARN){const t=e.map(Vp);vi.warn(`Firestore (${ja}): ${n}`,...t)}}function Vp(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(n="Unexpected state"){const e=`FIRESTORE (${ja}) INTERNAL ASSERTION FAILED: `+n;throw Xt(e),new Error(e)}function Pe(n,e){n||xe()}function l6(n,e){n||xe()}function ye(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class se extends Cs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class TP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(yn.UNAUTHENTICATED))}shutdown(){}}class xP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class AP{constructor(e){this.t=e,this.currentUser=yn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Pe(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new bn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new bn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(re("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new bn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Pe(typeof r.accessToken=="string"),new M0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Pe(e===null||typeof e=="string"),new yn(e)}}class SP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=yn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class PP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new SP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(yn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class L0{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class RP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Pe(this.o===void 0);const r=i=>{i.error!=null&&re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,re("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Pe(typeof t.token=="string"),this.R=t.token,new L0(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class u6{getToken(){return Promise.resolve(new L0(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=CP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function je(n,e){return n<e?-1:n>e?1:0}function ba(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function $0(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new se(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new se(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new se(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new se(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Kt.fromMillis(Date.now())}static fromDate(e){return Kt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Kt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?je(this.nanoseconds,e.nanoseconds):je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ce(e)}static min(){return new Ce(new Kt(0,0))}static max(){return new Ce(new Kt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e,t,r){t===void 0?t=0:t>e.length&&xe(),r===void 0?r=e.length-t:r>e.length-t&&xe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return lu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof lu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class it extends lu{construct(e,t,r){return new it(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new se(z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new it(t)}static emptyPath(){return new it([])}}const kP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zt extends lu{construct(e,t,r){return new zt(e,t,r)}static isValidIdentifier(e){return kP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new zt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new se(z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new se(z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new se(z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new se(z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new zt(t)}static emptyPath(){return new zt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e){this.path=e}static fromPath(e){return new Ie(it.fromString(e))}static fromName(e){return new Ie(it.fromString(e).popFirst(5))}static empty(){return new Ie(it.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&it.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return it.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ie(new it(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Lf(n){return n.fields.find(e=>e.kind===2)}function Ji(n){return n.fields.filter(e=>e.kind!==2)}function DP(n,e){let t=je(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=VP(n.fields[r],e.fields[r]),t!==0)return t;return je(n.fields.length,e.fields.length)}wa.UNKNOWN_ID=-1;class oo{constructor(e,t){this.fieldPath=e,this.kind=t}}function VP(n,e){const t=zt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:je(n.kind,e.kind)}class Ia{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ia(0,pr.min())}}function U0(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ce.fromTimestamp(r===1e9?new Kt(t+1,0):new Kt(t,r));return new pr(s,Ie.empty(),e)}function j0(n){return new pr(n.readTime,n.key,-1)}class pr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new pr(Ce.min(),Ie.empty(),-1)}static max(){return new pr(Ce.max(),Ie.empty(),-1)}}function Np(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ie.comparator(n.documentKey,e.documentKey),t!==0?t:je(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class q0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xi(n){if(n.code!==z.FAILED_PRECONDITION||n.message!==B0)throw n;re("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&xe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new j((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof j?t:j.resolve(t)}catch(t){return j.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):j.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):j.reject(t)}static resolve(e){return new j((t,r)=>{t(e)})}static reject(e){return new j((t,r)=>{r(e)})}static waitFor(e){return new j((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=j.resolve(!1);for(const r of e)t=t.next(s=>s?j.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new j((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new j((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qd{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new bn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Wl(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Op(r.target.error);this.V.reject(new Wl(e,s))}}static open(e,t,r,s){try{return new Qd(t,e.transaction(s,r))}catch(i){throw new Wl(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(re("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new OP(t)}}class Kr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Kr.S(pn())===12.2&&Xt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return re("SimpleDb","Removing database:",e),Xi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!E0())return!1;if(Kr.v())return!0;const e=pn(),t=Kr.S(e),r=0<t&&t<10,s=z0(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(re("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Wl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new se(z.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new se(z.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Wl(e,o))},s.onupgradeneeded=i=>{re("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{re("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Qd.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),j.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(re("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function z0(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class NP{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Xi(this.B.delete())}}class Wl extends se{constructor(e,t){super(z.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ai(n){return n.name==="IndexedDbTransactionError"}class OP{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(re("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(re("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Xi(r)}add(e){return re("SimpleDb","ADD",this.store.name,e,e),Xi(this.store.add(e))}get(e){return Xi(this.store.get(e)).next(t=>(t===void 0&&(t=null),re("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return re("SimpleDb","DELETE",this.store.name,e),Xi(this.store.delete(e))}count(){return re("SimpleDb","COUNT",this.store.name),Xi(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new j((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new j((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){re("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new j((r,s)=>{t.onerror=i=>{const o=Op(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new j((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new NP(a),c=t(a.primaryKey,a.value,l);if(c instanceof j){const d=c.catch(f=>(l.done(),j.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>j.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Xi(n){return new j((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Op(r.target.error);t(s)}})}let pv=!1;function Op(n){const e=Kr.S(pn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new se("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return pv||(pv=!0,setTimeout(()=>{throw r},0)),r}}return n}class MP{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){re("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{re("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Ai(t)?re("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await xi(t)}await this.X(6e4)})}}class LP{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return j.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return re("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(re("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=j0(i);Np(o,r)>0&&(r=o)}),new pr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}tr.oe=-1;function Du(n){return n==null}function uu(n){return n===0&&1/n==-1/0}function G0(n){return typeof n=="number"&&Number.isInteger(n)&&!uu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=mv(e)),e=FP(n.get(t),e);return mv(e)}function FP(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function mv(n){return n+""}function qr(n){const e=n.length;if(Pe(e>=2),e===2)return Pe(n.charAt(0)===""&&n.charAt(1)===""),it.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&xe(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:xe()}i=o+2}return new it(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jc(n,e){return[n,Fn(e)]}function K0(n,e,t){return[n,Fn(e),t]}const $P={},UP=["prefixPath","collectionGroup","readTime","documentId"],jP=["prefixPath","collectionGroup","documentId"],BP=["collectionGroup","readTime","prefixPath","documentId"],qP=["canonicalId","targetId"],zP=["targetId","path"],GP=["path","targetId"],KP=["collectionId","parent"],HP=["indexId","uid"],WP=["uid","sequenceNumber"],QP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],JP=["indexId","uid","orderedDocumentKey"],YP=["userId","collectionPath","documentId"],XP=["userId","collectionPath","largestBatchId"],ZP=["userId","collectionGroup","largestBatchId"],H0=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],e1=[...H0,"documentOverlays"],W0=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Q0=W0,Mp=[...Q0,"indexConfiguration","indexState","indexEntries"],t1=Mp,n1=[...Mp,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff extends q0{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function mn(n,e){const t=ye(n);return Kr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vv(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Si(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function J0(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Y0(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e,t){this.comparator=e,this.root=t||En.EMPTY}insert(e,t){return new Dt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,En.BLACK,null,null))}remove(e){return new Dt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,En.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ac(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ac(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ac(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ac(this.root,e,this.comparator,!0)}}class Ac{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class En{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??En.RED,this.left=s??En.EMPTY,this.right=i??En.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new En(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return En.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return En.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,En.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,En.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw xe();const e=this.left.check();if(e!==this.right.check())throw xe();return e+(this.isRed()?0:1)}}En.EMPTY=null,En.RED=!0,En.BLACK=!1;En.EMPTY=new class{constructor(){this.size=0}get key(){throw xe()}get value(){throw xe()}get color(){throw xe()}get left(){throw xe()}get right(){throw xe()}copy(e,t,r,s,i){return this}insert(e,t,r){return new En(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this.comparator=e,this.data=new Dt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new yv(this.data.getIterator())}getIteratorFrom(e){return new yv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Tt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Tt(this.comparator);return t.data=e,t}}class yv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ko(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e){this.fields=e,e.sort(zt.comparator)}static empty(){return new nr([])}unionWith(e){let t=new Tt(zt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new nr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ba(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d6(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new X0("Invalid base64 string: "+i):i}}(e);return new Qt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Qt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qt.EMPTY_BYTE_STRING=new Qt("");const r1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ts(n){if(Pe(!!n),typeof n=="string"){let e=0;const t=r1.exec(n);if(Pe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:qt(n.seconds),nanos:qt(n.nanos)}}function qt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function xs(n){return typeof n=="string"?Qt.fromBase64String(n):Qt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Yd(n){const e=n.mapValue.fields.__previous_value__;return Jd(e)?Yd(e):e}function cu(n){const e=Ts(n.mapValue.fields.__local_write_time__.timestampValue);return new Kt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class co{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new co("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof co&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Bc={nullValue:"NULL_VALUE"};function yi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Jd(n)?4:Z0(n)?9007199254740991:Xd(n)?10:11:xe()}function Yr(n,e){if(n===e)return!0;const t=yi(n);if(t!==yi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return cu(n).isEqual(cu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ts(s.timestampValue),a=Ts(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return xs(s.bytesValue).isEqual(xs(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return qt(s.geoPointValue.latitude)===qt(i.geoPointValue.latitude)&&qt(s.geoPointValue.longitude)===qt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return qt(s.integerValue)===qt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=qt(s.doubleValue),a=qt(i.doubleValue);return o===a?uu(o)===uu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return ba(n.arrayValue.values||[],e.arrayValue.values||[],Yr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(vv(o)!==vv(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Yr(o[l],a[l])))return!1;return!0}(n,e);default:return xe()}}function du(n,e){return(n.values||[]).find(t=>Yr(t,e))!==void 0}function _i(n,e){if(n===e)return 0;const t=yi(n),r=yi(e);if(t!==r)return je(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return je(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=qt(i.integerValue||i.doubleValue),l=qt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return _v(n.timestampValue,e.timestampValue);case 4:return _v(cu(n),cu(e));case 5:return je(n.stringValue,e.stringValue);case 6:return function(i,o){const a=xs(i),l=xs(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=je(a[c],l[c]);if(d!==0)return d}return je(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=je(qt(i.latitude),qt(o.latitude));return a!==0?a:je(qt(i.longitude),qt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return bv(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,R=(l=g.value)===null||l===void 0?void 0:l.arrayValue,x=je(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=R==null?void 0:R.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:bv(y,R)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===oi.mapValue&&o===oi.mapValue)return 0;if(i===oi.mapValue)return 1;if(o===oi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=je(l[f],d[f]);if(g!==0)return g;const y=_i(a[l[f]],c[d[f]]);if(y!==0)return y}return je(l.length,d.length)}(n.mapValue,e.mapValue);default:throw xe()}}function _v(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return je(n,e);const t=Ts(n),r=Ts(e),s=je(t.seconds,r.seconds);return s!==0?s:je(t.nanos,r.nanos)}function bv(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=_i(t[s],r[s]);if(i)return i}return je(t.length,r.length)}function Ea(n){return $f(n)}function $f(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ts(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return xs(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ie.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=$f(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${$f(t.fields[o])}`;return s+"}"}(n.mapValue):xe()}function qc(n){switch(yi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Yd(n);return e?16+qc(e):16;case 5:return 2*n.stringValue.length;case 6:return xs(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+qc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Si(r.fields,(i,o)=>{s+=i.length+qc(o)}),s}(n.mapValue);default:throw xe()}}function ho(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Uf(n){return!!n&&"integerValue"in n}function hu(n){return!!n&&"arrayValue"in n}function wv(n){return!!n&&"nullValue"in n}function Iv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function zc(n){return!!n&&"mapValue"in n}function Xd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Ql(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Si(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ql(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ql(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Z0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const eb={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function i1(n){return"nullValue"in n?Bc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ho(co.empty(),Ie.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Xd(n)?eb:{mapValue:{}}:xe()}function o1(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ho(co.empty(),Ie.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?eb:"mapValue"in n?Xd(n)?{mapValue:{}}:oi:xe()}function Ev(n,e){const t=_i(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Tv(n,e){const t=_i(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e){this.value=e}static empty(){return new xn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!zc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ql(t)}setAll(e){let t=zt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Ql(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());zc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Yr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];zc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Si(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new xn(Ql(this.value))}}function tb(n){const e=[];return Si(n.fields,(t,r)=>{const s=new zt([t]);if(zc(r)){const i=tb(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new nr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new $t(e,0,Ce.min(),Ce.min(),Ce.min(),xn.empty(),0)}static newFoundDocument(e,t,r,s){return new $t(e,1,t,Ce.min(),r,s,0)}static newNoDocument(e,t){return new $t(e,2,t,Ce.min(),Ce.min(),xn.empty(),0)}static newUnknownDocument(e,t){return new $t(e,3,t,Ce.min(),Ce.min(),xn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ce.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi{constructor(e,t){this.position=e,this.inclusive=t}}function xv(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ie.comparator(Ie.fromName(o.referenceValue),t.key):r=_i(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Av(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Yr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,t="asc"){this.field=e,this.dir=t}}function a1(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{}class ot extends nb{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new l1(e,t,r):t==="array-contains"?new d1(e,r):t==="in"?new lb(e,r):t==="not-in"?new h1(e,r):t==="array-contains-any"?new f1(e,r):new ot(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new u1(e,r):new c1(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(_i(t,this.value)):t!==null&&yi(this.value)===yi(t)&&this.matchesComparison(_i(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Et extends nb{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new Et(e,t)}matches(e){return Ta(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ta(n){return n.op==="and"}function jf(n){return n.op==="or"}function Lp(n){return rb(n)&&Ta(n)}function rb(n){for(const e of n.filters)if(e instanceof Et)return!1;return!0}function Bf(n){if(n instanceof ot)return n.field.canonicalString()+n.op.toString()+Ea(n.value);if(Lp(n))return n.filters.map(e=>Bf(e)).join(",");{const e=n.filters.map(t=>Bf(t)).join(",");return`${n.op}(${e})`}}function sb(n,e){return n instanceof ot?function(r,s){return s instanceof ot&&r.op===s.op&&r.field.isEqual(s.field)&&Yr(r.value,s.value)}(n,e):n instanceof Et?function(r,s){return s instanceof Et&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&sb(o,s.filters[a]),!0):!1}(n,e):void xe()}function ib(n,e){const t=n.filters.concat(e);return Et.create(t,n.op)}function ob(n){return n instanceof ot?function(t){return`${t.field.canonicalString()} ${t.op} ${Ea(t.value)}`}(n):n instanceof Et?function(t){return t.op.toString()+" {"+t.getFilters().map(ob).join(" ,")+"}"}(n):"Filter"}class l1 extends ot{constructor(e,t,r){super(e,t,r),this.key=Ie.fromName(r.referenceValue)}matches(e){const t=Ie.comparator(e.key,this.key);return this.matchesComparison(t)}}class u1 extends ot{constructor(e,t){super(e,"in",t),this.keys=ab("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class c1 extends ot{constructor(e,t){super(e,"not-in",t),this.keys=ab("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ab(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ie.fromName(r.referenceValue))}class d1 extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hu(t)&&du(t.arrayValue,this.value)}}class lb extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&du(this.value.arrayValue,t)}}class h1 extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if(du(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!du(this.value.arrayValue,t)}}class f1 extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>du(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function qf(n,e=null,t=[],r=[],s=null,i=null,o=null){return new p1(n,e,t,r,s,i,o)}function fo(n){const e=ye(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Bf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Du(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ea(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ea(r)).join(",")),e.ue=t}return e.ue}function Vu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!a1(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!sb(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Av(n.startAt,e.startAt)&&Av(n.endAt,e.endAt)}function fd(n){return Ie.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function pd(n,e){return n.filters.filter(t=>t instanceof ot&&t.field.isEqual(e))}function Sv(n,e,t){let r=Bc,s=!0;for(const i of pd(n,e)){let o=Bc,a=!0;switch(i.op){case"<":case"<=":o=i1(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Bc}Ev({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Ev({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Pv(n,e,t){let r=oi,s=!0;for(const i of pd(n,e)){let o=oi,a=!0;switch(i.op){case">=":case">":o=o1(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=oi}Tv({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Tv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function ub(n,e,t,r,s,i,o,a){return new ks(n,e,t,r,s,i,o,a)}function Ba(n){return new ks(n)}function Rv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Fp(n){return n.collectionGroup!==null}function ca(n){const e=ye(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Tt(zt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new fu(i,r))}),t.has(zt.keyField().canonicalString())||e.ce.push(new fu(zt.keyField(),r))}return e.ce}function $n(n){const e=ye(n);return e.le||(e.le=db(e,ca(n))),e.le}function cb(n){const e=ye(n);return e.he||(e.he=db(e,n.explicitOrderBy)),e.he}function db(n,e){if(n.limitType==="F")return qf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new fu(s.field,i)});const t=n.endAt?new bi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new bi(n.startAt.position,n.startAt.inclusive):null;return qf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function zf(n,e){const t=n.filters.concat([e]);return new ks(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function md(n,e,t){return new ks(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Nu(n,e){return Vu($n(n),$n(e))&&n.limitType===e.limitType}function hb(n){return`${fo($n(n))}|lt:${n.limitType}`}function ta(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>ob(s)).join(", ")}]`),Du(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ea(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ea(s)).join(",")),`Target(${r})`}($n(n))}; limitType=${n.limitType})`}function Ou(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ie.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of ca(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=xv(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,ca(r),s)||r.endAt&&!function(o,a,l){const c=xv(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,ca(r),s))}(n,e)}function fb(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function pb(n){return(e,t)=>{let r=!1;for(const s of ca(n)){const i=m1(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function m1(n,e,t){const r=n.field.isKeyField()?Ie.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?_i(l,c):xe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return xe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Si(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Y0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g1=new Dt(Ie.comparator);function rr(){return g1}const mb=new Dt(Ie.comparator);function Nl(...n){let e=mb;for(const t of n)e=e.insert(t.key,t);return e}function gb(n){let e=mb;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function zr(){return Jl()}function vb(){return Jl()}function Jl(){return new Ds(n=>n.toString(),(n,e)=>n.isEqual(e))}const v1=new Dt(Ie.comparator),y1=new Tt(Ie.comparator);function He(...n){let e=y1;for(const t of n)e=e.add(t);return e}const _1=new Tt(je);function $p(){return _1}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Up(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:uu(e)?"-0":e}}function yb(n){return{integerValue:""+n}}function _b(n,e){return G0(e)?yb(e):Up(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(){this._=void 0}}function b1(n,e,t){return n instanceof xa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Jd(i)&&(i=Yd(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof po?wb(n,e):n instanceof mo?Ib(n,e):function(s,i){const o=bb(s,i),a=Cv(o)+Cv(s.Pe);return Uf(o)&&Uf(s.Pe)?yb(a):Up(s.serializer,a)}(n,e)}function w1(n,e,t){return n instanceof po?wb(n,e):n instanceof mo?Ib(n,e):t}function bb(n,e){return n instanceof Aa?function(r){return Uf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class xa extends Zd{}class po extends Zd{constructor(e){super(),this.elements=e}}function wb(n,e){const t=Eb(e);for(const r of n.elements)t.some(s=>Yr(s,r))||t.push(r);return{arrayValue:{values:t}}}class mo extends Zd{constructor(e){super(),this.elements=e}}function Ib(n,e){let t=Eb(e);for(const r of n.elements)t=t.filter(s=>!Yr(s,r));return{arrayValue:{values:t}}}class Aa extends Zd{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Cv(n){return qt(n.integerValue||n.doubleValue)}function Eb(n){return hu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mu{constructor(e,t){this.field=e,this.transform=t}}function I1(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof po&&s instanceof po||r instanceof mo&&s instanceof mo?ba(r.elements,s.elements,Yr):r instanceof Aa&&s instanceof Aa?Yr(r.Pe,s.Pe):r instanceof xa&&s instanceof xa}(n.transform,e.transform)}class E1{constructor(e,t){this.version=e,this.transformResults=t}}class Gt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Gt}static exists(e){return new Gt(void 0,e)}static updateTime(e){return new Gt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Gc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class eh{}function Tb(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new za(n.key,Gt.none()):new qa(n.key,n.data,Gt.none());{const t=n.data,r=xn.empty();let s=new Tt(zt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Vs(n.key,r,new nr(s.toArray()),Gt.none())}}function T1(n,e,t){n instanceof qa?function(s,i,o){const a=s.value.clone(),l=Dv(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Vs?function(s,i,o){if(!Gc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Dv(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(xb(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Yl(n,e,t,r){return n instanceof qa?function(i,o,a,l){if(!Gc(i.precondition,o))return a;const c=i.value.clone(),d=Vv(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Vs?function(i,o,a,l){if(!Gc(i.precondition,o))return a;const c=Vv(i.fieldTransforms,l,o),d=o.data;return d.setAll(xb(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Gc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function x1(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=bb(r.transform,s||null);i!=null&&(t===null&&(t=xn.empty()),t.set(r.field,i))}return t||null}function kv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ba(r,s,(i,o)=>I1(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class qa extends eh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Vs extends eh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function xb(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Dv(n,e,t){const r=new Map;Pe(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,w1(o,a,t[s]))}return r}function Vv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,b1(i,o,e))}return r}class za extends eh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jp extends eh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&T1(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yl(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Yl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=vb();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=Tb(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ce.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),He())}isEqual(e){return this.batchId===e.batchId&&ba(this.mutations,e.mutations,(t,r)=>kv(t,r))&&ba(this.baseMutations,e.baseMutations,(t,r)=>kv(t,r))}}class qp{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Pe(e.mutations.length===r.length);let s=function(){return v1}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new qp(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A1{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rn,lt;function Sb(n){switch(n){default:return xe();case z.CANCELLED:case z.UNKNOWN:case z.DEADLINE_EXCEEDED:case z.RESOURCE_EXHAUSTED:case z.INTERNAL:case z.UNAVAILABLE:case z.UNAUTHENTICATED:return!1;case z.INVALID_ARGUMENT:case z.NOT_FOUND:case z.ALREADY_EXISTS:case z.PERMISSION_DENIED:case z.FAILED_PRECONDITION:case z.ABORTED:case z.OUT_OF_RANGE:case z.UNIMPLEMENTED:case z.DATA_LOSS:return!0}}function Pb(n){if(n===void 0)return Xt("GRPC error has no .code"),z.UNKNOWN;switch(n){case rn.OK:return z.OK;case rn.CANCELLED:return z.CANCELLED;case rn.UNKNOWN:return z.UNKNOWN;case rn.DEADLINE_EXCEEDED:return z.DEADLINE_EXCEEDED;case rn.RESOURCE_EXHAUSTED:return z.RESOURCE_EXHAUSTED;case rn.INTERNAL:return z.INTERNAL;case rn.UNAVAILABLE:return z.UNAVAILABLE;case rn.UNAUTHENTICATED:return z.UNAUTHENTICATED;case rn.INVALID_ARGUMENT:return z.INVALID_ARGUMENT;case rn.NOT_FOUND:return z.NOT_FOUND;case rn.ALREADY_EXISTS:return z.ALREADY_EXISTS;case rn.PERMISSION_DENIED:return z.PERMISSION_DENIED;case rn.FAILED_PRECONDITION:return z.FAILED_PRECONDITION;case rn.ABORTED:return z.ABORTED;case rn.OUT_OF_RANGE:return z.OUT_OF_RANGE;case rn.UNIMPLEMENTED:return z.UNIMPLEMENTED;case rn.DATA_LOSS:return z.DATA_LOSS;default:return xe()}}(lt=rn||(rn={}))[lt.OK=0]="OK",lt[lt.CANCELLED=1]="CANCELLED",lt[lt.UNKNOWN=2]="UNKNOWN",lt[lt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",lt[lt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",lt[lt.NOT_FOUND=5]="NOT_FOUND",lt[lt.ALREADY_EXISTS=6]="ALREADY_EXISTS",lt[lt.PERMISSION_DENIED=7]="PERMISSION_DENIED",lt[lt.UNAUTHENTICATED=16]="UNAUTHENTICATED",lt[lt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",lt[lt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",lt[lt.ABORTED=10]="ABORTED",lt[lt.OUT_OF_RANGE=11]="OUT_OF_RANGE",lt[lt.UNIMPLEMENTED=12]="UNIMPLEMENTED",lt[lt.INTERNAL=13]="INTERNAL",lt[lt.UNAVAILABLE=14]="UNAVAILABLE",lt[lt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rb(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S1=new io([4294967295,4294967295],0);function Nv(n){const e=Rb().encode(n),t=new C0;return t.update(e),new Uint8Array(t.digest())}function Ov(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new io([t,r],0),new io([s,i],0)]}class Gp{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ol(`Invalid padding: ${t}`);if(r<0)throw new Ol(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ol(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ol(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=io.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(io.fromNumber(r)));return s.compare(S1)===1&&(s=new io([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Nv(e),[r,s]=Ov(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Gp(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Nv(e),[r,s]=Ov(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ol extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Fu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Lu(Ce.min(),s,new Dt(je),rr(),He())}}class Fu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Fu(r,t,He(),He(),He())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class Cb{constructor(e,t){this.targetId=e,this.me=t}}class kb{constructor(e,t,r=Qt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Mv{constructor(){this.fe=0,this.ge=Fv(),this.pe=Qt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=He(),t=He(),r=He();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:xe()}}),new Fu(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Fv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Pe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class P1{constructor(e){this.Le=e,this.Be=new Map,this.ke=rr(),this.qe=Lv(),this.Qe=new Dt(je)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:xe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(fd(i))if(r===0){const o=new Ie(i.path);this.Ue(t,o,$t.newNoDocument(o,Ce.min()))}else Pe(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}gd==null||gd.et(function(d,f,g,y,R){var x,V,B,F,P,q;const X={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},pe=f.unchangedNames;return pe&&(X.bloomFilter={applied:R===0,hashCount:(x=pe==null?void 0:pe.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(F=(B=(V=pe==null?void 0:pe.bits)===null||V===void 0?void 0:V.bitmap)===null||B===void 0?void 0:B.length)!==null&&F!==void 0?F:0,padding:(q=(P=pe==null?void 0:pe.bits)===null||P===void 0?void 0:P.padding)!==null&&q!==void 0?q:0,mightContain:T=>{var w;return(w=y==null?void 0:y.mightContain(T))!==null&&w!==void 0&&w}}),X}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=xs(r).toUint8Array()}catch(l){if(l instanceof X0)return wr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Gp(o,s,i)}catch(l){return wr(l instanceof Ol?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&fd(a.target)){const l=new Ie(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,$t.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=He();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Lu(e,t,this.Qe,this.ke,r);return this.ke=rr(),this.qe=Lv(),this.Qe=new Dt(je),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Mv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Tt(je),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||re("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Mv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Lv(){return new Dt(Ie.comparator)}function Fv(){return new Dt(Ie.comparator)}const R1=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),C1=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),k1=(()=>({and:"AND",or:"OR"}))();class D1{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Gf(n,e){return n.useProto3Json||Du(e)?e:{value:e}}function Sa(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Db(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function V1(n,e){return Sa(n,e.toTimestamp())}function en(n){return Pe(!!n),Ce.fromTimestamp(function(t){const r=Ts(t);return new Kt(r.seconds,r.nanos)}(n))}function Kp(n,e){return Kf(n,e).canonicalString()}function Kf(n,e){const t=function(s){return new it(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Vb(n){const e=it.fromString(n);return Pe(qb(e)),e}function pu(n,e){return Kp(n.databaseId,e.path)}function Hr(n,e){const t=Vb(e);if(t.get(1)!==n.databaseId.projectId)throw new se(z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new se(z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ie(Mb(t))}function Nb(n,e){return Kp(n.databaseId,e)}function Ob(n){const e=Vb(n);return e.length===4?it.emptyPath():Mb(e)}function Hf(n){return new it(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Mb(n){return Pe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function $v(n,e,t){return{name:pu(n,e),fields:t.value.mapValue.fields}}function Lb(n,e,t){const r=Hr(n,e.name),s=en(e.updateTime),i=e.createTime?en(e.createTime):Ce.min(),o=new xn({mapValue:{fields:e.fields}}),a=$t.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function N1(n,e){return"found"in e?function(r,s){Pe(!!s.found),s.found.name,s.found.updateTime;const i=Hr(r,s.found.name),o=en(s.found.updateTime),a=s.found.createTime?en(s.found.createTime):Ce.min(),l=new xn({mapValue:{fields:s.found.fields}});return $t.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Pe(!!s.missing),Pe(!!s.readTime);const i=Hr(r,s.missing),o=en(s.readTime);return $t.newNoDocument(i,o)}(n,e):xe()}function O1(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:xe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Pe(d===void 0||typeof d=="string"),Qt.fromBase64String(d||"")):(Pe(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Qt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?z.UNKNOWN:Pb(c.code);return new se(d,c.message||"")}(o);t=new kb(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Hr(n,r.document.name),i=en(r.document.updateTime),o=r.document.createTime?en(r.document.createTime):Ce.min(),a=new xn({mapValue:{fields:r.document.fields}}),l=$t.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Kc(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Hr(n,r.document),i=r.readTime?en(r.readTime):Ce.min(),o=$t.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Kc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Hr(n,r.document),i=r.removedTargetIds||[];t=new Kc([],i,s,null)}else{if(!("filter"in e))return xe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new A1(s,i),a=r.targetId;t=new Cb(a,o)}}return t}function mu(n,e){let t;if(e instanceof qa)t={update:$v(n,e.key,e.value)};else if(e instanceof za)t={delete:pu(n,e.key)};else if(e instanceof Vs)t={update:$v(n,e.key,e.data),updateMask:j1(e.fieldMask)};else{if(!(e instanceof jp))return xe();t={verify:pu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof xa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof po)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof mo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Aa)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw xe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:V1(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:xe()}(n,e.precondition)),t}function Wf(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?Gt.updateTime(en(i.updateTime)):i.exists!==void 0?Gt.exists(i.exists):Gt.none()}(e.currentDocument):Gt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Pe(a.setToServerValue==="REQUEST_TIME"),l=new xa;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new po(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new mo(d)}else"increment"in a?l=new Aa(o,a.increment):xe();const c=zt.fromServerFormat(a.fieldPath);return new Mu(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Hr(n,e.update.name),i=new xn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new nr(c.map(d=>zt.fromServerFormat(d)))}(e.updateMask);return new Vs(s,i,o,t,r)}return new qa(s,i,t,r)}if(e.delete){const s=Hr(n,e.delete);return new za(s,t)}if(e.verify){const s=Hr(n,e.verify);return new jp(s,t)}return xe()}function M1(n,e){return n&&n.length>0?(Pe(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?en(s.updateTime):en(i);return o.isEqual(Ce.min())&&(o=en(i)),new E1(o,s.transformResults||[])}(t,e))):[]}function Fb(n,e){return{documents:[Nb(n,e.path)]}}function th(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Nb(n,s);const i=function(c){if(c.length!==0)return Bb(Et.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:Zs(g.field),direction:F1(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Gf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function $b(n,e,t,r){const{_t:s,parent:i}=th(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:Zs(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:Zs(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function Ub(n){let e=Ob(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Pe(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=jb(f);return g instanceof Et&&Lp(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(R){return new fu(na(R.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(R.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Du(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new bi(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new bi(y,g)}(t.endAt)),ub(e,s,o,i,a,"F",l,c)}function L1(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function jb(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=na(t.unaryFilter.field);return ot.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=na(t.unaryFilter.field);return ot.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=na(t.unaryFilter.field);return ot.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=na(t.unaryFilter.field);return ot.create(o,"!=",{nullValue:"NULL_VALUE"});default:return xe()}}(n):n.fieldFilter!==void 0?function(t){return ot.create(na(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Et.create(t.compositeFilter.filters.map(r=>jb(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return xe()}}(t.compositeFilter.op))}(n):xe()}function F1(n){return R1[n]}function $1(n){return C1[n]}function U1(n){return k1[n]}function Zs(n){return{fieldPath:n.canonicalString()}}function na(n){return zt.fromServerFormat(n.fieldPath)}function Bb(n){return n instanceof ot?function(t){if(t.op==="=="){if(Iv(t.value))return{unaryFilter:{field:Zs(t.field),op:"IS_NAN"}};if(wv(t.value))return{unaryFilter:{field:Zs(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Iv(t.value))return{unaryFilter:{field:Zs(t.field),op:"IS_NOT_NAN"}};if(wv(t.value))return{unaryFilter:{field:Zs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zs(t.field),op:$1(t.op),value:t.value}}}(n):n instanceof Et?function(t){const r=t.getFilters().map(s=>Bb(s));return r.length===1?r[0]:{compositeFilter:{op:U1(t.op),filters:r}}}(n):xe()}function j1(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function qb(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,t,r,s,i=Ce.min(),o=Ce.min(),a=Qt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ms(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ms(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ms(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ms(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zb{constructor(e){this.ct=e}}function B1(n,e){let t;if(e.document)t=Lb(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Ie.fromSegments(e.noDocument.path),s=vo(e.noDocument.readTime);t=$t.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return xe();{const r=Ie.fromSegments(e.unknownDocument.path),s=vo(e.unknownDocument.version);t=$t.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Kt(s[0],s[1]);return Ce.fromTimestamp(i)}(e.readTime)),t}function Uv(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:vd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:pu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Sa(i,o.version.toTimestamp()),createTime:Sa(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:go(e.version)};else{if(!e.isUnknownDocument())return xe();r.unknownDocument={path:t.path.toArray(),version:go(e.version)}}return r}function vd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function go(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function vo(n){const e=new Kt(n.seconds,n.nanoseconds);return Ce.fromTimestamp(e)}function Zi(n,e){const t=(e.baseMutations||[]).map(i=>Wf(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Wf(n.ct,i)),s=Kt.fromMillis(e.localWriteTimeMs);return new Bp(e.batchId,s,t,r)}function Ml(n){const e=vo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?vo(n.lastLimboFreeSnapshotVersion):Ce.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Pe(i.documents.length===1),$n(Ba(Ob(i.documents[0])))}(n.query):function(i){return $n(Ub(i))}(n.query),new ms(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Qt.fromBase64String(n.resumeToken))}function Gb(n,e){const t=go(e.snapshotVersion),r=go(e.lastLimboFreeSnapshotVersion);let s;s=fd(e.target)?Fb(n.ct,e.target):th(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:fo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Hp(n){const e=Ub({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?md(e,e.limit,"L"):e}function nf(n,e){return new zp(e.largestBatchId,Wf(n.ct,e.overlayMutation))}function jv(n,e){const t=e.path.lastSegment();return[n,Fn(e.path.popLast()),t]}function Bv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:go(r.readTime),documentKey:Fn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q1{getBundleMetadata(e,t){return qv(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:vo(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return qv(e).put(function(s){return{bundleId:s.id,createTime:go(en(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return zv(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Hp(i.bundledQuery),readTime:vo(i.readTime)}}(r)})}saveNamedQuery(e,t){return zv(e).put(function(s){return{name:s.name,readTime:go(en(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function qv(n){return mn(n,"bundles")}function zv(n){return mn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new nh(e,r)}getOverlay(e,t){return Tl(e).get(jv(this.userId,t)).next(r=>r?nf(this.serializer,r):null)}getOverlays(e,t){const r=zr();return j.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new zp(t,o);s.push(this.ht(e,a))}),j.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Fn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Tl(e).j("collectionPathOverlayIndex",a))}),j.waitFor(i)}getOverlaysForCollection(e,t,r){const s=zr(),i=Fn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Tl(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=nf(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=zr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Tl(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=nf(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return Tl(e).put(function(s,i,o){const[a,l,c]=jv(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:mu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Tl(n){return mn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{Pt(e){return mn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Qt.fromUint8Array(r):Qt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(qt(e.integerValue));else if("doubleValue"in e){const r=qt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),uu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Ts(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(xs(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Z0(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Xd(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):xe()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(qt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Ie.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}eo.vt=new eo;function G1(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Gv(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=G1(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class K1{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=Gv(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=Gv(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class H1{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class W1{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class xl{constructor(){this.jt=new K1,this.Ht=new H1(this.jt),this.Jt=new W1(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new to(this.indexId,this.documentKey,this.arrayValue,r)}}function Ks(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Kv(n.arrayValue,e.arrayValue),t!==0?t:(t=Kv(n.directionalValue,e.directionalValue),t!==0?t:Ie.comparator(n.documentKey,e.documentKey)))}function Kv(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hv{constructor(e){this.Xt=new Tt((t,r)=>zt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Pe(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Lf(e);if(t!==void 0&&!this.sn(t))return!1;const r=Ji(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Tt(zt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new oo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new oo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new oo(r.field,r.dir==="asc"?0:1)));return new wa(wa.UNKNOWN_ID,this.collectionId,t,Ia.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(n){var e,t;if(Pe(n instanceof ot||n instanceof Et),n instanceof ot){if(n instanceof lb){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>ot.create(n.field,"==",i)))||[];return Et.create(s,"or")}return n}const r=n.filters.map(s=>Kb(s));return Et.create(r,n.op)}function Q1(n){if(n.getFilters().length===0)return[];const e=Yf(Kb(n));return Pe(Hb(e)),Qf(e)||Jf(e)?[e]:e.getFilters()}function Qf(n){return n instanceof ot}function Jf(n){return n instanceof Et&&Lp(n)}function Hb(n){return Qf(n)||Jf(n)||function(t){if(t instanceof Et&&jf(t)){for(const r of t.getFilters())if(!Qf(r)&&!Jf(r))return!1;return!0}return!1}(n)}function Yf(n){if(Pe(n instanceof ot||n instanceof Et),n instanceof ot)return n;if(n.filters.length===1)return Yf(n.filters[0]);const e=n.filters.map(r=>Yf(r));let t=Et.create(e,n.op);return t=yd(t),Hb(t)?t:(Pe(t instanceof Et),Pe(Ta(t)),Pe(t.filters.length>1),t.filters.reduce((r,s)=>Wp(r,s)))}function Wp(n,e){let t;return Pe(n instanceof ot||n instanceof Et),Pe(e instanceof ot||e instanceof Et),t=n instanceof ot?e instanceof ot?function(s,i){return Et.create([s,i],"and")}(n,e):Wv(n,e):e instanceof ot?Wv(e,n):function(s,i){if(Pe(s.filters.length>0&&i.filters.length>0),Ta(s)&&Ta(i))return ib(s,i.getFilters());const o=jf(s)?s:i,a=jf(s)?i:s,l=o.filters.map(c=>Wp(c,a));return Et.create(l,"or")}(n,e),yd(t)}function Wv(n,e){if(Ta(e))return ib(e,n.getFilters());{const t=e.filters.map(r=>Wp(n,r));return Et.create(t,"or")}}function yd(n){if(Pe(n instanceof ot||n instanceof Et),n instanceof ot)return n;const e=n.getFilters();if(e.length===1)return yd(e[0]);if(rb(n))return n;const t=e.map(s=>yd(s)),r=[];return t.forEach(s=>{s instanceof ot?r.push(s):s instanceof Et&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Et.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1{constructor(){this.un=new Qp}addToCollectionParentIndex(e,t){return this.un.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(pr.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(pr.min())}updateCollectionGroup(e,t,r){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}}class Qp{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Tt(it.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Tt(it.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc=new Uint8Array(0);class Y1{constructor(e,t){this.databaseId=t,this.cn=new Qp,this.ln=new Ds(r=>fo(r),(r,s)=>Vu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Fn(s)};return Qv(e).put(i)}return j.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[$0(t),""],!1,!0);return Qv(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(qr(o.parent))}return r})}addFieldIndex(e,t){const r=Al(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Wo(e);return i.next(a=>{o.put(Bv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Al(e),s=Wo(e),i=Ho(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Al(e),r=Ho(e),s=Wo(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return j.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Hv(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ho(e);let s=!0;const i=new Map;return j.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=He();const a=[];return j.forEach(i,(l,c)=>{re("IndexedDbIndexManager",`Using index ${function(P){return`id=${P.indexId}|cg=${P.collectionGroup}|f=${P.fields.map(q=>`${q.fieldPath}:${q.kind}`).join(",")}`}(l)} to execute ${fo(t)}`);const d=function(P,q){const X=Lf(q);if(X===void 0)return null;for(const pe of pd(P,X.fieldPath))switch(pe.op){case"array-contains-any":return pe.value.arrayValue.values||[];case"array-contains":return[pe.value]}return null}(c,l),f=function(P,q){const X=new Map;for(const pe of Ji(q))for(const T of pd(P,pe.fieldPath))switch(T.op){case"==":case"in":X.set(pe.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return X.set(pe.fieldPath.canonicalString(),T.value),Array.from(X.values())}return null}(c,l),g=function(P,q){const X=[];let pe=!0;for(const T of Ji(q)){const w=T.kind===0?Sv(P,T.fieldPath,P.startAt):Pv(P,T.fieldPath,P.startAt);X.push(w.value),pe&&(pe=w.inclusive)}return new bi(X,pe)}(c,l),y=function(P,q){const X=[];let pe=!0;for(const T of Ji(q)){const w=T.kind===0?Pv(P,T.fieldPath,P.endAt):Sv(P,T.fieldPath,P.endAt);X.push(w.value),pe&&(pe=w.inclusive)}return new bi(X,pe)}(c,l),R=this.In(l,c,g),x=this.In(l,c,y),V=this.Tn(l,c,f),B=this.En(l.indexId,d,R,g.inclusive,x,y.inclusive,V);return j.forEach(B,F=>r.G(F,t.limit).next(P=>{P.forEach(q=>{const X=Ie.fromSegments(q.documentKey);o.has(X)||(o=o.add(X),a.push(X))})}))}).next(()=>a)}return j.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=Q1(Et.create(e.filters,"and")).map(r=>qf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Sc,y=this.An(e,g,r[f%c],s),R=this.Rn(e,g,i[f%c],o),x=a.map(V=>this.An(e,g,V,!0));d.push(...this.createRange(y,R,x))}return d}An(e,t,r,s){const i=new to(e,Ie.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new to(e,Ie.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Hv(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return j.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Tt(zt.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new xl;for(const s of Ji(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);eo.vt.It(i,o)}return r.zt()}dn(e){const t=new xl;return eo.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new xl;return eo.vt.It(ho(this.databaseId,t),r.Yt(function(i){const o=Ji(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new xl);let i=0;for(const o of Ji(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&hu(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);eo.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new xl;l.seed(a.zt()),eo.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof ot&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Al(e),s=Wo(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return j.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new Ia(f.sequenceNumber,new pr(vo(f.readTime),new Ie(qr(f.documentKey)),f.largestBatchId)):Ia.empty(),y=d.fields.map(([R,x])=>new oo(zt.fromServerFormat(R),x));return new wa(d.indexId,d.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:je(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Al(e),i=Wo(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>j.forEach(a,l=>i.put(Bv(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return j.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?j.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),j.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?j.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return Ho(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ho(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ho(e);let i=new Tt(Ks);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new to(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Tt(Ks);const s=this.Vn(t,e);if(s==null)return r;const i=Lf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(hu(o))for(const a of o.arrayValue.values||[])r=r.add(new to(t.indexId,e.key,this.dn(a),s))}else r=r.add(new to(t.indexId,e.key,Sc,s));return r}bn(e,t,r,s,i){re("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,g){const y=l.getIterator(),R=c.getIterator();let x=Ko(y),V=Ko(R);for(;x||V;){let B=!1,F=!1;if(x&&V){const P=d(x,V);P<0?F=!0:P>0&&(B=!0)}else x!=null?F=!0:B=!0;B?(f(V),V=Ko(R)):F?(g(x),x=Ko(y)):(x=Ko(y),V=Ko(R))}}(s,i,Ks,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),j.waitFor(o)}yn(e){let t=1;return Wo(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Ks(o,a)).filter((o,a,l)=>!a||Ks(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ks(o,e),l=Ks(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Sc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Sc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Ks(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Jv)}getMinOffset(e,t){return j.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||xe())).next(Jv)}}function Qv(n){return mn(n,"collectionParents")}function Ho(n){return mn(n,"indexEntries")}function Al(n){return mn(n,"indexConfiguration")}function Wo(n){return mn(n,"indexState")}function Jv(n){Pe(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Np(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new pr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Vn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Vn(e,Vn.DEFAULT_COLLECTION_PERCENTILE,Vn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wb(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Pe(a===1)}));const c=[];for(const d of t.mutations){const f=K0(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return j.waitFor(i).next(()=>c)}function _d(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw xe();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vn.DEFAULT_COLLECTION_PERCENTILE=10,Vn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vn.DEFAULT=new Vn(41943040,Vn.DEFAULT_COLLECTION_PERCENTILE,Vn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vn.DISABLED=new Vn(-1,0,0);class rh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Pe(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new rh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hs(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=ra(e),o=Hs(e);return o.add({}).next(a=>{Pe(typeof a=="number");const l=new Bp(a,t,r,s),c=function(y,R,x){const V=x.baseMutations.map(F=>mu(y.ct,F)),B=x.mutations.map(F=>mu(y.ct,F));return{userId:R,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:V,mutations:B}}(this.serializer,this.userId,l),d=[];let f=new Tt((g,y)=>je(g.canonicalString(),y.canonicalString()));for(const g of s){const y=K0(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,$P))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),j.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return Hs(e).get(t).next(r=>r?(Pe(r.userId===this.userId),Zi(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?j.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Hs(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Pe(a.batchId>=r),i=Zi(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Hs(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Hs(e).U("userMutationsIndex",t).next(r=>r.map(s=>Zi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=jc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return ra(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,g=qr(d);if(c===this.userId&&t.path.isEqual(g))return Hs(e).get(f).next(y=>{if(!y)throw xe();Pe(y.userId===this.userId),i.push(Zi(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Tt(je);const s=[];return t.forEach(i=>{const o=jc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=ra(e).J({range:a},(c,d,f)=>{const[g,y,R]=c,x=qr(y);g===this.userId&&i.path.isEqual(x)?r=r.add(R):f.done()});s.push(l)}),j.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=jc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Tt(je);return ra(e).J({range:o},(l,c,d)=>{const[f,g,y]=l,R=qr(g);f===this.userId&&r.isPrefixOf(R)?R.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Hs(e).get(i).next(o=>{if(o===null)throw xe();Pe(o.userId===this.userId),r.push(Zi(this.serializer,o))}))}),j.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Wb(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),j.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return j.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return ra(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=qr(i[1]);s.push(l)}else a.done()}).next(()=>{Pe(s.length===0)})})}containsKey(e,t){return Qb(e,this.userId,t)}Nn(e){return Jb(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Qb(n,e,t){const r=jc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return ra(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Hs(n){return mn(n,"mutations")}function ra(n){return mn(n,"documentMutations")}function Jb(n){return mn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new yo(0)}static kn(){return new yo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new yo(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Ce.fromTimestamp(new Kt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qo(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Pe(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Qo(e).J((o,a)=>{const l=Ml(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>j.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Qo(e).J((r,s)=>{const i=Ml(s);t(i)})}qn(e){return Xv(e).get("targetGlobalKey").next(t=>(Pe(t!==null),t))}Qn(e,t){return Xv(e).put("targetGlobalKey",t)}Kn(e,t){return Qo(e).put(Gb(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=fo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Qo(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Ml(a);Vu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ei(e);return t.forEach(o=>{const a=Fn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),j.waitFor(s)}removeMatchingKeys(e,t,r){const s=ei(e);return j.forEach(t,i=>{const o=Fn(i.path);return j.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ei(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ei(e);let i=He();return s.J({range:r,H:!0},(o,a,l)=>{const c=qr(o[1]),d=new Ie(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=Fn(t.path),s=IDBKeyRange.bound([r],[$0(r)],!1,!0);let i=0;return ei(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Qo(e).get(t).next(r=>r?Ml(r):null)}}function Qo(n){return mn(n,"targets")}function Xv(n){return mn(n,"targetGlobal")}function ei(n){return mn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zv([n,e],[t,r]){const s=je(n,t);return s===0?je(e,r):s}class Z1{constructor(e){this.Un=e,this.buffer=new Tt(Zv),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Zv(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Yb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){re("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ai(t)?re("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await xi(t)}await this.Hn(3e5)})}}class eR{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return j.resolve(tr.oe);const r=new Z1(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(re("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(Yv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(re("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Yv):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(re("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),ea()<=st.DEBUG&&re("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function Xb(n,e){return new eR(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tR{constructor(e,t){this.db=e,this.garbageCollector=Xb(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Pc(e,r)}removeReference(e,t,r){return Pc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Pc(e,t)}nr(e,t){return function(s,i){let o=!1;return Jb(s).Y(a=>Qb(s,a,i).next(l=>(l&&(o=!0),j.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ce.min()),ei(e).delete(function(f){return[0,Fn(f.path)]}(o))))});s.push(l)}}).next(()=>j.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Pc(e,t)}tr(e,t){const r=ei(e);let s,i=tr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==tr.oe&&t(new Ie(qr(s)),i),i=c,s=l):i=tr.oe}).next(()=>{i!==tr.oe&&t(new Ie(qr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Pc(n,e){return ei(n).put(function(r,s){return{targetId:0,path:Fn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(){this.changes=new Ds(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$t.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?j.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Hi(e).put(r)}removeEntry(e,t,r){return Hi(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],vd(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=$t.newInvalidDocument(t);return Hi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Sl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:$t.newInvalidDocument(t)};return Hi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Sl(t))},(s,i)=>{r={document:this.ir(t,i),size:_d(i)}}).next(()=>r)}getEntries(e,t){let r=rr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=rr(),s=new Dt(Ie.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,_d(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return j.resolve();let s=new Tt(ny);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Sl(s.first()),Sl(s.last())),o=s.getIterator();let a=o.getNext();return Hi(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=Ie.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&ny(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(Sl(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),vd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Hi(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=rr();for(const f of c){const g=this.ir(Ie.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Ou(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=rr();const o=ty(t,r),a=ty(t,pr.max());return Hi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(Ie.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new rR(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ey(e).get("remoteDocumentGlobalKey").next(t=>(Pe(!!t),t))}rr(e,t){return ey(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=B1(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ce.min())))return r}return $t.newInvalidDocument(e)}}function ew(n){return new nR(n)}class rR extends Zb{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Ds(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Tt((i,o)=>je(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Uv(this.cr.serializer,o);s=s.add(i.path.popLast());const c=_d(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Uv(this.cr.serializer,o.convertToNoDocument(Ce.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),j.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function ey(n){return mn(n,"remoteDocumentGlobal")}function Hi(n){return mn(n,"remoteDocumentsV14")}function Sl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ty(n,e){const t=e.documentKey.path.toArray();return[n,vd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function ny(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=je(t[i],r[i]),s)return s;return s=je(t.length,r.length),s||(s=je(t[t.length-2],r[r.length-2]),s||je(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tw{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Yl(r.mutation,s,nr.empty(),Kt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,He()).next(()=>r))}getLocalViewOfDocuments(e,t,r=He()){const s=zr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Nl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=zr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,He()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=rr();const o=Jl(),a=function(){return Jl()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof Vs)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Yl(d.mutation,c,d.mutation.getFieldMask(),Kt.now())):o.set(c.key,nr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new sR(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Jl();let s=new Dt((o,a)=>o-a),i=He();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||nr.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||He()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=vb();d.forEach(g=>{if(!i.has(g)){const y=Tb(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return j.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ie.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Fp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):j.resolve(zr());let a=-1,l=i;return o.next(c=>j.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?j.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,He())).next(d=>({batchId:a,changes:gb(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ie(t)).next(r=>{let s=Nl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Nl();return this.indexManager.getCollectionParents(e,i).next(a=>j.forEach(a,l=>{const c=function(f,g){return new ks(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,$t.newInvalidDocument(d)))});let a=Nl();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&Yl(d.mutation,c,nr.empty(),Kt.now()),Ou(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return j.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:en(s.createTime)}}(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Hp(s.bundledQuery),readTime:en(s.readTime)}}(t)),j.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(){this.overlays=new Dt(Ie.comparator),this.Ir=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){const r=zr();return j.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),j.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),j.resolve()}getOverlaysForCollection(e,t,r){const s=zr(),i=t.length+1,o=new Ie(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return j.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Dt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=zr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=zr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return j.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new zp(t,r));let i=this.Ir.get(t);i===void 0&&(i=He(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aR{constructor(){this.sessionToken=Qt.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(){this.Tr=new Tt(vn.Er),this.dr=new Tt(vn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new vn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new vn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ie(new it([])),r=new vn(t,e),s=new vn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ie(new it([])),r=new vn(t,e),s=new vn(t,e+1);let i=He();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new vn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class vn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ie.comparator(e.key,t.key)||je(e.wr,t.wr)}static Ar(e,t){return je(e.wr,t.wr)||Ie.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Tt(vn.Er)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Bp(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new vn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return j.resolve(o)}lookupMutationBatch(e,t){return j.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return j.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new vn(t,0),s=new vn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),j.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Tt(je);return t.forEach(s=>{const i=new vn(s,0),o=new vn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),j.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ie.isDocumentKey(i)||(i=i.child(""));const o=new vn(new Ie(i),0);let a=new Tt(je);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),j.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Pe(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return j.forEach(t.mutations,s=>{const i=new vn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new vn(t,0),s=this.br.firstAfterOrEqual(r);return j.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(e){this.Mr=e,this.docs=function(){return new Dt(Ie.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return j.resolve(r?r.document.mutableCopy():$t.newInvalidDocument(t))}getEntries(e,t){let r=rr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():$t.newInvalidDocument(s))}),j.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=rr();const o=t.path,a=new Ie(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Np(j0(d),r)<=0||(s.has(d.key)||Ou(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return j.resolve(i)}getAllFromCollectionGroup(e,t,r,s){xe()}Or(e,t){return j.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new cR(this)}getSize(e){return j.resolve(this.size)}}class cR extends Zb{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),j.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e){this.persistence=e,this.Nr=new Ds(t=>fo(t),Vu),this.lastRemoteSnapshotVersion=Ce.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Jp,this.targetCount=0,this.kr=yo.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),j.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new yo(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.Kn(t),j.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),j.waitFor(i).next(()=>s)}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return j.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),j.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),j.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),j.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return j.resolve(r)}containsKey(e,t){return j.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e,t){this.qr={},this.overlays={},this.Qr=new tr(0),this.Kr=!1,this.Kr=!0,this.$r=new aR,this.referenceDelegate=e(this),this.Ur=new dR(this),this.indexManager=new J1,this.remoteDocumentCache=function(s){return new uR(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new zb(t),this.Gr=new iR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new lR(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){re("MemoryPersistence","Starting transaction:",e);const s=new hR(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return j.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class hR extends q0{constructor(e){super(),this.currentSequenceNumber=e}}class sh{constructor(e){this.persistence=e,this.Jr=new Jp,this.Yr=null}static Zr(e){return new sh(e)}get Xr(){if(this.Yr)return this.Yr;throw xe()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),j.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),j.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.Xr,r=>{const s=Ie.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Ce.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return j.or([()=>j.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class bd{constructor(e,t){this.persistence=e,this.ti=new Ds(r=>Fn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Xb(this,t)}static Zr(e,t){return new bd(e,t)}zr(){}jr(e){return j.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return j.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?j.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ce.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),j.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),j.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),j.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),j.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=qc(e.data.value)),t}nr(e,t,r){return j.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return j.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Qd("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gv,{unique:!0}),l.createObjectStore("documentMutations")}(e),ry(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=j.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),ry(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ce.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gv,{unique:!0});const f=c.store("mutations"),g=d.map(y=>f.put(y));return j.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:YP});c.createIndex("collectionPathOverlayIndex",XP,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",ZP,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:UP});c.createIndex("documentKeyIndex",jP),c.createIndex("collectionGroupIndex",BP)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:HP}).createIndex("sequenceNumberIndex",WP,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:QP}).createIndex("documentKeyIndex",JP,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=_d(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>j.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>j.forEach(a,l=>{Pe(l.userId===i.userId);const c=Zi(this.serializer,l);return Wb(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new it(o),c=function(f){return[0,Fn(f)]}(l);i.push(t.get(c).next(d=>d?j.resolve():(f=>t.put({targetId:0,path:Fn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>j.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:KP});const r=t.store("collectionParents"),s=new Qp,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Fn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new it(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=qr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Ml(s),o=Gb(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Ie(it.fromString(f.document.name).popFirst(5)):f.noDocument?Ie.fromSegments(f.noDocument.path):f.unknownDocument?Ie.fromSegments(f.unknownDocument.path):xe()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>j.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=ew(this.serializer),i=new Yp(sh.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:He();Zi(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),j.forEach(a,(l,c)=>{const d=new yn(c),f=nh.lt(this.serializer,d),g=i.getIndexManager(d),y=rh.lt(d,this.serializer,g,i.referenceDelegate);return new tw(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Ff(t,tr.oe),l).next()})})}}function ry(n){n.createObjectStore("targetDocuments",{keyPath:zP}).createIndex("documentTargetsIndex",GP,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",qP,{unique:!0}),n.createObjectStore("targetGlobal")}const rf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Xp{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Xp.D())throw new se(z.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new tR(this,s),this.Ai=t+"main",this.serializer=new zb(l),this.Ri=new Kr(this.Ai,this.hi,new fR(this.serializer)),this.$r=new z1,this.Ur=new X1(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ew(this.serializer),this.Gr=new q1,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Xt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new se(z.FAILED_PRECONDITION,rf);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new tr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Rc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Ai(e))return re("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return re("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Pl(e).get("owner").next(t=>j.resolve(this.vi(t)))}Ci(e){return Rc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=mn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return j.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?j.resolve(!0):Pl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new se(z.FAILED_PRECONDITION,rf);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&re("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Ff(e,tr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Rc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return rh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Y1(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return nh.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){re("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?n1:l===16?t1:l===15?Mp:l===14?Q0:l===13?W0:l===12?e1:l===11?H0:void xe()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Ff(a,this.Qr?this.Qr.next():tr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Xt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new se(z.FAILED_PRECONDITION,B0);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Pl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new se(z.FAILED_PRECONDITION,rf)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pl(e).put("owner",t)}static D(){return Kr.D()}bi(e){const t=Pl(e);return t.get("owner").next(r=>this.vi(r)?(re("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):j.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Xt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;I0()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return re("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Xt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Xt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Pl(n){return mn(n,"owner")}function Rc(n){return mn(n,"clientMetadata")}function Zp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=He(),s=He();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new em(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return I0()?8:z0(pn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new pR;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(ea()<=st.DEBUG&&re("QueryEngine","SDK will not create cache indexes for query:",ta(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),j.resolve()):(ea()<=st.DEBUG&&re("QueryEngine","Query:",ta(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(ea()<=st.DEBUG&&re("QueryEngine","The SDK decides to create cache indexes for query:",ta(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$n(t))):j.resolve())}Yi(e,t){if(Rv(t))return j.resolve(null);let r=$n(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=md(t,null,"F"),r=$n(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=He(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,md(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Rv(t)||s.isEqual(Ce.min())?j.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?j.resolve(null):(ea()<=st.DEBUG&&re("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ta(t)),this.rs(e,o,t,U0(s,-1)).next(a=>a))})}ts(e,t){let r=new Tt(pb(e));return t.forEach((s,i)=>{Ou(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return ea()<=st.DEBUG&&re("QueryEngine","Using full collection scan to execute query:",ta(t)),this.Ji.getDocumentsMatchingQuery(e,t,pr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Dt(je),this._s=new Ds(i=>fo(i),Vu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tw(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function rw(n,e,t,r){return new mR(n,e,t,r)}async function sw(n,e){const t=ye(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=He();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function gR(n,e){const t=ye(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,g=f.keys();let y=j.resolve();return g.forEach(R=>{y=y.next(()=>d.getEntry(l,R)).next(x=>{const V=c.docVersions.get(R);Pe(V!==null),x.version.compareTo(V)<0&&(f.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),d.addEntry(x)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=He();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function iw(n){const e=ye(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function vR(n,e){const t=ye(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Qt.EMPTY_BYTE_STRING,Ce.min()).withLastLimboFreeSnapshotVersion(Ce.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(x,V,B){return x.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0}(g,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=rr(),c=He();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(ow(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(Ce.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return j.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function ow(n,e,t){let r=He(),s=He();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=rr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ce.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):re("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function yR(n,e){const t=ye(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Pa(n,e){const t=ye(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,j.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new ms(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Ra(n,e,t){const r=ye(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ai(o))throw o;re("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function wd(n,e,t){const r=ye(n);let s=Ce.min(),i=He();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=ye(l),g=f._s.get(d);return g!==void 0?j.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,$n(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Ce.min(),t?i:He())).next(a=>(uw(r,fb(e),a),{documents:a,Ts:i})))}function aw(n,e){const t=ye(n),r=ye(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function lw(n,e){const t=ye(n),r=t.us.get(e)||Ce.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,U0(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(uw(t,e,s),s))}function uw(n,e,t){let r=n.us.get(e)||Ce.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function _R(n,e,t,r){const s=ye(n);let i=He(),o=rr();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Pa(s,function(d){return $n(Ba(it.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>ow(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function bR(n,e,t=He()){const r=await Pa(n,$n(Hp(e.bundledQuery))),s=ye(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=en(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Qt.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function sy(n,e){return`firestore_clients_${n}_${e}`}function iy(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function sf(n,e){return`firestore_targets_${n}_${e}`}class Id{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new se(s.error.code,s.error.message))),o?new Id(e,t,s.state,i):(Xt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xl{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new se(r.error.code,r.error.message))),i?new Xl(e,r.state,s):(Xt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ed{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=$p();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=G0(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ed(e,i):(Xt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class tm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new tm(t.clientId,t.onlineState):(Xt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Xf{constructor(){this.activeTargetIds=$p()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class of{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Dt(je),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=sy(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Xf),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(sy(this.persistenceKey,r));if(s){const i=Ed.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(sf(this.persistenceKey,e));if(s){const i=Xl.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(sf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return re("SharedClientState","READ",e,t),t}setItem(e,t){re("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){re("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(re("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Xt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=tr.oe;if(i!=null)try{const a=JSON.parse(i);Pe(typeof a=="number"),o=a}catch(a){Xt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==tr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Id(this.currentUser,e,t,r),i=iy(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=iy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=sf(this.persistenceKey,e),i=new Xl(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Ed.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Id.Rs(new yn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Xl.Rs(s,t)}Ls(e){return tm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);re("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=$p();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class cw{constructor(){this.so=new Xf,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Xf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){re("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){re("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Cc=null;function af(){return Cc===null?Cc=function(){return 268435456+Math.round(2147483648*Math.random())}():Cc++,"0x"+Cc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kn="WebChannelConnection";class TR extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=af(),l=this.xo(t,r.toUriEncodedString());re("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(re("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw wr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ja}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=IR[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=af();return new Promise((o,a)=>{const l=new k0;l.setWithCredentials(!0),l.listenOnce(D0.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Uc.NO_ERROR:const d=l.getResponseJson();re(kn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Uc.TIMEOUT:re(kn,`RPC '${e}' ${i} timed out`),a(new se(z.DEADLINE_EXCEEDED,"Request time out"));break;case Uc.HTTP_ERROR:const f=l.getStatus();if(re(kn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const R=function(V){const B=V.toLowerCase().replace(/_/g,"-");return Object.values(z).indexOf(B)>=0?B:z.UNKNOWN}(y.status);a(new se(R,y.message))}else a(new se(z.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new se(z.UNAVAILABLE,"Connection failed."));break;default:xe()}}finally{re(kn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);re(kn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=af(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=O0(),a=N0(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");re(kn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,y=!1;const R=new ER({Io:V=>{y?re(kn,`Not sending because RPC '${e}' stream ${s} is closed:`,V):(g||(re(kn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),re(kn,`RPC '${e}' stream ${s} sending:`,V),f.send(V))},To:()=>f.close()}),x=(V,B,F)=>{V.listen(B,P=>{try{F(P)}catch(q){setTimeout(()=>{throw q},0)}})};return x(f,Vl.EventType.OPEN,()=>{y||(re(kn,`RPC '${e}' stream ${s} transport opened.`),R.yo())}),x(f,Vl.EventType.CLOSE,()=>{y||(y=!0,re(kn,`RPC '${e}' stream ${s} transport closed`),R.So())}),x(f,Vl.EventType.ERROR,V=>{y||(y=!0,wr(kn,`RPC '${e}' stream ${s} transport errored:`,V),R.So(new se(z.UNAVAILABLE,"The operation could not be completed")))}),x(f,Vl.EventType.MESSAGE,V=>{var B;if(!y){const F=V.data[0];Pe(!!F);const P=F,q=P.error||((B=P[0])===null||B===void 0?void 0:B.error);if(q){re(kn,`RPC '${e}' stream ${s} received error:`,q);const X=q.status;let pe=function(I){const C=rn[I];if(C!==void 0)return Pb(C)}(X),T=q.message;pe===void 0&&(pe=z.INTERNAL,T="Unknown error status: "+X+" with message "+q.message),y=!0,R.So(new se(pe,T)),f.close()}else re(kn,`RPC '${e}' stream ${s} received:`,F),R.bo(F)}}),x(a,V0.STAT_EVENT,V=>{V.stat===Mf.PROXY?re(kn,`RPC '${e}' stream ${s} detected buffering proxy`):V.stat===Mf.NOPROXY&&re(kn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{R.wo()},0),R}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dw(){return typeof window<"u"?window:null}function Hc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $u(n){return new D1(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&re("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new nm(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===z.RESOURCE_EXHAUSTED?(Xt(t.toString()),Xt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new se(z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return re("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(re("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class xR extends hw{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=O1(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ce.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ce.min():o.readTime?en(o.readTime):Ce.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Hf(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=fd(l)?{documents:Fb(i,l)}:{query:th(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Db(i,o.resumeToken);const c=Gf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Ce.min())>0){a.readTime=Sa(i,o.snapshotVersion.toTimestamp());const c=Gf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=L1(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Hf(this.serializer),t.removeTarget=e,this.a_(t)}}class AR extends hw{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Pe(!!e.streamToken),this.lastStreamToken=e.streamToken,Pe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Pe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=M1(e.writeResults,e.commitTime),r=en(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Hf(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>mu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new se(z.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Kf(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new se(z.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Kf(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new se(z.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class PR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Xt(t),this.D_=!1):re("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Pi(this)&&(re("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=ye(l);c.L_.add(4),await Ga(c),c.q_.set("Unknown"),c.L_.delete(4),await Uu(c)}(this))})}),this.q_=new PR(r,s)}}async function Uu(n){if(Pi(n))for(const e of n.B_)await e(!0)}async function Ga(n){for(const e of n.B_)await e(!1)}function ih(n,e){const t=ye(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),im(t)?sm(t):Ha(t).r_()&&rm(t,e))}function Ca(n,e){const t=ye(n),r=Ha(t);t.N_.delete(e),r.r_()&&fw(t,e),t.N_.size===0&&(r.r_()?r.o_():Pi(t)&&t.q_.set("Unknown"))}function rm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ce.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ha(n).A_(e)}function fw(n,e){n.Q_.xe(e),Ha(n).R_(e)}function sm(n){n.Q_=new P1({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ha(n).start(),n.q_.v_()}function im(n){return Pi(n)&&!Ha(n).n_()&&n.N_.size>0}function Pi(n){return ye(n).L_.size===0}function pw(n){n.Q_=void 0}async function CR(n){n.q_.set("Online")}async function kR(n){n.N_.forEach((e,t)=>{rm(n,e)})}async function DR(n,e){pw(n),im(n)?(n.q_.M_(e),sm(n)):n.q_.set("Unknown")}async function VR(n,e,t){if(n.q_.set("Online"),e instanceof kb&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){re("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Td(n,r)}else if(e instanceof Kc?n.Q_.Ke(e):e instanceof Cb?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Ce.min()))try{const r=await iw(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Qt.EMPTY_BYTE_STRING,d.snapshotVersion)),fw(i,l);const f=new ms(d.target,l,c,d.sequenceNumber);rm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){re("RemoteStore","Failed to raise snapshot:",r),await Td(n,r)}}async function Td(n,e,t){if(!Ai(e))throw e;n.L_.add(1),await Ga(n),n.q_.set("Offline"),t||(t=()=>iw(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{re("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await Uu(n)})}function mw(n,e){return e().catch(t=>Td(n,t,e))}async function Ka(n){const e=ye(n),t=wi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;NR(e);)try{const s=await yR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,OR(e,s)}catch(s){await Td(e,s)}gw(e)&&vw(e)}function NR(n){return Pi(n)&&n.O_.length<10}function OR(n,e){n.O_.push(e);const t=wi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function gw(n){return Pi(n)&&!wi(n).n_()&&n.O_.length>0}function vw(n){wi(n).start()}async function MR(n){wi(n).p_()}async function LR(n){const e=wi(n);for(const t of n.O_)e.m_(t.mutations)}async function FR(n,e,t){const r=n.O_.shift(),s=qp.from(r,e,t);await mw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ka(n)}async function $R(n,e){e&&wi(n).V_&&await async function(r,s){if(function(o){return Sb(o)&&o!==z.ABORTED}(s.code)){const i=r.O_.shift();wi(r).s_(),await mw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ka(r)}}(n,e),gw(n)&&vw(n)}async function ay(n,e){const t=ye(n);t.asyncQueue.verifyOperationInProgress(),re("RemoteStore","RemoteStore received new credentials");const r=Pi(t);t.L_.add(3),await Ga(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Uu(t)}async function Zf(n,e){const t=ye(n);e?(t.L_.delete(2),await Uu(t)):e||(t.L_.add(2),await Ga(t),t.q_.set("Unknown"))}function Ha(n){return n.K_||(n.K_=function(t,r,s){const i=ye(t);return i.w_(),new xR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:CR.bind(null,n),Ro:kR.bind(null,n),mo:DR.bind(null,n),d_:VR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),im(n)?sm(n):n.q_.set("Unknown")):(await n.K_.stop(),pw(n))})),n.K_}function wi(n){return n.U_||(n.U_=function(t,r,s){const i=ye(t);return i.w_(),new AR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:MR.bind(null,n),mo:$R.bind(null,n),f_:LR.bind(null,n),g_:FR.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Ka(n)):(await n.U_.stop(),n.O_.length>0&&(re("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new bn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new om(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new se(z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Wa(n,e){if(Xt("AsyncQueue",`${e}: ${n}`),Ai(n))return new se(z.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ie.comparator(t.key,r.key):(t,r)=>Ie.comparator(t.key,r.key),this.keyedMap=Nl(),this.sortedSet=new Dt(this.comparator)}static emptySet(e){return new da(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof da)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new da;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(){this.W_=new Dt(Ie.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):xe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class ka{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new ka(e,t,da.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Nu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class jR{constructor(){this.queries=uy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=ye(t),i=s.queries;s.queries=uy(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new se(z.ABORTED,"Firestore shutting down"))}}function uy(){return new Ds(n=>hb(n),Nu)}async function am(n,e){const t=ye(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new UR,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Wa(o,`Initialization of query '${ta(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&um(t)}async function lm(n,e){const t=ye(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function BR(n,e){const t=ye(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&um(t)}function qR(n,e,t){const r=ye(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function um(n){n.Y_.forEach(e=>{e.next()})}var ep,cy;(cy=ep||(ep={})).ea="default",cy.Cache="cache";class cm{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new ka(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=ka.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ep.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(e){this.serializer=e}Es(e){return Hr(this.serializer,e)}ds(e){return e.metadata.exists?Lb(this.serializer,e.document,!1):$t.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return en(e)}}class GR{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=yw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=it.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new dy(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||He()).add(i);t.set(o,a)}}return t}async complete(){const e=await _R(this.localStore,new dy(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await bR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function yw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(e){this.key=e}}class bw{constructor(e){this.key=e}}class ww{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=He(),this.mutatedKeys=He(),this.Aa=pb(e),this.Ra=new da(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new ly,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),y=Ou(this.query,f)?f:null,R=!!g&&this.mutatedKeys.has(g.key),x=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let V=!1;g&&y?g.data.isEqual(y.data)?R!==x&&(r.track({type:3,doc:y}),V=!0):this.ga(g,y)||(r.track({type:2,doc:y}),V=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),V=!0):g&&!y&&(r.track({type:1,doc:g}),V=!0,(l||c)&&(a=!0)),V&&(y?(o=o.add(y),i=x?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,R){const x=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xe()}};return x(y)-x(R)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new ka(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ly,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=He(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new bw(r))}),this.da.forEach(r=>{e.has(r)||t.push(new _w(r))}),t}ba(e){this.Ta=e.Ts,this.da=He();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return ka.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class KR{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class HR{constructor(e){this.key=e,this.va=!1}}class WR{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Ds(a=>hb(a),Nu),this.Ma=new Map,this.xa=new Set,this.Oa=new Dt(Ie.comparator),this.Na=new Map,this.La=new Jp,this.Ba={},this.ka=new Map,this.qa=yo.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function QR(n,e,t=!0){const r=oh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Iw(r,e,t,!0),s}async function JR(n,e){const t=oh(n);await Iw(t,e,!0,!1)}async function Iw(n,e,t,r){const s=await Pa(n.localStore,$n(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await dm(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&ih(n.remoteStore,s),a}async function dm(n,e,t,r,s){n.Ka=(f,g,y)=>async function(x,V,B,F){let P=V.view.ma(B);P.ns&&(P=await wd(x.localStore,V.query,!1).then(({documents:T})=>V.view.ma(T,P)));const q=F&&F.targetChanges.get(V.targetId),X=F&&F.targetMismatches.get(V.targetId)!=null,pe=V.view.applyChanges(P,x.isPrimaryClient,q,X);return tp(x,V.targetId,pe.wa),pe.snapshot}(n,f,g,y);const i=await wd(n.localStore,e,!0),o=new ww(e,i.Ts),a=o.ma(i.documents),l=Fu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);tp(n,t,c.wa);const d=new KR(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function YR(n,e,t){const r=ye(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Nu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ra(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Ca(r.remoteStore,s.targetId),Da(r,s.targetId)}).catch(xi)):(Da(r,s.targetId),await Ra(r.localStore,s.targetId,!0))}async function XR(n,e){const t=ye(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ca(t.remoteStore,r.targetId))}async function ZR(n,e,t){const r=mm(n);try{const s=await function(o,a){const l=ye(o),c=Kt.now(),d=a.reduce((y,R)=>y.add(R.key),He());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let R=rr(),x=He();return l.cs.getEntries(y,d).next(V=>{R=V,R.forEach((B,F)=>{F.isValidDocument()||(x=x.add(B))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,R)).next(V=>{f=V;const B=[];for(const F of a){const P=x1(F,f.get(F.key).overlayedDocument);P!=null&&B.push(new Vs(F.key,P,tb(P.value.mapValue),Gt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,B,a)}).next(V=>{g=V;const B=V.applyToLocalDocumentSet(f,x);return l.documentOverlayCache.saveOverlays(y,V.batchId,B)})}).then(()=>({batchId:g.batchId,changes:gb(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Dt(je)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Ns(r,s.changes),await Ka(r.remoteStore)}catch(s){const i=Wa(s,"Failed to persist write");t.reject(i)}}async function Ew(n,e){const t=ye(n);try{const r=await vR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Pe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Pe(o.va):s.removedDocuments.size>0&&(Pe(o.va),o.va=!1))}),await Ns(t,r,e)}catch(r){await xi(r)}}function hy(n,e,t){const r=ye(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ye(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&um(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function eC(n,e,t){const r=ye(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Dt(Ie.comparator);o=o.insert(i,$t.newNoDocument(i,Ce.min()));const a=He().add(i),l=new Lu(Ce.min(),new Map,new Dt(je),o,a);await Ew(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),pm(r)}else await Ra(r.localStore,e,!1).then(()=>Da(r,e,t)).catch(xi)}async function tC(n,e){const t=ye(n),r=e.batch.batchId;try{const s=await gR(t.localStore,e);fm(t,r,null),hm(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ns(t,s)}catch(s){await xi(s)}}async function nC(n,e,t){const r=ye(n);try{const s=await function(o,a){const l=ye(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Pe(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);fm(r,e,t),hm(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ns(r,s)}catch(s){await xi(s)}}async function rC(n,e){const t=ye(n);Pi(t.remoteStore)||re("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ye(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Wa(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function hm(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function fm(n,e,t){const r=ye(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Da(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Tw(n,r)})}function Tw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Ca(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),pm(n))}function tp(n,e,t){for(const r of t)r instanceof _w?(n.La.addReference(r.key,e),sC(n,r)):r instanceof bw?(re("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Tw(n,r.key)):xe()}function sC(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(re("SyncEngine","New document in limbo: "+t),n.xa.add(r),pm(n))}function pm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ie(it.fromString(e)),r=n.qa.next();n.Na.set(r,new HR(t)),n.Oa=n.Oa.insert(t,r),ih(n.remoteStore,new ms($n(Ba(t.path)),r,"TargetPurposeLimboResolution",tr.oe))}}async function Ns(n,e,t){const r=ye(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=em.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=ye(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>j.forEach(c,g=>j.forEach(g.$i,y=>d.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>j.forEach(g.Ui,y=>d.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!Ai(f))throw f;re("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=d.os.get(g),R=y.snapshotVersion,x=y.withLastLimboFreeSnapshotVersion(R);d.os=d.os.insert(g,x)}}}(r.localStore,i))}async function iC(n,e){const t=ye(n);if(!t.currentUser.isEqual(e)){re("SyncEngine","User change. New user:",e.toKey());const r=await sw(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new se(z.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ns(t,r.hs)}}function oC(n,e){const t=ye(n),r=t.Na.get(e);if(r&&r.va)return He().add(r.key);{let s=He();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function aC(n,e){const t=ye(n),r=await wd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&tp(t,e.targetId,s.wa),s}async function lC(n,e){const t=ye(n);return lw(t.localStore,e).then(r=>Ns(t,r))}async function uC(n,e,t,r){const s=ye(n),i=await function(a,l){const c=ye(a),d=ye(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):j.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Ka(s.remoteStore):t==="acknowledged"||t==="rejected"?(fm(s,e,r||null),hm(s,e),function(a,l){ye(ye(a).mutationQueue).On(l)}(s.localStore,e)):xe(),await Ns(s,i)):re("SyncEngine","Cannot apply mutation batch with id: "+e)}async function cC(n,e){const t=ye(n);if(oh(t),mm(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await fy(t,r.toArray());t.Qa=!0,await Zf(t.remoteStore,!0);for(const i of s)ih(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Da(t,o),Ra(t.localStore,o,!0))),Ca(t.remoteStore,o)}),await s,await fy(t,r),function(o){const a=ye(o);a.Na.forEach((l,c)=>{Ca(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Dt(Ie.comparator)}(t),t.Qa=!1,await Zf(t.remoteStore,!1)}}async function fy(n,e,t){const r=ye(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Pa(r.localStore,$n(l[0]));for(const c of l){const d=r.Fa.get(c),f=await aC(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await aw(r.localStore,o);a=await Pa(r.localStore,c),await dm(r,xw(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function xw(n){return ub(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function dC(n){return function(t){return ye(ye(t).persistence).Qi()}(ye(n).localStore)}async function hC(n,e,t,r){const s=ye(n);if(s.Qa)return void re("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await lw(s.localStore,fb(i[0])),a=Lu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Qt.EMPTY_BYTE_STRING);await Ns(s,o,a);break}case"rejected":await Ra(s.localStore,e,!0),Da(s,e,r);break;default:xe()}}async function fC(n,e,t){const r=oh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){re("SyncEngine","Adding an already active target "+s);continue}const i=await aw(r.localStore,s),o=await Pa(r.localStore,i);await dm(r,xw(i),o.targetId,!1,o.resumeToken),ih(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Ra(r.localStore,s,!1).then(()=>{Ca(r.remoteStore,s),Da(r,s)}).catch(xi)}}function oh(n){const e=ye(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ew.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oC.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=eC.bind(null,e),e.Ca.d_=BR.bind(null,e.eventManager),e.Ca.$a=qR.bind(null,e.eventManager),e}function mm(n){const e=ye(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=tC.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=nC.bind(null,e),e}function pC(n,e,t){const r=ye(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,R){const x=ye(y),V=en(R.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",B=>x.Gr.getBundleMetadata(B,R.id)).then(B=>!!B&&B.createTime.compareTo(V)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(yw(l));const c=new GR(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await Ns(i,f.Ia,void 0),await function(y,R){const x=ye(y);return x.persistence.runTransaction("Save bundle","readwrite",V=>x.Gr.saveBundleMetadata(V,R))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return wr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Ii{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=$u(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return rw(this.persistence,new nw,e.initialUser,this.serializer)}Ga(e){return new Yp(sh.Zr,this.serializer)}Wa(e){return new cw}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ii.provider={build:()=>new Ii};class mC extends Ii{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Pe(this.persistence.referenceDelegate instanceof bd);const r=this.persistence.referenceDelegate.garbageCollector;return new Yb(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?Vn.withCacheSize(this.cacheSizeBytes):Vn.DEFAULT;return new Yp(r=>bd.Zr(r,t),this.serializer)}}class gm extends Ii{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await mm(this.Ja.syncEngine),await Ka(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return rw(this.persistence,new nw,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new Yb(r,e.asyncQueue,t)}Ha(e,t){const r=new LP(t,this.persistence);return new MP(e.asyncQueue,r)}Ga(e){const t=Zp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Vn.withCacheSize(this.cacheSizeBytes):Vn.DEFAULT;return new Xp(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,dw(),Hc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new cw}}class Aw extends gm{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof of&&(this.sharedClientState.syncEngine={no:uC.bind(null,t),ro:hC.bind(null,t),io:fC.bind(null,t),Qi:dC.bind(null,t),eo:lC.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await cC(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=dw();if(!of.D(t))throw new se(z.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Zp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new of(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ei{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>hy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=iC.bind(null,this.syncEngine),await Zf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new jR}()}createDatastore(e){const t=$u(e.databaseInfo.databaseId),r=function(i){return new TR(i)}(e.databaseInfo);return function(i,o,a,l){return new SR(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new RR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>hy(this.syncEngine,t,0),function(){return oy.D()?new oy:new wR}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new WR(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ye(s);re("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Ga(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Ei.provider={build:()=>new Ei};function py(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Xt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new bn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new zR(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new se(z.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ye(s),a={documents:i.map(f=>pu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,it.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=N1(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());Pe(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new za(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ie.fromPath(r);this.mutations.push(new jp(s,this.precondition(s)))}),await async function(r,s){const i=ye(r),o={writes:s.map(a=>mu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,it.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw xe();t=Ce.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new se(z.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ce.min())?Gt.exists(!1):Gt.updateTime(t):Gt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ce.min()))throw new se(z.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Gt.updateTime(t)}return Gt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new nm(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new vC(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Du(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Sb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=yn.UNAUTHENTICATED,this.clientId=F0.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{re("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(re("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Wa(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function lf(n,e){n.asyncQueue.verifyOperationInProgress(),re("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await sw(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function my(n,e){n.asyncQueue.verifyOperationInProgress();const t=await vm(n);re("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>ay(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>ay(e.remoteStore,s)),n._onlineComponents=e}async function vm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){re("FirestoreClient","Using user provided OfflineComponentProvider");try{await lf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===z.FAILED_PRECONDITION||s.code===z.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;wr("Error using user provided cache. Falling back to memory cache: "+t),await lf(n,new Ii)}}else re("FirestoreClient","Using default OfflineComponentProvider"),await lf(n,new Ii);return n._offlineComponents}async function lh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(re("FirestoreClient","Using user provided OnlineComponentProvider"),await my(n,n._uninitializedComponentsProvider._online)):(re("FirestoreClient","Using default OnlineComponentProvider"),await my(n,new Ei))),n._onlineComponents}function Sw(n){return vm(n).then(e=>e.persistence)}function Qa(n){return vm(n).then(e=>e.localStore)}function Pw(n){return lh(n).then(e=>e.remoteStore)}function ym(n){return lh(n).then(e=>e.syncEngine)}function Rw(n){return lh(n).then(e=>e.datastore)}async function Va(n){const e=await lh(n),t=e.eventManager;return t.onListen=QR.bind(null,e.syncEngine),t.onUnlisten=YR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=JR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=XR.bind(null,e.syncEngine),t}function bC(n){return n.asyncQueue.enqueue(async()=>{const e=await Sw(n),t=await Pw(n);return e.setNetworkEnabled(!0),function(s){const i=ye(s);return i.L_.delete(0),Uu(i)}(t)})}function wC(n){return n.asyncQueue.enqueue(async()=>{const e=await Sw(n),t=await Pw(n);return e.setNetworkEnabled(!1),async function(s){const i=ye(s);i.L_.add(0),await Ga(i),i.q_.set("Offline")}(t)})}function IC(n,e){const t=new bn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=ye(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new se(z.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Wa(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Qa(n),e,t)),t.promise}function Cw(n,e,t={}){const r=new bn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new ah({next:g=>{d.Za(),o.enqueueAndForget(()=>lm(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new se(z.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new se(z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new cm(Ba(a.path),d,{includeMetadataChanges:!0,_a:!0});return am(i,f)}(await Va(n),n.asyncQueue,e,t,r)),r.promise}function EC(n,e){const t=new bn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await wd(s,i,!0),l=new ww(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=Wa(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Qa(n),e,t)),t.promise}function kw(n,e,t={}){const r=new bn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new ah({next:g=>{d.Za(),o.enqueueAndForget(()=>lm(i,f)),g.fromCache&&l.source==="server"?c.reject(new se(z.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new cm(a,d,{includeMetadataChanges:!0,_a:!0});return am(i,f)}(await Va(n),n.asyncQueue,e,t,r)),r.promise}function TC(n,e,t){const r=new bn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Rw(n);r.resolve(async function(o,a,l){var c;const d=ye(o),{request:f,ut:g,parent:y}=$b(d.serializer,cb(a),l);d.connection.Fo||delete f.parent;const R=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(V=>!!V.result);Pe(R.length===1);const x=(c=R[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(x).reduce((V,B)=>(V[g[B]]=x[B],V),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function xC(n,e){const t=new ah(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ye(s).Y_.add(i),i.next()}(await Va(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ye(s).Y_.delete(i)}(await Va(n),t))}}function AC(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?Rb().encode(o):o,function(d,f){return new gC(d,f)}(function(d,f){if(d instanceof Uint8Array)return py(d,f);if(d instanceof ArrayBuffer)return py(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,$u(e));n.asyncQueue.enqueueAndForget(async()=>{pC(await ym(n),s,r)})}function SC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ye(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Qa(n),e))}function PC(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ye(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,R,x){f=[...f],g=[...g],f.sort(y),g.sort(y);const V=f.length,B=g.length;let F=0,P=0;for(;F<B&&P<V;){const q=y(f[P],g[F]);q<0?x(f[P++]):q>0?R(g[F++]):(F++,P++)}for(;F<B;)R(g[F++]);for(;P<V;)x(f[P++])}(c,s,DP,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>j.waitFor(a)))}(await Qa(n),e))}function RC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ye(r).ss.zi=s}(await Qa(n),e))}function CC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ye(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Qa(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gy=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _m(n,e,t){if(!t)throw new se(z.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function kC(n,e,t,r){if(e===!0&&r===!0)throw new se(z.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function vy(n){if(!Ie.isDocumentKey(n))throw new se(z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function yy(n){if(Ie.isDocumentKey(n))throw new se(z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function uh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":xe()}function et(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new se(z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=uh(n);throw new se(z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Vw(n,e){if(e<=0)throw new se(z.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new se(z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new se(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}kC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Dw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new se(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new se(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new se(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ju{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _y({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new se(z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new se(z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _y(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new TP;switch(r.type){case"firstParty":return new PP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new se(z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=gy.get(t);r&&(re("ComponentProvider","Removing Datastore"),gy.delete(t),r.terminate())}(this),Promise.resolve()}}function DC(n,e,t,r={}){var s;const i=(n=et(n,ju))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&wr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=yn.MOCK_USER;else{a=ZA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new se(z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new yn(c)}n._authCredentials=new xP(new M0(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new An(this.firestore,e,this._query)}}class tn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new tn(this.firestore,e,this._key)}}class Wr extends An{constructor(e,t,r){super(e,t,Ba(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new tn(this.firestore,null,new Ie(e))}withConverter(e){return new Wr(this.firestore,e,this._path)}}function Qe(n,e,...t){if(n=ke(n),_m("collection","path",e),n instanceof ju){const r=it.fromString(e,...t);return yy(r),new Wr(n,null,r)}{if(!(n instanceof tn||n instanceof Wr))throw new se(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return yy(r),new Wr(n.firestore,null,r)}}function p6(n,e){if(n=et(n,ju),_m("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new se(z.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new An(n,null,function(r){return new ks(it.emptyPath(),r)}(e))}function Se(n,e,...t){if(n=ke(n),arguments.length===1&&(e=F0.newId()),_m("doc","path",e),n instanceof ju){const r=it.fromString(e,...t);return vy(r),new tn(n,null,new Ie(r))}{if(!(n instanceof tn||n instanceof Wr))throw new se(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(it.fromString(e,...t));return vy(r),new tn(n.firestore,n instanceof Wr?n.converter:null,new Ie(r))}}function m6(n,e){return n=ke(n),e=ke(e),(n instanceof tn||n instanceof Wr)&&(e instanceof tn||e instanceof Wr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Nw(n,e){return n=ke(n),e=ke(e),n instanceof An&&e instanceof An&&n.firestore===e.firestore&&Nu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new nm(this,"async_queue_retry"),this.Vu=()=>{const r=Hc();r&&re("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Hc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Hc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new bn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ai(e))throw e;re("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Xt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=om.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&xe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function np(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class VC{constructor(){this._progressObserver={},this._taskCompletionResolver=new bn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g6=-1;class St extends ju{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new by,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new by(e),this._firestoreClient=void 0,await e}}}function v6(n,e,t){t||(t="(default)");const r=ku(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(gi(i,e))return s;throw new se(z.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new se(z.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new se(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function NC(n,e){const t=typeof n=="object"?n:S0(),r=typeof n=="string"?n:e||"(default)",s=ku(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=YA("firestore");i&&DC(s,...i)}return s}function Ht(n){if(n._terminated)throw new se(z.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Ow(n),n._firestoreClient}function Ow(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new s1(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Dw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new _C(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function OC(n,e){wr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Mw(n,Ei.provider,{build:r=>new gm(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function y6(n){wr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();Mw(n,Ei.provider,{build:t=>new Aw(t,e.cacheSizeBytes)})}function Mw(n,e,t){if((n=et(n,St))._firestoreClient||n._terminated)throw new se(z.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new se(z.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},Ow(n)}function _6(n){if(n._initialized&&!n._terminated)throw new se(z.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new bn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Kr.D())return Promise.resolve();const s=r+"main";await Kr.delete(s)}(Zp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function b6(n){return function(t){const r=new bn;return t.asyncQueue.enqueueAndForget(async()=>rC(await ym(t),r)),r.promise}(Ht(n=et(n,St)))}function w6(n){return bC(Ht(n=et(n,St)))}function I6(n){return wC(Ht(n=et(n,St)))}function E6(n){return cP(n.app,"firestore",n._databaseId.database),n._delete()}function T6(n,e){const t=Ht(n=et(n,St)),r=new VC;return AC(t,n._databaseId,e,r),r}function x6(n,e){return SC(Ht(n=et(n,St)),e).then(t=>t?new An(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class MC{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _o(Qt.fromBase64String(e))}catch(t){throw new se(z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _o(Qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new se(z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function A6(){return new wo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new se(z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new se(z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return je(this._lat,e._lat)||je(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LC=/^__.*__$/;class FC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Vs(e,this.data,this.fieldMask,t,this.fieldTransforms):new qa(e,this.data,t,this.fieldTransforms)}}class Lw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Vs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Fw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xe()}}class dh{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new dh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return xd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(Fw(this.Cu)&&LC.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class $C{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||$u(e)}Qu(e,t,r,s=!1){return new dh({Cu:e,methodName:t,qu:r,path:zt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Eo(n){const e=n._freezeSettings(),t=$u(n._databaseId);return new $C(n._databaseId,!!e.ignoreUndefinedProperties,t)}function hh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);Sm("Data must be an object, but it was:",o,r);const a=jw(r,o);let l,c;if(i.merge)l=new nr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=vu(e,f,t);if(!o.contains(g))throw new se(z.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);qw(d,g)||d.push(g)}l=new nr(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new FC(new xn(a),l,c)}class Bu extends Io{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Bu}}function $w(n,e,t){return new dh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class wm extends Io{_toFieldTransform(e){return new Mu(e.path,new xa)}isEqual(e){return e instanceof wm}}class Im extends Io{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=$w(this,e,!0),r=this.Ku.map(i=>To(i,t)),s=new po(r);return new Mu(e.path,s)}isEqual(e){return e instanceof Im&&gi(this.Ku,e.Ku)}}class Em extends Io{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=$w(this,e,!0),r=this.Ku.map(i=>To(i,t)),s=new mo(r);return new Mu(e.path,s)}isEqual(e){return e instanceof Em&&gi(this.Ku,e.Ku)}}class Tm extends Io{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Aa(e.serializer,_b(e.serializer,this.$u));return new Mu(e.path,t)}isEqual(e){return e instanceof Tm&&this.$u===e.$u}}function xm(n,e,t,r){const s=n.Qu(1,e,t);Sm("Data must be an object, but it was:",s,r);const i=[],o=xn.empty();Si(r,(l,c)=>{const d=fh(e,l,t);c=ke(c);const f=s.Nu(d);if(c instanceof Bu)i.push(d);else{const g=To(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new nr(i);return new Lw(o,a,s.fieldTransforms)}function Am(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[vu(e,r,t)],l=[s];if(i.length%2!=0)throw new se(z.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(vu(e,i[g])),l.push(i[g+1]);const c=[],d=xn.empty();for(let g=a.length-1;g>=0;--g)if(!qw(c,a[g])){const y=a[g];let R=l[g];R=ke(R);const x=o.Nu(y);if(R instanceof Bu)c.push(y);else{const V=To(R,x);V!=null&&(c.push(y),d.set(y,V))}}const f=new nr(c);return new Lw(d,f,o.fieldTransforms)}function Uw(n,e,t,r=!1){return To(t,n.Qu(r?4:3,e))}function To(n,e){if(Bw(n=ke(n)))return Sm("Unsupported field value:",e,n),jw(n,e);if(n instanceof Io)return function(r,s){if(!Fw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=To(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=ke(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return _b(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Kt.fromDate(r);return{timestampValue:Sa(s.serializer,i)}}if(r instanceof Kt){const i=new Kt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Sa(s.serializer,i)}}if(r instanceof bm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof _o)return{bytesValue:Db(s.serializer,r._byteString)};if(r instanceof tn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Kp(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ch)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Up(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${uh(r)}`)}(n,e)}function jw(n,e){const t={};return Y0(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Si(n,(r,s)=>{const i=To(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Bw(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Kt||n instanceof bm||n instanceof _o||n instanceof tn||n instanceof Io||n instanceof ch)}function Sm(n,e,t){if(!Bw(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=uh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function vu(n,e,t){if((e=ke(e))instanceof wo)return e._internalPath;if(typeof e=="string")return fh(n,e);throw xd("Field path arguments must be of type string or ",n,!1,void 0,t)}const UC=new RegExp("[~\\*/\\[\\]]");function fh(n,e,t){if(e.search(UC)>=0)throw xd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new wo(...e.split("."))._internalPath}catch{throw xd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new se(z.INVALID_ARGUMENT,a+n+l)}function qw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new tn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new jC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ph("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class jC extends yu{data(){return super.data()}}function ph(n,e){return typeof e=="string"?fh(n,e):e instanceof wo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new se(z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Pm{}class qu extends Pm{}function _u(n,e,...t){let r=[];e instanceof Pm&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Ja).length,a=i.filter(l=>l instanceof zu).length;if(o>1||o>0&&a>0)throw new se(z.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class zu extends qu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new zu(e,t,r)}_apply(e){const t=this._parse(e);return Kw(e._query,t),new An(e.firestore,e.converter,zf(e._query,t))}_parse(e){const t=Eo(e.firestore);return function(i,o,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new se(z.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Iy(f,d);const y=[];for(const R of f)y.push(wy(l,i,R));g={arrayValue:{values:y}}}else g=wy(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Iy(f,d),g=Uw(a,o,f,d==="in"||d==="not-in");return ot.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Ad(n,e,t){const r=e,s=ph("where",n);return zu._create(s,r,t)}class Ja extends Pm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ja(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Et.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)Kw(o,l),o=zf(o,l)}(e._query,t),new An(e.firestore,e.converter,zf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function S6(...n){return n.forEach(e=>Hw("or",e)),Ja._create("or",n)}function P6(...n){return n.forEach(e=>Hw("and",e)),Ja._create("and",n)}class Rm extends qu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Rm(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new se(z.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new se(z.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fu(i,o)}(e._query,this._field,this._direction);return new An(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new ks(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function BC(n,e="asc"){const t=e,r=ph("orderBy",n);return Rm._create(r,t)}class mh extends qu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new mh(e,t,r)}_apply(e){return new An(e.firestore,e.converter,md(e._query,this._limit,this._limitType))}}function R6(n){return Vw("limit",n),mh._create("limit",n,"F")}function C6(n){return Vw("limitToLast",n),mh._create("limitToLast",n,"L")}class gh extends qu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new gh(e,t,r)}_apply(e){const t=Gw(e,this.type,this._docOrFields,this._inclusive);return new An(e.firestore,e.converter,function(s,i){return new ks(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function k6(...n){return gh._create("startAt",n,!0)}function D6(...n){return gh._create("startAfter",n,!1)}class vh extends qu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new vh(e,t,r)}_apply(e){const t=Gw(e,this.type,this._docOrFields,this._inclusive);return new An(e.firestore,e.converter,function(s,i){return new ks(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function V6(...n){return vh._create("endBefore",n,!1)}function N6(...n){return vh._create("endAt",n,!0)}function Gw(n,e,t,r){if(t[0]=ke(t[0]),t[0]instanceof yu)return function(i,o,a,l,c){if(!l)throw new se(z.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of ca(i))if(f.field.isKeyField())d.push(ho(o,l.key));else{const g=l.data.field(f.field);if(Jd(g))throw new se(z.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new se(z.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new bi(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Eo(n.firestore);return function(o,a,l,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new se(z.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let R=0;R<d.length;R++){const x=d[R];if(g[R].field.isKeyField()){if(typeof x!="string")throw new se(z.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof x}`);if(!Fp(o)&&x.indexOf("/")!==-1)throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${x}' contains a slash.`);const V=o.path.child(it.fromString(x));if(!Ie.isDocumentKey(V))throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const B=new Ie(V);y.push(ho(a,B))}else{const V=Uw(l,c,x);y.push(V)}}return new bi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function wy(n,e,t){if(typeof(t=ke(t))=="string"){if(t==="")throw new se(z.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fp(e)&&t.indexOf("/")!==-1)throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(it.fromString(t));if(!Ie.isDocumentKey(r))throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ho(n,new Ie(r))}if(t instanceof tn)return ho(n,t._key);throw new se(z.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uh(t)}.`)}function Iy(n,e){if(!Array.isArray(n)||n.length===0)throw new se(z.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Kw(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new se(z.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new se(z.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Hw(n,e){if(!(e instanceof zu||e instanceof Ja))throw new se(z.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class Ww{convertValue(e,t="none"){switch(yi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return qt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw xe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Si(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>qt(o.doubleValue));return new ch(i)}convertGeoPoint(e){return new bm(qt(e.latitude),qt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Yd(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(cu(e));default:return null}}convertTimestamp(e){const t=Ts(e);return new Kt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=it.fromString(e);Pe(qb(r));const s=new co(r.get(1),r.get(3)),i=new Ie(r.popFirst(5));return s.isEqual(t)||Xt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class qC extends Ww{constructor(e){super(),this.firestore=e}convertBytes(e){return new _o(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new tn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O6(n){return new gu("sum",vu("sum",n))}function M6(n){return new gu("avg",vu("average",n))}function zC(){return new gu("count")}function L6(n,e){var t,r;return n instanceof gu&&e instanceof gu&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function F6(n,e){return Nw(n.query,e.query)&&gi(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Na extends yu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Wc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ph("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Wc extends Na{data(e={}){return super.data(e)}}class Oa{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new no(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Wc(this._firestore,this._userDataWriter,r.key,r,new no(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new se(z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Wc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new no(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Wc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new no(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:GC(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function GC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xe()}}function $6(n,e){return n instanceof Na&&e instanceof Na?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Oa&&e instanceof Oa&&n._firestore===e._firestore&&Nw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sn(n){n=et(n,tn);const e=et(n.firestore,St);return Cw(Ht(e),n._key).then(t=>Cm(e,n,t))}class Ri extends Ww{constructor(e){super(),this.firestore=e}convertBytes(e){return new _o(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new tn(this.firestore,null,t)}}function U6(n){n=et(n,tn);const e=et(n.firestore,St),t=Ht(e),r=new Ri(e);return IC(t,n._key).then(s=>new Na(e,r,n._key,s,new no(s!==null&&s.hasLocalMutations,!0),n.converter))}function j6(n){n=et(n,tn);const e=et(n.firestore,St);return Cw(Ht(e),n._key,{source:"server"}).then(t=>Cm(e,n,t))}function bt(n){n=et(n,An);const e=et(n.firestore,St),t=Ht(e),r=new Ri(e);return zw(n._query),kw(t,n._query).then(s=>new Oa(e,r,n,s))}function B6(n){n=et(n,An);const e=et(n.firestore,St),t=Ht(e),r=new Ri(e);return EC(t,n._query).then(s=>new Oa(e,r,n,s))}function q6(n){n=et(n,An);const e=et(n.firestore,St),t=Ht(e),r=new Ri(e);return kw(t,n._query,{source:"server"}).then(s=>new Oa(e,r,n,s))}function fn(n,e,t){n=et(n,tn);const r=et(n.firestore,St),s=yh(n.converter,e,t);return Gu(r,[hh(Eo(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Gt.none())])}function Ya(n,e,t,...r){n=et(n,tn);const s=et(n.firestore,St),i=Eo(s);let o;return o=typeof(e=ke(e))=="string"||e instanceof wo?Am(i,"updateDoc",n._key,e,t,r):xm(i,"updateDoc",n._key,e),Gu(s,[o.toMutation(n._key,Gt.exists(!0))])}function Ma(n){return Gu(et(n.firestore,St),[new za(n._key,Gt.none())])}function _h(n,e){const t=et(n.firestore,St),r=Se(n),s=yh(n.converter,e);return Gu(t,[hh(Eo(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Gt.exists(!1))]).then(()=>r)}function z6(n,...e){var t,r,s;n=ke(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||np(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(np(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof tn)c=et(n.firestore,St),d=Ba(n._key.path),l={next:f=>{e[o]&&e[o](Cm(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=et(n,An);c=et(f.firestore,St),d=f._query;const g=new Ri(c);l={next:y=>{e[o]&&e[o](new Oa(c,g,f,y))},error:e[o+1],complete:e[o+2]},zw(n._query)}return function(g,y,R,x){const V=new ah(x),B=new cm(y,V,R);return g.asyncQueue.enqueueAndForget(async()=>am(await Va(g),B)),()=>{V.Za(),g.asyncQueue.enqueueAndForget(async()=>lm(await Va(g),B))}}(Ht(c),d,a,l)}function G6(n,e){return xC(Ht(n=et(n,St)),np(e)?e:{next:e})}function Gu(n,e){return function(r,s){const i=new bn;return r.asyncQueue.enqueueAndForget(async()=>ZR(await ym(r),s,i)),i.promise}(Ht(n),e)}function Cm(n,e,t){const r=t.docs.get(e._key),s=new Ri(n);return new Na(n,s,e._key,r,new no(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K6(n){return KC(n,{count:zC()})}function KC(n,e){const t=et(n.firestore,St),r=Ht(t),s=J0(e,(i,o)=>new Ab(o,i.aggregateType,i._internalFieldPath));return TC(r,n._query,s).then(i=>function(a,l,c){const d=new Ri(a);return new MC(l,d,c)}(t,n,i))}class HC{constructor(e){this.kind="memory",this._onlineComponentProvider=Ei.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Ii.provider}toJSON(){return{kind:this.kind}}}class WC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=ZC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class QC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Ii.provider}toJSON(){return{kind:this.kind}}}class JC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new mC(e)}}toJSON(){return{kind:this.kind}}}function H6(){return new QC}function W6(n){return new JC(n==null?void 0:n.cacheSizeBytes)}function Q6(n){return new HC(n)}function J6(n){return new WC(n)}class YC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ei.provider,this._offlineComponentProvider={build:t=>new gm(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class XC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ei.provider,this._offlineComponentProvider={build:t=>new Aw(t,e==null?void 0:e.cacheSizeBytes)}}}function ZC(n){return new YC(n==null?void 0:n.forceOwnership)}function Y6(){return new XC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Eo(e)}set(e,t,r){this._verifyNotCommitted();const s=ti(e,this._firestore),i=yh(s.converter,t,r),o=hh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,Gt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ti(e,this._firestore);let o;return o=typeof(t=ke(t))=="string"||t instanceof wo?Am(this._dataReader,"WriteBatch.update",i._key,t,r,s):xm(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,Gt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ti(e,this._firestore);return this._mutations=this._mutations.concat(new za(t._key,Gt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new se(z.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ti(n,e){if((n=ke(n)).firestore!==e)throw new se(z.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Eo(t)}get(t){const r=ti(t,this._firestore),s=new qC(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return xe();const o=i[0];if(o.isFoundDocument())return new yu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new yu(this._firestore,s,r._key,null,r.converter);throw xe()})}set(t,r,s){const i=ti(t,this._firestore),o=yh(i.converter,r,s),a=hh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=ti(t,this._firestore);let a;return a=typeof(r=ke(r))=="string"||r instanceof wo?Am(this._dataReader,"Transaction.update",o._key,r,s,i):xm(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=ti(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ti(e,this._firestore),r=new Ri(this._firestore);return super.get(e).then(s=>new Na(this._firestore,r,t._key,s._document,new no(!1,!1),t.converter))}}function Z6(n,e,t){n=et(n,St);const r=Object.assign(Object.assign({},ek),t);return function(i){if(i.maxAttempts<1)throw new se(z.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new bn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await Rw(i);new yC(i.asyncQueue,c,a,o,l).au()}),l.promise}(Ht(n),s=>e(new nk(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e$(){return new Bu("deleteField")}function Ku(){return new wm("serverTimestamp")}function t$(...n){return new Im("arrayUnion",n)}function n$(...n){return new Em("arrayRemove",n)}function r$(n){return new Tm("increment",n)}function s$(n){return new ch(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function km(n){return Ht(n=et(n,St)),new tk(n,e=>Gu(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i$(n,e){const t=Ht(n=et(n,St));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return wr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new se(z.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=Ey(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=fh("setIndexConfiguration",Ey(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new oo(g,2)):f.order==="ASCENDING"?d.push(new oo(g,0)):f.order==="DESCENDING"&&d.push(new oo(g,1))}a.push(new wa(wa.UNKNOWN_ID,c,d,Ia.empty()))}return a}(e);return PC(t,r)}function Ey(n,e){if(typeof n[e]!="string")throw new se(z.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function o$(n){var e;n=et(n,St);const t=Ty.get(n);if(t)return t;if(((e=Ht(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new rk(n);return Ty.set(n,r),r}function a$(n){Qw(n,!0)}function l$(n){Qw(n,!1)}function u$(n){CC(Ht(n._firestore)).then(e=>re("deleting all persistent cache indexes succeeded")).catch(e=>wr("deleting all persistent cache indexes failed",e))}function Qw(n,e){RC(Ht(n._firestore),e).then(t=>re(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>wr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const Ty=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c$(n){var e;const t=(e=Ht(et(n.firestore,St))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:th(t,$n(n._query))._t}function d$(n,e){var t;const r=J0(e,(i,o)=>new Ab(o,i.aggregateType,i._internalFieldPath)),s=(t=Ht(et(n.firestore,St))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:$b(s,cb(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h${constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Dm.instance.onExistenceFilterMismatch(e)}}class Dm{constructor(){this.Uu=new Map}static get instance(){return kc||(kc=new Dm,function(t){if(gd)throw new Error("a TestingHooksSpi instance is already set");gd=t}(kc)),kc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let kc=null;(function(e,t=!0){(function(s){ja=s})(Ua),_a(new uo("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new St(new AP(r.getProvider("auth-internal")),new RP(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new se(z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new co(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),ci(fv,"4.7.3",e),ci(fv,"4.7.3","esm2017")})();function Vm(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f$={PHONE:"phone",TOTP:"totp"},p$={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},m$={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},g$={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},v$={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sk(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function Jw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const y$=sk,ik=Jw,Yw=new Cu("auth","Firebase",Jw()),_$={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sd=new kp("@firebase/auth");function ok(n,...e){Sd.logLevel<=st.WARN&&Sd.warn(`Auth (${Ua}): ${n}`,...e)}function Qc(n,...e){Sd.logLevel<=st.ERROR&&Sd.error(`Auth (${Ua}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sr(n,...e){throw Om(n,...e)}function Wn(n,...e){return Om(n,...e)}function Nm(n,e,t){const r=Object.assign(Object.assign({},ik()),{[e]:t});return new Cu("auth","Firebase",r).create(e,{appName:n.name})}function wn(n){return Nm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Xa(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&sr(n,"argument-error"),Nm(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Om(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Yw.create(n,...e)}function fe(n,e,...t){if(!n)throw Om(e,...t)}function Gr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Qc(e),new Error(e)}function As(n,e){n||Gr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Mm(){return xy()==="http:"||xy()==="https:"}function xy(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ak(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mm()||rS()||"connection"in navigator)?navigator.onLine:!0}function lk(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e,t){this.shortDelay=e,this.longDelay=t,As(t>e,"Short delay should be less than long delay!"),this.isMobile=eS()||sS()}get(){return ak()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lm(n,e){As(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Gr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Gr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Gr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck=new Hu(3e4,6e4);function Ut(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function jt(n,e,t,r,s={}){return Zw(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=$a(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return nS()||(c.referrerPolicy="no-referrer"),Xw.fetch()(eI(n,n.config.apiHost,t,a),c)})}async function Zw(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},uk),e);try{const s=new hk(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Ll(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ll(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Ll(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Ll(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Nm(n,d,c);sr(n,d)}}catch(s){if(s instanceof Cs)throw s;sr(n,"network-request-failed",{message:String(s)})}}async function Os(n,e,t,r,s={}){const i=await jt(n,e,t,r,s);return"mfaPendingCredential"in i&&sr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function eI(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Lm(n.config,s):`${n.config.apiScheme}://${s}`}function dk(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class hk{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Wn(this.auth,"network-request-failed")),ck.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ll(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Wn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ay(n){return n!==void 0&&n.getResponse!==void 0}function Sy(n){return n!==void 0&&n.enterprise!==void 0}class tI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return dk(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fk(n){return(await jt(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function nI(n,e){return jt(n,"GET","/v2/recaptchaConfig",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pk(n,e){return jt(n,"POST","/v1/accounts:delete",e)}async function mk(n,e){return jt(n,"POST","/v1/accounts:update",e)}async function rI(n,e){return jt(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zl(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b$(n,e=!1){return ke(n).getIdToken(e)}async function gk(n,e=!1){const t=ke(n),r=await t.getIdToken(e),s=bh(r);fe(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Zl(uf(s.auth_time)),issuedAtTime:Zl(uf(s.iat)),expirationTime:Zl(uf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function uf(n){return Number(n)*1e3}function bh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Qc("JWT malformed, contained fewer than 3 sections"),null;try{const s=y0(t);return s?JSON.parse(s):(Qc("Failed to decode base64 JWT payload"),null)}catch(s){return Qc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Py(n){const e=bh(n);return fe(e,"internal-error"),fe(typeof e.exp<"u","internal-error"),fe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ss(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Cs&&vk(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function vk({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Zl(this.lastLoginAt),this.creationTime=Zl(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Ss(n,rI(t,{idToken:r}));fe(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?sI(i.providerUserInfo):[],a=bk(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new rp(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function _k(n){const e=ke(n);await wu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function bk(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function sI(n){return n.map(e=>{var{providerId:t}=e,r=Vm(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wk(n,e){const t=await Zw(n,{},async()=>{const r=$a({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=eI(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Xw.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Ik(n,e){return jt(n,"POST","/v2/accounts:revokeToken",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){fe(e.idToken,"internal-error"),fe(typeof e.idToken<"u","internal-error"),fe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Py(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){fe(e.length!==0,"internal-error");const t=Py(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(fe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await wk(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ha;return r&&(fe(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(fe(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(fe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ha,this.toJSON())}_performRefresh(){return Gr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ws(n,e){fe(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class gs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Vm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new rp(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Ss(this,this.stsTokenManager.getToken(this.auth,e));return fe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return gk(this,e)}reload(){return _k(this)}_assign(e){this!==e&&(fe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new gs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){fe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await wu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Zt(this.auth.app))return Promise.reject(wn(this.auth));const e=await this.getIdToken();return await Ss(this,pk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,R=(o=t.photoURL)!==null&&o!==void 0?o:void 0,x=(a=t.tenantId)!==null&&a!==void 0?a:void 0,V=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,B=(c=t.createdAt)!==null&&c!==void 0?c:void 0,F=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:P,emailVerified:q,isAnonymous:X,providerData:pe,stsTokenManager:T}=t;fe(P&&T,e,"internal-error");const w=ha.fromJSON(this.name,T);fe(typeof P=="string",e,"internal-error"),Ws(f,e.name),Ws(g,e.name),fe(typeof q=="boolean",e,"internal-error"),fe(typeof X=="boolean",e,"internal-error"),Ws(y,e.name),Ws(R,e.name),Ws(x,e.name),Ws(V,e.name),Ws(B,e.name),Ws(F,e.name);const I=new gs({uid:P,auth:e,email:g,emailVerified:q,displayName:f,isAnonymous:X,photoURL:R,phoneNumber:y,tenantId:x,stsTokenManager:w,createdAt:B,lastLoginAt:F});return pe&&Array.isArray(pe)&&(I.providerData=pe.map(C=>Object.assign({},C))),V&&(I._redirectEventId=V),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new ha;s.updateFromServerResponse(t);const i=new gs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await wu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];fe(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?sI(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ha;a.updateFromIdToken(r);const l=new gs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new rp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry=new Map;function vs(n){As(n instanceof Function,"Expected a class definition");let e=Ry.get(n);return e?(As(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Ry.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}iI.type="NONE";const Cy=iI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jc(n,e,t){return`firebase:${n}:${e}:${t}`}class fa{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Jc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Jc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?gs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new fa(vs(Cy),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||vs(Cy);const o=Jc(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=gs._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new fa(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new fa(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ky(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(uI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(oI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(dI(e))return"Blackberry";if(hI(e))return"Webos";if(aI(e))return"Safari";if((e.includes("chrome/")||lI(e))&&!e.includes("edge/"))return"Chrome";if(cI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function oI(n=pn()){return/firefox\//i.test(n)}function aI(n=pn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function lI(n=pn()){return/crios\//i.test(n)}function uI(n=pn()){return/iemobile/i.test(n)}function cI(n=pn()){return/android/i.test(n)}function dI(n=pn()){return/blackberry/i.test(n)}function hI(n=pn()){return/webos/i.test(n)}function Fm(n=pn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Ek(n=pn()){var e;return Fm(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Tk(){return iS()&&document.documentMode===10}function fI(n=pn()){return Fm(n)||cI(n)||hI(n)||dI(n)||/windows phone/i.test(n)||uI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pI(n,e=[]){let t;switch(n){case"Browser":t=ky(pn());break;case"Worker":t=`${ky(pn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ua}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ak(n,e={}){return jt(n,"GET","/v2/passwordPolicy",Ut(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=6;class Pk{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Sk,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Dy(this),this.idTokenSubscription=new Dy(this),this.beforeStateQueue=new xk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Yw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=vs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await fa.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await rI(this,{idToken:e}),r=await gs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Zt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return fe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await wu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=lk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Zt(this.app))return Promise.reject(wn(this));const t=e?ke(e):null;return t&&fe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&fe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Zt(this.app)?Promise.reject(wn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Zt(this.app)?Promise.reject(wn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Ak(this),t=new Pk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Cu("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Ik(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&vs(e)||this._popupRedirectResolver;fe(t,this,"argument-error"),this.redirectPersistenceManager=await fa.create(this,[vs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(fe(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return fe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&ok(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Jt(n){return ke(n)}class Dy{constructor(e){this.auth=e,this.observer=null,this.addObserver=dS(t=>this.observer=t)}get next(){return fe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ck(n){Wu=n}function $m(n){return Wu.loadJS(n)}function kk(){return Wu.recaptchaV2Script}function Dk(){return Wu.recaptchaEnterpriseScript}function Vk(){return Wu.gapiScript}function mI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const Nk="recaptcha-enterprise",Ok="NO_RECAPTCHA";class gI{constructor(e){this.type=Nk,this.auth=Jt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{nI(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new tI(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;Sy(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(Ok)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&Sy(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Dk();l.length!==0&&(l+=a),$m(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Vy(n,e,t,r=!1){const s=new gI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Iu(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Vy(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Vy(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function Mk(n){const e=Jt(n),t=await nI(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new tI(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new gI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lk(n,e){const t=ku(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(gi(i,e??{}))return s;sr(s,"already-initialized")}return t.initialize({options:e})}function Fk(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(vs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function $k(n,e,t){const r=Jt(n);fe(r._canInitEmulator,r,"emulator-config-failed"),fe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=vI(e),{host:o,port:a}=Uk(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||jk()}function vI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Uk(n){const e=vI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Ny(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Ny(o)}}}function Ny(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function jk(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Gr("not implemented")}_getIdTokenResponse(e){return Gr("not implemented")}_linkToIdToken(e,t){return Gr("not implemented")}_getReauthenticationResolver(e){return Gr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yI(n,e){return jt(n,"POST","/v1/accounts:resetPassword",Ut(n,e))}async function Bk(n,e){return jt(n,"POST","/v1/accounts:update",e)}async function qk(n,e){return jt(n,"POST","/v1/accounts:signUp",e)}async function zk(n,e){return jt(n,"POST","/v1/accounts:update",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gk(n,e){return Os(n,"POST","/v1/accounts:signInWithPassword",Ut(n,e))}async function wh(n,e){return jt(n,"POST","/v1/accounts:sendOobCode",Ut(n,e))}async function Kk(n,e){return wh(n,e)}async function Hk(n,e){return wh(n,e)}async function Wk(n,e){return wh(n,e)}async function Qk(n,e){return wh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jk(n,e){return Os(n,"POST","/v1/accounts:signInWithEmailLink",Ut(n,e))}async function Yk(n,e){return Os(n,"POST","/v1/accounts:signInWithEmailLink",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu extends Qu{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Eu(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Eu(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Iu(e,t,"signInWithPassword",Gk);case"emailLink":return Jk(e,{email:this._email,oobCode:this._password});default:sr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Iu(e,r,"signUpPassword",qk);case"emailLink":return Yk(e,{idToken:t,email:this._email,oobCode:this._password});default:sr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bs(n,e){return Os(n,"POST","/v1/accounts:signInWithIdp",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xk="http://localhost";class Ps extends Qu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ps(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):sr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Vm(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Ps(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return bs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,bs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,bs(e,t)}buildRequest(){const e={requestUri:Xk,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=$a(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zk(n,e){return jt(n,"POST","/v1/accounts:sendVerificationCode",Ut(n,e))}async function eD(n,e){return Os(n,"POST","/v1/accounts:signInWithPhoneNumber",Ut(n,e))}async function tD(n,e){const t=await Os(n,"POST","/v1/accounts:signInWithPhoneNumber",Ut(n,e));if(t.temporaryProof)throw Ll(n,"account-exists-with-different-credential",t);return t}const nD={USER_NOT_FOUND:"user-not-found"};async function rD(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Os(n,"POST","/v1/accounts:signInWithPhoneNumber",Ut(n,t),nD)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao extends Qu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ao({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ao({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eD(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return tD(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return rD(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ao({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sD(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function iD(n){const e=kl(Dl(n)).link,t=e?kl(Dl(e)).deep_link_id:null,r=kl(Dl(n)).deep_link_id;return(r?kl(Dl(r)).link:null)||r||t||e||n}class Ju{constructor(e){var t,r,s,i,o,a;const l=kl(Dl(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=sD((s=l.mode)!==null&&s!==void 0?s:null);fe(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=iD(e);try{return new Ju(t)}catch{return null}}}function w$(n){return Ju.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(){this.providerId=xo.PROVIDER_ID}static credential(e,t){return Eu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ju.parseLink(t);return fe(r,"argument-error"),Eu._fromEmailAndCode(e,r.code,r.tenantId)}}xo.PROVIDER_ID="password";xo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";xo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za extends Ms{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Yc extends Za{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return fe("providerId"in t&&"signInMethod"in t,"argument-error"),Ps._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return fe(e.idToken||e.accessToken,"argument-error"),Ps._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Yc.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Yc.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Yc(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni extends Za{constructor(){super("facebook.com")}static credential(e){return Ps._fromParams({providerId:ni.PROVIDER_ID,signInMethod:ni.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ni.credentialFromTaggedObject(e)}static credentialFromError(e){return ni.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ni.credential(e.oauthAccessToken)}catch{return null}}}ni.FACEBOOK_SIGN_IN_METHOD="facebook.com";ni.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ri extends Za{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ps._fromParams({providerId:ri.PROVIDER_ID,signInMethod:ri.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ri.credentialFromTaggedObject(e)}static credentialFromError(e){return ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return ri.credential(t,r)}catch{return null}}}ri.GOOGLE_SIGN_IN_METHOD="google.com";ri.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si extends Za{constructor(){super("github.com")}static credential(e){return Ps._fromParams({providerId:si.PROVIDER_ID,signInMethod:si.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return si.credentialFromTaggedObject(e)}static credentialFromError(e){return si.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return si.credential(e.oauthAccessToken)}catch{return null}}}si.GITHUB_SIGN_IN_METHOD="github.com";si.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD="http://localhost";class Tu extends Qu{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return bs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,bs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,bs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Tu(r,i)}static _create(e,t){return new Tu(e,t)}buildRequest(){return{requestUri:oD,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD="saml.";class sp extends Ms{constructor(e){fe(e.startsWith(aD),"argument-error"),super(e)}static credentialFromResult(e){return sp.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return sp.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Tu.fromJSON(e);return fe(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Tu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii extends Za{constructor(){super("twitter.com")}static credential(e,t){return Ps._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ii.credentialFromTaggedObject(e)}static credentialFromError(e){return ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return ii.credential(t,r)}catch{return null}}}ii.TWITTER_SIGN_IN_METHOD="twitter.com";ii.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _I(n,e){return Os(n,"POST","/v1/accounts:signUp",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await gs._fromIdTokenResponse(e,r,s),o=Oy(r);return new Ir({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Oy(r);return new Ir({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Oy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lD(n){var e;if(Zt(n.app))return Promise.reject(wn(n));const t=Jt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Ir({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await _I(t,{returnSecureToken:!0}),s=await Ir._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd extends Cs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Pd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Pd(e,t,r,s)}}function bI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Pd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I$(n,e){const t=ke(n);await Ih(!0,t,e);const{providerUserInfo:r}=await mk(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=wI(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Um(n,e,t=!1){const r=await Ss(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ir._forOperation(n,"link",r)}async function Ih(n,e,t){await wu(e);const r=wI(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";fe(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function II(n,e,t=!1){const{auth:r}=n;if(Zt(r.app))return Promise.reject(wn(r));const s="reauthenticate";try{const i=await Ss(n,bI(r,s,e,n),t);fe(i.idToken,r,"internal-error");const o=bh(i.idToken);fe(o,r,"internal-error");const{sub:a}=o;return fe(n.uid===a,r,"user-mismatch"),Ir._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&sr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EI(n,e,t=!1){if(Zt(n.app))return Promise.reject(wn(n));const r="signIn",s=await bI(n,r,e),i=await Ir._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function jm(n,e){return EI(Jt(n),e)}async function uD(n,e){const t=ke(n);return await Ih(!1,t,e.providerId),Um(t,e)}async function cD(n,e){return II(ke(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dD(n,e){return Os(n,"POST","/v1/accounts:signInWithCustomToken",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E$(n,e){if(Zt(n.app))return Promise.reject(wn(n));const t=Jt(n),r=await dD(t,{token:e,returnSecureToken:!0}),s=await Ir._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Bm._fromServerResponse(e,t):"totpInfo"in t?qm._fromServerResponse(e,t):sr(e,"internal-error")}}class Bm extends Yu{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Bm(t)}}class qm extends Yu{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new qm(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eh(n,e,t){var r;fe(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),fe(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(fe(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(fe(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zm(n){const e=Jt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function hD(n,e,t){const r=Jt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Eh(r,s,t),await Iu(r,s,"getOobCode",Hk)}async function fD(n,e,t){await yI(ke(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&zm(n),r})}async function T$(n,e){await zk(ke(n),{oobCode:e})}async function pD(n,e){const t=ke(n),r=await yI(t,{oobCode:e}),s=r.requestType;switch(fe(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":fe(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":fe(r.mfaInfo,t,"internal-error");default:fe(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Yu._fromServerResponse(Jt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function x$(n,e){const{data:t}=await pD(ke(n),e);return t.email}async function mD(n,e,t){if(Zt(n.app))return Promise.reject(wn(n));const r=Jt(n),o=await Iu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_I).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&zm(n),l}),a=await Ir._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function gD(n,e,t){return Zt(n.app)?Promise.reject(wn(n)):jm(ke(n),xo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&zm(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A$(n,e,t){const r=Jt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){fe(a.handleCodeInApp,r,"argument-error"),a&&Eh(r,o,a)}i(s,t),await Iu(r,s,"getOobCode",Wk)}function S$(n,e){const t=Ju.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function P$(n,e,t){if(Zt(n.app))return Promise.reject(wn(n));const r=ke(n),s=xo.credentialWithLink(e,t||bu());return fe(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),jm(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vD(n,e){return jt(n,"POST","/v1/accounts:createAuthUri",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R$(n,e){const t=Mm()?bu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await vD(ke(n),r);return s||[]}async function C$(n,e){const t=ke(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Eh(t.auth,s,e);const{email:i}=await Kk(t.auth,s);i!==n.email&&await n.reload()}async function k$(n,e,t){const r=ke(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Eh(r.auth,i,t);const{email:o}=await Qk(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yD(n,e){return jt(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D$(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=ke(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Ss(r,yD(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function _D(n,e){const t=ke(n);return Zt(t.auth.app)?Promise.reject(wn(t.auth)):TI(t,e,null)}function bD(n,e){return TI(ke(n),null,e)}async function TI(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Ss(n,Bk(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wD(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=bh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new pa(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new ID(i,s);case"github.com":return new ED(i,s);case"google.com":return new TD(i,s);case"twitter.com":return new xD(i,s,n.screenName||null);case"custom":case"anonymous":return new pa(i,null);default:return new pa(i,r,s)}}class pa{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class xI extends pa{constructor(e,t,r,s){super(e,t,r),this.username=s}}class ID extends pa{constructor(e,t){super(e,"facebook.com",t)}}class ED extends xI{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class TD extends pa{constructor(e,t){super(e,"google.com",t)}}class xD extends xI{constructor(e,t,r){super(e,"twitter.com",t,r)}}function V$(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:wD(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N$(n,e){return ke(n).setPersistence(e)}function O$(n){return Mk(n)}async function M$(n,e){return Jt(n).validatePassword(e)}function AD(n,e,t,r){return ke(n).onIdTokenChanged(e,t,r)}function SD(n,e,t){return ke(n).beforeAuthStateChanged(e,t)}function L$(n,e,t,r){return ke(n).onAuthStateChanged(e,t,r)}function F$(n){ke(n).useDeviceLanguage()}function $$(n,e){return ke(n).updateCurrentUser(e)}function PD(n){return ke(n).signOut()}function U$(n,e){return Jt(n).revokeAccessToken(e)}async function j$(n){return ke(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ro("enroll",e,t)}static _fromMfaPendingCredential(e){return new ro("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return ro._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return ro._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Jt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Yu._fromServerResponse(r,a));fe(s.mfaPendingCredential,r,"internal-error");const o=ro._fromMfaPendingCredential(s.mfaPendingCredential);return new Gm(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await Ir._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return fe(t.user,r,"internal-error"),Ir._forOperation(t.user,t.operationType,c);default:sr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function B$(n,e){var t;const r=ke(n),s=e;return fe(e.customData.operationType,r,"argument-error"),fe((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Gm._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:start",Ut(n,e))}function CD(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ut(n,e))}function kD(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:start",Ut(n,e))}function DD(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ut(n,e))}function VD(n,e){return jt(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ut(n,e))}class Km{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Yu._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Km(e)}async getSession(){return ro._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Ss(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Ss(this.user,VD(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const cf=new WeakMap;function q$(n){const e=ke(n);return cf.has(e)||cf.set(e,Km._fromUser(e)),cf.get(e)}const Rd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Rd,"1"),this.storage.removeItem(Rd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ND=1e3,OD=10;class SI extends AI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=fI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);Tk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,OD):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},ND)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}SI.type="LOCAL";const MD=SI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI extends AI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}PI.type="SESSION";const RI=PI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LD(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Th(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await LD(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Th.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=xh("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sn(){return window}function $D(n){sn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hm(){return typeof sn().WorkerGlobalScope<"u"&&typeof sn().importScripts=="function"}async function UD(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function jD(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function BD(){return Hm()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CI="firebaseLocalStorageDb",qD=1,Cd="firebaseLocalStorage",kI="fbase_key";class Xu{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ah(n,e){return n.transaction([Cd],e?"readwrite":"readonly").objectStore(Cd)}function zD(){const n=indexedDB.deleteDatabase(CI);return new Xu(n).toPromise()}function ip(){const n=indexedDB.open(CI,qD);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Cd,{keyPath:kI})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Cd)?e(r):(r.close(),await zD(),e(await ip()))})})}async function My(n,e,t){const r=Ah(n,!0).put({[kI]:e,value:t});return new Xu(r).toPromise()}async function GD(n,e){const t=Ah(n,!1).get(e),r=await new Xu(t).toPromise();return r===void 0?null:r.value}function Ly(n,e){const t=Ah(n,!0).delete(e);return new Xu(t).toPromise()}const KD=800,HD=3;class DI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ip(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>HD)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Hm()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Th._getInstance(BD()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await UD(),!this.activeServiceWorker)return;this.sender=new FD(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||jD()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ip();return await My(e,Rd,"1"),await Ly(e,Rd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>My(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>GD(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Ly(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Ah(s,!1).getAll();return new Xu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),KD)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}DI.type="LOCAL";const WD=DI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QD(n,e){return jt(n,"POST","/v2/accounts/mfaSignIn:start",Ut(n,e))}function JD(n,e){return jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Ut(n,e))}function YD(n,e){return jt(n,"POST","/v2/accounts/mfaSignIn:finalize",Ut(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XD=500,ZD=6e4,Dc=1e12;class e2{constructor(e){this.auth=e,this.counter=Dc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new t2(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Dc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Dc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Dc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class t2{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;fe(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=n2(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},ZD)},XD))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function n2(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const df=mI("rcb"),r2=new Hu(3e4,6e4);class s2{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=sn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return fe(i2(t),e,"argument-error"),this.shouldResolveImmediately(t)&&Ay(sn().grecaptcha)?Promise.resolve(sn().grecaptcha):new Promise((r,s)=>{const i=sn().setTimeout(()=>{s(Wn(e,"network-request-failed"))},r2.get());sn()[df]=()=>{sn().clearTimeout(i),delete sn()[df];const a=sn().grecaptcha;if(!a||!Ay(a)){s(Wn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${kk()}?${$a({onload:df,render:"explicit",hl:t})}`;$m(o).catch(()=>{clearTimeout(i),s(Wn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=sn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function i2(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class o2{async load(e){return new e2(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VI="recaptcha",a2={theme:"light",type:"image"};class z${constructor(e,t,r=Object.assign({},a2)){this.parameters=r,this.type=VI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Jt(e),this.isInvisible=this.parameters.size==="invisible",fe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;fe(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new o2:new s2,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){fe(!this.parameters.sitekey,this.auth,"argument-error"),fe(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),fe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=sn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){fe(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){fe(Mm()&&!Hm(),this.auth,"internal-error"),await l2(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await fk(this.auth);fe(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return fe(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function l2(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ao._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function G$(n,e,t){if(Zt(n.app))return Promise.reject(wn(n));const r=Jt(n),s=await Sh(r,e,ke(t));return new Wm(s,i=>jm(r,i))}async function K$(n,e,t){const r=ke(n);await Ih(!1,r,"phone");const s=await Sh(r.auth,e,ke(t));return new Wm(s,i=>uD(r,i))}async function H$(n,e,t){const r=ke(n);if(Zt(r.auth.app))return Promise.reject(wn(r.auth));const s=await Sh(r.auth,e,ke(t));return new Wm(s,i=>cD(r,i))}async function Sh(n,e,t){var r;const s=await t.verify();try{fe(typeof s=="string",n,"argument-error"),fe(t.type===VI,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return fe(o.type==="enroll",n,"internal-error"),(await RD(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{fe(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return fe(a,n,"missing-multi-factor-info"),(await QD(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await Zk(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function W$(n,e){const t=ke(n);if(Zt(t.auth.app))return Promise.reject(wn(t.auth));await Um(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e){this.providerId=ma.PROVIDER_ID,this.auth=Jt(e)}verifyPhoneNumber(e,t){return Sh(this.auth,e,ke(t))}static credential(e,t){return ao._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ma.credentialFromTaggedObject(t)}static credentialFromError(e){return ma.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ao._fromTokenResponse(t,r):null}}ma.PROVIDER_ID="phone";ma.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ao(n,e){return e?vs(e):(fe(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm extends Qu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return bs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return bs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function u2(n){return EI(n.auth,new Qm(n),n.bypassAuthState)}function c2(n){const{auth:e,user:t}=n;return fe(t,e,"internal-error"),II(t,new Qm(n),n.bypassAuthState)}async function d2(n){const{auth:e,user:t}=n;return fe(t,e,"internal-error"),Um(t,new Qm(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return u2;case"linkViaPopup":case"linkViaRedirect":return d2;case"reauthViaPopup":case"reauthViaRedirect":return c2;default:sr(this.auth,"internal-error")}}resolve(e){As(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){As(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h2=new Hu(2e3,1e4);async function Q$(n,e,t){if(Zt(n.app))return Promise.reject(Wn(n,"operation-not-supported-in-this-environment"));const r=Jt(n);Xa(n,e,Ms);const s=Ao(r,t);return new ys(r,"signInViaPopup",e,s).executeNotNull()}async function J$(n,e,t){const r=ke(n);if(Zt(r.auth.app))return Promise.reject(Wn(r.auth,"operation-not-supported-in-this-environment"));Xa(r.auth,e,Ms);const s=Ao(r.auth,t);return new ys(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function Y$(n,e,t){const r=ke(n);Xa(r.auth,e,Ms);const s=Ao(r.auth,t);return new ys(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class ys extends NI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ys.currentPopupAction&&ys.currentPopupAction.cancel(),ys.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return fe(e,this.auth,"internal-error"),e}async onExecution(){As(this.filter.length===1,"Popup operations only handle one event");const e=xh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Wn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Wn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ys.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Wn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,h2.get())};e()}}ys.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f2="pendingRedirect",Xc=new Map;class p2 extends NI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Xc.get(this.auth._key());if(!e){try{const r=await m2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Xc.set(this.auth._key(),e)}return this.bypassAuthState||Xc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function m2(n,e){const t=MI(e),r=OI(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Jm(n,e){return OI(n)._set(MI(e),"true")}function g2(n,e){Xc.set(n._key(),e)}function OI(n){return vs(n._redirectPersistence)}function MI(n){return Jc(f2,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X$(n,e,t){return v2(n,e,t)}async function v2(n,e,t){if(Zt(n.app))return Promise.reject(wn(n));const r=Jt(n);Xa(n,e,Ms),await r._initializationPromise;const s=Ao(r,t);return await Jm(s,r),s._openRedirect(r,e,"signInViaRedirect")}function Z$(n,e,t){return y2(n,e,t)}async function y2(n,e,t){const r=ke(n);if(Xa(r.auth,e,Ms),Zt(r.auth.app))return Promise.reject(wn(r.auth));await r.auth._initializationPromise;const s=Ao(r.auth,t);await Jm(s,r.auth);const i=await FI(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function eU(n,e,t){return _2(n,e,t)}async function _2(n,e,t){const r=ke(n);Xa(r.auth,e,Ms),await r.auth._initializationPromise;const s=Ao(r.auth,t);await Ih(!1,r,e.providerId),await Jm(s,r.auth);const i=await FI(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function tU(n,e){return await Jt(n)._initializationPromise,LI(n,e,!1)}async function LI(n,e,t=!1){if(Zt(n.app))return Promise.reject(wn(n));const r=Jt(n),s=Ao(r,e),o=await new p2(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function FI(n){const e=xh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b2=10*60*1e3;class w2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!I2(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!$I(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Wn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=b2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Fy(e))}saveEventToCache(e){this.cachedEventUids.add(Fy(e)),this.lastProcessedEventTime=Date.now()}}function Fy(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $I({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function I2(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $I(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E2(n,e={}){return jt(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,x2=/^https?/;async function A2(n){if(n.config.emulator)return;const{authorizedDomains:e}=await E2(n);for(const t of e)try{if(S2(t))return}catch{}sr(n,"unauthorized-domain")}function S2(n){const e=bu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!x2.test(t))return!1;if(T2.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P2=new Hu(3e4,6e4);function $y(){const n=sn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function R2(n){return new Promise((e,t)=>{var r,s,i;function o(){$y(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{$y(),t(Wn(n,"network-request-failed"))},timeout:P2.get()})}if(!((s=(r=sn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=sn().gapi)===null||i===void 0)&&i.load)o();else{const a=mI("iframefcb");return sn()[a]=()=>{gapi.load?o():t(Wn(n,"network-request-failed"))},$m(`${Vk()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Zc=null,e})}let Zc=null;function C2(n){return Zc=Zc||R2(n),Zc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2=new Hu(5e3,15e3),D2="__/auth/iframe",V2="emulator/auth/iframe",N2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},O2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function M2(n){const e=n.config;fe(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Lm(e,V2):`https://${n.config.authDomain}/${D2}`,r={apiKey:e.apiKey,appName:n.name,v:Ua},s=O2.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${$a(r).slice(1)}`}async function L2(n){const e=await C2(n),t=sn().gapi;return fe(t,n,"internal-error"),e.open({where:document.body,url:M2(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:N2,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Wn(n,"network-request-failed"),a=sn().setTimeout(()=>{i(o)},k2.get());function l(){sn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},$2=500,U2=600,j2="_blank",B2="http://localhost";class Uy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function q2(n,e,t,r=$2,s=U2){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},F2),{width:r.toString(),height:s.toString(),top:i,left:o}),c=pn().toLowerCase();t&&(a=lI(c)?j2:t),oI(c)&&(e=e||B2,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[y,R])=>`${g}${y}=${R},`,"");if(Ek(c)&&a!=="_self")return z2(e||"",a),new Uy(null);const f=window.open(e||"",a,d);fe(f,n,"popup-blocked");try{f.focus()}catch{}return new Uy(f)}function z2(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G2="__/auth/handler",K2="emulator/auth/handler",H2=encodeURIComponent("fac");async function jy(n,e,t,r,s,i){fe(n.config.authDomain,n,"auth-domain-config-required"),fe(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ua,eventId:s};if(e instanceof Ms){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",cS(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Za){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${H2}=${encodeURIComponent(l)}`:"";return`${W2(n)}?${$a(a).slice(1)}${c}`}function W2({config:n}){return n.emulator?Lm(n,K2):`https://${n.authDomain}/${G2}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hf="webStorageSupport";class Q2{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=RI,this._completeRedirectFn=LI,this._overrideRedirectResult=g2}async _openPopup(e,t,r,s){var i;As((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await jy(e,t,r,bu(),s);return q2(e,o,xh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await jy(e,t,r,bu(),s);return $D(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(As(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await L2(e),r=new w2(e);return t.register("authEvent",s=>(fe(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(hf,{type:hf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[hf];o!==void 0&&t(!!o),sr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=A2(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return fI()||aI()||Fm()}}const J2=Q2;class UI{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Gr("unexpected MultiFactorSessionType")}}}class Ym extends UI{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Ym(e)}_finalizeEnroll(e,t,r){return CD(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return JD(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Y2{constructor(){}static assertion(e){return Ym._fromCredential(e)}}Y2.FACTOR_ID="phone";class X2{static assertionForEnrollment(e,t){return xu._fromSecret(e,t)}static assertionForSignIn(e,t){return xu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;fe(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await kD(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Xm._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}X2.FACTOR_ID="totp";class xu extends UI{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new xu(t,void 0,e)}static _fromEnrollmentId(e,t){return new xu(t,e)}async _finalizeEnroll(e,t,r){return fe(typeof this.secret<"u",e,"argument-error"),DD(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){fe(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return YD(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Xm{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Xm(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Vc(e)||Vc(t))&&(s=!0),s&&(Vc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Vc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Vc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var By="@firebase/auth",qy="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z2{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){fe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function tV(n){_a(new uo("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;fe(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pI(n)},c=new Rk(r,s,i,l);return Fk(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),_a(new uo("auth-internal",e=>{const t=Jt(e.getProvider("auth").getImmediate());return(r=>new Z2(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ci(By,qy,eV(n)),ci(By,qy,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nV=5*60,rV=w0("authIdTokenMaxAge")||nV;let zy=null;const sV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>rV)return;const s=t==null?void 0:t.token;zy!==s&&(zy=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function iV(n=S0()){const e=ku(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Lk(n,{popupRedirectResolver:J2,persistence:[WD,MD,RI]}),r=w0("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=sV(i.toString());SD(t,o,()=>o(t.currentUser)),AD(t,a=>o(a))}}const s=_0("auth");return s&&$k(t,`http://${s}`),t}function oV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Ck({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Wn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",oV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});tV("Browser");const aV={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},jI=A0(aV),ae=NC(jI),_n=iV(jI);try{OC(ae)}catch{}lD(_n);async function lV(n,e){try{return(await mD(_n,n,e)).user}catch(t){throw t}}async function BI(n,e){try{return(await gD(_n,n,e)).user}catch(t){throw t}}async function qI(n){try{await hD(_n,n)}catch(e){throw e}}async function uV(n){try{const e=_n.currentUser;if(e)await bD(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const di=Object.freeze(Object.defineProperty({__proto__:null,auth:_n,createPlayerAccount:lV,db:ae,resetPlayerPassword:qI,signInPlayer:BI,updatePlayerPassword:uV},Symbol.toStringTag,{value:"Module"})),el="seasons";async function cV(n,e,t){return await _h(Qe(ae,el),{name:n,slug:e,pinCode:t,createdAt:Ku()})}async function dV(n){return await Ma(Se(ae,el,n))}async function ff(){const n=_u(Qe(ae,el),BC("createdAt","desc"));return(await bt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function kd(n,e){const t=await Sn(Se(ae,el,n));return t.exists()?t.data().pinCode===e:!1}async function op(n){const e=await Sn(Se(ae,el,n));return e.exists()?e.data().pinCode:null}async function Rl(n,e){const t=Se(ae,el,n);await Ya(t,{sortOrder:e})}const pf=10*60*1e3,mf="impro_selector_pin_session";class hV{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(mf);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<pf)return t;this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(mf,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<pf:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(mf),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=pf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const er=new hV,fV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},pV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},mV={class:"text-center mb-6"},gV={class:"text-gray-300"},vV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},yV={class:"text-sm text-green-400"},_V={class:"mb-6"},bV={class:"mb-4"},wV={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},IV={class:"flex justify-end space-x-3"},EV=["disabled"],zI={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(""),o=N(null);Ft(()=>t.show,d=>{d&&(s.value="",i.value="",hn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(M(),L("div",fV,[h("div",pV,[h("div",mV,[f[1]||(f[1]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),h("p",gV,ie(n.message),1),n.sessionInfo?(M(),L("div",vV,[h("p",yV," Session active : "+ie(n.sessionInfo.timeRemaining)+" min restantes ",1)])):le("",!0)]),h("div",_V,[h("div",bV,[f[3]||(f[3]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),ct(h("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Dn(l,["enter"]),Dn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Ct,s.value]])]),f[4]||(f[4]=h("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(M(),L("div",wV,ie(i.value||t.error),1)):le("",!0),h("div",IV,[h("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,EV)])])])):le("",!0)}},TV={class:"relative p-6 pb-4 border-b border-white/10"},xV={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},GI={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Lt(()=>{},["stop"]))},[h("div",TV,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"🎭"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Bienvenue dans Tu joues quand ?"),h("p",{class:"text-sm text-purple-300"},"L'appli impro pour organiser saisons, événements et sélections")])],-1))]),s[5]||(s[5]=cr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">À quoi ça sert ?</h3><p> Tu joues quand ? vous aide à gérer vos spectacles d&#39;impro : saisons, événements, joueurs, disponibilités, tirage au sort équitable et annonces. Fini les prises de tête : indiquez qui est dispo, et laissez le hasard pondéré faire le reste. </p></div><div class="space-y-3"><h3 class="text-white font-semibold">Fonctionnalités principales</h3><ul class="list-disc list-inside space-y-2 text-gray-300"><li><span class="text-white">Saisons</span> : regroupez vos événements par saison pour garder un historique clair.</li><li><span class="text-white">Événements</span> : créez des dates avec un titre et un nombre de joueurs à sélectionner; archivez-les quand ils sont passés.</li><li><span class="text-white">Joueurs</span> : gérez la liste des joueurs et leurs informations.</li><li><span class="text-white">Indication de disponibilité</span> : Oui/Non/Peut‑être via liens magiques ou directement dans la grille.</li><li><span class="text-white">Sélection automatique</span> : tirage au sort pondéré qui favorise l&#39;équité sur la durée.</li><li><span class="text-white">Protection des saisies</span> : PIN de saison pour sécuriser les actions sensibles, mot de passe possible pour certains joueurs.</li><li><span class="text-white">Notifications</span> : annoncez un événement (email/lien) pour collecter facilement les disponibilités.</li></ul></div><div class="space-y-2 text-sm text-gray-300"><h3 class="text-white font-semibold">Astuces</h3><ul class="list-disc list-inside space-y-1"><li>Sur mobile, faites glisser horizontalement pour parcourir les événements.</li><li>Le bouton ⚠️ dans les en-têtes signale qu&#39;un événement est prêt pour une sélection ou nécessite votre attention.</li></ul></div></div>',1)),h("div",xV,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):le("",!0)}},AV=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function SV(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function KI(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function PV(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function HI(n){if(!n)return!1;const e=String(n).toLowerCase();return AV.some(t=>e.includes(t.toLowerCase()))}function ap(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?PV(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>ap(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=HI(t)?"••••":ap(r);return e}return n}function RV(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&HI(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(ap(r))}return e}const CV=KI(SV());function Nc(n,e){const t=KI(n);return(...r)=>{if(t<CV)return;const s=RV(r);console[e](...s)}}const ge={debug:Nc("debug","log"),info:Nc("info","info"),warn:Nc("warn","warn"),error:Nc("error","error")},kV={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},DV={class:"text-center py-16 px-4 relative"},VV=["aria-busy"],NV={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},OV={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},MV=["onClick"],LV={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},FV={class:"absolute top-4 right-4"},$V=["onClick","aria-expanded"],UV={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},jV=["onClick"],BV=["onClick"],qV=["onClick"],zV={key:2,class:"flex justify-center mt-12"},GV={key:3,class:"text-center py-16"},KV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},HV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},WV={class:"mb-6"},QV={class:"mb-6"},JV={class:"mb-6"},YV={class:"flex justify-end space-x-3"},XV=["disabled"],ZV={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},eN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},tN={class:"text-center mb-6"},nN={class:"text-gray-300"},rN={__name:"Home",setup(n){const e=N([]),t=N(!0),r=Ru(),s=N(null),i=N(!1),o=N(!1),a=N(""),l=N(""),c=N(""),d=N(null),f=N(!1),g=N(null),y=N(""),R=N(!1);yr(async()=>{var De;try{e.value=await ff(),ge.info("Saisons chargées",{count:((De=e.value)==null?void 0:De.length)||0}),P().catch(te=>ge.error("Migration sortOrder échouée",te))}finally{t.value=!1}});const x=ze(()=>[...e.value].sort((De,te)=>{var Je,Ze;const Ve=typeof De.sortOrder=="number"?De.sortOrder:Number.MAX_SAFE_INTEGER,W=typeof te.sortOrder=="number"?te.sortOrder:Number.MAX_SAFE_INTEGER;if(Ve!==W)return Ve-W;const Y=(Je=De.createdAt)!=null&&Je.toMillis?De.createdAt.toMillis():0,Ne=(Ze=te.createdAt)!=null&&Ze.toMillis?te.createdAt.toMillis():0;return Y!==Ne?Ne-Y:(De.name||"").localeCompare(te.name||"")}));function V(De){r.push(`/season/${De}`)}function B(De){s.value=s.value===De?null:De}function F(){s.value=null}async function P(){if(!e.value.length)return;const De=e.value.map(Ve=>typeof Ve.sortOrder=="number"?Ve.sortOrder:null).filter(Ve=>Ve!==null);let te=De.length?Math.max(...De):0;for(const Ve of e.value)if(typeof Ve.sortOrder!="number"){te+=1;try{await Rl(Ve.id,te),Ve.sortOrder=te}catch(W){ge.error("Erreur migration sortOrder",{seasonName:Ve==null?void 0:Ve.name,error:W})}}}async function q(De){if(F(),De<=0)return;const te=[...x.value],Ve=te[De],W=te[De-1],Y=Ve.sortOrder;Ve.sortOrder=W.sortOrder,W.sortOrder=Y;try{await Promise.all([Rl(Ve.id,Ve.sortOrder),Rl(W.id,W.sortOrder)])}catch(Ne){ge.error("Erreur lors du déplacement vers le haut",Ne)}}async function X(De){F();const te=[...x.value];if(De>=te.length-1)return;const Ve=te[De],W=te[De+1],Y=Ve.sortOrder;Ve.sortOrder=W.sortOrder,W.sortOrder=Y;try{await Promise.all([Rl(Ve.id,Ve.sortOrder),Rl(W.id,W.sortOrder)])}catch(Ne){ge.error("Erreur lors du déplacement vers le bas",Ne)}}function pe(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function T(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function w(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await cV(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await ff(),await P(),I()}catch(De){ge.error("Erreur lors de la création de la saison",De),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function I(){i.value=!1,a.value="",l.value="",c.value=""}function C(De){d.value=De,o.value=!0}async function k(){o.value=!1,await Vt({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function $(){o.value=!1,d.value=null}function A(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Vt(De){if(er.isPinCached(d.value.id)){const te=er.getCachedPin(d.value.id);if(ge.debug("PIN en cache trouvé, utilisation automatique"),await kd(d.value.id,te)){await Ue(De);return}else er.clearSession()}g.value=De,f.value=!0}async function Pt(De){var te,Ve,W,Y;ge.debug("PIN soumis pour l'opération",{operationType:(te=g.value)==null?void 0:te.type});try{const Ne=((W=(Ve=g.value)==null?void 0:Ve.data)==null?void 0:W.seasonId)||((Y=d.value)==null?void 0:Y.id),Je=await kd(Ne,De);if(ge.debug("PIN validé",{valid:Je}),Je){er.saveSession(Ne,De),ge.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const Ze=g.value;g.value=null,ge.debug("Appel de executePendingOperation",{operationType:Ze==null?void 0:Ze.type}),await Ue(Ze)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(Ne){ge.error("Erreur lors de la vérification du PIN",Ne),y.value="Erreur lors de la vérification du code PIN"}}function tt(){f.value=!1,g.value=null,y.value=""}function $e(){return d.value&&er.isPinCached(d.value.id)?{timeRemaining:er.getTimeRemaining(),isExpiringSoon:er.isExpiringSoon()}:null}async function Ue(De){var W;if(ge.debug("executePendingOperation appelé",{hasOperation:!!De}),!De){ge.warn("Aucune opération à exécuter");return}const{type:te,data:Ve}=De;ge.info("Exécution de l'opération",{type:te});try{switch(te){case"deleteSeason":ge.info("Suppression de la saison",{seasonId:Ve.seasonId}),await dV(Ve.seasonId),ge.info("Saison supprimée, rechargement de la liste"),e.value=await ff(),ge.info("Liste des saisons rechargée",{count:((W=e.value)==null?void 0:W.length)||0});break;default:ge.warn("Type d'opération non reconnu",{type:te})}}catch(Y){ge.error("Erreur lors de l'exécution de l'opération",Y),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(De,te)=>{var Ve;return M(),L("div",kV,[h("div",DV,[h("button",{onClick:te[0]||(te[0]=W=>R.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},te[8]||(te[8]=[h("span",{class:"text-2xl"},"❓",-1)])),te[9]||(te[9]=h("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Tu joues quand ? ",-1)),te[10]||(te[10]=h("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui sera sur scène quand. Laissez chacun indiquer ses dispos et le hasard choisir pour vous !",-1))]),h("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(M(),L("div",NV,[(M(),L(It,null,dr(8,W=>h("div",{key:"skeleton-"+W,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},te[11]||(te[11]=[h("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),h("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),h("div",{class:"h-px bg-white/10 mb-4"},null,-1),h("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(M(),L("div",OV,[(M(!0),L(It,null,dr(x.value,(W,Y)=>(M(),L("div",{key:W.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[h("div",{onClick:Ne=>V(W.slug),class:"text-center cursor-pointer"},[te[12]||(te[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[h("span",{class:"text-2xl"},"🎭")],-1)),h("h2",LV,ie(W.name),1),te[13]||(te[13]=h("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),te[14]||(te[14]=h("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,MV),h("div",FV,[h("div",{class:"relative",onClick:te[1]||(te[1]=Lt(()=>{},["stop"]))},[h("button",{onClick:Ne=>B(Y),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Y,"aria-haspopup":"true",title:"Options"},te[15]||(te[15]=[h("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,$V),s.value===Y?(M(),L("div",UV,[h("button",{onClick:Ne=>q(Y),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,jV),h("button",{onClick:Ne=>X(Y),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,BV),te[16]||(te[16]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:Ne=>C(W),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,qV)])):le("",!0)])])]))),128))])):le("",!0),!t.value&&e.value.length>0?(M(),L("div",zV,[h("button",{onClick:te[2]||(te[2]=W=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):le("",!0),!t.value&&e.value.length===0?(M(),L("div",GV,[te[17]||(te[17]=h("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-4xl"},"🎪")],-1)),te[18]||(te[18]=h("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),te[19]||(te[19]=h("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),h("button",{onClick:te[3]||(te[3]=W=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):le("",!0)],8,VV),i.value?(M(),L("div",KV,[h("div",HV,[te[24]||(te[24]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),h("div",WV,[te[20]||(te[20]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),ct(h("input",{"onUpdate:modelValue":te[4]||(te[4]=W=>a.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:pe},null,544),[[Ct,a.value]])]),h("div",QV,[te[21]||(te[21]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),ct(h("input",{"onUpdate:modelValue":te[5]||(te[5]=W=>l.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Ct,l.value]])]),h("div",JV,[te[22]||(te[22]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),ct(h("input",{"onUpdate:modelValue":te[6]||(te[6]=W=>c.value=W),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:T},null,544),[[Ct,c.value]]),te[23]||(te[23]=h("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),h("div",YV,[h("button",{onClick:I,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:w,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,XV)])])])):le("",!0),o.value?(M(),L("div",ZV,[h("div",eN,[h("div",tN,[te[25]||(te[25]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"⚠️")],-1)),te[26]||(te[26]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",nN,'Êtes-vous sûr de vouloir supprimer la saison "'+ie((Ve=d.value)==null?void 0:Ve.name)+'" ?',1)]),te[27]||(te[27]=h("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:$,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:k,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):le("",!0),dt(zI,{show:f.value,message:A(),error:y.value,"session-info":$e(),onSubmit:Pt,onCancel:tt},null,8,["show","message","error","session-info"]),dt(GI,{show:R.value,onClose:te[7]||(te[7]=W=>R.value=!1)},null,8,["show"]),te[28]||(te[28]=cr('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},sN="modulepreload",iN=function(n){return"/"+n},Gy={},on=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=iN(i),i in Gy)return;Gy[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":sN,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},Ph="magicLinks";function Rh({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Zm(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function lp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Rh({seasonId:n,playerId:e,eventId:t,action:r}),i=Zm(40),o=Se(ae,Ph,s),a=Date.now()+1e3*60*60*24*7;await fn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function WI({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Rh({seasonId:n,playerId:e,eventId:r,action:s}),o=Zm(40),a=Se(ae,Ph,i),l=Date.now()+1e3*60*60*24*7;await fn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function QI({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Rh({seasonId:n,playerId:e,eventId:t,action:s}),o=Se(ae,Ph,i),a=await Sn(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function up({seasonId:n,playerId:e,eventId:t,action:r}){const s=Rh({seasonId:n,playerId:e,eventId:t,action:r}),i=Se(ae,Ph,s);await Ma(i)}const eg="accountMagicLinks";function Ch(n){return`account__${n}`}async function JI({currentEmail:n,newEmail:e}){const t=Zm(40),r=Ch(t),s=Se(ae,eg,r),i=Date.now()+1e3*60*60*24*7;await fn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function YI({token:n}){const e=Ch(n),t=Se(ae,eg,e),r=await Sn(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function XI({token:n}){const e=Ch(n),t=Se(ae,eg,e);await Ma(t)}const oN=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Ch,consumeAccountEmailUpdateLink:XI,consumeMagicLink:up,createAccountEmailUpdateLink:JI,createEmailVerificationLink:WI,createMagicLink:lp,verifyAccountEmailUpdateLink:YI,verifyMagicLink:QI},Symbol.toStringTag,{value:"Module"}));class aN{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const La=new aN;function tg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function Dd(n){return`seasonPreferredPlayer:${n||"global"}`}async function ZI(n,e,t,r=null){try{ge.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await tl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await on(()=>import("./index.esm-3d603a50.js"),[]),{db:c}=await on(()=>Promise.resolve().then(()=>di),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(P=>P.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");ge.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await on(()=>import("./index.esm-7dc858c5.js"),[]),{auth:R}=await on(()=>Promise.resolve().then(()=>di),void 0),x=await y(R,e,t);ge.info("Compte Firebase Auth créé",{uid:x.user.uid});const V=tg(t),B=r?Se(c,"seasons",r,"playerProtection",n):Se(c,"playerProtection",n);await fn(B,{playerId:n,email:e,passwordHash:V,firebaseUid:x.user.uid,isProtected:!0,createdAt:new Date}),ge.info("Protection sauvegardée dans Firestore");try{r&&localStorage.setItem(Dd(r),n)}catch{}return{success:!0}}catch(s){throw ge.error("Erreur lors de la protection du joueur",s),s}}async function eE({playerId:n,email:e,seasonId:t=null}){const r=t?Se(ae,"seasons",t,"playerProtection",n):Se(ae,"playerProtection",n);(await Sn(r)).exists()?await Ya(r,{email:e,updatedAt:new Date}):await fn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await WI({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function tE({playerId:n,seasonId:e=null}){const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n);if(!(await Sn(t)).exists())throw new Error("Protection introuvable");return await Ya(t,{emailVerifiedAt:new Date}),{success:!0}}async function nE({playerId:n,seasonId:e=null}){const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n);return await Ya(t,{emailVerifiedAt:null}),{success:!0}}async function rE(n,e=null){try{const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n);await fn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date});try{if(e){const r=Dd(e);localStorage.getItem(r)===n&&localStorage.removeItem(r)}}catch{}return{success:!0,email:""}}catch(t){throw ge.error("Erreur lors de la suppression de la protection",t),t}}async function hi(n,e=null){try{const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n),r=await Sn(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return ge.error("Erreur lors de la vérification de protection",t),!1}}async function tl(n,e=null){try{const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n),r=await Sn(t);return r.exists()?r.data():null}catch(t){return ge.error("Erreur lors de la récupération des données de protection",t),null}}async function sE(n,e=null){try{const t=await tl(n,e);return(t==null?void 0:t.email)||""}catch(t){return ge.error("Erreur lors de la récupération de l'email",t),""}}async function cp(n=null){try{const e=n?Qe(ae,"seasons",n,"playerProtection"):Qe(ae,"playerProtection");return(await bt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return ge.error("Erreur lors du chargement des protections",e),[]}}async function iE(n){try{const e=[],t=_u(Qe(ae,"playerProtection"),Ad("email","==",n));(await bt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await bt(Qe(ae,"seasons"));for(const i of s.docs){const o=i.id,a=_u(Qe(ae,"seasons",o,"playerProtection"),Ad("email","==",n));(await bt(a)).forEach(c=>{var f;const d=c.data();d!=null&&d.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...d})})}return e}catch(e){return ge.error("Erreur listAssociationsForEmail",e),[]}}async function oE(n,e,t=null){try{const r=await tl(n,t);if(!r||!r.isProtected)return!1;if(r.email){ge.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await on(()=>import("./index.esm-7dc858c5.js"),[]),{auth:i}=await on(()=>Promise.resolve().then(()=>di),void 0);await s(i,r.email,e),ge.debug("Mot de passe Firebase Auth valide"),La.saveSession(n,e);try{t&&localStorage.setItem(Dd(t),n)}catch{}return!0}catch(s){return ge.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{ge.debug("Vérification avec hash local");const s=tg(e),i=r.passwordHash===s;if(i){La.saveSession(n,e);try{t&&localStorage.setItem(Dd(t),n)}catch{}}return i}}catch(r){return ge.error("Erreur lors de la vérification du mot de passe",r),!1}}async function aE({playerId:n,seasonId:e=null}){const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n),r=await Sn(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await Ya(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function lo(n){return La.isPasswordCached(n)}function lN(n){return La.getCachedPassword(n)}async function lE(n,e=null){try{ge.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await tl(n,e);if(ge.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(ge.debug("Email à utiliser (masqué)"),t.firebaseUid){ge.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await on(()=>import("./index.esm-7dc858c5.js"),[]),{auth:s}=await on(()=>Promise.resolve().then(()=>di),void 0);ge.debug("Tentative d'envoi d'email"),await r(s,t.email),ge.info("Email envoyé avec succès via Firebase Auth")}else{ge.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await on(()=>import("./index.esm-7dc858c5.js"),[]),{auth:i}=await on(()=>Promise.resolve().then(()=>di),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);ge.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),ge.info("Email envoyé avec succès");const{updateDoc:l}=await on(()=>import("./index.esm-3d603a50.js"),[]),{db:c}=await on(()=>Promise.resolve().then(()=>di),void 0),d=e?Se(c,"seasons",e,"playerProtection",n):Se(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")ge.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),ge.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw ge.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function uN(n,e,t=null){try{const r=tg(e),s=t?Se(ae,"seasons",t,"playerProtection",n):Se(ae,"playerProtection",n);return await Ya(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw ge.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function cN(n){return new Promise((e,t)=>{ge.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const kh=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:nE,finalizeProtectionAfterVerification:aE,getCachedPlayerPassword:lN,getPlayerEmail:sE,getPlayerProtectionData:tl,isPlayerPasswordCached:lo,isPlayerProtected:hi,listAssociationsForEmail:iE,listProtectedPlayers:cp,markEmailVerifiedForProtection:tE,protectPlayer:ZI,requirePlayerPasswordForAvailability:cN,sendPasswordResetEmail:lE,startEmailVerificationForProtection:eE,unprotectPlayer:rE,updatePlayerPasswordInFirestore:uN,verifyPlayerPassword:oE},Symbol.toStringTag,{value:"Module"}));let Un="mock",fi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],bo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function uE(n){Un=n}async function dN(){if(Un!=="firebase"||!(await bt(Qe(ae,"seasons"))).empty)return;const e=Se(Qe(ae,"seasons"));await fn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Ku()});const t=await bt(Qe(ae,"players"));for(const o of t.docs)await fn(Se(e,"players",o.id),o.data());const r=await bt(Qe(ae,"events"));for(const o of r.docs)await fn(Se(e,"events",o.id),o.data());const s=await bt(Qe(ae,"availability"));for(const o of s.docs)await fn(Se(e,"availability",o.id),o.data());const i=await bt(Qe(ae,"selections"));for(const o of i.docs)await fn(Se(e,"selections",o.id),o.data())}async function hN(){Un==="firebase"&&await dN()}async function Ky(n=null){return(Un==="firebase"?n?(await bt(Qe(ae,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await bt(Qe(ae,"events"))).docs.map(t=>({id:t.id,...t.data()})):bo).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function gf(n=null){return(Un==="firebase"?n?(await bt(Qe(ae,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await bt(Qe(ae,"players"))).docs.map(t=>({id:t.id,...t.data()})):fi).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function cE(n,e=null){if(Un==="firebase"){const t=Se(e?Qe(ae,"seasons",e,"players"):Qe(ae,"players"));return await fn(t,{name:n}),t.id}else{const t=`p${fi.length+1}`;return fi.push({id:t,name:n}),t}}async function fN(n,e=null){if(Un==="firebase"){const t=e?Se(ae,"seasons",e,"players",n):Se(ae,"players",n);await Ma(t);const r=e?await bt(Qe(ae,"seasons",e,"availability")):await bt(Qe(ae,"availability")),s=km(ae);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else fi=fi.filter(t=>t.id!==n)}async function pN(n,e,t=null){if(Un==="firebase"){const r=t?Se(ae,"seasons",t,"players",n):Se(ae,"players",n),s=await Sn(r),i=s.exists()&&s.data().name||null;if(await fn(r,{name:e},{merge:!0}),i&&i!==e){const o=km(ae);try{const a=t?Se(ae,"seasons",t,"availability",i):Se(ae,"availability",i),l=await Sn(a);if(l.exists()){const c=l.data()||{},d=t?Se(ae,"seasons",t,"availability",e):Se(ae,"availability",e);o.set(d,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?Qe(ae,"seasons",t,"selections"):Qe(ae,"selections");(await bt(a)).forEach(c=>{var f;const d=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(d.includes(i)){const g=d.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=fi.findIndex(s=>s.id===n);r!==-1&&(fi[r]={...fi[r],name:e})}}async function Jo(n,e,t=null){if(Un==="firebase"){const r=t?await bt(Qe(ae,"seasons",t,"availability")):await bt(Qe(ae,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Yo(n=null){if(Un==="firebase"){const e=n?await bt(Qe(ae,"seasons",n,"selections")):await bt(Qe(ae,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Hy(n,e,t=null){if(Un==="firebase"){const r=t?Se(ae,"seasons",t,"availability",n):Se(ae,"availability",n);await fn(r,e)}}async function mN({seasonId:n,playerName:e,eventId:t,value:r}){if(Un!=="firebase")return;const s=n?Se(ae,"seasons",n,"availability",e):Se(ae,"availability",e),i=await Sn(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await fn(s,a)}async function Wy(n,e,t=null){if(Un==="firebase"){const r=t?Se(ae,"seasons",t,"selections",n):Se(ae,"selections",n);await fn(r,{players:e})}}async function gN(n,e=null){if(ge.info("Suppression de l'événement",{eventId:n}),Un==="firebase")try{ge.debug("Suppression de l'événement dans Firestore");const t=e?Se(ae,"seasons",e,"events",n):Se(ae,"events",n);await Ma(t),ge.debug("Suppression de la sélection associée");const r=e?Se(ae,"seasons",e,"selections",n):Se(ae,"selections",n);await Ma(r),ge.debug("Suppression des disponibilités");const s=e?await bt(Qe(ae,"seasons",e,"availability")):await bt(Qe(ae,"availability")),i=km(ae);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){ge.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),ge.info("Opérations de suppression terminées avec succès")}catch(t){throw ge.error("Erreur lors de la suppression",t),t}else bo=bo.filter(t=>t.id!==n)}async function vN(n,e=null){if(Un==="firebase"){const t=Se(e?Qe(ae,"seasons",e,"events"):Qe(ae,"events"));return await fn(t,n),t.id}else{const t=`event${bo.length+1}`;return bo.push({id:t,...n}),t}}async function Qy(n,e,t=null){if(Un==="firebase"){const r=t?Se(ae,"seasons",t,"events",n):Se(ae,"events",n);await fn(r,e,{merge:!0})}else{const r=bo.findIndex(s=>s.id===n);r!==-1&&(bo[r]={id:n,...e})}}async function yN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){try{const f=Se(ae,"userPreferences",n),g=await Sn(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:c,html:l},createdAt:Ku(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await _h(Qe(ae,"mail"),d),{success:!0}}async function dE({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",d=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:d,html:f},createdAt:Ku(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await _h(Qe(ae,"mail"),g)}async function _N({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return dE({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function bN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Se(ae,"userPreferences",n),g=await Sn(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}ge.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;ge.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:Ku(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),ge.debug("queueSelectionEmail firestore payload ready");try{return await _h(Qe(ae,"mail"),d),ge.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw ge.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function wN({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(ge.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await on(()=>Promise.resolve().then(()=>kh),void 0),{createMagicLink:a}=await on(()=>Promise.resolve().then(()=>oN),void 0),l=`${window.location.origin}/season/${s}/event/${n}`,c=t.join(", "),d=`🎭 Sélection confirmée · ${e.title}`,f=[];for(const g of t){ge.debug("Traitement du joueur",{playerName:g});try{const y=i==null?void 0:i.find(P=>P.name===g);if(!y){ge.warn("Joueur non trouvé",{playerName:g});continue}ge.debug("Joueur trouvé");const R=await o(y.id,r);if(!R){ge.warn("Pas d'email pour le joueur",{playerName:g});continue}ge.debug("Email trouvé pour joueur");const V=`${(await a({seasonId:r,playerId:y.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,B=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${g}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${Jy(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${V}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;ge.debug("HTML généré pour joueur");const F=bN({toEmail:R,playerName:g,eventTitle:e.title,eventDate:Jy(e.date),eventUrl:l,html:B,subject:d});f.push(F),ge.info("Email ajouté à la queue",{playerName:g})}catch(y){ge.error("Erreur lors de l'envoi de l'email de sélection",{playerName:g,error:y})}}return ge.info("Nombre total d'emails à envoyer",{count:f.length}),await Promise.all(f),ge.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:f.length}}function Jy(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const IN={class:"relative p-5 pb-4 border-b border-white/10"},EN={class:"text-xl md:text-2xl font-bold text-white pr-10"},TN={key:0,class:"text-sm text-purple-300 mt-1"},xN={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},AN={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},SN={class:"text-blue-200 text-sm"},PN={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},RN=["onClick"],CN={key:0,class:"space-y-4"},kN={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},DN={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},VN={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},NN={class:"text-blue-200 text-sm"},ON={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},MN={key:0,class:"space-y-2"},LN={class:"flex flex-wrap gap-2"},FN={key:1,class:"text-amber-400 text-sm"},$N={key:1,class:"space-y-4"},UN={class:"relative"},jN=["value"],BN=["title"],qN={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},zN={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},GN={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},KN=["disabled"],HN={key:0},WN={key:1},hE={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=N("email"),i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],d=ze(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=ze(()=>{if(!t.event)return"";const P=V(t.event.date);if(t.mode==="selection"){const q=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${P} : ${q}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${P}

Lien direct vers l'événement : ${d.value}

Merci de confirmer votre disponibilité.`}),g=ze(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const P=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${V(t.event.date)}).

Sélection complète : ${P}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${V(t.event.date)}) ?`}),y=N([]);async function R(){if(!t.seasonId)return;let P=[];t.mode==="selection"?P=t.players.filter(X=>t.selectedPlayers.includes(X.name)):P=t.players.filter(X=>X.isProtected);const q=[];for(const X of P)try{const{getPlayerEmail:pe}=await on(()=>Promise.resolve().then(()=>kh),void 0),T=await pe(X.id,t.seasonId);T&&q.push({...X,email:T})}catch(pe){console.warn(`Impossible de charger l'email pour ${X.name}:`,pe)}y.value=q}function x(){r("close")}function V(P){var X;return P?(typeof P=="string"?new Date(P):((X=P.toDate)==null?void 0:X.call(P))||P).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function B(){const P=f.value;navigator.clipboard.writeText(P).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(q=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}async function F(){if(!(!t.event||y.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return yr(()=>{t.show&&(s.value="email",R())}),Ft(()=>t.show,P=>{P&&(s.value="email",R())}),Ft(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&R()}),(P,q)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:x},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:q[1]||(q[1]=Lt(()=>{},["stop"]))},[h("div",IN,[h("button",{onClick:x,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("h2",EN,ie(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(M(),L("p",TN,ie(n.event.title)+" — "+ie(V(n.event.date)),1)):le("",!0)]),h("div",xN,[h("div",AN,[h("p",SN,ie(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),h("div",PN,[(M(),L(It,null,dr(c,X=>h("button",{key:X.id,onClick:pe=>s.value=X.id,class:Hn(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===X.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},ie(X.label),11,RN)),64))]),s.value==="email"?(M(),L("div",CN,[h("div",null,[q[2]||(q[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),h("div",kN,ie(g.value),1)]),h("div",null,[h("label",DN,[q[3]||(q[3]=On(" Destinataires ")),h("button",{onClick:q[0]||(q[0]=X=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(M(),L("div",VN,[h("p",NN,ie(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):le("",!0),h("div",ON,[y.value.length>0?(M(),L("div",MN,[h("div",LN,[(M(!0),L(It,null,dr(y.value,X=>(M(),L("span",{key:X.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},ie(X.name),1))),128))])])):(M(),L("div",FN," ⚠️ "+ie(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):le("",!0),s.value==="copy"?(M(),L("div",$N,[q[6]||(q[6]=h("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[h("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),h("div",UN,[h("textarea",{value:f.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,jN),h("button",{onClick:B,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(M(),L("svg",zN,q[5]||(q[5]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(M(),L("svg",qN,q[4]||(q[4]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,BN)])])):le("",!0)]),h("div",GN,[s.value==="email"?(M(),L("button",{key:0,onClick:F,disabled:y.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(M(),L("span",WN,"📧 Envoi en cours...")):(M(),L("span",HN,"📧 Envoyer les notifications email"))],8,KN)):le("",!0),s.value==="copy"?(M(),L("button",{key:1,onClick:B,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):le("",!0),h("button",{onClick:x,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):le("",!0)}},QN={class:"text-center mb-6"},JN={class:"text-lg text-gray-300"},YN={class:"mb-6"},XN={class:"space-y-4"},ZN=["disabled"],eO={key:0,class:"animate-spin"},tO={key:1},nO={class:"mb-6 text-center"},rO={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},sO={class:"text-red-300 text-sm"},iO={class:"text-center mb-6"},oO={class:"text-lg text-gray-300"},aO={class:"mb-6"},lO=["disabled"],uO={key:0,class:"animate-spin"},cO={key:1},dO={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},hO={class:"text-red-300 text-sm"},fO={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},pO={class:"text-green-300 text-sm"},mO={class:"flex justify-center"},ng={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(!1),o=N(""),a=N(!1),l=N(""),c=N(""),d=N(null);async function f(){if(s.value){i.value=!0,o.value="";try{const R=await op(t.seasonId);if(s.value===R){r("verified",{type:"season_pin"}),y();return}await oE(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),y()):o.value="Mot de passe incorrect. Veuillez réessayer."}catch(R){ge.error("Erreur lors de la vérification",R),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function g(){i.value=!0,l.value="",c.value="";try{const R=await lE(t.player.id,t.seasonId);c.value=R.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(R){ge.error("Erreur lors de l'envoi de l'email",R),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function y(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Ft(()=>t.show,R=>{R&&hn(()=>{d.value&&d.value.focus()})}),(R,x)=>{var V,B;return M(),L(It,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:y},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:x[2]||(x[2]=Lt(()=>{},["stop"]))},[h("div",QN,[x[6]||(x[6]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔐")],-1)),x[7]||(x[7]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),h("p",JN,ie((V=n.player)==null?void 0:V.name),1),x[8]||(x[8]=h("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),h("div",YN,[h("div",XN,[h("div",null,[x[9]||(x[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ct(h("input",{"onUpdate:modelValue":x[0]||(x[0]=F=>s.value=F),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Dn(f,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Ct,s.value]])])]),h("button",{onClick:f,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(M(),L("span",eO,"⏳")):(M(),L("span",tO,"🔓")),h("span",null,ie(i.value?"Vérification...":"Vérifier"),1)],8,ZN)]),h("div",nO,[h("button",{onClick:x[1]||(x[1]=F=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(M(),L("div",rO,[h("div",sO,ie(o.value),1)])):le("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:y,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):le("",!0),a.value?(M(),L("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:x[5]||(x[5]=F=>a.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:x[4]||(x[4]=Lt(()=>{},["stop"]))},[h("div",iO,[x[10]||(x[10]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"📧")],-1)),x[11]||(x[11]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),h("p",oO,ie((B=n.player)==null?void 0:B.name),1)]),h("div",aO,[x[12]||(x[12]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:g,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(M(),L("span",uO,"⏳")):(M(),L("span",cO,"📧")),h("span",null,ie(i.value?"Envoi...":"Envoyer l'email"),1)],8,lO)]),l.value?(M(),L("div",dO,[h("div",hO,ie(l.value),1)])):le("",!0),c.value?(M(),L("div",fO,[h("div",pO,ie(c.value),1)])):le("",!0),h("div",mO,[h("button",{onClick:x[3]||(x[3]=F=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):le("",!0)],64)}}},gO={class:"text-center mb-6"},vO={class:"text-sm text-gray-300"},yO={key:0,class:"space-y-4"},_O={key:0,class:"text-sm text-gray-300"},bO={key:1,class:"space-y-4"},wO=["disabled"],IO={key:0,class:"animate-spin"},EO={key:1},TO={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},xO={class:"mt-6 flex justify-center gap-3"},AO=["disabled"],SO={key:0,class:"animate-spin"},PO={key:1},fE={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=N(1),i=N(""),o=N(""),a=N(""),l=N(!1),c=N(""),d=N(!1),f=Fa(),g=ze(()=>i.value&&i.value.includes("@")),y=ze(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function R(){var F,P,q;if(!(!g.value||!((F=t.player)!=null&&F.id))){l.value=!0,c.value="";try{const X=await eE({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),pe=(P=f.params)==null?void 0:P.slug,T=`${X.url}${pe?`&slug=${encodeURIComponent(pe)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await _N({toEmail:i.value,playerName:((q=t.player)==null?void 0:q.name)||"joueur",verifyUrl:T}),d.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function x(){try{await nE({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,d.value=!1,i.value="",o.value="",a.value=""}async function V(){var F;try{const P=await tl((F=t.player)==null?void 0:F.id,t.seasonId);P!=null&&P.email&&(P!=null&&P.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}yr(()=>{V()}),Ft(()=>t.show,F=>{F&&V()});async function B(){if(y.value){l.value=!0,c.value="";try{await ZI(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(F){c.value=(F==null?void 0:F.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(F,P)=>{var q;return n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:P[6]||(P[6]=X=>F.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[5]||(P[5]=Lt(()=>{},["stop"]))},[h("button",{onClick:P[0]||(P[0]=X=>F.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",gO,[P[7]||(P[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"👤")],-1)),P[8]||(P[8]=h("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),h("p",vO,"Pour sécuriser les saisies de "+ie((q=n.player)==null?void 0:q.name),1)]),s.value===1?(M(),L("div",yO,[h("div",null,[P[9]||(P[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),ct(h("input",{"onUpdate:modelValue":P[1]||(P[1]=X=>i.value=X),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ct,i.value]])]),d.value?(M(),L("div",_O,"Un email a été envoyé à "+ie(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)):le("",!0)])):s.value===2?(M(),L("div",bO,[h("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[P[10]||(P[10]=h("span",null,"✅",-1)),P[11]||(P[11]=h("span",null,"Adresse email vérifiée",-1)),h("button",{type:"button",onClick:x,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),h("div",null,[P[12]||(P[12]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ct(h("input",{"onUpdate:modelValue":P[2]||(P[2]=X=>o.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Ct,o.value]])]),h("div",null,[P[13]||(P[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ct(h("input",{"onUpdate:modelValue":P[3]||(P[3]=X=>a.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Ct,a.value]])]),h("button",{onClick:B,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(M(),L("span",IO,"⏳")):(M(),L("span",EO,"🔒")),h("span",null,ie(l.value?"Association...":"Associer ce joueur"),1)],8,wO)])):le("",!0),c.value?(M(),L("div",TO,ie(c.value),1)):le("",!0),h("div",xO,[h("button",{onClick:P[4]||(P[4]=X=>F.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),s.value===1?(M(),L("button",{key:0,onClick:R,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(M(),L("span",SO,"⏳")):(M(),L("span",PO,"✉️")),h("span",null,ie(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,AO)):le("",!0)])])])):le("",!0)}}},RO={class:"text-center mb-6"},CO={class:"text-2xl font-bold text-white mb-2"},kO={class:"text-lg text-gray-300"},DO={class:"mb-6"},VO={class:"flex items-center space-x-3"},NO={class:"text-2xl"},OO={class:"font-semibold text-white"},MO={class:"text-sm text-gray-300"},LO={key:0,class:"mb-6"},FO={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},$O={class:"text-red-300 text-sm"},UO={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},jO={class:"text-green-300 text-sm"},BO={class:"flex justify-center gap-3"},qO=["disabled"],zO={key:3,class:"mt-4"},GO={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},KO={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=N(!1),o=N(!1),a=N(""),l=N(""),c=N(!1),d=N(!1);Fa();const f=N(!1);ze(()=>!1),ze(()=>!1);function g(){l.value="Compte créé et joueur associé !",s.value=!0,d.value=!1,r("update")}async function y(){var F;if((F=t.player)!=null&&F.id){s.value=await hi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:P}=await on(()=>Promise.resolve().then(()=>kh),void 0);i.value=P(t.player.id)}catch{i.value=!1}}}function R(){var F;a.value="";try{if((F=t.player)!=null&&F.id&&lo(t.player.id)){x();return}}catch{}f.value=!0}async function x(){o.value=!0,a.value="",l.value="";try{const F=await rE(t.player.id,t.seasonId);l.value="Protection désactivée avec succès !",s.value=!1,F.email&&(email.value=F.email),r("update")}catch(F){logger.error("Erreur lors de la désactivation de la protection",F),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function V(){f.value=!1,x()}function B(){r("close")}return Ft(()=>t.player,()=>{t.show&&t.player&&y()},{immediate:!0}),Ft(()=>t.show,F=>{F&&t.player&&(a.value="",l.value="",c.value=!1,f.value=!1,y(),t.onboarding&&hn(()=>{}))}),(F,P)=>{var q;return M(),L(It,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:B},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[2]||(P[2]=Lt(()=>{},["stop"]))},[h("button",{onClick:B,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",RO,[P[5]||(P[5]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),h("h2",CO,ie(s.value?"Déverrouiller les disponibilités":"Verrouiller ce joueur"),1),h("p",kO,ie((q=n.player)==null?void 0:q.name),1)]),h("div",DO,[h("div",{class:Hn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[h("div",VO,[h("span",NO,ie(s.value?"🔒":"🔓"),1),h("div",null,[h("div",OO,ie(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),h("div",MO,ie(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?le("",!0):(M(),L("div",LO,P[6]||(P[6]=[h("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(M(),L("div",FO,[h("div",$O,ie(a.value),1)])):le("",!0),l.value?(M(),L("div",UO,[h("div",jO,ie(l.value),1)])):le("",!0),h("div",BO,[h("button",{onClick:B,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),s.value?(M(),L("button",{key:1,onClick:R,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,qO)):(M(),L("button",{key:0,onClick:P[0]||(P[0]=X=>d.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte "))]),s.value?le("",!0):(M(),L("div",zO,[h("button",{onClick:P[1]||(P[1]=X=>c.value=!c.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[P[7]||(P[7]=h("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),h("span",{class:Hn(["text-blue-300 transition-transform duration-200",{"rotate-180":c.value}])},"▼",2)]),c.value?(M(),L("div",GO,P[8]||(P[8]=[h("div",{class:"text-gray-300"},"Vous pouvez continuer à utiliser cette application sans compte, mais avec un compte, vous bénéficiez de nombreux avantages.",-1),h("div",null,[On("• "),h("span",{class:"text-blue-300"},"Protéger vos saisies :"),On(" vous seul pourrez modifier les disponibilités de ce joueur")],-1),h("div",null,[On("• "),h("span",{class:"text-blue-300"},"Notifications :"),On(" recevez des emails lorsqu'il y a de nouvelles sélections")],-1),h("div",null,[On("• "),h("span",{class:"text-blue-300"},"Confort :"),On(" votre joueur reste toujours en haut de la liste")],-1)]))):le("",!0)]))])])):le("",!0),dt(fE,{show:d.value,player:n.player,"season-id":n.seasonId,onClose:P[3]||(P[3]=X=>d.value=!1),onSuccess:g},null,8,["show","player","season-id"]),dt(ng,{show:f.value,player:n.player,seasonId:n.seasonId,onClose:P[4]||(P[4]=X=>f.value=!1),onVerified:V},null,8,["show","player","seasonId"])],64)}}};const HO=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},WO={class:"relative text-center p-6 pb-4 border-b border-white/10"},QO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},JO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},YO={class:"grid grid-cols-3 gap-3 md:gap-4"},XO={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},ZO={class:"text-xl md:text-2xl font-bold text-white"},eM={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},tM={class:"text-xl md:text-2xl font-bold text-white"},nM={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},rM={class:"text-xl md:text-2xl font-bold text-white"},sM={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},iM={key:0,class:"md:hidden mt-3 space-y-2"},oM={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},aM={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},lM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},uM={class:"mb-6"},cM={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N(""),a=N(null),l=N(!1),c=N(!1),d=N(null),f=N(!1),g=N(!1),y=N(!1);function R(){s("close")}function x(){var w;o.value=((w=r.player)==null?void 0:w.name)||"",i.value=!0,hn(()=>{a.value&&a.value.focus()})}function V(){i.value=!1,o.value=""}async function B(){var I,C;if(!o.value.trim())return;if(await hi((I=r.player)==null?void 0:I.id,r.seasonId)){lo((C=r.player)==null?void 0:C.id)?F():(d.value="update",c.value=!0);return}F()}function F(){var w;s("update",{playerId:(w=r.player)==null?void 0:w.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function P(){var I,C;if(await hi((I=r.player)==null?void 0:I.id,r.seasonId)){lo((C=r.player)==null?void 0:C.id)?q():(d.value="delete",c.value=!0);return}q()}function q(){var w;s("delete",(w=r.player)==null?void 0:w.id)}function X(){s("refresh")}function pe(w){d.value==="update"?F():d.value==="delete"&&q(),d.value=null}Ft(()=>r.show,w=>{var I;w||(i.value=!1,o.value="",d.value=null,l.value=!1),w&&((I=r.player)!=null&&I.id)&&(hi(r.player.id,r.seasonId).then(C=>{g.value=!!C}),on(()=>Promise.resolve().then(()=>kh),void 0).then(C=>{try{y.value=!!C.isPlayerPasswordCached(r.player.id)}catch{y.value=!1}}))}),e({openProtection(){l.value=!0}});const T=N({position:null});return Ft(()=>r.show,w=>{w&&r.onboardingStep===4?hn(()=>{const I=document.querySelectorAll("button");let C=null;if(I.forEach(k=>{!C&&k.textContent&&k.textContent.includes("Protection")&&(C=k)}),C){const k=C.getBoundingClientRect();T.value.position={x:Math.round(k.right+8),y:Math.round(k.top+window.scrollY-4)}}}):w||(T.value.position=null)}),(w,I)=>{var C;return M(),L(It,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:R},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[5]||(I[5]=Lt(()=>{},["stop"]))},[h("div",WO,[h("button",{onClick:R,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),I[10]||(I[10]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),h("h2",QO,ie((C=n.player)==null?void 0:C.name),1)]),h("div",JO,[h("div",null,[h("div",YO,[h("div",XO,[h("div",ZO,ie(r.stats.availability),1),I[11]||(I[11]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",eM,[h("div",tM,ie(r.stats.selection),1),I[12]||(I[12]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",nM,[h("div",rM,ie(r.stats.ratio)+"%",1),I[13]||(I[13]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),h("div",sM,[h("button",{onClick:x,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},I[14]||(I[14]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:I[0]||(I[0]=k=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[h("span",null,ie(g.value?"🔓":"🔒"),1),h("span",null,ie(g.value?y.value?"Dissocier de mon compte":"Déverrouiller":"Verrouiller"),1)]),h("button",{onClick:P,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},I[15]||(I[15]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:R,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(M(),L("div",iM,[h("button",{onClick:I[1]||(I[1]=k=>{x(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Renommer "),h("button",{onClick:I[2]||(I[2]=k=>{P(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):le("",!0)]),h("div",oM,[h("button",{onClick:I[3]||(I[3]=k=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ie(g.value?y.value?"🔓 Dissocier":"🔓 Déverrouiller":"🔒 Verrouiller"),1),h("button",{onClick:R,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),h("button",{onClick:I[4]||(I[4]=k=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):le("",!0),i.value?(M(),L("div",aM,[h("div",lM,[I[17]||(I[17]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),h("div",uM,[I[16]||(I[16]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ct(h("input",{"onUpdate:modelValue":I[6]||(I[6]=k=>o.value=k),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Dn(V,["esc"]),Dn(B,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Ct,o.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:V,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:B,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):le("",!0),dt(KO,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:I[7]||(I[7]=k=>l.value=!1),onUpdate:X,onOnboardingFinished:I[8]||(I[8]=k=>w.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),dt(ng,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:I[9]||(I[9]=k=>c.value=!1),onVerified:pe},null,8,["show","player","seasonId"])],64)}}},dM=HO(cM,[["__scopeId","data-v-7eab3d36"]]),hM={class:"relative p-6 pb-4 border-b border-white/10"},fM={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},pM={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Lt(()=>{},["stop"]))},[h("div",hM,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),h("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=cr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),h("div",fM,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):le("",!0)}},mM={class:"relative text-center p-6 pb-4 border-b border-white/10"},gM={class:"text-2xl md:text-3xl font-bold text-white mb-1"},vM={class:"text-sm md:text-base text-purple-300"},yM={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},_M={class:"mb-3"},bM={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},wM={key:0,class:"flex items-center justify-between gap-2"},IM=["title"],EM={key:0,class:"text-purple-400 mr-2"},TM={key:1,class:"text-green-400 mr-2"},xM={key:2,class:"text-red-400 mr-2"},AM={key:3,class:"text-gray-400 mr-2"},SM=["onClick"],PM={key:1,class:"flex items-center justify-center"},RM=["onChange"],CM=["value"],kM=["onClick"],DM={key:0,class:"mb-3"},VM={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},NM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},OM={class:"text-cyan-300 text-lg md:text-xl font-semibold"},MM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},LM={class:"text-green-400 text-lg md:text-xl font-semibold"},FM={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},$M={class:"text-purple-400 text-lg md:text-xl font-semibold"},UM={key:1,class:"mb-3"},jM={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},BM={class:"flex-1"},qM={class:"text-blue-300 text-sm font-medium"},zM={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},GM=["disabled","title"],KM=["disabled"],HM=["disabled"],WM={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications","update-selection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=N(""),d=N(!1),f=N(!1),g=ze(()=>{var W;return((W=r.event)==null?void 0:W.playerCount)||6}),y=N([]),R=N(null),x=ze(()=>Array.from({length:g.value},(Y,Ne)=>{var Je;return((Je=r.currentSelection)==null?void 0:Je[Ne])||null})),V=ze(()=>JSON.stringify(y.value)!==JSON.stringify(x.value)),B=ze(()=>(r.players||[]).map(W=>W.name).filter(W=>{var Y;return((Y=r.playerAvailability)==null?void 0:Y[W])===!0}).sort((W,Y)=>W.localeCompare(Y,"fr",{sensitivity:"base"})));function F(W){const Y=new Set(y.value.filter(Boolean)),Ne=y.value[W];return Ne&&Y.delete(Ne),B.value.filter(Je=>!Y.has(Je))}function P(W){R.value=W}function q(){R.value=null}function X(W,Y){var Je;const Ne=((Je=W==null?void 0:W.target)==null?void 0:Je.value)||"";Ne&&(y.value[Y]=Ne),R.value=null}function pe(W){y.value[W]=null}ze(()=>(F(-1).length<g.value,""));const T=ze(()=>r.currentSelection&&r.currentSelection.length>0),w=ze(()=>{var Je;if(!T.value)return!1;const W=r.currentSelection.some(Ze=>!tt(Ze)),Y=((Je=r.event)==null?void 0:Je.playerCount)||6,Ne=r.availableCount<Y;return W||Ne});ze(()=>{var Ne;if(!w.value)return"";const W=r.currentSelection.filter(Je=>!tt(Je)),Y=((Ne=r.event)==null?void 0:Ne.playerCount)||6;return W.length>0?W.length===1?`${W[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${W.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<Y?`Seulement ${r.availableCount} joueurs disponibles pour ${Y} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),ze(()=>{if(!r.event||!T.value)return"";const W=I(r.event.date),Y=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${W} : ${Y}`}),Ft(()=>r.show,W=>{if(W){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const Y=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ne=g.value;y.value=Array.from({length:Ne},(Je,Ze)=>Y[Ze]||null),R.value=null}}),Ft([g,()=>r.currentSelection,()=>{var W;return(W=r.event)==null?void 0:W.id}],()=>{if(!r.show)return;const W=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Y=g.value,Ne=Array.from({length:Y},(Je,Ze)=>W[Ze]||y.value[Ze]||null);y.value=Ne.slice(0,Y)});function I(W){var Ne;return W?(typeof W=="string"?new Date(W):((Ne=W.toDate)==null?void 0:Ne.call(W))||W).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function C(){s("selection")}function k(){s("perfect")}function $(){var Y;if(!((Y=r.event)!=null&&Y.id))return;const W=y.value.filter(Boolean);s("update-selection",{eventId:r.event.id,players:W})}function A(){s("close")}function Vt(){a.value=!0}function Pt(){f.value=!0}function tt(W){return r.playerAvailability[W]===!0}function $e(W){return r.playerAvailability[W]===!1}function Ue(W){return r.currentSelection.includes(W)&&tt(W)}function De(W=!1,Y=!1){if(d.value=W,W){const Ne=I(r.event.date),Je=r.currentSelection.join(", ");Y?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ne} : ${Je}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ne} : ${Je}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function te(){l.value=!1}e({showSuccess:De});function Ve(W){s("send-email-notifications",W),a.value=!1}return(W,Y)=>{var Ne,Je,Ze;return M(),L(It,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:A},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:Y[1]||(Y[1]=Lt(()=>{},["stop"]))},[h("div",mM,[h("button",{onClick:A,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),Y[5]||(Y[5]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("h2",gM,"Sélection pour "+ie((Ne=n.event)==null?void 0:Ne.title),1),h("p",vM,ie(I((Je=n.event)==null?void 0:Je.date)),1),h("div",{class:"mt-3"},[h("button",{onClick:Pt,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},Y[4]||(Y[4]=[h("span",null,"❓",-1),On(),h("span",null,"Comment ça marche ?",-1)]))])]),h("div",yM,[h("div",_M,[Y[8]||(Y[8]=h("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),h("div",bM,[(M(!0),L(It,null,dr(y.value,(K,be)=>(M(),L("div",{key:"sel-slot-"+be,class:Hn(["relative p-3 rounded-lg border text-center transition-colors",K?["bg-gradient-to-r",$e(K)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":tt(K)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[K?(M(),L("div",wM,[h("div",{class:"flex-1 text-white font-medium truncate",title:K},[Ue(K)?(M(),L("span",EM,"🎭")):tt(K)?(M(),L("span",TM,"✅")):$e(K)?(M(),L("span",xM,"❌")):(M(),L("span",AM,"–")),On(" "+ie(K),1)],8,IM),h("button",{onClick:ce=>pe(be),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,SM)])):(M(),L("div",PM,[R.value===be?(M(),L("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:ce=>X(ce,be),onBlur:Y[0]||(Y[0]=ce=>q())},[Y[6]||(Y[6]=h("option",{value:""},"— Choisir —",-1)),(M(!0),L(It,null,dr(F(be),ce=>(M(),L("option",{key:ce,value:ce},ie(ce),9,CM))),128))],40,RM)):(M(),L("button",{key:1,onClick:ce=>P(be),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},Y[7]||(Y[7]=[h("span",{class:"text-lg"},"＋",-1),h("span",{class:"text-sm"},"Ajouter",-1)]),8,kM))]))],2))),128))])]),w.value?(M(),L("div",DM,Y[9]||(Y[9]=[h("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[h("div",{class:"text-yellow-400"},"⚠️"),h("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):le("",!0),h("div",VM,[h("div",NM,[h("div",OM,ie(((Ze=n.event)==null?void 0:Ze.playerCount)||6),1),Y[10]||(Y[10]=h("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),h("div",MM,[h("div",LM,ie(n.availableCount),1),Y[11]||(Y[11]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),h("div",FM,[h("div",$M,ie(n.selectedCount),1),Y[12]||(Y[12]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(M(),L("div",UM,[h("div",jM,[Y[14]||(Y[14]=h("div",{class:"text-blue-400 text-xl"},"✨",-1)),h("div",BM,[h("p",qM,ie(c.value),1)]),h("button",{onClick:te,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},Y[13]||(Y[13]=[h("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):le("",!0)]),h("div",zM,[h("button",{onClick:C,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":T.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},Y[15]||(Y[15]=[On(" ✨ "),h("span",{class:"hidden sm:inline"},"Sélection Auto",-1),h("span",{class:"sm:hidden"},"Auto",-1)]),8,GM),h("button",{onClick:$,disabled:!V.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",title:"Enregistrer cette composition manuelle"},Y[16]||(Y[16]=[On(" 💾 "),h("span",{class:"hidden sm:inline"},"Enregistrer",-1),h("span",{class:"sm:hidden"},"Save",-1)]),8,KM),T.value?(M(),L("button",{key:0,onClick:k,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},Y[17]||(Y[17]=[On(" 👍 "),h("span",{class:"hidden sm:inline"},"Parfait",-1)]))):le("",!0),h("button",{onClick:Vt,disabled:!T.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},Y[18]||(Y[18]=[On(" 📣 "),h("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,HM)])])])):le("",!0),dt(hE,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:Y[2]||(Y[2]=K=>a.value=!1),onSendEmailNotifications:Ve},null,8,["show","event","season-id","season-slug","players","selected-players"]),dt(pM,{show:f.value,onClose:Y[3]||(Y[3]=K=>f.value=!1)},null,8,["show"])],64)}}},QM={class:"flex items-center justify-center gap-2"},JM=["title"],YM=["title"],XM=["title"],ZM=["title"],eL=["title"],Yy={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=ze(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=ze(()=>t.isSelected?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){r("toggle",t.playerName,t.eventId)}return(l,c)=>(M(),L("div",{class:"flex items-center justify-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20 p-3 md:p-5",onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[h("div",QM,[i.value&&s.value?(M(),L("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ie(n.chancePercent)+"% ",9,JM)):(M(),L(It,{key:1},[n.isSelected?(M(),L("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," 🎭 ",8,YM)):n.isAvailable===!0?(M(),L("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ✅ ",8,XM)):n.isAvailable===!1?(M(),L("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ❌ ",8,ZM)):(M(),L("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:o.value}," – ",8,eL))],64))])],32))}},tL={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},nL={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},rL={class:"text-2xl md:text-3xl font-bold text-white mb-3"},sL={class:"text-gray-300 mb-6"},iL={class:"flex flex-col items-stretch justify-center gap-3"},oL=["value"],aL={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=ze(()=>`${s}/season/${t.seasonSlug}`),o=N(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=ze(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=ze(()=>a.value>0),c=N(l.value);Ft(a,V=>{c.value=V>0});const d=ze(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=ze(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function R(){var V;try{(V=navigator.clipboard)==null||V.writeText(i.value)}catch{}r("copy-link")}async function x(){try{if(t.seasonId){const{db:V}=await on(()=>Promise.resolve().then(()=>di),void 0),{doc:B,updateDoc:F}=await on(()=>import("./index.esm-3d603a50.js"),[]);await F(B(V,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(V,B)=>l.value&&c.value?(M(),L("div",tL,[h("div",nL,[B[1]||(B[1]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎬")],-1)),h("h2",rL,ie(d.value),1),h("p",sL,ie(f.value),1),h("div",iL,[a.value===1?(M(),L("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(M(),L("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(M(),L(It,{key:2},[h("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:B[0]||(B[0]=F=>F.target.select())},null,40,oL),h("div",{class:"flex gap-3 justify-center"},[h("button",{onClick:R,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),h("button",{onClick:x,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):le("",!0)])])])):le("",!0)}},lL={class:"flex justify-center gap-2 mb-4"},uL={class:"space-y-3"},cL={key:0},dL={key:0,class:"text-sm text-gray-400"},hL={key:1,class:"space-y-2"},fL={class:"flex items-center justify-between gap-3"},pL={class:"truncate"},mL={class:"text-white font-semibold"},gL={class:"text-gray-400 text-xs"},vL=["onClick"],yL={key:1,class:"text-sm text-gray-300"},_L={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},bL={class:"flex items-center justify-between"},wL={class:"flex items-center gap-2"},IL={class:"flex items-center justify-between"},EL={class:"flex items-center gap-2"},TL={class:"text-right"},xL=["disabled"],AL={key:0,class:"text-xs text-red-300"},SL={key:1,class:"text-xs text-green-300"},PL={key:2,class:"flex flex-col gap-3"},RL={class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},CL={class:"flex items-center gap-2"},kL=["disabled"],DL={key:0,class:"mt-2 text-xs text-red-300"},VL={key:1,class:"mt-2 text-xs text-green-300"},NL={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","manage-player","change-password","logout-device","delete-account"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N([]),o=N("players");function a(T){return["px-4 py-2 rounded-full text-sm transition-colors",o.value===T?"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"]}function l(T){return`${T.seasonId||"global"}__${T.playerId}`}async function c(){var T;try{s.value=((T=_n==null?void 0:_n.currentUser)==null?void 0:T.email)||""}catch{}try{const w=s.value?await iE(s.value):[],I=[];for(const C of w){let k=C.playerId;try{if(C.seasonId){const $=Se(ae,"seasons",C.seasonId,"players",C.playerId),A=await Sn($);A.exists()&&(k=A.data().name||k)}}catch{}I.push({...C,playerName:k})}i.value=I}catch{i.value=[]}}function d(){r("close")}Ft(()=>t.show,T=>{T&&(c(),X())}),yr(()=>{t.show&&(c(),X())});const f=N(""),g=N(!1),y=N(""),R=N(""),x=N(!1);Ft(s,T=>{f.value=T||""}),Ft(f,T=>{x.value=!!T&&T.includes("@")&&T!==s.value});async function V(){if(x.value){g.value=!0,y.value="",R.value="";try{const T=await JI({currentEmail:s.value,newEmail:f.value.trim()});await dE({toEmail:f.value.trim(),verifyUrl:T.url,purpose:"account_email_update",displayName:"utilisateur"}),R.value=`Un email de vérification a été envoyé à ${f.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(T){y.value=(T==null?void 0:T.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{g.value=!1}}}const B=N({notifyAvailability:!0,notifySelection:!0}),F=N(!1),P=N(""),q=N("");async function X(){try{if(!s.value)return;const T=Se(ae,"userPreferences",s.value),w=await Sn(T);if(w.exists()){const I=w.data()||{};B.value.notifyAvailability=I.notifyAvailability!==!1,B.value.notifySelection=I.notifySelection!==!1}else B.value={notifyAvailability:!0,notifySelection:!0}}catch{}}async function pe(){if(s.value){F.value=!0,P.value="",q.value="";try{const T=Se(ae,"userPreferences",s.value);await fn(T,{...B.value},{merge:!0}),q.value="Préférences sauvegardées"}catch{P.value="Impossible de sauvegarder vos préférences"}finally{F.value=!1}}}return(T,w)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:d},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:w[9]||(w[9]=Lt(()=>{},["stop"]))},[h("button",{onClick:d,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),w[15]||(w[15]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Gérez votre compte et vos préférences</p></div>',1)),h("div",lL,[h("button",{onClick:w[0]||(w[0]=I=>o.value="players"),class:Hn(a("players"))},"Joueurs",2),h("button",{onClick:w[1]||(w[1]=I=>o.value="notifications"),class:Hn(a("notifications"))},"Notifications",2),h("button",{onClick:w[2]||(w[2]=I=>o.value="manage"),class:Hn(a("manage"))},"Gérer",2)]),h("div",uL,[o.value==="players"?(M(),L("div",cL,[w[10]||(w[10]=h("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(M(),L("div",dL,"Aucun joueur associé pour le moment.")):(M(),L("ul",hL,[(M(!0),L(It,null,dr(i.value,I=>(M(),L("li",{key:l(I),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[h("div",fL,[h("div",pL,[h("div",mL,ie(I.seasonName||I.seasonId||"—"),1),h("div",gL,"Joueur : "+ie(I.playerName||"—"),1)]),h("button",{onClick:C=>T.$emit("manage-player",I),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,vL)])]))),128))]))])):o.value==="notifications"?(M(),L("div",yL,[h("div",_L,[h("div",bL,[h("label",wL,[ct(h("input",{type:"checkbox","onUpdate:modelValue":w[3]||(w[3]=I=>B.value.notifyAvailability=I),class:"w-4 h-4"},null,512),[[ud,B.value.notifyAvailability]]),w[11]||(w[11]=h("span",null,"Recevoir les demandes de disponibilités",-1))])]),h("div",IL,[h("label",EL,[ct(h("input",{type:"checkbox","onUpdate:modelValue":w[4]||(w[4]=I=>B.value.notifySelection=I),class:"w-4 h-4"},null,512),[[ud,B.value.notifySelection]]),w[12]||(w[12]=h("span",null,"Recevoir les emails de sélection",-1))])]),h("div",TL,[h("button",{onClick:pe,disabled:F.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},ie(F.value?"⏳":"Sauvegarder"),9,xL)]),P.value?(M(),L("div",AL,ie(P.value),1)):le("",!0),q.value?(M(),L("div",SL,ie(q.value),1)):le("",!0)])])):(M(),L("div",PL,[h("div",RL,[w[13]||(w[13]=h("label",{class:"block text-xs text-gray-400 mb-2"},"Email",-1)),h("div",CL,[ct(h("input",{"onUpdate:modelValue":w[5]||(w[5]=I=>f.value=I),type:"email",class:"flex-1 p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"nouvel@email.com"},null,512),[[Ct,f.value]]),h("button",{onClick:V,disabled:!x.value||g.value,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},ie(g.value?"⏳":"Mettre à jour"),9,kL)]),y.value?(M(),L("div",DL,ie(y.value),1)):le("",!0),R.value?(M(),L("div",VL,ie(R.value),1)):le("",!0)]),w[14]||(w[14]=h("div",{class:"text-sm text-gray-400"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),h("button",{onClick:w[6]||(w[6]=I=>T.$emit("change-password")),class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500"},"Changer de mot de passe"),h("button",{onClick:w[7]||(w[7]=I=>T.$emit("logout-device")),class:"w-full px-4 py-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600"},"Déconnexion de cet appareil"),h("button",{onClick:w[8]||(w[8]=I=>T.$emit("delete-account")),class:"w-full px-4 py-3 rounded-lg bg-red-600 text-white hover:bg-red-500"},"Supprimer mon compte")]))]),h("div",{class:"mt-6 text-center"},[h("button",{onClick:d,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):le("",!0)}},OL={class:"space-y-4"},ML={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},LL={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},FL={class:"flex justify-center gap-3 mt-2"},$L=["disabled"],UL={key:0,class:"animate-spin"},jL={key:1},BL={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=N(""),s=N(""),i=N(!1),o=N(""),a=N(""),l=ze(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function c(){if(l.value){i.value=!0,o.value="",a.value="";try{await BI(r.value.trim(),s.value),t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function d(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await qI(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(f,g)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:g[5]||(g[5]=y=>f.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[4]||(g[4]=Lt(()=>{},["stop"]))},[h("button",{onClick:g[0]||(g[0]=y=>f.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),g[8]||(g[8]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte</p></div>',1)),h("div",OL,[h("div",null,[g[6]||(g[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),ct(h("input",{"onUpdate:modelValue":g[1]||(g[1]=y=>r.value=y),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ct,r.value]])]),h("div",null,[g[7]||(g[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),ct(h("input",{"onUpdate:modelValue":g[2]||(g[2]=y=>s.value=y),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Ct,s.value]])]),h("div",{class:"text-right"},[h("button",{onClick:d,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(M(),L("div",ML,ie(o.value),1)):le("",!0),a.value?(M(),L("div",LL,ie(a.value),1)):le("",!0),h("div",FL,[h("button",{onClick:g[3]||(g[3]=y=>f.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),h("button",{onClick:c,disabled:!l.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(M(),L("span",UL,"⏳")):(M(),L("span",jL,"Se connecter"))],8,$L)])])])])):le("",!0)}};const qL={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},zL={ref:"pageHeaderRef",class:"sticky top-0 z-[140] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},GL={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},KL={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},HL={class:"hidden md:flex items-center gap-2"},WL={key:0,class:"absolute right-0 mt-2 w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[200] overflow-hidden"},QL={class:"inline-flex items-center justify-center w-5 h-5"},JL={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},YL={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},XL={class:"text-sm"},ZL={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},eF={class:"flex items-stretch relative"},tF={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},nF={class:"flex-1 overflow-hidden"},rF=["data-event-id","onClick"],sF=["title"],iF=["title"],oF={key:0,class:"mt-1 text-xs text-gray-400"},aF=["title","onClick"],lF=["title","onClick"],uF=["title","aria-label"],cF={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dF={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},hF={key:0,class:"pointer-events-none"},fF={class:"flex items-center justify-between"},pF={key:1,class:"pointer-events-none"},mF={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},gF={class:"flex items-center justify-between"},vF={key:2,class:"pointer-events-none"},yF={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},_F={class:"flex items-center justify-between"},bF={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},wF=["data-player-id"],IF={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},EF={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},TF={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},xF=["onClick","title"],AF=["data-event-id"],SF={class:"border-t border-white/10"},PF={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},RF={class:"px-4 md:px-5 flex items-center"},CF=["data-event-id"],kF={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},DF={class:"text-center"},VF={class:"text-white text-lg"},NF={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},OF={class:"text-white/60 text-xs mt-2"},MF={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},LF={class:"flex items-center space-x-2"},FF={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},$F={class:"flex items-center space-x-2"},UF={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},jF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BF={class:"mb-6"},qF={class:"mb-6"},zF={class:"mb-6"},GF={class:"mb-6 flex items-center gap-3"},KF={class:"mb-6"},HF={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},WF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},QF={class:"mb-6"},JF={class:"flex justify-end space-x-3"},YF={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},XF={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},ZF={class:"flex justify-end space-x-3"},e4={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},t4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},n4={class:"flex justify-end space-x-3"},r4={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},s4={class:"relative text-center p-6 pb-4 border-b border-white/10"},i4={class:"text-2xl md:text-3xl font-bold text-white mb-1"},o4={class:"text-sm md:text-base text-purple-300"},a4={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},l4={key:0,class:"mb-4 md:mb-6"},u4={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},c4={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},d4={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},h4={class:"text-xl md:text-2xl font-bold text-white"},f4={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},p4={class:"text-xl md:text-2xl font-bold text-white"},m4={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},g4={class:"text-xl md:text-2xl font-bold text-white"},v4={key:1,class:"mb-4 md:mb-6"},y4={class:"bg-gray-800 border border-gray-600 rounded-lg overflow-hidden"},_4={class:"col-span-4 p-3 flex items-center min-w-0"},b4=["title"],w4={key:0,class:"text-yellow-400 ml-2 text-lg",title:"Joueur protégé"},I4={class:"col-span-8 p-0"},E4={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},T4=["disabled","title"],x4=["title"],A4={key:2,class:"md:hidden mt-3 space-y-2"},S4=["disabled","title"],P4={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},R4={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},C4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},k4={class:"mb-6"},D4={class:"mb-6"},V4={class:"mb-6"},N4={class:"mb-6 flex items-center gap-3"},O4={class:"mb-6"},M4={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},L4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},F4={class:"mb-6"},$4={class:"space-y-4"},U4=["disabled"],j4={key:0,class:"animate-spin"},B4={key:1},q4={class:"mb-6 text-center"},z4={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},G4={class:"text-red-300 text-sm"},K4={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},H4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},W4={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},Q4={class:"space-y-4"},J4={class:"mt-2 text-center"},Y4={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},X4={class:"text-red-300 text-sm"},Z4={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},e3=["disabled"],t3={key:0,class:"animate-spin"},n3={key:1},r3={class:"mb-6"},s3=["disabled"],i3={key:0,class:"animate-spin"},o3={key:1},a3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},l3={class:"text-red-300 text-sm"},u3={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},c3={class:"text-green-300 text-sm"},d3={class:"flex justify-center"},h3={class:"mb-6"},f3=["disabled"],p3={key:0,class:"animate-spin"},m3={key:1},g3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},v3={class:"text-red-300 text-sm"},y3={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},_3={class:"text-green-300 text-sm"},b3={class:"flex justify-center"},w3={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},I3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},E3={class:"flex gap-3"},Xy={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Ru(),r=Fa(),s=e.slug,i=N(""),o=N(""),a=N({}),l=N(!1),c=N(null),d=N(null),f=N(""),g=N(""),y=N(6),R=N(!1),x=N(""),V=N(null),B=N(null),F=N(null),P=N({position:null,side:null}),q=N({position:null}),X=N({position:null}),pe=N(!1),T=N(null),w=N(!1),I=N(null),C=N(null),k=N(!1),$=N(null),A=N(""),Vt=N(!1),Pt=N(null),tt=N(""),$e=N(""),Ue=N(!1),De=N(null),te=N(!1),Ve=N(null),W=N(""),Y=N(""),Ne=N(!1),Je=N(null),Ze=N(!1),K=N(!1),be=N(""),ce=N(""),Ae=N(!1),We=N(!1),ut=N(""),E=N(""),S=N(!1),O=N(null),Z=N(""),J=N(!1),ee=N(!1),ve=N(!1),de=N(null),ue=N(null),oe=N(null),Ee=N(0);function we(){try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ge.value.length===0)return;const _=localStorage.getItem(`playerTourCompleted:${o.value}`),m=localStorage.getItem(`startPlayerTour:${o.value}`);!_&&m&&(Ee.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),hn(()=>{const D=document.querySelector('button[data-onboarding="add-player"]');if(D){D.scrollIntoView({behavior:"smooth",block:"end"});const Q=D.getBoundingClientRect(),ne=document.getElementById("coachmark-add"),_e=280,he=100,Me=(ne==null?void 0:ne.offsetWidth)||_e,qe=(ne==null?void 0:ne.offsetHeight)||he,rt=Math.round(Q.right+12);if(rt+Me<=window.innerWidth-12){const gt=Q.top+Q.height/2-qe/2,Ot=-14,Mt=12,at=window.innerHeight-qe-12,lr=Math.max(Mt,Math.min(Math.round(gt+Ot),at));P.value={position:{x:rt,y:lr},side:"right"}}else{const gt=Math.round(Q.left+Q.width/2-Me/2),Ot=Math.round(Q.top-qe-8),Mt=8,at=window.innerWidth-Me-8;P.value={position:{x:Math.max(Mt,Math.min(gt,at)),y:Ot},side:null}}}}))}catch{}}const Te=N(!1),Re=N(null),Oe=N(null),Be=N(!1),Xe=N(null),Wt=N(!1),Bt=N(null),gn=N(!1),Nt=N(!1),mr=N(!1),Vr=N(!1),nn=N(null);function Pn(){Nt.value=!1}function Ci(){try{const _=_n==null?void 0:_n.currentUser;if(!_||_.isAnonymous){let m=null;Fr.value&&(m=Ye.value.find(D=>D.id===Fr.value)||null),m||(m=Ye.value[0]||null),Vr.value=!0,m&&(nn.value=m);return}}catch{}Nt.value=!0}async function nl(){var _;try{const m=(_=_n==null?void 0:_n.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:D}=await on(()=>Promise.resolve().then(()=>di),void 0);await D(m),Le.value=!0,ft.value="Email de réinitialisation envoyé.",setTimeout(()=>{Le.value=!1},3e3)}catch{vr.value=!0,Bs.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{vr.value=!1},3e3)}}async function Zu(){try{await PD(_n),Pn(),Le.value=!0,ft.value="Déconnecté de cet appareil.",setTimeout(()=>{Le.value=!1},2500)}catch{vr.value=!0,Bs.value="Déconnexion impossible.",setTimeout(()=>{vr.value=!1},3e3)}}async function ec(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function ki(_){var m;Pn();try{if(_.seasonId&&_.seasonId!==o.value){const D=Se(ae,"seasons",_.seasonId),ne=(await bt(Qe(ae,"seasons"))).docs.find(he=>he.id===_.seasonId),_e=(m=ne==null?void 0:ne.data())==null?void 0:m.slug;if(_e){t.push(`/season/${_e}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const D=Ye.value.find(Q=>Q.id===_.playerId);if(D){u(D);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}yr(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function rl(){hn(()=>{Vi()})}const Er=N(new Set),Qn=N(!0),Tr=N(0),xr=N("Préparation de la grille"),Ar=N(e.eventId||null),Ls=N(!1),Di=N(null);Ft(()=>e.eventId,_=>{if(_)if(Ar.value=_,Ge.value.length>0)rg(_);else{const m=Ft(Ge,D=>{D.length>0&&(rg(_),m())},{immediate:!0})}});const ln=ze(()=>Ye.value.map(_=>({..._,isProtected:Er.value.has(_.id),email:null}))),tc=ze(()=>Ar.value?Jn.value.findIndex(_=>_.id===Ar.value):-1);ze(()=>{if(!Ar.value||tc.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Ar.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Rn=N(null),Fs=N(!1),nc=N(!1),sl=N(0),$s=N(null),jn=N(null);function Us(){const _=Rn.value;if(!_)return;const{scrollLeft:m,scrollWidth:D,clientWidth:Q}=_;Fs.value=m>2,nc.value=m<D-Q-2}function Vi(){var _;try{Us(),sl.value=((_=Rn.value)==null?void 0:_.scrollLeft)||0}catch{}}function il(_){const m=Rn.value;if(!m)return;let D=0;const Q=m.querySelector("tbody tr td[data-event-id]");if(Q)D=Q.getBoundingClientRect().width;else if(jn!=null&&jn.value){const _e=jn.value.querySelector(".col-event");_e&&(D=_e.getBoundingClientRect().width)}(!D||!isFinite(D))&&(D=m.clientWidth*.6);const ne=m.scrollLeft+_*D;m.scrollTo({left:ne,behavior:"smooth"})}const Xr=N(null);N(0);const Nr=N(!1),ir=N(!1),Zr=N(0);function ol(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),or(),il(_)}function js(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),Nr.value)return;Nr.value=!0,Zr.value=_,ir.value=!1;const D=Rn.value;if(!D)return;let Q=0;const ne=D.querySelector("tbody tr td[data-event-id]");if(ne)Q=ne.getBoundingClientRect().width;else if(jn!=null&&jn.value){const qe=jn.value.querySelector(".col-event");qe&&(Q=qe.getBoundingClientRect().width)}(!Q||!isFinite(Q))&&(Q=D.clientWidth*.6);const _e=Q/6,he=120,Me=()=>{if(!Nr.value||Zr.value===0)return;ir.value||(ir.value=!0);const qe=D.scrollLeft+Zr.value*_e;D.scrollTo({left:qe,behavior:"auto"}),Xr.value=window.setTimeout(Me,he)};Xr.value=window.setTimeout(Me,250)}function or(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=Nr.value,D=ir.value;if(Nr.value=!1,Xr.value&&(clearTimeout(Xr.value),Xr.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!D){const Q=Zr.value||0;Q!==0&&il(Q),Zr.value=0;return}Zr.value=0,m&&D&&rc()}function rc(){const _=Rn.value;if(!_)return;let m=0;const D=_.querySelector("tbody tr td[data-event-id]");if(D)m=D.getBoundingClientRect().width;else if(jn!=null&&jn.value){const he=jn.value.querySelector(".col-event");he&&(m=he.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const Q=_.scrollLeft,_e=Math.round(Q/m)*m;_.scrollTo({left:_e,behavior:"smooth"})}function sc(_){V.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Le.value=!0,ft.value="Nouveau joueur ajouté !",setTimeout(()=>{Le.value=!1},3e3)}function Dh(){if(Ee.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),D=document.getElementById("coachmark-add"),Q=280,ne=100,_e=D!=null&&D.offsetWidth&&D.offsetWidth>0?D.offsetWidth:Q,he=D!=null&&D.offsetHeight&&D.offsetHeight>0?D.offsetHeight:ne,Me=Math.round(m.right+12);if(Me+_e<=window.innerWidth-12){const rt=m.top+m.height/2-he/2,gt=Ni(rt+-14,he);P.value={position:{x:Me,y:gt},side:"right"}}else{const rt=Math.round(m.left+m.width/2-_e/2),xt=Ni(m.top-he-8,he),gt=8,Ot=window.innerWidth-_e-8;P.value={position:{x:Math.max(gt,Math.min(rt,Ot)),y:xt},side:null}}}function Ni(_,m){const D=pageHeaderRef==null?void 0:pageHeaderRef.value,Q=D?Math.max(0,Math.round(D.getBoundingClientRect().height||0)):0,ne=Math.max(12,Q+8),_e=window.innerHeight-m-12;return Math.max(ne,Math.min(Math.round(_),_e))}const es=N(!1),So=N(null);function Oi(){es.value=!es.value}function gr(){es.value=!1}function Po(_){if(!es.value)return;const m=So.value;m&&!m.contains(_.target)&&(es.value=!1)}yr(()=>{document.addEventListener("click",Po)}),ql(()=>{document.removeEventListener("click",Po)});function Ro(){var _;Ee.value===1&&((_=P.value)!=null&&_.position)&&Dh()}yr(()=>{window.addEventListener("scroll",Ro,{passive:!0}),window.addEventListener("resize",Ro)}),ql(()=>{window.removeEventListener("scroll",Ro),window.removeEventListener("resize",Ro)});function al(){var _,m;try{o.value&&(localStorage.removeItem(`playerTourCompleted:${o.value}`),localStorage.setItem(`startPlayerTour:${o.value}`,"1"))}catch{}B.value=B.value||((_=Ye.value[0])==null?void 0:_.id)||null,F.value=((m=Jn.value[0])==null?void 0:m.id)||null,P.value.position=null,q.value.position=null,X.value.position=null,Ee.value=1,hn(()=>{const D=document.querySelector('button[data-onboarding="add-player"]');D&&(D.scrollIntoView({behavior:"smooth",block:"end"}),requestAnimationFrame(()=>{const Q=D.getBoundingClientRect(),ne=document.getElementById("coachmark-add"),_e=280,he=100,Me=(ne==null?void 0:ne.offsetWidth)||_e,qe=(ne==null?void 0:ne.offsetHeight)||he,rt=Math.round(Q.right+12);if(rt+Me<=window.innerWidth-12){const gt=Q.top+Q.height/2-qe/2,Ot=-14,Mt=12,at=window.innerHeight-qe-12,lr=Math.max(Mt,Math.min(Math.round(gt+Ot),at));P.value={position:{x:rt,y:lr},side:"right"}}else{const gt=Math.round(Q.left+Q.width/2-Me/2),Ot=Math.round(Q.top-qe-8),Mt=8,at=window.innerWidth-Me-8;P.value={position:{x:Math.max(Mt,Math.min(gt,at)),y:Ot},side:null}}}))})}function Mi(_){return Er.value.has(_)}async function Co(){if(o.value)try{const _=await cp(o.value),m=new Set;_.forEach(D=>{D.isProtected&&m.add(D.playerId||D.id)}),Er.value=m}catch{const m=new Set;for(const D of Ye.value)await hi(D.id,o.value)&&m.add(D.id);Er.value=m}}const Le=N(!1),ft=N(""),vr=N(!1),Bs=N("");function Vh(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Le.value=!0,ft.value="Lien copié dans le presse-papiers",setTimeout(()=>{Le.value=!1},2500)}catch{vr.value=!0,Bs.value="Impossible de copier le lien",setTimeout(()=>{vr.value=!1},2500)}}async function ic(_){await ji({type:"deleteEvent",data:{eventId:_}})}async function oc(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await gN(m,o.value),Ge.value=Ge.value.filter(D=>D.id!==m),await Promise.all([Ky(o.value),Jo(Ye.value,Ge.value,o.value),Yo(o.value)]).then(([D,Q,ne])=>{Ge.value=D,Yt.value=Q,ht.value=ne}),l.value=!1,c.value=null,Le.value=!0,ft.value="Événement supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function ac(){l.value=!1,c.value=null}async function ll(){if(!d.value||!f.value.trim()||!g.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:g.value,description:Z.value.trim()||"",playerCount:_,archived:!!J.value};await Qy(d.value,m,o.value),!m.archived&&Ye.value.length>0&&Er.value.size>0&&(Bt.value={id:d.value,...m},Wt.value=!0),await Promise.all([Ky(o.value),Jo(Ye.value,Ge.value,o.value),Yo(o.value)]).then(([D,Q,ne])=>{Ge.value=D,Yt.value=Q,ht.value=ne}),d.value=null,f.value="",g.value="",Z.value="",y.value=6,J.value=!1,Le.value=!0,ft.value="Événement mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function ts(){if(x.value.trim())try{const _=x.value.trim(),m=await cE(_,o.value);await Promise.all([gf(o.value),Jo(Ye.value,Ge.value,o.value),Yo(o.value)]).then(([D,Q,ne])=>{Ye.value=D,Yt.value=Q,ht.value=ne,Co();const _e=Ye.value.find(Me=>Me.id===m);sc(m),B.value=m,F.value=Jn.value&&Jn.value[0]&&Jn.value[0].id?Jn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Ee<"u"&&(Ee.value=2)}catch{}const he=document.querySelector(`[data-player-id="${m}"]`);he&&he.scrollIntoView({behavior:"smooth",block:"center"}),hn(()=>{const Me=`[data-player-id="${B.value}"] td[data-event-id="${F.value}"]`,qe=document.querySelector(Me);if(qe){const rt=qe.getBoundingClientRect();q.value.position={x:Math.round(rt.left),y:Math.round(rt.top+window.scrollY-48)}}}),Le.value=!0,ft.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Le.value=!1},3e3),setTimeout(()=>{Le.value=!1,ft.value=""},5e3)}),R.value=!1,x.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Bn(){d.value=null,f.value="",g.value="",Z.value="",y.value=6}N(null);const ns=N(!1),Sr=N(""),rs=N(""),pt=N(""),Or=N(6),Mr=N(!1);async function Li(){if(!Sr.value.trim()||!rs.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Or.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:Sr.value.trim(),date:rs.value,description:pt.value.trim()||"",playerCount:_,archived:!!Mr.value};await Nh(m)}async function Nh(_){try{const m=await vN(_,o.value);Ge.value=[...Ge.value,{id:m,..._}];const D={};for(const Q of Ye.value)D[Q.name]=Yt.value[Q.name]||{},D[Q.name][m]=null,await Hy(Q.name,D[Q.name],o.value);Sr.value="",rs.value="",pt.value="",Or.value=6,Mr.value=!1,ns.value=!1,await Promise.resolve(),Le.value=!0,ft.value="Événement créé avec succès !",!_.archived&&Ye.value.length>0&&Er.value.size>0&&(Bt.value={id:m,..._},Wt.value=!0),setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function lc(){Sr.value="",rs.value="",pt.value="",Or.value=6,ns.value=!1}async function uc(){await ji({type:"addEvent",data:{}})}const Ge=N([]),Ye=N([]),Yt=N({}),ht=N({}),Lr=N({}),ko=N({});Ft([()=>Ge.value.length,()=>Ye.value.length,Qn],()=>{Qn.value||hn(()=>{Vi()})}),Ft([()=>Ye.value.length,()=>Ge.value.length,o],()=>{we()}),yr(async()=>{var _e;uE("firebase"),await hN();const _=_u(Qe(ae,"seasons"),Ad("slug","==",e.slug)),m=await bt(_);if(m.empty){t.push("/");return}else{const he=m.docs[0];o.value=he.id;const Me=he.data();i.value=Me.name,a.value=Me,document.title=`Saison : ${i.value}`}if(o.value){xr.value="Chargement des événements de la saison",Tr.value=20;const he=await bt(Qe(ae,"seasons",o.value,"events"));Ge.value=he.docs.map(at=>({id:at.id,...at.data(),playerCount:at.data().playerCount||6})),xr.value="Chargement des joueurs",Tr.value=45;const Me=await bt(Qe(ae,"seasons",o.value,"players"));Ye.value=Me.docs.map(at=>({id:at.id,...at.data()})),xr.value="Chargement des disponibilités",Tr.value=70;const qe=await bt(Qe(ae,"seasons",o.value,"availability")),rt={};qe.docs.forEach(at=>{const lr=at.data(),ls={};Object.keys(lr).forEach(zi=>{const zo=lr[zi];ls[zi]=zo==="oui"?!0:zo==="non"?!1:zo}),rt[at.id]=ls}),Yt.value=rt,xr.value="Chargement des sélections",Tr.value=85;const xt=await bt(Qe(ae,"seasons",o.value,"selections")),gt={};xt.docs.forEach(at=>{gt[at.id]=at.data().players||[]}),ht.value=gt;const Ot=await cp(o.value),Mt=new Set;Array.isArray(Ot)&&Ot.forEach(at=>{at.isProtected&&Mt.add(at.playerId||at.id)}),Er.value=Mt}const D=he=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>he()):setTimeout(he,0)};xr.value="Préparation de l'interface",Tr.value=95,D(()=>{fl(),ar()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await hn(),Tr.value=100,Qn.value=!1,hn(()=>{Us();const he=Rn.value;he&&(he.addEventListener("scroll",Me=>{Us(),sl.value=he.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Us))});const Q=r.query.event;if(Q&&Ge.value.length>0){const he=Ge.value.find(Me=>Me.id===Q);he?(console.debug("Événement trouvé depuis l'URL"),await Mh(Q,he)):(console.warn("Événement non trouvé avec l'ID"),vr.value=!0,Bs.value="Événement non trouvé",setTimeout(()=>{vr.value=!1},3e3))}const ne=r.query.player;if(ne&&Ye.value.length>0){const he=Ye.value.find(Me=>Me.id===ne);he&&(u(he),await hn(),r.query.open==="protection"&&((_e=C==null?void 0:C.value)!=null&&_e.openProtection)&&C.value.openProtection())}}),Ft(()=>r.params.eventId,_=>{if(_){const m=()=>{const D=Ge.value.find(Q=>Q.id===_);return D?(vl(D),!0):!1};if(Ge.value.length>0)m();else{const D=Ft(Ge,Q=>{Q.length>0&&m()&&D()},{immediate:!0})}}},{immediate:!0});function ul(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const qs=ze(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...Ye.value].sort((_e,he)=>(_e.name||"").localeCompare(he.name||"","fr",{sensitivity:"base"}));if(!_)return m;const D=m.findIndex(_e=>_e.id===_);if(D<=0)return m;const Q=m[D],ne=m.slice(0,D).concat(m.slice(D+1));return[Q,...ne]}),Fr=ze(()=>{try{if(o.value)return localStorage.getItem(`seasonPreferredPlayer:${o.value}`)}catch{}return null}),Oh=ze(()=>[...Ge.value].sort((_,m)=>{const D=ul(_.date),Q=ul(m.date),ne=D?D.getTime():Number.POSITIVE_INFINITY,_e=Q?Q.getTime():Number.POSITIVE_INFINITY;return ne!==_e?ne-_e:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),$r=N(!1),Jn=ze(()=>{const _=Oh.value;return $r.value?_:_.filter(m=>!m.archived)});function Pr(){$r.value=!$r.value}async function Do(_,m){const D=Ye.value.find(_e=>_e.name===_);if(!D){console.error("Joueur non trouvé");return}if(!Ge.value.find(_e=>_e.id===m)){console.error("Événement non trouvé");return}if(Mi(D.id)){const _e=lo(D.id),he=oe.value===D.id;console.debug("Joueur protégé:",{playerId:D.id,hasCachedPassword:_e,wasRecentlyVerified:he,recentlyVerifiedPlayer:oe.value}),_e||he?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),he&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),oe.value=null),cl(D,m)):(console.debug("Pas de session, affichage de la modal de vérification"),ue.value={playerName:_,eventId:m},de.value=D,ve.value=!0);return}cl(D,m)}function cl(_,m){var ne,_e,he;const D=(ne=Yt.value[_.name])==null?void 0:ne[m];console.debug("toggleAvailability");let Q;D===!0?Q=!1:D===!1?Q=void 0:Q=!0,Q===void 0?Yt.value[_.name]&&delete Yt.value[_.name][m]:(Yt.value[_.name]||(Yt.value[_.name]={}),Yt.value[_.name][m]=Q);try{typeof Ee<"u"&&Ee.value===1&&_.id===(B.value||((_e=qs.value[0])==null?void 0:_e.id))&&m===(F.value||((he=Jn.value[0])==null?void 0:he.id))&&(Ee.value=3,hn(()=>{const qe=document.querySelector(`[data-player-id="${_.id}"]`);if(qe){const rt=qe.querySelector(".player-name");if(rt){const xt=rt.getBoundingClientRect();X.value.position={x:Math.round(xt.right+8),y:Math.round(xt.top+window.scrollY-4)}}}}))}catch{}Hy(_.name,Yt.value[_.name],o.value).then(async()=>{await hn(),ar(),Le.value=!0,ft.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}).catch(Me=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function Yn(_,m){var D;return(D=Yt.value[_])==null?void 0:D[m]}function Vo(_,m){var ne;const D=ht.value[m]||[],Q=(ne=Yt.value[_])==null?void 0:ne[m];return D.includes(_)&&Q===!0}async function cc(_,m=6){const D=Ge.value.find(he=>he.id===_),Q=(D==null?void 0:D.playerCount)||6,ne=ht.value[_]||[];if(ne.length>0&&ne.every(he=>Yn(he,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Me=Ye.value.filter(xt=>Yn(xt.name,_)).map(xt=>{const gt=wt(xt.name);return{name:xt.name,weight:1/(1+gt)}}),qe=[],rt=[...Me];for(;qe.length<Q&&rt.length>0;){const xt=rt.reduce((Mt,at)=>Mt+at.weight,0);let gt=Math.random()*xt;const Ot=rt.findIndex(Mt=>(gt-=Mt.weight,gt<=0));Ot>=0&&(qe.push(rt[Ot].name),rt.splice(Ot,1))}ht.value[_]=qe}else{const he=ne.filter(qe=>Yn(qe,_)),Me=Q-he.length;if(Me<=0)ht.value[_]=he;else{const qe=new Set(he),xt=Ye.value.filter(Mt=>Yn(Mt.name,_)&&!qe.has(Mt.name)).map(Mt=>{const at=wt(Mt.name);return{name:Mt.name,weight:1/(1+at)}}),gt=[],Ot=[...xt];for(;gt.length<Me&&Ot.length>0;){const Mt=Ot.reduce((ls,zi)=>ls+zi.weight,0);let at=Math.random()*Mt;const lr=Ot.findIndex(ls=>(at-=ls.weight,at<=0));lr>=0&&(gt.push(Ot[lr].name),Ot.splice(lr,1))}ht.value[_]=[...he,...gt]}}await Wy(_,ht.value[_],o.value),fl(),ar()}async function zs(_,m=6){var he,Me;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const D=Te.value,Q=(he=Re.value)==null?void 0:he.id,ne=ht.value[_]&&ht.value[_].length>0,_e=ne?[...ht.value[_]]:[];if(await cc(_,m),console.debug("etat modal selection apres"),D&&!Te.value&&(console.debug("Restauration de la popin de sélection..."),Te.value=!0,Re.value=Ge.value.find(qe=>qe.id===Q)),Te.value&&((Me=Re.value)==null?void 0:Me.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await hn(),Oe.value&&Oe.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const qe=ht.value[_]||[],rt=_e.filter(gt=>qe.includes(gt)),xt=rt.length>0&&rt.length<_e.length;Oe.value.showSuccess(ne,xt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Le.value=!0,Ge.value.find(qe=>qe.id===_),ht.value[_],ne?ft.value="Sélection mise à jour avec succès !":ft.value="Sélection effectuée avec succès !",setTimeout(()=>{Le.value=!1},3e3)}function ss(_){_===0?P.value.position=null:_===1?q.value.position=null:_===2&&(X.value.position=null)}function dc(_){var D;return _?(typeof _=="string"?new Date(_):((D=_.toDate)==null?void 0:D.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Fi(_){var D;return _?(typeof _=="string"?new Date(_):((D=_.toDate)==null?void 0:D.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function wt(_){return Object.values(ht.value).filter(m=>m.includes(_)).length}function dl(_){const m=Yt.value[_]||{};return Object.values(m).filter(D=>D===!0).length}function No(_){return _?Object.values(Yt.value).filter(m=>m[_]===!0).length:0}function Oo(_){return _?(ht.value[_]||[]).length:0}function hl(_){const m=Ge.value.find(Q=>Q.id===_),D=(m==null?void 0:m.playerCount)||6;return Oo(_)>=D}function hc(_){const m=dl(_),D=wt(_);return m===0?0:D/m}function Mo(_){Lr.value[_]={availability:dl(_),selection:wt(_),ratio:hc(_)}}function fl(){Ye.value.forEach(_=>Mo(_.name))}function ar(){const _={};Ge.value.forEach(m=>{const D=m.playerCount||6,ne=Ye.value.filter(he=>Yn(he.name,m.id)===!0).map(he=>{const Me=wt(he.name);return{name:he.name,weight:1/(1+Me)}}),_e=ne.reduce((he,Me)=>he+Me.weight,0);ne.forEach(he=>{const Me=Math.min(1,he.weight/_e*D);_[he.name]||(_[he.name]={}),_[he.name][m.id]=Math.round(Me*100)})}),ko.value=_}const $i=N(null),Lo=N(!1);async function Ui(_=null){const m=_||$i.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await fN(m,o.value),Ye.value=Ye.value.filter(D=>D.id!==m),Lo.value=!1,$i.value=null,Le.value=!0,ft.value="Joueur supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function fc(){Lo.value=!1,$i.value=null}async function pl(_){p(),await hi(_,o.value)?await mc({type:"deletePlayer",data:{playerId:_}}):await ji({type:"deletePlayer",data:{playerId:_}})}async function Fo(){if(T.value){const _=Ge.value.find(D=>D.id===T.value),m=(_==null?void 0:_.playerCount)||6;await zs(T.value,m),pe.value=!1,T.value=null}}function pc(){pe.value=!1,T.value=null}function $o(){return $.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[$.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function ji(_){if(er.isPinCached(o.value)){const m=er.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await kd(o.value,m)){await qn(_);return}else er.clearSession()}$.value=_,k.value=!0}async function mc(_){const m=_.data.playerId;if(lo(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await qn(_);return}Pt.value=_,Vt.value=!0}async function Bi(_){try{if(await kd(o.value,_)){er.saveSession(o.value,_),k.value=!1;const D=$.value;$.value=null,await qn(D)}else A.value="Code PIN incorrect",setTimeout(()=>{A.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),A.value="Erreur lors de la vérification du code PIN"}}function gc(){k.value=!1,$.value=null,A.value=""}async function ml(_){if(_){Ue.value=!0,tt.value="";try{const m=Pt.value.data.playerId,D=await op(o.value);if(_===D){try{La.saveSession(Pt.value.data.playerId,_)}catch{}Vt.value=!1;const ne=Pt.value;Pt.value=null,$e.value="",await qn(ne);return}if(await verifyPlayerPassword(m,_,o.value)){Vt.value=!1;const ne=Pt.value;Pt.value=null,$e.value="",await qn(ne)}else tt.value="Mot de passe incorrect",setTimeout(()=>{tt.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),tt.value="Erreur lors de la vérification du mot de passe"}finally{Ue.value=!1}}}function gl(){Vt.value=!1,Pt.value=null,tt.value="",$e.value="",Ue.value=!1}async function Uo(_){if(_){Ne.value=!0,W.value="";try{const m=Ve.value.data.player,D=await op(o.value);if(_===D){try{La.saveSession(Ve.value.data.player.id,_)}catch{}te.value=!1;const ne=Ve.value;Ve.value=null,Y.value="",await qn(ne);return}if(await verifyPlayerPassword(m.id,_,o.value)){te.value=!1;const ne=Ve.value;Ve.value=null,Y.value="",await qn(ne)}else W.value="Mot de passe incorrect",setTimeout(()=>{W.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),W.value="Erreur lors de la vérification du mot de passe"}finally{Ne.value=!1}}}function vc(){te.value=!1,Ve.value=null,W.value="",Y.value="",Ne.value=!1}async function jo(){K.value=!0,be.value="",ce.value="";try{const _=Ve.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);ce.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),be.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{K.value=!1}}async function yc(){We.value=!0,ut.value="",E.value="";try{const _=Pt.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);E.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),ut.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{We.value=!1}}function _c(){return er.isPinCached(o.value)?{timeRemaining:er.getTimeRemaining(),isExpiringSoon:er.isExpiringSoon()}:null}async function qn(_){var Q;if(!_)return;const{type:m,data:D}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=D.eventId,l.value=!0;break;case"addEvent":ns.value=!0;break;case"deletePlayer":$i.value=D.playerId,Lo.value=!0;break;case"launchSelection":ht.value[D.eventId]&&ht.value[D.eventId].length>0?(T.value=D.eventId,pe.value=!0,S.value=!1):(await zs(D.eventId,D.count),S.value=!1);break;case"toggleAvailability":cl(D.player,D.eventId);break;case"toggleArchive":await setEventArchived(D.eventId,D.archived,o.value);{const ne=Ge.value.findIndex(_e=>_e.id===D.eventId);ne!==-1&&(Ge.value[ne]={...Ge.value[ne],archived:!!D.archived}),J.value=!!D.archived}break;case"updateSelection":{const{eventId:ne,players:_e}=D;await Wy(ne,Array.isArray(_e)?_e:[],o.value),ht.value[ne]=Array.isArray(_e)?_e:[];try{(Q=Oe.value)==null||Q.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Le.value=!0,ft.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Le.value=!1},3e3)}}function bc(){t.push("/")}ql(()=>{const _=Rn.value;_&&_.removeEventListener("scroll",Us),window.removeEventListener("resize",Us)});async function vl(_){O.value=_,Z.value=_.description||"",J.value=!!_.archived;try{const[m,D]=await Promise.all([Jo(Ye.value,Ge.value,o.value),Yo(o.value)]);Yt.value=m,ht.value=D}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}S.value=!0}function Bo(){S.value=!1,O.value=null,Z.value="",ee.value=!1}function yl(){Bo(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function qo(_,m){console.debug("handleAvailabilityToggle appelé");const D=Ye.value.find(ne=>ne.name===_);if(!D){console.error("Joueur non trouvé");return}console.debug("Joueur trouvé");const Q=Mi(D.id);if(console.debug("Joueur protégé"),Q){lo(D.id)?(console.debug("Session active, procéder au toggle"),await Do(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),ue.value={playerName:_,eventId:m},de.value=D,ve.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await Do(_,m)}function zn(_,m){return(ht.value[m]||[]).includes(_)}async function wc(_){if(console.debug("Mot de passe vérifié"),de.value&&(oe.value=de.value.id,console.debug("Joueur marqué comme récemment vérifié")),ue.value){const{playerName:m,eventId:D}=ue.value;console.debug("Exécution de l'action en attente"),await Do(m,D),ue.value=null}else console.debug("Aucune action en attente trouvée");ve.value=!1,de.value=null}function _l(){d.value=O.value.id,f.value=O.value.title,g.value=O.value.date,Z.value=O.value.description||"",y.value=O.value.playerCount||6,S.value=!1}async function is(){if(O.value)try{const _=!O.value.archived,m={...O.value,archived:_};await Qy(O.value.id,m,o.value),O.value.archived=_;const D=Ge.value.findIndex(Q=>Q.id===O.value.id);D!==-1&&(Ge.value[D].archived=_),Le.value=!0,ft.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function u(_){I.value=_,w.value=!0;try{typeof Ee<"u"&&Ee.value}catch{}}function p(){w.value=!1,I.value=null}async function v({playerId:_,newName:m}){try{await pN(_,m,o.value),await Promise.all([gf(o.value),Jo(Ye.value,Ge.value,o.value),Yo(o.value)]).then(([D,Q,ne])=>{if(Ye.value=D,Yt.value=Q,ht.value=ne,Co(),I.value&&I.value.id===_){const _e=D.find(he=>he.id===_);_e&&(I.value=_e)}}),Le.value=!0,ft.value="Joueur mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function b(){try{await Promise.all([gf(o.value),Jo(Ye.value,Ge.value,o.value),Yo(o.value)]).then(([_,m,D])=>{if(Ye.value=_,Yt.value=m,ht.value=D,Co(),I.value){const Q=_.find(ne=>ne.id===I.value.id);Q&&(I.value=Q)}}),Le.value=!0,ft.value="Données mises à jour !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function U(_){if(!_)return{availability:0,selection:0,ratio:0};const m=dl(_.name),D=wt(_.name),Q=m===0?0:Math.round(D/m*100);return{availability:m,selection:D,ratio:Q}}function G(_){const m=ht.value[_]||[],D=Ge.value.find(_e=>_e.id===_),Q=(D==null?void 0:D.playerCount)||6,ne=No(_);if(m.length>0){const _e=m.some(Me=>!Yn(Me,_)),he=ne<Q;if(_e||he)return{type:"incomplete",hasUnavailablePlayers:_e,hasInsufficientPlayers:he,unavailablePlayers:m.filter(Me=>!Yn(Me,_)),availableCount:ne,requiredCount:Q}}return ne<Q?{type:"insufficient",availableCount:ne,requiredCount:Q}:m.length===0?{type:"ready",availableCount:ne,requiredCount:Q}:{type:"complete",availableCount:ne,requiredCount:Q}}function me(_){const m=G(_);return m.type==="incomplete"||m.type==="insufficient"}function mt(_){const m=G(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function un({eventId:_,eventData:m,reason:D}){if(!o.value)return;const Q={id:_,...m};if(Q.archived){console.debug("Événement archivé, aucune notification envoyée"),Le.value=!0,ft.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}const ne=[];for(const _e of Ye.value){if(!await hi(_e.id,o.value))continue;const Me=await sE(_e.id,o.value);if(Me)try{const qe=await lp({seasonId:o.value,playerId:_e.id,eventId:Q.id,action:"yes"}),rt=await lp({seasonId:o.value,playerId:_e.id,eventId:Q.id,action:"no"}),xt=`${qe.url}&slug=${encodeURIComponent(s)}`,gt=`${rt.url}&slug=${encodeURIComponent(s)}`;await yN({toEmail:Me,playerName:_e.name,eventTitle:Q.title,eventDate:Fi(Q.date),yesUrl:xt,noUrl:gt,reason:D})}catch{console.error("Email non envoyé pour un joueur"),ne.push(_e.id)}}Le.value=!0,ft.value=ne.length>0?`Emails envoyés (avec ${ne.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Le.value=!1},3e3)}function nt(_){if(_!=null&&_.archived){Le.value=!0,ft.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}dn(),Xe.value=_,Be.value=!0}function cn(){Be.value=!1,Xe.value=null}function dn(){Wt.value=!1,Bt.value=null}async function os({eventId:_,eventData:m,reason:D,selectedPlayers:Q}){try{D==="selection"?(await wN({eventId:_,eventData:m,selectedPlayers:Q,seasonId:o.value,seasonSlug:s,players:ln.value}),qi(),Le.value=!0,ft.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Le.value=!1},3e3)):(await un({eventId:_,eventData:m,reason:D}),cn(),Le.value=!0,ft.value="Notifications envoyées avec succès !",setTimeout(()=>{Le.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Le.value=!0,ft.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Le.value=!1},3e3)}}function Xn(_){if(!_)return{};const m={};return Ye.value.forEach(D=>{m[D.name]=Yn(D.name,_)}),m}function as(_){Re.value=_,Te.value=!0}function qi(){Te.value=!1,Re.value=null}async function pE(){if(!Re.value)return;const _=Re.value.id,m=Re.value.playerCount||6;if(No(_)===0){Le.value=!0,ft.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Le.value=!1},3e3);return}await ji({type:"launchSelection",data:{eventId:_,count:m}})}function mE(){qi(),Le.value=!0,ft.value="Sélection validée !",setTimeout(()=>{Le.value=!1},3e3)}async function gE(_){if(!_||!_.eventId)return;const{eventId:m,players:D}=_;await ji({type:"updateSelection",data:{eventId:m,players:D}})}async function Mh(_,m){if(!_||!m)return;sg(),Ar.value=_,Ls.value=!0,await hn();const D=document.querySelector(`[data-event-id="${_}"]`);if(!D){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(he=>{he.classList.remove("focused-event-highlight")});const Q=document.querySelectorAll(`[data-event-id="${_}"]`);Q.forEach(he=>{he.classList.add("focused-event-highlight")});const ne=Q[0],_e=Q[Q.length-1];ne&&ne.classList.add("focused-event-column-start"),_e&&_e.classList.add("focused-event-column-end"),await vE(D),Le.value=!0,ft.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Le.value=!1},4e3),Di.value=setTimeout(()=>{sg()},8e3)}function rg(_){if(!_)return;const m=Ge.value.find(D=>D.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const D=Ge.value.find(Q=>Q.id===_);D?Mh(_,D):console.error("Événement toujours introuvable après retry")},500);return}Mh(_,m)}async function vE(_){if(!_)return;if(await new Promise(D=>setTimeout(D,100)),window.innerWidth<=768){const D=Rn.value;if(D){const Q=_.offsetLeft,ne=_.offsetWidth,_e=D.clientWidth,he=Q-_e/2+ne/2,Me=D.scrollWidth-_e,qe=Math.max(0,Math.min(he,Me));D.scrollTo({left:qe,behavior:"smooth"}),setTimeout(()=>{const rt=_.getBoundingClientRect();if(rt.left<0||rt.right>window.innerWidth){const xt=Q-20;D.scrollTo({left:Math.max(0,xt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Rn.value;m&&setTimeout(()=>{const D=document.querySelector(`[data-event-id="${Ar.value}"]`);if(D&&D.closest("tbody")){const Q=D.offsetLeft,ne=D.offsetWidth,_e=m.clientWidth,he=Q-_e/2+ne/2,Me=m.scrollWidth-_e,qe=Math.max(0,Math.min(he,Me));m.scrollTo({left:qe,behavior:"smooth"})}},300)}function sg(){Di.value&&(clearTimeout(Di.value),Di.value=null),Ar.value=null,Ls.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var D,Q,ne,_e,he,Me,qe,rt,xt,gt,Ot,Mt,at,lr,ls,zi,zo,ig,og;return M(),L(It,null,[h("div",qL,[h("div",zL,[h("button",{onClick:bc,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},m[70]||(m[70]=[h("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),h("h1",GL,ie(i.value?i.value:"Chargement..."),1),h("div",KL,[h("div",HL,[h("button",{onClick:Ci,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},m[71]||(m[71]=[h("span",{class:"text-2xl"},"👤",-1)])),h("button",{onClick:al,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Lancer le tutoriel interactif","aria-label":"Lancer le tutoriel interactif"},m[72]||(m[72]=[h("span",{class:"text-2xl"},"✨",-1)])),h("button",{onClick:m[0]||(m[0]=H=>gn.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Comment ça marche ?","aria-label":"Comment ça marche ?"},m[73]||(m[73]=[h("span",{class:"text-2xl"},"❓",-1)]))]),h("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:So},[h("button",{onClick:Lt(Oi,["stop"]),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[74]||(m[74]=[h("span",{class:"text-2xl"},"⋯",-1)])),es.value?(M(),L("div",WL,[h("button",{onClick:m[1]||(m[1]=H=>{Pr(),gr()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},[h("span",QL,[(M(),L("svg",JL,[m[75]||(m[75]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[76]||(m[76]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),$r.value?le("",!0):(M(),L("path",YL))]))]),h("span",XL,ie($r.value?"Masquer archivés":"Afficher archivés"),1)]),h("button",{onClick:m[2]||(m[2]=H=>{Ci(),gr()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[77]||(m[77]=[h("span",null,"👤",-1),h("span",{class:"text-sm"},"Mon compte",-1)])),h("button",{onClick:m[3]||(m[3]=H=>{al(),gr()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[78]||(m[78]=[h("span",null,"✨",-1),h("span",{class:"text-sm"},"Lancer le tutoriel",-1)])),h("button",{onClick:m[4]||(m[4]=H=>{gn.value=!0,gr()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[79]||(m[79]=[h("span",null,"❓",-1),h("span",{class:"text-sm"},"Comment ça marche ?",-1)]))])):le("",!0)],512)])],512),h("div",ZL,[h("div",{ref_key:"headerBarRef",ref:$s,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[h("div",eF,[Ge.value.length===0&&Ye.value.length===0?le("",!0):(M(),L("div",tF,[h("div",{class:"flex items-center justify-center h-full gap-2"},[h("button",{onClick:uc,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[80]||(m[80]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),h("span",{class:"sm:hidden"},"Événement",-1)]))])])),h("div",nF,[h("div",{ref_key:"headerEventsRef",ref:jn,class:"flex relative z-[60]",style:Xs({transform:`translateX(-${sl.value}px)`})},[(M(!0),L(It,null,dr(Jn.value,H=>(M(),L("div",{key:"h-"+H.id,"data-event-id":H.id,class:"col-event flex-shrink-0 p-3 text-center cursor-pointer",onClick:Cn=>vl(H)},[h("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:Fi(H.date)},ie(dc(H.date)),9,sF),h("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:H.title},ie(H.title||"Sans titre"),9,iF),H.archived?(M(),L("div",oF,"(Archivé)")):le("",!0),me(H.id)?(M(),L("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:mt(H.id)+" - Cliquez pour ouvrir la sélection",onClick:Lt(Cn=>as(H),["stop"])},m[81]||(m[81]=[h("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,aF)):G(H.id).type==="ready"?(M(),L("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:mt(H.id)+" - Cliquez pour ouvrir la sélection",onClick:Lt(Cn=>as(H),["stop"])},m[82]||(m[82]=[h("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,lF)):le("",!0)],8,rF))),128))],4)]),m[85]||(m[85]=h("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),h("button",{onClick:Pr,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:$r.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":$r.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(M(),L("svg",cF,[m[83]||(m[83]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[84]||(m[84]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),$r.value?le("",!0):(M(),L("path",dF))]))],8,uF),ct(h("button",{onClick:m[5]||(m[5]=Lt(H=>ol(-1,H),["prevent"])),onMousedown:m[6]||(m[6]=Lt(H=>js(-1,H),["prevent"])),onMouseup:m[7]||(m[7]=H=>or(H)),onMouseleave:m[8]||(m[8]=H=>or(H)),onTouchstart:m[9]||(m[9]=Lt(H=>js(-1,H),["prevent"])),onTouchend:m[10]||(m[10]=H=>or(H)),onTouchcancel:m[11]||(m[11]=H=>or(H)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Gh,Fs.value]]),ct(h("button",{onClick:m[12]||(m[12]=Lt(H=>ol(1,H),["prevent"])),onMousedown:m[13]||(m[13]=Lt(H=>js(1,H),["prevent"])),onMouseup:m[14]||(m[14]=H=>or(H)),onMouseleave:m[15]||(m[15]=H=>or(H)),onTouchstart:m[16]||(m[16]=Lt(H=>js(1,H),["prevent"])),onTouchend:m[17]||(m[17]=H=>or(H)),onTouchcancel:m[18]||(m[18]=H=>or(H)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Gh,nc.value]])])],512),ct(h("div",{ref_key:"gridboardRef",ref:Rn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Ee.value===1?(M(),L("div",hF,[P.value.position?(M(),L("div",{key:0,class:"fixed z-[400]",style:Xs({left:P.value.position.x+"px",top:P.value.position.y+"px"})},[h("div",{id:"coachmark-add",class:Hn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":P.value.side==="right","coachmark-left":P.value.side==="left"}])},[m[87]||(m[87]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[88]||(m[88]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),h("div",fF,[m[86]||(m[86]=h("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),h("button",{onClick:m[19]||(m[19]=H=>ss(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):le("",!0)])):le("",!0),Ee.value===2&&B.value&&F.value?(M(),L("div",pF,[q.value.position?(M(),L("div",{key:0,class:"fixed z-[400]",style:Xs({position:"absolute",left:q.value.position.x+"px",top:q.value.position.y+"px"})},[h("div",mF,[m[90]||(m[90]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[91]||(m[91]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),h("div",gF,[m[89]||(m[89]=h("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),h("button",{onClick:m[20]||(m[20]=H=>ss(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):le("",!0)])):le("",!0),Ee.value===3&&B.value?(M(),L("div",vF,[X.value.position?(M(),L("div",{key:0,class:"fixed z-[400]",style:Xs({position:"absolute",left:X.value.position.x+"px",top:X.value.position.y+"px"})},[h("div",yF,[m[93]||(m[93]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[94]||(m[94]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),h("div",_F,[m[92]||(m[92]=h("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),h("button",{onClick:m[21]||(m[21]=H=>ss(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):le("",!0)])):le("",!0),h("table",bF,[h("colgroup",null,[m[95]||(m[95]=h("col",{class:"col-left"},null,-1)),(M(!0),L(It,null,dr(Jn.value,(H,Cn)=>(M(),L("col",{key:"c"+Cn,class:"col-event"}))),128)),m[96]||(m[96]=h("col",{class:"col-right"},null,-1))]),m[100]||(m[100]=h("thead",{class:"hidden"},null,-1)),h("tbody",null,[(M(!0),L(It,null,dr(qs.value,H=>{var Cn;return M(),L("tr",{key:H.id,class:Hn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":H.id===V.value,"preferred-player":H.id===Fr.value}]),"data-player-id":H.id},[h("td",IF,[h("div",EF,[Mi(H.id)?(M(),L("span",TF," 🔒 ")):le("",!0),h("span",{onClick:us=>u(H),class:Hn(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Ee.value===3&&H.id===(B.value||((Cn=qs.value[0])==null?void 0:Cn.id))}]),title:"Cliquez pour voir les détails : "+H.name},ie(H.name),11,xF)])]),(M(!0),L(It,null,dr(Jn.value,us=>{var ag,lg,ug;return M(),L("td",{key:us.id,"data-event-id":us.id,class:Hn(["p-0",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Ee.value===2&&H.id===(B.value||((ag=qs.value[0])==null?void 0:ag.id))&&us.id===(F.value||((lg=Jn.value[0])==null?void 0:lg.id))}])},[dt(Yy,{"player-name":H.name,"event-id":us.id,"is-available":Yn(H.name,us.id),"is-selected":Vo(H.name,us.id),"chance-percent":((ug=ko.value[H.name])==null?void 0:ug[us.id])??null,"show-selected-chance":hl(us.id),onToggle:Do},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])],10,AF)}),128)),m[97]||(m[97]=h("td",{class:"p-3 md:p-4"},null,-1))],10,wF)}),128)),h("tr",SF,[h("td",PF,[h("div",RF,[h("button",{onClick:m[22]||(m[22]=H=>R.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[98]||(m[98]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),h("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(M(!0),L(It,null,dr(Jn.value,H=>(M(),L("td",{key:"add-row-"+H.id,"data-event-id":H.id,class:"p-3 md:p-5"},null,8,CF))),128)),m[99]||(m[99]=h("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Gh,!Qn.value]])])]),Qn.value?(M(),L("div",kF,[h("div",DF,[m[101]||(m[101]=h("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("p",VF,ie(xr.value)+"…",1),h("div",NF,[h("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Xs({width:Tr.value+"%"})},null,4)]),h("p",OF,ie(Tr.value)+"%",1)])])):le("",!0),Qn.value?le("",!0):(M(),Sp(aL,{key:1,"season-id":o.value,"season-slug":_s(s),"players-count":Ye.value.length,"events-count":Ge.value.length,"onboarding-done":((D=a.value)==null?void 0:D.onboardingCreatorDone)===!0,onCreateEvent:uc,onAddPlayer:m[23]||(m[23]=()=>{R.value=!0}),onCopyLink:Vh,onDismissed:rl},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),le("",!0),Le.value?(M(),L("div",MF,[h("div",LF,[m[102]||(m[102]=h("span",{class:"text-xl"},"✨",-1)),h("span",null,ie(ft.value),1)])])):le("",!0),vr.value?(M(),L("div",FF,[h("div",$F,[m[103]||(m[103]=h("span",{class:"text-xl"},"⚠️",-1)),h("span",null,ie(Bs.value),1)])])):le("",!0),ns.value?(M(),L("div",UF,[h("div",jF,[m[109]||(m[109]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),h("div",BF,[m[104]||(m[104]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ct(h("input",{"onUpdate:modelValue":m[24]||(m[24]=H=>Sr.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Ct,Sr.value]])]),h("div",qF,[m[105]||(m[105]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ct(h("input",{"onUpdate:modelValue":m[25]||(m[25]=H=>rs.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Ct,rs.value]])]),h("div",zF,[m[106]||(m[106]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ct(h("textarea",{"onUpdate:modelValue":m[26]||(m[26]=H=>pt.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Ct,pt.value]])]),h("div",GF,[ct(h("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[27]||(m[27]=H=>Mr.value=H),class:"w-4 h-4"},null,512),[[ud,Mr.value]]),m[107]||(m[107]=h("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),h("div",KF,[m[108]||(m[108]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ct(h("input",{"onUpdate:modelValue":m[28]||(m[28]=H=>Or.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Ct,Or.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:lc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Li,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):le("",!0),R.value?(M(),L("div",HF,[h("div",WF,[m[111]||(m[111]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),h("div",QF,[m[110]||(m[110]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),ct(h("input",{"onUpdate:modelValue":m[29]||(m[29]=H=>x.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Ct,x.value]])]),h("div",JF,[h("button",{onClick:m[30]||(m[30]=H=>R.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ts,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):le("",!0),l.value?(M(),L("div",YF,[h("div",XF,[m[112]||(m[112]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),h("div",ZF,[h("button",{onClick:ac,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:m[31]||(m[31]=()=>oc()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):le("",!0),Lo.value?(M(),L("div",e4,[h("div",t4,[m[113]||(m[113]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),h("div",n4,[h("button",{onClick:fc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:m[32]||(m[32]=()=>Ui()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):le("",!0),pe.value?(M(),L("div",r4,[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[m[114]||(m[114]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:pc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:Fo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):le("",!0),S.value?(M(),L("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Bo},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[42]||(m[42]=Lt(()=>{},["stop"]))},[h("div",s4,[h("button",{onClick:Bo,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),m[115]||(m[115]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),h("h2",i4,ie((Q=O.value)==null?void 0:Q.title),1),h("p",o4,ie(Fi((ne=O.value)==null?void 0:ne.date)),1)]),h("div",a4,[(_e=O.value)!=null&&_e.description?(M(),L("div",l4,[h("p",u4,ie(O.value.description),1)])):le("",!0),h("div",c4,[h("div",d4,[h("div",h4,ie(No((he=O.value)==null?void 0:he.id)),1),m[116]||(m[116]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",f4,[h("div",p4,ie(Oo((Me=O.value)==null?void 0:Me.id)),1),m[117]||(m[117]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",m4,[h("div",g4,ie(((qe=O.value)==null?void 0:qe.playerCount)||6),1),m[118]||(m[118]=h("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),O.value?(M(),L("div",v4,[m[120]||(m[120]=h("h3",{class:"text-lg font-semibold text-white mb-3"},"Disponibilités des joueurs",-1)),h("div",y4,[m[119]||(m[119]=h("div",{class:"grid grid-cols-12 gap-0 bg-gray-700 border-b border-gray-600"},[h("div",{class:"col-span-4 p-3 font-medium text-gray-300"},"Joueur"),h("div",{class:"col-span-8 p-3 font-medium text-gray-300 text-center"},"Disponibilité")],-1)),(M(!0),L(It,null,dr(qs.value,H=>{var Cn;return M(),L("div",{key:H.id,class:"grid grid-cols-12 gap-0 border-b border-gray-600 last:border-b-0 hover:bg-gray-700/50 transition-colors"},[h("div",_4,[h("span",{class:"font-medium text-white block truncate max-w-full flex-1 min-w-0",title:H.name},ie(H.name),9,b4),Mi(H.id)?(M(),L("span",w4,"🔒")):le("",!0)]),h("div",I4,[dt(Yy,{"player-name":H.name,"event-id":O.value.id,"is-available":Xn(O.value.id)[H.name],"is-selected":zn(H.name,O.value.id),"chance-percent":((Cn=ko.value[H.name])==null?void 0:Cn[O.value.id])??null,"show-selected-chance":hl(O.value.id),onToggle:qo},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance"])])])}),128))])])):le("",!0),h("div",E4,[h("button",{onClick:_l,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},m[121]||(m[121]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[33]||(m[33]=H=>nt(O.value)),disabled:(rt=O.value)==null?void 0:rt.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(xt=O.value)!=null&&xt.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[122]||(m[122]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,T4),h("button",{onClick:is,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(gt=O.value)!=null&&gt.archived?"Désarchiver cet événement":"Archiver cet événement"},[h("span",null,ie((Ot=O.value)!=null&&Ot.archived?"📂":"📁"),1),h("span",null,ie((Mt=O.value)!=null&&Mt.archived?"Désarchiver":"Archiver"),1)],8,x4),h("button",{onClick:m[34]||(m[34]=H=>as(O.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[123]||(m[123]=[h("span",null,"🎭",-1),h("span",null,"Sélectionner",-1)])),h("button",{onClick:m[35]||(m[35]=H=>{var Cn;return ic((Cn=O.value)==null?void 0:Cn.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},m[124]||(m[124]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:yl,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),ee.value?(M(),L("div",A4,[h("button",{onClick:m[36]||(m[36]=H=>{_l(),ee.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),h("button",{onClick:m[37]||(m[37]=H=>{nt(O.value),ee.value=!1}),disabled:(at=O.value)==null?void 0:at.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(lr=O.value)!=null&&lr.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[125]||(m[125]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,S4),h("button",{onClick:m[38]||(m[38]=H=>{is(),ee.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},ie((ls=O.value)!=null&&ls.archived?"📂 Désarchiver":"📁 Archiver"),1),h("button",{onClick:m[39]||(m[39]=H=>{var Cn;ic((Cn=O.value)==null?void 0:Cn.id),ee.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):le("",!0)]),h("div",P4,[h("button",{onClick:m[40]||(m[40]=H=>as(O.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),h("button",{onClick:yl,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),h("button",{onClick:m[41]||(m[41]=H=>ee.value=!ee.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):le("",!0),dt(ng,{show:ve.value,player:de.value,seasonId:o.value,onClose:m[43]||(m[43]=H=>ve.value=!1),onVerified:wc},null,8,["show","player","seasonId"]),d.value?(M(),L("div",R4,[h("div",C4,[m[131]||(m[131]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),h("div",k4,[m[126]||(m[126]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),ct(h("input",{"onUpdate:modelValue":m[44]||(m[44]=H=>f.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Dn(Bn,["esc"]),Dn(ll,["enter"])],ref:"editTitleInput"},null,544),[[Ct,f.value]])]),h("div",D4,[m[127]||(m[127]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),ct(h("input",{"onUpdate:modelValue":m[45]||(m[45]=H=>g.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Dn(Bn,["esc"]),Dn(ll,["enter"])]},null,544),[[Ct,g.value]])]),h("div",V4,[m[128]||(m[128]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),ct(h("textarea",{"onUpdate:modelValue":m[46]||(m[46]=H=>Z.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Dn(Bn,["esc"])},null,544),[[Ct,Z.value]])]),h("div",N4,[ct(h("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[47]||(m[47]=H=>J.value=H),class:"w-4 h-4"},null,512),[[ud,J.value]]),m[129]||(m[129]=h("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),h("div",O4,[m[130]||(m[130]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),ct(h("input",{"onUpdate:modelValue":m[48]||(m[48]=H=>y.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Dn(Bn,["esc"])},null,544),[[Ct,y.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Bn,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ll,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):le("",!0),dt(zI,{show:k.value,message:$o(),error:A.value,"session-info":_c(),onSubmit:Bi,onCancel:gc},null,8,["show","message","error","session-info"]),Vt.value?(M(),L("div",M4,[h("div",L4,[m[133]||(m[133]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",F4,[h("div",$4,[h("div",null,[m[132]||(m[132]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ct(h("input",{"onUpdate:modelValue":m[49]||(m[49]=H=>$e.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[50]||(m[50]=Dn(H=>ml($e.value),["enter"])),ref_key:"playerPasswordInputRef",ref:De},null,544),[[Ct,$e.value]])])]),h("button",{onClick:m[51]||(m[51]=H=>ml($e.value)),disabled:!$e.value||Ue.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ue.value?(M(),L("span",j4,"⏳")):(M(),L("span",B4,"🔓")),h("span",null,ie(Ue.value?"Vérification...":"Vérifier et supprimer"),1)],8,U4)]),h("div",q4,[h("button",{onClick:m[52]||(m[52]=H=>Ae.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),tt.value?(M(),L("div",z4,[h("div",G4,ie(tt.value),1)])):le("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:gl,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):le("",!0),te.value?(M(),L("div",K4,[h("div",H4,[m[136]||(m[136]=cr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",W4,[h("div",Q4,[h("div",null,[m[134]||(m[134]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),ct(h("input",{"onUpdate:modelValue":m[53]||(m[53]=H=>Y.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[54]||(m[54]=Dn(H=>Uo(Y.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Je},null,544),[[Ct,Y.value]])])]),h("div",J4,[h("button",{onClick:m[55]||(m[55]=H=>Ze.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),W.value?(M(),L("div",Y4,[h("div",X4,ie(W.value),1)])):le("",!0)]),h("div",Z4,[h("button",{onClick:vc,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),h("button",{onClick:m[56]||(m[56]=H=>Uo(Y.value)),disabled:!Y.value||Ne.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Ne.value?(M(),L("span",t3,"⏳")):(M(),L("span",n3,"🔓")),h("span",null,[On(ie(Ne.value?"Vérification...":"Vérifier"),1),m[135]||(m[135]=h("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,e3)])])])):le("",!0),Ze.value?(M(),L("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[59]||(m[59]=H=>Ze.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[58]||(m[58]=Lt(()=>{},["stop"]))},[m[138]||(m[138]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),h("div",r3,[m[137]||(m[137]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:jo,disabled:K.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[K.value?(M(),L("span",i3,"⏳")):(M(),L("span",o3,"📧")),h("span",null,ie(K.value?"Envoi...":"Envoyer l'email"),1)],8,s3)]),be.value?(M(),L("div",a3,[h("div",l3,ie(be.value),1)])):le("",!0),ce.value?(M(),L("div",u3,[h("div",c3,ie(ce.value),1)])):le("",!0),h("div",d3,[h("button",{onClick:m[57]||(m[57]=H=>Ze.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):le("",!0),Ae.value?(M(),L("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[62]||(m[62]=H=>Ae.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[61]||(m[61]=Lt(()=>{},["stop"]))},[m[140]||(m[140]=cr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),h("div",h3,[m[139]||(m[139]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:yc,disabled:We.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[We.value?(M(),L("span",p3,"⏳")):(M(),L("span",m3,"📧")),h("span",null,ie(We.value?"Envoi...":"Envoyer l'email"),1)],8,f3)]),ut.value?(M(),L("div",g3,[h("div",v3,ie(ut.value),1)])):le("",!0),E.value?(M(),L("div",y3,[h("div",_3,ie(E.value),1)])):le("",!0),h("div",b3,[h("button",{onClick:m[60]||(m[60]=H=>Ae.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):le("",!0),dt(dM,{ref_key:"playerModalRef",ref:C,show:w.value,player:I.value,stats:U(I.value),seasonId:o.value,"onboarding-step":Ee.value,"onboarding-player-id":B.value,onClose:p,onUpdate:v,onDelete:pl,onRefresh:b,onAdvanceOnboarding:m[63]||(m[63]=H=>{try{typeof Ee.value<"u"&&(Ee.value.value=H)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),dt(WM,{ref_key:"selectionModalRef",ref:Oe,show:Te.value,event:Re.value,"current-selection":ht.value[(zi=Re.value)==null?void 0:zi.id]||[],"available-count":No((zo=Re.value)==null?void 0:zo.id),"selected-count":Oo((ig=Re.value)==null?void 0:ig.id),"player-availability":Xn((og=Re.value)==null?void 0:og.id),"season-id":o.value,"season-slug":_s(s),players:ln.value,onClose:qi,onSelection:pE,onPerfect:mE,onSendEmailNotifications:os,onUpdateSelection:gE},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),dt(hE,{show:Be.value,event:Xe.value,"season-id":o.value,"season-slug":_s(s),players:ln.value,onClose:cn,onSendEmailNotifications:os},null,8,["show","event","season-id","season-slug","players"]),dt(GI,{show:gn.value,onClose:m[64]||(m[64]=H=>gn.value=!1)},null,8,["show"]),dt(NL,{show:Nt.value,"season-id":o.value,onClose:Pn,onManagePlayer:ki,onChangePassword:nl,onLogoutDevice:Zu,onDeleteAccount:ec},null,8,["show","season-id"]),dt(fE,{show:mr.value,player:nn.value,"season-id":o.value,onClose:m[65]||(m[65]=H=>mr.value=!1),onSuccess:m[66]||(m[66]=()=>{mr.value=!1,Nt.value=!0})},null,8,["show","player","season-id"]),dt(BL,{show:Vr.value,onClose:m[67]||(m[67]=H=>Vr.value=!1),onSuccess:m[68]||(m[68]=()=>{Vr.value=!1,Nt.value=!0})},null,8,["show"]),Wt.value?(M(),L("div",w3,[h("div",I3,[m[141]||(m[141]=h("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[142]||(m[142]=h("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),h("div",E3,[h("button",{onClick:m[69]||(m[69]=H=>nt(Bt.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),h("button",{onClick:dn,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):le("",!0)],64)}}},T3={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},x3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},A3={key:0,class:"text-center py-8"},S3={key:1,class:"text-center py-8"},P3={class:"text-gray-300 mb-6"},R3={key:2,class:"space-y-6"},C3={class:"text-center"},k3={class:"text-gray-300"},D3={class:"font-semibold text-white"},V3={class:"space-y-4"},N3=["disabled"],O3={key:0,class:"animate-spin"},M3={key:1},L3={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},F3={class:"text-red-300 text-sm"},$3={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},U3={class:"text-green-300 text-sm"},j3={__name:"PasswordReset",setup(n){const e=Fa(),t=Ru(),r=N(!0),s=N(""),i=N(""),o=N(""),a=N(""),l=N(""),c=N(!1),d=N(""),f=N(""),g=ze(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);yr(async()=>{try{const{oobCode:x}=e.query;if(ge.debug("Token reçu (masqué)"),!x){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=x,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(x){ge.error("Erreur lors de la vérification du lien",x),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,d.value="",f.value="";try{ge.debug("Début réinitialisation avec token (masqué)"),await fD(_n,o.value,a.value),ge.info("Mot de passe Firebase Auth mis à jour"),ge.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{R()},3e3)}catch(x){ge.error("Erreur lors de la réinitialisation",x),x.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":x.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function R(){t.push("/")}return(x,V)=>(M(),L("div",T3,[h("div",x3,[V[8]||(V[8]=cr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(M(),L("div",A3,V[2]||(V[2]=[h("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),h("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(M(),L("div",S3,[V[3]||(V[3]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"❌")],-1)),V[4]||(V[4]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),h("p",P3,ie(s.value),1),h("button",{onClick:R,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(M(),L("div",R3,[h("div",C3,[h("p",k3,[V[5]||(V[5]=On("Email : ")),h("span",D3,ie(i.value),1)])]),h("div",V3,[h("div",null,[V[6]||(V[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),ct(h("input",{"onUpdate:modelValue":V[0]||(V[0]=B=>a.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Dn(y,["enter"])},null,544),[[Ct,a.value]])]),h("div",null,[V[7]||(V[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),ct(h("input",{"onUpdate:modelValue":V[1]||(V[1]=B=>l.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Dn(y,["enter"])},null,544),[[Ct,l.value]])])]),h("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(M(),L("span",O3,"⏳")):(M(),L("span",M3,"🔑")),h("span",null,ie(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,N3),d.value?(M(),L("div",L3,[h("div",F3,ie(d.value),1)])):le("",!0),f.value?(M(),L("div",$3,[h("div",U3,ie(f.value),1)])):le("",!0)])):le("",!0)])]))}},B3={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},q3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},z3={class:"text-3xl"},G3={class:"text-2xl font-bold text-white mb-2"},K3={class:"text-gray-300 mb-6"},H3={__name:"MagicLink",setup(n){const e=Fa(),t=Ru(),r=N("loading"),s=N("Traitement en cours..."),i=N("Merci de patienter pendant la validation du lien."),o=ze(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return yr(async()=>{try{uE("firebase");const l=String(e.query.sid||""),c=String(e.query.pid||"");let d=String(e.query.eid||"");const f=String(e.query.t||""),g=String(e.query.a||""),y=String(e.query.slug||"");if(!f||!g){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(g==="account_email_update"){const P=await YI({token:f});if(!P.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await _D(_n.currentUser,P.data.newEmail),await XI({token:f}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(g==="verify_email"&&(d="protection"),!(await QI({seasonId:l,playerId:c,eventId:d,token:f,action:g})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(g==="verify_email"){await tE({playerId:c,seasonId:l});try{await aE({playerId:c,seasonId:l})}catch{}await up({seasonId:l,playerId:c,eventId:"protection",action:g}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(y?()=>t.push(`/season/${y}?player=${encodeURIComponent(c)}&open=protection&verified=1`):()=>t.push("/"),800);return}const x=Se(ae,"seasons",l,"players",c),V=await Sn(x),B=V.exists()&&V.data().name||"";if(!B){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await mN({seasonId:l,playerName:B,eventId:d,value:g==="yes"}),await up({seasonId:l,playerId:c,eventId:d,action:g}),r.value="ok",s.value="Merci !",i.value=g==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(y?()=>t.push(`/season/${y}/event/${d}`):()=>t.push("/"),1200)}catch(l){ge.error("Magic link error",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(M(),L("div",B3,[h("div",q3,[h("div",{class:Hn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[h("span",z3,ie(o.value),1)],2),h("h1",G3,ie(s.value),1),h("p",K3,ie(i.value),1),h("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},W3={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},Q3={class:"text-center py-12 px-4"},J3={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},Y3={class:"container mx-auto px-4 pb-16"},X3={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},Z3={class:"space-y-5"},e6=["onKeydown"],t6={class:"flex items-center justify-end gap-3 pt-2"},n6=["disabled"],r6={key:0,class:"mt-6 text-sm text-gray-200"},s6={__name:"JoinSeason",setup(n){const e=Fa(),t=Ru(),r=e.params.slug,s=N(""),i=N(""),o=N(""),a=N(!1),l=N("");yr(async()=>{const f=_u(Qe(ae,"seasons"),Ad("slug","==",r)),g=await bt(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await cE(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){ge.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(M(),L("div",W3,[h("div",Q3,[h("h1",J3,ie(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=h("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),h("div",Y3,[h("div",X3,[g[3]||(g[3]=h("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),h("div",Z3,[h("div",null,[g[2]||(g[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),ct(h("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Dn(Lt(d,["prevent"]),["enter"])},null,40,e6),[[Ct,o.value]])]),h("div",t6,[h("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,n6)])]),l.value?(M(),L("div",r6,ie(l.value),1)):le("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const i6=[{path:"/",component:rN},{path:"/season/:slug",component:Xy,props:!0},{path:"/season/:slug/event/:eventId",component:Xy,props:!0},{path:"/season/:slug/join",component:s6,props:!0},{path:"/reset-password",component:j3},{path:"/magic",component:H3}],o6=BA({history:vA("/"),routes:i6});Lx(Ux).use(o6).mount("#app");export{Qe as $,Ww as A,_o as B,Wr as C,tn as D,d$ as E,wo as F,bm as G,c$ as H,d6 as I,wr as J,kC as K,VC as L,_h as M,L6 as N,F6 as O,rk as P,An as Q,P6 as R,g6 as S,Kt as T,n$ as U,ch as V,tk as W,t$ as X,M6 as Y,_6 as Z,F0 as _,gu as a,Ju as a$,p6 as a0,DC as a1,zC as a2,u$ as a3,Ma as a4,e$ as a5,I6 as a6,l$ as a7,Se as a8,A6 as a9,x6 as aA,z6 as aB,G6 as aC,S6 as aD,BC as aE,J6 as aF,Y6 as aG,ZC as aH,_u as aI,Nw as aJ,m6 as aK,Z6 as aL,Ku as aM,fn as aN,i$ as aO,a6 as aP,$6 as aQ,D6 as aR,k6 as aS,O6 as aT,E6 as aU,Ya as aV,s$ as aW,b6 as aX,Ad as aY,km as aZ,v$ as a_,OC as aa,y6 as ab,w6 as ac,a$ as ad,N6 as ae,V6 as af,Ht as ag,Gu as ah,KC as ai,K6 as aj,Sn as ak,U6 as al,j6 as am,bt as an,B6 as ao,q6 as ap,NC as aq,o$ as ar,r$ as as,v6 as at,R6 as au,C6 as av,T6 as aw,H6 as ax,Q6 as ay,W6 as az,MC as b,lD as b$,Qu as b0,_$ as b1,Eu as b2,xo as b3,ni as b4,f$ as b5,si as b6,ri as b7,Ps as b8,Yc as b9,gk as bA,B$ as bB,tU as bC,Cy as bD,WD as bE,Lk as bF,O$ as bG,S$ as bH,uD as bI,K$ as bJ,Y$ as bK,eU as bL,q$ as bM,L$ as bN,AD as bO,w$ as bP,ik as bQ,cD as bR,H$ as bS,J$ as bT,Z$ as bU,_k as bV,U$ as bW,C$ as bX,hD as bY,A$ as bZ,N$ as b_,g$ as ba,ao as bb,ma as bc,Y2 as bd,p$ as be,z$ as bf,sp as bg,m$ as bh,X2 as bi,Xm as bj,ii as bk,T$ as bl,SD as bm,MD as bn,J2 as bo,RI as bp,pD as bq,fD as br,$k as bs,mD as bt,y$ as bu,j$ as bv,R$ as bw,V$ as bx,iV as by,b$ as bz,Na as c,jm as c0,E$ as c1,gD as c2,P$ as c3,G$ as c4,Q$ as c5,X$ as c6,PD as c7,I$ as c8,$$ as c9,_D as ca,bD as cb,W$ as cc,D$ as cd,F$ as ce,M$ as cf,k$ as cg,x$ as ch,Io as d,St as e,se as f,Ja as g,qu as h,Wc as i,vh as j,zu as k,mh as l,Rm as m,Oa as n,gh as o,no as p,nk as q,Qt as r,co as s,Ie as t,u6 as u,TP as v,zt as w,h$ as x,et as y,l6 as z};
