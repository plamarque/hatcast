(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function cf(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const dt={},uo=[],or=()=>{},tI=()=>!1,Au=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),uf=n=>n.startsWith("onUpdate:"),ln=Object.assign,df=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},nI=Object.prototype.hasOwnProperty,ot=(n,e)=>nI.call(n,e),Ce=Array.isArray,ho=n=>Sl(n)==="[object Map]",xu=n=>Sl(n)==="[object Set]",pm=n=>Sl(n)==="[object Date]",je=n=>typeof n=="function",Qt=n=>typeof n=="string",Cr=n=>typeof n=="symbol",_t=n=>n!==null&&typeof n=="object",nv=n=>(_t(n)||je(n))&&je(n.then)&&je(n.catch),rv=Object.prototype.toString,Sl=n=>rv.call(n),rI=n=>Sl(n).slice(8,-1),sv=n=>Sl(n)==="[object Object]",hf=n=>Qt(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Ua=cf(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Pu=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},sI=/-(\w)/g,Xn=Pu(n=>n.replace(sI,(e,t)=>t?t.toUpperCase():"")),iI=/\B([A-Z])/g,js=Pu(n=>n.replace(iI,"-$1").toLowerCase()),Su=Pu(n=>n.charAt(0).toUpperCase()+n.slice(1)),Fd=Pu(n=>n?`on${Su(n)}`:""),Ss=(n,e)=>!Object.is(n,e),Rc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},_h=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},vh=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let mm;const Ru=()=>mm||(mm=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Cu(n){if(Ce(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Qt(r)?cI(r):Cu(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Qt(n)||_t(n))return n}const oI=/;(?![^(]*\))/g,aI=/:([^]+)/,lI=/\/\*[^]*?\*\//g;function cI(n){const e={};return n.replace(lI,"").split(oI).forEach(t=>{if(t){const r=t.split(aI);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function ar(n){let e="";if(Qt(n))e=n;else if(Ce(n))for(let t=0;t<n.length;t++){const r=ar(n[t]);r&&(e+=r+" ")}else if(_t(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const uI="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",dI=cf(uI);function iv(n){return!!n||n===""}function hI(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=ku(n[r],e[r]);return t}function ku(n,e){if(n===e)return!0;let t=pm(n),r=pm(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Cr(n),r=Cr(e),t||r)return n===e;if(t=Ce(n),r=Ce(e),t||r)return t&&r?hI(n,e):!1;if(t=_t(n),r=_t(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!ku(n[o],e[o]))return!1}}return String(n)===String(e)}function ov(n,e){return n.findIndex(t=>ku(t,e))}const av=n=>!!(n&&n.__v_isRef===!0),ge=n=>Qt(n)?n:n==null?"":Ce(n)||_t(n)&&(n.toString===rv||!je(n.toString))?av(n)?ge(n.value):JSON.stringify(n,lv,2):String(n),lv=(n,e)=>av(e)?lv(n,e.value):ho(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Ud(r,i)+" =>"]=s,t),{})}:xu(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Ud(t))}:Cr(e)?Ud(e):_t(e)&&!Ce(e)&&!sv(e)?String(e):e,Ud=(n,e="")=>{var t;return Cr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Vn;class fI{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Vn,!e&&Vn&&(this.index=(Vn.scopes||(Vn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=Vn;try{return Vn=this,e()}finally{Vn=t}}}on(){++this._on===1&&(this.prevScope=Vn,Vn=this)}off(){this._on>0&&--this._on===0&&(Vn=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function pI(){return Vn}let gt;const Bd=new WeakSet;class cv{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Vn&&Vn.active&&Vn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Bd.has(this)&&(Bd.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||dv(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,gm(this),hv(this);const e=gt,t=lr;gt=this,lr=!0;try{return this.fn()}finally{fv(this),gt=e,lr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)mf(e);this.deps=this.depsTail=void 0,gm(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Bd.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){yh(this)&&this.run()}get dirty(){return yh(this)}}let uv=0,Ba,$a;function dv(n,e=!1){if(n.flags|=8,e){n.next=$a,$a=n;return}n.next=Ba,Ba=n}function ff(){uv++}function pf(){if(--uv>0)return;if($a){let e=$a;for($a=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Ba;){let e=Ba;for(Ba=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function hv(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function fv(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),mf(r),mI(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function yh(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(pv(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function pv(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===tl)||(n.globalVersion=tl,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!yh(n))))return;n.flags|=2;const e=n.dep,t=gt,r=lr;gt=n,lr=!0;try{hv(n);const s=n.fn(n._value);(e.version===0||Ss(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{gt=t,lr=r,fv(n),n.flags&=-3}}function mf(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)mf(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function mI(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let lr=!0;const mv=[];function Kr(){mv.push(lr),lr=!1}function Hr(){const n=mv.pop();lr=n===void 0?!0:n}function gm(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=gt;gt=void 0;try{e()}finally{gt=t}}}let tl=0;class gI{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class gf{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!gt||!lr||gt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==gt)t=this.activeLink=new gI(gt,this),gt.deps?(t.prevDep=gt.depsTail,gt.depsTail.nextDep=t,gt.depsTail=t):gt.deps=gt.depsTail=t,gv(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=gt.depsTail,t.nextDep=void 0,gt.depsTail.nextDep=t,gt.depsTail=t,gt.deps===t&&(gt.deps=r)}return t}trigger(e){this.version++,tl++,this.notify(e)}notify(e){ff();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{pf()}}}function gv(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)gv(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const wh=new WeakMap,_i=Symbol(""),bh=Symbol(""),nl=Symbol("");function wn(n,e,t){if(lr&&gt){let r=wh.get(n);r||wh.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new gf),s.map=r,s.key=t),s.track()}}function Ur(n,e,t,r,s,i){const o=wh.get(n);if(!o){tl++;return}const a=l=>{l&&l.trigger()};if(ff(),e==="clear")o.forEach(a);else{const l=Ce(n),u=l&&hf(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===nl||!Cr(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),u&&a(o.get(nl)),e){case"add":l?u&&a(o.get("length")):(a(o.get(_i)),ho(n)&&a(o.get(bh)));break;case"delete":l||(a(o.get(_i)),ho(n)&&a(o.get(bh)));break;case"set":ho(n)&&a(o.get(_i));break}}pf()}function Zi(n){const e=it(n);return e===n?e:(wn(e,"iterate",nl),Yn(n)?e:e.map(fn))}function Du(n){return wn(n=it(n),"iterate",nl),n}const _I={__proto__:null,[Symbol.iterator](){return $d(this,Symbol.iterator,fn)},concat(...n){return Zi(this).concat(...n.map(e=>Ce(e)?Zi(e):e))},entries(){return $d(this,"entries",n=>(n[1]=fn(n[1]),n))},every(n,e){return Or(this,"every",n,e,void 0,arguments)},filter(n,e){return Or(this,"filter",n,e,t=>t.map(fn),arguments)},find(n,e){return Or(this,"find",n,e,fn,arguments)},findIndex(n,e){return Or(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Or(this,"findLast",n,e,fn,arguments)},findLastIndex(n,e){return Or(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Or(this,"forEach",n,e,void 0,arguments)},includes(...n){return jd(this,"includes",n)},indexOf(...n){return jd(this,"indexOf",n)},join(n){return Zi(this).join(n)},lastIndexOf(...n){return jd(this,"lastIndexOf",n)},map(n,e){return Or(this,"map",n,e,void 0,arguments)},pop(){return ya(this,"pop")},push(...n){return ya(this,"push",n)},reduce(n,...e){return _m(this,"reduce",n,e)},reduceRight(n,...e){return _m(this,"reduceRight",n,e)},shift(){return ya(this,"shift")},some(n,e){return Or(this,"some",n,e,void 0,arguments)},splice(...n){return ya(this,"splice",n)},toReversed(){return Zi(this).toReversed()},toSorted(n){return Zi(this).toSorted(n)},toSpliced(...n){return Zi(this).toSpliced(...n)},unshift(...n){return ya(this,"unshift",n)},values(){return $d(this,"values",fn)}};function $d(n,e,t){const r=Du(n),s=r[e]();return r!==n&&!Yn(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const vI=Array.prototype;function Or(n,e,t,r,s,i){const o=Du(n),a=o!==n&&!Yn(n),l=o[e];if(l!==vI[e]){const f=l.apply(n,i);return a?fn(f):f}let u=t;o!==n&&(a?u=function(f,g){return t.call(this,fn(f),g,n)}:t.length>2&&(u=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,u,r);return a&&s?s(d):d}function _m(n,e,t,r){const s=Du(n);let i=t;return s!==n&&(Yn(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,fn(a),l,n)}),s[e](i,...r)}function jd(n,e,t){const r=it(n);wn(r,"iterate",nl);const s=r[e](...t);return(s===-1||s===!1)&&yf(t[0])?(t[0]=it(t[0]),r[e](...t)):s}function ya(n,e,t=[]){Kr(),ff();const r=it(n)[e].apply(n,t);return pf(),Hr(),r}const yI=cf("__proto__,__v_isRef,__isVue"),_v=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Cr));function wI(n){Cr(n)||(n=String(n));const e=it(this);return wn(e,"has",n),e.hasOwnProperty(n)}class vv{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?CI:Iv:i?bv:wv).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ce(e);if(!s){let l;if(o&&(l=_I[t]))return l;if(t==="hasOwnProperty")return wI}const a=Reflect.get(e,t,In(e)?e:r);return(Cr(t)?_v.has(t):yI(t))||(s||wn(e,"get",t),i)?a:In(a)?o&&hf(t)?a:a.value:_t(a)?s?Tv(a):Vu(a):a}}class yv extends vv{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Ds(i);if(!Yn(r)&&!Ds(r)&&(i=it(i),r=it(r)),!Ce(e)&&In(i)&&!In(r))return l?!1:(i.value=r,!0)}const o=Ce(e)&&hf(t)?Number(t)<e.length:ot(e,t),a=Reflect.set(e,t,r,In(e)?e:s);return e===it(s)&&(o?Ss(r,i)&&Ur(e,"set",t,r):Ur(e,"add",t,r)),a}deleteProperty(e,t){const r=ot(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&Ur(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Cr(t)||!_v.has(t))&&wn(e,"has",t),r}ownKeys(e){return wn(e,"iterate",Ce(e)?"length":_i),Reflect.ownKeys(e)}}class bI extends vv{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const II=new yv,EI=new bI,TI=new yv(!0);const Ih=n=>n,_c=n=>Reflect.getPrototypeOf(n);function AI(n,e,t){return function(...r){const s=this.__v_raw,i=it(s),o=ho(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,u=s[n](...r),d=t?Ih:e?Wc:fn;return!e&&wn(i,"iterate",l?bh:_i),{next(){const{value:f,done:g}=u.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function vc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function xI(n,e){const t={get(s){const i=this.__v_raw,o=it(i),a=it(s);n||(Ss(s,a)&&wn(o,"get",s),wn(o,"get",a));const{has:l}=_c(o),u=e?Ih:n?Wc:fn;if(l.call(o,s))return u(i.get(s));if(l.call(o,a))return u(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&wn(it(s),"iterate",_i),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=it(i),a=it(s);return n||(Ss(s,a)&&wn(o,"has",s),wn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=it(a),u=e?Ih:n?Wc:fn;return!n&&wn(l,"iterate",_i),a.forEach((d,f)=>s.call(i,u(d),u(f),o))}};return ln(t,n?{add:vc("add"),set:vc("set"),delete:vc("delete"),clear:vc("clear")}:{add(s){!e&&!Yn(s)&&!Ds(s)&&(s=it(s));const i=it(this);return _c(i).has.call(i,s)||(i.add(s),Ur(i,"add",s,s)),this},set(s,i){!e&&!Yn(i)&&!Ds(i)&&(i=it(i));const o=it(this),{has:a,get:l}=_c(o);let u=a.call(o,s);u||(s=it(s),u=a.call(o,s));const d=l.call(o,s);return o.set(s,i),u?Ss(i,d)&&Ur(o,"set",s,i):Ur(o,"add",s,i),this},delete(s){const i=it(this),{has:o,get:a}=_c(i);let l=o.call(i,s);l||(s=it(s),l=o.call(i,s)),a&&a.call(i,s);const u=i.delete(s);return l&&Ur(i,"delete",s,void 0),u},clear(){const s=it(this),i=s.size!==0,o=s.clear();return i&&Ur(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=AI(s,n,e)}),t}function _f(n,e){const t=xI(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(ot(t,s)&&s in r?t:r,s,i)}const PI={get:_f(!1,!1)},SI={get:_f(!1,!0)},RI={get:_f(!0,!1)};const wv=new WeakMap,bv=new WeakMap,Iv=new WeakMap,CI=new WeakMap;function kI(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function DI(n){return n.__v_skip||!Object.isExtensible(n)?0:kI(rI(n))}function Vu(n){return Ds(n)?n:vf(n,!1,II,PI,wv)}function Ev(n){return vf(n,!1,TI,SI,bv)}function Tv(n){return vf(n,!0,EI,RI,Iv)}function vf(n,e,t,r,s){if(!_t(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=DI(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function fo(n){return Ds(n)?fo(n.__v_raw):!!(n&&n.__v_isReactive)}function Ds(n){return!!(n&&n.__v_isReadonly)}function Yn(n){return!!(n&&n.__v_isShallow)}function yf(n){return n?!!n.__v_raw:!1}function it(n){const e=n&&n.__v_raw;return e?it(e):n}function VI(n){return!ot(n,"__v_skip")&&Object.isExtensible(n)&&_h(n,"__v_skip",!0),n}const fn=n=>_t(n)?Vu(n):n,Wc=n=>_t(n)?Tv(n):n;function In(n){return n?n.__v_isRef===!0:!1}function q(n){return Av(n,!1)}function NI(n){return Av(n,!0)}function Av(n,e){return In(n)?n:new OI(n,e)}class OI{constructor(e,t){this.dep=new gf,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:it(e),this._value=t?e:fn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Yn(e)||Ds(e);e=r?e:it(e),Ss(e,t)&&(this._rawValue=e,this._value=r?e:fn(e),this.dep.trigger())}}function po(n){return In(n)?n.value:n}const MI={get:(n,e,t)=>e==="__v_raw"?n:po(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return In(s)&&!In(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function xv(n){return fo(n)?n:new Proxy(n,MI)}class LI{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new gf(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=tl-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&gt!==this)return dv(this,!0),!0}get value(){const e=this.dep.track();return pv(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function FI(n,e,t=!1){let r,s;return je(n)?r=n:(r=n.get,s=n.set),new LI(r,s,t)}const yc={},Qc=new WeakMap;let oi;function UI(n,e=!1,t=oi){if(t){let r=Qc.get(t);r||Qc.set(t,r=[]),r.push(n)}}function BI(n,e,t=dt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,u=j=>s?j:Yn(j)||s===!1||s===0?Br(j,1):Br(j);let d,f,g,_,C=!1,P=!1;if(In(n)?(f=()=>n.value,C=Yn(n)):fo(n)?(f=()=>u(n),C=!0):Ce(n)?(P=!0,C=n.some(j=>fo(j)||Yn(j)),f=()=>n.map(j=>{if(In(j))return j.value;if(fo(j))return u(j);if(je(j))return l?l(j,2):j()})):je(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Kr();try{g()}finally{Hr()}}const j=oi;oi=d;try{return l?l(n,3,[_]):n(_)}finally{oi=j}}:f=or,e&&s){const j=f,M=s===!0?1/0:s;f=()=>Br(j(),M)}const R=pI(),L=()=>{d.stop(),R&&R.active&&df(R.effects,d)};if(i&&e){const j=e;e=(...M)=>{j(...M),L()}}let U=P?new Array(n.length).fill(yc):yc;const $=j=>{if(!(!(d.flags&1)||!d.dirty&&!j))if(e){const M=d.run();if(s||C||(P?M.some((ae,T)=>Ss(ae,U[T])):Ss(M,U))){g&&g();const ae=oi;oi=d;try{const T=[M,U===yc?void 0:P&&U[0]===yc?[]:U,_];U=M,l?l(e,3,T):e(...T)}finally{oi=ae}}}else d.run()};return a&&a($),d=new cv(f),d.scheduler=o?()=>o($,!1):$,_=j=>UI(j,!1,d),g=d.onStop=()=>{const j=Qc.get(d);if(j){if(l)l(j,4);else for(const M of j)M();Qc.delete(d)}},e?r?$(!0):U=d.run():o?o($.bind(null,!0),!0):d.run(),L.pause=d.pause.bind(d),L.resume=d.resume.bind(d),L.stop=L,L}function Br(n,e=1/0,t){if(e<=0||!_t(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,In(n))Br(n.value,e,t);else if(Ce(n))for(let r=0;r<n.length;r++)Br(n[r],e,t);else if(xu(n)||ho(n))n.forEach(r=>{Br(r,e,t)});else if(sv(n)){for(const r in n)Br(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Br(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Rl(n,e,t,r){try{return r?n(...r):n()}catch(s){Nu(s,e,t)}}function kr(n,e,t,r){if(je(n)){const s=Rl(n,e,t,r);return s&&nv(s)&&s.catch(i=>{Nu(i,e,t)}),s}if(Ce(n)){const s=[];for(let i=0;i<n.length;i++)s.push(kr(n[i],e,t,r));return s}}function Nu(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||dt;if(e){let a=e.parent;const l=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,u)===!1)return}a=a.parent}if(i){Kr(),Rl(i,null,10,[n,l,u]),Hr();return}}$I(n,t,s,r,o)}function $I(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Rn=[];let wr=-1;const mo=[];let _s=null,so=0;const Pv=Promise.resolve();let Jc=null;function Er(n){const e=Jc||Pv;return n?e.then(this?n.bind(this):n):e}function jI(n){let e=wr+1,t=Rn.length;for(;e<t;){const r=e+t>>>1,s=Rn[r],i=rl(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function wf(n){if(!(n.flags&1)){const e=rl(n),t=Rn[Rn.length-1];!t||!(n.flags&2)&&e>=rl(t)?Rn.push(n):Rn.splice(jI(e),0,n),n.flags|=1,Sv()}}function Sv(){Jc||(Jc=Pv.then(Cv))}function qI(n){Ce(n)?mo.push(...n):_s&&n.id===-1?_s.splice(so+1,0,n):n.flags&1||(mo.push(n),n.flags|=1),Sv()}function vm(n,e,t=wr+1){for(;t<Rn.length;t++){const r=Rn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Rn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function Rv(n){if(mo.length){const e=[...new Set(mo)].sort((t,r)=>rl(t)-rl(r));if(mo.length=0,_s){_s.push(...e);return}for(_s=e,so=0;so<_s.length;so++){const t=_s[so];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}_s=null,so=0}}const rl=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Cv(n){const e=or;try{for(wr=0;wr<Rn.length;wr++){const t=Rn[wr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Rl(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;wr<Rn.length;wr++){const t=Rn[wr];t&&(t.flags&=-2)}wr=-1,Rn.length=0,Rv(),Jc=null,(Rn.length||mo.length)&&Cv()}}let zn=null,kv=null;function Yc(n){const e=zn;return zn=n,kv=n&&n.type.__scopeId||null,e}function zI(n,e=zn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Pm(-1);const i=Yc(e);let o;try{o=n(...s)}finally{Yc(i),r._d&&Pm(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function lt(n,e){if(zn===null)return n;const t=Fu(zn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=dt]=e[s];i&&(je(i)&&(i={mounted:i,updated:i}),i.deep&&Br(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function ri(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Kr(),kr(l,t,8,[n.el,a,n,e]),Hr())}}const GI=Symbol("_vte"),KI=n=>n.__isTeleport;function bf(n,e){n.shapeFlag&6&&n.component?(n.transition=e,bf(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function Dv(n,e){return je(n)?(()=>ln({name:n.name},e,{setup:n}))():n}function Vv(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function ja(n,e,t,r,s=!1){if(Ce(n)){n.forEach((C,P)=>ja(C,e&&(Ce(e)?e[P]:e),t,r,s));return}if(qa(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&ja(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Fu(r.component):r.el,o=s?null:i,{i:a,r:l}=n,u=e&&e.r,d=a.refs===dt?a.refs={}:a.refs,f=a.setupState,g=it(f),_=f===dt?()=>!1:C=>ot(g,C);if(u!=null&&u!==l&&(Qt(u)?(d[u]=null,_(u)&&(f[u]=null)):In(u)&&(u.value=null)),je(l))Rl(l,a,12,[o,d]);else{const C=Qt(l),P=In(l);if(C||P){const R=()=>{if(n.f){const L=C?_(l)?f[l]:d[l]:l.value;s?Ce(L)&&df(L,i):Ce(L)?L.includes(i)||L.push(i):C?(d[l]=[i],_(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else C?(d[l]=o,_(l)&&(f[l]=o)):P&&(l.value=o,n.k&&(d[n.k]=o))};o?(R.id=-1,jn(R,t)):R()}}}Ru().requestIdleCallback;Ru().cancelIdleCallback;const qa=n=>!!n.type.__asyncLoader,Nv=n=>n.type.__isKeepAlive;function HI(n,e){Ov(n,"a",e)}function WI(n,e){Ov(n,"da",e)}function Ov(n,e,t=bn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Ou(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Nv(s.parent.vnode)&&QI(r,e,t,s),s=s.parent}}function QI(n,e,t,r){const s=Ou(e,n,r,!0);If(()=>{df(r[e],s)},t)}function Ou(n,e,t=bn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Kr();const a=Cl(t),l=kr(e,t,n,o);return a(),Hr(),l});return r?s.unshift(i):s.push(i),i}}const es=n=>(e,t=bn)=>{(!il||n==="sp")&&Ou(n,(...r)=>e(...r),t)},JI=es("bm"),Ao=es("m"),YI=es("bu"),XI=es("u"),Mv=es("bum"),If=es("um"),ZI=es("sp"),eE=es("rtg"),tE=es("rtc");function nE(n,e=bn){Ou("ec",n,e)}const Lv="components";function rE(n,e){return iE(Lv,n,!0,e)||n}const sE=Symbol.for("v-ndc");function iE(n,e,t=!0,r=!1){const s=zn||bn;if(s){const i=s.type;if(n===Lv){const a=GE(i,!1);if(a&&(a===e||a===Xn(e)||a===Su(Xn(e))))return i}const o=ym(s[n]||i[n],e)||ym(s.appContext[n],e);return!o&&r?i:o}}function ym(n,e){return n&&(n[e]||n[Xn(e)]||n[Su(Xn(e))])}function Ir(n,e,t,r){let s;const i=t&&t[r],o=Ce(n);if(o||Qt(n)){const a=o&&fo(n);let l=!1,u=!1;a&&(l=!Yn(n),u=Ds(n),n=Du(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?u?Wc(fn(n[d])):fn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(_t(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,u=a.length;l<u;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const Eh=n=>n?ry(n)?Fu(n):Eh(n.parent):null,za=ln(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Eh(n.parent),$root:n=>Eh(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Ef(n),$forceUpdate:n=>n.f||(n.f=()=>{wf(n.update)}),$nextTick:n=>n.n||(n.n=Er.bind(n.proxy)),$watch:n=>xE.bind(n)}),qd=(n,e)=>n!==dt&&!n.__isScriptSetup&&ot(n,e),oE={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let u;if(e[0]!=="$"){const _=o[e];if(_!==void 0)switch(_){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(qd(r,e))return o[e]=1,r[e];if(s!==dt&&ot(s,e))return o[e]=2,s[e];if((u=n.propsOptions[0])&&ot(u,e))return o[e]=3,i[e];if(t!==dt&&ot(t,e))return o[e]=4,t[e];Th&&(o[e]=0)}}const d=za[e];let f,g;if(d)return e==="$attrs"&&wn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==dt&&ot(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,ot(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return qd(s,e)?(s[e]=t,!0):r!==dt&&ot(r,e)?(r[e]=t,!0):ot(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==dt&&ot(n,o)||qd(e,o)||(a=i[0])&&ot(a,o)||ot(r,o)||ot(za,o)||ot(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:ot(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function wm(n){return Ce(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Th=!0;function aE(n){const e=Ef(n),t=n.proxy,r=n.ctx;Th=!1,e.beforeCreate&&bm(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:u,created:d,beforeMount:f,mounted:g,beforeUpdate:_,updated:C,activated:P,deactivated:R,beforeDestroy:L,beforeUnmount:U,destroyed:$,unmounted:j,render:M,renderTracked:ae,renderTriggered:T,errorCaptured:w,serverPrefetch:I,expose:S,inheritAttrs:k,components:D,directives:A,filters:Jt}=e;if(u&&lE(u,r,null),o)for(const Le in o){const ie=o[Le];je(ie)&&(r[Le]=ie.bind(t))}if(s){const Le=s.call(t,t);_t(Le)&&(n.data=Vu(Le))}if(Th=!0,i)for(const Le in i){const ie=i[Le],ee=je(ie)?ie.bind(t,t):je(ie.get)?ie.get.bind(t,t):or,ke=!je(ie)&&je(ie.set)?ie.set.bind(t):or,Se=Nt({get:ee,set:ke});Object.defineProperty(r,Le,{enumerable:!0,configurable:!0,get:()=>Se.value,set:De=>Se.value=De})}if(a)for(const Le in a)Fv(a[Le],r,t,Le);if(l){const Le=je(l)?l.call(t):l;Reflect.ownKeys(Le).forEach(ie=>{Cc(ie,Le[ie])})}d&&bm(d,n,"c");function et(Le,ie){Ce(ie)?ie.forEach(ee=>Le(ee.bind(t))):ie&&Le(ie.bind(t))}if(et(JI,f),et(Ao,g),et(YI,_),et(XI,C),et(HI,P),et(WI,R),et(nE,w),et(tE,ae),et(eE,T),et(Mv,U),et(If,j),et(ZI,I),Ce(S))if(S.length){const Le=n.exposed||(n.exposed={});S.forEach(ie=>{Object.defineProperty(Le,ie,{get:()=>t[ie],set:ee=>t[ie]=ee})})}else n.exposed||(n.exposed={});M&&n.render===or&&(n.render=M),k!=null&&(n.inheritAttrs=k),D&&(n.components=D),A&&(n.directives=A),I&&Vv(n)}function lE(n,e,t=or){Ce(n)&&(n=Ah(n));for(const r in n){const s=n[r];let i;_t(s)?"default"in s?i=cr(s.from||r,s.default,!0):i=cr(s.from||r):i=cr(s),In(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function bm(n,e,t){kr(Ce(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Fv(n,e,t,r){let s=r.includes(".")?Yv(t,r):()=>t[r];if(Qt(n)){const i=e[n];je(i)&&ur(s,i)}else if(je(n))ur(s,n.bind(t));else if(_t(n))if(Ce(n))n.forEach(i=>Fv(i,e,t,r));else{const i=je(n.handler)?n.handler.bind(t):e[n.handler];je(i)&&ur(s,i,n)}}function Ef(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(u=>Xc(l,u,o,!0)),Xc(l,e,o)),_t(e)&&i.set(e,l),l}function Xc(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Xc(n,i,t,!0),s&&s.forEach(o=>Xc(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=cE[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const cE={data:Im,props:Em,emits:Em,methods:ka,computed:ka,beforeCreate:Pn,created:Pn,beforeMount:Pn,mounted:Pn,beforeUpdate:Pn,updated:Pn,beforeDestroy:Pn,beforeUnmount:Pn,destroyed:Pn,unmounted:Pn,activated:Pn,deactivated:Pn,errorCaptured:Pn,serverPrefetch:Pn,components:ka,directives:ka,watch:dE,provide:Im,inject:uE};function Im(n,e){return e?n?function(){return ln(je(n)?n.call(this,this):n,je(e)?e.call(this,this):e)}:e:n}function uE(n,e){return ka(Ah(n),Ah(e))}function Ah(n){if(Ce(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Pn(n,e){return n?[...new Set([].concat(n,e))]:e}function ka(n,e){return n?ln(Object.create(null),n,e):e}function Em(n,e){return n?Ce(n)&&Ce(e)?[...new Set([...n,...e])]:ln(Object.create(null),wm(n),wm(e??{})):e}function dE(n,e){if(!n)return e;if(!e)return n;const t=ln(Object.create(null),n);for(const r in e)t[r]=Pn(n[r],e[r]);return t}function Uv(){return{app:null,config:{isNativeTag:tI,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let hE=0;function fE(n,e){return function(r,s=null){je(r)||(r=ln({},r)),s!=null&&!_t(s)&&(s=null);const i=Uv(),o=new WeakSet,a=[];let l=!1;const u=i.app={_uid:hE++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:HE,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&je(d.install)?(o.add(d),d.install(u,...f)):je(d)&&(o.add(d),d(u,...f))),u},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),u},component(d,f){return f?(i.components[d]=f,u):i.components[d]},directive(d,f){return f?(i.directives[d]=f,u):i.directives[d]},mount(d,f,g){if(!l){const _=u._ceVNode||$t(r,s);return _.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(_,d):n(_,d,g),l=!0,u._container=d,d.__vue_app__=u,Fu(_.component)}},onUnmount(d){a.push(d)},unmount(){l&&(kr(a,u._instance,16),n(null,u._container),delete u._container.__vue_app__)},provide(d,f){return i.provides[d]=f,u},runWithContext(d){const f=go;go=u;try{return d()}finally{go=f}}};return u}}let go=null;function Cc(n,e){if(bn){let t=bn.provides;const r=bn.parent&&bn.parent.provides;r===t&&(t=bn.provides=Object.create(r)),t[n]=e}}function cr(n,e,t=!1){const r=bn||zn;if(r||go){let s=go?go._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&je(e)?e.call(r&&r.proxy):e}}const Bv={},$v=()=>Object.create(Bv),jv=n=>Object.getPrototypeOf(n)===Bv;function pE(n,e,t,r=!1){const s={},i=$v();n.propsDefaults=Object.create(null),qv(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:Ev(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function mE(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=it(s),[l]=n.propsOptions;let u=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(Mu(n.emitsOptions,g))continue;const _=e[g];if(l)if(ot(i,g))_!==i[g]&&(i[g]=_,u=!0);else{const C=Xn(g);s[C]=xh(l,a,C,_,n,!1)}else _!==i[g]&&(i[g]=_,u=!0)}}}else{qv(n,e,s,i)&&(u=!0);let d;for(const f in a)(!e||!ot(e,f)&&((d=js(f))===f||!ot(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=xh(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!ot(e,f))&&(delete i[f],u=!0)}u&&Ur(n.attrs,"set","")}function qv(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Ua(l))continue;const u=e[l];let d;s&&ot(s,d=Xn(l))?!i||!i.includes(d)?t[d]=u:(a||(a={}))[d]=u:Mu(n.emitsOptions,l)||(!(l in r)||u!==r[l])&&(r[l]=u,o=!0)}if(i){const l=it(t),u=a||dt;for(let d=0;d<i.length;d++){const f=i[d];t[f]=xh(s,l,f,u[f],n,!ot(u,f))}}return o}function xh(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=ot(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&je(l)){const{propsDefaults:u}=s;if(t in u)r=u[t];else{const d=Cl(s);r=u[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===js(t))&&(r=!0))}return r}const gE=new WeakMap;function zv(n,e,t=!1){const r=t?gE:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!je(n)){const d=f=>{l=!0;const[g,_]=zv(f,e,!0);ln(o,g),_&&a.push(..._)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return _t(n)&&r.set(n,uo),uo;if(Ce(i))for(let d=0;d<i.length;d++){const f=Xn(i[d]);Tm(f)&&(o[f]=dt)}else if(i)for(const d in i){const f=Xn(d);if(Tm(f)){const g=i[d],_=o[f]=Ce(g)||je(g)?{type:g}:ln({},g),C=_.type;let P=!1,R=!0;if(Ce(C))for(let L=0;L<C.length;++L){const U=C[L],$=je(U)&&U.name;if($==="Boolean"){P=!0;break}else $==="String"&&(R=!1)}else P=je(C)&&C.name==="Boolean";_[0]=P,_[1]=R,(P||ot(_,"default"))&&a.push(f)}}const u=[o,a];return _t(n)&&r.set(n,u),u}function Tm(n){return n[0]!=="$"&&!Ua(n)}const Tf=n=>n[0]==="_"||n==="$stable",Af=n=>Ce(n)?n.map(br):[br(n)],_E=(n,e,t)=>{if(e._n)return e;const r=zI((...s)=>Af(e(...s)),t);return r._c=!1,r},Gv=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Tf(s))continue;const i=n[s];if(je(i))e[s]=_E(s,i,r);else if(i!=null){const o=Af(i);e[s]=()=>o}}},Kv=(n,e)=>{const t=Af(e);n.slots.default=()=>t},Hv=(n,e,t)=>{for(const r in e)(t||!Tf(r))&&(n[r]=e[r])},vE=(n,e,t)=>{const r=n.slots=$v();if(n.vnode.shapeFlag&32){const s=e.__;s&&_h(r,"__",s,!0);const i=e._;i?(Hv(r,e,t),t&&_h(r,"_",i,!0)):Gv(e,r)}else e&&Kv(n,e)},yE=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=dt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:Hv(s,e,t):(i=!e.$stable,Gv(e,s)),o=e}else e&&(Kv(n,e),o={default:1});if(i)for(const a in s)!Tf(a)&&o[a]==null&&delete s[a]},jn=VE;function wE(n){return bE(n)}function bE(n,e){const t=Ru();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:u,setElementText:d,parentNode:f,nextSibling:g,setScopeId:_=or,insertStaticContent:C}=n,P=(b,x,O,Q=null,G=null,X=null,de=void 0,le=null,re=!!x.dynamicChildren)=>{if(b===x)return;b&&!wa(b,x)&&(Q=K(b),De(b,G,X,!0),b=null),x.patchFlag===-2&&(re=!1,x.dynamicChildren=null);const{type:Z,ref:xe,shapeFlag:fe}=x;switch(Z){case Lu:R(b,x,O,Q);break;case Vs:L(b,x,O,Q);break;case kc:b==null&&U(x,O,Q,de);break;case Rt:D(b,x,O,Q,G,X,de,le,re);break;default:fe&1?M(b,x,O,Q,G,X,de,le,re):fe&6?A(b,x,O,Q,G,X,de,le,re):(fe&64||fe&128)&&Z.process(b,x,O,Q,G,X,de,le,re,ne)}xe!=null&&G?ja(xe,b&&b.ref,X,x||b,!x):xe==null&&b&&b.ref!=null&&ja(b.ref,null,X,b,!0)},R=(b,x,O,Q)=>{if(b==null)r(x.el=a(x.children),O,Q);else{const G=x.el=b.el;x.children!==b.children&&u(G,x.children)}},L=(b,x,O,Q)=>{b==null?r(x.el=l(x.children||""),O,Q):x.el=b.el},U=(b,x,O,Q)=>{[b.el,b.anchor]=C(b.children,x,O,Q,b.el,b.anchor)},$=({el:b,anchor:x},O,Q)=>{let G;for(;b&&b!==x;)G=g(b),r(b,O,Q),b=G;r(x,O,Q)},j=({el:b,anchor:x})=>{let O;for(;b&&b!==x;)O=g(b),s(b),b=O;s(x)},M=(b,x,O,Q,G,X,de,le,re)=>{x.type==="svg"?de="svg":x.type==="math"&&(de="mathml"),b==null?ae(x,O,Q,G,X,de,le,re):I(b,x,G,X,de,le,re)},ae=(b,x,O,Q,G,X,de,le)=>{let re,Z;const{props:xe,shapeFlag:fe,transition:ve,dirs:Re}=b;if(re=b.el=o(b.type,X,xe&&xe.is,xe),fe&8?d(re,b.children):fe&16&&w(b.children,re,null,Q,G,zd(b,X),de,le),Re&&ri(b,null,Q,"created"),T(re,b,b.scopeId,de,Q),xe){for(const Ne in xe)Ne!=="value"&&!Ua(Ne)&&i(re,Ne,null,xe[Ne],X,Q);"value"in xe&&i(re,"value",null,xe.value,X),(Z=xe.onVnodeBeforeMount)&&yr(Z,Q,b)}Re&&ri(b,null,Q,"beforeMount");const Pe=IE(G,ve);Pe&&ve.beforeEnter(re),r(re,x,O),((Z=xe&&xe.onVnodeMounted)||Pe||Re)&&jn(()=>{Z&&yr(Z,Q,b),Pe&&ve.enter(re),Re&&ri(b,null,Q,"mounted")},G)},T=(b,x,O,Q,G)=>{if(O&&_(b,O),Q)for(let X=0;X<Q.length;X++)_(b,Q[X]);if(G){let X=G.subTree;if(x===X||Zv(X.type)&&(X.ssContent===x||X.ssFallback===x)){const de=G.vnode;T(b,de,de.scopeId,de.slotScopeIds,G.parent)}}},w=(b,x,O,Q,G,X,de,le,re=0)=>{for(let Z=re;Z<b.length;Z++){const xe=b[Z]=le?vs(b[Z]):br(b[Z]);P(null,xe,x,O,Q,G,X,de,le)}},I=(b,x,O,Q,G,X,de)=>{const le=x.el=b.el;let{patchFlag:re,dynamicChildren:Z,dirs:xe}=x;re|=b.patchFlag&16;const fe=b.props||dt,ve=x.props||dt;let Re;if(O&&si(O,!1),(Re=ve.onVnodeBeforeUpdate)&&yr(Re,O,x,b),xe&&ri(x,b,O,"beforeUpdate"),O&&si(O,!0),(fe.innerHTML&&ve.innerHTML==null||fe.textContent&&ve.textContent==null)&&d(le,""),Z?S(b.dynamicChildren,Z,le,O,Q,zd(x,G),X):de||ie(b,x,le,null,O,Q,zd(x,G),X,!1),re>0){if(re&16)k(le,fe,ve,O,G);else if(re&2&&fe.class!==ve.class&&i(le,"class",null,ve.class,G),re&4&&i(le,"style",fe.style,ve.style,G),re&8){const Pe=x.dynamicProps;for(let Ne=0;Ne<Pe.length;Ne++){const ye=Pe[Ne],Ke=fe[ye],Dt=ve[ye];(Dt!==Ke||ye==="value")&&i(le,ye,Ke,Dt,G,O)}}re&1&&b.children!==x.children&&d(le,x.children)}else!de&&Z==null&&k(le,fe,ve,O,G);((Re=ve.onVnodeUpdated)||xe)&&jn(()=>{Re&&yr(Re,O,x,b),xe&&ri(x,b,O,"updated")},Q)},S=(b,x,O,Q,G,X,de)=>{for(let le=0;le<x.length;le++){const re=b[le],Z=x[le],xe=re.el&&(re.type===Rt||!wa(re,Z)||re.shapeFlag&198)?f(re.el):O;P(re,Z,xe,null,Q,G,X,de,!0)}},k=(b,x,O,Q,G)=>{if(x!==O){if(x!==dt)for(const X in x)!Ua(X)&&!(X in O)&&i(b,X,x[X],null,G,Q);for(const X in O){if(Ua(X))continue;const de=O[X],le=x[X];de!==le&&X!=="value"&&i(b,X,le,de,G,Q)}"value"in O&&i(b,"value",x.value,O.value,G)}},D=(b,x,O,Q,G,X,de,le,re)=>{const Z=x.el=b?b.el:a(""),xe=x.anchor=b?b.anchor:a("");let{patchFlag:fe,dynamicChildren:ve,slotScopeIds:Re}=x;Re&&(le=le?le.concat(Re):Re),b==null?(r(Z,O,Q),r(xe,O,Q),w(x.children||[],O,xe,G,X,de,le,re)):fe>0&&fe&64&&ve&&b.dynamicChildren?(S(b.dynamicChildren,ve,O,G,X,de,le),(x.key!=null||G&&x===G.subTree)&&Wv(b,x,!0)):ie(b,x,O,xe,G,X,de,le,re)},A=(b,x,O,Q,G,X,de,le,re)=>{x.slotScopeIds=le,b==null?x.shapeFlag&512?G.ctx.activate(x,O,Q,de,re):Jt(x,O,Q,G,X,de,re):Gt(b,x,re)},Jt=(b,x,O,Q,G,X,de)=>{const le=b.component=BE(b,Q,G);if(Nv(b)&&(le.ctx.renderer=ne),$E(le,!1,de),le.asyncDep){if(G&&G.registerDep(le,et,de),!b.el){const re=le.subTree=$t(Vs);L(null,re,x,O)}}else et(le,b,x,O,G,X,de)},Gt=(b,x,O)=>{const Q=x.component=b.component;if(kE(b,x,O))if(Q.asyncDep&&!Q.asyncResolved){Le(Q,x,O);return}else Q.next=x,Q.update();else x.el=b.el,Q.vnode=x},et=(b,x,O,Q,G,X,de)=>{const le=()=>{if(b.isMounted){let{next:fe,bu:ve,u:Re,parent:Pe,vnode:Ne}=b;{const Lt=Qv(b);if(Lt){fe&&(fe.el=Ne.el,Le(b,fe,de)),Lt.asyncDep.then(()=>{b.isUnmounted||le()});return}}let ye=fe,Ke;si(b,!1),fe?(fe.el=Ne.el,Le(b,fe,de)):fe=Ne,ve&&Rc(ve),(Ke=fe.props&&fe.props.onVnodeBeforeUpdate)&&yr(Ke,Pe,fe,Ne),si(b,!0);const Dt=Gd(b),xn=b.subTree;b.subTree=Dt,P(xn,Dt,f(xn.el),K(xn),b,G,X),fe.el=Dt.el,ye===null&&DE(b,Dt.el),Re&&jn(Re,G),(Ke=fe.props&&fe.props.onVnodeUpdated)&&jn(()=>yr(Ke,Pe,fe,Ne),G)}else{let fe;const{el:ve,props:Re}=x,{bm:Pe,m:Ne,parent:ye,root:Ke,type:Dt}=b,xn=qa(x);if(si(b,!1),Pe&&Rc(Pe),!xn&&(fe=Re&&Re.onVnodeBeforeMount)&&yr(fe,ye,x),si(b,!0),ve&&Je){const Lt=()=>{b.subTree=Gd(b),Je(ve,b.subTree,b,G,null)};xn&&Dt.__asyncHydrate?Dt.__asyncHydrate(ve,b,Lt):Lt()}else{Ke.ce&&Ke.ce._def.shadowRoot!==!1&&Ke.ce._injectChildStyle(Dt);const Lt=b.subTree=Gd(b);P(null,Lt,O,Q,b,G,X),x.el=Lt.el}if(Ne&&jn(Ne,G),!xn&&(fe=Re&&Re.onVnodeMounted)){const Lt=x;jn(()=>yr(fe,ye,Lt),G)}(x.shapeFlag&256||ye&&qa(ye.vnode)&&ye.vnode.shapeFlag&256)&&b.a&&jn(b.a,G),b.isMounted=!0,x=O=Q=null}};b.scope.on();const re=b.effect=new cv(le);b.scope.off();const Z=b.update=re.run.bind(re),xe=b.job=re.runIfDirty.bind(re);xe.i=b,xe.id=b.uid,re.scheduler=()=>wf(xe),si(b,!0),Z()},Le=(b,x,O)=>{x.component=b;const Q=b.vnode.props;b.vnode=x,b.next=null,mE(b,x.props,Q,O),yE(b,x.children,O),Kr(),vm(b),Hr()},ie=(b,x,O,Q,G,X,de,le,re=!1)=>{const Z=b&&b.children,xe=b?b.shapeFlag:0,fe=x.children,{patchFlag:ve,shapeFlag:Re}=x;if(ve>0){if(ve&128){ke(Z,fe,O,Q,G,X,de,le,re);return}else if(ve&256){ee(Z,fe,O,Q,G,X,de,le,re);return}}Re&8?(xe&16&&Kt(Z,G,X),fe!==Z&&d(O,fe)):xe&16?Re&16?ke(Z,fe,O,Q,G,X,de,le,re):Kt(Z,G,X,!0):(xe&8&&d(O,""),Re&16&&w(fe,O,Q,G,X,de,le,re))},ee=(b,x,O,Q,G,X,de,le,re)=>{b=b||uo,x=x||uo;const Z=b.length,xe=x.length,fe=Math.min(Z,xe);let ve;for(ve=0;ve<fe;ve++){const Re=x[ve]=re?vs(x[ve]):br(x[ve]);P(b[ve],Re,O,null,G,X,de,le,re)}Z>xe?Kt(b,G,X,!0,!1,fe):w(x,O,Q,G,X,de,le,re,fe)},ke=(b,x,O,Q,G,X,de,le,re)=>{let Z=0;const xe=x.length;let fe=b.length-1,ve=xe-1;for(;Z<=fe&&Z<=ve;){const Re=b[Z],Pe=x[Z]=re?vs(x[Z]):br(x[Z]);if(wa(Re,Pe))P(Re,Pe,O,null,G,X,de,le,re);else break;Z++}for(;Z<=fe&&Z<=ve;){const Re=b[fe],Pe=x[ve]=re?vs(x[ve]):br(x[ve]);if(wa(Re,Pe))P(Re,Pe,O,null,G,X,de,le,re);else break;fe--,ve--}if(Z>fe){if(Z<=ve){const Re=ve+1,Pe=Re<xe?x[Re].el:Q;for(;Z<=ve;)P(null,x[Z]=re?vs(x[Z]):br(x[Z]),O,Pe,G,X,de,le,re),Z++}}else if(Z>ve)for(;Z<=fe;)De(b[Z],G,X,!0),Z++;else{const Re=Z,Pe=Z,Ne=new Map;for(Z=Pe;Z<=ve;Z++){const Pt=x[Z]=re?vs(x[Z]):br(x[Z]);Pt.key!=null&&Ne.set(Pt.key,Z)}let ye,Ke=0;const Dt=ve-Pe+1;let xn=!1,Lt=0;const Hn=new Array(Dt);for(Z=0;Z<Dt;Z++)Hn[Z]=0;for(Z=Re;Z<=fe;Z++){const Pt=b[Z];if(Ke>=Dt){De(Pt,G,X,!0);continue}let cn;if(Pt.key!=null)cn=Ne.get(Pt.key);else for(ye=Pe;ye<=ve;ye++)if(Hn[ye-Pe]===0&&wa(Pt,x[ye])){cn=ye;break}cn===void 0?De(Pt,G,X,!0):(Hn[cn-Pe]=Z+1,cn>=Lt?Lt=cn:xn=!0,P(Pt,x[cn],O,null,G,X,de,le,re),Ke++)}const Ws=xn?EE(Hn):uo;for(ye=Ws.length-1,Z=Dt-1;Z>=0;Z--){const Pt=Pe+Z,cn=x[Pt],tr=Pt+1<xe?x[Pt+1].el:Q;Hn[Z]===0?P(null,cn,O,tr,G,X,de,le,re):xn&&(ye<0||Z!==Ws[ye]?Se(cn,O,tr,2):ye--)}}},Se=(b,x,O,Q,G=null)=>{const{el:X,type:de,transition:le,children:re,shapeFlag:Z}=b;if(Z&6){Se(b.component.subTree,x,O,Q);return}if(Z&128){b.suspense.move(x,O,Q);return}if(Z&64){de.move(b,x,O,ne);return}if(de===Rt){r(X,x,O);for(let fe=0;fe<re.length;fe++)Se(re[fe],x,O,Q);r(b.anchor,x,O);return}if(de===kc){$(b,x,O);return}if(Q!==2&&Z&1&&le)if(Q===0)le.beforeEnter(X),r(X,x,O),jn(()=>le.enter(X),G);else{const{leave:fe,delayLeave:ve,afterLeave:Re}=le,Pe=()=>{b.ctx.isUnmounted?s(X):r(X,x,O)},Ne=()=>{fe(X,()=>{Pe(),Re&&Re()})};ve?ve(X,Pe,Ne):Ne()}else r(X,x,O)},De=(b,x,O,Q=!1,G=!1)=>{const{type:X,props:de,ref:le,children:re,dynamicChildren:Z,shapeFlag:xe,patchFlag:fe,dirs:ve,cacheIndex:Re}=b;if(fe===-2&&(G=!1),le!=null&&(Kr(),ja(le,null,O,b,!0),Hr()),Re!=null&&(x.renderCache[Re]=void 0),xe&256){x.ctx.deactivate(b);return}const Pe=xe&1&&ve,Ne=!qa(b);let ye;if(Ne&&(ye=de&&de.onVnodeBeforeUnmount)&&yr(ye,x,b),xe&6)nn(b.component,O,Q);else{if(xe&128){b.suspense.unmount(O,Q);return}Pe&&ri(b,null,x,"beforeUnmount"),xe&64?b.type.remove(b,x,O,ne,Q):Z&&!Z.hasOnce&&(X!==Rt||fe>0&&fe&64)?Kt(Z,x,O,!1,!0):(X===Rt&&fe&384||!G&&xe&16)&&Kt(re,x,O),Q&&$e(b)}(Ne&&(ye=de&&de.onVnodeUnmounted)||Pe)&&jn(()=>{ye&&yr(ye,x,b),Pe&&ri(b,null,x,"unmounted")},O)},$e=b=>{const{type:x,el:O,anchor:Q,transition:G}=b;if(x===Rt){Yt(O,Q);return}if(x===kc){j(b);return}const X=()=>{s(O),G&&!G.persisted&&G.afterLeave&&G.afterLeave()};if(b.shapeFlag&1&&G&&!G.persisted){const{leave:de,delayLeave:le}=G,re=()=>de(O,X);le?le(b.el,X,re):re()}else X()},Yt=(b,x)=>{let O;for(;b!==x;)O=g(b),s(b),b=O;s(x)},nn=(b,x,O)=>{const{bum:Q,scope:G,job:X,subTree:de,um:le,m:re,a:Z,parent:xe,slots:{__:fe}}=b;Am(re),Am(Z),Q&&Rc(Q),xe&&Ce(fe)&&fe.forEach(ve=>{xe.renderCache[ve]=void 0}),G.stop(),X&&(X.flags|=8,De(de,b,x,O)),le&&jn(le,x),jn(()=>{b.isUnmounted=!0},x),x&&x.pendingBranch&&!x.isUnmounted&&b.asyncDep&&!b.asyncResolved&&b.suspenseId===x.pendingId&&(x.deps--,x.deps===0&&x.resolve())},Kt=(b,x,O,Q=!1,G=!1,X=0)=>{for(let de=X;de<b.length;de++)De(b[de],x,O,Q,G)},K=b=>{if(b.shapeFlag&6)return K(b.component.subTree);if(b.shapeFlag&128)return b.suspense.next();const x=g(b.anchor||b.el),O=x&&x[GI];return O?g(O):x};let me=!1;const ue=(b,x,O)=>{b==null?x._vnode&&De(x._vnode,null,null,!0):P(x._vnode||null,b,x,null,null,null,O),x._vnode=b,me||(me=!0,vm(),Rv(),me=!1)},ne={p:P,um:De,m:Se,r:$e,mt:Jt,mc:w,pc:ie,pbc:S,n:K,o:n};let Fe,Je;return e&&([Fe,Je]=e(ne)),{render:ue,hydrate:Fe,createApp:fE(ue,Fe)}}function zd({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function si({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function IE(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Wv(n,e,t=!1){const r=n.children,s=e.children;if(Ce(r)&&Ce(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=vs(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Wv(o,a)),a.type===Lu&&(a.el=o.el),a.type===Vs&&!a.el&&(a.el=o.el)}}function EE(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const u=n[r];if(u!==0){if(s=t[t.length-1],n[s]<u){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<u?i=a+1:o=a;u<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Qv(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Qv(e)}function Am(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const TE=Symbol.for("v-scx"),AE=()=>cr(TE);function ur(n,e,t){return Jv(n,e,t)}function Jv(n,e,t=dt){const{immediate:r,deep:s,flush:i,once:o}=t,a=ln({},t),l=e&&r||!e&&i!=="post";let u;if(il){if(i==="sync"){const _=AE();u=_.__watcherHandles||(_.__watcherHandles=[])}else if(!l){const _=()=>{};return _.stop=or,_.resume=or,_.pause=or,_}}const d=bn;a.call=(_,C,P)=>kr(_,d,C,P);let f=!1;i==="post"?a.scheduler=_=>{jn(_,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(_,C)=>{C?_():wf(_)}),a.augmentJob=_=>{e&&(_.flags|=4),f&&(_.flags|=2,d&&(_.id=d.uid,_.i=d))};const g=BI(n,e,a);return il&&(u?u.push(g):l&&g()),g}function xE(n,e,t){const r=this.proxy,s=Qt(n)?n.includes(".")?Yv(r,n):()=>r[n]:n.bind(r,r);let i;je(e)?i=e:(i=e.handler,t=e);const o=Cl(this),a=Jv(s,i.bind(r),t);return o(),a}function Yv(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const PE=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Xn(e)}Modifiers`]||n[`${js(e)}Modifiers`];function SE(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||dt;let s=t;const i=e.startsWith("update:"),o=i&&PE(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>Qt(d)?d.trim():d)),o.number&&(s=t.map(vh)));let a,l=r[a=Fd(e)]||r[a=Fd(Xn(e))];!l&&i&&(l=r[a=Fd(js(e))]),l&&kr(l,n,6,s);const u=r[a+"Once"];if(u){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,kr(u,n,6,s)}}function Xv(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!je(n)){const l=u=>{const d=Xv(u,e,!0);d&&(a=!0,ln(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(_t(n)&&r.set(n,null),null):(Ce(i)?i.forEach(l=>o[l]=null):ln(o,i),_t(n)&&r.set(n,o),o)}function Mu(n,e){return!n||!Au(e)?!1:(e=e.slice(2).replace(/Once$/,""),ot(n,e[0].toLowerCase()+e.slice(1))||ot(n,js(e))||ot(n,e))}function Gd(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:u,renderCache:d,props:f,data:g,setupState:_,ctx:C,inheritAttrs:P}=n,R=Yc(n);let L,U;try{if(t.shapeFlag&4){const j=s||r,M=j;L=br(u.call(M,j,d,f,_,g,C)),U=a}else{const j=e;L=br(j.length>1?j(f,{attrs:a,slots:o,emit:l}):j(f,null)),U=e.props?a:RE(a)}}catch(j){Ga.length=0,Nu(j,n,1),L=$t(Vs)}let $=L;if(U&&P!==!1){const j=Object.keys(U),{shapeFlag:M}=$;j.length&&M&7&&(i&&j.some(uf)&&(U=CE(U,i)),$=xo($,U,!1,!0))}return t.dirs&&($=xo($,null,!1,!0),$.dirs=$.dirs?$.dirs.concat(t.dirs):t.dirs),t.transition&&bf($,t.transition),L=$,Yc(R),L}const RE=n=>{let e;for(const t in n)(t==="class"||t==="style"||Au(t))&&((e||(e={}))[t]=n[t]);return e},CE=(n,e)=>{const t={};for(const r in n)(!uf(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function kE(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,u=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?xm(r,o,u):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!Mu(u,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?xm(r,o,u):!0:!!o;return!1}function xm(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Mu(t,i))return!0}return!1}function DE({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Zv=n=>n.__isSuspense;function VE(n,e){e&&e.pendingBranch?Ce(n)?e.effects.push(...n):e.effects.push(n):qI(n)}const Rt=Symbol.for("v-fgt"),Lu=Symbol.for("v-txt"),Vs=Symbol.for("v-cmt"),kc=Symbol.for("v-stc"),Ga=[];let Gn=null;function H(n=!1){Ga.push(Gn=n?null:[])}function NE(){Ga.pop(),Gn=Ga[Ga.length-1]||null}let sl=1;function Pm(n,e=!1){sl+=n,n<0&&Gn&&e&&(Gn.hasOnce=!0)}function ey(n){return n.dynamicChildren=sl>0?Gn||uo:null,NE(),sl>0&&Gn&&Gn.push(n),n}function W(n,e,t,r,s,i){return ey(p(n,e,t,r,s,i,!0))}function ty(n,e,t,r,s){return ey($t(n,e,t,r,s,!0))}function Zc(n){return n?n.__v_isVNode===!0:!1}function wa(n,e){return n.type===e.type&&n.key===e.key}const ny=({key:n})=>n??null,Dc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Qt(n)||In(n)||je(n)?{i:zn,r:n,k:e,f:!!t}:n:null);function p(n,e=null,t=null,r=0,s=null,i=n===Rt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&ny(e),ref:e&&Dc(e),scopeId:kv,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:zn};return a?(xf(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Qt(t)?8:16),sl>0&&!o&&Gn&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Gn.push(l),l}const $t=OE;function OE(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===sE)&&(n=Vs),Zc(n)){const a=xo(n,e,!0);return t&&xf(a,t),sl>0&&!i&&Gn&&(a.shapeFlag&6?Gn[Gn.indexOf(n)]=a:Gn.push(a)),a.patchFlag=-2,a}if(KE(n)&&(n=n.__vccOpts),e){e=ME(e);let{class:a,style:l}=e;a&&!Qt(a)&&(e.class=ar(a)),_t(l)&&(yf(l)&&!Ce(l)&&(l=ln({},l)),e.style=Cu(l))}const o=Qt(n)?1:Zv(n)?128:KI(n)?64:_t(n)?4:je(n)?2:0;return p(n,e,t,r,s,o,i,!0)}function ME(n){return n?yf(n)||jv(n)?ln({},n):n:null}function xo(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,u=e?LE(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:u,key:u&&ny(u),ref:e&&e.ref?t&&i?Ce(i)?i.concat(Dc(e)):[i,Dc(e)]:Dc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Rt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&xo(n.ssContent),ssFallback:n.ssFallback&&xo(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&bf(d,l.clone(d)),d}function qn(n=" ",e=0){return $t(Lu,null,n,e)}function Lr(n,e){const t=$t(kc,null,n);return t.staticCount=e,t}function Ee(n="",e=!1){return e?(H(),ty(Vs,null,n)):$t(Vs,null,n)}function br(n){return n==null||typeof n=="boolean"?$t(Vs):Ce(n)?$t(Rt,null,n.slice()):Zc(n)?vs(n):$t(Lu,null,String(n))}function vs(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:xo(n)}function xf(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ce(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),xf(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!jv(e)?e._ctx=zn:s===3&&zn&&(zn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else je(e)?(e={default:e,_ctx:zn},t=32):(e=String(e),r&64?(t=16,e=[qn(e)]):t=8);n.children=e,n.shapeFlag|=t}function LE(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=ar([e.class,r.class]));else if(s==="style")e.style=Cu([e.style,r.style]);else if(Au(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ce(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function yr(n,e,t,r=null){kr(n,e,7,[t,r])}const FE=Uv();let UE=0;function BE(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||FE,i={uid:UE++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new fI(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:zv(r,s),emitsOptions:Xv(r,s),emit:null,emitted:null,propsDefaults:dt,inheritAttrs:r.inheritAttrs,ctx:dt,data:dt,props:dt,attrs:dt,slots:dt,refs:dt,setupState:dt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=SE.bind(null,i),n.ce&&n.ce(i),i}let bn=null,eu,Ph;{const n=Ru(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};eu=e("__VUE_INSTANCE_SETTERS__",t=>bn=t),Ph=e("__VUE_SSR_SETTERS__",t=>il=t)}const Cl=n=>{const e=bn;return eu(n),n.scope.on(),()=>{n.scope.off(),eu(e)}},Sm=()=>{bn&&bn.scope.off(),eu(null)};function ry(n){return n.vnode.shapeFlag&4}let il=!1;function $E(n,e=!1,t=!1){e&&Ph(e);const{props:r,children:s}=n.vnode,i=ry(n);pE(n,r,i,e),vE(n,s,t||e);const o=i?jE(n,e):void 0;return e&&Ph(!1),o}function jE(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,oE);const{setup:r}=t;if(r){Kr();const s=n.setupContext=r.length>1?zE(n):null,i=Cl(n),o=Rl(r,n,0,[n.props,s]),a=nv(o);if(Hr(),i(),(a||n.sp)&&!qa(n)&&Vv(n),a){if(o.then(Sm,Sm),e)return o.then(l=>{Rm(n,l,e)}).catch(l=>{Nu(l,n,0)});n.asyncDep=o}else Rm(n,o,e)}else sy(n,e)}function Rm(n,e,t){je(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:_t(e)&&(n.setupState=xv(e)),sy(n,t)}let Cm;function sy(n,e,t){const r=n.type;if(!n.render){if(!e&&Cm&&!r.render){const s=r.template||Ef(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,u=ln(ln({isCustomElement:i,delimiters:a},o),l);r.render=Cm(s,u)}}n.render=r.render||or}{const s=Cl(n);Kr();try{aE(n)}finally{Hr(),s()}}}const qE={get(n,e){return wn(n,"get",""),n[e]}};function zE(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,qE),slots:n.slots,emit:n.emit,expose:e}}function Fu(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(xv(VI(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in za)return za[t](n)},has(e,t){return t in e||t in za}})):n.proxy}function GE(n,e=!0){return je(n)?n.displayName||n.name:n.name||e&&n.__name}function KE(n){return je(n)&&"__vccOpts"in n}const Nt=(n,e)=>FI(n,e,il);function iy(n,e,t){const r=arguments.length;return r===2?_t(e)&&!Ce(e)?Zc(e)?$t(n,null,[e]):$t(n,e):$t(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Zc(t)&&(t=[t]),$t(n,e,t))}const HE="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Sh;const km=typeof window<"u"&&window.trustedTypes;if(km)try{Sh=km.createPolicy("vue",{createHTML:n=>n})}catch{}const oy=Sh?n=>Sh.createHTML(n):n=>n,WE="http://www.w3.org/2000/svg",QE="http://www.w3.org/1998/Math/MathML",Fr=typeof document<"u"?document:null,Dm=Fr&&Fr.createElement("template"),JE={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?Fr.createElementNS(WE,n):e==="mathml"?Fr.createElementNS(QE,n):t?Fr.createElement(n,{is:t}):Fr.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Fr.createTextNode(n),createComment:n=>Fr.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Fr.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Dm.innerHTML=oy(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Dm.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},YE=Symbol("_vtc");function XE(n,e,t){const r=n[YE];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const tu=Symbol("_vod"),ay=Symbol("_vsh"),Kd={beforeMount(n,{value:e},{transition:t}){n[tu]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):ba(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),ba(n,!0),r.enter(n)):r.leave(n,()=>{ba(n,!1)}):ba(n,e))},beforeUnmount(n,{value:e}){ba(n,e)}};function ba(n,e){n.style.display=e?n[tu]:"none",n[ay]=!e}const ZE=Symbol(""),eT=/(^|;)\s*display\s*:/;function tT(n,e,t){const r=n.style,s=Qt(t);let i=!1;if(t&&!s){if(e)if(Qt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Vc(r,a,"")}else for(const o in e)t[o]==null&&Vc(r,o,"");for(const o in t)o==="display"&&(i=!0),Vc(r,o,t[o])}else if(s){if(e!==t){const o=r[ZE];o&&(t+=";"+o),r.cssText=t,i=eT.test(t)}}else e&&n.removeAttribute("style");tu in n&&(n[tu]=i?r.display:"",n[ay]&&(r.display="none"))}const Vm=/\s*!important$/;function Vc(n,e,t){if(Ce(t))t.forEach(r=>Vc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=nT(n,e);Vm.test(t)?n.setProperty(js(r),t.replace(Vm,""),"important"):n[r]=t}}const Nm=["Webkit","Moz","ms"],Hd={};function nT(n,e){const t=Hd[e];if(t)return t;let r=Xn(e);if(r!=="filter"&&r in n)return Hd[e]=r;r=Su(r);for(let s=0;s<Nm.length;s++){const i=Nm[s]+r;if(i in n)return Hd[e]=i}return e}const Om="http://www.w3.org/1999/xlink";function Mm(n,e,t,r,s,i=dI(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Om,e.slice(6,e.length)):n.setAttributeNS(Om,e,t):t==null||i&&!iv(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Cr(t)?String(t):t)}function Lm(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?oy(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=iv(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function ci(n,e,t,r){n.addEventListener(e,t,r)}function rT(n,e,t,r){n.removeEventListener(e,t,r)}const Fm=Symbol("_vei");function sT(n,e,t,r,s=null){const i=n[Fm]||(n[Fm]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=iT(e);if(r){const u=i[e]=lT(r,s);ci(n,a,u,l)}else o&&(rT(n,a,o,l),i[e]=void 0)}}const Um=/(?:Once|Passive|Capture)$/;function iT(n){let e;if(Um.test(n)){e={};let r;for(;r=n.match(Um);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):js(n.slice(2)),e]}let Wd=0;const oT=Promise.resolve(),aT=()=>Wd||(oT.then(()=>Wd=0),Wd=Date.now());function lT(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;kr(cT(r,t.value),e,5,[r])};return t.value=n,t.attached=aT(),t}function cT(n,e){if(Ce(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Bm=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,uT=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?XE(n,r,o):e==="style"?tT(n,t,r):Au(e)?uf(e)||sT(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):dT(n,e,r,o))?(Lm(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Mm(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Qt(r))?Lm(n,Xn(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Mm(n,e,r,o))};function dT(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Bm(e)&&je(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Bm(e)&&Qt(t)?!1:e in n}const nu=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ce(e)?t=>Rc(e,t):e};function hT(n){n.target.composing=!0}function $m(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const _o=Symbol("_assign"),St={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[_o]=nu(s);const i=r||s.props&&s.props.type==="number";ci(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=vh(a)),n[_o](a)}),t&&ci(n,"change",()=>{n.value=n.value.trim()}),e||(ci(n,"compositionstart",hT),ci(n,"compositionend",$m),ci(n,"change",$m))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[_o]=nu(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?vh(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},jm={deep:!0,created(n,e,t){n[_o]=nu(t),ci(n,"change",()=>{const r=n._modelValue,s=fT(n),i=n.checked,o=n[_o];if(Ce(r)){const a=ov(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const u=[...r];u.splice(a,1),o(u)}}else if(xu(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(ly(n,i))})},mounted:qm,beforeUpdate(n,e,t){n[_o]=nu(t),qm(n,e,t)}};function qm(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ce(e))s=ov(e,r.props.value)>-1;else if(xu(e))s=e.has(r.props.value);else{if(e===t)return;s=ku(e,ly(n,!0))}n.checked!==s&&(n.checked=s)}function fT(n){return"_value"in n?n._value:n.value}function ly(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const pT=["ctrl","shift","alt","meta"],mT={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>pT.some(t=>n[`${t}Key`]&&!e.includes(t))},Nn=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=mT[e[o]];if(a&&a(s,e))return}return n(s,...i)})},gT={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Sn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=js(s.key);if(e.some(o=>o===i||gT[o]===i))return n(s)})},_T=ln({patchProp:uT},JE);let zm;function vT(){return zm||(zm=wE(_T))}const yT=(...n)=>{const e=vT().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=bT(r);if(!s)return;const i=e._component;!je(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,wT(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function wT(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function bT(n){return Qt(n)?document.querySelector(n):n}const IT={__name:"App",setup(n){return(e,t)=>{const r=rE("router-view");return H(),ty(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const io=typeof document<"u";function cy(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function ET(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&cy(n.default)}const st=Object.assign;function Qd(n,e){const t={};for(const r in e){const s=e[r];t[r]=dr(s)?s.map(n):n(s)}return t}const Ka=()=>{},dr=Array.isArray,uy=/#/g,TT=/&/g,AT=/\//g,xT=/=/g,PT=/\?/g,dy=/\+/g,ST=/%5B/g,RT=/%5D/g,hy=/%5E/g,CT=/%60/g,fy=/%7B/g,kT=/%7C/g,py=/%7D/g,DT=/%20/g;function Pf(n){return encodeURI(""+n).replace(kT,"|").replace(ST,"[").replace(RT,"]")}function VT(n){return Pf(n).replace(fy,"{").replace(py,"}").replace(hy,"^")}function Rh(n){return Pf(n).replace(dy,"%2B").replace(DT,"+").replace(uy,"%23").replace(TT,"%26").replace(CT,"`").replace(fy,"{").replace(py,"}").replace(hy,"^")}function NT(n){return Rh(n).replace(xT,"%3D")}function OT(n){return Pf(n).replace(uy,"%23").replace(PT,"%3F")}function MT(n){return n==null?"":OT(n).replace(AT,"%2F")}function ol(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const LT=/\/$/,FT=n=>n.replace(LT,"");function Jd(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=jT(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:ol(o)}}function UT(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Gm(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function BT(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Po(e.matched[r],t.matched[s])&&my(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Po(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function my(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!$T(n[t],e[t]))return!1;return!0}function $T(n,e){return dr(n)?Km(n,e):dr(e)?Km(e,n):n===e}function Km(n,e){return dr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function jT(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const fs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var al;(function(n){n.pop="pop",n.push="push"})(al||(al={}));var Ha;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Ha||(Ha={}));function qT(n){if(!n)if(io){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),FT(n)}const zT=/^[^#]+#/;function GT(n,e){return n.replace(zT,"#")+e}function KT(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Uu=()=>({left:window.scrollX,top:window.scrollY});function HT(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=KT(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Hm(n,e){return(history.state?history.state.position-e:-1)+n}const Ch=new Map;function WT(n,e){Ch.set(n,e)}function QT(n){const e=Ch.get(n);return Ch.delete(n),e}let JT=()=>location.protocol+"//"+location.host;function gy(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Gm(l,"")}return Gm(t,n)+r+s}function YT(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const _=gy(n,location),C=t.value,P=e.value;let R=0;if(g){if(t.value=_,e.value=g,o&&o===C){o=null;return}R=P?g.position-P.position:0}else r(_);s.forEach(L=>{L(t.value,C,{delta:R,type:al.pop,direction:R?R>0?Ha.forward:Ha.back:Ha.unknown})})};function l(){o=t.value}function u(g){s.push(g);const _=()=>{const C=s.indexOf(g);C>-1&&s.splice(C,1)};return i.push(_),_}function d(){const{history:g}=window;g.state&&g.replaceState(st({},g.state,{scroll:Uu()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:u,destroy:f}}function Wm(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Uu():null}}function XT(n){const{history:e,location:t}=window,r={value:gy(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,u,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:JT()+n+l;try{e[d?"replaceState":"pushState"](u,"",g),s.value=u}catch(_){console.error(_),t[d?"replace":"assign"](g)}}function o(l,u){const d=st({},e.state,Wm(s.value.back,l,s.value.forward,!0),u,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,u){const d=st({},s.value,e.state,{forward:l,scroll:Uu()});i(d.current,d,!0);const f=st({},Wm(r.value,l,null),{position:d.position+1},u);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function ZT(n){n=qT(n);const e=XT(n),t=YT(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=st({location:"",base:n,go:r,createHref:GT.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function eA(n){return typeof n=="string"||n&&typeof n=="object"}function _y(n){return typeof n=="string"||typeof n=="symbol"}const vy=Symbol("");var Qm;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Qm||(Qm={}));function So(n,e){return st(new Error,{type:n,[vy]:!0},e)}function Mr(n,e){return n instanceof Error&&vy in n&&(e==null||!!(n.type&e))}const Jm="[^/]+?",tA={sensitive:!1,strict:!1,start:!0,end:!0},nA=/[.+*?^${}()[\]/\\]/g;function rA(n,e){const t=st({},tA,e),r=[];let s=t.start?"^":"";const i=[];for(const u of n){const d=u.length?[]:[90];t.strict&&!u.length&&(s+="/");for(let f=0;f<u.length;f++){const g=u[f];let _=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(nA,"\\$&"),_+=40;else if(g.type===1){const{value:C,repeatable:P,optional:R,regexp:L}=g;i.push({name:C,repeatable:P,optional:R});const U=L||Jm;if(U!==Jm){_+=10;try{new RegExp(`(${U})`)}catch(j){throw new Error(`Invalid custom RegExp for param "${C}" (${U}): `+j.message)}}let $=P?`((?:${U})(?:/(?:${U}))*)`:`(${U})`;f||($=R&&u.length<2?`(?:/${$})`:"/"+$),R&&($+="?"),s+=$,_+=20,R&&(_+=-8),P&&(_+=-20),U===".*"&&(_+=-50)}d.push(_)}r.push(d)}if(t.strict&&t.end){const u=r.length-1;r[u][r[u].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(u){const d=u.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const _=d[g]||"",C=i[g-1];f[C.name]=_&&C.repeatable?_.split("/"):_}return f}function l(u){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const _ of g)if(_.type===0)d+=_.value;else if(_.type===1){const{value:C,repeatable:P,optional:R}=_,L=C in u?u[C]:"";if(dr(L)&&!P)throw new Error(`Provided param "${C}" is an array but it is not repeatable (* or + modifiers)`);const U=dr(L)?L.join("/"):L;if(!U)if(R)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${C}"`);d+=U}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function sA(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function yy(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=sA(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(Ym(r))return 1;if(Ym(s))return-1}return s.length-r.length}function Ym(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const iA={type:0,value:""},oA=/[a-zA-Z0-9_]/;function aA(n){if(!n)return[[]];if(n==="/")return[[iA]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(_){throw new Error(`ERR (${t})/"${u}": ${_}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,u="",d="";function f(){u&&(t===0?i.push({type:0,value:u}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${u}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:u,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),u="")}function g(){u+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(u&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:oA.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${u}"`),f(),o(),s}function lA(n,e,t){const r=rA(aA(n.path),t),s=st(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function cA(n,e){const t=[],r=new Map;e=tg({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,_){const C=!_,P=Zm(f);P.aliasOf=_&&_.record;const R=tg(e,f),L=[P];if("alias"in f){const j=typeof f.alias=="string"?[f.alias]:f.alias;for(const M of j)L.push(Zm(st({},P,{components:_?_.record.components:P.components,path:M,aliasOf:_?_.record:P})))}let U,$;for(const j of L){const{path:M}=j;if(g&&M[0]!=="/"){const ae=g.record.path,T=ae[ae.length-1]==="/"?"":"/";j.path=g.record.path+(M&&T+M)}if(U=lA(j,g,R),_?_.alias.push(U):($=$||U,$!==U&&$.alias.push(U),C&&f.name&&!eg(U)&&o(f.name)),wy(U)&&l(U),P.children){const ae=P.children;for(let T=0;T<ae.length;T++)i(ae[T],U,_&&_.children[T])}_=_||U}return $?()=>{o($)}:Ka}function o(f){if(_y(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=hA(f,t);t.splice(g,0,f),f.record.name&&!eg(f)&&r.set(f.record.name,f)}function u(f,g){let _,C={},P,R;if("name"in f&&f.name){if(_=r.get(f.name),!_)throw So(1,{location:f});R=_.record.name,C=st(Xm(g.params,_.keys.filter($=>!$.optional).concat(_.parent?_.parent.keys.filter($=>$.optional):[]).map($=>$.name)),f.params&&Xm(f.params,_.keys.map($=>$.name))),P=_.stringify(C)}else if(f.path!=null)P=f.path,_=t.find($=>$.re.test(P)),_&&(C=_.parse(P),R=_.record.name);else{if(_=g.name?r.get(g.name):t.find($=>$.re.test(g.path)),!_)throw So(1,{location:f,currentLocation:g});R=_.record.name,C=st({},g.params,f.params),P=_.stringify(C)}const L=[];let U=_;for(;U;)L.unshift(U.record),U=U.parent;return{name:R,path:P,params:C,matched:L,meta:dA(L)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:u,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function Xm(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Zm(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:uA(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function uA(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function eg(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function dA(n){return n.reduce((e,t)=>st(e,t.meta),{})}function tg(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function hA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;yy(n,e[i])<0?r=i:t=i+1}const s=fA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function fA(n){let e=n;for(;e=e.parent;)if(wy(e)&&yy(n,e)===0)return e}function wy({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function pA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(dy," "),o=i.indexOf("="),a=ol(o<0?i:i.slice(0,o)),l=o<0?null:ol(i.slice(o+1));if(a in e){let u=e[a];dr(u)||(u=e[a]=[u]),u.push(l)}else e[a]=l}return e}function ng(n){let e="";for(let t in n){const r=n[t];if(t=NT(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(dr(r)?r.map(i=>i&&Rh(i)):[r&&Rh(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function mA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=dr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const gA=Symbol(""),rg=Symbol(""),Bu=Symbol(""),Sf=Symbol(""),kh=Symbol("");function Ia(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function ys(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const u=g=>{g===!1?l(So(4,{from:t,to:e})):g instanceof Error?l(g):eA(g)?l(So(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,u));let f=Promise.resolve(d);n.length<3&&(f=f.then(u)),f.catch(g=>l(g))})}function Yd(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(cy(l)){const d=(l.__vccOpts||l)[e];d&&i.push(ys(d,t,r,o,a,s))}else{let u=l();i.push(()=>u.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=ET(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const _=(f.__vccOpts||f)[e];return _&&ys(_,t,r,o,a,s)()}))}}return i}function sg(n){const e=cr(Bu),t=cr(Sf),r=Nt(()=>{const l=po(n.to);return e.resolve(l)}),s=Nt(()=>{const{matched:l}=r.value,{length:u}=l,d=l[u-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(Po.bind(null,d));if(g>-1)return g;const _=ig(l[u-2]);return u>1&&ig(d)===_&&f[f.length-1].path!==_?f.findIndex(Po.bind(null,l[u-2])):g}),i=Nt(()=>s.value>-1&&bA(t.params,r.value.params)),o=Nt(()=>s.value>-1&&s.value===t.matched.length-1&&my(t.params,r.value.params));function a(l={}){if(wA(l)){const u=e[po(n.replace)?"replace":"push"](po(n.to)).catch(Ka);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>u),u}return Promise.resolve()}return{route:r,href:Nt(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function _A(n){return n.length===1?n[0]:n}const vA=Dv({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:sg,setup(n,{slots:e}){const t=Vu(sg(n)),{options:r}=cr(Bu),s=Nt(()=>({[og(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[og(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&_A(e.default(t));return n.custom?i:iy("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),yA=vA;function wA(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function bA(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!dr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function ig(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const og=(n,e,t)=>n??e??t,IA=Dv({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=cr(kh),s=Nt(()=>n.route||r.value),i=cr(rg,0),o=Nt(()=>{let u=po(i);const{matched:d}=s.value;let f;for(;(f=d[u])&&!f.components;)u++;return u}),a=Nt(()=>s.value.matched[o.value]);Cc(rg,Nt(()=>o.value+1)),Cc(gA,a),Cc(kh,s);const l=q();return ur(()=>[l.value,a.value,n.name],([u,d,f],[g,_,C])=>{d&&(d.instances[f]=u,_&&_!==d&&u&&u===g&&(d.leaveGuards.size||(d.leaveGuards=_.leaveGuards),d.updateGuards.size||(d.updateGuards=_.updateGuards))),u&&d&&(!_||!Po(d,_)||!g)&&(d.enterCallbacks[f]||[]).forEach(P=>P(u))},{flush:"post"}),()=>{const u=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return ag(t.default,{Component:g,route:u});const _=f.props[d],C=_?_===!0?u.params:typeof _=="function"?_(u):_:null,R=iy(g,st({},C,e,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return ag(t.default,{Component:R,route:u})||R}}});function ag(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const EA=IA;function TA(n){const e=cA(n.routes,n),t=n.parseQuery||pA,r=n.stringifyQuery||ng,s=n.history,i=Ia(),o=Ia(),a=Ia(),l=NI(fs);let u=fs;io&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=Qd.bind(null,K=>""+K),f=Qd.bind(null,MT),g=Qd.bind(null,ol);function _(K,me){let ue,ne;return _y(K)?(ue=e.getRecordMatcher(K),ne=me):ne=K,e.addRoute(ne,ue)}function C(K){const me=e.getRecordMatcher(K);me&&e.removeRoute(me)}function P(){return e.getRoutes().map(K=>K.record)}function R(K){return!!e.getRecordMatcher(K)}function L(K,me){if(me=st({},me||l.value),typeof K=="string"){const x=Jd(t,K,me.path),O=e.resolve({path:x.path},me),Q=s.createHref(x.fullPath);return st(x,O,{params:g(O.params),hash:ol(x.hash),redirectedFrom:void 0,href:Q})}let ue;if(K.path!=null)ue=st({},K,{path:Jd(t,K.path,me.path).path});else{const x=st({},K.params);for(const O in x)x[O]==null&&delete x[O];ue=st({},K,{params:f(x)}),me.params=f(me.params)}const ne=e.resolve(ue,me),Fe=K.hash||"";ne.params=d(g(ne.params));const Je=UT(r,st({},K,{hash:VT(Fe),path:ne.path})),b=s.createHref(Je);return st({fullPath:Je,hash:Fe,query:r===ng?mA(K.query):K.query||{}},ne,{redirectedFrom:void 0,href:b})}function U(K){return typeof K=="string"?Jd(t,K,l.value.path):st({},K)}function $(K,me){if(u!==K)return So(8,{from:me,to:K})}function j(K){return T(K)}function M(K){return j(st(U(K),{replace:!0}))}function ae(K){const me=K.matched[K.matched.length-1];if(me&&me.redirect){const{redirect:ue}=me;let ne=typeof ue=="function"?ue(K):ue;return typeof ne=="string"&&(ne=ne.includes("?")||ne.includes("#")?ne=U(ne):{path:ne},ne.params={}),st({query:K.query,hash:K.hash,params:ne.path!=null?{}:K.params},ne)}}function T(K,me){const ue=u=L(K),ne=l.value,Fe=K.state,Je=K.force,b=K.replace===!0,x=ae(ue);if(x)return T(st(U(x),{state:typeof x=="object"?st({},Fe,x.state):Fe,force:Je,replace:b}),me||ue);const O=ue;O.redirectedFrom=me;let Q;return!Je&&BT(r,ne,ue)&&(Q=So(16,{to:O,from:ne}),Se(ne,ne,!0,!1)),(Q?Promise.resolve(Q):S(O,ne)).catch(G=>Mr(G)?Mr(G,2)?G:ke(G):ie(G,O,ne)).then(G=>{if(G){if(Mr(G,2))return T(st({replace:b},U(G.to),{state:typeof G.to=="object"?st({},Fe,G.to.state):Fe,force:Je}),me||O)}else G=D(O,ne,!0,b,Fe);return k(O,ne,G),G})}function w(K,me){const ue=$(K,me);return ue?Promise.reject(ue):Promise.resolve()}function I(K){const me=Yt.values().next().value;return me&&typeof me.runWithContext=="function"?me.runWithContext(K):K()}function S(K,me){let ue;const[ne,Fe,Je]=AA(K,me);ue=Yd(ne.reverse(),"beforeRouteLeave",K,me);for(const x of ne)x.leaveGuards.forEach(O=>{ue.push(ys(O,K,me))});const b=w.bind(null,K,me);return ue.push(b),Kt(ue).then(()=>{ue=[];for(const x of i.list())ue.push(ys(x,K,me));return ue.push(b),Kt(ue)}).then(()=>{ue=Yd(Fe,"beforeRouteUpdate",K,me);for(const x of Fe)x.updateGuards.forEach(O=>{ue.push(ys(O,K,me))});return ue.push(b),Kt(ue)}).then(()=>{ue=[];for(const x of Je)if(x.beforeEnter)if(dr(x.beforeEnter))for(const O of x.beforeEnter)ue.push(ys(O,K,me));else ue.push(ys(x.beforeEnter,K,me));return ue.push(b),Kt(ue)}).then(()=>(K.matched.forEach(x=>x.enterCallbacks={}),ue=Yd(Je,"beforeRouteEnter",K,me,I),ue.push(b),Kt(ue))).then(()=>{ue=[];for(const x of o.list())ue.push(ys(x,K,me));return ue.push(b),Kt(ue)}).catch(x=>Mr(x,8)?x:Promise.reject(x))}function k(K,me,ue){a.list().forEach(ne=>I(()=>ne(K,me,ue)))}function D(K,me,ue,ne,Fe){const Je=$(K,me);if(Je)return Je;const b=me===fs,x=io?history.state:{};ue&&(ne||b?s.replace(K.fullPath,st({scroll:b&&x&&x.scroll},Fe)):s.push(K.fullPath,Fe)),l.value=K,Se(K,me,ue,b),ke()}let A;function Jt(){A||(A=s.listen((K,me,ue)=>{if(!nn.listening)return;const ne=L(K),Fe=ae(ne);if(Fe){T(st(Fe,{replace:!0,force:!0}),ne).catch(Ka);return}u=ne;const Je=l.value;io&&WT(Hm(Je.fullPath,ue.delta),Uu()),S(ne,Je).catch(b=>Mr(b,12)?b:Mr(b,2)?(T(st(U(b.to),{force:!0}),ne).then(x=>{Mr(x,20)&&!ue.delta&&ue.type===al.pop&&s.go(-1,!1)}).catch(Ka),Promise.reject()):(ue.delta&&s.go(-ue.delta,!1),ie(b,ne,Je))).then(b=>{b=b||D(ne,Je,!1),b&&(ue.delta&&!Mr(b,8)?s.go(-ue.delta,!1):ue.type===al.pop&&Mr(b,20)&&s.go(-1,!1)),k(ne,Je,b)}).catch(Ka)}))}let Gt=Ia(),et=Ia(),Le;function ie(K,me,ue){ke(K);const ne=et.list();return ne.length?ne.forEach(Fe=>Fe(K,me,ue)):console.error(K),Promise.reject(K)}function ee(){return Le&&l.value!==fs?Promise.resolve():new Promise((K,me)=>{Gt.add([K,me])})}function ke(K){return Le||(Le=!K,Jt(),Gt.list().forEach(([me,ue])=>K?ue(K):me()),Gt.reset()),K}function Se(K,me,ue,ne){const{scrollBehavior:Fe}=n;if(!io||!Fe)return Promise.resolve();const Je=!ue&&QT(Hm(K.fullPath,0))||(ne||!ue)&&history.state&&history.state.scroll||null;return Er().then(()=>Fe(K,me,Je)).then(b=>b&&HT(b)).catch(b=>ie(b,K,me))}const De=K=>s.go(K);let $e;const Yt=new Set,nn={currentRoute:l,listening:!0,addRoute:_,removeRoute:C,clearRoutes:e.clearRoutes,hasRoute:R,getRoutes:P,resolve:L,options:n,push:j,replace:M,go:De,back:()=>De(-1),forward:()=>De(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:et.add,isReady:ee,install(K){const me=this;K.component("RouterLink",yA),K.component("RouterView",EA),K.config.globalProperties.$router=me,Object.defineProperty(K.config.globalProperties,"$route",{enumerable:!0,get:()=>po(l)}),io&&!$e&&l.value===fs&&($e=!0,j(s.location).catch(Fe=>{}));const ue={};for(const Fe in fs)Object.defineProperty(ue,Fe,{get:()=>l.value[Fe],enumerable:!0});K.provide(Bu,me),K.provide(Sf,Ev(ue)),K.provide(kh,l);const ne=K.unmount;Yt.add(K),K.unmount=function(){Yt.delete(K),Yt.size<1&&(u=fs,A&&A(),A=null,l.value=fs,$e=!1,Le=!1),ne()}}};function Kt(K){return K.reduce((me,ue)=>me.then(()=>I(ue)),Promise.resolve())}return nn}function AA(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(u=>Po(u,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(u=>Po(u,l))||s.push(l))}return[t,r,s]}function $u(){return cr(Bu)}function by(n){return cr(Sf)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iy=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},xA=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},Ey={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(g=64)),r.push(t[d],t[f],t[g],t[_])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Iy(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):xA(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const u=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||u==null||f==null)throw new PA;const g=i<<2|a>>4;if(r.push(g),u!==64){const _=a<<4&240|u>>2;if(r.push(_),f!==64){const C=u<<6&192|f;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class PA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const SA=function(n){const e=Iy(n);return Ey.encodeByteArray(e,!0)},ru=function(n){return SA(n).replace(/\./g,"")},Ty=function(n){try{return Ey.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CA=()=>RA().__FIREBASE_DEFAULTS__,kA=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},DA=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ty(n[1]);return e&&JSON.parse(e)},ju=()=>{try{return CA()||kA()||DA()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ay=n=>{var e,t;return(t=(e=ju())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},VA=n=>{const e=Ay(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},xy=()=>{var n;return(n=ju())===null||n===void 0?void 0:n.config},Py=n=>{var e;return(e=ju())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OA(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[ru(JSON.stringify(t)),ru(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function en(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function MA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(en())}function LA(){var n;const e=(n=ju())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function FA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function UA(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function BA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function $A(){const n=en();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Sy(){return!LA()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ry(){try{return typeof indexedDB=="object"}catch{return!1}}function jA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qA="FirebaseError";class ts extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=qA,Object.setPrototypeOf(this,ts.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kl.prototype.create)}}class kl{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?zA(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ts(s,a,r)}}function zA(n,e){return n.replace(GA,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const GA=/\{\$([^}]+)}/g;function KA(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ns(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(lg(i)&&lg(o)){if(!Ns(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function lg(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Da(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Va(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function HA(n,e){const t=new WA(n,e);return t.subscribe.bind(t)}class WA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");QA(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Xd),s.error===void 0&&(s.error=Xd),s.complete===void 0&&(s.complete=Xd);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function QA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Xd(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(n){return n&&n._delegate?n._delegate:n}class bi{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ai="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new NA;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(XA(e))try{this.getOrInitializeService({instanceIdentifier:ai})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ai){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ai){return this.instances.has(e)}getOptions(e=ai){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:YA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ai){return this.component?this.component.multipleInstances?e:ai:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function YA(n){return n===ai?void 0:n}function XA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new JA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var He;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(He||(He={}));const ex={debug:He.DEBUG,verbose:He.VERBOSE,info:He.INFO,warn:He.WARN,error:He.ERROR,silent:He.SILENT},tx=He.INFO,nx={[He.DEBUG]:"log",[He.VERBOSE]:"log",[He.INFO]:"info",[He.WARN]:"warn",[He.ERROR]:"error"},rx=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=nx[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Rf{constructor(e){this.name=e,this._logLevel=tx,this._logHandler=rx,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in He))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ex[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,He.DEBUG,...e),this._logHandler(this,He.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,He.VERBOSE,...e),this._logHandler(this,He.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,He.INFO,...e),this._logHandler(this,He.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,He.WARN,...e),this._logHandler(this,He.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,He.ERROR,...e),this._logHandler(this,He.ERROR,...e)}}const sx=(n,e)=>e.some(t=>n instanceof t);let cg,ug;function ix(){return cg||(cg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ox(){return ug||(ug=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Cy=new WeakMap,Dh=new WeakMap,ky=new WeakMap,Zd=new WeakMap,Cf=new WeakMap;function ax(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Rs(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Cy.set(t,n)}).catch(()=>{}),Cf.set(e,n),e}function lx(n){if(Dh.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Dh.set(n,e)}let Vh={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Dh.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ky.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Rs(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function cx(n){Vh=n(Vh)}function ux(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(eh(this),e,...t);return ky.set(r,e.sort?e.sort():[e]),Rs(r)}:ox().includes(n)?function(...e){return n.apply(eh(this),e),Rs(Cy.get(this))}:function(...e){return Rs(n.apply(eh(this),e))}}function dx(n){return typeof n=="function"?ux(n):(n instanceof IDBTransaction&&lx(n),sx(n,ix())?new Proxy(n,Vh):n)}function Rs(n){if(n instanceof IDBRequest)return ax(n);if(Zd.has(n))return Zd.get(n);const e=dx(n);return e!==n&&(Zd.set(n,e),Cf.set(e,n)),e}const eh=n=>Cf.get(n);function hx(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Rs(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Rs(o.result),l.oldVersion,l.newVersion,Rs(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const fx=["get","getKey","getAll","getAllKeys","count"],px=["put","add","delete","clear"],th=new Map;function dg(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(th.get(e))return th.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=px.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||fx.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return th.set(e,i),i}cx(n=>({...n,get:(e,t,r)=>dg(e,t)||n.get(e,t,r),has:(e,t)=>!!dg(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(gx(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function gx(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Nh="@firebase/app",hg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr=new Rf("@firebase/app"),_x="@firebase/app-compat",vx="@firebase/analytics-compat",yx="@firebase/analytics",wx="@firebase/app-check-compat",bx="@firebase/app-check",Ix="@firebase/auth",Ex="@firebase/auth-compat",Tx="@firebase/database",Ax="@firebase/data-connect",xx="@firebase/database-compat",Px="@firebase/functions",Sx="@firebase/functions-compat",Rx="@firebase/installations",Cx="@firebase/installations-compat",kx="@firebase/messaging",Dx="@firebase/messaging-compat",Vx="@firebase/performance",Nx="@firebase/performance-compat",Ox="@firebase/remote-config",Mx="@firebase/remote-config-compat",Lx="@firebase/storage",Fx="@firebase/storage-compat",Ux="@firebase/firestore",Bx="@firebase/vertexai-preview",$x="@firebase/firestore-compat",jx="firebase",qx="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su="[DEFAULT]",zx={[Nh]:"fire-core",[_x]:"fire-core-compat",[yx]:"fire-analytics",[vx]:"fire-analytics-compat",[bx]:"fire-app-check",[wx]:"fire-app-check-compat",[Ix]:"fire-auth",[Ex]:"fire-auth-compat",[Tx]:"fire-rtdb",[Ax]:"fire-data-connect",[xx]:"fire-rtdb-compat",[Px]:"fire-fn",[Sx]:"fire-fn-compat",[Rx]:"fire-iid",[Cx]:"fire-iid-compat",[kx]:"fire-fcm",[Dx]:"fire-fcm-compat",[Vx]:"fire-perf",[Nx]:"fire-perf-compat",[Ox]:"fire-rc",[Mx]:"fire-rc-compat",[Lx]:"fire-gcs",[Fx]:"fire-gcs-compat",[Ux]:"fire-fst",[$x]:"fire-fst-compat",[Bx]:"fire-vertex","fire-js":"fire-js",[jx]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu=new Map,Gx=new Map,Oh=new Map;function fg(n,e){try{n.container.addComponent(e)}catch(t){Wr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ro(n){const e=n.name;if(Oh.has(e))return Wr.debug(`There were multiple attempts to register component ${e}.`),!1;Oh.set(e,n);for(const t of iu.values())fg(t,n);for(const t of Gx.values())fg(t,n);return!0}function Dl(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Kx(n,e,t=su){Dl(n,e).clearInstance(t)}function jt(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hx={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Cs=new kl("app","Firebase",Hx);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new bi("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Cs.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho=qx;function Dy(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:su,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Cs.create("bad-app-name",{appName:String(s)});if(t||(t=xy()),!t)throw Cs.create("no-options");const i=iu.get(s);if(i){if(Ns(t,i.options)&&Ns(r,i.config))return i;throw Cs.create("duplicate-app",{appName:s})}const o=new ZA(s);for(const l of Oh.values())o.addComponent(l);const a=new Wx(t,r,o);return iu.set(s,a),a}function Vy(n=su){const e=iu.get(n);if(!e&&n===su&&xy())return Dy();if(!e)throw Cs.create("no-app",{appName:n});return e}function ks(n,e,t){var r;let s=(r=zx[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Wr.warn(a.join(" "));return}Ro(new bi(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qx="firebase-heartbeat-database",Jx=1,ll="firebase-heartbeat-store";let nh=null;function Ny(){return nh||(nh=hx(Qx,Jx,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ll)}catch(t){console.warn(t)}}}}).catch(n=>{throw Cs.create("idb-open",{originalErrorMessage:n.message})})),nh}async function Yx(n){try{const t=(await Ny()).transaction(ll),r=await t.objectStore(ll).get(Oy(n));return await t.done,r}catch(e){if(e instanceof ts)Wr.warn(e.message);else{const t=Cs.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Wr.warn(t.message)}}}async function pg(n,e){try{const r=(await Ny()).transaction(ll,"readwrite");await r.objectStore(ll).put(e,Oy(n)),await r.done}catch(t){if(t instanceof ts)Wr.warn(t.message);else{const r=Cs.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Wr.warn(r.message)}}}function Oy(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xx=1024,Zx=30*24*60*60*1e3;class eP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new nP(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=mg();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=Zx}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Wr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=mg(),{heartbeatsToSend:r,unsentEntries:s}=tP(this._heartbeatsCache.heartbeats),i=ru(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Wr.warn(t),""}}}function mg(){return new Date().toISOString().substring(0,10)}function tP(n,e=Xx){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),gg(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),gg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class nP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ry()?jA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Yx(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return pg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return pg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function gg(n){return ru(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(n){Ro(new bi("platform-logger",e=>new mx(e),"PRIVATE")),Ro(new bi("heartbeat",e=>new eP(e),"PRIVATE")),ks(Nh,hg,n),ks(Nh,hg,"esm2017"),ks("fire-js","")}rP("");var sP="firebase",iP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ks(sP,iP,"app");var _g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var vi,My;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,w){function I(){}I.prototype=w.prototype,T.D=w.prototype,T.prototype=new I,T.prototype.constructor=T,T.C=function(S,k,D){for(var A=Array(arguments.length-2),Jt=2;Jt<arguments.length;Jt++)A[Jt-2]=arguments[Jt];return w.prototype[k].apply(S,A)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,w,I){I||(I=0);var S=Array(16);if(typeof w=="string")for(var k=0;16>k;++k)S[k]=w.charCodeAt(I++)|w.charCodeAt(I++)<<8|w.charCodeAt(I++)<<16|w.charCodeAt(I++)<<24;else for(k=0;16>k;++k)S[k]=w[I++]|w[I++]<<8|w[I++]<<16|w[I++]<<24;w=T.g[0],I=T.g[1],k=T.g[2];var D=T.g[3],A=w+(D^I&(k^D))+S[0]+3614090360&4294967295;w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+S[1]+3905402710&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+S[2]+606105819&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+S[3]+3250441966&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(D^I&(k^D))+S[4]+4118548399&4294967295,w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+S[5]+1200080426&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+S[6]+2821735955&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+S[7]+4249261313&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(D^I&(k^D))+S[8]+1770035416&4294967295,w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+S[9]+2336552879&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+S[10]+4294925233&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+S[11]+2304563134&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(D^I&(k^D))+S[12]+1804603682&4294967295,w=I+(A<<7&4294967295|A>>>25),A=D+(k^w&(I^k))+S[13]+4254626195&4294967295,D=w+(A<<12&4294967295|A>>>20),A=k+(I^D&(w^I))+S[14]+2792965006&4294967295,k=D+(A<<17&4294967295|A>>>15),A=I+(w^k&(D^w))+S[15]+1236535329&4294967295,I=k+(A<<22&4294967295|A>>>10),A=w+(k^D&(I^k))+S[1]+4129170786&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+S[6]+3225465664&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+S[11]+643717713&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+S[0]+3921069994&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^D&(I^k))+S[5]+3593408605&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+S[10]+38016083&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+S[15]+3634488961&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+S[4]+3889429448&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^D&(I^k))+S[9]+568446438&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+S[14]+3275163606&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+S[3]+4107603335&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+S[8]+1163531501&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(k^D&(I^k))+S[13]+2850285829&4294967295,w=I+(A<<5&4294967295|A>>>27),A=D+(I^k&(w^I))+S[2]+4243563512&4294967295,D=w+(A<<9&4294967295|A>>>23),A=k+(w^I&(D^w))+S[7]+1735328473&4294967295,k=D+(A<<14&4294967295|A>>>18),A=I+(D^w&(k^D))+S[12]+2368359562&4294967295,I=k+(A<<20&4294967295|A>>>12),A=w+(I^k^D)+S[5]+4294588738&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+S[8]+2272392833&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+S[11]+1839030562&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+S[14]+4259657740&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^D)+S[1]+2763975236&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+S[4]+1272893353&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+S[7]+4139469664&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+S[10]+3200236656&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^D)+S[13]+681279174&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+S[0]+3936430074&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+S[3]+3572445317&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+S[6]+76029189&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(I^k^D)+S[9]+3654602809&4294967295,w=I+(A<<4&4294967295|A>>>28),A=D+(w^I^k)+S[12]+3873151461&4294967295,D=w+(A<<11&4294967295|A>>>21),A=k+(D^w^I)+S[15]+530742520&4294967295,k=D+(A<<16&4294967295|A>>>16),A=I+(k^D^w)+S[2]+3299628645&4294967295,I=k+(A<<23&4294967295|A>>>9),A=w+(k^(I|~D))+S[0]+4096336452&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+S[7]+1126891415&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+S[14]+2878612391&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+S[5]+4237533241&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~D))+S[12]+1700485571&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+S[3]+2399980690&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+S[10]+4293915773&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+S[1]+2240044497&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~D))+S[8]+1873313359&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+S[15]+4264355552&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+S[6]+2734768916&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+S[13]+1309151649&4294967295,I=k+(A<<21&4294967295|A>>>11),A=w+(k^(I|~D))+S[4]+4149444226&4294967295,w=I+(A<<6&4294967295|A>>>26),A=D+(I^(w|~k))+S[11]+3174756917&4294967295,D=w+(A<<10&4294967295|A>>>22),A=k+(w^(D|~I))+S[2]+718787259&4294967295,k=D+(A<<15&4294967295|A>>>17),A=I+(D^(k|~w))+S[9]+3951481745&4294967295,T.g[0]=T.g[0]+w&4294967295,T.g[1]=T.g[1]+(k+(A<<21&4294967295|A>>>11))&4294967295,T.g[2]=T.g[2]+k&4294967295,T.g[3]=T.g[3]+D&4294967295}r.prototype.u=function(T,w){w===void 0&&(w=T.length);for(var I=w-this.blockSize,S=this.B,k=this.h,D=0;D<w;){if(k==0)for(;D<=I;)s(this,T,D),D+=this.blockSize;if(typeof T=="string"){for(;D<w;)if(S[k++]=T.charCodeAt(D++),k==this.blockSize){s(this,S),k=0;break}}else for(;D<w;)if(S[k++]=T[D++],k==this.blockSize){s(this,S),k=0;break}}this.h=k,this.o+=w},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var w=1;w<T.length-8;++w)T[w]=0;var I=8*this.o;for(w=T.length-8;w<T.length;++w)T[w]=I&255,I/=256;for(this.u(T),T=Array(16),w=I=0;4>w;++w)for(var S=0;32>S;S+=8)T[I++]=this.g[w]>>>S&255;return T};function i(T,w){var I=a;return Object.prototype.hasOwnProperty.call(I,T)?I[T]:I[T]=w(T)}function o(T,w){this.h=w;for(var I=[],S=!0,k=T.length-1;0<=k;k--){var D=T[k]|0;S&&D==w||(I[k]=D,S=!1)}this.g=I}var a={};function l(T){return-128<=T&&128>T?i(T,function(w){return new o([w|0],0>w?-1:0)}):new o([T|0],0>T?-1:0)}function u(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return R(u(-T));for(var w=[],I=1,S=0;T>=I;S++)w[S]=T/I|0,I*=4294967296;return new o(w,0)}function d(T,w){if(T.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(T.charAt(0)=="-")return R(d(T.substring(1),w));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=u(Math.pow(w,8)),S=f,k=0;k<T.length;k+=8){var D=Math.min(8,T.length-k),A=parseInt(T.substring(k,k+D),w);8>D?(D=u(Math.pow(w,D)),S=S.j(D).add(u(A))):(S=S.j(I),S=S.add(u(A)))}return S}var f=l(0),g=l(1),_=l(16777216);n=o.prototype,n.m=function(){if(P(this))return-R(this).m();for(var T=0,w=1,I=0;I<this.g.length;I++){var S=this.i(I);T+=(0<=S?S:4294967296+S)*w,w*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(C(this))return"0";if(P(this))return"-"+R(this).toString(T);for(var w=u(Math.pow(T,6)),I=this,S="";;){var k=j(I,w).g;I=L(I,k.j(w));var D=((0<I.g.length?I.g[0]:I.h)>>>0).toString(T);if(I=k,C(I))return D+S;for(;6>D.length;)D="0"+D;S=D+S}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function C(T){if(T.h!=0)return!1;for(var w=0;w<T.g.length;w++)if(T.g[w]!=0)return!1;return!0}function P(T){return T.h==-1}n.l=function(T){return T=L(this,T),P(T)?-1:C(T)?0:1};function R(T){for(var w=T.g.length,I=[],S=0;S<w;S++)I[S]=~T.g[S];return new o(I,~T.h).add(g)}n.abs=function(){return P(this)?R(this):this},n.add=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],S=0,k=0;k<=w;k++){var D=S+(this.i(k)&65535)+(T.i(k)&65535),A=(D>>>16)+(this.i(k)>>>16)+(T.i(k)>>>16);S=A>>>16,D&=65535,A&=65535,I[k]=A<<16|D}return new o(I,I[I.length-1]&-2147483648?-1:0)};function L(T,w){return T.add(R(w))}n.j=function(T){if(C(this)||C(T))return f;if(P(this))return P(T)?R(this).j(R(T)):R(R(this).j(T));if(P(T))return R(this.j(R(T)));if(0>this.l(_)&&0>T.l(_))return u(this.m()*T.m());for(var w=this.g.length+T.g.length,I=[],S=0;S<2*w;S++)I[S]=0;for(S=0;S<this.g.length;S++)for(var k=0;k<T.g.length;k++){var D=this.i(S)>>>16,A=this.i(S)&65535,Jt=T.i(k)>>>16,Gt=T.i(k)&65535;I[2*S+2*k]+=A*Gt,U(I,2*S+2*k),I[2*S+2*k+1]+=D*Gt,U(I,2*S+2*k+1),I[2*S+2*k+1]+=A*Jt,U(I,2*S+2*k+1),I[2*S+2*k+2]+=D*Jt,U(I,2*S+2*k+2)}for(S=0;S<w;S++)I[S]=I[2*S+1]<<16|I[2*S];for(S=w;S<2*w;S++)I[S]=0;return new o(I,0)};function U(T,w){for(;(T[w]&65535)!=T[w];)T[w+1]+=T[w]>>>16,T[w]&=65535,w++}function $(T,w){this.g=T,this.h=w}function j(T,w){if(C(w))throw Error("division by zero");if(C(T))return new $(f,f);if(P(T))return w=j(R(T),w),new $(R(w.g),R(w.h));if(P(w))return w=j(T,R(w)),new $(R(w.g),w.h);if(30<T.g.length){if(P(T)||P(w))throw Error("slowDivide_ only works with positive integers.");for(var I=g,S=w;0>=S.l(T);)I=M(I),S=M(S);var k=ae(I,1),D=ae(S,1);for(S=ae(S,2),I=ae(I,2);!C(S);){var A=D.add(S);0>=A.l(T)&&(k=k.add(I),D=A),S=ae(S,1),I=ae(I,1)}return w=L(T,k.j(w)),new $(k,w)}for(k=f;0<=T.l(w);){for(I=Math.max(1,Math.floor(T.m()/w.m())),S=Math.ceil(Math.log(I)/Math.LN2),S=48>=S?1:Math.pow(2,S-48),D=u(I),A=D.j(w);P(A)||0<A.l(T);)I-=S,D=u(I),A=D.j(w);C(D)&&(D=g),k=k.add(D),T=L(T,A)}return new $(k,T)}n.A=function(T){return j(this,T).h},n.and=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],S=0;S<w;S++)I[S]=this.i(S)&T.i(S);return new o(I,this.h&T.h)},n.or=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],S=0;S<w;S++)I[S]=this.i(S)|T.i(S);return new o(I,this.h|T.h)},n.xor=function(T){for(var w=Math.max(this.g.length,T.g.length),I=[],S=0;S<w;S++)I[S]=this.i(S)^T.i(S);return new o(I,this.h^T.h)};function M(T){for(var w=T.g.length+1,I=[],S=0;S<w;S++)I[S]=T.i(S)<<1|T.i(S-1)>>>31;return new o(I,T.h)}function ae(T,w){var I=w>>5;w%=32;for(var S=T.g.length-I,k=[],D=0;D<S;D++)k[D]=0<w?T.i(D+I)>>>w|T.i(D+I+1)<<32-w:T.i(D+I);return new o(k,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,My=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,vi=o}).apply(typeof _g<"u"?_g:typeof self<"u"?self:typeof window<"u"?window:{});var wc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ly,Na,Fy,Nc,Mh,Uy,By,$y;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,h,m){return c==Array.prototype||c==Object.prototype||(c[h]=m.value),c};function t(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof wc=="object"&&wc];for(var h=0;h<c.length;++h){var m=c[h];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function s(c,h){if(h)e:{var m=r;c=c.split(".");for(var y=0;y<c.length-1;y++){var V=c[y];if(!(V in m))break e;m=m[V]}c=c[c.length-1],y=m[c],h=h(y),h!=y&&h!=null&&e(m,c,{configurable:!0,writable:!0,value:h})}}function i(c,h){c instanceof String&&(c+="");var m=0,y=!1,V={next:function(){if(!y&&m<c.length){var B=m++;return{value:h(B,c[B]),done:!1}}return y=!0,{done:!0,value:void 0}}};return V[Symbol.iterator]=function(){return V},V}s("Array.prototype.values",function(c){return c||function(){return i(this,function(h,m){return m})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var h=typeof c;return h=h!="object"?h:c?Array.isArray(c)?"array":h:"null",h=="array"||h=="object"&&typeof c.length=="number"}function u(c){var h=typeof c;return h=="object"&&c!=null||h=="function"}function d(c,h,m){return c.call.apply(c.bind,arguments)}function f(c,h,m){if(!c)throw Error();if(2<arguments.length){var y=Array.prototype.slice.call(arguments,2);return function(){var V=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(V,y),c.apply(h,V)}}return function(){return c.apply(h,arguments)}}function g(c,h,m){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function _(c,h){var m=Array.prototype.slice.call(arguments,1);return function(){var y=m.slice();return y.push.apply(y,arguments),c.apply(this,y)}}function C(c,h){function m(){}m.prototype=h.prototype,c.aa=h.prototype,c.prototype=new m,c.prototype.constructor=c,c.Qb=function(y,V,B){for(var he=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)he[ut-2]=arguments[ut];return h.prototype[V].apply(y,he)}}function P(c){const h=c.length;if(0<h){const m=Array(h);for(let y=0;y<h;y++)m[y]=c[y];return m}return[]}function R(c,h){for(let m=1;m<arguments.length;m++){const y=arguments[m];if(l(y)){const V=c.length||0,B=y.length||0;c.length=V+B;for(let he=0;he<B;he++)c[V+he]=y[he]}else c.push(y)}}class L{constructor(h,m){this.i=h,this.j=m,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function U(c){return/^[\s\xa0]*$/.test(c)}function $(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function j(c){return j[" "](c),c}j[" "]=function(){};var M=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function ae(c,h,m){for(const y in c)h.call(m,c[y],y,c)}function T(c,h){for(const m in c)h.call(void 0,c[m],m,c)}function w(c){const h={};for(const m in c)h[m]=c[m];return h}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function S(c,h){let m,y;for(let V=1;V<arguments.length;V++){y=arguments[V];for(m in y)c[m]=y[m];for(let B=0;B<I.length;B++)m=I[B],Object.prototype.hasOwnProperty.call(y,m)&&(c[m]=y[m])}}function k(c){var h=1;c=c.split(":");const m=[];for(;0<h&&c.length;)m.push(c.shift()),h--;return c.length&&m.push(c.join(":")),m}function D(c){a.setTimeout(()=>{throw c},0)}function A(){var c=ee;let h=null;return c.g&&(h=c.g,c.g=c.g.next,c.g||(c.h=null),h.next=null),h}class Jt{constructor(){this.h=this.g=null}add(h,m){const y=Gt.get();y.set(h,m),this.h?this.h.next=y:this.g=y,this.h=y}}var Gt=new L(()=>new et,c=>c.reset());class et{constructor(){this.next=this.g=this.h=null}set(h,m){this.h=h,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let Le,ie=!1,ee=new Jt,ke=()=>{const c=a.Promise.resolve(void 0);Le=()=>{c.then(Se)}};var Se=()=>{for(var c;c=A();){try{c.h.call(c.g)}catch(m){D(m)}var h=Gt;h.j(c),100>h.h&&(h.h++,c.next=h.g,h.g=c)}ie=!1};function De(){this.s=this.s,this.C=this.C}De.prototype.s=!1,De.prototype.ma=function(){this.s||(this.s=!0,this.N())},De.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $e(c,h){this.type=c,this.g=this.target=h,this.defaultPrevented=!1}$e.prototype.h=function(){this.defaultPrevented=!0};var Yt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,h=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const m=()=>{};a.addEventListener("test",m,h),a.removeEventListener("test",m,h)}catch{}return c}();function nn(c,h){if($e.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var m=this.type=c.type,y=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=h,h=c.relatedTarget){if(M){e:{try{j(h.nodeName);var V=!0;break e}catch{}V=!1}V||(h=null)}}else m=="mouseover"?h=c.fromElement:m=="mouseout"&&(h=c.toElement);this.relatedTarget=h,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:Kt[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&nn.aa.h.call(this)}}C(nn,$e);var Kt={2:"touch",3:"pen",4:"mouse"};nn.prototype.h=function(){nn.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),me=0;function ue(c,h,m,y,V){this.listener=c,this.proxy=null,this.src=h,this.type=m,this.capture=!!y,this.ha=V,this.key=++me,this.da=this.fa=!1}function ne(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function Fe(c){this.src=c,this.g={},this.h=0}Fe.prototype.add=function(c,h,m,y,V){var B=c.toString();c=this.g[B],c||(c=this.g[B]=[],this.h++);var he=b(c,h,y,V);return-1<he?(h=c[he],m||(h.fa=!1)):(h=new ue(h,this.src,B,!!y,V),h.fa=m,c.push(h)),h};function Je(c,h){var m=h.type;if(m in c.g){var y=c.g[m],V=Array.prototype.indexOf.call(y,h,void 0),B;(B=0<=V)&&Array.prototype.splice.call(y,V,1),B&&(ne(h),c.g[m].length==0&&(delete c.g[m],c.h--))}}function b(c,h,m,y){for(var V=0;V<c.length;++V){var B=c[V];if(!B.da&&B.listener==h&&B.capture==!!m&&B.ha==y)return V}return-1}var x="closure_lm_"+(1e6*Math.random()|0),O={};function Q(c,h,m,y,V){if(y&&y.once)return de(c,h,m,y,V);if(Array.isArray(h)){for(var B=0;B<h.length;B++)Q(c,h[B],m,y,V);return null}return m=Re(m),c&&c[K]?c.K(h,m,u(y)?!!y.capture:!!y,V):G(c,h,m,!1,y,V)}function G(c,h,m,y,V,B){if(!h)throw Error("Invalid event type");var he=u(V)?!!V.capture:!!V,ut=fe(c);if(ut||(c[x]=ut=new Fe(c)),m=ut.add(h,m,y,he,B),m.proxy)return m;if(y=X(),m.proxy=y,y.src=c,y.listener=m,c.addEventListener)Yt||(V=he),V===void 0&&(V=!1),c.addEventListener(h.toString(),y,V);else if(c.attachEvent)c.attachEvent(Z(h.toString()),y);else if(c.addListener&&c.removeListener)c.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return m}function X(){function c(m){return h.call(c.src,c.listener,m)}const h=xe;return c}function de(c,h,m,y,V){if(Array.isArray(h)){for(var B=0;B<h.length;B++)de(c,h[B],m,y,V);return null}return m=Re(m),c&&c[K]?c.L(h,m,u(y)?!!y.capture:!!y,V):G(c,h,m,!0,y,V)}function le(c,h,m,y,V){if(Array.isArray(h))for(var B=0;B<h.length;B++)le(c,h[B],m,y,V);else y=u(y)?!!y.capture:!!y,m=Re(m),c&&c[K]?(c=c.i,h=String(h).toString(),h in c.g&&(B=c.g[h],m=b(B,m,y,V),-1<m&&(ne(B[m]),Array.prototype.splice.call(B,m,1),B.length==0&&(delete c.g[h],c.h--)))):c&&(c=fe(c))&&(h=c.g[h.toString()],c=-1,h&&(c=b(h,m,y,V)),(m=-1<c?h[c]:null)&&re(m))}function re(c){if(typeof c!="number"&&c&&!c.da){var h=c.src;if(h&&h[K])Je(h.i,c);else{var m=c.type,y=c.proxy;h.removeEventListener?h.removeEventListener(m,y,c.capture):h.detachEvent?h.detachEvent(Z(m),y):h.addListener&&h.removeListener&&h.removeListener(y),(m=fe(h))?(Je(m,c),m.h==0&&(m.src=null,h[x]=null)):ne(c)}}}function Z(c){return c in O?O[c]:O[c]="on"+c}function xe(c,h){if(c.da)c=!0;else{h=new nn(h,this);var m=c.listener,y=c.ha||c.src;c.fa&&re(c),c=m.call(y,h)}return c}function fe(c){return c=c[x],c instanceof Fe?c:null}var ve="__closure_events_fn_"+(1e9*Math.random()>>>0);function Re(c){return typeof c=="function"?c:(c[ve]||(c[ve]=function(h){return c.handleEvent(h)}),c[ve])}function Pe(){De.call(this),this.i=new Fe(this),this.M=this,this.F=null}C(Pe,De),Pe.prototype[K]=!0,Pe.prototype.removeEventListener=function(c,h,m,y){le(this,c,h,m,y)};function Ne(c,h){var m,y=c.F;if(y)for(m=[];y;y=y.F)m.push(y);if(c=c.M,y=h.type||h,typeof h=="string")h=new $e(h,c);else if(h instanceof $e)h.target=h.target||c;else{var V=h;h=new $e(y,c),S(h,V)}if(V=!0,m)for(var B=m.length-1;0<=B;B--){var he=h.g=m[B];V=ye(he,y,!0,h)&&V}if(he=h.g=c,V=ye(he,y,!0,h)&&V,V=ye(he,y,!1,h)&&V,m)for(B=0;B<m.length;B++)he=h.g=m[B],V=ye(he,y,!1,h)&&V}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var c=this.i,h;for(h in c.g){for(var m=c.g[h],y=0;y<m.length;y++)ne(m[y]);delete c.g[h],c.h--}}this.F=null},Pe.prototype.K=function(c,h,m,y){return this.i.add(String(c),h,!1,m,y)},Pe.prototype.L=function(c,h,m,y){return this.i.add(String(c),h,!0,m,y)};function ye(c,h,m,y){if(h=c.i.g[String(h)],!h)return!0;h=h.concat();for(var V=!0,B=0;B<h.length;++B){var he=h[B];if(he&&!he.da&&he.capture==m){var ut=he.listener,dn=he.ha||he.src;he.fa&&Je(c.i,he),V=ut.call(dn,y)!==!1&&V}}return V&&!y.defaultPrevented}function Ke(c,h,m){if(typeof c=="function")m&&(c=g(c,m));else if(c&&typeof c.handleEvent=="function")c=g(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(c,h||0)}function Dt(c){c.g=Ke(()=>{c.g=null,c.i&&(c.i=!1,Dt(c))},c.l);const h=c.h;c.h=null,c.m.apply(null,h)}class xn extends De{constructor(h,m){super(),this.m=h,this.l=m,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:Dt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lt(c){De.call(this),this.h=c,this.g={}}C(Lt,De);var Hn=[];function Ws(c){ae(c.g,function(h,m){this.g.hasOwnProperty(m)&&re(h)},c),c.g={}}Lt.prototype.N=function(){Lt.aa.N.call(this),Ws(this)},Lt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Pt=a.JSON.stringify,cn=a.JSON.parse,tr=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function hr(){}hr.prototype.h=null;function ls(c){return c.h||(c.h=c.i())}function cs(){}var fr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function aa(){$e.call(this,"d")}C(aa,$e);function la(){$e.call(this,"c")}C(la,$e);var Vr={},ec=null;function rt(){return ec=ec||new Pe}Vr.La="serverreachability";function ft(c){$e.call(this,Vr.La,c)}C(ft,$e);function yt(c){const h=rt();Ne(h,new ft(h))}Vr.STAT_EVENT="statevent";function pt(c,h){$e.call(this,Vr.STAT_EVENT,c),this.stat=h}C(pt,$e);function un(c){const h=rt();Ne(h,new pt(h,c))}Vr.Ma="timingevent";function ca(c,h){$e.call(this,Vr.Ma,c),this.size=h}C(ca,$e);function us(c,h){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},h)}function Qs(){this.g=!0}Qs.prototype.xa=function(){this.g=!1};function bd(c,h,m,y,V,B){c.info(function(){if(c.g)if(B)for(var he="",ut=B.split("&"),dn=0;dn<ut.length;dn++){var tt=ut[dn].split("=");if(1<tt.length){var gn=tt[0];tt=tt[1];var _n=gn.split("_");he=2<=_n.length&&_n[1]=="type"?he+(gn+"="+tt+"&"):he+(gn+"=redacted&")}}else he=null;else he=B;return"XMLHTTP REQ ("+y+") [attempt "+V+"]: "+h+`
`+m+`
`+he})}function Js(c,h,m,y,V,B,he){c.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+V+"]: "+h+`
`+m+`
`+B+" "+he})}function nr(c,h,m,y){c.info(function(){return"XMLHTTP TEXT ("+h+"): "+Ed(c,m)+(y?" "+y:"")})}function Id(c,h){c.info(function(){return"TIMEOUT: "+h})}Qs.prototype.info=function(){};function Ed(c,h){if(!c.g)return h;if(!h)return null;try{var m=JSON.parse(h);if(m){for(c=0;c<m.length;c++)if(Array.isArray(m[c])){var y=m[c];if(!(2>y.length)){var V=y[1];if(Array.isArray(V)&&!(1>V.length)){var B=V[0];if(B!="noop"&&B!="stop"&&B!="close")for(var he=1;he<V.length;he++)V[he]=""}}}}return Pt(m)}catch{return h}}var ds={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Dn={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},$i;function ji(){}C(ji,hr),ji.prototype.g=function(){return new XMLHttpRequest},ji.prototype.i=function(){return{}},$i=new ji;function rr(c,h,m,y){this.j=c,this.i=h,this.l=m,this.R=y||1,this.U=new Lt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new tc}function tc(){this.i=null,this.g="",this.h=!1}var qi={},pr={};function Ys(c,h,m){c.L=1,c.v=Wi(sr(h)),c.m=m,c.P=!0,Xs(c,null)}function Xs(c,h){c.F=Date.now(),zi(c),c.A=sr(c.v);var m=c.A,y=c.R;Array.isArray(y)||(y=[String(y)]),Qi(m.i,"t",y),c.C=0,m=c.j.J,c.h=new tc,c.g=um(c.j,m?h:null,!c.m),0<c.O&&(c.M=new xn(g(c.Y,c,c.g),c.O)),h=c.U,m=c.g,y=c.ca;var V="readystatechange";Array.isArray(V)||(V&&(Hn[0]=V.toString()),V=Hn);for(var B=0;B<V.length;B++){var he=Q(m,V[B],y||h.handleEvent,!1,h.h||h);if(!he)break;h.g[he.key]=he}h=c.H?w(c.H):{},c.m?(c.u||(c.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,h)):(c.u="GET",c.g.ea(c.A,c.u,null,h)),yt(),bd(c.i,c.u,c.A,c.l,c.R,c.m)}rr.prototype.ca=function(c){c=c.target;const h=this.M;h&&te(c)==3?h.j():this.Y(c)},rr.prototype.Y=function(c){try{if(c==this.g)e:{const _n=te(this.g);var h=this.g.Ba();const Xi=this.g.Z();if(!(3>_n)&&(_n!=3||this.g&&(this.h.h||this.g.oa()||mt(this.g)))){this.J||_n!=4||h==7||(h==8||0>=Xi?yt(3):yt(2)),Gi(this);var m=this.g.Z();this.X=m;t:if(ua(this)){var y=mt(this.g);c="";var V=y.length,B=te(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Wn(this),mr(this);var he="";break t}this.h.i=new a.TextDecoder}for(h=0;h<V;h++)this.h.h=!0,c+=this.h.i.decode(y[h],{stream:!(B&&h==V-1)});y.length=0,this.h.g+=c,this.C=0,he=this.h.g}else he=this.g.oa();if(this.o=m==200,Js(this.i,this.u,this.A,this.l,this.R,_n,m),this.o){if(this.T&&!this.K){t:{if(this.g){var ut,dn=this.g;if((ut=dn.g?dn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(ut)){var tt=ut;break t}}tt=null}if(m=tt)nr(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hs(this,m);else{this.o=!1,this.s=3,un(12),Wn(this),mr(this);break e}}if(this.P){m=!0;let ir;for(;!this.J&&this.C<he.length;)if(ir=Td(this,he),ir==pr){_n==4&&(this.s=4,un(14),m=!1),nr(this.i,this.l,null,"[Incomplete Response]");break}else if(ir==qi){this.s=4,un(15),nr(this.i,this.l,he,"[Invalid Chunk]"),m=!1;break}else nr(this.i,this.l,ir,null),hs(this,ir);if(ua(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),_n!=4||he.length!=0||this.h.h||(this.s=1,un(16),m=!1),this.o=this.o&&m,!m)nr(this.i,this.l,he,"[Invalid Chunked Response]"),Wn(this),mr(this);else if(0<he.length&&!this.W){this.W=!0;var gn=this.j;gn.g==this&&gn.ba&&!gn.M&&(gn.j.info("Great, no buffering proxy detected. Bytes received: "+he.length),Md(gn),gn.M=!0,un(11))}}else nr(this.i,this.l,he,null),hs(this,he);_n==4&&Wn(this),this.o&&!this.J&&(_n==4?om(this.j,this):(this.o=!1,zi(this)))}else Zp(this.g),m==400&&0<he.indexOf("Unknown SID")?(this.s=3,un(12)):(this.s=0,un(13)),Wn(this),mr(this)}}}catch{}finally{}};function ua(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function Td(c,h){var m=c.C,y=h.indexOf(`
`,m);return y==-1?pr:(m=Number(h.substring(m,y)),isNaN(m)?qi:(y+=1,y+m>h.length?pr:(h=h.slice(y,y+m),c.C=y+m,h)))}rr.prototype.cancel=function(){this.J=!0,Wn(this)};function zi(c){c.S=Date.now()+c.I,da(c,c.I)}function da(c,h){if(c.B!=null)throw Error("WatchDog timer not null");c.B=us(g(c.ba,c),h)}function Gi(c){c.B&&(a.clearTimeout(c.B),c.B=null)}rr.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(Id(this.i,this.A),this.L!=2&&(yt(),un(17)),Wn(this),this.s=2,mr(this)):da(this,this.S-c)};function mr(c){c.j.G==0||c.J||om(c.j,c)}function Wn(c){Gi(c);var h=c.M;h&&typeof h.ma=="function"&&h.ma(),c.M=null,Ws(c.U),c.g&&(h=c.g,c.g=null,h.abort(),h.ma())}function hs(c,h){try{var m=c.j;if(m.G!=0&&(m.g==c||ha(m.h,c))){if(!c.K&&ha(m.h,c)&&m.G==3){try{var y=m.Da.g.parse(h)}catch{y=null}if(Array.isArray(y)&&y.length==3){var V=y;if(V[0]==0){e:if(!m.u){if(m.g)if(m.g.F+3e3<c.F)pc(m),hc(m);else break e;Od(m),un(18)}}else m.za=V[1],0<m.za-m.T&&37500>V[2]&&m.F&&m.v==0&&!m.C&&(m.C=us(g(m.Za,m),6e3));if(1>=sc(m.h)&&m.ca){try{m.ca()}catch{}m.ca=void 0}}else ni(m,11)}else if((c.K||m.g==c)&&pc(m),!U(h))for(V=m.Da.g.parse(h),h=0;h<V.length;h++){let tt=V[h];if(m.T=tt[0],tt=tt[1],m.G==2)if(tt[0]=="c"){m.K=tt[1],m.ia=tt[2];const gn=tt[3];gn!=null&&(m.la=gn,m.j.info("VER="+m.la));const _n=tt[4];_n!=null&&(m.Aa=_n,m.j.info("SVER="+m.Aa));const Xi=tt[5];Xi!=null&&typeof Xi=="number"&&0<Xi&&(y=1.5*Xi,m.L=y,m.j.info("backChannelRequestTimeoutMs_="+y)),y=m;const ir=c.g;if(ir){const gc=ir.g?ir.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(gc){var B=y.h;B.g||gc.indexOf("spdy")==-1&&gc.indexOf("quic")==-1&&gc.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&(fa(B,B.h),B.h=null))}if(y.D){const Ld=ir.g?ir.g.getResponseHeader("X-HTTP-Session-Id"):null;Ld&&(y.ya=Ld,Xe(y.I,y.D,Ld))}}m.G=3,m.l&&m.l.ua(),m.ba&&(m.R=Date.now()-c.F,m.j.info("Handshake RTT: "+m.R+"ms")),y=m;var he=c;if(y.qa=cm(y,y.J?y.ia:null,y.W),he.K){Zs(y.h,he);var ut=he,dn=y.L;dn&&(ut.I=dn),ut.B&&(Gi(ut),zi(ut)),y.g=he}else sm(y);0<m.i.length&&fc(m)}else tt[0]!="stop"&&tt[0]!="close"||ni(m,7);else m.G==3&&(tt[0]=="stop"||tt[0]=="close"?tt[0]=="stop"?ni(m,7):Nd(m):tt[0]!="noop"&&m.l&&m.l.ta(tt),m.v=0)}}yt(4)}catch{}}var Ad=class{constructor(c,h){this.g=c,this.map=h}};function nc(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function rc(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function sc(c){return c.h?1:c.g?c.g.size:0}function ha(c,h){return c.h?c.h==h:c.g?c.g.has(h):!1}function fa(c,h){c.g?c.g.add(h):c.h=h}function Zs(c,h){c.h&&c.h==h?c.h=null:c.g&&c.g.has(h)&&c.g.delete(h)}nc.prototype.cancel=function(){if(this.i=ic(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function ic(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let h=c.i;for(const m of c.g.values())h=h.concat(m.D);return h}return P(c.i)}function xd(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var h=[],m=c.length,y=0;y<m;y++)h.push(c[y]);return h}h=[],m=0;for(y in c)h[m++]=c[y];return h}function Pd(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var h=[];c=c.length;for(var m=0;m<c;m++)h.push(m);return h}h=[],m=0;for(const y in c)h[m++]=y;return h}}}function oc(c,h){if(c.forEach&&typeof c.forEach=="function")c.forEach(h,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,h,void 0);else for(var m=Pd(c),y=xd(c),V=y.length,B=0;B<V;B++)h.call(void 0,y[B],m&&m[B],c)}var pa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Sd(c,h){if(c){c=c.split("&");for(var m=0;m<c.length;m++){var y=c[m].indexOf("="),V=null;if(0<=y){var B=c[m].substring(0,y);V=c[m].substring(y+1)}else B=c[m];h(B,V?decodeURIComponent(V.replace(/\+/g," ")):"")}}}function gr(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof gr){this.h=c.h,Ki(this,c.j),this.o=c.o,this.g=c.g,Hi(this,c.s),this.l=c.l;var h=c.i,m=new ti;m.i=h.i,h.g&&(m.g=new Map(h.g),m.h=h.h),ac(this,m),this.m=c.m}else c&&(h=String(c).match(pa))?(this.h=!1,Ki(this,h[1]||"",!0),this.o=ei(h[2]||""),this.g=ei(h[3]||"",!0),Hi(this,h[4]),this.l=ei(h[5]||"",!0),ac(this,h[6]||"",!0),this.m=ei(h[7]||"")):(this.h=!1,this.i=new ti(null,this.h))}gr.prototype.toString=function(){var c=[],h=this.j;h&&c.push(_r(h,ma,!0),":");var m=this.g;return(m||h=="file")&&(c.push("//"),(h=this.o)&&c.push(_r(h,ma,!0),"@"),c.push(encodeURIComponent(String(m)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.s,m!=null&&c.push(":",String(m))),(m=this.l)&&(this.g&&m.charAt(0)!="/"&&c.push("/"),c.push(_r(m,m.charAt(0)=="/"?cc:Rd,!0))),(m=this.i.toString())&&c.push("?",m),(m=this.m)&&c.push("#",_r(m,kd)),c.join("")};function sr(c){return new gr(c)}function Ki(c,h,m){c.j=m?ei(h,!0):h,c.j&&(c.j=c.j.replace(/:$/,""))}function Hi(c,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);c.s=h}else c.s=null}function ac(c,h,m){h instanceof ti?(c.i=h,Dd(c.i,c.h)):(m||(h=_r(h,Cd)),c.i=new ti(h,c.h))}function Xe(c,h,m){c.i.set(h,m)}function Wi(c){return Xe(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function ei(c,h){return c?h?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function _r(c,h,m){return typeof c=="string"?(c=encodeURI(c).replace(h,lc),m&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function lc(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var ma=/[#\/\?@]/g,Rd=/[#\?:]/g,cc=/[#\?]/g,Cd=/[#\?@]/g,kd=/#/g;function ti(c,h){this.h=this.g=null,this.i=c||null,this.j=!!h}function Qn(c){c.g||(c.g=new Map,c.h=0,c.i&&Sd(c.i,function(h,m){c.add(decodeURIComponent(h.replace(/\+/g," ")),m)}))}n=ti.prototype,n.add=function(c,h){Qn(this),this.i=null,c=Nr(this,c);var m=this.g.get(c);return m||this.g.set(c,m=[]),m.push(h),this.h+=1,this};function uc(c,h){Qn(c),h=Nr(c,h),c.g.has(h)&&(c.i=null,c.h-=c.g.get(h).length,c.g.delete(h))}function ga(c,h){return Qn(c),h=Nr(c,h),c.g.has(h)}n.forEach=function(c,h){Qn(this),this.g.forEach(function(m,y){m.forEach(function(V){c.call(h,V,y,this)},this)},this)},n.na=function(){Qn(this);const c=Array.from(this.g.values()),h=Array.from(this.g.keys()),m=[];for(let y=0;y<h.length;y++){const V=c[y];for(let B=0;B<V.length;B++)m.push(h[y])}return m},n.V=function(c){Qn(this);let h=[];if(typeof c=="string")ga(this,c)&&(h=h.concat(this.g.get(Nr(this,c))));else{c=Array.from(this.g.values());for(let m=0;m<c.length;m++)h=h.concat(c[m])}return h},n.set=function(c,h){return Qn(this),this.i=null,c=Nr(this,c),ga(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[h]),this.h+=1,this},n.get=function(c,h){return c?(c=this.V(c),0<c.length?String(c[0]):h):h};function Qi(c,h,m){uc(c,h),0<m.length&&(c.i=null,c.g.set(Nr(c,h),P(m)),c.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],h=Array.from(this.g.keys());for(var m=0;m<h.length;m++){var y=h[m];const B=encodeURIComponent(String(y)),he=this.V(y);for(y=0;y<he.length;y++){var V=B;he[y]!==""&&(V+="="+encodeURIComponent(String(he[y]))),c.push(V)}}return this.i=c.join("&")};function Nr(c,h){return h=String(h),c.j&&(h=h.toLowerCase()),h}function Dd(c,h){h&&!c.j&&(Qn(c),c.i=null,c.g.forEach(function(m,y){var V=y.toLowerCase();y!=V&&(uc(this,y),Qi(this,V,m))},c)),c.j=h}function Ji(c,h){const m=new Qs;if(a.Image){const y=new Image;y.onload=_(vr,m,"TestLoadImage: loaded",!0,h,y),y.onerror=_(vr,m,"TestLoadImage: error",!1,h,y),y.onabort=_(vr,m,"TestLoadImage: abort",!1,h,y),y.ontimeout=_(vr,m,"TestLoadImage: timeout",!1,h,y),a.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=c}else h(!1)}function dc(c,h){const m=new Qs,y=new AbortController,V=setTimeout(()=>{y.abort(),vr(m,"TestPingServer: timeout",!1,h)},1e4);fetch(c,{signal:y.signal}).then(B=>{clearTimeout(V),B.ok?vr(m,"TestPingServer: ok",!0,h):vr(m,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(V),vr(m,"TestPingServer: error",!1,h)})}function vr(c,h,m,y,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),y(m)}catch{}}function Vd(){this.g=new tr}function E(c,h,m){const y=m||"";try{oc(c,function(V,B){let he=V;u(V)&&(he=Pt(V)),h.push(y+B+"="+encodeURIComponent(he))})}catch(V){throw h.push(y+"type="+encodeURIComponent("_badmap")),V}}function v(c){this.l=c.Ub||null,this.j=c.eb||!1}C(v,hr),v.prototype.g=function(){return new z(this.l,this.j)},v.prototype.i=function(c){return function(){return c}}({});function z(c,h){Pe.call(this),this.D=c,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(z,Pe),n=z.prototype,n.open=function(c,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=h,this.readyState=1,Oe(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(h.body=c),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,be(this)),this.readyState=0},n.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Oe(this)),this.g&&(this.readyState=3,Oe(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;se(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function se(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}n.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var h=c.value?c.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!c.done}))&&(this.response=this.responseText+=h)}c.done?be(this):Oe(this),this.readyState==3&&se(this)}},n.Ra=function(c){this.g&&(this.response=this.responseText=c,be(this))},n.Qa=function(c){this.g&&(this.response=c,be(this))},n.ga=function(){this.g&&be(this)};function be(c){c.readyState=4,c.l=null,c.j=null,c.v=null,Oe(c)}n.setRequestHeader=function(c,h){this.u.append(c,h)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],h=this.h.entries();for(var m=h.next();!m.done;)m=m.value,c.push(m[0]+": "+m[1]),m=h.next();return c.join(`\r
`)};function Oe(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(z.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Ue(c){let h="";return ae(c,function(m,y){h+=y,h+=":",h+=m,h+=`\r
`}),h}function Ye(c,h,m){e:{for(y in m){var y=!1;break e}y=!0}y||(m=Ue(m),typeof c=="string"?m!=null&&encodeURIComponent(String(m)):Xe(c,h,m))}function Me(c){Pe.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C(Me,Pe);var Xt=/^https?$/i,Ft=["POST","PUT"];n=Me.prototype,n.Ha=function(c){this.J=c},n.ea=function(c,h,m,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);h=h?h.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():$i.g(),this.v=this.o?ls(this.o):ls($i),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(c),!0),this.B=!1}catch(B){ze(this,B);return}if(c=m||"",m=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var V in y)m.set(V,y[V]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(const B of y.keys())m.set(B,y.get(B));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(m.keys()).find(B=>B.toLowerCase()=="content-type"),V=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Ft,h,void 0))||y||V||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[B,he]of m)this.g.setRequestHeader(B,he);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Bn(this),this.u=!0,this.g.send(c),this.u=!1}catch(B){ze(this,B)}};function ze(c,h){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=h,c.m=5,Ut(c),Zt(c)}function Ut(c){c.A||(c.A=!0,Ne(c,"complete"),Ne(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,Ne(this,"complete"),Ne(this,"abort"),Zt(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zt(this,!0)),Me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Vt(this):this.bb())},n.bb=function(){Vt(this)};function Vt(c){if(c.h&&typeof o<"u"&&(!c.v[1]||te(c)!=4||c.Z()!=2)){if(c.u&&te(c)==4)Ke(c.Ea,0,c);else if(Ne(c,"readystatechange"),te(c)==4){c.h=!1;try{const he=c.Z();e:switch(he){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var m;if(!(m=h)){var y;if(y=he===0){var V=String(c.D).match(pa)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),y=!Xt.test(V?V.toLowerCase():"")}m=y}if(m)Ne(c,"complete"),Ne(c,"success");else{c.m=6;try{var B=2<te(c)?c.g.statusText:""}catch{B=""}c.l=B+" ["+c.Z()+"]",Ut(c)}}finally{Zt(c)}}}}function Zt(c,h){if(c.g){Bn(c);const m=c.g,y=c.v[0]?()=>{}:null;c.g=null,c.v=null,h||Ne(c,"ready");try{m.onreadystatechange=y}catch{}}}function Bn(c){c.I&&(a.clearTimeout(c.I),c.I=null)}n.isActive=function(){return!!this.g};function te(c){return c.g?c.g.readyState:0}n.Z=function(){try{return 2<te(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(c){if(this.g){var h=this.g.responseText;return c&&h.indexOf(c)==0&&(h=h.substring(c.length)),cn(h)}};function mt(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function Zp(c){const h={};c=(c.g&&2<=te(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<c.length;y++){if(U(c[y]))continue;var m=k(c[y]);const V=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();const B=h[V]||[];h[V]=B,B.push(m)}T(h,function(y){return y.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function _a(c,h,m){return m&&m.internalChannelParams&&m.internalChannelParams[c]||h}function em(c){this.Aa=0,this.i=[],this.j=new Qs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=_a("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=_a("baseRetryDelayMs",5e3,c),this.cb=_a("retryDelaySeedMs",1e4,c),this.Wa=_a("forwardChannelMaxRetries",2,c),this.wa=_a("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new nc(c&&c.concurrentRequestLimit),this.Da=new Vd,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=em.prototype,n.la=8,n.G=1,n.connect=function(c,h,m,y){un(0),this.W=c,this.H=h||{},m&&y!==void 0&&(this.H.OSID=m,this.H.OAID=y),this.F=this.X,this.I=cm(this,null,this.W),fc(this)};function Nd(c){if(tm(c),c.G==3){var h=c.U++,m=sr(c.I);if(Xe(m,"SID",c.K),Xe(m,"RID",h),Xe(m,"TYPE","terminate"),va(c,m),h=new rr(c,c.j,h),h.L=2,h.v=Wi(sr(m)),m=!1,a.navigator&&a.navigator.sendBeacon)try{m=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!m&&a.Image&&(new Image().src=h.v,m=!0),m||(h.g=um(h.j,null),h.g.ea(h.v)),h.F=Date.now(),zi(h)}lm(c)}function hc(c){c.g&&(Md(c),c.g.cancel(),c.g=null)}function tm(c){hc(c),c.u&&(a.clearTimeout(c.u),c.u=null),pc(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function fc(c){if(!rc(c.h)&&!c.s){c.s=!0;var h=c.Ga;Le||ke(),ie||(Le(),ie=!0),ee.add(h,c),c.B=0}}function eI(c,h){return sc(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=h.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=us(g(c.Ga,c,h),am(c,c.B)),c.B++,!0)}n.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const V=new rr(this,this.j,c);let B=this.o;if(this.S&&(B?(B=w(B),S(B,this.S)):B=this.S),this.m!==null||this.O||(V.H=B,B=null),this.P)e:{for(var h=0,m=0;m<this.i.length;m++){t:{var y=this.i[m];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(h+=y,4096<h){h=m;break e}if(h===4096||m===this.i.length-1){h=m+1;break e}}h=1e3}else h=1e3;h=rm(this,V,h),m=sr(this.I),Xe(m,"RID",c),Xe(m,"CVER",22),this.D&&Xe(m,"X-HTTP-Session-Id",this.D),va(this,m),B&&(this.O?h="headers="+encodeURIComponent(String(Ue(B)))+"&"+h:this.m&&Ye(m,this.m,B)),fa(this.h,V),this.Ua&&Xe(m,"TYPE","init"),this.P?(Xe(m,"$req",h),Xe(m,"SID","null"),V.T=!0,Ys(V,m,null)):Ys(V,m,h),this.G=2}}else this.G==3&&(c?nm(this,c):this.i.length==0||rc(this.h)||nm(this))};function nm(c,h){var m;h?m=h.l:m=c.U++;const y=sr(c.I);Xe(y,"SID",c.K),Xe(y,"RID",m),Xe(y,"AID",c.T),va(c,y),c.m&&c.o&&Ye(y,c.m,c.o),m=new rr(c,c.j,m,c.B+1),c.m===null&&(m.H=c.o),h&&(c.i=h.D.concat(c.i)),h=rm(c,m,1e3),m.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),fa(c.h,m),Ys(m,y,h)}function va(c,h){c.H&&ae(c.H,function(m,y){Xe(h,y,m)}),c.l&&oc({},function(m,y){Xe(h,y,m)})}function rm(c,h,m){m=Math.min(c.i.length,m);var y=c.l?g(c.l.Na,c.l,c):null;e:{var V=c.i;let B=-1;for(;;){const he=["count="+m];B==-1?0<m?(B=V[0].g,he.push("ofs="+B)):B=0:he.push("ofs="+B);let ut=!0;for(let dn=0;dn<m;dn++){let tt=V[dn].g;const gn=V[dn].map;if(tt-=B,0>tt)B=Math.max(0,V[dn].g-100),ut=!1;else try{E(gn,he,"req"+tt+"_")}catch{y&&y(gn)}}if(ut){y=he.join("&");break e}}}return c=c.i.splice(0,m),h.D=c,y}function sm(c){if(!c.g&&!c.u){c.Y=1;var h=c.Fa;Le||ke(),ie||(Le(),ie=!0),ee.add(h,c),c.v=0}}function Od(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=us(g(c.Fa,c),am(c,c.v)),c.v++,!0)}n.Fa=function(){if(this.u=null,im(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=us(g(this.ab,this),c)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,un(10),hc(this),im(this))};function Md(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function im(c){c.g=new rr(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var h=sr(c.qa);Xe(h,"RID","rpc"),Xe(h,"SID",c.K),Xe(h,"AID",c.T),Xe(h,"CI",c.F?"0":"1"),!c.F&&c.ja&&Xe(h,"TO",c.ja),Xe(h,"TYPE","xmlhttp"),va(c,h),c.m&&c.o&&Ye(h,c.m,c.o),c.L&&(c.g.I=c.L);var m=c.g;c=c.ia,m.L=1,m.v=Wi(sr(h)),m.m=null,m.P=!0,Xs(m,c)}n.Za=function(){this.C!=null&&(this.C=null,hc(this),Od(this),un(19))};function pc(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function om(c,h){var m=null;if(c.g==h){pc(c),Md(c),c.g=null;var y=2}else if(ha(c.h,h))m=h.D,Zs(c.h,h),y=1;else return;if(c.G!=0){if(h.o)if(y==1){m=h.m?h.m.length:0,h=Date.now()-h.F;var V=c.B;y=rt(),Ne(y,new ca(y,m)),fc(c)}else sm(c);else if(V=h.s,V==3||V==0&&0<h.X||!(y==1&&eI(c,h)||y==2&&Od(c)))switch(m&&0<m.length&&(h=c.h,h.i=h.i.concat(m)),V){case 1:ni(c,5);break;case 4:ni(c,10);break;case 3:ni(c,6);break;default:ni(c,2)}}}function am(c,h){let m=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(m*=2),m*h}function ni(c,h){if(c.j.info("Error code "+h),h==2){var m=g(c.fb,c),y=c.Xa;const V=!y;y=new gr(y||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ki(y,"https"),Wi(y),V?Ji(y.toString(),m):dc(y.toString(),m)}else un(2);c.G=0,c.l&&c.l.sa(h),lm(c),tm(c)}n.fb=function(c){c?(this.j.info("Successfully pinged google.com"),un(2)):(this.j.info("Failed to ping google.com"),un(1))};function lm(c){if(c.G=0,c.ka=[],c.l){const h=ic(c.h);(h.length!=0||c.i.length!=0)&&(R(c.ka,h),R(c.ka,c.i),c.h.i.length=0,P(c.i),c.i.length=0),c.l.ra()}}function cm(c,h,m){var y=m instanceof gr?sr(m):new gr(m);if(y.g!="")h&&(y.g=h+"."+y.g),Hi(y,y.s);else{var V=a.location;y=V.protocol,h=h?h+"."+V.hostname:V.hostname,V=+V.port;var B=new gr(null);y&&Ki(B,y),h&&(B.g=h),V&&Hi(B,V),m&&(B.l=m),y=B}return m=c.D,h=c.ya,m&&h&&Xe(y,m,h),Xe(y,"VER",c.la),va(c,y),y}function um(c,h,m){if(h&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=c.Ca&&!c.pa?new Me(new v({eb:m})):new Me(c.pa),h.Ha(c.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function dm(){}n=dm.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function mc(){}mc.prototype.g=function(c,h){return new $n(c,h)};function $n(c,h){Pe.call(this),this.g=new em(h),this.l=c,this.h=h&&h.messageUrlParams||null,c=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(c?c["X-WebChannel-Content-Type"]=h.messageContentType:c={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(c?c["X-WebChannel-Client-Profile"]=h.va:c={"X-WebChannel-Client-Profile":h.va}),this.g.S=c,(c=h&&h.Sb)&&!U(c)&&(this.g.m=c),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!U(h)&&(this.g.D=h,c=this.h,c!==null&&h in c&&(c=this.h,h in c&&delete c[h])),this.j=new Yi(this)}C($n,Pe),$n.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},$n.prototype.close=function(){Nd(this.g)},$n.prototype.o=function(c){var h=this.g;if(typeof c=="string"){var m={};m.__data__=c,c=m}else this.u&&(m={},m.__data__=Pt(c),c=m);h.i.push(new Ad(h.Ya++,c)),h.G==3&&fc(h)},$n.prototype.N=function(){this.g.l=null,delete this.j,Nd(this.g),delete this.g,$n.aa.N.call(this)};function hm(c){aa.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var h=c.__sm__;if(h){e:{for(const m in h){c=m;break e}c=void 0}(this.i=c)&&(c=this.i,h=h!==null&&c in h?h[c]:void 0),this.data=h}else this.data=c}C(hm,aa);function fm(){la.call(this),this.status=1}C(fm,la);function Yi(c){this.g=c}C(Yi,dm),Yi.prototype.ua=function(){Ne(this.g,"a")},Yi.prototype.ta=function(c){Ne(this.g,new hm(c))},Yi.prototype.sa=function(c){Ne(this.g,new fm)},Yi.prototype.ra=function(){Ne(this.g,"b")},mc.prototype.createWebChannel=mc.prototype.g,$n.prototype.send=$n.prototype.o,$n.prototype.open=$n.prototype.m,$n.prototype.close=$n.prototype.close,$y=function(){return new mc},By=function(){return rt()},Uy=Vr,Mh={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ds.NO_ERROR=0,ds.TIMEOUT=8,ds.HTTP_ERROR=6,Nc=ds,Dn.COMPLETE="complete",Fy=Dn,cs.EventType=fr,fr.OPEN="a",fr.CLOSE="b",fr.ERROR="c",fr.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,Na=cs,Me.prototype.listenOnce=Me.prototype.L,Me.prototype.getLastError=Me.prototype.Ka,Me.prototype.getLastErrorCode=Me.prototype.Ba,Me.prototype.getStatus=Me.prototype.Z,Me.prototype.getResponseJson=Me.prototype.Oa,Me.prototype.getResponseText=Me.prototype.oa,Me.prototype.send=Me.prototype.ea,Me.prototype.setWithCredentials=Me.prototype.Ha,Ly=Me}).apply(typeof wc<"u"?wc:typeof self<"u"?self:typeof window<"u"?window:{});const vg="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}sn.UNAUTHENTICATED=new sn(null),sn.GOOGLE_CREDENTIALS=new sn("google-credentials-uid"),sn.FIRST_PARTY=new sn("first-party-uid"),sn.MOCK_USER=new sn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wo="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Os=new Rf("@firebase/firestore");function oo(){return Os.logLevel}function kL(n){Os.setLogLevel(n)}function J(n,...e){if(Os.logLevel<=He.DEBUG){const t=e.map(kf);Os.debug(`Firestore (${Wo}): ${n}`,...t)}}function Bt(n,...e){if(Os.logLevel<=He.ERROR){const t=e.map(kf);Os.error(`Firestore (${Wo}): ${n}`,...t)}}function Zn(n,...e){if(Os.logLevel<=He.WARN){const t=e.map(kf);Os.warn(`Firestore (${Wo}): ${n}`,...t)}}function kf(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _e(n="Unexpected state"){const e=`FIRESTORE (${Wo}) INTERNAL ASSERTION FAILED: `+n;throw Bt(e),new Error(e)}function Ie(n,e){n||_e()}function DL(n,e){n||_e()}function ce(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Y extends ts{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jy{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class oP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(sn.UNAUTHENTICATED))}shutdown(){}}class aP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class lP{constructor(e){this.t=e,this.currentUser=sn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ie(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new on;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new on,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{J("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(J("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new on)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(J("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ie(typeof r.accessToken=="string"),new jy(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ie(e===null||typeof e=="string"),new sn(e)}}class cP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=sn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class uP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new cP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(sn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qy{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class dP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Ie(this.o===void 0);const r=i=>{i.error!=null&&J("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,J("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{J("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):J("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ie(typeof t.token=="string"),this.R=t.token,new qy(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class VL{getToken(){return Promise.resolve(new qy(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=hP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ve(n,e){return n<e?-1:n>e?1:0}function Co(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function Gy(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Y(F.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Y(F.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ct.fromMillis(Date.now())}static fromDate(e){return Ct.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ct(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ve(this.nanoseconds,e.nanoseconds):Ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Te(e)}static min(){return new Te(new Ct(0,0))}static max(){return new Te(new Ct(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(e,t,r){t===void 0?t=0:t>e.length&&_e(),r===void 0?r=e.length-t:r>e.length-t&&_e(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return cl.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof cl?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class We extends cl{construct(e,t,r){return new We(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Y(F.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new We(t)}static emptyPath(){return new We([])}}const fP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Tt extends cl{construct(e,t,r){return new Tt(e,t,r)}static isValidIdentifier(e){return fP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Tt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Tt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Y(F.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Y(F.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Y(F.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new Y(F.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Tt(t)}static emptyPath(){return new Tt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e){this.path=e}static fromPath(e){return new pe(We.fromString(e))}static fromName(e){return new pe(We.fromString(e).popFirst(5))}static empty(){return new pe(We.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&We.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return We.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pe(new We(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Lh(n){return n.fields.find(e=>e.kind===2)}function li(n){return n.fields.filter(e=>e.kind!==2)}function pP(n,e){let t=Ve(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=mP(n.fields[r],e.fields[r]),t!==0)return t;return Ve(n.fields.length,e.fields.length)}ko.UNKNOWN_ID=-1;class yi{constructor(e,t){this.fieldPath=e,this.kind=t}}function mP(n,e){const t=Tt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ve(n.kind,e.kind)}class Do{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Do(0,Kn.min())}}function Ky(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Te.fromTimestamp(r===1e9?new Ct(t+1,0):new Ct(t,r));return new Kn(s,pe.empty(),e)}function Hy(n){return new Kn(n.readTime,n.key,-1)}class Kn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Kn(Te.min(),pe.empty(),-1)}static max(){return new Kn(Te.max(),pe.empty(),-1)}}function Df(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=pe.comparator(n.documentKey,e.documentKey),t!==0?t:Ve(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Qy{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qs(n){if(n.code!==F.FAILED_PRECONDITION||n.message!==Wy)throw n;J("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&_e(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new N((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof N?t:N.resolve(t)}catch(t){return N.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):N.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):N.reject(t)}static resolve(e){return new N((t,r)=>{t(e)})}static reject(e){return new N((t,r)=>{r(e)})}static waitFor(e){return new N((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=N.resolve(!1);for(const r of e)t=t.next(s=>s?N.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new N((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const u=l;t(e[u]).next(d=>{o[u]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new N((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new on,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Wa(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Vf(r.target.error);this.V.reject(new Wa(e,s))}}static open(e,t,r,s){try{return new qu(t,e.transaction(s,r))}catch(i){throw new Wa(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(J("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new _P(t)}}class Pr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Pr.S(en())===12.2&&Bt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return J("SimpleDb","Removing database:",e),ui(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Ry())return!1;if(Pr.v())return!0;const e=en(),t=Pr.S(e),r=0<t&&t<10,s=Jy(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(J("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Wa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new Y(F.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new Y(F.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Wa(e,o))},s.onupgradeneeded=i=>{J("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{J("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=qu.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),N.reject(u))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,u=l.name!=="FirebaseError"&&o<3;if(J("SimpleDb","Transaction failed with error:",l.message,"Retrying:",u),this.close(),!u)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Jy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class gP{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ui(this.B.delete())}}class Wa extends Y{constructor(e,t){super(F.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function zs(n){return n.name==="IndexedDbTransactionError"}class _P{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(J("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(J("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ui(r)}add(e){return J("SimpleDb","ADD",this.store.name,e,e),ui(this.store.add(e))}get(e){return ui(this.store.get(e)).next(t=>(t===void 0&&(t=null),J("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return J("SimpleDb","DELETE",this.store.name,e),ui(this.store.delete(e))}count(){return J("SimpleDb","COUNT",this.store.name),ui(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new N((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new N((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){J("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new N((r,s)=>{t.onerror=i=>{const o=Vf(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new N((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new gP(a),u=t(a.primaryKey,a.value,l);if(u instanceof N){const d=u.catch(f=>(l.done(),N.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>N.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ui(n){return new N((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Vf(r.target.error);t(s)}})}let yg=!1;function Vf(n){const e=Pr.S(en());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new Y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return yg||(yg=!0,setTimeout(()=>{throw r},0)),r}}return n}class vP{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){J("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{J("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){zs(t)?J("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await qs(t)}await this.X(6e4)})}}class yP{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return N.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return J("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(J("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Hy(i);Df(o,r)>0&&(r=o)}),new Kn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Mn.oe=-1;function Vl(n){return n==null}function ul(n){return n===0&&1/n==-1/0}function Yy(n){return typeof n=="number"&&Number.isInteger(n)&&!ul(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=wg(e)),e=wP(n.get(t),e);return wg(e)}function wP(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function wg(n){return n+""}function Tr(n){const e=n.length;if(Ie(e>=2),e===2)return Ie(n.charAt(0)===""&&n.charAt(1)===""),We.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&_e(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:_e()}i=o+2}return new We(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bg=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oc(n,e){return[n,En(e)]}function Xy(n,e,t){return[n,En(e),t]}const bP={},IP=["prefixPath","collectionGroup","readTime","documentId"],EP=["prefixPath","collectionGroup","documentId"],TP=["collectionGroup","readTime","prefixPath","documentId"],AP=["canonicalId","targetId"],xP=["targetId","path"],PP=["path","targetId"],SP=["collectionId","parent"],RP=["indexId","uid"],CP=["uid","sequenceNumber"],kP=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],DP=["indexId","uid","orderedDocumentKey"],VP=["userId","collectionPath","documentId"],NP=["userId","collectionPath","largestBatchId"],OP=["userId","collectionGroup","largestBatchId"],Zy=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],MP=[...Zy,"documentOverlays"],e0=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],t0=e0,Nf=[...t0,"indexConfiguration","indexState","indexEntries"],LP=Nf,FP=[...Nf,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh extends Qy{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function tn(n,e){const t=ce(n);return Pr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ig(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Gs(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function n0(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function r0(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e,t){this.comparator=e,this.root=t||hn.EMPTY}insert(e,t){return new vt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,hn.BLACK,null,null))}remove(e){return new vt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bc(this.root,e,this.comparator,!1)}getReverseIterator(){return new bc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bc(this.root,e,this.comparator,!0)}}class bc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class hn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??hn.RED,this.left=s??hn.EMPTY,this.right=i??hn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new hn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return hn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return hn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,hn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,hn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw _e();const e=this.left.check();if(e!==this.right.check())throw _e();return e+(this.isRed()?0:1)}}hn.EMPTY=null,hn.RED=!0,hn.BLACK=!1;hn.EMPTY=new class{constructor(){this.size=0}get key(){throw _e()}get value(){throw _e()}get color(){throw _e()}get left(){throw _e()}get right(){throw _e()}copy(e,t,r,s,i){return this}insert(e,t,r){return new hn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e){this.comparator=e,this.data=new vt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Eg(this.data.getIterator())}getIteratorFrom(e){return new Eg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ct)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ct(this.comparator);return t.data=e,t}}class Eg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function eo(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.fields=e,e.sort(Tt.comparator)}static empty(){return new Ln([])}unionWith(e){let t=new ct(Tt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ln(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Co(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new s0("Invalid base64 string: "+i):i}}(e);return new Ot(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Ot(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ot.EMPTY_BYTE_STRING=new Ot("");const UP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qr(n){if(Ie(!!n),typeof n=="string"){let e=0;const t=UP.exec(n);if(Ie(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Et(n.seconds),nanos:Et(n.nanos)}}function Et(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Jr(n){return typeof n=="string"?Ot.fromBase64String(n):Ot.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zu(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Gu(n){const e=n.mapValue.fields.__previous_value__;return zu(e)?Gu(e):e}function dl(n){const e=Qr(n.mapValue.fields.__local_write_time__.timestampValue);return new Ct(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e,t,r,s,i,o,a,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}class Ii{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ii("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Ii&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Mc={nullValue:"NULL_VALUE"};function Ms(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?zu(n)?4:i0(n)?9007199254740991:Ku(n)?10:11:_e()}function Dr(n,e){if(n===e)return!0;const t=Ms(n);if(t!==Ms(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return dl(n).isEqual(dl(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Qr(s.timestampValue),a=Qr(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Jr(s.bytesValue).isEqual(Jr(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Et(s.geoPointValue.latitude)===Et(i.geoPointValue.latitude)&&Et(s.geoPointValue.longitude)===Et(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Et(s.integerValue)===Et(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Et(s.doubleValue),a=Et(i.doubleValue);return o===a?ul(o)===ul(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Co(n.arrayValue.values||[],e.arrayValue.values||[],Dr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Ig(o)!==Ig(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Dr(o[l],a[l])))return!1;return!0}(n,e);default:return _e()}}function hl(n,e){return(n.values||[]).find(t=>Dr(t,e))!==void 0}function Ls(n,e){if(n===e)return 0;const t=Ms(n),r=Ms(e);if(t!==r)return Ve(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ve(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Et(i.integerValue||i.doubleValue),l=Et(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Tg(n.timestampValue,e.timestampValue);case 4:return Tg(dl(n),dl(e));case 5:return Ve(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Jr(i),l=Jr(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const d=Ve(a[u],l[u]);if(d!==0)return d}return Ve(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ve(Et(i.latitude),Et(o.latitude));return a!==0?a:Ve(Et(i.longitude),Et(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Ag(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,u,d;const f=i.fields||{},g=o.fields||{},_=(a=f.value)===null||a===void 0?void 0:a.arrayValue,C=(l=g.value)===null||l===void 0?void 0:l.arrayValue,P=Ve(((u=_==null?void 0:_.values)===null||u===void 0?void 0:u.length)||0,((d=C==null?void 0:C.values)===null||d===void 0?void 0:d.length)||0);return P!==0?P:Ag(_,C)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ps.mapValue&&o===Ps.mapValue)return 0;if(i===Ps.mapValue)return 1;if(o===Ps.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),u=o.fields||{},d=Object.keys(u);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=Ve(l[f],d[f]);if(g!==0)return g;const _=Ls(a[l[f]],u[d[f]]);if(_!==0)return _}return Ve(l.length,d.length)}(n.mapValue,e.mapValue);default:throw _e()}}function Tg(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ve(n,e);const t=Qr(n),r=Qr(e),s=Ve(t.seconds,r.seconds);return s!==0?s:Ve(t.nanos,r.nanos)}function Ag(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ls(t[s],r[s]);if(i)return i}return Ve(t.length,r.length)}function Vo(n){return Uh(n)}function Uh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Qr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Jr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return pe.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Uh(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Uh(t.fields[o])}`;return s+"}"}(n.mapValue):_e()}function Lc(n){switch(Ms(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Gu(n);return e?16+Lc(e):16;case 5:return 2*n.stringValue.length;case 6:return Jr(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Lc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Gs(r.fields,(i,o)=>{s+=i.length+Lc(o)}),s}(n.mapValue);default:throw _e()}}function Ei(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Bh(n){return!!n&&"integerValue"in n}function fl(n){return!!n&&"arrayValue"in n}function xg(n){return!!n&&"nullValue"in n}function Pg(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Fc(n){return!!n&&"mapValue"in n}function Ku(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Qa(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Gs(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Qa(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qa(n.arrayValue.values[t]);return e}return Object.assign({},n)}function i0(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const o0={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function $P(n){return"nullValue"in n?Mc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ei(Ii.empty(),pe.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Ku(n)?o0:{mapValue:{}}:_e()}function jP(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ei(Ii.empty(),pe.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?o0:"mapValue"in n?Ku(n)?{mapValue:{}}:Ps:_e()}function Sg(n,e){const t=Ls(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Rg(n,e){const t=Ls(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(e){this.value=e}static empty(){return new pn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Fc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qa(t)}setAll(e){let t=Tt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Qa(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Fc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Dr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Fc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Gs(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new pn(Qa(this.value))}}function a0(n){const e=[];return Gs(n.fields,(t,r)=>{const s=new Tt([t]);if(Fc(r)){const i=a0(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ln(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new wt(e,0,Te.min(),Te.min(),Te.min(),pn.empty(),0)}static newFoundDocument(e,t,r,s){return new wt(e,1,t,Te.min(),r,s,0)}static newNoDocument(e,t){return new wt(e,2,t,Te.min(),Te.min(),pn.empty(),0)}static newUnknownDocument(e,t){return new wt(e,3,t,Te.min(),Te.min(),pn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Te.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=pn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=pn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Te.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof wt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e,t){this.position=e,this.inclusive=t}}function Cg(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=pe.comparator(pe.fromName(o.referenceValue),t.key):r=Ls(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function kg(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Dr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(e,t="asc"){this.field=e,this.dir=t}}function qP(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{}class Qe extends l0{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new zP(e,t,r):t==="array-contains"?new HP(e,r):t==="in"?new p0(e,r):t==="not-in"?new WP(e,r):t==="array-contains-any"?new QP(e,r):new Qe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new GP(e,r):new KP(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ls(t,this.value)):t!==null&&Ms(this.value)===Ms(t)&&this.matchesComparison(Ls(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return _e()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class at extends l0{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new at(e,t)}matches(e){return No(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function No(n){return n.op==="and"}function $h(n){return n.op==="or"}function Of(n){return c0(n)&&No(n)}function c0(n){for(const e of n.filters)if(e instanceof at)return!1;return!0}function jh(n){if(n instanceof Qe)return n.field.canonicalString()+n.op.toString()+Vo(n.value);if(Of(n))return n.filters.map(e=>jh(e)).join(",");{const e=n.filters.map(t=>jh(t)).join(",");return`${n.op}(${e})`}}function u0(n,e){return n instanceof Qe?function(r,s){return s instanceof Qe&&r.op===s.op&&r.field.isEqual(s.field)&&Dr(r.value,s.value)}(n,e):n instanceof at?function(r,s){return s instanceof at&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&u0(o,s.filters[a]),!0):!1}(n,e):void _e()}function d0(n,e){const t=n.filters.concat(e);return at.create(t,n.op)}function h0(n){return n instanceof Qe?function(t){return`${t.field.canonicalString()} ${t.op} ${Vo(t.value)}`}(n):n instanceof at?function(t){return t.op.toString()+" {"+t.getFilters().map(h0).join(" ,")+"}"}(n):"Filter"}class zP extends Qe{constructor(e,t,r){super(e,t,r),this.key=pe.fromName(r.referenceValue)}matches(e){const t=pe.comparator(e.key,this.key);return this.matchesComparison(t)}}class GP extends Qe{constructor(e,t){super(e,"in",t),this.keys=f0("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class KP extends Qe{constructor(e,t){super(e,"not-in",t),this.keys=f0("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function f0(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>pe.fromName(r.referenceValue))}class HP extends Qe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return fl(t)&&hl(t.arrayValue,this.value)}}class p0 extends Qe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&hl(this.value.arrayValue,t)}}class WP extends Qe{constructor(e,t){super(e,"not-in",t)}matches(e){if(hl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!hl(this.value.arrayValue,t)}}class QP extends Qe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!fl(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>hl(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function qh(n,e=null,t=[],r=[],s=null,i=null,o=null){return new JP(n,e,t,r,s,i,o)}function Ti(n){const e=ce(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>jh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Vl(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Vo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Vo(r)).join(",")),e.ue=t}return e.ue}function Nl(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!qP(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!u0(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!kg(n.startAt,e.startAt)&&kg(n.endAt,e.endAt)}function ou(n){return pe.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function au(n,e){return n.filters.filter(t=>t instanceof Qe&&t.field.isEqual(e))}function Dg(n,e,t){let r=Mc,s=!0;for(const i of au(n,e)){let o=Mc,a=!0;switch(i.op){case"<":case"<=":o=$P(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Mc}Sg({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Sg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Vg(n,e,t){let r=Ps,s=!0;for(const i of au(n,e)){let o=Ps,a=!0;switch(i.op){case">=":case">":o=jP(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ps}Rg({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Rg({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function m0(n,e,t,r,s,i,o,a){return new ns(n,e,t,r,s,i,o,a)}function Qo(n){return new ns(n)}function Ng(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Mf(n){return n.collectionGroup!==null}function vo(n){const e=ce(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ct(Tt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new pl(i,r))}),t.has(Tt.keyField().canonicalString())||e.ce.push(new pl(Tt.keyField(),r))}return e.ce}function Tn(n){const e=ce(n);return e.le||(e.le=_0(e,vo(n))),e.le}function g0(n){const e=ce(n);return e.he||(e.he=_0(e,n.explicitOrderBy)),e.he}function _0(n,e){if(n.limitType==="F")return qh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new pl(s.field,i)});const t=n.endAt?new Fs(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Fs(n.startAt.position,n.startAt.inclusive):null;return qh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function zh(n,e){const t=n.filters.concat([e]);return new ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function lu(n,e,t){return new ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ol(n,e){return Nl(Tn(n),Tn(e))&&n.limitType===e.limitType}function v0(n){return`${Ti(Tn(n))}|lt:${n.limitType}`}function ao(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>h0(s)).join(", ")}]`),Vl(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Vo(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Vo(s)).join(",")),`Target(${r})`}(Tn(n))}; limitType=${n.limitType})`}function Ml(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):pe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of vo(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const u=Cg(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,vo(r),s)||r.endAt&&!function(o,a,l){const u=Cg(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,vo(r),s))}(n,e)}function y0(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function w0(n){return(e,t)=>{let r=!1;for(const s of vo(n)){const i=YP(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function YP(n,e,t){const r=n.field.isKeyField()?pe.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),u=a.data.field(i);return l!==null&&u!==null?Ls(l,u):_e()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return _e()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Gs(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return r0(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XP=new vt(pe.comparator);function Fn(){return XP}const b0=new vt(pe.comparator);function Oa(...n){let e=b0;for(const t of n)e=e.insert(t.key,t);return e}function I0(n){let e=b0;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ar(){return Ja()}function E0(){return Ja()}function Ja(){return new rs(n=>n.toString(),(n,e)=>n.isEqual(e))}const ZP=new vt(pe.comparator),eS=new ct(pe.comparator);function qe(...n){let e=eS;for(const t of n)e=e.add(t);return e}const tS=new ct(Ve);function Lf(){return tS}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ff(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ul(e)?"-0":e}}function T0(n){return{integerValue:""+n}}function A0(n,e){return Yy(e)?T0(e):Ff(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(){this._=void 0}}function nS(n,e,t){return n instanceof Oo?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&zu(i)&&(i=Gu(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Ai?P0(n,e):n instanceof xi?S0(n,e):function(s,i){const o=x0(s,i),a=Og(o)+Og(s.Pe);return Bh(o)&&Bh(s.Pe)?T0(a):Ff(s.serializer,a)}(n,e)}function rS(n,e,t){return n instanceof Ai?P0(n,e):n instanceof xi?S0(n,e):t}function x0(n,e){return n instanceof Mo?function(r){return Bh(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Oo extends Hu{}class Ai extends Hu{constructor(e){super(),this.elements=e}}function P0(n,e){const t=R0(e);for(const r of n.elements)t.some(s=>Dr(s,r))||t.push(r);return{arrayValue:{values:t}}}class xi extends Hu{constructor(e){super(),this.elements=e}}function S0(n,e){let t=R0(e);for(const r of n.elements)t=t.filter(s=>!Dr(s,r));return{arrayValue:{values:t}}}class Mo extends Hu{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Og(n){return Et(n.integerValue||n.doubleValue)}function R0(n){return fl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{constructor(e,t){this.field=e,this.transform=t}}function sS(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Ai&&s instanceof Ai||r instanceof xi&&s instanceof xi?Co(r.elements,s.elements,Dr):r instanceof Mo&&s instanceof Mo?Dr(r.Pe,s.Pe):r instanceof Oo&&s instanceof Oo}(n.transform,e.transform)}class iS{constructor(e,t){this.version=e,this.transformResults=t}}class At{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new At}static exists(e){return new At(void 0,e)}static updateTime(e){return new At(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Uc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Wu{}function C0(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Yo(n.key,At.none()):new Jo(n.key,n.data,At.none());{const t=n.data,r=pn.empty();let s=new ct(Tt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new ss(n.key,r,new Ln(s.toArray()),At.none())}}function oS(n,e,t){n instanceof Jo?function(s,i,o){const a=s.value.clone(),l=Lg(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof ss?function(s,i,o){if(!Uc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Lg(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(k0(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ya(n,e,t,r){return n instanceof Jo?function(i,o,a,l){if(!Uc(i.precondition,o))return a;const u=i.value.clone(),d=Fg(i.fieldTransforms,l,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof ss?function(i,o,a,l){if(!Uc(i.precondition,o))return a;const u=Fg(i.fieldTransforms,l,o),d=o.data;return d.setAll(k0(i)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Uc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function aS(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=x0(r.transform,s||null);i!=null&&(t===null&&(t=pn.empty()),t.set(r.field,i))}return t||null}function Mg(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Co(r,s,(i,o)=>sS(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Jo extends Wu{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ss extends Wu{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function k0(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Lg(n,e,t){const r=new Map;Ie(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,rS(o,a,t[s]))}return r}function Fg(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,nS(i,o,e))}return r}class Yo extends Wu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Uf extends Wu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&oS(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ya(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ya(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=E0();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=C0(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Te.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),qe())}isEqual(e){return this.batchId===e.batchId&&Co(this.mutations,e.mutations,(t,r)=>Mg(t,r))&&Co(this.baseMutations,e.baseMutations,(t,r)=>Mg(t,r))}}class $f{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ie(e.mutations.length===r.length);let s=function(){return ZP}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new $f(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ht,Ze;function V0(n){switch(n){default:return _e();case F.CANCELLED:case F.UNKNOWN:case F.DEADLINE_EXCEEDED:case F.RESOURCE_EXHAUSTED:case F.INTERNAL:case F.UNAVAILABLE:case F.UNAUTHENTICATED:return!1;case F.INVALID_ARGUMENT:case F.NOT_FOUND:case F.ALREADY_EXISTS:case F.PERMISSION_DENIED:case F.FAILED_PRECONDITION:case F.ABORTED:case F.OUT_OF_RANGE:case F.UNIMPLEMENTED:case F.DATA_LOSS:return!0}}function N0(n){if(n===void 0)return Bt("GRPC error has no .code"),F.UNKNOWN;switch(n){case Ht.OK:return F.OK;case Ht.CANCELLED:return F.CANCELLED;case Ht.UNKNOWN:return F.UNKNOWN;case Ht.DEADLINE_EXCEEDED:return F.DEADLINE_EXCEEDED;case Ht.RESOURCE_EXHAUSTED:return F.RESOURCE_EXHAUSTED;case Ht.INTERNAL:return F.INTERNAL;case Ht.UNAVAILABLE:return F.UNAVAILABLE;case Ht.UNAUTHENTICATED:return F.UNAUTHENTICATED;case Ht.INVALID_ARGUMENT:return F.INVALID_ARGUMENT;case Ht.NOT_FOUND:return F.NOT_FOUND;case Ht.ALREADY_EXISTS:return F.ALREADY_EXISTS;case Ht.PERMISSION_DENIED:return F.PERMISSION_DENIED;case Ht.FAILED_PRECONDITION:return F.FAILED_PRECONDITION;case Ht.ABORTED:return F.ABORTED;case Ht.OUT_OF_RANGE:return F.OUT_OF_RANGE;case Ht.UNIMPLEMENTED:return F.UNIMPLEMENTED;case Ht.DATA_LOSS:return F.DATA_LOSS;default:return _e()}}(Ze=Ht||(Ht={}))[Ze.OK=0]="OK",Ze[Ze.CANCELLED=1]="CANCELLED",Ze[Ze.UNKNOWN=2]="UNKNOWN",Ze[Ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ze[Ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ze[Ze.NOT_FOUND=5]="NOT_FOUND",Ze[Ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ze[Ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ze[Ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ze[Ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ze[Ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ze[Ze.ABORTED=10]="ABORTED",Ze[Ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ze[Ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ze[Ze.INTERNAL=13]="INTERNAL",Ze[Ze.UNAVAILABLE=14]="UNAVAILABLE",Ze[Ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O0(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cS=new vi([4294967295,4294967295],0);function Ug(n){const e=O0().encode(n),t=new My;return t.update(e),new Uint8Array(t.digest())}function Bg(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new vi([t,r],0),new vi([s,i],0)]}class qf{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ma(`Invalid padding: ${t}`);if(r<0)throw new Ma(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ma(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ma(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=vi.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(vi.fromNumber(r)));return s.compare(cS)===1&&(s=new vi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Ug(e),[r,s]=Bg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new qf(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Ug(e),[r,s]=Bg(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ma extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Ul.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Fl(Te.min(),s,new vt(Ve),Fn(),qe())}}class Ul{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ul(r,t,qe(),qe(),qe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class M0{constructor(e,t){this.targetId=e,this.me=t}}class L0{constructor(e,t,r=Ot.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class $g{constructor(){this.fe=0,this.ge=qg(),this.pe=Ot.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=qe(),t=qe(),r=qe();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:_e()}}),new Ul(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=qg()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ie(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class uS{constructor(e){this.Le=e,this.Be=new Map,this.ke=Fn(),this.qe=jg(),this.Qe=new vt(Ve)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:_e()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(ou(i))if(r===0){const o=new pe(i.path);this.Ue(t,o,wt.newNoDocument(o,Te.min()))}else Ie(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,u)}cu==null||cu.et(function(d,f,g,_,C){var P,R,L,U,$,j;const M={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},ae=f.unchangedNames;return ae&&(M.bloomFilter={applied:C===0,hashCount:(P=ae==null?void 0:ae.hashCount)!==null&&P!==void 0?P:0,bitmapLength:(U=(L=(R=ae==null?void 0:ae.bits)===null||R===void 0?void 0:R.bitmap)===null||L===void 0?void 0:L.length)!==null&&U!==void 0?U:0,padding:(j=($=ae==null?void 0:ae.bits)===null||$===void 0?void 0:$.padding)!==null&&j!==void 0?j:0,mightContain:T=>{var w;return(w=_==null?void 0:_.mightContain(T))!==null&&w!==void 0&&w}}),M}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Jr(r).toUint8Array()}catch(l){if(l instanceof s0)return Zn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new qf(o,s,i)}catch(l){return Zn(l instanceof Ma?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&ou(a.target)){const l=new pe(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,wt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=qe();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Je(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Fl(e,t,this.Qe,this.ke,r);return this.ke=Fn(),this.qe=jg(),this.Qe=new vt(Ve),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new $g,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new ct(Ve),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||J("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new $g),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function jg(){return new vt(pe.comparator)}function qg(){return new vt(pe.comparator)}const dS=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),hS=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),fS=(()=>({and:"AND",or:"OR"}))();class pS{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Gh(n,e){return n.useProto3Json||Vl(e)?e:{value:e}}function Lo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function F0(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function mS(n,e){return Lo(n,e.toTimestamp())}function qt(n){return Ie(!!n),Te.fromTimestamp(function(t){const r=Qr(t);return new Ct(r.seconds,r.nanos)}(n))}function zf(n,e){return Kh(n,e).canonicalString()}function Kh(n,e){const t=function(s){return new We(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function U0(n){const e=We.fromString(n);return Ie(Q0(e)),e}function ml(n,e){return zf(n.databaseId,e.path)}function Sr(n,e){const t=U0(e);if(t.get(1)!==n.databaseId.projectId)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Y(F.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new pe(j0(t))}function B0(n,e){return zf(n.databaseId,e)}function $0(n){const e=U0(n);return e.length===4?We.emptyPath():j0(e)}function Hh(n){return new We(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function j0(n){return Ie(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function zg(n,e,t){return{name:ml(n,e),fields:t.value.mapValue.fields}}function q0(n,e,t){const r=Sr(n,e.name),s=qt(e.updateTime),i=e.createTime?qt(e.createTime):Te.min(),o=new pn({mapValue:{fields:e.fields}}),a=wt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function gS(n,e){return"found"in e?function(r,s){Ie(!!s.found),s.found.name,s.found.updateTime;const i=Sr(r,s.found.name),o=qt(s.found.updateTime),a=s.found.createTime?qt(s.found.createTime):Te.min(),l=new pn({mapValue:{fields:s.found.fields}});return wt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Ie(!!s.missing),Ie(!!s.readTime);const i=Sr(r,s.missing),o=qt(s.readTime);return wt.newNoDocument(i,o)}(n,e):_e()}function _S(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:_e()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(u,d){return u.useProto3Json?(Ie(d===void 0||typeof d=="string"),Ot.fromBase64String(d||"")):(Ie(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Ot.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const d=u.code===void 0?F.UNKNOWN:N0(u.code);return new Y(d,u.message||"")}(o);t=new L0(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Sr(n,r.document.name),i=qt(r.document.updateTime),o=r.document.createTime?qt(r.document.createTime):Te.min(),a=new pn({mapValue:{fields:r.document.fields}}),l=wt.newFoundDocument(s,i,o,a),u=r.targetIds||[],d=r.removedTargetIds||[];t=new Bc(u,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Sr(n,r.document),i=r.readTime?qt(r.readTime):Te.min(),o=wt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Bc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Sr(n,r.document),i=r.removedTargetIds||[];t=new Bc([],i,s,null)}else{if(!("filter"in e))return _e();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new lS(s,i),a=r.targetId;t=new M0(a,o)}}return t}function gl(n,e){let t;if(e instanceof Jo)t={update:zg(n,e.key,e.value)};else if(e instanceof Yo)t={delete:ml(n,e.key)};else if(e instanceof ss)t={update:zg(n,e.key,e.data),updateMask:ES(e.fieldMask)};else{if(!(e instanceof Uf))return _e();t={verify:ml(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Oo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ai)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof xi)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Mo)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw _e()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:mS(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:_e()}(n,e.precondition)),t}function Wh(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?At.updateTime(qt(i.updateTime)):i.exists!==void 0?At.exists(i.exists):At.none()}(e.currentDocument):At.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Ie(a.setToServerValue==="REQUEST_TIME"),l=new Oo;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new Ai(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new xi(d)}else"increment"in a?l=new Mo(o,a.increment):_e();const u=Tt.fromServerFormat(a.fieldPath);return new Ll(u,l)}(n,s)):[];if(e.update){e.update.name;const s=Sr(n,e.update.name),i=new pn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const u=l.fieldPaths||[];return new Ln(u.map(d=>Tt.fromServerFormat(d)))}(e.updateMask);return new ss(s,i,o,t,r)}return new Jo(s,i,t,r)}if(e.delete){const s=Sr(n,e.delete);return new Yo(s,t)}if(e.verify){const s=Sr(n,e.verify);return new Uf(s,t)}return _e()}function vS(n,e){return n&&n.length>0?(Ie(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?qt(s.updateTime):qt(i);return o.isEqual(Te.min())&&(o=qt(i)),new iS(o,s.transformResults||[])}(t,e))):[]}function z0(n,e){return{documents:[B0(n,e.path)]}}function Qu(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=B0(n,s);const i=function(u){if(u.length!==0)return W0(at.create(u,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(u){if(u.length!==0)return u.map(d=>function(g){return{field:ws(g.field),direction:wS(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Gh(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{_t:t,parent:s}}function G0(n,e,t,r){const{_t:s,parent:i}=Qu(n,e),o={},a=[];let l=0;return t.forEach(u=>{const d=r?u.alias:"aggregate_"+l++;o[d]=u.alias,u.aggregateType==="count"?a.push({alias:d,count:{}}):u.aggregateType==="avg"?a.push({alias:d,avg:{field:ws(u.fieldPath)}}):u.aggregateType==="sum"&&a.push({alias:d,sum:{field:ws(u.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function K0(n){let e=$0(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ie(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=H0(f);return g instanceof at&&Of(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(C){return new pl(lo(C.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Vl(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,_=f.values||[];return new Fs(_,g)}(t.startAt));let u=null;return t.endAt&&(u=function(f){const g=!f.before,_=f.values||[];return new Fs(_,g)}(t.endAt)),m0(e,s,o,i,a,"F",l,u)}function yS(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return _e()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function H0(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=lo(t.unaryFilter.field);return Qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=lo(t.unaryFilter.field);return Qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=lo(t.unaryFilter.field);return Qe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=lo(t.unaryFilter.field);return Qe.create(o,"!=",{nullValue:"NULL_VALUE"});default:return _e()}}(n):n.fieldFilter!==void 0?function(t){return Qe.create(lo(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _e()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return at.create(t.compositeFilter.filters.map(r=>H0(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return _e()}}(t.compositeFilter.op))}(n):_e()}function wS(n){return dS[n]}function bS(n){return hS[n]}function IS(n){return fS[n]}function ws(n){return{fieldPath:n.canonicalString()}}function lo(n){return Tt.fromServerFormat(n.fieldPath)}function W0(n){return n instanceof Qe?function(t){if(t.op==="=="){if(Pg(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NAN"}};if(xg(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Pg(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NAN"}};if(xg(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ws(t.field),op:bS(t.op),value:t.value}}}(n):n instanceof at?function(t){const r=t.getFilters().map(s=>W0(s));return r.length===1?r[0]:{compositeFilter:{op:IS(t.op),filters:r}}}(n):_e()}function ES(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Q0(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $r{constructor(e,t,r,s,i=Te.min(),o=Te.min(),a=Ot.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new $r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new $r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new $r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new $r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(e){this.ct=e}}function TS(n,e){let t;if(e.document)t=q0(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=pe.fromSegments(e.noDocument.path),s=Si(e.noDocument.readTime);t=wt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return _e();{const r=pe.fromSegments(e.unknownDocument.path),s=Si(e.unknownDocument.version);t=wt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Ct(s[0],s[1]);return Te.fromTimestamp(i)}(e.readTime)),t}function Gg(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:uu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:ml(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Lo(i,o.version.toTimestamp()),createTime:Lo(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Pi(e.version)};else{if(!e.isUnknownDocument())return _e();r.unknownDocument={path:t.path.toArray(),version:Pi(e.version)}}return r}function uu(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Pi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Si(n){const e=new Ct(n.seconds,n.nanoseconds);return Te.fromTimestamp(e)}function di(n,e){const t=(e.baseMutations||[]).map(i=>Wh(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Wh(n.ct,i)),s=Ct.fromMillis(e.localWriteTimeMs);return new Bf(e.batchId,s,t,r)}function La(n){const e=Si(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Si(n.lastLimboFreeSnapshotVersion):Te.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Ie(i.documents.length===1),Tn(Qo($0(i.documents[0])))}(n.query):function(i){return Tn(K0(i))}(n.query),new $r(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ot.fromBase64String(n.resumeToken))}function Y0(n,e){const t=Pi(e.snapshotVersion),r=Pi(e.lastLimboFreeSnapshotVersion);let s;s=ou(e.target)?z0(n.ct,e.target):Qu(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ti(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Gf(n){const e=K0({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?lu(e,e.limit,"L"):e}function rh(n,e){return new jf(e.largestBatchId,Wh(n.ct,e.overlayMutation))}function Kg(n,e){const t=e.path.lastSegment();return[n,En(e.path.popLast()),t]}function Hg(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Pi(r.readTime),documentKey:En(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AS{getBundleMetadata(e,t){return Wg(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Si(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Wg(e).put(function(s){return{bundleId:s.id,createTime:Pi(qt(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Qg(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Gf(i.bundledQuery),readTime:Si(i.readTime)}}(r)})}saveNamedQuery(e,t){return Qg(e).put(function(s){return{name:s.name,readTime:Pi(qt(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Wg(n){return tn(n,"bundles")}function Qg(n){return tn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Ju(e,r)}getOverlay(e,t){return Ea(e).get(Kg(this.userId,t)).next(r=>r?rh(this.serializer,r):null)}getOverlays(e,t){const r=Ar();return N.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new jf(t,o);s.push(this.ht(e,a))}),N.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(En(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Ea(e).j("collectionPathOverlayIndex",a))}),N.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Ar(),i=En(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ea(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const u=rh(this.serializer,l);s.set(u.getKey(),u)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Ar();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ea(e).J({index:"collectionGroupOverlayIndex",range:a},(l,u,d)=>{const f=rh(this.serializer,u);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return Ea(e).put(function(s,i,o){const[a,l,u]=Kg(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:gl(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Ea(n){return tn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{Pt(e){return tn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Ot.fromUint8Array(r):Ot.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Et(e.integerValue));else if("doubleValue"in e){const r=Et(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),ul(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Qr(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Jr(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?i0(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Ku(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):_e()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Et(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),pe.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}hi.vt=new hi;function PS(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Jg(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=PS(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class SS{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=Jg(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=Jg(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class RS{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class CS{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Ta{constructor(){this.jt=new SS,this.Ht=new RS(this.jt),this.Jt=new CS(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new fi(this.indexId,this.documentKey,this.arrayValue,r)}}function ps(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Yg(n.arrayValue,e.arrayValue),t!==0?t:(t=Yg(n.directionalValue,e.directionalValue),t!==0?t:pe.comparator(n.documentKey,e.documentKey)))}function Yg(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(e){this.Xt=new ct((t,r)=>Tt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Ie(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Lh(e);if(t!==void 0&&!this.sn(t))return!1;const r=li(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new ct(Tt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new yi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new yi(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new yi(r.field,r.dir==="asc"?0:1)));return new ko(ko.UNKNOWN_ID,this.collectionId,t,Do.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X0(n){var e,t;if(Ie(n instanceof Qe||n instanceof at),n instanceof Qe){if(n instanceof p0){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>Qe.create(n.field,"==",i)))||[];return at.create(s,"or")}return n}const r=n.filters.map(s=>X0(s));return at.create(r,n.op)}function kS(n){if(n.getFilters().length===0)return[];const e=Yh(X0(n));return Ie(Z0(e)),Qh(e)||Jh(e)?[e]:e.getFilters()}function Qh(n){return n instanceof Qe}function Jh(n){return n instanceof at&&Of(n)}function Z0(n){return Qh(n)||Jh(n)||function(t){if(t instanceof at&&$h(t)){for(const r of t.getFilters())if(!Qh(r)&&!Jh(r))return!1;return!0}return!1}(n)}function Yh(n){if(Ie(n instanceof Qe||n instanceof at),n instanceof Qe)return n;if(n.filters.length===1)return Yh(n.filters[0]);const e=n.filters.map(r=>Yh(r));let t=at.create(e,n.op);return t=du(t),Z0(t)?t:(Ie(t instanceof at),Ie(No(t)),Ie(t.filters.length>1),t.filters.reduce((r,s)=>Kf(r,s)))}function Kf(n,e){let t;return Ie(n instanceof Qe||n instanceof at),Ie(e instanceof Qe||e instanceof at),t=n instanceof Qe?e instanceof Qe?function(s,i){return at.create([s,i],"and")}(n,e):Zg(n,e):e instanceof Qe?Zg(e,n):function(s,i){if(Ie(s.filters.length>0&&i.filters.length>0),No(s)&&No(i))return d0(s,i.getFilters());const o=$h(s)?s:i,a=$h(s)?i:s,l=o.filters.map(u=>Kf(u,a));return at.create(l,"or")}(n,e),du(t)}function Zg(n,e){if(No(e))return d0(e,n.getFilters());{const t=e.filters.map(r=>Kf(n,r));return at.create(t,"or")}}function du(n){if(Ie(n instanceof Qe||n instanceof at),n instanceof Qe)return n;const e=n.getFilters();if(e.length===1)return du(e[0]);if(c0(n))return n;const t=e.map(s=>du(s)),r=[];return t.forEach(s=>{s instanceof Qe?r.push(s):s instanceof at&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:at.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DS{constructor(){this.un=new Hf}addToCollectionParentIndex(e,t){return this.un.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(Kn.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(Kn.min())}updateCollectionGroup(e,t,r){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}}class Hf{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ct(We.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ct(We.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ic=new Uint8Array(0);class VS{constructor(e,t){this.databaseId=t,this.cn=new Hf,this.ln=new rs(r=>Ti(r),(r,s)=>Nl(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:En(s)};return e_(e).put(i)}return N.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[Gy(t),""],!1,!0);return e_(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Tr(o.parent))}return r})}addFieldIndex(e,t){const r=Aa(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=no(e);return i.next(a=>{o.put(Hg(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Aa(e),s=no(e),i=to(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Aa(e),r=to(e),s=no(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return N.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Xg(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=to(e);let s=!0;const i=new Map;return N.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=qe();const a=[];return N.forEach(i,(l,u)=>{J("IndexedDbIndexManager",`Using index ${function($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(l)} to execute ${Ti(t)}`);const d=function($,j){const M=Lh(j);if(M===void 0)return null;for(const ae of au($,M.fieldPath))switch(ae.op){case"array-contains-any":return ae.value.arrayValue.values||[];case"array-contains":return[ae.value]}return null}(u,l),f=function($,j){const M=new Map;for(const ae of li(j))for(const T of au($,ae.fieldPath))switch(T.op){case"==":case"in":M.set(ae.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return M.set(ae.fieldPath.canonicalString(),T.value),Array.from(M.values())}return null}(u,l),g=function($,j){const M=[];let ae=!0;for(const T of li(j)){const w=T.kind===0?Dg($,T.fieldPath,$.startAt):Vg($,T.fieldPath,$.startAt);M.push(w.value),ae&&(ae=w.inclusive)}return new Fs(M,ae)}(u,l),_=function($,j){const M=[];let ae=!0;for(const T of li(j)){const w=T.kind===0?Vg($,T.fieldPath,$.endAt):Dg($,T.fieldPath,$.endAt);M.push(w.value),ae&&(ae=w.inclusive)}return new Fs(M,ae)}(u,l),C=this.In(l,u,g),P=this.In(l,u,_),R=this.Tn(l,u,f),L=this.En(l.indexId,d,C,g.inclusive,P,_.inclusive,R);return N.forEach(L,U=>r.G(U,t.limit).next($=>{$.forEach(j=>{const M=pe.fromSegments(j.documentKey);o.has(M)||(o=o.add(M),a.push(M))})}))}).next(()=>a)}return N.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=kS(at.create(e.filters,"and")).map(r=>qh(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),u=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/u]):Ic,_=this.An(e,g,r[f%u],s),C=this.Rn(e,g,i[f%u],o),P=a.map(R=>this.An(e,g,R,!0));d.push(...this.createRange(_,C,P))}return d}An(e,t,r,s){const i=new fi(e,pe.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new fi(e,pe.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Xg(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return N.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let u=new ct(Tt.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:u=u.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(u=u.add(f.field));return u.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Ta;for(const s of li(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);hi.vt.It(i,o)}return r.zt()}dn(e){const t=new Ta;return hi.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Ta;return hi.vt.It(Ei(this.databaseId,t),r.Yt(function(i){const o=li(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Ta);let i=0;for(const o of li(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&fl(a))s=this.gn(s,o,a);else{const u=l.Yt(o.kind);hi.vt.It(a,u)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Ta;l.seed(a.zt()),hi.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof Qe&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Aa(e),s=no(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return N.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new Do(f.sequenceNumber,new Kn(Si(f.readTime),new pe(Tr(f.documentKey)),f.largestBatchId)):Do.empty(),_=d.fields.map(([C,P])=>new yi(Tt.fromServerFormat(C),P));return new ko(d.indexId,d.collectionGroup,_,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ve(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Aa(e),i=no(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>N.forEach(a,l=>i.put(Hg(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return N.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?N.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),N.forEach(a,l=>this.wn(e,s,l).next(u=>{const d=this.Sn(i,l);return u.isEqual(d)?N.resolve():this.bn(e,i,l,u,d)}))))})}Dn(e,t,r,s){return to(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return to(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=to(e);let i=new ct(ps);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new fi(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new ct(ps);const s=this.Vn(t,e);if(s==null)return r;const i=Lh(t);if(i!=null){const o=e.data.field(i.fieldPath);if(fl(o))for(const a of o.arrayValue.values||[])r=r.add(new fi(t.indexId,e.key,this.dn(a),s))}else r=r.add(new fi(t.indexId,e.key,Ic,s));return r}bn(e,t,r,s,i){J("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,u,d,f,g){const _=l.getIterator(),C=u.getIterator();let P=eo(_),R=eo(C);for(;P||R;){let L=!1,U=!1;if(P&&R){const $=d(P,R);$<0?U=!0:$>0&&(L=!0)}else P!=null?U=!0:L=!0;L?(f(R),R=eo(C)):U?(g(P),P=eo(_)):(P=eo(_),R=eo(C))}}(s,i,ps,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),N.waitFor(o)}yn(e){let t=1;return no(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ps(o,a)).filter((o,a,l)=>!a||ps(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=ps(o,e),l=ps(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Ic,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Ic,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return ps(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(t_)}getMinOffset(e,t){return N.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||_e())).next(t_)}}function e_(n){return tn(n,"collectionParents")}function to(n){return tn(n,"indexEntries")}function Aa(n){return tn(n,"indexConfiguration")}function no(n){return tn(n,"indexState")}function t_(n){Ie(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Df(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Kn(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class yn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new yn(e,yn.DEFAULT_COLLECTION_PERCENTILE,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ew(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Ie(a===1)}));const u=[];for(const d of t.mutations){const f=Xy(e,d.key.path,t.batchId);i.push(s.delete(f)),u.push(d.key)}return N.waitFor(i).next(()=>u)}function hu(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw _e();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yn.DEFAULT_COLLECTION_PERCENTILE=10,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yn.DEFAULT=new yn(41943040,yn.DEFAULT_COLLECTION_PERCENTILE,yn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yn.DISABLED=new yn(-1,0,0);class Yu{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Ie(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Yu(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ms(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=co(e),o=ms(e);return o.add({}).next(a=>{Ie(typeof a=="number");const l=new Bf(a,t,r,s),u=function(_,C,P){const R=P.baseMutations.map(U=>gl(_.ct,U)),L=P.mutations.map(U=>gl(_.ct,U));return{userId:C,batchId:P.batchId,localWriteTimeMs:P.localWriteTime.toMillis(),baseMutations:R,mutations:L}}(this.serializer,this.userId,l),d=[];let f=new ct((g,_)=>Ve(g.canonicalString(),_.canonicalString()));for(const g of s){const _=Xy(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(u)),d.push(i.put(_,bP))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),N.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return ms(e).get(t).next(r=>r?(Ie(r.userId===this.userId),di(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?N.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ms(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Ie(a.batchId>=r),i=di(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ms(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ms(e).U("userMutationsIndex",t).next(r=>r.map(s=>di(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Oc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return co(e).J({range:s},(o,a,l)=>{const[u,d,f]=o,g=Tr(d);if(u===this.userId&&t.path.isEqual(g))return ms(e).get(f).next(_=>{if(!_)throw _e();Ie(_.userId===this.userId),i.push(di(this.serializer,_))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ct(Ve);const s=[];return t.forEach(i=>{const o=Oc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=co(e).J({range:a},(u,d,f)=>{const[g,_,C]=u,P=Tr(_);g===this.userId&&i.path.isEqual(P)?r=r.add(C):f.done()});s.push(l)}),N.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Oc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new ct(Ve);return co(e).J({range:o},(l,u,d)=>{const[f,g,_]=l,C=Tr(g);f===this.userId&&r.isPrefixOf(C)?C.length===s&&(a=a.add(_)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ms(e).get(i).next(o=>{if(o===null)throw _e();Ie(o.userId===this.userId),r.push(di(this.serializer,o))}))}),N.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return ew(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),N.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return N.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return co(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Tr(i[1]);s.push(l)}else a.done()}).next(()=>{Ie(s.length===0)})})}containsKey(e,t){return tw(e,this.userId,t)}Nn(e){return nw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function tw(n,e,t){const r=Oc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return co(n).J({range:i,H:!0},(a,l,u)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),u.done()}).next(()=>o)}function ms(n){return tn(n,"mutations")}function co(n){return tn(n,"documentMutations")}function nw(n){return tn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ri{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ri(0)}static kn(){return new Ri(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Ri(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Te.fromTimestamp(new Ct(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ro(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Ie(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return ro(e).J((o,a)=>{const l=La(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>N.waitFor(i)).next(()=>s)}forEachTarget(e,t){return ro(e).J((r,s)=>{const i=La(s);t(i)})}qn(e){return r_(e).get("targetGlobalKey").next(t=>(Ie(t!==null),t))}Qn(e,t){return r_(e).put("targetGlobalKey",t)}Kn(e,t){return ro(e).put(Y0(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ti(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return ro(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const u=La(a);Nl(t,u.target)&&(i=u,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=bs(e);return t.forEach(o=>{const a=En(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),N.waitFor(s)}removeMatchingKeys(e,t,r){const s=bs(e);return N.forEach(t,i=>{const o=En(i.path);return N.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=bs(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=bs(e);let i=qe();return s.J({range:r,H:!0},(o,a,l)=>{const u=Tr(o[1]),d=new pe(u);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=En(t.path),s=IDBKeyRange.bound([r],[Gy(r)],!1,!0);let i=0;return bs(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,u)=>{o!==0&&(i++,u.done())}).next(()=>i>0)}ot(e,t){return ro(e).get(t).next(r=>r?La(r):null)}}function ro(n){return tn(n,"targets")}function r_(n){return tn(n,"targetGlobal")}function bs(n){return tn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_([n,e],[t,r]){const s=Ve(n,t);return s===0?Ve(e,r):s}class OS{constructor(e){this.Un=e,this.buffer=new ct(s_),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();s_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class rw{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){J("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){zs(t)?J("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await qs(t)}await this.Hn(3e5)})}}class MS{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return N.resolve(Mn.oe);const r=new OS(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(J("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(n_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(J("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),n_):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(J("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),oo()<=He.DEBUG&&J("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(u-l)+`ms
Total Duration: ${u-d}ms`),N.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function sw(n,e){return new MS(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LS{constructor(e,t){this.db=e,this.garbageCollector=sw(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Ec(e,r)}removeReference(e,t,r){return Ec(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ec(e,t)}nr(e,t){return function(s,i){let o=!1;return nw(s).Y(a=>tw(s,a,i).next(l=>(l&&(o=!0),N.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(u=>{if(!u)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Te.min()),bs(e).delete(function(f){return[0,En(f.path)]}(o))))});s.push(l)}}).next(()=>N.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ec(e,t)}tr(e,t){const r=bs(e);let s,i=Mn.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:u})=>{o===0?(i!==Mn.oe&&t(new pe(Tr(s)),i),i=u,s=l):i=Mn.oe}).next(()=>{i!==Mn.oe&&t(new pe(Tr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ec(n,e){return bs(n).put(function(r,s){return{targetId:0,path:En(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw{constructor(){this.changes=new rs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,wt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?N.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ii(e).put(r)}removeEntry(e,t,r){return ii(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],uu(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=wt.newInvalidDocument(t);return ii(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xa(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:wt.newInvalidDocument(t)};return ii(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(xa(t))},(s,i)=>{r={document:this.ir(t,i),size:hu(i)}}).next(()=>r)}getEntries(e,t){let r=Fn();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=Fn(),s=new vt(pe.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,hu(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return N.resolve();let s=new ct(a_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(xa(s.first()),xa(s.last())),o=s.getIterator();let a=o.getNext();return ii(e).J({index:"documentKeyIndex",range:i},(l,u,d)=>{const f=pe.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&a_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?d.$(xa(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),uu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ii(e).U(IDBKeyRange.bound(a,l,!0)).next(u=>{i==null||i.incrementDocumentReadCount(u.length);let d=Fn();for(const f of u){const g=this.ir(pe.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Ml(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=Fn();const o=o_(t,r),a=o_(t,Kn.max());return ii(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,u,d)=>{const f=this.ir(pe.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new US(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return i_(e).get("remoteDocumentGlobalKey").next(t=>(Ie(!!t),t))}rr(e,t){return i_(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=TS(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Te.min())))return r}return wt.newInvalidDocument(e)}}function ow(n){return new FS(n)}class US extends iw{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new rs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new ct((i,o)=>Ve(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Gg(this.cr.serializer,o);s=s.add(i.path.popLast());const u=hu(l);r+=u-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Gg(this.cr.serializer,o.convertToNoDocument(Te.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),N.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function i_(n){return tn(n,"remoteDocumentGlobal")}function ii(n){return tn(n,"remoteDocumentsV14")}function xa(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function o_(n,e){const t=e.documentKey.path.toArray();return[n,uu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function a_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ve(t[i],r[i]),s)return s;return s=Ve(t.length,r.length),s||(s=Ve(t[t.length-2],r[r.length-2]),s||Ve(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Ya(r.mutation,s,Ln.empty(),Ct.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,qe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=qe()){const s=Ar();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Oa();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Ar();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,qe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Fn();const o=Ja(),a=function(){return Ja()}();return t.forEach((l,u)=>{const d=r.get(u.key);s.has(u.key)&&(d===void 0||d.mutation instanceof ss)?i=i.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),Ya(d.mutation,u,d.mutation.getFieldMask(),Ct.now())):o.set(u.key,Ln.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var f;return a.set(u,new BS(d,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Ja();let s=new vt((o,a)=>o-a),i=qe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=t.get(l);if(u===null)return;let d=r.get(l)||Ln.empty();d=a.applyToLocalView(u,d),r.set(l,d);const f=(s.get(a.batchId)||qe()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,d=l.value,f=E0();d.forEach(g=>{if(!i.has(g)){const _=C0(t.get(g),r.get(g));_!==null&&f.set(g,_),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return N.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return pe.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Mf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):N.resolve(Ar());let a=-1,l=i;return o.next(u=>N.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?N.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,u,i)).next(()=>this.computeViews(e,l,u,qe())).next(d=>({batchId:a,changes:I0(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new pe(t)).next(r=>{let s=Oa();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Oa();return this.indexManager.getCollectionParents(e,i).next(a=>N.forEach(a,l=>{const u=function(f,g){return new ns(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,u,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,u)=>{const d=u.getKey();o.get(d)===null&&(o=o.insert(d,wt.newInvalidDocument(d)))});let a=Oa();return o.forEach((l,u)=>{const d=i.get(l);d!==void 0&&Ya(d.mutation,u,Ln.empty(),Ct.now()),Ml(t,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $S{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return N.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:qt(s.createTime)}}(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Gf(s.bundledQuery),readTime:qt(s.readTime)}}(t)),N.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS{constructor(){this.overlays=new vt(pe.comparator),this.Ir=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ar();return N.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),N.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),N.resolve()}getOverlaysForCollection(e,t,r){const s=Ar(),i=t.length+1,o=new pe(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return N.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new vt((u,d)=>u-d);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=i.get(u.largestBatchId);d===null&&(d=Ar(),i=i.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const a=Ar(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=s)););return N.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new jf(t,r));let i=this.Ir.get(t);i===void 0&&(i=qe(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{constructor(){this.sessionToken=Ot.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(){this.Tr=new ct(rn.Er),this.dr=new ct(rn.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new rn(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new rn(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new pe(new We([])),r=new rn(t,e),s=new rn(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new pe(new We([])),r=new rn(t,e),s=new rn(t,e+1);let i=qe();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new rn(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class rn{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return pe.comparator(e.key,t.key)||Ve(e.wr,t.wr)}static Ar(e,t){return Ve(e.wr,t.wr)||pe.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zS{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new ct(rn.Er)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Bf(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new rn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return N.resolve(o)}lookupMutationBatch(e,t){return N.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return N.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new rn(t,0),s=new rn(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),N.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ct(Ve);return t.forEach(s=>{const i=new rn(s,0),o=new rn(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),N.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;pe.isDocumentKey(i)||(i=i.child(""));const o=new rn(new pe(i),0);let a=new ct(Ve);return this.br.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.wr)),!0)},o),N.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ie(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return N.forEach(t.mutations,s=>{const i=new rn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new rn(t,0),s=this.br.firstAfterOrEqual(r);return N.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GS{constructor(e){this.Mr=e,this.docs=function(){return new vt(pe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return N.resolve(r?r.document.mutableCopy():wt.newInvalidDocument(t))}getEntries(e,t){let r=Fn();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():wt.newInvalidDocument(s))}),N.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Fn();const o=t.path,a=new pe(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:d}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Df(Hy(d),r)<=0||(s.has(d.key)||Ml(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return N.resolve(i)}getAllFromCollectionGroup(e,t,r,s){_e()}Or(e,t){return N.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new KS(this)}getSize(e){return N.resolve(this.size)}}class KS extends iw{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),N.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HS{constructor(e){this.persistence=e,this.Nr=new rs(t=>Ti(t),Nl),this.lastRemoteSnapshotVersion=Te.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Wf,this.targetCount=0,this.kr=Ri.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),N.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Ri(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.Kn(t),N.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),N.waitFor(i).next(()=>s)}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return N.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),N.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),N.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),N.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return N.resolve(r)}containsKey(e,t){return N.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Mn(0),this.Kr=!1,this.Kr=!0,this.$r=new qS,this.referenceDelegate=e(this),this.Ur=new HS(this),this.indexManager=new DS,this.remoteDocumentCache=function(s){return new GS(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new J0(t),this.Gr=new $S(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new jS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new zS(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){J("MemoryPersistence","Starting transaction:",e);const s=new WS(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return N.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class WS extends Qy{constructor(e){super(),this.currentSequenceNumber=e}}class Xu{constructor(e){this.persistence=e,this.Jr=new Wf,this.Yr=null}static Zr(e){return new Xu(e)}get Xr(){if(this.Yr)return this.Yr;throw _e()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),N.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),N.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.Xr,r=>{const s=pe.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Te.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return N.or([()=>N.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class fu{constructor(e,t){this.persistence=e,this.ti=new rs(r=>En(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=sw(this,t)}static Zr(e,t){return new fu(e,t)}zr(){}jr(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return N.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?N.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Te.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),N.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),N.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Lc(e.data.value)),t}nr(e,t,r){return N.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return N.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS{constructor(e){this.serializer=e}O(e,t,r,s){const i=new qu("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",bg,{unique:!0}),l.createObjectStore("documentMutations")}(e),l_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=N.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),l_(e)),o=o.next(()=>function(l){const u=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Te.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,u){return u.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",bg,{unique:!0});const f=u.store("mutations"),g=d.map(_=>f.put(_));return N.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const u=l.createObjectStore("documentOverlays",{keyPath:VP});u.createIndex("collectionPathOverlayIndex",NP,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",OP,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const u=l.createObjectStore("remoteDocumentsV14",{keyPath:IP});u.createIndex("documentKeyIndex",EP),u.createIndex("collectionGroupIndex",TP)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:RP}).createIndex("sequenceNumberIndex",CP,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:kP}).createIndex("documentKeyIndex",DP,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=hu(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>N.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>N.forEach(a,l=>{Ie(l.userId===i.userId);const u=di(this.serializer,l);return ew(e,i.userId,u).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new We(o),u=function(f){return[0,En(f)]}(l);i.push(t.get(u).next(d=>d?N.resolve():(f=>t.put({targetId:0,path:En(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>N.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:SP});const r=t.store("collectionParents"),s=new Hf,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:En(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new We(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],u)=>{const d=Tr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=La(s),o=Y0(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new pe(We.fromString(f.document.name).popFirst(5)):f.noDocument?pe.fromSegments(f.noDocument.path):f.unknownDocument?pe.fromSegments(f.unknownDocument.path):_e()}(o).path.toArray(),u={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>N.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=ow(this.serializer),i=new Qf(Xu.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var u;let d=(u=a.get(l.userId))!==null&&u!==void 0?u:qe();di(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),N.forEach(a,(l,u)=>{const d=new sn(u),f=Ju.lt(this.serializer,d),g=i.getIndexManager(d),_=Yu.lt(d,this.serializer,g,i.referenceDelegate);return new aw(s,_,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Fh(t,Mn.oe),l).next()})})}}function l_(n){n.createObjectStore("targetDocuments",{keyPath:xP}).createIndex("documentTargetsIndex",PP,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",AP,{unique:!0}),n.createObjectStore("targetGlobal")}const sh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Jf{constructor(e,t,r,s,i,o,a,l,u,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=u,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!Jf.D())throw new Y(F.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new LS(this,s),this.Ai=t+"main",this.serializer=new J0(l),this.Ri=new Pr(this.Ai,this.hi,new QS(this.serializer)),this.$r=new xS,this.Ur=new NS(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ow(this.serializer),this.Gr=new AS,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Bt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Y(F.FAILED_PRECONDITION,sh);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Mn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Tc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(zs(e))return J("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return J("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Pa(e).get("owner").next(t=>N.resolve(this.vi(t)))}Ci(e){return Tc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=tn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return N.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?N.resolve(!0):Pa(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new Y(F.FAILED_PRECONDITION,sh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Tc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&J("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Fh(e,Mn.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Tc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Yu.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new VS(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ju.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){J("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?FP:l===16?LP:l===15?Nf:l===14?t0:l===13?e0:l===12?MP:l===11?Zy:void _e()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Fh(a,this.Qr?this.Qr.next():Mn.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Bt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new Y(F.FAILED_PRECONDITION,Wy);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Pa(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Y(F.FAILED_PRECONDITION,sh)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Pa(e).put("owner",t)}static D(){return Pr.D()}bi(e){const t=Pa(e);return t.get("owner").next(r=>this.vi(r)?(J("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):N.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Bt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Sy()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return J("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Bt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Bt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Pa(n){return tn(n,"owner")}function Tc(n){return tn(n,"clientMetadata")}function Yf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=qe(),s=qe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Xf(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Sy()?8:Jy(en())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new JS;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(oo()<=He.DEBUG&&J("QueryEngine","SDK will not create cache indexes for query:",ao(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),N.resolve()):(oo()<=He.DEBUG&&J("QueryEngine","Query:",ao(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(oo()<=He.DEBUG&&J("QueryEngine","The SDK decides to create cache indexes for query:",ao(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Tn(t))):N.resolve())}Yi(e,t){if(Ng(t))return N.resolve(null);let r=Tn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=lu(t,null,"F"),r=Tn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=qe(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.ts(t,a);return this.ns(t,u,o,l.readTime)?this.Yi(e,lu(t,null,"F")):this.rs(e,u,t,l)}))})))}Zi(e,t,r,s){return Ng(t)||s.isEqual(Te.min())?N.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?N.resolve(null):(oo()<=He.DEBUG&&J("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ao(t)),this.rs(e,o,t,Ky(s,-1)).next(a=>a))})}ts(e,t){let r=new ct(w0(e));return t.forEach((s,i)=>{Ml(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return oo()<=He.DEBUG&&J("QueryEngine","Using full collection scan to execute query:",ao(t)),this.Ji.getDocumentsMatchingQuery(e,t,Kn.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YS{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new vt(Ve),this._s=new rs(i=>Ti(i),Nl),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new aw(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function cw(n,e,t,r){return new YS(n,e,t,r)}async function uw(n,e){const t=ce(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=qe();for(const u of s){o.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}for(const u of i){a.push(u.batchId);for(const d of u.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(u=>({hs:u,removedBatchIds:o,addedBatchIds:a}))})})}function XS(n,e){const t=ce(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,d){const f=u.batch,g=f.keys();let _=N.resolve();return g.forEach(C=>{_=_.next(()=>d.getEntry(l,C)).next(P=>{const R=u.docVersions.get(C);Ie(R!==null),P.version.compareTo(R)<0&&(f.applyToRemoteDocument(P,u),P.isValidDocument()&&(P.setReadTime(u.commitVersion),d.addEntry(P)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=qe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function dw(n){const e=ce(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function ZS(n,e){const t=ce(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let _=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Ot.EMPTY_BYTE_STRING,Te.min()).withLastLimboFreeSnapshotVersion(Te.min()):d.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(d.resumeToken,r)),s=s.insert(f,_),function(P,R,L){return P.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=3e8?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0}(g,_,d)&&a.push(t.Ur.updateTargetData(i,_))});let l=Fn(),u=qe();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(hw(i,o,e.documentUpdates).next(d=>{l=d.Ps,u=d.Is})),!r.isEqual(Te.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return N.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,u)).next(()=>l)}).then(i=>(t.os=s,i))}function hw(n,e,t){let r=qe(),s=qe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Fn();return t.forEach((a,l)=>{const u=i.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Te.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):J("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function eR(n,e){const t=ce(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Fo(n,e){const t=ce(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,N.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new $r(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Uo(n,e,t){const r=ce(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!zs(o))throw o;J("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function pu(n,e,t){const r=ce(n);let s=Te.min(),i=qe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,d){const f=ce(l),g=f._s.get(d);return g!==void 0?N.resolve(f.os.get(g)):f.Ur.getTargetData(u,d)}(r,o,Tn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Te.min(),t?i:qe())).next(a=>(mw(r,y0(e),a),{documents:a,Ts:i})))}function fw(n,e){const t=ce(n),r=ce(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function pw(n,e){const t=ce(n),r=t.us.get(e)||Te.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,Ky(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(mw(t,e,s),s))}function mw(n,e,t){let r=n.us.get(e)||Te.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function tR(n,e,t,r){const s=ce(n);let i=qe(),o=Fn();for(const u of t){const d=e.Es(u.metadata.name);u.document&&(i=i.add(d));const f=e.ds(u);f.setReadTime(e.As(u.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Fo(s,function(d){return Tn(Qo(We.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",u=>hw(u,a,o).next(d=>(a.apply(u),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(u,l.targetId).next(()=>s.Ur.addMatchingKeys(u,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(u,d.Ps,d.Is)).next(()=>d.Ps)))}async function nR(n,e,t=qe()){const r=await Fo(n,Tn(Gf(e.bundledQuery))),s=ce(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=qt(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Ot.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function c_(n,e){return`firestore_clients_${n}_${e}`}function u_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function ih(n,e){return`firestore_targets_${n}_${e}`}class mu{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new Y(s.error.code,s.error.message))),o?new mu(e,t,s.state,i):(Bt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Xa{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new Y(r.error.code,r.error.message))),i?new Xa(e,r.state,s):(Bt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class gu{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Lf();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Yy(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new gu(e,i):(Bt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Zf{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Zf(t.clientId,t.onlineState):(Bt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Xh{constructor(){this.activeTargetIds=Lf()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class oh{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new vt(Ve),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=c_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Xh),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(c_(this.persistenceKey,r));if(s){const i=gu.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(ih(this.persistenceKey,e));if(s){const i=Xa.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ih(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return J("SharedClientState","READ",e,t),t}setItem(e,t){J("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){J("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(J("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Bt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=Mn.oe;if(i!=null)try{const a=JSON.parse(i);Ie(typeof a=="number"),o=a}catch(a){Bt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Mn.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new mu(this.currentUser,e,t,r),i=u_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=u_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=ih(this.persistenceKey,e),i=new Xa(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return gu.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return mu.Rs(new sn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return Xa.Rs(s,t)}Ls(e){return Zf.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);J("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Lf();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class gw{constructor(){this.so=new Xh,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Xh,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){J("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){J("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ac=null;function ah(){return Ac===null?Ac=function(){return 268435456+Math.round(2147483648*Math.random())}():Ac++,"0x"+Ac.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vn="WebChannelConnection";class oR extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=ah(),l=this.xo(t,r.toUriEncodedString());J("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const u={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(u,i,o),this.No(t,l,u,s).then(d=>(J("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Zn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Wo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=sR[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=ah();return new Promise((o,a)=>{const l=new Ly;l.setWithCredentials(!0),l.listenOnce(Fy.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Nc.NO_ERROR:const d=l.getResponseJson();J(vn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case Nc.TIMEOUT:J(vn,`RPC '${e}' ${i} timed out`),a(new Y(F.DEADLINE_EXCEEDED,"Request time out"));break;case Nc.HTTP_ERROR:const f=l.getStatus();if(J(vn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const _=g==null?void 0:g.error;if(_&&_.status&&_.message){const C=function(R){const L=R.toLowerCase().replace(/_/g,"-");return Object.values(F).indexOf(L)>=0?L:F.UNKNOWN}(_.status);a(new Y(C,_.message))}else a(new Y(F.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new Y(F.UNAVAILABLE,"Connection failed."));break;default:_e()}}finally{J(vn,`RPC '${e}' ${i} completed.`)}});const u=JSON.stringify(s);J(vn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",u,r,15)})}Bo(e,t,r){const s=ah(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=$y(),a=By(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");J(vn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,_=!1;const C=new iR({Io:R=>{_?J(vn,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(g||(J(vn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),J(vn,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),P=(R,L,U)=>{R.listen(L,$=>{try{U($)}catch(j){setTimeout(()=>{throw j},0)}})};return P(f,Na.EventType.OPEN,()=>{_||(J(vn,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),P(f,Na.EventType.CLOSE,()=>{_||(_=!0,J(vn,`RPC '${e}' stream ${s} transport closed`),C.So())}),P(f,Na.EventType.ERROR,R=>{_||(_=!0,Zn(vn,`RPC '${e}' stream ${s} transport errored:`,R),C.So(new Y(F.UNAVAILABLE,"The operation could not be completed")))}),P(f,Na.EventType.MESSAGE,R=>{var L;if(!_){const U=R.data[0];Ie(!!U);const $=U,j=$.error||((L=$[0])===null||L===void 0?void 0:L.error);if(j){J(vn,`RPC '${e}' stream ${s} received error:`,j);const M=j.status;let ae=function(I){const S=Ht[I];if(S!==void 0)return N0(S)}(M),T=j.message;ae===void 0&&(ae=F.INTERNAL,T="Unknown error status: "+M+" with message "+j.message),_=!0,C.So(new Y(ae,T)),f.close()}else J(vn,`RPC '${e}' stream ${s} received:`,U),C.bo(U)}}),P(a,Uy.STAT_EVENT,R=>{R.stat===Mh.PROXY?J(vn,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===Mh.NOPROXY&&J(vn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _w(){return typeof window<"u"?window:null}function $c(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bl(n){return new pS(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&J("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vw{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ep(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===F.RESOURCE_EXHAUSTED?(Bt(t.toString()),Bt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===F.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new Y(F.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return J("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(J("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aR extends vw{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=_S(this.serializer,e),r=function(i){if(!("targetChange"in i))return Te.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Te.min():o.readTime?qt(o.readTime):Te.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Hh(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=ou(l)?{documents:z0(i,l)}:{query:Qu(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=F0(i,o.resumeToken);const u=Gh(i,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(Te.min())>0){a.readTime=Lo(i,o.snapshotVersion.toTimestamp());const u=Gh(i,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=yS(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Hh(this.serializer),t.removeTarget=e,this.a_(t)}}class lR extends vw{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,Ie(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ie(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=vS(e.writeResults,e.commitTime),r=qt(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Hh(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>gl(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Kh(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Y(F.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Kh(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===F.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Y(F.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class uR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Bt(t),this.D_=!1):J("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Ks(this)&&(J("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=ce(l);u.L_.add(4),await Xo(u),u.q_.set("Unknown"),u.L_.delete(4),await $l(u)}(this))})}),this.q_=new uR(r,s)}}async function $l(n){if(Ks(n))for(const e of n.B_)await e(!0)}async function Xo(n){for(const e of n.B_)await e(!1)}function Zu(n,e){const t=ce(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),rp(t)?np(t):ea(t).r_()&&tp(t,e))}function Bo(n,e){const t=ce(n),r=ea(t);t.N_.delete(e),r.r_()&&yw(t,e),t.N_.size===0&&(r.r_()?r.o_():Ks(t)&&t.q_.set("Unknown"))}function tp(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Te.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ea(n).A_(e)}function yw(n,e){n.Q_.xe(e),ea(n).R_(e)}function np(n){n.Q_=new uS({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ea(n).start(),n.q_.v_()}function rp(n){return Ks(n)&&!ea(n).n_()&&n.N_.size>0}function Ks(n){return ce(n).L_.size===0}function ww(n){n.Q_=void 0}async function hR(n){n.q_.set("Online")}async function fR(n){n.N_.forEach((e,t)=>{tp(n,e)})}async function pR(n,e){ww(n),rp(n)?(n.q_.M_(e),np(n)):n.q_.set("Unknown")}async function mR(n,e,t){if(n.q_.set("Online"),e instanceof L0&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){J("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await _u(n,r)}else if(e instanceof Bc?n.Q_.Ke(e):e instanceof M0?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Te.min()))try{const r=await dw(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(u);d&&i.N_.set(u,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Ot.EMPTY_BYTE_STRING,d.snapshotVersion)),yw(i,l);const f=new $r(d.target,l,u,d.sequenceNumber);tp(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){J("RemoteStore","Failed to raise snapshot:",r),await _u(n,r)}}async function _u(n,e,t){if(!zs(e))throw e;n.L_.add(1),await Xo(n),n.q_.set("Offline"),t||(t=()=>dw(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{J("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await $l(n)})}function bw(n,e){return e().catch(t=>_u(n,t,e))}async function Zo(n){const e=ce(n),t=Us(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;gR(e);)try{const s=await eR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,_R(e,s)}catch(s){await _u(e,s)}Iw(e)&&Ew(e)}function gR(n){return Ks(n)&&n.O_.length<10}function _R(n,e){n.O_.push(e);const t=Us(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Iw(n){return Ks(n)&&!Us(n).n_()&&n.O_.length>0}function Ew(n){Us(n).start()}async function vR(n){Us(n).p_()}async function yR(n){const e=Us(n);for(const t of n.O_)e.m_(t.mutations)}async function wR(n,e,t){const r=n.O_.shift(),s=$f.from(r,e,t);await bw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Zo(n)}async function bR(n,e){e&&Us(n).V_&&await async function(r,s){if(function(o){return V0(o)&&o!==F.ABORTED}(s.code)){const i=r.O_.shift();Us(r).s_(),await bw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Zo(r)}}(n,e),Iw(n)&&Ew(n)}async function h_(n,e){const t=ce(n);t.asyncQueue.verifyOperationInProgress(),J("RemoteStore","RemoteStore received new credentials");const r=Ks(t);t.L_.add(3),await Xo(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await $l(t)}async function Zh(n,e){const t=ce(n);e?(t.L_.delete(2),await $l(t)):e||(t.L_.add(2),await Xo(t),t.q_.set("Unknown"))}function ea(n){return n.K_||(n.K_=function(t,r,s){const i=ce(t);return i.w_(),new aR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:hR.bind(null,n),Ro:fR.bind(null,n),mo:pR.bind(null,n),d_:mR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),rp(n)?np(n):n.q_.set("Unknown")):(await n.K_.stop(),ww(n))})),n.K_}function Us(n){return n.U_||(n.U_=function(t,r,s){const i=ce(t);return i.w_(),new lR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:vR.bind(null,n),mo:bR.bind(null,n),f_:yR.bind(null,n),g_:wR.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Zo(n)):(await n.U_.stop(),n.O_.length>0&&(J("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new on,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new sp(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Y(F.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ta(n,e){if(Bt("AsyncQueue",`${e}: ${n}`),zs(n))return new Y(F.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(e){this.comparator=e?(t,r)=>e(t,r)||pe.comparator(t.key,r.key):(t,r)=>pe.comparator(t.key,r.key),this.keyedMap=Oa(),this.sortedSet=new vt(this.comparator)}static emptySet(e){return new yo(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof yo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new yo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(){this.W_=new vt(pe.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):_e():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class $o{constructor(e,t,r,s,i,o,a,l,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new $o(e,t,yo.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ol(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class ER{constructor(){this.queries=p_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=ce(t),i=s.queries;s.queries=p_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new Y(F.ABORTED,"Firestore shutting down"))}}function p_(){return new rs(n=>v0(n),Ol)}async function ip(n,e){const t=ce(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new IR,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=ta(o,`Initialization of query '${ao(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&ap(t)}async function op(n,e){const t=ce(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function TR(n,e){const t=ce(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&ap(t)}function AR(n,e,t){const r=ce(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function ap(n){n.Y_.forEach(e=>{e.next()})}var ef,m_;(m_=ef||(ef={})).ea="default",m_.Cache="cache";class lp{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new $o(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=$o.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ef.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(e){this.serializer=e}Es(e){return Sr(this.serializer,e)}ds(e){return e.metadata.exists?q0(this.serializer,e.document,!1):wt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return qt(e)}}class PR{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Tw(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=We.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new g_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||qe()).add(i);t.set(o,a)}}return t}async complete(){const e=await tR(this.localStore,new g_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await nR(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Tw(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aw{constructor(e){this.key=e}}class xw{constructor(e){this.key=e}}class Pw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=qe(),this.mutatedKeys=qe(),this.Aa=w0(e),this.Ra=new yo(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new f_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),_=Ml(this.query,f)?f:null,C=!!g&&this.mutatedKeys.has(g.key),P=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let R=!1;g&&_?g.data.isEqual(_.data)?C!==P&&(r.track({type:3,doc:_}),R=!0):this.ga(g,_)||(r.track({type:2,doc:_}),R=!0,(l&&this.Aa(_,l)>0||u&&this.Aa(_,u)<0)&&(a=!0)):!g&&_?(r.track({type:0,doc:_}),R=!0):g&&!_&&(r.track({type:1,doc:g}),R=!0,(l||u)&&(a=!0)),R&&(_?(o=o.add(_),i=P?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(_,C){const P=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _e()}};return P(_)-P(C)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,u=l!==this.Ea;return this.Ea=l,o.length!==0||u?{snapshot:new $o(this.query,e.Ra,i,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new f_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=qe(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new xw(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Aw(r))}),t}ba(e){this.Ta=e.Ts,this.da=qe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return $o.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class SR{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class RR{constructor(e){this.key=e,this.va=!1}}class CR{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new rs(a=>v0(a),Ol),this.Ma=new Map,this.xa=new Set,this.Oa=new vt(pe.comparator),this.Na=new Map,this.La=new Wf,this.Ba={},this.ka=new Map,this.qa=Ri.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function kR(n,e,t=!0){const r=ed(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await Sw(r,e,t,!0),s}async function DR(n,e){const t=ed(n);await Sw(t,e,!0,!1)}async function Sw(n,e,t,r){const s=await Fo(n.localStore,Tn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await cp(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Zu(n.remoteStore,s),a}async function cp(n,e,t,r,s){n.Ka=(f,g,_)=>async function(P,R,L,U){let $=R.view.ma(L);$.ns&&($=await pu(P.localStore,R.query,!1).then(({documents:T})=>R.view.ma(T,$)));const j=U&&U.targetChanges.get(R.targetId),M=U&&U.targetMismatches.get(R.targetId)!=null,ae=R.view.applyChanges($,P.isPrimaryClient,j,M);return tf(P,R.targetId,ae.wa),ae.snapshot}(n,f,g,_);const i=await pu(n.localStore,e,!0),o=new Pw(e,i.Ts),a=o.ma(i.documents),l=Ul.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);tf(n,t,u.wa);const d=new SR(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),u.snapshot}async function VR(n,e,t){const r=ce(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Ol(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Uo(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Bo(r.remoteStore,s.targetId),jo(r,s.targetId)}).catch(qs)):(jo(r,s.targetId),await Uo(r.localStore,s.targetId,!0))}async function NR(n,e){const t=ce(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Bo(t.remoteStore,r.targetId))}async function OR(n,e,t){const r=fp(n);try{const s=await function(o,a){const l=ce(o),u=Ct.now(),d=a.reduce((_,C)=>_.add(C.key),qe());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",_=>{let C=Fn(),P=qe();return l.cs.getEntries(_,d).next(R=>{C=R,C.forEach((L,U)=>{U.isValidDocument()||(P=P.add(L))})}).next(()=>l.localDocuments.getOverlayedDocuments(_,C)).next(R=>{f=R;const L=[];for(const U of a){const $=aS(U,f.get(U.key).overlayedDocument);$!=null&&L.push(new ss(U.key,$,a0($.value.mapValue),At.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,L,a)}).next(R=>{g=R;const L=R.applyToLocalDocumentSet(f,P);return l.documentOverlayCache.saveOverlays(_,R.batchId,L)})}).then(()=>({batchId:g.batchId,changes:I0(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let u=o.Ba[o.currentUser.toKey()];u||(u=new vt(Ve)),u=u.insert(a,l),o.Ba[o.currentUser.toKey()]=u}(r,s.batchId,t),await is(r,s.changes),await Zo(r.remoteStore)}catch(s){const i=ta(s,"Failed to persist write");t.reject(i)}}async function Rw(n,e){const t=ce(n);try{const r=await ZS(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Ie(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ie(o.va):s.removedDocuments.size>0&&(Ie(o.va),o.va=!1))}),await is(t,r,e)}catch(r){await qs(r)}}function __(n,e,t){const r=ce(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ce(o);l.onlineState=a;let u=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(u=!0)}),u&&ap(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function MR(n,e,t){const r=ce(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new vt(pe.comparator);o=o.insert(i,wt.newNoDocument(i,Te.min()));const a=qe().add(i),l=new Fl(Te.min(),new Map,new vt(Ve),o,a);await Rw(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),hp(r)}else await Uo(r.localStore,e,!1).then(()=>jo(r,e,t)).catch(qs)}async function LR(n,e){const t=ce(n),r=e.batch.batchId;try{const s=await XS(t.localStore,e);dp(t,r,null),up(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await is(t,s)}catch(s){await qs(s)}}async function FR(n,e,t){const r=ce(n);try{const s=await function(o,a){const l=ce(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return l.mutationQueue.lookupMutationBatch(u,a).next(f=>(Ie(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(u,f))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>l.localDocuments.getDocuments(u,d))})}(r.localStore,e);dp(r,e,t),up(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await is(r,s)}catch(s){await qs(s)}}async function UR(n,e){const t=ce(n);Ks(t.remoteStore)||J("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=ce(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=ta(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function up(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function dp(n,e,t){const r=ce(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function jo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Cw(n,r)})}function Cw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Bo(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),hp(n))}function tf(n,e,t){for(const r of t)r instanceof Aw?(n.La.addReference(r.key,e),BR(n,r)):r instanceof xw?(J("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Cw(n,r.key)):_e()}function BR(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(J("SyncEngine","New document in limbo: "+t),n.xa.add(r),hp(n))}function hp(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new pe(We.fromString(e)),r=n.qa.next();n.Na.set(r,new RR(t)),n.Oa=n.Oa.insert(t,r),Zu(n.remoteStore,new $r(Tn(Qo(t.path)),r,"TargetPurposeLimboResolution",Mn.oe))}}async function is(n,e,t){const r=ce(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(u=>{var d;if((u||t)&&r.isPrimaryClient){const f=u?!u.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(u){s.push(u);const f=Xf.Wi(l.targetId,u);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,u){const d=ce(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>N.forEach(u,g=>N.forEach(g.$i,_=>d.persistence.referenceDelegate.addReference(f,g.targetId,_)).next(()=>N.forEach(g.Ui,_=>d.persistence.referenceDelegate.removeReference(f,g.targetId,_)))))}catch(f){if(!zs(f))throw f;J("LocalStore","Failed to update sequence numbers: "+f)}for(const f of u){const g=f.targetId;if(!f.fromCache){const _=d.os.get(g),C=_.snapshotVersion,P=_.withLastLimboFreeSnapshotVersion(C);d.os=d.os.insert(g,P)}}}(r.localStore,i))}async function $R(n,e){const t=ce(n);if(!t.currentUser.isEqual(e)){J("SyncEngine","User change. New user:",e.toKey());const r=await uw(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new Y(F.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await is(t,r.hs)}}function jR(n,e){const t=ce(n),r=t.Na.get(e);if(r&&r.va)return qe().add(r.key);{let s=qe();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function qR(n,e){const t=ce(n),r=await pu(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&tf(t,e.targetId,s.wa),s}async function zR(n,e){const t=ce(n);return pw(t.localStore,e).then(r=>is(t,r))}async function GR(n,e,t,r){const s=ce(n),i=await function(a,l){const u=ce(a),d=ce(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?u.localDocuments.getDocuments(f,g):N.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Zo(s.remoteStore):t==="acknowledged"||t==="rejected"?(dp(s,e,r||null),up(s,e),function(a,l){ce(ce(a).mutationQueue).On(l)}(s.localStore,e)):_e(),await is(s,i)):J("SyncEngine","Cannot apply mutation batch with id: "+e)}async function KR(n,e){const t=ce(n);if(ed(t),fp(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await v_(t,r.toArray());t.Qa=!0,await Zh(t.remoteStore,!0);for(const i of s)Zu(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(jo(t,o),Uo(t.localStore,o,!0))),Bo(t.remoteStore,o)}),await s,await v_(t,r),function(o){const a=ce(o);a.Na.forEach((l,u)=>{Bo(a.remoteStore,u)}),a.La.pr(),a.Na=new Map,a.Oa=new vt(pe.comparator)}(t),t.Qa=!1,await Zh(t.remoteStore,!1)}}async function v_(n,e,t){const r=ce(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Fo(r.localStore,Tn(l[0]));for(const u of l){const d=r.Fa.get(u),f=await qR(r,d);f.snapshot&&i.push(f.snapshot)}}else{const u=await fw(r.localStore,o);a=await Fo(r.localStore,u),await cp(r,kw(u),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function kw(n){return m0(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function HR(n){return function(t){return ce(ce(t).persistence).Qi()}(ce(n).localStore)}async function WR(n,e,t,r){const s=ce(n);if(s.Qa)return void J("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await pw(s.localStore,y0(i[0])),a=Fl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ot.EMPTY_BYTE_STRING);await is(s,o,a);break}case"rejected":await Uo(s.localStore,e,!0),jo(s,e,r);break;default:_e()}}async function QR(n,e,t){const r=ed(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){J("SyncEngine","Adding an already active target "+s);continue}const i=await fw(r.localStore,s),o=await Fo(r.localStore,i);await cp(r,kw(i),o.targetId,!1,o.resumeToken),Zu(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Uo(r.localStore,s,!1).then(()=>{Bo(r.remoteStore,s),jo(r,s)}).catch(qs)}}function ed(n){const e=ce(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Rw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jR.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=MR.bind(null,e),e.Ca.d_=TR.bind(null,e.eventManager),e.Ca.$a=AR.bind(null,e.eventManager),e}function fp(n){const e=ce(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=LR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=FR.bind(null,e),e}function JR(n,e,t){const r=ce(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(_,C){const P=ce(_),R=qt(C.createTime);return P.persistence.runTransaction("hasNewerBundle","readonly",L=>P.Gr.getBundleMetadata(L,C.id)).then(L=>!!L&&L.createTime.compareTo(R)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(_){return{taskState:"Success",documentsLoaded:_.totalDocuments,bytesLoaded:_.totalBytes,totalDocuments:_.totalDocuments,totalBytes:_.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Tw(l));const u=new PR(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await u.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await u.complete();return await is(i,f.Ia,void 0),await function(_,C){const P=ce(_);return P.persistence.runTransaction("Save bundle","readwrite",R=>P.Gr.saveBundleMetadata(R,C))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Zn("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Bs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Bl(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return cw(this.persistence,new lw,e.initialUser,this.serializer)}Ga(e){return new Qf(Xu.Zr,this.serializer)}Wa(e){return new gw}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Bs.provider={build:()=>new Bs};class YR extends Bs{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Ie(this.persistence.referenceDelegate instanceof fu);const r=this.persistence.referenceDelegate.garbageCollector;return new rw(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?yn.withCacheSize(this.cacheSizeBytes):yn.DEFAULT;return new Qf(r=>fu.Zr(r,t),this.serializer)}}class pp extends Bs{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await fp(this.Ja.syncEngine),await Zo(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return cw(this.persistence,new lw,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new rw(r,e.asyncQueue,t)}Ha(e,t){const r=new yP(t,this.persistence);return new vP(e.asyncQueue,r)}Ga(e){const t=Yf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?yn.withCacheSize(this.cacheSizeBytes):yn.DEFAULT;return new Jf(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,_w(),$c(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new gw}}class Dw extends pp{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof oh&&(this.sharedClientState.syncEngine={no:GR.bind(null,t),ro:WR.bind(null,t),io:QR.bind(null,t),Qi:HR.bind(null,t),eo:zR.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await KR(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=_w();if(!oh.D(t))throw new Y(F.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Yf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new oh(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class $s{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>__(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=$R.bind(null,this.syncEngine),await Zh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new ER}()}createDatastore(e){const t=Bl(e.databaseInfo.databaseId),r=function(i){return new oR(i)}(e.databaseInfo);return function(i,o,a,l){return new cR(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new dR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>__(this.syncEngine,t,0),function(){return d_.D()?new d_:new rR}())}createSyncEngine(e,t){return function(s,i,o,a,l,u,d){const f=new CR(s,i,o,a,l,u);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=ce(s);J("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Xo(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}$s.provider={build:()=>new $s};function y_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Bt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XR{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new on,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new xR(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Y(F.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=ce(s),a={documents:i.map(f=>ml(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,We.emptyPath(),a,i.length),u=new Map;l.forEach(f=>{const g=gS(o.serializer,f);u.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=u.get(f.toString());Ie(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Yo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=pe.fromPath(r);this.mutations.push(new Uf(s,this.precondition(s)))}),await async function(r,s){const i=ce(r),o={writes:s.map(a=>gl(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,We.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw _e();t=Te.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Y(F.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Te.min())?At.exists(!1):At.updateTime(t):At.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Te.min()))throw new Y(F.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return At.updateTime(t)}return At.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new ep(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new ZR(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Vl(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!V0(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=sn.UNAUTHENTICATED,this.clientId=zy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{J("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(J("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new on;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=ta(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function lh(n,e){n.asyncQueue.verifyOperationInProgress(),J("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await uw(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function w_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await mp(n);J("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>h_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>h_(e.remoteStore,s)),n._onlineComponents=e}async function mp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){J("FirestoreClient","Using user provided OfflineComponentProvider");try{await lh(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===F.FAILED_PRECONDITION||s.code===F.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Zn("Error using user provided cache. Falling back to memory cache: "+t),await lh(n,new Bs)}}else J("FirestoreClient","Using default OfflineComponentProvider"),await lh(n,new Bs);return n._offlineComponents}async function nd(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(J("FirestoreClient","Using user provided OnlineComponentProvider"),await w_(n,n._uninitializedComponentsProvider._online)):(J("FirestoreClient","Using default OnlineComponentProvider"),await w_(n,new $s))),n._onlineComponents}function Vw(n){return mp(n).then(e=>e.persistence)}function na(n){return mp(n).then(e=>e.localStore)}function Nw(n){return nd(n).then(e=>e.remoteStore)}function gp(n){return nd(n).then(e=>e.syncEngine)}function Ow(n){return nd(n).then(e=>e.datastore)}async function qo(n){const e=await nd(n),t=e.eventManager;return t.onListen=kR.bind(null,e.syncEngine),t.onUnlisten=VR.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=DR.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=NR.bind(null,e.syncEngine),t}function nC(n){return n.asyncQueue.enqueue(async()=>{const e=await Vw(n),t=await Nw(n);return e.setNetworkEnabled(!0),function(s){const i=ce(s);return i.L_.delete(0),$l(i)}(t)})}function rC(n){return n.asyncQueue.enqueue(async()=>{const e=await Vw(n),t=await Nw(n);return e.setNetworkEnabled(!1),async function(s){const i=ce(s);i.L_.add(0),await Xo(i),i.q_.set("Offline")}(t)})}function sC(n,e){const t=new on;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(u,d){const f=ce(u);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new Y(F.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=ta(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await na(n),e,t)),t.promise}function Mw(n,e,t={}){const r=new on;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const d=new td({next:g=>{d.Za(),o.enqueueAndForget(()=>op(i,f));const _=g.docs.has(a);!_&&g.fromCache?u.reject(new Y(F.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&g.fromCache&&l&&l.source==="server"?u.reject(new Y(F.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new lp(Qo(a.path),d,{includeMetadataChanges:!0,_a:!0});return ip(i,f)}(await qo(n),n.asyncQueue,e,t,r)),r.promise}function iC(n,e){const t=new on;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await pu(s,i,!0),l=new Pw(i,a.Ts),u=l.ma(a.documents),d=l.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){const l=ta(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await na(n),e,t)),t.promise}function Lw(n,e,t={}){const r=new on;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,u){const d=new td({next:g=>{d.Za(),o.enqueueAndForget(()=>op(i,f)),g.fromCache&&l.source==="server"?u.reject(new Y(F.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),f=new lp(a,d,{includeMetadataChanges:!0,_a:!0});return ip(i,f)}(await qo(n),n.asyncQueue,e,t,r)),r.promise}function oC(n,e,t){const r=new on;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Ow(n);r.resolve(async function(o,a,l){var u;const d=ce(o),{request:f,ut:g,parent:_}=G0(d.serializer,g0(a),l);d.connection.Fo||delete f.parent;const C=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,_,f,1)).filter(R=>!!R.result);Ie(C.length===1);const P=(u=C[0].result)===null||u===void 0?void 0:u.aggregateFields;return Object.keys(P).reduce((R,L)=>(R[g[L]]=P[L],R),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function aC(n,e){const t=new td(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){ce(s).Y_.add(i),i.next()}(await qo(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){ce(s).Y_.delete(i)}(await qo(n),t))}}function lC(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?O0().encode(o):o,function(d,f){return new XR(d,f)}(function(d,f){if(d instanceof Uint8Array)return y_(d,f);if(d instanceof ArrayBuffer)return y_(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Bl(e));n.asyncQueue.enqueueAndForget(async()=>{JR(await gp(n),s,r)})}function cC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=ce(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await na(n),e))}function uC(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=ce(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(u=>function(f,g,_,C,P){f=[...f],g=[...g],f.sort(_),g.sort(_);const R=f.length,L=g.length;let U=0,$=0;for(;U<L&&$<R;){const j=_(f[$],g[U]);j<0?P(f[$++]):j>0?C(g[U++]):(U++,$++)}for(;U<L;)C(g[U++]);for(;$<R;)P(f[$++])}(u,s,pP,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>N.waitFor(a)))}(await na(n),e))}function dC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){ce(r).ss.zi=s}(await na(n),e))}function hC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=ce(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await na(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _p(n,e,t){if(!t)throw new Y(F.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function fC(n,e,t,r){if(e===!0&&r===!0)throw new Y(F.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function I_(n){if(!pe.isDocumentKey(n))throw new Y(F.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function E_(n){if(pe.isDocumentKey(n))throw new Y(F.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function rd(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":_e()}function Ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Y(F.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=rd(n);throw new Y(F.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Uw(n,e){if(e<=0)throw new Y(F.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Y(F.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Y(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}fC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Fw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Y(F.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class jl{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new T_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Y(F.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Y(F.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new T_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new oP;switch(r.type){case"firstParty":return new uP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Y(F.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=b_.get(t);r&&(J("ComponentProvider","Removing Datastore"),b_.delete(t),r.terminate())}(this),Promise.resolve()}}function pC(n,e,t,r={}){var s;const i=(n=Ge(n,jl))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Zn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=sn.MOCK_USER;else{a=OA(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new Y(F.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new sn(u)}n._authCredentials=new aP(new jy(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new mn(this.firestore,e,this._query)}}class zt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new zt(this.firestore,e,this._key)}}class Rr extends mn{constructor(e,t,r){super(e,t,Qo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new zt(this.firestore,null,new pe(e))}withConverter(e){return new Rr(this.firestore,e,this._path)}}function nt(n,e,...t){if(n=Ae(n),_p("collection","path",e),n instanceof jl){const r=We.fromString(e,...t);return E_(r),new Rr(n,null,r)}{if(!(n instanceof zt||n instanceof Rr))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(We.fromString(e,...t));return E_(r),new Rr(n.firestore,null,r)}}function FL(n,e){if(n=Ge(n,jl),_p("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Y(F.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new mn(n,null,function(r){return new ns(We.emptyPath(),r)}(e))}function Be(n,e,...t){if(n=Ae(n),arguments.length===1&&(e=zy.newId()),_p("doc","path",e),n instanceof jl){const r=We.fromString(e,...t);return I_(r),new zt(n,null,new pe(r))}{if(!(n instanceof zt||n instanceof Rr))throw new Y(F.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(We.fromString(e,...t));return I_(r),new zt(n.firestore,n instanceof Rr?n.converter:null,new pe(r))}}function UL(n,e){return n=Ae(n),e=Ae(e),(n instanceof zt||n instanceof Rr)&&(e instanceof zt||e instanceof Rr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Bw(n,e){return n=Ae(n),e=Ae(e),n instanceof mn&&e instanceof mn&&n.firestore===e.firestore&&Ol(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ep(this,"async_queue_retry"),this.Vu=()=>{const r=$c();r&&J("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=$c();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=$c();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new on;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!zs(e))throw e;J("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Bt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=sp.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&_e()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function nf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class mC{constructor(){this._progressObserver={},this._taskCompletionResolver=new on,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BL=-1;class ht extends jl{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new A_,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new A_(e),this._firestoreClient=void 0,await e}}}function $L(n,e,t){t||(t="(default)");const r=Dl(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ns(i,e))return s;throw new Y(F.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new Y(F.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Y(F.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function gC(n,e){const t=typeof n=="object"?n:Vy(),r=typeof n=="string"?n:e||"(default)",s=Dl(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=VA("firestore");i&&pC(s,...i)}return s}function kt(n){if(n._terminated)throw new Y(F.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||$w(n),n._firestoreClient}function $w(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,u,d){return new BP(a,l,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Fw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new tC(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function _C(n,e){Zn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return jw(n,$s.provider,{build:r=>new pp(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function jL(n){Zn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();jw(n,$s.provider,{build:t=>new Dw(t,e.cacheSizeBytes)})}function jw(n,e,t){if((n=Ge(n,ht))._firestoreClient||n._terminated)throw new Y(F.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new Y(F.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},$w(n)}function qL(n){if(n._initialized&&!n._terminated)throw new Y(F.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new on;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Pr.D())return Promise.resolve();const s=r+"main";await Pr.delete(s)}(Yf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function zL(n){return function(t){const r=new on;return t.asyncQueue.enqueueAndForget(async()=>UR(await gp(t),r)),r.promise}(kt(n=Ge(n,ht)))}function GL(n){return nC(kt(n=Ge(n,ht)))}function KL(n){return rC(kt(n=Ge(n,ht)))}function HL(n){return Kx(n.app,"firestore",n._databaseId.database),n._delete()}function WL(n,e){const t=kt(n=Ge(n,ht)),r=new mC;return lC(t,n._databaseId,e,r),r}function QL(n,e){return cC(kt(n=Ge(n,ht)),e).then(t=>t?new mn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class vC{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ci(Ot.fromBase64String(e))}catch(t){throw new Y(F.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ci(Ot.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Y(F.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function JL(){return new Vi("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Y(F.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Y(F.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ve(this._lat,e._lat)||Ve(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC=/^__.*__$/;class wC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ss(e,this.data,this.fieldMask,t,this.fieldTransforms):new Jo(e,this.data,t,this.fieldTransforms)}}class qw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ss(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function zw(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _e()}}class id{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new id(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return vu(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(zw(this.Cu)&&yC.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class bC{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Bl(e)}Qu(e,t,r,s=!1){return new id({Cu:e,methodName:t,qu:r,path:Tt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Oi(n){const e=n._freezeSettings(),t=Bl(n._databaseId);return new bC(n._databaseId,!!e.ignoreUndefinedProperties,t)}function od(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);Ap("Data must be an object, but it was:",o,r);const a=Hw(r,o);let l,u;if(i.merge)l=new Ln(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=vl(e,f,t);if(!o.contains(g))throw new Y(F.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);Qw(d,g)||d.push(g)}l=new Ln(d),u=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,u=o.fieldTransforms;return new wC(new pn(a),l,u)}class ql extends Ni{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ql}}function Gw(n,e,t){return new id({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class yp extends Ni{_toFieldTransform(e){return new Ll(e.path,new Oo)}isEqual(e){return e instanceof yp}}class wp extends Ni{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Gw(this,e,!0),r=this.Ku.map(i=>Mi(i,t)),s=new Ai(r);return new Ll(e.path,s)}isEqual(e){return e instanceof wp&&Ns(this.Ku,e.Ku)}}class bp extends Ni{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Gw(this,e,!0),r=this.Ku.map(i=>Mi(i,t)),s=new xi(r);return new Ll(e.path,s)}isEqual(e){return e instanceof bp&&Ns(this.Ku,e.Ku)}}class Ip extends Ni{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Mo(e.serializer,A0(e.serializer,this.$u));return new Ll(e.path,t)}isEqual(e){return e instanceof Ip&&this.$u===e.$u}}function Ep(n,e,t,r){const s=n.Qu(1,e,t);Ap("Data must be an object, but it was:",s,r);const i=[],o=pn.empty();Gs(r,(l,u)=>{const d=ad(e,l,t);u=Ae(u);const f=s.Nu(d);if(u instanceof ql)i.push(d);else{const g=Mi(u,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new Ln(i);return new qw(o,a,s.fieldTransforms)}function Tp(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[vl(e,r,t)],l=[s];if(i.length%2!=0)throw new Y(F.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(vl(e,i[g])),l.push(i[g+1]);const u=[],d=pn.empty();for(let g=a.length-1;g>=0;--g)if(!Qw(u,a[g])){const _=a[g];let C=l[g];C=Ae(C);const P=o.Nu(_);if(C instanceof ql)u.push(_);else{const R=Mi(C,P);R!=null&&(u.push(_),d.set(_,R))}}const f=new Ln(u);return new qw(d,f,o.fieldTransforms)}function Kw(n,e,t,r=!1){return Mi(t,n.Qu(r?4:3,e))}function Mi(n,e){if(Ww(n=Ae(n)))return Ap("Unsupported field value:",e,n),Hw(n,e);if(n instanceof Ni)return function(r,s){if(!zw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Mi(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ae(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return A0(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Ct.fromDate(r);return{timestampValue:Lo(s.serializer,i)}}if(r instanceof Ct){const i=new Ct(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Lo(s.serializer,i)}}if(r instanceof vp)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ci)return{bytesValue:F0(s.serializer,r._byteString)};if(r instanceof zt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:zf(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof sd)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Ff(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${rd(r)}`)}(n,e)}function Hw(n,e){const t={};return r0(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gs(n,(r,s)=>{const i=Mi(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function Ww(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ct||n instanceof vp||n instanceof Ci||n instanceof zt||n instanceof Ni||n instanceof sd)}function Ap(n,e,t){if(!Ww(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=rd(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function vl(n,e,t){if((e=Ae(e))instanceof Vi)return e._internalPath;if(typeof e=="string")return ad(n,e);throw vu("Field path arguments must be of type string or ",n,!1,void 0,t)}const IC=new RegExp("[~\\*/\\[\\]]");function ad(n,e,t){if(e.search(IC)>=0)throw vu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Vi(...e.split("."))._internalPath}catch{throw vu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function vu(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new Y(F.INVALID_ARGUMENT,a+n+l)}function Qw(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new zt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new EC(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ld("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class EC extends yl{data(){return super.data()}}function ld(n,e){return typeof e=="string"?ad(n,e):e instanceof Vi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Y(F.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class xp{}class zl extends xp{}function Yw(n,e,...t){let r=[];e instanceof xp&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof ra).length,a=i.filter(l=>l instanceof Gl).length;if(o>1||o>0&&a>0)throw new Y(F.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Gl extends zl{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Gl(e,t,r)}_apply(e){const t=this._parse(e);return Zw(e._query,t),new mn(e.firestore,e.converter,zh(e._query,t))}_parse(e){const t=Oi(e.firestore);return function(i,o,a,l,u,d,f){let g;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new Y(F.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){P_(f,d);const _=[];for(const C of f)_.push(x_(l,i,C));g={arrayValue:{values:_}}}else g=x_(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||P_(f,d),g=Kw(a,o,f,d==="in"||d==="not-in");return Qe.create(u,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function TC(n,e,t){const r=e,s=ld("where",n);return Gl._create(s,r,t)}class ra extends xp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ra(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:at.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)Zw(o,l),o=zh(o,l)}(e._query,t),new mn(e.firestore,e.converter,zh(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function YL(...n){return n.forEach(e=>eb("or",e)),ra._create("or",n)}function XL(...n){return n.forEach(e=>eb("and",e)),ra._create("and",n)}class Pp extends zl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Pp(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new Y(F.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Y(F.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pl(i,o)}(e._query,this._field,this._direction);return new mn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new ns(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function AC(n,e="asc"){const t=e,r=ld("orderBy",n);return Pp._create(r,t)}class cd extends zl{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new cd(e,t,r)}_apply(e){return new mn(e.firestore,e.converter,lu(e._query,this._limit,this._limitType))}}function ZL(n){return Uw("limit",n),cd._create("limit",n,"F")}function eF(n){return Uw("limitToLast",n),cd._create("limitToLast",n,"L")}class ud extends zl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ud(e,t,r)}_apply(e){const t=Xw(e,this.type,this._docOrFields,this._inclusive);return new mn(e.firestore,e.converter,function(s,i){return new ns(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function tF(...n){return ud._create("startAt",n,!0)}function nF(...n){return ud._create("startAfter",n,!1)}class dd extends zl{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new dd(e,t,r)}_apply(e){const t=Xw(e,this.type,this._docOrFields,this._inclusive);return new mn(e.firestore,e.converter,function(s,i){return new ns(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function rF(...n){return dd._create("endBefore",n,!1)}function sF(...n){return dd._create("endAt",n,!0)}function Xw(n,e,t,r){if(t[0]=Ae(t[0]),t[0]instanceof yl)return function(i,o,a,l,u){if(!l)throw new Y(F.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of vo(i))if(f.field.isKeyField())d.push(Ei(o,l.key));else{const g=l.data.field(f.field);if(zu(g))throw new Y(F.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const _=f.field.canonicalString();throw new Y(F.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}d.push(g)}return new Fs(d,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Oi(n.firestore);return function(o,a,l,u,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new Y(F.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let C=0;C<d.length;C++){const P=d[C];if(g[C].field.isKeyField()){if(typeof P!="string")throw new Y(F.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof P}`);if(!Mf(o)&&P.indexOf("/")!==-1)throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${P}' contains a slash.`);const R=o.path.child(We.fromString(P));if(!pe.isDocumentKey(R))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const L=new pe(R);_.push(Ei(a,L))}else{const R=Kw(l,u,P);_.push(R)}}return new Fs(_,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function x_(n,e,t){if(typeof(t=Ae(t))=="string"){if(t==="")throw new Y(F.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Mf(e)&&t.indexOf("/")!==-1)throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(We.fromString(t));if(!pe.isDocumentKey(r))throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ei(n,new pe(r))}if(t instanceof zt)return Ei(n,t._key);throw new Y(F.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${rd(t)}.`)}function P_(n,e){if(!Array.isArray(n)||n.length===0)throw new Y(F.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Zw(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new Y(F.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Y(F.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function eb(n,e){if(!(e instanceof Gl||e instanceof ra))throw new Y(F.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class tb{convertValue(e,t="none"){switch(Ms(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Et(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Jr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw _e()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Gs(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Et(o.doubleValue));return new sd(i)}convertGeoPoint(e){return new vp(Et(e.latitude),Et(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Gu(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(dl(e));default:return null}}convertTimestamp(e){const t=Qr(e);return new Ct(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=We.fromString(e);Ie(Q0(r));const s=new Ii(r.get(1),r.get(3)),i=new pe(r.popFirst(5));return s.isEqual(t)||Bt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hd(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class xC extends tb{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ci(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new zt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iF(n){return new _l("sum",vl("sum",n))}function oF(n){return new _l("avg",vl("average",n))}function PC(){return new _l("count")}function aF(n,e){var t,r;return n instanceof _l&&e instanceof _l&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function lF(n,e){return Bw(n.query,e.query)&&Ns(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zo extends yl{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new jc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ld("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class jc extends zo{data(e={}){return super.data(e)}}class Go{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new pi(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new jc(this._firestore,this._userDataWriter,r.key,r,new pi(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Y(F.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new jc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new pi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new jc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new pi(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:SC(a.type),doc:l,oldIndex:u,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function SC(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _e()}}function cF(n,e){return n instanceof zo&&e instanceof zo?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Go&&e instanceof Go&&n._firestore===e._firestore&&Bw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(n){n=Ge(n,zt);const e=Ge(n.firestore,ht);return Mw(kt(e),n._key).then(t=>Sp(e,n,t))}class Hs extends tb{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ci(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new zt(this.firestore,null,t)}}function uF(n){n=Ge(n,zt);const e=Ge(n.firestore,ht),t=kt(e),r=new Hs(e);return sC(t,n._key).then(s=>new zo(e,r,n._key,s,new pi(s!==null&&s.hasLocalMutations,!0),n.converter))}function dF(n){n=Ge(n,zt);const e=Ge(n.firestore,ht);return Mw(kt(e),n._key,{source:"server"}).then(t=>Sp(e,n,t))}function xt(n){n=Ge(n,mn);const e=Ge(n.firestore,ht),t=kt(e),r=new Hs(e);return Jw(n._query),Lw(t,n._query).then(s=>new Go(e,r,n,s))}function hF(n){n=Ge(n,mn);const e=Ge(n.firestore,ht),t=kt(e),r=new Hs(e);return iC(t,n._query).then(s=>new Go(e,r,n,s))}function fF(n){n=Ge(n,mn);const e=Ge(n.firestore,ht),t=kt(e),r=new Hs(e);return Lw(t,n._query,{source:"server"}).then(s=>new Go(e,r,n,s))}function Cn(n,e,t){n=Ge(n,zt);const r=Ge(n.firestore,ht),s=hd(n.converter,e,t);return Kl(r,[od(Oi(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,At.none())])}function RC(n,e,t,...r){n=Ge(n,zt);const s=Ge(n.firestore,ht),i=Oi(s);let o;return o=typeof(e=Ae(e))=="string"||e instanceof Vi?Tp(i,"updateDoc",n._key,e,t,r):Ep(i,"updateDoc",n._key,e),Kl(s,[o.toMutation(n._key,At.exists(!0))])}function wl(n){return Kl(Ge(n.firestore,ht),[new Yo(n._key,At.none())])}function nb(n,e){const t=Ge(n.firestore,ht),r=Be(n),s=hd(n.converter,e);return Kl(t,[od(Oi(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,At.exists(!1))]).then(()=>r)}function pF(n,...e){var t,r,s;n=Ae(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||nf(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(nf(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,u,d;if(n instanceof zt)u=Ge(n.firestore,ht),d=Qo(n._key.path),l={next:f=>{e[o]&&e[o](Sp(u,n,f))},error:e[o+1],complete:e[o+2]};else{const f=Ge(n,mn);u=Ge(f.firestore,ht),d=f._query;const g=new Hs(u);l={next:_=>{e[o]&&e[o](new Go(u,g,f,_))},error:e[o+1],complete:e[o+2]},Jw(n._query)}return function(g,_,C,P){const R=new td(P),L=new lp(_,R,C);return g.asyncQueue.enqueueAndForget(async()=>ip(await qo(g),L)),()=>{R.Za(),g.asyncQueue.enqueueAndForget(async()=>op(await qo(g),L))}}(kt(u),d,a,l)}function mF(n,e){return aC(kt(n=Ge(n,ht)),nf(e)?e:{next:e})}function Kl(n,e){return function(r,s){const i=new on;return r.asyncQueue.enqueueAndForget(async()=>OR(await gp(r),s,i)),i.promise}(kt(n),e)}function Sp(n,e,t){const r=t.docs.get(e._key),s=new Hs(n);return new zo(n,s,e._key,r,new pi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gF(n){return CC(n,{count:PC()})}function CC(n,e){const t=Ge(n.firestore,ht),r=kt(t),s=n0(e,(i,o)=>new D0(o,i.aggregateType,i._internalFieldPath));return oC(r,n._query,s).then(i=>function(a,l,u){const d=new Hs(a);return new vC(l,d,u)}(t,n,i))}class kC{constructor(e){this.kind="memory",this._onlineComponentProvider=$s.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Bs.provider}toJSON(){return{kind:this.kind}}}class DC{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=LC(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class VC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Bs.provider}toJSON(){return{kind:this.kind}}}class NC{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new YR(e)}}toJSON(){return{kind:this.kind}}}function _F(){return new VC}function vF(n){return new NC(n==null?void 0:n.cacheSizeBytes)}function yF(n){return new kC(n)}function wF(n){return new DC(n)}class OC{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=$s.provider,this._offlineComponentProvider={build:t=>new pp(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class MC{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=$s.provider,this._offlineComponentProvider={build:t=>new Dw(t,e==null?void 0:e.cacheSizeBytes)}}}function LC(n){return new OC(n==null?void 0:n.forceOwnership)}function bF(){return new MC}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Oi(e)}set(e,t,r){this._verifyNotCommitted();const s=Is(e,this._firestore),i=hd(s.converter,t,r),o=od(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,At.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=Is(e,this._firestore);let o;return o=typeof(t=Ae(t))=="string"||t instanceof Vi?Tp(this._dataReader,"WriteBatch.update",i._key,t,r,s):Ep(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,At.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Is(e,this._firestore);return this._mutations=this._mutations.concat(new Yo(t._key,At.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Y(F.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Is(n,e){if((n=Ae(n)).firestore!==e)throw new Y(F.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Oi(t)}get(t){const r=Is(t,this._firestore),s=new xC(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return _e();const o=i[0];if(o.isFoundDocument())return new yl(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new yl(this._firestore,s,r._key,null,r.converter);throw _e()})}set(t,r,s){const i=Is(t,this._firestore),o=hd(i.converter,r,s),a=od(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=Is(t,this._firestore);let a;return a=typeof(r=Ae(r))=="string"||r instanceof Vi?Tp(this._dataReader,"Transaction.update",o._key,r,s,i):Ep(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Is(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Is(e,this._firestore),r=new Hs(this._firestore);return super.get(e).then(s=>new zo(this._firestore,r,t._key,s._document,new pi(!1,!1),t.converter))}}function EF(n,e,t){n=Ge(n,ht);const r=Object.assign(Object.assign({},FC),t);return function(i){if(i.maxAttempts<1)throw new Y(F.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new on;return i.asyncQueue.enqueueAndForget(async()=>{const u=await Ow(i);new eC(i.asyncQueue,u,a,o,l).au()}),l.promise}(kt(n),s=>e(new BC(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TF(){return new ql("deleteField")}function Rp(){return new yp("serverTimestamp")}function AF(...n){return new wp("arrayUnion",n)}function xF(...n){return new bp("arrayRemove",n)}function PF(n){return new Ip("increment",n)}function SF(n){return new sd(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rb(n){return kt(n=Ge(n,ht)),new UC(n,e=>Kl(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RF(n,e){const t=kt(n=Ge(n,ht));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Zn("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(u){try{return JSON.parse(u)}catch(d){throw new Y(F.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const u=S_(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=ad("setIndexConfiguration",S_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new yi(g,2)):f.order==="ASCENDING"?d.push(new yi(g,0)):f.order==="DESCENDING"&&d.push(new yi(g,1))}a.push(new ko(ko.UNKNOWN_ID,u,d,Do.empty()))}return a}(e);return uC(t,r)}function S_(n,e){if(typeof n[e]!="string")throw new Y(F.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function CF(n){var e;n=Ge(n,ht);const t=R_.get(n);if(t)return t;if(((e=kt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new $C(n);return R_.set(n,r),r}function kF(n){sb(n,!0)}function DF(n){sb(n,!1)}function VF(n){hC(kt(n._firestore)).then(e=>J("deleting all persistent cache indexes succeeded")).catch(e=>Zn("deleting all persistent cache indexes failed",e))}function sb(n,e){dC(kt(n._firestore),e).then(t=>J(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Zn(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const R_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NF(n){var e;const t=(e=kt(Ge(n.firestore,ht))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Qu(t,Tn(n._query))._t}function OF(n,e){var t;const r=n0(e,(i,o)=>new D0(o,i.aggregateType,i._internalFieldPath)),s=(t=kt(Ge(n.firestore,ht))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:G0(s,g0(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return Cp.instance.onExistenceFilterMismatch(e)}}class Cp{constructor(){this.Uu=new Map}static get instance(){return xc||(xc=new Cp,function(t){if(cu)throw new Error("a TestingHooksSpi instance is already set");cu=t}(xc)),xc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let xc=null;(function(e,t=!0){(function(s){Wo=s})(Ho),Ro(new bi("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new ht(new lP(r.getProvider("auth-internal")),new dP(r.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new Y(F.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ii(u.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),ks(vg,"4.7.3",e),ks(vg,"4.7.3","esm2017")})();function kp(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LF={PHONE:"phone",TOTP:"totp"},FF={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},UF={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},BF={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},$F={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jC(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function ib(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jF=jC,qC=ib,ob=new kl("auth","Firebase",ib()),qF={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yu=new Rf("@firebase/auth");function zC(n,...e){yu.logLevel<=He.WARN&&yu.warn(`Auth (${Ho}): ${n}`,...e)}function qc(n,...e){yu.logLevel<=He.ERROR&&yu.error(`Auth (${Ho}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(n,...e){throw Vp(n,...e)}function kn(n,...e){return Vp(n,...e)}function Dp(n,e,t){const r=Object.assign(Object.assign({},qC()),{[e]:t});return new kl("auth","Firebase",r).create(e,{appName:n.name})}function an(n){return Dp(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function sa(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Un(n,"argument-error"),Dp(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Vp(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return ob.create(n,...e)}function oe(n,e,...t){if(!n)throw Vp(e,...t)}function xr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw qc(e),new Error(e)}function Yr(n,e){n||xr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bl(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Np(){return C_()==="http:"||C_()==="https:"}function C_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GC(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Np()||UA()||"connection"in navigator)?navigator.onLine:!0}function KC(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(e,t){this.shortDelay=e,this.longDelay=t,Yr(t>e,"Short delay should be less than long delay!"),this.isMobile=MA()||BA()}get(){return GC()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Op(n,e){Yr(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HC={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WC=new Hl(3e4,6e4);function bt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function It(n,e,t,r,s={}){return lb(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ko(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u=Object.assign({method:e,headers:l},i);return FA()||(u.referrerPolicy="no-referrer"),ab.fetch()(cb(n,n.config.apiHost,t,a),u)})}async function lb(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},HC),e);try{const s=new JC(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Fa(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Fa(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Fa(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Fa(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Dp(n,d,u);Un(n,d)}}catch(s){if(s instanceof ts)throw s;Un(n,"network-request-failed",{message:String(s)})}}async function os(n,e,t,r,s={}){const i=await It(n,e,t,r,s);return"mfaPendingCredential"in i&&Un(n,"multi-factor-auth-required",{_serverResponse:i}),i}function cb(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Op(n.config,s):`${n.config.apiScheme}://${s}`}function QC(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class JC{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(kn(this.auth,"network-request-failed")),WC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Fa(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=kn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k_(n){return n!==void 0&&n.getResponse!==void 0}function D_(n){return n!==void 0&&n.enterprise!==void 0}class ub{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return QC(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YC(n){return(await It(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function db(n,e){return It(n,"GET","/v2/recaptchaConfig",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XC(n,e){return It(n,"POST","/v1/accounts:delete",e)}async function ZC(n,e){return It(n,"POST","/v1/accounts:update",e)}async function hb(n,e){return It(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zF(n,e=!1){return Ae(n).getIdToken(e)}async function e1(n,e=!1){const t=Ae(n),r=await t.getIdToken(e),s=fd(r);oe(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Za(ch(s.auth_time)),issuedAtTime:Za(ch(s.iat)),expirationTime:Za(ch(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function ch(n){return Number(n)*1e3}function fd(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return qc("JWT malformed, contained fewer than 3 sections"),null;try{const s=Ty(t);return s?JSON.parse(s):(qc("Failed to decode base64 JWT payload"),null)}catch(s){return qc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function V_(n){const e=fd(n);return oe(e,"internal-error"),oe(typeof e.exp<"u","internal-error"),oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof ts&&t1(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function t1({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Za(this.lastLoginAt),this.creationTime=Za(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Il(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Xr(n,hb(t,{idToken:r}));oe(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?fb(i.providerUserInfo):[],a=s1(n.providerData,o),l=n.isAnonymous,u=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?u:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new rf(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function r1(n){const e=Ae(n);await Il(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function s1(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function fb(n){return n.map(e=>{var{providerId:t}=e,r=kp(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i1(n,e){const t=await lb(n,{},async()=>{const r=Ko({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=cb(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ab.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function o1(n,e){return It(n,"POST","/v2/accounts:revokeToken",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){oe(e.idToken,"internal-error"),oe(typeof e.idToken<"u","internal-error"),oe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):V_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){oe(e.length!==0,"internal-error");const t=V_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await i1(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new wo;return r&&(oe(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(oe(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(oe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new wo,this.toJSON())}_performRefresh(){return xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gs(n,e){oe(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class jr{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=kp(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new n1(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new rf(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Xr(this,this.stsTokenManager.getToken(this.auth,e));return oe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return e1(this,e)}reload(){return r1(this)}_assign(e){this!==e&&(oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new jr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Il(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(jt(this.auth.app))return Promise.reject(an(this.auth));const e=await this.getIdToken();return await Xr(this,XC(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,u,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,_=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,C=(o=t.photoURL)!==null&&o!==void 0?o:void 0,P=(a=t.tenantId)!==null&&a!==void 0?a:void 0,R=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,L=(u=t.createdAt)!==null&&u!==void 0?u:void 0,U=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:$,emailVerified:j,isAnonymous:M,providerData:ae,stsTokenManager:T}=t;oe($&&T,e,"internal-error");const w=wo.fromJSON(this.name,T);oe(typeof $=="string",e,"internal-error"),gs(f,e.name),gs(g,e.name),oe(typeof j=="boolean",e,"internal-error"),oe(typeof M=="boolean",e,"internal-error"),gs(_,e.name),gs(C,e.name),gs(P,e.name),gs(R,e.name),gs(L,e.name),gs(U,e.name);const I=new jr({uid:$,auth:e,email:g,emailVerified:j,displayName:f,isAnonymous:M,photoURL:C,phoneNumber:_,tenantId:P,stsTokenManager:w,createdAt:L,lastLoginAt:U});return ae&&Array.isArray(ae)&&(I.providerData=ae.map(S=>Object.assign({},S))),R&&(I._redirectEventId=R),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new wo;s.updateFromServerResponse(t);const i=new jr({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Il(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];oe(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?fb(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new wo;a.updateFromIdToken(r);const l=new jr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new rf(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,u),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N_=new Map;function qr(n){Yr(n instanceof Function,"Expected a class definition");let e=N_.get(n);return e?(Yr(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,N_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pb{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}pb.type="NONE";const O_=pb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(n,e,t){return`firebase:${n}:${e}:${t}`}class bo{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=zc(this.userKey,s.apiKey,i),this.fullPersistenceKey=zc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?jr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new bo(qr(O_),e,r);const s=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let i=s[0]||qr(O_);const o=zc(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const d=await u._get(o);if(d){const f=jr._fromJSON(e,d);u!==i&&(a=f),i=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new bo(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==i)try{await u._remove(o)}catch{}})),new bo(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(vb(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(mb(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(wb(e))return"Blackberry";if(bb(e))return"Webos";if(gb(e))return"Safari";if((e.includes("chrome/")||_b(e))&&!e.includes("edge/"))return"Chrome";if(yb(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function mb(n=en()){return/firefox\//i.test(n)}function gb(n=en()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _b(n=en()){return/crios\//i.test(n)}function vb(n=en()){return/iemobile/i.test(n)}function yb(n=en()){return/android/i.test(n)}function wb(n=en()){return/blackberry/i.test(n)}function bb(n=en()){return/webos/i.test(n)}function Mp(n=en()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function a1(n=en()){var e;return Mp(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function l1(){return $A()&&document.documentMode===10}function Ib(n=en()){return Mp(n)||yb(n)||bb(n)||wb(n)||/windows phone/i.test(n)||vb(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(n,e=[]){let t;switch(n){case"Browser":t=M_(en());break;case"Worker":t=`${M_(en())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ho}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c1{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u1(n,e={}){return It(n,"GET","/v2/passwordPolicy",bt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d1=6;class h1{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:d1,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f1{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new L_(this),this.idTokenSubscription=new L_(this),this.beforeStateQueue=new c1(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ob,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qr(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await bo.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await hb(this,{idToken:e}),r=await jr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(jt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Il(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=KC()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(jt(this.app))return Promise.reject(an(this));const t=e?Ae(e):null;return t&&oe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return jt(this.app)?Promise.reject(an(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return jt(this.app)?Promise.reject(an(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qr(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await u1(this),t=new h1(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new kl("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await o1(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qr(e)||this._popupRedirectResolver;oe(t,this,"argument-error"),this.redirectPersistenceManager=await bo.create(this,[qr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(oe(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Eb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&zC(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Mt(n){return Ae(n)}class L_{constructor(e){this.auth=e,this.observer=null,this.addObserver=HA(t=>this.observer=t)}get next(){return oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wl={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function p1(n){Wl=n}function Lp(n){return Wl.loadJS(n)}function m1(){return Wl.recaptchaV2Script}function g1(){return Wl.recaptchaEnterpriseScript}function _1(){return Wl.gapiScript}function Tb(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const v1="recaptcha-enterprise",y1="NO_RECAPTCHA";class Ab{constructor(e){this.type=v1,this.auth=Mt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{db(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new ub(l);return i.tenantId==null?i._agentRecaptchaConfig=u:i._tenantRecaptchaConfigs[i.tenantId]=u,o(u.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;D_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(u=>{o(u)}).catch(()=>{o(y1)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&D_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=g1();l.length!==0&&(l+=a),Lp(l).then(()=>{s(a,i,o)}).catch(u=>{o(u)})}}).catch(a=>{o(a)})})}}async function F_(n,e,t,r=!1){const s=new Ab(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function El(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await F_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await F_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function w1(n){const e=Mt(n),t=await db(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new ub(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new Ab(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b1(n,e){const t=Dl(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ns(i,e??{}))return s;Un(s,"already-initialized")}return t.initialize({options:e})}function I1(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(qr);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function E1(n,e,t){const r=Mt(n);oe(r._canInitEmulator,r,"emulator-config-failed"),oe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=xb(e),{host:o,port:a}=T1(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||A1()}function xb(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function T1(n){const e=xb(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:U_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:U_(o)}}}function U_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function A1(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return xr("not implemented")}_getIdTokenResponse(e){return xr("not implemented")}_linkToIdToken(e,t){return xr("not implemented")}_getReauthenticationResolver(e){return xr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pb(n,e){return It(n,"POST","/v1/accounts:resetPassword",bt(n,e))}async function x1(n,e){return It(n,"POST","/v1/accounts:update",e)}async function P1(n,e){return It(n,"POST","/v1/accounts:signUp",e)}async function S1(n,e){return It(n,"POST","/v1/accounts:update",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R1(n,e){return os(n,"POST","/v1/accounts:signInWithPassword",bt(n,e))}async function pd(n,e){return It(n,"POST","/v1/accounts:sendOobCode",bt(n,e))}async function C1(n,e){return pd(n,e)}async function k1(n,e){return pd(n,e)}async function D1(n,e){return pd(n,e)}async function V1(n,e){return pd(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N1(n,e){return os(n,"POST","/v1/accounts:signInWithEmailLink",bt(n,e))}async function O1(n,e){return os(n,"POST","/v1/accounts:signInWithEmailLink",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl extends Ql{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Tl(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Tl(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return El(e,t,"signInWithPassword",R1);case"emailLink":return N1(e,{email:this._email,oobCode:this._password});default:Un(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return El(e,r,"signUpPassword",P1);case"emailLink":return O1(e,{idToken:t,email:this._email,oobCode:this._password});default:Un(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gr(n,e){return os(n,"POST","/v1/accounts:signInWithIdp",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M1="http://localhost";class Zr extends Ql{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Un("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=kp(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Zr(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Gr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Gr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Gr(e,t)}buildRequest(){const e={requestUri:M1,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ko(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L1(n,e){return It(n,"POST","/v1/accounts:sendVerificationCode",bt(n,e))}async function F1(n,e){return os(n,"POST","/v1/accounts:signInWithPhoneNumber",bt(n,e))}async function U1(n,e){const t=await os(n,"POST","/v1/accounts:signInWithPhoneNumber",bt(n,e));if(t.temporaryProof)throw Fa(n,"account-exists-with-different-credential",t);return t}const B1={USER_NOT_FOUND:"user-not-found"};async function $1(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return os(n,"POST","/v1/accounts:signInWithPhoneNumber",bt(n,t),B1)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi extends Ql{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new wi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new wi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return F1(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return U1(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return $1(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new wi({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j1(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function q1(n){const e=Da(Va(n)).link,t=e?Da(Va(e)).deep_link_id:null,r=Da(Va(n)).deep_link_id;return(r?Da(Va(r)).link:null)||r||t||e||n}class Jl{constructor(e){var t,r,s,i,o,a;const l=Da(Va(e)),u=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=j1((s=l.mode)!==null&&s!==void 0?s:null);oe(u&&d&&f,"argument-error"),this.apiKey=u,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=q1(e);try{return new Jl(t)}catch{return null}}}function GF(n){return Jl.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(){this.providerId=Fi.PROVIDER_ID}static credential(e,t){return Tl._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Jl.parseLink(t);return oe(r,"argument-error"),Tl._fromEmailAndCode(e,r.code,r.tenantId)}}Fi.PROVIDER_ID="password";Fi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Fi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia extends as{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Gc extends ia{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return oe("providerId"in t&&"signInMethod"in t,"argument-error"),Zr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return oe(e.idToken||e.accessToken,"argument-error"),Zr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Gc.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Gc.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new Gc(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es extends ia{constructor(){super("facebook.com")}static credential(e){return Zr._fromParams({providerId:Es.PROVIDER_ID,signInMethod:Es.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Es.credentialFromTaggedObject(e)}static credentialFromError(e){return Es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Es.credential(e.oauthAccessToken)}catch{return null}}}Es.FACEBOOK_SIGN_IN_METHOD="facebook.com";Es.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts extends ia{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zr._fromParams({providerId:Ts.PROVIDER_ID,signInMethod:Ts.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ts.credentialFromTaggedObject(e)}static credentialFromError(e){return Ts.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ts.credential(t,r)}catch{return null}}}Ts.GOOGLE_SIGN_IN_METHOD="google.com";Ts.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As extends ia{constructor(){super("github.com")}static credential(e){return Zr._fromParams({providerId:As.PROVIDER_ID,signInMethod:As.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return As.credentialFromTaggedObject(e)}static credentialFromError(e){return As.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return As.credential(e.oauthAccessToken)}catch{return null}}}As.GITHUB_SIGN_IN_METHOD="github.com";As.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z1="http://localhost";class Al extends Ql{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Gr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Gr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Gr(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Al(r,i)}static _create(e,t){return new Al(e,t)}buildRequest(){return{requestUri:z1,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G1="saml.";class sf extends as{constructor(e){oe(e.startsWith(G1),"argument-error"),super(e)}static credentialFromResult(e){return sf.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return sf.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Al.fromJSON(e);return oe(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Al._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs extends ia{constructor(){super("twitter.com")}static credential(e,t){return Zr._fromParams({providerId:xs.PROVIDER_ID,signInMethod:xs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return xs.credentialFromTaggedObject(e)}static credentialFromError(e){return xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return xs.credential(t,r)}catch{return null}}}xs.TWITTER_SIGN_IN_METHOD="twitter.com";xs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sb(n,e){return os(n,"POST","/v1/accounts:signUp",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await jr._fromIdTokenResponse(e,r,s),o=B_(r);return new er({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=B_(r);return new er({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function B_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K1(n){var e;if(jt(n.app))return Promise.reject(an(n));const t=Mt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new er({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await Sb(t,{returnSecureToken:!0}),s=await er._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu extends ts{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,wu.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new wu(e,t,r,s)}}function Rb(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?wu._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KF(n,e){const t=Ae(n);await md(!0,t,e);const{providerUserInfo:r}=await ZC(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=Cb(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Fp(n,e,t=!1){const r=await Xr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return er._forOperation(n,"link",r)}async function md(n,e,t){await Il(e);const r=Cb(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";oe(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kb(n,e,t=!1){const{auth:r}=n;if(jt(r.app))return Promise.reject(an(r));const s="reauthenticate";try{const i=await Xr(n,Rb(r,s,e,n),t);oe(i.idToken,r,"internal-error");const o=fd(i.idToken);oe(o,r,"internal-error");const{sub:a}=o;return oe(n.uid===a,r,"user-mismatch"),er._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Un(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Db(n,e,t=!1){if(jt(n.app))return Promise.reject(an(n));const r="signIn",s=await Rb(n,r,e),i=await er._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Up(n,e){return Db(Mt(n),e)}async function H1(n,e){const t=Ae(n);return await md(!1,t,e.providerId),Fp(t,e)}async function W1(n,e){return kb(Ae(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q1(n,e){return os(n,"POST","/v1/accounts:signInWithCustomToken",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HF(n,e){if(jt(n.app))return Promise.reject(an(n));const t=Mt(n),r=await Q1(t,{token:e,returnSecureToken:!0}),s=await er._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Bp._fromServerResponse(e,t):"totpInfo"in t?$p._fromServerResponse(e,t):Un(e,"internal-error")}}class Bp extends Yl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Bp(t)}}class $p extends Yl{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new $p(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gd(n,e,t){var r;oe(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),oe(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(oe(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(oe(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jp(n){const e=Mt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function J1(n,e,t){const r=Mt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&gd(r,s,t),await El(r,s,"getOobCode",k1)}async function Y1(n,e,t){await Pb(Ae(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&jp(n),r})}async function WF(n,e){await S1(Ae(n),{oobCode:e})}async function X1(n,e){const t=Ae(n),r=await Pb(t,{oobCode:e}),s=r.requestType;switch(oe(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":oe(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":oe(r.mfaInfo,t,"internal-error");default:oe(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Yl._fromServerResponse(Mt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function QF(n,e){const{data:t}=await X1(Ae(n),e);return t.email}async function Z1(n,e,t){if(jt(n.app))return Promise.reject(an(n));const r=Mt(n),o=await El(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Sb).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&jp(n),l}),a=await er._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function ek(n,e,t){return jt(n.app)?Promise.reject(an(n)):Up(Ae(n),Fi.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&jp(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JF(n,e,t){const r=Mt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){oe(a.handleCodeInApp,r,"argument-error"),a&&gd(r,o,a)}i(s,t),await El(r,s,"getOobCode",D1)}function YF(n,e){const t=Jl.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function XF(n,e,t){if(jt(n.app))return Promise.reject(an(n));const r=Ae(n),s=Fi.credentialWithLink(e,t||bl());return oe(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Up(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tk(n,e){return It(n,"POST","/v1/accounts:createAuthUri",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZF(n,e){const t=Np()?bl():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await tk(Ae(n),r);return s||[]}async function e4(n,e){const t=Ae(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&gd(t.auth,s,e);const{email:i}=await C1(t.auth,s);i!==n.email&&await n.reload()}async function t4(n,e,t){const r=Ae(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&gd(r.auth,i,t);const{email:o}=await V1(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nk(n,e){return It(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n4(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ae(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Xr(r,nk(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function r4(n,e){const t=Ae(n);return jt(t.auth.app)?Promise.reject(an(t.auth)):Vb(t,e,null)}function rk(n,e){return Vb(Ae(n),null,e)}async function Vb(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Xr(n,x1(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sk(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=fd(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Io(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new ik(i,s);case"github.com":return new ok(i,s);case"google.com":return new ak(i,s);case"twitter.com":return new lk(i,s,n.screenName||null);case"custom":case"anonymous":return new Io(i,null);default:return new Io(i,r,s)}}class Io{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Nb extends Io{constructor(e,t,r,s){super(e,t,r),this.username=s}}class ik extends Io{constructor(e,t){super(e,"facebook.com",t)}}class ok extends Nb{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class ak extends Io{constructor(e,t){super(e,"google.com",t)}}class lk extends Nb{constructor(e,t,r){super(e,"twitter.com",t,r)}}function s4(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:sk(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i4(n,e){return Ae(n).setPersistence(e)}function o4(n){return w1(n)}async function a4(n,e){return Mt(n).validatePassword(e)}function ck(n,e,t,r){return Ae(n).onIdTokenChanged(e,t,r)}function uk(n,e,t){return Ae(n).beforeAuthStateChanged(e,t)}function l4(n,e,t,r){return Ae(n).onAuthStateChanged(e,t,r)}function c4(n){Ae(n).useDeviceLanguage()}function u4(n,e){return Ae(n).updateCurrentUser(e)}function d4(n){return Ae(n).signOut()}function h4(n,e){return Mt(n).revokeAccessToken(e)}async function f4(n){return Ae(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new mi("enroll",e,t)}static _fromMfaPendingCredential(e){return new mi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return mi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return mi._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Mt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Yl._fromServerResponse(r,a));oe(s.mfaPendingCredential,r,"internal-error");const o=mi._fromMfaPendingCredential(s.mfaPendingCredential);return new qp(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const u=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await er._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return oe(t.user,r,"internal-error"),er._forOperation(t.user,t.operationType,u);default:Un(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function p4(n,e){var t;const r=Ae(n),s=e;return oe(e.customData.operationType,r,"argument-error"),oe((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),qp._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dk(n,e){return It(n,"POST","/v2/accounts/mfaEnrollment:start",bt(n,e))}function hk(n,e){return It(n,"POST","/v2/accounts/mfaEnrollment:finalize",bt(n,e))}function fk(n,e){return It(n,"POST","/v2/accounts/mfaEnrollment:start",bt(n,e))}function pk(n,e){return It(n,"POST","/v2/accounts/mfaEnrollment:finalize",bt(n,e))}function mk(n,e){return It(n,"POST","/v2/accounts/mfaEnrollment:withdraw",bt(n,e))}class zp{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Yl._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new zp(e)}async getSession(){return mi._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Xr(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Xr(this.user,mk(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const uh=new WeakMap;function m4(n){const e=Ae(n);return uh.has(e)||uh.set(e,zp._fromUser(e)),uh.get(e)}const bu="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(bu,"1"),this.storage.removeItem(bu),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gk=1e3,_k=10;class Mb extends Ob{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ib(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);l1()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,_k):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},gk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Mb.type="LOCAL";const vk=Mb;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lb extends Ob{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Lb.type="SESSION";const Fb=Lb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new _d(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async u=>u(t.origin,i)),l=await yk(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}_d.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const u=vd("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===u)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(){return window}function bk(n){Wt().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gp(){return typeof Wt().WorkerGlobalScope<"u"&&typeof Wt().importScripts=="function"}async function Ik(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Ek(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Tk(){return Gp()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ub="firebaseLocalStorageDb",Ak=1,Iu="firebaseLocalStorage",Bb="fbase_key";class Xl{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function yd(n,e){return n.transaction([Iu],e?"readwrite":"readonly").objectStore(Iu)}function xk(){const n=indexedDB.deleteDatabase(Ub);return new Xl(n).toPromise()}function of(){const n=indexedDB.open(Ub,Ak);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Iu,{keyPath:Bb})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Iu)?e(r):(r.close(),await xk(),e(await of()))})})}async function $_(n,e,t){const r=yd(n,!0).put({[Bb]:e,value:t});return new Xl(r).toPromise()}async function Pk(n,e){const t=yd(n,!1).get(e),r=await new Xl(t).toPromise();return r===void 0?null:r.value}function j_(n,e){const t=yd(n,!0).delete(e);return new Xl(t).toPromise()}const Sk=800,Rk=3;class $b{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await of(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Rk)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Gp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_d._getInstance(Tk()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Ik(),!this.activeServiceWorker)return;this.sender=new wk(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Ek()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await of();return await $_(e,bu,"1"),await j_(e,bu),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>$_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Pk(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>j_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=yd(s,!1).getAll();return new Xl(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Sk)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}$b.type="LOCAL";const Ck=$b;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kk(n,e){return It(n,"POST","/v2/accounts/mfaSignIn:start",bt(n,e))}function Dk(n,e){return It(n,"POST","/v2/accounts/mfaSignIn:finalize",bt(n,e))}function Vk(n,e){return It(n,"POST","/v2/accounts/mfaSignIn:finalize",bt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=500,Ok=6e4,Pc=1e12;class Mk{constructor(e){this.auth=e,this.counter=Pc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new Lk(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Pc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Pc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Pc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class Lk{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;oe(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=Fk(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Ok)},Nk))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function Fk(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh=Tb("rcb"),Uk=new Hl(3e4,6e4);class Bk{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Wt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return oe($k(t),e,"argument-error"),this.shouldResolveImmediately(t)&&k_(Wt().grecaptcha)?Promise.resolve(Wt().grecaptcha):new Promise((r,s)=>{const i=Wt().setTimeout(()=>{s(kn(e,"network-request-failed"))},Uk.get());Wt()[dh]=()=>{Wt().clearTimeout(i),delete Wt()[dh];const a=Wt().grecaptcha;if(!a||!k_(a)){s(kn(e,"internal-error"));return}const l=a.render;a.render=(u,d)=>{const f=l(u,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${m1()}?${Ko({onload:dh,render:"explicit",hl:t})}`;Lp(o).catch(()=>{clearTimeout(i),s(kn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Wt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function $k(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class jk{async load(e){return new Mk(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jb="recaptcha",qk={theme:"light",type:"image"};class g4{constructor(e,t,r=Object.assign({},qk)){this.parameters=r,this.type=jb,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Mt(e),this.isInvisible=this.parameters.size==="invisible",oe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;oe(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new jk:new Bk,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){oe(!this.parameters.sitekey,this.auth,"argument-error"),oe(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),oe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Wt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){oe(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){oe(Np()&&!Gp(),this.auth,"internal-error"),await zk(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await YC(this.auth);oe(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return oe(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function zk(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=wi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function _4(n,e,t){if(jt(n.app))return Promise.reject(an(n));const r=Mt(n),s=await wd(r,e,Ae(t));return new Kp(s,i=>Up(r,i))}async function v4(n,e,t){const r=Ae(n);await md(!1,r,"phone");const s=await wd(r.auth,e,Ae(t));return new Kp(s,i=>H1(r,i))}async function y4(n,e,t){const r=Ae(n);if(jt(r.auth.app))return Promise.reject(an(r.auth));const s=await wd(r.auth,e,Ae(t));return new Kp(s,i=>W1(r,i))}async function wd(n,e,t){var r;const s=await t.verify();try{oe(typeof s=="string",n,"argument-error"),oe(t.type===jb,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return oe(o.type==="enroll",n,"internal-error"),(await dk(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{oe(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return oe(a,n,"missing-multi-factor-info"),(await kk(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await L1(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function w4(n,e){const t=Ae(n);if(jt(t.auth.app))return Promise.reject(an(t.auth));await Fp(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e){this.providerId=Eo.PROVIDER_ID,this.auth=Mt(e)}verifyPhoneNumber(e,t){return wd(this.auth,e,Ae(t))}static credential(e,t){return wi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Eo.credentialFromTaggedObject(t)}static credentialFromError(e){return Eo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?wi._fromTokenResponse(t,r):null}}Eo.PROVIDER_ID="phone";Eo.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(n,e){return e?qr(e):(oe(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp extends Ql{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Gr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Gr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Gr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Gk(n){return Db(n.auth,new Hp(n),n.bypassAuthState)}function Kk(n){const{auth:e,user:t}=n;return oe(t,e,"internal-error"),kb(t,new Hp(n),n.bypassAuthState)}async function Hk(n){const{auth:e,user:t}=n;return oe(t,e,"internal-error"),Fp(t,new Hp(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Gk;case"linkViaPopup":case"linkViaRedirect":return Hk;case"reauthViaPopup":case"reauthViaRedirect":return Kk;default:Un(this.auth,"internal-error")}}resolve(e){Yr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wk=new Hl(2e3,1e4);async function b4(n,e,t){if(jt(n.app))return Promise.reject(kn(n,"operation-not-supported-in-this-environment"));const r=Mt(n);sa(n,e,as);const s=Ui(r,t);return new zr(r,"signInViaPopup",e,s).executeNotNull()}async function I4(n,e,t){const r=Ae(n);if(jt(r.auth.app))return Promise.reject(kn(r.auth,"operation-not-supported-in-this-environment"));sa(r.auth,e,as);const s=Ui(r.auth,t);return new zr(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function E4(n,e,t){const r=Ae(n);sa(r.auth,e,as);const s=Ui(r.auth,t);return new zr(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class zr extends qb{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,zr.currentPopupAction&&zr.currentPopupAction.cancel(),zr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return oe(e,this.auth,"internal-error"),e}async onExecution(){Yr(this.filter.length===1,"Popup operations only handle one event");const e=vd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(kn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(kn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,zr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Wk.get())};e()}}zr.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk="pendingRedirect",Kc=new Map;class Jk extends qb{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Kc.get(this.auth._key());if(!e){try{const r=await Yk(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Kc.set(this.auth._key(),e)}return this.bypassAuthState||Kc.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Yk(n,e){const t=Gb(e),r=zb(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Wp(n,e){return zb(n)._set(Gb(e),"true")}function Xk(n,e){Kc.set(n._key(),e)}function zb(n){return qr(n._redirectPersistence)}function Gb(n){return zc(Qk,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4(n,e,t){return Zk(n,e,t)}async function Zk(n,e,t){if(jt(n.app))return Promise.reject(an(n));const r=Mt(n);sa(n,e,as),await r._initializationPromise;const s=Ui(r,t);return await Wp(s,r),s._openRedirect(r,e,"signInViaRedirect")}function A4(n,e,t){return eD(n,e,t)}async function eD(n,e,t){const r=Ae(n);if(sa(r.auth,e,as),jt(r.auth.app))return Promise.reject(an(r.auth));await r.auth._initializationPromise;const s=Ui(r.auth,t);await Wp(s,r.auth);const i=await Hb(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function x4(n,e,t){return tD(n,e,t)}async function tD(n,e,t){const r=Ae(n);sa(r.auth,e,as),await r.auth._initializationPromise;const s=Ui(r.auth,t);await md(!1,r,e.providerId),await Wp(s,r.auth);const i=await Hb(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function P4(n,e){return await Mt(n)._initializationPromise,Kb(n,e,!1)}async function Kb(n,e,t=!1){if(jt(n.app))return Promise.reject(an(n));const r=Mt(n),s=Ui(r,e),o=await new Jk(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function Hb(n){const e=vd(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nD=10*60*1e3;class rD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!sD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Wb(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(kn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=nD&&this.cachedEventUids.clear(),this.cachedEventUids.has(q_(e))}saveEventToCache(e){this.cachedEventUids.add(q_(e)),this.lastProcessedEventTime=Date.now()}}function q_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Wb({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function sD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Wb(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iD(n,e={}){return It(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,aD=/^https?/;async function lD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await iD(n);for(const t of e)try{if(cD(t))return}catch{}Un(n,"unauthorized-domain")}function cD(n){const e=bl(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!aD.test(t))return!1;if(oD.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uD=new Hl(3e4,6e4);function z_(){const n=Wt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function dD(n){return new Promise((e,t)=>{var r,s,i;function o(){z_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{z_(),t(kn(n,"network-request-failed"))},timeout:uD.get()})}if(!((s=(r=Wt().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Wt().gapi)===null||i===void 0)&&i.load)o();else{const a=Tb("iframefcb");return Wt()[a]=()=>{gapi.load?o():t(kn(n,"network-request-failed"))},Lp(`${_1()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Hc=null,e})}let Hc=null;function hD(n){return Hc=Hc||dD(n),Hc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD=new Hl(5e3,15e3),pD="__/auth/iframe",mD="emulator/auth/iframe",gD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_D=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function vD(n){const e=n.config;oe(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Op(e,mD):`https://${n.config.authDomain}/${pD}`,r={apiKey:e.apiKey,appName:n.name,v:Ho},s=_D.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ko(r).slice(1)}`}async function yD(n){const e=await hD(n),t=Wt().gapi;return oe(t,n,"internal-error"),e.open({where:document.body,url:vD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gD,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=kn(n,"network-request-failed"),a=Wt().setTimeout(()=>{i(o)},fD.get());function l(){Wt().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},bD=500,ID=600,ED="_blank",TD="http://localhost";class G_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AD(n,e,t,r=bD,s=ID){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},wD),{width:r.toString(),height:s.toString(),top:i,left:o}),u=en().toLowerCase();t&&(a=_b(u)?ED:t),mb(u)&&(e=e||TD,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[_,C])=>`${g}${_}=${C},`,"");if(a1(u)&&a!=="_self")return xD(e||"",a),new G_(null);const f=window.open(e||"",a,d);oe(f,n,"popup-blocked");try{f.focus()}catch{}return new G_(f)}function xD(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PD="__/auth/handler",SD="emulator/auth/handler",RD=encodeURIComponent("fac");async function K_(n,e,t,r,s,i){oe(n.config.authDomain,n,"auth-domain-config-required"),oe(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Ho,eventId:s};if(e instanceof as){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",KA(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof ia){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),u=l?`#${RD}=${encodeURIComponent(l)}`:"";return`${CD(n)}?${Ko(a).slice(1)}${u}`}function CD({config:n}){return n.emulator?Op(n,SD):`https://${n.authDomain}/${PD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hh="webStorageSupport";class kD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Fb,this._completeRedirectFn=Kb,this._overrideRedirectResult=Xk}async _openPopup(e,t,r,s){var i;Yr((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await K_(e,t,r,bl(),s);return AD(e,o,vd())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await K_(e,t,r,bl(),s);return bk(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Yr(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await yD(e),r=new rD(e);return t.register("authEvent",s=>(oe(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(hh,{type:hh},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[hh];o!==void 0&&t(!!o),Un(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=lD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ib()||gb()||Mp()}}const DD=kD;class Qb{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return xr("unexpected MultiFactorSessionType")}}}class Qp extends Qb{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Qp(e)}_finalizeEnroll(e,t,r){return hk(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return Dk(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class VD{constructor(){}static assertion(e){return Qp._fromCredential(e)}}VD.FACTOR_ID="phone";class ND{static assertionForEnrollment(e,t){return xl._fromSecret(e,t)}static assertionForSignIn(e,t){return xl._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;oe(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await fk(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return Jp._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}ND.FACTOR_ID="totp";class xl extends Qb{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new xl(t,void 0,e)}static _fromEnrollmentId(e,t){return new xl(t,e)}async _finalizeEnroll(e,t,r){return oe(typeof this.secret<"u",e,"argument-error"),pk(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){oe(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return Vk(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class Jp{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new Jp(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Sc(e)||Sc(t))&&(s=!0),s&&(Sc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Sc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Sc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var H_="@firebase/auth",W_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MD(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function LD(n){Ro(new bi("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;oe(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Eb(n)},u=new f1(r,s,i,l);return I1(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ro(new bi("auth-internal",e=>{const t=Mt(e.getProvider("auth").getImmediate());return(r=>new OD(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ks(H_,W_,MD(n)),ks(H_,W_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD=5*60,UD=Py("authIdTokenMaxAge")||FD;let Q_=null;const BD=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>UD)return;const s=t==null?void 0:t.token;Q_!==s&&(Q_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function $D(n=Vy()){const e=Dl(n,"auth");if(e.isInitialized())return e.getImmediate();const t=b1(n,{popupRedirectResolver:DD,persistence:[Ck,vk,Fb]}),r=Py("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=BD(i.toString());uk(t,o,()=>o(t.currentUser)),ck(t,a=>o(a))}}const s=Ay("auth");return s&&E1(t,`http://${s}`),t}function jD(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}p1({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=kn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",jD().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});LD("Browser");const qD={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Jb=Dy(qD),we=gC(Jb),Bi=$D(Jb);try{_C(we)}catch{}K1(Bi);async function zD(n,e){try{return(await Z1(Bi,n,e)).user}catch(t){throw t}}async function GD(n,e){try{return(await ek(Bi,n,e)).user}catch(t){throw t}}async function KD(n){try{await J1(Bi,n)}catch(e){throw e}}async function HD(n){try{const e=Bi.currentUser;if(e)await rk(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const To=Object.freeze(Object.defineProperty({__proto__:null,auth:Bi,createPlayerAccount:zD,db:we,resetPlayerPassword:KD,signInPlayer:GD,updatePlayerPassword:HD},Symbol.toStringTag,{value:"Module"})),oa="seasons";async function WD(n,e,t){return await nb(nt(we,oa),{name:n,slug:e,pinCode:t,createdAt:Rp()})}async function QD(n){return await wl(Be(we,oa,n))}async function fh(){const n=Yw(nt(we,oa),AC("createdAt","desc"));return(await xt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Eu(n,e){const t=await Li(Be(we,oa,n));return t.exists()?t.data().pinCode===e:!1}async function af(n){const e=await Li(Be(we,oa,n));return e.exists()?e.data().pinCode:null}async function Sa(n,e){const t=Be(we,oa,n);await RC(t,{sortOrder:e})}const ph=10*60*1e3,mh="impro_selector_pin_session";class JD{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(mh);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<ph)return t;this.clearSession()}}catch(e){console.error("Erreur lors du chargement de la session PIN:",e)}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(mh,JSON.stringify(r)),this.sessionData=r}catch(r){console.error("Erreur lors de la sauvegarde de la session PIN:",r)}}isPinCached(e){return this.sessionData?this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<ph:!1}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(mh),this.sessionData=null}catch(e){console.error("Erreur lors de la suppression de la session PIN:",e)}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=ph-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const On=new JD,YD={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},XD={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},ZD={class:"text-center mb-6"},eV={class:"text-gray-300"},tV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},nV={class:"text-sm text-green-400"},rV={class:"mb-4 flex justify-center"},sV={class:"flex bg-gray-800 rounded-lg p-1"},iV={key:0,class:"mb-6"},oV={class:"mb-4"},aV={key:1,class:"mb-6"},lV={class:"flex justify-center space-x-3 mb-4"},cV={class:"grid grid-cols-3 gap-3 mb-4"},uV=["onClick"],dV={key:2,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},hV={class:"flex justify-end space-x-3"},fV=["disabled"],Yb={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=q(""),i=q(""),o=q("direct"),a=q(null);ur(()=>t.show,P=>{P&&(s.value="",i.value="",o.value==="direct"&&Er(()=>{var R;(R=a.value)==null||R.focus()}))}),ur(o,P=>{P==="direct"&&t.show&&Er(()=>{var R;(R=a.value)==null||R.focus()})});function l(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function u(P){s.value.length<4&&(s.value+=P.toString())}function d(){s.value=s.value.slice(0,-1)}function f(){s.value="",i.value=""}function g(){s.value.length===4&&r("submit",s.value)}function _(){r("cancel")}const C=P=>{t.show&&(P.key>="0"&&P.key<="9"?o.value==="keypad"&&u(parseInt(P.key)):P.key==="Backspace"?o.value==="keypad"&&d():P.key==="Enter"?g():P.key==="Escape"&&_())};return typeof window<"u"&&window.addEventListener("keydown",C),(P,R)=>n.show?(H(),W("div",YD,[p("div",XD,[p("div",ZD,[R[4]||(R[4]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),R[5]||(R[5]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),p("p",eV,ge(n.message),1),n.sessionInfo?(H(),W("div",tV,[p("p",nV," Session active : "+ge(n.sessionInfo.timeRemaining)+" min restantes ",1)])):Ee("",!0)]),p("div",rV,[p("div",sV,[p("button",{onClick:R[0]||(R[0]=L=>o.value="direct"),class:ar(["px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",o.value==="direct"?"bg-purple-600 text-white":"text-gray-400 hover:text-white"])}," Saisie directe ",2),p("button",{onClick:R[1]||(R[1]=L=>o.value="keypad"),class:ar(["px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",o.value==="keypad"?"bg-purple-600 text-white":"text-gray-400 hover:text-white"])}," Pavé numérique ",2)])]),o.value==="direct"?(H(),W("div",iV,[p("div",oV,[R[6]||(R[6]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),lt(p("input",{"onUpdate:modelValue":R[2]||(R[2]=L=>s.value=L),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:l,onKeydown:[Sn(g,["enter"]),Sn(_,["escape"])],ref_key:"pinInput",ref:a},null,544),[[St,s.value]])]),R[7]||(R[7]=p("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))])):(H(),W("div",aV,[p("div",lV,[(H(),W(Rt,null,Ir(4,(L,U)=>p("div",{key:U,class:ar(["w-12 h-12 border-2 border-gray-600 rounded-lg flex items-center justify-center text-2xl font-bold text-white bg-gray-800",{"border-purple-500 bg-purple-900/20":s.value.length>U}])},ge(s.value[U]||"•"),3)),64))]),p("div",cV,[(H(),W(Rt,null,Ir([1,2,3,4,5,6,7,8,9],L=>p("button",{key:L,onClick:U=>u(L),class:"w-12 h-12 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold text-xl transition-all duration-200 hover:scale-105"},ge(L),9,uV)),64)),p("button",{onClick:f,class:"w-12 h-12 bg-red-600 hover:bg-red-500 text-white rounded-lg font-bold text-lg transition-all duration-200 hover:scale-105"}," C "),p("button",{onClick:R[3]||(R[3]=L=>u(0)),class:"w-12 h-12 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold text-xl transition-all duration-200 hover:scale-105"}," 0 "),p("button",{onClick:d,class:"w-12 h-12 bg-gray-600 hover:bg-gray-500 text-white rounded-lg font-bold text-lg transition-all duration-200 hover:scale-105"}," ← ")])])),i.value||t.error?(H(),W("div",dV,ge(i.value||t.error),1)):Ee("",!0),p("div",hV,[p("button",{onClick:_,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:g,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,fV)])])])):Ee("",!0)}},pV={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},mV=["aria-busy"],gV={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},_V={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},vV=["onClick"],yV={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},wV={class:"absolute top-4 right-4"},bV=["onClick","aria-expanded"],IV={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},EV=["onClick"],TV=["onClick"],AV=["onClick"],xV={key:2,class:"flex justify-center mt-12"},PV={key:3,class:"text-center py-16"},SV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},RV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},CV={class:"mb-6"},kV={class:"mb-6"},DV={class:"mb-6"},VV={class:"flex justify-end space-x-3"},NV=["disabled"],OV={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},MV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},LV={class:"text-center mb-6"},FV={class:"text-gray-300"},UV={__name:"Home",setup(n){const e=q([]),t=q(!0),r=$u(),s=q(null),i=q(!1),o=q(!1),a=q(""),l=q(""),u=q(""),d=q(null),f=q(!1),g=q(null),_=q("");Ao(async()=>{try{e.value=await fh(),console.log("Saisons chargées:",e.value),U().catch(ie=>console.error("Migration sortOrder échouée",ie))}finally{t.value=!1}});const C=Nt(()=>[...e.value].sort((ie,ee)=>{var Yt,nn;const ke=typeof ie.sortOrder=="number"?ie.sortOrder:Number.MAX_SAFE_INTEGER,Se=typeof ee.sortOrder=="number"?ee.sortOrder:Number.MAX_SAFE_INTEGER;if(ke!==Se)return ke-Se;const De=(Yt=ie.createdAt)!=null&&Yt.toMillis?ie.createdAt.toMillis():0,$e=(nn=ee.createdAt)!=null&&nn.toMillis?ee.createdAt.toMillis():0;return De!==$e?$e-De:(ie.name||"").localeCompare(ee.name||"")}));function P(ie){r.push(`/season/${ie}`)}function R(ie){s.value=s.value===ie?null:ie}function L(){s.value=null}async function U(){if(!e.value.length)return;const ie=e.value.map(ke=>typeof ke.sortOrder=="number"?ke.sortOrder:null).filter(ke=>ke!==null);let ee=ie.length?Math.max(...ie):0;for(const ke of e.value)if(typeof ke.sortOrder!="number"){ee+=1;try{await Sa(ke.id,ee),ke.sortOrder=ee}catch(Se){console.error("Erreur migration sortOrder pour",ke.name,Se)}}}async function $(ie){if(L(),ie<=0)return;const ee=[...C.value],ke=ee[ie],Se=ee[ie-1],De=ke.sortOrder;ke.sortOrder=Se.sortOrder,Se.sortOrder=De;try{await Promise.all([Sa(ke.id,ke.sortOrder),Sa(Se.id,Se.sortOrder)])}catch($e){console.error("Erreur lors du déplacement vers le haut",$e)}}async function j(ie){L();const ee=[...C.value];if(ie>=ee.length-1)return;const ke=ee[ie],Se=ee[ie+1],De=ke.sortOrder;ke.sortOrder=Se.sortOrder,Se.sortOrder=De;try{await Promise.all([Sa(ke.id,ke.sortOrder),Sa(Se.id,Se.sortOrder)])}catch($e){console.error("Erreur lors du déplacement vers le bas",$e)}}function M(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function ae(){u.value=u.value.replace(/[^0-9]/g,""),u.value.length>4&&(u.value=u.value.slice(0,4))}async function T(){if(!a.value.trim()||!l.value.trim()||!u.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(u.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await WD(a.value.trim(),l.value.trim(),u.value.trim()),e.value=await fh(),await U(),w()}catch(ie){console.error("Erreur lors de la création de la saison:",ie),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function w(){i.value=!1,a.value="",l.value="",u.value=""}function I(ie){d.value=ie,o.value=!0}async function S(){o.value=!1,await A({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function k(){o.value=!1,d.value=null}function D(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function A(ie){if(On.isPinCached(d.value.id)){const ee=On.getCachedPin(d.value.id);if(console.log("PIN en cache trouvé, utilisation automatique"),await Eu(d.value.id,ee)){await Le(ie);return}else On.clearSession()}g.value=ie,f.value=!0}async function Jt(ie){var ee,ke,Se;console.log("PIN soumis:",ie,"pour l'opération:",g.value);try{const De=((ke=(ee=g.value)==null?void 0:ee.data)==null?void 0:ke.seasonId)||((Se=d.value)==null?void 0:Se.id),$e=await Eu(De,ie);if(console.log("PIN valide:",$e),$e){On.saveSession(De,ie),console.log("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const Yt=g.value;g.value=null,console.log("Appel de executePendingOperation avec:",Yt),await Le(Yt)}else _.value="Code PIN incorrect",setTimeout(()=>{_.value=""},3e3)}catch(De){console.error("Erreur lors de la vérification du PIN:",De),_.value="Erreur lors de la vérification du code PIN"}}function Gt(){f.value=!1,g.value=null,_.value=""}function et(){return d.value&&On.isPinCached(d.value.id)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function Le(ie){if(console.log("executePendingOperation appelé avec:",ie),!ie){console.log("Aucune opération à exécuter");return}const{type:ee,data:ke}=ie;console.log("Exécution de l'opération:",ee,"avec données:",ke);try{switch(ee){case"deleteSeason":console.log("Suppression de la saison ID:",ke.seasonId),await QD(ke.seasonId),console.log("Saison supprimée, rechargement de la liste..."),e.value=await fh(),console.log("Nouvelle liste des saisons:",e.value);break;default:console.log("Type d'opération non reconnu:",ee)}}catch(Se){console.error("Erreur lors de l'exécution de l'opération:",Se),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(ie,ee)=>{var ke;return H(),W("div",pV,[ee[23]||(ee[23]=p("div",{class:"text-center py-16 px-4"},[p("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Sélections Spectacle "),p("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"}," Gérez facilement les sélections pour vos spectacles. ")],-1)),p("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(H(),W("div",gV,[(H(),W(Rt,null,Ir(8,Se=>p("div",{key:"skeleton-"+Se,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},ee[6]||(ee[6]=[p("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),p("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),p("div",{class:"h-px bg-white/10 mb-4"},null,-1),p("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(H(),W("div",_V,[(H(!0),W(Rt,null,Ir(C.value,(Se,De)=>(H(),W("div",{key:Se.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[p("div",{onClick:$e=>P(Se.slug),class:"text-center cursor-pointer"},[ee[7]||(ee[7]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[p("span",{class:"text-2xl"},"🎭")],-1)),p("h2",yV,ge(Se.name),1),ee[8]||(ee[8]=p("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),ee[9]||(ee[9]=p("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,vV),p("div",wV,[p("div",{class:"relative",onClick:ee[0]||(ee[0]=Nn(()=>{},["stop"]))},[p("button",{onClick:$e=>R(De),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===De,"aria-haspopup":"true",title:"Options"},ee[10]||(ee[10]=[p("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,bV),s.value===De?(H(),W("div",IV,[p("button",{onClick:$e=>$(De),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,EV),p("button",{onClick:$e=>j(De),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,TV),ee[11]||(ee[11]=p("div",{class:"border-t border-white/10 my-1"},null,-1)),p("button",{onClick:$e=>I(Se),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,AV)])):Ee("",!0)])])]))),128))])):Ee("",!0),!t.value&&e.value.length>0?(H(),W("div",xV,[p("button",{onClick:ee[1]||(ee[1]=Se=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):Ee("",!0),!t.value&&e.value.length===0?(H(),W("div",PV,[ee[12]||(ee[12]=p("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[p("span",{class:"text-4xl"},"🎪")],-1)),ee[13]||(ee[13]=p("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),ee[14]||(ee[14]=p("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),p("button",{onClick:ee[2]||(ee[2]=Se=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):Ee("",!0)],8,mV),i.value?(H(),W("div",SV,[p("div",RV,[ee[19]||(ee[19]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),p("div",CV,[ee[15]||(ee[15]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),lt(p("input",{"onUpdate:modelValue":ee[3]||(ee[3]=Se=>a.value=Se),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:M},null,544),[[St,a.value]])]),p("div",kV,[ee[16]||(ee[16]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),lt(p("input",{"onUpdate:modelValue":ee[4]||(ee[4]=Se=>l.value=Se),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[St,l.value]])]),p("div",DV,[ee[17]||(ee[17]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),lt(p("input",{"onUpdate:modelValue":ee[5]||(ee[5]=Se=>u.value=Se),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:ae},null,544),[[St,u.value]]),ee[18]||(ee[18]=p("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),p("div",VV,[p("button",{onClick:w,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:T,disabled:!a.value.trim()||!l.value.trim()||!u.value.trim()||u.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,NV)])])])):Ee("",!0),o.value?(H(),W("div",OV,[p("div",MV,[p("div",LV,[ee[20]||(ee[20]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"⚠️")],-1)),ee[21]||(ee[21]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),p("p",FV,'Êtes-vous sûr de vouloir supprimer la saison "'+ge((ke=d.value)==null?void 0:ke.name)+'" ?',1)]),ee[22]||(ee[22]=p("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:k,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:S,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):Ee("",!0),$t(Yb,{show:f.value,message:D(),error:_.value,"session-info":et(),onSubmit:Jt,onCancel:Gt},null,8,["show","message","error","session-info"])])}}};let An="mock",ki=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Di=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function BV(n){An=n}async function $V(){if(An!=="firebase"||!(await xt(nt(we,"seasons"))).empty)return;const e=Be(nt(we,"seasons"));await Cn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Rp()});const t=await xt(nt(we,"players"));for(const o of t.docs)await Cn(Be(e,"players",o.id),o.data());const r=await xt(nt(we,"events"));for(const o of r.docs)await Cn(Be(e,"events",o.id),o.data());const s=await xt(nt(we,"availability"));for(const o of s.docs)await Cn(Be(e,"availability",o.id),o.data());const i=await xt(nt(we,"selections"));for(const o of i.docs)await Cn(Be(e,"selections",o.id),o.data())}async function jV(){An==="firebase"&&await $V()}async function J_(n=null){return(An==="firebase"?n?(await xt(nt(we,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await xt(nt(we,"events"))).docs.map(t=>({id:t.id,...t.data()})):Di).sort((t,r)=>{const s=u=>{if(!u)return null;if(u instanceof Date)return u;if(typeof(u==null?void 0:u.toDate)=="function")return u.toDate();const d=new Date(u);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function gh(n=null){return(An==="firebase"?n?(await xt(nt(we,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await xt(nt(we,"players"))).docs.map(t=>({id:t.id,...t.data()})):ki).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function qV(n,e=null){if(An==="firebase"){const t=Be(e?nt(we,"seasons",e,"players"):nt(we,"players"));return await Cn(t,{name:n}),t.id}else{const t=`p${ki.length+1}`;return ki.push({id:t,name:n}),t}}async function zV(n,e=null){if(An==="firebase"){const t=e?Be(we,"seasons",e,"players",n):Be(we,"players",n);await wl(t);const r=e?await xt(nt(we,"seasons",e,"availability")):await xt(nt(we,"availability")),s=rb(we);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else ki=ki.filter(t=>t.id!==n)}async function GV(n,e,t=null){if(An==="firebase"){const r=t?Be(we,"seasons",t,"players",n):Be(we,"players",n);await Cn(r,{name:e})}else{const r=ki.findIndex(s=>s.id===n);r!==-1&&(ki[r]=e)}}async function Ra(n,e,t=null){if(An==="firebase"){const r=t?await xt(nt(we,"seasons",t,"availability")):await xt(nt(we,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Ca(n=null){if(An==="firebase"){const e=n?await xt(nt(we,"seasons",n,"selections")):await xt(nt(we,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function Y_(n,e,t=null){if(An==="firebase"){const r=t?Be(we,"seasons",t,"availability",n):Be(we,"availability",n);await Cn(r,e)}}async function KV({seasonId:n,playerName:e,eventId:t,value:r}){if(An!=="firebase")return;const s=n?Be(we,"seasons",n,"availability",e):Be(we,"availability",e),i=await Li(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Cn(s,a)}async function HV(n,e,t=null){if(An==="firebase"){const r=t?Be(we,"seasons",t,"selections",n):Be(we,"selections",n);await Cn(r,{players:e})}}async function WV(n,e=null){if(console.log("Suppression de l'événement:",n),An==="firebase")try{console.log("Suppression de l'événement dans Firestore");const t=e?Be(we,"seasons",e,"events",n):Be(we,"events",n);await wl(t),console.log("Suppression de la sélection associée");const r=e?Be(we,"seasons",e,"selections",n):Be(we,"selections",n);await wl(r),console.log("Suppression des disponibilités");const s=e?await xt(nt(we,"seasons",e,"availability")):await xt(nt(we,"availability")),i=rb(we);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){console.log("Mise à jour de la disponibilité pour:",o.id);const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),console.log("Opérations de suppression terminées avec succès")}catch(t){throw console.error("Erreur lors de la suppression:",t),t}else Di=Di.filter(t=>t.id!==n)}async function QV(n,e=null){if(An==="firebase"){const t=Be(e?nt(we,"seasons",e,"events"):nt(we,"events"));return await Cn(t,n),t.id}else{const t=`event${Di.length+1}`;return Di.push({id:t,...n}),t}}async function X_(n,e,t=null){if(An==="firebase"){const r=t?Be(we,"seasons",t,"events",n):Be(we,"events",n);await Cn(r,e,{merge:!0})}else{const r=Di.findIndex(s=>s.id===n);r!==-1&&(Di[r]={id:n,...e})}}class JV{constructor(){this.sessions=new Map,this.sessionDuration=10*60*1e3}isPasswordCached(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),!1):!0:!1}getCachedPassword(e){const t=this.sessions.get(e);return t?Date.now()-t.timestamp>this.sessionDuration?(this.sessions.delete(e),null):t.password:null}saveSession(e,t){this.sessions.set(e,{password:t,timestamp:Date.now()})}clearSession(e){this.sessions.delete(e)}clearExpiredSessions(){const e=Date.now();for(const[t,r]of this.sessions.entries())e-r.timestamp>this.sessionDuration&&this.sessions.delete(t)}clearAllSessions(){this.sessions.clear()}}const Pl=new JV,YV="modulepreload",XV=function(n){return"/impro-selector/"+n},Z_={},Jn=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=XV(i),i in Z_)return;Z_[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":YV,o||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),o)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function Xb(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}async function ZV(n,e,t,r=null){try{console.log("🔍 [DEBUG] Début protectPlayer:",{playerId:n,email:e,seasonId:r});const s=await Zl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Jn(()=>import("./index.esm-ea5ce076.js"),[]),{db:u}=await Jn(()=>Promise.resolve().then(()=>To),void 0),d=r?i(u,"seasons",r,"playerProtection"):i(u,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find($=>$.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");console.log("🔍 [DEBUG] Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:_}=await Jn(()=>import("./index.esm-dc9b1dcf.js"),[]),{auth:C}=await Jn(()=>Promise.resolve().then(()=>To),void 0),P=await _(C,e,t);console.log("🔍 [DEBUG] Compte Firebase Auth créé:",P.user.uid);const R=Xb(t),L=r?Be(u,"seasons",r,"playerProtection",n):Be(u,"playerProtection",n);return await Cn(L,{playerId:n,email:e,passwordHash:R,firebaseUid:P.user.uid,isProtected:!0,createdAt:new Date}),console.log("🔍 [DEBUG] Protection sauvegardée dans Firestore"),{success:!0}}catch(s){throw console.error("❌ [ERROR] Erreur lors de la protection du joueur:",s),s}}async function eN(n,e=null){try{const t=e?Be(we,"seasons",e,"playerProtection",n):Be(we,"playerProtection",n),r=await Zl(n,e),s=(r==null?void 0:r.email)||"";return await Cn(t,{playerId:n,email:s,isProtected:!1,updatedAt:new Date}),{success:!0,email:s}}catch(t){throw console.error("Erreur lors de la suppression de la protection:",t),t}}async function gi(n,e=null){try{const t=e?Be(we,"seasons",e,"playerProtection",n):Be(we,"playerProtection",n),r=await Li(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return console.error("Erreur lors de la vérification de protection:",t),!1}}async function Zl(n,e=null){try{const t=e?Be(we,"seasons",e,"playerProtection",n):Be(we,"playerProtection",n),r=await Li(t);return r.exists()?r.data():null}catch(t){return console.error("Erreur lors de la récupération des données de protection:",t),null}}async function Zb(n,e=null){try{const t=await Zl(n,e);return(t==null?void 0:t.email)||""}catch(t){return console.error("Erreur lors de la récupération de l'email:",t),""}}async function ev(n=null){try{const e=n?nt(we,"seasons",n,"playerProtection"):nt(we,"playerProtection");return(await xt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return console.error("Erreur lors du chargement des protections:",e),[]}}async function Tu(n,e,t=null){try{const r=await Zl(n,t);if(!r||!r.isProtected)return!1;if(r.firebaseUid){console.log("🔍 [DEBUG] Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Jn(()=>import("./index.esm-dc9b1dcf.js"),[]),{auth:i}=await Jn(()=>Promise.resolve().then(()=>To),void 0);return await s(i,r.email,e),console.log("🔍 [DEBUG] Mot de passe Firebase Auth valide"),Pl.saveSession(n,e),!0}catch(s){return console.log("🔍 [DEBUG] Mot de passe Firebase Auth invalide:",s.code),!1}}else{console.log("🔍 [DEBUG] Vérification avec hash local");const s=Xb(e),i=r.passwordHash===s;return i&&Pl.saveSession(n,e),i}}catch(r){return console.error("Erreur lors de la vérification du mot de passe:",r),!1}}function el(n){return Pl.isPasswordCached(n)}async function lf(n,e=null){try{console.log("🔍 [DEBUG] Début sendPasswordResetEmail:",{playerId:n,seasonId:e});const t=await Zl(n,e);if(console.log("🔍 [DEBUG] Protection data:",t),!t||!t.isProtected)throw new Error("Joueur non protégé");if(console.log("🔍 [DEBUG] Email à utiliser:",t.email),t.firebaseUid){console.log("🔍 [DEBUG] Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Jn(()=>import("./index.esm-dc9b1dcf.js"),[]),{auth:s}=await Jn(()=>Promise.resolve().then(()=>To),void 0);console.log("🔍 [DEBUG] Tentative d'envoi d'email à:",t.email),await r(s,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès via Firebase Auth!"),console.log("🔍 [DEBUG] Vérifiez votre boîte mail:",t.email)}else{console.log("🔍 [DEBUG] Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Jn(()=>import("./index.esm-dc9b1dcf.js"),[]),{auth:i}=await Jn(()=>Promise.resolve().then(()=>To),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);console.log("🔍 [DEBUG] Compte temporaire créé:",a.user.uid),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");const{updateDoc:l}=await Jn(()=>import("./index.esm-ea5ce076.js"),[]),{db:u}=await Jn(()=>Promise.resolve().then(()=>To),void 0),d=e?Be(u,"seasons",e,"playerProtection",n):Be(u,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")console.log("🔍 [DEBUG] Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),console.log("🔍 [DEBUG] Email envoyé avec succès!");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw console.error("❌ [ERROR] Erreur lors de l'envoi de l'email de réinitialisation:",t),console.error("❌ [ERROR] Code d'erreur:",t.code),console.error("❌ [ERROR] Message d'erreur:",t.message),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}const Yp="magicLinks";function Xp({seasonId:n,playerId:e,eventId:t}){return`${n}__${e}__${t}`}function tN(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function tv({seasonId:n,playerId:e,eventId:t,action:r}){const s=Xp({seasonId:n,playerId:e,eventId:t}),i=tN(40),o=Be(we,Yp,s),a=Date.now()+1e3*60*60*24*7;await Cn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const u=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:u}}async function nN({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Xp({seasonId:n,playerId:e,eventId:t}),o=Be(we,Yp,i),a=await Li(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function rN({seasonId:n,playerId:e,eventId:t}){const r=Xp({seasonId:n,playerId:e,eventId:t}),s=Be(we,Yp,r);await wl(s)}async function sN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,u=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:u,html:l},createdAt:Rp(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await nb(nt(we,"mail"),d),{success:!0}}const iN={class:"text-center mb-6"},oN={class:"text-lg text-gray-300"},aN={class:"mb-6"},lN={class:"flex items-center space-x-3"},cN={class:"text-2xl"},uN={class:"font-semibold text-white"},dN={class:"text-sm text-gray-300"},hN={class:"mb-6"},fN={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-1"},pN={key:0,class:"mb-6"},mN={class:"space-y-4"},gN=["disabled"],_N={key:0,class:"animate-spin"},vN={key:1},yN={key:1,class:"mb-6"},wN={key:0,class:"space-y-4 mb-4"},bN=["disabled"],IN={key:0,class:"animate-spin"},EN={key:1},TN=["disabled"],AN={key:2,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},xN={class:"text-red-300 text-sm"},PN={key:3,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},SN={class:"text-green-300 text-sm"},RN={__name:"PlayerProtectionModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","update"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q(""),o=q(""),a=q(""),l=q(!1),u=q(""),d=q(""),f=q(!1),g=q(!1),_=q(""),C=Nt(()=>i.value&&o.value&&a.value&&o.value===a.value&&o.value.length>=6&&i.value.includes("@"));async function P(){var j;if((j=t.player)!=null&&j.id&&(s.value=await gi(t.player.id,t.seasonId),!s.value)){const M=await Zb(t.player.id,t.seasonId);M&&(i.value=M)}}async function R(){if(C.value){l.value=!0,u.value="",d.value="";try{await ZV(t.player.id,i.value,o.value,t.seasonId),d.value="Protection activée avec succès !",s.value=!0,i.value="",o.value="",a.value="",r("update")}catch(j){console.error("Erreur lors de l'activation de la protection:",j),j.message&&j.message.includes("email")?u.value="Cette adresse email est déjà utilisée par un autre joueur.":u.value="Erreur lors de l'activation de la protection. Veuillez réessayer."}finally{l.value=!1}}}function L(){g.value=!0,_.value="",u.value=""}async function U(){if(_.value){l.value=!0,u.value="",d.value="";try{if(!await Tu(t.player.id,_.value,t.seasonId)){u.value="Mot de passe incorrect. Veuillez réessayer.";return}const M=await eN(t.player.id,t.seasonId);d.value="Protection désactivée avec succès !",s.value=!1,g.value=!1,_.value="",M.email&&(i.value=M.email),r("update")}catch(j){console.error("Erreur lors de la désactivation de la protection:",j),u.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{l.value=!1}}}function $(){r("close")}return ur(()=>t.player,()=>{t.show&&t.player&&P()},{immediate:!0}),ur(()=>t.show,j=>{j&&t.player&&(o.value="",a.value="",u.value="",d.value="",f.value=!1,g.value=!1,_.value="",P())}),(j,M)=>{var ae;return n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:$},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:M[6]||(M[6]=Nn(()=>{},["stop"]))},[p("div",iN,[M[7]||(M[7]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔒")],-1)),M[8]||(M[8]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Protection du joueur",-1)),p("p",oN,ge((ae=n.player)==null?void 0:ae.name),1)]),p("div",aN,[p("div",{class:ar(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[p("div",lN,[p("span",cN,ge(s.value?"🔒":"🔓"),1),p("div",null,[p("div",uN,ge(s.value?"Protégé":"Non protégé"),1),p("div",dN,ge(s.value?"Modifications sécurisées":"Modifications libres"),1)])])],2)]),p("div",hN,[p("button",{onClick:M[0]||(M[0]=T=>f.value=!f.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[M[9]||(M[9]=p("h3",{class:"text-sm font-semibold text-blue-300"},"💡 Pourquoi protéger son joueur ?",-1)),p("span",{class:ar(["text-blue-300 transition-transform duration-200",{"rotate-180":f.value}])},"▼",2)]),f.value?(H(),W("div",fN,M[10]||(M[10]=[p("div",null,[qn("• "),p("span",{class:"text-blue-300"},"Protection des disponibilités :"),qn(" Seul vous pouvez modifier vos disponibilités")],-1),p("div",null,[qn("• "),p("span",{class:"text-blue-300"},"Protection du nom :"),qn(" Seul vous pouvez changer votre nom de joueur")],-1),p("div",null,[qn("• "),p("span",{class:"text-blue-300"},"Email requis :"),qn(" Permet de réinitialiser le mot de passe en cas d'oubli")],-1)]))):Ee("",!0)]),s.value?Ee("",!0):(H(),W("div",pN,[M[14]||(M[14]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔐 Activer la protection",-1)),p("div",mN,[p("div",null,[M[11]||(M[11]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),lt(p("input",{"onUpdate:modelValue":M[1]||(M[1]=T=>i.value=T),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[St,i.value]])]),p("div",null,[M[12]||(M[12]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":M[2]||(M[2]=T=>o.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé"},null,512),[[St,o.value]])]),p("div",null,[M[13]||(M[13]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":M[3]||(M[3]=T=>a.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[St,a.value]])])]),p("button",{onClick:R,disabled:!C.value||l.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l.value?(H(),W("span",_N,"⏳")):(H(),W("span",vN,"🔒")),p("span",null,ge(l.value?"Activation...":"Activer la protection"),1)],8,gN)])),s.value?(H(),W("div",yN,[M[17]||(M[17]=p("h3",{class:"text-lg font-semibold text-white mb-4"},"🔓 Désactiver la protection",-1)),M[18]||(M[18]=p("p",{class:"text-sm text-gray-300 mb-4"}," Attention : désactiver la protection supprimera définitivement le mot de passe et l'email associés. ",-1)),g.value?(H(),W("div",wN,[p("div",null,[M[15]||(M[15]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de confirmation",-1)),lt(p("input",{"onUpdate:modelValue":M[4]||(M[4]=T=>_.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe pour confirmer"},null,512),[[St,_.value]])]),p("button",{onClick:U,disabled:!_.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[l.value?(H(),W("span",IN,"⏳")):(H(),W("span",EN,"🔓")),p("span",null,ge(l.value?"Désactivation...":"Confirmer la désactivation"),1)],8,bN),p("button",{onClick:M[5]||(M[5]=T=>g.value=!1),class:"w-full px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])):Ee("",!0),g.value?Ee("",!0):(H(),W("button",{key:1,onClick:L,disabled:l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},M[16]||(M[16]=[p("span",null,"🔓",-1),p("span",null,"Désactiver la protection",-1)]),8,TN))])):Ee("",!0),u.value?(H(),W("div",AN,[p("div",xN,ge(u.value),1)])):Ee("",!0),d.value?(H(),W("div",PN,[p("div",SN,ge(d.value),1)])):Ee("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:$,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0)}}},CN={class:"text-center mb-6"},kN={class:"text-lg text-gray-300"},DN={class:"mb-6"},VN={class:"space-y-4"},NN=["disabled"],ON={key:0,class:"animate-spin"},MN={key:1},LN={class:"mb-6 text-center"},FN={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},UN={class:"text-red-300 text-sm"},BN={class:"text-center mb-6"},$N={class:"text-lg text-gray-300"},jN={class:"mb-6"},qN=["disabled"],zN={key:0,class:"animate-spin"},GN={key:1},KN={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},HN={class:"text-red-300 text-sm"},WN={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},QN={class:"text-green-300 text-sm"},JN={class:"flex justify-center"},YN={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=q(""),i=q(!1),o=q(""),a=q(!1),l=q(""),u=q(""),d=q(null);async function f(){if(s.value){i.value=!0,o.value="";try{const C=await af(t.seasonId);if(s.value===C){r("verified",{type:"season_pin"}),_();return}await Tu(t.player.id,s.value,t.seasonId)?(r("verified",{type:"player_password"}),_()):o.value="Mot de passe incorrect. Veuillez réessayer."}catch(C){console.error("Erreur lors de la vérification:",C),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function g(){i.value=!0,l.value="",u.value="";try{const C=await lf(t.player.id,t.seasonId);u.value=C.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(C){console.error("Erreur lors de l'envoi de l'email:",C),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function _(){r("close"),s.value="",o.value="",a.value=!1,l.value="",u.value=""}return ur(()=>t.show,C=>{C&&Er(()=>{d.value&&d.value.focus()})}),(C,P)=>{var R,L;return H(),W(Rt,null,[n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:_},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[2]||(P[2]=Nn(()=>{},["stop"]))},[p("div",CN,[P[6]||(P[6]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"🔐")],-1)),P[7]||(P[7]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),p("p",kN,ge((R=n.player)==null?void 0:R.name),1),P[8]||(P[8]=p("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),p("div",DN,[p("div",VN,[p("div",null,[P[9]||(P[9]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(p("input",{"onUpdate:modelValue":P[0]||(P[0]=U=>s.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Sn(f,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[St,s.value]])])]),p("button",{onClick:f,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(H(),W("span",ON,"⏳")):(H(),W("span",MN,"🔓")),p("span",null,ge(i.value?"Vérification...":"Vérifier"),1)],8,NN)]),p("div",LN,[p("button",{onClick:P[1]||(P[1]=U=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(H(),W("div",FN,[p("div",UN,ge(o.value),1)])):Ee("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:_,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):Ee("",!0),a.value?(H(),W("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:P[5]||(P[5]=U=>a.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[4]||(P[4]=Nn(()=>{},["stop"]))},[p("div",BN,[P[10]||(P[10]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"📧")],-1)),P[11]||(P[11]=p("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),p("p",$N,ge((L=n.player)==null?void 0:L.name),1)]),p("div",jN,[P[12]||(P[12]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:g,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(H(),W("span",zN,"⏳")):(H(),W("span",GN,"📧")),p("span",null,ge(i.value?"Envoi...":"Envoyer l'email"),1)],8,qN)]),l.value?(H(),W("div",KN,[p("div",HN,ge(l.value),1)])):Ee("",!0),u.value?(H(),W("div",WN,[p("div",QN,ge(u.value),1)])):Ee("",!0),p("div",JN,[p("button",{onClick:P[3]||(P[3]=U=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0)],64)}}},XN={class:"relative text-center p-6 pb-4 border-b border-white/10"},ZN={class:"text-2xl md:text-3xl font-bold text-white mb-1"},eO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},tO={class:"grid grid-cols-3 gap-3 md:gap-4"},nO={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},rO={class:"text-xl md:text-2xl font-bold text-white"},sO={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},iO={class:"text-xl md:text-2xl font-bold text-white"},oO={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},aO={class:"text-xl md:text-2xl font-bold text-white"},lO={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},cO={key:0,class:"md:hidden mt-3 space-y-2"},uO={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},dO={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},hO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},fO={class:"mb-6"},pO={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null}},emits:["close","update","delete","refresh"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q(""),o=q(null),a=q(!1),l=q(!1),u=q(null),d=q(!1);function f(){r("close")}function g(){var j;i.value=((j=t.player)==null?void 0:j.name)||"",s.value=!0,Er(()=>{o.value&&o.value.focus()})}function _(){s.value=!1,i.value=""}async function C(){var M,ae;if(!i.value.trim())return;if(await gi((M=t.player)==null?void 0:M.id,t.seasonId)){el((ae=t.player)==null?void 0:ae.id)?P():(u.value="update",l.value=!0);return}P()}function P(){var j;r("update",{playerId:(j=t.player)==null?void 0:j.id,newName:i.value.trim()}),s.value=!1,i.value=""}async function R(){var M,ae;if(await gi((M=t.player)==null?void 0:M.id,t.seasonId)){el((ae=t.player)==null?void 0:ae.id)?L():(u.value="delete",l.value=!0);return}L()}function L(){var j;r("delete",(j=t.player)==null?void 0:j.id)}function U(){r("refresh")}function $(j){u.value==="update"?P():u.value==="delete"&&L(),u.value=null}return ur(()=>t.show,j=>{j||(s.value=!1,i.value="",u.value=null)}),(j,M)=>{var ae;return H(),W(Rt,null,[n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:f},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:M[5]||(M[5]=Nn(()=>{},["stop"]))},[p("div",XN,[p("button",{onClick:f,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),M[9]||(M[9]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),p("h2",ZN,ge((ae=n.player)==null?void 0:ae.name),1)]),p("div",eO,[p("div",null,[p("div",tO,[p("div",nO,[p("div",rO,ge(t.stats.availability),1),M[10]||(M[10]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",sO,[p("div",iO,ge(t.stats.selection),1),M[11]||(M[11]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",oO,[p("div",aO,ge(t.stats.ratio)+"%",1),M[12]||(M[12]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),p("div",lO,[p("button",{onClick:g,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},M[13]||(M[13]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:M[0]||(M[0]=T=>a.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},M[14]||(M[14]=[p("span",null,"🔒",-1),p("span",null,"Protection",-1)])),p("button",{onClick:R,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},M[15]||(M[15]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:f,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),d.value?(H(),W("div",cO,[p("button",{onClick:M[1]||(M[1]=T=>{g(),d.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Modifier "),p("button",{onClick:M[2]||(M[2]=T=>{R(),d.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):Ee("",!0)]),p("div",uO,[p("button",{onClick:M[3]||(M[3]=T=>a.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"}," 🔒 Protection "),p("button",{onClick:f,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),p("button",{onClick:M[4]||(M[4]=T=>d.value=!d.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):Ee("",!0),s.value?(H(),W("div",dO,[p("div",hO,[M[17]||(M[17]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier le joueur",-1)),p("div",fO,[M[16]||(M[16]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),lt(p("input",{"onUpdate:modelValue":M[6]||(M[6]=T=>i.value=T),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Sn(_,["esc"]),Sn(C,["enter"])],ref_key:"editNameInput",ref:o},null,544),[[St,i.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:_,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:C,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):Ee("",!0),$t(RN,{show:a.value,player:n.player,seasonId:n.seasonId,onClose:M[7]||(M[7]=T=>a.value=!1),onUpdate:U},null,8,["show","player","seasonId"]),$t(YN,{show:l.value,player:n.player,seasonId:n.seasonId,onClose:M[8]||(M[8]=T=>l.value=!1),onVerified:$},null,8,["show","player","seasonId"])],64)}}},mO={class:"relative p-5 pb-4 border-b border-white/10"},gO={key:0,class:"text-sm text-purple-300 mt-1"},_O={class:"px-4 md:px-6 py-4 md:py-6 space-y-4 overflow-y-auto"},vO={class:"relative"},yO=["value"],wO=["title"],bO={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},IO={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},EO={class:"text-sm text-gray-300"},TO={key:0,class:"mb-1"},AO={key:1},xO={__name:"AnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},message:{type:String,default:""},isPartial:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=q(!1),i=q("Copier le message");function o(){r("close")}function a(u){var f;return u?(typeof u=="string"?new Date(u):((f=u.toDate)==null?void 0:f.call(u))||u).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function l(){const u=t.message||"";navigator.clipboard.writeText(u).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(d=>{console.error("Erreur lors de la copie du texte:",d),alert("Impossible de copier le message.")})}return(u,d)=>n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:o},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:d[0]||(d[0]=Nn(()=>{},["stop"]))},[p("div",mO,[p("button",{onClick:o,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d[1]||(d[1]=p("h2",{class:"text-xl md:text-2xl font-bold text-white pr-10"},"Annoncer la sélection",-1)),n.event?(H(),W("p",gO,ge(n.event.title)+" — "+ge(a(n.event.date)),1)):Ee("",!0)]),p("div",_O,[d[4]||(d[4]=p("div",{class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},[p("p",{class:"text-blue-200 text-sm"},"Le message ci-dessous est prêt à être copié/collé dans WhatsApp, Messenger, email, etc.")],-1)),p("div",vO,[p("textarea",{value:n.message,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,yO),p("button",{onClick:l,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(H(),W("svg",IO,d[3]||(d[3]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(H(),W("svg",bO,d[2]||(d[2]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,wO)]),p("div",EO,[n.isPartial?(H(),W("p",TO,"Note: cette annonce concerne une mise à jour partielle de la sélection.")):(H(),W("p",AO,"Vérifie le message si besoin avant de l'envoyer."))])]),p("div",{class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},[p("button",{onClick:l,class:"h-12 px-4 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier "),p("button",{onClick:o,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):Ee("",!0)}},PO={class:"relative text-center p-6 pb-4 border-b border-white/10"},SO={class:"text-2xl md:text-3xl font-bold text-white mb-1"},RO={class:"text-sm md:text-base text-purple-300"},CO={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},kO={key:0,class:"mb-3"},DO={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},VO={class:"text-white font-medium"},NO={key:0,class:"text-purple-400 mr-2"},OO={key:1,class:"text-green-400 mr-2"},MO={key:2,class:"text-red-400 mr-2"},LO={key:3,class:"text-gray-400 mr-2"},FO={key:1,class:"mb-3"},UO={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},BO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},$O={class:"text-cyan-300 text-lg md:text-xl font-semibold"},jO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},qO={class:"text-green-400 text-lg md:text-xl font-semibold"},zO={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},GO={class:"text-purple-400 text-lg md:text-xl font-semibold"},KO={key:2,class:"mb-3"},HO={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},WO={class:"flex-1"},QO={class:"text-blue-300 text-sm font-medium"},JO={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},YO=["disabled","title"],XO=["disabled"],ZO={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})}},emits:["close","selection","perfect"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=q(!1),o=q("Copier le message"),a=q(!1),l=q(!1),u=q(""),d=q(!1),f=Nt(()=>r.currentSelection&&r.currentSelection.length>0),g=Nt(()=>{var k;if(!f.value)return!1;const w=r.currentSelection.some(D=>!$(D)),I=((k=r.event)==null?void 0:k.playerCount)||6,S=r.availableCount<I;return w||S});Nt(()=>{var S;if(!g.value)return"";const w=r.currentSelection.filter(k=>!$(k)),I=((S=r.event)==null?void 0:S.playerCount)||6;return w.length>0?w.length===1?`${w[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${w.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<I?`Seulement ${r.availableCount} joueurs disponibles pour ${I} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"});const _=Nt(()=>{if(!r.event||!f.value)return"";const w=C(r.event.date),I=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${w} : ${I}`});ur(()=>r.show,w=>{w&&(i.value=!1,o.value="Copier le message",l.value=!1,u.value="",d.value=!1,a.value=!1)});function C(w){var S;return w?(typeof w=="string"?new Date(w):((S=w.toDate)==null?void 0:S.call(w))||w).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function P(){s("selection")}function R(){s("perfect")}function L(){s("close")}function U(){a.value=!0}function $(w){return r.playerAvailability[w]===!0}function j(w){return r.playerAvailability[w]===!1}function M(w){return r.currentSelection.includes(w)&&$(w)}function ae(w=!1,I=!1){if(d.value=w,w){const S=C(r.event.date),k=r.currentSelection.join(", ");I?u.value=`Sélection mise à jour pour ${r.event.title} du ${S} : ${k}`:u.value=`Nouvelle sélection pour ${r.event.title} du ${S} : ${k}`}else u.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function T(){l.value=!1}return e({showSuccess:ae}),(w,I)=>{var S,k,D;return H(),W(Rt,null,[n.show?(H(),W("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:L},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[0]||(I[0]=Nn(()=>{},["stop"]))},[p("div",PO,[p("button",{onClick:L,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),I[2]||(I[2]=p("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-3xl"},"🎭")],-1)),p("h2",SO,"Sélection pour "+ge((S=n.event)==null?void 0:S.title),1),p("p",RO,ge(C((k=n.event)==null?void 0:k.date)),1)]),p("div",CO,[f.value?(H(),W("div",kO,[I[3]||(I[3]=p("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),p("div",DO,[(H(!0),W(Rt,null,Ir(n.currentSelection,A=>(H(),W("div",{key:A,class:ar(["bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 rounded-lg border border-green-500/30 text-center",{"from-red-500/20 to-red-600/20 border-red-500/30":!$(A),"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":j(A)}])},[p("span",VO,[M(A)?(H(),W("span",NO,"🎭")):$(A)?(H(),W("span",OO,"✅")):j(A)?(H(),W("span",MO,"❌")):(H(),W("span",LO,"–")),qn(" "+ge(A),1)])],2))),128))])])):Ee("",!0),g.value?(H(),W("div",FO,I[4]||(I[4]=[p("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[p("div",{class:"text-yellow-400"},"⚠️"),p("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):Ee("",!0),p("div",UO,[p("div",BO,[p("div",$O,ge(((D=n.event)==null?void 0:D.playerCount)||6),1),I[5]||(I[5]=p("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),p("div",jO,[p("div",qO,ge(n.availableCount),1),I[6]||(I[6]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),p("div",zO,[p("div",GO,ge(n.selectedCount),1),I[7]||(I[7]=p("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(H(),W("div",KO,[p("div",HO,[I[9]||(I[9]=p("div",{class:"text-blue-400 text-xl"},"✨",-1)),p("div",WO,[p("p",QO,ge(u.value),1)]),p("button",{onClick:T,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},I[8]||(I[8]=[p("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):Ee("",!0)]),p("div",JO,[p("button",{onClick:P,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":f.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},I[10]||(I[10]=[qn(" ✨ "),p("span",{class:"hidden sm:inline"},"Sélection Auto",-1),p("span",{class:"sm:hidden"},"Auto",-1)]),8,YO),f.value?(H(),W("button",{key:0,onClick:R,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},I[11]||(I[11]=[qn(" 👍 "),p("span",{class:"hidden sm:inline"},"Parfait",-1)]))):Ee("",!0),p("button",{onClick:U,disabled:!f.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},I[12]||(I[12]=[qn(" 📣 "),p("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,XO)])])])):Ee("",!0),$t(xO,{show:a.value,event:n.event,message:_.value,"is-partial":d.value,onClose:I[1]||(I[1]=A=>a.value=!1)},null,8,["show","event","message","is-partial"])],64)}}};const e2={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},t2={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},n2=["title"],r2={class:"text-2xl"},s2={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},i2={class:"flex items-stretch relative"},o2={class:"flex-1 overflow-hidden"},a2=["onClick"],l2=["title"],c2=["title"],u2={key:0,class:"mt-1 text-xs text-gray-400"},d2=["title","onClick"],h2=["title","onClick"],f2={class:"table-auto border-separate border-spacing-0 table-fixed w-full min-w-max"},p2=["data-player-id"],m2={class:"p-4 md:p-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900"},g2={class:"font-bold text-xl md:text-2xl whitespace-pre-wrap flex items-center"},_2={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},v2=["onClick","title"],y2=["onClick"],w2={class:"flex items-center justify-center"},b2=["title"],I2=["title"],E2=["title"],T2=["title"],A2={class:"border-t border-white/10"},x2={class:"p-4 md:p-5 sticky left-0 z-40 bg-gray-900"},P2={class:"flex items-center"},S2={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},R2={key:1,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-50"},C2={class:"flex items-center space-x-2"},k2={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},D2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},V2={class:"mb-6"},N2={class:"mb-6"},O2={class:"mb-6"},M2={class:"mb-6 flex items-center gap-3"},L2={class:"mb-6"},F2={key:3,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},U2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},B2={class:"mb-6"},$2={class:"flex justify-end space-x-3"},j2={key:4,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},q2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},z2={class:"flex justify-end space-x-3"},G2={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},K2={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},H2={class:"flex justify-end space-x-3"},W2={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},Q2={class:"relative text-center p-6 pb-4 border-b border-white/10"},J2={class:"text-2xl md:text-3xl font-bold text-white mb-1"},Y2={class:"text-sm md:text-base text-purple-300"},X2={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},Z2={key:0,class:"mb-4 md:mb-6"},eM={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},tM={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},nM={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},rM={class:"text-xl md:text-2xl font-bold text-white"},sM={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},iM={class:"text-xl md:text-2xl font-bold text-white"},oM={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},aM={class:"text-xl md:text-2xl font-bold text-white"},lM={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},cM=["title"],uM={key:1,class:"md:hidden mt-3 space-y-2"},dM={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},hM={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},fM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},pM={class:"mb-6"},mM={class:"mb-6"},gM={class:"mb-6"},_M={class:"mb-6 flex items-center gap-3"},vM={class:"mb-6"},yM={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},wM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},bM={class:"mb-6"},IM={class:"space-y-4"},EM=["disabled"],TM={key:0,class:"animate-spin"},AM={key:1},xM={class:"mb-6 text-center"},PM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},SM={class:"text-red-300 text-sm"},RM={key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},CM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},kM={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},DM={class:"space-y-4"},VM={class:"mt-2 text-center"},NM={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},OM={class:"text-red-300 text-sm"},MM={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},LM=["disabled"],FM={key:0,class:"animate-spin"},UM={key:1},BM={class:"mb-6"},$M=["disabled"],jM={key:0,class:"animate-spin"},qM={key:1},zM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},GM={class:"text-red-300 text-sm"},KM={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},HM={class:"text-green-300 text-sm"},WM={class:"flex justify-center"},QM={class:"mb-6"},JM=["disabled"],YM={key:0,class:"animate-spin"},XM={key:1},ZM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},eL={class:"text-red-300 text-sm"},tL={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},nL={class:"text-green-300 text-sm"},rL={class:"flex justify-center"},sL={__name:"GridBoard",props:{slug:{type:String,required:!0}},setup(n){const e=q(null),t=q(64);Ao(async()=>{await Er();const E=e.value;t.value=E?E.offsetHeight:64,window.addEventListener("resize",r)}),Mv(()=>{window.removeEventListener("resize",r)});function r(){const E=e.value;t.value=E?E.offsetHeight:64}const s=n,i=$u(),o=s.slug,a=q(""),l=q(""),u=q(!1),d=q(null),f=q(null),g=q(""),_=q(""),C=q(6),P=q(!1),R=q(""),L=q(null),U=q(!1),$=q(null),j=q(!1),M=q(null),ae=q(!1),T=q(null),w=q(""),I=q(!1),S=q(null),k=q(""),D=q(""),A=q(!1),Jt=q(null),Gt=q(!1),et=q(null),Le=q(""),ie=q(""),ee=q(!1),ke=q(null),Se=q(!1),De=q(!1),$e=q(""),Yt=q(""),nn=q(!1),Kt=q(!1),K=q(""),me=q(""),ue=q(!1),ne=q(null),Fe=q(""),Je=q(!1),b=q(!1),x=q(!1),O=q(null),Q=q(null),G=q(new Set),X=q(!0),de=q(null),le=q(!1),re=q(!1),Z=q(0),xe=q(null),fe=q(null);function ve(){const E=de.value;if(!E)return;const{scrollLeft:v,scrollWidth:z,clientWidth:se}=E;le.value=v>2,re.value=v<z-se-2}function Re(E){L.value=E;const v=document.querySelector(`[data-player-id="${E}"]`);v&&v.scrollIntoView({behavior:"smooth",block:"center"}),ye.value=!0,Ke.value="Nouveau joueur ajouté !",setTimeout(()=>{ye.value=!1},3e3)}function Pe(E){return G.value.has(E)}async function Ne(){if(l.value)try{const E=await ev(l.value),v=new Set;E.forEach(z=>{z.isProtected&&v.add(z.playerId||z.id)}),G.value=v}catch{const v=new Set;for(const z of ft.value)await gi(z.id,l.value)&&v.add(z.id);G.value=v}}const ye=q(!1),Ke=q("");async function Dt(E){await Zs({type:"deleteEvent",data:{eventId:E}})}async function xn(E=null){const v=E||d.value;if(console.log("deleteEventConfirmed - eventId param:",E),console.log("deleteEventConfirmed - eventToDelete.value:",d.value),console.log("deleteEventConfirmed - eventIdToDelete:",v),console.log("deleteEventConfirmed - type de eventIdToDelete:",typeof v),!v){console.error("Aucun événement à supprimer");return}try{await WV(v,l.value),rt.value=rt.value.filter(z=>z.id!==v),await Promise.all([J_(l.value),Ra(ft.value,rt.value,l.value),Ca(l.value)]).then(([z,se,be])=>{rt.value=z,yt.value=se,pt.value=be}),u.value=!1,d.value=null,ye.value=!0,Ke.value="Événement supprimé avec succès !",setTimeout(()=>{ye.value=!1},3e3)}catch(z){console.error("Erreur lors de la suppression de l'événement:",z),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Lt(){u.value=!1,d.value=null}async function Hn(){if(!f.value||!g.value.trim()||!_.value)return;const E=parseInt(C.value);if(isNaN(E)||E<1||E>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const v={title:g.value.trim(),date:_.value,description:Fe.value.trim()||"",playerCount:E,archived:!!Je.value};await X_(f.value,v,l.value),v.archived||await Qi({eventId:f.value,eventData:v,reason:"updated"}),await Promise.all([J_(l.value),Ra(ft.value,rt.value,l.value),Ca(l.value)]).then(([z,se,be])=>{rt.value=z,yt.value=se,pt.value=be}),f.value=null,g.value="",_.value="",Fe.value="",C.value=6,Je.value=!1,ye.value=!0,Ke.value="Événement mis à jour avec succès !",setTimeout(()=>{ye.value=!1},3e3)}catch(v){console.error("Erreur lors de l'édition de l'événement:",v),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Ws(){if(R.value.trim())try{const E=R.value.trim(),v=await qV(E,l.value);await Promise.all([gh(l.value),Ra(ft.value,rt.value,l.value),Ca(l.value)]).then(([z,se,be])=>{ft.value=z,yt.value=se,pt.value=be,Ne();const Oe=ft.value.find(Ye=>Ye.id===v);Re(v);const Ue=document.querySelector(`[data-player-id="${v}"]`);Ue&&Ue.scrollIntoView({behavior:"smooth",block:"center"}),ye.value=!0,Ke.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{ye.value=!1},3e3),setTimeout(()=>{ye.value=!1,Ke.value=""},5e3)}),P.value=!1,R.value=""}catch(E){console.error("Erreur lors de l'ajout du joueur:",E),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Pt(){f.value=null,g.value="",_.value="",Fe.value="",C.value=6}q(null);const cn=q(!1),tr=q(""),hr=q(""),ls=q(""),cs=q(6),fr=q(!1);async function aa(){if(!tr.value.trim()||!hr.value){alert("Veuillez remplir le titre et la date de l'événement");return}const E=parseInt(cs.value);if(isNaN(E)||E<1||E>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const v={title:tr.value.trim(),date:hr.value,description:ls.value.trim()||"",playerCount:E,archived:!!fr.value};await la(v)}async function la(E){try{const v=await QV(E,l.value);rt.value=[...rt.value,{id:v,...E}];const z={};for(const se of ft.value)z[se.name]=yt.value[se.name]||{},z[se.name][v]=null,await Y_(se.name,z[se.name],l.value);tr.value="",hr.value="",ls.value="",cs.value=6,fr.value=!1,cn.value=!1,await Promise.resolve(),ye.value=!0,Ke.value="Événement créé avec succès !";try{E.archived||await Qi({eventId:v,eventData:E,reason:"created"})}catch(se){console.warn("Envoi des emails partiellement en échec:",se)}setTimeout(()=>{ye.value=!1},3e3)}catch(v){console.error("Erreur lors de la création de l'événement:",(v==null?void 0:v.message)||v),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Vr(){tr.value="",hr.value="",ls.value="",cs.value=6,cn.value=!1}async function ec(){await Zs({type:"addEvent",data:{}})}const rt=q([]),ft=q([]),yt=q({}),pt=q({}),un=q({}),ca=q({});Ao(async()=>{BV("firebase"),await jV();const E=Yw(nt(we,"seasons"),TC("slug","==",s.slug)),v=await xt(E);if(v.empty){i.push("/");return}else{const se=v.docs[0];l.value=se.id,a.value=se.data().name,document.title=`Saison : ${a.value}`}if(l.value){const[se,be,Oe,Ue,Ye]=await Promise.all([xt(nt(we,"seasons",l.value,"players")),xt(nt(we,"seasons",l.value,"events")),xt(nt(we,"seasons",l.value,"availability")),xt(nt(we,"seasons",l.value,"selections")),ev(l.value)]);ft.value=se.docs.map(ze=>({id:ze.id,...ze.data()}));const Me=new Set;Array.isArray(Ye)&&Ye.forEach(ze=>{ze.isProtected&&Me.add(ze.playerId||ze.id)}),G.value=Me,rt.value=be.docs.map(ze=>({id:ze.id,...ze.data(),playerCount:ze.data().playerCount||6}));const Xt={};Oe.docs.forEach(ze=>{const Ut=ze.data(),Vt={};Object.keys(Ut).forEach(Zt=>{const Bn=Ut[Zt];Vt[Zt]=Bn==="oui"?!0:Bn==="non"?!1:Bn}),Xt[ze.id]=Vt}),yt.value=Xt;const Ft={};Ue.docs.forEach(ze=>{Ft[ze.id]=ze.data().players||[]}),pt.value=Ft}(se=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>se()):setTimeout(se,0)})(()=>{da(),Gi()}),console.log("players (deduplicated):",ft.value.map(se=>({id:se.id,name:se.name}))),console.log("availability loaded:",yt.value),await Er(),X.value=!1,Er(()=>{ve();const se=de.value;se&&(se.addEventListener("scroll",be=>{ve(),Z.value=se.scrollLeft||0},{passive:!0}),window.addEventListener("resize",ve))})});function us(E){if(!E)return null;if(E instanceof Date)return E;if(typeof(E==null?void 0:E.toDate)=="function")return E.toDate();if(typeof E=="string"||typeof E=="number"){const v=new Date(E);return isNaN(v.getTime())?null:v}return null}const Qs=Nt(()=>[...ft.value].sort((E,v)=>(E.name||"").localeCompare(v.name||"","fr",{sensitivity:"base"}))),bd=Nt(()=>[...rt.value].sort((E,v)=>{const z=us(E.date),se=us(v.date),be=z?z.getTime():Number.POSITIVE_INFINITY,Oe=se?se.getTime():Number.POSITIVE_INFINITY;return be!==Oe?be-Oe:(E.title||"").localeCompare(v.title||"","fr",{sensitivity:"base"})})),Js=q(!1),nr=Nt(()=>{const E=bd.value;return Js.value?E:E.filter(v=>!v.archived)});function Id(){Js.value=!Js.value}async function Ed(E,v){const z=ft.value.find(Oe=>Oe.name===E);if(!z){console.error("Joueur non trouvé:",E);return}if(!rt.value.find(Oe=>Oe.id===v)){console.error("Événement non trouvé:",v);return}if(await gi(z.id,l.value)){el(z.id)?ds(z,v):await xd({type:"toggleAvailability",data:{player:z,eventId:v}});return}ds(z,v)}function ds(E,v){var be;const z=(be=yt.value[E.name])==null?void 0:be[v];console.log(`toggleAvailability - ${E.name} pour ${v}:`,z);let se;z===!0?se=!1:z===!1?se=void 0:se=!0,se===void 0?yt.value[E.name]&&delete yt.value[E.name][v]:(yt.value[E.name]||(yt.value[E.name]={}),yt.value[E.name][v]=se),Y_(E.name,yt.value[E.name],l.value).then(()=>{ye.value=!0,Ke.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{ye.value=!1},3e3)}).catch(Oe=>{console.error("Erreur lors de la mise à jour de la disponibilité:",Oe),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function Dn(E,v){var z;return(z=yt.value[E])==null?void 0:z[v]}function $i(E,v){var be;const z=pt.value[v]||[],se=(be=yt.value[E])==null?void 0:be[v];return z.includes(E)&&se===!0}async function ji(E,v=6){const z=rt.value.find(Ue=>Ue.id===E),se=(z==null?void 0:z.playerCount)||6,be=pt.value[E]||[];if(be.length>0&&be.every(Ue=>Dn(Ue,E))){console.log("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Ye=ft.value.filter(Ft=>Dn(Ft.name,E)).map(Ft=>{const ze=pr(Ft.name);return{name:Ft.name,weight:1/(1+ze)}}),Me=[],Xt=[...Ye];for(;Me.length<se&&Xt.length>0;){const Ft=Xt.reduce((Vt,Zt)=>Vt+Zt.weight,0);let ze=Math.random()*Ft;const Ut=Xt.findIndex(Vt=>(ze-=Vt.weight,ze<=0));Ut>=0&&(Me.push(Xt[Ut].name),Xt.splice(Ut,1))}pt.value[E]=Me}else{const Ue=be.filter(Me=>Dn(Me,E)),Ye=se-Ue.length;if(Ye<=0)pt.value[E]=Ue;else{const Me=new Set(Ue),Ft=ft.value.filter(Vt=>Dn(Vt.name,E)&&!Me.has(Vt.name)).map(Vt=>{const Zt=pr(Vt.name);return{name:Vt.name,weight:1/(1+Zt)}}),ze=[],Ut=[...Ft];for(;ze.length<Ye&&Ut.length>0;){const Vt=Ut.reduce((te,mt)=>te+mt.weight,0);let Zt=Math.random()*Vt;const Bn=Ut.findIndex(te=>(Zt-=te.weight,Zt<=0));Bn>=0&&(ze.push(Ut[Bn].name),Ut.splice(Bn,1))}pt.value[E]=[...Ue,...ze]}}await HV(E,pt.value[E],l.value),da(),Gi()}async function rr(E,v=6){var Ue,Ye,Me,Xt,Ft;console.log("tirerProtected appelé avec eventId:",E),console.log("showSelectionModal.value AVANT:",x.value),console.log("selectionModalEvent.value?.id AVANT:",(Ue=O.value)==null?void 0:Ue.id);const z=x.value,se=(Ye=O.value)==null?void 0:Ye.id,be=pt.value[E]&&pt.value[E].length>0,Oe=be?[...pt.value[E]]:[];if(await ji(E,v),console.log("showSelectionModal.value APRÈS tirage:",x.value),console.log("selectionModalEvent.value?.id APRÈS tirage:",(Me=O.value)==null?void 0:Me.id),z&&!x.value&&(console.log("Restauration de la popin de sélection..."),x.value=!0,O.value=rt.value.find(ze=>ze.id===se)),x.value&&((Xt=O.value)==null?void 0:Xt.id)===E)if(console.log("Popin de sélection ouverte, mise à jour..."),await Er(),Q.value&&Q.value.showSuccess){console.log("Appel de showSuccess sur la popin de sélection");const ze=pt.value[E]||[],Ut=Oe.filter(Zt=>ze.includes(Zt)),Vt=Ut.length>0&&Ut.length<Oe.length;Q.value.showSuccess(be,Vt)}else console.log("selectionModalRef.value:",Q.value),console.log("showSuccess disponible:",(Ft=Q.value)==null?void 0:Ft.showSuccess);else console.log("Popin de sélection fermée, affichage message global"),ye.value=!0,rt.value.find(ze=>ze.id===E),pt.value[E],be?Ke.value="Sélection mise à jour avec succès !":Ke.value="Sélection effectuée avec succès !",setTimeout(()=>{ye.value=!1},3e3)}function tc(E){var z;return E?(typeof E=="string"?new Date(E):((z=E.toDate)==null?void 0:z.call(E))||E).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function qi(E){var z;return E?(typeof E=="string"?new Date(E):((z=E.toDate)==null?void 0:z.call(E))||E).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function pr(E){return Object.values(pt.value).filter(v=>v.includes(E)).length}function Ys(E){const v=yt.value[E]||{};return Object.values(v).filter(z=>z===!0).length}function Xs(E){return E?Object.values(yt.value).filter(v=>v[E]===!0).length:0}function ua(E){return E?(pt.value[E]||[]).length:0}function Td(E){const v=Ys(E),z=pr(E);return v===0?0:z/v}function zi(E){un.value[E]={availability:Ys(E),selection:pr(E),ratio:Td(E)}}function da(){ft.value.forEach(E=>zi(E.name))}function Gi(){const E={};rt.value.forEach(v=>{const z=v.playerCount||6,be=ft.value.filter(Ue=>Dn(Ue.name,v.id)===!0).map(Ue=>{const Ye=pr(Ue.name);return{name:Ue.name,weight:1/(1+Ye)}}),Oe=be.reduce((Ue,Ye)=>Ue+Ye.weight,0);be.forEach(Ue=>{const Ye=Math.min(1,Ue.weight/Oe*z);E[Ue.name]||(E[Ue.name]={}),E[Ue.name][v.id]=Math.round(Ye*100)})}),ca.value=E}function mr(E,v){var Ue,Ye;const z=E.name,se=Dn(z,v),be=$i(z,v),Oe=((Ye=(Ue=ca.value)==null?void 0:Ue[z])==null?void 0:Ye[v])??0;return se===!1?"Non disponible – cliquez pour changer":be?`Sélectionné · Chance estimée : ${Oe}%`:se===!0?`Disponible · Chance estimée : ${Oe}%`:"Cliquez pour indiquer votre disponibilité"}const Wn=q(null),hs=q(!1);async function Ad(E=null){const v=E||Wn.value;if(!v){console.error("Aucun joueur à supprimer");return}try{await zV(v,l.value),ft.value=ft.value.filter(z=>z.id!==v),hs.value=!1,Wn.value=null,ye.value=!0,Ke.value="Joueur supprimé avec succès !",setTimeout(()=>{ye.value=!1},3e3)}catch(z){console.error("Erreur lors de la suppression du joueur :",z),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function nc(){hs.value=!1,Wn.value=null}async function rc(E){cc(),await gi(E,l.value)?await ic({type:"deletePlayer",data:{playerId:E}}):await Zs({type:"deletePlayer",data:{playerId:E}})}async function sc(){if($.value){const E=rt.value.find(z=>z.id===$.value),v=(E==null?void 0:E.playerCount)||6;await rr($.value,v),U.value=!1,$.value=null}}function ha(){U.value=!1,$.value=null}function fa(){return T.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis"}[T.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Zs(E){if(On.isPinCached(l.value)){const v=On.getCachedPin(l.value);if(console.log("PIN en cache trouvé, utilisation automatique"),await Eu(l.value,v)){await Xe(E);return}else On.clearSession()}T.value=E,ae.value=!0}async function ic(E){const v=E.data.playerId;if(el(v)){console.log("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Xe(E);return}S.value=E,I.value=!0}async function xd(E){const v=E.data.player.id;if(el(v)){console.log("Mot de passe du joueur en cache trouvé, utilisation automatique"),await Xe(E);return}et.value=E,Gt.value=!0}async function Pd(E){try{if(await Eu(l.value,E)){On.saveSession(l.value,E),ae.value=!1;const z=T.value;T.value=null,await Xe(z)}else w.value="Code PIN incorrect",setTimeout(()=>{w.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du PIN:",v),w.value="Erreur lors de la vérification du code PIN"}}function oc(){ae.value=!1,T.value=null,w.value=""}async function pa(E){if(E){A.value=!0,k.value="";try{const v=S.value.data.playerId,z=await af(l.value);if(E===z){try{Pl.saveSession(S.value.data.playerId,E)}catch{}I.value=!1;const be=S.value;S.value=null,D.value="",await Xe(be);return}if(await Tu(v,E,l.value)){I.value=!1;const be=S.value;S.value=null,D.value="",await Xe(be)}else k.value="Mot de passe incorrect",setTimeout(()=>{k.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du mot de passe:",v),k.value="Erreur lors de la vérification du mot de passe"}finally{A.value=!1}}}function Sd(){I.value=!1,S.value=null,k.value="",D.value="",A.value=!1}async function gr(E){if(E){ee.value=!0,Le.value="";try{const v=et.value.data.player,z=await af(l.value);if(E===z){try{Pl.saveSession(et.value.data.player.id,E)}catch{}Gt.value=!1;const be=et.value;et.value=null,ie.value="",await Xe(be);return}if(await Tu(v.id,E,l.value)){Gt.value=!1;const be=et.value;et.value=null,ie.value="",await Xe(be)}else Le.value="Mot de passe incorrect",setTimeout(()=>{Le.value=""},3e3)}catch(v){console.error("Erreur lors de la vérification du mot de passe:",v),Le.value="Erreur lors de la vérification du mot de passe"}finally{ee.value=!1}}}function sr(){Gt.value=!1,et.value=null,Le.value="",ie.value="",ee.value=!1}async function Ki(){De.value=!0,$e.value="",Yt.value="";try{const E=et.value.data.player,v=await lf(E.id,l.value);Yt.value=v.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(E){console.error("Erreur lors de l'envoi de l'email:",E),$e.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{De.value=!1}}async function Hi(){Kt.value=!0,K.value="",me.value="";try{const E=S.value.data.playerId,v=await lf(E,l.value);me.value=v.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(E){console.error("Erreur lors de l'envoi de l'email:",E),K.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Kt.value=!1}}function ac(){return On.isPinCached(l.value)?{timeRemaining:On.getTimeRemaining(),isExpiringSoon:On.isExpiringSoon()}:null}async function Xe(E){if(!E)return;const{type:v,data:z}=E;try{switch(v){case"deleteEvent":console.log("executePendingOperation - data.eventId:",z.eventId),console.log("executePendingOperation - type de data.eventId:",typeof z.eventId),d.value=z.eventId,u.value=!0;break;case"addEvent":cn.value=!0;break;case"deletePlayer":Wn.value=z.playerId,hs.value=!0;break;case"launchSelection":pt.value[z.eventId]&&pt.value[z.eventId].length>0?($.value=z.eventId,U.value=!0,ue.value=!1):(await rr(z.eventId,z.count),ue.value=!1);break;case"toggleAvailability":ds(z.player,z.eventId);break;case"toggleArchive":await setEventArchived(z.eventId,z.archived,l.value);{const se=rt.value.findIndex(be=>be.id===z.eventId);se!==-1&&(rt.value[se]={...rt.value[se],archived:!!z.archived}),Je.value=!!z.archived}break}}catch(se){console.error("Erreur lors de l'exécution de l'opération:",se),ye.value=!0,Ke.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{ye.value=!1},3e3)}}function Wi(){i.push("/")}If(()=>{const E=de.value;E&&E.removeEventListener("scroll",ve),window.removeEventListener("resize",ve)});function ei(E){ne.value=E,Fe.value=E.description||"",Je.value=!!E.archived,ue.value=!0}function _r(){ue.value=!1,ne.value=null,Fe.value="",b.value=!1}function lc(){f.value=ne.value.id,g.value=ne.value.title,_.value=ne.value.date,Fe.value=ne.value.description||"",C.value=ne.value.playerCount||6,ue.value=!1}async function ma(){if(ne.value)try{const E=!ne.value.archived,v={...ne.value,archived:E};await X_(ne.value.id,v,l.value),ne.value.archived=E;const z=rt.value.findIndex(se=>se.id===ne.value.id);z!==-1&&(rt.value[z].archived=E),ye.value=!0,Ke.value=E?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{ye.value=!1},3e3)}catch(E){console.error("Erreur lors de la modification de l'archivage:",E),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function Rd(E){M.value=E,j.value=!0}function cc(){j.value=!1,M.value=null}async function Cd({playerId:E,newName:v}){try{await GV(E,v,l.value),await Promise.all([gh(l.value),Ra(ft.value,rt.value,l.value),Ca(l.value)]).then(([z,se,be])=>{if(ft.value=z,yt.value=se,pt.value=be,Ne(),M.value&&M.value.id===E){const Oe=z.find(Ue=>Ue.id===E);Oe&&(M.value=Oe)}}),ye.value=!0,Ke.value="Joueur mis à jour avec succès !",setTimeout(()=>{ye.value=!1},3e3)}catch(z){console.error("Erreur lors de l'édition du joueur:",z),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function kd(){try{await Promise.all([gh(l.value),Ra(ft.value,rt.value,l.value),Ca(l.value)]).then(([E,v,z])=>{if(ft.value=E,yt.value=v,pt.value=z,Ne(),M.value){const se=E.find(be=>be.id===M.value.id);se&&(M.value=se)}}),ye.value=!0,Ke.value="Données mises à jour !",setTimeout(()=>{ye.value=!1},3e3)}catch(E){console.error("Erreur lors du rafraîchissement:",E)}}function ti(E){if(!E)return{availability:0,selection:0,ratio:0};const v=Ys(E.name),z=pr(E.name),se=v===0?0:Math.round(z/v*100);return{availability:v,selection:z,ratio:se}}function Qn(E){const v=pt.value[E]||[],z=rt.value.find(Oe=>Oe.id===E),se=(z==null?void 0:z.playerCount)||6,be=Xs(E);if(v.length>0){const Oe=v.some(Ye=>!Dn(Ye,E)),Ue=be<se;if(Oe||Ue)return{type:"incomplete",hasUnavailablePlayers:Oe,hasInsufficientPlayers:Ue,unavailablePlayers:v.filter(Ye=>!Dn(Ye,E)),availableCount:be,requiredCount:se}}return be<se?{type:"insufficient",availableCount:be,requiredCount:se}:v.length===0?{type:"ready",availableCount:be,requiredCount:se}:{type:"complete",availableCount:be,requiredCount:se}}function uc(E){const v=Qn(E);return v.type==="incomplete"||v.type==="insufficient"}function ga(E){const v=Qn(E);switch(v.type){case"incomplete":return v.hasUnavailablePlayers?v.unavailablePlayers.length===1?`Sélection incomplète : ${v.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${v.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${v.availableCount} joueurs disponibles pour ${v.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${v.availableCount} disponibles pour ${v.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${v.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${v.availableCount} joueurs disponibles`;default:return""}}async function Qi({eventId:E,eventData:v,reason:z}){if(!l.value)return;const se={id:E,...v},be=[];for(const Oe of ft.value){if(!await gi(Oe.id,l.value))continue;const Ye=await Zb(Oe.id,l.value);if(Ye)try{const Me=await tv({seasonId:l.value,playerId:Oe.id,eventId:se.id,action:"yes"}),Xt=await tv({seasonId:l.value,playerId:Oe.id,eventId:se.id,action:"no"}),Ft=`${Me.url}&slug=${encodeURIComponent(o)}`,ze=`${Xt.url}&slug=${encodeURIComponent(o)}`;await sN({toEmail:Ye,playerName:Oe.name,eventTitle:se.title,eventDate:qi(se.date),yesUrl:Ft,noUrl:ze,reason:z})}catch(Me){console.error("Email non envoyé pour",Oe.name,(Me==null?void 0:Me.message)||Me),be.push(Oe.id)}}ye.value=!0,Ke.value=be.length>0?`Emails envoyés (avec ${be.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{ye.value=!1},3e3)}async function Nr(E){await Qi({eventId:E.id,eventData:E,reason:"manual"})}function Dd(E){if(!E)return{};const v={};return ft.value.forEach(z=>{v[z.name]=Dn(z.name,E)}),v}function Ji(E){O.value=E,x.value=!0}function dc(){x.value=!1,O.value=null}async function vr(){if(!O.value)return;const E=O.value.id,v=O.value.playerCount||6;if(Xs(E)===0){ye.value=!0,Ke.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{ye.value=!1},3e3);return}await Zs({type:"launchSelection",data:{eventId:E,count:v}})}function Vd(){dc(),ye.value=!0,Ke.value="Sélection validée !",setTimeout(()=>{ye.value=!1},3e3)}return(E,v)=>{var z,se,be,Oe,Ue,Ye,Me,Xt,Ft,ze,Ut,Vt,Zt,Bn;return H(),W(Rt,null,[p("div",e2,[p("div",{ref_key:"pageHeaderRef",ref:e,class:"sticky top-0 z-[70] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},[p("button",{onClick:Wi,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},v[41]||(v[41]=[p("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),p("h1",t2,ge(a.value?a.value:"Chargement..."),1),p("button",{onClick:Id,class:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:Js.value?"Masquer les événements archivés":"Afficher les événements archivés"},[p("span",r2,ge(Js.value?"📂":"📁"),1)],8,n2)],512),p("div",s2,[p("div",{ref_key:"headerBarRef",ref:xe,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[p("div",i2,[p("div",{class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},[p("div",{class:"flex items-center justify-center h-full gap-2"},[p("button",{onClick:ec,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},v[42]||(v[42]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),p("span",{class:"sm:hidden"},"Événement",-1)]))])]),p("div",o2,[p("div",{ref_key:"headerEventsRef",ref:fe,class:"flex relative z-[60]",style:Cu({transform:`translateX(-${Z.value}px)`})},[(H(!0),W(Rt,null,Ir(nr.value,te=>(H(),W("div",{key:"h-"+te.id,class:"col-event flex-shrink-0 p-3 text-center cursor-pointer",onClick:mt=>ei(te)},[p("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:qi(te.date)},ge(tc(te.date)),9,l2),p("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:te.title},ge(te.title||"Sans titre"),9,c2),te.archived?(H(),W("div",u2,"(Archivé)")):Ee("",!0),uc(te.id)?(H(),W("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:ga(te.id)+" - Cliquez pour ouvrir la sélection",onClick:Nn(mt=>Ji(te),["stop"])},v[43]||(v[43]=[p("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,d2)):Qn(te.id).type==="ready"?(H(),W("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:ga(te.id)+" - Cliquez pour ouvrir la sélection",onClick:Nn(mt=>Ji(te),["stop"])},v[44]||(v[44]=[p("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,h2)):Ee("",!0)],8,a2))),128))],4)]),v[45]||(v[45]=p("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),lt(p("button",{onClick:v[0]||(v[0]=Nn(te=>E.scrollHeaderBy(-1),["prevent"])),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",512),[[Kd,le.value]]),lt(p("button",{onClick:v[1]||(v[1]=Nn(te=>E.scrollHeaderBy(1),["prevent"])),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",512),[[Kd,re.value]])])],512),lt(p("div",{ref_key:"gridboardRef",ref:de,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[p("table",f2,[p("colgroup",null,[v[46]||(v[46]=p("col",{class:"col-left"},null,-1)),(H(!0),W(Rt,null,Ir(nr.value,(te,mt)=>(H(),W("col",{key:"c"+mt,class:"col-event"}))),128)),v[47]||(v[47]=p("col",{class:"col-right"},null,-1))]),v[51]||(v[51]=p("thead",{class:"hidden"},null,-1)),p("tbody",null,[(H(!0),W(Rt,null,Ir(Qs.value,te=>(H(),W("tr",{key:te.id,class:ar(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":te.id===L.value}]),"data-player-id":te.id},[p("td",m2,[p("div",g2,[Pe(te.id)?(H(),W("span",_2," 🔒 ")):Ee("",!0),p("span",{onClick:mt=>Rd(te),class:"player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight",title:"Cliquez pour voir les détails : "+te.name},ge(te.name),9,v2)])]),(H(!0),W(Rt,null,Ir(nr.value,mt=>(H(),W("td",{key:mt.id,class:"p-3 md:p-5 text-center cursor-pointer hover:bg-white/10 transition-all duration-200 min-h-20",onClick:Zp=>Ed(te.name,mt.id)},[p("div",w2,[$i(te.name,mt.id)?(H(),W("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:mr(te,mt.id)}," 🎭 ",8,b2)):Dn(te.name,mt.id)?(H(),W("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:mr(te,mt.id)}," ✅ ",8,I2)):Dn(te.name,mt.id)===!1?(H(),W("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:mr(te,mt.id)}," ❌ ",8,E2)):(H(),W("span",{key:3,class:"text-gray-500 hover:text-white transition-colors duration-200 text-xl",title:mr(te,mt.id)}," – ",8,T2))])],8,y2))),128)),v[48]||(v[48]=p("td",{class:"p-3 md:p-4"},null,-1))],10,p2))),128)),p("tr",A2,[p("td",x2,[p("div",P2,[p("button",{onClick:v[2]||(v[2]=te=>P.value=!0),class:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur"},v[49]||(v[49]=[p("span",{class:"text-lg"},"➕",-1),p("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),p("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(H(!0),W(Rt,null,Ir(nr.value,te=>(H(),W("td",{key:"add-row-"+te.id,class:"p-3 md:p-5"}))),128)),v[50]||(v[50]=p("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Kd,!X.value]])])]),X.value?(H(),W("div",S2,v[52]||(v[52]=[Lr('<div class="text-center"><div class="w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"><span class="text-3xl">🎭</span></div><p class="text-white text-lg">Préparation de la grille…</p><p class="text-white/70 text-sm mt-1">Un instant</p></div>',1)]))):Ee("",!0),ye.value?(H(),W("div",R2,[p("div",C2,[v[53]||(v[53]=p("span",{class:"text-xl"},"✨",-1)),p("span",null,ge(Ke.value),1)])])):Ee("",!0),cn.value?(H(),W("div",k2,[p("div",D2,[v[59]||(v[59]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),p("div",V2,[v[54]||(v[54]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),lt(p("input",{"onUpdate:modelValue":v[3]||(v[3]=te=>tr.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[St,tr.value]])]),p("div",N2,[v[55]||(v[55]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),lt(p("input",{"onUpdate:modelValue":v[4]||(v[4]=te=>hr.value=te),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[St,hr.value]])]),p("div",O2,[v[56]||(v[56]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),lt(p("textarea",{"onUpdate:modelValue":v[5]||(v[5]=te=>ls.value=te),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[St,ls.value]])]),p("div",M2,[lt(p("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":v[6]||(v[6]=te=>fr.value=te),class:"w-4 h-4"},null,512),[[jm,fr.value]]),v[57]||(v[57]=p("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),p("div",L2,[v[58]||(v[58]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),lt(p("input",{"onUpdate:modelValue":v[7]||(v[7]=te=>cs.value=te),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[St,cs.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:Vr,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:aa,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):Ee("",!0),P.value?(H(),W("div",F2,[p("div",U2,[v[61]||(v[61]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),p("div",B2,[v[60]||(v[60]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),lt(p("input",{"onUpdate:modelValue":v[8]||(v[8]=te=>R.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[St,R.value]])]),p("div",$2,[p("button",{onClick:v[9]||(v[9]=te=>P.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Ws,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):Ee("",!0),u.value?(H(),W("div",j2,[p("div",q2,[v[62]||(v[62]=Lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),p("div",z2,[p("button",{onClick:Lt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:v[10]||(v[10]=()=>xn()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):Ee("",!0),hs.value?(H(),W("div",G2,[p("div",K2,[v[63]||(v[63]=Lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),p("div",H2,[p("button",{onClick:nc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:v[11]||(v[11]=()=>Ad()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):Ee("",!0),U.value?(H(),W("div",W2,[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[v[64]||(v[64]=Lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:ha,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),p("button",{onClick:sc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):Ee("",!0),ue.value?(H(),W("div",{key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:_r},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:v[21]||(v[21]=Nn(()=>{},["stop"]))},[p("div",Q2,[p("button",{onClick:_r,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),v[65]||(v[65]=p("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[p("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),p("h2",J2,ge((z=ne.value)==null?void 0:z.title),1),p("p",Y2,ge(qi((se=ne.value)==null?void 0:se.date)),1)]),p("div",X2,[(be=ne.value)!=null&&be.description?(H(),W("div",Z2,[p("p",eM,ge(ne.value.description),1)])):Ee("",!0),p("div",tM,[p("div",nM,[p("div",rM,ge(Xs((Oe=ne.value)==null?void 0:Oe.id)),1),v[66]||(v[66]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),p("div",sM,[p("div",iM,ge(ua((Ue=ne.value)==null?void 0:Ue.id)),1),v[67]||(v[67]=p("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),p("div",oM,[p("div",aM,ge(((Ye=ne.value)==null?void 0:Ye.playerCount)||6),1),v[68]||(v[68]=p("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),p("div",lM,[p("button",{onClick:lc,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},v[69]||(v[69]=[p("span",null,"✏️",-1),p("span",null,"Modifier",-1)])),p("button",{onClick:v[12]||(v[12]=te=>Nr(ne.value)),class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2",title:"Envoyer un email aux joueurs protégés pour indiquer leur disponibilité"},v[70]||(v[70]=[p("span",null,"📧",-1),p("span",null,"Relancer",-1)])),p("button",{onClick:ma,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(Me=ne.value)!=null&&Me.archived?"Désarchiver cet événement":"Archiver cet événement"},[p("span",null,ge((Xt=ne.value)!=null&&Xt.archived?"📂":"📁"),1),p("span",null,ge((Ft=ne.value)!=null&&Ft.archived?"Désarchiver":"Archiver"),1)],8,cM),p("button",{onClick:v[13]||(v[13]=te=>Ji(ne.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},v[71]||(v[71]=[p("span",null,"🎭",-1),p("span",null,"Sélection",-1)])),p("button",{onClick:v[14]||(v[14]=te=>{var mt;return Dt((mt=ne.value)==null?void 0:mt.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},v[72]||(v[72]=[p("span",null,"🗑️",-1),p("span",null,"Supprimer",-1)])),p("button",{onClick:_r,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),b.value?(H(),W("div",uM,[p("button",{onClick:v[15]||(v[15]=te=>{lc(),b.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),p("button",{onClick:v[16]||(v[16]=te=>{Nr(ne.value),b.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30"},"📧 Relancer"),p("button",{onClick:v[17]||(v[17]=te=>{ma(),b.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},ge((ze=ne.value)!=null&&ze.archived?"📂 Désarchiver":"📁 Archiver"),1),p("button",{onClick:v[18]||(v[18]=te=>{var mt;Dt((mt=ne.value)==null?void 0:mt.id),b.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):Ee("",!0)]),p("div",dM,[p("button",{onClick:v[19]||(v[19]=te=>Ji(ne.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélection"),p("button",{onClick:_r,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),p("button",{onClick:v[20]||(v[20]=te=>b.value=!b.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):Ee("",!0),f.value?(H(),W("div",hM,[p("div",fM,[v[78]||(v[78]=p("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),p("div",pM,[v[73]||(v[73]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),lt(p("input",{"onUpdate:modelValue":v[22]||(v[22]=te=>g.value=te),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Sn(Pt,["esc"]),Sn(Hn,["enter"])],ref:"editTitleInput"},null,544),[[St,g.value]])]),p("div",mM,[v[74]||(v[74]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),lt(p("input",{"onUpdate:modelValue":v[23]||(v[23]=te=>_.value=te),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Sn(Pt,["esc"]),Sn(Hn,["enter"])]},null,544),[[St,_.value]])]),p("div",gM,[v[75]||(v[75]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),lt(p("textarea",{"onUpdate:modelValue":v[24]||(v[24]=te=>Fe.value=te),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Sn(Pt,["esc"])},null,544),[[St,Fe.value]])]),p("div",_M,[lt(p("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":v[25]||(v[25]=te=>Je.value=te),class:"w-4 h-4"},null,512),[[jm,Je.value]]),v[76]||(v[76]=p("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),p("div",vM,[v[77]||(v[77]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),lt(p("input",{"onUpdate:modelValue":v[26]||(v[26]=te=>C.value=te),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Sn(Pt,["esc"])},null,544),[[St,C.value]])]),p("div",{class:"flex justify-end space-x-3"},[p("button",{onClick:Pt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),p("button",{onClick:Hn,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):Ee("",!0),$t(Yb,{show:ae.value,message:fa(),error:w.value,"session-info":ac(),onSubmit:Pd,onCancel:oc},null,8,["show","message","error","session-info"]),I.value?(H(),W("div",yM,[p("div",wM,[v[80]||(v[80]=Lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",bM,[p("div",IM,[p("div",null,[v[79]||(v[79]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(p("input",{"onUpdate:modelValue":v[27]||(v[27]=te=>D.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:v[28]||(v[28]=Sn(te=>pa(D.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Jt},null,544),[[St,D.value]])])]),p("button",{onClick:v[29]||(v[29]=te=>pa(D.value)),disabled:!D.value||A.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[A.value?(H(),W("span",TM,"⏳")):(H(),W("span",AM,"🔓")),p("span",null,ge(A.value?"Vérification...":"Vérifier et supprimer"),1)],8,EM)]),p("div",xM,[p("button",{onClick:v[30]||(v[30]=te=>nn.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),k.value?(H(),W("div",PM,[p("div",SM,ge(k.value),1)])):Ee("",!0),p("div",{class:"flex justify-center"},[p("button",{onClick:Sd,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):Ee("",!0),Gt.value?(H(),W("div",RM,[p("div",CM,[v[83]||(v[83]=Lr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),p("div",kM,[p("div",DM,[p("div",null,[v[81]||(v[81]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),lt(p("input",{"onUpdate:modelValue":v[31]||(v[31]=te=>ie.value=te),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:v[32]||(v[32]=Sn(te=>gr(ie.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:ke},null,544),[[St,ie.value]])])]),p("div",VM,[p("button",{onClick:v[33]||(v[33]=te=>Se.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Le.value?(H(),W("div",NM,[p("div",OM,ge(Le.value),1)])):Ee("",!0)]),p("div",MM,[p("button",{onClick:sr,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),p("button",{onClick:v[34]||(v[34]=te=>gr(ie.value)),disabled:!ie.value||ee.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[ee.value?(H(),W("span",FM,"⏳")):(H(),W("span",UM,"🔓")),p("span",null,[qn(ge(ee.value?"Vérification...":"Vérifier"),1),v[82]||(v[82]=p("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,LM)])])])):Ee("",!0),Se.value?(H(),W("div",{key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:v[37]||(v[37]=te=>Se.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[36]||(v[36]=Nn(()=>{},["stop"]))},[v[85]||(v[85]=Lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),p("div",BM,[v[84]||(v[84]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:Ki,disabled:De.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[De.value?(H(),W("span",jM,"⏳")):(H(),W("span",qM,"📧")),p("span",null,ge(De.value?"Envoi...":"Envoyer l'email"),1)],8,$M)]),$e.value?(H(),W("div",zM,[p("div",GM,ge($e.value),1)])):Ee("",!0),Yt.value?(H(),W("div",KM,[p("div",HM,ge(Yt.value),1)])):Ee("",!0),p("div",WM,[p("button",{onClick:v[35]||(v[35]=te=>Se.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0),nn.value?(H(),W("div",{key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:v[40]||(v[40]=te=>nn.value=!1)},[p("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:v[39]||(v[39]=Nn(()=>{},["stop"]))},[v[87]||(v[87]=Lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),p("div",QM,[v[86]||(v[86]=p("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),p("button",{onClick:Hi,disabled:Kt.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Kt.value?(H(),W("span",YM,"⏳")):(H(),W("span",XM,"📧")),p("span",null,ge(Kt.value?"Envoi...":"Envoyer l'email"),1)],8,JM)]),K.value?(H(),W("div",ZM,[p("div",eL,ge(K.value),1)])):Ee("",!0),me.value?(H(),W("div",tL,[p("div",nL,ge(me.value),1)])):Ee("",!0),p("div",rL,[p("button",{onClick:v[38]||(v[38]=te=>nn.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):Ee("",!0),$t(pO,{show:j.value,player:M.value,stats:ti(M.value),seasonId:l.value,onClose:cc,onUpdate:Cd,onDelete:rc,onRefresh:kd},null,8,["show","player","stats","seasonId"]),$t(ZO,{ref_key:"selectionModalRef",ref:Q,show:x.value,event:O.value,"current-selection":pt.value[(Ut=O.value)==null?void 0:Ut.id]||[],"available-count":Xs((Vt=O.value)==null?void 0:Vt.id),"selected-count":ua((Zt=O.value)==null?void 0:Zt.id),"player-availability":Dd((Bn=O.value)==null?void 0:Bn.id),onClose:dc,onSelection:vr,onPerfect:Vd},null,8,["show","event","current-selection","available-count","selected-count","player-availability"])],64)}}},iL={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},oL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},aL={key:0,class:"text-center py-8"},lL={key:1,class:"text-center py-8"},cL={class:"text-gray-300 mb-6"},uL={key:2,class:"space-y-6"},dL={class:"text-center"},hL={class:"text-gray-300"},fL={class:"font-semibold text-white"},pL={class:"space-y-4"},mL=["disabled"],gL={key:0,class:"animate-spin"},_L={key:1},vL={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},yL={class:"text-red-300 text-sm"},wL={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},bL={class:"text-green-300 text-sm"},IL={__name:"PasswordReset",setup(n){const e=by(),t=$u(),r=q(!0),s=q(""),i=q(""),o=q(""),a=q(""),l=q(""),u=q(!1),d=q(""),f=q(""),g=Nt(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);Ao(async()=>{try{const{oobCode:P}=e.query;if(console.log("🔍 [DEBUG] Token reçu:",P),!P){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=P,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(P){console.error("Erreur lors de la vérification du lien:",P),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function _(){if(g.value){u.value=!0,d.value="",f.value="";try{console.log("🔍 [DEBUG] Début réinitialisation avec token:",o.value),await Y1(Bi,o.value,a.value),console.log("🔍 [DEBUG] Mot de passe Firebase Auth mis à jour"),console.log("🔍 [DEBUG] Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{C()},3e3)}catch(P){console.error("❌ [ERROR] Erreur lors de la réinitialisation:",P),P.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":P.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{u.value=!1}}}function C(){t.push("/")}return(P,R)=>(H(),W("div",iL,[p("div",oL,[R[8]||(R[8]=Lr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(H(),W("div",aL,R[2]||(R[2]=[p("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),p("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(H(),W("div",lL,[R[3]||(R[3]=p("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[p("span",{class:"text-2xl"},"❌")],-1)),R[4]||(R[4]=p("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),p("p",cL,ge(s.value),1),p("button",{onClick:C,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(H(),W("div",uL,[p("div",dL,[p("p",hL,[R[5]||(R[5]=qn("Email : ")),p("span",fL,ge(i.value),1)])]),p("div",pL,[p("div",null,[R[6]||(R[6]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":R[0]||(R[0]=L=>a.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Sn(_,["enter"])},null,544),[[St,a.value]])]),p("div",null,[R[7]||(R[7]=p("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),lt(p("input",{"onUpdate:modelValue":R[1]||(R[1]=L=>l.value=L),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Sn(_,["enter"])},null,544),[[St,l.value]])])]),p("button",{onClick:_,disabled:!g.value||u.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[u.value?(H(),W("span",gL,"⏳")):(H(),W("span",_L,"🔑")),p("span",null,ge(u.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,mL),d.value?(H(),W("div",vL,[p("div",yL,ge(d.value),1)])):Ee("",!0),f.value?(H(),W("div",wL,[p("div",bL,ge(f.value),1)])):Ee("",!0)])):Ee("",!0)])]))}},EL={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},TL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},AL={class:"text-3xl"},xL={class:"text-2xl font-bold text-white mb-2"},PL={class:"text-gray-300 mb-6"},SL={__name:"MagicLink",setup(n){const e=by(),t=$u(),r=q("loading"),s=q("Traitement en cours..."),i=q("Merci de patienter pendant la validation du lien."),o=Nt(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return Ao(async()=>{try{const l=String(e.query.sid||""),u=String(e.query.pid||""),d=String(e.query.eid||""),f=String(e.query.t||""),g=String(e.query.a||""),_=String(e.query.slug||"");if(!l||!u||!d||!f||!g){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(!(await nN({seasonId:l,playerId:u,eventId:d,token:f,action:g})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}const P=Be(we,"seasons",l,"players",u),R=await Li(P),L=R.exists()&&R.data().name||"";if(!L){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await KV({seasonId:l,playerName:L,eventId:d,value:g==="yes"}),await rN({seasonId:l,playerId:u,eventId:d}),r.value="ok",s.value="Merci !",i.value=g==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(()=>a(),2e3)}catch(l){console.error("Magic link error:",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,u)=>(H(),W("div",EL,[p("div",TL,[p("div",{class:ar(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[p("span",AL,ge(o.value),1)],2),p("h1",xL,ge(s.value),1),p("p",PL,ge(i.value),1),p("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},RL=[{path:"/",component:UV},{path:"/season/:slug",component:sL,props:!0},{path:"/reset-password",component:IL},{path:"/magic",component:SL}],CL=TA({history:ZT("/"),routes:RL});yT(IT).use(CL).mount("#app");export{nt as $,tb as A,Ci as B,Rr as C,zt as D,OF as E,Vi as F,vp as G,NF as H,OL as I,Zn as J,fC as K,mC as L,nb as M,aF as N,lF as O,$C as P,mn as Q,XL as R,BL as S,Ct as T,xF as U,sd as V,UC as W,AF as X,oF as Y,qL as Z,zy as _,_l as a,Jl as a$,FL as a0,pC as a1,PC as a2,VF as a3,wl as a4,TF as a5,KL as a6,DF as a7,Be as a8,JL as a9,QL as aA,pF as aB,mF as aC,YL as aD,AC as aE,wF as aF,bF as aG,LC as aH,Yw as aI,Bw as aJ,UL as aK,EF as aL,Rp as aM,Cn as aN,RF as aO,kL as aP,cF as aQ,nF as aR,tF as aS,iF as aT,HL as aU,RC as aV,SF as aW,zL as aX,TC as aY,rb as aZ,$F as a_,_C as aa,jL as ab,GL as ac,kF as ad,sF as ae,rF as af,kt as ag,Kl as ah,CC as ai,gF as aj,Li as ak,uF as al,dF as am,xt as an,hF as ao,fF as ap,gC as aq,CF as ar,PF as as,$L as at,ZL as au,eF as av,WL as aw,_F as ax,yF as ay,vF as az,vC as b,K1 as b$,Ql as b0,qF as b1,Tl as b2,Fi as b3,Es as b4,LF as b5,As as b6,Ts as b7,Zr as b8,Gc as b9,e1 as bA,p4 as bB,P4 as bC,O_ as bD,Ck as bE,b1 as bF,o4 as bG,YF as bH,H1 as bI,v4 as bJ,E4 as bK,x4 as bL,m4 as bM,l4 as bN,ck as bO,GF as bP,qC as bQ,W1 as bR,y4 as bS,I4 as bT,A4 as bU,r1 as bV,h4 as bW,e4 as bX,J1 as bY,JF as bZ,i4 as b_,BF as ba,wi as bb,Eo as bc,VD as bd,FF as be,g4 as bf,sf as bg,UF as bh,ND as bi,Jp as bj,xs as bk,WF as bl,uk as bm,vk as bn,DD as bo,Fb as bp,X1 as bq,Y1 as br,E1 as bs,Z1 as bt,jF as bu,f4 as bv,ZF as bw,s4 as bx,$D as by,zF as bz,zo as c,Up as c0,HF as c1,ek as c2,XF as c3,_4 as c4,b4 as c5,T4 as c6,d4 as c7,KF as c8,u4 as c9,r4 as ca,rk as cb,w4 as cc,n4 as cd,c4 as ce,a4 as cf,t4 as cg,QF as ch,Ni as d,ht as e,Y as f,ra as g,zl as h,jc as i,dd as j,Gl as k,cd as l,Pp as m,Go as n,ud as o,pi as p,BC as q,Ot as r,Ii as s,pe as t,VL as u,oP as v,Tt as w,MF as x,Ge as y,DL as z};
