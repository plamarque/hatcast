(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function jp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Tt={},wa=[],Or=()=>{},tx=()=>!1,Xd=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),qp=n=>n.startsWith("onUpdate:"),En=Object.assign,Bp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},nx=Object.prototype.hasOwnProperty,mt=(n,e)=>nx.call(n,e),Ue=Array.isArray,Ia=n=>Bu(n)==="[object Map]",Za=n=>Bu(n)==="[object Set]",sv=n=>Bu(n)==="[object Date]",He=n=>typeof n=="function",sn=n=>typeof n=="string",ts=n=>typeof n=="symbol",Rt=n=>n!==null&&typeof n=="object",i0=n=>(Rt(n)||He(n))&&He(n.then)&&He(n.catch),o0=Object.prototype.toString,Bu=n=>o0.call(n),rx=n=>Bu(n).slice(8,-1),a0=n=>Bu(n)==="[object Object]",zp=n=>sn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Xl=jp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Zd=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},sx=/-(\w)/g,Tr=Zd(n=>n.replace(sx,(e,t)=>t?t.toUpperCase():"")),ix=/\B([A-Z])/g,Ni=Zd(n=>n.replace(ix,"-$1").toLowerCase()),eh=Zd(n=>n.charAt(0).toUpperCase()+n.slice(1)),af=Zd(n=>n?`on${eh(n)}`:""),vi=(n,e)=>!Object.is(n,e),Yc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},zf=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},yd=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let iv;const th=()=>iv||(iv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function vs(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=sn(r)?ux(r):vs(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(sn(n)||Rt(n))return n}const ox=/;(?![^(]*\))/g,ax=/:([^]+)/,lx=/\/\*[^]*?\*\//g;function ux(n){const e={};return n.replace(lx,"").split(ox).forEach(t=>{if(t){const r=t.split(ax);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Kt(n){let e="";if(sn(n))e=n;else if(Ue(n))for(let t=0;t<n.length;t++){const r=Kt(n[t]);r&&(e+=r+" ")}else if(Rt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const cx="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",dx=jp(cx);function l0(n){return!!n||n===""}function hx(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=zu(n[r],e[r]);return t}function zu(n,e){if(n===e)return!0;let t=sv(n),r=sv(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=ts(n),r=ts(e),t||r)return n===e;if(t=Ue(n),r=Ue(e),t||r)return t&&r?hx(n,e):!1;if(t=Rt(n),r=Rt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!zu(n[o],e[o]))return!1}}return String(n)===String(e)}function Kp(n,e){return n.findIndex(t=>zu(t,e))}const u0=n=>!!(n&&n.__v_isRef===!0),ie=n=>sn(n)?n:n==null?"":Ue(n)||Rt(n)&&(n.toString===o0||!He(n.toString))?u0(n)?ie(n.value):JSON.stringify(n,c0,2):String(n),c0=(n,e)=>u0(e)?c0(n,e.value):Ia(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[lf(r,i)+" =>"]=s,t),{})}:Za(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>lf(t))}:ts(e)?lf(e):Rt(e)&&!Ue(e)&&!a0(e)?String(e):e,lf=(n,e="")=>{var t;return ts(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let nr;class fx{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=nr,!e&&nr&&(this.index=(nr.scopes||(nr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=nr;try{return nr=this,e()}finally{nr=t}}}on(){++this._on===1&&(this.prevScope=nr,nr=this)}off(){this._on>0&&--this._on===0&&(nr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function px(){return nr}let At;const uf=new WeakSet;class d0{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,nr&&nr.active&&nr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,uf.has(this)&&(uf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||f0(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,ov(this),p0(this);const e=At,t=Mr;At=this,Mr=!0;try{return this.fn()}finally{m0(this),At=e,Mr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Wp(e);this.deps=this.depsTail=void 0,ov(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?uf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Kf(this)&&this.run()}get dirty(){return Kf(this)}}let h0=0,Zl,eu;function f0(n,e=!1){if(n.flags|=8,e){n.next=eu,eu=n;return}n.next=Zl,Zl=n}function Gp(){h0++}function Hp(){if(--h0>0)return;if(eu){let e=eu;for(eu=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Zl;){let e=Zl;for(Zl=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function p0(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function m0(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Wp(r),mx(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function Kf(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(g0(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function g0(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===pu)||(n.globalVersion=pu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!Kf(n))))return;n.flags|=2;const e=n.dep,t=At,r=Mr;At=n,Mr=!0;try{p0(n);const s=n.fn(n._value);(e.version===0||vi(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{At=t,Mr=r,m0(n),n.flags&=-3}}function Wp(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Wp(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function mx(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Mr=!0;const v0=[];function Ps(){v0.push(Mr),Mr=!1}function Rs(){const n=v0.pop();Mr=n===void 0?!0:n}function ov(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=At;At=void 0;try{e()}finally{At=t}}}let pu=0;class gx{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Qp{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!At||!Mr||At===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==At)t=this.activeLink=new gx(At,this),At.deps?(t.prevDep=At.depsTail,At.depsTail.nextDep=t,At.depsTail=t):At.deps=At.depsTail=t,y0(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=At.depsTail,t.nextDep=void 0,At.depsTail.nextDep=t,At.depsTail=t,At.deps===t&&(At.deps=r)}return t}trigger(e){this.version++,pu++,this.notify(e)}notify(e){Gp();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Hp()}}}function y0(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)y0(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Gf=new WeakMap,_o=Symbol(""),Hf=Symbol(""),mu=Symbol("");function Fn(n,e,t){if(Mr&&At){let r=Gf.get(n);r||Gf.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Qp),s.map=r,s.key=t),s.track()}}function ys(n,e,t,r,s,i){const o=Gf.get(n);if(!o){pu++;return}const a=l=>{l&&l.trigger()};if(Gp(),e==="clear")o.forEach(a);else{const l=Ue(n),c=l&&zp(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,m)=>{(m==="length"||m===mu||!ts(m)&&m>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(mu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(_o)),Ia(n)&&a(o.get(Hf)));break;case"delete":l||(a(o.get(_o)),Ia(n)&&a(o.get(Hf)));break;case"set":Ia(n)&&a(o.get(_o));break}}Hp()}function ua(n){const e=pt(n);return e===n?e:(Fn(e,"iterate",mu),Ir(n)?e:e.map(An))}function nh(n){return Fn(n=pt(n),"iterate",mu),n}const vx={__proto__:null,[Symbol.iterator](){return cf(this,Symbol.iterator,An)},concat(...n){return ua(this).concat(...n.map(e=>Ue(e)?ua(e):e))},entries(){return cf(this,"entries",n=>(n[1]=An(n[1]),n))},every(n,e){return fs(this,"every",n,e,void 0,arguments)},filter(n,e){return fs(this,"filter",n,e,t=>t.map(An),arguments)},find(n,e){return fs(this,"find",n,e,An,arguments)},findIndex(n,e){return fs(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return fs(this,"findLast",n,e,An,arguments)},findLastIndex(n,e){return fs(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return fs(this,"forEach",n,e,void 0,arguments)},includes(...n){return df(this,"includes",n)},indexOf(...n){return df(this,"indexOf",n)},join(n){return ua(this).join(n)},lastIndexOf(...n){return df(this,"lastIndexOf",n)},map(n,e){return fs(this,"map",n,e,void 0,arguments)},pop(){return Nl(this,"pop")},push(...n){return Nl(this,"push",n)},reduce(n,...e){return av(this,"reduce",n,e)},reduceRight(n,...e){return av(this,"reduceRight",n,e)},shift(){return Nl(this,"shift")},some(n,e){return fs(this,"some",n,e,void 0,arguments)},splice(...n){return Nl(this,"splice",n)},toReversed(){return ua(this).toReversed()},toSorted(n){return ua(this).toSorted(n)},toSpliced(...n){return ua(this).toSpliced(...n)},unshift(...n){return Nl(this,"unshift",n)},values(){return cf(this,"values",An)}};function cf(n,e,t){const r=nh(n),s=r[e]();return r!==n&&!Ir(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const yx=Array.prototype;function fs(n,e,t,r,s,i){const o=nh(n),a=o!==n&&!Ir(n),l=o[e];if(l!==yx[e]){const f=l.apply(n,i);return a?An(f):f}let c=t;o!==n&&(a?c=function(f,m){return t.call(this,An(f),m,n)}:t.length>2&&(c=function(f,m){return t.call(this,f,m,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function av(n,e,t,r){const s=nh(n);let i=t;return s!==n&&(Ir(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,An(a),l,n)}),s[e](i,...r)}function df(n,e,t){const r=pt(n);Fn(r,"iterate",mu);const s=r[e](...t);return(s===-1||s===!1)&&Xp(t[0])?(t[0]=pt(t[0]),r[e](...t)):s}function Nl(n,e,t=[]){Ps(),Gp();const r=pt(n)[e].apply(n,t);return Hp(),Rs(),r}const _x=jp("__proto__,__v_isRef,__isVue"),_0=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(ts));function bx(n){ts(n)||(n=String(n));const e=pt(this);return Fn(e,"has",n),e.hasOwnProperty(n)}class b0{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?Cx:T0:i?E0:I0).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ue(e);if(!s){let l;if(o&&(l=vx[t]))return l;if(t==="hasOwnProperty")return bx}const a=Reflect.get(e,t,Un(e)?e:r);return(ts(t)?_0.has(t):_x(t))||(s||Fn(e,"get",t),i)?a:Un(a)?o&&zp(t)?a:a.value:Rt(a)?s?A0(a):rh(a):a}}class w0 extends b0{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Ii(i);if(!Ir(r)&&!Ii(r)&&(i=pt(i),r=pt(r)),!Ue(e)&&Un(i)&&!Un(r))return l?!1:(i.value=r,!0)}const o=Ue(e)&&zp(t)?Number(t)<e.length:mt(e,t),a=Reflect.set(e,t,r,Un(e)?e:s);return e===pt(s)&&(o?vi(r,i)&&ys(e,"set",t,r):ys(e,"add",t,r)),a}deleteProperty(e,t){const r=mt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&ys(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!ts(t)||!_0.has(t))&&Fn(e,"has",t),r}ownKeys(e){return Fn(e,"iterate",Ue(e)?"length":_o),Reflect.ownKeys(e)}}class wx extends b0{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const Ix=new w0,Ex=new wx,Tx=new w0(!0);const Wf=n=>n,Lc=n=>Reflect.getPrototypeOf(n);function xx(n,e,t){return function(...r){const s=this.__v_raw,i=pt(s),o=Ia(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?Wf:e?_d:An;return!e&&Fn(i,"iterate",l?Hf:_o),{next(){const{value:f,done:m}=c.next();return m?{value:f,done:m}:{value:a?[d(f[0]),d(f[1])]:d(f),done:m}},[Symbol.iterator](){return this}}}}function Fc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function Ax(n,e){const t={get(s){const i=this.__v_raw,o=pt(i),a=pt(s);n||(vi(s,a)&&Fn(o,"get",s),Fn(o,"get",a));const{has:l}=Lc(o),c=e?Wf:n?_d:An;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Fn(pt(s),"iterate",_o),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=pt(i),a=pt(s);return n||(vi(s,a)&&Fn(o,"has",s),Fn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=pt(a),c=e?Wf:n?_d:An;return!n&&Fn(l,"iterate",_o),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return En(t,n?{add:Fc("add"),set:Fc("set"),delete:Fc("delete"),clear:Fc("clear")}:{add(s){!e&&!Ir(s)&&!Ii(s)&&(s=pt(s));const i=pt(this);return Lc(i).has.call(i,s)||(i.add(s),ys(i,"add",s,s)),this},set(s,i){!e&&!Ir(i)&&!Ii(i)&&(i=pt(i));const o=pt(this),{has:a,get:l}=Lc(o);let c=a.call(o,s);c||(s=pt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?vi(i,d)&&ys(o,"set",s,i):ys(o,"add",s,i),this},delete(s){const i=pt(this),{has:o,get:a}=Lc(i);let l=o.call(i,s);l||(s=pt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&ys(i,"delete",s,void 0),c},clear(){const s=pt(this),i=s.size!==0,o=s.clear();return i&&ys(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=xx(s,n,e)}),t}function Jp(n,e){const t=Ax(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(mt(t,s)&&s in r?t:r,s,i)}const Sx={get:Jp(!1,!1)},Px={get:Jp(!1,!0)},Rx={get:Jp(!0,!1)};const I0=new WeakMap,E0=new WeakMap,T0=new WeakMap,Cx=new WeakMap;function kx(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Dx(n){return n.__v_skip||!Object.isExtensible(n)?0:kx(rx(n))}function rh(n){return Ii(n)?n:Yp(n,!1,Ix,Sx,I0)}function x0(n){return Yp(n,!1,Tx,Px,E0)}function A0(n){return Yp(n,!0,Ex,Rx,T0)}function Yp(n,e,t,r,s){if(!Rt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=Dx(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function Ea(n){return Ii(n)?Ea(n.__v_raw):!!(n&&n.__v_isReactive)}function Ii(n){return!!(n&&n.__v_isReadonly)}function Ir(n){return!!(n&&n.__v_isShallow)}function Xp(n){return n?!!n.__v_raw:!1}function pt(n){const e=n&&n.__v_raw;return e?pt(e):n}function Nx(n){return!mt(n,"__v_skip")&&Object.isExtensible(n)&&zf(n,"__v_skip",!0),n}const An=n=>Rt(n)?rh(n):n,_d=n=>Rt(n)?A0(n):n;function Un(n){return n?n.__v_isRef===!0:!1}function N(n){return S0(n,!1)}function Vx(n){return S0(n,!0)}function S0(n,e){return Un(n)?n:new Ox(n,e)}class Ox{constructor(e,t){this.dep=new Qp,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:pt(e),this._value=t?e:An(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Ir(e)||Ii(e);e=r?e:pt(e),vi(e,t)&&(this._rawValue=e,this._value=r?e:An(e),this.dep.trigger())}}function Ts(n){return Un(n)?n.value:n}const Mx={get:(n,e,t)=>e==="__v_raw"?n:Ts(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Un(s)&&!Un(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function P0(n){return Ea(n)?n:new Proxy(n,Mx)}class Lx{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Qp(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=pu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&At!==this)return f0(this,!0),!0}get value(){const e=this.dep.track();return g0(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Fx(n,e,t=!1){let r,s;return He(n)?r=n:(r=n.get,s=n.set),new Lx(r,s,t)}const $c={},bd=new WeakMap;let oo;function $x(n,e=!1,t=oo){if(t){let r=bd.get(t);r||bd.set(t,r=[]),r.push(n)}}function Ux(n,e,t=Tt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=K=>s?K:Ir(K)||s===!1||s===0?_s(K,1):_s(K);let d,f,m,y,T=!1,x=!1;if(Un(n)?(f=()=>n.value,T=Ir(n)):Ea(n)?(f=()=>c(n),T=!0):Ue(n)?(x=!0,T=n.some(K=>Ea(K)||Ir(K)),f=()=>n.map(K=>{if(Un(K))return K.value;if(Ea(K))return c(K);if(He(K))return l?l(K,2):K()})):He(n)?e?f=l?()=>l(n,2):n:f=()=>{if(m){Ps();try{m()}finally{Rs()}}const K=oo;oo=d;try{return l?l(n,3,[y]):n(y)}finally{oo=K}}:f=Or,e&&s){const K=f,X=s===!0?1/0:s;f=()=>_s(K(),X)}const P=px(),U=()=>{d.stop(),P&&P.active&&Bp(P.effects,d)};if(i&&e){const K=e;e=(...X)=>{K(...X),U()}}let j=x?new Array(n.length).fill($c):$c;const D=K=>{if(!(!(d.flags&1)||!d.dirty&&!K))if(e){const X=d.run();if(s||T||(x?X.some((de,S)=>vi(de,j[S])):vi(X,j))){m&&m();const de=oo;oo=d;try{const S=[X,j===$c?void 0:x&&j[0]===$c?[]:j,y];j=X,l?l(e,3,S):e(...S)}finally{oo=de}}}else d.run()};return a&&a(D),d=new d0(f),d.scheduler=o?()=>o(D,!1):D,y=K=>$x(K,!1,d),m=d.onStop=()=>{const K=bd.get(d);if(K){if(l)l(K,4);else for(const X of K)X();bd.delete(d)}},e?r?D(!0):j=d.run():o?o(D.bind(null,!0),!0):d.run(),U.pause=d.pause.bind(d),U.resume=d.resume.bind(d),U.stop=U,U}function _s(n,e=1/0,t){if(e<=0||!Rt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Un(n))_s(n.value,e,t);else if(Ue(n))for(let r=0;r<n.length;r++)_s(n[r],e,t);else if(Za(n)||Ia(n))n.forEach(r=>{_s(r,e,t)});else if(a0(n)){for(const r in n)_s(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&_s(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ku(n,e,t,r){try{return r?n(...r):n()}catch(s){sh(s,e,t)}}function ns(n,e,t,r){if(He(n)){const s=Ku(n,e,t,r);return s&&i0(s)&&s.catch(i=>{sh(i,e,t)}),s}if(Ue(n)){const s=[];for(let i=0;i<n.length;i++)s.push(ns(n[i],e,t,r));return s}}function sh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Tt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){Ps(),Ku(i,null,10,[n,l,c]),Rs();return}}jx(n,t,s,r,o)}function jx(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Jn=[];let Hr=-1;const Ta=[];let ii=null,pa=0;const R0=Promise.resolve();let wd=null;function dn(n){const e=wd||R0;return n?e.then(this?n.bind(this):n):e}function qx(n){let e=Hr+1,t=Jn.length;for(;e<t;){const r=e+t>>>1,s=Jn[r],i=gu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Zp(n){if(!(n.flags&1)){const e=gu(n),t=Jn[Jn.length-1];!t||!(n.flags&2)&&e>=gu(t)?Jn.push(n):Jn.splice(qx(e),0,n),n.flags|=1,C0()}}function C0(){wd||(wd=R0.then(D0))}function Bx(n){Ue(n)?Ta.push(...n):ii&&n.id===-1?ii.splice(pa+1,0,n):n.flags&1||(Ta.push(n),n.flags|=1),C0()}function lv(n,e,t=Hr+1){for(;t<Jn.length;t++){const r=Jn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Jn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function k0(n){if(Ta.length){const e=[...new Set(Ta)].sort((t,r)=>gu(t)-gu(r));if(Ta.length=0,ii){ii.push(...e);return}for(ii=e,pa=0;pa<ii.length;pa++){const t=ii[pa];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ii=null,pa=0}}const gu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function D0(n){const e=Or;try{for(Hr=0;Hr<Jn.length;Hr++){const t=Jn[Hr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Ku(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Hr<Jn.length;Hr++){const t=Jn[Hr];t&&(t.flags&=-2)}Hr=-1,Jn.length=0,k0(),wd=null,(Jn.length||Ta.length)&&D0()}}let hr=null,N0=null;function Id(n){const e=hr;return hr=n,N0=n&&n.type.__scopeId||null,e}function zx(n,e=hr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&bv(-1);const i=Id(e);let o;try{o=n(...s)}finally{Id(i),r._d&&bv(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function Ze(n,e){if(hr===null)return n;const t=lh(hr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Tt]=e[s];i&&(He(i)&&(i={mounted:i,updated:i}),i.deep&&_s(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function ro(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Ps(),ns(l,t,8,[n.el,a,n,e]),Rs())}}const V0=Symbol("_vte"),Kx=n=>n.__isTeleport,tu=n=>n&&(n.disabled||n.disabled===""),uv=n=>n&&(n.defer||n.defer===""),cv=n=>typeof SVGElement<"u"&&n instanceof SVGElement,dv=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Qf=(n,e)=>{const t=n&&n.to;return sn(t)?e?e(t):null:t},O0={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:d,pc:f,pbc:m,o:{insert:y,querySelector:T,createText:x,createComment:P}}=c,U=tu(e.props);let{shapeFlag:j,children:D,dynamicChildren:K}=e;if(n==null){const X=e.el=x(""),de=e.anchor=x("");y(X,t,r),y(de,t,r);const S=(w,C)=>{j&16&&(s&&s.isCE&&(s.ce._teleportTarget=w),d(D,w,C,s,i,o,a,l))},I=()=>{const w=e.target=Qf(e.props,T),C=M0(w,e,x,y);w&&(o!=="svg"&&cv(w)?o="svg":o!=="mathml"&&dv(w)&&(o="mathml"),U||(S(w,C),Xc(e,!1)))};U&&(S(t,de),Xc(e,!0)),uv(e.props)?(e.el.__isMounted=!1,Qn(()=>{I(),delete e.el.__isMounted},i)):I()}else{if(uv(e.props)&&n.el.__isMounted===!1){Qn(()=>{O0.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const X=e.anchor=n.anchor,de=e.target=n.target,S=e.targetAnchor=n.targetAnchor,I=tu(n.props),w=I?t:de,C=I?X:S;if(o==="svg"||cv(de)?o="svg":(o==="mathml"||dv(de))&&(o="mathml"),K?(m(n.dynamicChildren,K,w,s,i,o,a),sm(n,e,!0)):l||f(n,e,w,C,s,i,o,a,!1),U)I?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Uc(e,t,X,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const O=e.target=Qf(e.props,T);O&&Uc(e,O,null,c,0)}else I&&Uc(e,de,S,c,1);Xc(e,U)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:d,target:f,props:m}=n;if(f&&(s(c),s(d)),i&&s(l),o&16){const y=i||!tu(m);for(let T=0;T<a.length;T++){const x=a[T];r(x,e,t,y,!!x.dynamicChildren)}}},move:Uc,hydrate:Gx};function Uc(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:d}=n,f=i===2;if(f&&r(o,e,t),(!f||tu(d))&&l&16)for(let m=0;m<c.length;m++)s(c[m],e,t,2);f&&r(a,e,t)}function Gx(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:d}},f){const m=e.target=Qf(e.props,l);if(m){const y=tu(e.props),T=m._lpa||m.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=T,e.targetAnchor=T&&o(T);else{e.anchor=o(n);let x=T;for(;x;){if(x&&x.nodeType===8){if(x.data==="teleport start anchor")e.targetStart=x;else if(x.data==="teleport anchor"){e.targetAnchor=x,m._lpa=e.targetAnchor&&o(e.targetAnchor);break}}x=o(x)}e.targetAnchor||M0(m,e,d,c),f(T&&o(T),e,m,t,r,s,i)}Xc(e,y)}return e.anchor&&o(e.anchor)}const Hx=O0;function Xc(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function M0(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[V0]=i,n&&(r(s,n),r(i,n)),i}function em(n,e){n.shapeFlag&6&&n.component?(n.transition=e,em(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function L0(n,e){return He(n)?(()=>En({name:n.name},e,{setup:n}))():n}function F0(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function nu(n,e,t,r,s=!1){if(Ue(n)){n.forEach((T,x)=>nu(T,e&&(Ue(e)?e[x]:e),t,r,s));return}if(ru(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&nu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?lh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===Tt?a.refs={}:a.refs,f=a.setupState,m=pt(f),y=f===Tt?()=>!1:T=>mt(m,T);if(c!=null&&c!==l&&(sn(c)?(d[c]=null,y(c)&&(f[c]=null)):Un(c)&&(c.value=null)),He(l))Ku(l,a,12,[o,d]);else{const T=sn(l),x=Un(l);if(T||x){const P=()=>{if(n.f){const U=T?y(l)?f[l]:d[l]:l.value;s?Ue(U)&&Bp(U,i):Ue(U)?U.includes(i)||U.push(i):T?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else T?(d[l]=o,y(l)&&(f[l]=o)):x&&(l.value=o,n.k&&(d[n.k]=o))};o?(P.id=-1,Qn(P,t)):P()}}}th().requestIdleCallback;th().cancelIdleCallback;const ru=n=>!!n.type.__asyncLoader,$0=n=>n.type.__isKeepAlive;function Wx(n,e){U0(n,"a",e)}function Qx(n,e){U0(n,"da",e)}function U0(n,e,t=$n){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(ih(e,r,t),t){let s=t.parent;for(;s&&s.parent;)$0(s.parent.vnode)&&Jx(r,e,t,s),s=s.parent}}function Jx(n,e,t,r){const s=ih(e,n,r,!0);ba(()=>{Bp(r[e],s)},t)}function ih(n,e,t=$n,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Ps();const a=Gu(t),l=ns(e,t,n,o);return a(),Rs(),l});return r?s.unshift(i):s.push(i),i}}const Ms=n=>(e,t=$n)=>{(!yu||n==="sp")&&ih(n,(...r)=>e(...r),t)},Yx=Ms("bm"),sr=Ms("m"),Xx=Ms("bu"),Zx=Ms("u"),j0=Ms("bum"),ba=Ms("um"),eA=Ms("sp"),tA=Ms("rtg"),nA=Ms("rtc");function rA(n,e=$n){ih("ec",n,e)}const q0="components";function sA(n,e){return oA(q0,n,!0,e)||n}const iA=Symbol.for("v-ndc");function oA(n,e,t=!0,r=!1){const s=hr||$n;if(s){const i=s.type;if(n===q0){const a=GA(i,!1);if(a&&(a===e||a===Tr(e)||a===eh(Tr(e))))return i}const o=hv(s[n]||i[n],e)||hv(s.appContext[n],e);return!o&&r?i:o}}function hv(n,e){return n&&(n[e]||n[Tr(e)]||n[eh(Tr(e))])}function dr(n,e,t,r){let s;const i=t&&t[r],o=Ue(n);if(o||sn(n)){const a=o&&Ea(n);let l=!1,c=!1;a&&(l=!Ir(n),c=Ii(n),n=nh(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?_d(An(n[d])):An(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Rt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const Jf=n=>n?ob(n)?lh(n):Jf(n.parent):null,su=En(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Jf(n.parent),$root:n=>Jf(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>tm(n),$forceUpdate:n=>n.f||(n.f=()=>{Zp(n.update)}),$nextTick:n=>n.n||(n.n=dn.bind(n.proxy)),$watch:n=>SA.bind(n)}),hf=(n,e)=>n!==Tt&&!n.__isScriptSetup&&mt(n,e),aA={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(hf(r,e))return o[e]=1,r[e];if(s!==Tt&&mt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&mt(c,e))return o[e]=3,i[e];if(t!==Tt&&mt(t,e))return o[e]=4,t[e];Yf&&(o[e]=0)}}const d=su[e];let f,m;if(d)return e==="$attrs"&&Fn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Tt&&mt(t,e))return o[e]=4,t[e];if(m=l.config.globalProperties,mt(m,e))return m[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return hf(s,e)?(s[e]=t,!0):r!==Tt&&mt(r,e)?(r[e]=t,!0):mt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Tt&&mt(n,o)||hf(e,o)||(a=i[0])&&mt(a,o)||mt(r,o)||mt(su,o)||mt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:mt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function fv(n){return Ue(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let Yf=!0;function lA(n){const e=tm(n),t=n.proxy,r=n.ctx;Yf=!1,e.beforeCreate&&pv(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:m,beforeUpdate:y,updated:T,activated:x,deactivated:P,beforeDestroy:U,beforeUnmount:j,destroyed:D,unmounted:K,render:X,renderTracked:de,renderTriggered:S,errorCaptured:I,serverPrefetch:w,expose:C,inheritAttrs:O,components:q,directives:R,filters:It}=e;if(c&&uA(c,r,null),o)for(const Ee in o){const Fe=o[Ee];He(Fe)&&(r[Ee]=Fe.bind(t))}if(s){const Ee=s.call(t,t);Rt(Ee)&&(n.data=rh(Ee))}if(Yf=!0,i)for(const Ee in i){const Fe=i[Ee],Bt=He(Fe)?Fe.bind(t,t):He(Fe.get)?Fe.get.bind(t,t):Or,Wt=!He(Fe)&&He(Fe.set)?Fe.set.bind(t):Or,bt=qe({get:Bt,set:Wt});Object.defineProperty(r,Ee,{enumerable:!0,configurable:!0,get:()=>bt.value,set:pe=>bt.value=pe})}if(a)for(const Ee in a)B0(a[Ee],r,t,Ee);if(l){const Ee=He(l)?l.call(t):l;Reflect.ownKeys(Ee).forEach(Fe=>{Zc(Fe,Ee[Fe])})}d&&pv(d,n,"c");function ge(Ee,Fe){Ue(Fe)?Fe.forEach(Bt=>Ee(Bt.bind(t))):Fe&&Ee(Fe.bind(t))}if(ge(Yx,f),ge(sr,m),ge(Xx,y),ge(Zx,T),ge(Wx,x),ge(Qx,P),ge(rA,I),ge(nA,de),ge(tA,S),ge(j0,j),ge(ba,K),ge(eA,w),Ue(C))if(C.length){const Ee=n.exposed||(n.exposed={});C.forEach(Fe=>{Object.defineProperty(Ee,Fe,{get:()=>t[Fe],set:Bt=>t[Fe]=Bt})})}else n.exposed||(n.exposed={});X&&n.render===Or&&(n.render=X),O!=null&&(n.inheritAttrs=O),q&&(n.components=q),R&&(n.directives=R),w&&F0(n)}function uA(n,e,t=Or){Ue(n)&&(n=Xf(n));for(const r in n){const s=n[r];let i;Rt(s)?"default"in s?i=Lr(s.from||r,s.default,!0):i=Lr(s.from||r):i=Lr(s),Un(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function pv(n,e,t){ns(Ue(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function B0(n,e,t,r){let s=r.includes(".")?tb(t,r):()=>t[r];if(sn(n)){const i=e[n];He(i)&&Ot(s,i)}else if(He(n))Ot(s,n.bind(t));else if(Rt(n))if(Ue(n))n.forEach(i=>B0(i,e,t,r));else{const i=He(n.handler)?n.handler.bind(t):e[n.handler];He(i)&&Ot(s,i,n)}}function tm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>Ed(l,c,o,!0)),Ed(l,e,o)),Rt(e)&&i.set(e,l),l}function Ed(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&Ed(n,i,t,!0),s&&s.forEach(o=>Ed(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=cA[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const cA={data:mv,props:gv,emits:gv,methods:zl,computed:zl,beforeCreate:Wn,created:Wn,beforeMount:Wn,mounted:Wn,beforeUpdate:Wn,updated:Wn,beforeDestroy:Wn,beforeUnmount:Wn,destroyed:Wn,unmounted:Wn,activated:Wn,deactivated:Wn,errorCaptured:Wn,serverPrefetch:Wn,components:zl,directives:zl,watch:hA,provide:mv,inject:dA};function mv(n,e){return e?n?function(){return En(He(n)?n.call(this,this):n,He(e)?e.call(this,this):e)}:e:n}function dA(n,e){return zl(Xf(n),Xf(e))}function Xf(n){if(Ue(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Wn(n,e){return n?[...new Set([].concat(n,e))]:e}function zl(n,e){return n?En(Object.create(null),n,e):e}function gv(n,e){return n?Ue(n)&&Ue(e)?[...new Set([...n,...e])]:En(Object.create(null),fv(n),fv(e??{})):e}function hA(n,e){if(!n)return e;if(!e)return n;const t=En(Object.create(null),n);for(const r in e)t[r]=Wn(n[r],e[r]);return t}function z0(){return{app:null,config:{isNativeTag:tx,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let fA=0;function pA(n,e){return function(r,s=null){He(r)||(r=En({},r)),s!=null&&!Rt(s)&&(s=null);const i=z0(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:fA++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:WA,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&He(d.install)?(o.add(d),d.install(c,...f)):He(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,m){if(!l){const y=c._ceVNode||lt(r,s);return y.appContext=i,m===!0?m="svg":m===!1&&(m=void 0),f&&e?e(y,d):n(y,d,m),l=!0,c._container=d,d.__vue_app__=c,lh(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(ns(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=xa;xa=c;try{return d()}finally{xa=f}}};return c}}let xa=null;function Zc(n,e){if($n){let t=$n.provides;const r=$n.parent&&$n.parent.provides;r===t&&(t=$n.provides=Object.create(r)),t[n]=e}}function Lr(n,e,t=!1){const r=$n||hr;if(r||xa){let s=xa?xa._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&He(e)?e.call(r&&r.proxy):e}}const K0={},G0=()=>Object.create(K0),H0=n=>Object.getPrototypeOf(n)===K0;function mA(n,e,t,r=!1){const s={},i=G0();n.propsDefaults=Object.create(null),W0(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:x0(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function gA(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=pt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let m=d[f];if(oh(n.emitsOptions,m))continue;const y=e[m];if(l)if(mt(i,m))y!==i[m]&&(i[m]=y,c=!0);else{const T=Tr(m);s[T]=Zf(l,a,T,y,n,!1)}else y!==i[m]&&(i[m]=y,c=!0)}}}else{W0(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!mt(e,f)&&((d=Ni(f))===f||!mt(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=Zf(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!mt(e,f))&&(delete i[f],c=!0)}c&&ys(n.attrs,"set","")}function W0(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Xl(l))continue;const c=e[l];let d;s&&mt(s,d=Tr(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:oh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=pt(t),c=a||Tt;for(let d=0;d<i.length;d++){const f=i[d];t[f]=Zf(s,l,f,c[f],n,!mt(c,f))}}return o}function Zf(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=mt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&He(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=Gu(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Ni(t))&&(r=!0))}return r}const vA=new WeakMap;function Q0(n,e,t=!1){const r=t?vA:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!He(n)){const d=f=>{l=!0;const[m,y]=Q0(f,e,!0);En(o,m),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Rt(n)&&r.set(n,wa),wa;if(Ue(i))for(let d=0;d<i.length;d++){const f=Tr(i[d]);vv(f)&&(o[f]=Tt)}else if(i)for(const d in i){const f=Tr(d);if(vv(f)){const m=i[d],y=o[f]=Ue(m)||He(m)?{type:m}:En({},m),T=y.type;let x=!1,P=!0;if(Ue(T))for(let U=0;U<T.length;++U){const j=T[U],D=He(j)&&j.name;if(D==="Boolean"){x=!0;break}else D==="String"&&(P=!1)}else x=He(T)&&T.name==="Boolean";y[0]=x,y[1]=P,(x||mt(y,"default"))&&a.push(f)}}const c=[o,a];return Rt(n)&&r.set(n,c),c}function vv(n){return n[0]!=="$"&&!Xl(n)}const nm=n=>n[0]==="_"||n==="$stable",rm=n=>Ue(n)?n.map(Wr):[Wr(n)],yA=(n,e,t)=>{if(e._n)return e;const r=zx((...s)=>rm(e(...s)),t);return r._c=!1,r},J0=(n,e,t)=>{const r=n._ctx;for(const s in n){if(nm(s))continue;const i=n[s];if(He(i))e[s]=yA(s,i,r);else if(i!=null){const o=rm(i);e[s]=()=>o}}},Y0=(n,e)=>{const t=rm(e);n.slots.default=()=>t},X0=(n,e,t)=>{for(const r in e)(t||!nm(r))&&(n[r]=e[r])},_A=(n,e,t)=>{const r=n.slots=G0();if(n.vnode.shapeFlag&32){const s=e.__;s&&zf(r,"__",s,!0);const i=e._;i?(X0(r,e,t),t&&zf(r,"_",i,!0)):J0(e,r)}else e&&Y0(n,e)},bA=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Tt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:X0(s,e,t):(i=!e.$stable,J0(e,s)),o=e}else e&&(Y0(n,e),o={default:1});if(i)for(const a in s)!nm(a)&&o[a]==null&&delete s[a]},Qn=VA;function wA(n){return IA(n)}function IA(n,e){const t=th();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:m,setScopeId:y=Or,insertStaticContent:T}=n,x=(E,A,M,ee=null,Y=null,te=null,ye=void 0,he=null,fe=!!A.dynamicChildren)=>{if(E===A)return;E&&!Vl(E,A)&&(ee=k(E),pe(E,Y,te,!0),E=null),A.patchFlag===-2&&(fe=!1,A.dynamicChildren=null);const{type:ue,ref:xe,shapeFlag:Ie}=A;switch(ue){case ah:P(E,A,M,ee);break;case Ei:U(E,A,M,ee);break;case ed:E==null&&j(A,M,ee,ye);break;case gt:q(E,A,M,ee,Y,te,ye,he,fe);break;default:Ie&1?X(E,A,M,ee,Y,te,ye,he,fe):Ie&6?R(E,A,M,ee,Y,te,ye,he,fe):(Ie&64||Ie&128)&&ue.process(E,A,M,ee,Y,te,ye,he,fe,Z)}xe!=null&&Y?nu(xe,E&&E.ref,te,A||E,!A):xe==null&&E&&E.ref!=null&&nu(E.ref,null,te,E,!0)},P=(E,A,M,ee)=>{if(E==null)r(A.el=a(A.children),M,ee);else{const Y=A.el=E.el;A.children!==E.children&&c(Y,A.children)}},U=(E,A,M,ee)=>{E==null?r(A.el=l(A.children||""),M,ee):A.el=E.el},j=(E,A,M,ee)=>{[E.el,E.anchor]=T(E.children,A,M,ee,E.el,E.anchor)},D=({el:E,anchor:A},M,ee)=>{let Y;for(;E&&E!==A;)Y=m(E),r(E,M,ee),E=Y;r(A,M,ee)},K=({el:E,anchor:A})=>{let M;for(;E&&E!==A;)M=m(E),s(E),E=M;s(A)},X=(E,A,M,ee,Y,te,ye,he,fe)=>{A.type==="svg"?ye="svg":A.type==="math"&&(ye="mathml"),E==null?de(A,M,ee,Y,te,ye,he,fe):w(E,A,Y,te,ye,he,fe)},de=(E,A,M,ee,Y,te,ye,he)=>{let fe,ue;const{props:xe,shapeFlag:Ie,transition:Se,dirs:ke}=E;if(fe=E.el=o(E.type,te,xe&&xe.is,xe),Ie&8?d(fe,E.children):Ie&16&&I(E.children,fe,null,ee,Y,ff(E,te),ye,he),ke&&ro(E,null,ee,"created"),S(fe,E,E.scopeId,ye,ee),xe){for(const ze in xe)ze!=="value"&&!Xl(ze)&&i(fe,ze,null,xe[ze],te,ee);"value"in xe&&i(fe,"value",null,xe.value,te),(ue=xe.onVnodeBeforeMount)&&Gr(ue,ee,E)}ke&&ro(E,null,ee,"beforeMount");const Le=EA(Y,Se);Le&&Se.beforeEnter(fe),r(fe,A,M),((ue=xe&&xe.onVnodeMounted)||Le||ke)&&Qn(()=>{ue&&Gr(ue,ee,E),Le&&Se.enter(fe),ke&&ro(E,null,ee,"mounted")},Y)},S=(E,A,M,ee,Y)=>{if(M&&y(E,M),ee)for(let te=0;te<ee.length;te++)y(E,ee[te]);if(Y){let te=Y.subTree;if(A===te||rb(te.type)&&(te.ssContent===A||te.ssFallback===A)){const ye=Y.vnode;S(E,ye,ye.scopeId,ye.slotScopeIds,Y.parent)}}},I=(E,A,M,ee,Y,te,ye,he,fe=0)=>{for(let ue=fe;ue<E.length;ue++){const xe=E[ue]=he?oi(E[ue]):Wr(E[ue]);x(null,xe,A,M,ee,Y,te,ye,he)}},w=(E,A,M,ee,Y,te,ye)=>{const he=A.el=E.el;let{patchFlag:fe,dynamicChildren:ue,dirs:xe}=A;fe|=E.patchFlag&16;const Ie=E.props||Tt,Se=A.props||Tt;let ke;if(M&&so(M,!1),(ke=Se.onVnodeBeforeUpdate)&&Gr(ke,M,A,E),xe&&ro(A,E,M,"beforeUpdate"),M&&so(M,!0),(Ie.innerHTML&&Se.innerHTML==null||Ie.textContent&&Se.textContent==null)&&d(he,""),ue?C(E.dynamicChildren,ue,he,M,ee,ff(A,Y),te):ye||Fe(E,A,he,null,M,ee,ff(A,Y),te,!1),fe>0){if(fe&16)O(he,Ie,Se,M,Y);else if(fe&2&&Ie.class!==Se.class&&i(he,"class",null,Se.class,Y),fe&4&&i(he,"style",Ie.style,Se.style,Y),fe&8){const Le=A.dynamicProps;for(let ze=0;ze<Le.length;ze++){const Xe=Le[ze],Qt=Ie[Xe],$t=Se[Xe];($t!==Qt||Xe==="value")&&i(he,Xe,Qt,$t,Y,M)}}fe&1&&E.children!==A.children&&d(he,A.children)}else!ye&&ue==null&&O(he,Ie,Se,M,Y);((ke=Se.onVnodeUpdated)||xe)&&Qn(()=>{ke&&Gr(ke,M,A,E),xe&&ro(A,E,M,"updated")},ee)},C=(E,A,M,ee,Y,te,ye)=>{for(let he=0;he<A.length;he++){const fe=E[he],ue=A[he],xe=fe.el&&(fe.type===gt||!Vl(fe,ue)||fe.shapeFlag&198)?f(fe.el):M;x(fe,ue,xe,null,ee,Y,te,ye,!0)}},O=(E,A,M,ee,Y)=>{if(A!==M){if(A!==Tt)for(const te in A)!Xl(te)&&!(te in M)&&i(E,te,A[te],null,Y,ee);for(const te in M){if(Xl(te))continue;const ye=M[te],he=A[te];ye!==he&&te!=="value"&&i(E,te,he,ye,Y,ee)}"value"in M&&i(E,"value",A.value,M.value,Y)}},q=(E,A,M,ee,Y,te,ye,he,fe)=>{const ue=A.el=E?E.el:a(""),xe=A.anchor=E?E.anchor:a("");let{patchFlag:Ie,dynamicChildren:Se,slotScopeIds:ke}=A;ke&&(he=he?he.concat(ke):ke),E==null?(r(ue,M,ee),r(xe,M,ee),I(A.children||[],M,xe,Y,te,ye,he,fe)):Ie>0&&Ie&64&&Se&&E.dynamicChildren?(C(E.dynamicChildren,Se,M,Y,te,ye,he),(A.key!=null||Y&&A===Y.subTree)&&sm(E,A,!0)):Fe(E,A,M,xe,Y,te,ye,he,fe)},R=(E,A,M,ee,Y,te,ye,he,fe)=>{A.slotScopeIds=he,E==null?A.shapeFlag&512?Y.ctx.activate(A,M,ee,ye,fe):It(A,M,ee,Y,te,ye,fe):De(E,A,fe)},It=(E,A,M,ee,Y,te,ye)=>{const he=E.component=jA(E,ee,Y);if($0(E)&&(he.ctx.renderer=Z),qA(he,!1,ye),he.asyncDep){if(Y&&Y.registerDep(he,ge,ye),!E.el){const fe=he.subTree=lt(Ei);U(null,fe,A,M)}}else ge(he,E,A,M,Y,te,ye)},De=(E,A,M)=>{const ee=A.component=E.component;if(DA(E,A,M))if(ee.asyncDep&&!ee.asyncResolved){Ee(ee,A,M);return}else ee.next=A,ee.update();else A.el=E.el,ee.vnode=A},ge=(E,A,M,ee,Y,te,ye)=>{const he=()=>{if(E.isMounted){let{next:Ie,bu:Se,u:ke,parent:Le,vnode:ze}=E;{const kt=Z0(E);if(kt){Ie&&(Ie.el=ze.el,Ee(E,Ie,ye)),kt.asyncDep.then(()=>{E.isUnmounted||he()});return}}let Xe=Ie,Qt;so(E,!1),Ie?(Ie.el=ze.el,Ee(E,Ie,ye)):Ie=ze,Se&&Yc(Se),(Qt=Ie.props&&Ie.props.onVnodeBeforeUpdate)&&Gr(Qt,Le,Ie,ze),so(E,!0);const $t=pf(E),yn=E.subTree;E.subTree=$t,x(yn,$t,f(yn.el),k(yn),E,Y,te),Ie.el=$t.el,Xe===null&&NA(E,$t.el),ke&&Qn(ke,Y),(Qt=Ie.props&&Ie.props.onVnodeUpdated)&&Qn(()=>Gr(Qt,Le,Ie,ze),Y)}else{let Ie;const{el:Se,props:ke}=A,{bm:Le,m:ze,parent:Xe,root:Qt,type:$t}=E,yn=ru(A);if(so(E,!1),Le&&Yc(Le),!yn&&(Ie=ke&&ke.onVnodeBeforeMount)&&Gr(Ie,Xe,A),so(E,!0),Se&&$e){const kt=()=>{E.subTree=pf(E),$e(Se,E.subTree,E,Y,null)};yn&&$t.__asyncHydrate?$t.__asyncHydrate(Se,E,kt):kt()}else{Qt.ce&&Qt.ce._def.shadowRoot!==!1&&Qt.ce._injectChildStyle($t);const kt=E.subTree=pf(E);x(null,kt,M,ee,E,Y,te),A.el=kt.el}if(ze&&Qn(ze,Y),!yn&&(Ie=ke&&ke.onVnodeMounted)){const kt=A;Qn(()=>Gr(Ie,Xe,kt),Y)}(A.shapeFlag&256||Xe&&ru(Xe.vnode)&&Xe.vnode.shapeFlag&256)&&E.a&&Qn(E.a,Y),E.isMounted=!0,A=M=ee=null}};E.scope.on();const fe=E.effect=new d0(he);E.scope.off();const ue=E.update=fe.run.bind(fe),xe=E.job=fe.runIfDirty.bind(fe);xe.i=E,xe.id=E.uid,fe.scheduler=()=>Zp(xe),so(E,!0),ue()},Ee=(E,A,M)=>{A.component=E;const ee=E.vnode.props;E.vnode=A,E.next=null,gA(E,A.props,ee,M),bA(E,A.children,M),Ps(),lv(E),Rs()},Fe=(E,A,M,ee,Y,te,ye,he,fe=!1)=>{const ue=E&&E.children,xe=E?E.shapeFlag:0,Ie=A.children,{patchFlag:Se,shapeFlag:ke}=A;if(Se>0){if(Se&128){Wt(ue,Ie,M,ee,Y,te,ye,he,fe);return}else if(Se&256){Bt(ue,Ie,M,ee,Y,te,ye,he,fe);return}}ke&8?(xe&16&&ht(ue,Y,te),Ie!==ue&&d(M,Ie)):xe&16?ke&16?Wt(ue,Ie,M,ee,Y,te,ye,he,fe):ht(ue,Y,te,!0):(xe&8&&d(M,""),ke&16&&I(Ie,M,ee,Y,te,ye,he,fe))},Bt=(E,A,M,ee,Y,te,ye,he,fe)=>{E=E||wa,A=A||wa;const ue=E.length,xe=A.length,Ie=Math.min(ue,xe);let Se;for(Se=0;Se<Ie;Se++){const ke=A[Se]=fe?oi(A[Se]):Wr(A[Se]);x(E[Se],ke,M,null,Y,te,ye,he,fe)}ue>xe?ht(E,Y,te,!0,!1,Ie):I(A,M,ee,Y,te,ye,he,fe,Ie)},Wt=(E,A,M,ee,Y,te,ye,he,fe)=>{let ue=0;const xe=A.length;let Ie=E.length-1,Se=xe-1;for(;ue<=Ie&&ue<=Se;){const ke=E[ue],Le=A[ue]=fe?oi(A[ue]):Wr(A[ue]);if(Vl(ke,Le))x(ke,Le,M,null,Y,te,ye,he,fe);else break;ue++}for(;ue<=Ie&&ue<=Se;){const ke=E[Ie],Le=A[Se]=fe?oi(A[Se]):Wr(A[Se]);if(Vl(ke,Le))x(ke,Le,M,null,Y,te,ye,he,fe);else break;Ie--,Se--}if(ue>Ie){if(ue<=Se){const ke=Se+1,Le=ke<xe?A[ke].el:ee;for(;ue<=Se;)x(null,A[ue]=fe?oi(A[ue]):Wr(A[ue]),M,Le,Y,te,ye,he,fe),ue++}}else if(ue>Se)for(;ue<=Ie;)pe(E[ue],Y,te,!0),ue++;else{const ke=ue,Le=ue,ze=new Map;for(ue=Le;ue<=Se;ue++){const on=A[ue]=fe?oi(A[ue]):Wr(A[ue]);on.key!=null&&ze.set(on.key,ue)}let Xe,Qt=0;const $t=Se-Le+1;let yn=!1,kt=0;const mr=new Array($t);for(ue=0;ue<$t;ue++)mr[ue]=0;for(ue=ke;ue<=Ie;ue++){const on=E[ue];if(Qt>=$t){pe(on,Y,te,!0);continue}let Cn;if(on.key!=null)Cn=ze.get(on.key);else for(Xe=Le;Xe<=Se;Xe++)if(mr[Xe-Le]===0&&Vl(on,A[Xe])){Cn=Xe;break}Cn===void 0?pe(on,Y,te,!0):(mr[Cn-Le]=ue+1,Cn>=kt?kt=Cn:yn=!0,x(on,A[Cn],M,null,Y,te,ye,he,fe),Qt++)}const Ur=yn?TA(mr):wa;for(Xe=Ur.length-1,ue=$t-1;ue>=0;ue--){const on=Le+ue,Cn=A[on],ji=on+1<xe?A[on+1].el:ee;mr[ue]===0?x(null,Cn,M,ji,Y,te,ye,he,fe):yn&&(Xe<0||ue!==Ur[Xe]?bt(Cn,M,ji,2):Xe--)}}},bt=(E,A,M,ee,Y=null)=>{const{el:te,type:ye,transition:he,children:fe,shapeFlag:ue}=E;if(ue&6){bt(E.component.subTree,A,M,ee);return}if(ue&128){E.suspense.move(A,M,ee);return}if(ue&64){ye.move(E,A,M,Z);return}if(ye===gt){r(te,A,M);for(let Ie=0;Ie<fe.length;Ie++)bt(fe[Ie],A,M,ee);r(E.anchor,A,M);return}if(ye===ed){D(E,A,M);return}if(ee!==2&&ue&1&&he)if(ee===0)he.beforeEnter(te),r(te,A,M),Qn(()=>he.enter(te),Y);else{const{leave:Ie,delayLeave:Se,afterLeave:ke}=he,Le=()=>{E.ctx.isUnmounted?s(te):r(te,A,M)},ze=()=>{Ie(te,()=>{Le(),ke&&ke()})};Se?Se(te,Le,ze):ze()}else r(te,A,M)},pe=(E,A,M,ee=!1,Y=!1)=>{const{type:te,props:ye,ref:he,children:fe,dynamicChildren:ue,shapeFlag:xe,patchFlag:Ie,dirs:Se,cacheIndex:ke}=E;if(Ie===-2&&(Y=!1),he!=null&&(Ps(),nu(he,null,M,E,!0),Rs()),ke!=null&&(A.renderCache[ke]=void 0),xe&256){A.ctx.deactivate(E);return}const Le=xe&1&&Se,ze=!ru(E);let Xe;if(ze&&(Xe=ye&&ye.onVnodeBeforeUnmount)&&Gr(Xe,A,E),xe&6)st(E.component,M,ee);else{if(xe&128){E.suspense.unmount(M,ee);return}Le&&ro(E,null,A,"beforeUnmount"),xe&64?E.type.remove(E,A,M,Z,ee):ue&&!ue.hasOnce&&(te!==gt||Ie>0&&Ie&64)?ht(ue,A,M,!1,!0):(te===gt&&Ie&384||!Y&&xe&16)&&ht(fe,A,M),ee&&le(E)}(ze&&(Xe=ye&&ye.onVnodeUnmounted)||Le)&&Qn(()=>{Xe&&Gr(Xe,A,E),Le&&ro(E,null,A,"unmounted")},M)},le=E=>{const{type:A,el:M,anchor:ee,transition:Y}=E;if(A===gt){Ge(M,ee);return}if(A===ed){K(E);return}const te=()=>{s(M),Y&&!Y.persisted&&Y.afterLeave&&Y.afterLeave()};if(E.shapeFlag&1&&Y&&!Y.persisted){const{leave:ye,delayLeave:he}=Y,fe=()=>ye(M,te);he?he(E.el,te,fe):fe()}else te()},Ge=(E,A)=>{let M;for(;E!==A;)M=m(E),s(E),E=M;s(A)},st=(E,A,M)=>{const{bum:ee,scope:Y,job:te,subTree:ye,um:he,m:fe,a:ue,parent:xe,slots:{__:Ie}}=E;yv(fe),yv(ue),ee&&Yc(ee),xe&&Ue(Ie)&&Ie.forEach(Se=>{xe.renderCache[Se]=void 0}),Y.stop(),te&&(te.flags|=8,pe(ye,E,A,M)),he&&Qn(he,A),Qn(()=>{E.isUnmounted=!0},A),A&&A.pendingBranch&&!A.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===A.pendingId&&(A.deps--,A.deps===0&&A.resolve())},ht=(E,A,M,ee=!1,Y=!1,te=0)=>{for(let ye=te;ye<E.length;ye++)pe(E[ye],A,M,ee,Y)},k=E=>{if(E.shapeFlag&6)return k(E.component.subTree);if(E.shapeFlag&128)return E.suspense.next();const A=m(E.anchor||E.el),M=A&&A[V0];return M?m(M):A};let L=!1;const J=(E,A,M)=>{E==null?A._vnode&&pe(A._vnode,null,null,!0):x(A._vnode||null,E,A,null,null,null,M),A._vnode=E,L||(L=!0,lv(),k0(),L=!1)},Z={p:x,um:pe,m:bt,r:le,mt:It,mc:I,pc:Fe,pbc:C,n:k,o:n};let Ce,$e;return e&&([Ce,$e]=e(Z)),{render:J,hydrate:Ce,createApp:pA(J,Ce)}}function ff({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function so({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function EA(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function sm(n,e,t=!1){const r=n.children,s=e.children;if(Ue(r)&&Ue(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=oi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&sm(o,a)),a.type===ah&&(a.el=o.el),a.type===Ei&&!a.el&&(a.el=o.el)}}function TA(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Z0(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Z0(e)}function yv(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const xA=Symbol.for("v-scx"),AA=()=>Lr(xA);function Ot(n,e,t){return eb(n,e,t)}function eb(n,e,t=Tt){const{immediate:r,deep:s,flush:i,once:o}=t,a=En({},t),l=e&&r||!e&&i!=="post";let c;if(yu){if(i==="sync"){const y=AA();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=Or,y.resume=Or,y.pause=Or,y}}const d=$n;a.call=(y,T,x)=>ns(y,d,T,x);let f=!1;i==="post"?a.scheduler=y=>{Qn(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,T)=>{T?y():Zp(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const m=Ux(n,e,a);return yu&&(c?c.push(m):l&&m()),m}function SA(n,e,t){const r=this.proxy,s=sn(n)?n.includes(".")?tb(r,n):()=>r[n]:n.bind(r,r);let i;He(e)?i=e:(i=e.handler,t=e);const o=Gu(this),a=eb(s,i.bind(r),t);return o(),a}function tb(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const PA=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Tr(e)}Modifiers`]||n[`${Ni(e)}Modifiers`];function RA(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Tt;let s=t;const i=e.startsWith("update:"),o=i&&PA(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>sn(d)?d.trim():d)),o.number&&(s=t.map(yd)));let a,l=r[a=af(e)]||r[a=af(Tr(e))];!l&&i&&(l=r[a=af(Ni(e))]),l&&ns(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ns(c,n,6,s)}}function nb(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!He(n)){const l=c=>{const d=nb(c,e,!0);d&&(a=!0,En(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Rt(n)&&r.set(n,null),null):(Ue(i)?i.forEach(l=>o[l]=null):En(o,i),Rt(n)&&r.set(n,o),o)}function oh(n,e){return!n||!Xd(e)?!1:(e=e.slice(2).replace(/Once$/,""),mt(n,e[0].toLowerCase()+e.slice(1))||mt(n,Ni(e))||mt(n,e))}function pf(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:m,setupState:y,ctx:T,inheritAttrs:x}=n,P=Id(n);let U,j;try{if(t.shapeFlag&4){const K=s||r,X=K;U=Wr(c.call(X,K,d,f,y,m,T)),j=a}else{const K=e;U=Wr(K.length>1?K(f,{attrs:a,slots:o,emit:l}):K(f,null)),j=e.props?a:CA(a)}}catch(K){iu.length=0,sh(K,n,1),U=lt(Ei)}let D=U;if(j&&x!==!1){const K=Object.keys(j),{shapeFlag:X}=D;K.length&&X&7&&(i&&K.some(qp)&&(j=kA(j,i)),D=Da(D,j,!1,!0))}return t.dirs&&(D=Da(D,null,!1,!0),D.dirs=D.dirs?D.dirs.concat(t.dirs):t.dirs),t.transition&&em(D,t.transition),U=D,Id(P),U}const CA=n=>{let e;for(const t in n)(t==="class"||t==="style"||Xd(t))&&((e||(e={}))[t]=n[t]);return e},kA=(n,e)=>{const t={};for(const r in n)(!qp(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function DA(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?_v(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const m=d[f];if(o[m]!==r[m]&&!oh(c,m))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?_v(r,o,c):!0:!!o;return!1}function _v(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!oh(t,i))return!0}return!1}function NA({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const rb=n=>n.__isSuspense;function VA(n,e){e&&e.pendingBranch?Ue(n)?e.effects.push(...n):e.effects.push(n):Bx(n)}const gt=Symbol.for("v-fgt"),ah=Symbol.for("v-txt"),Ei=Symbol.for("v-cmt"),ed=Symbol.for("v-stc"),iu=[];let fr=null;function F(n=!1){iu.push(fr=n?null:[])}function OA(){iu.pop(),fr=iu[iu.length-1]||null}let vu=1;function bv(n,e=!1){vu+=n,n<0&&fr&&e&&(fr.hasOnce=!0)}function sb(n){return n.dynamicChildren=vu>0?fr||wa:null,OA(),vu>0&&fr&&fr.push(n),n}function $(n,e,t,r,s,i){return sb(h(n,e,t,r,s,i,!0))}function Td(n,e,t,r,s){return sb(lt(n,e,t,r,s,!0))}function xd(n){return n?n.__v_isVNode===!0:!1}function Vl(n,e){return n.type===e.type&&n.key===e.key}const ib=({key:n})=>n??null,td=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?sn(n)||Un(n)||He(n)?{i:hr,r:n,k:e,f:!!t}:n:null);function h(n,e=null,t=null,r=0,s=null,i=n===gt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&ib(e),ref:e&&td(e),scopeId:N0,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:hr};return a?(im(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=sn(t)?8:16),vu>0&&!o&&fr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&fr.push(l),l}const lt=MA;function MA(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===iA)&&(n=Ei),xd(n)){const a=Da(n,e,!0);return t&&im(a,t),vu>0&&!i&&fr&&(a.shapeFlag&6?fr[fr.indexOf(n)]=a:fr.push(a)),a.patchFlag=-2,a}if(HA(n)&&(n=n.__vccOpts),e){e=LA(e);let{class:a,style:l}=e;a&&!sn(a)&&(e.class=Kt(a)),Rt(l)&&(Xp(l)&&!Ue(l)&&(l=En({},l)),e.style=vs(l))}const o=sn(n)?1:rb(n)?128:Kx(n)?64:Rt(n)?4:He(n)?2:0;return h(n,e,t,r,s,o,i,!0)}function LA(n){return n?Xp(n)||H0(n)?En({},n):n:null}function Da(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?FA(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&ib(c),ref:e&&e.ref?t&&i?Ue(i)?i.concat(td(e)):[i,td(e)]:td(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==gt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Da(n.ssContent),ssFallback:n.ssFallback&&Da(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&em(d,l.clone(d)),d}function Sn(n=" ",e=0){return lt(ah,null,n,e)}function rr(n,e){const t=lt(ed,null,n);return t.staticCount=e,t}function ce(n="",e=!1){return e?(F(),Td(Ei,null,n)):lt(Ei,null,n)}function Wr(n){return n==null||typeof n=="boolean"?lt(Ei):Ue(n)?lt(gt,null,n.slice()):xd(n)?oi(n):lt(ah,null,String(n))}function oi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Da(n)}function im(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ue(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),im(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!H0(e)?e._ctx=hr:s===3&&hr&&(hr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else He(e)?(e={default:e,_ctx:hr},t=32):(e=String(e),r&64?(t=16,e=[Sn(e)]):t=8);n.children=e,n.shapeFlag|=t}function FA(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Kt([e.class,r.class]));else if(s==="style")e.style=vs([e.style,r.style]);else if(Xd(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ue(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Gr(n,e,t,r=null){ns(n,e,7,[t,r])}const $A=z0();let UA=0;function jA(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||$A,i={uid:UA++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new fx(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Q0(r,s),emitsOptions:nb(r,s),emit:null,emitted:null,propsDefaults:Tt,inheritAttrs:r.inheritAttrs,ctx:Tt,data:Tt,props:Tt,attrs:Tt,slots:Tt,refs:Tt,setupState:Tt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=RA.bind(null,i),n.ce&&n.ce(i),i}let $n=null,Ad,ep;{const n=th(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Ad=e("__VUE_INSTANCE_SETTERS__",t=>$n=t),ep=e("__VUE_SSR_SETTERS__",t=>yu=t)}const Gu=n=>{const e=$n;return Ad(n),n.scope.on(),()=>{n.scope.off(),Ad(e)}},wv=()=>{$n&&$n.scope.off(),Ad(null)};function ob(n){return n.vnode.shapeFlag&4}let yu=!1;function qA(n,e=!1,t=!1){e&&ep(e);const{props:r,children:s}=n.vnode,i=ob(n);mA(n,r,i,e),_A(n,s,t||e);const o=i?BA(n,e):void 0;return e&&ep(!1),o}function BA(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,aA);const{setup:r}=t;if(r){Ps();const s=n.setupContext=r.length>1?KA(n):null,i=Gu(n),o=Ku(r,n,0,[n.props,s]),a=i0(o);if(Rs(),i(),(a||n.sp)&&!ru(n)&&F0(n),a){if(o.then(wv,wv),e)return o.then(l=>{Iv(n,l,e)}).catch(l=>{sh(l,n,0)});n.asyncDep=o}else Iv(n,o,e)}else ab(n,e)}function Iv(n,e,t){He(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Rt(e)&&(n.setupState=P0(e)),ab(n,t)}let Ev;function ab(n,e,t){const r=n.type;if(!n.render){if(!e&&Ev&&!r.render){const s=r.template||tm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=En(En({isCustomElement:i,delimiters:a},o),l);r.render=Ev(s,c)}}n.render=r.render||Or}{const s=Gu(n);Ps();try{lA(n)}finally{Rs(),s()}}}const zA={get(n,e){return Fn(n,"get",""),n[e]}};function KA(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,zA),slots:n.slots,emit:n.emit,expose:e}}function lh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(P0(Nx(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in su)return su[t](n)},has(e,t){return t in e||t in su}})):n.proxy}function GA(n,e=!0){return He(n)?n.displayName||n.name:n.name||e&&n.__name}function HA(n){return He(n)&&"__vccOpts"in n}const qe=(n,e)=>Fx(n,e,yu);function lb(n,e,t){const r=arguments.length;return r===2?Rt(e)&&!Ue(e)?xd(e)?lt(n,null,[e]):lt(n,e):lt(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&xd(t)&&(t=[t]),lt(n,e,t))}const WA="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let tp;const Tv=typeof window<"u"&&window.trustedTypes;if(Tv)try{tp=Tv.createPolicy("vue",{createHTML:n=>n})}catch{}const ub=tp?n=>tp.createHTML(n):n=>n,QA="http://www.w3.org/2000/svg",JA="http://www.w3.org/1998/Math/MathML",ms=typeof document<"u"?document:null,xv=ms&&ms.createElement("template"),YA={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?ms.createElementNS(QA,n):e==="mathml"?ms.createElementNS(JA,n):t?ms.createElement(n,{is:t}):ms.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>ms.createTextNode(n),createComment:n=>ms.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>ms.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{xv.innerHTML=ub(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=xv.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},XA=Symbol("_vtc");function ZA(n,e,t){const r=n[XA];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Sd=Symbol("_vod"),cb=Symbol("_vsh"),mf={beforeMount(n,{value:e},{transition:t}){n[Sd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Ol(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Ol(n,!0),r.enter(n)):r.leave(n,()=>{Ol(n,!1)}):Ol(n,e))},beforeUnmount(n,{value:e}){Ol(n,e)}};function Ol(n,e){n.style.display=e?n[Sd]:"none",n[cb]=!e}const eS=Symbol(""),tS=/(^|;)\s*display\s*:/;function nS(n,e,t){const r=n.style,s=sn(t);let i=!1;if(t&&!s){if(e)if(sn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&nd(r,a,"")}else for(const o in e)t[o]==null&&nd(r,o,"");for(const o in t)o==="display"&&(i=!0),nd(r,o,t[o])}else if(s){if(e!==t){const o=r[eS];o&&(t+=";"+o),r.cssText=t,i=tS.test(t)}}else e&&n.removeAttribute("style");Sd in n&&(n[Sd]=i?r.display:"",n[cb]&&(r.display="none"))}const Av=/\s*!important$/;function nd(n,e,t){if(Ue(t))t.forEach(r=>nd(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=rS(n,e);Av.test(t)?n.setProperty(Ni(r),t.replace(Av,""),"important"):n[r]=t}}const Sv=["Webkit","Moz","ms"],gf={};function rS(n,e){const t=gf[e];if(t)return t;let r=Tr(e);if(r!=="filter"&&r in n)return gf[e]=r;r=eh(r);for(let s=0;s<Sv.length;s++){const i=Sv[s]+r;if(i in n)return gf[e]=i}return e}const Pv="http://www.w3.org/1999/xlink";function Rv(n,e,t,r,s,i=dx(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Pv,e.slice(6,e.length)):n.setAttributeNS(Pv,e,t):t==null||i&&!l0(t)?n.removeAttribute(e):n.setAttribute(e,i?"":ts(t)?String(t):t)}function Cv(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?ub(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=l0(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function li(n,e,t,r){n.addEventListener(e,t,r)}function sS(n,e,t,r){n.removeEventListener(e,t,r)}const kv=Symbol("_vei");function iS(n,e,t,r,s=null){const i=n[kv]||(n[kv]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=oS(e);if(r){const c=i[e]=uS(r,s);li(n,a,c,l)}else o&&(sS(n,a,o,l),i[e]=void 0)}}const Dv=/(?:Once|Passive|Capture)$/;function oS(n){let e;if(Dv.test(n)){e={};let r;for(;r=n.match(Dv);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Ni(n.slice(2)),e]}let vf=0;const aS=Promise.resolve(),lS=()=>vf||(aS.then(()=>vf=0),vf=Date.now());function uS(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ns(cS(r,t.value),e,5,[r])};return t.value=n,t.attached=lS(),t}function cS(n,e){if(Ue(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Nv=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,dS=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?ZA(n,r,o):e==="style"?nS(n,t,r):Xd(e)?qp(e)||iS(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):hS(n,e,r,o))?(Cv(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Rv(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!sn(r))?Cv(n,Tr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Rv(n,e,r,o))};function hS(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Nv(e)&&He(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Nv(e)&&sn(t)?!1:e in n}const Na=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ue(e)?t=>Yc(e,t):e};function fS(n){n.target.composing=!0}function Vv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const xs=Symbol("_assign"),St={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[xs]=Na(s);const i=r||s.props&&s.props.type==="number";li(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=yd(a)),n[xs](a)}),t&&li(n,"change",()=>{n.value=n.value.trim()}),e||(li(n,"compositionstart",fS),li(n,"compositionend",Vv),li(n,"change",Vv))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[xs]=Na(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?yd(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},bo={deep:!0,created(n,e,t){n[xs]=Na(t),li(n,"change",()=>{const r=n._modelValue,s=_u(n),i=n.checked,o=n[xs];if(Ue(r)){const a=Kp(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Za(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(db(n,i))})},mounted:Ov,beforeUpdate(n,e,t){n[xs]=Na(t),Ov(n,e,t)}};function Ov(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ue(e))s=Kp(e,r.props.value)>-1;else if(Za(e))s=e.has(r.props.value);else{if(e===t)return;s=zu(e,db(n,!0))}n.checked!==s&&(n.checked=s)}const pS={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Za(e);li(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?yd(_u(o)):_u(o));n[xs](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,dn(()=>{n._assigning=!1})}),n[xs]=Na(r)},mounted(n,{value:e}){Mv(n,e)},beforeUpdate(n,e,t){n[xs]=Na(t)},updated(n,{value:e}){n._assigning||Mv(n,e)}};function Mv(n,e){const t=n.multiple,r=Ue(e);if(!(t&&!r&&!Za(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=_u(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=Kp(e,a)>-1}else o.selected=e.has(a);else if(zu(_u(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function _u(n){return"_value"in n?n._value:n.value}function db(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const mS=["ctrl","shift","alt","meta"],gS={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>mS.some(t=>n[`${t}Key`]&&!e.includes(t))},Vt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=gS[e[o]];if(a&&a(s,e))return}return n(s,...i)})},vS={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Mn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Ni(s.key);if(e.some(o=>o===i||vS[o]===i))return n(s)})},yS=En({patchProp:dS},YA);let Lv;function _S(){return Lv||(Lv=wA(yS))}const bS=(...n)=>{const e=_S().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=IS(r);if(!s)return;const i=e._component;!He(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,wS(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function wS(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function IS(n){return sn(n)?document.querySelector(n):n}const ES={__name:"App",setup(n){const e=N(null),t=N(!1);function r(o){o.preventDefault(),e.value=o,t.value=!0}async function s(){e.value&&(e.value.prompt(),await e.value.userChoice,t.value=!1,e.value=null)}function i(){t.value=!1,e.value=null}return sr(()=>{window.addEventListener("beforeinstallprompt",r),window.addEventListener("appinstalled",i)}),j0(()=>{window.removeEventListener("beforeinstallprompt",r),window.removeEventListener("appinstalled",i)}),(o,a)=>{const l=sA("router-view");return F(),$(gt,null,[lt(l),t.value?(F(),$("button",{key:0,class:"fixed bottom-4 right-4 z-50 rounded-full bg-sky-600 text-white px-4 py-2 shadow-lg hover:bg-sky-700 active:bg-sky-800",onClick:s}," Installer l’app ")):ce("",!0)],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const ma=typeof document<"u";function hb(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function TS(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&hb(n.default)}const ft=Object.assign;function yf(n,e){const t={};for(const r in e){const s=e[r];t[r]=Fr(s)?s.map(n):n(s)}return t}const ou=()=>{},Fr=Array.isArray,fb=/#/g,xS=/&/g,AS=/\//g,SS=/=/g,PS=/\?/g,pb=/\+/g,RS=/%5B/g,CS=/%5D/g,mb=/%5E/g,kS=/%60/g,gb=/%7B/g,DS=/%7C/g,vb=/%7D/g,NS=/%20/g;function om(n){return encodeURI(""+n).replace(DS,"|").replace(RS,"[").replace(CS,"]")}function VS(n){return om(n).replace(gb,"{").replace(vb,"}").replace(mb,"^")}function np(n){return om(n).replace(pb,"%2B").replace(NS,"+").replace(fb,"%23").replace(xS,"%26").replace(kS,"`").replace(gb,"{").replace(vb,"}").replace(mb,"^")}function OS(n){return np(n).replace(SS,"%3D")}function MS(n){return om(n).replace(fb,"%23").replace(PS,"%3F")}function LS(n){return n==null?"":MS(n).replace(AS,"%2F")}function bu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const FS=/\/$/,$S=n=>n.replace(FS,"");function _f(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=BS(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:bu(o)}}function US(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Fv(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function jS(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Va(e.matched[r],t.matched[s])&&yb(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Va(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function yb(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!qS(n[t],e[t]))return!1;return!0}function qS(n,e){return Fr(n)?$v(n,e):Fr(e)?$v(e,n):n===e}function $v(n,e){return Fr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function BS(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const ti={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var wu;(function(n){n.pop="pop",n.push="push"})(wu||(wu={}));var au;(function(n){n.back="back",n.forward="forward",n.unknown=""})(au||(au={}));function zS(n){if(!n)if(ma){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),$S(n)}const KS=/^[^#]+#/;function GS(n,e){return n.replace(KS,"#")+e}function HS(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const uh=()=>({left:window.scrollX,top:window.scrollY});function WS(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=HS(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Uv(n,e){return(history.state?history.state.position-e:-1)+n}const rp=new Map;function QS(n,e){rp.set(n,e)}function JS(n){const e=rp.get(n);return rp.delete(n),e}let YS=()=>location.protocol+"//"+location.host;function _b(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Fv(l,"")}return Fv(t,n)+r+s}function XS(n,e,t,r){let s=[],i=[],o=null;const a=({state:m})=>{const y=_b(n,location),T=t.value,x=e.value;let P=0;if(m){if(t.value=y,e.value=m,o&&o===T){o=null;return}P=x?m.position-x.position:0}else r(y);s.forEach(U=>{U(t.value,T,{delta:P,type:wu.pop,direction:P?P>0?au.forward:au.back:au.unknown})})};function l(){o=t.value}function c(m){s.push(m);const y=()=>{const T=s.indexOf(m);T>-1&&s.splice(T,1)};return i.push(y),y}function d(){const{history:m}=window;m.state&&m.replaceState(ft({},m.state,{scroll:uh()}),"")}function f(){for(const m of i)m();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function jv(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?uh():null}}function ZS(n){const{history:e,location:t}=window,r={value:_b(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),m=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:YS()+n+l;try{e[d?"replaceState":"pushState"](c,"",m),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](m)}}function o(l,c){const d=ft({},e.state,jv(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=ft({},s.value,e.state,{forward:l,scroll:uh()});i(d.current,d,!0);const f=ft({},jv(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function eP(n){n=zS(n);const e=ZS(n),t=XS(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=ft({location:"",base:n,go:r,createHref:GS.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function tP(n){return typeof n=="string"||n&&typeof n=="object"}function bb(n){return typeof n=="string"||typeof n=="symbol"}const wb=Symbol("");var qv;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(qv||(qv={}));function Oa(n,e){return ft(new Error,{type:n,[wb]:!0},e)}function ps(n,e){return n instanceof Error&&wb in n&&(e==null||!!(n.type&e))}const Bv="[^/]+?",nP={sensitive:!1,strict:!1,start:!0,end:!0},rP=/[.+*?^${}()[\]/\\]/g;function sP(n,e){const t=ft({},nP,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const m=c[f];let y=40+(t.sensitive?.25:0);if(m.type===0)f||(s+="/"),s+=m.value.replace(rP,"\\$&"),y+=40;else if(m.type===1){const{value:T,repeatable:x,optional:P,regexp:U}=m;i.push({name:T,repeatable:x,optional:P});const j=U||Bv;if(j!==Bv){y+=10;try{new RegExp(`(${j})`)}catch(K){throw new Error(`Invalid custom RegExp for param "${T}" (${j}): `+K.message)}}let D=x?`((?:${j})(?:/(?:${j}))*)`:`(${j})`;f||(D=P&&c.length<2?`(?:/${D})`:"/"+D),P&&(D+="?"),s+=D,y+=20,P&&(y+=-8),x&&(y+=-20),j===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let m=1;m<d.length;m++){const y=d[m]||"",T=i[m-1];f[T.name]=y&&T.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const m of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of m)if(y.type===0)d+=y.value;else if(y.type===1){const{value:T,repeatable:x,optional:P}=y,U=T in c?c[T]:"";if(Fr(U)&&!x)throw new Error(`Provided param "${T}" is an array but it is not repeatable (* or + modifiers)`);const j=Fr(U)?U.join("/"):U;if(!j)if(P)m.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${T}"`);d+=j}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function iP(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function Ib(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=iP(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(zv(r))return 1;if(zv(s))return-1}return s.length-r.length}function zv(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const oP={type:0,value:""},aP=/[a-zA-Z0-9_]/;function lP(n){if(!n)return[[]];if(n==="/")return[[oP]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function m(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):m();break;case 4:m(),t=r;break;case 1:l==="("?t=2:aP.test(l)?m():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function uP(n,e,t){const r=sP(lP(n.path),t),s=ft(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function cP(n,e){const t=[],r=new Map;e=Wv({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,m,y){const T=!y,x=Gv(f);x.aliasOf=y&&y.record;const P=Wv(e,f),U=[x];if("alias"in f){const K=typeof f.alias=="string"?[f.alias]:f.alias;for(const X of K)U.push(Gv(ft({},x,{components:y?y.record.components:x.components,path:X,aliasOf:y?y.record:x})))}let j,D;for(const K of U){const{path:X}=K;if(m&&X[0]!=="/"){const de=m.record.path,S=de[de.length-1]==="/"?"":"/";K.path=m.record.path+(X&&S+X)}if(j=uP(K,m,P),y?y.alias.push(j):(D=D||j,D!==j&&D.alias.push(j),T&&f.name&&!Hv(j)&&o(f.name)),Eb(j)&&l(j),x.children){const de=x.children;for(let S=0;S<de.length;S++)i(de[S],j,y&&y.children[S])}y=y||j}return D?()=>{o(D)}:ou}function o(f){if(bb(f)){const m=r.get(f);m&&(r.delete(f),t.splice(t.indexOf(m),1),m.children.forEach(o),m.alias.forEach(o))}else{const m=t.indexOf(f);m>-1&&(t.splice(m,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const m=fP(f,t);t.splice(m,0,f),f.record.name&&!Hv(f)&&r.set(f.record.name,f)}function c(f,m){let y,T={},x,P;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Oa(1,{location:f});P=y.record.name,T=ft(Kv(m.params,y.keys.filter(D=>!D.optional).concat(y.parent?y.parent.keys.filter(D=>D.optional):[]).map(D=>D.name)),f.params&&Kv(f.params,y.keys.map(D=>D.name))),x=y.stringify(T)}else if(f.path!=null)x=f.path,y=t.find(D=>D.re.test(x)),y&&(T=y.parse(x),P=y.record.name);else{if(y=m.name?r.get(m.name):t.find(D=>D.re.test(m.path)),!y)throw Oa(1,{location:f,currentLocation:m});P=y.record.name,T=ft({},m.params,f.params),x=y.stringify(T)}const U=[];let j=y;for(;j;)U.unshift(j.record),j=j.parent;return{name:P,path:x,params:T,matched:U,meta:hP(U)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function Kv(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function Gv(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:dP(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function dP(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function Hv(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function hP(n){return n.reduce((e,t)=>ft(e,t.meta),{})}function Wv(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function fP(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;Ib(n,e[i])<0?r=i:t=i+1}const s=pP(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function pP(n){let e=n;for(;e=e.parent;)if(Eb(e)&&Ib(n,e)===0)return e}function Eb({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function mP(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(pb," "),o=i.indexOf("="),a=bu(o<0?i:i.slice(0,o)),l=o<0?null:bu(i.slice(o+1));if(a in e){let c=e[a];Fr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Qv(n){let e="";for(let t in n){const r=n[t];if(t=OS(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Fr(r)?r.map(i=>i&&np(i)):[r&&np(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function gP(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Fr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const vP=Symbol(""),Jv=Symbol(""),ch=Symbol(""),am=Symbol(""),sp=Symbol("");function Ml(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function ai(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=m=>{m===!1?l(Oa(4,{from:t,to:e})):m instanceof Error?l(m):tP(m)?l(Oa(2,{from:e,to:m})):(o&&r.enterCallbacks[s]===o&&typeof m=="function"&&o.push(m),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(m=>l(m))})}function bf(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(hb(l)){const d=(l.__vccOpts||l)[e];d&&i.push(ai(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=TS(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&ai(y,t,r,o,a,s)()}))}}return i}function Yv(n){const e=Lr(ch),t=Lr(am),r=qe(()=>{const l=Ts(n.to);return e.resolve(l)}),s=qe(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const m=f.findIndex(Va.bind(null,d));if(m>-1)return m;const y=Xv(l[c-2]);return c>1&&Xv(d)===y&&f[f.length-1].path!==y?f.findIndex(Va.bind(null,l[c-2])):m}),i=qe(()=>s.value>-1&&IP(t.params,r.value.params)),o=qe(()=>s.value>-1&&s.value===t.matched.length-1&&yb(t.params,r.value.params));function a(l={}){if(wP(l)){const c=e[Ts(n.replace)?"replace":"push"](Ts(n.to)).catch(ou);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:qe(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function yP(n){return n.length===1?n[0]:n}const _P=L0({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Yv,setup(n,{slots:e}){const t=rh(Yv(n)),{options:r}=Lr(ch),s=qe(()=>({[Zv(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Zv(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&yP(e.default(t));return n.custom?i:lb("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),bP=_P;function wP(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function IP(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Fr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function Xv(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Zv=(n,e,t)=>n??e??t,EP=L0({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Lr(sp),s=qe(()=>n.route||r.value),i=Lr(Jv,0),o=qe(()=>{let c=Ts(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=qe(()=>s.value.matched[o.value]);Zc(Jv,qe(()=>o.value+1)),Zc(vP,a),Zc(sp,s);const l=N();return Ot(()=>[l.value,a.value,n.name],([c,d,f],[m,y,T])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===m&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!Va(d,y)||!m)&&(d.enterCallbacks[f]||[]).forEach(x=>x(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,m=f&&f.components[d];if(!m)return ey(t.default,{Component:m,route:c});const y=f.props[d],T=y?y===!0?c.params:typeof y=="function"?y(c):y:null,P=lb(m,ft({},T,e,{onVnodeUnmounted:U=>{U.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return ey(t.default,{Component:P,route:c})||P}}});function ey(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const TP=EP;function xP(n){const e=cP(n.routes,n),t=n.parseQuery||mP,r=n.stringifyQuery||Qv,s=n.history,i=Ml(),o=Ml(),a=Ml(),l=Vx(ti);let c=ti;ma&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=yf.bind(null,k=>""+k),f=yf.bind(null,LS),m=yf.bind(null,bu);function y(k,L){let J,Z;return bb(k)?(J=e.getRecordMatcher(k),Z=L):Z=k,e.addRoute(Z,J)}function T(k){const L=e.getRecordMatcher(k);L&&e.removeRoute(L)}function x(){return e.getRoutes().map(k=>k.record)}function P(k){return!!e.getRecordMatcher(k)}function U(k,L){if(L=ft({},L||l.value),typeof k=="string"){const A=_f(t,k,L.path),M=e.resolve({path:A.path},L),ee=s.createHref(A.fullPath);return ft(A,M,{params:m(M.params),hash:bu(A.hash),redirectedFrom:void 0,href:ee})}let J;if(k.path!=null)J=ft({},k,{path:_f(t,k.path,L.path).path});else{const A=ft({},k.params);for(const M in A)A[M]==null&&delete A[M];J=ft({},k,{params:f(A)}),L.params=f(L.params)}const Z=e.resolve(J,L),Ce=k.hash||"";Z.params=d(m(Z.params));const $e=US(r,ft({},k,{hash:VS(Ce),path:Z.path})),E=s.createHref($e);return ft({fullPath:$e,hash:Ce,query:r===Qv?gP(k.query):k.query||{}},Z,{redirectedFrom:void 0,href:E})}function j(k){return typeof k=="string"?_f(t,k,l.value.path):ft({},k)}function D(k,L){if(c!==k)return Oa(8,{from:L,to:k})}function K(k){return S(k)}function X(k){return K(ft(j(k),{replace:!0}))}function de(k){const L=k.matched[k.matched.length-1];if(L&&L.redirect){const{redirect:J}=L;let Z=typeof J=="function"?J(k):J;return typeof Z=="string"&&(Z=Z.includes("?")||Z.includes("#")?Z=j(Z):{path:Z},Z.params={}),ft({query:k.query,hash:k.hash,params:Z.path!=null?{}:k.params},Z)}}function S(k,L){const J=c=U(k),Z=l.value,Ce=k.state,$e=k.force,E=k.replace===!0,A=de(J);if(A)return S(ft(j(A),{state:typeof A=="object"?ft({},Ce,A.state):Ce,force:$e,replace:E}),L||J);const M=J;M.redirectedFrom=L;let ee;return!$e&&jS(r,Z,J)&&(ee=Oa(16,{to:M,from:Z}),bt(Z,Z,!0,!1)),(ee?Promise.resolve(ee):C(M,Z)).catch(Y=>ps(Y)?ps(Y,2)?Y:Wt(Y):Fe(Y,M,Z)).then(Y=>{if(Y){if(ps(Y,2))return S(ft({replace:E},j(Y.to),{state:typeof Y.to=="object"?ft({},Ce,Y.to.state):Ce,force:$e}),L||M)}else Y=q(M,Z,!0,E,Ce);return O(M,Z,Y),Y})}function I(k,L){const J=D(k,L);return J?Promise.reject(J):Promise.resolve()}function w(k){const L=Ge.values().next().value;return L&&typeof L.runWithContext=="function"?L.runWithContext(k):k()}function C(k,L){let J;const[Z,Ce,$e]=AP(k,L);J=bf(Z.reverse(),"beforeRouteLeave",k,L);for(const A of Z)A.leaveGuards.forEach(M=>{J.push(ai(M,k,L))});const E=I.bind(null,k,L);return J.push(E),ht(J).then(()=>{J=[];for(const A of i.list())J.push(ai(A,k,L));return J.push(E),ht(J)}).then(()=>{J=bf(Ce,"beforeRouteUpdate",k,L);for(const A of Ce)A.updateGuards.forEach(M=>{J.push(ai(M,k,L))});return J.push(E),ht(J)}).then(()=>{J=[];for(const A of $e)if(A.beforeEnter)if(Fr(A.beforeEnter))for(const M of A.beforeEnter)J.push(ai(M,k,L));else J.push(ai(A.beforeEnter,k,L));return J.push(E),ht(J)}).then(()=>(k.matched.forEach(A=>A.enterCallbacks={}),J=bf($e,"beforeRouteEnter",k,L,w),J.push(E),ht(J))).then(()=>{J=[];for(const A of o.list())J.push(ai(A,k,L));return J.push(E),ht(J)}).catch(A=>ps(A,8)?A:Promise.reject(A))}function O(k,L,J){a.list().forEach(Z=>w(()=>Z(k,L,J)))}function q(k,L,J,Z,Ce){const $e=D(k,L);if($e)return $e;const E=L===ti,A=ma?history.state:{};J&&(Z||E?s.replace(k.fullPath,ft({scroll:E&&A&&A.scroll},Ce)):s.push(k.fullPath,Ce)),l.value=k,bt(k,L,J,E),Wt()}let R;function It(){R||(R=s.listen((k,L,J)=>{if(!st.listening)return;const Z=U(k),Ce=de(Z);if(Ce){S(ft(Ce,{replace:!0,force:!0}),Z).catch(ou);return}c=Z;const $e=l.value;ma&&QS(Uv($e.fullPath,J.delta),uh()),C(Z,$e).catch(E=>ps(E,12)?E:ps(E,2)?(S(ft(j(E.to),{force:!0}),Z).then(A=>{ps(A,20)&&!J.delta&&J.type===wu.pop&&s.go(-1,!1)}).catch(ou),Promise.reject()):(J.delta&&s.go(-J.delta,!1),Fe(E,Z,$e))).then(E=>{E=E||q(Z,$e,!1),E&&(J.delta&&!ps(E,8)?s.go(-J.delta,!1):J.type===wu.pop&&ps(E,20)&&s.go(-1,!1)),O(Z,$e,E)}).catch(ou)}))}let De=Ml(),ge=Ml(),Ee;function Fe(k,L,J){Wt(k);const Z=ge.list();return Z.length?Z.forEach(Ce=>Ce(k,L,J)):console.error(k),Promise.reject(k)}function Bt(){return Ee&&l.value!==ti?Promise.resolve():new Promise((k,L)=>{De.add([k,L])})}function Wt(k){return Ee||(Ee=!k,It(),De.list().forEach(([L,J])=>k?J(k):L()),De.reset()),k}function bt(k,L,J,Z){const{scrollBehavior:Ce}=n;if(!ma||!Ce)return Promise.resolve();const $e=!J&&JS(Uv(k.fullPath,0))||(Z||!J)&&history.state&&history.state.scroll||null;return dn().then(()=>Ce(k,L,$e)).then(E=>E&&WS(E)).catch(E=>Fe(E,k,L))}const pe=k=>s.go(k);let le;const Ge=new Set,st={currentRoute:l,listening:!0,addRoute:y,removeRoute:T,clearRoutes:e.clearRoutes,hasRoute:P,getRoutes:x,resolve:U,options:n,push:K,replace:X,go:pe,back:()=>pe(-1),forward:()=>pe(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:ge.add,isReady:Bt,install(k){const L=this;k.component("RouterLink",bP),k.component("RouterView",TP),k.config.globalProperties.$router=L,Object.defineProperty(k.config.globalProperties,"$route",{enumerable:!0,get:()=>Ts(l)}),ma&&!le&&l.value===ti&&(le=!0,K(s.location).catch(Ce=>{}));const J={};for(const Ce in ti)Object.defineProperty(J,Ce,{get:()=>l.value[Ce],enumerable:!0});k.provide(ch,L),k.provide(am,x0(J)),k.provide(sp,l);const Z=k.unmount;Ge.add(k),k.unmount=function(){Ge.delete(k),Ge.size<1&&(c=ti,R&&R(),R=null,l.value=ti,le=!1,Ee=!1),Z()}}};function ht(k){return k.reduce((L,J)=>L.then(()=>w(J)),Promise.resolve())}return st}function AP(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Va(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Va(c,l))||s.push(l))}return[t,r,s]}function Hu(){return Lr(ch)}function el(n){return Lr(am)}const SP="modulepreload",PP=function(n){return"/"+n},ty={},Jt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=PP(i),i in ty)return;ty[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":SP,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function RP(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function d(){if("serviceWorker"in navigator){const{Workbox:f}=await Jt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",m=>{(m.isUpdate||m.isExternal)&&window.location.reload()}),a.addEventListener("installed",m=>{m.isUpdate||r==null||r()}),a.register({immediate:e}).then(m=>{i?i("/service-worker.js",m):s==null||s(m)}).catch(m=>{o==null||o(m)})}}return l=d(),c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},CP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},xb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(m=64)),r.push(t[d],t[f],t[m],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Tb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):CP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new kP;const m=i<<2|a>>4;if(r.push(m),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const T=c<<6&192|f;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class kP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const DP=function(n){const e=Tb(n);return xb.encodeByteArray(e,!0)},Pd=function(n){return DP(n).replace(/\./g,"")},Ab=function(n){try{return xb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VP=()=>NP().__FIREBASE_DEFAULTS__,OP=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},MP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ab(n[1]);return e&&JSON.parse(e)},dh=()=>{try{return VP()||OP()||MP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Sb=n=>{var e,t;return(t=(e=dh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},LP=n=>{const e=Sb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Pb=()=>{var n;return(n=dh())===null||n===void 0?void 0:n.config},Rb=n=>{var e;return(e=dh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Pd(JSON.stringify(t)),Pd(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function UP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(gn())}function jP(){var n;const e=(n=dh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function qP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function BP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function zP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function KP(){const n=gn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Cb(){return!jP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function lm(){try{return typeof indexedDB=="object"}catch{return!1}}function kb(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function GP(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP="FirebaseError";class is extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=HP,Object.setPrototypeOf(this,is.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Lo.prototype.create)}}class Lo{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?WP(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new is(s,a,r)}}function WP(n,e){return n.replace(QP,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const QP=/\{\$([^}]+)}/g;function JP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ti(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(ny(i)&&ny(o)){if(!Ti(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function ny(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Kl(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Gl(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function YP(n,e){const t=new XP(n,e);return t.subscribe.bind(t)}class XP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");ZP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=wf),s.error===void 0&&(s.error=wf),s.complete===void 0&&(s.complete=wf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ZP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function wf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n){return n&&n._delegate?n._delegate:n}class $r{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ao="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new FP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(n1(e))try{this.getOrInitializeService({instanceIdentifier:ao})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ao){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ao){return this.instances.has(e)}getOptions(e=ao){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:t1(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ao){return this.component?this.component.multipleInstances?e:ao:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function t1(n){return n===ao?void 0:n}function n1(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r1{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new e1(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(tt||(tt={}));const s1={debug:tt.DEBUG,verbose:tt.VERBOSE,info:tt.INFO,warn:tt.WARN,error:tt.ERROR,silent:tt.SILENT},i1=tt.INFO,o1={[tt.DEBUG]:"log",[tt.VERBOSE]:"log",[tt.INFO]:"info",[tt.WARN]:"warn",[tt.ERROR]:"error"},a1=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=o1[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class um{constructor(e){this.name=e,this._logLevel=i1,this._logHandler=a1,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?s1[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tt.DEBUG,...e),this._logHandler(this,tt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tt.VERBOSE,...e),this._logHandler(this,tt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tt.INFO,...e),this._logHandler(this,tt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tt.WARN,...e),this._logHandler(this,tt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tt.ERROR,...e),this._logHandler(this,tt.ERROR,...e)}}const l1=(n,e)=>e.some(t=>n instanceof t);let ry,sy;function u1(){return ry||(ry=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c1(){return sy||(sy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Db=new WeakMap,ip=new WeakMap,Nb=new WeakMap,If=new WeakMap,cm=new WeakMap;function d1(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(As(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Db.set(t,n)}).catch(()=>{}),cm.set(e,n),e}function h1(n){if(ip.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});ip.set(n,e)}let op={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ip.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Nb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return As(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function f1(n){op=n(op)}function p1(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Ef(this),e,...t);return Nb.set(r,e.sort?e.sort():[e]),As(r)}:c1().includes(n)?function(...e){return n.apply(Ef(this),e),As(Db.get(this))}:function(...e){return As(n.apply(Ef(this),e))}}function m1(n){return typeof n=="function"?p1(n):(n instanceof IDBTransaction&&h1(n),l1(n,u1())?new Proxy(n,op):n)}function As(n){if(n instanceof IDBRequest)return d1(n);if(If.has(n))return If.get(n);const e=m1(n);return e!==n&&(If.set(n,e),cm.set(e,n)),e}const Ef=n=>cm.get(n);function hh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=As(o);return r&&o.addEventListener("upgradeneeded",l=>{r(As(o.result),l.oldVersion,l.newVersion,As(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Tf(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),As(t).then(()=>{})}const g1=["get","getKey","getAll","getAllKeys","count"],v1=["put","add","delete","clear"],xf=new Map;function iy(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(xf.get(e))return xf.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=v1.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||g1.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return xf.set(e,i),i}f1(n=>({...n,get:(e,t,r)=>iy(e,t)||n.get(e,t,r),has:(e,t)=>!!iy(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y1{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(_1(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function _1(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ap="@firebase/app",oy="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs=new um("@firebase/app"),b1="@firebase/app-compat",w1="@firebase/analytics-compat",I1="@firebase/analytics",E1="@firebase/app-check-compat",T1="@firebase/app-check",x1="@firebase/auth",A1="@firebase/auth-compat",S1="@firebase/database",P1="@firebase/data-connect",R1="@firebase/database-compat",C1="@firebase/functions",k1="@firebase/functions-compat",D1="@firebase/installations",N1="@firebase/installations-compat",V1="@firebase/messaging",O1="@firebase/messaging-compat",M1="@firebase/performance",L1="@firebase/performance-compat",F1="@firebase/remote-config",$1="@firebase/remote-config-compat",U1="@firebase/storage",j1="@firebase/storage-compat",q1="@firebase/firestore",B1="@firebase/vertexai-preview",z1="@firebase/firestore-compat",K1="firebase",G1="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rd="[DEFAULT]",H1={[ap]:"fire-core",[b1]:"fire-core-compat",[I1]:"fire-analytics",[w1]:"fire-analytics-compat",[T1]:"fire-app-check",[E1]:"fire-app-check-compat",[x1]:"fire-auth",[A1]:"fire-auth-compat",[S1]:"fire-rtdb",[P1]:"fire-data-connect",[R1]:"fire-rtdb-compat",[C1]:"fire-fn",[k1]:"fire-fn-compat",[D1]:"fire-iid",[N1]:"fire-iid-compat",[V1]:"fire-fcm",[O1]:"fire-fcm-compat",[M1]:"fire-perf",[L1]:"fire-perf-compat",[F1]:"fire-rc",[$1]:"fire-rc-compat",[U1]:"fire-gcs",[j1]:"fire-gcs-compat",[q1]:"fire-fst",[z1]:"fire-fst-compat",[B1]:"fire-vertex","fire-js":"fire-js",[K1]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cd=new Map,W1=new Map,lp=new Map;function ay(n,e){try{n.container.addComponent(e)}catch(t){Cs.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function rs(n){const e=n.name;if(lp.has(e))return Cs.debug(`There were multiple attempts to register component ${e}.`),!1;lp.set(e,n);for(const t of Cd.values())ay(t,n);for(const t of W1.values())ay(t,n);return!0}function Vi(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Q1(n,e,t=Rd){Vi(n,e).clearInstance(t)}function tn(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J1={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yi=new Lo("app","Firebase",J1);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new $r("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nl=G1;function Vb(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Rd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw yi.create("bad-app-name",{appName:String(s)});if(t||(t=Pb()),!t)throw yi.create("no-options");const i=Cd.get(s);if(i){if(Ti(t,i.options)&&Ti(r,i.config))return i;throw yi.create("duplicate-app",{appName:s})}const o=new r1(s);for(const l of lp.values())o.addComponent(l);const a=new Y1(t,r,o);return Cd.set(s,a),a}function dm(n=Rd){const e=Cd.get(n);if(!e&&n===Rd&&Pb())return Vb();if(!e)throw yi.create("no-app",{appName:n});return e}function Er(n,e,t){var r;let s=(r=H1[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Cs.warn(a.join(" "));return}rs(new $r(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X1="firebase-heartbeat-database",Z1=1,Iu="firebase-heartbeat-store";let Af=null;function Ob(){return Af||(Af=hh(X1,Z1,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Iu)}catch(t){console.warn(t)}}}}).catch(n=>{throw yi.create("idb-open",{originalErrorMessage:n.message})})),Af}async function eR(n){try{const t=(await Ob()).transaction(Iu),r=await t.objectStore(Iu).get(Mb(n));return await t.done,r}catch(e){if(e instanceof is)Cs.warn(e.message);else{const t=yi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Cs.warn(t.message)}}}async function ly(n,e){try{const r=(await Ob()).transaction(Iu,"readwrite");await r.objectStore(Iu).put(e,Mb(n)),await r.done}catch(t){if(t instanceof is)Cs.warn(t.message);else{const r=yi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Cs.warn(r.message)}}}function Mb(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tR=1024,nR=30*24*60*60*1e3;class rR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new iR(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=uy();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=nR}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Cs.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=uy(),{heartbeatsToSend:r,unsentEntries:s}=sR(this._heartbeatsCache.heartbeats),i=Pd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Cs.warn(t),""}}}function uy(){return new Date().toISOString().substring(0,10)}function sR(n,e=tR){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),cy(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),cy(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class iR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lm()?kb().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await eR(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ly(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ly(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function cy(n){return Pd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oR(n){rs(new $r("platform-logger",e=>new y1(e),"PRIVATE")),rs(new $r("heartbeat",e=>new rR(e),"PRIVATE")),Er(ap,oy,n),Er(ap,oy,"esm2017"),Er("fire-js","")}oR("");var aR="firebase",lR="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Er(aR,lR,"app");var dy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wo,Lb;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(S,I){function w(){}w.prototype=I.prototype,S.D=I.prototype,S.prototype=new w,S.prototype.constructor=S,S.C=function(C,O,q){for(var R=Array(arguments.length-2),It=2;It<arguments.length;It++)R[It-2]=arguments[It];return I.prototype[O].apply(C,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(S,I,w){w||(w=0);var C=Array(16);if(typeof I=="string")for(var O=0;16>O;++O)C[O]=I.charCodeAt(w++)|I.charCodeAt(w++)<<8|I.charCodeAt(w++)<<16|I.charCodeAt(w++)<<24;else for(O=0;16>O;++O)C[O]=I[w++]|I[w++]<<8|I[w++]<<16|I[w++]<<24;I=S.g[0],w=S.g[1],O=S.g[2];var q=S.g[3],R=I+(q^w&(O^q))+C[0]+3614090360&4294967295;I=w+(R<<7&4294967295|R>>>25),R=q+(O^I&(w^O))+C[1]+3905402710&4294967295,q=I+(R<<12&4294967295|R>>>20),R=O+(w^q&(I^w))+C[2]+606105819&4294967295,O=q+(R<<17&4294967295|R>>>15),R=w+(I^O&(q^I))+C[3]+3250441966&4294967295,w=O+(R<<22&4294967295|R>>>10),R=I+(q^w&(O^q))+C[4]+4118548399&4294967295,I=w+(R<<7&4294967295|R>>>25),R=q+(O^I&(w^O))+C[5]+1200080426&4294967295,q=I+(R<<12&4294967295|R>>>20),R=O+(w^q&(I^w))+C[6]+2821735955&4294967295,O=q+(R<<17&4294967295|R>>>15),R=w+(I^O&(q^I))+C[7]+4249261313&4294967295,w=O+(R<<22&4294967295|R>>>10),R=I+(q^w&(O^q))+C[8]+1770035416&4294967295,I=w+(R<<7&4294967295|R>>>25),R=q+(O^I&(w^O))+C[9]+2336552879&4294967295,q=I+(R<<12&4294967295|R>>>20),R=O+(w^q&(I^w))+C[10]+4294925233&4294967295,O=q+(R<<17&4294967295|R>>>15),R=w+(I^O&(q^I))+C[11]+2304563134&4294967295,w=O+(R<<22&4294967295|R>>>10),R=I+(q^w&(O^q))+C[12]+1804603682&4294967295,I=w+(R<<7&4294967295|R>>>25),R=q+(O^I&(w^O))+C[13]+4254626195&4294967295,q=I+(R<<12&4294967295|R>>>20),R=O+(w^q&(I^w))+C[14]+2792965006&4294967295,O=q+(R<<17&4294967295|R>>>15),R=w+(I^O&(q^I))+C[15]+1236535329&4294967295,w=O+(R<<22&4294967295|R>>>10),R=I+(O^q&(w^O))+C[1]+4129170786&4294967295,I=w+(R<<5&4294967295|R>>>27),R=q+(w^O&(I^w))+C[6]+3225465664&4294967295,q=I+(R<<9&4294967295|R>>>23),R=O+(I^w&(q^I))+C[11]+643717713&4294967295,O=q+(R<<14&4294967295|R>>>18),R=w+(q^I&(O^q))+C[0]+3921069994&4294967295,w=O+(R<<20&4294967295|R>>>12),R=I+(O^q&(w^O))+C[5]+3593408605&4294967295,I=w+(R<<5&4294967295|R>>>27),R=q+(w^O&(I^w))+C[10]+38016083&4294967295,q=I+(R<<9&4294967295|R>>>23),R=O+(I^w&(q^I))+C[15]+3634488961&4294967295,O=q+(R<<14&4294967295|R>>>18),R=w+(q^I&(O^q))+C[4]+3889429448&4294967295,w=O+(R<<20&4294967295|R>>>12),R=I+(O^q&(w^O))+C[9]+568446438&4294967295,I=w+(R<<5&4294967295|R>>>27),R=q+(w^O&(I^w))+C[14]+3275163606&4294967295,q=I+(R<<9&4294967295|R>>>23),R=O+(I^w&(q^I))+C[3]+4107603335&4294967295,O=q+(R<<14&4294967295|R>>>18),R=w+(q^I&(O^q))+C[8]+1163531501&4294967295,w=O+(R<<20&4294967295|R>>>12),R=I+(O^q&(w^O))+C[13]+2850285829&4294967295,I=w+(R<<5&4294967295|R>>>27),R=q+(w^O&(I^w))+C[2]+4243563512&4294967295,q=I+(R<<9&4294967295|R>>>23),R=O+(I^w&(q^I))+C[7]+1735328473&4294967295,O=q+(R<<14&4294967295|R>>>18),R=w+(q^I&(O^q))+C[12]+2368359562&4294967295,w=O+(R<<20&4294967295|R>>>12),R=I+(w^O^q)+C[5]+4294588738&4294967295,I=w+(R<<4&4294967295|R>>>28),R=q+(I^w^O)+C[8]+2272392833&4294967295,q=I+(R<<11&4294967295|R>>>21),R=O+(q^I^w)+C[11]+1839030562&4294967295,O=q+(R<<16&4294967295|R>>>16),R=w+(O^q^I)+C[14]+4259657740&4294967295,w=O+(R<<23&4294967295|R>>>9),R=I+(w^O^q)+C[1]+2763975236&4294967295,I=w+(R<<4&4294967295|R>>>28),R=q+(I^w^O)+C[4]+1272893353&4294967295,q=I+(R<<11&4294967295|R>>>21),R=O+(q^I^w)+C[7]+4139469664&4294967295,O=q+(R<<16&4294967295|R>>>16),R=w+(O^q^I)+C[10]+3200236656&4294967295,w=O+(R<<23&4294967295|R>>>9),R=I+(w^O^q)+C[13]+681279174&4294967295,I=w+(R<<4&4294967295|R>>>28),R=q+(I^w^O)+C[0]+3936430074&4294967295,q=I+(R<<11&4294967295|R>>>21),R=O+(q^I^w)+C[3]+3572445317&4294967295,O=q+(R<<16&4294967295|R>>>16),R=w+(O^q^I)+C[6]+76029189&4294967295,w=O+(R<<23&4294967295|R>>>9),R=I+(w^O^q)+C[9]+3654602809&4294967295,I=w+(R<<4&4294967295|R>>>28),R=q+(I^w^O)+C[12]+3873151461&4294967295,q=I+(R<<11&4294967295|R>>>21),R=O+(q^I^w)+C[15]+530742520&4294967295,O=q+(R<<16&4294967295|R>>>16),R=w+(O^q^I)+C[2]+3299628645&4294967295,w=O+(R<<23&4294967295|R>>>9),R=I+(O^(w|~q))+C[0]+4096336452&4294967295,I=w+(R<<6&4294967295|R>>>26),R=q+(w^(I|~O))+C[7]+1126891415&4294967295,q=I+(R<<10&4294967295|R>>>22),R=O+(I^(q|~w))+C[14]+2878612391&4294967295,O=q+(R<<15&4294967295|R>>>17),R=w+(q^(O|~I))+C[5]+4237533241&4294967295,w=O+(R<<21&4294967295|R>>>11),R=I+(O^(w|~q))+C[12]+1700485571&4294967295,I=w+(R<<6&4294967295|R>>>26),R=q+(w^(I|~O))+C[3]+2399980690&4294967295,q=I+(R<<10&4294967295|R>>>22),R=O+(I^(q|~w))+C[10]+4293915773&4294967295,O=q+(R<<15&4294967295|R>>>17),R=w+(q^(O|~I))+C[1]+2240044497&4294967295,w=O+(R<<21&4294967295|R>>>11),R=I+(O^(w|~q))+C[8]+1873313359&4294967295,I=w+(R<<6&4294967295|R>>>26),R=q+(w^(I|~O))+C[15]+4264355552&4294967295,q=I+(R<<10&4294967295|R>>>22),R=O+(I^(q|~w))+C[6]+2734768916&4294967295,O=q+(R<<15&4294967295|R>>>17),R=w+(q^(O|~I))+C[13]+1309151649&4294967295,w=O+(R<<21&4294967295|R>>>11),R=I+(O^(w|~q))+C[4]+4149444226&4294967295,I=w+(R<<6&4294967295|R>>>26),R=q+(w^(I|~O))+C[11]+3174756917&4294967295,q=I+(R<<10&4294967295|R>>>22),R=O+(I^(q|~w))+C[2]+718787259&4294967295,O=q+(R<<15&4294967295|R>>>17),R=w+(q^(O|~I))+C[9]+3951481745&4294967295,S.g[0]=S.g[0]+I&4294967295,S.g[1]=S.g[1]+(O+(R<<21&4294967295|R>>>11))&4294967295,S.g[2]=S.g[2]+O&4294967295,S.g[3]=S.g[3]+q&4294967295}r.prototype.u=function(S,I){I===void 0&&(I=S.length);for(var w=I-this.blockSize,C=this.B,O=this.h,q=0;q<I;){if(O==0)for(;q<=w;)s(this,S,q),q+=this.blockSize;if(typeof S=="string"){for(;q<I;)if(C[O++]=S.charCodeAt(q++),O==this.blockSize){s(this,C),O=0;break}}else for(;q<I;)if(C[O++]=S[q++],O==this.blockSize){s(this,C),O=0;break}}this.h=O,this.o+=I},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var I=1;I<S.length-8;++I)S[I]=0;var w=8*this.o;for(I=S.length-8;I<S.length;++I)S[I]=w&255,w/=256;for(this.u(S),S=Array(16),I=w=0;4>I;++I)for(var C=0;32>C;C+=8)S[w++]=this.g[I]>>>C&255;return S};function i(S,I){var w=a;return Object.prototype.hasOwnProperty.call(w,S)?w[S]:w[S]=I(S)}function o(S,I){this.h=I;for(var w=[],C=!0,O=S.length-1;0<=O;O--){var q=S[O]|0;C&&q==I||(w[O]=q,C=!1)}this.g=w}var a={};function l(S){return-128<=S&&128>S?i(S,function(I){return new o([I|0],0>I?-1:0)}):new o([S|0],0>S?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return f;if(0>S)return P(c(-S));for(var I=[],w=1,C=0;S>=w;C++)I[C]=S/w|0,w*=4294967296;return new o(I,0)}function d(S,I){if(S.length==0)throw Error("number format error: empty string");if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(S.charAt(0)=="-")return P(d(S.substring(1),I));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=c(Math.pow(I,8)),C=f,O=0;O<S.length;O+=8){var q=Math.min(8,S.length-O),R=parseInt(S.substring(O,O+q),I);8>q?(q=c(Math.pow(I,q)),C=C.j(q).add(c(R))):(C=C.j(w),C=C.add(c(R)))}return C}var f=l(0),m=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(x(this))return-P(this).m();for(var S=0,I=1,w=0;w<this.g.length;w++){var C=this.i(w);S+=(0<=C?C:4294967296+C)*I,I*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(T(this))return"0";if(x(this))return"-"+P(this).toString(S);for(var I=c(Math.pow(S,6)),w=this,C="";;){var O=K(w,I).g;w=U(w,O.j(I));var q=((0<w.g.length?w.g[0]:w.h)>>>0).toString(S);if(w=O,T(w))return q+C;for(;6>q.length;)q="0"+q;C=q+C}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function T(S){if(S.h!=0)return!1;for(var I=0;I<S.g.length;I++)if(S.g[I]!=0)return!1;return!0}function x(S){return S.h==-1}n.l=function(S){return S=U(this,S),x(S)?-1:T(S)?0:1};function P(S){for(var I=S.g.length,w=[],C=0;C<I;C++)w[C]=~S.g[C];return new o(w,~S.h).add(m)}n.abs=function(){return x(this)?P(this):this},n.add=function(S){for(var I=Math.max(this.g.length,S.g.length),w=[],C=0,O=0;O<=I;O++){var q=C+(this.i(O)&65535)+(S.i(O)&65535),R=(q>>>16)+(this.i(O)>>>16)+(S.i(O)>>>16);C=R>>>16,q&=65535,R&=65535,w[O]=R<<16|q}return new o(w,w[w.length-1]&-2147483648?-1:0)};function U(S,I){return S.add(P(I))}n.j=function(S){if(T(this)||T(S))return f;if(x(this))return x(S)?P(this).j(P(S)):P(P(this).j(S));if(x(S))return P(this.j(P(S)));if(0>this.l(y)&&0>S.l(y))return c(this.m()*S.m());for(var I=this.g.length+S.g.length,w=[],C=0;C<2*I;C++)w[C]=0;for(C=0;C<this.g.length;C++)for(var O=0;O<S.g.length;O++){var q=this.i(C)>>>16,R=this.i(C)&65535,It=S.i(O)>>>16,De=S.i(O)&65535;w[2*C+2*O]+=R*De,j(w,2*C+2*O),w[2*C+2*O+1]+=q*De,j(w,2*C+2*O+1),w[2*C+2*O+1]+=R*It,j(w,2*C+2*O+1),w[2*C+2*O+2]+=q*It,j(w,2*C+2*O+2)}for(C=0;C<I;C++)w[C]=w[2*C+1]<<16|w[2*C];for(C=I;C<2*I;C++)w[C]=0;return new o(w,0)};function j(S,I){for(;(S[I]&65535)!=S[I];)S[I+1]+=S[I]>>>16,S[I]&=65535,I++}function D(S,I){this.g=S,this.h=I}function K(S,I){if(T(I))throw Error("division by zero");if(T(S))return new D(f,f);if(x(S))return I=K(P(S),I),new D(P(I.g),P(I.h));if(x(I))return I=K(S,P(I)),new D(P(I.g),I.h);if(30<S.g.length){if(x(S)||x(I))throw Error("slowDivide_ only works with positive integers.");for(var w=m,C=I;0>=C.l(S);)w=X(w),C=X(C);var O=de(w,1),q=de(C,1);for(C=de(C,2),w=de(w,2);!T(C);){var R=q.add(C);0>=R.l(S)&&(O=O.add(w),q=R),C=de(C,1),w=de(w,1)}return I=U(S,O.j(I)),new D(O,I)}for(O=f;0<=S.l(I);){for(w=Math.max(1,Math.floor(S.m()/I.m())),C=Math.ceil(Math.log(w)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),q=c(w),R=q.j(I);x(R)||0<R.l(S);)w-=C,q=c(w),R=q.j(I);T(q)&&(q=m),O=O.add(q),S=U(S,R)}return new D(O,S)}n.A=function(S){return K(this,S).h},n.and=function(S){for(var I=Math.max(this.g.length,S.g.length),w=[],C=0;C<I;C++)w[C]=this.i(C)&S.i(C);return new o(w,this.h&S.h)},n.or=function(S){for(var I=Math.max(this.g.length,S.g.length),w=[],C=0;C<I;C++)w[C]=this.i(C)|S.i(C);return new o(w,this.h|S.h)},n.xor=function(S){for(var I=Math.max(this.g.length,S.g.length),w=[],C=0;C<I;C++)w[C]=this.i(C)^S.i(C);return new o(w,this.h^S.h)};function X(S){for(var I=S.g.length+1,w=[],C=0;C<I;C++)w[C]=S.i(C)<<1|S.i(C-1)>>>31;return new o(w,S.h)}function de(S,I){var w=I>>5;I%=32;for(var C=S.g.length-w,O=[],q=0;q<C;q++)O[q]=0<I?S.i(q+w)>>>I|S.i(q+w+1)<<32-I:S.i(q+w);return new o(O,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Lb=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,wo=o}).apply(typeof dy<"u"?dy:typeof self<"u"?self:typeof window<"u"?window:{});var jc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Fb,Hl,$b,rd,up,Ub,jb,qb;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof jc=="object"&&jc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var B=u[b];if(!(B in v))break e;v=v[B]}u=u[u.length-1],b=v[u],p=p(b),p!=b&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,b=!1,B={next:function(){if(!b&&v<u.length){var H=v++;return{value:p(H,u[H]),done:!1}}return b=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function d(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,b),u.apply(p,B)}}return function(){return u.apply(p,arguments)}}function m(u,p,v){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var b=v.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function T(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(b,B,H){for(var be=Array(arguments.length-2),yt=2;yt<arguments.length;yt++)be[yt-2]=arguments[yt];return p.prototype[B].apply(b,be)}}function x(u){const p=u.length;if(0<p){const v=Array(p);for(let b=0;b<p;b++)v[b]=u[b];return v}return[]}function P(u,p){for(let v=1;v<arguments.length;v++){const b=arguments[v];if(l(b)){const B=u.length||0,H=b.length||0;u.length=B+H;for(let be=0;be<H;be++)u[B+be]=b[be]}else u.push(b)}}class U{constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function j(u){return/^[\s\xa0]*$/.test(u)}function D(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function K(u){return K[" "](u),u}K[" "]=function(){};var X=D().indexOf("Gecko")!=-1&&!(D().toLowerCase().indexOf("webkit")!=-1&&D().indexOf("Edge")==-1)&&!(D().indexOf("Trident")!=-1||D().indexOf("MSIE")!=-1)&&D().indexOf("Edge")==-1;function de(u,p,v){for(const b in u)p.call(v,u[b],b,u)}function S(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function I(u){const p={};for(const v in u)p[v]=u[v];return p}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,p){let v,b;for(let B=1;B<arguments.length;B++){b=arguments[B];for(v in b)u[v]=b[v];for(let H=0;H<w.length;H++)v=w[H],Object.prototype.hasOwnProperty.call(b,v)&&(u[v]=b[v])}}function O(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function q(u){a.setTimeout(()=>{throw u},0)}function R(){var u=Bt;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class It{constructor(){this.h=this.g=null}add(p,v){const b=De.get();b.set(p,v),this.h?this.h.next=b:this.g=b,this.h=b}}var De=new U(()=>new ge,u=>u.reset());class ge{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,Fe=!1,Bt=new It,Wt=()=>{const u=a.Promise.resolve(void 0);Ee=()=>{u.then(bt)}};var bt=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(v){q(v)}var p=De;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Fe=!1};function pe(){this.s=this.s,this.C=this.C}pe.prototype.s=!1,pe.prototype.ma=function(){this.s||(this.s=!0,this.N())},pe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function le(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}le.prototype.h=function(){this.defaultPrevented=!0};var Ge=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function st(u,p){if(le.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(X){e:{try{K(p.nodeName);var B=!0;break e}catch{}B=!1}B||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:ht[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&st.aa.h.call(this)}}T(st,le);var ht={2:"touch",3:"pen",4:"mouse"};st.prototype.h=function(){st.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var k="closure_listenable_"+(1e6*Math.random()|0),L=0;function J(u,p,v,b,B){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!b,this.ha=B,this.key=++L,this.da=this.fa=!1}function Z(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Ce(u){this.src=u,this.g={},this.h=0}Ce.prototype.add=function(u,p,v,b,B){var H=u.toString();u=this.g[H],u||(u=this.g[H]=[],this.h++);var be=E(u,p,b,B);return-1<be?(p=u[be],v||(p.fa=!1)):(p=new J(p,this.src,H,!!b,B),p.fa=v,u.push(p)),p};function $e(u,p){var v=p.type;if(v in u.g){var b=u.g[v],B=Array.prototype.indexOf.call(b,p,void 0),H;(H=0<=B)&&Array.prototype.splice.call(b,B,1),H&&(Z(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function E(u,p,v,b){for(var B=0;B<u.length;++B){var H=u[B];if(!H.da&&H.listener==p&&H.capture==!!v&&H.ha==b)return B}return-1}var A="closure_lm_"+(1e6*Math.random()|0),M={};function ee(u,p,v,b,B){if(b&&b.once)return ye(u,p,v,b,B);if(Array.isArray(p)){for(var H=0;H<p.length;H++)ee(u,p[H],v,b,B);return null}return v=ke(v),u&&u[k]?u.K(p,v,c(b)?!!b.capture:!!b,B):Y(u,p,v,!1,b,B)}function Y(u,p,v,b,B,H){if(!p)throw Error("Invalid event type");var be=c(B)?!!B.capture:!!B,yt=Ie(u);if(yt||(u[A]=yt=new Ce(u)),v=yt.add(p,v,b,be,H),v.proxy)return v;if(b=te(),v.proxy=b,b.src=u,b.listener=v,u.addEventListener)Ge||(B=be),B===void 0&&(B=!1),u.addEventListener(p.toString(),b,B);else if(u.attachEvent)u.attachEvent(ue(p.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return v}function te(){function u(v){return p.call(u.src,u.listener,v)}const p=xe;return u}function ye(u,p,v,b,B){if(Array.isArray(p)){for(var H=0;H<p.length;H++)ye(u,p[H],v,b,B);return null}return v=ke(v),u&&u[k]?u.L(p,v,c(b)?!!b.capture:!!b,B):Y(u,p,v,!0,b,B)}function he(u,p,v,b,B){if(Array.isArray(p))for(var H=0;H<p.length;H++)he(u,p[H],v,b,B);else b=c(b)?!!b.capture:!!b,v=ke(v),u&&u[k]?(u=u.i,p=String(p).toString(),p in u.g&&(H=u.g[p],v=E(H,v,b,B),-1<v&&(Z(H[v]),Array.prototype.splice.call(H,v,1),H.length==0&&(delete u.g[p],u.h--)))):u&&(u=Ie(u))&&(p=u.g[p.toString()],u=-1,p&&(u=E(p,v,b,B)),(v=-1<u?p[u]:null)&&fe(v))}function fe(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[k])$e(p.i,u);else{var v=u.type,b=u.proxy;p.removeEventListener?p.removeEventListener(v,b,u.capture):p.detachEvent?p.detachEvent(ue(v),b):p.addListener&&p.removeListener&&p.removeListener(b),(v=Ie(p))?($e(v,u),v.h==0&&(v.src=null,p[A]=null)):Z(u)}}}function ue(u){return u in M?M[u]:M[u]="on"+u}function xe(u,p){if(u.da)u=!0;else{p=new st(p,this);var v=u.listener,b=u.ha||u.src;u.fa&&fe(u),u=v.call(b,p)}return u}function Ie(u){return u=u[A],u instanceof Ce?u:null}var Se="__closure_events_fn_"+(1e9*Math.random()>>>0);function ke(u){return typeof u=="function"?u:(u[Se]||(u[Se]=function(p){return u.handleEvent(p)}),u[Se])}function Le(){pe.call(this),this.i=new Ce(this),this.M=this,this.F=null}T(Le,pe),Le.prototype[k]=!0,Le.prototype.removeEventListener=function(u,p,v,b){he(this,u,p,v,b)};function ze(u,p){var v,b=u.F;if(b)for(v=[];b;b=b.F)v.push(b);if(u=u.M,b=p.type||p,typeof p=="string")p=new le(p,u);else if(p instanceof le)p.target=p.target||u;else{var B=p;p=new le(b,u),C(p,B)}if(B=!0,v)for(var H=v.length-1;0<=H;H--){var be=p.g=v[H];B=Xe(be,b,!0,p)&&B}if(be=p.g=u,B=Xe(be,b,!0,p)&&B,B=Xe(be,b,!1,p)&&B,v)for(H=0;H<v.length;H++)be=p.g=v[H],B=Xe(be,b,!1,p)&&B}Le.prototype.N=function(){if(Le.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],b=0;b<v.length;b++)Z(v[b]);delete u.g[p],u.h--}}this.F=null},Le.prototype.K=function(u,p,v,b){return this.i.add(String(u),p,!1,v,b)},Le.prototype.L=function(u,p,v,b){return this.i.add(String(u),p,!0,v,b)};function Xe(u,p,v,b){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var B=!0,H=0;H<p.length;++H){var be=p[H];if(be&&!be.da&&be.capture==v){var yt=be.listener,ln=be.ha||be.src;be.fa&&$e(u.i,be),B=yt.call(ln,b)!==!1&&B}}return B&&!b.defaultPrevented}function Qt(u,p,v){if(typeof u=="function")v&&(u=m(u,v));else if(u&&typeof u.handleEvent=="function")u=m(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function $t(u){u.g=Qt(()=>{u.g=null,u.i&&(u.i=!1,$t(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class yn extends pe{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:$t(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function kt(u){pe.call(this),this.h=u,this.g={}}T(kt,pe);var mr=[];function Ur(u){de(u.g,function(p,v){this.g.hasOwnProperty(v)&&fe(p)},u),u.g={}}kt.prototype.N=function(){kt.aa.N.call(this),Ur(this)},kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var on=a.JSON.stringify,Cn=a.JSON.parse,ji=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function _l(){}_l.prototype.h=null;function mc(u){return u.h||(u.h=u.i())}function gc(){}var qi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function bl(){le.call(this,"d")}T(bl,le);function Sr(){le.call(this,"c")}T(Sr,le);var Zn={},Pr=null;function Rr(){return Pr=Pr||new Le}Zn.La="serverreachability";function Cr(u){le.call(this,Zn.La,u)}T(Cr,le);function Bs(u){const p=Rr();ze(p,new Cr(p))}Zn.STAT_EVENT="statevent";function Bi(u,p){le.call(this,Zn.STAT_EVENT,u),this.stat=p}T(Bi,le);function an(u){const p=Rr();ze(p,new Bi(p,u))}Zn.Ma="timingevent";function vc(u,p){le.call(this,Zn.Ma,u),this.size=p}T(vc,le);function kn(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function zs(){this.g=!0}zs.prototype.xa=function(){this.g=!1};function yc(u,p,v,b,B,H){u.info(function(){if(u.g)if(H)for(var be="",yt=H.split("&"),ln=0;ln<yt.length;ln++){var ot=yt[ln].split("=");if(1<ot.length){var un=ot[0];ot=ot[1];var mn=un.split("_");be=2<=mn.length&&mn[1]=="type"?be+(un+"="+ot+"&"):be+(un+"=redacted&")}}else be=null;else be=H;return"XMLHTTP REQ ("+b+") [attempt "+B+"]: "+p+`
`+v+`
`+be})}function wl(u,p,v,b,B,H,be){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+B+"]: "+p+`
`+v+`
`+H+" "+be})}function Ks(u,p,v,b){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+zo(u,v)+(b?" "+b:"")})}function zn(u,p){u.info(function(){return"TIMEOUT: "+p})}zs.prototype.info=function(){};function zo(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var b=v[u];if(!(2>b.length)){var B=b[1];if(Array.isArray(B)&&!(1>B.length)){var H=B[0];if(H!="noop"&&H!="stop"&&H!="close")for(var be=1;be<B.length;be++)B[be]=""}}}}return on(v)}catch{return p}}var Kn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Il={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ko;function jr(){}T(jr,_l),jr.prototype.g=function(){return new XMLHttpRequest},jr.prototype.i=function(){return{}},Ko=new jr;function er(u,p,v,b){this.j=u,this.i=p,this.l=v,this.R=b||1,this.U=new kt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new zi}function zi(){this.i=null,this.g="",this.h=!1}var os={},Go={};function Gs(u,p,v){u.L=1,u.v=Br(_r(p)),u.m=v,u.P=!0,gr(u,null)}function gr(u,p){u.F=Date.now(),Ho(u),u.A=_r(u.v);var v=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),zt(v.i,"t",b),u.C=0,v=u.j.J,u.h=new zi,u.g=Dl(u.j,v?p:null,!u.m),0<u.O&&(u.M=new yn(m(u.Y,u,u.g),u.O)),p=u.U,v=u.g,b=u.ca;var B="readystatechange";Array.isArray(B)||(B&&(mr[0]=B.toString()),B=mr);for(var H=0;H<B.length;H++){var be=ee(v,B[H],b||p.handleEvent,!1,p.h||p);if(!be)break;p.g[be.key]=be}p=u.H?I(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Bs(),yc(u.i,u.u,u.A,u.l,u.R,u.m)}er.prototype.ca=function(u){u=u.target;const p=this.M;p&&Nr(u)==3?p.j():this.Y(u)},er.prototype.Y=function(u){try{if(u==this.g)e:{const mn=Nr(this.g);var p=this.g.Ba();const Zs=this.g.Z();if(!(3>mn)&&(mn!=3||this.g&&(this.h.h||this.g.oa()||sa(this.g)))){this.J||mn!=4||p==7||(p==8||0>=Zs?Bs(3):Bs(2)),vr(this);var v=this.g.Z();this.X=v;t:if(_c(this)){var b=sa(this.g);u="";var B=b.length,H=Nr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){qr(this),as(this);var be="";break t}this.h.i=new a.TextDecoder}for(p=0;p<B;p++)this.h.h=!0,u+=this.h.i.decode(b[p],{stream:!(H&&p==B-1)});b.length=0,this.h.g+=u,this.C=0,be=this.h.g}else be=this.g.oa();if(this.o=v==200,wl(this.i,this.u,this.A,this.l,this.R,mn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var yt,ln=this.g;if((yt=ln.g?ln.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(yt)){var ot=yt;break t}}ot=null}if(v=ot)Ks(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Wo(this,v);else{this.o=!1,this.s=3,an(12),qr(this),as(this);break e}}if(this.P){v=!0;let ur;for(;!this.J&&this.C<be.length;)if(ur=Yh(this,be),ur==Go){mn==4&&(this.s=4,an(14),v=!1),Ks(this.i,this.l,null,"[Incomplete Response]");break}else if(ur==os){this.s=4,an(15),Ks(this.i,this.l,be,"[Invalid Chunk]"),v=!1;break}else Ks(this.i,this.l,ur,null),Wo(this,ur);if(_c(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),mn!=4||be.length!=0||this.h.h||(this.s=1,an(16),v=!1),this.o=this.o&&v,!v)Ks(this.i,this.l,be,"[Invalid Chunked Response]"),qr(this),as(this);else if(0<be.length&&!this.W){this.W=!0;var un=this.j;un.g==this&&un.ba&&!un.M&&(un.j.info("Great, no buffering proxy detected. Bytes received: "+be.length),kl(un),un.M=!0,an(11))}}else Ks(this.i,this.l,be,null),Wo(this,be);mn==4&&qr(this),this.o&&!this.J&&(mn==4?Cc(this.j,this):(this.o=!1,Ho(this)))}else Js(this.g),v==400&&0<be.indexOf("Unknown SID")?(this.s=3,an(12)):(this.s=0,an(13)),qr(this),as(this)}}}catch{}finally{}};function _c(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Yh(u,p){var v=u.C,b=p.indexOf(`
`,v);return b==-1?Go:(v=Number(p.substring(v,b)),isNaN(v)?os:(b+=1,b+v>p.length?Go:(p=p.slice(b,b+v),u.C=b+v,p)))}er.prototype.cancel=function(){this.J=!0,qr(this)};function Ho(u){u.S=Date.now()+u.I,El(u,u.I)}function El(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=kn(m(u.ba,u),p)}function vr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}er.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(zn(this.i,this.A),this.L!=2&&(Bs(),an(17)),qr(this),this.s=2,as(this)):El(this,this.S-u)};function as(u){u.j.G==0||u.J||Cc(u.j,u)}function qr(u){vr(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Ur(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Wo(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Jo(v.h,u))){if(!u.K&&Jo(v.h,u)&&v.G==3){try{var b=v.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var B=b;if(B[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)aa(v),eo(v);else break e;Cl(v),an(18)}}else v.za=B[1],0<v.za-v.T&&37500>B[2]&&v.F&&v.v==0&&!v.C&&(v.C=kn(m(v.Za,v),6e3));if(1>=xl(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else ds(v,11)}else if((u.K||v.g==u)&&aa(v),!j(p))for(B=v.Da.g.parse(p),p=0;p<B.length;p++){let ot=B[p];if(v.T=ot[0],ot=ot[1],v.G==2)if(ot[0]=="c"){v.K=ot[1],v.ia=ot[2];const un=ot[3];un!=null&&(v.la=un,v.j.info("VER="+v.la));const mn=ot[4];mn!=null&&(v.Aa=mn,v.j.info("SVER="+v.Aa));const Zs=ot[5];Zs!=null&&typeof Zs=="number"&&0<Zs&&(b=1.5*Zs,v.L=b,v.j.info("backChannelRequestTimeoutMs_="+b)),b=v;const ur=u.g;if(ur){const la=ur.g?ur.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(la){var H=b.h;H.g||la.indexOf("spdy")==-1&&la.indexOf("quic")==-1&&la.indexOf("h2")==-1||(H.j=H.l,H.g=new Set,H.h&&(Hs(H,H.h),H.h=null))}if(b.D){const hs=ur.g?ur.g.getResponseHeader("X-HTTP-Session-Id"):null;hs&&(b.ya=hs,Et(b.I,b.D,hs))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),b=v;var be=u;if(b.qa=Dc(b,b.J?b.ia:null,b.W),be.K){Ki(b.h,be);var yt=be,ln=b.L;ln&&(yt.I=ln),yt.B&&(vr(yt),Ho(yt)),b.g=be}else Pc(b);0<v.i.length&&ia(v)}else ot[0]!="stop"&&ot[0]!="close"||ds(v,7);else v.G==3&&(ot[0]=="stop"||ot[0]=="close"?ot[0]=="stop"?ds(v,7):Zi(v):ot[0]!="noop"&&v.l&&v.l.ta(ot),v.v=0)}}Bs(4)}catch{}}var Tl=class{constructor(u,p){this.g=u,this.map=p}};function bc(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qo(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function xl(u){return u.h?1:u.g?u.g.size:0}function Jo(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Hs(u,p){u.g?u.g.add(p):u.h=p}function Ki(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}bc.prototype.cancel=function(){if(this.i=Gi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Gi(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return x(u.i)}function Al(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,b=0;b<v;b++)p.push(u[b]);return p}p=[],v=0;for(b in u)p[v++]=u[b];return p}function Ve(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const b in u)p[v++]=b;return p}}}function ut(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=Ve(u),b=Al(u),B=b.length,H=0;H<B;H++)p.call(void 0,b[H],v&&v[H],u)}var yr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Hi(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var b=u[v].indexOf("="),B=null;if(0<=b){var H=u[v].substring(0,b);B=u[v].substring(b+1)}else H=u[v];p(H,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function ls(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof ls){this.h=u.h,Yo(this,u.j),this.o=u.o,this.g=u.g,Xo(this,u.s),this.l=u.l;var p=u.i,v=new Qi;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),Zo(this,v),this.m=u.m}else u&&(p=String(u).match(yr))?(this.h=!1,Yo(this,p[1]||"",!0),this.o=zr(p[2]||""),this.g=zr(p[3]||"",!0),Xo(this,p[4]),this.l=zr(p[5]||"",!0),Zo(this,p[6]||"",!0),this.m=zr(p[7]||"")):(this.h=!1,this.i=new Qi(null,this.h))}ls.prototype.toString=function(){var u=[],p=this.j;p&&u.push(br(p,Qs,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(br(p,Qs,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(br(v,v.charAt(0)=="/"?ea:Wi,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",br(v,Zh)),u.join("")};function _r(u){return new ls(u)}function Yo(u,p,v){u.j=v?zr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function Xo(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Zo(u,p,v){p instanceof Qi?(u.i=p,ef(u.i,u.h)):(v||(p=br(p,Xh)),u.i=new Qi(p,u.h))}function Et(u,p,v){u.i.set(p,v)}function Br(u){return Et(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function zr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function br(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,Ws),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Ws(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Qs=/[#\/\?@]/g,Wi=/[#\?:]/g,ea=/[#\?]/g,Xh=/[#\?@]/g,Zh=/#/g;function Qi(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function kr(u){u.g||(u.g=new Map,u.h=0,u.i&&Hi(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=Qi.prototype,n.add=function(u,p){kr(this),this.i=null,u=it(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function Ke(u,p){kr(u),p=it(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Ye(u,p){return kr(u),p=it(u,p),u.g.has(p)}n.forEach=function(u,p){kr(this),this.g.forEach(function(v,b){v.forEach(function(B){u.call(p,B,b,this)},this)},this)},n.na=function(){kr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let b=0;b<p.length;b++){const B=u[b];for(let H=0;H<B.length;H++)v.push(p[b])}return v},n.V=function(u){kr(this);let p=[];if(typeof u=="string")Ye(this,u)&&(p=p.concat(this.g.get(it(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return kr(this),this.i=null,u=it(this,u),Ye(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function zt(u,p,v){Ke(u,p),0<v.length&&(u.i=null,u.g.set(it(u,p),x(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var b=p[v];const H=encodeURIComponent(String(b)),be=this.V(b);for(b=0;b<be.length;b++){var B=H;be[b]!==""&&(B+="="+encodeURIComponent(String(be[b]))),u.push(B)}}return this.i=u.join("&")};function it(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function ef(u,p){p&&!u.j&&(kr(u),u.i=null,u.g.forEach(function(v,b){var B=b.toLowerCase();b!=B&&(Ke(this,b),zt(this,B,v))},u)),u.j=p}function Sl(u,p){const v=new zs;if(a.Image){const b=new Image;b.onload=y(Gn,v,"TestLoadImage: loaded",!0,p,b),b.onerror=y(Gn,v,"TestLoadImage: error",!1,p,b),b.onabort=y(Gn,v,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(Gn,v,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else p(!1)}function wc(u,p){const v=new zs,b=new AbortController,B=setTimeout(()=>{b.abort(),Gn(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:b.signal}).then(H=>{clearTimeout(B),H.ok?Gn(v,"TestPingServer: ok",!0,p):Gn(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(B),Gn(v,"TestPingServer: error",!1,p)})}function Gn(u,p,v,b,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),b(v)}catch{}}function ta(){this.g=new ji}function tf(u,p,v){const b=v||"";try{ut(u,function(B,H){let be=B;c(B)&&(be=on(B)),p.push(b+H+"="+encodeURIComponent(be))})}catch(B){throw p.push(b+"type="+encodeURIComponent("_badmap")),B}}function Dr(u){this.l=u.Ub||null,this.j=u.eb||!1}T(Dr,_l),Dr.prototype.g=function(){return new Dn(this.l,this.j)},Dr.prototype.i=function(u){return function(){return u}}({});function Dn(u,p){Le.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}T(Dn,Le),n=Dn.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,Ji(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,us(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Ji(this)),this.g&&(this.readyState=3,Ji(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ic(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ic(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?us(this):Ji(this),this.readyState==3&&Ic(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,us(this))},n.Qa=function(u){this.g&&(this.response=u,us(this))},n.ga=function(){this.g&&us(this)};function us(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Ji(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function Ji(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Dn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Ec(u){let p="";return de(u,function(v,b){p+=b,p+=":",p+=v,p+=`\r
`}),p}function Pl(u,p,v){e:{for(b in v){var b=!1;break e}b=!0}b||(v=Ec(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):Et(u,p,v))}function Dt(u){Le.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}T(Dt,Le);var na=/^https?$/i,Rl=["POST","PUT"];n=Dt.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ko.g(),this.v=this.o?mc(this.o):mc(Ko),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(H){wr(this,H);return}if(u=v||"",v=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var B in b)v.set(B,b[B]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const H of b.keys())v.set(H,b.get(H));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(v.keys()).find(H=>H.toLowerCase()=="content-type"),B=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Rl,p,void 0))||b||B||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[H,be]of v)this.g.setRequestHeader(H,be);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ra(this),this.u=!0,this.g.send(u),this.u=!1}catch(H){wr(this,H)}};function wr(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Tc(u),Yi(u)}function Tc(u){u.A||(u.A=!0,ze(u,"complete"),ze(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,ze(this,"complete"),ze(this,"abort"),Yi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Yi(this,!0)),Dt.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?xc(this):this.bb())},n.bb=function(){xc(this)};function xc(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Nr(u)!=4||u.Z()!=2)){if(u.u&&Nr(u)==4)Qt(u.Ea,0,u);else if(ze(u,"readystatechange"),Nr(u)==4){u.h=!1;try{const be=u.Z();e:switch(be){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var b;if(b=be===0){var B=String(u.D).match(yr)[1]||null;!B&&a.self&&a.self.location&&(B=a.self.location.protocol.slice(0,-1)),b=!na.test(B?B.toLowerCase():"")}v=b}if(v)ze(u,"complete"),ze(u,"success");else{u.m=6;try{var H=2<Nr(u)?u.g.statusText:""}catch{H=""}u.l=H+" ["+u.Z()+"]",Tc(u)}}finally{Yi(u)}}}}function Yi(u,p){if(u.g){ra(u);const v=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||ze(u,"ready");try{v.onreadystatechange=b}catch{}}}function ra(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Nr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Nr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Cn(p)}};function sa(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Js(u){const p={};u=(u.g&&2<=Nr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(j(u[b]))continue;var v=O(u[b]);const B=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const H=p[B]||[];p[B]=H,H.push(v)}S(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function cs(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function Xi(u){this.Aa=0,this.i=[],this.j=new zs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=cs("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=cs("baseRetryDelayMs",5e3,u),this.cb=cs("retryDelaySeedMs",1e4,u),this.Wa=cs("forwardChannelMaxRetries",2,u),this.wa=cs("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new bc(u&&u.concurrentRequestLimit),this.Da=new ta,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Xi.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,b){an(0),this.W=u,this.H=p||{},v&&b!==void 0&&(this.H.OSID=v,this.H.OAID=b),this.F=this.X,this.I=Dc(this,null,this.W),ia(this)};function Zi(u){if(Ac(u),u.G==3){var p=u.U++,v=_r(u.I);if(Et(v,"SID",u.K),Et(v,"RID",p),Et(v,"TYPE","terminate"),Kr(u,v),p=new er(u,u.j,p),p.L=2,p.v=Br(_r(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=Dl(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Ho(p)}kc(u)}function eo(u){u.g&&(kl(u),u.g.cancel(),u.g=null)}function Ac(u){eo(u),u.u&&(a.clearTimeout(u.u),u.u=null),aa(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function ia(u){if(!Qo(u.h)&&!u.s){u.s=!0;var p=u.Ga;Ee||Wt(),Fe||(Ee(),Fe=!0),Bt.add(p,u),u.B=0}}function Sc(u,p){return xl(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=kn(m(u.Ga,u,p),Ys(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const B=new er(this,this.j,u);let H=this.o;if(this.S&&(H?(H=I(H),C(H,this.S)):H=this.S),this.m!==null||this.O||(B.H=H,H=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var b=this.i[v];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=to(this,B,p),v=_r(this.I),Et(v,"RID",u),Et(v,"CVER",22),this.D&&Et(v,"X-HTTP-Session-Id",this.D),Kr(this,v),H&&(this.O?p="headers="+encodeURIComponent(String(Ec(H)))+"&"+p:this.m&&Pl(v,this.m,H)),Hs(this.h,B),this.Ua&&Et(v,"TYPE","init"),this.P?(Et(v,"$req",p),Et(v,"SID","null"),B.T=!0,Gs(B,v,null)):Gs(B,v,p),this.G=2}}else this.G==3&&(u?oa(this,u):this.i.length==0||Qo(this.h)||oa(this))};function oa(u,p){var v;p?v=p.l:v=u.U++;const b=_r(u.I);Et(b,"SID",u.K),Et(b,"RID",v),Et(b,"AID",u.T),Kr(u,b),u.m&&u.o&&Pl(b,u.m,u.o),v=new er(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=to(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Hs(u.h,v),Gs(v,b,p)}function Kr(u,p){u.H&&de(u.H,function(v,b){Et(p,b,v)}),u.l&&ut({},function(v,b){Et(p,b,v)})}function to(u,p,v){v=Math.min(u.i.length,v);var b=u.l?m(u.l.Na,u.l,u):null;e:{var B=u.i;let H=-1;for(;;){const be=["count="+v];H==-1?0<v?(H=B[0].g,be.push("ofs="+H)):H=0:be.push("ofs="+H);let yt=!0;for(let ln=0;ln<v;ln++){let ot=B[ln].g;const un=B[ln].map;if(ot-=H,0>ot)H=Math.max(0,B[ln].g-100),yt=!1;else try{tf(un,be,"req"+ot+"_")}catch{b&&b(un)}}if(yt){b=be.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,b}function Pc(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;Ee||Wt(),Fe||(Ee(),Fe=!0),Bt.add(p,u),u.v=0}}function Cl(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=kn(m(u.Fa,u),Ys(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Rc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=kn(m(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,an(10),eo(this),Rc(this))};function kl(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Rc(u){u.g=new er(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=_r(u.qa);Et(p,"RID","rpc"),Et(p,"SID",u.K),Et(p,"AID",u.T),Et(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&Et(p,"TO",u.ja),Et(p,"TYPE","xmlhttp"),Kr(u,p),u.m&&u.o&&Pl(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=Br(_r(p)),v.m=null,v.P=!0,gr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,eo(this),Cl(this),an(19))};function aa(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function Cc(u,p){var v=null;if(u.g==p){aa(u),kl(u),u.g=null;var b=2}else if(Jo(u.h,p))v=p.D,Ki(u.h,p),b=1;else return;if(u.G!=0){if(p.o)if(b==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var B=u.B;b=Rr(),ze(b,new vc(b,v)),ia(u)}else Pc(u);else if(B=p.s,B==3||B==0&&0<p.X||!(b==1&&Sc(u,p)||b==2&&Cl(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),B){case 1:ds(u,5);break;case 4:ds(u,10);break;case 3:ds(u,6);break;default:ds(u,2)}}}function Ys(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function ds(u,p){if(u.j.info("Error code "+p),p==2){var v=m(u.fb,u),b=u.Xa;const B=!b;b=new ls(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Yo(b,"https"),Br(b),B?Sl(b.toString(),v):wc(b.toString(),v)}else an(2);u.G=0,u.l&&u.l.sa(p),kc(u),Ac(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),an(2)):(this.j.info("Failed to ping google.com"),an(1))};function kc(u){if(u.G=0,u.ka=[],u.l){const p=Gi(u.h);(p.length!=0||u.i.length!=0)&&(P(u.ka,p),P(u.ka,u.i),u.h.i.length=0,x(u.i),u.i.length=0),u.l.ra()}}function Dc(u,p,v){var b=v instanceof ls?_r(v):new ls(v);if(b.g!="")p&&(b.g=p+"."+b.g),Xo(b,b.s);else{var B=a.location;b=B.protocol,p=p?p+"."+B.hostname:B.hostname,B=+B.port;var H=new ls(null);b&&Yo(H,b),p&&(H.g=p),B&&Xo(H,B),v&&(H.l=v),b=H}return v=u.D,p=u.ya,v&&p&&Et(b,v,p),Et(b,"VER",u.la),Kr(u,b),b}function Dl(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Dt(new Dr({eb:v})):new Dt(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Nc(){}n=Nc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function no(){}no.prototype.g=function(u,p){return new Hn(u,p)};function Hn(u,p){Le.call(this),this.g=new Xi(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!j(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!j(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Xs(this)}T(Hn,Le),Hn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Hn.prototype.close=function(){Zi(this.g)},Hn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=on(u),u=v);p.i.push(new Tl(p.Ya++,u)),p.G==3&&ia(p)},Hn.prototype.N=function(){this.g.l=null,delete this.j,Zi(this.g),delete this.g,Hn.aa.N.call(this)};function Vc(u){bl.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}T(Vc,bl);function Oc(){Sr.call(this),this.status=1}T(Oc,Sr);function Xs(u){this.g=u}T(Xs,Nc),Xs.prototype.ua=function(){ze(this.g,"a")},Xs.prototype.ta=function(u){ze(this.g,new Vc(u))},Xs.prototype.sa=function(u){ze(this.g,new Oc)},Xs.prototype.ra=function(){ze(this.g,"b")},no.prototype.createWebChannel=no.prototype.g,Hn.prototype.send=Hn.prototype.o,Hn.prototype.open=Hn.prototype.m,Hn.prototype.close=Hn.prototype.close,qb=function(){return new no},jb=function(){return Rr()},Ub=Zn,up={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Kn.NO_ERROR=0,Kn.TIMEOUT=8,Kn.HTTP_ERROR=6,rd=Kn,Il.COMPLETE="complete",$b=Il,gc.EventType=qi,qi.OPEN="a",qi.CLOSE="b",qi.ERROR="c",qi.MESSAGE="d",Le.prototype.listen=Le.prototype.K,Hl=gc,Dt.prototype.listenOnce=Dt.prototype.L,Dt.prototype.getLastError=Dt.prototype.Ka,Dt.prototype.getLastErrorCode=Dt.prototype.Ba,Dt.prototype.getStatus=Dt.prototype.Z,Dt.prototype.getResponseJson=Dt.prototype.Oa,Dt.prototype.getResponseText=Dt.prototype.oa,Dt.prototype.send=Dt.prototype.ea,Dt.prototype.setWithCredentials=Dt.prototype.Ha,Fb=Dt}).apply(typeof jc<"u"?jc:typeof self<"u"?self:typeof window<"u"?window:{});const hy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bn.UNAUTHENTICATED=new bn(null),bn.GOOGLE_CREDENTIALS=new bn("google-credentials-uid"),bn.FIRST_PARTY=new bn("first-party-uid"),bn.MOCK_USER=new bn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xi=new um("@firebase/firestore");function ga(){return xi.logLevel}function O5(n){xi.setLogLevel(n)}function oe(n,...e){if(xi.logLevel<=tt.DEBUG){const t=e.map(hm);xi.debug(`Firestore (${rl}): ${n}`,...t)}}function en(n,...e){if(xi.logLevel<=tt.ERROR){const t=e.map(hm);xi.error(`Firestore (${rl}): ${n}`,...t)}}function xr(n,...e){if(xi.logLevel<=tt.WARN){const t=e.map(hm);xi.warn(`Firestore (${rl}): ${n}`,...t)}}function hm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pe(n="Unexpected state"){const e=`FIRESTORE (${rl}) INTERNAL ASSERTION FAILED: `+n;throw en(e),new Error(e)}function Re(n,e){n||Pe()}function M5(n,e){n||Pe()}function we(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ae extends is{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class uR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(bn.UNAUTHENTICATED))}shutdown(){}}class cR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class dR{constructor(e){this.t=e,this.currentUser=bn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Re(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new wn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new wn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{oe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(oe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new wn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(oe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Re(typeof r.accessToken=="string"),new Bb(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Re(e===null||typeof e=="string"),new bn(e)}}class hR{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=bn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class fR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new hR(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(bn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class zb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class pR{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Re(this.o===void 0);const r=i=>{i.error!=null&&oe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,oe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{oe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):oe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Re(typeof t.token=="string"),this.R=t.token,new zb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class L5{getToken(){return Promise.resolve(new zb(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mR(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=mR(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Be(n,e){return n<e?-1:n>e?1:0}function Ma(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function Gb(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ae(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ae(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new ae(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ae(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Gt.fromMillis(Date.now())}static fromDate(e){return Gt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Gt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Be(this.nanoseconds,e.nanoseconds):Be(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Oe(e)}static min(){return new Oe(new Gt(0,0))}static max(){return new Oe(new Gt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e,t,r){t===void 0?t=0:t>e.length&&Pe(),r===void 0?r=e.length-t:r>e.length-t&&Pe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Eu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Eu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class nt extends Eu{construct(e,t,r){return new nt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new ae(G.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new nt(t)}static emptyPath(){return new nt([])}}const gR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class jt extends Eu{construct(e,t,r){return new jt(e,t,r)}static isValidIdentifier(e){return gR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),jt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new jt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ae(G.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new ae(G.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ae(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new ae(G.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new jt(t)}static emptyPath(){return new jt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.path=e}static fromPath(e){return new Te(nt.fromString(e))}static fromName(e){return new Te(nt.fromString(e).popFirst(5))}static empty(){return new Te(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&nt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return nt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Te(new nt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function cp(n){return n.fields.find(e=>e.kind===2)}function lo(n){return n.fields.filter(e=>e.kind!==2)}function vR(n,e){let t=Be(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=yR(n.fields[r],e.fields[r]),t!==0)return t;return Be(n.fields.length,e.fields.length)}La.UNKNOWN_ID=-1;class Io{constructor(e,t){this.fieldPath=e,this.kind=t}}function yR(n,e){const t=jt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Be(n.kind,e.kind)}class Fa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Fa(0,pr.min())}}function Hb(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Oe.fromTimestamp(r===1e9?new Gt(t+1,0):new Gt(t,r));return new pr(s,Te.empty(),e)}function Wb(n){return new pr(n.readTime,n.key,-1)}class pr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new pr(Oe.min(),Te.empty(),-1)}static max(){return new pr(Oe.max(),Te.empty(),-1)}}function fm(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Te.comparator(n.documentKey,e.documentKey),t!==0?t:Be(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Jb{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oi(n){if(n.code!==G.FAILED_PRECONDITION||n.message!==Qb)throw n;oe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Pe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new z((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof z?t:z.resolve(t)}catch(t){return z.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):z.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):z.reject(t)}static resolve(e){return new z((t,r)=>{t(e)})}static reject(e){return new z((t,r)=>{r(e)})}static waitFor(e){return new z((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=z.resolve(!1);for(const r of e)t=t.next(s=>s?z.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new z((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new z((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new wn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new lu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=pm(r.target.error);this.V.reject(new lu(e,s))}}static open(e,t,r,s){try{return new fh(t,e.transaction(s,r))}catch(i){throw new lu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(oe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new bR(t)}}class Xr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Xr.S(gn())===12.2&&en("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return oe("SimpleDb","Removing database:",e),ho(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!lm())return!1;if(Xr.v())return!0;const e=gn(),t=Xr.S(e),r=0<t&&t<10,s=Yb(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(oe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new lu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new ae(G.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ae(G.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new lu(e,o))},s.onupgradeneeded=i=>{oe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{oe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=fh.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),z.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(oe("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Yb(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class _R{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ho(this.B.delete())}}class lu extends ae{constructor(e,t){super(G.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Mi(n){return n.name==="IndexedDbTransactionError"}class bR{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(oe("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(oe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ho(r)}add(e){return oe("SimpleDb","ADD",this.store.name,e,e),ho(this.store.add(e))}get(e){return ho(this.store.get(e)).next(t=>(t===void 0&&(t=null),oe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return oe("SimpleDb","DELETE",this.store.name,e),ho(this.store.delete(e))}count(){return oe("SimpleDb","COUNT",this.store.name),ho(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new z((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new z((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){oe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new z((r,s)=>{t.onerror=i=>{const o=pm(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new z((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new _R(a),c=t(a.primaryKey,a.value,l);if(c instanceof z){const d=c.catch(f=>(l.done(),z.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>z.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ho(n){return new z((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=pm(r.target.error);t(s)}})}let fy=!1;function pm(n){const e=Xr.S(gn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new ae("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return fy||(fy=!0,setTimeout(()=>{throw r},0)),r}}return n}class wR{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){oe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{oe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Mi(t)?oe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Oi(t)}await this.X(6e4)})}}class IR{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return z.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return oe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(oe("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Wb(i);fm(o,r)>0&&(r=o)}),new pr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}ir.oe=-1;function Wu(n){return n==null}function Tu(n){return n===0&&1/n==-1/0}function Xb(n){return typeof n=="number"&&Number.isInteger(n)&&!Tu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=py(e)),e=ER(n.get(t),e);return py(e)}function ER(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function py(n){return n+""}function Qr(n){const e=n.length;if(Re(e>=2),e===2)return Re(n.charAt(0)===""&&n.charAt(1)===""),nt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Pe(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Pe()}i=o+2}return new nt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const my=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sd(n,e){return[n,jn(e)]}function Zb(n,e,t){return[n,jn(e),t]}const TR={},xR=["prefixPath","collectionGroup","readTime","documentId"],AR=["prefixPath","collectionGroup","documentId"],SR=["collectionGroup","readTime","prefixPath","documentId"],PR=["canonicalId","targetId"],RR=["targetId","path"],CR=["path","targetId"],kR=["collectionId","parent"],DR=["indexId","uid"],NR=["uid","sequenceNumber"],VR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],OR=["indexId","uid","orderedDocumentKey"],MR=["userId","collectionPath","documentId"],LR=["userId","collectionPath","largestBatchId"],FR=["userId","collectionGroup","largestBatchId"],ew=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$R=[...ew,"documentOverlays"],tw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],nw=tw,mm=[...nw,"indexConfiguration","indexState","indexEntries"],UR=mm,jR=[...mm,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp extends Jb{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function vn(n,e){const t=we(n);return Xr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gy(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Li(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function rw(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function sw(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,t){this.comparator=e,this.root=t||xn.EMPTY}insert(e,t){return new Ct(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xn.BLACK,null,null))}remove(e){return new Ct(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new qc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new qc(this.root,e,this.comparator,!1)}getReverseIterator(){return new qc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new qc(this.root,e,this.comparator,!0)}}class qc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??xn.RED,this.left=s??xn.EMPTY,this.right=i??xn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new xn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return xn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return xn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Pe();const e=this.left.check();if(e!==this.right.check())throw Pe();return e+(this.isRed()?0:1)}}xn.EMPTY=null,xn.RED=!0,xn.BLACK=!1;xn.EMPTY=new class{constructor(){this.size=0}get key(){throw Pe()}get value(){throw Pe()}get color(){throw Pe()}get left(){throw Pe()}get right(){throw Pe()}copy(e,t,r,s,i){return this}insert(e,t,r){return new xn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this.comparator=e,this.data=new Ct(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new vy(this.data.getIterator())}getIteratorFrom(e){return new vy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof wt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new wt(this.comparator);return t.data=e,t}}class vy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ca(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this.fields=e,e.sort(jt.comparator)}static empty(){return new or([])}unionWith(e){let t=new wt(jt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new or(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ma(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $5(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new iw("Invalid base64 string: "+i):i}}(e);return new Yt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Yt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Be(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Yt.EMPTY_BYTE_STRING=new Yt("");const qR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ks(n){if(Re(!!n),typeof n=="string"){let e=0;const t=qR.exec(n);if(Re(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ut(n.seconds),nanos:Ut(n.nanos)}}function Ut(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ds(n){return typeof n=="string"?Yt.fromBase64String(n):Yt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function mh(n){const e=n.mapValue.fields.__previous_value__;return ph(e)?mh(e):e}function xu(n){const e=ks(n.mapValue.fields.__local_write_time__.timestampValue);return new Gt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class xo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new xo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof xo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},id={nullValue:"NULL_VALUE"};function Ai(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ph(n)?4:ow(n)?9007199254740991:gh(n)?10:11:Pe()}function ss(n,e){if(n===e)return!0;const t=Ai(n);if(t!==Ai(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return xu(n).isEqual(xu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ks(s.timestampValue),a=ks(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ds(s.bytesValue).isEqual(Ds(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return Ut(s.geoPointValue.latitude)===Ut(i.geoPointValue.latitude)&&Ut(s.geoPointValue.longitude)===Ut(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Ut(s.integerValue)===Ut(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=Ut(s.doubleValue),a=Ut(i.doubleValue);return o===a?Tu(o)===Tu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ma(n.arrayValue.values||[],e.arrayValue.values||[],ss);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(gy(o)!==gy(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ss(o[l],a[l])))return!1;return!0}(n,e);default:return Pe()}}function Au(n,e){return(n.values||[]).find(t=>ss(t,e))!==void 0}function Si(n,e){if(n===e)return 0;const t=Ai(n),r=Ai(e);if(t!==r)return Be(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Be(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=Ut(i.integerValue||i.doubleValue),l=Ut(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return yy(n.timestampValue,e.timestampValue);case 4:return yy(xu(n),xu(e));case 5:return Be(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ds(i),l=Ds(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Be(a[c],l[c]);if(d!==0)return d}return Be(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Be(Ut(i.latitude),Ut(o.latitude));return a!==0?a:Be(Ut(i.longitude),Ut(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return _y(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},m=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,T=(l=m.value)===null||l===void 0?void 0:l.arrayValue,x=Be(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=T==null?void 0:T.values)===null||d===void 0?void 0:d.length)||0);return x!==0?x:_y(y,T)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===gi.mapValue&&o===gi.mapValue)return 0;if(i===gi.mapValue)return 1;if(o===gi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const m=Be(l[f],d[f]);if(m!==0)return m;const y=Si(a[l[f]],c[d[f]]);if(y!==0)return y}return Be(l.length,d.length)}(n.mapValue,e.mapValue);default:throw Pe()}}function yy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Be(n,e);const t=ks(n),r=ks(e),s=Be(t.seconds,r.seconds);return s!==0?s:Be(t.nanos,r.nanos)}function _y(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Si(t[s],r[s]);if(i)return i}return Be(t.length,r.length)}function $a(n){return hp(n)}function hp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ks(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ds(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Te.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=hp(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${hp(t.fields[o])}`;return s+"}"}(n.mapValue):Pe()}function od(n){switch(Ai(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=mh(n);return e?16+od(e):16;case 5:return 2*n.stringValue.length;case 6:return Ds(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+od(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Li(r.fields,(i,o)=>{s+=i.length+od(o)}),s}(n.mapValue);default:throw Pe()}}function Ao(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function fp(n){return!!n&&"integerValue"in n}function Su(n){return!!n&&"arrayValue"in n}function by(n){return!!n&&"nullValue"in n}function wy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ad(n){return!!n&&"mapValue"in n}function gh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function uu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Li(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=uu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=uu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function ow(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const aw={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function zR(n){return"nullValue"in n?id:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ao(xo.empty(),Te.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?gh(n)?aw:{mapValue:{}}:Pe()}function KR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ao(xo.empty(),Te.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?aw:"mapValue"in n?gh(n)?{mapValue:{}}:gi:Pe()}function Iy(n,e){const t=Si(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Ey(n,e){const t=Si(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e){this.value=e}static empty(){return new Pn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ad(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=uu(t)}setAll(e){let t=jt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=uu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ad(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ss(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ad(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Li(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Pn(uu(this.value))}}function lw(n){const e=[];return Li(n.fields,(t,r)=>{const s=new jt([t]);if(ad(r)){const i=lw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new or(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Mt(e,0,Oe.min(),Oe.min(),Oe.min(),Pn.empty(),0)}static newFoundDocument(e,t,r,s){return new Mt(e,1,t,Oe.min(),r,s,0)}static newNoDocument(e,t){return new Mt(e,2,t,Oe.min(),Oe.min(),Pn.empty(),0)}static newUnknownDocument(e,t){return new Mt(e,3,t,Oe.min(),Oe.min(),Pn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Oe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Oe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pi{constructor(e,t){this.position=e,this.inclusive=t}}function Ty(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Te.comparator(Te.fromName(o.referenceValue),t.key):r=Si(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function xy(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ss(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(e,t="asc"){this.field=e,this.dir=t}}function GR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uw{}class rt extends uw{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new HR(e,t,r):t==="array-contains"?new JR(e,r):t==="in"?new mw(e,r):t==="not-in"?new YR(e,r):t==="array-contains-any"?new XR(e,r):new rt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new WR(e,r):new QR(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Si(t,this.value)):t!==null&&Ai(this.value)===Ai(t)&&this.matchesComparison(Si(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Pe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class _t extends uw{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new _t(e,t)}matches(e){return Ua(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ua(n){return n.op==="and"}function pp(n){return n.op==="or"}function gm(n){return cw(n)&&Ua(n)}function cw(n){for(const e of n.filters)if(e instanceof _t)return!1;return!0}function mp(n){if(n instanceof rt)return n.field.canonicalString()+n.op.toString()+$a(n.value);if(gm(n))return n.filters.map(e=>mp(e)).join(",");{const e=n.filters.map(t=>mp(t)).join(",");return`${n.op}(${e})`}}function dw(n,e){return n instanceof rt?function(r,s){return s instanceof rt&&r.op===s.op&&r.field.isEqual(s.field)&&ss(r.value,s.value)}(n,e):n instanceof _t?function(r,s){return s instanceof _t&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&dw(o,s.filters[a]),!0):!1}(n,e):void Pe()}function hw(n,e){const t=n.filters.concat(e);return _t.create(t,n.op)}function fw(n){return n instanceof rt?function(t){return`${t.field.canonicalString()} ${t.op} ${$a(t.value)}`}(n):n instanceof _t?function(t){return t.op.toString()+" {"+t.getFilters().map(fw).join(" ,")+"}"}(n):"Filter"}class HR extends rt{constructor(e,t,r){super(e,t,r),this.key=Te.fromName(r.referenceValue)}matches(e){const t=Te.comparator(e.key,this.key);return this.matchesComparison(t)}}class WR extends rt{constructor(e,t){super(e,"in",t),this.keys=pw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class QR extends rt{constructor(e,t){super(e,"not-in",t),this.keys=pw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function pw(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Te.fromName(r.referenceValue))}class JR extends rt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Su(t)&&Au(t.arrayValue,this.value)}}class mw extends rt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Au(this.value.arrayValue,t)}}class YR extends rt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Au(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Au(this.value.arrayValue,t)}}class XR extends rt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Su(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Au(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function gp(n,e=null,t=[],r=[],s=null,i=null,o=null){return new ZR(n,e,t,r,s,i,o)}function So(n){const e=we(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>mp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Wu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>$a(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>$a(r)).join(",")),e.ue=t}return e.ue}function Qu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!GR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!dw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!xy(n.startAt,e.startAt)&&xy(n.endAt,e.endAt)}function kd(n){return Te.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Dd(n,e){return n.filters.filter(t=>t instanceof rt&&t.field.isEqual(e))}function Ay(n,e,t){let r=id,s=!0;for(const i of Dd(n,e)){let o=id,a=!0;switch(i.op){case"<":case"<=":o=zR(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=id}Iy({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Iy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function Sy(n,e,t){let r=gi,s=!0;for(const i of Dd(n,e)){let o=gi,a=!0;switch(i.op){case">=":case">":o=KR(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=gi}Ey({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Ey({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function gw(n,e,t,r,s,i,o,a){return new Ls(n,e,t,r,s,i,o,a)}function sl(n){return new Ls(n)}function Py(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function vm(n){return n.collectionGroup!==null}function Aa(n){const e=we(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new wt(jt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Pu(i,r))}),t.has(jt.keyField().canonicalString())||e.ce.push(new Pu(jt.keyField(),r))}return e.ce}function qn(n){const e=we(n);return e.le||(e.le=yw(e,Aa(n))),e.le}function vw(n){const e=we(n);return e.he||(e.he=yw(e,n.explicitOrderBy)),e.he}function yw(n,e){if(n.limitType==="F")return gp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Pu(s.field,i)});const t=n.endAt?new Pi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Pi(n.startAt.position,n.startAt.inclusive):null;return gp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function vp(n,e){const t=n.filters.concat([e]);return new Ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Nd(n,e,t){return new Ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ju(n,e){return Qu(qn(n),qn(e))&&n.limitType===e.limitType}function _w(n){return`${So(qn(n))}|lt:${n.limitType}`}function va(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>fw(s)).join(", ")}]`),Wu(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>$a(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>$a(s)).join(",")),`Target(${r})`}(qn(n))}; limitType=${n.limitType})`}function Yu(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Te.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Aa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=Ty(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,Aa(r),s)||r.endAt&&!function(o,a,l){const c=Ty(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,Aa(r),s))}(n,e)}function bw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ww(n){return(e,t)=>{let r=!1;for(const s of Aa(n)){const i=eC(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function eC(n,e,t){const r=n.field.isKeyField()?Te.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Si(l,c):Pe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Pe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Li(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return sw(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC=new Ct(Te.comparator);function ar(){return tC}const Iw=new Ct(Te.comparator);function Wl(...n){let e=Iw;for(const t of n)e=e.insert(t.key,t);return e}function Ew(n){let e=Iw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Jr(){return cu()}function Tw(){return cu()}function cu(){return new Fs(n=>n.toString(),(n,e)=>n.isEqual(e))}const nC=new Ct(Te.comparator),rC=new wt(Te.comparator);function Qe(...n){let e=rC;for(const t of n)e=e.add(t);return e}const sC=new wt(Be);function ym(){return sC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _m(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Tu(e)?"-0":e}}function xw(n){return{integerValue:""+n}}function Aw(n,e){return Xb(e)?xw(e):_m(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(){this._=void 0}}function iC(n,e,t){return n instanceof ja?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&ph(i)&&(i=mh(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof Po?Pw(n,e):n instanceof Ro?Rw(n,e):function(s,i){const o=Sw(s,i),a=Ry(o)+Ry(s.Pe);return fp(o)&&fp(s.Pe)?xw(a):_m(s.serializer,a)}(n,e)}function oC(n,e,t){return n instanceof Po?Pw(n,e):n instanceof Ro?Rw(n,e):t}function Sw(n,e){return n instanceof qa?function(r){return fp(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class ja extends vh{}class Po extends vh{constructor(e){super(),this.elements=e}}function Pw(n,e){const t=Cw(e);for(const r of n.elements)t.some(s=>ss(s,r))||t.push(r);return{arrayValue:{values:t}}}class Ro extends vh{constructor(e){super(),this.elements=e}}function Rw(n,e){let t=Cw(e);for(const r of n.elements)t=t.filter(s=>!ss(s,r));return{arrayValue:{values:t}}}class qa extends vh{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Ry(n){return Ut(n.integerValue||n.doubleValue)}function Cw(n){return Su(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(e,t){this.field=e,this.transform=t}}function aC(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof Po&&s instanceof Po||r instanceof Ro&&s instanceof Ro?Ma(r.elements,s.elements,ss):r instanceof qa&&s instanceof qa?ss(r.Pe,s.Pe):r instanceof ja&&s instanceof ja}(n.transform,e.transform)}class lC{constructor(e,t){this.version=e,this.transformResults=t}}class qt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qt}static exists(e){return new qt(void 0,e)}static updateTime(e){return new qt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ld(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class yh{}function kw(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ol(n.key,qt.none()):new il(n.key,n.data,qt.none());{const t=n.data,r=Pn.empty();let s=new wt(jt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new $s(n.key,r,new or(s.toArray()),qt.none())}}function uC(n,e,t){n instanceof il?function(s,i,o){const a=s.value.clone(),l=ky(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof $s?function(s,i,o){if(!ld(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=ky(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Dw(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function du(n,e,t,r){return n instanceof il?function(i,o,a,l){if(!ld(i.precondition,o))return a;const c=i.value.clone(),d=Dy(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof $s?function(i,o,a,l){if(!ld(i.precondition,o))return a;const c=Dy(i.fieldTransforms,l,o),d=o.data;return d.setAll(Dw(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return ld(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function cC(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Sw(r.transform,s||null);i!=null&&(t===null&&(t=Pn.empty()),t.set(r.field,i))}return t||null}function Cy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ma(r,s,(i,o)=>aC(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class il extends yh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class $s extends yh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Dw(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function ky(n,e,t){const r=new Map;Re(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,oC(o,a,t[s]))}return r}function Dy(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,iC(i,o,e))}return r}class ol extends yh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bm extends yh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&uC(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=du(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=du(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Tw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=kw(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Oe.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Qe())}isEqual(e){return this.batchId===e.batchId&&Ma(this.mutations,e.mutations,(t,r)=>Cy(t,r))&&Ma(this.baseMutations,e.baseMutations,(t,r)=>Cy(t,r))}}class Im{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Re(e.mutations.length===r.length);let s=function(){return nC}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Im(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nw{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var cn,ct;function Vw(n){switch(n){default:return Pe();case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0}}function Ow(n){if(n===void 0)return en("GRPC error has no .code"),G.UNKNOWN;switch(n){case cn.OK:return G.OK;case cn.CANCELLED:return G.CANCELLED;case cn.UNKNOWN:return G.UNKNOWN;case cn.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case cn.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case cn.INTERNAL:return G.INTERNAL;case cn.UNAVAILABLE:return G.UNAVAILABLE;case cn.UNAUTHENTICATED:return G.UNAUTHENTICATED;case cn.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case cn.NOT_FOUND:return G.NOT_FOUND;case cn.ALREADY_EXISTS:return G.ALREADY_EXISTS;case cn.PERMISSION_DENIED:return G.PERMISSION_DENIED;case cn.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case cn.ABORTED:return G.ABORTED;case cn.OUT_OF_RANGE:return G.OUT_OF_RANGE;case cn.UNIMPLEMENTED:return G.UNIMPLEMENTED;case cn.DATA_LOSS:return G.DATA_LOSS;default:return Pe()}}(ct=cn||(cn={}))[ct.OK=0]="OK",ct[ct.CANCELLED=1]="CANCELLED",ct[ct.UNKNOWN=2]="UNKNOWN",ct[ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ct[ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ct[ct.NOT_FOUND=5]="NOT_FOUND",ct[ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",ct[ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",ct[ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",ct[ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ct[ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ct[ct.ABORTED=10]="ABORTED",ct[ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",ct[ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",ct[ct.INTERNAL=13]="INTERNAL",ct[ct.UNAVAILABLE=14]="UNAVAILABLE",ct[ct.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mw(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC=new wo([4294967295,4294967295],0);function Ny(n){const e=Mw().encode(n),t=new Lb;return t.update(e),new Uint8Array(t.digest())}function Vy(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new wo([t,r],0),new wo([s,i],0)]}class Tm{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ql(`Invalid padding: ${t}`);if(r<0)throw new Ql(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ql(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ql(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=wo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(wo.fromNumber(r)));return s.compare(hC)===1&&(s=new wo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Ny(e),[r,s]=Vy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Tm(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Ny(e),[r,s]=Vy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Ql extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,ec.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Zu(Oe.min(),s,new Ct(Be),ar(),Qe())}}class ec{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ec(r,t,Qe(),Qe(),Qe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class Lw{constructor(e,t){this.targetId=e,this.me=t}}class Fw{constructor(e,t,r=Yt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Oy{constructor(){this.fe=0,this.ge=Ly(),this.pe=Yt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Qe(),t=Qe(),r=Qe();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Pe()}}),new ec(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Ly()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Re(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class fC{constructor(e){this.Le=e,this.Be=new Map,this.ke=ar(),this.qe=My(),this.Qe=new Ct(Be)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Pe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(kd(i))if(r===0){const o=new Te(i.path);this.Ue(t,o,Mt.newNoDocument(o,Oe.min()))}else Re(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}Vd==null||Vd.et(function(d,f,m,y,T){var x,P,U,j,D,K;const X={localCacheCount:d,existenceFilterCount:f.count,databaseId:m.database,projectId:m.projectId},de=f.unchangedNames;return de&&(X.bloomFilter={applied:T===0,hashCount:(x=de==null?void 0:de.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(j=(U=(P=de==null?void 0:de.bits)===null||P===void 0?void 0:P.bitmap)===null||U===void 0?void 0:U.length)!==null&&j!==void 0?j:0,padding:(K=(D=de==null?void 0:de.bits)===null||D===void 0?void 0:D.padding)!==null&&K!==void 0?K:0,mightContain:S=>{var I;return(I=y==null?void 0:y.mightContain(S))!==null&&I!==void 0&&I}}),X}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ds(r).toUint8Array()}catch(l){if(l instanceof iw)return xr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Tm(o,s,i)}catch(l){return xr(l instanceof Ql?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&kd(a.target)){const l=new Te(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Mt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Qe();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new Zu(e,t,this.Qe,this.ke,r);return this.ke=ar(),this.qe=My(),this.Qe=new Ct(Be),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Oy,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new wt(Be),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||oe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Oy),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function My(){return new Ct(Te.comparator)}function Ly(){return new Ct(Te.comparator)}const pC=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),mC=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),gC=(()=>({and:"AND",or:"OR"}))();class vC{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function yp(n,e){return n.useProto3Json||Wu(e)?e:{value:e}}function Ba(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $w(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function yC(n,e){return Ba(n,e.toTimestamp())}function nn(n){return Re(!!n),Oe.fromTimestamp(function(t){const r=ks(t);return new Gt(r.seconds,r.nanos)}(n))}function xm(n,e){return _p(n,e).canonicalString()}function _p(n,e){const t=function(s){return new nt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Uw(n){const e=nt.fromString(n);return Re(Jw(e)),e}function Ru(n,e){return xm(n.databaseId,e.path)}function Zr(n,e){const t=Uw(e);if(t.get(1)!==n.databaseId.projectId)throw new ae(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ae(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Te(Bw(t))}function jw(n,e){return xm(n.databaseId,e)}function qw(n){const e=Uw(n);return e.length===4?nt.emptyPath():Bw(e)}function bp(n){return new nt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Bw(n){return Re(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Fy(n,e,t){return{name:Ru(n,e),fields:t.value.mapValue.fields}}function zw(n,e,t){const r=Zr(n,e.name),s=nn(e.updateTime),i=e.createTime?nn(e.createTime):Oe.min(),o=new Pn({mapValue:{fields:e.fields}}),a=Mt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function _C(n,e){return"found"in e?function(r,s){Re(!!s.found),s.found.name,s.found.updateTime;const i=Zr(r,s.found.name),o=nn(s.found.updateTime),a=s.found.createTime?nn(s.found.createTime):Oe.min(),l=new Pn({mapValue:{fields:s.found.fields}});return Mt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Re(!!s.missing),Re(!!s.readTime);const i=Zr(r,s.missing),o=nn(s.readTime);return Mt.newNoDocument(i,o)}(n,e):Pe()}function bC(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Pe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Re(d===void 0||typeof d=="string"),Yt.fromBase64String(d||"")):(Re(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Yt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?G.UNKNOWN:Ow(c.code);return new ae(d,c.message||"")}(o);t=new Fw(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Zr(n,r.document.name),i=nn(r.document.updateTime),o=r.document.createTime?nn(r.document.createTime):Oe.min(),a=new Pn({mapValue:{fields:r.document.fields}}),l=Mt.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new ud(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Zr(n,r.document),i=r.readTime?nn(r.readTime):Oe.min(),o=Mt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new ud([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Zr(n,r.document),i=r.removedTargetIds||[];t=new ud([],i,s,null)}else{if(!("filter"in e))return Pe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new dC(s,i),a=r.targetId;t=new Lw(a,o)}}return t}function Cu(n,e){let t;if(e instanceof il)t={update:Fy(n,e.key,e.value)};else if(e instanceof ol)t={delete:Ru(n,e.key)};else if(e instanceof $s)t={update:Fy(n,e.key,e.data),updateMask:AC(e.fieldMask)};else{if(!(e instanceof bm))return Pe();t={verify:Ru(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof ja)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Po)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ro)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof qa)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Pe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:yC(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Pe()}(n,e.precondition)),t}function wp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?qt.updateTime(nn(i.updateTime)):i.exists!==void 0?qt.exists(i.exists):qt.none()}(e.currentDocument):qt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Re(a.setToServerValue==="REQUEST_TIME"),l=new ja;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new Po(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new Ro(d)}else"increment"in a?l=new qa(o,a.increment):Pe();const c=jt.fromServerFormat(a.fieldPath);return new Xu(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Zr(n,e.update.name),i=new Pn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new or(c.map(d=>jt.fromServerFormat(d)))}(e.updateMask);return new $s(s,i,o,t,r)}return new il(s,i,t,r)}if(e.delete){const s=Zr(n,e.delete);return new ol(s,t)}if(e.verify){const s=Zr(n,e.verify);return new bm(s,t)}return Pe()}function wC(n,e){return n&&n.length>0?(Re(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?nn(s.updateTime):nn(i);return o.isEqual(Oe.min())&&(o=nn(i)),new lC(o,s.transformResults||[])}(t,e))):[]}function Kw(n,e){return{documents:[jw(n,e.path)]}}function _h(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=jw(n,s);const i=function(c){if(c.length!==0)return Qw(_t.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(m){return{field:ui(m.field),direction:EC(m.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=yp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function Gw(n,e,t,r){const{_t:s,parent:i}=_h(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:ui(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:ui(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function Hw(n){let e=qw(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Re(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const m=Ww(f);return m instanceof _t&&gm(m)?m.getFilters():[m]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(m=>function(T){return new Pu(ya(T.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(m))}(t.orderBy));let a=null;t.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,Wu(m)?null:m}(t.limit));let l=null;t.startAt&&(l=function(f){const m=!!f.before,y=f.values||[];return new Pi(y,m)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const m=!f.before,y=f.values||[];return new Pi(y,m)}(t.endAt)),gw(e,s,o,i,a,"F",l,c)}function IC(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Pe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Ww(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ya(t.unaryFilter.field);return rt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=ya(t.unaryFilter.field);return rt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ya(t.unaryFilter.field);return rt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=ya(t.unaryFilter.field);return rt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Pe()}}(n):n.fieldFilter!==void 0?function(t){return rt.create(ya(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Pe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return _t.create(t.compositeFilter.filters.map(r=>Ww(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Pe()}}(t.compositeFilter.op))}(n):Pe()}function EC(n){return pC[n]}function TC(n){return mC[n]}function xC(n){return gC[n]}function ui(n){return{fieldPath:n.canonicalString()}}function ya(n){return jt.fromServerFormat(n.fieldPath)}function Qw(n){return n instanceof rt?function(t){if(t.op==="=="){if(wy(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NAN"}};if(by(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(wy(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NOT_NAN"}};if(by(t.value))return{unaryFilter:{field:ui(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ui(t.field),op:TC(t.op),value:t.value}}}(n):n instanceof _t?function(t){const r=t.getFilters().map(s=>Qw(s));return r.length===1?r[0]:{compositeFilter:{op:xC(t.op),filters:r}}}(n):Pe()}function AC(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Jw(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,t,r,s,i=Oe.min(),o=Oe.min(),a=Yt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new bs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(e){this.ct=e}}function SC(n,e){let t;if(e.document)t=zw(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Te.fromSegments(e.noDocument.path),s=ko(e.noDocument.readTime);t=Mt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Pe();{const r=Te.fromSegments(e.unknownDocument.path),s=ko(e.unknownDocument.version);t=Mt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Gt(s[0],s[1]);return Oe.fromTimestamp(i)}(e.readTime)),t}function $y(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Od(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Ru(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Ba(i,o.version.toTimestamp()),createTime:Ba(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Co(e.version)};else{if(!e.isUnknownDocument())return Pe();r.unknownDocument={path:t.path.toArray(),version:Co(e.version)}}return r}function Od(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Co(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ko(n){const e=new Gt(n.seconds,n.nanoseconds);return Oe.fromTimestamp(e)}function fo(n,e){const t=(e.baseMutations||[]).map(i=>wp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>wp(n.ct,i)),s=Gt.fromMillis(e.localWriteTimeMs);return new wm(e.batchId,s,t,r)}function Jl(n){const e=ko(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ko(n.lastLimboFreeSnapshotVersion):Oe.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Re(i.documents.length===1),qn(sl(qw(i.documents[0])))}(n.query):function(i){return qn(Hw(i))}(n.query),new bs(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Yt.fromBase64String(n.resumeToken))}function Xw(n,e){const t=Co(e.snapshotVersion),r=Co(e.lastLimboFreeSnapshotVersion);let s;s=kd(e.target)?Kw(n.ct,e.target):_h(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:So(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Am(n){const e=Hw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Nd(e,e.limit,"L"):e}function Sf(n,e){return new Em(e.largestBatchId,wp(n.ct,e.overlayMutation))}function Uy(n,e){const t=e.path.lastSegment();return[n,jn(e.path.popLast()),t]}function jy(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Co(r.readTime),documentKey:jn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{getBundleMetadata(e,t){return qy(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:ko(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return qy(e).put(function(s){return{bundleId:s.id,createTime:Co(nn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return By(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Am(i.bundledQuery),readTime:ko(i.readTime)}}(r)})}saveNamedQuery(e,t){return By(e).put(function(s){return{name:s.name,readTime:Co(nn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function qy(n){return vn(n,"bundles")}function By(n){return vn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new bh(e,r)}getOverlay(e,t){return Ll(e).get(Uy(this.userId,t)).next(r=>r?Sf(this.serializer,r):null)}getOverlays(e,t){const r=Jr();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Em(t,o);s.push(this.ht(e,a))}),z.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(jn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Ll(e).j("collectionPathOverlayIndex",a))}),z.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Jr(),i=jn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ll(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Sf(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Jr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ll(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=Sf(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return Ll(e).put(function(s,i,o){const[a,l,c]=Uy(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Cu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Ll(n){return vn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RC{Pt(e){return vn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Yt.fromUint8Array(r):Yt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ut(e.integerValue));else if("doubleValue"in e){const r=Ut(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Tu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ks(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Ds(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?ow(e)?this.dt(t,Number.MAX_SAFE_INTEGER):gh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Pe()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Ut(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Te.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}po.vt=new po;function CC(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function zy(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=CC(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class kC{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=zy(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=zy(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class DC{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class NC{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Fl{constructor(){this.jt=new kC,this.Ht=new DC(this.jt),this.Jt=new NC(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new mo(this.indexId,this.documentKey,this.arrayValue,r)}}function ni(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Ky(n.arrayValue,e.arrayValue),t!==0?t:(t=Ky(n.directionalValue,e.directionalValue),t!==0?t:Te.comparator(n.documentKey,e.documentKey)))}function Ky(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(e){this.Xt=new wt((t,r)=>jt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Re(e.collectionGroup===this.collectionId),this.nn)return!1;const t=cp(e);if(t!==void 0&&!this.sn(t))return!1;const r=lo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new wt(jt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Io(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Io(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Io(r.field,r.dir==="asc"?0:1)));return new La(La.UNKNOWN_ID,this.collectionId,t,Fa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zw(n){var e,t;if(Re(n instanceof rt||n instanceof _t),n instanceof rt){if(n instanceof mw){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>rt.create(n.field,"==",i)))||[];return _t.create(s,"or")}return n}const r=n.filters.map(s=>Zw(s));return _t.create(r,n.op)}function VC(n){if(n.getFilters().length===0)return[];const e=Tp(Zw(n));return Re(eI(e)),Ip(e)||Ep(e)?[e]:e.getFilters()}function Ip(n){return n instanceof rt}function Ep(n){return n instanceof _t&&gm(n)}function eI(n){return Ip(n)||Ep(n)||function(t){if(t instanceof _t&&pp(t)){for(const r of t.getFilters())if(!Ip(r)&&!Ep(r))return!1;return!0}return!1}(n)}function Tp(n){if(Re(n instanceof rt||n instanceof _t),n instanceof rt)return n;if(n.filters.length===1)return Tp(n.filters[0]);const e=n.filters.map(r=>Tp(r));let t=_t.create(e,n.op);return t=Md(t),eI(t)?t:(Re(t instanceof _t),Re(Ua(t)),Re(t.filters.length>1),t.filters.reduce((r,s)=>Sm(r,s)))}function Sm(n,e){let t;return Re(n instanceof rt||n instanceof _t),Re(e instanceof rt||e instanceof _t),t=n instanceof rt?e instanceof rt?function(s,i){return _t.create([s,i],"and")}(n,e):Hy(n,e):e instanceof rt?Hy(e,n):function(s,i){if(Re(s.filters.length>0&&i.filters.length>0),Ua(s)&&Ua(i))return hw(s,i.getFilters());const o=pp(s)?s:i,a=pp(s)?i:s,l=o.filters.map(c=>Sm(c,a));return _t.create(l,"or")}(n,e),Md(t)}function Hy(n,e){if(Ua(e))return hw(e,n.getFilters());{const t=e.filters.map(r=>Sm(n,r));return _t.create(t,"or")}}function Md(n){if(Re(n instanceof rt||n instanceof _t),n instanceof rt)return n;const e=n.getFilters();if(e.length===1)return Md(e[0]);if(cw(n))return n;const t=e.map(s=>Md(s)),r=[];return t.forEach(s=>{s instanceof rt?r.push(s):s instanceof _t&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:_t.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(){this.un=new Pm}addToCollectionParentIndex(e,t){return this.un.add(t),z.resolve()}getCollectionParents(e,t){return z.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return z.resolve()}deleteFieldIndex(e,t){return z.resolve()}deleteAllFieldIndexes(e){return z.resolve()}createTargetIndexes(e,t){return z.resolve()}getDocumentsMatchingTarget(e,t){return z.resolve(null)}getIndexType(e,t){return z.resolve(0)}getFieldIndexes(e,t){return z.resolve([])}getNextCollectionGroupToUpdate(e){return z.resolve(null)}getMinOffset(e,t){return z.resolve(pr.min())}getMinOffsetFromCollectionGroup(e,t){return z.resolve(pr.min())}updateCollectionGroup(e,t,r){return z.resolve()}updateIndexEntries(e,t){return z.resolve()}}class Pm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new wt(nt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new wt(nt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bc=new Uint8Array(0);class MC{constructor(e,t){this.databaseId=t,this.cn=new Pm,this.ln=new Fs(r=>So(r),(r,s)=>Qu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:jn(s)};return Wy(e).put(i)}return z.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[Gb(t),""],!1,!0);return Wy(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Qr(o.parent))}return r})}addFieldIndex(e,t){const r=$l(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=ha(e);return i.next(a=>{o.put(jy(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=$l(e),s=ha(e),i=da(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=$l(e),r=da(e),s=ha(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return z.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Gy(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=da(e);let s=!0;const i=new Map;return z.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Qe();const a=[];return z.forEach(i,(l,c)=>{oe("IndexedDbIndexManager",`Using index ${function(D){return`id=${D.indexId}|cg=${D.collectionGroup}|f=${D.fields.map(K=>`${K.fieldPath}:${K.kind}`).join(",")}`}(l)} to execute ${So(t)}`);const d=function(D,K){const X=cp(K);if(X===void 0)return null;for(const de of Dd(D,X.fieldPath))switch(de.op){case"array-contains-any":return de.value.arrayValue.values||[];case"array-contains":return[de.value]}return null}(c,l),f=function(D,K){const X=new Map;for(const de of lo(K))for(const S of Dd(D,de.fieldPath))switch(S.op){case"==":case"in":X.set(de.fieldPath.canonicalString(),S.value);break;case"not-in":case"!=":return X.set(de.fieldPath.canonicalString(),S.value),Array.from(X.values())}return null}(c,l),m=function(D,K){const X=[];let de=!0;for(const S of lo(K)){const I=S.kind===0?Ay(D,S.fieldPath,D.startAt):Sy(D,S.fieldPath,D.startAt);X.push(I.value),de&&(de=I.inclusive)}return new Pi(X,de)}(c,l),y=function(D,K){const X=[];let de=!0;for(const S of lo(K)){const I=S.kind===0?Sy(D,S.fieldPath,D.endAt):Ay(D,S.fieldPath,D.endAt);X.push(I.value),de&&(de=I.inclusive)}return new Pi(X,de)}(c,l),T=this.In(l,c,m),x=this.In(l,c,y),P=this.Tn(l,c,f),U=this.En(l.indexId,d,T,m.inclusive,x,y.inclusive,P);return z.forEach(U,j=>r.G(j,t.limit).next(D=>{D.forEach(K=>{const X=Te.fromSegments(K.documentKey);o.has(X)||(o=o.add(X),a.push(X))})}))}).next(()=>a)}return z.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=VC(_t.create(e.filters,"and")).map(r=>gp(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const m=t?this.dn(t[f/c]):Bc,y=this.An(e,m,r[f%c],s),T=this.Rn(e,m,i[f%c],o),x=a.map(P=>this.An(e,m,P,!0));d.push(...this.createRange(y,T,x))}return d}An(e,t,r,s){const i=new mo(e,Te.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new mo(e,Te.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new Gy(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return z.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new wt(jt.comparator),d=!1;for(const f of l.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?d=!0:c=c.add(m.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Fl;for(const s of lo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);po.vt.It(i,o)}return r.zt()}dn(e){const t=new Fl;return po.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Fl;return po.vt.It(Ao(this.databaseId,t),r.Yt(function(i){const o=lo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Fl);let i=0;for(const o of lo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&Su(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);po.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Fl;l.seed(a.zt()),po.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof rt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=$l(e),s=ha(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return z.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const m=f?new Fa(f.sequenceNumber,new pr(ko(f.readTime),new Te(Qr(f.documentKey)),f.largestBatchId)):Fa.empty(),y=d.fields.map(([T,x])=>new Io(jt.fromServerFormat(T),x));return new La(d.indexId,d.collectionGroup,y,m)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Be(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=$l(e),i=ha(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>z.forEach(a,l=>i.put(jy(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return z.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?z.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),z.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?z.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return da(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return da(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=da(e);let i=new wt(ni);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new mo(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new wt(ni);const s=this.Vn(t,e);if(s==null)return r;const i=cp(t);if(i!=null){const o=e.data.field(i.fieldPath);if(Su(o))for(const a of o.arrayValue.values||[])r=r.add(new mo(t.indexId,e.key,this.dn(a),s))}else r=r.add(new mo(t.indexId,e.key,Bc,s));return r}bn(e,t,r,s,i){oe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,m){const y=l.getIterator(),T=c.getIterator();let x=ca(y),P=ca(T);for(;x||P;){let U=!1,j=!1;if(x&&P){const D=d(x,P);D<0?j=!0:D>0&&(U=!0)}else x!=null?j=!0:U=!0;U?(f(P),P=ca(T)):j?(m(x),x=ca(y)):(x=ca(y),P=ca(T))}}(s,i,ni,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),z.waitFor(o)}yn(e){let t=1;return ha(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ni(o,a)).filter((o,a,l)=>!a||ni(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=ni(o,e),l=ni(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Bc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Bc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return ni(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Qy)}getMinOffset(e,t){return z.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Pe())).next(Qy)}}function Wy(n){return vn(n,"collectionParents")}function da(n){return vn(n,"indexEntries")}function $l(n){return vn(n,"indexConfiguration")}function ha(n){return vn(n,"indexState")}function Qy(n){Re(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;fm(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new pr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ln{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ln(e,Ln.DEFAULT_COLLECTION_PERCENTILE,Ln.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tI(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,m)=>(a++,m.delete()));i.push(l.next(()=>{Re(a===1)}));const c=[];for(const d of t.mutations){const f=Zb(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return z.waitFor(i).next(()=>c)}function Ld(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Pe();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ln.DEFAULT_COLLECTION_PERCENTILE=10,Ln.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ln.DEFAULT=new Ln(41943040,Ln.DEFAULT_COLLECTION_PERCENTILE,Ln.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ln.DISABLED=new Ln(-1,0,0);class wh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Re(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new wh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ri(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=_a(e),o=ri(e);return o.add({}).next(a=>{Re(typeof a=="number");const l=new wm(a,t,r,s),c=function(y,T,x){const P=x.baseMutations.map(j=>Cu(y.ct,j)),U=x.mutations.map(j=>Cu(y.ct,j));return{userId:T,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:P,mutations:U}}(this.serializer,this.userId,l),d=[];let f=new wt((m,y)=>Be(m.canonicalString(),y.canonicalString()));for(const m of s){const y=Zb(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,TR))}return f.forEach(m=>{d.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),z.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return ri(e).get(t).next(r=>r?(Re(r.userId===this.userId),fo(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?z.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ri(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Re(a.batchId>=r),i=fo(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ri(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ri(e).U("userMutationsIndex",t).next(r=>r.map(s=>fo(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=sd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return _a(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,m=Qr(d);if(c===this.userId&&t.path.isEqual(m))return ri(e).get(f).next(y=>{if(!y)throw Pe();Re(y.userId===this.userId),i.push(fo(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new wt(Be);const s=[];return t.forEach(i=>{const o=sd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=_a(e).J({range:a},(c,d,f)=>{const[m,y,T]=c,x=Qr(y);m===this.userId&&i.path.isEqual(x)?r=r.add(T):f.done()});s.push(l)}),z.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=sd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new wt(Be);return _a(e).J({range:o},(l,c,d)=>{const[f,m,y]=l,T=Qr(m);f===this.userId&&r.isPrefixOf(T)?T.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ri(e).get(i).next(o=>{if(o===null)throw Pe();Re(o.userId===this.userId),r.push(fo(this.serializer,o))}))}),z.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return tI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),z.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return z.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return _a(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Qr(i[1]);s.push(l)}else a.done()}).next(()=>{Re(s.length===0)})})}containsKey(e,t){return nI(e,this.userId,t)}Nn(e){return rI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function nI(n,e,t){const r=sd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return _a(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,m]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function ri(n){return vn(n,"mutations")}function _a(n){return vn(n,"documentMutations")}function rI(n){return vn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Do(0)}static kn(){return new Do(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Do(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Oe.fromTimestamp(new Gt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>fa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Re(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return fa(e).J((o,a)=>{const l=Jl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>z.waitFor(i)).next(()=>s)}forEachTarget(e,t){return fa(e).J((r,s)=>{const i=Jl(s);t(i)})}qn(e){return Yy(e).get("targetGlobalKey").next(t=>(Re(t!==null),t))}Qn(e,t){return Yy(e).put("targetGlobalKey",t)}Kn(e,t){return fa(e).put(Xw(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=So(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return fa(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Jl(a);Qu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ci(e);return t.forEach(o=>{const a=jn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),z.waitFor(s)}removeMatchingKeys(e,t,r){const s=ci(e);return z.forEach(t,i=>{const o=jn(i.path);return z.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ci(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ci(e);let i=Qe();return s.J({range:r,H:!0},(o,a,l)=>{const c=Qr(o[1]),d=new Te(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=jn(t.path),s=IDBKeyRange.bound([r],[Gb(r)],!1,!0);let i=0;return ci(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return fa(e).get(t).next(r=>r?Jl(r):null)}}function fa(n){return vn(n,"targets")}function Yy(n){return vn(n,"targetGlobal")}function ci(n){return vn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xy([n,e],[t,r]){const s=Be(n,t);return s===0?Be(e,r):s}class FC{constructor(e){this.Un=e,this.buffer=new wt(Xy),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Xy(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sI{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){oe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Mi(t)?oe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Oi(t)}await this.Hn(3e5)})}}class $C{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return z.resolve(ir.oe);const r=new FC(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(oe("LruGarbageCollector","Garbage collection skipped; disabled"),z.resolve(Jy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(oe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Jy):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(oe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),ga()<=tt.DEBUG&&oe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),z.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function iI(n,e){return new $C(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(e,t){this.db=e,this.garbageCollector=iI(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return zc(e,r)}removeReference(e,t,r){return zc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return zc(e,t)}nr(e,t){return function(s,i){let o=!1;return rI(s).Y(a=>nI(s,a,i).next(l=>(l&&(o=!0),z.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Oe.min()),ci(e).delete(function(f){return[0,jn(f.path)]}(o))))});s.push(l)}}).next(()=>z.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return zc(e,t)}tr(e,t){const r=ci(e);let s,i=ir.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==ir.oe&&t(new Te(Qr(s)),i),i=c,s=l):i=ir.oe}).next(()=>{i!==ir.oe&&t(new Te(Qr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function zc(n,e){return ci(n).put(function(r,s){return{targetId:0,path:jn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oI{constructor(){this.changes=new Fs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Mt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?z.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return io(e).put(r)}removeEntry(e,t,r){return io(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Od(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Mt.newInvalidDocument(t);return io(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ul(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Mt.newInvalidDocument(t)};return io(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ul(t))},(s,i)=>{r={document:this.ir(t,i),size:Ld(i)}}).next(()=>r)}getEntries(e,t){let r=ar();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=ar(),s=new Ct(Te.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Ld(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return z.resolve();let s=new wt(t_);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Ul(s.first()),Ul(s.last())),o=s.getIterator();let a=o.getNext();return io(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=Te.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&t_(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(Ul(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Od(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return io(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=ar();for(const f of c){const m=this.ir(Te.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(Yu(t,m)||s.has(m.key))&&(d=d.insert(m.key,m))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=ar();const o=e_(t,r),a=e_(t,pr.max());return io(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(Te.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new qC(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Zy(e).get("remoteDocumentGlobalKey").next(t=>(Re(!!t),t))}rr(e,t){return Zy(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=SC(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Oe.min())))return r}return Mt.newInvalidDocument(e)}}function aI(n){return new jC(n)}class qC extends oI{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Fs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new wt((i,o)=>Be(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=$y(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Ld(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=$y(this.cr.serializer,o.convertToNoDocument(Oe.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),z.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Zy(n){return vn(n,"remoteDocumentGlobal")}function io(n){return vn(n,"remoteDocumentsV14")}function Ul(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function e_(n,e){const t=e.documentKey.path.toArray();return[n,Od(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function t_(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Be(t[i],r[i]),s)return s;return s=Be(t.length,r.length),s||(s=Be(t[t.length-2],r[r.length-2]),s||Be(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lI{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&du(r.mutation,s,or.empty(),Gt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Qe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Qe()){const s=Jr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Wl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Jr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Qe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=ar();const o=cu(),a=function(){return cu()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof $s)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),du(d.mutation,c,d.mutation.getFieldMask(),Gt.now())):o.set(c.key,or.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new BC(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=cu();let s=new Ct((o,a)=>o-a),i=Qe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||or.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||Qe()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=Tw();d.forEach(m=>{if(!i.has(m)){const y=kw(t.get(m),r.get(m));y!==null&&f.set(m,y),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return z.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Te.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):vm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):z.resolve(Jr());let a=-1,l=i;return o.next(c=>z.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?z.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{l=l.insert(d,m)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Qe())).next(d=>({batchId:a,changes:Ew(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Te(t)).next(r=>{let s=Wl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Wl();return this.indexManager.getCollectionParents(e,i).next(a=>z.forEach(a,l=>{const c=function(f,m){return new Ls(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Mt.newInvalidDocument(d)))});let a=Wl();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&du(d.mutation,c,or.empty(),Gt.now()),Yu(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return z.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:nn(s.createTime)}}(t)),z.resolve()}getNamedQuery(e,t){return z.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Am(s.bundledQuery),readTime:nn(s.readTime)}}(t)),z.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(){this.overlays=new Ct(Te.comparator),this.Ir=new Map}getOverlay(e,t){return z.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Jr();return z.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),z.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),z.resolve()}getOverlaysForCollection(e,t,r){const s=Jr(),i=t.length+1,o=new Te(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return z.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ct((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Jr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Jr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return z.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Em(t,r));let i=this.Ir.get(t);i===void 0&&(i=Qe(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{constructor(){this.sessionToken=Yt.EMPTY_BYTE_STRING}getSessionToken(e){return z.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,z.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(){this.Tr=new wt(_n.Er),this.dr=new wt(_n.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new _n(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new _n(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Te(new nt([])),r=new _n(t,e),s=new _n(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Te(new nt([])),r=new _n(t,e),s=new _n(t,e+1);let i=Qe();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new _n(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class _n{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Te.comparator(e.key,t.key)||Be(e.wr,t.wr)}static Ar(e,t){return Be(e.wr,t.wr)||Te.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HC{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new wt(_n.Er)}checkEmpty(e){return z.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new wm(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new _n(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return z.resolve(o)}lookupMutationBatch(e,t){return z.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return z.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return z.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return z.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new _n(t,0),s=new _n(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),z.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new wt(Be);return t.forEach(s=>{const i=new _n(s,0),o=new _n(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),z.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Te.isDocumentKey(i)||(i=i.child(""));const o=new _n(new Te(i),0);let a=new wt(Be);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),z.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Re(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return z.forEach(t.mutations,s=>{const i=new _n(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new _n(t,0),s=this.br.firstAfterOrEqual(r);return z.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,z.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WC{constructor(e){this.Mr=e,this.docs=function(){return new Ct(Te.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return z.resolve(r?r.document.mutableCopy():Mt.newInvalidDocument(t))}getEntries(e,t){let r=ar();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Mt.newInvalidDocument(s))}),z.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=ar();const o=t.path,a=new Te(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||fm(Wb(d),r)<=0||(s.has(d.key)||Yu(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return z.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Pe()}Or(e,t){return z.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new QC(this)}getSize(e){return z.resolve(this.size)}}class QC extends oI{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),z.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e){this.persistence=e,this.Nr=new Fs(t=>So(t),Qu),this.lastRemoteSnapshotVersion=Oe.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Rm,this.targetCount=0,this.kr=Do.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),z.resolve()}getLastRemoteSnapshotVersion(e){return z.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return z.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),z.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),z.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Do(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,z.resolve()}updateTargetData(e,t){return this.Kn(t),z.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,z.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),z.waitFor(i).next(()=>s)}getTargetCount(e){return z.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return z.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),z.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),z.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),z.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return z.resolve(r)}containsKey(e,t){return z.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cm{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ir(0),this.Kr=!1,this.Kr=!0,this.$r=new GC,this.referenceDelegate=e(this),this.Ur=new JC(this),this.indexManager=new OC,this.remoteDocumentCache=function(s){return new WC(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new Yw(t),this.Gr=new zC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new KC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new HC(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){oe("MemoryPersistence","Starting transaction:",e);const s=new YC(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return z.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class YC extends Jb{constructor(e){super(),this.currentSequenceNumber=e}}class Ih{constructor(e){this.persistence=e,this.Jr=new Rm,this.Yr=null}static Zr(e){return new Ih(e)}get Xr(){if(this.Yr)return this.Yr;throw Pe()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),z.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),z.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),z.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return z.forEach(this.Xr,r=>{const s=Te.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Oe.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return z.or([()=>z.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Fd{constructor(e,t){this.persistence=e,this.ti=new Fs(r=>jn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=iI(this,t)}static Zr(e,t){return new Fd(e,t)}zr(){}jr(e){return z.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return z.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?z.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Oe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),z.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),z.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=od(e.data.value)),t}nr(e,t,r){return z.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return z.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XC{constructor(e){this.serializer=e}O(e,t,r,s){const i=new fh("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",my,{unique:!0}),l.createObjectStore("documentMutations")}(e),n_(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=z.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),n_(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Oe.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",my,{unique:!0});const f=c.store("mutations"),m=d.map(y=>f.put(y));return z.waitFor(m)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:MR});c.createIndex("collectionPathOverlayIndex",LR,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",FR,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:xR});c.createIndex("documentKeyIndex",AR),c.createIndex("collectionGroupIndex",SR)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:DR}).createIndex("sequenceNumberIndex",NR,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:VR}).createIndex("documentKeyIndex",OR,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Ld(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>z.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>z.forEach(a,l=>{Re(l.userId===i.userId);const c=fo(this.serializer,l);return tI(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new nt(o),c=function(f){return[0,jn(f)]}(l);i.push(t.get(c).next(d=>d?z.resolve():(f=>t.put({targetId:0,path:jn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>z.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:kR});const r=t.store("collectionParents"),s=new Pm,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:jn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new nt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=Qr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Jl(s),o=Xw(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Te(nt.fromString(f.document.name).popFirst(5)):f.noDocument?Te.fromSegments(f.noDocument.path):f.unknownDocument?Te.fromSegments(f.unknownDocument.path):Pe()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>z.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=aI(this.serializer),i=new Cm(Ih.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:Qe();fo(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),z.forEach(a,(l,c)=>{const d=new bn(c),f=bh.lt(this.serializer,d),m=i.getIndexManager(d),y=wh.lt(d,this.serializer,m,i.referenceDelegate);return new lI(s,y,f,m).recalculateAndSaveOverlaysForDocumentKeys(new dp(t,ir.oe),l).next()})})}}function n_(n){n.createObjectStore("targetDocuments",{keyPath:RR}).createIndex("documentTargetsIndex",CR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",PR,{unique:!0}),n.createObjectStore("targetGlobal")}const Pf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class km{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=m=>Promise.resolve(),!km.D())throw new ae(G.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new UC(this,s),this.Ai=t+"main",this.serializer=new Yw(l),this.Ri=new Xr(this.Ai,this.hi,new XC(this.serializer)),this.$r=new RC,this.Ur=new LC(this.referenceDelegate,this.serializer),this.remoteDocumentCache=aI(this.serializer),this.Gr=new PC,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&en("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ae(G.FAILED_PRECONDITION,Pf);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new ir(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Kc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Mi(e))return oe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return oe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return jl(e).get("owner").next(t=>z.resolve(this.vi(t)))}Ci(e){return Kc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=vn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return z.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?z.resolve(!0):jl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new ae(G.FAILED_PRECONDITION,Pf);return!1}}return!(!this.networkEnabled||!this.inForeground)||Kc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&oe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new dp(e,ir.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Kc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return wh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new MC(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return bh.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){oe("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?jR:l===16?UR:l===15?mm:l===14?nw:l===13?tw:l===12?$R:l===11?ew:void Pe()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new dp(a,this.Qr?this.Qr.next():ir.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw en(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new ae(G.FAILED_PRECONDITION,Qb);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return jl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new ae(G.FAILED_PRECONDITION,Pf)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return jl(e).put("owner",t)}static D(){return Xr.D()}bi(e){const t=jl(e);return t.get("owner").next(r=>this.vi(r)?(oe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):z.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(en(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Cb()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return oe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return en("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){en("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function jl(n){return vn(n,"owner")}function Kc(n){return vn(n,"clientMetadata")}function Dm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Qe(),s=Qe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Nm(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Cb()?8:Yb(gn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new ZC;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(ga()<=tt.DEBUG&&oe("QueryEngine","SDK will not create cache indexes for query:",va(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),z.resolve()):(ga()<=tt.DEBUG&&oe("QueryEngine","Query:",va(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(ga()<=tt.DEBUG&&oe("QueryEngine","The SDK decides to create cache indexes for query:",va(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,qn(t))):z.resolve())}Yi(e,t){if(Py(t))return z.resolve(null);let r=qn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Nd(t,null,"F"),r=qn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Qe(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,Nd(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Py(t)||s.isEqual(Oe.min())?z.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?z.resolve(null):(ga()<=tt.DEBUG&&oe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),va(t)),this.rs(e,o,t,Hb(s,-1)).next(a=>a))})}ts(e,t){let r=new wt(ww(e));return t.forEach((s,i)=>{Yu(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return ga()<=tt.DEBUG&&oe("QueryEngine","Using full collection scan to execute query:",va(t)),this.Ji.getDocumentsMatchingQuery(e,t,pr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ek{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ct(Be),this._s=new Fs(i=>So(i),Qu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function cI(n,e,t,r){return new ek(n,e,t,r)}async function dI(n,e){const t=we(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Qe();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function tk(n,e){const t=we(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,m=f.keys();let y=z.resolve();return m.forEach(T=>{y=y.next(()=>d.getEntry(l,T)).next(x=>{const P=c.docVersions.get(T);Re(P!==null),x.version.compareTo(P)<0&&(f.applyToRemoteDocument(x,c),x.isValidDocument()&&(x.setReadTime(c.commitVersion),d.addEntry(x)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Qe();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function hI(n){const e=we(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function nk(n,e){const t=we(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const m=s.get(f);if(!m)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Yt.EMPTY_BYTE_STRING,Oe.min()).withLastLimboFreeSnapshotVersion(Oe.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(x,P,U){return x.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(m,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=ar(),c=Qe();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(fI(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(Oe.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return z.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function fI(n,e,t){let r=Qe(),s=Qe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=ar();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Oe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):oe("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function rk(n,e){const t=we(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function za(n,e){const t=we(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,z.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new bs(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Ka(n,e,t){const r=we(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Mi(o))throw o;oe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function $d(n,e,t){const r=we(n);let s=Oe.min(),i=Qe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=we(l),m=f._s.get(d);return m!==void 0?z.resolve(f.os.get(m)):f.Ur.getTargetData(c,d)}(r,o,qn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Oe.min(),t?i:Qe())).next(a=>(gI(r,bw(e),a),{documents:a,Ts:i})))}function pI(n,e){const t=we(n),r=we(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function mI(n,e){const t=we(n),r=t.us.get(e)||Oe.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,Hb(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(gI(t,e,s),s))}function gI(n,e,t){let r=n.us.get(e)||Oe.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function sk(n,e,t,r){const s=we(n);let i=Qe(),o=ar();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await za(s,function(d){return qn(sl(nt.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>fI(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function ik(n,e,t=Qe()){const r=await za(n,qn(Am(e.bundledQuery))),s=we(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=nn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Yt.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function r_(n,e){return`firestore_clients_${n}_${e}`}function s_(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Rf(n,e){return`firestore_targets_${n}_${e}`}class Ud{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new ae(s.error.code,s.error.message))),o?new Ud(e,t,s.state,i):(en("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new ae(r.error.code,r.error.message))),i?new hu(e,r.state,s):(en("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class jd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=ym();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Xb(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new jd(e,i):(en("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Vm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Vm(t.clientId,t.onlineState):(en("SharedClientState",`Failed to parse online state: ${e}`),null)}}class xp{constructor(){this.activeTargetIds=ym()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Cf{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ct(Be),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=r_(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new xp),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(r_(this.persistenceKey,r));if(s){const i=jd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Rf(this.persistenceKey,e));if(s){const i=hu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Rf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return oe("SharedClientState","READ",e,t),t}setItem(e,t){oe("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){oe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(oe("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void en("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=ir.oe;if(i!=null)try{const a=JSON.parse(i);Re(typeof a=="number"),o=a}catch(a){en("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==ir.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Ud(this.currentUser,e,t,r),i=s_(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=s_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=Rf(this.persistenceKey,e),i=new hu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return jd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Ud.Rs(new bn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return hu.Rs(s,t)}Ls(e){return Vm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);oe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=ym();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class vI{constructor(){this.so=new xp,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new xp,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ok{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){oe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){oe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc=null;function kf(){return Gc===null?Gc=function(){return 268435456+Math.round(2147483648*Math.random())}():Gc++,"0x"+Gc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On="WebChannelConnection";class uk extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=kf(),l=this.xo(t,r.toUriEncodedString());oe("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(oe("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw xr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+rl}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=ak[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=kf();return new Promise((o,a)=>{const l=new Fb;l.setWithCredentials(!0),l.listenOnce($b.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case rd.NO_ERROR:const d=l.getResponseJson();oe(On,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case rd.TIMEOUT:oe(On,`RPC '${e}' ${i} timed out`),a(new ae(G.DEADLINE_EXCEEDED,"Request time out"));break;case rd.HTTP_ERROR:const f=l.getStatus();if(oe(On,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let m=l.getResponseJson();Array.isArray(m)&&(m=m[0]);const y=m==null?void 0:m.error;if(y&&y.status&&y.message){const T=function(P){const U=P.toLowerCase().replace(/_/g,"-");return Object.values(G).indexOf(U)>=0?U:G.UNKNOWN}(y.status);a(new ae(T,y.message))}else a(new ae(G.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new ae(G.UNAVAILABLE,"Connection failed."));break;default:Pe()}}finally{oe(On,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);oe(On,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=kf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=qb(),a=jb(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");oe(On,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let m=!1,y=!1;const T=new lk({Io:P=>{y?oe(On,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(m||(oe(On,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),oe(On,`RPC '${e}' stream ${s} sending:`,P),f.send(P))},To:()=>f.close()}),x=(P,U,j)=>{P.listen(U,D=>{try{j(D)}catch(K){setTimeout(()=>{throw K},0)}})};return x(f,Hl.EventType.OPEN,()=>{y||(oe(On,`RPC '${e}' stream ${s} transport opened.`),T.yo())}),x(f,Hl.EventType.CLOSE,()=>{y||(y=!0,oe(On,`RPC '${e}' stream ${s} transport closed`),T.So())}),x(f,Hl.EventType.ERROR,P=>{y||(y=!0,xr(On,`RPC '${e}' stream ${s} transport errored:`,P),T.So(new ae(G.UNAVAILABLE,"The operation could not be completed")))}),x(f,Hl.EventType.MESSAGE,P=>{var U;if(!y){const j=P.data[0];Re(!!j);const D=j,K=D.error||((U=D[0])===null||U===void 0?void 0:U.error);if(K){oe(On,`RPC '${e}' stream ${s} received error:`,K);const X=K.status;let de=function(w){const C=cn[w];if(C!==void 0)return Ow(C)}(X),S=K.message;de===void 0&&(de=G.INTERNAL,S="Unknown error status: "+X+" with message "+K.message),y=!0,T.So(new ae(de,S)),f.close()}else oe(On,`RPC '${e}' stream ${s} received:`,j),T.bo(j)}}),x(a,Ub.STAT_EVENT,P=>{P.stat===up.PROXY?oe(On,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===up.NOPROXY&&oe(On,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{T.wo()},0),T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(){return typeof window<"u"?window:null}function cd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(n){return new vC(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&oe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _I{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Om(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===G.RESOURCE_EXHAUSTED?(en(t.toString()),en("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===G.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new ae(G.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return oe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(oe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ck extends _I{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=bC(this.serializer,e),r=function(i){if(!("targetChange"in i))return Oe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Oe.min():o.readTime?nn(o.readTime):Oe.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=bp(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=kd(l)?{documents:Kw(i,l)}:{query:_h(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=$w(i,o.resumeToken);const c=yp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Oe.min())>0){a.readTime=Ba(i,o.snapshotVersion.toTimestamp());const c=yp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=IC(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=bp(this.serializer),t.removeTarget=e,this.a_(t)}}class dk extends _I{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Re(!!e.streamToken),this.lastStreamToken=e.streamToken,Re(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Re(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=wC(e.writeResults,e.commitTime),r=nn(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=bp(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Cu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new ae(G.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,_p(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ae(G.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,_p(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ae(G.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class fk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(en(t),this.D_=!1):oe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Fi(this)&&(oe("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=we(l);c.L_.add(4),await al(c),c.q_.set("Unknown"),c.L_.delete(4),await nc(c)}(this))})}),this.q_=new fk(r,s)}}async function nc(n){if(Fi(n))for(const e of n.B_)await e(!0)}async function al(n){for(const e of n.B_)await e(!1)}function Eh(n,e){const t=we(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Fm(t)?Lm(t):ul(t).r_()&&Mm(t,e))}function Ga(n,e){const t=we(n),r=ul(t);t.N_.delete(e),r.r_()&&bI(t,e),t.N_.size===0&&(r.r_()?r.o_():Fi(t)&&t.q_.set("Unknown"))}function Mm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Oe.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ul(n).A_(e)}function bI(n,e){n.Q_.xe(e),ul(n).R_(e)}function Lm(n){n.Q_=new fC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),ul(n).start(),n.q_.v_()}function Fm(n){return Fi(n)&&!ul(n).n_()&&n.N_.size>0}function Fi(n){return we(n).L_.size===0}function wI(n){n.Q_=void 0}async function mk(n){n.q_.set("Online")}async function gk(n){n.N_.forEach((e,t)=>{Mm(n,e)})}async function vk(n,e){wI(n),Fm(n)?(n.q_.M_(e),Lm(n)):n.q_.set("Unknown")}async function yk(n,e,t){if(n.q_.set("Online"),e instanceof Fw&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){oe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await qd(n,r)}else if(e instanceof ud?n.Q_.Ke(e):e instanceof Lw?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Oe.min()))try{const r=await hI(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Yt.EMPTY_BYTE_STRING,d.snapshotVersion)),bI(i,l);const f=new bs(d.target,l,c,d.sequenceNumber);Mm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){oe("RemoteStore","Failed to raise snapshot:",r),await qd(n,r)}}async function qd(n,e,t){if(!Mi(e))throw e;n.L_.add(1),await al(n),n.q_.set("Offline"),t||(t=()=>hI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{oe("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await nc(n)})}function II(n,e){return e().catch(t=>qd(n,t,e))}async function ll(n){const e=we(n),t=Ri(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;_k(e);)try{const s=await rk(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,bk(e,s)}catch(s){await qd(e,s)}EI(e)&&TI(e)}function _k(n){return Fi(n)&&n.O_.length<10}function bk(n,e){n.O_.push(e);const t=Ri(n);t.r_()&&t.V_&&t.m_(e.mutations)}function EI(n){return Fi(n)&&!Ri(n).n_()&&n.O_.length>0}function TI(n){Ri(n).start()}async function wk(n){Ri(n).p_()}async function Ik(n){const e=Ri(n);for(const t of n.O_)e.m_(t.mutations)}async function Ek(n,e,t){const r=n.O_.shift(),s=Im.from(r,e,t);await II(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await ll(n)}async function Tk(n,e){e&&Ri(n).V_&&await async function(r,s){if(function(o){return Vw(o)&&o!==G.ABORTED}(s.code)){const i=r.O_.shift();Ri(r).s_(),await II(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await ll(r)}}(n,e),EI(n)&&TI(n)}async function o_(n,e){const t=we(n);t.asyncQueue.verifyOperationInProgress(),oe("RemoteStore","RemoteStore received new credentials");const r=Fi(t);t.L_.add(3),await al(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await nc(t)}async function Ap(n,e){const t=we(n);e?(t.L_.delete(2),await nc(t)):e||(t.L_.add(2),await al(t),t.q_.set("Unknown"))}function ul(n){return n.K_||(n.K_=function(t,r,s){const i=we(t);return i.w_(),new ck(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:mk.bind(null,n),Ro:gk.bind(null,n),mo:vk.bind(null,n),d_:yk.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Fm(n)?Lm(n):n.q_.set("Unknown")):(await n.K_.stop(),wI(n))})),n.K_}function Ri(n){return n.U_||(n.U_=function(t,r,s){const i=we(t);return i.w_(),new dk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:wk.bind(null,n),mo:Tk.bind(null,n),f_:Ik.bind(null,n),g_:Ek.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await ll(n)):(await n.U_.stop(),n.O_.length>0&&(oe("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new wn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new $m(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ae(G.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function cl(n,e){if(en("AsyncQueue",`${e}: ${n}`),Mi(n))return new ae(G.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Te.comparator(t.key,r.key):(t,r)=>Te.comparator(t.key,r.key),this.keyedMap=Wl(),this.sortedSet=new Ct(this.comparator)}static emptySet(e){return new Sa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Sa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a_{constructor(){this.W_=new Ct(Te.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Pe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ha{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ha(e,t,Sa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ju(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Ak{constructor(){this.queries=l_(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=we(t),i=s.queries;s.queries=l_(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new ae(G.ABORTED,"Firestore shutting down"))}}function l_(){return new Fs(n=>_w(n),Ju)}async function Um(n,e){const t=we(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new xk,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=cl(o,`Initialization of query '${va(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&qm(t)}async function jm(n,e){const t=we(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Sk(n,e){const t=we(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&qm(t)}function Pk(n,e,t){const r=we(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function qm(n){n.Y_.forEach(e=>{e.next()})}var Sp,u_;(u_=Sp||(Sp={})).ea="default",u_.Cache="cache";class Bm{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ha(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ha.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Sp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c_{constructor(e){this.serializer=e}Es(e){return Zr(this.serializer,e)}ds(e){return e.metadata.exists?zw(this.serializer,e.document,!1):Mt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return nn(e)}}class Ck{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=xI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=nt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new c_(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Qe()).add(i);t.set(o,a)}}return t}async complete(){const e=await sk(this.localStore,new c_(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await ik(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function xI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e){this.key=e}}class SI{constructor(e){this.key=e}}class PI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Qe(),this.mutatedKeys=Qe(),this.Aa=ww(e),this.Ra=new Sa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new a_,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const m=s.get(d),y=Yu(this.query,f)?f:null,T=!!m&&this.mutatedKeys.has(m.key),x=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let P=!1;m&&y?m.data.isEqual(y.data)?T!==x&&(r.track({type:3,doc:y}),P=!0):this.ga(m,y)||(r.track({type:2,doc:y}),P=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!m&&y?(r.track({type:0,doc:y}),P=!0):m&&!y&&(r.track({type:1,doc:m}),P=!0,(l||c)&&(a=!0)),P&&(y?(o=o.add(y),i=x?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,T){const x=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pe()}};return x(y)-x(T)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Ha(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new a_,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Qe(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new SI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new AI(r))}),t}ba(e){this.Ta=e.Ts,this.da=Qe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ha.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class kk{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Dk{constructor(e){this.key=e,this.va=!1}}class Nk{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Fs(a=>_w(a),Ju),this.Ma=new Map,this.xa=new Set,this.Oa=new Ct(Te.comparator),this.Na=new Map,this.La=new Rm,this.Ba={},this.ka=new Map,this.qa=Do.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function Vk(n,e,t=!0){const r=Th(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await RI(r,e,t,!0),s}async function Ok(n,e){const t=Th(n);await RI(t,e,!0,!1)}async function RI(n,e,t,r){const s=await za(n.localStore,qn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await zm(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Eh(n.remoteStore,s),a}async function zm(n,e,t,r,s){n.Ka=(f,m,y)=>async function(x,P,U,j){let D=P.view.ma(U);D.ns&&(D=await $d(x.localStore,P.query,!1).then(({documents:S})=>P.view.ma(S,D)));const K=j&&j.targetChanges.get(P.targetId),X=j&&j.targetMismatches.get(P.targetId)!=null,de=P.view.applyChanges(D,x.isPrimaryClient,K,X);return Pp(x,P.targetId,de.wa),de.snapshot}(n,f,m,y);const i=await $d(n.localStore,e,!0),o=new PI(e,i.Ts),a=o.ma(i.documents),l=ec.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Pp(n,t,c.wa);const d=new kk(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function Mk(n,e,t){const r=we(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Ju(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ka(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Ga(r.remoteStore,s.targetId),Wa(r,s.targetId)}).catch(Oi)):(Wa(r,s.targetId),await Ka(r.localStore,s.targetId,!0))}async function Lk(n,e){const t=we(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ga(t.remoteStore,r.targetId))}async function Fk(n,e,t){const r=Wm(n);try{const s=await function(o,a){const l=we(o),c=Gt.now(),d=a.reduce((y,T)=>y.add(T.key),Qe());let f,m;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let T=ar(),x=Qe();return l.cs.getEntries(y,d).next(P=>{T=P,T.forEach((U,j)=>{j.isValidDocument()||(x=x.add(U))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,T)).next(P=>{f=P;const U=[];for(const j of a){const D=cC(j,f.get(j.key).overlayedDocument);D!=null&&U.push(new $s(j.key,D,lw(D.value.mapValue),qt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,U,a)}).next(P=>{m=P;const U=P.applyToLocalDocumentSet(f,x);return l.documentOverlayCache.saveOverlays(y,P.batchId,U)})}).then(()=>({batchId:m.batchId,changes:Ew(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ct(Be)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Us(r,s.changes),await ll(r.remoteStore)}catch(s){const i=cl(s,"Failed to persist write");t.reject(i)}}async function CI(n,e){const t=we(n);try{const r=await nk(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Re(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Re(o.va):s.removedDocuments.size>0&&(Re(o.va),o.va=!1))}),await Us(t,r,e)}catch(r){await Oi(r)}}function d_(n,e,t){const r=we(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=we(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const m of f.j_)m.Z_(a)&&(c=!0)}),c&&qm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function $k(n,e,t){const r=we(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ct(Te.comparator);o=o.insert(i,Mt.newNoDocument(i,Oe.min()));const a=Qe().add(i),l=new Zu(Oe.min(),new Map,new Ct(Be),o,a);await CI(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),Hm(r)}else await Ka(r.localStore,e,!1).then(()=>Wa(r,e,t)).catch(Oi)}async function Uk(n,e){const t=we(n),r=e.batch.batchId;try{const s=await tk(t.localStore,e);Gm(t,r,null),Km(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Us(t,s)}catch(s){await Oi(s)}}async function jk(n,e,t){const r=we(n);try{const s=await function(o,a){const l=we(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Re(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);Gm(r,e,t),Km(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Us(r,s)}catch(s){await Oi(s)}}async function qk(n,e){const t=we(n);Fi(t.remoteStore)||oe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=we(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=cl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Km(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function Gm(n,e,t){const r=we(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Wa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||kI(n,r)})}function kI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Ga(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),Hm(n))}function Pp(n,e,t){for(const r of t)r instanceof AI?(n.La.addReference(r.key,e),Bk(n,r)):r instanceof SI?(oe("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||kI(n,r.key)):Pe()}function Bk(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(oe("SyncEngine","New document in limbo: "+t),n.xa.add(r),Hm(n))}function Hm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Te(nt.fromString(e)),r=n.qa.next();n.Na.set(r,new Dk(t)),n.Oa=n.Oa.insert(t,r),Eh(n.remoteStore,new bs(qn(sl(t.path)),r,"TargetPurposeLimboResolution",ir.oe))}}async function Us(n,e,t){const r=we(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=Nm.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=we(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>z.forEach(c,m=>z.forEach(m.$i,y=>d.persistence.referenceDelegate.addReference(f,m.targetId,y)).next(()=>z.forEach(m.Ui,y=>d.persistence.referenceDelegate.removeReference(f,m.targetId,y)))))}catch(f){if(!Mi(f))throw f;oe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const m=f.targetId;if(!f.fromCache){const y=d.os.get(m),T=y.snapshotVersion,x=y.withLastLimboFreeSnapshotVersion(T);d.os=d.os.insert(m,x)}}}(r.localStore,i))}async function zk(n,e){const t=we(n);if(!t.currentUser.isEqual(e)){oe("SyncEngine","User change. New user:",e.toKey());const r=await dI(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new ae(G.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Us(t,r.hs)}}function Kk(n,e){const t=we(n),r=t.Na.get(e);if(r&&r.va)return Qe().add(r.key);{let s=Qe();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function Gk(n,e){const t=we(n),r=await $d(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Pp(t,e.targetId,s.wa),s}async function Hk(n,e){const t=we(n);return mI(t.localStore,e).then(r=>Us(t,r))}async function Wk(n,e,t,r){const s=we(n),i=await function(a,l){const c=we(a),d=we(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(m=>m?c.localDocuments.getDocuments(f,m):z.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await ll(s.remoteStore):t==="acknowledged"||t==="rejected"?(Gm(s,e,r||null),Km(s,e),function(a,l){we(we(a).mutationQueue).On(l)}(s.localStore,e)):Pe(),await Us(s,i)):oe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Qk(n,e){const t=we(n);if(Th(t),Wm(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await h_(t,r.toArray());t.Qa=!0,await Ap(t.remoteStore,!0);for(const i of s)Eh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Wa(t,o),Ka(t.localStore,o,!0))),Ga(t.remoteStore,o)}),await s,await h_(t,r),function(o){const a=we(o);a.Na.forEach((l,c)=>{Ga(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ct(Te.comparator)}(t),t.Qa=!1,await Ap(t.remoteStore,!1)}}async function h_(n,e,t){const r=we(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await za(r.localStore,qn(l[0]));for(const c of l){const d=r.Fa.get(c),f=await Gk(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await pI(r.localStore,o);a=await za(r.localStore,c),await zm(r,DI(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function DI(n){return gw(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Jk(n){return function(t){return we(we(t).persistence).Qi()}(we(n).localStore)}async function Yk(n,e,t,r){const s=we(n);if(s.Qa)return void oe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await mI(s.localStore,bw(i[0])),a=Zu.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Yt.EMPTY_BYTE_STRING);await Us(s,o,a);break}case"rejected":await Ka(s.localStore,e,!0),Wa(s,e,r);break;default:Pe()}}async function Xk(n,e,t){const r=Th(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){oe("SyncEngine","Adding an already active target "+s);continue}const i=await pI(r.localStore,s),o=await za(r.localStore,i);await zm(r,DI(i),o.targetId,!1,o.resumeToken),Eh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Ka(r.localStore,s,!1).then(()=>{Ga(r.remoteStore,s),Wa(r,s)}).catch(Oi)}}function Th(n){const e=we(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=CI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Kk.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$k.bind(null,e),e.Ca.d_=Sk.bind(null,e.eventManager),e.Ca.$a=Pk.bind(null,e.eventManager),e}function Wm(n){const e=we(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Uk.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jk.bind(null,e),e}function Zk(n,e,t){const r=we(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,T){const x=we(y),P=nn(T.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",U=>x.Gr.getBundleMetadata(U,T.id)).then(U=>!!U&&U.createTime.compareTo(P)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(xI(l));const c=new Ck(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const m=await c.la(d);m&&a._updateProgress(m),d=await o.Ua()}const f=await c.complete();return await Us(i,f.Ia,void 0),await function(y,T){const x=we(y);return x.persistence.runTransaction("Save bundle","readwrite",P=>x.Gr.saveBundleMetadata(P,T))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return xr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Ci{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=tc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return cI(this.persistence,new uI,e.initialUser,this.serializer)}Ga(e){return new Cm(Ih.Zr,this.serializer)}Wa(e){return new vI}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ci.provider={build:()=>new Ci};class eD extends Ci{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Re(this.persistence.referenceDelegate instanceof Fd);const r=this.persistence.referenceDelegate.garbageCollector;return new sI(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?Ln.withCacheSize(this.cacheSizeBytes):Ln.DEFAULT;return new Cm(r=>Fd.Zr(r,t),this.serializer)}}class Qm extends Ci{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Wm(this.Ja.syncEngine),await ll(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return cI(this.persistence,new uI,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new sI(r,e.asyncQueue,t)}Ha(e,t){const r=new IR(t,this.persistence);return new wR(e.asyncQueue,r)}Ga(e){const t=Dm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ln.withCacheSize(this.cacheSizeBytes):Ln.DEFAULT;return new km(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,yI(),cd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new vI}}class NI extends Qm{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Cf&&(this.sharedClientState.syncEngine={no:Wk.bind(null,t),ro:Yk.bind(null,t),io:Xk.bind(null,t),Qi:Jk.bind(null,t),eo:Hk.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await Qk(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=yI();if(!Cf.D(t))throw new ae(G.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Dm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Cf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ki{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>d_(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=zk.bind(null,this.syncEngine),await Ap(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Ak}()}createDatastore(e){const t=tc(e.databaseInfo.databaseId),r=function(i){return new uk(i)}(e.databaseInfo);return function(i,o,a,l){return new hk(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new pk(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>d_(this.syncEngine,t,0),function(){return i_.D()?new i_:new ok}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new Nk(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=we(s);oe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await al(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ki.provider={build:()=>new ki};function f_(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):en("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tD{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new wn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new Rk(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ae(G.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=we(s),a={documents:i.map(f=>Ru(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,nt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const m=_C(o.serializer,f);c.set(m.key.toString(),m)});const d=[];return i.forEach(f=>{const m=c.get(f.toString());Re(!!m),d.push(m)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ol(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Te.fromPath(r);this.mutations.push(new bm(s,this.precondition(s)))}),await async function(r,s){const i=we(r),o={writes:s.map(a=>Cu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,nt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Pe();t=Oe.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new ae(G.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Oe.min())?qt.exists(!1):qt.updateTime(t):qt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Oe.min()))throw new ae(G.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qt.updateTime(t)}return qt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Om(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new nD(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Wu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Vw(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sD{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=bn.UNAUTHENTICATED,this.clientId=Kb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{oe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(oe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=cl(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Df(n,e){n.asyncQueue.verifyOperationInProgress(),oe("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await dI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function p_(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Jm(n);oe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>o_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>o_(e.remoteStore,s)),n._onlineComponents=e}async function Jm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){oe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Df(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===G.FAILED_PRECONDITION||s.code===G.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;xr("Error using user provided cache. Falling back to memory cache: "+t),await Df(n,new Ci)}}else oe("FirestoreClient","Using default OfflineComponentProvider"),await Df(n,new Ci);return n._offlineComponents}async function Ah(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(oe("FirestoreClient","Using user provided OnlineComponentProvider"),await p_(n,n._uninitializedComponentsProvider._online)):(oe("FirestoreClient","Using default OnlineComponentProvider"),await p_(n,new ki))),n._onlineComponents}function VI(n){return Jm(n).then(e=>e.persistence)}function dl(n){return Jm(n).then(e=>e.localStore)}function OI(n){return Ah(n).then(e=>e.remoteStore)}function Ym(n){return Ah(n).then(e=>e.syncEngine)}function MI(n){return Ah(n).then(e=>e.datastore)}async function Qa(n){const e=await Ah(n),t=e.eventManager;return t.onListen=Vk.bind(null,e.syncEngine),t.onUnlisten=Mk.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ok.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Lk.bind(null,e.syncEngine),t}function iD(n){return n.asyncQueue.enqueue(async()=>{const e=await VI(n),t=await OI(n);return e.setNetworkEnabled(!0),function(s){const i=we(s);return i.L_.delete(0),nc(i)}(t)})}function oD(n){return n.asyncQueue.enqueue(async()=>{const e=await VI(n),t=await OI(n);return e.setNetworkEnabled(!1),async function(s){const i=we(s);i.L_.add(0),await al(i),i.q_.set("Offline")}(t)})}function aD(n,e){const t=new wn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=we(c);return f.persistence.runTransaction("read document","readonly",m=>f.localDocuments.getDocument(m,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new ae(G.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=cl(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await dl(n),e,t)),t.promise}function LI(n,e,t={}){const r=new wn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new xh({next:m=>{d.Za(),o.enqueueAndForget(()=>jm(i,f));const y=m.docs.has(a);!y&&m.fromCache?c.reject(new ae(G.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&m.fromCache&&l&&l.source==="server"?c.reject(new ae(G.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Bm(sl(a.path),d,{includeMetadataChanges:!0,_a:!0});return Um(i,f)}(await Qa(n),n.asyncQueue,e,t,r)),r.promise}function lD(n,e){const t=new wn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await $d(s,i,!0),l=new PI(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=cl(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await dl(n),e,t)),t.promise}function FI(n,e,t={}){const r=new wn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new xh({next:m=>{d.Za(),o.enqueueAndForget(()=>jm(i,f)),m.fromCache&&l.source==="server"?c.reject(new ae(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(m)},error:m=>c.reject(m)}),f=new Bm(a,d,{includeMetadataChanges:!0,_a:!0});return Um(i,f)}(await Qa(n),n.asyncQueue,e,t,r)),r.promise}function uD(n,e,t){const r=new wn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await MI(n);r.resolve(async function(o,a,l){var c;const d=we(o),{request:f,ut:m,parent:y}=Gw(d.serializer,vw(a),l);d.connection.Fo||delete f.parent;const T=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(P=>!!P.result);Re(T.length===1);const x=(c=T[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(x).reduce((P,U)=>(P[m[U]]=x[U],P),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function cD(n,e){const t=new xh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){we(s).Y_.add(i),i.next()}(await Qa(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){we(s).Y_.delete(i)}(await Qa(n),t))}}function dD(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?Mw().encode(o):o,function(d,f){return new tD(d,f)}(function(d,f){if(d instanceof Uint8Array)return f_(d,f);if(d instanceof ArrayBuffer)return f_(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,tc(e));n.asyncQueue.enqueueAndForget(async()=>{Zk(await Ym(n),s,r)})}function hD(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=we(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await dl(n),e))}function fD(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=we(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,m,y,T,x){f=[...f],m=[...m],f.sort(y),m.sort(y);const P=f.length,U=m.length;let j=0,D=0;for(;j<U&&D<P;){const K=y(f[D],m[j]);K<0?x(f[D++]):K>0?T(m[j++]):(j++,D++)}for(;j<U;)T(m[j++]);for(;D<P;)x(f[D++])}(c,s,vR,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>z.waitFor(a)))}(await dl(n),e))}function pD(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){we(r).ss.zi=s}(await dl(n),e))}function mD(n){return n.asyncQueue.enqueue(async()=>function(t){const r=we(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await dl(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $I(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m_=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xm(n,e,t){if(!t)throw new ae(G.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function gD(n,e,t,r){if(e===!0&&r===!0)throw new ae(G.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function g_(n){if(!Te.isDocumentKey(n))throw new ae(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function v_(n){if(Te.isDocumentKey(n))throw new ae(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Sh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Pe()}function et(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ae(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Sh(n);throw new ae(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function UI(n,e){if(e<=0)throw new ae(G.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ae(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ae(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}gD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$I((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ae(G.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ae(G.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ae(G.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class rc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new y_({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ae(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ae(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new y_(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new uR;switch(r.type){case"firstParty":return new fR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ae(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=m_.get(t);r&&(oe("ComponentProvider","Removing Datastore"),m_.delete(t),r.terminate())}(this),Promise.resolve()}}function vD(n,e,t,r={}){var s;const i=(n=et(n,rc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&xr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=bn.MOCK_USER;else{a=$P(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new ae(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new bn(c)}n._authCredentials=new cR(new Bb(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Rn(this.firestore,e,this._query)}}class rn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new es(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rn(this.firestore,e,this._key)}}class es extends Rn{constructor(e,t,r){super(e,t,sl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rn(this.firestore,null,new Te(e))}withConverter(e){return new es(this.firestore,e,this._path)}}function We(n,e,...t){if(n=Ne(n),Xm("collection","path",e),n instanceof rc){const r=nt.fromString(e,...t);return v_(r),new es(n,null,r)}{if(!(n instanceof rn||n instanceof es))throw new ae(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(nt.fromString(e,...t));return v_(r),new es(n.firestore,null,r)}}function q5(n,e){if(n=et(n,rc),Xm("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ae(G.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Rn(n,null,function(r){return new Ls(nt.emptyPath(),r)}(e))}function Ae(n,e,...t){if(n=Ne(n),arguments.length===1&&(e=Kb.newId()),Xm("doc","path",e),n instanceof rc){const r=nt.fromString(e,...t);return g_(r),new rn(n,null,new Te(r))}{if(!(n instanceof rn||n instanceof es))throw new ae(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(nt.fromString(e,...t));return g_(r),new rn(n.firestore,n instanceof es?n.converter:null,new Te(r))}}function B5(n,e){return n=Ne(n),e=Ne(e),(n instanceof rn||n instanceof es)&&(e instanceof rn||e instanceof es)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function jI(n,e){return n=Ne(n),e=Ne(e),n instanceof Rn&&e instanceof Rn&&n.firestore===e.firestore&&Ju(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Om(this,"async_queue_retry"),this.Vu=()=>{const r=cd();r&&oe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=cd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=cd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new wn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Mi(e))throw e;oe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw en("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=$m.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Pe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Rp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class yD{constructor(){this._progressObserver={},this._taskCompletionResolver=new wn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z5=-1;class xt extends rc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new __,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new __(e),this._firestoreClient=void 0,await e}}}function K5(n,e,t){t||(t="(default)");const r=Vi(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ti(i,e))return s;throw new ae(G.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new ae(G.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ae(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function _D(n,e){const t=typeof n=="object"?n:dm(),r=typeof n=="string"?n:e||"(default)",s=Vi(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=LP("firestore");i&&vD(s,...i)}return s}function Ht(n){if(n._terminated)throw new ae(G.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||qI(n),n._firestoreClient}function qI(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new BR(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,$I(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new sD(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function bD(n,e){xr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return BI(n,ki.provider,{build:r=>new Qm(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function G5(n){xr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();BI(n,ki.provider,{build:t=>new NI(t,e.cacheSizeBytes)})}function BI(n,e,t){if((n=et(n,xt))._firestoreClient||n._terminated)throw new ae(G.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new ae(G.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},qI(n)}function H5(n){if(n._initialized&&!n._terminated)throw new ae(G.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new wn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Xr.D())return Promise.resolve();const s=r+"main";await Xr.delete(s)}(Dm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function W5(n){return function(t){const r=new wn;return t.asyncQueue.enqueueAndForget(async()=>qk(await Ym(t),r)),r.promise}(Ht(n=et(n,xt)))}function Q5(n){return iD(Ht(n=et(n,xt)))}function J5(n){return oD(Ht(n=et(n,xt)))}function Y5(n){return Q1(n.app,"firestore",n._databaseId.database),n._delete()}function X5(n,e){const t=Ht(n=et(n,xt)),r=new yD;return dD(t,n._databaseId,e,r),r}function Z5(n,e){return hD(Ht(n=et(n,xt)),e).then(t=>t?new Rn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class wD{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e){this._byteString=e}static fromBase64String(e){try{return new No(Yt.fromBase64String(e))}catch(t){throw new ae(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new No(Yt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ae(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new jt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function ej(){return new Fo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ae(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ae(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Be(this._lat,e._lat)||Be(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID=/^__.*__$/;class ED{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new $s(e,this.data,this.fieldMask,t,this.fieldTransforms):new il(e,this.data,t,this.fieldTransforms)}}class zI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new $s(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function KI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Pe()}}class Rh{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Rh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Bd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(KI(this.Cu)&&ID.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class TD{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||tc(e)}Qu(e,t,r,s=!1){return new Rh({Cu:e,methodName:t,qu:r,path:jt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Uo(n){const e=n._freezeSettings(),t=tc(n._databaseId);return new TD(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ch(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);og("Data must be an object, but it was:",o,r);const a=WI(r,o);let l,c;if(i.merge)l=new or(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const m=Du(e,f,t);if(!o.contains(m))throw new ae(G.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);JI(d,m)||d.push(m)}l=new or(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new ED(new Pn(a),l,c)}class sc extends $o{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof sc}}function GI(n,e,t){return new Rh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class eg extends $o{_toFieldTransform(e){return new Xu(e.path,new ja)}isEqual(e){return e instanceof eg}}class tg extends $o{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=GI(this,e,!0),r=this.Ku.map(i=>jo(i,t)),s=new Po(r);return new Xu(e.path,s)}isEqual(e){return e instanceof tg&&Ti(this.Ku,e.Ku)}}class ng extends $o{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=GI(this,e,!0),r=this.Ku.map(i=>jo(i,t)),s=new Ro(r);return new Xu(e.path,s)}isEqual(e){return e instanceof ng&&Ti(this.Ku,e.Ku)}}class rg extends $o{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new qa(e.serializer,Aw(e.serializer,this.$u));return new Xu(e.path,t)}isEqual(e){return e instanceof rg&&this.$u===e.$u}}function sg(n,e,t,r){const s=n.Qu(1,e,t);og("Data must be an object, but it was:",s,r);const i=[],o=Pn.empty();Li(r,(l,c)=>{const d=kh(e,l,t);c=Ne(c);const f=s.Nu(d);if(c instanceof sc)i.push(d);else{const m=jo(c,f);m!=null&&(i.push(d),o.set(d,m))}});const a=new or(i);return new zI(o,a,s.fieldTransforms)}function ig(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[Du(e,r,t)],l=[s];if(i.length%2!=0)throw new ae(G.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Du(e,i[m])),l.push(i[m+1]);const c=[],d=Pn.empty();for(let m=a.length-1;m>=0;--m)if(!JI(c,a[m])){const y=a[m];let T=l[m];T=Ne(T);const x=o.Nu(y);if(T instanceof sc)c.push(y);else{const P=jo(T,x);P!=null&&(c.push(y),d.set(y,P))}}const f=new or(c);return new zI(d,f,o.fieldTransforms)}function HI(n,e,t,r=!1){return jo(t,n.Qu(r?4:3,e))}function jo(n,e){if(QI(n=Ne(n)))return og("Unsupported field value:",e,n),WI(n,e);if(n instanceof $o)return function(r,s){if(!KI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=jo(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Ne(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Aw(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Gt.fromDate(r);return{timestampValue:Ba(s.serializer,i)}}if(r instanceof Gt){const i=new Gt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ba(s.serializer,i)}}if(r instanceof Zm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof No)return{bytesValue:$w(s.serializer,r._byteString)};if(r instanceof rn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:xm(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ph)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return _m(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Sh(r)}`)}(n,e)}function WI(n,e){const t={};return sw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Li(n,(r,s)=>{const i=jo(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function QI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Gt||n instanceof Zm||n instanceof No||n instanceof rn||n instanceof $o||n instanceof Ph)}function og(n,e,t){if(!QI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Sh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function Du(n,e,t){if((e=Ne(e))instanceof Fo)return e._internalPath;if(typeof e=="string")return kh(n,e);throw Bd("Field path arguments must be of type string or ",n,!1,void 0,t)}const xD=new RegExp("[~\\*/\\[\\]]");function kh(n,e,t){if(e.search(xD)>=0)throw Bd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Fo(...e.split("."))._internalPath}catch{throw Bd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Bd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new ae(G.INVALID_ARGUMENT,a+n+l)}function JI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new rn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new AD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Dh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class AD extends Nu{data(){return super.data()}}function Dh(n,e){return typeof e=="string"?kh(n,e):e instanceof Fo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ae(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ag{}class ic extends ag{}function Vu(n,e,...t){let r=[];e instanceof ag&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof hl).length,a=i.filter(l=>l instanceof oc).length;if(o>1||o>0&&a>0)throw new ae(G.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class oc extends ic{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new oc(e,t,r)}_apply(e){const t=this._parse(e);return ZI(e._query,t),new Rn(e.firestore,e.converter,vp(e._query,t))}_parse(e){const t=Uo(e.firestore);return function(i,o,a,l,c,d,f){let m;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new ae(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){w_(f,d);const y=[];for(const T of f)y.push(b_(l,i,T));m={arrayValue:{values:y}}}else m=b_(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||w_(f,d),m=HI(a,o,f,d==="in"||d==="not-in");return rt.create(c,d,m)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function zd(n,e,t){const r=e,s=Dh("where",n);return oc._create(s,r,t)}class hl extends ag{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:_t.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)ZI(o,l),o=vp(o,l)}(e._query,t),new Rn(e.firestore,e.converter,vp(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function tj(...n){return n.forEach(e=>eE("or",e)),hl._create("or",n)}function nj(...n){return n.forEach(e=>eE("and",e)),hl._create("and",n)}class lg extends ic{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new lg(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new ae(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ae(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Pu(i,o)}(e._query,this._field,this._direction);return new Rn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ls(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function SD(n,e="asc"){const t=e,r=Dh("orderBy",n);return lg._create(r,t)}class Nh extends ic{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Nh(e,t,r)}_apply(e){return new Rn(e.firestore,e.converter,Nd(e._query,this._limit,this._limitType))}}function rj(n){return UI("limit",n),Nh._create("limit",n,"F")}function sj(n){return UI("limitToLast",n),Nh._create("limitToLast",n,"L")}class Vh extends ic{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Vh(e,t,r)}_apply(e){const t=XI(e,this.type,this._docOrFields,this._inclusive);return new Rn(e.firestore,e.converter,function(s,i){return new Ls(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function ij(...n){return Vh._create("startAt",n,!0)}function oj(...n){return Vh._create("startAfter",n,!1)}class Oh extends ic{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Oh(e,t,r)}_apply(e){const t=XI(e,this.type,this._docOrFields,this._inclusive);return new Rn(e.firestore,e.converter,function(s,i){return new Ls(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function aj(...n){return Oh._create("endBefore",n,!1)}function lj(...n){return Oh._create("endAt",n,!0)}function XI(n,e,t,r){if(t[0]=Ne(t[0]),t[0]instanceof Nu)return function(i,o,a,l,c){if(!l)throw new ae(G.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of Aa(i))if(f.field.isKeyField())d.push(Ao(o,l.key));else{const m=l.data.field(f.field);if(ph(m))throw new ae(G.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const y=f.field.canonicalString();throw new ae(G.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(m)}return new Pi(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Uo(n.firestore);return function(o,a,l,c,d,f){const m=o.explicitOrderBy;if(d.length>m.length)throw new ae(G.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let T=0;T<d.length;T++){const x=d[T];if(m[T].field.isKeyField()){if(typeof x!="string")throw new ae(G.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof x}`);if(!vm(o)&&x.indexOf("/")!==-1)throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${x}' contains a slash.`);const P=o.path.child(nt.fromString(x));if(!Te.isDocumentKey(P))throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${P}' is not because it contains an odd number of segments.`);const U=new Te(P);y.push(Ao(a,U))}else{const P=HI(l,c,x);y.push(P)}}return new Pi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function b_(n,e,t){if(typeof(t=Ne(t))=="string"){if(t==="")throw new ae(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!vm(e)&&t.indexOf("/")!==-1)throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(nt.fromString(t));if(!Te.isDocumentKey(r))throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ao(n,new Te(r))}if(t instanceof rn)return Ao(n,t._key);throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Sh(t)}.`)}function w_(n,e){if(!Array.isArray(n)||n.length===0)throw new ae(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ZI(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new ae(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ae(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function eE(n,e){if(!(e instanceof oc||e instanceof hl))throw new ae(G.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class tE{convertValue(e,t="none"){switch(Ai(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ut(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ds(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Pe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Li(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Ut(o.doubleValue));return new Ph(i)}convertGeoPoint(e){return new Zm(Ut(e.latitude),Ut(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=mh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(xu(e));default:return null}}convertTimestamp(e){const t=ks(e);return new Gt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=nt.fromString(e);Re(Jw(r));const s=new xo(r.get(1),r.get(3)),i=new Te(r.popFirst(5));return s.isEqual(t)||en(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class PD extends tE{constructor(e){super(),this.firestore=e}convertBytes(e){return new No(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uj(n){return new ku("sum",Du("sum",n))}function cj(n){return new ku("avg",Du("average",n))}function RD(){return new ku("count")}function dj(n,e){var t,r;return n instanceof ku&&e instanceof ku&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function hj(n,e){return jI(n.query,e.query)&&Ti(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ja extends Nu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new dd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Dh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class dd extends Ja{data(e={}){return super.data(e)}}class Ya{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new go(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new dd(this._firestore,this._userDataWriter,r.key,r,new go(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ae(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new dd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new go(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new dd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new go(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:CD(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function CD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pe()}}function fj(n,e){return n instanceof Ja&&e instanceof Ja?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ya&&e instanceof Ya&&n._firestore===e._firestore&&jI(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(n){n=et(n,rn);const e=et(n.firestore,xt);return LI(Ht(e),n._key).then(t=>ug(e,n,t))}class $i extends tE{constructor(e){super(),this.firestore=e}convertBytes(e){return new No(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new rn(this.firestore,null,t)}}function pj(n){n=et(n,rn);const e=et(n.firestore,xt),t=Ht(e),r=new $i(e);return aD(t,n._key).then(s=>new Ja(e,r,n._key,s,new go(s!==null&&s.hasLocalMutations,!0),n.converter))}function mj(n){n=et(n,rn);const e=et(n.firestore,xt);return LI(Ht(e),n._key,{source:"server"}).then(t=>ug(e,n,t))}function vt(n){n=et(n,Rn);const e=et(n.firestore,xt),t=Ht(e),r=new $i(e);return YI(n._query),FI(t,n._query).then(s=>new Ya(e,r,n,s))}function gj(n){n=et(n,Rn);const e=et(n.firestore,xt),t=Ht(e),r=new $i(e);return lD(t,n._query).then(s=>new Ya(e,r,n,s))}function vj(n){n=et(n,Rn);const e=et(n.firestore,xt),t=Ht(e),r=new $i(e);return FI(t,n._query,{source:"server"}).then(s=>new Ya(e,r,n,s))}function fn(n,e,t){n=et(n,rn);const r=et(n.firestore,xt),s=Mh(n.converter,e,t);return ac(r,[Ch(Uo(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,qt.none())])}function fl(n,e,t,...r){n=et(n,rn);const s=et(n.firestore,xt),i=Uo(s);let o;return o=typeof(e=Ne(e))=="string"||e instanceof Fo?ig(i,"updateDoc",n._key,e,t,r):sg(i,"updateDoc",n._key,e),ac(s,[o.toMutation(n._key,qt.exists(!0))])}function Xa(n){return ac(et(n.firestore,xt),[new ol(n._key,qt.none())])}function pl(n,e){const t=et(n.firestore,xt),r=Ae(n),s=Mh(n.converter,e);return ac(t,[Ch(Uo(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,qt.exists(!1))]).then(()=>r)}function yj(n,...e){var t,r,s;n=Ne(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Rp(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Rp(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof rn)c=et(n.firestore,xt),d=sl(n._key.path),l={next:f=>{e[o]&&e[o](ug(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=et(n,Rn);c=et(f.firestore,xt),d=f._query;const m=new $i(c);l={next:y=>{e[o]&&e[o](new Ya(c,m,f,y))},error:e[o+1],complete:e[o+2]},YI(n._query)}return function(m,y,T,x){const P=new xh(x),U=new Bm(y,P,T);return m.asyncQueue.enqueueAndForget(async()=>Um(await Qa(m),U)),()=>{P.Za(),m.asyncQueue.enqueueAndForget(async()=>jm(await Qa(m),U))}}(Ht(c),d,a,l)}function _j(n,e){return cD(Ht(n=et(n,xt)),Rp(e)?e:{next:e})}function ac(n,e){return function(r,s){const i=new wn;return r.asyncQueue.enqueueAndForget(async()=>Fk(await Ym(r),s,i)),i.promise}(Ht(n),e)}function ug(n,e,t){const r=t.docs.get(e._key),s=new $i(n);return new Ja(n,s,e._key,r,new go(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bj(n){return kD(n,{count:RD()})}function kD(n,e){const t=et(n.firestore,xt),r=Ht(t),s=rw(e,(i,o)=>new Nw(o,i.aggregateType,i._internalFieldPath));return uD(r,n._query,s).then(i=>function(a,l,c){const d=new $i(a);return new wD(l,d,c)}(t,n,i))}class DD{constructor(e){this.kind="memory",this._onlineComponentProvider=ki.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Ci.provider}toJSON(){return{kind:this.kind}}}class ND{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=FD(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class VD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Ci.provider}toJSON(){return{kind:this.kind}}}class OD{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new eD(e)}}toJSON(){return{kind:this.kind}}}function wj(){return new VD}function Ij(n){return new OD(n==null?void 0:n.cacheSizeBytes)}function Ej(n){return new DD(n)}function Tj(n){return new ND(n)}class MD{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ki.provider,this._offlineComponentProvider={build:t=>new Qm(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class LD{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ki.provider,this._offlineComponentProvider={build:t=>new NI(t,e==null?void 0:e.cacheSizeBytes)}}}function FD(n){return new MD(n==null?void 0:n.forceOwnership)}function xj(){return new LD}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $D={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Uo(e)}set(e,t,r){this._verifyNotCommitted();const s=di(e,this._firestore),i=Mh(s.converter,t,r),o=Ch(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,qt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=di(e,this._firestore);let o;return o=typeof(t=Ne(t))=="string"||t instanceof Fo?ig(this._dataReader,"WriteBatch.update",i._key,t,r,s):sg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,qt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=di(e,this._firestore);return this._mutations=this._mutations.concat(new ol(t._key,qt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new ae(G.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function di(n,e){if((n=Ne(n)).firestore!==e)throw new ae(G.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Uo(t)}get(t){const r=di(t,this._firestore),s=new PD(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Pe();const o=i[0];if(o.isFoundDocument())return new Nu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Nu(this._firestore,s,r._key,null,r.converter);throw Pe()})}set(t,r,s){const i=di(t,this._firestore),o=Mh(i.converter,r,s),a=Ch(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=di(t,this._firestore);let a;return a=typeof(r=Ne(r))=="string"||r instanceof Fo?ig(this._dataReader,"Transaction.update",o._key,r,s,i):sg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=di(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=di(e,this._firestore),r=new $i(this._firestore);return super.get(e).then(s=>new Ja(this._firestore,r,t._key,s._document,new go(!1,!1),t.converter))}}function Sj(n,e,t){n=et(n,xt);const r=Object.assign(Object.assign({},$D),t);return function(i){if(i.maxAttempts<1)throw new ae(G.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new wn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await MI(i);new rD(i.asyncQueue,c,a,o,l).au()}),l.promise}(Ht(n),s=>e(new jD(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pj(){return new sc("deleteField")}function Ui(){return new eg("serverTimestamp")}function qD(...n){return new tg("arrayUnion",n)}function Rj(...n){return new ng("arrayRemove",n)}function Cj(n){return new rg("increment",n)}function kj(n){return new Ph(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(n){return Ht(n=et(n,xt)),new UD(n,e=>ac(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dj(n,e){const t=Ht(n=et(n,xt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return xr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new ae(G.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=I_(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const m=kh("setIndexConfiguration",I_(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new Io(m,2)):f.order==="ASCENDING"?d.push(new Io(m,0)):f.order==="DESCENDING"&&d.push(new Io(m,1))}a.push(new La(La.UNKNOWN_ID,c,d,Fa.empty()))}return a}(e);return fD(t,r)}function I_(n,e){if(typeof n[e]!="string")throw new ae(G.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function Nj(n){var e;n=et(n,xt);const t=E_.get(n);if(t)return t;if(((e=Ht(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new BD(n);return E_.set(n,r),r}function Vj(n){nE(n,!0)}function Oj(n){nE(n,!1)}function Mj(n){mD(Ht(n._firestore)).then(e=>oe("deleting all persistent cache indexes succeeded")).catch(e=>xr("deleting all persistent cache indexes failed",e))}function nE(n,e){pD(Ht(n._firestore),e).then(t=>oe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>xr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const E_=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lj(n){var e;const t=(e=Ht(et(n.firestore,xt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:_h(t,qn(n._query))._t}function Fj(n,e){var t;const r=rw(e,(i,o)=>new Nw(o,i.aggregateType,i._internalFieldPath)),s=(t=Ht(et(n.firestore,xt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:Gw(s,vw(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $j{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return dg.instance.onExistenceFilterMismatch(e)}}class dg{constructor(){this.Uu=new Map}static get instance(){return Hc||(Hc=new dg,function(t){if(Vd)throw new Error("a TestingHooksSpi instance is already set");Vd=t}(Hc)),Hc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Hc=null;(function(e,t=!0){(function(s){rl=s})(nl),rs(new $r("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new xt(new dR(r.getProvider("auth-internal")),new pR(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new ae(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xo(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Er(hy,"4.7.3",e),Er(hy,"4.7.3","esm2017")})();function hg(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uj={PHONE:"phone",TOTP:"totp"},jj={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},qj={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},Bj={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},zj={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zD(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function rE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Kj=zD,KD=rE,sE=new Lo("auth","Firebase",rE()),Gj={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kd=new um("@firebase/auth");function GD(n,...e){Kd.logLevel<=tt.WARN&&Kd.warn(`Auth (${nl}): ${n}`,...e)}function hd(n,...e){Kd.logLevel<=tt.ERROR&&Kd.error(`Auth (${nl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(n,...e){throw pg(n,...e)}function Yn(n,...e){return pg(n,...e)}function fg(n,e,t){const r=Object.assign(Object.assign({},KD()),{[e]:t});return new Lo("auth","Firebase",r).create(e,{appName:n.name})}function In(n){return fg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ml(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&lr(n,"argument-error"),fg(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function pg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return sE.create(n,...e)}function _e(n,e,...t){if(!n)throw pg(e,...t)}function Yr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw hd(e),new Error(e)}function Ns(n,e){n||Yr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ou(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function mg(){return T_()==="http:"||T_()==="https:"}function T_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(mg()||BP()||"connection"in navigator)?navigator.onLine:!0}function WD(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ns(t>e,"Short delay should be less than long delay!"),this.isMobile=UP()||zP()}get(){return HD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(n,e){Ns(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iE{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Yr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Yr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Yr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD=new lc(3e4,6e4);function Lt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ft(n,e,t,r,s={}){return oE(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=tl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return qP()||(c.referrerPolicy="no-referrer"),iE.fetch()(aE(n,n.config.apiHost,t,a),c)})}async function oE(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},QD),e);try{const s=new XD(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Yl(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Yl(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Yl(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Yl(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw fg(n,d,c);lr(n,d)}}catch(s){if(s instanceof is)throw s;lr(n,"network-request-failed",{message:String(s)})}}async function js(n,e,t,r,s={}){const i=await Ft(n,e,t,r,s);return"mfaPendingCredential"in i&&lr(n,"multi-factor-auth-required",{_serverResponse:i}),i}function aE(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?gg(n.config,s):`${n.config.apiScheme}://${s}`}function YD(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class XD{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Yn(this.auth,"network-request-failed")),JD.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Yl(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Yn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x_(n){return n!==void 0&&n.getResponse!==void 0}function A_(n){return n!==void 0&&n.enterprise!==void 0}class lE{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return YD(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZD(n){return(await Ft(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function uE(n,e){return Ft(n,"GET","/v2/recaptchaConfig",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e2(n,e){return Ft(n,"POST","/v1/accounts:delete",e)}async function t2(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function cE(n,e){return Ft(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hj(n,e=!1){return Ne(n).getIdToken(e)}async function n2(n,e=!1){const t=Ne(n),r=await t.getIdToken(e),s=Lh(r);_e(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:fu(Nf(s.auth_time)),issuedAtTime:fu(Nf(s.iat)),expirationTime:fu(Nf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Nf(n){return Number(n)*1e3}function Lh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return hd("JWT malformed, contained fewer than 3 sections"),null;try{const s=Ab(t);return s?JSON.parse(s):(hd("Failed to decode base64 JWT payload"),null)}catch(s){return hd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function S_(n){const e=Lh(n);return _e(e,"internal-error"),_e(typeof e.exp<"u","internal-error"),_e(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof is&&r2(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function r2({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s2{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=fu(this.lastLoginAt),this.creationTime=fu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Vs(n,cE(t,{idToken:r}));_e(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?dE(i.providerUserInfo):[],a=o2(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new Cp(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function i2(n){const e=Ne(n);await Mu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function o2(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function dE(n){return n.map(e=>{var{providerId:t}=e,r=hg(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a2(n,e){const t=await oE(n,{},async()=>{const r=tl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=aE(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",iE.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function l2(n,e){return Ft(n,"POST","/v2/accounts:revokeToken",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_e(e.idToken,"internal-error"),_e(typeof e.idToken<"u","internal-error"),_e(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):S_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){_e(e.length!==0,"internal-error");const t=S_(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(_e(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await a2(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Pa;return r&&(_e(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(_e(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(_e(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pa,this.toJSON())}_performRefresh(){return Yr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(n,e){_e(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ws{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=hg(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new s2(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Cp(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Vs(this,this.stsTokenManager.getToken(this.auth,e));return _e(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return n2(this,e)}reload(){return i2(this)}_assign(e){this!==e&&(_e(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ws(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){_e(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Mu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tn(this.auth.app))return Promise.reject(In(this.auth));const e=await this.getIdToken();return await Vs(this,e2(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,m=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,T=(o=t.photoURL)!==null&&o!==void 0?o:void 0,x=(a=t.tenantId)!==null&&a!==void 0?a:void 0,P=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,U=(c=t.createdAt)!==null&&c!==void 0?c:void 0,j=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:D,emailVerified:K,isAnonymous:X,providerData:de,stsTokenManager:S}=t;_e(D&&S,e,"internal-error");const I=Pa.fromJSON(this.name,S);_e(typeof D=="string",e,"internal-error"),si(f,e.name),si(m,e.name),_e(typeof K=="boolean",e,"internal-error"),_e(typeof X=="boolean",e,"internal-error"),si(y,e.name),si(T,e.name),si(x,e.name),si(P,e.name),si(U,e.name),si(j,e.name);const w=new ws({uid:D,auth:e,email:m,emailVerified:K,displayName:f,isAnonymous:X,photoURL:T,phoneNumber:y,tenantId:x,stsTokenManager:I,createdAt:U,lastLoginAt:j});return de&&Array.isArray(de)&&(w.providerData=de.map(C=>Object.assign({},C))),P&&(w._redirectEventId=P),w}static async _fromIdTokenResponse(e,t,r=!1){const s=new Pa;s.updateFromServerResponse(t);const i=new ws({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Mu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];_e(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?dE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Pa;a.updateFromIdToken(r);const l=new ws({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Cp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P_=new Map;function Is(n){Ns(n instanceof Function,"Expected a class definition");let e=P_.get(n);return e?(Ns(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,P_.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}hE.type="NONE";const R_=hE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(n,e,t){return`firebase:${n}:${e}:${t}`}class Ra{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=fd(this.userKey,s.apiKey,i),this.fullPersistenceKey=fd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ws._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ra(Is(R_),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Is(R_);const o=fd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=ws._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ra(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Ra(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C_(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(gE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(fE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(yE(e))return"Blackberry";if(_E(e))return"Webos";if(pE(e))return"Safari";if((e.includes("chrome/")||mE(e))&&!e.includes("edge/"))return"Chrome";if(vE(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function fE(n=gn()){return/firefox\//i.test(n)}function pE(n=gn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function mE(n=gn()){return/crios\//i.test(n)}function gE(n=gn()){return/iemobile/i.test(n)}function vE(n=gn()){return/android/i.test(n)}function yE(n=gn()){return/blackberry/i.test(n)}function _E(n=gn()){return/webos/i.test(n)}function vg(n=gn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function u2(n=gn()){var e;return vg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function c2(){return KP()&&document.documentMode===10}function bE(n=gn()){return vg(n)||vE(n)||_E(n)||yE(n)||/windows phone/i.test(n)||gE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wE(n,e=[]){let t;switch(n){case"Browser":t=C_(gn());break;case"Worker":t=`${C_(gn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${nl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h2(n,e={}){return Ft(n,"GET","/v2/passwordPolicy",Lt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f2=6;class p2{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:f2,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new k_(this),this.idTokenSubscription=new k_(this),this.beforeStateQueue=new d2(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Is(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ra.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await cE(this,{idToken:e}),r=await ws._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(tn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return _e(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Mu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=WD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tn(this.app))return Promise.reject(In(this));const t=e?Ne(e):null;return t&&_e(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_e(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tn(this.app)?Promise.reject(In(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tn(this.app)?Promise.reject(In(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Is(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await h2(this),t=new p2(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Lo("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await l2(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Is(e)||this._popupRedirectResolver;_e(t,this,"argument-error"),this.redirectPersistenceManager=await Ra.create(this,[Is(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(_e(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _e(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&GD(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Xt(n){return Ne(n)}class k_{constructor(e){this.auth=e,this.observer=null,this.addObserver=YP(t=>this.observer=t)}get next(){return _e(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function g2(n){uc=n}function yg(n){return uc.loadJS(n)}function v2(){return uc.recaptchaV2Script}function y2(){return uc.recaptchaEnterpriseScript}function _2(){return uc.gapiScript}function IE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const b2="recaptcha-enterprise",w2="NO_RECAPTCHA";class EE{constructor(e){this.type=b2,this.auth=Xt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{uE(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new lE(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;A_(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(w2)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&A_(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=y2();l.length!==0&&(l+=a),yg(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function D_(n,e,t,r=!1){const s=new EE(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Lu(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await D_(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await D_(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function I2(n){const e=Xt(n),t=await uE(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new lE(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new EE(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E2(n,e){const t=Vi(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ti(i,e??{}))return s;lr(s,"already-initialized")}return t.initialize({options:e})}function T2(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Is);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function x2(n,e,t){const r=Xt(n);_e(r._canInitEmulator,r,"emulator-config-failed"),_e(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=TE(e),{host:o,port:a}=A2(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||S2()}function TE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function A2(n){const e=TE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:N_(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:N_(o)}}}function N_(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function S2(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Yr("not implemented")}_getIdTokenResponse(e){return Yr("not implemented")}_linkToIdToken(e,t){return Yr("not implemented")}_getReauthenticationResolver(e){return Yr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xE(n,e){return Ft(n,"POST","/v1/accounts:resetPassword",Lt(n,e))}async function P2(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function R2(n,e){return Ft(n,"POST","/v1/accounts:signUp",e)}async function C2(n,e){return Ft(n,"POST","/v1/accounts:update",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k2(n,e){return js(n,"POST","/v1/accounts:signInWithPassword",Lt(n,e))}async function Fh(n,e){return Ft(n,"POST","/v1/accounts:sendOobCode",Lt(n,e))}async function D2(n,e){return Fh(n,e)}async function N2(n,e){return Fh(n,e)}async function V2(n,e){return Fh(n,e)}async function O2(n,e){return Fh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function M2(n,e){return js(n,"POST","/v1/accounts:signInWithEmailLink",Lt(n,e))}async function L2(n,e){return js(n,"POST","/v1/accounts:signInWithEmailLink",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu extends cc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Fu(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Fu(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Lu(e,t,"signInWithPassword",k2);case"emailLink":return M2(e,{email:this._email,oobCode:this._password});default:lr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Lu(e,r,"signUpPassword",R2);case"emailLink":return L2(e,{idToken:t,email:this._email,oobCode:this._password});default:lr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ss(n,e){return js(n,"POST","/v1/accounts:signInWithIdp",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2="http://localhost";class Os extends cc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Os(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):lr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=hg(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Os(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ss(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ss(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ss(e,t)}buildRequest(){const e={requestUri:F2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=tl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $2(n,e){return Ft(n,"POST","/v1/accounts:sendVerificationCode",Lt(n,e))}async function U2(n,e){return js(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,e))}async function j2(n,e){const t=await js(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,e));if(t.temporaryProof)throw Yl(n,"account-exists-with-different-credential",t);return t}const q2={USER_NOT_FOUND:"user-not-found"};async function B2(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return js(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,t),q2)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo extends cc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Eo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Eo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return U2(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return j2(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return B2(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Eo({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z2(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function K2(n){const e=Kl(Gl(n)).link,t=e?Kl(Gl(e)).deep_link_id:null,r=Kl(Gl(n)).deep_link_id;return(r?Kl(Gl(r)).link:null)||r||t||e||n}class dc{constructor(e){var t,r,s,i,o,a;const l=Kl(Gl(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=z2((s=l.mode)!==null&&s!==void 0?s:null);_e(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=K2(e);try{return new dc(t)}catch{return null}}}function Wj(n){return dc.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(){this.providerId=qo.PROVIDER_ID}static credential(e,t){return Fu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=dc.parseLink(t);return _e(r,"argument-error"),Fu._fromEmailAndCode(e,r.code,r.tenantId)}}qo.PROVIDER_ID="password";qo.EMAIL_PASSWORD_SIGN_IN_METHOD="password";qo.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gl extends qs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class pd extends gl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return _e("providerId"in t&&"signInMethod"in t,"argument-error"),Os._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return _e(e.idToken||e.accessToken,"argument-error"),Os._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return pd.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return pd.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new pd(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hi extends gl{constructor(){super("facebook.com")}static credential(e){return Os._fromParams({providerId:hi.PROVIDER_ID,signInMethod:hi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return hi.credentialFromTaggedObject(e)}static credentialFromError(e){return hi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return hi.credential(e.oauthAccessToken)}catch{return null}}}hi.FACEBOOK_SIGN_IN_METHOD="facebook.com";hi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi extends gl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Os._fromParams({providerId:fi.PROVIDER_ID,signInMethod:fi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return fi.credentialFromTaggedObject(e)}static credentialFromError(e){return fi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return fi.credential(t,r)}catch{return null}}}fi.GOOGLE_SIGN_IN_METHOD="google.com";fi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi extends gl{constructor(){super("github.com")}static credential(e){return Os._fromParams({providerId:pi.PROVIDER_ID,signInMethod:pi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pi.credentialFromTaggedObject(e)}static credentialFromError(e){return pi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pi.credential(e.oauthAccessToken)}catch{return null}}}pi.GITHUB_SIGN_IN_METHOD="github.com";pi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G2="http://localhost";class $u extends cc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ss(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ss(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ss(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new $u(r,i)}static _create(e,t){return new $u(e,t)}buildRequest(){return{requestUri:G2,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2="saml.";class kp extends qs{constructor(e){_e(e.startsWith(H2),"argument-error"),super(e)}static credentialFromResult(e){return kp.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return kp.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=$u.fromJSON(e);return _e(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return $u._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi extends gl{constructor(){super("twitter.com")}static credential(e,t){return Os._fromParams({providerId:mi.PROVIDER_ID,signInMethod:mi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return mi.credentialFromTaggedObject(e)}static credentialFromError(e){return mi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return mi.credential(t,r)}catch{return null}}}mi.TWITTER_SIGN_IN_METHOD="twitter.com";mi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AE(n,e){return js(n,"POST","/v1/accounts:signUp",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ws._fromIdTokenResponse(e,r,s),o=V_(r);return new Ar({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=V_(r);return new Ar({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function V_(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W2(n){var e;if(tn(n.app))return Promise.reject(In(n));const t=Xt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Ar({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await AE(t,{returnSecureToken:!0}),s=await Ar._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd extends is{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Gd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Gd(e,t,r,s)}}function SE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Gd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PE(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qj(n,e){const t=Ne(n);await $h(!0,t,e);const{providerUserInfo:r}=await t2(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=PE(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function _g(n,e,t=!1){const r=await Vs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ar._forOperation(n,"link",r)}async function $h(n,e,t){await Mu(e);const r=PE(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";_e(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RE(n,e,t=!1){const{auth:r}=n;if(tn(r.app))return Promise.reject(In(r));const s="reauthenticate";try{const i=await Vs(n,SE(r,s,e,n),t);_e(i.idToken,r,"internal-error");const o=Lh(i.idToken);_e(o,r,"internal-error");const{sub:a}=o;return _e(n.uid===a,r,"user-mismatch"),Ar._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&lr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CE(n,e,t=!1){if(tn(n.app))return Promise.reject(In(n));const r="signIn",s=await SE(n,r,e),i=await Ar._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function bg(n,e){return CE(Xt(n),e)}async function Q2(n,e){const t=Ne(n);return await $h(!1,t,e.providerId),_g(t,e)}async function J2(n,e){return RE(Ne(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y2(n,e){return js(n,"POST","/v1/accounts:signInWithCustomToken",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jj(n,e){if(tn(n.app))return Promise.reject(In(n));const t=Xt(n),r=await Y2(t,{token:e,returnSecureToken:!0}),s=await Ar._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?wg._fromServerResponse(e,t):"totpInfo"in t?Ig._fromServerResponse(e,t):lr(e,"internal-error")}}class wg extends hc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new wg(t)}}class Ig extends hc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Ig(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uh(n,e,t){var r;_e(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),_e(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(_e(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(_e(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eg(n){const e=Xt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function X2(n,e,t){const r=Xt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Uh(r,s,t),await Lu(r,s,"getOobCode",N2)}async function Z2(n,e,t){await xE(Ne(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Eg(n),r})}async function Yj(n,e){await C2(Ne(n),{oobCode:e})}async function eN(n,e){const t=Ne(n),r=await xE(t,{oobCode:e}),s=r.requestType;switch(_e(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":_e(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":_e(r.mfaInfo,t,"internal-error");default:_e(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=hc._fromServerResponse(Xt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function Xj(n,e){const{data:t}=await eN(Ne(n),e);return t.email}async function tN(n,e,t){if(tn(n.app))return Promise.reject(In(n));const r=Xt(n),o=await Lu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",AE).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Eg(n),l}),a=await Ar._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function nN(n,e,t){return tn(n.app)?Promise.reject(In(n)):bg(Ne(n),qo.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Eg(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zj(n,e,t){const r=Xt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){_e(a.handleCodeInApp,r,"argument-error"),a&&Uh(r,o,a)}i(s,t),await Lu(r,s,"getOobCode",V2)}function eq(n,e){const t=dc.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function tq(n,e,t){if(tn(n.app))return Promise.reject(In(n));const r=Ne(n),s=qo.credentialWithLink(e,t||Ou());return _e(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),bg(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rN(n,e){return Ft(n,"POST","/v1/accounts:createAuthUri",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nq(n,e){const t=mg()?Ou():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await rN(Ne(n),r);return s||[]}async function rq(n,e){const t=Ne(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Uh(t.auth,s,e);const{email:i}=await D2(t.auth,s);i!==n.email&&await n.reload()}async function sq(n,e,t){const r=Ne(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Uh(r.auth,i,t);const{email:o}=await O2(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sN(n,e){return Ft(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iq(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Ne(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Vs(r,sN(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function iN(n,e){const t=Ne(n);return tn(t.auth.app)?Promise.reject(In(t.auth)):kE(t,e,null)}function oN(n,e){return kE(Ne(n),null,e)}async function kE(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Vs(n,P2(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aN(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Lh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Ca(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new lN(i,s);case"github.com":return new uN(i,s);case"google.com":return new cN(i,s);case"twitter.com":return new dN(i,s,n.screenName||null);case"custom":case"anonymous":return new Ca(i,null);default:return new Ca(i,r,s)}}class Ca{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class DE extends Ca{constructor(e,t,r,s){super(e,t,r),this.username=s}}class lN extends Ca{constructor(e,t){super(e,"facebook.com",t)}}class uN extends DE{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class cN extends Ca{constructor(e,t){super(e,"google.com",t)}}class dN extends DE{constructor(e,t,r){super(e,"twitter.com",t,r)}}function oq(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:aN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hN(n,e){return Ne(n).setPersistence(e)}function aq(n){return I2(n)}async function lq(n,e){return Xt(n).validatePassword(e)}function fN(n,e,t,r){return Ne(n).onIdTokenChanged(e,t,r)}function pN(n,e,t){return Ne(n).beforeAuthStateChanged(e,t)}function mN(n,e,t,r){return Ne(n).onAuthStateChanged(e,t,r)}function uq(n){Ne(n).useDeviceLanguage()}function cq(n,e){return Ne(n).updateCurrentUser(e)}function gN(n){return Ne(n).signOut()}function dq(n,e){return Xt(n).revokeAccessToken(e)}async function hq(n){return Ne(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new vo("enroll",e,t)}static _fromMfaPendingCredential(e){return new vo("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return vo._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return vo._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Xt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>hc._fromServerResponse(r,a));_e(s.mfaPendingCredential,r,"internal-error");const o=vo._fromMfaPendingCredential(s.mfaPendingCredential);return new Tg(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await Ar._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return _e(t.user,r,"internal-error"),Ar._forOperation(t.user,t.operationType,c);default:lr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function fq(n,e){var t;const r=Ne(n),s=e;return _e(e.customData.operationType,r,"argument-error"),_e((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Tg._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Lt(n,e))}function yN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Lt(n,e))}function _N(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Lt(n,e))}function bN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Lt(n,e))}function wN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Lt(n,e))}class xg{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>hc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new xg(e)}async getSession(){return vo._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Vs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Vs(this.user,wN(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Vf=new WeakMap;function pq(n){const e=Ne(n);return Vf.has(e)||Vf.set(e,xg._fromUser(e)),Vf.get(e)}const Hd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Hd,"1"),this.storage.removeItem(Hd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IN=1e3,EN=10;class VE extends NE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bE(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);c2()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,EN):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},IN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}VE.type="LOCAL";const OE=VE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME extends NE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ME.type="SESSION";const LE=ME;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TN(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new jh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await TN(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}jh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=qh("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===c)switch(m.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hn(){return window}function AN(n){hn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(){return typeof hn().WorkerGlobalScope<"u"&&typeof hn().importScripts=="function"}async function SN(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function PN(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function RN(){return Ag()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FE="firebaseLocalStorageDb",CN=1,Wd="firebaseLocalStorage",$E="fbase_key";class fc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Bh(n,e){return n.transaction([Wd],e?"readwrite":"readonly").objectStore(Wd)}function kN(){const n=indexedDB.deleteDatabase(FE);return new fc(n).toPromise()}function Dp(){const n=indexedDB.open(FE,CN);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Wd,{keyPath:$E})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Wd)?e(r):(r.close(),await kN(),e(await Dp()))})})}async function O_(n,e,t){const r=Bh(n,!0).put({[$E]:e,value:t});return new fc(r).toPromise()}async function DN(n,e){const t=Bh(n,!1).get(e),r=await new fc(t).toPromise();return r===void 0?null:r.value}function M_(n,e){const t=Bh(n,!0).delete(e);return new fc(t).toPromise()}const NN=800,VN=3;class UE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Dp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>VN)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ag()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=jh._getInstance(RN()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await SN(),!this.activeServiceWorker)return;this.sender=new xN(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||PN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Dp();return await O_(e,Hd,"1"),await M_(e,Hd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>O_(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>DN(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>M_(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Bh(s,!1).getAll();return new fc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),NN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}UE.type="LOCAL";const ON=UE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MN(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:start",Lt(n,e))}function LN(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Lt(n,e))}function FN(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $N=500,UN=6e4,Wc=1e12;class jN{constructor(e){this.auth=e,this.counter=Wc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new qN(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Wc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Wc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Wc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class qN{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;_e(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=BN(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},UN)},$N))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function BN(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Of=IE("rcb"),zN=new lc(3e4,6e4);class KN{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=hn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return _e(GN(t),e,"argument-error"),this.shouldResolveImmediately(t)&&x_(hn().grecaptcha)?Promise.resolve(hn().grecaptcha):new Promise((r,s)=>{const i=hn().setTimeout(()=>{s(Yn(e,"network-request-failed"))},zN.get());hn()[Of]=()=>{hn().clearTimeout(i),delete hn()[Of];const a=hn().grecaptcha;if(!a||!x_(a)){s(Yn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${v2()}?${tl({onload:Of,render:"explicit",hl:t})}`;yg(o).catch(()=>{clearTimeout(i),s(Yn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=hn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function GN(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class HN{async load(e){return new jN(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jE="recaptcha",WN={theme:"light",type:"image"};class mq{constructor(e,t,r=Object.assign({},WN)){this.parameters=r,this.type=jE,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Xt(e),this.isInvisible=this.parameters.size==="invisible",_e(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;_e(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new HN:new KN,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){_e(!this.parameters.sitekey,this.auth,"argument-error"),_e(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),_e(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=hn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){_e(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){_e(mg()&&!Ag(),this.auth,"internal-error"),await QN(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await ZD(this.auth);_e(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return _e(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function QN(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Eo._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function gq(n,e,t){if(tn(n.app))return Promise.reject(In(n));const r=Xt(n),s=await zh(r,e,Ne(t));return new Sg(s,i=>bg(r,i))}async function vq(n,e,t){const r=Ne(n);await $h(!1,r,"phone");const s=await zh(r.auth,e,Ne(t));return new Sg(s,i=>Q2(r,i))}async function yq(n,e,t){const r=Ne(n);if(tn(r.auth.app))return Promise.reject(In(r.auth));const s=await zh(r.auth,e,Ne(t));return new Sg(s,i=>J2(r,i))}async function zh(n,e,t){var r;const s=await t.verify();try{_e(typeof s=="string",n,"argument-error"),_e(t.type===jE,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return _e(o.type==="enroll",n,"internal-error"),(await vN(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{_e(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return _e(a,n,"missing-multi-factor-info"),(await MN(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await $2(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function _q(n,e){const t=Ne(n);if(tn(t.auth.app))return Promise.reject(In(t.auth));await _g(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e){this.providerId=ka.PROVIDER_ID,this.auth=Xt(e)}verifyPhoneNumber(e,t){return zh(this.auth,e,Ne(t))}static credential(e,t){return Eo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ka.credentialFromTaggedObject(t)}static credentialFromError(e){return ka.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Eo._fromTokenResponse(t,r):null}}ka.PROVIDER_ID="phone";ka.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bo(n,e){return e?Is(e):(_e(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg extends cc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ss(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ss(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ss(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function JN(n){return CE(n.auth,new Pg(n),n.bypassAuthState)}function YN(n){const{auth:e,user:t}=n;return _e(t,e,"internal-error"),RE(t,new Pg(n),n.bypassAuthState)}async function XN(n){const{auth:e,user:t}=n;return _e(t,e,"internal-error"),_g(t,new Pg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return JN;case"linkViaPopup":case"linkViaRedirect":return XN;case"reauthViaPopup":case"reauthViaRedirect":return YN;default:lr(this.auth,"internal-error")}}resolve(e){Ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ns(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN=new lc(2e3,1e4);async function bq(n,e,t){if(tn(n.app))return Promise.reject(Yn(n,"operation-not-supported-in-this-environment"));const r=Xt(n);ml(n,e,qs);const s=Bo(r,t);return new Es(r,"signInViaPopup",e,s).executeNotNull()}async function wq(n,e,t){const r=Ne(n);if(tn(r.auth.app))return Promise.reject(Yn(r.auth,"operation-not-supported-in-this-environment"));ml(r.auth,e,qs);const s=Bo(r.auth,t);return new Es(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function Iq(n,e,t){const r=Ne(n);ml(r.auth,e,qs);const s=Bo(r.auth,t);return new Es(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Es extends qE{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Es.currentPopupAction&&Es.currentPopupAction.cancel(),Es.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _e(e,this.auth,"internal-error"),e}async onExecution(){Ns(this.filter.length===1,"Popup operations only handle one event");const e=qh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Yn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Yn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Es.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Yn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,ZN.get())};e()}}Es.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eV="pendingRedirect",md=new Map;class tV extends qE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=md.get(this.auth._key());if(!e){try{const r=await nV(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}md.set(this.auth._key(),e)}return this.bypassAuthState||md.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nV(n,e){const t=zE(e),r=BE(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function Rg(n,e){return BE(n)._set(zE(e),"true")}function rV(n,e){md.set(n._key(),e)}function BE(n){return Is(n._redirectPersistence)}function zE(n){return fd(eV,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eq(n,e,t){return sV(n,e,t)}async function sV(n,e,t){if(tn(n.app))return Promise.reject(In(n));const r=Xt(n);ml(n,e,qs),await r._initializationPromise;const s=Bo(r,t);return await Rg(s,r),s._openRedirect(r,e,"signInViaRedirect")}function Tq(n,e,t){return iV(n,e,t)}async function iV(n,e,t){const r=Ne(n);if(ml(r.auth,e,qs),tn(r.auth.app))return Promise.reject(In(r.auth));await r.auth._initializationPromise;const s=Bo(r.auth,t);await Rg(s,r.auth);const i=await GE(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function xq(n,e,t){return oV(n,e,t)}async function oV(n,e,t){const r=Ne(n);ml(r.auth,e,qs),await r.auth._initializationPromise;const s=Bo(r.auth,t);await $h(!1,r,e.providerId),await Rg(s,r.auth);const i=await GE(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function Aq(n,e){return await Xt(n)._initializationPromise,KE(n,e,!1)}async function KE(n,e,t=!1){if(tn(n.app))return Promise.reject(In(n));const r=Xt(n),s=Bo(r,e),o=await new tV(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function GE(n){const e=qh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aV=10*60*1e3;class lV{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!uV(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!HE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Yn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=aV&&this.cachedEventUids.clear(),this.cachedEventUids.has(L_(e))}saveEventToCache(e){this.cachedEventUids.add(L_(e)),this.lastProcessedEventTime=Date.now()}}function L_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function HE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function uV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return HE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cV(n,e={}){return Ft(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hV=/^https?/;async function fV(n){if(n.config.emulator)return;const{authorizedDomains:e}=await cV(n);for(const t of e)try{if(pV(t))return}catch{}lr(n,"unauthorized-domain")}function pV(n){const e=Ou(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!hV.test(t))return!1;if(dV.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mV=new lc(3e4,6e4);function F_(){const n=hn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function gV(n){return new Promise((e,t)=>{var r,s,i;function o(){F_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{F_(),t(Yn(n,"network-request-failed"))},timeout:mV.get()})}if(!((s=(r=hn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=hn().gapi)===null||i===void 0)&&i.load)o();else{const a=IE("iframefcb");return hn()[a]=()=>{gapi.load?o():t(Yn(n,"network-request-failed"))},yg(`${_2()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw gd=null,e})}let gd=null;function vV(n){return gd=gd||gV(n),gd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yV=new lc(5e3,15e3),_V="__/auth/iframe",bV="emulator/auth/iframe",wV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},IV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function EV(n){const e=n.config;_e(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?gg(e,bV):`https://${n.config.authDomain}/${_V}`,r={apiKey:e.apiKey,appName:n.name,v:nl},s=IV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${tl(r).slice(1)}`}async function TV(n){const e=await vV(n),t=hn().gapi;return _e(t,n,"internal-error"),e.open({where:document.body,url:EV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:wV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Yn(n,"network-request-failed"),a=hn().setTimeout(()=>{i(o)},yV.get());function l(){hn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},AV=500,SV=600,PV="_blank",RV="http://localhost";class $_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function CV(n,e,t,r=AV,s=SV){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},xV),{width:r.toString(),height:s.toString(),top:i,left:o}),c=gn().toLowerCase();t&&(a=mE(c)?PV:t),fE(c)&&(e=e||RV,l.scrollbars="yes");const d=Object.entries(l).reduce((m,[y,T])=>`${m}${y}=${T},`,"");if(u2(c)&&a!=="_self")return kV(e||"",a),new $_(null);const f=window.open(e||"",a,d);_e(f,n,"popup-blocked");try{f.focus()}catch{}return new $_(f)}function kV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DV="__/auth/handler",NV="emulator/auth/handler",VV=encodeURIComponent("fac");async function U_(n,e,t,r,s,i){_e(n.config.authDomain,n,"auth-domain-config-required"),_e(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:nl,eventId:s};if(e instanceof qs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",JP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof gl){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${VV}=${encodeURIComponent(l)}`:"";return`${OV(n)}?${tl(a).slice(1)}${c}`}function OV({config:n}){return n.emulator?gg(n,NV):`https://${n.authDomain}/${DV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mf="webStorageSupport";class MV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=LE,this._completeRedirectFn=KE,this._overrideRedirectResult=rV}async _openPopup(e,t,r,s){var i;Ns((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await U_(e,t,r,Ou(),s);return CV(e,o,qh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await U_(e,t,r,Ou(),s);return AN(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Ns(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await TV(e),r=new lV(e);return t.register("authEvent",s=>(_e(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Mf,{type:Mf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Mf];o!==void 0&&t(!!o),lr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=fV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return bE()||pE()||vg()}}const LV=MV;class WE{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Yr("unexpected MultiFactorSessionType")}}}class Cg extends WE{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Cg(e)}_finalizeEnroll(e,t,r){return yN(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return LN(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class FV{constructor(){}static assertion(e){return Cg._fromCredential(e)}}FV.FACTOR_ID="phone";class $V{static assertionForEnrollment(e,t){return Uu._fromSecret(e,t)}static assertionForSignIn(e,t){return Uu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;_e(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await _N(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return kg._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}$V.FACTOR_ID="totp";class Uu extends WE{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Uu(t,void 0,e)}static _fromEnrollmentId(e,t){return new Uu(t,e)}async _finalizeEnroll(e,t,r){return _e(typeof this.secret<"u",e,"argument-error"),bN(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){_e(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return FN(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class kg{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new kg(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Qc(e)||Qc(t))&&(s=!0),s&&(Qc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Qc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Qc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var j_="@firebase/auth",q_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_e(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function qV(n){rs(new $r("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;_e(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wE(n)},c=new m2(r,s,i,l);return T2(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),rs(new $r("auth-internal",e=>{const t=Xt(e.getProvider("auth").getImmediate());return(r=>new UV(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Er(j_,q_,jV(n)),Er(j_,q_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BV=5*60,zV=Rb("authIdTokenMaxAge")||BV;let B_=null;const KV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>zV)return;const s=t==null?void 0:t.token;B_!==s&&(B_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function GV(n=dm()){const e=Vi(n,"auth");if(e.isInitialized())return e.getImmediate();const t=E2(n,{popupRedirectResolver:LV,persistence:[ON,OE,LE]}),r=Rb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=KV(i.toString());pN(t,o,()=>o(t.currentUser)),fN(t,a=>o(a))}}const s=Sb("auth");return s&&x2(t,`http://${s}`),t}function HV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}g2({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Yn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",HV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});qV("Browser");const WV={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Kh=Vb(WV),se=_D(Kh),Pt=GV(Kh);try{bD(se)}catch{}try{hN(Pt,OE)}catch{}mN(Pt,n=>{n||W2(Pt)});async function QV(n,e){try{return(await tN(Pt,n,e)).user}catch(t){throw t}}async function QE(n,e){try{return(await nN(Pt,n,e)).user}catch(t){throw t}}async function JE(n){try{await X2(Pt,n)}catch(e){throw e}}async function JV(n){try{const e=Pt.currentUser;if(e)await oN(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const _i=Object.freeze(Object.defineProperty({__proto__:null,app:Kh,auth:Pt,createPlayerAccount:QV,db:se,resetPlayerPassword:JE,signInPlayer:QE,updatePlayerPassword:JV},Symbol.toStringTag,{value:"Module"})),vl="seasons";async function YV(n,e,t){return await pl(We(se,vl),{name:n,slug:e,pinCode:t,createdAt:Ui()})}async function XV(n){return await Xa(Ae(se,vl,n))}async function Lf(){const n=Vu(We(se,vl),SD("createdAt","desc"));return(await vt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Qd(n,e){const t=await pn(Ae(se,vl,n));return t.exists()?t.data().pinCode===e:!1}async function Np(n){const e=await pn(Ae(se,vl,n));return e.exists()?e.data().pinCode:null}async function ql(n,e){const t=Ae(se,vl,n);await fl(t,{sortOrder:e})}const Ff=7*24*60*60*1e3,Bl="impro_selector_pin_session";class ZV{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Bl);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Ff){try{t.timestamp=Date.now(),localStorage.setItem(Bl,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Bl,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Ff;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Bl,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Bl),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Ff-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Tn=new ZV,eO={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},tO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},nO={class:"text-center mb-6"},rO={class:"text-gray-300"},sO={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},iO={class:"text-sm text-green-400"},oO={class:"mb-6"},aO={class:"mb-4"},lO={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},uO={class:"flex justify-end space-x-3"},cO=["disabled"],YE={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(""),o=N(null);Ot(()=>t.show,d=>{d&&(s.value="",i.value="",dn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(F(),$("div",eO,[h("div",tO,[h("div",nO,[f[1]||(f[1]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),h("p",rO,ie(n.message),1),n.sessionInfo?(F(),$("div",sO,[h("p",iO," Session active : "+ie(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ce("",!0)]),h("div",oO,[h("div",aO,[f[3]||(f[3]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),Ze(h("input",{"onUpdate:modelValue":f[0]||(f[0]=m=>s.value=m),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Mn(l,["enter"]),Mn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[St,s.value]])]),f[4]||(f[4]=h("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(F(),$("div",lO,ie(i.value||t.error),1)):ce("",!0),h("div",uO,[h("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,cO)])])])):ce("",!0)}},dO={class:"relative p-6 pb-4 border-b border-white/10"},hO={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},XE={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Vt(()=>{},["stop"]))},[h("div",dO,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),h("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=rr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),h("div",hO,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},fO=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function pO(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function ZE(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function mO(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function eT(n){if(!n)return!1;const e=String(n).toLowerCase();return fO.some(t=>e.includes(t.toLowerCase()))}function Vp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?mO(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>Vp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=eT(t)?"••••":Vp(r);return e}return n}function gO(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&eT(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(Vp(r))}return e}const vO=ZE(pO());function Jc(n,e){const t=ZE(n);return(...r)=>{if(t<vO)return;const s=gO(r);console[e](...s)}}const ve={debug:Jc("debug","log"),info:Jc("info","info"),warn:Jc("warn","warn"),error:Jc("error","error")};let Bn="mock",bi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Vo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function tT(n){Bn=n}async function yO(){if(Bn!=="firebase"||!(await vt(We(se,"seasons"))).empty)return;const e=Ae(We(se,"seasons"));await fn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Ui()});const t=await vt(We(se,"players"));for(const o of t.docs)await fn(Ae(e,"players",o.id),o.data());const r=await vt(We(se,"events"));for(const o of r.docs)await fn(Ae(e,"events",o.id),o.data());const s=await vt(We(se,"availability"));for(const o of s.docs)await fn(Ae(e,"availability",o.id),o.data());const i=await vt(We(se,"selections"));for(const o of i.docs)await fn(Ae(e,"selections",o.id),o.data())}async function _O(){Bn==="firebase"&&await yO()}async function Op(n=null){return(Bn==="firebase"?n?(await vt(We(se,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await vt(We(se,"events"))).docs.map(t=>({id:t.id,...t.data()})):Vo).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function vd(n=null){return(Bn==="firebase"?n?(await vt(We(se,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await vt(We(se,"players"))).docs.map(t=>({id:t.id,...t.data()})):bi).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function nT(n,e=null){if(Bn==="firebase"){const t=Ae(e?We(se,"seasons",e,"players"):We(se,"players"));return await fn(t,{name:n}),t.id}else{const t=`p${bi.length+1}`;return bi.push({id:t,name:n}),t}}async function bO(n,e=null){if(Bn==="firebase"){const t=e?Ae(se,"seasons",e,"players",n):Ae(se,"players",n);await Xa(t);const r=e?await vt(We(se,"seasons",e,"availability")):await vt(We(se,"availability")),s=cg(se);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else bi=bi.filter(t=>t.id!==n)}async function wO(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(se,"seasons",t,"players",n):Ae(se,"players",n),s=await pn(r),i=s.exists()&&s.data().name||null;if(await fn(r,{name:e},{merge:!0}),i&&i!==e){const o=cg(se);try{const a=t?Ae(se,"seasons",t,"availability",i):Ae(se,"availability",i),l=await pn(a);if(l.exists()){const c=l.data()||{},d=t?Ae(se,"seasons",t,"availability",e):Ae(se,"availability",e);o.set(d,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?We(se,"seasons",t,"selections"):We(se,"selections");(await vt(a)).forEach(c=>{var f;const d=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(d.includes(i)){const m=d.map(y=>y===i?e:y);o.update(c.ref,{players:m})}})}catch{}await o.commit()}}else{const r=bi.findIndex(s=>s.id===n);r!==-1&&(bi[r]={...bi[r],name:e})}}async function uo(n,e,t=null){if(Bn==="firebase"){const r=t?await vt(We(se,"seasons",t,"availability")):await vt(We(se,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function co(n=null){if(Bn==="firebase"){const e=n?await vt(We(se,"seasons",n,"selections")):await vt(We(se,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function z_(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(se,"seasons",t,"availability",n):Ae(se,"availability",n);await fn(r,e)}}async function IO({seasonId:n,playerName:e,eventId:t,value:r}){if(Bn!=="firebase")return;const s=n?Ae(se,"seasons",n,"availability",e):Ae(se,"availability",e),i=await pn(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await fn(s,a)}async function K_(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(se,"seasons",t,"selections",n):Ae(se,"selections",n);await fn(r,{players:e})}}async function EO(n,e=null){if(ve.info("Suppression de l'événement",{eventId:n}),Bn==="firebase")try{ve.debug("Suppression de l'événement dans Firestore");const t=e?Ae(se,"seasons",e,"events",n):Ae(se,"events",n);await Xa(t),ve.debug("Suppression de la sélection associée");const r=e?Ae(se,"seasons",e,"selections",n):Ae(se,"selections",n);await Xa(r),ve.debug("Suppression des disponibilités");const s=e?await vt(We(se,"seasons",e,"availability")):await vt(We(se,"availability")),i=cg(se);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){ve.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),ve.info("Opérations de suppression terminées avec succès")}catch(t){throw ve.error("Erreur lors de la suppression",t),t}else Vo=Vo.filter(t=>t.id!==n)}async function TO(n,e=null){if(Bn==="firebase"){const t=Ae(e?We(se,"seasons",e,"events"):We(se,"events"));return await fn(t,n),t.id}else{const t=`event${Vo.length+1}`;return Vo.push({id:t,...n}),t}}async function G_(n,e,t=null){if(Bn==="firebase"){const r=t?Ae(se,"seasons",t,"events",n):Ae(se,"events",n);await fn(r,e,{merge:!0})}else{const r=Vo.findIndex(s=>s.id===n);r!==-1&&(Vo[r]={id:n,...e})}}const xO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},AO={class:"text-center py-16 px-4 relative"},SO=["aria-busy"],PO={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},RO={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},CO=["onClick"],kO={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},DO={class:"absolute top-4 right-4"},NO=["onClick","aria-expanded"],VO={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},OO=["onClick"],MO=["onClick"],LO=["onClick"],FO=["onClick"],$O={key:2,class:"flex justify-center mt-12"},UO={key:3,class:"text-center py-16"},jO={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},qO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},BO={class:"mb-6"},zO={class:"mb-6"},KO={class:"mb-6"},GO={class:"flex justify-end space-x-3"},HO=["disabled"],WO={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},QO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},JO={class:"text-center mb-6"},YO={class:"text-gray-300"},XO={__name:"Home",setup(n){const e=N([]),t=N(!0),r=Hu(),s=N(null),i=N(!1),o=N(!1),a=N(""),l=N(""),c=N(""),d=N(null),f=N(!1),m=N(null),y=N(""),T=N(!1);sr(async()=>{var k;try{e.value=await Lf(),ve.info("Saisons chargées",{count:((k=e.value)==null?void 0:k.length)||0}),D().catch(L=>ve.error("Migration sortOrder échouée",L))}finally{t.value=!1}});const x=qe(()=>[...e.value].sort((k,L)=>{var E,A;const J=typeof k.sortOrder=="number"?k.sortOrder:Number.MAX_SAFE_INTEGER,Z=typeof L.sortOrder=="number"?L.sortOrder:Number.MAX_SAFE_INTEGER;if(J!==Z)return J-Z;const Ce=(E=k.createdAt)!=null&&E.toMillis?k.createdAt.toMillis():0,$e=(A=L.createdAt)!=null&&A.toMillis?L.createdAt.toMillis():0;return Ce!==$e?$e-Ce:(k.name||"").localeCompare(L.name||"")}));function P(k){r.push(`/season/${k}`)}function U(k){s.value=s.value===k?null:k}function j(){s.value=null}async function D(){if(!e.value.length)return;const k=e.value.map(J=>typeof J.sortOrder=="number"?J.sortOrder:null).filter(J=>J!==null);let L=k.length?Math.max(...k):0;for(const J of e.value)if(typeof J.sortOrder!="number"){L+=1;try{await ql(J.id,L),J.sortOrder=L}catch(Z){ve.error("Erreur migration sortOrder",{seasonName:J==null?void 0:J.name,error:Z})}}}async function K(k){try{if(!(k!=null&&k.id)){alert("Saison introuvable");return}const[L,J]=await Promise.all([Op(k.id),vd(k.id)]),[Z,Ce]=await Promise.all([uo(J,L,k.id),co(k.id)]),$e=["Joueur",...L.map(he=>de(he))],E=[];for(const he of J){const fe=(he==null?void 0:he.name)||"",ue=(Z==null?void 0:Z[fe])||{},xe=[fe,...L.map(Ie=>O(ue[Ie.id],Ce==null?void 0:Ce[Ie.id],fe))];E.push(xe)}const A=I([$e,...E]),M=new Blob(["\uFEFF"+A],{type:"text/csv;charset=utf-8;"}),ee=(k==null?void 0:k.name)||(k==null?void 0:k.slug)||"saison",Y=`${C(ee)}-disponibilites.csv`,te=URL.createObjectURL(M),ye=document.createElement("a");ye.href=te,ye.download=Y,document.body.appendChild(ye),ye.click(),document.body.removeChild(ye),URL.revokeObjectURL(te),ve.info("Export CSV saison",{seasonId:k.id,events:L.length,players:J.length})}catch(L){ve.error("Erreur export CSV",L),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function X(k){if(!k)return null;if(k instanceof Date)return k;if(typeof(k==null?void 0:k.toDate)=="function")return k.toDate();if(typeof k=="string"||typeof k=="number"){const L=new Date(k);return isNaN(L.getTime())?null:L}return null}function de(k){const L=X(k==null?void 0:k.date),J=L?`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}-${String(L.getDate()).padStart(2,"0")}`:"",Z=(k==null?void 0:k.title)||"Sans titre";return`${J} · ${Z}`.trim()}function S(k){return k===!0||k==="oui"?"disponible":k===!1||k==="non"?"non disponible":""}function I(k){return k.map(L=>L.map(w).join(",")).join(`
`)}function w(k){const L=String(k??"");return/[",\n\r]/.test(L)?'"'+L.replace(/"/g,'""')+'"':L}function C(k){return String(k||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function O(k,L,J){return Array.isArray(L)&&L.includes(J)?k===!1||k==="non"?"non disponible":"sélectionné":S(k)}async function q(k){if(j(),k<=0)return;const L=[...x.value],J=L[k],Z=L[k-1],Ce=J.sortOrder;J.sortOrder=Z.sortOrder,Z.sortOrder=Ce;try{await Promise.all([ql(J.id,J.sortOrder),ql(Z.id,Z.sortOrder)])}catch($e){ve.error("Erreur lors du déplacement vers le haut",$e)}}async function R(k){j();const L=[...x.value];if(k>=L.length-1)return;const J=L[k],Z=L[k+1],Ce=J.sortOrder;J.sortOrder=Z.sortOrder,Z.sortOrder=Ce;try{await Promise.all([ql(J.id,J.sortOrder),ql(Z.id,Z.sortOrder)])}catch($e){ve.error("Erreur lors du déplacement vers le bas",$e)}}function It(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function De(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function ge(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await YV(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await Lf(),await D(),Ee()}catch(k){ve.error("Erreur lors de la création de la saison",k),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function Ee(){i.value=!1,a.value="",l.value="",c.value=""}function Fe(k){d.value=k,o.value=!0}async function Bt(){o.value=!1,await pe({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function Wt(){o.value=!1,d.value=null}function bt(){return m.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[m.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function pe(k){if(Tn.isPinCached(d.value.id)){const L=Tn.getCachedPin(d.value.id);if(ve.debug("PIN en cache trouvé, utilisation automatique"),await Qd(d.value.id,L)){await ht(k);return}else Tn.clearSession()}m.value=k,f.value=!0}async function le(k){var L,J,Z,Ce;ve.debug("PIN soumis pour l'opération",{operationType:(L=m.value)==null?void 0:L.type});try{const $e=((Z=(J=m.value)==null?void 0:J.data)==null?void 0:Z.seasonId)||((Ce=d.value)==null?void 0:Ce.id),E=await Qd($e,k);if(ve.debug("PIN validé",{valid:E}),E){Tn.saveSession($e,k),ve.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const A=m.value;m.value=null,ve.debug("Appel de executePendingOperation",{operationType:A==null?void 0:A.type}),await ht(A)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch($e){ve.error("Erreur lors de la vérification du PIN",$e),y.value="Erreur lors de la vérification du code PIN"}}function Ge(){f.value=!1,m.value=null,y.value=""}function st(){return d.value&&Tn.isPinCached(d.value.id)?{timeRemaining:Tn.getTimeRemaining(),isExpiringSoon:Tn.isExpiringSoon()}:null}async function ht(k){var Z;if(ve.debug("executePendingOperation appelé",{hasOperation:!!k}),!k){ve.warn("Aucune opération à exécuter");return}const{type:L,data:J}=k;ve.info("Exécution de l'opération",{type:L});try{switch(L){case"deleteSeason":ve.info("Suppression de la saison",{seasonId:J.seasonId}),await XV(J.seasonId),ve.info("Saison supprimée, rechargement de la liste"),e.value=await Lf(),ve.info("Liste des saisons rechargée",{count:((Z=e.value)==null?void 0:Z.length)||0});break;default:ve.warn("Type d'opération non reconnu",{type:L})}}catch(Ce){ve.error("Erreur lors de l'exécution de l'opération",Ce),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(k,L)=>{var J;return F(),$("div",xO,[h("div",AO,[h("button",{onClick:L[0]||(L[0]=Z=>T.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},L[8]||(L[8]=[h("span",{class:"text-2xl"},"❓",-1)])),L[9]||(L[9]=h("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Tu joues quand ? ",-1)),L[10]||(L[10]=h("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui sera sur scène quand. Laissez chacun indiquer ses dispos et le hasard choisir pour vous !",-1))]),h("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(F(),$("div",PO,[(F(),$(gt,null,dr(8,Z=>h("div",{key:"skeleton-"+Z,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},L[11]||(L[11]=[h("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),h("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),h("div",{class:"h-px bg-white/10 mb-4"},null,-1),h("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(F(),$("div",RO,[(F(!0),$(gt,null,dr(x.value,(Z,Ce)=>(F(),$("div",{key:Z.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[h("div",{onClick:$e=>P(Z.slug),class:"text-center cursor-pointer"},[L[12]||(L[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[h("span",{class:"text-2xl"},"🎭")],-1)),h("h2",kO,ie(Z.name),1),L[13]||(L[13]=h("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),L[14]||(L[14]=h("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,CO),h("div",DO,[h("div",{class:"relative",onClick:L[1]||(L[1]=Vt(()=>{},["stop"]))},[h("button",{onClick:$e=>U(Ce),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Ce,"aria-haspopup":"true",title:"Options"},L[15]||(L[15]=[h("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,NO),s.value===Ce?(F(),$("div",VO,[h("button",{onClick:$e=>{K(Z),j()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,OO),L[16]||(L[16]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:$e=>q(Ce),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,MO),h("button",{onClick:$e=>R(Ce),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,LO),L[17]||(L[17]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:$e=>Fe(Z),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,FO)])):ce("",!0)])])]))),128))])):ce("",!0),!t.value&&e.value.length>0?(F(),$("div",$O,[h("button",{onClick:L[2]||(L[2]=Z=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):ce("",!0),!t.value&&e.value.length===0?(F(),$("div",UO,[L[18]||(L[18]=h("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-4xl"},"🎪")],-1)),L[19]||(L[19]=h("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),L[20]||(L[20]=h("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),h("button",{onClick:L[3]||(L[3]=Z=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ce("",!0)],8,SO),i.value?(F(),$("div",jO,[h("div",qO,[L[25]||(L[25]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),h("div",BO,[L[21]||(L[21]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),Ze(h("input",{"onUpdate:modelValue":L[4]||(L[4]=Z=>a.value=Z),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:It},null,544),[[St,a.value]])]),h("div",zO,[L[22]||(L[22]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),Ze(h("input",{"onUpdate:modelValue":L[5]||(L[5]=Z=>l.value=Z),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[St,l.value]])]),h("div",KO,[L[23]||(L[23]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),Ze(h("input",{"onUpdate:modelValue":L[6]||(L[6]=Z=>c.value=Z),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:De},null,544),[[St,c.value]]),L[24]||(L[24]=h("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),h("div",GO,[h("button",{onClick:Ee,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ge,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,HO)])])])):ce("",!0),o.value?(F(),$("div",WO,[h("div",QO,[h("div",JO,[L[26]||(L[26]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"⚠️")],-1)),L[27]||(L[27]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",YO,'Êtes-vous sûr de vouloir supprimer la saison "'+ie((J=d.value)==null?void 0:J.name)+'" ?',1)]),L[28]||(L[28]=h("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Wt,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Bt,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),lt(YE,{show:f.value,message:bt(),error:y.value,"session-info":st(),onSubmit:le,onCancel:Ge},null,8,["show","message","error","session-info"]),lt(XE,{show:T.value,onClose:L[7]||(L[7]=Z=>T.value=!1)},null,8,["show"]),L[29]||(L[29]=rr('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},Gh="magicLinks";function Hh({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function Dg(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Mp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Hh({seasonId:n,playerId:e,eventId:t,action:r}),i=Dg(40),o=Ae(se,Gh,s),a=Date.now()+1e3*60*60*24*7;await fn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function rT({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Hh({seasonId:n,playerId:e,eventId:r,action:s}),o=Dg(40),a=Ae(se,Gh,i),l=Date.now()+1e3*60*60*24*7;await fn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function sT({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Hh({seasonId:n,playerId:e,eventId:t,action:s}),o=Ae(se,Gh,i),a=await pn(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Lp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Hh({seasonId:n,playerId:e,eventId:t,action:r}),i=Ae(se,Gh,s);await Xa(i)}const Ng="accountMagicLinks";function Wh(n){return`account__${n}`}async function iT({currentEmail:n,newEmail:e}){const t=Dg(40),r=Wh(t),s=Ae(se,Ng,r),i=Date.now()+1e3*60*60*24*7;await fn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function oT({token:n}){const e=Wh(n),t=Ae(se,Ng,e),r=await pn(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function aT({token:n}){const e=Wh(n),t=Ae(se,Ng,e);await Xa(t)}const ZO=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Wh,consumeAccountEmailUpdateLink:aT,consumeMagicLink:Lp,createAccountEmailUpdateLink:iT,createEmailVerificationLink:rT,createMagicLink:Mp,verifyAccountEmailUpdateLink:oT,verifyMagicLink:sT},Symbol.toStringTag,{value:"Module"})),H_="impro_selector_trusted_players",W_=180*24*60*60*1e3;class eM{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(H_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(H_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<W_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>W_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Di=new eM;function Vg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function lT(n){return`seasonPreferredPlayer:${n||"global"}`}function Fp(n,e){try{const t=lT(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function tM(n,e){try{const t=lT(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function uT(n,e,t,r=null){try{ve.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await yl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Jt(()=>import("./index.esm-93305b69.js"),[]),{db:c}=await Jt(()=>Promise.resolve().then(()=>_i),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),m=await l(f);if(!m.empty&&m.docs.find(D=>D.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");ve.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await Jt(()=>import("./index.esm-dfc6116a.js"),[]),{auth:T}=await Jt(()=>Promise.resolve().then(()=>_i),void 0),x=await y(T,e,t);ve.info("Compte Firebase Auth créé",{uid:x.user.uid});const P=Vg(t),U=r?Ae(c,"seasons",r,"playerProtection",n):Ae(c,"playerProtection",n);return await fn(U,{playerId:n,email:e,passwordHash:P,firebaseUid:x.user.uid,isProtected:!0,createdAt:new Date}),ve.info("Protection sauvegardée dans Firestore"),r&&Fp(r,n),{success:!0}}catch(s){throw ve.error("Erreur lors de la protection du joueur",s),s}}async function cT({playerId:n,email:e,seasonId:t=null}){const r=t?Ae(se,"seasons",t,"playerProtection",n):Ae(se,"playerProtection",n);(await pn(r)).exists()?await fl(r,{email:e,updatedAt:new Date}):await fn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await rT({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function dT({playerId:n,seasonId:e=null}){const t=e?Ae(se,"seasons",e,"playerProtection",n):Ae(se,"playerProtection",n);if(!(await pn(t)).exists())throw new Error("Protection introuvable");return await fl(t,{emailVerifiedAt:new Date}),{success:!0}}async function hT({playerId:n,seasonId:e=null}){const t=e?Ae(se,"seasons",e,"playerProtection",n):Ae(se,"playerProtection",n);return await fl(t,{emailVerifiedAt:null}),{success:!0}}async function fT(n,e=null){try{const t=e?Ae(se,"seasons",e,"playerProtection",n):Ae(se,"playerProtection",n);return await fn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&tM(e,n),{success:!0,email:""}}catch(t){throw ve.error("Erreur lors de la suppression de la protection",t),t}}async function wi(n,e=null){try{const t=e?Ae(se,"seasons",e,"playerProtection",n):Ae(se,"playerProtection",n),r=await pn(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return ve.error("Erreur lors de la vérification de protection",t),!1}}async function yl(n,e=null){try{const t=e?Ae(se,"seasons",e,"playerProtection",n):Ae(se,"playerProtection",n),r=await pn(t);return r.exists()?r.data():null}catch(t){return ve.error("Erreur lors de la récupération des données de protection",t),null}}async function pT(n,e=null){try{const t=await yl(n,e);return(t==null?void 0:t.email)||""}catch(t){return ve.error("Erreur lors de la récupération de l'email",t),""}}async function $p(n=null){try{const e=n?We(se,"seasons",n,"playerProtection"):We(se,"playerProtection");return(await vt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return ve.error("Erreur lors du chargement des protections",e),[]}}async function Og(n){try{const e=[],t=Vu(We(se,"playerProtection"),zd("email","==",n));(await vt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await vt(We(se,"seasons"));for(const i of s.docs){const o=i.id,a=Vu(We(se,"seasons",o,"playerProtection"),zd("email","==",n));(await vt(a)).forEach(c=>{var f;const d=c.data();d!=null&&d.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...d})})}return e}catch(e){return ve.error("Erreur listAssociationsForEmail",e),[]}}async function mT(n,e,t=null){try{const r=await yl(n,t);if(!r||!r.isProtected)return!1;if(r.email){ve.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Jt(()=>import("./index.esm-dfc6116a.js"),[]),{auth:i}=await Jt(()=>Promise.resolve().then(()=>_i),void 0);return await s(i,r.email,e),ve.debug("Mot de passe Firebase Auth valide"),Di.saveSession(n),t&&Fp(t,n),!0}catch(s){return ve.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{ve.debug("Vérification avec hash local");const s=Vg(e),i=r.passwordHash===s;return i&&(Di.saveSession(n),t&&Fp(t,n)),i}}catch(r){return ve.error("Erreur lors de la vérification du mot de passe",r),!1}}async function gT({playerId:n,seasonId:e=null}){const t=e?Ae(se,"seasons",e,"playerProtection",n):Ae(se,"playerProtection",n),r=await pn(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await fl(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function To(n){return Di.isPasswordCached(n)}function nM(n){return null}async function vT(n,e=null){try{ve.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await yl(n,e);if(ve.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(ve.debug("Email à utiliser (masqué)"),t.firebaseUid){ve.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Jt(()=>import("./index.esm-dfc6116a.js"),[]),{auth:s}=await Jt(()=>Promise.resolve().then(()=>_i),void 0);ve.debug("Tentative d'envoi d'email"),await r(s,t.email),ve.info("Email envoyé avec succès via Firebase Auth")}else{ve.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Jt(()=>import("./index.esm-dfc6116a.js"),[]),{auth:i}=await Jt(()=>Promise.resolve().then(()=>_i),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);ve.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),ve.info("Email envoyé avec succès");const{updateDoc:l}=await Jt(()=>import("./index.esm-93305b69.js"),[]),{db:c}=await Jt(()=>Promise.resolve().then(()=>_i),void 0),d=e?Ae(c,"seasons",e,"playerProtection",n):Ae(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")ve.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),ve.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw ve.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function rM(n,e,t=null){try{const r=Vg(e),s=t?Ae(se,"seasons",t,"playerProtection",n):Ae(se,"playerProtection",n);return await fl(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw ve.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function sM(n){return new Promise((e,t)=>{ve.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const pc=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:hT,finalizeProtectionAfterVerification:gT,getCachedPlayerPassword:nM,getPlayerEmail:pT,getPlayerProtectionData:yl,isPlayerPasswordCached:To,isPlayerProtected:wi,listAssociationsForEmail:Og,listProtectedPlayers:$p,markEmailVerifiedForProtection:dT,protectPlayer:uT,requirePlayerPasswordForAvailability:sM,sendPasswordResetEmail:vT,startEmailVerificationForProtection:cT,unprotectPlayer:fT,updatePlayerPasswordInFirestore:rM,verifyPlayerPassword:mT},Symbol.toStringTag,{value:"Module"}));async function Mg({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:Ui()};return await pl(We(se,"pushQueue"),i),{success:!0}}async function iM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){try{const f=Ae(se,"userPreferences",n),m=await pn(f);if(m.exists()){const y=m.data();if((y==null?void 0:y.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:c,html:l},createdAt:Ui(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await pl(We(se,"mail"),d),{success:!0}}async function yT({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",d=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,m={to:n,message:{subject:d,html:f},createdAt:Ui(),meta:{reason:t,displayName:r}};s&&(m.from=s,m.replyTo=s),await pl(We(se,"mail"),m)}async function oM({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return yT({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function aM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Ae(se,"userPreferences",n),m=await pn(f);if(m.exists()){const y=m.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}ve.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;ve.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:Ui(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),ve.debug("queueSelectionEmail firestore payload ready");try{await pl(We(se,"mail"),d);try{const f=Ae(se,"userPreferences",n),m=await pn(f),y=m.exists()?m.data():{};(y==null?void 0:y.notifySelectionPush)!==!1&&await Mg({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, ${t} le ${r}`,data:{url:s||window.location.origin}})}catch{}return ve.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw ve.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function lM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const y=Ae(se,"userPreferences",n),T=await pn(y);if(T.exists()){const x=T.data();if((x==null?void 0:x.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",d=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,m={to:n,message:{subject:f,html:d},createdAt:Ui(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}};l&&(m.from=l,m.replyTo=l),await pl(We(se,"mail"),m);try{const y=Ae(se,"userPreferences",n),T=await pn(y),x=T.exists()?T.data():{};(x==null?void 0:x.notifySelectionPush)!==!1&&await Mg({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus dans ${t} (${r})`,data:{url:s||window.location.origin},reason:"deselection"})}catch{}return{success:!0}}async function uM({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(ve.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await Jt(()=>Promise.resolve().then(()=>pc),void 0),{createMagicLink:a}=await Jt(()=>Promise.resolve().then(()=>ZO),void 0),l=`${window.location.origin}/season/${s}/event/${n}`,c=t.join(", "),d=`🎭 Sélection confirmée · ${e.title}`,f=[];for(const m of t){ve.debug("Traitement du joueur",{playerName:m});try{const y=i==null?void 0:i.find(D=>D.name===m);if(!y){ve.warn("Joueur non trouvé",{playerName:m});continue}ve.debug("Joueur trouvé");const T=await o(y.id,r);if(!T){ve.warn("Pas d'email pour le joueur",{playerName:m});continue}ve.debug("Email trouvé pour joueur");const P=`${(await a({seasonId:r,playerId:y.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,U=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${m}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${Jd(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${P}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;ve.debug("HTML généré pour joueur");const j=aM({toEmail:T,playerName:m,eventTitle:e.title,eventDate:Jd(e.date),eventUrl:l,html:U,subject:d});f.push(j),ve.info("Email ajouté à la queue",{playerName:m})}catch(y){ve.error("Erreur lors de l'envoi de l'email de sélection",{playerName:m,error:y})}}return ve.info("Nombre total d'emails à envoyer",{count:f.length}),await Promise.all(f),ve.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:f.length}}async function cM({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(ve.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await Jt(()=>Promise.resolve().then(()=>pc),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],d=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const m=o==null?void 0:o.find(x=>x.name===f);if(!m){ve.warn("Joueur retiré non trouvé",{playerName:f});continue}const y=await a(m.id,s);if(!y){ve.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const T=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${Jd(e.date)}) 😔.</p>
          ${d?`<p>Nouvelle sélection: <strong>${d}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(lM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:Jd(e.date),eventUrl:l,newSelectedPlayers:r,html:T}))}catch(m){ve.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:m})}return await Promise.all(c),ve.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function Jd(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const dM={class:"relative p-5 pb-4 border-b border-white/10"},hM={class:"text-xl md:text-2xl font-bold text-white pr-10"},fM={key:0,class:"text-sm text-purple-300 mt-1"},pM={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},mM={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},gM={class:"text-blue-200 text-sm"},vM={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},yM=["onClick"],_M={key:0,class:"space-y-4"},bM={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},wM={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},IM={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},EM={class:"text-blue-200 text-sm"},TM={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},xM={key:0,class:"space-y-2"},AM={class:"flex flex-wrap gap-2"},SM={key:1,class:"text-amber-400 text-sm"},PM={key:1,class:"space-y-4"},RM={class:"relative"},CM=["value"],kM=["title"],DM={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},NM={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},VM={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},OM=["disabled"],MM={key:0},LM={key:1},_T={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=N("email"),i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],d=qe(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=qe(()=>{if(!t.event)return"";const D=P(t.event.date);if(t.mode==="selection"){const K=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${D} : ${K}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${D}

Lien direct vers l'événement : ${d.value}

Merci de confirmer votre disponibilité.`}),m=qe(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const D=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${P(t.event.date)}).

Sélection complète : ${D}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${P(t.event.date)}) ?`}),y=N([]);async function T(){if(!t.seasonId)return;let D=[];t.mode==="selection"?D=t.players.filter(X=>t.selectedPlayers.includes(X.name)):D=t.players.filter(X=>X.isProtected);const K=[];for(const X of D)try{const{getPlayerEmail:de}=await Jt(()=>Promise.resolve().then(()=>pc),void 0),S=await de(X.id,t.seasonId);S&&K.push({...X,email:S})}catch(de){console.warn(`Impossible de charger l'email pour ${X.name}:`,de)}y.value=K}function x(){r("close")}function P(D){var X;return D?(typeof D=="string"?new Date(D):((X=D.toDate)==null?void 0:X.call(D))||D).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function U(){const D=f.value;navigator.clipboard.writeText(D).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(K=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}async function j(){if(!(!t.event||y.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return sr(()=>{t.show&&(s.value="email",T())}),Ot(()=>t.show,D=>{D&&(s.value="email",T())}),Ot(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&T()}),(D,K)=>n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:x},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:K[1]||(K[1]=Vt(()=>{},["stop"]))},[h("div",dM,[h("button",{onClick:x,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("h2",hM,ie(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(F(),$("p",fM,ie(n.event.title)+" — "+ie(P(n.event.date)),1)):ce("",!0)]),h("div",pM,[h("div",mM,[h("p",gM,ie(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),h("div",vM,[(F(),$(gt,null,dr(c,X=>h("button",{key:X.id,onClick:de=>s.value=X.id,class:Kt(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===X.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},ie(X.label),11,yM)),64))]),s.value==="email"?(F(),$("div",_M,[h("div",null,[K[2]||(K[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),h("div",bM,ie(m.value),1)]),h("div",null,[h("label",wM,[K[3]||(K[3]=Sn(" Destinataires ")),h("button",{onClick:K[0]||(K[0]=X=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(F(),$("div",IM,[h("p",EM,ie(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):ce("",!0),h("div",TM,[y.value.length>0?(F(),$("div",xM,[h("div",AM,[(F(!0),$(gt,null,dr(y.value,X=>(F(),$("span",{key:X.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},ie(X.name),1))),128))])])):(F(),$("div",SM," ⚠️ "+ie(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):ce("",!0),s.value==="copy"?(F(),$("div",PM,[K[6]||(K[6]=h("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[h("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),h("div",RM,[h("textarea",{value:f.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,CM),h("button",{onClick:U,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(F(),$("svg",NM,K[5]||(K[5]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(F(),$("svg",DM,K[4]||(K[4]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,kM)])])):ce("",!0)]),h("div",VM,[s.value==="email"?(F(),$("button",{key:0,onClick:j,disabled:y.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(F(),$("span",LM,"📧 Envoi en cours...")):(F(),$("span",MM,"📧 Envoyer les notifications email"))],8,OM)):ce("",!0),s.value==="copy"?(F(),$("button",{key:1,onClick:U,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):ce("",!0),h("button",{onClick:x,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ce("",!0)}},FM={class:"text-center mb-6"},$M={class:"text-lg text-gray-300"},UM={class:"mb-6"},jM={class:"space-y-4"},qM={class:"flex items-center gap-2 text-gray-300 text-sm"},BM=["disabled"],zM={key:0,class:"animate-spin"},KM={key:1},GM={class:"mb-6 text-center"},HM={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},WM={class:"text-red-300 text-sm"},QM={class:"text-center mb-6"},JM={class:"text-lg text-gray-300"},YM={class:"mb-6"},XM=["disabled"],ZM={key:0,class:"animate-spin"},eL={key:1},tL={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},nL={class:"text-red-300 text-sm"},rL={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},sL={class:"text-green-300 text-sm"},iL={class:"flex justify-center"},Lg={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(!1),o=N(""),a=N(!1),l=N(""),c=N(""),d=N(null),f=N(!0);async function m(){if(s.value){i.value=!0,o.value="";try{const x=await Np(t.seasonId);if(s.value===x){if(f.value)try{Di.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),T();return}if(await mT(t.player.id,s.value,t.seasonId)){if(f.value)try{Di.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),T()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(x){ve.error("Erreur lors de la vérification",x),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const x=await vT(t.player.id,t.seasonId);c.value=x.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(x){ve.error("Erreur lors de l'envoi de l'email",x),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function T(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Ot(()=>t.show,x=>{x&&dn(()=>{d.value&&d.value.focus()})}),(x,P)=>{var U,j;return F(),$(gt,null,[n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:T},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[3]||(P[3]=Vt(()=>{},["stop"]))},[h("div",FM,[P[7]||(P[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔐")],-1)),P[8]||(P[8]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),h("p",$M,ie((U=n.player)==null?void 0:U.name),1),P[9]||(P[9]=h("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),h("div",UM,[h("div",jM,[h("div",null,[P[10]||(P[10]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),Ze(h("input",{"onUpdate:modelValue":P[0]||(P[0]=D=>s.value=D),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Mn(m,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[St,s.value]])]),h("div",qM,[Ze(h("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":P[1]||(P[1]=D=>f.value=D),class:"w-4 h-4"},null,512),[[bo,f.value]]),P[11]||(P[11]=h("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),h("button",{onClick:m,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(F(),$("span",zM,"⏳")):(F(),$("span",KM,"🔓")),h("span",null,ie(i.value?"Vérification...":"Vérifier"),1)],8,BM)]),h("div",GM,[h("button",{onClick:P[2]||(P[2]=D=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(F(),$("div",HM,[h("div",WM,ie(o.value),1)])):ce("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),a.value?(F(),$("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:P[6]||(P[6]=D=>a.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[5]||(P[5]=Vt(()=>{},["stop"]))},[h("div",QM,[P[12]||(P[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"📧")],-1)),P[13]||(P[13]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),h("p",JM,ie((j=n.player)==null?void 0:j.name),1)]),h("div",YM,[P[14]||(P[14]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(F(),$("span",ZM,"⏳")):(F(),$("span",eL,"📧")),h("span",null,ie(i.value?"Envoi...":"Envoyer l'email"),1)],8,XM)]),l.value?(F(),$("div",tL,[h("div",nL,ie(l.value),1)])):ce("",!0),c.value?(F(),$("div",rL,[h("div",sL,ie(c.value),1)])):ce("",!0),h("div",iL,[h("button",{onClick:P[4]||(P[4]=D=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0)],64)}}},oL={class:"text-center mb-6"},aL={class:"text-sm text-gray-300"},lL={key:0,class:"space-y-4"},uL={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},cL={key:1,class:"space-y-4"},dL=["disabled"],hL={key:0,class:"animate-spin"},fL={key:1},pL={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},mL={class:"mt-6 flex justify-center gap-3"},gL=["disabled"],vL={key:0,class:"animate-spin"},yL={key:1},bT={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=N(1),i=N(""),o=N(""),a=N(""),l=N(!1),c=N(""),d=N(!1),f=el(),m=qe(()=>i.value&&i.value.includes("@")),y=qe(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function T(){var j,D,K;if(!(!m.value||!((j=t.player)!=null&&j.id))){l.value=!0,c.value="";try{const X=await cT({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),de=(D=f.params)==null?void 0:D.slug,S=`${X.url}${de?`&slug=${encodeURIComponent(de)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await oM({toEmail:i.value,playerName:((K=t.player)==null?void 0:K.name)||"joueur",verifyUrl:S}),d.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function x(){try{await hT({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,d.value=!1,i.value="",o.value="",a.value=""}async function P(){var j;try{const D=await yl((j=t.player)==null?void 0:j.id,t.seasonId);D!=null&&D.email&&(D!=null&&D.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}sr(()=>{P()}),Ot(()=>t.show,j=>{j&&P()});async function U(){if(y.value){l.value=!0,c.value="";try{await uT(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(j){c.value=(j==null?void 0:j.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(j,D)=>{var K;return n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:D[6]||(D[6]=X=>j.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:D[5]||(D[5]=Vt(()=>{},["stop"]))},[h("button",{onClick:D[0]||(D[0]=X=>j.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",oL,[D[7]||(D[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"👤")],-1)),D[8]||(D[8]=h("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),h("p",aL,"Pour sécuriser les saisies de "+ie((K=n.player)==null?void 0:K.name),1)]),s.value===1?(F(),$("div",lL,[h("div",null,[D[9]||(D[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),Ze(h("input",{"onUpdate:modelValue":D[1]||(D[1]=X=>i.value=X),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[St,i.value]])]),d.value?(F(),$("div",uL,[D[10]||(D[10]=h("span",null,"✅",-1)),h("span",null,"Un email a été envoyé à "+ie(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ce("",!0)])):s.value===2?(F(),$("div",cL,[h("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[D[11]||(D[11]=h("span",null,"✅",-1)),D[12]||(D[12]=h("span",null,"Adresse email vérifiée",-1)),h("button",{type:"button",onClick:x,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),h("div",null,[D[13]||(D[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),Ze(h("input",{"onUpdate:modelValue":D[2]||(D[2]=X=>o.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[St,o.value]])]),h("div",null,[D[14]||(D[14]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),Ze(h("input",{"onUpdate:modelValue":D[3]||(D[3]=X=>a.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[St,a.value]])]),h("button",{onClick:U,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(F(),$("span",hL,"⏳")):(F(),$("span",fL,"🔒")),h("span",null,ie(l.value?"Association...":"Associer ce joueur"),1)],8,dL)])):ce("",!0),c.value?(F(),$("div",pL,ie(c.value),1)):ce("",!0),h("div",mL,[h("button",{onClick:D[4]||(D[4]=X=>j.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),s.value===1?(F(),$("button",{key:0,onClick:T,disabled:!m.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(F(),$("span",vL,"⏳")):(F(),$("span",yL,"✉️")),h("span",null,ie(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,gL)):ce("",!0)])])])):ce("",!0)}}},_L={class:"mt-4"},bL={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},wT={__name:"AccountBenefitsHint",setup(n){const e=N(!1);return(t,r)=>(F(),$("div",_L,[h("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=h("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),h("span",{class:Kt(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(F(),$("div",bL,r[2]||(r[2]=[h("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),h("div",null,[Sn("• "),h("span",{class:"text-blue-300"},"Protégez vos saisies :"),Sn(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),h("div",null,[Sn("• "),h("span",{class:"text-blue-300"},"Notifications :"),Sn(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),h("div",null,[Sn("• "),h("span",{class:"text-blue-300"},"Saisie simplifiée :"),Sn(" votre joueur reste toujours en haut de la liste")],-1)]))):ce("",!0)]))}},wL={class:"text-center mb-6"},IL={class:"text-2xl font-bold text-white mb-2"},EL={class:"text-lg text-gray-300"},TL={class:"mb-6"},xL={class:"flex items-center space-x-3"},AL={class:"text-2xl"},SL={class:"font-semibold text-white"},PL={class:"text-sm text-gray-300"},RL={key:0,class:"mb-6"},CL={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},kL={class:"text-red-300 text-sm"},DL={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},NL={class:"text-green-300 text-sm"},VL={class:"flex justify-center gap-3"},OL=["disabled"],ML={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=N(!1),o=N(!1),a=N(""),l=N(""),c=N(!1);el();const d=N(!1);qe(()=>!1),qe(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function m(){var U;if((U=t.player)!=null&&U.id){s.value=await wi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:j}=await Jt(()=>Promise.resolve().then(()=>pc),void 0);i.value=j(t.player.id)}catch{i.value=!1}}}function y(){var U;a.value="";try{if((U=t.player)!=null&&U.id&&To(t.player.id)){T();return}}catch{}d.value=!0}async function T(){o.value=!0,a.value="",l.value="";try{const U=await fT(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,U.email&&(email.value=U.email),r("update")}catch(U){logger.error("Erreur lors de la désactivation de la protection",U),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function x(){d.value=!1,T()}function P(){r("close")}return Ot(()=>t.player,()=>{t.show&&t.player&&m()},{immediate:!0}),Ot(()=>t.show,U=>{U&&t.player&&(a.value="",l.value="",d.value=!1,m(),t.onboarding&&dn(()=>{}))}),(U,j)=>{var D;return F(),$(gt,null,[n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:P},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:j[1]||(j[1]=Vt(()=>{},["stop"]))},[h("button",{onClick:P,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",wL,[j[4]||(j[4]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),h("h2",IL,ie(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),h("p",EL,ie((D=n.player)==null?void 0:D.name),1)]),h("div",TL,[h("div",{class:Kt(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[h("div",xL,[h("span",AL,ie(s.value?"🔒":"🔓"),1),h("div",null,[h("div",SL,ie(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),h("div",PL,ie(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ce("",!0):(F(),$("div",RL,j[5]||(j[5]=[h("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(F(),$("div",CL,[h("div",kL,ie(a.value),1)])):ce("",!0),l.value?(F(),$("div",DL,[h("div",NL,ie(l.value),1)])):ce("",!0),h("div",VL,[h("button",{onClick:P,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),s.value?(F(),$("button",{key:1,onClick:y,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,OL)):(F(),$("button",{key:0,onClick:j[0]||(j[0]=K=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte "))]),s.value?ce("",!0):(F(),Td(wT,{key:3}))])])):ce("",!0),lt(bT,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:j[2]||(j[2]=K=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),lt(Lg,{show:d.value,player:n.player,seasonId:n.seasonId,onClose:j[3]||(j[3]=K=>d.value=!1),onVerified:x},null,8,["show","player","seasonId"])],64)}}};const LL=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},FL={class:"relative text-center p-6 pb-4 border-b border-white/10"},$L={class:"text-2xl md:text-3xl font-bold text-white mb-1"},UL={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},jL={class:"grid grid-cols-3 gap-3 md:gap-4"},qL={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},BL={class:"text-xl md:text-2xl font-bold text-white"},zL={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},KL={class:"text-xl md:text-2xl font-bold text-white"},GL={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},HL={class:"text-xl md:text-2xl font-bold text-white"},WL={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},QL={key:0,class:"md:hidden mt-3 space-y-2"},JL={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},YL={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},XL={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},ZL={class:"mb-6"},eF={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N(""),a=N(null),l=N(!1),c=N(!1),d=N(null),f=N(!1),m=N(!1),y=N(!1);function T(){s("close")}function x(){var I;o.value=((I=r.player)==null?void 0:I.name)||"",i.value=!0,dn(()=>{a.value&&a.value.focus()})}function P(){i.value=!1,o.value=""}async function U(){var w,C;if(!o.value.trim())return;if(await wi((w=r.player)==null?void 0:w.id,r.seasonId)){To((C=r.player)==null?void 0:C.id)?j():(d.value="update",c.value=!0);return}j()}function j(){var I;s("update",{playerId:(I=r.player)==null?void 0:I.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function D(){var w,C;if(await wi((w=r.player)==null?void 0:w.id,r.seasonId)){To((C=r.player)==null?void 0:C.id)?K():(d.value="delete",c.value=!0);return}K()}function K(){var I;s("delete",(I=r.player)==null?void 0:I.id)}function X(){s("refresh")}function de(I){d.value==="update"?j():d.value==="delete"&&K(),d.value=null}Ot(()=>r.show,I=>{var w;I||(i.value=!1,o.value="",d.value=null,l.value=!1),I&&((w=r.player)!=null&&w.id)&&(wi(r.player.id,r.seasonId).then(C=>{m.value=!!C}),Jt(()=>Promise.resolve().then(()=>pc),void 0).then(C=>{try{y.value=!!C.isPlayerPasswordCached(r.player.id)}catch{y.value=!1}}))}),e({openProtection(){l.value=!0}});const S=N({position:null});return Ot(()=>r.show,I=>{I&&r.onboardingStep===4?dn(()=>{const w=document.querySelectorAll("button");let C=null;if(w.forEach(O=>{!C&&O.textContent&&O.textContent.includes("Protection")&&(C=O)}),C){const O=C.getBoundingClientRect();S.value.position={x:Math.round(O.right+8),y:Math.round(O.top+window.scrollY-4)}}}):I||(S.value.position=null)}),(I,w)=>{var C;return F(),$(gt,null,[n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:T},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:w[5]||(w[5]=Vt(()=>{},["stop"]))},[h("div",FL,[h("button",{onClick:T,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),w[10]||(w[10]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),h("h2",$L,ie((C=n.player)==null?void 0:C.name),1)]),h("div",UL,[h("div",null,[h("div",jL,[h("div",qL,[h("div",BL,ie(r.stats.availability),1),w[11]||(w[11]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),h("div",zL,[h("div",KL,ie(r.stats.selection),1),w[12]||(w[12]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),h("div",GL,[h("div",HL,ie(r.stats.ratio),1),w[13]||(w[13]=h("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),h("div",WL,[h("button",{onClick:x,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},w[14]||(w[14]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:w[0]||(w[0]=O=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[h("span",null,ie(m.value?"🔓":"🔒"),1),h("span",null,ie(m.value?"Déverrouiller":"Verrouiller"),1)]),h("button",{onClick:D,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},w[15]||(w[15]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:T,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(F(),$("div",QL,[h("button",{onClick:w[1]||(w[1]=O=>{x(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Renommer "),h("button",{onClick:w[2]||(w[2]=O=>{D(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):ce("",!0)]),h("div",JL,[h("button",{onClick:w[3]||(w[3]=O=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ie(m.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),h("button",{onClick:T,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),h("button",{onClick:w[4]||(w[4]=O=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):ce("",!0),i.value?(F(),$("div",YL,[h("div",XL,[w[17]||(w[17]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),h("div",ZL,[w[16]||(w[16]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),Ze(h("input",{"onUpdate:modelValue":w[6]||(w[6]=O=>o.value=O),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Mn(P,["esc"]),Mn(U,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[St,o.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:P,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:U,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),lt(ML,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:w[7]||(w[7]=O=>l.value=!1),onUpdate:X,onOnboardingFinished:w[8]||(w[8]=O=>I.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),lt(Lg,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:w[9]||(w[9]=O=>c.value=!1),onVerified:de},null,8,["show","player","seasonId"])],64)}}},tF=LL(eF,[["__scopeId","data-v-731bb3fb"]]),nF={class:"relative p-6 pb-4 border-b border-white/10"},rF={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},sF={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Vt(()=>{},["stop"]))},[h("div",nF,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),h("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=rr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),h("div",rF,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ce("",!0)}},iF={class:"relative text-center p-6 pb-4 border-b border-white/10"},oF={class:"text-2xl md:text-3xl font-bold text-white mb-1"},aF={class:"text-sm md:text-base text-purple-300"},lF={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},uF={class:"mb-3"},cF={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},dF={key:0,class:"flex items-center justify-between gap-2"},hF=["title"],fF={key:0,class:"text-purple-400 mr-2"},pF={key:1,class:"text-green-400 mr-2"},mF={key:2,class:"text-red-400 mr-2"},gF={key:3,class:"text-gray-400 mr-2"},vF=["onClick"],yF={key:1,class:"flex items-center justify-center"},_F=["onChange"],bF=["value"],wF=["onClick"],IF={key:0,class:"mb-3"},EF={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},TF={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},xF={class:"text-cyan-300 text-lg md:text-xl font-semibold"},AF={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},SF={class:"text-green-400 text-lg md:text-xl font-semibold"},PF={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},RF={class:"text-purple-400 text-lg md:text-xl font-semibold"},CF={key:1,class:"mb-3"},kF={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},DF={class:"flex-1"},NF={class:"text-blue-300 text-sm font-medium"},VF={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},OF=["disabled","title"],MF=["disabled"],LF=["disabled"],FF={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications","update-selection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=N(""),d=N(!1),f=N(!1),m=qe(()=>{var pe;return((pe=r.event)==null?void 0:pe.playerCount)||6}),y=N([]),T=N(null),x=qe(()=>Array.from({length:m.value},(le,Ge)=>{var st;return((st=r.currentSelection)==null?void 0:st[Ge])||null})),P=qe(()=>JSON.stringify(y.value)!==JSON.stringify(x.value)),U=qe(()=>(r.players||[]).map(pe=>pe.name).filter(pe=>{var le;return((le=r.playerAvailability)==null?void 0:le[pe])===!0}).sort((pe,le)=>pe.localeCompare(le,"fr",{sensitivity:"base"})));function j(pe){const le=new Set(y.value.filter(Boolean)),Ge=y.value[pe];return Ge&&le.delete(Ge),U.value.filter(st=>!le.has(st))}function D(pe){T.value=pe}function K(){T.value=null}function X(pe,le){var st;const Ge=((st=pe==null?void 0:pe.target)==null?void 0:st.value)||"";Ge&&(y.value[le]=Ge),T.value=null}function de(pe){y.value[pe]=null}qe(()=>(j(-1).length<m.value,""));const S=qe(()=>r.currentSelection&&r.currentSelection.length>0),I=qe(()=>{var st;if(!S.value)return!1;const pe=r.currentSelection.some(ht=>!ge(ht)),le=((st=r.event)==null?void 0:st.playerCount)||6,Ge=r.availableCount<le;return pe||Ge});qe(()=>{var Ge;if(!I.value)return"";const pe=r.currentSelection.filter(st=>!ge(st)),le=((Ge=r.event)==null?void 0:Ge.playerCount)||6;return pe.length>0?pe.length===1?`${pe[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${pe.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<le?`Seulement ${r.availableCount} joueurs disponibles pour ${le} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),qe(()=>{if(!r.event||!S.value)return"";const pe=w(r.event.date),le=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${pe} : ${le}`}),Ot(()=>r.show,pe=>{if(pe){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const le=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ge=m.value;y.value=Array.from({length:Ge},(st,ht)=>le[ht]||null),T.value=null}}),Ot([m,()=>r.currentSelection,()=>{var pe;return(pe=r.event)==null?void 0:pe.id}],()=>{if(!r.show)return;const pe=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],le=m.value,Ge=Array.from({length:le},(st,ht)=>pe[ht]||y.value[ht]||null);y.value=Ge.slice(0,le)});function w(pe){var Ge;return pe?(typeof pe=="string"?new Date(pe):((Ge=pe.toDate)==null?void 0:Ge.call(pe))||pe).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function C(){s("selection")}function O(){s("perfect")}function q(){var le;if(!((le=r.event)!=null&&le.id))return;const pe=y.value.filter(Boolean);s("update-selection",{eventId:r.event.id,players:pe})}function R(){s("close")}function It(){a.value=!0}function De(){f.value=!0}function ge(pe){return r.playerAvailability[pe]===!0}function Ee(pe){return r.playerAvailability[pe]===!1}function Fe(pe){return r.currentSelection.includes(pe)&&ge(pe)}function Bt(pe=!1,le=!1){if(d.value=pe,pe){const Ge=w(r.event.date),st=r.currentSelection.join(", ");le?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ge} : ${st}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ge} : ${st}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function Wt(){l.value=!1}e({showSuccess:Bt});function bt(pe){s("send-email-notifications",pe),a.value=!1}return(pe,le)=>{var Ge,st,ht;return F(),$(gt,null,[n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:R},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:le[1]||(le[1]=Vt(()=>{},["stop"]))},[h("div",iF,[h("button",{onClick:R,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),le[5]||(le[5]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("h2",oF,"Sélection pour "+ie((Ge=n.event)==null?void 0:Ge.title),1),h("p",aF,ie(w((st=n.event)==null?void 0:st.date)),1),h("div",{class:"mt-3"},[h("button",{onClick:De,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},le[4]||(le[4]=[h("span",null,"❓",-1),Sn(),h("span",null,"Kezako ?",-1)]))])]),h("div",lF,[h("div",uF,[le[8]||(le[8]=h("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),h("div",cF,[(F(!0),$(gt,null,dr(y.value,(k,L)=>(F(),$("div",{key:"sel-slot-"+L,class:Kt(["relative p-3 rounded-lg border text-center transition-colors",k?["bg-gradient-to-r",Ee(k)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":ge(k)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[k?(F(),$("div",dF,[h("div",{class:"flex-1 text-white font-medium truncate",title:k},[Fe(k)?(F(),$("span",fF,"🎭")):ge(k)?(F(),$("span",pF,"✅")):Ee(k)?(F(),$("span",mF,"❌")):(F(),$("span",gF,"–")),Sn(" "+ie(k),1)],8,hF),h("button",{onClick:J=>de(L),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,vF)])):(F(),$("div",yF,[T.value===L?(F(),$("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:J=>X(J,L),onBlur:le[0]||(le[0]=J=>K())},[le[6]||(le[6]=h("option",{value:""},"— Choisir —",-1)),(F(!0),$(gt,null,dr(j(L),J=>(F(),$("option",{key:J,value:J},ie(J),9,bF))),128))],40,_F)):(F(),$("button",{key:1,onClick:J=>D(L),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},le[7]||(le[7]=[h("span",{class:"text-lg"},"＋",-1),h("span",{class:"text-sm"},"Ajouter",-1)]),8,wF))]))],2))),128))])]),I.value?(F(),$("div",IF,le[9]||(le[9]=[h("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[h("div",{class:"text-yellow-400"},"⚠️"),h("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):ce("",!0),h("div",EF,[h("div",TF,[h("div",xF,ie(((ht=n.event)==null?void 0:ht.playerCount)||6),1),le[10]||(le[10]=h("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),h("div",AF,[h("div",SF,ie(n.availableCount),1),le[11]||(le[11]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),h("div",PF,[h("div",RF,ie(n.selectedCount),1),le[12]||(le[12]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(F(),$("div",CF,[h("div",kF,[le[14]||(le[14]=h("div",{class:"text-blue-400 text-xl"},"✨",-1)),h("div",DF,[h("p",NF,ie(c.value),1)]),h("button",{onClick:Wt,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},le[13]||(le[13]=[h("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ce("",!0)]),h("div",VF,[h("button",{onClick:C,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":S.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},le[15]||(le[15]=[Sn(" ✨ "),h("span",{class:"hidden sm:inline"},"Sélection Auto",-1),h("span",{class:"sm:hidden"},"Auto",-1)]),8,OF),h("button",{onClick:q,disabled:!P.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",title:"Enregistrer cette composition manuelle"},le[16]||(le[16]=[Sn(" 💾 "),h("span",{class:"hidden sm:inline"},"Enregistrer",-1),h("span",{class:"sm:hidden"},"Save",-1)]),8,MF),h("button",{onClick:It,disabled:!S.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},le[17]||(le[17]=[Sn(" 📣 "),h("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,LF),S.value?(F(),$("button",{key:0,onClick:O,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap"},le[18]||(le[18]=[Sn(" 👍 "),h("span",{class:"hidden sm:inline"},"Fermer",-1)]))):ce("",!0)])])])):ce("",!0),lt(_T,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:le[2]||(le[2]=k=>a.value=!1),onSendEmailNotifications:bt},null,8,["show","event","season-id","season-slug","players","selected-players"]),lt(sF,{show:f.value,onClose:le[3]||(le[3]=k=>f.value=!1)},null,8,["show"])],64)}}},$F={class:"flex items-center justify-center gap-2"},UF=["title"],jF=["title"],qF=["title"],BF=["title"],zF=["title"],Q_={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=qe(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=qe(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(F(),$("div",{class:Kt(["flex items-center justify-center transition-all duration-200",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-white/10",n.compact?"min-h-0 p-1 md:p-2":"min-h-20 p-3 md:p-5"]]),onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[h("div",$F,[i.value&&s.value?(F(),$("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ie(n.chancePercent)+"% ",9,UF)):(F(),$(gt,{key:1},[n.isSelected&&n.isAvailable===!0?(F(),$("span",{key:0,class:Kt([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," 🎭 ",10,jF)):n.isAvailable===!0?(F(),$("span",{key:1,class:Kt([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," ✅ ",10,qF)):n.isAvailable===!1?(F(),$("span",{key:2,class:Kt([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," ❌ ",10,BF)):(F(),$("span",{key:3,class:Kt(["text-gray-500 transition-colors duration-200",[n.compact?"text-base md:text-lg":"text-xl md:text-2xl",n.disabled?"":"hover:text-white"]]),title:o.value}," – ",10,zF))],64))])],34))}},KF={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},GF={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},HF={class:"text-2xl md:text-3xl font-bold text-white mb-3"},WF={class:"text-gray-300 mb-6"},QF={class:"flex flex-col items-stretch justify-center gap-3"},JF=["value"],YF={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=qe(()=>`${s}/season/${t.seasonSlug}`),o=N(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=qe(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=qe(()=>a.value>0),c=N(l.value);Ot(a,P=>{c.value=P>0});const d=qe(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=qe(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function m(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function T(){var P;try{(P=navigator.clipboard)==null||P.writeText(i.value)}catch{}r("copy-link")}async function x(){try{if(t.seasonId){const{db:P}=await Jt(()=>Promise.resolve().then(()=>_i),void 0),{doc:U,updateDoc:j}=await Jt(()=>import("./index.esm-93305b69.js"),[]);await j(U(P,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(P,U)=>l.value&&c.value?(F(),$("div",KF,[h("div",GF,[U[1]||(U[1]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎬")],-1)),h("h2",HF,ie(d.value),1),h("p",WF,ie(f.value),1),h("div",QF,[a.value===1?(F(),$("button",{key:0,onClick:m,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(F(),$("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(F(),$(gt,{key:2},[h("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:U[0]||(U[0]=j=>j.target.select())},null,40,JF),h("div",{class:"flex gap-3 justify-center"},[h("button",{onClick:T,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),h("button",{onClick:x,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ce("",!0)])])])):ce("",!0)}},IT="@firebase/installations",Fg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ET=1e4,TT=`w:${Fg}`,xT="FIS_v2",XF="https://firebaseinstallations.googleapis.com/v1",ZF=60*60*1e3,e4="installations",t4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Oo=new Lo(e4,t4,n4);function AT(n){return n instanceof is&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ST({projectId:n}){return`${XF}/projects/${n}/installations`}function PT(n){return{token:n.token,requestStatus:2,expiresIn:s4(n.expiresIn),creationTime:Date.now()}}async function RT(n,e){const r=(await e.json()).error;return Oo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function CT({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function r4(n,{refreshToken:e}){const t=CT(n);return t.append("Authorization",i4(e)),t}async function kT(n){const e=await n();return e.status>=500&&e.status<600?n():e}function s4(n){return Number(n.replace("s","000"))}function i4(n){return`${xT} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o4({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=ST(n),s=CT(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:xT,appId:n.appId,sdkVersion:TT},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await kT(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:PT(c.authToken)}}else throw await RT("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DT(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a4(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l4=/^[cdef][\w-]{21}$/,Up="";function u4(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=c4(n);return l4.test(t)?t:Up}catch{return Up}}function c4(n){return a4(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qh(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NT=new Map;function VT(n,e){const t=Qh(n);OT(t,e),d4(t,e)}function OT(n,e){const t=NT.get(n);if(t)for(const r of t)r(e)}function d4(n,e){const t=h4();t&&t.postMessage({key:n,fid:e}),f4()}let yo=null;function h4(){return!yo&&"BroadcastChannel"in self&&(yo=new BroadcastChannel("[Firebase] FID Change"),yo.onmessage=n=>{OT(n.data.key,n.data.fid)}),yo}function f4(){NT.size===0&&yo&&(yo.close(),yo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p4="firebase-installations-database",m4=1,Mo="firebase-installations-store";let $f=null;function $g(){return $f||($f=hh(p4,m4,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Mo)}}})),$f}async function Yd(n,e){const t=Qh(n),s=(await $g()).transaction(Mo,"readwrite"),i=s.objectStore(Mo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&VT(n,e.fid),e}async function MT(n){const e=Qh(n),r=(await $g()).transaction(Mo,"readwrite");await r.objectStore(Mo).delete(e),await r.done}async function Jh(n,e){const t=Qh(n),s=(await $g()).transaction(Mo,"readwrite"),i=s.objectStore(Mo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&VT(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ug(n){let e;const t=await Jh(n.appConfig,r=>{const s=g4(r),i=v4(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Up?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function g4(n){const e=n||{fid:u4(),registrationStatus:0};return LT(e)}function v4(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Oo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=y4(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:_4(n)}:{installationEntry:e}}async function y4(n,e){try{const t=await o4(n,e);return Yd(n.appConfig,t)}catch(t){throw AT(t)&&t.customData.serverCode===409?await MT(n.appConfig):await Yd(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function _4(n){let e=await J_(n.appConfig);for(;e.registrationStatus===1;)await DT(100),e=await J_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Ug(n);return r||t}return e}function J_(n){return Jh(n,e=>{if(!e)throw Oo.create("installation-not-found");return LT(e)})}function LT(n){return b4(n)?{fid:n.fid,registrationStatus:0}:n}function b4(n){return n.registrationStatus===1&&n.registrationTime+ET<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w4({appConfig:n,heartbeatServiceProvider:e},t){const r=I4(n,t),s=r4(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:TT,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await kT(()=>fetch(r,a));if(l.ok){const c=await l.json();return PT(c)}else throw await RT("Generate Auth Token",l)}function I4(n,{fid:e}){return`${ST(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jg(n,e=!1){let t;const r=await Jh(n.appConfig,i=>{if(!FT(i))throw Oo.create("not-registered");const o=i.authToken;if(!e&&x4(o))return i;if(o.requestStatus===1)return t=E4(n,e),i;{if(!navigator.onLine)throw Oo.create("app-offline");const a=S4(i);return t=T4(n,a),a}});return t?await t:r.authToken}async function E4(n,e){let t=await Y_(n.appConfig);for(;t.authToken.requestStatus===1;)await DT(100),t=await Y_(n.appConfig);const r=t.authToken;return r.requestStatus===0?jg(n,e):r}function Y_(n){return Jh(n,e=>{if(!FT(e))throw Oo.create("not-registered");const t=e.authToken;return P4(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function T4(n,e){try{const t=await w4(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await Yd(n.appConfig,r),t}catch(t){if(AT(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await MT(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Yd(n.appConfig,r)}throw t}}function FT(n){return n!==void 0&&n.registrationStatus===2}function x4(n){return n.requestStatus===2&&!A4(n)}function A4(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+ZF}function S4(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function P4(n){return n.requestStatus===1&&n.requestTime+ET<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R4(n){const e=n,{installationEntry:t,registrationPromise:r}=await Ug(e);return r?r.catch(console.error):jg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C4(n,e=!1){const t=n;return await k4(t),(await jg(t,e)).token}async function k4(n){const{registrationPromise:e}=await Ug(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D4(n){if(!n||!n.options)throw Uf("App Configuration");if(!n.name)throw Uf("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Uf(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Uf(n){return Oo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $T="installations",N4="installations-internal",V4=n=>{const e=n.getProvider("app").getImmediate(),t=D4(e),r=Vi(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},O4=n=>{const e=n.getProvider("app").getImmediate(),t=Vi(e,$T).getImmediate();return{getId:()=>R4(t),getToken:s=>C4(t,s)}};function M4(){rs(new $r($T,V4,"PUBLIC")),rs(new $r(N4,O4,"PRIVATE"))}M4();Er(IT,Fg);Er(IT,Fg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L4="/firebase-messaging-sw.js",F4="/firebase-cloud-messaging-push-scope",UT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",$4="https://fcmregistrations.googleapis.com/v1",jT="google.c.a.c_id",U4="google.c.a.c_l",j4="google.c.a.ts",q4="google.c.a.e";var X_;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(X_||(X_={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var ju;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(ju||(ju={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gs(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function B4(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jf="fcm_token_details_db",z4=5,Z_="fcm_token_object_Store";async function K4(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(jf))return null;let e=null;return(await hh(jf,z4,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(Z_))return;const l=o.objectStore(Z_),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const d=c;if(!d.auth||!d.p256dh||!d.endpoint)return;e={token:d.fcmToken,createTime:(a=d.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:d.auth,p256dh:d.p256dh,endpoint:d.endpoint,swScope:d.swScope,vapidKey:typeof d.vapidKey=="string"?d.vapidKey:gs(d.vapidKey)}}}else if(s===3){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:gs(d.auth),p256dh:gs(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:gs(d.vapidKey)}}}else if(s===4){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:gs(d.auth),p256dh:gs(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:gs(d.vapidKey)}}}}}})).close(),await Tf(jf),await Tf("fcm_vapid_details_db"),await Tf("undefined"),G4(e)?e:null}function G4(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H4="firebase-messaging-database",W4=1,qu="firebase-messaging-store";let qf=null;function qT(){return qf||(qf=hh(H4,W4,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(qu)}}})),qf}async function Q4(n){const e=BT(n),r=await(await qT()).transaction(qu).objectStore(qu).get(e);if(r)return r;{const s=await K4(n.appConfig.senderId);if(s)return await qg(n,s),s}}async function qg(n,e){const t=BT(n),s=(await qT()).transaction(qu,"readwrite");return await s.objectStore(qu).put(e,t),await s.done,e}function BT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},Xn=new Lo("messaging","Messaging",J4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y4(n,e){const t=await zg(n),r=zT(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(Bg(n.appConfig),s)).json()}catch(o){throw Xn.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw Xn.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw Xn.create("token-subscribe-no-token");return i.token}async function X4(n,e){const t=await zg(n),r=zT(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${Bg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw Xn.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw Xn.create("token-update-failed",{errorInfo:o})}if(!i.token)throw Xn.create("token-update-no-token");return i.token}async function Z4(n,e){const r={method:"DELETE",headers:await zg(n)};try{const i=await(await fetch(`${Bg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw Xn.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw Xn.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Bg({projectId:n}){return`${$4}/projects/${n}/registrations`}async function zg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function zT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==UT&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3=7*24*60*60*1e3;async function t3(n){const e=await r3(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:gs(e.getKey("auth")),p256dh:gs(e.getKey("p256dh"))},r=await Q4(n.firebaseDependencies);if(r){if(s3(r.subscriptionOptions,t))return Date.now()>=r.createTime+e3?n3(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await Z4(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return e0(n.firebaseDependencies,t)}else return e0(n.firebaseDependencies,t)}async function n3(n,e){try{const t=await X4(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await qg(n.firebaseDependencies,r),t}catch(t){throw t}}async function e0(n,e){const r={token:await Y4(n,e),createTime:Date.now(),subscriptionOptions:e};return await qg(n,r),r.token}async function r3(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:B4(e)})}function s3(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t0(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return i3(e,n),o3(e,n),a3(e,n),e}function i3(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function o3(n,e){e.data&&(n.data=e.data)}function a3(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l3(n){return typeof n=="object"&&!!n&&jT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */u3("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function u3(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c3(n){if(!n||!n.options)throw Bf("App Configuration Object");if(!n.name)throw Bf("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Bf(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Bf(n){return Xn.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d3{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=c3(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h3(n){try{n.swRegistration=await navigator.serviceWorker.register(L4,{scope:F4}),n.swRegistration.update().catch(()=>{})}catch(e){throw Xn.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f3(n,e){if(!e&&!n.swRegistration&&await h3(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw Xn.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p3(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=UT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KT(n,e){if(!navigator)throw Xn.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw Xn.create("permission-blocked");return await p3(n,e==null?void 0:e.vapidKey),await f3(n,e==null?void 0:e.serviceWorkerRegistration),t3(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m3(n,e,t){const r=g3(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[jT],message_name:t[U4],message_time:t[j4],message_device_time:Math.floor(Date.now()/1e3)})}function g3(n){switch(n){case ju.NOTIFICATION_CLICKED:return"notification_open";case ju.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v3(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===ju.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(t0(t)):n.onMessageHandler.next(t0(t)));const r=t.data;l3(r)&&r[q4]==="1"&&await m3(n,t.messageType,r)}const n0="@firebase/messaging",r0="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y3=n=>{const e=new d3(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>v3(e,t)),e},_3=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>KT(e,r)}};function b3(){rs(new $r("messaging",y3,"PUBLIC")),rs(new $r("messaging-internal",_3,"PRIVATE")),Er(n0,r0),Er(n0,r0,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GT(){try{await kb()}catch{return!1}return typeof window<"u"&&lm()&&GP()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w3(n=dm()){return GT().then(e=>{if(!e)throw Xn.create("unsupported-browser")},e=>{throw Xn.create("indexed-db-unsupported")}),Vi(Ne(n),"messaging").getImmediate()}async function I3(n,e){return n=Ne(n),KT(n,e)}b3();const E3="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function HT(){try{return await GT()}catch{return!1}}async function T3(n){var s;if(!await HT()||await Notification.requestPermission()!=="granted")return null;const t=w3(Kh),r=await I3(t,{vapidKey:E3,serviceWorkerRegistration:n});try{const i=((s=Pt==null?void 0:Pt.currentUser)==null?void 0:s.email)||"anonymous";i&&r&&await fn(Ae(se,"userPushTokens",i),{tokens:qD(r),lastToken:r,email:i,updatedAt:Ui(),userAgent:navigator.userAgent},{merge:!0})}catch{}return r}const x3={class:"flex justify-center gap-2 mb-4"},A3={class:"space-y-3"},S3={key:0},P3={key:0,class:"text-sm text-gray-400"},R3={key:1,class:"space-y-2"},C3={class:"flex items-center justify-between gap-3"},k3={class:"truncate"},D3={class:"text-white font-semibold"},N3={class:"text-gray-400 text-xs"},V3=["onClick"],O3={key:1,class:"text-sm text-gray-300 space-y-3"},M3={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},L3={class:"flex items-center justify-between"},F3={class:"flex items-center gap-2"},$3={class:"flex items-center justify-between"},U3={class:"flex items-center gap-2"},j3={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},q3={class:"flex items-center justify-between"},B3={class:"flex items-center gap-2"},z3={class:"flex items-center justify-between pt-2 border-t border-white/10"},K3=["disabled"],G3={key:1,class:"inline-flex items-center text-xs text-gray-300"},H3={class:"flex items-center justify-between pt-2"},W3=["disabled"],Q3={key:0,class:"text-xs text-green-300"},J3={key:1,class:"text-xs text-red-300"},Y3={key:2,class:"text-[10px] text-gray-400 break-all"},X3={class:"text-right"},Z3=["disabled"],e$={key:0,class:"text-xs text-red-300"},t$={key:1,class:"text-xs text-green-300"},n$={key:2,class:"flex flex-col gap-3"},r$={class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},s$={class:"flex items-center gap-2"},i$=["disabled"],o$={key:0,class:"mt-2 text-xs text-red-300"},a$={key:1,class:"mt-2 text-xs text-green-300"},l$={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","manage-player","change-password","logout-device","delete-account"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N([]),o=N("players");function a(De){return["px-4 py-2 rounded-full text-sm transition-colors",o.value===De?"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"]}function l(De){return`${De.seasonId||"global"}__${De.playerId}`}async function c(){var De;try{s.value=((De=Pt==null?void 0:Pt.currentUser)==null?void 0:De.email)||""}catch{}try{const ge=s.value?await Og(s.value):[],Ee=[];for(const Fe of ge){let Bt=Fe.playerId;try{if(Fe.seasonId){const Wt=Ae(se,"seasons",Fe.seasonId,"players",Fe.playerId),bt=await pn(Wt);bt.exists()&&(Bt=bt.data().name||Bt)}}catch{}Ee.push({...Fe,playerName:Bt})}i.value=Ee}catch{i.value=[]}}function d(){r("close")}Ot(()=>t.show,De=>{De&&(c(),O())}),sr(()=>{t.show&&(c(),O())});const f=N(""),m=N(!1),y=N(""),T=N(""),x=N(!1);Ot(s,De=>{f.value=De||""}),Ot(f,De=>{x.value=!!De&&De.includes("@")&&De!==s.value});async function P(){if(x.value){m.value=!0,y.value="",T.value="";try{const De=await iT({currentEmail:s.value,newEmail:f.value.trim()});await yT({toEmail:f.value.trim(),verifyUrl:De.url,purpose:"account_email_update",displayName:"utilisateur"}),T.value=`Un email de vérification a été envoyé à ${f.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(De){y.value=(De==null?void 0:De.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{m.value=!1}}}const U=N({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0}),j=N(!1),D=N(""),K=N(""),X=N(!1),de=N(""),S=N(""),I=N(!1),w=N(localStorage.getItem("fcmToken")||""),C=N(!1);async function O(){try{if(!s.value)return;const De=Ae(se,"userPreferences",s.value),ge=await pn(De);if(ge.exists()){const Ee=ge.data()||{};U.value.notifyAvailability=Ee.notifyAvailability!==!1,U.value.notifySelection=Ee.notifySelection!==!1,U.value.notifySelectionPush=Ee.notifySelectionPush!==!1}else U.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0}}catch{}}async function q(){if(s.value){X.value=!0,S.value="",de.value="";try{await Mg({toEmail:s.value,title:"Test Impro Selector",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),de.value="OK"}catch{S.value="Échec de l'envoi du test"}finally{X.value=!1}}}async function R(){try{if(I.value=!0,!await HT()){S.value="Push non supporté sur cet appareil";return}const ge=window.__swReg,Ee=await T3(ge);if(Ee){w.value=Ee;try{localStorage.setItem("fcmToken",Ee)}catch{}C.value=!0}}catch{S.value="Activation impossible"}finally{I.value=!1}}sr(()=>{try{C.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken")}catch{C.value=!1}});async function It(){if(s.value){j.value=!0,D.value="",K.value="";try{const De=Ae(se,"userPreferences",s.value);await fn(De,{...U.value},{merge:!0}),K.value="Préférences sauvegardées"}catch{D.value="Impossible de sauvegarder vos préférences"}finally{j.value=!1}}}return(De,ge)=>n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:d},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:ge[10]||(ge[10]=Vt(()=>{},["stop"]))},[h("button",{onClick:d,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),ge[23]||(ge[23]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Gérez votre compte et vos préférences</p></div>',1)),h("div",x3,[h("button",{onClick:ge[0]||(ge[0]=Ee=>o.value="manage"),class:Kt(a("manage"))},"Gérer",2),h("button",{onClick:ge[1]||(ge[1]=Ee=>o.value="notifications"),class:Kt(a("notifications"))},"Notifications",2),h("button",{onClick:ge[2]||(ge[2]=Ee=>o.value="players"),class:Kt(a("players"))},"Joueurs",2)]),h("div",A3,[o.value==="players"?(F(),$("div",S3,[ge[11]||(ge[11]=h("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(F(),$("div",P3,"Aucun joueur associé pour le moment.")):(F(),$("ul",R3,[(F(!0),$(gt,null,dr(i.value,Ee=>(F(),$("li",{key:l(Ee),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[h("div",C3,[h("div",k3,[h("div",D3,ie(Ee.seasonName||Ee.seasonId||"—"),1),h("div",N3,"Joueur : "+ie(Ee.playerName||"—"),1)]),h("button",{onClick:Fe=>De.$emit("manage-player",Ee),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,V3)])]))),128))]))])):o.value==="notifications"?(F(),$("div",O3,[h("div",M3,[ge[14]||(ge[14]=h("div",{class:"text-white font-semibold text-sm mb-1"},"Emails",-1)),h("div",L3,[h("label",F3,[Ze(h("input",{type:"checkbox","onUpdate:modelValue":ge[3]||(ge[3]=Ee=>U.value.notifyAvailability=Ee),class:"w-4 h-4"},null,512),[[bo,U.value.notifyAvailability]]),ge[12]||(ge[12]=h("span",null,"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),h("div",$3,[h("label",U3,[Ze(h("input",{type:"checkbox","onUpdate:modelValue":ge[4]||(ge[4]=Ee=>U.value.notifySelection=Ee),class:"w-4 h-4"},null,512),[[bo,U.value.notifySelection]]),ge[13]||(ge[13]=h("span",null,"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])]),h("div",j3,[ge[19]||(ge[19]=h("div",{class:"text-white font-semibold text-sm mb-1"},"Push (expérimental)",-1)),ge[20]||(ge[20]=h("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),h("div",q3,[h("label",B3,[Ze(h("input",{type:"checkbox","onUpdate:modelValue":ge[5]||(ge[5]=Ee=>U.value.notifySelectionPush=Ee),class:"w-4 h-4"},null,512),[[bo,U.value.notifySelectionPush]]),ge[15]||(ge[15]=h("span",null,"Me notifier lorsque je suis concerné par une sélection",-1))])]),h("div",z3,[ge[17]||(ge[17]=h("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),C.value?(F(),$("span",G3,ge[16]||(ge[16]=[h("span",{class:"mr-1 text-emerald-400"},"✓",-1),Sn(" Actif ")]))):(F(),$("button",{key:0,onClick:R,disabled:I.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ie(I.value?"...":"Activer"),9,K3))]),h("div",H3,[ge[18]||(ge[18]=h("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),h("button",{onClick:q,disabled:X.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ie(X.value?"Envoi…":"Envoyer un test"),9,W3)]),de.value?(F(),$("div",Q3,"Notification test envoyée (vérifiez votre appareil)")):ce("",!0),S.value?(F(),$("div",J3,ie(S.value),1)):ce("",!0),w.value?(F(),$("div",Y3,"FCM token: "+ie(w.value),1)):ce("",!0)]),h("div",X3,[h("button",{onClick:It,disabled:j.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},ie(j.value?"⏳":"Sauvegarder"),9,Z3)]),D.value?(F(),$("div",e$,ie(D.value),1)):ce("",!0),K.value?(F(),$("div",t$,ie(K.value),1)):ce("",!0)])):(F(),$("div",n$,[h("div",r$,[ge[21]||(ge[21]=h("label",{class:"block text-xs text-gray-400 mb-2"},"Email",-1)),h("div",s$,[Ze(h("input",{"onUpdate:modelValue":ge[6]||(ge[6]=Ee=>f.value=Ee),type:"email",class:"flex-1 p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"nouvel@email.com"},null,512),[[St,f.value]]),h("button",{onClick:P,disabled:!x.value||m.value,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},ie(m.value?"⏳":"Mettre à jour"),9,i$)]),y.value?(F(),$("div",o$,ie(y.value),1)):ce("",!0),T.value?(F(),$("div",a$,ie(T.value),1)):ce("",!0)]),ge[22]||(ge[22]=h("div",{class:"text-sm text-gray-400"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),h("button",{onClick:ge[7]||(ge[7]=Ee=>De.$emit("change-password")),class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500"},"Changer de mot de passe"),h("button",{onClick:ge[8]||(ge[8]=Ee=>De.$emit("logout-device")),class:"w-full px-4 py-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600"},"Déconnexion de cet appareil"),h("button",{onClick:ge[9]||(ge[9]=Ee=>De.$emit("delete-account")),class:"w-full px-4 py-3 rounded-lg bg-red-600 text-white hover:bg-red-500"},"Supprimer mon compte")]))]),h("div",{class:"mt-6 text-center"},[h("button",{onClick:d,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ce("",!0)}},u$={class:"space-y-4"},c$={class:"flex items-center justify-between"},d$={class:"flex items-center gap-2 text-gray-300 text-sm"},h$={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},f$={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},p$={class:"flex justify-center gap-3 mt-2"},m$=["disabled"],g$={key:0,class:"animate-spin"},v$={key:1},y$={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=N(""),s=N(""),i=N(!1),o=N(""),a=N(""),l=N(!0),c=qe(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function d(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await QE(r.value.trim(),s.value),l.value)try{Di.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await JE(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(m,y)=>n.show?(F(),$("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=T=>m.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=Vt(()=>{},["stop"]))},[h("button",{onClick:y[0]||(y[0]=T=>m.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),h("div",u$,[lt(wT),h("div",null,[y[7]||(y[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),Ze(h("input",{"onUpdate:modelValue":y[1]||(y[1]=T=>r.value=T),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[St,r.value]])]),h("div",null,[y[8]||(y[8]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),Ze(h("input",{"onUpdate:modelValue":y[2]||(y[2]=T=>s.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[St,s.value]])]),h("div",c$,[h("label",d$,[Ze(h("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=T=>l.value=T),class:"w-4 h-4"},null,512),[[bo,l.value]]),y[9]||(y[9]=h("span",null,"Rester connecté sur cet appareil",-1))]),h("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(F(),$("div",h$,ie(o.value),1)):ce("",!0),a.value?(F(),$("div",f$,ie(a.value),1)):ce("",!0),h("div",p$,[h("button",{onClick:y[4]||(y[4]=T=>m.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),h("button",{onClick:d,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(F(),$("span",g$,"⏳")):(F(),$("span",v$,"Se connecter"))],8,m$)])])])])):ce("",!0)}};const _$={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},b$={ref:"pageHeaderRef",class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},w$={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},I$={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},E$={class:"hidden md:flex items-center gap-2"},T$={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},x$={class:"flex items-stretch relative"},A$={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},S$={class:"flex-1 overflow-hidden"},P$=["data-event-id","onClick"],R$=["title"],C$=["title"],k$={key:0,class:"mt-1 text-xs text-gray-400"},D$=["title","onClick"],N$=["title","onClick"],V$=["title","aria-label"],O$={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},M$={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},L$={key:0,class:"pointer-events-none"},F$={class:"flex items-center justify-between"},$$={key:1,class:"pointer-events-none"},U$={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},j$={class:"flex items-center justify-between"},q$={key:2,class:"pointer-events-none"},B$={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},z$={class:"flex items-center justify-between"},K$={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},G$=["data-player-id"],H$={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},W$={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},Q$={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},J$=["onClick","title"],Y$=["data-event-id"],X$={class:"border-t border-white/10"},Z$={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},e6={class:"px-4 md:px-5 flex items-center"},t6=["data-event-id"],n6={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},r6={class:"text-center"},s6={class:"text-white text-lg"},i6={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},o6={class:"text-white/60 text-xs mt-2"},a6={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},l6={class:"flex items-center space-x-2"},u6={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},c6={class:"flex items-center space-x-2"},d6={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},h6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},f6={class:"mb-6"},p6={class:"mb-6"},m6={class:"mb-6"},g6={class:"mb-6 flex items-center gap-3"},v6={class:"mb-6"},y6={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},_6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},b6={class:"mb-6"},w6={class:"flex justify-end space-x-3"},I6={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},E6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},T6={class:"flex justify-end space-x-3"},x6={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},A6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},S6={class:"flex justify-end space-x-3"},P6={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},R6={class:"relative text-center p-6 pb-4 border-b border-white/10"},C6={class:"text-2xl md:text-3xl font-bold text-white mb-1"},k6={class:"text-sm md:text-base text-purple-300"},D6={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},N6={key:0,class:"mb-4 md:mb-6"},V6={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},O6={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},M6={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},L6={class:"text-xl md:text-2xl font-bold text-white"},F6={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},$6={class:"text-xl md:text-2xl font-bold text-white"},U6={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},j6={class:"text-xl md:text-2xl font-bold text-white"},q6={key:1,class:"mb-4 md:mb-6"},B6={class:"mb-3 flex items-center"},z6=["title"],K6={class:"truncate"},G6={class:"space-y-0.5"},H6={class:"flex items-center min-w-0 gap-1.5"},W6={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},Q6=["title"],J6={class:"flex-0 p-0"},Y6={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},X6=["disabled","title"],Z6=["title"],eU={key:2,class:"md:hidden mt-3 space-y-2"},tU=["disabled","title"],nU={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},rU={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},sU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},iU={class:"mb-6"},oU={class:"mb-6"},aU={class:"mb-6"},lU={class:"mb-6 flex items-center gap-3"},uU={class:"mb-6"},cU={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},dU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},hU={class:"mb-6"},fU={class:"space-y-4"},pU=["disabled"],mU={key:0,class:"animate-spin"},gU={key:1},vU={class:"mb-6 text-center"},yU={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_U={class:"text-red-300 text-sm"},bU={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},wU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},IU={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},EU={class:"space-y-4"},TU={class:"mt-2 text-center"},xU={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},AU={class:"text-red-300 text-sm"},SU={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},PU=["disabled"],RU={key:0,class:"animate-spin"},CU={key:1},kU={class:"mb-6"},DU=["disabled"],NU={key:0,class:"animate-spin"},VU={key:1},OU={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},MU={class:"text-red-300 text-sm"},LU={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},FU={class:"text-green-300 text-sm"},$U={class:"flex justify-center"},UU={class:"mb-6"},jU=["disabled"],qU={key:0,class:"animate-spin"},BU={key:1},zU={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},KU={class:"text-red-300 text-sm"},GU={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},HU={class:"text-green-300 text-sm"},WU={class:"flex justify-center"},QU={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},JU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},YU={class:"flex gap-3"},s0={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Hu(),r=el(),s=e.slug,i=N(""),o=N(""),a=N({}),l=N(!1),c=N(null),d=N(null),f=N(""),m=N(""),y=N(6),T=N(!1),x=N(""),P=N(null),U=N(null),j=N(null),D=N({position:null,side:null}),K=N({position:null}),X=N({position:null}),de=N(!1),S=N(null),I=N(!1),w=N(null),C=N(null),O=N(!1),q=N(null),R=N(""),It=N(!1),De=N(null),ge=N(""),Ee=N(""),Fe=N(!1),Bt=N(null),Wt=N(!1),bt=N(null),pe=N(""),le=N(""),Ge=N(!1),st=N(null),ht=N(!1),k=N(!1),L=N(""),J=N(""),Z=N(!1),Ce=N(!1),$e=N(""),E=N(""),A=N(!1),M=N(null),ee=N(""),Y=N(!1),te=N(!1),ye=N(!1),he=N(null),fe=N(null),ue=N(null),xe=N(0);function Ie(){var _;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ke.value.length===0)return;const g=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const Q=((_=Pt==null?void 0:Pt.currentUser)==null?void 0:_.email)||"";Q&&Og(Q).then(async ne=>{const re=ne.filter(me=>me.seasonId===o.value);if(re.length>0){const me=`seasonPreferredPlayer:${o.value}`,Me=localStorage.getItem(me);let je=[];if(Me)if(Me.startsWith("["))try{je=JSON.parse(Me)||[]}catch{}else je=[Me];const Je=new Set(je);re.forEach(Nt=>Je.add(Nt.playerId));const dt=Array.from(Je);localStorage.setItem(me,JSON.stringify(dt))}}).catch(()=>{})}catch{}const V=localStorage.getItem(`startPlayerTour:${o.value}`);!g&&V&&(xe.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),dn(()=>{const Q=document.querySelector('button[data-onboarding="add-player"]');if(Q){Q.scrollIntoView({behavior:"smooth",block:"end"});const ne=Q.getBoundingClientRect(),re=document.getElementById("coachmark-add"),me=280,Me=100,je=(re==null?void 0:re.offsetWidth)||me,Je=(re==null?void 0:re.offsetHeight)||Me,dt=Math.round(ne.right+12);if(dt+je<=window.innerWidth-12){const Zt=ne.top+ne.height/2-Je/2,at=-14,Nn=12,cr=window.innerHeight-Je-12,Vr=Math.max(Nn,Math.min(Math.round(Zt+at),cr));D.value={position:{x:dt,y:Vr},side:"right"}}else{const Zt=Math.round(ne.left+ne.width/2-je/2),at=Math.round(ne.top-Je-8),Nn=8,cr=window.innerWidth-je-8;D.value={position:{x:Math.max(Nn,Math.min(Zt,cr)),y:at},side:null}}}}))}catch{}}const Se=N(!1),ke=N(null),Le=N(null),ze=N(!1),Xe=N(null),Qt=N(!1),$t=N(null),yn=N(!1),kt=N(!1),mr=N(!1),Ur=N(!1),on=N(null);function Cn(){kt.value=!1}function ji(){try{const _=Pt==null?void 0:Pt.currentUser;if(!_||_.isAnonymous){let g=null;if(ta.value&&ta.value.size>0){const V=ta.value.values().next().value;g=Ye.value.find(Q=>Q.id===V)||null}g||(g=Ye.value[0]||null),Ur.value=!0,g&&(on.value=g);return}}catch{}kt.value=!0}async function _l(){var _;try{const g=(_=Pt==null?void 0:Pt.currentUser)==null?void 0:_.email;if(!g)return;const{resetPlayerPassword:V}=await Jt(()=>Promise.resolve().then(()=>_i),void 0);await V(g),Ve.value=!0,ut.value="Email de réinitialisation envoyé.",setTimeout(()=>{Ve.value=!1},3e3)}catch{yr.value=!0,Hi.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{yr.value=!1},3e3)}}async function mc(){try{await gN(Pt),Cn(),Ve.value=!0,ut.value="Déconnecté de cet appareil.",setTimeout(()=>{Ve.value=!1},2500)}catch{yr.value=!0,Hi.value="Déconnexion impossible.",setTimeout(()=>{yr.value=!1},3e3)}}async function gc(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function qi(_){var g;Cn();try{if(_.seasonId&&_.seasonId!==o.value){const V=Ae(se,"seasons",_.seasonId),ne=(await vt(We(se,"seasons"))).docs.find(me=>me.id===_.seasonId),re=(g=ne==null?void 0:ne.data())==null?void 0:g.slug;if(re){t.push(`/season/${re}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const V=Ye.value.find(Q=>Q.id===_.playerId);if(V){un(V);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}sr(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function bl(){dn(()=>{Il()})}const Sr=N(new Set),Zn=N(!0),Pr=N(0),Rr=N("Préparation de la grille"),Cr=N(e.eventId||null),Bs=N(!1),Bi=N(null);Ot(()=>e.eventId,_=>{if(_)if(Cr.value=_,Ke.value.length>0)Qg(_);else{const g=Ot(Ke,V=>{V.length>0&&(Qg(_),g())},{immediate:!0})}});const an=qe(()=>Ye.value.map(_=>({..._,isProtected:Sr.value.has(_.id),email:null}))),vc=qe(()=>Cr.value?Dn.value.findIndex(_=>_.id===Cr.value):-1);qe(()=>{if(!Cr.value||vc.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Cr.value}"]`);if(_){const g=_.getBoundingClientRect();return g.left>=0&&g.right<=window.innerWidth}}return!0});const kn=N(null),zs=N(!1),yc=N(!1),wl=N(0),Ks=N(null),zn=N(null),zo=N(null);function Kn(){const _=kn.value;if(!_)return;const{scrollLeft:g,scrollWidth:V,clientWidth:Q}=_;zs.value=g>2,yc.value=g<V-Q-2}function Il(){var _;try{Kn(),wl.value=((_=kn.value)==null?void 0:_.scrollLeft)||0}catch{}}function Ko(_){const g=kn.value;if(!g)return;let V=0;const Q=g.querySelector("tbody tr td[data-event-id]");if(Q)V=Q.getBoundingClientRect().width;else if(zn!=null&&zn.value){const re=zn.value.querySelector(".col-event");re&&(V=re.getBoundingClientRect().width)}(!V||!isFinite(V))&&(V=g.clientWidth*.6);const ne=g.scrollLeft+_*V;g.scrollTo({left:ne,behavior:"smooth"})}const jr=N(null);N(0);const er=N(!1),zi=N(!1),os=N(0);function Go(_,g){g&&typeof g.preventDefault=="function"&&g.preventDefault(),gr(),Ko(_)}function Gs(_,g){if(g&&typeof g.preventDefault=="function"&&g.preventDefault(),er.value)return;er.value=!0,os.value=_,zi.value=!1;const V=kn.value;if(!V)return;let Q=0;const ne=V.querySelector("tbody tr td[data-event-id]");if(ne)Q=ne.getBoundingClientRect().width;else if(zn!=null&&zn.value){const je=zn.value.querySelector(".col-event");je&&(Q=je.getBoundingClientRect().width)}(!Q||!isFinite(Q))&&(Q=V.clientWidth*.6);const re=Q/6,me=120,Me=()=>{if(!er.value||os.value===0)return;zi.value||(zi.value=!0);const je=V.scrollLeft+os.value*re;V.scrollTo({left:je,behavior:"auto"}),jr.value=window.setTimeout(Me,me)};jr.value=window.setTimeout(Me,250)}function gr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const g=er.value,V=zi.value;if(er.value=!1,jr.value&&(clearTimeout(jr.value),jr.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!V){const Q=os.value||0;Q!==0&&Ko(Q),os.value=0;return}os.value=0,g&&V&&_c()}function _c(){const _=kn.value;if(!_)return;let g=0;const V=_.querySelector("tbody tr td[data-event-id]");if(V)g=V.getBoundingClientRect().width;else if(zn!=null&&zn.value){const me=zn.value.querySelector(".col-event");me&&(g=me.getBoundingClientRect().width)}if(!g||!isFinite(g)||g<=0)return;const Q=_.scrollLeft,re=Math.round(Q/g)*g;_.scrollTo({left:re,behavior:"smooth"})}function Yh(_){P.value=_;const g=document.querySelector(`[data-player-id="${_}"]`);g&&g.scrollIntoView({behavior:"smooth",block:"center"}),Ve.value=!0,ut.value="Nouveau joueur ajouté !",setTimeout(()=>{Ve.value=!1},3e3)}function Ho(){if(xe.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const g=_.getBoundingClientRect(),V=document.getElementById("coachmark-add"),Q=280,ne=100,re=V!=null&&V.offsetWidth&&V.offsetWidth>0?V.offsetWidth:Q,me=V!=null&&V.offsetHeight&&V.offsetHeight>0?V.offsetHeight:ne,Me=Math.round(g.right+12);if(Me+re<=window.innerWidth-12){const Je=g.top+g.height/2-me/2,Nt=El(Je+-14,me);D.value={position:{x:Me,y:Nt},side:"right"}}else{const Je=Math.round(g.left+g.width/2-re/2),dt=El(g.top-me-8,me),Nt=8,Zt=window.innerWidth-re-8;D.value={position:{x:Math.max(Nt,Math.min(Je,Zt)),y:dt},side:null}}}function El(_,g){const V=pageHeaderRef==null?void 0:pageHeaderRef.value,Q=V?Math.max(0,Math.round(V.getBoundingClientRect().height||0)):0,ne=Math.max(12,Q+8),re=window.innerHeight-g-12;return Math.max(ne,Math.min(Math.round(_),re))}const vr=N(!1),as=N(null),qr=N(null),Wo=N({position:"fixed",top:"0px",right:"0px"});function Tl(){try{const _=as.value;if(!_)return;const g=_.getBoundingClientRect(),V=8,Q=Math.max(V,Math.round(g.bottom+V)),ne=Math.max(V,Math.round(window.innerWidth-g.right));Wo.value={position:"fixed",top:`${Q}px`,right:`${ne}px`,zIndex:400}}catch{}}function bc(){vr.value=!vr.value,vr.value&&dn(()=>Tl())}function Qo(){vr.value=!1}function xl(_){if(!vr.value)return;const g=as.value,V=qr.value,Q=g&&g.contains(_.target),ne=V&&V.contains(_.target);!Q&&!ne&&(vr.value=!1)}function Jo(_){_.key==="Escape"&&Qo()}function Hs(){vr.value&&Tl()}sr(()=>{document.addEventListener("click",xl),document.addEventListener("keydown",Jo),window.addEventListener("scroll",Hs,{passive:!0}),window.addEventListener("resize",Hs)}),ba(()=>{document.removeEventListener("click",xl),document.removeEventListener("keydown",Jo),window.removeEventListener("scroll",Hs),window.removeEventListener("resize",Hs)});function Ki(){var _;xe.value===1&&((_=D.value)!=null&&_.position)&&Ho()}sr(()=>{window.addEventListener("scroll",Ki,{passive:!0}),window.addEventListener("resize",Ki)}),ba(()=>{window.removeEventListener("scroll",Ki),window.removeEventListener("resize",Ki)});function Gi(_){return Sr.value.has(_)}async function Al(){if(o.value)try{const _=await $p(o.value),g=new Set;_.forEach(V=>{V.isProtected&&g.add(V.playerId||V.id)}),Sr.value=g}catch{const g=new Set;for(const V of Ye.value)await wi(V.id,o.value)&&g.add(V.id);Sr.value=g}}const Ve=N(!1),ut=N(""),yr=N(!1),Hi=N("");function ls(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Ve.value=!0,ut.value="Lien copié dans le presse-papiers",setTimeout(()=>{Ve.value=!1},2500)}catch{yr.value=!0,Hi.value="Impossible de copier le lien",setTimeout(()=>{yr.value=!1},2500)}}async function _r(_){await Ys({type:"deleteEvent",data:{eventId:_}})}async function Yo(_=null){const g=_||c.value;if(console.debug("deleteEventConfirmed"),!g){console.error("Aucun événement à supprimer");return}try{await EO(g,o.value),Ke.value=Ke.value.filter(V=>V.id!==g),await Promise.all([Op(o.value),uo(Ye.value,Ke.value,o.value),co(o.value)]).then(([V,Q,ne])=>{Ke.value=V,zt.value=Q,it.value=ne}),l.value=!1,c.value=null,Ve.value=!0,ut.value="Événement supprimé avec succès !",setTimeout(()=>{Ve.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Xo(){l.value=!1,c.value=null}async function Zo(){if(!d.value||!f.value.trim()||!m.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const g={title:f.value.trim(),date:m.value,description:ee.value.trim()||"",playerCount:_,archived:!!Y.value};await G_(d.value,g,o.value),!g.archived&&Ye.value.length>0&&Sr.value.size>0&&($t.value={id:d.value,...g},Qt.value=!0),await Promise.all([Op(o.value),uo(Ye.value,Ke.value,o.value),co(o.value)]).then(([V,Q,ne])=>{Ke.value=V,zt.value=Q,it.value=ne}),d.value=null,f.value="",m.value="",ee.value="",y.value=6,Y.value=!1,Ve.value=!0,ut.value="Événement mis à jour avec succès !",setTimeout(()=>{Ve.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function Et(){if(x.value.trim())try{const _=x.value.trim(),g=await nT(_,o.value);await Promise.all([vd(o.value),uo(Ye.value,Ke.value,o.value),co(o.value)]).then(([V,Q,ne])=>{Ye.value=V,zt.value=Q,it.value=ne,Al();const re=Ye.value.find(Me=>Me.id===g);Yh(g),U.value=g,j.value=Dn.value&&Dn.value[0]&&Dn.value[0].id?Dn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,g)}catch{}try{typeof xe<"u"&&(xe.value=2)}catch{}const me=document.querySelector(`[data-player-id="${g}"]`);me&&me.scrollIntoView({behavior:"smooth",block:"center"}),dn(()=>{const Me=`[data-player-id="${U.value}"] td[data-event-id="${j.value}"]`,je=document.querySelector(Me);if(je){const Je=je.getBoundingClientRect();K.value.position={x:Math.round(Je.left),y:Math.round(Je.top+window.scrollY-48)}}}),Ve.value=!0,ut.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Ve.value=!1},3e3),setTimeout(()=>{Ve.value=!1,ut.value=""},5e3)}),T.value=!1,x.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Br(){d.value=null,f.value="",m.value="",ee.value="",y.value=6}N(null);const zr=N(!1),br=N(""),Ws=N(""),Qs=N(""),Wi=N(6),ea=N(!1);async function Xh(){if(!br.value.trim()||!Ws.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Wi.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const g={title:br.value.trim(),date:Ws.value,description:Qs.value.trim()||"",playerCount:_,archived:!!ea.value};await Zh(g)}async function Zh(_){try{const g=await TO(_,o.value);Ke.value=[...Ke.value,{id:g,..._}];const V={};for(const Q of Ye.value)V[Q.name]=zt.value[Q.name]||{},V[Q.name][g]=null,await z_(Q.name,V[Q.name],o.value);br.value="",Ws.value="",Qs.value="",Wi.value=6,ea.value=!1,zr.value=!1,await Promise.resolve(),Ve.value=!0,ut.value="Événement créé avec succès !",!_.archived&&Ye.value.length>0&&Sr.value.size>0&&($t.value={id:g,..._},Qt.value=!0),setTimeout(()=>{Ve.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Qi(){br.value="",Ws.value="",Qs.value="",Wi.value=6,zr.value=!1}async function kr(){await Ys({type:"addEvent",data:{}})}const Ke=N([]),Ye=N([]),zt=N({}),it=N({}),ef=N({}),Sl=N({});Ot([()=>Ke.value.length,()=>Ye.value.length,Zn],()=>{Zn.value||dn(()=>{Il()})}),Ot([()=>Ye.value.length,()=>Ke.value.length,o],()=>{Ie()}),sr(async()=>{tT("firebase"),await _O();const _=Vu(We(se,"seasons"),zd("slug","==",e.slug)),g=await vt(_);if(g.empty){t.push("/");return}else{const re=g.docs[0];o.value=re.id;const me=re.data();i.value=me.name,a.value=me,document.title=`Saison : ${i.value}`}if(o.value){Rr.value="Chargement des événements de la saison",Pr.value=20;const re=await vt(We(se,"seasons",o.value,"events"));Ke.value=re.docs.map(at=>({id:at.id,...at.data(),playerCount:at.data().playerCount||6})),Rr.value="Chargement des joueurs",Pr.value=45;const me=await vt(We(se,"seasons",o.value,"players"));Ye.value=me.docs.map(at=>({id:at.id,...at.data()})),Rr.value="Chargement des disponibilités",Pr.value=70;const Me=await vt(We(se,"seasons",o.value,"availability")),je={};Me.docs.forEach(at=>{const Nn=at.data(),cr={};Object.keys(Nn).forEach(Vr=>{const ei=Nn[Vr];cr[Vr]=ei==="oui"?!0:ei==="non"?!1:ei}),je[at.id]=cr}),zt.value=je,Rr.value="Chargement des sélections",Pr.value=85;const Je=await vt(We(se,"seasons",o.value,"selections")),dt={};Je.docs.forEach(at=>{dt[at.id]=at.data().players||[]}),it.value=dt;const Nt=await $p(o.value),Zt=new Set;Array.isArray(Nt)&&Nt.forEach(at=>{at.isProtected&&Zt.add(at.playerId||at.id)}),Sr.value=Zt}const V=re=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>re()):setTimeout(re,0)};Rr.value="Préparation de l'interface",Pr.value=95,V(()=>{Sc(),oa()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await dn(),Pr.value=100,Zn.value=!1,dn(()=>{Kn(),requestAnimationFrame(()=>Kn()),setTimeout(()=>Kn(),250);const re=kn.value;re&&(re.addEventListener("scroll",me=>{Kn(),wl.value=re.scrollLeft||0},{passive:!0}),window.addEventListener("resize",Kn),typeof ResizeObserver<"u"&&(zo.value=new ResizeObserver(()=>{Kn()}),zo.value.observe(re)))});const Q=r.query.event;if(Q&&Ke.value.length>0){const re=Ke.value.find(me=>me.id===Q);re?(console.debug("Événement trouvé depuis l'URL"),await of(Q,re)):(console.warn("Événement non trouvé avec l'ID"),yr.value=!0,Hi.value="Événement non trouvé",setTimeout(()=>{yr.value=!1},3e3))}const ne=r.query.player;if(ne&&Ye.value.length>0){const re=Ye.value.find(me=>me.id===ne);re&&(un(re),await dn(),r.query.verified==="1"&&(Ve.value=!0,ut.value="Joueur associé à votre compte.",setTimeout(()=>{Ve.value=!1},2500)))}}),Ot(()=>r.params.eventId,_=>{if(_){const g=()=>{const V=Ke.value.find(Q=>Q.id===_);return V?(v(V),!0):!1};if(Ke.value.length>0)g();else{const V=Ot(Ke,Q=>{Q.length>0&&g()&&V()},{immediate:!0})}}},{immediate:!0});function wc(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const g=new Date(_);return isNaN(g.getTime())?null:g}return null}const Gn=qe(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const g=[...Ye.value].sort((me,Me)=>(me.name||"").localeCompare(Me.name||"","fr",{sensitivity:"base"}));if(!_)return g;let V=[];try{_.startsWith("[")?V=JSON.parse(_):_&&(V=[_])}catch{V=[]}const Q=new Set(V);if(Q.size===0)return g;const ne=g.filter(me=>Q.has(me.id)),re=g.filter(me=>!Q.has(me.id));return[...ne,...re]}),ta=qe(()=>{try{if(o.value){const _=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!_)return new Set;if(_.startsWith("[")){const g=JSON.parse(_);return new Set(Array.isArray(g)?g:[])}return new Set([_])}}catch{}return new Set}),tf=qe(()=>[...Ke.value].sort((_,g)=>{const V=wc(_.date),Q=wc(g.date),ne=V?V.getTime():Number.POSITIVE_INFINITY,re=Q?Q.getTime():Number.POSITIVE_INFINITY;return ne!==re?ne-re:(_.title||"").localeCompare(g.title||"","fr",{sensitivity:"base"})})),Dr=N(!1),Dn=qe(()=>{const _=tf.value;return Dr.value?_:_.filter(g=>!g.archived)});function Ic(){Dr.value=!Dr.value}const us=N("selected"),Ji=qe(()=>{var V;if(!M.value)return Gn.value;const _=M.value.id,g=new Set(((V=it.value)==null?void 0:V[_])||[]);return Gn.value.filter(Q=>{var Me;const ne=Q.name,re=(Me=zt.value[ne])==null?void 0:Me[_],me=g.has(ne);switch(us.value){case"selected":return me;case"available":return re===!0&&!me;case"unavailable":return re===!1;case"unknown":return re!==!0&&re!==!1;case"all":default:return!0}})}),Ec=qe(()=>M.value?hs(M.value.id):null),Pl=qe(()=>{if(!M.value)return!1;const _=hs(M.value.id);return _.type==="incomplete"||_.type==="insufficient"}),Dt=qe(()=>M.value?nf(M.value.id):"");async function na(_,g){const V=Ye.value.find(re=>re.name===_);if(!V){console.error("Joueur non trouvé");return}const Q=Ke.value.find(re=>re.id===g);if(!Q){console.error("Événement non trouvé");return}if(Q.archived){Ve.value=!0,ut.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Ve.value=!1},3e3);return}if(Gi(V.id)){const re=To(V.id),me=ue.value===V.id;console.debug("Joueur protégé:",{playerId:V.id,hasCachedPassword:re,wasRecentlyVerified:me,recentlyVerifiedPlayer:ue.value}),re||me?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),me&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),ue.value=null),Rl(V,g)):(console.debug("Pas de session, affichage de la modal de vérification"),fe.value={playerName:_,eventId:g},he.value=V,ye.value=!0);return}Rl(V,g)}function Rl(_,g){var ne,re,me;const V=(ne=zt.value[_.name])==null?void 0:ne[g];console.debug("toggleAvailability");let Q;V===!0?Q=!1:V===!1?Q=void 0:Q=!0,Q===void 0?zt.value[_.name]&&delete zt.value[_.name][g]:(zt.value[_.name]||(zt.value[_.name]={}),zt.value[_.name][g]=Q);try{typeof xe<"u"&&xe.value===1&&_.id===(U.value||((re=Gn.value[0])==null?void 0:re.id))&&g===(j.value||((me=Dn.value[0])==null?void 0:me.id))&&(xe.value=3,dn(()=>{const je=document.querySelector(`[data-player-id="${_.id}"]`);if(je){const Je=je.querySelector(".player-name");if(Je){const dt=Je.getBoundingClientRect();X.value.position={x:Math.round(dt.right+8),y:Math.round(dt.top+window.scrollY-4)}}}}),ba(()=>{try{window.removeEventListener("resize",Kn)}catch{}try{zo.value&&zo.value.disconnect()}catch{}}))}catch{}z_(_.name,zt.value[_.name],o.value).then(async()=>{await dn(),oa(),Ve.value=!0,ut.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Ve.value=!1},3e3)}).catch(Me=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function wr(_,g){var V;return(V=zt.value[_])==null?void 0:V[g]}function Tc(_,g){var ne;const V=it.value[g]||[],Q=(ne=zt.value[_])==null?void 0:ne[g];return V.includes(_)&&Q===!0}async function xc(_,g=6){const V=Ke.value.find(me=>me.id===_),Q=(V==null?void 0:V.playerCount)||6,ne=it.value[_]||[];if(ne.length>0&&ne.every(me=>wr(me,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Me=Ye.value.filter(dt=>wr(dt.name,_)).map(dt=>{const Nt=Js(dt.name);return{name:dt.name,weight:1/(1+Nt)}}),je=[],Je=[...Me];for(;je.length<Q&&Je.length>0;){const dt=Je.reduce((at,Nn)=>at+Nn.weight,0);let Nt=Math.random()*dt;const Zt=Je.findIndex(at=>(Nt-=at.weight,Nt<=0));Zt>=0&&(je.push(Je[Zt].name),Je.splice(Zt,1))}it.value[_]=je}else{const me=ne.filter(je=>wr(je,_)),Me=Q-me.length;if(Me<=0)it.value[_]=me;else{const je=new Set(me),dt=Ye.value.filter(at=>wr(at.name,_)&&!je.has(at.name)).map(at=>{const Nn=Js(at.name);return{name:at.name,weight:1/(1+Nn)}}),Nt=[],Zt=[...dt];for(;Nt.length<Me&&Zt.length>0;){const at=Zt.reduce((Vr,ei)=>Vr+ei.weight,0);let Nn=Math.random()*at;const cr=Zt.findIndex(Vr=>(Nn-=Vr.weight,Nn<=0));cr>=0&&(Nt.push(Zt[cr].name),Zt.splice(cr,1))}it.value[_]=[...me,...Nt]}}await K_(_,it.value[_],o.value),Sc(),oa()}async function Yi(_,g=6){var me,Me;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const V=Se.value,Q=(me=ke.value)==null?void 0:me.id,ne=it.value[_]&&it.value[_].length>0,re=ne?[...it.value[_]]:[];if(await xc(_,g),console.debug("etat modal selection apres"),V&&!Se.value&&(console.debug("Restauration de la popin de sélection..."),Se.value=!0,ke.value=Ke.value.find(je=>je.id===Q)),Se.value&&((Me=ke.value)==null?void 0:Me.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await dn(),Le.value&&Le.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const je=it.value[_]||[],Je=re.filter(Nt=>je.includes(Nt)),dt=Je.length>0&&Je.length<re.length;Le.value.showSuccess(ne,dt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Ve.value=!0,Ke.value.find(je=>je.id===_),it.value[_],ne?ut.value="Sélection mise à jour avec succès !":ut.value="Sélection effectuée avec succès !",setTimeout(()=>{Ve.value=!1},3e3)}function ra(_){_===0?D.value.position=null:_===1?K.value.position=null:_===2&&(X.value.position=null)}function Nr(_){var V;return _?(typeof _=="string"?new Date(_):((V=_.toDate)==null?void 0:V.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function sa(_){var V;return _?(typeof _=="string"?new Date(_):((V=_.toDate)==null?void 0:V.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function Js(_){return Object.values(it.value).filter(g=>g.includes(_)).length}function cs(_){const g=zt.value[_]||{};return Object.values(g).filter(V=>V===!0).length}function Xi(_){return _?Object.values(zt.value).filter(g=>g[_]===!0).length:0}function Zi(_){return _?(it.value[_]||[]).length:0}function eo(_){const g=Ke.value.find(Q=>Q.id===_),V=(g==null?void 0:g.playerCount)||6;return Zi(_)>=V}function Ac(_){const g=cs(_),V=Js(_);return g===0?0:V/g}function ia(_){ef.value[_]={availability:cs(_),selection:Js(_),ratio:Ac(_)}}function Sc(){Ye.value.forEach(_=>ia(_.name))}function oa(){const _={};Ke.value.forEach(g=>{const V=g.playerCount||6,ne=Ye.value.filter(me=>wr(me.name,g.id)===!0).map(me=>{const Me=Js(me.name);return{name:me.name,weight:1/(1+Me)}}),re=ne.reduce((me,Me)=>me+Me.weight,0);ne.forEach(me=>{const Me=Math.min(1,me.weight/re*V);_[me.name]||(_[me.name]={}),_[me.name][g.id]=Math.round(Me*100)})}),Sl.value=_}const Kr=N(null),to=N(!1);async function Pc(_=null){const g=_||Kr.value;if(!g){console.error("Aucun joueur à supprimer");return}try{await bO(g,o.value),Ye.value=Ye.value.filter(V=>V.id!==g),to.value=!1,Kr.value=null,Ve.value=!0,ut.value="Joueur supprimé avec succès !",setTimeout(()=>{Ve.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function Cl(){to.value=!1,Kr.value=null}async function kl(_){mn(),await wi(_,o.value)?await ds({type:"deletePlayer",data:{playerId:_}}):await Ys({type:"deletePlayer",data:{playerId:_}})}async function Rc(){if(S.value){const _=Ke.value.find(V=>V.id===S.value),g=(_==null?void 0:_.playerCount)||6;await Yi(S.value,g),de.value=!1,S.value=null}}function aa(){de.value=!1,S.value=null}function Cc(){return q.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[q.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Ys(_){if(Tn.isPinCached(o.value)){const g=Tn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await Qd(o.value,g)){await u(_);return}else Tn.clearSession()}q.value=_,O.value=!0}async function ds(_){const g=_.data.playerId;try{if(Tn.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await u(_);return}}catch{}if(To(g)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await u(_);return}De.value=_,It.value=!0}async function kc(_){try{if(await Qd(o.value,_)){Tn.saveSession(o.value,_),O.value=!1;const V=q.value;q.value=null,await u(V)}else R.value="Code PIN incorrect",setTimeout(()=>{R.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),R.value="Erreur lors de la vérification du code PIN"}}function Dc(){O.value=!1,q.value=null,R.value=""}async function Dl(_){if(_){Fe.value=!0,ge.value="";try{const g=De.value.data.playerId,V=await Np(o.value);if(_===V){try{Tn.saveSession(o.value,_)}catch{}try{Di.saveSession(De.value.data.playerId)}catch{}It.value=!1;const ne=De.value;De.value=null,Ee.value="",await u(ne);return}if(await verifyPlayerPassword(g,_,o.value)){It.value=!1;const ne=De.value;De.value=null,Ee.value="",await u(ne)}else ge.value="Mot de passe incorrect",setTimeout(()=>{ge.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),ge.value="Erreur lors de la vérification du mot de passe"}finally{Fe.value=!1}}}function Nc(){It.value=!1,De.value=null,ge.value="",Ee.value="",Fe.value=!1}async function no(_){if(_){Ge.value=!0,pe.value="";try{const g=bt.value.data.player,V=await Np(o.value);if(_===V){try{Tn.saveSession(o.value,_)}catch{}try{Di.saveSession(bt.value.data.player.id)}catch{}Wt.value=!1;const ne=bt.value;bt.value=null,le.value="",await u(ne);return}if(await verifyPlayerPassword(g.id,_,o.value)){Wt.value=!1;const ne=bt.value;bt.value=null,le.value="",await u(ne)}else pe.value="Mot de passe incorrect",setTimeout(()=>{pe.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),pe.value="Erreur lors de la vérification du mot de passe"}finally{Ge.value=!1}}}function Hn(){Wt.value=!1,bt.value=null,pe.value="",le.value="",Ge.value=!1}async function Vc(){k.value=!0,L.value="",J.value="";try{const _=bt.value.data.player,g=await sendPasswordResetEmail(_.id,o.value);J.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),L.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{k.value=!1}}async function Oc(){Ce.value=!0,$e.value="",E.value="";try{const _=De.value.data.playerId,g=await sendPasswordResetEmail(_,o.value);E.value=g.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),$e.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Ce.value=!1}}function Xs(){return Tn.isPinCached(o.value)?{timeRemaining:Tn.getTimeRemaining(),isExpiringSoon:Tn.isExpiringSoon()}:null}async function u(_){var Q;if(!_)return;const{type:g,data:V}=_;try{switch(g){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=V.eventId,l.value=!0;break;case"addEvent":zr.value=!0;break;case"deletePlayer":Kr.value=V.playerId,to.value=!0;break;case"launchSelection":it.value[V.eventId]&&it.value[V.eventId].length>0?(S.value=V.eventId,de.value=!0,A.value=!1):(await Yi(V.eventId,V.count),A.value=!1);break;case"toggleAvailability":Rl(V.player,V.eventId);break;case"toggleArchive":await setEventArchived(V.eventId,V.archived,o.value);{const ne=Ke.value.findIndex(re=>re.id===V.eventId);ne!==-1&&(Ke.value[ne]={...Ke.value[ne],archived:!!V.archived}),Y.value=!!V.archived}break;case"updateSelection":{const{eventId:ne,players:re}=V,me=[...it.value[ne]||[]],Me=Array.isArray(re)?re:[];await K_(ne,Me,o.value),it.value[ne]=Me;try{const je=me.filter(Je=>!Me.includes(Je));if(je.length>0){const Je=Ke.value.find(dt=>dt.id===ne);await cM({eventId:ne,eventData:Je,removedPlayers:je,newSelectedPlayers:Me,seasonId:o.value,seasonSlug:s,players:an.value})}}catch{}try{(Q=Le.value)==null||Q.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Ve.value=!0,ut.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Ve.value=!1},3e3)}}function p(){t.push("/")}ba(()=>{const _=kn.value;_&&_.removeEventListener("scroll",Kn),window.removeEventListener("resize",Kn)});async function v(_){M.value=_,ee.value=_.description||"",Y.value=!!_.archived;try{const[g,V]=await Promise.all([uo(Ye.value,Ke.value,o.value),co(o.value)]);zt.value=g,it.value=V}catch(g){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",g)}A.value=!0}function b(){A.value=!1,M.value=null,ee.value="",te.value=!1}function B(){b(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function H(_,g){console.debug("handleAvailabilityToggle appelé");const V=Ye.value.find(re=>re.name===_);if(!V){console.error("Joueur non trouvé");return}const Q=Ke.value.find(re=>re.id===g);if(Q!=null&&Q.archived){Ve.value=!0,ut.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Ve.value=!1},3e3);return}console.debug("Joueur trouvé");const ne=Gi(V.id);if(console.debug("Joueur protégé"),ne){To(V.id)?(console.debug("Session active, procéder au toggle"),await na(_,g)):(console.debug("Demande du mot de passe pour joueur protégé"),fe.value={playerName:_,eventId:g},he.value=V,ye.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await na(_,g)}function be(_,g){return(it.value[g]||[]).includes(_)}async function yt(_){if(console.debug("Mot de passe vérifié"),he.value&&(ue.value=he.value.id,console.debug("Joueur marqué comme récemment vérifié")),fe.value){const{playerName:g,eventId:V}=fe.value;console.debug("Exécution de l'action en attente"),await na(g,V),fe.value=null}else console.debug("Aucune action en attente trouvée");ye.value=!1,he.value=null}function ln(){d.value=M.value.id,f.value=M.value.title,m.value=M.value.date,ee.value=M.value.description||"",y.value=M.value.playerCount||6,A.value=!1}async function ot(){if(M.value)try{const _=!M.value.archived,g={...M.value,archived:_};await G_(M.value.id,g,o.value),M.value.archived=_;const V=Ke.value.findIndex(Q=>Q.id===M.value.id);V!==-1&&(Ke.value[V].archived=_),Ve.value=!0,ut.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Ve.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function un(_){w.value=_,I.value=!0;try{typeof xe<"u"&&xe.value}catch{}}function mn(){I.value=!1,w.value=null}async function Zs({playerId:_,newName:g}){try{await wO(_,g,o.value),await Promise.all([vd(o.value),uo(Ye.value,Ke.value,o.value),co(o.value)]).then(([V,Q,ne])=>{if(Ye.value=V,zt.value=Q,it.value=ne,Al(),w.value&&w.value.id===_){const re=V.find(me=>me.id===_);re&&(w.value=re)}}),Ve.value=!0,ut.value="Joueur mis à jour avec succès !",setTimeout(()=>{Ve.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function ur(){try{await Promise.all([vd(o.value),uo(Ye.value,Ke.value,o.value),co(o.value)]).then(([_,g,V])=>{if(Ye.value=_,zt.value=g,it.value=V,Al(),w.value){const Q=_.find(ne=>ne.id===w.value.id);Q&&(w.value=Q)}}),Ve.value=!0,ut.value="Données mises à jour !",setTimeout(()=>{Ve.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function la(_){if(!_)return{availability:0,selection:0,ratio:0};const g=cs(_.name),V=Js(_.name),Q=g===0?0:Math.round(V/g*100);return{availability:g,selection:V,ratio:Q}}function hs(_){const g=it.value[_]||[],V=Ke.value.find(re=>re.id===_),Q=(V==null?void 0:V.playerCount)||6,ne=Xi(_);if(g.length>0){const re=g.some(Me=>!wr(Me,_)),me=ne<Q;if(re||me)return{type:"incomplete",hasUnavailablePlayers:re,hasInsufficientPlayers:me,unavailablePlayers:g.filter(Me=>!wr(Me,_)),availableCount:ne,requiredCount:Q}}return ne<Q?{type:"insufficient",availableCount:ne,requiredCount:Q}:g.length===0?{type:"ready",availableCount:ne,requiredCount:Q}:{type:"complete",availableCount:ne,requiredCount:Q}}function QT(_){const g=hs(_);return g.type==="incomplete"||g.type==="insufficient"}function nf(_){const g=hs(_);switch(g.type){case"incomplete":return g.hasUnavailablePlayers?g.unavailablePlayers.length===1?`Sélection incomplète : ${g.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${g.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${g.availableCount} joueurs disponibles pour ${g.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${g.availableCount} disponibles pour ${g.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${g.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${g.availableCount} joueurs disponibles`;default:return""}}async function JT({eventId:_,eventData:g,reason:V}){if(!o.value)return;const Q={id:_,...g};if(Q.archived){console.debug("Événement archivé, aucune notification envoyée"),Ve.value=!0,ut.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Ve.value=!1},3e3);return}const ne=[];for(const re of Ye.value){if(!await wi(re.id,o.value))continue;const Me=await pT(re.id,o.value);if(Me)try{const je=await Mp({seasonId:o.value,playerId:re.id,eventId:Q.id,action:"yes"}),Je=await Mp({seasonId:o.value,playerId:re.id,eventId:Q.id,action:"no"}),dt=`${je.url}&slug=${encodeURIComponent(s)}`,Nt=`${Je.url}&slug=${encodeURIComponent(s)}`;await iM({toEmail:Me,playerName:re.name,eventTitle:Q.title,eventDate:sa(Q.date),yesUrl:dt,noUrl:Nt,reason:V})}catch{console.error("Email non envoyé pour un joueur"),ne.push(re.id)}}Ve.value=!0,ut.value=ne.length>0?`Emails envoyés (avec ${ne.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Ve.value=!1},3e3)}function rf(_){if(_!=null&&_.archived){Ve.value=!0,ut.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Ve.value=!1},3e3);return}Gg(),Xe.value=_,ze.value=!0}function Kg(){ze.value=!1,Xe.value=null}function Gg(){Qt.value=!1,$t.value=null}async function Hg({eventId:_,eventData:g,reason:V,selectedPlayers:Q}){try{V==="selection"?(await uM({eventId:_,eventData:g,selectedPlayers:Q,seasonId:o.value,seasonSlug:s,players:an.value}),sf(),Ve.value=!0,ut.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Ve.value=!1},3e3)):(await JT({eventId:_,eventData:g,reason:V}),Kg(),Ve.value=!0,ut.value="Notifications envoyées avec succès !",setTimeout(()=>{Ve.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Ve.value=!0,ut.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Ve.value=!1},3e3)}}function Wg(_){if(!_)return{};const g={};return Ye.value.forEach(V=>{g[V.name]=wr(V.name,_)}),g}function Mc(_){if(_!=null&&_.archived){Ve.value=!0,ut.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Ve.value=!1},3e3);return}ke.value=_,Se.value=!0}function sf(){Se.value=!1,ke.value=null}async function YT(){if(!ke.value)return;const _=ke.value.id,g=ke.value.playerCount||6;if(Xi(_)===0){Ve.value=!0,ut.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Ve.value=!1},3e3);return}await Ys({type:"launchSelection",data:{eventId:_,count:g}})}function XT(){sf(),Ve.value=!0,ut.value="Sélection validée !",setTimeout(()=>{Ve.value=!1},3e3)}async function ZT(_){if(!_||!_.eventId)return;const{eventId:g,players:V}=_;await Ys({type:"updateSelection",data:{eventId:g,players:V}})}async function of(_,g){if(!_||!g)return;Jg(),Cr.value=_,Bs.value=!0,await dn();const V=document.querySelector(`[data-event-id="${_}"]`);if(!V){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(me=>{me.classList.remove("focused-event-highlight")});const Q=document.querySelectorAll(`[data-event-id="${_}"]`);Q.forEach(me=>{me.classList.add("focused-event-highlight")});const ne=Q[0],re=Q[Q.length-1];ne&&ne.classList.add("focused-event-column-start"),re&&re.classList.add("focused-event-column-end"),await ex(V),Ve.value=!0,ut.value=`Événement ciblé : ${g.title}`,setTimeout(()=>{Ve.value=!1},4e3),Bi.value=setTimeout(()=>{Jg()},8e3)}function Qg(_){if(!_)return;const g=Ke.value.find(V=>V.id===_);if(!g){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const V=Ke.value.find(Q=>Q.id===_);V?of(_,V):console.error("Événement toujours introuvable après retry")},500);return}of(_,g)}async function ex(_){if(!_)return;if(await new Promise(V=>setTimeout(V,100)),window.innerWidth<=768){const V=kn.value;if(V){const Q=_.offsetLeft,ne=_.offsetWidth,re=V.clientWidth,me=Q-re/2+ne/2,Me=V.scrollWidth-re,je=Math.max(0,Math.min(me,Me));V.scrollTo({left:je,behavior:"smooth"}),setTimeout(()=>{const Je=_.getBoundingClientRect();if(Je.left<0||Je.right>window.innerWidth){const dt=Q-20;V.scrollTo({left:Math.max(0,dt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const g=kn.value;g&&setTimeout(()=>{const V=document.querySelector(`[data-event-id="${Cr.value}"]`);if(V&&V.closest("tbody")){const Q=V.offsetLeft,ne=V.offsetWidth,re=g.clientWidth,me=Q-re/2+ne/2,Me=g.scrollWidth-re,je=Math.max(0,Math.min(me,Me));g.scrollTo({left:je,behavior:"smooth"})}},300)}function Jg(){Bi.value&&(clearTimeout(Bi.value),Bi.value=null),Cr.value=null,Bs.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,g)=>{var V,Q,ne,re,me,Me,je,Je,dt,Nt,Zt,at,Nn,cr,Vr,ei,Yg,Xg,Zg,ev;return F(),$(gt,null,[h("div",_$,[h("div",b$,[h("button",{onClick:p,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},g[70]||(g[70]=[h("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),h("h1",w$,ie(i.value?i.value:"Chargement..."),1),h("div",I$,[h("div",E$,[h("button",{onClick:ji,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},g[71]||(g[71]=[h("span",{class:"text-2xl"},"👤",-1)])),h("button",{onClick:g[0]||(g[0]=W=>yn.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},g[72]||(g[72]=[h("span",{class:"text-2xl"},"❓",-1)]))]),h("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:as},[h("button",{onClick:g[1]||(g[1]=Vt(W=>{bc(),Tl()},["stop"])),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},g[73]||(g[73]=[h("span",{class:"text-2xl"},"⋯",-1)]))],512),(F(),Td(Hx,{to:"body"},[vr.value?(F(),$("div",{key:0,ref_key:"headerMenuDropdownRef",ref:qr,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:vs(Wo.value)},[h("button",{onClick:g[2]||(g[2]=W=>{ji(),Qo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[74]||(g[74]=[h("span",null,"👤",-1),h("span",{class:"text-sm"},"Mon compte",-1)])),h("button",{onClick:g[3]||(g[3]=W=>{yn.value=!0,Qo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},g[75]||(g[75]=[h("span",null,"❓",-1),h("span",{class:"text-sm"},"Kezako ?",-1)]))],4)):ce("",!0)]))])],512),h("div",T$,[h("div",{ref_key:"headerBarRef",ref:Ks,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[h("div",x$,[Ke.value.length===0&&Ye.value.length===0?ce("",!0):(F(),$("div",A$,[h("div",{class:"flex items-center justify-center h-full gap-2"},[h("button",{onClick:kr,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},g[76]||(g[76]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),h("span",{class:"sm:hidden"},"Événement",-1)]))])])),h("div",S$,[h("div",{ref_key:"headerEventsRef",ref:zn,class:"flex relative z-[60]",style:vs({transform:`translateX(-${wl.value}px)`})},[(F(!0),$(gt,null,dr(Dn.value,W=>(F(),$("div",{key:"h-"+W.id,"data-event-id":W.id,class:Kt(["col-event flex-shrink-0 p-3 text-center cursor-pointer",{"archived-header":W.archived}]),onClick:Vn=>v(W)},[h("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:sa(W.date)},ie(Nr(W.date)),9,R$),h("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:W.title},ie(W.title||"Sans titre"),9,C$),W.archived?(F(),$("div",k$,"(Archivé)")):ce("",!0),QT(W.id)?(F(),$("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:nf(W.id)+" - Cliquez pour ouvrir la sélection",onClick:Vt(Vn=>Mc(W),["stop"])},g[77]||(g[77]=[h("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,D$)):hs(W.id).type==="ready"?(F(),$("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:nf(W.id)+" - Cliquez pour ouvrir la sélection",onClick:Vt(Vn=>Mc(W),["stop"])},g[78]||(g[78]=[h("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,N$)):ce("",!0)],10,P$))),128))],4)]),g[81]||(g[81]=h("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),h("button",{onClick:Ic,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:Dr.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":Dr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(F(),$("svg",O$,[g[79]||(g[79]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),g[80]||(g[80]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),Dr.value?ce("",!0):(F(),$("path",M$))]))],8,V$),Ze(h("button",{onClick:g[4]||(g[4]=Vt(W=>Go(-1,W),["prevent"])),onMousedown:g[5]||(g[5]=Vt(W=>Gs(-1,W),["prevent"])),onMouseup:g[6]||(g[6]=W=>gr(W)),onMouseleave:g[7]||(g[7]=W=>gr(W)),onTouchstart:g[8]||(g[8]=Vt(W=>Gs(-1,W),["prevent"])),onTouchend:g[9]||(g[9]=W=>gr(W)),onTouchcancel:g[10]||(g[10]=W=>gr(W)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[mf,zs.value]]),Ze(h("button",{onClick:g[11]||(g[11]=Vt(W=>Go(1,W),["prevent"])),onMousedown:g[12]||(g[12]=Vt(W=>Gs(1,W),["prevent"])),onMouseup:g[13]||(g[13]=W=>gr(W)),onMouseleave:g[14]||(g[14]=W=>gr(W)),onTouchstart:g[15]||(g[15]=Vt(W=>Gs(1,W),["prevent"])),onTouchend:g[16]||(g[16]=W=>gr(W)),onTouchcancel:g[17]||(g[17]=W=>gr(W)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[mf,yc.value]])])],512),Ze(h("div",{ref_key:"gridboardRef",ref:kn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[xe.value===1?(F(),$("div",L$,[D.value.position?(F(),$("div",{key:0,class:"fixed z-[400]",style:vs({left:D.value.position.x+"px",top:D.value.position.y+"px"})},[h("div",{id:"coachmark-add",class:Kt(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":D.value.side==="right","coachmark-left":D.value.side==="left"}])},[g[83]||(g[83]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),g[84]||(g[84]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),h("div",F$,[g[82]||(g[82]=h("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),h("button",{onClick:g[18]||(g[18]=W=>ra(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ce("",!0)])):ce("",!0),xe.value===2&&U.value&&j.value?(F(),$("div",$$,[K.value.position?(F(),$("div",{key:0,class:"fixed z-[400]",style:vs({position:"absolute",left:K.value.position.x+"px",top:K.value.position.y+"px"})},[h("div",U$,[g[86]||(g[86]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),g[87]||(g[87]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),h("div",j$,[g[85]||(g[85]=h("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),h("button",{onClick:g[19]||(g[19]=W=>ra(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),xe.value===3&&U.value?(F(),$("div",q$,[X.value.position?(F(),$("div",{key:0,class:"fixed z-[400]",style:vs({position:"absolute",left:X.value.position.x+"px",top:X.value.position.y+"px"})},[h("div",B$,[g[89]||(g[89]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),g[90]||(g[90]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),h("div",z$,[g[88]||(g[88]=h("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),h("button",{onClick:g[20]||(g[20]=W=>ra(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ce("",!0)])):ce("",!0),h("table",K$,[h("colgroup",null,[g[91]||(g[91]=h("col",{class:"col-left"},null,-1)),(F(!0),$(gt,null,dr(Dn.value,(W,Vn)=>(F(),$("col",{key:"c"+Vn,class:"col-event"}))),128)),g[92]||(g[92]=h("col",{class:"col-right"},null,-1))]),g[96]||(g[96]=h("thead",{class:"hidden"},null,-1)),h("tbody",null,[(F(!0),$(gt,null,dr(Gn.value,W=>{var Vn;return F(),$("tr",{key:W.id,class:Kt(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":W.id===P.value,"preferred-player":ta.value.has(W.id)}]),"data-player-id":W.id},[h("td",H$,[h("div",W$,[Gi(W.id)?(F(),$("span",Q$," 🔒 ")):ce("",!0),h("span",{onClick:tr=>un(W),class:Kt(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":xe.value===3&&W.id===(U.value||((Vn=Gn.value[0])==null?void 0:Vn.id))}]),title:"Cliquez pour voir les détails : "+W.name},ie(W.name),11,J$)])]),(F(!0),$(gt,null,dr(Dn.value,tr=>{var tv,nv,rv;return F(),$("td",{key:tr.id,"data-event-id":tr.id,class:Kt(["p-0",tr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":xe.value===2&&W.id===(U.value||((tv=Gn.value[0])==null?void 0:tv.id))&&tr.id===(j.value||((nv=Dn.value[0])==null?void 0:nv.id))}])},[lt(Q_,{"player-name":W.name,"event-id":tr.id,"is-available":wr(W.name,tr.id),"is-selected":Tc(W.name,tr.id),"chance-percent":((rv=Sl.value[W.name])==null?void 0:rv[tr.id])??null,"show-selected-chance":eo(tr.id),disabled:tr.archived===!0,onToggle:na},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,Y$)}),128)),g[93]||(g[93]=h("td",{class:"p-3 md:p-4"},null,-1))],10,G$)}),128)),h("tr",X$,[h("td",Z$,[h("div",e6,[h("button",{onClick:g[21]||(g[21]=W=>T.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},g[94]||(g[94]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),h("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(F(!0),$(gt,null,dr(Dn.value,W=>(F(),$("td",{key:"add-row-"+W.id,"data-event-id":W.id,class:Kt(["p-3 md:p-5",W.archived?"archived-col":""])},null,10,t6))),128)),g[95]||(g[95]=h("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[mf,!Zn.value]])])]),Zn.value?(F(),$("div",n6,[h("div",r6,[g[97]||(g[97]=h("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("p",s6,ie(Rr.value)+"…",1),h("div",i6,[h("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:vs({width:Pr.value+"%"})},null,4)]),h("p",o6,ie(Pr.value)+"%",1)])])):ce("",!0),Zn.value?ce("",!0):(F(),Td(YF,{key:1,"season-id":o.value,"season-slug":Ts(s),"players-count":Ye.value.length,"events-count":Ke.value.length,"onboarding-done":((V=a.value)==null?void 0:V.onboardingCreatorDone)===!0,onCreateEvent:kr,onAddPlayer:g[22]||(g[22]=()=>{T.value=!0}),onCopyLink:ls,onDismissed:bl},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ce("",!0),Ve.value?(F(),$("div",a6,[h("div",l6,[g[98]||(g[98]=h("span",{class:"text-xl"},"✨",-1)),h("span",null,ie(ut.value),1)])])):ce("",!0),yr.value?(F(),$("div",u6,[h("div",c6,[g[99]||(g[99]=h("span",{class:"text-xl"},"⚠️",-1)),h("span",null,ie(Hi.value),1)])])):ce("",!0),zr.value?(F(),$("div",d6,[h("div",h6,[g[105]||(g[105]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),h("div",f6,[g[100]||(g[100]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),Ze(h("input",{"onUpdate:modelValue":g[23]||(g[23]=W=>br.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[St,br.value]])]),h("div",p6,[g[101]||(g[101]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),Ze(h("input",{"onUpdate:modelValue":g[24]||(g[24]=W=>Ws.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[St,Ws.value]])]),h("div",m6,[g[102]||(g[102]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),Ze(h("textarea",{"onUpdate:modelValue":g[25]||(g[25]=W=>Qs.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[St,Qs.value]])]),h("div",g6,[Ze(h("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":g[26]||(g[26]=W=>ea.value=W),class:"w-4 h-4"},null,512),[[bo,ea.value]]),g[103]||(g[103]=h("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),h("div",v6,[g[104]||(g[104]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),Ze(h("input",{"onUpdate:modelValue":g[27]||(g[27]=W=>Wi.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[St,Wi.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Qi,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Xh,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ce("",!0),T.value?(F(),$("div",y6,[h("div",_6,[g[107]||(g[107]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),h("div",b6,[g[106]||(g[106]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),Ze(h("input",{"onUpdate:modelValue":g[28]||(g[28]=W=>x.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[St,x.value]])]),h("div",w6,[h("button",{onClick:g[29]||(g[29]=W=>T.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Et,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ce("",!0),l.value?(F(),$("div",I6,[h("div",E6,[g[108]||(g[108]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),h("div",T6,[h("button",{onClick:Xo,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:g[30]||(g[30]=()=>Yo()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ce("",!0),to.value?(F(),$("div",x6,[h("div",A6,[g[109]||(g[109]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),h("div",S6,[h("button",{onClick:Cl,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:g[31]||(g[31]=()=>Pc()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ce("",!0),de.value?(F(),$("div",P6,[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[g[110]||(g[110]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:aa,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:Rc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ce("",!0),A.value?(F(),$("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:b},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:g[42]||(g[42]=Vt(()=>{},["stop"]))},[h("div",R6,[h("button",{onClick:b,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),g[111]||(g[111]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),h("h2",C6,ie((Q=M.value)==null?void 0:Q.title),1),h("p",k6,ie(sa((ne=M.value)==null?void 0:ne.date)),1)]),h("div",D6,[(re=M.value)!=null&&re.description?(F(),$("div",N6,[h("p",V6,ie(M.value.description),1)])):ce("",!0),h("div",O6,[h("div",M6,[h("div",L6,ie(Xi((me=M.value)==null?void 0:me.id)),1),g[112]||(g[112]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",F6,[h("div",$6,ie(Zi((Me=M.value)==null?void 0:Me.id)),1),g[113]||(g[113]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",U6,[h("div",j6,ie(((je=M.value)==null?void 0:je.playerCount)||6),1),g[114]||(g[114]=h("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),M.value?(F(),$("div",q6,[h("div",B6,[Pl.value?(F(),$("div",{key:0,class:Kt(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((Je=Ec.value)==null?void 0:Je.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:Dt.value},[g[115]||(g[115]=h("span",null,"⚠️",-1)),h("span",K6,ie(Dt.value),1)],10,z6)):ce("",!0),Ze(h("select",{"onUpdate:modelValue":g[32]||(g[32]=W=>us.value=W),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},g[116]||(g[116]=[rr('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[pS,us.value]])]),h("div",G6,[(F(!0),$(gt,null,dr(Ji.value,W=>{var Vn,tr;return F(),$("div",{key:W.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[h("div",H6,[Gi(W.id)?(F(),$("span",W6," 🔒 ")):ce("",!0),h("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:W.name},ie(W.name),9,Q6)]),h("div",J6,[lt(Q_,{"player-name":W.name,"event-id":M.value.id,"is-available":Wg(M.value.id)[W.name],"is-selected":be(W.name,M.value.id),"chance-percent":((Vn=Sl.value[W.name])==null?void 0:Vn[M.value.id])??null,"show-selected-chance":eo(M.value.id),disabled:((tr=M.value)==null?void 0:tr.archived)===!0,compact:!0,onToggle:H},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ce("",!0),h("div",Y6,[h("button",{onClick:ln,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},g[117]||(g[117]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:g[33]||(g[33]=W=>rf(M.value)),disabled:(dt=M.value)==null?void 0:dt.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Nt=M.value)!=null&&Nt.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[118]||(g[118]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,X6),h("button",{onClick:ot,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(Zt=M.value)!=null&&Zt.archived?"Désarchiver cet événement":"Archiver cet événement"},[h("span",null,ie((at=M.value)!=null&&at.archived?"📂":"📁"),1),h("span",null,ie((Nn=M.value)!=null&&Nn.archived?"Désarchiver":"Archiver"),1)],8,Z6),h("button",{onClick:g[34]||(g[34]=W=>Mc(M.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},g[119]||(g[119]=[h("span",null,"🎭",-1),h("span",null,"Sélectionner",-1)])),h("button",{onClick:g[35]||(g[35]=W=>{var Vn;return _r((Vn=M.value)==null?void 0:Vn.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},g[120]||(g[120]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:B,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),te.value?(F(),$("div",eU,[h("button",{onClick:g[36]||(g[36]=W=>{ln(),te.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),h("button",{onClick:g[37]||(g[37]=W=>{rf(M.value),te.value=!1}),disabled:(cr=M.value)==null?void 0:cr.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Vr=M.value)!=null&&Vr.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},g[121]||(g[121]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,tU),h("button",{onClick:g[38]||(g[38]=W=>{ot(),te.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},ie((ei=M.value)!=null&&ei.archived?"📂 Désarchiver":"📁 Archiver"),1),h("button",{onClick:g[39]||(g[39]=W=>{var Vn;_r((Vn=M.value)==null?void 0:Vn.id),te.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):ce("",!0)]),h("div",nU,[h("button",{onClick:g[40]||(g[40]=W=>Mc(M.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),h("button",{onClick:B,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),h("button",{onClick:g[41]||(g[41]=W=>te.value=!te.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ce("",!0),lt(Lg,{show:ye.value,player:he.value,seasonId:o.value,onClose:g[43]||(g[43]=W=>ye.value=!1),onVerified:yt},null,8,["show","player","seasonId"]),d.value?(F(),$("div",rU,[h("div",sU,[g[127]||(g[127]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),h("div",iU,[g[122]||(g[122]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),Ze(h("input",{"onUpdate:modelValue":g[44]||(g[44]=W=>f.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Mn(Br,["esc"]),Mn(Zo,["enter"])],ref:"editTitleInput"},null,544),[[St,f.value]])]),h("div",oU,[g[123]||(g[123]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),Ze(h("input",{"onUpdate:modelValue":g[45]||(g[45]=W=>m.value=W),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Mn(Br,["esc"]),Mn(Zo,["enter"])]},null,544),[[St,m.value]])]),h("div",aU,[g[124]||(g[124]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),Ze(h("textarea",{"onUpdate:modelValue":g[46]||(g[46]=W=>ee.value=W),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Mn(Br,["esc"])},null,544),[[St,ee.value]])]),h("div",lU,[Ze(h("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":g[47]||(g[47]=W=>Y.value=W),class:"w-4 h-4"},null,512),[[bo,Y.value]]),g[125]||(g[125]=h("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),h("div",uU,[g[126]||(g[126]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),Ze(h("input",{"onUpdate:modelValue":g[48]||(g[48]=W=>y.value=W),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Mn(Br,["esc"])},null,544),[[St,y.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Br,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Zo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ce("",!0),lt(YE,{show:O.value,message:Cc(),error:R.value,"session-info":Xs(),onSubmit:kc,onCancel:Dc},null,8,["show","message","error","session-info"]),It.value?(F(),$("div",cU,[h("div",dU,[g[129]||(g[129]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",hU,[h("div",fU,[h("div",null,[g[128]||(g[128]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),Ze(h("input",{"onUpdate:modelValue":g[49]||(g[49]=W=>Ee.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[50]||(g[50]=Mn(W=>Dl(Ee.value),["enter"])),ref_key:"playerPasswordInputRef",ref:Bt},null,544),[[St,Ee.value]])])]),h("button",{onClick:g[51]||(g[51]=W=>Dl(Ee.value)),disabled:!Ee.value||Fe.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Fe.value?(F(),$("span",mU,"⏳")):(F(),$("span",gU,"🔓")),h("span",null,ie(Fe.value?"Vérification...":"Vérifier et supprimer"),1)],8,pU)]),h("div",vU,[h("button",{onClick:g[52]||(g[52]=W=>Z.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),ge.value?(F(),$("div",yU,[h("div",_U,ie(ge.value),1)])):ce("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:Nc,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ce("",!0),Wt.value?(F(),$("div",bU,[h("div",wU,[g[132]||(g[132]=rr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",IU,[h("div",EU,[h("div",null,[g[130]||(g[130]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),Ze(h("input",{"onUpdate:modelValue":g[53]||(g[53]=W=>le.value=W),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:g[54]||(g[54]=Mn(W=>no(le.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:st},null,544),[[St,le.value]])])]),h("div",TU,[h("button",{onClick:g[55]||(g[55]=W=>ht.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),pe.value?(F(),$("div",xU,[h("div",AU,ie(pe.value),1)])):ce("",!0)]),h("div",SU,[h("button",{onClick:Hn,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),h("button",{onClick:g[56]||(g[56]=W=>no(le.value)),disabled:!le.value||Ge.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Ge.value?(F(),$("span",RU,"⏳")):(F(),$("span",CU,"🔓")),h("span",null,[Sn(ie(Ge.value?"Vérification...":"Vérifier"),1),g[131]||(g[131]=h("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,PU)])])])):ce("",!0),ht.value?(F(),$("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[59]||(g[59]=W=>ht.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[58]||(g[58]=Vt(()=>{},["stop"]))},[g[134]||(g[134]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),h("div",kU,[g[133]||(g[133]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:Vc,disabled:k.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[k.value?(F(),$("span",NU,"⏳")):(F(),$("span",VU,"📧")),h("span",null,ie(k.value?"Envoi...":"Envoyer l'email"),1)],8,DU)]),L.value?(F(),$("div",OU,[h("div",MU,ie(L.value),1)])):ce("",!0),J.value?(F(),$("div",LU,[h("div",FU,ie(J.value),1)])):ce("",!0),h("div",$U,[h("button",{onClick:g[57]||(g[57]=W=>ht.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),Z.value?(F(),$("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:g[62]||(g[62]=W=>Z.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:g[61]||(g[61]=Vt(()=>{},["stop"]))},[g[136]||(g[136]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),h("div",UU,[g[135]||(g[135]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:Oc,disabled:Ce.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ce.value?(F(),$("span",qU,"⏳")):(F(),$("span",BU,"📧")),h("span",null,ie(Ce.value?"Envoi...":"Envoyer l'email"),1)],8,jU)]),$e.value?(F(),$("div",zU,[h("div",KU,ie($e.value),1)])):ce("",!0),E.value?(F(),$("div",GU,[h("div",HU,ie(E.value),1)])):ce("",!0),h("div",WU,[h("button",{onClick:g[60]||(g[60]=W=>Z.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ce("",!0),lt(tF,{ref_key:"playerModalRef",ref:C,show:I.value,player:w.value,stats:la(w.value),seasonId:o.value,"onboarding-step":xe.value,"onboarding-player-id":U.value,onClose:mn,onUpdate:Zs,onDelete:kl,onRefresh:ur,onAdvanceOnboarding:g[63]||(g[63]=W=>{try{typeof xe.value<"u"&&(xe.value.value=W)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),lt(FF,{ref_key:"selectionModalRef",ref:Le,show:Se.value,event:ke.value,"current-selection":it.value[(Yg=ke.value)==null?void 0:Yg.id]||[],"available-count":Xi((Xg=ke.value)==null?void 0:Xg.id),"selected-count":Zi((Zg=ke.value)==null?void 0:Zg.id),"player-availability":Wg((ev=ke.value)==null?void 0:ev.id),"season-id":o.value,"season-slug":Ts(s),players:an.value,onClose:sf,onSelection:YT,onPerfect:XT,onSendEmailNotifications:Hg,onUpdateSelection:ZT},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),lt(_T,{show:ze.value,event:Xe.value,"season-id":o.value,"season-slug":Ts(s),players:an.value,onClose:Kg,onSendEmailNotifications:Hg},null,8,["show","event","season-id","season-slug","players"]),lt(XE,{show:yn.value,onClose:g[64]||(g[64]=W=>yn.value=!1)},null,8,["show"]),lt(l$,{show:kt.value,"season-id":o.value,onClose:Cn,onManagePlayer:qi,onChangePassword:_l,onLogoutDevice:mc,onDeleteAccount:gc},null,8,["show","season-id"]),lt(bT,{show:mr.value,player:on.value,"season-id":o.value,onClose:g[65]||(g[65]=W=>mr.value=!1),onSuccess:g[66]||(g[66]=()=>{mr.value=!1,kt.value=!0})},null,8,["show","player","season-id"]),lt(y$,{show:Ur.value,onClose:g[67]||(g[67]=W=>Ur.value=!1),onSuccess:g[68]||(g[68]=()=>{Ur.value=!1,kt.value=!0})},null,8,["show"]),Qt.value?(F(),$("div",QU,[h("div",JU,[g[137]||(g[137]=h("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),g[138]||(g[138]=h("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),h("div",YU,[h("button",{onClick:g[69]||(g[69]=W=>rf($t.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),h("button",{onClick:Gg,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ce("",!0)],64)}}},XU={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},ZU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},e5={key:0,class:"text-center py-8"},t5={key:1,class:"text-center py-8"},n5={class:"text-gray-300 mb-6"},r5={key:2,class:"space-y-6"},s5={class:"text-center"},i5={class:"text-gray-300"},o5={class:"font-semibold text-white"},a5={class:"space-y-4"},l5=["disabled"],u5={key:0,class:"animate-spin"},c5={key:1},d5={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},h5={class:"text-red-300 text-sm"},f5={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},p5={class:"text-green-300 text-sm"},m5={__name:"PasswordReset",setup(n){const e=el(),t=Hu(),r=N(!0),s=N(""),i=N(""),o=N(""),a=N(""),l=N(""),c=N(!1),d=N(""),f=N(""),m=qe(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);sr(async()=>{try{const{oobCode:x}=e.query;if(ve.debug("Token reçu (masqué)"),!x){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=x,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(x){ve.error("Erreur lors de la vérification du lien",x),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(m.value){c.value=!0,d.value="",f.value="";try{ve.debug("Début réinitialisation avec token (masqué)"),await Z2(Pt,o.value,a.value),ve.info("Mot de passe Firebase Auth mis à jour"),ve.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{T()},3e3)}catch(x){ve.error("Erreur lors de la réinitialisation",x),x.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":x.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function T(){t.push("/")}return(x,P)=>(F(),$("div",XU,[h("div",ZU,[P[8]||(P[8]=rr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(F(),$("div",e5,P[2]||(P[2]=[h("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),h("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(F(),$("div",t5,[P[3]||(P[3]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"❌")],-1)),P[4]||(P[4]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),h("p",n5,ie(s.value),1),h("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(F(),$("div",r5,[h("div",s5,[h("p",i5,[P[5]||(P[5]=Sn("Email : ")),h("span",o5,ie(i.value),1)])]),h("div",a5,[h("div",null,[P[6]||(P[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),Ze(h("input",{"onUpdate:modelValue":P[0]||(P[0]=U=>a.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Mn(y,["enter"])},null,544),[[St,a.value]])]),h("div",null,[P[7]||(P[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),Ze(h("input",{"onUpdate:modelValue":P[1]||(P[1]=U=>l.value=U),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Mn(y,["enter"])},null,544),[[St,l.value]])])]),h("button",{onClick:y,disabled:!m.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(F(),$("span",u5,"⏳")):(F(),$("span",c5,"🔑")),h("span",null,ie(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,l5),d.value?(F(),$("div",d5,[h("div",h5,ie(d.value),1)])):ce("",!0),f.value?(F(),$("div",f5,[h("div",p5,ie(f.value),1)])):ce("",!0)])):ce("",!0)])]))}},g5={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},v5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},y5={class:"text-3xl"},_5={class:"text-2xl font-bold text-white mb-2"},b5={class:"text-gray-300 mb-6"},w5={__name:"MagicLink",setup(n){const e=el(),t=Hu(),r=N("loading"),s=N("Traitement en cours..."),i=N("Merci de patienter pendant la validation du lien."),o=qe(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return sr(async()=>{try{tT("firebase");const l=String(e.query.sid||""),c=String(e.query.pid||"");let d=String(e.query.eid||"");const f=String(e.query.t||""),m=String(e.query.a||""),y=String(e.query.slug||"");if(!f||!m){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(m==="account_email_update"){const D=await oT({token:f});if(!D.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await iN(Pt.currentUser,D.data.newEmail),await aT({token:f}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(m==="verify_email"&&(d="protection"),!(await sT({seasonId:l,playerId:c,eventId:d,token:f,action:m})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(m==="verify_email"){await dT({playerId:c,seasonId:l});try{await gT({playerId:c,seasonId:l})}catch{}await Lp({seasonId:l,playerId:c,eventId:"protection",action:m}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(y?()=>t.push(`/season/${y}?player=${encodeURIComponent(c)}&verified=1`):()=>t.push("/"),800);return}const x=Ae(se,"seasons",l,"players",c),P=await pn(x),U=P.exists()&&P.data().name||"";if(!U){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await IO({seasonId:l,playerName:U,eventId:d,value:m==="yes"}),await Lp({seasonId:l,playerId:c,eventId:d,action:m}),r.value="ok",s.value="Merci !",i.value=m==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(y?()=>t.push(`/season/${y}/event/${d}`):()=>t.push("/"),1200)}catch(l){ve.error("Magic link error",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(F(),$("div",g5,[h("div",v5,[h("div",{class:Kt(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[h("span",y5,ie(o.value),1)],2),h("h1",_5,ie(s.value),1),h("p",b5,ie(i.value),1),h("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},I5={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},E5={class:"text-center py-12 px-4"},T5={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},x5={class:"container mx-auto px-4 pb-16"},A5={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},S5={class:"space-y-5"},P5=["onKeydown"],R5={class:"flex items-center justify-end gap-3 pt-2"},C5=["disabled"],k5={key:0,class:"mt-6 text-sm text-gray-200"},D5={__name:"JoinSeason",setup(n){const e=el(),t=Hu(),r=e.params.slug,s=N(""),i=N(""),o=N(""),a=N(!1),l=N("");sr(async()=>{const f=Vu(We(se,"seasons"),zd("slug","==",r)),m=await vt(f);if(m.empty)l.value="Saison introuvable";else{const y=m.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await nT(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){ve.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,m)=>(F(),$("div",I5,[h("div",E5,[h("h1",T5,ie(i.value||"Rejoindre la saison"),1),m[1]||(m[1]=h("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),h("div",x5,[h("div",A5,[m[3]||(m[3]=h("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),h("div",S5,[h("div",null,[m[2]||(m[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),Ze(h("input",{"onUpdate:modelValue":m[0]||(m[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Mn(Vt(d,["prevent"]),["enter"])},null,40,P5),[[St,o.value]])]),h("div",R5,[h("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,C5)])]),l.value?(F(),$("div",k5,ie(l.value),1)):ce("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const N5=[{path:"/",component:XO},{path:"/season/:slug",component:s0,props:!0},{path:"/season/:slug/event/:eventId",component:s0,props:!0},{path:"/season/:slug/join",component:D5,props:!0},{path:"/reset-password",component:m5},{path:"/magic",component:w5}],V5=xP({history:eP("/"),routes:N5}),WT=bS(ES);WT.use(V5);WT.mount("#app");RP({immediate:!0,onRegistered(n){window.__swReg=n}});export{We as $,tE as A,No as B,es as C,rn as D,Fj as E,Fo as F,Zm as G,Lj as H,$5 as I,xr as J,gD as K,yD as L,pl as M,dj as N,hj as O,BD as P,Rn as Q,nj as R,z5 as S,Gt as T,Rj as U,Ph as V,UD as W,qD as X,cj as Y,H5 as Z,Kb as _,ku as a,dc as a$,q5 as a0,vD as a1,RD as a2,Mj as a3,Xa as a4,Pj as a5,J5 as a6,Oj as a7,Ae as a8,ej as a9,Z5 as aA,yj as aB,_j as aC,tj as aD,SD as aE,Tj as aF,xj as aG,FD as aH,Vu as aI,jI as aJ,B5 as aK,Sj as aL,Ui as aM,fn as aN,Dj as aO,O5 as aP,fj as aQ,oj as aR,ij as aS,uj as aT,Y5 as aU,fl as aV,kj as aW,W5 as aX,zd as aY,cg as aZ,zj as a_,bD as aa,G5 as ab,Q5 as ac,Vj as ad,lj as ae,aj as af,Ht as ag,ac as ah,kD as ai,bj as aj,pn as ak,pj as al,mj as am,vt as an,gj as ao,vj as ap,_D as aq,Nj as ar,Cj as as,K5 as at,rj as au,sj as av,X5 as aw,wj as ax,Ej as ay,Ij as az,wD as b,W2 as b$,cc as b0,Gj as b1,Fu as b2,qo as b3,hi as b4,Uj as b5,pi as b6,fi as b7,Os as b8,pd as b9,n2 as bA,fq as bB,Aq as bC,R_ as bD,ON as bE,E2 as bF,aq as bG,eq as bH,Q2 as bI,vq as bJ,Iq as bK,xq as bL,pq as bM,mN as bN,fN as bO,Wj as bP,KD as bQ,J2 as bR,yq as bS,wq as bT,Tq as bU,i2 as bV,dq as bW,rq as bX,X2 as bY,Zj as bZ,hN as b_,Bj as ba,Eo as bb,ka as bc,FV as bd,jj as be,mq as bf,kp as bg,qj as bh,$V as bi,kg as bj,mi as bk,Yj as bl,pN as bm,OE as bn,LV as bo,LE as bp,eN as bq,Z2 as br,x2 as bs,tN as bt,Kj as bu,hq as bv,nq as bw,oq as bx,GV as by,Hj as bz,Ja as c,bg as c0,Jj as c1,nN as c2,tq as c3,gq as c4,bq as c5,Eq as c6,gN as c7,Qj as c8,cq as c9,iN as ca,oN as cb,_q as cc,iq as cd,uq as ce,lq as cf,sq as cg,Xj as ch,$o as d,xt as e,ae as f,hl as g,ic as h,dd as i,Oh as j,oc as k,Nh as l,lg as m,Ya as n,Vh as o,go as p,jD as q,Yt as r,xo as s,Te as t,L5 as u,uR as v,jt as w,$j as x,et as y,M5 as z};
