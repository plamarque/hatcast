(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function yp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Et={},la=[],Vr=()=>{},ME=()=>!1,Md=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),_p=n=>n.startsWith("onUpdate:"),En=Object.assign,bp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},LE=Object.prototype.hasOwnProperty,gt=(n,e)=>LE.call(n,e),Fe=Array.isArray,ua=n=>Cu(n)==="[object Map]",Ld=n=>Cu(n)==="[object Set]",bg=n=>Cu(n)==="[object Date]",Ge=n=>typeof n=="function",nn=n=>typeof n=="string",Zr=n=>typeof n=="symbol",Ct=n=>n!==null&&typeof n=="object",p_=n=>(Ct(n)||Ge(n))&&Ge(n.then)&&Ge(n.catch),m_=Object.prototype.toString,Cu=n=>m_.call(n),FE=n=>Cu(n).slice(8,-1),g_=n=>Cu(n)==="[object Object]",wp=n=>nn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Bl=yp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Fd=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},$E=/-(\w)/g,Er=Fd(n=>n.replace($E,(e,t)=>t?t.toUpperCase():"")),UE=/\B([A-Z])/g,Pi=Fd(n=>n.replace(UE,"-$1").toLowerCase()),$d=Fd(n=>n.charAt(0).toUpperCase()+n.slice(1)),zh=Fd(n=>n?`on${$d(n)}`:""),ci=(n,e)=>!Object.is(n,e),Lc=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},Ef=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Tf=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let wg;const Ud=()=>wg||(wg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ms(n){if(Fe(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=nn(r)?zE(r):ms(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(nn(n)||Ct(n))return n}const jE=/;(?![^(]*\))/g,BE=/:([^]+)/,qE=/\/\*[^]*?\*\//g;function zE(n){const e={};return n.replace(qE,"").split(jE).forEach(t=>{if(t){const r=t.split(BE);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function fn(n){let e="";if(nn(n))e=n;else if(Fe(n))for(let t=0;t<n.length;t++){const r=fn(n[t]);r&&(e+=r+" ")}else if(Ct(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const GE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",KE=yp(GE);function v_(n){return!!n||n===""}function HE(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=jd(n[r],e[r]);return t}function jd(n,e){if(n===e)return!0;let t=bg(n),r=bg(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Zr(n),r=Zr(e),t||r)return n===e;if(t=Fe(n),r=Fe(e),t||r)return t&&r?HE(n,e):!1;if(t=Ct(n),r=Ct(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!jd(n[o],e[o]))return!1}}return String(n)===String(e)}function y_(n,e){return n.findIndex(t=>jd(t,e))}const __=n=>!!(n&&n.__v_isRef===!0),oe=n=>nn(n)?n:n==null?"":Fe(n)||Ct(n)&&(n.toString===m_||!Ge(n.toString))?__(n)?oe(n.value):JSON.stringify(n,b_,2):String(n),b_=(n,e)=>__(e)?b_(n,e.value):ua(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[Gh(r,i)+" =>"]=s,t),{})}:Ld(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Gh(t))}:Zr(e)?Gh(e):Ct(e)&&!Fe(e)&&!g_(e)?String(e):e,Gh=(n,e="")=>{var t;return Zr(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let er;class WE{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=er,!e&&er&&(this.index=(er.scopes||(er.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=er;try{return er=this,e()}finally{er=t}}}on(){++this._on===1&&(this.prevScope=er,er=this)}off(){this._on>0&&--this._on===0&&(er=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function QE(){return er}let Pt;const Kh=new WeakSet;class w_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,er&&er.active&&er.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Kh.has(this)&&(Kh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||E_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ig(this),T_(this);const e=Pt,t=Nr;Pt=this,Nr=!0;try{return this.fn()}finally{x_(this),Pt=e,Nr=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Tp(e);this.deps=this.depsTail=void 0,Ig(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Kh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){xf(this)&&this.run()}get dirty(){return xf(this)}}let I_=0,ql,zl;function E_(n,e=!1){if(n.flags|=8,e){n.next=zl,zl=n;return}n.next=ql,ql=n}function Ip(){I_++}function Ep(){if(--I_>0)return;if(zl){let e=zl;for(zl=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;ql;){let e=ql;for(ql=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function T_(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function x_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Tp(r),JE(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function xf(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(A_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function A_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===su)||(n.globalVersion=su,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!xf(n))))return;n.flags|=2;const e=n.dep,t=Pt,r=Nr;Pt=n,Nr=!0;try{T_(n);const s=n.fn(n._value);(e.version===0||ci(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Pt=t,Nr=r,x_(n),n.flags&=-3}}function Tp(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Tp(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function JE(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Nr=!0;const S_=[];function Ts(){S_.push(Nr),Nr=!1}function xs(){const n=S_.pop();Nr=n===void 0?!0:n}function Ig(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Pt;Pt=void 0;try{e()}finally{Pt=t}}}let su=0;class YE{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class xp{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Pt||!Nr||Pt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Pt)t=this.activeLink=new YE(Pt,this),Pt.deps?(t.prevDep=Pt.depsTail,Pt.depsTail.nextDep=t,Pt.depsTail=t):Pt.deps=Pt.depsTail=t,P_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Pt.depsTail,t.nextDep=void 0,Pt.depsTail.nextDep=t,Pt.depsTail=t,Pt.deps===t&&(Pt.deps=r)}return t}trigger(e){this.version++,su++,this.notify(e)}notify(e){Ip();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Ep()}}}function P_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)P_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const Af=new WeakMap,lo=Symbol(""),Sf=Symbol(""),iu=Symbol("");function Mn(n,e,t){if(Nr&&Pt){let r=Af.get(n);r||Af.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new xp),s.map=r,s.key=t),s.track()}}function gs(n,e,t,r,s,i){const o=Af.get(n);if(!o){su++;return}const a=l=>{l&&l.trigger()};if(Ip(),e==="clear")o.forEach(a);else{const l=Fe(n),c=l&&wp(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===iu||!Zr(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(iu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(lo)),ua(n)&&a(o.get(Sf)));break;case"delete":l||(a(o.get(lo)),ua(n)&&a(o.get(Sf)));break;case"set":ua(n)&&a(o.get(lo));break}}Ep()}function Wo(n){const e=mt(n);return e===n?e:(Mn(e,"iterate",iu),Ir(n)?e:e.map(xn))}function Bd(n){return Mn(n=mt(n),"iterate",iu),n}const XE={__proto__:null,[Symbol.iterator](){return Hh(this,Symbol.iterator,xn)},concat(...n){return Wo(this).concat(...n.map(e=>Fe(e)?Wo(e):e))},entries(){return Hh(this,"entries",n=>(n[1]=xn(n[1]),n))},every(n,e){return hs(this,"every",n,e,void 0,arguments)},filter(n,e){return hs(this,"filter",n,e,t=>t.map(xn),arguments)},find(n,e){return hs(this,"find",n,e,xn,arguments)},findIndex(n,e){return hs(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return hs(this,"findLast",n,e,xn,arguments)},findLastIndex(n,e){return hs(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return hs(this,"forEach",n,e,void 0,arguments)},includes(...n){return Wh(this,"includes",n)},indexOf(...n){return Wh(this,"indexOf",n)},join(n){return Wo(this).join(n)},lastIndexOf(...n){return Wh(this,"lastIndexOf",n)},map(n,e){return hs(this,"map",n,e,void 0,arguments)},pop(){return El(this,"pop")},push(...n){return El(this,"push",n)},reduce(n,...e){return Eg(this,"reduce",n,e)},reduceRight(n,...e){return Eg(this,"reduceRight",n,e)},shift(){return El(this,"shift")},some(n,e){return hs(this,"some",n,e,void 0,arguments)},splice(...n){return El(this,"splice",n)},toReversed(){return Wo(this).toReversed()},toSorted(n){return Wo(this).toSorted(n)},toSpliced(...n){return Wo(this).toSpliced(...n)},unshift(...n){return El(this,"unshift",n)},values(){return Hh(this,"values",xn)}};function Hh(n,e,t){const r=Bd(n),s=r[e]();return r!==n&&!Ir(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const ZE=Array.prototype;function hs(n,e,t,r,s,i){const o=Bd(n),a=o!==n&&!Ir(n),l=o[e];if(l!==ZE[e]){const f=l.apply(n,i);return a?xn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,xn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function Eg(n,e,t,r){const s=Bd(n);let i=t;return s!==n&&(Ir(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,xn(a),l,n)}),s[e](i,...r)}function Wh(n,e,t){const r=mt(n);Mn(r,"iterate",iu);const s=r[e](...t);return(s===-1||s===!1)&&Pp(t[0])?(t[0]=mt(t[0]),r[e](...t)):s}function El(n,e,t=[]){Ts(),Ip();const r=mt(n)[e].apply(n,t);return Ep(),xs(),r}const eT=yp("__proto__,__v_isRef,__isVue"),R_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Zr));function tT(n){Zr(n)||(n=String(n));const e=mt(this);return Mn(e,"has",n),e.hasOwnProperty(n)}class C_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?dT:N_:i?V_:D_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Fe(e);if(!s){let l;if(o&&(l=XE[t]))return l;if(t==="hasOwnProperty")return tT}const a=Reflect.get(e,t,$n(e)?e:r);return(Zr(t)?R_.has(t):eT(t))||(s||Mn(e,"get",t),i)?a:$n(a)?o&&wp(t)?a:a.value:Ct(a)?s?M_(a):qd(a):a}}class k_ extends C_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=vi(i);if(!Ir(r)&&!vi(r)&&(i=mt(i),r=mt(r)),!Fe(e)&&$n(i)&&!$n(r))return l?!1:(i.value=r,!0)}const o=Fe(e)&&wp(t)?Number(t)<e.length:gt(e,t),a=Reflect.set(e,t,r,$n(e)?e:s);return e===mt(s)&&(o?ci(r,i)&&gs(e,"set",t,r):gs(e,"add",t,r)),a}deleteProperty(e,t){const r=gt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&gs(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Zr(t)||!R_.has(t))&&Mn(e,"has",t),r}ownKeys(e){return Mn(e,"iterate",Fe(e)?"length":lo),Reflect.ownKeys(e)}}class nT extends C_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const rT=new k_,sT=new nT,iT=new k_(!0);const Pf=n=>n,Ec=n=>Reflect.getPrototypeOf(n);function oT(n,e,t){return function(...r){const s=this.__v_raw,i=mt(s),o=ua(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?Pf:e?rd:xn;return!e&&Mn(i,"iterate",l?Sf:lo),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function Tc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function aT(n,e){const t={get(s){const i=this.__v_raw,o=mt(i),a=mt(s);n||(ci(s,a)&&Mn(o,"get",s),Mn(o,"get",a));const{has:l}=Ec(o),c=e?Pf:n?rd:xn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Mn(mt(s),"iterate",lo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=mt(i),a=mt(s);return n||(ci(s,a)&&Mn(o,"has",s),Mn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=mt(a),c=e?Pf:n?rd:xn;return!n&&Mn(l,"iterate",lo),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return En(t,n?{add:Tc("add"),set:Tc("set"),delete:Tc("delete"),clear:Tc("clear")}:{add(s){!e&&!Ir(s)&&!vi(s)&&(s=mt(s));const i=mt(this);return Ec(i).has.call(i,s)||(i.add(s),gs(i,"add",s,s)),this},set(s,i){!e&&!Ir(i)&&!vi(i)&&(i=mt(i));const o=mt(this),{has:a,get:l}=Ec(o);let c=a.call(o,s);c||(s=mt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?ci(i,d)&&gs(o,"set",s,i):gs(o,"add",s,i),this},delete(s){const i=mt(this),{has:o,get:a}=Ec(i);let l=o.call(i,s);l||(s=mt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&gs(i,"delete",s,void 0),c},clear(){const s=mt(this),i=s.size!==0,o=s.clear();return i&&gs(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=oT(s,n,e)}),t}function Ap(n,e){const t=aT(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(gt(t,s)&&s in r?t:r,s,i)}const lT={get:Ap(!1,!1)},uT={get:Ap(!1,!0)},cT={get:Ap(!0,!1)};const D_=new WeakMap,V_=new WeakMap,N_=new WeakMap,dT=new WeakMap;function hT(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function fT(n){return n.__v_skip||!Object.isExtensible(n)?0:hT(FE(n))}function qd(n){return vi(n)?n:Sp(n,!1,rT,lT,D_)}function O_(n){return Sp(n,!1,iT,uT,V_)}function M_(n){return Sp(n,!0,sT,cT,N_)}function Sp(n,e,t,r,s){if(!Ct(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=fT(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function ca(n){return vi(n)?ca(n.__v_raw):!!(n&&n.__v_isReactive)}function vi(n){return!!(n&&n.__v_isReadonly)}function Ir(n){return!!(n&&n.__v_isShallow)}function Pp(n){return n?!!n.__v_raw:!1}function mt(n){const e=n&&n.__v_raw;return e?mt(e):n}function pT(n){return!gt(n,"__v_skip")&&Object.isExtensible(n)&&Ef(n,"__v_skip",!0),n}const xn=n=>Ct(n)?qd(n):n,rd=n=>Ct(n)?M_(n):n;function $n(n){return n?n.__v_isRef===!0:!1}function N(n){return L_(n,!1)}function mT(n){return L_(n,!0)}function L_(n,e){return $n(n)?n:new gT(n,e)}class gT{constructor(e,t){this.dep=new xp,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:mt(e),this._value=t?e:xn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Ir(e)||vi(e);e=r?e:mt(e),ci(e,t)&&(this._rawValue=e,this._value=r?e:xn(e),this.dep.trigger())}}function Is(n){return $n(n)?n.value:n}const vT={get:(n,e,t)=>e==="__v_raw"?n:Is(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return $n(s)&&!$n(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function F_(n){return ca(n)?n:new Proxy(n,vT)}class yT{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new xp(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=su-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Pt!==this)return E_(this,!0),!0}get value(){const e=this.dep.track();return A_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function _T(n,e,t=!1){let r,s;return Ge(n)?r=n:(r=n.get,s=n.set),new yT(r,s,t)}const xc={},sd=new WeakMap;let Xi;function bT(n,e=!1,t=Xi){if(t){let r=sd.get(t);r||sd.set(t,r=[]),r.push(n)}}function wT(n,e,t=Et){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=q=>s?q:Ir(q)||s===!1||s===0?vs(q,1):vs(q);let d,f,g,y,x=!1,S=!1;if($n(n)?(f=()=>n.value,x=Ir(n)):ca(n)?(f=()=>c(n),x=!0):Fe(n)?(S=!0,x=n.some(q=>ca(q)||Ir(q)),f=()=>n.map(q=>{if($n(q))return q.value;if(ca(q))return c(q);if(Ge(q))return l?l(q,2):q()})):Ge(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Ts();try{g()}finally{xs()}}const q=Xi;Xi=d;try{return l?l(n,3,[y]):n(y)}finally{Xi=q}}:f=Vr,e&&s){const q=f,X=s===!0?1/0:s;f=()=>vs(q(),X)}const A=QE(),j=()=>{d.stop(),A&&A.active&&bp(A.effects,d)};if(i&&e){const q=e;e=(...X)=>{q(...X),j()}}let F=S?new Array(n.length).fill(xc):xc;const P=q=>{if(!(!(d.flags&1)||!d.dirty&&!q))if(e){const X=d.run();if(s||x||(S?X.some((ue,E)=>ci(ue,F[E])):ci(X,F))){g&&g();const ue=Xi;Xi=d;try{const E=[X,F===xc?void 0:S&&F[0]===xc?[]:F,y];F=X,l?l(e,3,E):e(...E)}finally{Xi=ue}}}else d.run()};return a&&a(P),d=new w_(f),d.scheduler=o?()=>o(P,!1):P,y=q=>bT(q,!1,d),g=d.onStop=()=>{const q=sd.get(d);if(q){if(l)l(q,4);else for(const X of q)X();sd.delete(d)}},e?r?P(!0):F=d.run():o?o(P.bind(null,!0),!0):d.run(),j.pause=d.pause.bind(d),j.resume=d.resume.bind(d),j.stop=j,j}function vs(n,e=1/0,t){if(e<=0||!Ct(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,$n(n))vs(n.value,e,t);else if(Fe(n))for(let r=0;r<n.length;r++)vs(n[r],e,t);else if(Ld(n)||ua(n))n.forEach(r=>{vs(r,e,t)});else if(g_(n)){for(const r in n)vs(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&vs(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function ku(n,e,t,r){try{return r?n(...r):n()}catch(s){zd(s,e,t)}}function es(n,e,t,r){if(Ge(n)){const s=ku(n,e,t,r);return s&&p_(s)&&s.catch(i=>{zd(i,e,t)}),s}if(Fe(n)){const s=[];for(let i=0;i<n.length;i++)s.push(es(n[i],e,t,r));return s}}function zd(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Et;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){Ts(),ku(i,null,10,[n,l,c]),xs();return}}IT(n,t,s,r,o)}function IT(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Wn=[];let Gr=-1;const da=[];let Zs=null,ta=0;const $_=Promise.resolve();let id=null;function hn(n){const e=id||$_;return n?e.then(this?n.bind(this):n):e}function ET(n){let e=Gr+1,t=Wn.length;for(;e<t;){const r=e+t>>>1,s=Wn[r],i=ou(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Rp(n){if(!(n.flags&1)){const e=ou(n),t=Wn[Wn.length-1];!t||!(n.flags&2)&&e>=ou(t)?Wn.push(n):Wn.splice(ET(e),0,n),n.flags|=1,U_()}}function U_(){id||(id=$_.then(B_))}function TT(n){Fe(n)?da.push(...n):Zs&&n.id===-1?Zs.splice(ta+1,0,n):n.flags&1||(da.push(n),n.flags|=1),U_()}function Tg(n,e,t=Gr+1){for(;t<Wn.length;t++){const r=Wn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Wn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function j_(n){if(da.length){const e=[...new Set(da)].sort((t,r)=>ou(t)-ou(r));if(da.length=0,Zs){Zs.push(...e);return}for(Zs=e,ta=0;ta<Zs.length;ta++){const t=Zs[ta];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Zs=null,ta=0}}const ou=n=>n.id==null?n.flags&2?-1:1/0:n.id;function B_(n){const e=Vr;try{for(Gr=0;Gr<Wn.length;Gr++){const t=Wn[Gr];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),ku(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Gr<Wn.length;Gr++){const t=Wn[Gr];t&&(t.flags&=-2)}Gr=-1,Wn.length=0,j_(),id=null,(Wn.length||da.length)&&B_()}}let cr=null,q_=null;function od(n){const e=cr;return cr=n,q_=n&&n.type.__scopeId||null,e}function xT(n,e=cr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Mg(-1);const i=od(e);let o;try{o=n(...s)}finally{od(i),r._d&&Mg(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function it(n,e){if(cr===null)return n;const t=Wd(cr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Et]=e[s];i&&(Ge(i)&&(i={mounted:i,updated:i}),i.deep&&vs(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function Qi(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Ts(),es(l,t,8,[n.el,a,n,e]),xs())}}const z_=Symbol("_vte"),AT=n=>n.__isTeleport,Gl=n=>n&&(n.disabled||n.disabled===""),xg=n=>n&&(n.defer||n.defer===""),Ag=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Sg=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Rf=(n,e)=>{const t=n&&n.to;return nn(t)?e?e(t):null:t},G_={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:d,pc:f,pbc:g,o:{insert:y,querySelector:x,createText:S,createComment:A}}=c,j=Gl(e.props);let{shapeFlag:F,children:P,dynamicChildren:q}=e;if(n==null){const X=e.el=S(""),ue=e.anchor=S("");y(X,t,r),y(ue,t,r);const E=(I,k)=>{F&16&&(s&&s.isCE&&(s.ce._teleportTarget=I),d(P,I,k,s,i,o,a,l))},w=()=>{const I=e.target=Rf(e.props,x),k=K_(I,e,S,y);I&&(o!=="svg"&&Ag(I)?o="svg":o!=="mathml"&&Sg(I)&&(o="mathml"),j||(E(I,k),Fc(e,!1)))};j&&(E(t,ue),Fc(e,!0)),xg(e.props)?(e.el.__isMounted=!1,Hn(()=>{w(),delete e.el.__isMounted},i)):w()}else{if(xg(e.props)&&n.el.__isMounted===!1){Hn(()=>{G_.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const X=e.anchor=n.anchor,ue=e.target=n.target,E=e.targetAnchor=n.targetAnchor,w=Gl(n.props),I=w?t:ue,k=w?X:E;if(o==="svg"||Ag(ue)?o="svg":(o==="mathml"||Sg(ue))&&(o="mathml"),q?(g(n.dynamicChildren,q,I,s,i,o,a),Np(n,e,!0)):l||f(n,e,I,k,s,i,o,a,!1),j)w?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Ac(e,t,X,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const D=e.target=Rf(e.props,x);D&&Ac(e,D,null,c,0)}else w&&Ac(e,ue,E,c,1);Fc(e,j)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:d,target:f,props:g}=n;if(f&&(s(c),s(d)),i&&s(l),o&16){const y=i||!Gl(g);for(let x=0;x<a.length;x++){const S=a[x];r(S,e,t,y,!!S.dynamicChildren)}}},move:Ac,hydrate:ST};function Ac(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:d}=n,f=i===2;if(f&&r(o,e,t),(!f||Gl(d))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function ST(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:d}},f){const g=e.target=Rf(e.props,l);if(g){const y=Gl(e.props),x=g._lpa||g.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=x,e.targetAnchor=x&&o(x);else{e.anchor=o(n);let S=x;for(;S;){if(S&&S.nodeType===8){if(S.data==="teleport start anchor")e.targetStart=S;else if(S.data==="teleport anchor"){e.targetAnchor=S,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}S=o(S)}e.targetAnchor||K_(g,e,d,c),f(x&&o(x),e,g,t,r,s,i)}Fc(e,y)}return e.anchor&&o(e.anchor)}const PT=G_;function Fc(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function K_(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[z_]=i,n&&(r(s,n),r(i,n)),i}function Cp(n,e){n.shapeFlag&6&&n.component?(n.transition=e,Cp(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function H_(n,e){return Ge(n)?(()=>En({name:n.name},e,{setup:n}))():n}function W_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Kl(n,e,t,r,s=!1){if(Fe(n)){n.forEach((x,S)=>Kl(x,e&&(Fe(e)?e[S]:e),t,r,s));return}if(Hl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Kl(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Wd(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===Et?a.refs={}:a.refs,f=a.setupState,g=mt(f),y=f===Et?()=>!1:x=>gt(g,x);if(c!=null&&c!==l&&(nn(c)?(d[c]=null,y(c)&&(f[c]=null)):$n(c)&&(c.value=null)),Ge(l))ku(l,a,12,[o,d]);else{const x=nn(l),S=$n(l);if(x||S){const A=()=>{if(n.f){const j=x?y(l)?f[l]:d[l]:l.value;s?Fe(j)&&bp(j,i):Fe(j)?j.includes(i)||j.push(i):x?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else x?(d[l]=o,y(l)&&(f[l]=o)):S&&(l.value=o,n.k&&(d[n.k]=o))};o?(A.id=-1,Hn(A,t)):A()}}}Ud().requestIdleCallback;Ud().cancelIdleCallback;const Hl=n=>!!n.type.__asyncLoader,Q_=n=>n.type.__isKeepAlive;function RT(n,e){J_(n,"a",e)}function CT(n,e){J_(n,"da",e)}function J_(n,e,t=Fn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Gd(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Q_(s.parent.vnode)&&kT(r,e,t,s),s=s.parent}}function kT(n,e,t,r){const s=Gd(e,n,r,!0);aa(()=>{bp(r[e],s)},t)}function Gd(n,e,t=Fn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Ts();const a=Du(t),l=es(e,t,n,o);return a(),xs(),l});return r?s.unshift(i):s.push(i),i}}const Ds=n=>(e,t=Fn)=>{(!lu||n==="sp")&&Gd(n,(...r)=>e(...r),t)},DT=Ds("bm"),wr=Ds("m"),VT=Ds("bu"),NT=Ds("u"),OT=Ds("bum"),aa=Ds("um"),MT=Ds("sp"),LT=Ds("rtg"),FT=Ds("rtc");function $T(n,e=Fn){Gd("ec",n,e)}const Y_="components";function UT(n,e){return BT(Y_,n,!0,e)||n}const jT=Symbol.for("v-ndc");function BT(n,e,t=!0,r=!1){const s=cr||Fn;if(s){const i=s.type;if(n===Y_){const a=Px(i,!1);if(a&&(a===e||a===Er(e)||a===$d(Er(e))))return i}const o=Pg(s[n]||i[n],e)||Pg(s.appContext[n],e);return!o&&r?i:o}}function Pg(n,e){return n&&(n[e]||n[Er(e)]||n[$d(Er(e))])}function ur(n,e,t,r){let s;const i=t&&t[r],o=Fe(n);if(o||nn(n)){const a=o&&ca(n);let l=!1,c=!1;a&&(l=!Ir(n),c=vi(n),n=Bd(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?rd(xn(n[d])):xn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Ct(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const Cf=n=>n?m0(n)?Wd(n):Cf(n.parent):null,Wl=En(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Cf(n.parent),$root:n=>Cf(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>kp(n),$forceUpdate:n=>n.f||(n.f=()=>{Rp(n.update)}),$nextTick:n=>n.n||(n.n=hn.bind(n.proxy)),$watch:n=>ux.bind(n)}),Qh=(n,e)=>n!==Et&&!n.__isScriptSetup&&gt(n,e),qT={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Qh(r,e))return o[e]=1,r[e];if(s!==Et&&gt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&gt(c,e))return o[e]=3,i[e];if(t!==Et&&gt(t,e))return o[e]=4,t[e];kf&&(o[e]=0)}}const d=Wl[e];let f,g;if(d)return e==="$attrs"&&Mn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Et&&gt(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,gt(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Qh(s,e)?(s[e]=t,!0):r!==Et&&gt(r,e)?(r[e]=t,!0):gt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Et&&gt(n,o)||Qh(e,o)||(a=i[0])&&gt(a,o)||gt(r,o)||gt(Wl,o)||gt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:gt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Rg(n){return Fe(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let kf=!0;function zT(n){const e=kp(n),t=n.proxy,r=n.ctx;kf=!1,e.beforeCreate&&Cg(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:y,updated:x,activated:S,deactivated:A,beforeDestroy:j,beforeUnmount:F,destroyed:P,unmounted:q,render:X,renderTracked:ue,renderTriggered:E,errorCaptured:w,serverPrefetch:I,expose:k,inheritAttrs:D,components:$,directives:R,filters:Dt}=e;if(c&&GT(c,r,null),o)for(const $e in o){const Ue=o[$e];Ge(Ue)&&(r[$e]=Ue.bind(t))}if(s){const $e=s.call(t,t);Ct($e)&&(n.data=qd($e))}if(kf=!0,i)for(const $e in i){const Ue=i[$e],De=Ge(Ue)?Ue.bind(t,t):Ge(Ue.get)?Ue.get.bind(t,t):Vr,te=!Ge(Ue)&&Ge(Ue.set)?Ue.set.bind(t):Vr,Ve=ze({get:De,set:te});Object.defineProperty(r,$e,{enumerable:!0,configurable:!0,get:()=>Ve.value,set:W=>Ve.value=W})}if(a)for(const $e in a)X_(a[$e],r,t,$e);if(l){const $e=Ge(l)?l.call(t):l;Reflect.ownKeys($e).forEach(Ue=>{$c(Ue,$e[Ue])})}d&&Cg(d,n,"c");function tt($e,Ue){Fe(Ue)?Ue.forEach(De=>$e(De.bind(t))):Ue&&$e(Ue.bind(t))}if(tt(DT,f),tt(wr,g),tt(VT,y),tt(NT,x),tt(RT,S),tt(CT,A),tt($T,w),tt(FT,ue),tt(LT,E),tt(OT,F),tt(aa,q),tt(MT,I),Fe(k))if(k.length){const $e=n.exposed||(n.exposed={});k.forEach(Ue=>{Object.defineProperty($e,Ue,{get:()=>t[Ue],set:De=>t[Ue]=De})})}else n.exposed||(n.exposed={});X&&n.render===Vr&&(n.render=X),D!=null&&(n.inheritAttrs=D),$&&(n.components=$),R&&(n.directives=R),I&&W_(n)}function GT(n,e,t=Vr){Fe(n)&&(n=Df(n));for(const r in n){const s=n[r];let i;Ct(s)?"default"in s?i=Or(s.from||r,s.default,!0):i=Or(s.from||r):i=Or(s),$n(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Cg(n,e,t){es(Fe(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function X_(n,e,t,r){let s=r.includes(".")?c0(t,r):()=>t[r];if(nn(n)){const i=e[n];Ge(i)&&Ot(s,i)}else if(Ge(n))Ot(s,n.bind(t));else if(Ct(n))if(Fe(n))n.forEach(i=>X_(i,e,t,r));else{const i=Ge(n.handler)?n.handler.bind(t):e[n.handler];Ge(i)&&Ot(s,i,n)}}function kp(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>ad(l,c,o,!0)),ad(l,e,o)),Ct(e)&&i.set(e,l),l}function ad(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&ad(n,i,t,!0),s&&s.forEach(o=>ad(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=KT[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const KT={data:kg,props:Dg,emits:Dg,methods:Nl,computed:Nl,beforeCreate:Kn,created:Kn,beforeMount:Kn,mounted:Kn,beforeUpdate:Kn,updated:Kn,beforeDestroy:Kn,beforeUnmount:Kn,destroyed:Kn,unmounted:Kn,activated:Kn,deactivated:Kn,errorCaptured:Kn,serverPrefetch:Kn,components:Nl,directives:Nl,watch:WT,provide:kg,inject:HT};function kg(n,e){return e?n?function(){return En(Ge(n)?n.call(this,this):n,Ge(e)?e.call(this,this):e)}:e:n}function HT(n,e){return Nl(Df(n),Df(e))}function Df(n){if(Fe(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Kn(n,e){return n?[...new Set([].concat(n,e))]:e}function Nl(n,e){return n?En(Object.create(null),n,e):e}function Dg(n,e){return n?Fe(n)&&Fe(e)?[...new Set([...n,...e])]:En(Object.create(null),Rg(n),Rg(e??{})):e}function WT(n,e){if(!n)return e;if(!e)return n;const t=En(Object.create(null),n);for(const r in e)t[r]=Kn(n[r],e[r]);return t}function Z_(){return{app:null,config:{isNativeTag:ME,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let QT=0;function JT(n,e){return function(r,s=null){Ge(r)||(r=En({},r)),s!=null&&!Ct(s)&&(s=null);const i=Z_(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:QT++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:Cx,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&Ge(d.install)?(o.add(d),d.install(c,...f)):Ge(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!l){const y=c._ceVNode||ht(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,d):n(y,d,g),l=!0,c._container=d,d.__vue_app__=c,Wd(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(es(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=ha;ha=c;try{return d()}finally{ha=f}}};return c}}let ha=null;function $c(n,e){if(Fn){let t=Fn.provides;const r=Fn.parent&&Fn.parent.provides;r===t&&(t=Fn.provides=Object.create(r)),t[n]=e}}function Or(n,e,t=!1){const r=Fn||cr;if(r||ha){let s=ha?ha._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Ge(e)?e.call(r&&r.proxy):e}}const e0={},t0=()=>Object.create(e0),n0=n=>Object.getPrototypeOf(n)===e0;function YT(n,e,t,r=!1){const s={},i=t0();n.propsDefaults=Object.create(null),r0(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:O_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function XT(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=mt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(Kd(n.emitsOptions,g))continue;const y=e[g];if(l)if(gt(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const x=Er(g);s[x]=Vf(l,a,x,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{r0(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!gt(e,f)&&((d=Pi(f))===f||!gt(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=Vf(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!gt(e,f))&&(delete i[f],c=!0)}c&&gs(n.attrs,"set","")}function r0(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Bl(l))continue;const c=e[l];let d;s&&gt(s,d=Er(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:Kd(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=mt(t),c=a||Et;for(let d=0;d<i.length;d++){const f=i[d];t[f]=Vf(s,l,f,c[f],n,!gt(c,f))}}return o}function Vf(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=gt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ge(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=Du(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Pi(t))&&(r=!0))}return r}const ZT=new WeakMap;function s0(n,e,t=!1){const r=t?ZT:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Ge(n)){const d=f=>{l=!0;const[g,y]=s0(f,e,!0);En(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Ct(n)&&r.set(n,la),la;if(Fe(i))for(let d=0;d<i.length;d++){const f=Er(i[d]);Vg(f)&&(o[f]=Et)}else if(i)for(const d in i){const f=Er(d);if(Vg(f)){const g=i[d],y=o[f]=Fe(g)||Ge(g)?{type:g}:En({},g),x=y.type;let S=!1,A=!0;if(Fe(x))for(let j=0;j<x.length;++j){const F=x[j],P=Ge(F)&&F.name;if(P==="Boolean"){S=!0;break}else P==="String"&&(A=!1)}else S=Ge(x)&&x.name==="Boolean";y[0]=S,y[1]=A,(S||gt(y,"default"))&&a.push(f)}}const c=[o,a];return Ct(n)&&r.set(n,c),c}function Vg(n){return n[0]!=="$"&&!Bl(n)}const Dp=n=>n[0]==="_"||n==="$stable",Vp=n=>Fe(n)?n.map(Kr):[Kr(n)],ex=(n,e,t)=>{if(e._n)return e;const r=xT((...s)=>Vp(e(...s)),t);return r._c=!1,r},i0=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Dp(s))continue;const i=n[s];if(Ge(i))e[s]=ex(s,i,r);else if(i!=null){const o=Vp(i);e[s]=()=>o}}},o0=(n,e)=>{const t=Vp(e);n.slots.default=()=>t},a0=(n,e,t)=>{for(const r in e)(t||!Dp(r))&&(n[r]=e[r])},tx=(n,e,t)=>{const r=n.slots=t0();if(n.vnode.shapeFlag&32){const s=e.__;s&&Ef(r,"__",s,!0);const i=e._;i?(a0(r,e,t),t&&Ef(r,"_",i,!0)):i0(e,r)}else e&&o0(n,e)},nx=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Et;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:a0(s,e,t):(i=!e.$stable,i0(e,s)),o=e}else e&&(o0(n,e),o={default:1});if(i)for(const a in s)!Dp(a)&&o[a]==null&&delete s[a]},Hn=gx;function rx(n){return sx(n)}function sx(n,e){const t=Ud();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:y=Vr,insertStaticContent:x}=n,S=(T,C,O,Z=null,J=null,ee=null,ye=void 0,he=null,ce=!!C.dynamicChildren)=>{if(T===C)return;T&&!Tl(T,C)&&(Z=K(T),W(T,J,ee,!0),T=null),C.patchFlag===-2&&(ce=!1,C.dynamicChildren=null);const{type:ie,ref:Ee,shapeFlag:we}=C;switch(ie){case Hd:A(T,C,O,Z);break;case yi:j(T,C,O,Z);break;case Uc:T==null&&F(C,O,Z,ye);break;case _t:$(T,C,O,Z,J,ee,ye,he,ce);break;default:we&1?X(T,C,O,Z,J,ee,ye,he,ce):we&6?R(T,C,O,Z,J,ee,ye,he,ce):(we&64||we&128)&&ie.process(T,C,O,Z,J,ee,ye,he,ce,Ae)}Ee!=null&&J?Kl(Ee,T&&T.ref,ee,C||T,!C):Ee==null&&T&&T.ref!=null&&Kl(T.ref,null,ee,T,!0)},A=(T,C,O,Z)=>{if(T==null)r(C.el=a(C.children),O,Z);else{const J=C.el=T.el;C.children!==T.children&&c(J,C.children)}},j=(T,C,O,Z)=>{T==null?r(C.el=l(C.children||""),O,Z):C.el=T.el},F=(T,C,O,Z)=>{[T.el,T.anchor]=x(T.children,C,O,Z,T.el,T.anchor)},P=({el:T,anchor:C},O,Z)=>{let J;for(;T&&T!==C;)J=g(T),r(T,O,Z),T=J;r(C,O,Z)},q=({el:T,anchor:C})=>{let O;for(;T&&T!==C;)O=g(T),s(T),T=O;s(C)},X=(T,C,O,Z,J,ee,ye,he,ce)=>{C.type==="svg"?ye="svg":C.type==="math"&&(ye="mathml"),T==null?ue(C,O,Z,J,ee,ye,he,ce):I(T,C,J,ee,ye,he,ce)},ue=(T,C,O,Z,J,ee,ye,he)=>{let ce,ie;const{props:Ee,shapeFlag:we,transition:Te,dirs:Re}=T;if(ce=T.el=o(T.type,ee,Ee&&Ee.is,Ee),we&8?d(ce,T.children):we&16&&w(T.children,ce,null,Z,J,Jh(T,ee),ye,he),Re&&Qi(T,null,Z,"created"),E(ce,T,T.scopeId,ye,Z),Ee){for(const Be in Ee)Be!=="value"&&!Bl(Be)&&i(ce,Be,null,Ee[Be],ee,Z);"value"in Ee&&i(ce,"value",null,Ee.value,ee),(ie=Ee.onVnodeBeforeMount)&&zr(ie,Z,T)}Re&&Qi(T,null,Z,"beforeMount");const Me=ix(J,Te);Me&&Te.beforeEnter(ce),r(ce,C,O),((ie=Ee&&Ee.onVnodeMounted)||Me||Re)&&Hn(()=>{ie&&zr(ie,Z,T),Me&&Te.enter(ce),Re&&Qi(T,null,Z,"mounted")},J)},E=(T,C,O,Z,J)=>{if(O&&y(T,O),Z)for(let ee=0;ee<Z.length;ee++)y(T,Z[ee]);if(J){let ee=J.subTree;if(C===ee||h0(ee.type)&&(ee.ssContent===C||ee.ssFallback===C)){const ye=J.vnode;E(T,ye,ye.scopeId,ye.slotScopeIds,J.parent)}}},w=(T,C,O,Z,J,ee,ye,he,ce=0)=>{for(let ie=ce;ie<T.length;ie++){const Ee=T[ie]=he?ei(T[ie]):Kr(T[ie]);S(null,Ee,C,O,Z,J,ee,ye,he)}},I=(T,C,O,Z,J,ee,ye)=>{const he=C.el=T.el;let{patchFlag:ce,dynamicChildren:ie,dirs:Ee}=C;ce|=T.patchFlag&16;const we=T.props||Et,Te=C.props||Et;let Re;if(O&&Ji(O,!1),(Re=Te.onVnodeBeforeUpdate)&&zr(Re,O,C,T),Ee&&Qi(C,T,O,"beforeUpdate"),O&&Ji(O,!0),(we.innerHTML&&Te.innerHTML==null||we.textContent&&Te.textContent==null)&&d(he,""),ie?k(T.dynamicChildren,ie,he,O,Z,Jh(C,J),ee):ye||Ue(T,C,he,null,O,Z,Jh(C,J),ee,!1),ce>0){if(ce&16)D(he,we,Te,O,J);else if(ce&2&&we.class!==Te.class&&i(he,"class",null,Te.class,J),ce&4&&i(he,"style",we.style,Te.style,J),ce&8){const Me=C.dynamicProps;for(let Be=0;Be<Me.length;Be++){const Xe=Me[Be],Kt=we[Xe],$t=Te[Xe];($t!==Kt||Xe==="value")&&i(he,Xe,Kt,$t,J,O)}}ce&1&&T.children!==C.children&&d(he,C.children)}else!ye&&ie==null&&D(he,we,Te,O,J);((Re=Te.onVnodeUpdated)||Ee)&&Hn(()=>{Re&&zr(Re,O,C,T),Ee&&Qi(C,T,O,"updated")},Z)},k=(T,C,O,Z,J,ee,ye)=>{for(let he=0;he<C.length;he++){const ce=T[he],ie=C[he],Ee=ce.el&&(ce.type===_t||!Tl(ce,ie)||ce.shapeFlag&198)?f(ce.el):O;S(ce,ie,Ee,null,Z,J,ee,ye,!0)}},D=(T,C,O,Z,J)=>{if(C!==O){if(C!==Et)for(const ee in C)!Bl(ee)&&!(ee in O)&&i(T,ee,C[ee],null,J,Z);for(const ee in O){if(Bl(ee))continue;const ye=O[ee],he=C[ee];ye!==he&&ee!=="value"&&i(T,ee,he,ye,J,Z)}"value"in O&&i(T,"value",C.value,O.value,J)}},$=(T,C,O,Z,J,ee,ye,he,ce)=>{const ie=C.el=T?T.el:a(""),Ee=C.anchor=T?T.anchor:a("");let{patchFlag:we,dynamicChildren:Te,slotScopeIds:Re}=C;Re&&(he=he?he.concat(Re):Re),T==null?(r(ie,O,Z),r(Ee,O,Z),w(C.children||[],O,Ee,J,ee,ye,he,ce)):we>0&&we&64&&Te&&T.dynamicChildren?(k(T.dynamicChildren,Te,O,J,ee,ye,he),(C.key!=null||J&&C===J.subTree)&&Np(T,C,!0)):Ue(T,C,O,Ee,J,ee,ye,he,ce)},R=(T,C,O,Z,J,ee,ye,he,ce)=>{C.slotScopeIds=he,T==null?C.shapeFlag&512?J.ctx.activate(C,O,Z,ye,ce):Dt(C,O,Z,J,ee,ye,ce):xt(T,C,ce)},Dt=(T,C,O,Z,J,ee,ye)=>{const he=T.component=Ex(T,Z,J);if(Q_(T)&&(he.ctx.renderer=Ae),Tx(he,!1,ye),he.asyncDep){if(J&&J.registerDep(he,tt,ye),!T.el){const ce=he.subTree=ht(yi);j(null,ce,C,O)}}else tt(he,T,C,O,J,ee,ye)},xt=(T,C,O)=>{const Z=C.component=T.component;if(px(T,C,O))if(Z.asyncDep&&!Z.asyncResolved){$e(Z,C,O);return}else Z.next=C,Z.update();else C.el=T.el,Z.vnode=C},tt=(T,C,O,Z,J,ee,ye)=>{const he=()=>{if(T.isMounted){let{next:we,bu:Te,u:Re,parent:Me,vnode:Be}=T;{const Vt=l0(T);if(Vt){we&&(we.el=Be.el,$e(T,we,ye)),Vt.asyncDep.then(()=>{T.isUnmounted||he()});return}}let Xe=we,Kt;Ji(T,!1),we?(we.el=Be.el,$e(T,we,ye)):we=Be,Te&&Lc(Te),(Kt=we.props&&we.props.onVnodeBeforeUpdate)&&zr(Kt,Me,we,Be),Ji(T,!0);const $t=Yh(T),vn=T.subTree;T.subTree=$t,S(vn,$t,f(vn.el),K(vn),T,J,ee),we.el=$t.el,Xe===null&&mx(T,$t.el),Re&&Hn(Re,J),(Kt=we.props&&we.props.onVnodeUpdated)&&Hn(()=>zr(Kt,Me,we,Be),J)}else{let we;const{el:Te,props:Re}=C,{bm:Me,m:Be,parent:Xe,root:Kt,type:$t}=T,vn=Hl(C);if(Ji(T,!1),Me&&Lc(Me),!vn&&(we=Re&&Re.onVnodeBeforeMount)&&zr(we,Xe,C),Ji(T,!0),Te&&lt){const Vt=()=>{T.subTree=Yh(T),lt(Te,T.subTree,T,J,null)};vn&&$t.__asyncHydrate?$t.__asyncHydrate(Te,T,Vt):Vt()}else{Kt.ce&&Kt.ce._def.shadowRoot!==!1&&Kt.ce._injectChildStyle($t);const Vt=T.subTree=Yh(T);S(null,Vt,O,Z,T,J,ee),C.el=Vt.el}if(Be&&Hn(Be,J),!vn&&(we=Re&&Re.onVnodeMounted)){const Vt=C;Hn(()=>zr(we,Xe,Vt),J)}(C.shapeFlag&256||Xe&&Hl(Xe.vnode)&&Xe.vnode.shapeFlag&256)&&T.a&&Hn(T.a,J),T.isMounted=!0,C=O=Z=null}};T.scope.on();const ce=T.effect=new w_(he);T.scope.off();const ie=T.update=ce.run.bind(ce),Ee=T.job=ce.runIfDirty.bind(ce);Ee.i=T,Ee.id=T.uid,ce.scheduler=()=>Rp(Ee),Ji(T,!0),ie()},$e=(T,C,O)=>{C.component=T;const Z=T.vnode.props;T.vnode=C,T.next=null,XT(T,C.props,Z,O),nx(T,C.children,O),Ts(),Tg(T),xs()},Ue=(T,C,O,Z,J,ee,ye,he,ce=!1)=>{const ie=T&&T.children,Ee=T?T.shapeFlag:0,we=C.children,{patchFlag:Te,shapeFlag:Re}=C;if(Te>0){if(Te&128){te(ie,we,O,Z,J,ee,ye,he,ce);return}else if(Te&256){De(ie,we,O,Z,J,ee,ye,he,ce);return}}Re&8?(Ee&16&&Ze(ie,J,ee),we!==ie&&d(O,we)):Ee&16?Re&16?te(ie,we,O,Z,J,ee,ye,he,ce):Ze(ie,J,ee,!0):(Ee&8&&d(O,""),Re&16&&w(we,O,Z,J,ee,ye,he,ce))},De=(T,C,O,Z,J,ee,ye,he,ce)=>{T=T||la,C=C||la;const ie=T.length,Ee=C.length,we=Math.min(ie,Ee);let Te;for(Te=0;Te<we;Te++){const Re=C[Te]=ce?ei(C[Te]):Kr(C[Te]);S(T[Te],Re,O,null,J,ee,ye,he,ce)}ie>Ee?Ze(T,J,ee,!0,!1,we):w(C,O,Z,J,ee,ye,he,ce,we)},te=(T,C,O,Z,J,ee,ye,he,ce)=>{let ie=0;const Ee=C.length;let we=T.length-1,Te=Ee-1;for(;ie<=we&&ie<=Te;){const Re=T[ie],Me=C[ie]=ce?ei(C[ie]):Kr(C[ie]);if(Tl(Re,Me))S(Re,Me,O,null,J,ee,ye,he,ce);else break;ie++}for(;ie<=we&&ie<=Te;){const Re=T[we],Me=C[Te]=ce?ei(C[Te]):Kr(C[Te]);if(Tl(Re,Me))S(Re,Me,O,null,J,ee,ye,he,ce);else break;we--,Te--}if(ie>we){if(ie<=Te){const Re=Te+1,Me=Re<Ee?C[Re].el:Z;for(;ie<=Te;)S(null,C[ie]=ce?ei(C[ie]):Kr(C[ie]),O,Me,J,ee,ye,he,ce),ie++}}else if(ie>Te)for(;ie<=we;)W(T[ie],J,ee,!0),ie++;else{const Re=ie,Me=ie,Be=new Map;for(ie=Me;ie<=Te;ie++){const rn=C[ie]=ce?ei(C[ie]):Kr(C[ie]);rn.key!=null&&Be.set(rn.key,ie)}let Xe,Kt=0;const $t=Te-Me+1;let vn=!1,Vt=0;const fr=new Array($t);for(ie=0;ie<$t;ie++)fr[ie]=0;for(ie=Re;ie<=we;ie++){const rn=T[ie];if(Kt>=$t){W(rn,J,ee,!0);continue}let Rn;if(rn.key!=null)Rn=Be.get(rn.key);else for(Xe=Me;Xe<=Te;Xe++)if(fr[Xe-Me]===0&&Tl(rn,C[Xe])){Rn=Xe;break}Rn===void 0?W(rn,J,ee,!0):(fr[Rn-Me]=ie+1,Rn>=Vt?Vt=Rn:vn=!0,S(rn,C[Rn],O,null,J,ee,ye,he,ce),Kt++)}const Lr=vn?ox(fr):la;for(Xe=Lr.length-1,ie=$t-1;ie>=0;ie--){const rn=Me+ie,Rn=C[rn],Ni=rn+1<Ee?C[rn+1].el:Z;fr[ie]===0?S(null,Rn,O,Ni,J,ee,ye,he,ce):vn&&(Xe<0||ie!==Lr[Xe]?Ve(Rn,O,Ni,2):Xe--)}}},Ve=(T,C,O,Z,J=null)=>{const{el:ee,type:ye,transition:he,children:ce,shapeFlag:ie}=T;if(ie&6){Ve(T.component.subTree,C,O,Z);return}if(ie&128){T.suspense.move(C,O,Z);return}if(ie&64){ye.move(T,C,O,Ae);return}if(ye===_t){r(ee,C,O);for(let we=0;we<ce.length;we++)Ve(ce[we],C,O,Z);r(T.anchor,C,O);return}if(ye===Uc){P(T,C,O);return}if(Z!==2&&ie&1&&he)if(Z===0)he.beforeEnter(ee),r(ee,C,O),Hn(()=>he.enter(ee),J);else{const{leave:we,delayLeave:Te,afterLeave:Re}=he,Me=()=>{T.ctx.isUnmounted?s(ee):r(ee,C,O)},Be=()=>{we(ee,()=>{Me(),Re&&Re()})};Te?Te(ee,Me,Be):Be()}else r(ee,C,O)},W=(T,C,O,Z=!1,J=!1)=>{const{type:ee,props:ye,ref:he,children:ce,dynamicChildren:ie,shapeFlag:Ee,patchFlag:we,dirs:Te,cacheIndex:Re}=T;if(we===-2&&(J=!1),he!=null&&(Ts(),Kl(he,null,O,T,!0),xs()),Re!=null&&(C.renderCache[Re]=void 0),Ee&256){C.ctx.deactivate(T);return}const Me=Ee&1&&Te,Be=!Hl(T);let Xe;if(Be&&(Xe=ye&&ye.onVnodeBeforeUnmount)&&zr(Xe,C,T),Ee&6)Je(T.component,O,Z);else{if(Ee&128){T.suspense.unmount(O,Z);return}Me&&Qi(T,null,C,"beforeUnmount"),Ee&64?T.type.remove(T,C,O,Ae,Z):ie&&!ie.hasOnce&&(ee!==_t||we>0&&we&64)?Ze(ie,C,O,!1,!0):(ee===_t&&we&384||!J&&Ee&16)&&Ze(ce,C,O),Z&&Y(T)}(Be&&(Xe=ye&&ye.onVnodeUnmounted)||Me)&&Hn(()=>{Xe&&zr(Xe,C,T),Me&&Qi(T,null,C,"unmounted")},O)},Y=T=>{const{type:C,el:O,anchor:Z,transition:J}=T;if(C===_t){Ne(O,Z);return}if(C===Uc){q(T);return}const ee=()=>{s(O),J&&!J.persisted&&J.afterLeave&&J.afterLeave()};if(T.shapeFlag&1&&J&&!J.persisted){const{leave:ye,delayLeave:he}=J,ce=()=>ye(O,ee);he?he(T.el,ee,ce):ce()}else ee()},Ne=(T,C)=>{let O;for(;T!==C;)O=g(T),s(T),T=O;s(C)},Je=(T,C,O)=>{const{bum:Z,scope:J,job:ee,subTree:ye,um:he,m:ce,a:ie,parent:Ee,slots:{__:we}}=T;Ng(ce),Ng(ie),Z&&Lc(Z),Ee&&Fe(we)&&we.forEach(Te=>{Ee.renderCache[Te]=void 0}),J.stop(),ee&&(ee.flags|=8,W(ye,T,C,O)),he&&Hn(he,C),Hn(()=>{T.isUnmounted=!0},C),C&&C.pendingBranch&&!C.isUnmounted&&T.asyncDep&&!T.asyncResolved&&T.suspenseId===C.pendingId&&(C.deps--,C.deps===0&&C.resolve())},Ze=(T,C,O,Z=!1,J=!1,ee=0)=>{for(let ye=ee;ye<T.length;ye++)W(T[ye],C,O,Z,J)},K=T=>{if(T.shapeFlag&6)return K(T.component.subTree);if(T.shapeFlag&128)return T.suspense.next();const C=g(T.anchor||T.el),O=C&&C[z_];return O?g(O):C};let be=!1;const de=(T,C,O)=>{T==null?C._vnode&&W(C._vnode,null,null,!0):S(C._vnode||null,T,C,null,null,null,O),C._vnode=T,be||(be=!0,Tg(),j_(),be=!1)},Ae={p:S,um:W,m:Ve,r:Y,mt:Dt,mc:w,pc:Ue,pbc:k,n:K,o:n};let He,lt;return e&&([He,lt]=e(Ae)),{render:de,hydrate:He,createApp:JT(de,He)}}function Jh({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Ji({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function ix(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Np(n,e,t=!1){const r=n.children,s=e.children;if(Fe(r)&&Fe(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=ei(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Np(o,a)),a.type===Hd&&(a.el=o.el),a.type===yi&&!a.el&&(a.el=o.el)}}function ox(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function l0(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:l0(e)}function Ng(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const ax=Symbol.for("v-scx"),lx=()=>Or(ax);function Ot(n,e,t){return u0(n,e,t)}function u0(n,e,t=Et){const{immediate:r,deep:s,flush:i,once:o}=t,a=En({},t),l=e&&r||!e&&i!=="post";let c;if(lu){if(i==="sync"){const y=lx();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=Vr,y.resume=Vr,y.pause=Vr,y}}const d=Fn;a.call=(y,x,S)=>es(y,d,x,S);let f=!1;i==="post"?a.scheduler=y=>{Hn(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,x)=>{x?y():Rp(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const g=wT(n,e,a);return lu&&(c?c.push(g):l&&g()),g}function ux(n,e,t){const r=this.proxy,s=nn(n)?n.includes(".")?c0(r,n):()=>r[n]:n.bind(r,r);let i;Ge(e)?i=e:(i=e.handler,t=e);const o=Du(this),a=u0(s,i.bind(r),t);return o(),a}function c0(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const cx=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Er(e)}Modifiers`]||n[`${Pi(e)}Modifiers`];function dx(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Et;let s=t;const i=e.startsWith("update:"),o=i&&cx(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>nn(d)?d.trim():d)),o.number&&(s=t.map(Tf)));let a,l=r[a=zh(e)]||r[a=zh(Er(e))];!l&&i&&(l=r[a=zh(Pi(e))]),l&&es(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,es(c,n,6,s)}}function d0(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Ge(n)){const l=c=>{const d=d0(c,e,!0);d&&(a=!0,En(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Ct(n)&&r.set(n,null),null):(Fe(i)?i.forEach(l=>o[l]=null):En(o,i),Ct(n)&&r.set(n,o),o)}function Kd(n,e){return!n||!Md(e)?!1:(e=e.slice(2).replace(/Once$/,""),gt(n,e[0].toLowerCase()+e.slice(1))||gt(n,Pi(e))||gt(n,e))}function Yh(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:g,setupState:y,ctx:x,inheritAttrs:S}=n,A=od(n);let j,F;try{if(t.shapeFlag&4){const q=s||r,X=q;j=Kr(c.call(X,q,d,f,y,g,x)),F=a}else{const q=e;j=Kr(q.length>1?q(f,{attrs:a,slots:o,emit:l}):q(f,null)),F=e.props?a:hx(a)}}catch(q){Ql.length=0,zd(q,n,1),j=ht(yi)}let P=j;if(F&&S!==!1){const q=Object.keys(F),{shapeFlag:X}=P;q.length&&X&7&&(i&&q.some(_p)&&(F=fx(F,i)),P=ba(P,F,!1,!0))}return t.dirs&&(P=ba(P,null,!1,!0),P.dirs=P.dirs?P.dirs.concat(t.dirs):t.dirs),t.transition&&Cp(P,t.transition),j=P,od(A),j}const hx=n=>{let e;for(const t in n)(t==="class"||t==="style"||Md(t))&&((e||(e={}))[t]=n[t]);return e},fx=(n,e)=>{const t={};for(const r in n)(!_p(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function px(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Og(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!Kd(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Og(r,o,c):!0:!!o;return!1}function Og(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Kd(t,i))return!0}return!1}function mx({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const h0=n=>n.__isSuspense;function gx(n,e){e&&e.pendingBranch?Fe(n)?e.effects.push(...n):e.effects.push(n):TT(n)}const _t=Symbol.for("v-fgt"),Hd=Symbol.for("v-txt"),yi=Symbol.for("v-cmt"),Uc=Symbol.for("v-stc"),Ql=[];let dr=null;function M(n=!1){Ql.push(dr=n?null:[])}function vx(){Ql.pop(),dr=Ql[Ql.length-1]||null}let au=1;function Mg(n,e=!1){au+=n,n<0&&dr&&e&&(dr.hasOnce=!0)}function f0(n){return n.dynamicChildren=au>0?dr||la:null,vx(),au>0&&dr&&dr.push(n),n}function L(n,e,t,r,s,i){return f0(h(n,e,t,r,s,i,!0))}function ld(n,e,t,r,s){return f0(ht(n,e,t,r,s,!0))}function ud(n){return n?n.__v_isVNode===!0:!1}function Tl(n,e){return n.type===e.type&&n.key===e.key}const p0=({key:n})=>n??null,jc=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?nn(n)||$n(n)||Ge(n)?{i:cr,r:n,k:e,f:!!t}:n:null);function h(n,e=null,t=null,r=0,s=null,i=n===_t?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&p0(e),ref:e&&jc(e),scopeId:q_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:cr};return a?(Op(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=nn(t)?8:16),au>0&&!o&&dr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&dr.push(l),l}const ht=yx;function yx(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===jT)&&(n=yi),ud(n)){const a=ba(n,e,!0);return t&&Op(a,t),au>0&&!i&&dr&&(a.shapeFlag&6?dr[dr.indexOf(n)]=a:dr.push(a)),a.patchFlag=-2,a}if(Rx(n)&&(n=n.__vccOpts),e){e=_x(e);let{class:a,style:l}=e;a&&!nn(a)&&(e.class=fn(a)),Ct(l)&&(Pp(l)&&!Fe(l)&&(l=En({},l)),e.style=ms(l))}const o=nn(n)?1:h0(n)?128:AT(n)?64:Ct(n)?4:Ge(n)?2:0;return h(n,e,t,r,s,o,i,!0)}function _x(n){return n?Pp(n)||n0(n)?En({},n):n:null}function ba(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?bx(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&p0(c),ref:e&&e.ref?t&&i?Fe(i)?i.concat(jc(e)):[i,jc(e)]:jc(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==_t?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&ba(n.ssContent),ssFallback:n.ssFallback&&ba(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&Cp(d,l.clone(d)),d}function Ln(n=" ",e=0){return ht(Hd,null,n,e)}function lr(n,e){const t=ht(Uc,null,n);return t.staticCount=e,t}function le(n="",e=!1){return e?(M(),ld(yi,null,n)):ht(yi,null,n)}function Kr(n){return n==null||typeof n=="boolean"?ht(yi):Fe(n)?ht(_t,null,n.slice()):ud(n)?ei(n):ht(Hd,null,String(n))}function ei(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:ba(n)}function Op(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Fe(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),Op(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!n0(e)?e._ctx=cr:s===3&&cr&&(cr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Ge(e)?(e={default:e,_ctx:cr},t=32):(e=String(e),r&64?(t=16,e=[Ln(e)]):t=8);n.children=e,n.shapeFlag|=t}function bx(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=fn([e.class,r.class]));else if(s==="style")e.style=ms([e.style,r.style]);else if(Md(s)){const i=e[s],o=r[s];o&&i!==o&&!(Fe(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function zr(n,e,t,r=null){es(n,e,7,[t,r])}const wx=Z_();let Ix=0;function Ex(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||wx,i={uid:Ix++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new WE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:s0(r,s),emitsOptions:d0(r,s),emit:null,emitted:null,propsDefaults:Et,inheritAttrs:r.inheritAttrs,ctx:Et,data:Et,props:Et,attrs:Et,slots:Et,refs:Et,setupState:Et,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=dx.bind(null,i),n.ce&&n.ce(i),i}let Fn=null,cd,Nf;{const n=Ud(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};cd=e("__VUE_INSTANCE_SETTERS__",t=>Fn=t),Nf=e("__VUE_SSR_SETTERS__",t=>lu=t)}const Du=n=>{const e=Fn;return cd(n),n.scope.on(),()=>{n.scope.off(),cd(e)}},Lg=()=>{Fn&&Fn.scope.off(),cd(null)};function m0(n){return n.vnode.shapeFlag&4}let lu=!1;function Tx(n,e=!1,t=!1){e&&Nf(e);const{props:r,children:s}=n.vnode,i=m0(n);YT(n,r,i,e),tx(n,s,t||e);const o=i?xx(n,e):void 0;return e&&Nf(!1),o}function xx(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,qT);const{setup:r}=t;if(r){Ts();const s=n.setupContext=r.length>1?Sx(n):null,i=Du(n),o=ku(r,n,0,[n.props,s]),a=p_(o);if(xs(),i(),(a||n.sp)&&!Hl(n)&&W_(n),a){if(o.then(Lg,Lg),e)return o.then(l=>{Fg(n,l,e)}).catch(l=>{zd(l,n,0)});n.asyncDep=o}else Fg(n,o,e)}else g0(n,e)}function Fg(n,e,t){Ge(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Ct(e)&&(n.setupState=F_(e)),g0(n,t)}let $g;function g0(n,e,t){const r=n.type;if(!n.render){if(!e&&$g&&!r.render){const s=r.template||kp(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=En(En({isCustomElement:i,delimiters:a},o),l);r.render=$g(s,c)}}n.render=r.render||Vr}{const s=Du(n);Ts();try{zT(n)}finally{xs(),s()}}}const Ax={get(n,e){return Mn(n,"get",""),n[e]}};function Sx(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,Ax),slots:n.slots,emit:n.emit,expose:e}}function Wd(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(F_(pT(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Wl)return Wl[t](n)},has(e,t){return t in e||t in Wl}})):n.proxy}function Px(n,e=!0){return Ge(n)?n.displayName||n.name:n.name||e&&n.__name}function Rx(n){return Ge(n)&&"__vccOpts"in n}const ze=(n,e)=>_T(n,e,lu);function v0(n,e,t){const r=arguments.length;return r===2?Ct(e)&&!Fe(e)?ud(e)?ht(n,null,[e]):ht(n,e):ht(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&ud(t)&&(t=[t]),ht(n,e,t))}const Cx="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Of;const Ug=typeof window<"u"&&window.trustedTypes;if(Ug)try{Of=Ug.createPolicy("vue",{createHTML:n=>n})}catch{}const y0=Of?n=>Of.createHTML(n):n=>n,kx="http://www.w3.org/2000/svg",Dx="http://www.w3.org/1998/Math/MathML",ps=typeof document<"u"?document:null,jg=ps&&ps.createElement("template"),Vx={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?ps.createElementNS(kx,n):e==="mathml"?ps.createElementNS(Dx,n):t?ps.createElement(n,{is:t}):ps.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>ps.createTextNode(n),createComment:n=>ps.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>ps.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{jg.innerHTML=y0(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=jg.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Nx=Symbol("_vtc");function Ox(n,e,t){const r=n[Nx];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const dd=Symbol("_vod"),_0=Symbol("_vsh"),Xh={beforeMount(n,{value:e},{transition:t}){n[dd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):xl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),xl(n,!0),r.enter(n)):r.leave(n,()=>{xl(n,!1)}):xl(n,e))},beforeUnmount(n,{value:e}){xl(n,e)}};function xl(n,e){n.style.display=e?n[dd]:"none",n[_0]=!e}const Mx=Symbol(""),Lx=/(^|;)\s*display\s*:/;function Fx(n,e,t){const r=n.style,s=nn(t);let i=!1;if(t&&!s){if(e)if(nn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Bc(r,a,"")}else for(const o in e)t[o]==null&&Bc(r,o,"");for(const o in t)o==="display"&&(i=!0),Bc(r,o,t[o])}else if(s){if(e!==t){const o=r[Mx];o&&(t+=";"+o),r.cssText=t,i=Lx.test(t)}}else e&&n.removeAttribute("style");dd in n&&(n[dd]=i?r.display:"",n[_0]&&(r.display="none"))}const Bg=/\s*!important$/;function Bc(n,e,t){if(Fe(t))t.forEach(r=>Bc(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=$x(n,e);Bg.test(t)?n.setProperty(Pi(r),t.replace(Bg,""),"important"):n[r]=t}}const qg=["Webkit","Moz","ms"],Zh={};function $x(n,e){const t=Zh[e];if(t)return t;let r=Er(e);if(r!=="filter"&&r in n)return Zh[e]=r;r=$d(r);for(let s=0;s<qg.length;s++){const i=qg[s]+r;if(i in n)return Zh[e]=i}return e}const zg="http://www.w3.org/1999/xlink";function Gg(n,e,t,r,s,i=KE(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(zg,e.slice(6,e.length)):n.setAttributeNS(zg,e,t):t==null||i&&!v_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Zr(t)?String(t):t)}function Kg(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?y0(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=v_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function to(n,e,t,r){n.addEventListener(e,t,r)}function Ux(n,e,t,r){n.removeEventListener(e,t,r)}const Hg=Symbol("_vei");function jx(n,e,t,r,s=null){const i=n[Hg]||(n[Hg]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=Bx(e);if(r){const c=i[e]=Gx(r,s);to(n,a,c,l)}else o&&(Ux(n,a,o,l),i[e]=void 0)}}const Wg=/(?:Once|Passive|Capture)$/;function Bx(n){let e;if(Wg.test(n)){e={};let r;for(;r=n.match(Wg);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Pi(n.slice(2)),e]}let ef=0;const qx=Promise.resolve(),zx=()=>ef||(qx.then(()=>ef=0),ef=Date.now());function Gx(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;es(Kx(r,t.value),e,5,[r])};return t.value=n,t.attached=zx(),t}function Kx(n,e){if(Fe(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Qg=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,Hx=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?Ox(n,r,o):e==="style"?Fx(n,t,r):Md(e)?_p(e)||jx(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Wx(n,e,r,o))?(Kg(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Gg(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!nn(r))?Kg(n,Er(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Gg(n,e,r,o))};function Wx(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Qg(e)&&Ge(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Qg(e)&&nn(t)?!1:e in n}const hd=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Fe(e)?t=>Lc(e,t):e};function Qx(n){n.target.composing=!0}function Jg(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const fa=Symbol("_assign"),Rt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[fa]=hd(s);const i=r||s.props&&s.props.type==="number";to(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Tf(a)),n[fa](a)}),t&&to(n,"change",()=>{n.value=n.value.trim()}),e||(to(n,"compositionstart",Qx),to(n,"compositionend",Jg),to(n,"change",Jg))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[fa]=hd(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Tf(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},wa={deep:!0,created(n,e,t){n[fa]=hd(t),to(n,"change",()=>{const r=n._modelValue,s=Jx(n),i=n.checked,o=n[fa];if(Fe(r)){const a=y_(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Ld(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(b0(n,i))})},mounted:Yg,beforeUpdate(n,e,t){n[fa]=hd(t),Yg(n,e,t)}};function Yg(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Fe(e))s=y_(e,r.props.value)>-1;else if(Ld(e))s=e.has(r.props.value);else{if(e===t)return;s=jd(e,b0(n,!0))}n.checked!==s&&(n.checked=s)}function Jx(n){return"_value"in n?n._value:n.value}function b0(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const Yx=["ctrl","shift","alt","meta"],Xx={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>Yx.some(t=>n[`${t}Key`]&&!e.includes(t))},Nt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=Xx[e[o]];if(a&&a(s,e))return}return n(s,...i)})},Zx={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Nn=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Pi(s.key);if(e.some(o=>o===i||Zx[o]===i))return n(s)})},eA=En({patchProp:Hx},Vx);let Xg;function tA(){return Xg||(Xg=rx(eA))}const nA=(...n)=>{const e=tA().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=sA(r);if(!s)return;const i=e._component;!Ge(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,rA(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function rA(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function sA(n){return nn(n)?document.querySelector(n):n}const iA={__name:"App",setup(n){return(e,t)=>{const r=UT("router-view");return M(),ld(r)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const na=typeof document<"u";function w0(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function oA(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&w0(n.default)}const pt=Object.assign;function tf(n,e){const t={};for(const r in e){const s=e[r];t[r]=Mr(s)?s.map(n):n(s)}return t}const Jl=()=>{},Mr=Array.isArray,I0=/#/g,aA=/&/g,lA=/\//g,uA=/=/g,cA=/\?/g,E0=/\+/g,dA=/%5B/g,hA=/%5D/g,T0=/%5E/g,fA=/%60/g,x0=/%7B/g,pA=/%7C/g,A0=/%7D/g,mA=/%20/g;function Mp(n){return encodeURI(""+n).replace(pA,"|").replace(dA,"[").replace(hA,"]")}function gA(n){return Mp(n).replace(x0,"{").replace(A0,"}").replace(T0,"^")}function Mf(n){return Mp(n).replace(E0,"%2B").replace(mA,"+").replace(I0,"%23").replace(aA,"%26").replace(fA,"`").replace(x0,"{").replace(A0,"}").replace(T0,"^")}function vA(n){return Mf(n).replace(uA,"%3D")}function yA(n){return Mp(n).replace(I0,"%23").replace(cA,"%3F")}function _A(n){return n==null?"":yA(n).replace(lA,"%2F")}function uu(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const bA=/\/$/,wA=n=>n.replace(bA,"");function nf(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=xA(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:uu(o)}}function IA(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Zg(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function EA(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Ia(e.matched[r],t.matched[s])&&S0(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ia(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function S0(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!TA(n[t],e[t]))return!1;return!0}function TA(n,e){return Mr(n)?ev(n,e):Mr(e)?ev(e,n):n===e}function ev(n,e){return Mr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function xA(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const Qs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var cu;(function(n){n.pop="pop",n.push="push"})(cu||(cu={}));var Yl;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Yl||(Yl={}));function AA(n){if(!n)if(na){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),wA(n)}const SA=/^[^#]+#/;function PA(n,e){return n.replace(SA,"#")+e}function RA(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Qd=()=>({left:window.scrollX,top:window.scrollY});function CA(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=RA(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function tv(n,e){return(history.state?history.state.position-e:-1)+n}const Lf=new Map;function kA(n,e){Lf.set(n,e)}function DA(n){const e=Lf.get(n);return Lf.delete(n),e}let VA=()=>location.protocol+"//"+location.host;function P0(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Zg(l,"")}return Zg(t,n)+r+s}function NA(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=P0(n,location),x=t.value,S=e.value;let A=0;if(g){if(t.value=y,e.value=g,o&&o===x){o=null;return}A=S?g.position-S.position:0}else r(y);s.forEach(j=>{j(t.value,x,{delta:A,type:cu.pop,direction:A?A>0?Yl.forward:Yl.back:Yl.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const x=s.indexOf(g);x>-1&&s.splice(x,1)};return i.push(y),y}function d(){const{history:g}=window;g.state&&g.replaceState(pt({},g.state,{scroll:Qd()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function nv(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Qd():null}}function OA(n){const{history:e,location:t}=window,r={value:P0(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:VA()+n+l;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](g)}}function o(l,c){const d=pt({},e.state,nv(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=pt({},s.value,e.state,{forward:l,scroll:Qd()});i(d.current,d,!0);const f=pt({},nv(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function MA(n){n=AA(n);const e=OA(n),t=NA(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=pt({location:"",base:n,go:r,createHref:PA.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function LA(n){return typeof n=="string"||n&&typeof n=="object"}function R0(n){return typeof n=="string"||typeof n=="symbol"}const C0=Symbol("");var rv;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(rv||(rv={}));function Ea(n,e){return pt(new Error,{type:n,[C0]:!0},e)}function fs(n,e){return n instanceof Error&&C0 in n&&(e==null||!!(n.type&e))}const sv="[^/]+?",FA={sensitive:!1,strict:!1,start:!0,end:!0},$A=/[.+*?^${}()[\]/\\]/g;function UA(n,e){const t=pt({},FA,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace($A,"\\$&"),y+=40;else if(g.type===1){const{value:x,repeatable:S,optional:A,regexp:j}=g;i.push({name:x,repeatable:S,optional:A});const F=j||sv;if(F!==sv){y+=10;try{new RegExp(`(${F})`)}catch(q){throw new Error(`Invalid custom RegExp for param "${x}" (${F}): `+q.message)}}let P=S?`((?:${F})(?:/(?:${F}))*)`:`(${F})`;f||(P=A&&c.length<2?`(?:/${P})`:"/"+P),A&&(P+="?"),s+=P,y+=20,A&&(y+=-8),S&&(y+=-20),F===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const y=d[g]||"",x=i[g-1];f[x.name]=y&&x.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of g)if(y.type===0)d+=y.value;else if(y.type===1){const{value:x,repeatable:S,optional:A}=y,j=x in c?c[x]:"";if(Mr(j)&&!S)throw new Error(`Provided param "${x}" is an array but it is not repeatable (* or + modifiers)`);const F=Mr(j)?j.join("/"):j;if(!F)if(A)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${x}"`);d+=F}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function jA(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function k0(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=jA(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(iv(r))return 1;if(iv(s))return-1}return s.length-r.length}function iv(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const BA={type:0,value:""},qA=/[a-zA-Z0-9_]/;function zA(n){if(!n)return[[]];if(n==="/")return[[BA]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:qA.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function GA(n,e,t){const r=UA(zA(n.path),t),s=pt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function KA(n,e){const t=[],r=new Map;e=uv({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const x=!y,S=av(f);S.aliasOf=y&&y.record;const A=uv(e,f),j=[S];if("alias"in f){const q=typeof f.alias=="string"?[f.alias]:f.alias;for(const X of q)j.push(av(pt({},S,{components:y?y.record.components:S.components,path:X,aliasOf:y?y.record:S})))}let F,P;for(const q of j){const{path:X}=q;if(g&&X[0]!=="/"){const ue=g.record.path,E=ue[ue.length-1]==="/"?"":"/";q.path=g.record.path+(X&&E+X)}if(F=GA(q,g,A),y?y.alias.push(F):(P=P||F,P!==F&&P.alias.push(F),x&&f.name&&!lv(F)&&o(f.name)),D0(F)&&l(F),S.children){const ue=S.children;for(let E=0;E<ue.length;E++)i(ue[E],F,y&&y.children[E])}y=y||F}return P?()=>{o(P)}:Jl}function o(f){if(R0(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=QA(f,t);t.splice(g,0,f),f.record.name&&!lv(f)&&r.set(f.record.name,f)}function c(f,g){let y,x={},S,A;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Ea(1,{location:f});A=y.record.name,x=pt(ov(g.params,y.keys.filter(P=>!P.optional).concat(y.parent?y.parent.keys.filter(P=>P.optional):[]).map(P=>P.name)),f.params&&ov(f.params,y.keys.map(P=>P.name))),S=y.stringify(x)}else if(f.path!=null)S=f.path,y=t.find(P=>P.re.test(S)),y&&(x=y.parse(S),A=y.record.name);else{if(y=g.name?r.get(g.name):t.find(P=>P.re.test(g.path)),!y)throw Ea(1,{location:f,currentLocation:g});A=y.record.name,x=pt({},g.params,f.params),S=y.stringify(x)}const j=[];let F=y;for(;F;)j.unshift(F.record),F=F.parent;return{name:A,path:S,params:x,matched:j,meta:WA(j)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function ov(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function av(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:HA(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function HA(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function lv(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function WA(n){return n.reduce((e,t)=>pt(e,t.meta),{})}function uv(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function QA(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;k0(n,e[i])<0?r=i:t=i+1}const s=JA(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function JA(n){let e=n;for(;e=e.parent;)if(D0(e)&&k0(n,e)===0)return e}function D0({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function YA(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(E0," "),o=i.indexOf("="),a=uu(o<0?i:i.slice(0,o)),l=o<0?null:uu(i.slice(o+1));if(a in e){let c=e[a];Mr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function cv(n){let e="";for(let t in n){const r=n[t];if(t=vA(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Mr(r)?r.map(i=>i&&Mf(i)):[r&&Mf(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function XA(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Mr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const ZA=Symbol(""),dv=Symbol(""),Jd=Symbol(""),Lp=Symbol(""),Ff=Symbol("");function Al(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function ti(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(Ea(4,{from:t,to:e})):g instanceof Error?l(g):LA(g)?l(Ea(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function rf(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(w0(l)){const d=(l.__vccOpts||l)[e];d&&i.push(ti(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=oA(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&ti(y,t,r,o,a,s)()}))}}return i}function hv(n){const e=Or(Jd),t=Or(Lp),r=ze(()=>{const l=Is(n.to);return e.resolve(l)}),s=ze(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(Ia.bind(null,d));if(g>-1)return g;const y=fv(l[c-2]);return c>1&&fv(d)===y&&f[f.length-1].path!==y?f.findIndex(Ia.bind(null,l[c-2])):g}),i=ze(()=>s.value>-1&&sS(t.params,r.value.params)),o=ze(()=>s.value>-1&&s.value===t.matched.length-1&&S0(t.params,r.value.params));function a(l={}){if(rS(l)){const c=e[Is(n.replace)?"replace":"push"](Is(n.to)).catch(Jl);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:ze(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function eS(n){return n.length===1?n[0]:n}const tS=H_({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:hv,setup(n,{slots:e}){const t=qd(hv(n)),{options:r}=Or(Jd),s=ze(()=>({[pv(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[pv(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&eS(e.default(t));return n.custom?i:v0("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),nS=tS;function rS(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function sS(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Mr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function fv(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const pv=(n,e,t)=>n??e??t,iS=H_({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Or(Ff),s=ze(()=>n.route||r.value),i=Or(dv,0),o=ze(()=>{let c=Is(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=ze(()=>s.value.matched[o.value]);$c(dv,ze(()=>o.value+1)),$c(ZA,a),$c(Ff,s);const l=N();return Ot(()=>[l.value,a.value,n.name],([c,d,f],[g,y,x])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!Ia(d,y)||!g)&&(d.enterCallbacks[f]||[]).forEach(S=>S(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return mv(t.default,{Component:g,route:c});const y=f.props[d],x=y?y===!0?c.params:typeof y=="function"?y(c):y:null,A=v0(g,pt({},x,e,{onVnodeUnmounted:j=>{j.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return mv(t.default,{Component:A,route:c})||A}}});function mv(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const oS=iS;function aS(n){const e=KA(n.routes,n),t=n.parseQuery||YA,r=n.stringifyQuery||cv,s=n.history,i=Al(),o=Al(),a=Al(),l=mT(Qs);let c=Qs;na&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=tf.bind(null,K=>""+K),f=tf.bind(null,_A),g=tf.bind(null,uu);function y(K,be){let de,Ae;return R0(K)?(de=e.getRecordMatcher(K),Ae=be):Ae=K,e.addRoute(Ae,de)}function x(K){const be=e.getRecordMatcher(K);be&&e.removeRoute(be)}function S(){return e.getRoutes().map(K=>K.record)}function A(K){return!!e.getRecordMatcher(K)}function j(K,be){if(be=pt({},be||l.value),typeof K=="string"){const C=nf(t,K,be.path),O=e.resolve({path:C.path},be),Z=s.createHref(C.fullPath);return pt(C,O,{params:g(O.params),hash:uu(C.hash),redirectedFrom:void 0,href:Z})}let de;if(K.path!=null)de=pt({},K,{path:nf(t,K.path,be.path).path});else{const C=pt({},K.params);for(const O in C)C[O]==null&&delete C[O];de=pt({},K,{params:f(C)}),be.params=f(be.params)}const Ae=e.resolve(de,be),He=K.hash||"";Ae.params=d(g(Ae.params));const lt=IA(r,pt({},K,{hash:gA(He),path:Ae.path})),T=s.createHref(lt);return pt({fullPath:lt,hash:He,query:r===cv?XA(K.query):K.query||{}},Ae,{redirectedFrom:void 0,href:T})}function F(K){return typeof K=="string"?nf(t,K,l.value.path):pt({},K)}function P(K,be){if(c!==K)return Ea(8,{from:be,to:K})}function q(K){return E(K)}function X(K){return q(pt(F(K),{replace:!0}))}function ue(K){const be=K.matched[K.matched.length-1];if(be&&be.redirect){const{redirect:de}=be;let Ae=typeof de=="function"?de(K):de;return typeof Ae=="string"&&(Ae=Ae.includes("?")||Ae.includes("#")?Ae=F(Ae):{path:Ae},Ae.params={}),pt({query:K.query,hash:K.hash,params:Ae.path!=null?{}:K.params},Ae)}}function E(K,be){const de=c=j(K),Ae=l.value,He=K.state,lt=K.force,T=K.replace===!0,C=ue(de);if(C)return E(pt(F(C),{state:typeof C=="object"?pt({},He,C.state):He,force:lt,replace:T}),be||de);const O=de;O.redirectedFrom=be;let Z;return!lt&&EA(r,Ae,de)&&(Z=Ea(16,{to:O,from:Ae}),Ve(Ae,Ae,!0,!1)),(Z?Promise.resolve(Z):k(O,Ae)).catch(J=>fs(J)?fs(J,2)?J:te(J):Ue(J,O,Ae)).then(J=>{if(J){if(fs(J,2))return E(pt({replace:T},F(J.to),{state:typeof J.to=="object"?pt({},He,J.to.state):He,force:lt}),be||O)}else J=$(O,Ae,!0,T,He);return D(O,Ae,J),J})}function w(K,be){const de=P(K,be);return de?Promise.reject(de):Promise.resolve()}function I(K){const be=Ne.values().next().value;return be&&typeof be.runWithContext=="function"?be.runWithContext(K):K()}function k(K,be){let de;const[Ae,He,lt]=lS(K,be);de=rf(Ae.reverse(),"beforeRouteLeave",K,be);for(const C of Ae)C.leaveGuards.forEach(O=>{de.push(ti(O,K,be))});const T=w.bind(null,K,be);return de.push(T),Ze(de).then(()=>{de=[];for(const C of i.list())de.push(ti(C,K,be));return de.push(T),Ze(de)}).then(()=>{de=rf(He,"beforeRouteUpdate",K,be);for(const C of He)C.updateGuards.forEach(O=>{de.push(ti(O,K,be))});return de.push(T),Ze(de)}).then(()=>{de=[];for(const C of lt)if(C.beforeEnter)if(Mr(C.beforeEnter))for(const O of C.beforeEnter)de.push(ti(O,K,be));else de.push(ti(C.beforeEnter,K,be));return de.push(T),Ze(de)}).then(()=>(K.matched.forEach(C=>C.enterCallbacks={}),de=rf(lt,"beforeRouteEnter",K,be,I),de.push(T),Ze(de))).then(()=>{de=[];for(const C of o.list())de.push(ti(C,K,be));return de.push(T),Ze(de)}).catch(C=>fs(C,8)?C:Promise.reject(C))}function D(K,be,de){a.list().forEach(Ae=>I(()=>Ae(K,be,de)))}function $(K,be,de,Ae,He){const lt=P(K,be);if(lt)return lt;const T=be===Qs,C=na?history.state:{};de&&(Ae||T?s.replace(K.fullPath,pt({scroll:T&&C&&C.scroll},He)):s.push(K.fullPath,He)),l.value=K,Ve(K,be,de,T),te()}let R;function Dt(){R||(R=s.listen((K,be,de)=>{if(!Je.listening)return;const Ae=j(K),He=ue(Ae);if(He){E(pt(He,{replace:!0,force:!0}),Ae).catch(Jl);return}c=Ae;const lt=l.value;na&&kA(tv(lt.fullPath,de.delta),Qd()),k(Ae,lt).catch(T=>fs(T,12)?T:fs(T,2)?(E(pt(F(T.to),{force:!0}),Ae).then(C=>{fs(C,20)&&!de.delta&&de.type===cu.pop&&s.go(-1,!1)}).catch(Jl),Promise.reject()):(de.delta&&s.go(-de.delta,!1),Ue(T,Ae,lt))).then(T=>{T=T||$(Ae,lt,!1),T&&(de.delta&&!fs(T,8)?s.go(-de.delta,!1):de.type===cu.pop&&fs(T,20)&&s.go(-1,!1)),D(Ae,lt,T)}).catch(Jl)}))}let xt=Al(),tt=Al(),$e;function Ue(K,be,de){te(K);const Ae=tt.list();return Ae.length?Ae.forEach(He=>He(K,be,de)):console.error(K),Promise.reject(K)}function De(){return $e&&l.value!==Qs?Promise.resolve():new Promise((K,be)=>{xt.add([K,be])})}function te(K){return $e||($e=!K,Dt(),xt.list().forEach(([be,de])=>K?de(K):be()),xt.reset()),K}function Ve(K,be,de,Ae){const{scrollBehavior:He}=n;if(!na||!He)return Promise.resolve();const lt=!de&&DA(tv(K.fullPath,0))||(Ae||!de)&&history.state&&history.state.scroll||null;return hn().then(()=>He(K,be,lt)).then(T=>T&&CA(T)).catch(T=>Ue(T,K,be))}const W=K=>s.go(K);let Y;const Ne=new Set,Je={currentRoute:l,listening:!0,addRoute:y,removeRoute:x,clearRoutes:e.clearRoutes,hasRoute:A,getRoutes:S,resolve:j,options:n,push:q,replace:X,go:W,back:()=>W(-1),forward:()=>W(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:tt.add,isReady:De,install(K){const be=this;K.component("RouterLink",nS),K.component("RouterView",oS),K.config.globalProperties.$router=be,Object.defineProperty(K.config.globalProperties,"$route",{enumerable:!0,get:()=>Is(l)}),na&&!Y&&l.value===Qs&&(Y=!0,q(s.location).catch(He=>{}));const de={};for(const He in Qs)Object.defineProperty(de,He,{get:()=>l.value[He],enumerable:!0});K.provide(Jd,be),K.provide(Lp,O_(de)),K.provide(Ff,l);const Ae=K.unmount;Ne.add(K),K.unmount=function(){Ne.delete(K),Ne.size<1&&(c=Qs,R&&R(),R=null,l.value=Qs,Y=!1,$e=!1),Ae()}}};function Ze(K){return K.reduce((be,de)=>be.then(()=>I(de)),Promise.resolve())}return Je}function lS(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Ia(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Ia(c,l))||s.push(l))}return[t,r,s]}function Vu(){return Or(Jd)}function Ba(n){return Or(Lp)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},uS=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},N0={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[d],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(V0(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):uS(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new cS;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const x=c<<6&192|f;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class cS extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const dS=function(n){const e=V0(n);return N0.encodeByteArray(e,!0)},fd=function(n){return dS(n).replace(/\./g,"")},O0=function(n){try{return N0.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fS=()=>hS().__FIREBASE_DEFAULTS__,pS=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},mS=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&O0(n[1]);return e&&JSON.parse(e)},Yd=()=>{try{return fS()||pS()||mS()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},M0=n=>{var e,t;return(t=(e=Yd())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},gS=n=>{const e=M0(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},L0=()=>{var n;return(n=Yd())===null||n===void 0?void 0:n.config},F0=n=>{var e;return(e=Yd())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yS(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[fd(JSON.stringify(t)),fd(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _S(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(mn())}function bS(){var n;const e=(n=Yd())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wS(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function IS(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ES(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function TS(){const n=mn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function $0(){return!bS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U0(){try{return typeof indexedDB=="object"}catch{return!1}}function xS(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AS="FirebaseError";class Vs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=AS,Object.setPrototypeOf(this,Vs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nu.prototype.create)}}class Nu{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?SS(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Vs(s,a,r)}}function SS(n,e){return n.replace(PS,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const PS=/\{\$([^}]+)}/g;function RS(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function _i(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(gv(i)&&gv(o)){if(!_i(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function gv(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qa(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ol(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ml(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function CS(n,e){const t=new kS(n,e);return t.subscribe.bind(t)}class kS{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");DS(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=sf),s.error===void 0&&(s.error=sf),s.complete===void 0&&(s.complete=sf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function DS(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function sf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ke(n){return n&&n._delegate?n._delegate:n}class po{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VS{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new vS;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(OS(e))try{this.getOrInitializeService({instanceIdentifier:Zi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Zi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Zi){return this.instances.has(e)}getOptions(e=Zi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:NS(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Zi){return this.component?this.component.multipleInstances?e:Zi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function NS(n){return n===Zi?void 0:n}function OS(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new VS(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(nt||(nt={}));const LS={debug:nt.DEBUG,verbose:nt.VERBOSE,info:nt.INFO,warn:nt.WARN,error:nt.ERROR,silent:nt.SILENT},FS=nt.INFO,$S={[nt.DEBUG]:"log",[nt.VERBOSE]:"log",[nt.INFO]:"info",[nt.WARN]:"warn",[nt.ERROR]:"error"},US=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=$S[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Fp{constructor(e){this.name=e,this._logLevel=FS,this._logHandler=US,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in nt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?LS[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,nt.DEBUG,...e),this._logHandler(this,nt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,nt.VERBOSE,...e),this._logHandler(this,nt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,nt.INFO,...e),this._logHandler(this,nt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,nt.WARN,...e),this._logHandler(this,nt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,nt.ERROR,...e),this._logHandler(this,nt.ERROR,...e)}}const jS=(n,e)=>e.some(t=>n instanceof t);let vv,yv;function BS(){return vv||(vv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qS(){return yv||(yv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const j0=new WeakMap,$f=new WeakMap,B0=new WeakMap,of=new WeakMap,$p=new WeakMap;function zS(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(di(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&j0.set(t,n)}).catch(()=>{}),$p.set(e,n),e}function GS(n){if($f.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});$f.set(n,e)}let Uf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return $f.get(n);if(e==="objectStoreNames")return n.objectStoreNames||B0.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return di(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function KS(n){Uf=n(Uf)}function HS(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(af(this),e,...t);return B0.set(r,e.sort?e.sort():[e]),di(r)}:qS().includes(n)?function(...e){return n.apply(af(this),e),di(j0.get(this))}:function(...e){return di(n.apply(af(this),e))}}function WS(n){return typeof n=="function"?HS(n):(n instanceof IDBTransaction&&GS(n),jS(n,BS())?new Proxy(n,Uf):n)}function di(n){if(n instanceof IDBRequest)return zS(n);if(of.has(n))return of.get(n);const e=WS(n);return e!==n&&(of.set(n,e),$p.set(e,n)),e}const af=n=>$p.get(n);function QS(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=di(o);return r&&o.addEventListener("upgradeneeded",l=>{r(di(o.result),l.oldVersion,l.newVersion,di(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const JS=["get","getKey","getAll","getAllKeys","count"],YS=["put","add","delete","clear"],lf=new Map;function _v(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(lf.get(e))return lf.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=YS.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||JS.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return lf.set(e,i),i}KS(n=>({...n,get:(e,t,r)=>_v(e,t)||n.get(e,t,r),has:(e,t)=>!!_v(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ZS(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function ZS(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const jf="@firebase/app",bv="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const As=new Fp("@firebase/app"),eP="@firebase/app-compat",tP="@firebase/analytics-compat",nP="@firebase/analytics",rP="@firebase/app-check-compat",sP="@firebase/app-check",iP="@firebase/auth",oP="@firebase/auth-compat",aP="@firebase/database",lP="@firebase/data-connect",uP="@firebase/database-compat",cP="@firebase/functions",dP="@firebase/functions-compat",hP="@firebase/installations",fP="@firebase/installations-compat",pP="@firebase/messaging",mP="@firebase/messaging-compat",gP="@firebase/performance",vP="@firebase/performance-compat",yP="@firebase/remote-config",_P="@firebase/remote-config-compat",bP="@firebase/storage",wP="@firebase/storage-compat",IP="@firebase/firestore",EP="@firebase/vertexai-preview",TP="@firebase/firestore-compat",xP="firebase",AP="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd="[DEFAULT]",SP={[jf]:"fire-core",[eP]:"fire-core-compat",[nP]:"fire-analytics",[tP]:"fire-analytics-compat",[sP]:"fire-app-check",[rP]:"fire-app-check-compat",[iP]:"fire-auth",[oP]:"fire-auth-compat",[aP]:"fire-rtdb",[lP]:"fire-data-connect",[uP]:"fire-rtdb-compat",[cP]:"fire-fn",[dP]:"fire-fn-compat",[hP]:"fire-iid",[fP]:"fire-iid-compat",[pP]:"fire-fcm",[mP]:"fire-fcm-compat",[gP]:"fire-perf",[vP]:"fire-perf-compat",[yP]:"fire-rc",[_P]:"fire-rc-compat",[bP]:"fire-gcs",[wP]:"fire-gcs-compat",[IP]:"fire-fst",[TP]:"fire-fst-compat",[EP]:"fire-vertex","fire-js":"fire-js",[xP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const md=new Map,PP=new Map,Bf=new Map;function wv(n,e){try{n.container.addComponent(e)}catch(t){As.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ta(n){const e=n.name;if(Bf.has(e))return As.debug(`There were multiple attempts to register component ${e}.`),!1;Bf.set(e,n);for(const t of md.values())wv(t,n);for(const t of PP.values())wv(t,n);return!0}function Ou(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function RP(n,e,t=pd){Ou(n,e).clearInstance(t)}function Zt(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hi=new Nu("app","Firebase",CP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kP{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new po("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const za=AP;function q0(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:pd,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw hi.create("bad-app-name",{appName:String(s)});if(t||(t=L0()),!t)throw hi.create("no-options");const i=md.get(s);if(i){if(_i(t,i.options)&&_i(r,i.config))return i;throw hi.create("duplicate-app",{appName:s})}const o=new MS(s);for(const l of Bf.values())o.addComponent(l);const a=new kP(t,r,o);return md.set(s,a),a}function z0(n=pd){const e=md.get(n);if(!e&&n===pd&&L0())return q0();if(!e)throw hi.create("no-app",{appName:n});return e}function fi(n,e,t){var r;let s=(r=SP[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),As.warn(a.join(" "));return}Ta(new po(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DP="firebase-heartbeat-database",VP=1,du="firebase-heartbeat-store";let uf=null;function G0(){return uf||(uf=QS(DP,VP,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(du)}catch(t){console.warn(t)}}}}).catch(n=>{throw hi.create("idb-open",{originalErrorMessage:n.message})})),uf}async function NP(n){try{const t=(await G0()).transaction(du),r=await t.objectStore(du).get(K0(n));return await t.done,r}catch(e){if(e instanceof Vs)As.warn(e.message);else{const t=hi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});As.warn(t.message)}}}async function Iv(n,e){try{const r=(await G0()).transaction(du,"readwrite");await r.objectStore(du).put(e,K0(n)),await r.done}catch(t){if(t instanceof Vs)As.warn(t.message);else{const r=hi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});As.warn(r.message)}}}function K0(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OP=1024,MP=30*24*60*60*1e3;class LP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $P(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ev();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=MP}),this._storage.overwrite(this._heartbeatsCache))}catch(r){As.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ev(),{heartbeatsToSend:r,unsentEntries:s}=FP(this._heartbeatsCache.heartbeats),i=fd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return As.warn(t),""}}}function Ev(){return new Date().toISOString().substring(0,10)}function FP(n,e=OP){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Tv(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Tv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class $P{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return U0()?xS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await NP(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Iv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Iv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Tv(n){return fd(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UP(n){Ta(new po("platform-logger",e=>new XS(e),"PRIVATE")),Ta(new po("heartbeat",e=>new LP(e),"PRIVATE")),fi(jf,bv,n),fi(jf,bv,"esm2017"),fi("fire-js","")}UP("");var jP="firebase",BP="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fi(jP,BP,"app");var xv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var uo,H0;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(E,w){function I(){}I.prototype=w.prototype,E.D=w.prototype,E.prototype=new I,E.prototype.constructor=E,E.C=function(k,D,$){for(var R=Array(arguments.length-2),Dt=2;Dt<arguments.length;Dt++)R[Dt-2]=arguments[Dt];return w.prototype[D].apply(k,R)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,w,I){I||(I=0);var k=Array(16);if(typeof w=="string")for(var D=0;16>D;++D)k[D]=w.charCodeAt(I++)|w.charCodeAt(I++)<<8|w.charCodeAt(I++)<<16|w.charCodeAt(I++)<<24;else for(D=0;16>D;++D)k[D]=w[I++]|w[I++]<<8|w[I++]<<16|w[I++]<<24;w=E.g[0],I=E.g[1],D=E.g[2];var $=E.g[3],R=w+($^I&(D^$))+k[0]+3614090360&4294967295;w=I+(R<<7&4294967295|R>>>25),R=$+(D^w&(I^D))+k[1]+3905402710&4294967295,$=w+(R<<12&4294967295|R>>>20),R=D+(I^$&(w^I))+k[2]+606105819&4294967295,D=$+(R<<17&4294967295|R>>>15),R=I+(w^D&($^w))+k[3]+3250441966&4294967295,I=D+(R<<22&4294967295|R>>>10),R=w+($^I&(D^$))+k[4]+4118548399&4294967295,w=I+(R<<7&4294967295|R>>>25),R=$+(D^w&(I^D))+k[5]+1200080426&4294967295,$=w+(R<<12&4294967295|R>>>20),R=D+(I^$&(w^I))+k[6]+2821735955&4294967295,D=$+(R<<17&4294967295|R>>>15),R=I+(w^D&($^w))+k[7]+4249261313&4294967295,I=D+(R<<22&4294967295|R>>>10),R=w+($^I&(D^$))+k[8]+1770035416&4294967295,w=I+(R<<7&4294967295|R>>>25),R=$+(D^w&(I^D))+k[9]+2336552879&4294967295,$=w+(R<<12&4294967295|R>>>20),R=D+(I^$&(w^I))+k[10]+4294925233&4294967295,D=$+(R<<17&4294967295|R>>>15),R=I+(w^D&($^w))+k[11]+2304563134&4294967295,I=D+(R<<22&4294967295|R>>>10),R=w+($^I&(D^$))+k[12]+1804603682&4294967295,w=I+(R<<7&4294967295|R>>>25),R=$+(D^w&(I^D))+k[13]+4254626195&4294967295,$=w+(R<<12&4294967295|R>>>20),R=D+(I^$&(w^I))+k[14]+2792965006&4294967295,D=$+(R<<17&4294967295|R>>>15),R=I+(w^D&($^w))+k[15]+1236535329&4294967295,I=D+(R<<22&4294967295|R>>>10),R=w+(D^$&(I^D))+k[1]+4129170786&4294967295,w=I+(R<<5&4294967295|R>>>27),R=$+(I^D&(w^I))+k[6]+3225465664&4294967295,$=w+(R<<9&4294967295|R>>>23),R=D+(w^I&($^w))+k[11]+643717713&4294967295,D=$+(R<<14&4294967295|R>>>18),R=I+($^w&(D^$))+k[0]+3921069994&4294967295,I=D+(R<<20&4294967295|R>>>12),R=w+(D^$&(I^D))+k[5]+3593408605&4294967295,w=I+(R<<5&4294967295|R>>>27),R=$+(I^D&(w^I))+k[10]+38016083&4294967295,$=w+(R<<9&4294967295|R>>>23),R=D+(w^I&($^w))+k[15]+3634488961&4294967295,D=$+(R<<14&4294967295|R>>>18),R=I+($^w&(D^$))+k[4]+3889429448&4294967295,I=D+(R<<20&4294967295|R>>>12),R=w+(D^$&(I^D))+k[9]+568446438&4294967295,w=I+(R<<5&4294967295|R>>>27),R=$+(I^D&(w^I))+k[14]+3275163606&4294967295,$=w+(R<<9&4294967295|R>>>23),R=D+(w^I&($^w))+k[3]+4107603335&4294967295,D=$+(R<<14&4294967295|R>>>18),R=I+($^w&(D^$))+k[8]+1163531501&4294967295,I=D+(R<<20&4294967295|R>>>12),R=w+(D^$&(I^D))+k[13]+2850285829&4294967295,w=I+(R<<5&4294967295|R>>>27),R=$+(I^D&(w^I))+k[2]+4243563512&4294967295,$=w+(R<<9&4294967295|R>>>23),R=D+(w^I&($^w))+k[7]+1735328473&4294967295,D=$+(R<<14&4294967295|R>>>18),R=I+($^w&(D^$))+k[12]+2368359562&4294967295,I=D+(R<<20&4294967295|R>>>12),R=w+(I^D^$)+k[5]+4294588738&4294967295,w=I+(R<<4&4294967295|R>>>28),R=$+(w^I^D)+k[8]+2272392833&4294967295,$=w+(R<<11&4294967295|R>>>21),R=D+($^w^I)+k[11]+1839030562&4294967295,D=$+(R<<16&4294967295|R>>>16),R=I+(D^$^w)+k[14]+4259657740&4294967295,I=D+(R<<23&4294967295|R>>>9),R=w+(I^D^$)+k[1]+2763975236&4294967295,w=I+(R<<4&4294967295|R>>>28),R=$+(w^I^D)+k[4]+1272893353&4294967295,$=w+(R<<11&4294967295|R>>>21),R=D+($^w^I)+k[7]+4139469664&4294967295,D=$+(R<<16&4294967295|R>>>16),R=I+(D^$^w)+k[10]+3200236656&4294967295,I=D+(R<<23&4294967295|R>>>9),R=w+(I^D^$)+k[13]+681279174&4294967295,w=I+(R<<4&4294967295|R>>>28),R=$+(w^I^D)+k[0]+3936430074&4294967295,$=w+(R<<11&4294967295|R>>>21),R=D+($^w^I)+k[3]+3572445317&4294967295,D=$+(R<<16&4294967295|R>>>16),R=I+(D^$^w)+k[6]+76029189&4294967295,I=D+(R<<23&4294967295|R>>>9),R=w+(I^D^$)+k[9]+3654602809&4294967295,w=I+(R<<4&4294967295|R>>>28),R=$+(w^I^D)+k[12]+3873151461&4294967295,$=w+(R<<11&4294967295|R>>>21),R=D+($^w^I)+k[15]+530742520&4294967295,D=$+(R<<16&4294967295|R>>>16),R=I+(D^$^w)+k[2]+3299628645&4294967295,I=D+(R<<23&4294967295|R>>>9),R=w+(D^(I|~$))+k[0]+4096336452&4294967295,w=I+(R<<6&4294967295|R>>>26),R=$+(I^(w|~D))+k[7]+1126891415&4294967295,$=w+(R<<10&4294967295|R>>>22),R=D+(w^($|~I))+k[14]+2878612391&4294967295,D=$+(R<<15&4294967295|R>>>17),R=I+($^(D|~w))+k[5]+4237533241&4294967295,I=D+(R<<21&4294967295|R>>>11),R=w+(D^(I|~$))+k[12]+1700485571&4294967295,w=I+(R<<6&4294967295|R>>>26),R=$+(I^(w|~D))+k[3]+2399980690&4294967295,$=w+(R<<10&4294967295|R>>>22),R=D+(w^($|~I))+k[10]+4293915773&4294967295,D=$+(R<<15&4294967295|R>>>17),R=I+($^(D|~w))+k[1]+2240044497&4294967295,I=D+(R<<21&4294967295|R>>>11),R=w+(D^(I|~$))+k[8]+1873313359&4294967295,w=I+(R<<6&4294967295|R>>>26),R=$+(I^(w|~D))+k[15]+4264355552&4294967295,$=w+(R<<10&4294967295|R>>>22),R=D+(w^($|~I))+k[6]+2734768916&4294967295,D=$+(R<<15&4294967295|R>>>17),R=I+($^(D|~w))+k[13]+1309151649&4294967295,I=D+(R<<21&4294967295|R>>>11),R=w+(D^(I|~$))+k[4]+4149444226&4294967295,w=I+(R<<6&4294967295|R>>>26),R=$+(I^(w|~D))+k[11]+3174756917&4294967295,$=w+(R<<10&4294967295|R>>>22),R=D+(w^($|~I))+k[2]+718787259&4294967295,D=$+(R<<15&4294967295|R>>>17),R=I+($^(D|~w))+k[9]+3951481745&4294967295,E.g[0]=E.g[0]+w&4294967295,E.g[1]=E.g[1]+(D+(R<<21&4294967295|R>>>11))&4294967295,E.g[2]=E.g[2]+D&4294967295,E.g[3]=E.g[3]+$&4294967295}r.prototype.u=function(E,w){w===void 0&&(w=E.length);for(var I=w-this.blockSize,k=this.B,D=this.h,$=0;$<w;){if(D==0)for(;$<=I;)s(this,E,$),$+=this.blockSize;if(typeof E=="string"){for(;$<w;)if(k[D++]=E.charCodeAt($++),D==this.blockSize){s(this,k),D=0;break}}else for(;$<w;)if(k[D++]=E[$++],D==this.blockSize){s(this,k),D=0;break}}this.h=D,this.o+=w},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var w=1;w<E.length-8;++w)E[w]=0;var I=8*this.o;for(w=E.length-8;w<E.length;++w)E[w]=I&255,I/=256;for(this.u(E),E=Array(16),w=I=0;4>w;++w)for(var k=0;32>k;k+=8)E[I++]=this.g[w]>>>k&255;return E};function i(E,w){var I=a;return Object.prototype.hasOwnProperty.call(I,E)?I[E]:I[E]=w(E)}function o(E,w){this.h=w;for(var I=[],k=!0,D=E.length-1;0<=D;D--){var $=E[D]|0;k&&$==w||(I[D]=$,k=!1)}this.g=I}var a={};function l(E){return-128<=E&&128>E?i(E,function(w){return new o([w|0],0>w?-1:0)}):new o([E|0],0>E?-1:0)}function c(E){if(isNaN(E)||!isFinite(E))return f;if(0>E)return A(c(-E));for(var w=[],I=1,k=0;E>=I;k++)w[k]=E/I|0,I*=4294967296;return new o(w,0)}function d(E,w){if(E.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(E.charAt(0)=="-")return A(d(E.substring(1),w));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=c(Math.pow(w,8)),k=f,D=0;D<E.length;D+=8){var $=Math.min(8,E.length-D),R=parseInt(E.substring(D,D+$),w);8>$?($=c(Math.pow(w,$)),k=k.j($).add(c(R))):(k=k.j(I),k=k.add(c(R)))}return k}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(S(this))return-A(this).m();for(var E=0,w=1,I=0;I<this.g.length;I++){var k=this.i(I);E+=(0<=k?k:4294967296+k)*w,w*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(x(this))return"0";if(S(this))return"-"+A(this).toString(E);for(var w=c(Math.pow(E,6)),I=this,k="";;){var D=q(I,w).g;I=j(I,D.j(w));var $=((0<I.g.length?I.g[0]:I.h)>>>0).toString(E);if(I=D,x(I))return $+k;for(;6>$.length;)$="0"+$;k=$+k}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function x(E){if(E.h!=0)return!1;for(var w=0;w<E.g.length;w++)if(E.g[w]!=0)return!1;return!0}function S(E){return E.h==-1}n.l=function(E){return E=j(this,E),S(E)?-1:x(E)?0:1};function A(E){for(var w=E.g.length,I=[],k=0;k<w;k++)I[k]=~E.g[k];return new o(I,~E.h).add(g)}n.abs=function(){return S(this)?A(this):this},n.add=function(E){for(var w=Math.max(this.g.length,E.g.length),I=[],k=0,D=0;D<=w;D++){var $=k+(this.i(D)&65535)+(E.i(D)&65535),R=($>>>16)+(this.i(D)>>>16)+(E.i(D)>>>16);k=R>>>16,$&=65535,R&=65535,I[D]=R<<16|$}return new o(I,I[I.length-1]&-2147483648?-1:0)};function j(E,w){return E.add(A(w))}n.j=function(E){if(x(this)||x(E))return f;if(S(this))return S(E)?A(this).j(A(E)):A(A(this).j(E));if(S(E))return A(this.j(A(E)));if(0>this.l(y)&&0>E.l(y))return c(this.m()*E.m());for(var w=this.g.length+E.g.length,I=[],k=0;k<2*w;k++)I[k]=0;for(k=0;k<this.g.length;k++)for(var D=0;D<E.g.length;D++){var $=this.i(k)>>>16,R=this.i(k)&65535,Dt=E.i(D)>>>16,xt=E.i(D)&65535;I[2*k+2*D]+=R*xt,F(I,2*k+2*D),I[2*k+2*D+1]+=$*xt,F(I,2*k+2*D+1),I[2*k+2*D+1]+=R*Dt,F(I,2*k+2*D+1),I[2*k+2*D+2]+=$*Dt,F(I,2*k+2*D+2)}for(k=0;k<w;k++)I[k]=I[2*k+1]<<16|I[2*k];for(k=w;k<2*w;k++)I[k]=0;return new o(I,0)};function F(E,w){for(;(E[w]&65535)!=E[w];)E[w+1]+=E[w]>>>16,E[w]&=65535,w++}function P(E,w){this.g=E,this.h=w}function q(E,w){if(x(w))throw Error("division by zero");if(x(E))return new P(f,f);if(S(E))return w=q(A(E),w),new P(A(w.g),A(w.h));if(S(w))return w=q(E,A(w)),new P(A(w.g),w.h);if(30<E.g.length){if(S(E)||S(w))throw Error("slowDivide_ only works with positive integers.");for(var I=g,k=w;0>=k.l(E);)I=X(I),k=X(k);var D=ue(I,1),$=ue(k,1);for(k=ue(k,2),I=ue(I,2);!x(k);){var R=$.add(k);0>=R.l(E)&&(D=D.add(I),$=R),k=ue(k,1),I=ue(I,1)}return w=j(E,D.j(w)),new P(D,w)}for(D=f;0<=E.l(w);){for(I=Math.max(1,Math.floor(E.m()/w.m())),k=Math.ceil(Math.log(I)/Math.LN2),k=48>=k?1:Math.pow(2,k-48),$=c(I),R=$.j(w);S(R)||0<R.l(E);)I-=k,$=c(I),R=$.j(w);x($)&&($=g),D=D.add($),E=j(E,R)}return new P(D,E)}n.A=function(E){return q(this,E).h},n.and=function(E){for(var w=Math.max(this.g.length,E.g.length),I=[],k=0;k<w;k++)I[k]=this.i(k)&E.i(k);return new o(I,this.h&E.h)},n.or=function(E){for(var w=Math.max(this.g.length,E.g.length),I=[],k=0;k<w;k++)I[k]=this.i(k)|E.i(k);return new o(I,this.h|E.h)},n.xor=function(E){for(var w=Math.max(this.g.length,E.g.length),I=[],k=0;k<w;k++)I[k]=this.i(k)^E.i(k);return new o(I,this.h^E.h)};function X(E){for(var w=E.g.length+1,I=[],k=0;k<w;k++)I[k]=E.i(k)<<1|E.i(k-1)>>>31;return new o(I,E.h)}function ue(E,w){var I=w>>5;w%=32;for(var k=E.g.length-I,D=[],$=0;$<k;$++)D[$]=0<w?E.i($+I)>>>w|E.i($+I+1)<<32-w:E.i($+I);return new o(D,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,H0=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,uo=o}).apply(typeof xv<"u"?xv:typeof self<"u"?self:typeof window<"u"?window:{});var Sc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var W0,Ll,Q0,qc,qf,J0,Y0,X0;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Sc=="object"&&Sc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var U=u[b];if(!(U in v))break e;v=v[U]}u=u[u.length-1],b=v[u],p=p(b),p!=b&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,b=!1,U={next:function(){if(!b&&v<u.length){var G=v++;return{value:p(G,u[G]),done:!1}}return b=!0,{done:!0,value:void 0}}};return U[Symbol.iterator]=function(){return U},U}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function d(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var U=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(U,b),u.apply(p,U)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var b=v.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function x(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(b,U,G){for(var me=Array(arguments.length-2),yt=2;yt<arguments.length;yt++)me[yt-2]=arguments[yt];return p.prototype[U].apply(b,me)}}function S(u){const p=u.length;if(0<p){const v=Array(p);for(let b=0;b<p;b++)v[b]=u[b];return v}return[]}function A(u,p){for(let v=1;v<arguments.length;v++){const b=arguments[v];if(l(b)){const U=u.length||0,G=b.length||0;u.length=U+G;for(let me=0;me<G;me++)u[U+me]=b[me]}else u.push(b)}}class j{constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function F(u){return/^[\s\xa0]*$/.test(u)}function P(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function q(u){return q[" "](u),u}q[" "]=function(){};var X=P().indexOf("Gecko")!=-1&&!(P().toLowerCase().indexOf("webkit")!=-1&&P().indexOf("Edge")==-1)&&!(P().indexOf("Trident")!=-1||P().indexOf("MSIE")!=-1)&&P().indexOf("Edge")==-1;function ue(u,p,v){for(const b in u)p.call(v,u[b],b,u)}function E(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function w(u){const p={};for(const v in u)p[v]=u[v];return p}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function k(u,p){let v,b;for(let U=1;U<arguments.length;U++){b=arguments[U];for(v in b)u[v]=b[v];for(let G=0;G<I.length;G++)v=I[G],Object.prototype.hasOwnProperty.call(b,v)&&(u[v]=b[v])}}function D(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function $(u){a.setTimeout(()=>{throw u},0)}function R(){var u=De;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class Dt{constructor(){this.h=this.g=null}add(p,v){const b=xt.get();b.set(p,v),this.h?this.h.next=b:this.g=b,this.h=b}}var xt=new j(()=>new tt,u=>u.reset());class tt{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let $e,Ue=!1,De=new Dt,te=()=>{const u=a.Promise.resolve(void 0);$e=()=>{u.then(Ve)}};var Ve=()=>{for(var u;u=R();){try{u.h.call(u.g)}catch(v){$(v)}var p=xt;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}Ue=!1};function W(){this.s=this.s,this.C=this.C}W.prototype.s=!1,W.prototype.ma=function(){this.s||(this.s=!0,this.N())},W.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Y(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Y.prototype.h=function(){this.defaultPrevented=!0};var Ne=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function Je(u,p){if(Y.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(X){e:{try{q(p.nodeName);var U=!0;break e}catch{}U=!1}U||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Ze[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Je.aa.h.call(this)}}x(Je,Y);var Ze={2:"touch",3:"pen",4:"mouse"};Je.prototype.h=function(){Je.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),be=0;function de(u,p,v,b,U){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!b,this.ha=U,this.key=++be,this.da=this.fa=!1}function Ae(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function He(u){this.src=u,this.g={},this.h=0}He.prototype.add=function(u,p,v,b,U){var G=u.toString();u=this.g[G],u||(u=this.g[G]=[],this.h++);var me=T(u,p,b,U);return-1<me?(p=u[me],v||(p.fa=!1)):(p=new de(p,this.src,G,!!b,U),p.fa=v,u.push(p)),p};function lt(u,p){var v=p.type;if(v in u.g){var b=u.g[v],U=Array.prototype.indexOf.call(b,p,void 0),G;(G=0<=U)&&Array.prototype.splice.call(b,U,1),G&&(Ae(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function T(u,p,v,b){for(var U=0;U<u.length;++U){var G=u[U];if(!G.da&&G.listener==p&&G.capture==!!v&&G.ha==b)return U}return-1}var C="closure_lm_"+(1e6*Math.random()|0),O={};function Z(u,p,v,b,U){if(b&&b.once)return ye(u,p,v,b,U);if(Array.isArray(p)){for(var G=0;G<p.length;G++)Z(u,p[G],v,b,U);return null}return v=Re(v),u&&u[K]?u.K(p,v,c(b)?!!b.capture:!!b,U):J(u,p,v,!1,b,U)}function J(u,p,v,b,U,G){if(!p)throw Error("Invalid event type");var me=c(U)?!!U.capture:!!U,yt=we(u);if(yt||(u[C]=yt=new He(u)),v=yt.add(p,v,b,me,G),v.proxy)return v;if(b=ee(),v.proxy=b,b.src=u,b.listener=v,u.addEventListener)Ne||(U=me),U===void 0&&(U=!1),u.addEventListener(p.toString(),b,U);else if(u.attachEvent)u.attachEvent(ie(p.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return v}function ee(){function u(v){return p.call(u.src,u.listener,v)}const p=Ee;return u}function ye(u,p,v,b,U){if(Array.isArray(p)){for(var G=0;G<p.length;G++)ye(u,p[G],v,b,U);return null}return v=Re(v),u&&u[K]?u.L(p,v,c(b)?!!b.capture:!!b,U):J(u,p,v,!0,b,U)}function he(u,p,v,b,U){if(Array.isArray(p))for(var G=0;G<p.length;G++)he(u,p[G],v,b,U);else b=c(b)?!!b.capture:!!b,v=Re(v),u&&u[K]?(u=u.i,p=String(p).toString(),p in u.g&&(G=u.g[p],v=T(G,v,b,U),-1<v&&(Ae(G[v]),Array.prototype.splice.call(G,v,1),G.length==0&&(delete u.g[p],u.h--)))):u&&(u=we(u))&&(p=u.g[p.toString()],u=-1,p&&(u=T(p,v,b,U)),(v=-1<u?p[u]:null)&&ce(v))}function ce(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[K])lt(p.i,u);else{var v=u.type,b=u.proxy;p.removeEventListener?p.removeEventListener(v,b,u.capture):p.detachEvent?p.detachEvent(ie(v),b):p.addListener&&p.removeListener&&p.removeListener(b),(v=we(p))?(lt(v,u),v.h==0&&(v.src=null,p[C]=null)):Ae(u)}}}function ie(u){return u in O?O[u]:O[u]="on"+u}function Ee(u,p){if(u.da)u=!0;else{p=new Je(p,this);var v=u.listener,b=u.ha||u.src;u.fa&&ce(u),u=v.call(b,p)}return u}function we(u){return u=u[C],u instanceof He?u:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function Re(u){return typeof u=="function"?u:(u[Te]||(u[Te]=function(p){return u.handleEvent(p)}),u[Te])}function Me(){W.call(this),this.i=new He(this),this.M=this,this.F=null}x(Me,W),Me.prototype[K]=!0,Me.prototype.removeEventListener=function(u,p,v,b){he(this,u,p,v,b)};function Be(u,p){var v,b=u.F;if(b)for(v=[];b;b=b.F)v.push(b);if(u=u.M,b=p.type||p,typeof p=="string")p=new Y(p,u);else if(p instanceof Y)p.target=p.target||u;else{var U=p;p=new Y(b,u),k(p,U)}if(U=!0,v)for(var G=v.length-1;0<=G;G--){var me=p.g=v[G];U=Xe(me,b,!0,p)&&U}if(me=p.g=u,U=Xe(me,b,!0,p)&&U,U=Xe(me,b,!1,p)&&U,v)for(G=0;G<v.length;G++)me=p.g=v[G],U=Xe(me,b,!1,p)&&U}Me.prototype.N=function(){if(Me.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],b=0;b<v.length;b++)Ae(v[b]);delete u.g[p],u.h--}}this.F=null},Me.prototype.K=function(u,p,v,b){return this.i.add(String(u),p,!1,v,b)},Me.prototype.L=function(u,p,v,b){return this.i.add(String(u),p,!0,v,b)};function Xe(u,p,v,b){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var U=!0,G=0;G<p.length;++G){var me=p[G];if(me&&!me.da&&me.capture==v){var yt=me.listener,dn=me.ha||me.src;me.fa&&lt(u.i,me),U=yt.call(dn,b)!==!1&&U}}return U&&!b.defaultPrevented}function Kt(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function $t(u){u.g=Kt(()=>{u.g=null,u.i&&(u.i=!1,$t(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class vn extends W{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:$t(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vt(u){W.call(this),this.h=u,this.g={}}x(Vt,W);var fr=[];function Lr(u){ue(u.g,function(p,v){this.g.hasOwnProperty(v)&&ce(p)},u),u.g={}}Vt.prototype.N=function(){Vt.aa.N.call(this),Lr(this)},Vt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rn=a.JSON.stringify,Rn=a.JSON.parse,Ni=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function ol(){}ol.prototype.h=null;function rc(u){return u.h||(u.h=u.i())}function sc(){}var Oi={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function al(){Y.call(this,"d")}x(al,Y);function Ar(){Y.call(this,"c")}x(Ar,Y);var Jn={},Sr=null;function Pr(){return Sr=Sr||new Me}Jn.La="serverreachability";function Rr(u){Y.call(this,Jn.La,u)}x(Rr,Y);function Us(u){const p=Pr();Be(p,new Rr(p))}Jn.STAT_EVENT="statevent";function Mi(u,p){Y.call(this,Jn.STAT_EVENT,u),this.stat=p}x(Mi,Y);function cn(u){const p=Pr();Be(p,new Mi(p,u))}Jn.Ma="timingevent";function ic(u,p){Y.call(this,Jn.Ma,u),this.size=p}x(ic,Y);function Cn(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function js(){this.g=!0}js.prototype.xa=function(){this.g=!1};function oc(u,p,v,b,U,G){u.info(function(){if(u.g)if(G)for(var me="",yt=G.split("&"),dn=0;dn<yt.length;dn++){var ot=yt[dn].split("=");if(1<ot.length){var sn=ot[0];ot=ot[1];var yn=sn.split("_");me=2<=yn.length&&yn[1]=="type"?me+(sn+"="+ot+"&"):me+(sn+"=redacted&")}}else me=null;else me=G;return"XMLHTTP REQ ("+b+") [attempt "+U+"]: "+p+`
`+v+`
`+me})}function ll(u,p,v,b,U,G,me){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+U+"]: "+p+`
`+v+`
`+G+" "+me})}function Bs(u,p,v,b){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+ko(u,v)+(b?" "+b:"")})}function qn(u,p){u.info(function(){return"TIMEOUT: "+p})}js.prototype.info=function(){};function ko(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var b=v[u];if(!(2>b.length)){var U=b[1];if(Array.isArray(U)&&!(1>U.length)){var G=U[0];if(G!="noop"&&G!="stop"&&G!="close")for(var me=1;me<U.length;me++)U[me]=""}}}}return rn(v)}catch{return p}}var zn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ul={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Do;function Fr(){}x(Fr,ol),Fr.prototype.g=function(){return new XMLHttpRequest},Fr.prototype.i=function(){return{}},Do=new Fr;function Yn(u,p,v,b){this.j=u,this.i=p,this.l=v,this.R=b||1,this.U=new Vt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Li}function Li(){this.i=null,this.g="",this.h=!1}var ns={},Vo={};function qs(u,p,v){u.L=1,u.v=Ur(vr(p)),u.m=v,u.P=!0,pr(u,null)}function pr(u,p){u.F=Date.now(),No(u),u.A=vr(u.v);var v=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),Ht(v.i,"t",b),u.C=0,v=u.j.J,u.h=new Li,u.g=bc(u.j,v?p:null,!u.m),0<u.O&&(u.M=new vn(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,b=u.ca;var U="readystatechange";Array.isArray(U)||(U&&(fr[0]=U.toString()),U=fr);for(var G=0;G<U.length;G++){var me=Z(v,U[G],b||p.handleEvent,!1,p.h||p);if(!me)break;p.g[me.key]=me}p=u.H?w(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Us(),oc(u.i,u.u,u.A,u.l,u.R,u.m)}Yn.prototype.ca=function(u){u=u.target;const p=this.M;p&&or(u)==3?p.j():this.Y(u)},Yn.prototype.Y=function(u){try{if(u==this.g)e:{const yn=or(this.g);var p=this.g.Ba();const cs=this.g.Z();if(!(3>yn)&&(yn!=3||this.g&&(this.h.h||this.g.oa()||yl(this.g)))){this.J||yn!=4||p==7||(p==8||0>=cs?Us(3):Us(2)),mr(this);var v=this.g.Z();this.X=v;t:if(ac(this)){var b=yl(this.g);u="";var U=b.length,G=or(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$r(this),rs(this);var me="";break t}this.h.i=new a.TextDecoder}for(p=0;p<U;p++)this.h.h=!0,u+=this.h.i.decode(b[p],{stream:!(G&&p==U-1)});b.length=0,this.h.g+=u,this.C=0,me=this.h.g}else me=this.g.oa();if(this.o=v==200,ll(this.i,this.u,this.A,this.l,this.R,yn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var yt,dn=this.g;if((yt=dn.g?dn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(yt)){var ot=yt;break t}}ot=null}if(v=ot)Bs(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Oo(this,v);else{this.o=!1,this.s=3,cn(12),$r(this),rs(this);break e}}if(this.P){v=!0;let ar;for(;!this.J&&this.C<me.length;)if(ar=Oh(this,me),ar==Vo){yn==4&&(this.s=4,cn(14),v=!1),Bs(this.i,this.l,null,"[Incomplete Response]");break}else if(ar==ns){this.s=4,cn(15),Bs(this.i,this.l,me,"[Invalid Chunk]"),v=!1;break}else Bs(this.i,this.l,ar,null),Oo(this,ar);if(ac(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),yn!=4||me.length!=0||this.h.h||(this.s=1,cn(16),v=!1),this.o=this.o&&v,!v)Bs(this.i,this.l,me,"[Invalid Chunked Response]"),$r(this),rs(this);else if(0<me.length&&!this.W){this.W=!0;var sn=this.j;sn.g==this&&sn.ba&&!sn.M&&(sn.j.info("Great, no buffering proxy detected. Bytes received: "+me.length),bl(sn),sn.M=!0,cn(11))}}else Bs(this.i,this.l,me,null),Oo(this,me);yn==4&&$r(this),this.o&&!this.J&&(yn==4?wl(this.j,this):(this.o=!1,No(this)))}else Uh(this.g),v==400&&0<me.indexOf("Unknown SID")?(this.s=3,cn(12)):(this.s=0,cn(13)),$r(this),rs(this)}}}catch{}finally{}};function ac(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Oh(u,p){var v=u.C,b=p.indexOf(`
`,v);return b==-1?Vo:(v=Number(p.substring(v,b)),isNaN(v)?ns:(b+=1,b+v>p.length?Vo:(p=p.slice(b,b+v),u.C=b+v,p)))}Yn.prototype.cancel=function(){this.J=!0,$r(this)};function No(u){u.S=Date.now()+u.I,cl(u,u.I)}function cl(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Cn(g(u.ba,u),p)}function mr(u){u.B&&(a.clearTimeout(u.B),u.B=null)}Yn.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(qn(this.i,this.A),this.L!=2&&(Us(),cn(17)),$r(this),this.s=2,rs(this)):cl(this,this.S-u)};function rs(u){u.j.G==0||u.J||wl(u.j,u)}function $r(u){mr(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,Lr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function Oo(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Lo(v.h,u))){if(!u.K&&Lo(v.h,u)&&v.G==3){try{var b=v.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var U=b;if(U[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)zo(v),as(v);else break e;ls(v),cn(18)}}else v.za=U[1],0<v.za-v.T&&37500>U[2]&&v.F&&v.v==0&&!v.C&&(v.C=Cn(g(v.Za,v),6e3));if(1>=hl(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else qr(v,11)}else if((u.K||v.g==u)&&zo(v),!F(p))for(U=v.Da.g.parse(p),p=0;p<U.length;p++){let ot=U[p];if(v.T=ot[0],ot=ot[1],v.G==2)if(ot[0]=="c"){v.K=ot[1],v.ia=ot[2];const sn=ot[3];sn!=null&&(v.la=sn,v.j.info("VER="+v.la));const yn=ot[4];yn!=null&&(v.Aa=yn,v.j.info("SVER="+v.Aa));const cs=ot[5];cs!=null&&typeof cs=="number"&&0<cs&&(b=1.5*cs,v.L=b,v.j.info("backChannelRequestTimeoutMs_="+b)),b=v;const ar=u.g;if(ar){const Ws=ar.g?ar.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ws){var G=b.h;G.g||Ws.indexOf("spdy")==-1&&Ws.indexOf("quic")==-1&&Ws.indexOf("h2")==-1||(G.j=G.l,G.g=new Set,G.h&&(zs(G,G.h),G.h=null))}if(b.D){const Ko=ar.g?ar.g.getResponseHeader("X-HTTP-Session-Id"):null;Ko&&(b.ya=Ko,It(b.I,b.D,Ko))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),b=v;var me=u;if(b.qa=_c(b,b.J?b.ia:null,b.W),me.K){Fi(b.h,me);var yt=me,dn=b.L;dn&&(yt.I=dn),yt.B&&(mr(yt),No(yt)),b.g=me}else mc(b);0<v.i.length&&qo(v)}else ot[0]!="stop"&&ot[0]!="close"||qr(v,7);else v.G==3&&(ot[0]=="stop"||ot[0]=="close"?ot[0]=="stop"?qr(v,7):Gi(v):ot[0]!="noop"&&v.l&&v.l.ta(ot),v.v=0)}}Us(4)}catch{}}var dl=class{constructor(u,p){this.g=u,this.map=p}};function lc(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mo(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function hl(u){return u.h?1:u.g?u.g.size:0}function Lo(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function zs(u,p){u.g?u.g.add(p):u.h=p}function Fi(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}lc.prototype.cancel=function(){if(this.i=$i(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function $i(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return S(u.i)}function fl(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,b=0;b<v;b++)p.push(u[b]);return p}p=[],v=0;for(b in u)p[v++]=u[b];return p}function Oe(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const b in u)p[v++]=b;return p}}}function ut(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=Oe(u),b=fl(u),U=b.length,G=0;G<U;G++)p.call(void 0,b[G],v&&v[G],u)}var gr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ui(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var b=u[v].indexOf("="),U=null;if(0<=b){var G=u[v].substring(0,b);U=u[v].substring(b+1)}else G=u[v];p(G,U?decodeURIComponent(U.replace(/\+/g," ")):"")}}}function ss(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof ss){this.h=u.h,Fo(this,u.j),this.o=u.o,this.g=u.g,$o(this,u.s),this.l=u.l;var p=u.i,v=new Bi;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),Uo(this,v),this.m=u.m}else u&&(p=String(u).match(gr))?(this.h=!1,Fo(this,p[1]||"",!0),this.o=jr(p[2]||""),this.g=jr(p[3]||"",!0),$o(this,p[4]),this.l=jr(p[5]||"",!0),Uo(this,p[6]||"",!0),this.m=jr(p[7]||"")):(this.h=!1,this.i=new Bi(null,this.h))}ss.prototype.toString=function(){var u=[],p=this.j;p&&u.push(yr(p,Ks,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(yr(p,Ks,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(yr(v,v.charAt(0)=="/"?jo:ji,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",yr(v,Lh)),u.join("")};function vr(u){return new ss(u)}function Fo(u,p,v){u.j=v?jr(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function $o(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Uo(u,p,v){p instanceof Bi?(u.i=p,Fh(u.i,u.h)):(v||(p=yr(p,Mh)),u.i=new Bi(p,u.h))}function It(u,p,v){u.i.set(p,v)}function Ur(u){return It(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function jr(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function yr(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,Gs),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Gs(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Ks=/[#\/\?@]/g,ji=/[#\?:]/g,jo=/[#\?]/g,Mh=/[#\?@]/g,Lh=/#/g;function Bi(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Cr(u){u.g||(u.g=new Map,u.h=0,u.i&&Ui(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=Bi.prototype,n.add=function(u,p){Cr(this),this.i=null,u=ct(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function qe(u,p){Cr(u),p=ct(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Ye(u,p){return Cr(u),p=ct(u,p),u.g.has(p)}n.forEach=function(u,p){Cr(this),this.g.forEach(function(v,b){v.forEach(function(U){u.call(p,U,b,this)},this)},this)},n.na=function(){Cr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let b=0;b<p.length;b++){const U=u[b];for(let G=0;G<U.length;G++)v.push(p[b])}return v},n.V=function(u){Cr(this);let p=[];if(typeof u=="string")Ye(this,u)&&(p=p.concat(this.g.get(ct(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return Cr(this),this.i=null,u=ct(this,u),Ye(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Ht(u,p,v){qe(u,p),0<v.length&&(u.i=null,u.g.set(ct(u,p),S(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var b=p[v];const G=encodeURIComponent(String(b)),me=this.V(b);for(b=0;b<me.length;b++){var U=G;me[b]!==""&&(U+="="+encodeURIComponent(String(me[b]))),u.push(U)}}return this.i=u.join("&")};function ct(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function Fh(u,p){p&&!u.j&&(Cr(u),u.i=null,u.g.forEach(function(v,b){var U=b.toLowerCase();b!=U&&(qe(this,b),Ht(this,U,v))},u)),u.j=p}function pl(u,p){const v=new js;if(a.Image){const b=new Image;b.onload=y(Xn,v,"TestLoadImage: loaded",!0,p,b),b.onerror=y(Xn,v,"TestLoadImage: error",!1,p,b),b.onabort=y(Xn,v,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(Xn,v,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else p(!1)}function uc(u,p){const v=new js,b=new AbortController,U=setTimeout(()=>{b.abort(),Xn(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:b.signal}).then(G=>{clearTimeout(U),G.ok?Xn(v,"TestPingServer: ok",!0,p):Xn(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(U),Xn(v,"TestPingServer: error",!1,p)})}function Xn(u,p,v,b,U){try{U&&(U.onload=null,U.onerror=null,U.onabort=null,U.ontimeout=null),b(v)}catch{}}function ml(){this.g=new Ni}function $h(u,p,v){const b=v||"";try{ut(u,function(U,G){let me=U;c(U)&&(me=rn(U)),p.push(b+G+"="+encodeURIComponent(me))})}catch(U){throw p.push(b+"type="+encodeURIComponent("_badmap")),U}}function kr(u){this.l=u.Ub||null,this.j=u.eb||!1}x(kr,ol),kr.prototype.g=function(){return new kn(this.l,this.j)},kr.prototype.i=function(u){return function(){return u}}({});function kn(u,p){Me.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(kn,Me),n=kn.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,is(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Br(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,is(this)),this.g&&(this.readyState=3,is(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function cc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?Br(this):is(this),this.readyState==3&&cc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Br(this))},n.Qa=function(u){this.g&&(this.response=u,Br(this))},n.ga=function(){this.g&&Br(this)};function Br(u){u.readyState=4,u.l=null,u.j=null,u.v=null,is(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function is(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(kn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function _r(u){let p="";return ue(u,function(v,b){p+=b,p+=":",p+=v,p+=`\r
`}),p}function gl(u,p,v){e:{for(b in v){var b=!1;break e}b=!0}b||(v=_r(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):It(u,p,v))}function Ut(u){Me.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Ut,Me);var dc=/^https?$/i,vl=["POST","PUT"];n=Ut.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Do.g(),this.v=this.o?rc(this.o):rc(Do),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(G){hc(this,G);return}if(u=v||"",v=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var U in b)v.set(U,b[U]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const G of b.keys())v.set(G,b.get(G));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(v.keys()).find(G=>G.toLowerCase()=="content-type"),U=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(vl,p,void 0))||b||U||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[G,me]of v)this.g.setRequestHeader(G,me);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qi(this),this.u=!0,this.g.send(u),this.u=!1}catch(G){hc(this,G)}};function hc(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,Bo(u),Hs(u)}function Bo(u){u.A||(u.A=!0,Be(u,"complete"),Be(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,Be(this,"complete"),Be(this,"abort"),Hs(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Hs(this,!0)),Ut.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?os(this):this.bb())},n.bb=function(){os(this)};function os(u){if(u.h&&typeof o<"u"&&(!u.v[1]||or(u)!=4||u.Z()!=2)){if(u.u&&or(u)==4)Kt(u.Ea,0,u);else if(Be(u,"readystatechange"),or(u)==4){u.h=!1;try{const me=u.Z();e:switch(me){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var b;if(b=me===0){var U=String(u.D).match(gr)[1]||null;!U&&a.self&&a.self.location&&(U=a.self.location.protocol.slice(0,-1)),b=!dc.test(U?U.toLowerCase():"")}v=b}if(v)Be(u,"complete"),Be(u,"success");else{u.m=6;try{var G=2<or(u)?u.g.statusText:""}catch{G=""}u.l=G+" ["+u.Z()+"]",Bo(u)}}finally{Hs(u)}}}}function Hs(u,p){if(u.g){qi(u);const v=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||Be(u,"ready");try{v.onreadystatechange=b}catch{}}}function qi(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function or(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<or(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),Rn(p)}};function yl(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function Uh(u){const p={};u=(u.g&&2<=or(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(F(u[b]))continue;var v=D(u[b]);const U=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const G=p[U]||[];p[U]=G,G.push(v)}E(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function zi(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function _l(u){this.Aa=0,this.i=[],this.j=new js,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zi("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zi("baseRetryDelayMs",5e3,u),this.cb=zi("retryDelaySeedMs",1e4,u),this.Wa=zi("forwardChannelMaxRetries",2,u),this.wa=zi("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new lc(u&&u.concurrentRequestLimit),this.Da=new ml,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=_l.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,b){cn(0),this.W=u,this.H=p||{},v&&b!==void 0&&(this.H.OSID=v,this.H.OAID=b),this.F=this.X,this.I=_c(this,null,this.W),qo(this)};function Gi(u){if(Ki(u),u.G==3){var p=u.U++,v=vr(u.I);if(It(v,"SID",u.K),It(v,"RID",p),It(v,"TYPE","terminate"),Hi(u,v),p=new Yn(u,u.j,p),p.L=2,p.v=Ur(vr(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=bc(p.j,null),p.g.ea(p.v)),p.F=Date.now(),No(p)}yc(u)}function as(u){u.g&&(bl(u),u.g.cancel(),u.g=null)}function Ki(u){as(u),u.u&&(a.clearTimeout(u.u),u.u=null),zo(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function qo(u){if(!Mo(u.h)&&!u.s){u.s=!0;var p=u.Ga;$e||te(),Ue||($e(),Ue=!0),De.add(p,u),u.B=0}}function jh(u,p){return hl(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Cn(g(u.Ga,u,p),vc(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const U=new Yn(this,this.j,u);let G=this.o;if(this.S&&(G?(G=w(G),k(G,this.S)):G=this.S),this.m!==null||this.O||(U.H=G,G=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var b=this.i[v];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=pc(this,U,p),v=vr(this.I),It(v,"RID",u),It(v,"CVER",22),this.D&&It(v,"X-HTTP-Session-Id",this.D),Hi(this,v),G&&(this.O?p="headers="+encodeURIComponent(String(_r(G)))+"&"+p:this.m&&gl(v,this.m,G)),zs(this.h,U),this.Ua&&It(v,"TYPE","init"),this.P?(It(v,"$req",p),It(v,"SID","null"),U.T=!0,qs(U,v,null)):qs(U,v,p),this.G=2}}else this.G==3&&(u?fc(this,u):this.i.length==0||Mo(this.h)||fc(this))};function fc(u,p){var v;p?v=p.l:v=u.U++;const b=vr(u.I);It(b,"SID",u.K),It(b,"RID",v),It(b,"AID",u.T),Hi(u,b),u.m&&u.o&&gl(b,u.m,u.o),v=new Yn(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=pc(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),zs(u.h,v),qs(v,b,p)}function Hi(u,p){u.H&&ue(u.H,function(v,b){It(p,b,v)}),u.l&&ut({},function(v,b){It(p,b,v)})}function pc(u,p,v){v=Math.min(u.i.length,v);var b=u.l?g(u.l.Na,u.l,u):null;e:{var U=u.i;let G=-1;for(;;){const me=["count="+v];G==-1?0<v?(G=U[0].g,me.push("ofs="+G)):G=0:me.push("ofs="+G);let yt=!0;for(let dn=0;dn<v;dn++){let ot=U[dn].g;const sn=U[dn].map;if(ot-=G,0>ot)G=Math.max(0,U[dn].g-100),yt=!1;else try{$h(sn,me,"req"+ot+"_")}catch{b&&b(sn)}}if(yt){b=me.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,b}function mc(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;$e||te(),Ue||($e(),Ue=!0),De.add(p,u),u.v=0}}function ls(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Cn(g(u.Fa,u),vc(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,gc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Cn(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,cn(10),as(this),gc(this))};function bl(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function gc(u){u.g=new Yn(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=vr(u.qa);It(p,"RID","rpc"),It(p,"SID",u.K),It(p,"AID",u.T),It(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&It(p,"TO",u.ja),It(p,"TYPE","xmlhttp"),Hi(u,p),u.m&&u.o&&gl(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=Ur(vr(p)),v.m=null,v.P=!0,pr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,as(this),ls(this),cn(19))};function zo(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function wl(u,p){var v=null;if(u.g==p){zo(u),bl(u),u.g=null;var b=2}else if(Lo(u.h,p))v=p.D,Fi(u.h,p),b=1;else return;if(u.G!=0){if(p.o)if(b==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var U=u.B;b=Pr(),Be(b,new ic(b,v)),qo(u)}else mc(u);else if(U=p.s,U==3||U==0&&0<p.X||!(b==1&&jh(u,p)||b==2&&ls(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),U){case 1:qr(u,5);break;case 4:qr(u,10);break;case 3:qr(u,6);break;default:qr(u,2)}}}function vc(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function qr(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),b=u.Xa;const U=!b;b=new ss(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Fo(b,"https"),Ur(b),U?pl(b.toString(),v):uc(b.toString(),v)}else cn(2);u.G=0,u.l&&u.l.sa(p),yc(u),Ki(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),cn(2)):(this.j.info("Failed to ping google.com"),cn(1))};function yc(u){if(u.G=0,u.ka=[],u.l){const p=$i(u.h);(p.length!=0||u.i.length!=0)&&(A(u.ka,p),A(u.ka,u.i),u.h.i.length=0,S(u.i),u.i.length=0),u.l.ra()}}function _c(u,p,v){var b=v instanceof ss?vr(v):new ss(v);if(b.g!="")p&&(b.g=p+"."+b.g),$o(b,b.s);else{var U=a.location;b=U.protocol,p=p?p+"."+U.hostname:U.hostname,U=+U.port;var G=new ss(null);b&&Fo(G,b),p&&(G.g=p),U&&$o(G,U),v&&(G.l=v),b=G}return v=u.D,p=u.ya,v&&p&&It(b,v,p),It(b,"VER",u.la),Hi(u,b),b}function bc(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Ut(new kr({eb:v})):new Ut(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function wc(){}n=wc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function br(){}br.prototype.g=function(u,p){return new Gn(u,p)};function Gn(u,p){Me.call(this),this.g=new _l(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!F(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!F(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new us(this)}x(Gn,Me),Gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Gn.prototype.close=function(){Gi(this.g)},Gn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=rn(u),u=v);p.i.push(new dl(p.Ya++,u)),p.G==3&&qo(p)},Gn.prototype.N=function(){this.g.l=null,delete this.j,Gi(this.g),delete this.g,Gn.aa.N.call(this)};function Il(u){al.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}x(Il,al);function Go(){Ar.call(this),this.status=1}x(Go,Ar);function us(u){this.g=u}x(us,wc),us.prototype.ua=function(){Be(this.g,"a")},us.prototype.ta=function(u){Be(this.g,new Il(u))},us.prototype.sa=function(u){Be(this.g,new Go)},us.prototype.ra=function(){Be(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,Gn.prototype.send=Gn.prototype.o,Gn.prototype.open=Gn.prototype.m,Gn.prototype.close=Gn.prototype.close,X0=function(){return new br},Y0=function(){return Pr()},J0=Jn,qf={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},zn.NO_ERROR=0,zn.TIMEOUT=8,zn.HTTP_ERROR=6,qc=zn,ul.COMPLETE="complete",Q0=ul,sc.EventType=Oi,Oi.OPEN="a",Oi.CLOSE="b",Oi.ERROR="c",Oi.MESSAGE="d",Me.prototype.listen=Me.prototype.K,Ll=sc,Ut.prototype.listenOnce=Ut.prototype.L,Ut.prototype.getLastError=Ut.prototype.Ka,Ut.prototype.getLastErrorCode=Ut.prototype.Ba,Ut.prototype.getStatus=Ut.prototype.Z,Ut.prototype.getResponseJson=Ut.prototype.Oa,Ut.prototype.getResponseText=Ut.prototype.oa,Ut.prototype.send=Ut.prototype.ea,Ut.prototype.setWithCredentials=Ut.prototype.Ha,W0=Ut}).apply(typeof Sc<"u"?Sc:typeof self<"u"?self:typeof window<"u"?window:{});const Av="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bn.UNAUTHENTICATED=new bn(null),bn.GOOGLE_CREDENTIALS=new bn("google-credentials-uid"),bn.FIRST_PARTY=new bn("first-party-uid"),bn.MOCK_USER=new bn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ga="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bi=new Fp("@firebase/firestore");function ra(){return bi.logLevel}function x6(n){bi.setLogLevel(n)}function ne(n,...e){if(bi.logLevel<=nt.DEBUG){const t=e.map(Up);bi.debug(`Firestore (${Ga}): ${n}`,...t)}}function Xt(n,...e){if(bi.logLevel<=nt.ERROR){const t=e.map(Up);bi.error(`Firestore (${Ga}): ${n}`,...t)}}function Tr(n,...e){if(bi.logLevel<=nt.WARN){const t=e.map(Up);bi.warn(`Firestore (${Ga}): ${n}`,...t)}}function Up(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xe(n="Unexpected state"){const e=`FIRESTORE (${Ga}) INTERNAL ASSERTION FAILED: `+n;throw Xt(e),new Error(e)}function Pe(n,e){n||xe()}function A6(n,e){n||xe()}function _e(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class re extends Vs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(bn.UNAUTHENTICATED))}shutdown(){}}class zP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class GP{constructor(e){this.t=e,this.currentUser=bn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Pe(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new wn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new wn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{ne("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ne("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new wn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ne("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Pe(typeof r.accessToken=="string"),new Z0(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Pe(e===null||typeof e=="string"),new bn(e)}}class KP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=bn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class HP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new KP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(bn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class eb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class WP{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Pe(this.o===void 0);const r=i=>{i.error!=null&&ne("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,ne("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ne("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):ne("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Pe(typeof t.token=="string"),this.R=t.token,new eb(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class S6{getToken(){return Promise.resolve(new eb(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=QP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function je(n,e){return n<e?-1:n>e?1:0}function xa(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function nb(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new re(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new re(z.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new re(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new re(z.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return zt.fromMillis(Date.now())}static fromDate(e){return zt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new zt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?je(this.nanoseconds,e.nanoseconds):je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ce(e)}static min(){return new Ce(new zt(0,0))}static max(){return new Ce(new zt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,t,r){t===void 0?t=0:t>e.length&&xe(),r===void 0?r=e.length-t:r>e.length-t&&xe(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return hu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof hu?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rt extends hu{construct(e,t,r){return new rt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new re(z.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new rt(t)}static emptyPath(){return new rt([])}}const JP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bt extends hu{construct(e,t,r){return new Bt(e,t,r)}static isValidIdentifier(e){return JP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Bt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new re(z.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new re(z.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new re(z.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new re(z.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bt(t)}static emptyPath(){return new Bt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e){this.path=e}static fromPath(e){return new Ie(rt.fromString(e))}static fromName(e){return new Ie(rt.fromString(e).popFirst(5))}static empty(){return new Ie(rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&rt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return rt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ie(new rt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function zf(n){return n.fields.find(e=>e.kind===2)}function eo(n){return n.fields.filter(e=>e.kind!==2)}function YP(n,e){let t=je(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=XP(n.fields[r],e.fields[r]),t!==0)return t;return je(n.fields.length,e.fields.length)}Aa.UNKNOWN_ID=-1;class co{constructor(e,t){this.fieldPath=e,this.kind=t}}function XP(n,e){const t=Bt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:je(n.kind,e.kind)}class Sa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Sa(0,hr.min())}}function rb(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=Ce.fromTimestamp(r===1e9?new zt(t+1,0):new zt(t,r));return new hr(s,Ie.empty(),e)}function sb(n){return new hr(n.readTime,n.key,-1)}class hr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new hr(Ce.min(),Ie.empty(),-1)}static max(){return new hr(Ce.max(),Ie.empty(),-1)}}function jp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Ie.comparator(n.documentKey,e.documentKey),t!==0?t:je(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ib="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ob{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ri(n){if(n.code!==z.FAILED_PRECONDITION||n.message!==ib)throw n;ne("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&xe(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new B((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof B?t:B.resolve(t)}catch(t){return B.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):B.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):B.reject(t)}static resolve(e){return new B((t,r)=>{t(e)})}static reject(e){return new B((t,r)=>{r(e)})}static waitFor(e){return new B((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=B.resolve(!1);for(const r of e)t=t.next(s=>s?B.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new B((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new B((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new wn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Xl(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=Bp(r.target.error);this.V.reject(new Xl(e,s))}}static open(e,t,r,s){try{return new Xd(t,e.transaction(s,r))}catch(i){throw new Xl(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ne("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new e1(t)}}class Jr{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Jr.S(mn())===12.2&&Xt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ne("SimpleDb","Removing database:",e),no(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!U0())return!1;if(Jr.v())return!0;const e=mn(),t=Jr.S(e),r=0<t&&t<10,s=ab(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(ne("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new Xl(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new re(z.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new re(z.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Xl(e,o))},s.onupgradeneeded=i=>{ne("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{ne("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=Xd.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),B.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(ne("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ab(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class ZP{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return no(this.B.delete())}}class Xl extends re{constructor(e,t){super(z.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ci(n){return n.name==="IndexedDbTransactionError"}class e1{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ne("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(ne("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),no(r)}add(e){return ne("SimpleDb","ADD",this.store.name,e,e),no(this.store.add(e))}get(e){return no(this.store.get(e)).next(t=>(t===void 0&&(t=null),ne("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ne("SimpleDb","DELETE",this.store.name,e),no(this.store.delete(e))}count(){return ne("SimpleDb","COUNT",this.store.name),no(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new B((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new B((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){ne("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new B((r,s)=>{t.onerror=i=>{const o=Bp(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new B((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new ZP(a),c=t(a.primaryKey,a.value,l);if(c instanceof B){const d=c.catch(f=>(l.done(),B.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>B.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function no(n){return new B((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=Bp(r.target.error);t(s)}})}let Sv=!1;function Bp(n){const e=Jr.S(mn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new re("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Sv||(Sv=!0,setTimeout(()=>{throw r},0)),r}}return n}class t1{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){ne("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ne("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Ci(t)?ne("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Ri(t)}await this.X(6e4)})}}class n1{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return B.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return ne("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(ne("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=sb(i);jp(o,r)>0&&(r=o)}),new hr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}nr.oe=-1;function Mu(n){return n==null}function fu(n){return n===0&&1/n==-1/0}function lb(n){return typeof n=="number"&&Number.isInteger(n)&&!fu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Un(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Pv(e)),e=r1(n.get(t),e);return Pv(e)}function r1(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function Pv(n){return n+""}function Hr(n){const e=n.length;if(Pe(e>=2),e===2)return Pe(n.charAt(0)===""&&n.charAt(1)===""),rt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&xe(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:xe()}i=o+2}return new rt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(n,e){return[n,Un(e)]}function ub(n,e,t){return[n,Un(e),t]}const s1={},i1=["prefixPath","collectionGroup","readTime","documentId"],o1=["prefixPath","collectionGroup","documentId"],a1=["collectionGroup","readTime","prefixPath","documentId"],l1=["canonicalId","targetId"],u1=["targetId","path"],c1=["path","targetId"],d1=["collectionId","parent"],h1=["indexId","uid"],f1=["uid","sequenceNumber"],p1=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],m1=["indexId","uid","orderedDocumentKey"],g1=["userId","collectionPath","documentId"],v1=["userId","collectionPath","largestBatchId"],y1=["userId","collectionGroup","largestBatchId"],cb=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],_1=[...cb,"documentOverlays"],db=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],hb=db,qp=[...hb,"indexConfiguration","indexState","indexEntries"],b1=qp,w1=[...qp,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf extends ob{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function gn(n,e){const t=_e(n);return Jr.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cv(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ki(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function fb(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function pb(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e,t){this.comparator=e,this.root=t||Tn.EMPTY}insert(e,t){return new kt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Tn.BLACK,null,null))}remove(e){return new kt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Tn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pc(this.root,e,this.comparator,!0)}}class Pc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Tn{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Tn.RED,this.left=s??Tn.EMPTY,this.right=i??Tn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Tn(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Tn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Tn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Tn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Tn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw xe();const e=this.left.check();if(e!==this.right.check())throw xe();return e+(this.isRed()?0:1)}}Tn.EMPTY=null,Tn.RED=!0,Tn.BLACK=!1;Tn.EMPTY=new class{constructor(){this.size=0}get key(){throw xe()}get value(){throw xe()}get color(){throw xe()}get left(){throw xe()}get right(){throw xe()}copy(e,t,r,s,i){return this}insert(e,t,r){return new Tn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this.comparator=e,this.data=new kt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new kv(this.data.getIterator())}getIteratorFrom(e){return new kv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof wt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new wt(this.comparator);return t.data=e,t}}class kv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Qo(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.fields=e,e.sort(Bt.comparator)}static empty(){return new rr([])}unionWith(e){let t=new wt(Bt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new rr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xa(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R6(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new mb("Invalid base64 string: "+i):i}}(e);return new Wt(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Wt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Wt.EMPTY_BYTE_STRING=new Wt("");const I1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ss(n){if(Pe(!!n),typeof n=="string"){let e=0;const t=I1.exec(n);if(Pe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:jt(n.seconds),nanos:jt(n.nanos)}}function jt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ps(n){return typeof n=="string"?Wt.fromBase64String(n):Wt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zd(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function eh(n){const e=n.mapValue.fields.__previous_value__;return Zd(e)?eh(e):e}function pu(n){const e=Ss(n.mapValue.fields.__local_write_time__.timestampValue);return new zt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E1{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class mo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new mo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof mo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ui={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Gc={nullValue:"NULL_VALUE"};function wi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Zd(n)?4:gb(n)?9007199254740991:th(n)?10:11:xe()}function ts(n,e){if(n===e)return!0;const t=wi(n);if(t!==wi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return pu(n).isEqual(pu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Ss(s.timestampValue),a=Ss(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Ps(s.bytesValue).isEqual(Ps(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return jt(s.geoPointValue.latitude)===jt(i.geoPointValue.latitude)&&jt(s.geoPointValue.longitude)===jt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return jt(s.integerValue)===jt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=jt(s.doubleValue),a=jt(i.doubleValue);return o===a?fu(o)===fu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return xa(n.arrayValue.values||[],e.arrayValue.values||[],ts);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Cv(o)!==Cv(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ts(o[l],a[l])))return!1;return!0}(n,e);default:return xe()}}function mu(n,e){return(n.values||[]).find(t=>ts(t,e))!==void 0}function Ii(n,e){if(n===e)return 0;const t=wi(n),r=wi(e);if(t!==r)return je(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return je(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=jt(i.integerValue||i.doubleValue),l=jt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Dv(n.timestampValue,e.timestampValue);case 4:return Dv(pu(n),pu(e));case 5:return je(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Ps(i),l=Ps(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=je(a[c],l[c]);if(d!==0)return d}return je(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=je(jt(i.latitude),jt(o.latitude));return a!==0?a:je(jt(i.longitude),jt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Vv(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,x=(l=g.value)===null||l===void 0?void 0:l.arrayValue,S=je(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=x==null?void 0:x.values)===null||d===void 0?void 0:d.length)||0);return S!==0?S:Vv(y,x)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===ui.mapValue&&o===ui.mapValue)return 0;if(i===ui.mapValue)return 1;if(o===ui.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=je(l[f],d[f]);if(g!==0)return g;const y=Ii(a[l[f]],c[d[f]]);if(y!==0)return y}return je(l.length,d.length)}(n.mapValue,e.mapValue);default:throw xe()}}function Dv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return je(n,e);const t=Ss(n),r=Ss(e),s=je(t.seconds,r.seconds);return s!==0?s:je(t.nanos,r.nanos)}function Vv(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ii(t[s],r[s]);if(i)return i}return je(t.length,r.length)}function Pa(n){return Kf(n)}function Kf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ss(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ps(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Ie.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=Kf(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Kf(t.fields[o])}`;return s+"}"}(n.mapValue):xe()}function Kc(n){switch(wi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=eh(n);return e?16+Kc(e):16;case 5:return 2*n.stringValue.length;case 6:return Ps(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Kc(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return ki(r.fields,(i,o)=>{s+=i.length+Kc(o)}),s}(n.mapValue);default:throw xe()}}function go(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Hf(n){return!!n&&"integerValue"in n}function gu(n){return!!n&&"arrayValue"in n}function Nv(n){return!!n&&"nullValue"in n}function Ov(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hc(n){return!!n&&"mapValue"in n}function th(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Zl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return ki(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Zl(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Zl(n.arrayValue.values[t]);return e}return Object.assign({},n)}function gb(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const vb={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function T1(n){return"nullValue"in n?Gc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?go(mo.empty(),Ie.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?th(n)?vb:{mapValue:{}}:xe()}function x1(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?go(mo.empty(),Ie.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?vb:"mapValue"in n?th(n)?{mapValue:{}}:ui:xe()}function Mv(n,e){const t=Ii(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Lv(n,e){const t=Ii(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e){this.value=e}static empty(){return new An({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Hc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Zl(t)}setAll(e){let t=Bt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Zl(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());Hc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ts(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Hc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){ki(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new An(Zl(this.value))}}function yb(n){const e=[];return ki(n.fields,(t,r)=>{const s=new Bt([t]);if(Hc(r)){const i=yb(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new rr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Mt(e,0,Ce.min(),Ce.min(),Ce.min(),An.empty(),0)}static newFoundDocument(e,t,r,s){return new Mt(e,1,t,Ce.min(),r,s,0)}static newNoDocument(e,t){return new Mt(e,2,t,Ce.min(),Ce.min(),An.empty(),0)}static newUnknownDocument(e,t){return new Mt(e,3,t,Ce.min(),Ce.min(),An.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ce.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=An.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=An.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e,t){this.position=e,this.inclusive=t}}function Fv(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Ie.comparator(Ie.fromName(o.referenceValue),t.key):r=Ii(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function $v(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ts(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(e,t="asc"){this.field=e,this.dir=t}}function A1(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _b{}class st extends _b{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new S1(e,t,r):t==="array-contains"?new C1(e,r):t==="in"?new xb(e,r):t==="not-in"?new k1(e,r):t==="array-contains-any"?new D1(e,r):new st(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new P1(e,r):new R1(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ii(t,this.value)):t!==null&&wi(this.value)===wi(t)&&this.matchesComparison(Ii(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xe()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class bt extends _b{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new bt(e,t)}matches(e){return Ra(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ra(n){return n.op==="and"}function Wf(n){return n.op==="or"}function zp(n){return bb(n)&&Ra(n)}function bb(n){for(const e of n.filters)if(e instanceof bt)return!1;return!0}function Qf(n){if(n instanceof st)return n.field.canonicalString()+n.op.toString()+Pa(n.value);if(zp(n))return n.filters.map(e=>Qf(e)).join(",");{const e=n.filters.map(t=>Qf(t)).join(",");return`${n.op}(${e})`}}function wb(n,e){return n instanceof st?function(r,s){return s instanceof st&&r.op===s.op&&r.field.isEqual(s.field)&&ts(r.value,s.value)}(n,e):n instanceof bt?function(r,s){return s instanceof bt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&wb(o,s.filters[a]),!0):!1}(n,e):void xe()}function Ib(n,e){const t=n.filters.concat(e);return bt.create(t,n.op)}function Eb(n){return n instanceof st?function(t){return`${t.field.canonicalString()} ${t.op} ${Pa(t.value)}`}(n):n instanceof bt?function(t){return t.op.toString()+" {"+t.getFilters().map(Eb).join(" ,")+"}"}(n):"Filter"}class S1 extends st{constructor(e,t,r){super(e,t,r),this.key=Ie.fromName(r.referenceValue)}matches(e){const t=Ie.comparator(e.key,this.key);return this.matchesComparison(t)}}class P1 extends st{constructor(e,t){super(e,"in",t),this.keys=Tb("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class R1 extends st{constructor(e,t){super(e,"not-in",t),this.keys=Tb("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Tb(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Ie.fromName(r.referenceValue))}class C1 extends st{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return gu(t)&&mu(t.arrayValue,this.value)}}class xb extends st{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&mu(this.value.arrayValue,t)}}class k1 extends st{constructor(e,t){super(e,"not-in",t)}matches(e){if(mu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!mu(this.value.arrayValue,t)}}class D1 extends st{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!gu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>mu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V1{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Jf(n,e=null,t=[],r=[],s=null,i=null,o=null){return new V1(n,e,t,r,s,i,o)}function vo(n){const e=_e(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Qf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Mu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Pa(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Pa(r)).join(",")),e.ue=t}return e.ue}function Lu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!A1(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!wb(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$v(n.startAt,e.startAt)&&$v(n.endAt,e.endAt)}function gd(n){return Ie.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function vd(n,e){return n.filters.filter(t=>t instanceof st&&t.field.isEqual(e))}function Uv(n,e,t){let r=Gc,s=!0;for(const i of vd(n,e)){let o=Gc,a=!0;switch(i.op){case"<":case"<=":o=T1(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Gc}Mv({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Mv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function jv(n,e,t){let r=ui,s=!0;for(const i of vd(n,e)){let o=ui,a=!0;switch(i.op){case">=":case">":o=x1(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=ui}Lv({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Lv({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ab(n,e,t,r,s,i,o,a){return new Ns(n,e,t,r,s,i,o,a)}function Ka(n){return new Ns(n)}function Bv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Gp(n){return n.collectionGroup!==null}function pa(n){const e=_e(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new wt(Bt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new vu(i,r))}),t.has(Bt.keyField().canonicalString())||e.ce.push(new vu(Bt.keyField(),r))}return e.ce}function jn(n){const e=_e(n);return e.le||(e.le=Pb(e,pa(n))),e.le}function Sb(n){const e=_e(n);return e.he||(e.he=Pb(e,n.explicitOrderBy)),e.he}function Pb(n,e){if(n.limitType==="F")return Jf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new vu(s.field,i)});const t=n.endAt?new Ei(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ei(n.startAt.position,n.startAt.inclusive):null;return Jf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Yf(n,e){const t=n.filters.concat([e]);return new Ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function yd(n,e,t){return new Ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Fu(n,e){return Lu(jn(n),jn(e))&&n.limitType===e.limitType}function Rb(n){return`${vo(jn(n))}|lt:${n.limitType}`}function sa(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Eb(s)).join(", ")}]`),Mu(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Pa(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Pa(s)).join(",")),`Target(${r})`}(jn(n))}; limitType=${n.limitType})`}function $u(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Ie.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of pa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=Fv(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,pa(r),s)||r.endAt&&!function(o,a,l){const c=Fv(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,pa(r),s))}(n,e)}function Cb(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function kb(n){return(e,t)=>{let r=!1;for(const s of pa(n)){const i=N1(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function N1(n,e,t){const r=n.field.isKeyField()?Ie.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Ii(l,c):xe()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return xe()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ki(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return pb(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O1=new kt(Ie.comparator);function sr(){return O1}const Db=new kt(Ie.comparator);function Fl(...n){let e=Db;for(const t of n)e=e.insert(t.key,t);return e}function Vb(n){let e=Db;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Wr(){return eu()}function Nb(){return eu()}function eu(){return new Os(n=>n.toString(),(n,e)=>n.isEqual(e))}const M1=new kt(Ie.comparator),L1=new wt(Ie.comparator);function Ke(...n){let e=L1;for(const t of n)e=e.add(t);return e}const F1=new wt(je);function Kp(){return F1}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fu(e)?"-0":e}}function Ob(n){return{integerValue:""+n}}function Mb(n,e){return lb(e)?Ob(e):Hp(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(){this._=void 0}}function $1(n,e,t){return n instanceof Ca?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Zd(i)&&(i=eh(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof yo?Fb(n,e):n instanceof _o?$b(n,e):function(s,i){const o=Lb(s,i),a=qv(o)+qv(s.Pe);return Hf(o)&&Hf(s.Pe)?Ob(a):Hp(s.serializer,a)}(n,e)}function U1(n,e,t){return n instanceof yo?Fb(n,e):n instanceof _o?$b(n,e):t}function Lb(n,e){return n instanceof ka?function(r){return Hf(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Ca extends nh{}class yo extends nh{constructor(e){super(),this.elements=e}}function Fb(n,e){const t=Ub(e);for(const r of n.elements)t.some(s=>ts(s,r))||t.push(r);return{arrayValue:{values:t}}}class _o extends nh{constructor(e){super(),this.elements=e}}function $b(n,e){let t=Ub(e);for(const r of n.elements)t=t.filter(s=>!ts(s,r));return{arrayValue:{values:t}}}class ka extends nh{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function qv(n){return jt(n.integerValue||n.doubleValue)}function Ub(n){return gu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,t){this.field=e,this.transform=t}}function j1(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof yo&&s instanceof yo||r instanceof _o&&s instanceof _o?xa(r.elements,s.elements,ts):r instanceof ka&&s instanceof ka?ts(r.Pe,s.Pe):r instanceof Ca&&s instanceof Ca}(n.transform,e.transform)}class B1{constructor(e,t){this.version=e,this.transformResults=t}}class qt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qt}static exists(e){return new qt(void 0,e)}static updateTime(e){return new qt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class rh{}function jb(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Wa(n.key,qt.none()):new Ha(n.key,n.data,qt.none());{const t=n.data,r=An.empty();let s=new wt(Bt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ms(n.key,r,new rr(s.toArray()),qt.none())}}function q1(n,e,t){n instanceof Ha?function(s,i,o){const a=s.value.clone(),l=Gv(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ms?function(s,i,o){if(!Wc(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Gv(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Bb(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function tu(n,e,t,r){return n instanceof Ha?function(i,o,a,l){if(!Wc(i.precondition,o))return a;const c=i.value.clone(),d=Kv(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ms?function(i,o,a,l){if(!Wc(i.precondition,o))return a;const c=Kv(i.fieldTransforms,l,o),d=o.data;return d.setAll(Bb(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return Wc(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function z1(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Lb(r.transform,s||null);i!=null&&(t===null&&(t=An.empty()),t.set(r.field,i))}return t||null}function zv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&xa(r,s,(i,o)=>j1(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ha extends rh{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ms extends rh{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Bb(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Gv(n,e,t){const r=new Map;Pe(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,U1(o,a,t[s]))}return r}function Kv(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,$1(i,o,e))}return r}class Wa extends rh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wp extends rh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qp{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&q1(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=tu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=tu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Nb();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=jb(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(Ce.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ke())}isEqual(e){return this.batchId===e.batchId&&xa(this.mutations,e.mutations,(t,r)=>zv(t,r))&&xa(this.baseMutations,e.baseMutations,(t,r)=>zv(t,r))}}class Jp{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Pe(e.mutations.length===r.length);let s=function(){return M1}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Jp(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var on,at;function zb(n){switch(n){default:return xe();case z.CANCELLED:case z.UNKNOWN:case z.DEADLINE_EXCEEDED:case z.RESOURCE_EXHAUSTED:case z.INTERNAL:case z.UNAVAILABLE:case z.UNAUTHENTICATED:return!1;case z.INVALID_ARGUMENT:case z.NOT_FOUND:case z.ALREADY_EXISTS:case z.PERMISSION_DENIED:case z.FAILED_PRECONDITION:case z.ABORTED:case z.OUT_OF_RANGE:case z.UNIMPLEMENTED:case z.DATA_LOSS:return!0}}function Gb(n){if(n===void 0)return Xt("GRPC error has no .code"),z.UNKNOWN;switch(n){case on.OK:return z.OK;case on.CANCELLED:return z.CANCELLED;case on.UNKNOWN:return z.UNKNOWN;case on.DEADLINE_EXCEEDED:return z.DEADLINE_EXCEEDED;case on.RESOURCE_EXHAUSTED:return z.RESOURCE_EXHAUSTED;case on.INTERNAL:return z.INTERNAL;case on.UNAVAILABLE:return z.UNAVAILABLE;case on.UNAUTHENTICATED:return z.UNAUTHENTICATED;case on.INVALID_ARGUMENT:return z.INVALID_ARGUMENT;case on.NOT_FOUND:return z.NOT_FOUND;case on.ALREADY_EXISTS:return z.ALREADY_EXISTS;case on.PERMISSION_DENIED:return z.PERMISSION_DENIED;case on.FAILED_PRECONDITION:return z.FAILED_PRECONDITION;case on.ABORTED:return z.ABORTED;case on.OUT_OF_RANGE:return z.OUT_OF_RANGE;case on.UNIMPLEMENTED:return z.UNIMPLEMENTED;case on.DATA_LOSS:return z.DATA_LOSS;default:return xe()}}(at=on||(on={}))[at.OK=0]="OK",at[at.CANCELLED=1]="CANCELLED",at[at.UNKNOWN=2]="UNKNOWN",at[at.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",at[at.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",at[at.NOT_FOUND=5]="NOT_FOUND",at[at.ALREADY_EXISTS=6]="ALREADY_EXISTS",at[at.PERMISSION_DENIED=7]="PERMISSION_DENIED",at[at.UNAUTHENTICATED=16]="UNAUTHENTICATED",at[at.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",at[at.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",at[at.ABORTED=10]="ABORTED",at[at.OUT_OF_RANGE=11]="OUT_OF_RANGE",at[at.UNIMPLEMENTED=12]="UNIMPLEMENTED",at[at.INTERNAL=13]="INTERNAL",at[at.UNAVAILABLE=14]="UNAVAILABLE",at[at.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _d=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kb(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K1=new uo([4294967295,4294967295],0);function Hv(n){const e=Kb().encode(n),t=new H0;return t.update(e),new Uint8Array(t.digest())}function Wv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new uo([t,r],0),new uo([s,i],0)]}class Xp{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new $l(`Invalid padding: ${t}`);if(r<0)throw new $l(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new $l(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new $l(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=uo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(uo.fromNumber(r)));return s.compare(K1)===1&&(s=new uo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Hv(e),[r,s]=Wv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Xp(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Hv(e),[r,s]=Wv(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class $l extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Bu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ju(Ce.min(),s,new kt(je),sr(),Ke())}}class Bu{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Bu(r,t,Ke(),Ke(),Ke())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class Hb{constructor(e,t){this.targetId=e,this.me=t}}class Wb{constructor(e,t,r=Wt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Qv{constructor(){this.fe=0,this.ge=Yv(),this.pe=Wt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Ke(),t=Ke(),r=Ke();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:xe()}}),new Bu(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Yv()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Pe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class H1{constructor(e){this.Le=e,this.Be=new Map,this.ke=sr(),this.qe=Jv(),this.Qe=new kt(je)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:xe()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(gd(i))if(r===0){const o=new Ie(i.path);this.Ue(t,o,Mt.newNoDocument(o,Ce.min()))}else Pe(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}_d==null||_d.et(function(d,f,g,y,x){var S,A,j,F,P,q;const X={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},ue=f.unchangedNames;return ue&&(X.bloomFilter={applied:x===0,hashCount:(S=ue==null?void 0:ue.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(F=(j=(A=ue==null?void 0:ue.bits)===null||A===void 0?void 0:A.bitmap)===null||j===void 0?void 0:j.length)!==null&&F!==void 0?F:0,padding:(q=(P=ue==null?void 0:ue.bits)===null||P===void 0?void 0:P.padding)!==null&&q!==void 0?q:0,mightContain:E=>{var w;return(w=y==null?void 0:y.mightContain(E))!==null&&w!==void 0&&w}}),X}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Ps(r).toUint8Array()}catch(l){if(l instanceof mb)return Tr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Xp(o,s,i)}catch(l){return Tr(l instanceof $l?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&gd(a.target)){const l=new Ie(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Mt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Ke();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new ju(e,t,this.Qe,this.ke,r);return this.ke=sr(),this.qe=Jv(),this.Qe=new kt(je),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Qv,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new wt(je),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||ne("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Qv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Jv(){return new kt(Ie.comparator)}function Yv(){return new kt(Ie.comparator)}const W1=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Q1=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),J1=(()=>({and:"AND",or:"OR"}))();class Y1{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Xf(n,e){return n.useProto3Json||Mu(e)?e:{value:e}}function Da(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Qb(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function X1(n,e){return Da(n,e.toTimestamp())}function en(n){return Pe(!!n),Ce.fromTimestamp(function(t){const r=Ss(t);return new zt(r.seconds,r.nanos)}(n))}function Zp(n,e){return Zf(n,e).canonicalString()}function Zf(n,e){const t=function(s){return new rt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Jb(n){const e=rt.fromString(n);return Pe(ow(e)),e}function yu(n,e){return Zp(n.databaseId,e.path)}function Yr(n,e){const t=Jb(e);if(t.get(1)!==n.databaseId.projectId)throw new re(z.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new re(z.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Ie(Zb(t))}function Yb(n,e){return Zp(n.databaseId,e)}function Xb(n){const e=Jb(n);return e.length===4?rt.emptyPath():Zb(e)}function ep(n){return new rt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Zb(n){return Pe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Xv(n,e,t){return{name:yu(n,e),fields:t.value.mapValue.fields}}function ew(n,e,t){const r=Yr(n,e.name),s=en(e.updateTime),i=e.createTime?en(e.createTime):Ce.min(),o=new An({mapValue:{fields:e.fields}}),a=Mt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Z1(n,e){return"found"in e?function(r,s){Pe(!!s.found),s.found.name,s.found.updateTime;const i=Yr(r,s.found.name),o=en(s.found.updateTime),a=s.found.createTime?en(s.found.createTime):Ce.min(),l=new An({mapValue:{fields:s.found.fields}});return Mt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Pe(!!s.missing),Pe(!!s.readTime);const i=Yr(r,s.missing),o=en(s.readTime);return Mt.newNoDocument(i,o)}(n,e):xe()}function eR(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:xe()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Pe(d===void 0||typeof d=="string"),Wt.fromBase64String(d||"")):(Pe(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Wt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?z.UNKNOWN:Gb(c.code);return new re(d,c.message||"")}(o);t=new Wb(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Yr(n,r.document.name),i=en(r.document.updateTime),o=r.document.createTime?en(r.document.createTime):Ce.min(),a=new An({mapValue:{fields:r.document.fields}}),l=Mt.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new Qc(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Yr(n,r.document),i=r.readTime?en(r.readTime):Ce.min(),o=Mt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new Qc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Yr(n,r.document),i=r.removedTargetIds||[];t=new Qc([],i,s,null)}else{if(!("filter"in e))return xe();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new G1(s,i),a=r.targetId;t=new Hb(a,o)}}return t}function _u(n,e){let t;if(e instanceof Ha)t={update:Xv(n,e.key,e.value)};else if(e instanceof Wa)t={delete:yu(n,e.key)};else if(e instanceof Ms)t={update:Xv(n,e.key,e.data),updateMask:oR(e.fieldMask)};else{if(!(e instanceof Wp))return xe();t={verify:yu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Ca)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof yo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof _o)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof ka)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw xe()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:X1(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:xe()}(n,e.precondition)),t}function tp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?qt.updateTime(en(i.updateTime)):i.exists!==void 0?qt.exists(i.exists):qt.none()}(e.currentDocument):qt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Pe(a.setToServerValue==="REQUEST_TIME"),l=new Ca;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new yo(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new _o(d)}else"increment"in a?l=new ka(o,a.increment):xe();const c=Bt.fromServerFormat(a.fieldPath);return new Uu(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Yr(n,e.update.name),i=new An({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new rr(c.map(d=>Bt.fromServerFormat(d)))}(e.updateMask);return new Ms(s,i,o,t,r)}return new Ha(s,i,t,r)}if(e.delete){const s=Yr(n,e.delete);return new Wa(s,t)}if(e.verify){const s=Yr(n,e.verify);return new Wp(s,t)}return xe()}function tR(n,e){return n&&n.length>0?(Pe(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?en(s.updateTime):en(i);return o.isEqual(Ce.min())&&(o=en(i)),new B1(o,s.transformResults||[])}(t,e))):[]}function tw(n,e){return{documents:[Yb(n,e.path)]}}function sh(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Yb(n,s);const i=function(c){if(c.length!==0)return iw(bt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:ni(g.field),direction:rR(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Xf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function nw(n,e,t,r){const{_t:s,parent:i}=sh(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:ni(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:ni(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function rw(n){let e=Xb(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Pe(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=sw(f);return g instanceof bt&&zp(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(x){return new vu(ia(x.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,Mu(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new Ei(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new Ei(y,g)}(t.endAt)),Ab(e,s,o,i,a,"F",l,c)}function nR(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xe()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function sw(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ia(t.unaryFilter.field);return st.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=ia(t.unaryFilter.field);return st.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ia(t.unaryFilter.field);return st.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=ia(t.unaryFilter.field);return st.create(o,"!=",{nullValue:"NULL_VALUE"});default:return xe()}}(n):n.fieldFilter!==void 0?function(t){return st.create(ia(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xe()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return bt.create(t.compositeFilter.filters.map(r=>sw(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return xe()}}(t.compositeFilter.op))}(n):xe()}function rR(n){return W1[n]}function sR(n){return Q1[n]}function iR(n){return J1[n]}function ni(n){return{fieldPath:n.canonicalString()}}function ia(n){return Bt.fromServerFormat(n.fieldPath)}function iw(n){return n instanceof st?function(t){if(t.op==="=="){if(Ov(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NAN"}};if(Nv(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ov(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NAN"}};if(Nv(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ni(t.field),op:sR(t.op),value:t.value}}}(n):n instanceof bt?function(t){const r=t.getFilters().map(s=>iw(s));return r.length===1?r[0]:{compositeFilter:{op:iR(t.op),filters:r}}}(n):xe()}function oR(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ow(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,t,r,s,i=Ce.min(),o=Ce.min(),a=Wt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ys(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e){this.ct=e}}function aR(n,e){let t;if(e.document)t=ew(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Ie.fromSegments(e.noDocument.path),s=wo(e.noDocument.readTime);t=Mt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return xe();{const r=Ie.fromSegments(e.unknownDocument.path),s=wo(e.unknownDocument.version);t=Mt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new zt(s[0],s[1]);return Ce.fromTimestamp(i)}(e.readTime)),t}function Zv(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:bd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:yu(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Da(i,o.version.toTimestamp()),createTime:Da(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:bo(e.version)};else{if(!e.isUnknownDocument())return xe();r.unknownDocument={path:t.path.toArray(),version:bo(e.version)}}return r}function bd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function bo(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function wo(n){const e=new zt(n.seconds,n.nanoseconds);return Ce.fromTimestamp(e)}function ro(n,e){const t=(e.baseMutations||[]).map(i=>tp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>tp(n.ct,i)),s=zt.fromMillis(e.localWriteTimeMs);return new Qp(e.batchId,s,t,r)}function Ul(n){const e=wo(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?wo(n.lastLimboFreeSnapshotVersion):Ce.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Pe(i.documents.length===1),jn(Ka(Xb(i.documents[0])))}(n.query):function(i){return jn(rw(i))}(n.query),new ys(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Wt.fromBase64String(n.resumeToken))}function lw(n,e){const t=bo(e.snapshotVersion),r=bo(e.lastLimboFreeSnapshotVersion);let s;s=gd(e.target)?tw(n.ct,e.target):sh(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:vo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function em(n){const e=rw({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yd(e,e.limit,"L"):e}function cf(n,e){return new Yp(e.largestBatchId,tp(n.ct,e.overlayMutation))}function ey(n,e){const t=e.path.lastSegment();return[n,Un(e.path.popLast()),t]}function ty(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:bo(r.readTime),documentKey:Un(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lR{getBundleMetadata(e,t){return ny(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:wo(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return ny(e).put(function(s){return{bundleId:s.id,createTime:bo(en(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return ry(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:em(i.bundledQuery),readTime:wo(i.readTime)}}(r)})}saveNamedQuery(e,t){return ry(e).put(function(s){return{name:s.name,readTime:bo(en(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function ny(n){return gn(n,"bundles")}function ry(n){return gn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new ih(e,r)}getOverlay(e,t){return Sl(e).get(ey(this.userId,t)).next(r=>r?cf(this.serializer,r):null)}getOverlays(e,t){const r=Wr();return B.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Yp(t,o);s.push(this.ht(e,a))}),B.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Un(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Sl(e).j("collectionPathOverlayIndex",a))}),B.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Wr(),i=Un(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Sl(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=cf(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Wr();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Sl(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=cf(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return Sl(e).put(function(s,i,o){const[a,l,c]=ey(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_u(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Sl(n){return gn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{Pt(e){return gn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Wt.fromUint8Array(r):Wt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(jt(e.integerValue));else if("doubleValue"in e){const r=jt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),fu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Ss(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Ps(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?gb(e)?this.dt(t,Number.MAX_SAFE_INTEGER):th(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):xe()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(jt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Ie.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}so.vt=new so;function cR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function sy(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=cR(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class dR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=sy(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=sy(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class hR{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class fR{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Pl{constructor(){this.jt=new dR,this.Ht=new hR(this.jt),this.Jt=new fR(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new io(this.indexId,this.documentKey,this.arrayValue,r)}}function Js(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=iy(n.arrayValue,e.arrayValue),t!==0?t:(t=iy(n.directionalValue,e.directionalValue),t!==0?t:Ie.comparator(n.documentKey,e.documentKey)))}function iy(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oy{constructor(e){this.Xt=new wt((t,r)=>Bt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Pe(e.collectionGroup===this.collectionId),this.nn)return!1;const t=zf(e);if(t!==void 0&&!this.sn(t))return!1;const r=eo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new wt(Bt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new co(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new co(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new co(r.field,r.dir==="asc"?0:1)));return new Aa(Aa.UNKNOWN_ID,this.collectionId,t,Sa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uw(n){var e,t;if(Pe(n instanceof st||n instanceof bt),n instanceof st){if(n instanceof xb){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>st.create(n.field,"==",i)))||[];return bt.create(s,"or")}return n}const r=n.filters.map(s=>uw(s));return bt.create(r,n.op)}function pR(n){if(n.getFilters().length===0)return[];const e=sp(uw(n));return Pe(cw(e)),np(e)||rp(e)?[e]:e.getFilters()}function np(n){return n instanceof st}function rp(n){return n instanceof bt&&zp(n)}function cw(n){return np(n)||rp(n)||function(t){if(t instanceof bt&&Wf(t)){for(const r of t.getFilters())if(!np(r)&&!rp(r))return!1;return!0}return!1}(n)}function sp(n){if(Pe(n instanceof st||n instanceof bt),n instanceof st)return n;if(n.filters.length===1)return sp(n.filters[0]);const e=n.filters.map(r=>sp(r));let t=bt.create(e,n.op);return t=wd(t),cw(t)?t:(Pe(t instanceof bt),Pe(Ra(t)),Pe(t.filters.length>1),t.filters.reduce((r,s)=>tm(r,s)))}function tm(n,e){let t;return Pe(n instanceof st||n instanceof bt),Pe(e instanceof st||e instanceof bt),t=n instanceof st?e instanceof st?function(s,i){return bt.create([s,i],"and")}(n,e):ay(n,e):e instanceof st?ay(e,n):function(s,i){if(Pe(s.filters.length>0&&i.filters.length>0),Ra(s)&&Ra(i))return Ib(s,i.getFilters());const o=Wf(s)?s:i,a=Wf(s)?i:s,l=o.filters.map(c=>tm(c,a));return bt.create(l,"or")}(n,e),wd(t)}function ay(n,e){if(Ra(e))return Ib(e,n.getFilters());{const t=e.filters.map(r=>tm(n,r));return bt.create(t,"or")}}function wd(n){if(Pe(n instanceof st||n instanceof bt),n instanceof st)return n;const e=n.getFilters();if(e.length===1)return wd(e[0]);if(bb(n))return n;const t=e.map(s=>wd(s)),r=[];return t.forEach(s=>{s instanceof st?r.push(s):s instanceof bt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:bt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(){this.un=new nm}addToCollectionParentIndex(e,t){return this.un.add(t),B.resolve()}getCollectionParents(e,t){return B.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return B.resolve()}deleteFieldIndex(e,t){return B.resolve()}deleteAllFieldIndexes(e){return B.resolve()}createTargetIndexes(e,t){return B.resolve()}getDocumentsMatchingTarget(e,t){return B.resolve(null)}getIndexType(e,t){return B.resolve(0)}getFieldIndexes(e,t){return B.resolve([])}getNextCollectionGroupToUpdate(e){return B.resolve(null)}getMinOffset(e,t){return B.resolve(hr.min())}getMinOffsetFromCollectionGroup(e,t){return B.resolve(hr.min())}updateCollectionGroup(e,t,r){return B.resolve()}updateIndexEntries(e,t){return B.resolve()}}class nm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new wt(rt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new wt(rt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rc=new Uint8Array(0);class gR{constructor(e,t){this.databaseId=t,this.cn=new nm,this.ln=new Os(r=>vo(r),(r,s)=>Lu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Un(s)};return ly(e).put(i)}return B.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[nb(t),""],!1,!0);return ly(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Hr(o.parent))}return r})}addFieldIndex(e,t){const r=Rl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Yo(e);return i.next(a=>{o.put(ty(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Rl(e),s=Yo(e),i=Jo(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Rl(e),r=Jo(e),s=Yo(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return B.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new oy(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Jo(e);let s=!0;const i=new Map;return B.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ke();const a=[];return B.forEach(i,(l,c)=>{ne("IndexedDbIndexManager",`Using index ${function(P){return`id=${P.indexId}|cg=${P.collectionGroup}|f=${P.fields.map(q=>`${q.fieldPath}:${q.kind}`).join(",")}`}(l)} to execute ${vo(t)}`);const d=function(P,q){const X=zf(q);if(X===void 0)return null;for(const ue of vd(P,X.fieldPath))switch(ue.op){case"array-contains-any":return ue.value.arrayValue.values||[];case"array-contains":return[ue.value]}return null}(c,l),f=function(P,q){const X=new Map;for(const ue of eo(q))for(const E of vd(P,ue.fieldPath))switch(E.op){case"==":case"in":X.set(ue.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return X.set(ue.fieldPath.canonicalString(),E.value),Array.from(X.values())}return null}(c,l),g=function(P,q){const X=[];let ue=!0;for(const E of eo(q)){const w=E.kind===0?Uv(P,E.fieldPath,P.startAt):jv(P,E.fieldPath,P.startAt);X.push(w.value),ue&&(ue=w.inclusive)}return new Ei(X,ue)}(c,l),y=function(P,q){const X=[];let ue=!0;for(const E of eo(q)){const w=E.kind===0?jv(P,E.fieldPath,P.endAt):Uv(P,E.fieldPath,P.endAt);X.push(w.value),ue&&(ue=w.inclusive)}return new Ei(X,ue)}(c,l),x=this.In(l,c,g),S=this.In(l,c,y),A=this.Tn(l,c,f),j=this.En(l.indexId,d,x,g.inclusive,S,y.inclusive,A);return B.forEach(j,F=>r.G(F,t.limit).next(P=>{P.forEach(q=>{const X=Ie.fromSegments(q.documentKey);o.has(X)||(o=o.add(X),a.push(X))})}))}).next(()=>a)}return B.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=pR(bt.create(e.filters,"and")).map(r=>Jf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Rc,y=this.An(e,g,r[f%c],s),x=this.Rn(e,g,i[f%c],o),S=a.map(A=>this.An(e,g,A,!0));d.push(...this.createRange(y,x,S))}return d}An(e,t,r,s){const i=new io(e,Ie.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new io(e,Ie.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new oy(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return B.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new wt(Bt.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Pl;for(const s of eo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);so.vt.It(i,o)}return r.zt()}dn(e){const t=new Pl;return so.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Pl;return so.vt.It(go(this.databaseId,t),r.Yt(function(i){const o=eo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Pl);let i=0;for(const o of eo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&gu(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);so.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Pl;l.seed(a.zt()),so.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof st&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Rl(e),s=Yo(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return B.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new Sa(f.sequenceNumber,new hr(wo(f.readTime),new Ie(Hr(f.documentKey)),f.largestBatchId)):Sa.empty(),y=d.fields.map(([x,S])=>new co(Bt.fromServerFormat(x),S));return new Aa(d.indexId,d.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:je(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Rl(e),i=Yo(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>B.forEach(a,l=>i.put(ty(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return B.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?B.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),B.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?B.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return Jo(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Jo(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Jo(e);let i=new wt(Js);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new io(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new wt(Js);const s=this.Vn(t,e);if(s==null)return r;const i=zf(t);if(i!=null){const o=e.data.field(i.fieldPath);if(gu(o))for(const a of o.arrayValue.values||[])r=r.add(new io(t.indexId,e.key,this.dn(a),s))}else r=r.add(new io(t.indexId,e.key,Rc,s));return r}bn(e,t,r,s,i){ne("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,g){const y=l.getIterator(),x=c.getIterator();let S=Qo(y),A=Qo(x);for(;S||A;){let j=!1,F=!1;if(S&&A){const P=d(S,A);P<0?F=!0:P>0&&(j=!0)}else S!=null?F=!0:j=!0;j?(f(A),A=Qo(x)):F?(g(S),S=Qo(y)):(S=Qo(y),A=Qo(x))}}(s,i,Js,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),B.waitFor(o)}yn(e){let t=1;return Yo(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Js(o,a)).filter((o,a,l)=>!a||Js(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Js(o,e),l=Js(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Rc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Rc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return Js(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(uy)}getMinOffset(e,t){return B.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||xe())).next(uy)}}function ly(n){return gn(n,"collectionParents")}function Jo(n){return gn(n,"indexEntries")}function Rl(n){return gn(n,"indexConfiguration")}function Yo(n){return gn(n,"indexState")}function uy(n){Pe(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;jp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new hr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class On{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new On(e,On.DEFAULT_COLLECTION_PERCENTILE,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dw(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Pe(a===1)}));const c=[];for(const d of t.mutations){const f=ub(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return B.waitFor(i).next(()=>c)}function Id(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw xe();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */On.DEFAULT_COLLECTION_PERCENTILE=10,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,On.DEFAULT=new On(41943040,On.DEFAULT_COLLECTION_PERCENTILE,On.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),On.DISABLED=new On(-1,0,0);class oh{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Pe(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new oh(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ys(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=oa(e),o=Ys(e);return o.add({}).next(a=>{Pe(typeof a=="number");const l=new Qp(a,t,r,s),c=function(y,x,S){const A=S.baseMutations.map(F=>_u(y.ct,F)),j=S.mutations.map(F=>_u(y.ct,F));return{userId:x,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:A,mutations:j}}(this.serializer,this.userId,l),d=[];let f=new wt((g,y)=>je(g.canonicalString(),y.canonicalString()));for(const g of s){const y=ub(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,s1))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),B.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return Ys(e).get(t).next(r=>r?(Pe(r.userId===this.userId),ro(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?B.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Ys(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Pe(a.batchId>=r),i=ro(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Ys(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ys(e).U("userMutationsIndex",t).next(r=>r.map(s=>ro(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=zc(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return oa(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,g=Hr(d);if(c===this.userId&&t.path.isEqual(g))return Ys(e).get(f).next(y=>{if(!y)throw xe();Pe(y.userId===this.userId),i.push(ro(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new wt(je);const s=[];return t.forEach(i=>{const o=zc(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=oa(e).J({range:a},(c,d,f)=>{const[g,y,x]=c,S=Hr(y);g===this.userId&&i.path.isEqual(S)?r=r.add(x):f.done()});s.push(l)}),B.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=zc(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new wt(je);return oa(e).J({range:o},(l,c,d)=>{const[f,g,y]=l,x=Hr(g);f===this.userId&&r.isPrefixOf(x)?x.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Ys(e).get(i).next(o=>{if(o===null)throw xe();Pe(o.userId===this.userId),r.push(ro(this.serializer,o))}))}),B.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return dw(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),B.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return B.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return oa(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Hr(i[1]);s.push(l)}else a.done()}).next(()=>{Pe(s.length===0)})})}containsKey(e,t){return hw(e,this.userId,t)}Nn(e){return fw(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hw(n,e,t){const r=zc(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return oa(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function Ys(n){return gn(n,"mutations")}function oa(n){return gn(n,"documentMutations")}function fw(n){return gn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Io(0)}static kn(){return new Io(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Io(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>Ce.fromTimestamp(new zt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Xo(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Pe(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Xo(e).J((o,a)=>{const l=Ul(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>B.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Xo(e).J((r,s)=>{const i=Ul(s);t(i)})}qn(e){return dy(e).get("targetGlobalKey").next(t=>(Pe(t!==null),t))}Qn(e,t){return dy(e).put("targetGlobalKey",t)}Kn(e,t){return Xo(e).put(lw(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=vo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Xo(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=Ul(a);Lu(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ri(e);return t.forEach(o=>{const a=Un(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),B.waitFor(s)}removeMatchingKeys(e,t,r){const s=ri(e);return B.forEach(t,i=>{const o=Un(i.path);return B.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ri(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ri(e);let i=Ke();return s.J({range:r,H:!0},(o,a,l)=>{const c=Hr(o[1]),d=new Ie(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=Un(t.path),s=IDBKeyRange.bound([r],[nb(r)],!1,!0);let i=0;return ri(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return Xo(e).get(t).next(r=>r?Ul(r):null)}}function Xo(n){return gn(n,"targets")}function dy(n){return gn(n,"targetGlobal")}function ri(n){return gn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hy([n,e],[t,r]){const s=je(n,t);return s===0?je(e,r):s}class yR{constructor(e){this.Un=e,this.buffer=new wt(hy),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();hy(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class pw{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){ne("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ci(t)?ne("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Ri(t)}await this.Hn(3e5)})}}class _R{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return B.resolve(nr.oe);const r=new yR(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ne("LruGarbageCollector","Garbage collection skipped; disabled"),B.resolve(cy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ne("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cy):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(ne("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),ra()<=nt.DEBUG&&ne("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),B.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function mw(n,e){return new _R(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(e,t){this.db=e,this.garbageCollector=mw(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Cc(e,r)}removeReference(e,t,r){return Cc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Cc(e,t)}nr(e,t){return function(s,i){let o=!1;return fw(s).Y(a=>hw(s,a,i).next(l=>(l&&(o=!0),B.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,Ce.min()),ri(e).delete(function(f){return[0,Un(f.path)]}(o))))});s.push(l)}}).next(()=>B.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Cc(e,t)}tr(e,t){const r=ri(e);let s,i=nr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==nr.oe&&t(new Ie(Hr(s)),i),i=c,s=l):i=nr.oe}).next(()=>{i!==nr.oe&&t(new Ie(Hr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Cc(n,e){return ri(n).put(function(r,s){return{targetId:0,path:Un(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(){this.changes=new Os(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Mt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?B.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wR{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Yi(e).put(r)}removeEntry(e,t,r){return Yi(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],bd(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Mt.newInvalidDocument(t);return Yi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Cl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Mt.newInvalidDocument(t)};return Yi(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Cl(t))},(s,i)=>{r={document:this.ir(t,i),size:Id(i)}}).next(()=>r)}getEntries(e,t){let r=sr();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=sr(),s=new kt(Ie.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,Id(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return B.resolve();let s=new wt(my);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Cl(s.first()),Cl(s.last())),o=s.getIterator();let a=o.getNext();return Yi(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=Ie.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&my(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(Cl(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),bd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yi(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=sr();for(const f of c){const g=this.ir(Ie.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&($u(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=sr();const o=py(t,r),a=py(t,hr.max());return Yi(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(Ie.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new IR(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return fy(e).get("remoteDocumentGlobalKey").next(t=>(Pe(!!t),t))}rr(e,t){return fy(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=aR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Ce.min())))return r}return Mt.newInvalidDocument(e)}}function vw(n){return new wR(n)}class IR extends gw{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Os(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new wt((i,o)=>je(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=Zv(this.cr.serializer,o);s=s.add(i.path.popLast());const c=Id(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=Zv(this.cr.serializer,o.convertToNoDocument(Ce.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),B.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function fy(n){return gn(n,"remoteDocumentGlobal")}function Yi(n){return gn(n,"remoteDocumentsV14")}function Cl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function py(n,e){const t=e.documentKey.path.toArray();return[n,bd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function my(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=je(t[i],r[i]),s)return s;return s=je(t.length,r.length),s||(s=je(t[t.length-2],r[r.length-2]),s||je(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yw{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&tu(r.mutation,s,rr.empty(),zt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ke()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ke()){const s=Wr();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Fl();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Wr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ke()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=sr();const o=eu(),a=function(){return eu()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof Ms)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),tu(d.mutation,c,d.mutation.getFieldMask(),zt.now())):o.set(c.key,rr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new ER(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=eu();let s=new kt((o,a)=>o-a),i=Ke();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||rr.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||Ke()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=Nb();d.forEach(g=>{if(!i.has(g)){const y=jb(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return B.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Ie.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Gp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):B.resolve(Wr());let a=-1,l=i;return o.next(c=>B.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?B.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Ke())).next(d=>({batchId:a,changes:Vb(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ie(t)).next(r=>{let s=Fl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Fl();return this.indexManager.getCollectionParents(e,i).next(a=>B.forEach(a,l=>{const c=function(f,g){return new Ns(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Mt.newInvalidDocument(d)))});let a=Fl();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&tu(d.mutation,c,rr.empty(),zt.now()),$u(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return B.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:en(s.createTime)}}(t)),B.resolve()}getNamedQuery(e,t){return B.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:em(s.bundledQuery),readTime:en(s.readTime)}}(t)),B.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(){this.overlays=new kt(Ie.comparator),this.Ir=new Map}getOverlay(e,t){return B.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Wr();return B.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),B.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),B.resolve()}getOverlaysForCollection(e,t,r){const s=Wr(),i=t.length+1,o=new Ie(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return B.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new kt((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=Wr(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=Wr(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return B.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Yp(t,r));let i=this.Ir.get(t);i===void 0&&(i=Ke(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(){this.sessionToken=Wt.EMPTY_BYTE_STRING}getSessionToken(e){return B.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,B.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(){this.Tr=new wt(_n.Er),this.dr=new wt(_n.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new _n(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new _n(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Ie(new rt([])),r=new _n(t,e),s=new _n(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Ie(new rt([])),r=new _n(t,e),s=new _n(t,e+1);let i=Ke();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new _n(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class _n{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Ie.comparator(e.key,t.key)||je(e.wr,t.wr)}static Ar(e,t){return je(e.wr,t.wr)||Ie.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new wt(_n.Er)}checkEmpty(e){return B.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Qp(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new _n(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return B.resolve(o)}lookupMutationBatch(e,t){return B.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return B.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return B.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return B.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new _n(t,0),s=new _n(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),B.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new wt(je);return t.forEach(s=>{const i=new _n(s,0),o=new _n(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),B.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Ie.isDocumentKey(i)||(i=i.child(""));const o=new _n(new Ie(i),0);let a=new wt(je);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),B.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Pe(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return B.forEach(t.mutations,s=>{const i=new _n(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new _n(t,0),s=this.br.firstAfterOrEqual(r);return B.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,B.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(e){this.Mr=e,this.docs=function(){return new kt(Ie.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return B.resolve(r?r.document.mutableCopy():Mt.newInvalidDocument(t))}getEntries(e,t){let r=sr();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Mt.newInvalidDocument(s))}),B.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=sr();const o=t.path,a=new Ie(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||jp(sb(d),r)<=0||(s.has(d.key)||$u(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return B.resolve(i)}getAllFromCollectionGroup(e,t,r,s){xe()}Or(e,t){return B.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new RR(this)}getSize(e){return B.resolve(this.size)}}class RR extends gw{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),B.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(e){this.persistence=e,this.Nr=new Os(t=>vo(t),Lu),this.lastRemoteSnapshotVersion=Ce.min(),this.highestTargetId=0,this.Lr=0,this.Br=new rm,this.targetCount=0,this.kr=Io.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),B.resolve()}getLastRemoteSnapshotVersion(e){return B.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return B.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),B.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),B.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Io(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,B.resolve()}updateTargetData(e,t){return this.Kn(t),B.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,B.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),B.waitFor(i).next(()=>s)}getTargetCount(e){return B.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return B.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),B.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),B.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),B.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return B.resolve(r)}containsKey(e,t){return B.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm{constructor(e,t){this.qr={},this.overlays={},this.Qr=new nr(0),this.Kr=!1,this.Kr=!0,this.$r=new AR,this.referenceDelegate=e(this),this.Ur=new CR(this),this.indexManager=new mR,this.remoteDocumentCache=function(s){return new PR(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new aw(t),this.Gr=new TR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new xR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new SR(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){ne("MemoryPersistence","Starting transaction:",e);const s=new kR(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return B.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class kR extends ob{constructor(e){super(),this.currentSequenceNumber=e}}class ah{constructor(e){this.persistence=e,this.Jr=new rm,this.Yr=null}static Zr(e){return new ah(e)}get Xr(){if(this.Yr)return this.Yr;throw xe()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),B.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),B.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),B.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return B.forEach(this.Xr,r=>{const s=Ie.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,Ce.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return B.or([()=>B.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Ed{constructor(e,t){this.persistence=e,this.ti=new Os(r=>Un(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=mw(this,t)}static Zr(e,t){return new Ed(e,t)}zr(){}jr(e){return B.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return B.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?B.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,Ce.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),B.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),B.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),B.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),B.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Kc(e.data.value)),t}nr(e,t,r){return B.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return B.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DR{constructor(e){this.serializer=e}O(e,t,r,s){const i=new Xd("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Rv,{unique:!0}),l.createObjectStore("documentMutations")}(e),gy(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=B.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),gy(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Ce.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Rv,{unique:!0});const f=c.store("mutations"),g=d.map(y=>f.put(y));return B.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:g1});c.createIndex("collectionPathOverlayIndex",v1,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",y1,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:i1});c.createIndex("documentKeyIndex",o1),c.createIndex("collectionGroupIndex",a1)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:h1}).createIndex("sequenceNumberIndex",f1,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:p1}).createIndex("documentKeyIndex",m1,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=Id(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>B.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>B.forEach(a,l=>{Pe(l.userId===i.userId);const c=ro(this.serializer,l);return dw(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new rt(o),c=function(f){return[0,Un(f)]}(l);i.push(t.get(c).next(d=>d?B.resolve():(f=>t.put({targetId:0,path:Un(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>B.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:d1});const r=t.store("collectionParents"),s=new nm,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Un(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new rt(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=Hr(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=Ul(s),o=lw(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Ie(rt.fromString(f.document.name).popFirst(5)):f.noDocument?Ie.fromSegments(f.noDocument.path):f.unknownDocument?Ie.fromSegments(f.unknownDocument.path):xe()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>B.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=vw(this.serializer),i=new sm(ah.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:Ke();ro(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),B.forEach(a,(l,c)=>{const d=new bn(c),f=ih.lt(this.serializer,d),g=i.getIndexManager(d),y=oh.lt(d,this.serializer,g,i.referenceDelegate);return new yw(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new Gf(t,nr.oe),l).next()})})}}function gy(n){n.createObjectStore("targetDocuments",{keyPath:u1}).createIndex("documentTargetsIndex",c1,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",l1,{unique:!0}),n.createObjectStore("targetGlobal")}const df="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class im{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!im.D())throw new re(z.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new bR(this,s),this.Ai=t+"main",this.serializer=new aw(l),this.Ri=new Jr(this.Ai,this.hi,new DR(this.serializer)),this.$r=new uR,this.Ur=new vR(this.referenceDelegate,this.serializer),this.remoteDocumentCache=vw(this.serializer),this.Gr=new lR,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&Xt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new re(z.FAILED_PRECONDITION,df);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new nr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>kc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Ci(e))return ne("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ne("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return kl(e).get("owner").next(t=>B.resolve(this.vi(t)))}Ci(e){return kc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=gn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return B.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?B.resolve(!0):kl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new re(z.FAILED_PRECONDITION,df);return!1}}return!(!this.networkEnabled||!this.inForeground)||kc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ne("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Gf(e,nr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>kc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return oh.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new gR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ih.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){ne("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?w1:l===16?b1:l===15?qp:l===14?hb:l===13?db:l===12?_1:l===11?cb:void xe()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new Gf(a,this.Qr?this.Qr.next():nr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw Xt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new re(z.FAILED_PRECONDITION,ib);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return kl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new re(z.FAILED_PRECONDITION,df)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return kl(e).put("owner",t)}static D(){return Jr.D()}bi(e){const t=kl(e);return t.get("owner").next(r=>this.vi(r)?(ne("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):B.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Xt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;$0()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return ne("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Xt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Xt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function kl(n){return gn(n,"owner")}function kc(n){return gn(n,"clientMetadata")}function om(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Ke(),s=Ke();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new am(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _w{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return $0()?8:ab(mn())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new VR;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(ra()<=nt.DEBUG&&ne("QueryEngine","SDK will not create cache indexes for query:",sa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),B.resolve()):(ra()<=nt.DEBUG&&ne("QueryEngine","Query:",sa(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(ra()<=nt.DEBUG&&ne("QueryEngine","The SDK decides to create cache indexes for query:",sa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jn(t))):B.resolve())}Yi(e,t){if(Bv(t))return B.resolve(null);let r=jn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=yd(t,null,"F"),r=jn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ke(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,yd(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Bv(t)||s.isEqual(Ce.min())?B.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?B.resolve(null):(ra()<=nt.DEBUG&&ne("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),sa(t)),this.rs(e,o,t,rb(s,-1)).next(a=>a))})}ts(e,t){let r=new wt(kb(e));return t.forEach((s,i)=>{$u(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return ra()<=nt.DEBUG&&ne("QueryEngine","Using full collection scan to execute query:",sa(t)),this.Ji.getDocumentsMatchingQuery(e,t,hr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new kt(je),this._s=new Os(i=>vo(i),Lu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new yw(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function bw(n,e,t,r){return new NR(n,e,t,r)}async function ww(n,e){const t=_e(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Ke();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function OR(n,e){const t=_e(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,g=f.keys();let y=B.resolve();return g.forEach(x=>{y=y.next(()=>d.getEntry(l,x)).next(S=>{const A=c.docVersions.get(x);Pe(A!==null),S.version.compareTo(A)<0&&(f.applyToRemoteDocument(S,c),S.isValidDocument()&&(S.setReadTime(c.commitVersion),d.addEntry(S)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Ke();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Iw(n){const e=_e(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function MR(n,e){const t=_e(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(Wt.EMPTY_BYTE_STRING,Ce.min()).withLastLimboFreeSnapshotVersion(Ce.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(S,A,j){return S.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0}(g,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=sr(),c=Ke();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(Ew(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual(Ce.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return B.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function Ew(n,e,t){let r=Ke(),s=Ke();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=sr();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(Ce.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ne("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function LR(n,e){const t=_e(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Va(n,e){const t=_e(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,B.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new ys(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Na(n,e,t){const r=_e(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ci(o))throw o;ne("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Td(n,e,t){const r=_e(n);let s=Ce.min(),i=Ke();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=_e(l),g=f._s.get(d);return g!==void 0?B.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,jn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:Ce.min(),t?i:Ke())).next(a=>(Aw(r,Cb(e),a),{documents:a,Ts:i})))}function Tw(n,e){const t=_e(n),r=_e(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function xw(n,e){const t=_e(n),r=t.us.get(e)||Ce.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,rb(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Aw(t,e,s),s))}function Aw(n,e,t){let r=n.us.get(e)||Ce.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function FR(n,e,t,r){const s=_e(n);let i=Ke(),o=sr();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await Va(s,function(d){return jn(Ka(rt.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Ew(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function $R(n,e,t=Ke()){const r=await Va(n,jn(em(e.bundledQuery))),s=_e(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=en(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(Wt.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function vy(n,e){return`firestore_clients_${n}_${e}`}function yy(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function hf(n,e){return`firestore_targets_${n}_${e}`}class xd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new re(s.error.code,s.error.message))),o?new xd(e,t,s.state,i):(Xt("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class nu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new re(r.error.code,r.error.message))),i?new nu(e,r.state,s):(Xt("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ad{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Kp();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=lb(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ad(e,i):(Xt("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class lm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new lm(t.clientId,t.onlineState):(Xt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class ip{constructor(){this.activeTargetIds=Kp()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ff{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new kt(je),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=vy(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new ip),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(vy(this.persistenceKey,r));if(s){const i=Ad.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(hf(this.persistenceKey,e));if(s){const i=nu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(hf(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ne("SharedClientState","READ",e,t),t}setItem(e,t){ne("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ne("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(ne("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Xt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=nr.oe;if(i!=null)try{const a=JSON.parse(i);Pe(typeof a=="number"),o=a}catch(a){Xt("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==nr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new xd(this.currentUser,e,t,r),i=yy(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=yy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=hf(this.persistenceKey,e),i=new nu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Ad.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return xd.Rs(new bn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return nu.Rs(s,t)}Ls(e){return lm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);ne("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Kp();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Sw{constructor(){this.so=new ip,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new ip,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UR{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ne("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ne("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dc=null;function pf(){return Dc===null?Dc=function(){return 268435456+Math.round(2147483648*Math.random())}():Dc++,"0x"+Dc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vn="WebChannelConnection";class qR extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=pf(),l=this.xo(t,r.toUriEncodedString());ne("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(ne("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Tr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ga}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=jR[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=pf();return new Promise((o,a)=>{const l=new W0;l.setWithCredentials(!0),l.listenOnce(Q0.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case qc.NO_ERROR:const d=l.getResponseJson();ne(Vn,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case qc.TIMEOUT:ne(Vn,`RPC '${e}' ${i} timed out`),a(new re(z.DEADLINE_EXCEEDED,"Request time out"));break;case qc.HTTP_ERROR:const f=l.getStatus();if(ne(Vn,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const x=function(A){const j=A.toLowerCase().replace(/_/g,"-");return Object.values(z).indexOf(j)>=0?j:z.UNKNOWN}(y.status);a(new re(x,y.message))}else a(new re(z.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new re(z.UNAVAILABLE,"Connection failed."));break;default:xe()}}finally{ne(Vn,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);ne(Vn,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=pf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=X0(),a=Y0(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");ne(Vn,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,y=!1;const x=new BR({Io:A=>{y?ne(Vn,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(g||(ne(Vn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),ne(Vn,`RPC '${e}' stream ${s} sending:`,A),f.send(A))},To:()=>f.close()}),S=(A,j,F)=>{A.listen(j,P=>{try{F(P)}catch(q){setTimeout(()=>{throw q},0)}})};return S(f,Ll.EventType.OPEN,()=>{y||(ne(Vn,`RPC '${e}' stream ${s} transport opened.`),x.yo())}),S(f,Ll.EventType.CLOSE,()=>{y||(y=!0,ne(Vn,`RPC '${e}' stream ${s} transport closed`),x.So())}),S(f,Ll.EventType.ERROR,A=>{y||(y=!0,Tr(Vn,`RPC '${e}' stream ${s} transport errored:`,A),x.So(new re(z.UNAVAILABLE,"The operation could not be completed")))}),S(f,Ll.EventType.MESSAGE,A=>{var j;if(!y){const F=A.data[0];Pe(!!F);const P=F,q=P.error||((j=P[0])===null||j===void 0?void 0:j.error);if(q){ne(Vn,`RPC '${e}' stream ${s} received error:`,q);const X=q.status;let ue=function(I){const k=on[I];if(k!==void 0)return Gb(k)}(X),E=q.message;ue===void 0&&(ue=z.INTERNAL,E="Unknown error status: "+X+" with message "+q.message),y=!0,x.So(new re(ue,E)),f.close()}else ne(Vn,`RPC '${e}' stream ${s} received:`,F),x.bo(F)}}),S(a,J0.STAT_EVENT,A=>{A.stat===qf.PROXY?ne(Vn,`RPC '${e}' stream ${s} detected buffering proxy`):A.stat===qf.NOPROXY&&ne(Vn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.wo()},0),x}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(){return typeof window<"u"?window:null}function Jc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qu(n){return new Y1(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&ne("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new um(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===z.RESOURCE_EXHAUSTED?(Xt(t.toString()),Xt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===z.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new re(z.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ne("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ne("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class zR extends Rw{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=eR(this.serializer,e),r=function(i){if(!("targetChange"in i))return Ce.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?Ce.min():o.readTime?en(o.readTime):Ce.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=ep(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=gd(l)?{documents:tw(i,l)}:{query:sh(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Qb(i,o.resumeToken);const c=Xf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(Ce.min())>0){a.readTime=Da(i,o.snapshotVersion.toTimestamp());const c=Xf(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=nR(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=ep(this.serializer),t.removeTarget=e,this.a_(t)}}class GR extends Rw{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Pe(!!e.streamToken),this.lastStreamToken=e.streamToken,Pe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Pe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=tR(e.writeResults,e.commitTime),r=en(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=ep(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>_u(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KR extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new re(z.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Zf(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new re(z.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Zf(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===z.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new re(z.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class HR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Xt(t),this.D_=!1):ne("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Di(this)&&(ne("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=_e(l);c.L_.add(4),await Qa(c),c.q_.set("Unknown"),c.L_.delete(4),await zu(c)}(this))})}),this.q_=new HR(r,s)}}async function zu(n){if(Di(n))for(const e of n.B_)await e(!0)}async function Qa(n){for(const e of n.B_)await e(!1)}function lh(n,e){const t=_e(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),hm(t)?dm(t):Ya(t).r_()&&cm(t,e))}function Oa(n,e){const t=_e(n),r=Ya(t);t.N_.delete(e),r.r_()&&Cw(t,e),t.N_.size===0&&(r.r_()?r.o_():Di(t)&&t.q_.set("Unknown"))}function cm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ce.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ya(n).A_(e)}function Cw(n,e){n.Q_.xe(e),Ya(n).R_(e)}function dm(n){n.Q_=new H1({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ya(n).start(),n.q_.v_()}function hm(n){return Di(n)&&!Ya(n).n_()&&n.N_.size>0}function Di(n){return _e(n).L_.size===0}function kw(n){n.Q_=void 0}async function QR(n){n.q_.set("Online")}async function JR(n){n.N_.forEach((e,t)=>{cm(n,e)})}async function YR(n,e){kw(n),hm(n)?(n.q_.M_(e),dm(n)):n.q_.set("Unknown")}async function XR(n,e,t){if(n.q_.set("Online"),e instanceof Wb&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){ne("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Sd(n,r)}else if(e instanceof Qc?n.Q_.Ke(e):e instanceof Hb?n.Q_.He(e):n.Q_.We(e),!t.isEqual(Ce.min()))try{const r=await Iw(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(Wt.EMPTY_BYTE_STRING,d.snapshotVersion)),Cw(i,l);const f=new ys(d.target,l,c,d.sequenceNumber);cm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ne("RemoteStore","Failed to raise snapshot:",r),await Sd(n,r)}}async function Sd(n,e,t){if(!Ci(e))throw e;n.L_.add(1),await Qa(n),n.q_.set("Offline"),t||(t=()=>Iw(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ne("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await zu(n)})}function Dw(n,e){return e().catch(t=>Sd(n,t,e))}async function Ja(n){const e=_e(n),t=Ti(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;ZR(e);)try{const s=await LR(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,eC(e,s)}catch(s){await Sd(e,s)}Vw(e)&&Nw(e)}function ZR(n){return Di(n)&&n.O_.length<10}function eC(n,e){n.O_.push(e);const t=Ti(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Vw(n){return Di(n)&&!Ti(n).n_()&&n.O_.length>0}function Nw(n){Ti(n).start()}async function tC(n){Ti(n).p_()}async function nC(n){const e=Ti(n);for(const t of n.O_)e.m_(t.mutations)}async function rC(n,e,t){const r=n.O_.shift(),s=Jp.from(r,e,t);await Dw(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ja(n)}async function sC(n,e){e&&Ti(n).V_&&await async function(r,s){if(function(o){return zb(o)&&o!==z.ABORTED}(s.code)){const i=r.O_.shift();Ti(r).s_(),await Dw(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ja(r)}}(n,e),Vw(n)&&Nw(n)}async function by(n,e){const t=_e(n);t.asyncQueue.verifyOperationInProgress(),ne("RemoteStore","RemoteStore received new credentials");const r=Di(t);t.L_.add(3),await Qa(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await zu(t)}async function op(n,e){const t=_e(n);e?(t.L_.delete(2),await zu(t)):e||(t.L_.add(2),await Qa(t),t.q_.set("Unknown"))}function Ya(n){return n.K_||(n.K_=function(t,r,s){const i=_e(t);return i.w_(),new zR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:QR.bind(null,n),Ro:JR.bind(null,n),mo:YR.bind(null,n),d_:XR.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),hm(n)?dm(n):n.q_.set("Unknown")):(await n.K_.stop(),kw(n))})),n.K_}function Ti(n){return n.U_||(n.U_=function(t,r,s){const i=_e(t);return i.w_(),new GR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:tC.bind(null,n),mo:sC.bind(null,n),f_:nC.bind(null,n),g_:rC.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await Ja(n)):(await n.U_.stop(),n.O_.length>0&&(ne("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new wn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new fm(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new re(z.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xa(n,e){if(Xt("AsyncQueue",`${e}: ${n}`),Ci(n))return new re(z.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Ie.comparator(t.key,r.key):(t,r)=>Ie.comparator(t.key,r.key),this.keyedMap=Fl(),this.sortedSet=new kt(this.comparator)}static emptySet(e){return new ma(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ma)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ma;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wy{constructor(){this.W_=new kt(Ie.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):xe():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ma{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ma(e,t,ma.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Fu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class oC{constructor(){this.queries=Iy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=_e(t),i=s.queries;s.queries=Iy(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new re(z.ABORTED,"Firestore shutting down"))}}function Iy(){return new Os(n=>Rb(n),Fu)}async function pm(n,e){const t=_e(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new iC,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Xa(o,`Initialization of query '${sa(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&gm(t)}async function mm(n,e){const t=_e(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function aC(n,e){const t=_e(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&gm(t)}function lC(n,e,t){const r=_e(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function gm(n){n.Y_.forEach(e=>{e.next()})}var ap,Ey;(Ey=ap||(ap={})).ea="default",Ey.Cache="cache";class vm{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ma(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=Ma.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ap.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uC{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{constructor(e){this.serializer=e}Es(e){return Yr(this.serializer,e)}ds(e){return e.metadata.exists?ew(this.serializer,e.document,!1):Mt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return en(e)}}class cC{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ow(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=rt.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new Ty(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Ke()).add(i);t.set(o,a)}}return t}async complete(){const e=await FR(this.localStore,new Ty(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await $R(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Ow(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{constructor(e){this.key=e}}class Lw{constructor(e){this.key=e}}class Fw{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Ke(),this.mutatedKeys=Ke(),this.Aa=kb(e),this.Ra=new ma(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new wy,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),y=$u(this.query,f)?f:null,x=!!g&&this.mutatedKeys.has(g.key),S=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let A=!1;g&&y?g.data.isEqual(y.data)?x!==S&&(r.track({type:3,doc:y}),A=!0):this.ga(g,y)||(r.track({type:2,doc:y}),A=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),A=!0):g&&!y&&(r.track({type:1,doc:g}),A=!0,(l||c)&&(a=!0)),A&&(y?(o=o.add(y),i=S?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,x){const S=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xe()}};return S(y)-S(x)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new Ma(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new wy,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Ke(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new Lw(r))}),this.da.forEach(r=>{e.has(r)||t.push(new Mw(r))}),t}ba(e){this.Ta=e.Ts,this.da=Ke();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Ma.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class dC{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class hC{constructor(e){this.key=e,this.va=!1}}class fC{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Os(a=>Rb(a),Fu),this.Ma=new Map,this.xa=new Set,this.Oa=new kt(Ie.comparator),this.Na=new Map,this.La=new rm,this.Ba={},this.ka=new Map,this.qa=Io.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function pC(n,e,t=!0){const r=uh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await $w(r,e,t,!0),s}async function mC(n,e){const t=uh(n);await $w(t,e,!0,!1)}async function $w(n,e,t,r){const s=await Va(n.localStore,jn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await ym(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&lh(n.remoteStore,s),a}async function ym(n,e,t,r,s){n.Ka=(f,g,y)=>async function(S,A,j,F){let P=A.view.ma(j);P.ns&&(P=await Td(S.localStore,A.query,!1).then(({documents:E})=>A.view.ma(E,P)));const q=F&&F.targetChanges.get(A.targetId),X=F&&F.targetMismatches.get(A.targetId)!=null,ue=A.view.applyChanges(P,S.isPrimaryClient,q,X);return lp(S,A.targetId,ue.wa),ue.snapshot}(n,f,g,y);const i=await Td(n.localStore,e,!0),o=new Fw(e,i.Ts),a=o.ma(i.documents),l=Bu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);lp(n,t,c.wa);const d=new dC(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function gC(n,e,t){const r=_e(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!Fu(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Na(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Oa(r.remoteStore,s.targetId),La(r,s.targetId)}).catch(Ri)):(La(r,s.targetId),await Na(r.localStore,s.targetId,!0))}async function vC(n,e){const t=_e(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Oa(t.remoteStore,r.targetId))}async function yC(n,e,t){const r=Im(n);try{const s=await function(o,a){const l=_e(o),c=zt.now(),d=a.reduce((y,x)=>y.add(x.key),Ke());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let x=sr(),S=Ke();return l.cs.getEntries(y,d).next(A=>{x=A,x.forEach((j,F)=>{F.isValidDocument()||(S=S.add(j))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,x)).next(A=>{f=A;const j=[];for(const F of a){const P=z1(F,f.get(F.key).overlayedDocument);P!=null&&j.push(new Ms(F.key,P,yb(P.value.mapValue),qt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,j,a)}).next(A=>{g=A;const j=A.applyToLocalDocumentSet(f,S);return l.documentOverlayCache.saveOverlays(y,A.batchId,j)})}).then(()=>({batchId:g.batchId,changes:Vb(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new kt(je)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Ls(r,s.changes),await Ja(r.remoteStore)}catch(s){const i=Xa(s,"Failed to persist write");t.reject(i)}}async function Uw(n,e){const t=_e(n);try{const r=await MR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Pe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Pe(o.va):s.removedDocuments.size>0&&(Pe(o.va),o.va=!1))}),await Ls(t,r,e)}catch(r){await Ri(r)}}function xy(n,e,t){const r=_e(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=_e(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&gm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function _C(n,e,t){const r=_e(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new kt(Ie.comparator);o=o.insert(i,Mt.newNoDocument(i,Ce.min()));const a=Ke().add(i),l=new ju(Ce.min(),new Map,new kt(je),o,a);await Uw(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),wm(r)}else await Na(r.localStore,e,!1).then(()=>La(r,e,t)).catch(Ri)}async function bC(n,e){const t=_e(n),r=e.batch.batchId;try{const s=await OR(t.localStore,e);bm(t,r,null),_m(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ls(t,s)}catch(s){await Ri(s)}}async function wC(n,e,t){const r=_e(n);try{const s=await function(o,a){const l=_e(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Pe(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);bm(r,e,t),_m(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ls(r,s)}catch(s){await Ri(s)}}async function IC(n,e){const t=_e(n);Di(t.remoteStore)||ne("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=_e(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Xa(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function _m(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function bm(n,e,t){const r=_e(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function La(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||jw(n,r)})}function jw(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Oa(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),wm(n))}function lp(n,e,t){for(const r of t)r instanceof Mw?(n.La.addReference(r.key,e),EC(n,r)):r instanceof Lw?(ne("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||jw(n,r.key)):xe()}function EC(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(ne("SyncEngine","New document in limbo: "+t),n.xa.add(r),wm(n))}function wm(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Ie(rt.fromString(e)),r=n.qa.next();n.Na.set(r,new hC(t)),n.Oa=n.Oa.insert(t,r),lh(n.remoteStore,new ys(jn(Ka(t.path)),r,"TargetPurposeLimboResolution",nr.oe))}}async function Ls(n,e,t){const r=_e(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=am.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=_e(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>B.forEach(c,g=>B.forEach(g.$i,y=>d.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>B.forEach(g.Ui,y=>d.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!Ci(f))throw f;ne("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=d.os.get(g),x=y.snapshotVersion,S=y.withLastLimboFreeSnapshotVersion(x);d.os=d.os.insert(g,S)}}}(r.localStore,i))}async function TC(n,e){const t=_e(n);if(!t.currentUser.isEqual(e)){ne("SyncEngine","User change. New user:",e.toKey());const r=await ww(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new re(z.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ls(t,r.hs)}}function xC(n,e){const t=_e(n),r=t.Na.get(e);if(r&&r.va)return Ke().add(r.key);{let s=Ke();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function AC(n,e){const t=_e(n),r=await Td(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&lp(t,e.targetId,s.wa),s}async function SC(n,e){const t=_e(n);return xw(t.localStore,e).then(r=>Ls(t,r))}async function PC(n,e,t,r){const s=_e(n),i=await function(a,l){const c=_e(a),d=_e(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):B.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await Ja(s.remoteStore):t==="acknowledged"||t==="rejected"?(bm(s,e,r||null),_m(s,e),function(a,l){_e(_e(a).mutationQueue).On(l)}(s.localStore,e)):xe(),await Ls(s,i)):ne("SyncEngine","Cannot apply mutation batch with id: "+e)}async function RC(n,e){const t=_e(n);if(uh(t),Im(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Ay(t,r.toArray());t.Qa=!0,await op(t.remoteStore,!0);for(const i of s)lh(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(La(t,o),Na(t.localStore,o,!0))),Oa(t.remoteStore,o)}),await s,await Ay(t,r),function(o){const a=_e(o);a.Na.forEach((l,c)=>{Oa(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new kt(Ie.comparator)}(t),t.Qa=!1,await op(t.remoteStore,!1)}}async function Ay(n,e,t){const r=_e(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await Va(r.localStore,jn(l[0]));for(const c of l){const d=r.Fa.get(c),f=await AC(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await Tw(r.localStore,o);a=await Va(r.localStore,c),await ym(r,Bw(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function Bw(n){return Ab(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function CC(n){return function(t){return _e(_e(t).persistence).Qi()}(_e(n).localStore)}async function kC(n,e,t,r){const s=_e(n);if(s.Qa)return void ne("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await xw(s.localStore,Cb(i[0])),a=ju.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Wt.EMPTY_BYTE_STRING);await Ls(s,o,a);break}case"rejected":await Na(s.localStore,e,!0),La(s,e,r);break;default:xe()}}async function DC(n,e,t){const r=uh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){ne("SyncEngine","Adding an already active target "+s);continue}const i=await Tw(r.localStore,s),o=await Va(r.localStore,i);await ym(r,Bw(i),o.targetId,!1,o.resumeToken),lh(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await Na(r.localStore,s,!1).then(()=>{Oa(r.remoteStore,s),La(r,s)}).catch(Ri)}}function uh(n){const e=_e(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Uw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xC.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_C.bind(null,e),e.Ca.d_=aC.bind(null,e.eventManager),e.Ca.$a=lC.bind(null,e.eventManager),e}function Im(n){const e=_e(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=bC.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=wC.bind(null,e),e}function VC(n,e,t){const r=_e(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,x){const S=_e(y),A=en(x.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",j=>S.Gr.getBundleMetadata(j,x.id)).then(j=>!!j&&j.createTime.compareTo(A)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(Ow(l));const c=new cC(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await Ls(i,f.Ia,void 0),await function(y,x){const S=_e(y);return S.persistence.runTransaction("Save bundle","readwrite",A=>S.Gr.saveBundleMetadata(A,x))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Tr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class xi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=qu(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return bw(this.persistence,new _w,e.initialUser,this.serializer)}Ga(e){return new sm(ah.Zr,this.serializer)}Wa(e){return new Sw}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}xi.provider={build:()=>new xi};class NC extends xi{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Pe(this.persistence.referenceDelegate instanceof Ed);const r=this.persistence.referenceDelegate.garbageCollector;return new pw(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?On.withCacheSize(this.cacheSizeBytes):On.DEFAULT;return new sm(r=>Ed.Zr(r,t),this.serializer)}}class Em extends xi{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Im(this.Ja.syncEngine),await Ja(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return bw(this.persistence,new _w,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new pw(r,e.asyncQueue,t)}Ha(e,t){const r=new n1(t,this.persistence);return new t1(e.asyncQueue,r)}Ga(e){const t=om(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?On.withCacheSize(this.cacheSizeBytes):On.DEFAULT;return new im(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Pw(),Jc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Sw}}class qw extends Em{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof ff&&(this.sharedClientState.syncEngine={no:PC.bind(null,t),ro:kC.bind(null,t),io:DC.bind(null,t),Qi:CC.bind(null,t),eo:SC.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await RC(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=Pw();if(!ff.D(t))throw new re(z.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=om(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ff(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ai{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>xy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=TC.bind(null,this.syncEngine),await op(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new oC}()}createDatastore(e){const t=qu(e.databaseInfo.databaseId),r=function(i){return new qR(i)}(e.databaseInfo);return function(i,o,a,l){return new KR(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new WR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>xy(this.syncEngine,t,0),function(){return _y.D()?new _y:new UR}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new fC(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=_e(s);ne("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await Qa(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Ai.provider={build:()=>new Ai};function Sy(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Xt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OC{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new wn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new uC(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new re(z.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=_e(s),a={documents:i.map(f=>yu(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,rt.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=Z1(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());Pe(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Wa(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Ie.fromPath(r);this.mutations.push(new Wp(s,this.precondition(s)))}),await async function(r,s){const i=_e(r),o={writes:s.map(a=>_u(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,rt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw xe();t=Ce.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new re(z.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ce.min())?qt.exists(!1):qt.updateTime(t):qt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ce.min()))throw new re(z.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qt.updateTime(t)}return qt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new um(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new MC(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!Mu(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!zb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=bn.UNAUTHENTICATED,this.clientId=tb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ne("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ne("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new wn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Xa(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function mf(n,e){n.asyncQueue.verifyOperationInProgress(),ne("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await ww(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Py(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Tm(n);ne("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>by(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>by(e.remoteStore,s)),n._onlineComponents=e}async function Tm(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ne("FirestoreClient","Using user provided OfflineComponentProvider");try{await mf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===z.FAILED_PRECONDITION||s.code===z.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Tr("Error using user provided cache. Falling back to memory cache: "+t),await mf(n,new xi)}}else ne("FirestoreClient","Using default OfflineComponentProvider"),await mf(n,new xi);return n._offlineComponents}async function dh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ne("FirestoreClient","Using user provided OnlineComponentProvider"),await Py(n,n._uninitializedComponentsProvider._online)):(ne("FirestoreClient","Using default OnlineComponentProvider"),await Py(n,new Ai))),n._onlineComponents}function zw(n){return Tm(n).then(e=>e.persistence)}function Za(n){return Tm(n).then(e=>e.localStore)}function Gw(n){return dh(n).then(e=>e.remoteStore)}function xm(n){return dh(n).then(e=>e.syncEngine)}function Kw(n){return dh(n).then(e=>e.datastore)}async function Fa(n){const e=await dh(n),t=e.eventManager;return t.onListen=pC.bind(null,e.syncEngine),t.onUnlisten=gC.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=mC.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=vC.bind(null,e.syncEngine),t}function $C(n){return n.asyncQueue.enqueue(async()=>{const e=await zw(n),t=await Gw(n);return e.setNetworkEnabled(!0),function(s){const i=_e(s);return i.L_.delete(0),zu(i)}(t)})}function UC(n){return n.asyncQueue.enqueue(async()=>{const e=await zw(n),t=await Gw(n);return e.setNetworkEnabled(!1),async function(s){const i=_e(s);i.L_.add(0),await Qa(i),i.q_.set("Offline")}(t)})}function jC(n,e){const t=new wn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=_e(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new re(z.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Xa(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Za(n),e,t)),t.promise}function Hw(n,e,t={}){const r=new wn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new ch({next:g=>{d.Za(),o.enqueueAndForget(()=>mm(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new re(z.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new re(z.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new vm(Ka(a.path),d,{includeMetadataChanges:!0,_a:!0});return pm(i,f)}(await Fa(n),n.asyncQueue,e,t,r)),r.promise}function BC(n,e){const t=new wn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Td(s,i,!0),l=new Fw(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=Xa(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Za(n),e,t)),t.promise}function Ww(n,e,t={}){const r=new wn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new ch({next:g=>{d.Za(),o.enqueueAndForget(()=>mm(i,f)),g.fromCache&&l.source==="server"?c.reject(new re(z.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new vm(a,d,{includeMetadataChanges:!0,_a:!0});return pm(i,f)}(await Fa(n),n.asyncQueue,e,t,r)),r.promise}function qC(n,e,t){const r=new wn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await Kw(n);r.resolve(async function(o,a,l){var c;const d=_e(o),{request:f,ut:g,parent:y}=nw(d.serializer,Sb(a),l);d.connection.Fo||delete f.parent;const x=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(A=>!!A.result);Pe(x.length===1);const S=(c=x[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(S).reduce((A,j)=>(A[g[j]]=S[j],A),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function zC(n,e){const t=new ch(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){_e(s).Y_.add(i),i.next()}(await Fa(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){_e(s).Y_.delete(i)}(await Fa(n),t))}}function GC(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?Kb().encode(o):o,function(d,f){return new OC(d,f)}(function(d,f){if(d instanceof Uint8Array)return Sy(d,f);if(d instanceof ArrayBuffer)return Sy(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,qu(e));n.asyncQueue.enqueueAndForget(async()=>{VC(await xm(n),s,r)})}function KC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=_e(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await Za(n),e))}function HC(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=_e(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,x,S){f=[...f],g=[...g],f.sort(y),g.sort(y);const A=f.length,j=g.length;let F=0,P=0;for(;F<j&&P<A;){const q=y(f[P],g[F]);q<0?S(f[P++]):q>0?x(g[F++]):(F++,P++)}for(;F<j;)x(g[F++]);for(;P<A;)S(f[P++])}(c,s,YP,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>B.waitFor(a)))}(await Za(n),e))}function WC(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){_e(r).ss.zi=s}(await Za(n),e))}function QC(n){return n.asyncQueue.enqueue(async()=>function(t){const r=_e(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Za(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qw(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(n,e,t){if(!t)throw new re(z.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function JC(n,e,t,r){if(e===!0&&r===!0)throw new re(z.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Cy(n){if(!Ie.isDocumentKey(n))throw new re(z.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ky(n){if(Ie.isDocumentKey(n))throw new re(z.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function hh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":xe()}function et(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new re(z.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=hh(n);throw new re(z.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Jw(n,e){if(e<=0)throw new re(z.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new re(z.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new re(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}JC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Qw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new re(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new re(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new re(z.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Gu{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Dy({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new re(z.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new re(z.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Dy(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new qP;switch(r.type){case"firstParty":return new HP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new re(z.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Ry.get(t);r&&(ne("ComponentProvider","Removing Datastore"),Ry.delete(t),r.terminate())}(this),Promise.resolve()}}function YC(n,e,t,r={}){var s;const i=(n=et(n,Gu))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Tr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=bn.MOCK_USER;else{a=yS(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new re(z.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new bn(c)}n._authCredentials=new zP(new Z0(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Sn(this.firestore,e,this._query)}}class tn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new tn(this.firestore,e,this._key)}}class Xr extends Sn{constructor(e,t,r){super(e,t,Ka(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new tn(this.firestore,null,new Ie(e))}withConverter(e){return new Xr(this.firestore,e,this._path)}}function Qe(n,e,...t){if(n=ke(n),Am("collection","path",e),n instanceof Gu){const r=rt.fromString(e,...t);return ky(r),new Xr(n,null,r)}{if(!(n instanceof tn||n instanceof Xr))throw new re(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return ky(r),new Xr(n.firestore,null,r)}}function D6(n,e){if(n=et(n,Gu),Am("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new re(z.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Sn(n,null,function(r){return new Ns(rt.emptyPath(),r)}(e))}function Se(n,e,...t){if(n=ke(n),arguments.length===1&&(e=tb.newId()),Am("doc","path",e),n instanceof Gu){const r=rt.fromString(e,...t);return Cy(r),new tn(n,null,new Ie(r))}{if(!(n instanceof tn||n instanceof Xr))throw new re(z.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(rt.fromString(e,...t));return Cy(r),new tn(n.firestore,n instanceof Xr?n.converter:null,new Ie(r))}}function V6(n,e){return n=ke(n),e=ke(e),(n instanceof tn||n instanceof Xr)&&(e instanceof tn||e instanceof Xr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Yw(n,e){return n=ke(n),e=ke(e),n instanceof Sn&&e instanceof Sn&&n.firestore===e.firestore&&Fu(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vy{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new um(this,"async_queue_retry"),this.Vu=()=>{const r=Jc();r&&ne("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Jc();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Jc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new wn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ci(e))throw e;ne("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Xt("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=fm.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&xe()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function up(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class XC{constructor(){this._progressObserver={},this._taskCompletionResolver=new wn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N6=-1;class Tt extends Gu{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Vy,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Vy(e),this._firestoreClient=void 0,await e}}}function O6(n,e,t){t||(t="(default)");const r=Ou(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(_i(i,e))return s;throw new re(z.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new re(z.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new re(z.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function ZC(n,e){const t=typeof n=="object"?n:z0(),r=typeof n=="string"?n:e||"(default)",s=Ou(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=gS("firestore");i&&YC(s,...i)}return s}function Gt(n){if(n._terminated)throw new re(z.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Xw(n),n._firestoreClient}function Xw(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new E1(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Qw(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new FC(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function ek(n,e){Tr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return Zw(n,Ai.provider,{build:r=>new Em(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function M6(n){Tr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();Zw(n,Ai.provider,{build:t=>new qw(t,e.cacheSizeBytes)})}function Zw(n,e,t){if((n=et(n,Tt))._firestoreClient||n._terminated)throw new re(z.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new re(z.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},Xw(n)}function L6(n){if(n._initialized&&!n._terminated)throw new re(z.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new wn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Jr.D())return Promise.resolve();const s=r+"main";await Jr.delete(s)}(om(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function F6(n){return function(t){const r=new wn;return t.asyncQueue.enqueueAndForget(async()=>IC(await xm(t),r)),r.promise}(Gt(n=et(n,Tt)))}function $6(n){return $C(Gt(n=et(n,Tt)))}function U6(n){return UC(Gt(n=et(n,Tt)))}function j6(n){return RP(n.app,"firestore",n._databaseId.database),n._delete()}function B6(n,e){const t=Gt(n=et(n,Tt)),r=new XC;return GC(t,n._databaseId,e,r),r}function q6(n,e){return KC(Gt(n=et(n,Tt)),e).then(t=>t?new Sn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bu{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class tk{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Eo(Wt.fromBase64String(e))}catch(t){throw new re(z.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Eo(Wt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new re(z.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function z6(){return new xo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new re(z.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new re(z.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return je(this._lat,e._lat)||je(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nk=/^__.*__$/;class rk{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ms(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ha(e,this.data,t,this.fieldTransforms)}}class eI{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ms(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function tI(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xe()}}class ph{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new ph(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Pd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(tI(this.Cu)&&nk.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class sk{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||qu(e)}Qu(e,t,r,s=!1){return new ph({Cu:e,methodName:t,qu:r,path:Bt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function So(n){const e=n._freezeSettings(),t=qu(n._databaseId);return new sk(n._databaseId,!!e.ignoreUndefinedProperties,t)}function mh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);Nm("Data must be an object, but it was:",o,r);const a=sI(r,o);let l,c;if(i.merge)l=new rr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=wu(e,f,t);if(!o.contains(g))throw new re(z.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);oI(d,g)||d.push(g)}l=new rr(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new rk(new An(a),l,c)}class Ku extends Ao{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ku}}function nI(n,e,t){return new ph({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Pm extends Ao{_toFieldTransform(e){return new Uu(e.path,new Ca)}isEqual(e){return e instanceof Pm}}class Rm extends Ao{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=nI(this,e,!0),r=this.Ku.map(i=>Po(i,t)),s=new yo(r);return new Uu(e.path,s)}isEqual(e){return e instanceof Rm&&_i(this.Ku,e.Ku)}}class Cm extends Ao{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=nI(this,e,!0),r=this.Ku.map(i=>Po(i,t)),s=new _o(r);return new Uu(e.path,s)}isEqual(e){return e instanceof Cm&&_i(this.Ku,e.Ku)}}class km extends Ao{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new ka(e.serializer,Mb(e.serializer,this.$u));return new Uu(e.path,t)}isEqual(e){return e instanceof km&&this.$u===e.$u}}function Dm(n,e,t,r){const s=n.Qu(1,e,t);Nm("Data must be an object, but it was:",s,r);const i=[],o=An.empty();ki(r,(l,c)=>{const d=gh(e,l,t);c=ke(c);const f=s.Nu(d);if(c instanceof Ku)i.push(d);else{const g=Po(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new rr(i);return new eI(o,a,s.fieldTransforms)}function Vm(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[wu(e,r,t)],l=[s];if(i.length%2!=0)throw new re(z.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(wu(e,i[g])),l.push(i[g+1]);const c=[],d=An.empty();for(let g=a.length-1;g>=0;--g)if(!oI(c,a[g])){const y=a[g];let x=l[g];x=ke(x);const S=o.Nu(y);if(x instanceof Ku)c.push(y);else{const A=Po(x,S);A!=null&&(c.push(y),d.set(y,A))}}const f=new rr(c);return new eI(d,f,o.fieldTransforms)}function rI(n,e,t,r=!1){return Po(t,n.Qu(r?4:3,e))}function Po(n,e){if(iI(n=ke(n)))return Nm("Unsupported field value:",e,n),sI(n,e);if(n instanceof Ao)return function(r,s){if(!tI(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Po(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=ke(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Mb(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=zt.fromDate(r);return{timestampValue:Da(s.serializer,i)}}if(r instanceof zt){const i=new zt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Da(s.serializer,i)}}if(r instanceof Sm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Eo)return{bytesValue:Qb(s.serializer,r._byteString)};if(r instanceof tn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Zp(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof fh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Hp(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${hh(r)}`)}(n,e)}function sI(n,e){const t={};return pb(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ki(n,(r,s)=>{const i=Po(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function iI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof zt||n instanceof Sm||n instanceof Eo||n instanceof tn||n instanceof Ao||n instanceof fh)}function Nm(n,e,t){if(!iI(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=hh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function wu(n,e,t){if((e=ke(e))instanceof xo)return e._internalPath;if(typeof e=="string")return gh(n,e);throw Pd("Field path arguments must be of type string or ",n,!1,void 0,t)}const ik=new RegExp("[~\\*/\\[\\]]");function gh(n,e,t){if(e.search(ik)>=0)throw Pd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new xo(...e.split("."))._internalPath}catch{throw Pd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Pd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new re(z.INVALID_ARGUMENT,a+n+l)}function oI(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new tn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new ok(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class ok extends Iu{data(){return super.data()}}function vh(n,e){return typeof e=="string"?gh(n,e):e instanceof xo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new re(z.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Om{}class Hu extends Om{}function Eu(n,e,...t){let r=[];e instanceof Om&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof el).length,a=i.filter(l=>l instanceof Wu).length;if(o>1||o>0&&a>0)throw new re(z.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Wu extends Hu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Wu(e,t,r)}_apply(e){const t=this._parse(e);return uI(e._query,t),new Sn(e.firestore,e.converter,Yf(e._query,t))}_parse(e){const t=So(e.firestore);return function(i,o,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new re(z.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){Oy(f,d);const y=[];for(const x of f)y.push(Ny(l,i,x));g={arrayValue:{values:y}}}else g=Ny(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||Oy(f,d),g=rI(a,o,f,d==="in"||d==="not-in");return st.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Rd(n,e,t){const r=e,s=vh("where",n);return Wu._create(s,r,t)}class el extends Om{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new el(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:bt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)uI(o,l),o=Yf(o,l)}(e._query,t),new Sn(e.firestore,e.converter,Yf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function G6(...n){return n.forEach(e=>cI("or",e)),el._create("or",n)}function K6(...n){return n.forEach(e=>cI("and",e)),el._create("and",n)}class Mm extends Hu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Mm(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new re(z.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new re(z.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vu(i,o)}(e._query,this._field,this._direction);return new Sn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ns(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function ak(n,e="asc"){const t=e,r=vh("orderBy",n);return Mm._create(r,t)}class yh extends Hu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new yh(e,t,r)}_apply(e){return new Sn(e.firestore,e.converter,yd(e._query,this._limit,this._limitType))}}function H6(n){return Jw("limit",n),yh._create("limit",n,"F")}function W6(n){return Jw("limitToLast",n),yh._create("limitToLast",n,"L")}class _h extends Hu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new _h(e,t,r)}_apply(e){const t=lI(e,this.type,this._docOrFields,this._inclusive);return new Sn(e.firestore,e.converter,function(s,i){return new Ns(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function Q6(...n){return _h._create("startAt",n,!0)}function J6(...n){return _h._create("startAfter",n,!1)}class bh extends Hu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new bh(e,t,r)}_apply(e){const t=lI(e,this.type,this._docOrFields,this._inclusive);return new Sn(e.firestore,e.converter,function(s,i){return new Ns(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function Y6(...n){return bh._create("endBefore",n,!1)}function X6(...n){return bh._create("endAt",n,!0)}function lI(n,e,t,r){if(t[0]=ke(t[0]),t[0]instanceof Iu)return function(i,o,a,l,c){if(!l)throw new re(z.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of pa(i))if(f.field.isKeyField())d.push(go(o,l.key));else{const g=l.data.field(f.field);if(Zd(g))throw new re(z.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new re(z.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new Ei(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=So(n.firestore);return function(o,a,l,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new re(z.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let x=0;x<d.length;x++){const S=d[x];if(g[x].field.isKeyField()){if(typeof S!="string")throw new re(z.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof S}`);if(!Gp(o)&&S.indexOf("/")!==-1)throw new re(z.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${S}' contains a slash.`);const A=o.path.child(rt.fromString(S));if(!Ie.isDocumentKey(A))throw new re(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${A}' is not because it contains an odd number of segments.`);const j=new Ie(A);y.push(go(a,j))}else{const A=rI(l,c,S);y.push(A)}}return new Ei(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Ny(n,e,t){if(typeof(t=ke(t))=="string"){if(t==="")throw new re(z.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gp(e)&&t.indexOf("/")!==-1)throw new re(z.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(rt.fromString(t));if(!Ie.isDocumentKey(r))throw new re(z.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return go(n,new Ie(r))}if(t instanceof tn)return go(n,t._key);throw new re(z.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hh(t)}.`)}function Oy(n,e){if(!Array.isArray(n)||n.length===0)throw new re(z.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function uI(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new re(z.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new re(z.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function cI(n,e){if(!(e instanceof Wu||e instanceof el))throw new re(z.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class dI{convertValue(e,t="none"){switch(wi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return jt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ps(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw xe()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return ki(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>jt(o.doubleValue));return new fh(i)}convertGeoPoint(e){return new Sm(jt(e.latitude),jt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=eh(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(pu(e));default:return null}}convertTimestamp(e){const t=Ss(e);return new zt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=rt.fromString(e);Pe(ow(r));const s=new mo(r.get(1),r.get(3)),i=new Ie(r.popFirst(5));return s.isEqual(t)||Xt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class lk extends dI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Eo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new tn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z6(n){return new bu("sum",wu("sum",n))}function e$(n){return new bu("avg",wu("average",n))}function uk(){return new bu("count")}function t$(n,e){var t,r;return n instanceof bu&&e instanceof bu&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function n$(n,e){return Yw(n.query,e.query)&&_i(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class $a extends Iu{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Yc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(vh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Yc extends $a{data(e={}){return super.data(e)}}class Ua{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new oo(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Yc(this._firestore,this._userDataWriter,r.key,r,new oo(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new re(z.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Yc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Yc(s._firestore,s._userDataWriter,a.doc.key,a.doc,new oo(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:ck(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ck(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xe()}}function r$(n,e){return n instanceof $a&&e instanceof $a?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ua&&e instanceof Ua&&n._firestore===e._firestore&&Yw(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(n){n=et(n,tn);const e=et(n.firestore,Tt);return Hw(Gt(e),n._key).then(t=>Lm(e,n,t))}class Vi extends dI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Eo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new tn(this.firestore,null,t)}}function s$(n){n=et(n,tn);const e=et(n.firestore,Tt),t=Gt(e),r=new Vi(e);return jC(t,n._key).then(s=>new $a(e,r,n._key,s,new oo(s!==null&&s.hasLocalMutations,!0),n.converter))}function i$(n){n=et(n,tn);const e=et(n.firestore,Tt);return Hw(Gt(e),n._key,{source:"server"}).then(t=>Lm(e,n,t))}function vt(n){n=et(n,Sn);const e=et(n.firestore,Tt),t=Gt(e),r=new Vi(e);return aI(n._query),Ww(t,n._query).then(s=>new Ua(e,r,n,s))}function o$(n){n=et(n,Sn);const e=et(n.firestore,Tt),t=Gt(e),r=new Vi(e);return BC(t,n._query).then(s=>new Ua(e,r,n,s))}function a$(n){n=et(n,Sn);const e=et(n.firestore,Tt),t=Gt(e),r=new Vi(e);return Ww(t,n._query,{source:"server"}).then(s=>new Ua(e,r,n,s))}function pn(n,e,t){n=et(n,tn);const r=et(n.firestore,Tt),s=wh(n.converter,e,t);return Qu(r,[mh(So(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,qt.none())])}function tl(n,e,t,...r){n=et(n,tn);const s=et(n.firestore,Tt),i=So(s);let o;return o=typeof(e=ke(e))=="string"||e instanceof xo?Vm(i,"updateDoc",n._key,e,t,r):Dm(i,"updateDoc",n._key,e),Qu(s,[o.toMutation(n._key,qt.exists(!0))])}function ja(n){return Qu(et(n.firestore,Tt),[new Wa(n._key,qt.none())])}function Ih(n,e){const t=et(n.firestore,Tt),r=Se(n),s=wh(n.converter,e);return Qu(t,[mh(So(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,qt.exists(!1))]).then(()=>r)}function l$(n,...e){var t,r,s;n=ke(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||up(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(up(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof tn)c=et(n.firestore,Tt),d=Ka(n._key.path),l={next:f=>{e[o]&&e[o](Lm(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=et(n,Sn);c=et(f.firestore,Tt),d=f._query;const g=new Vi(c);l={next:y=>{e[o]&&e[o](new Ua(c,g,f,y))},error:e[o+1],complete:e[o+2]},aI(n._query)}return function(g,y,x,S){const A=new ch(S),j=new vm(y,A,x);return g.asyncQueue.enqueueAndForget(async()=>pm(await Fa(g),j)),()=>{A.Za(),g.asyncQueue.enqueueAndForget(async()=>mm(await Fa(g),j))}}(Gt(c),d,a,l)}function u$(n,e){return zC(Gt(n=et(n,Tt)),up(e)?e:{next:e})}function Qu(n,e){return function(r,s){const i=new wn;return r.asyncQueue.enqueueAndForget(async()=>yC(await xm(r),s,i)),i.promise}(Gt(n),e)}function Lm(n,e,t){const r=t.docs.get(e._key),s=new Vi(n);return new $a(n,s,e._key,r,new oo(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c$(n){return dk(n,{count:uk()})}function dk(n,e){const t=et(n.firestore,Tt),r=Gt(t),s=fb(e,(i,o)=>new qb(o,i.aggregateType,i._internalFieldPath));return qC(r,n._query,s).then(i=>function(a,l,c){const d=new Vi(a);return new tk(l,d,c)}(t,n,i))}class hk{constructor(e){this.kind="memory",this._onlineComponentProvider=Ai.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=xi.provider}toJSON(){return{kind:this.kind}}}class fk{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=yk(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class pk{constructor(){this.kind="memoryEager",this._offlineComponentProvider=xi.provider}toJSON(){return{kind:this.kind}}}class mk{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new NC(e)}}toJSON(){return{kind:this.kind}}}function d$(){return new pk}function h$(n){return new mk(n==null?void 0:n.cacheSizeBytes)}function f$(n){return new hk(n)}function p$(n){return new fk(n)}class gk{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ai.provider,this._offlineComponentProvider={build:t=>new Em(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class vk{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ai.provider,this._offlineComponentProvider={build:t=>new qw(t,e==null?void 0:e.cacheSizeBytes)}}}function yk(n){return new gk(n==null?void 0:n.forceOwnership)}function m$(){return new vk}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=So(e)}set(e,t,r){this._verifyNotCommitted();const s=si(e,this._firestore),i=wh(s.converter,t,r),o=mh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,qt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=si(e,this._firestore);let o;return o=typeof(t=ke(t))=="string"||t instanceof xo?Vm(this._dataReader,"WriteBatch.update",i._key,t,r,s):Dm(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,qt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=si(e,this._firestore);return this._mutations=this._mutations.concat(new Wa(t._key,qt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new re(z.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function si(n,e){if((n=ke(n)).firestore!==e)throw new re(z.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=So(t)}get(t){const r=si(t,this._firestore),s=new lk(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return xe();const o=i[0];if(o.isFoundDocument())return new Iu(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Iu(this._firestore,s,r._key,null,r.converter);throw xe()})}set(t,r,s){const i=si(t,this._firestore),o=wh(i.converter,r,s),a=mh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=si(t,this._firestore);let a;return a=typeof(r=ke(r))=="string"||r instanceof xo?Vm(this._dataReader,"Transaction.update",o._key,r,s,i):Dm(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=si(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=si(e,this._firestore),r=new Vi(this._firestore);return super.get(e).then(s=>new $a(this._firestore,r,t._key,s._document,new oo(!1,!1),t.converter))}}function v$(n,e,t){n=et(n,Tt);const r=Object.assign(Object.assign({},_k),t);return function(i){if(i.maxAttempts<1)throw new re(z.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new wn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await Kw(i);new LC(i.asyncQueue,c,a,o,l).au()}),l.promise}(Gt(n),s=>e(new wk(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y$(){return new Ku("deleteField")}function Ju(){return new Pm("serverTimestamp")}function _$(...n){return new Rm("arrayUnion",n)}function b$(...n){return new Cm("arrayRemove",n)}function w$(n){return new km("increment",n)}function I$(n){return new fh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fm(n){return Gt(n=et(n,Tt)),new bk(n,e=>Qu(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E$(n,e){const t=Gt(n=et(n,Tt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Tr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new re(z.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=My(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=gh("setIndexConfiguration",My(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new co(g,2)):f.order==="ASCENDING"?d.push(new co(g,0)):f.order==="DESCENDING"&&d.push(new co(g,1))}a.push(new Aa(Aa.UNKNOWN_ID,c,d,Sa.empty()))}return a}(e);return HC(t,r)}function My(n,e){if(typeof n[e]!="string")throw new re(z.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function T$(n){var e;n=et(n,Tt);const t=Ly.get(n);if(t)return t;if(((e=Gt(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new Ik(n);return Ly.set(n,r),r}function x$(n){hI(n,!0)}function A$(n){hI(n,!1)}function S$(n){QC(Gt(n._firestore)).then(e=>ne("deleting all persistent cache indexes succeeded")).catch(e=>Tr("deleting all persistent cache indexes failed",e))}function hI(n,e){WC(Gt(n._firestore),e).then(t=>ne(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Tr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const Ly=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P$(n){var e;const t=(e=Gt(et(n.firestore,Tt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:sh(t,jn(n._query))._t}function R$(n,e){var t;const r=fb(e,(i,o)=>new qb(o,i.aggregateType,i._internalFieldPath)),s=(t=Gt(et(n.firestore,Tt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:nw(s,Sb(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C${constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return $m.instance.onExistenceFilterMismatch(e)}}class $m{constructor(){this.Uu=new Map}static get instance(){return Vc||(Vc=new $m,function(t){if(_d)throw new Error("a TestingHooksSpi instance is already set");_d=t}(Vc)),Vc}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let Vc=null;(function(e,t=!0){(function(s){Ga=s})(za),Ta(new po("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Tt(new GP(r.getProvider("auth-internal")),new WP(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new re(z.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mo(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),fi(Av,"4.7.3",e),fi(Av,"4.7.3","esm2017")})();function Um(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k$={PHONE:"phone",TOTP:"totp"},D$={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},V$={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},N$={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},O$={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ek(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function fI(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const M$=Ek,Tk=fI,pI=new Nu("auth","Firebase",fI()),L$={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cd=new Fp("@firebase/auth");function xk(n,...e){Cd.logLevel<=nt.WARN&&Cd.warn(`Auth (${za}): ${n}`,...e)}function Xc(n,...e){Cd.logLevel<=nt.ERROR&&Cd.error(`Auth (${za}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ir(n,...e){throw Bm(n,...e)}function Qn(n,...e){return Bm(n,...e)}function jm(n,e,t){const r=Object.assign(Object.assign({},Tk()),{[e]:t});return new Nu("auth","Firebase",r).create(e,{appName:n.name})}function In(n){return jm(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function nl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&ir(n,"argument-error"),jm(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Bm(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return pI.create(n,...e)}function pe(n,e,...t){if(!n)throw Bm(e,...t)}function Qr(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Xc(e),new Error(e)}function Rs(n,e){n||Qr(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function qm(){return Fy()==="http:"||Fy()==="https:"}function Fy(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ak(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(qm()||IS()||"connection"in navigator)?navigator.onLine:!0}function Sk(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(e,t){this.shortDelay=e,this.longDelay=t,Rs(t>e,"Short delay should be less than long delay!"),this.isMobile=_S()||ES()}get(){return Ak()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(n,e){Rs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Qr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Qr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Qr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk=new Yu(3e4,6e4);function Lt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ft(n,e,t,r,s={}){return gI(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=qa(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return wS()||(c.referrerPolicy="no-referrer"),mI.fetch()(vI(n,n.config.apiHost,t,a),c)})}async function gI(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},Pk),e);try{const s=new kk(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw jl(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw jl(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw jl(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw jl(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw jm(n,d,c);ir(n,d)}}catch(s){if(s instanceof Vs)throw s;ir(n,"network-request-failed",{message:String(s)})}}async function Fs(n,e,t,r,s={}){const i=await Ft(n,e,t,r,s);return"mfaPendingCredential"in i&&ir(n,"multi-factor-auth-required",{_serverResponse:i}),i}function vI(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?zm(n.config,s):`${n.config.apiScheme}://${s}`}function Ck(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class kk{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Qn(this.auth,"network-request-failed")),Rk.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function jl(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Qn(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $y(n){return n!==void 0&&n.getResponse!==void 0}function Uy(n){return n!==void 0&&n.enterprise!==void 0}class yI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Ck(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dk(n){return(await Ft(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function _I(n,e){return Ft(n,"GET","/v2/recaptchaConfig",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n,e){return Ft(n,"POST","/v1/accounts:delete",e)}async function Nk(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function bI(n,e){return Ft(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F$(n,e=!1){return ke(n).getIdToken(e)}async function Ok(n,e=!1){const t=ke(n),r=await t.getIdToken(e),s=Eh(r);pe(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:ru(gf(s.auth_time)),issuedAtTime:ru(gf(s.iat)),expirationTime:ru(gf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function gf(n){return Number(n)*1e3}function Eh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Xc("JWT malformed, contained fewer than 3 sections"),null;try{const s=O0(t);return s?JSON.parse(s):(Xc("Failed to decode base64 JWT payload"),null)}catch(s){return Xc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function jy(n){const e=Eh(n);return pe(e,"internal-error"),pe(typeof e.exp<"u","internal-error"),pe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cs(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Vs&&Mk(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Mk({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lk{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ru(this.lastLoginAt),this.creationTime=ru(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await Cs(n,bI(t,{idToken:r}));pe(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?wI(i.providerUserInfo):[],a=$k(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new cp(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function Fk(n){const e=ke(n);await xu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function $k(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function wI(n){return n.map(e=>{var{providerId:t}=e,r=Um(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uk(n,e){const t=await gI(n,{},async()=>{const r=qa({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=vI(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",mI.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function jk(n,e){return Ft(n,"POST","/v2/accounts:revokeToken",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pe(e.idToken,"internal-error"),pe(typeof e.idToken<"u","internal-error"),pe(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):jy(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){pe(e.length!==0,"internal-error");const t=jy(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(pe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await Uk(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new ga;return r&&(pe(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(pe(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(pe(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ga,this.toJSON())}_performRefresh(){return Qr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xs(n,e){pe(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class _s{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Um(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Lk(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new cp(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Cs(this,this.stsTokenManager.getToken(this.auth,e));return pe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Ok(this,e)}reload(){return Fk(this)}_assign(e){this!==e&&(pe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _s(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){pe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await xu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Zt(this.auth.app))return Promise.reject(In(this.auth));const e=await this.getIdToken();return await Cs(this,Vk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,x=(o=t.photoURL)!==null&&o!==void 0?o:void 0,S=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,j=(c=t.createdAt)!==null&&c!==void 0?c:void 0,F=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:P,emailVerified:q,isAnonymous:X,providerData:ue,stsTokenManager:E}=t;pe(P&&E,e,"internal-error");const w=ga.fromJSON(this.name,E);pe(typeof P=="string",e,"internal-error"),Xs(f,e.name),Xs(g,e.name),pe(typeof q=="boolean",e,"internal-error"),pe(typeof X=="boolean",e,"internal-error"),Xs(y,e.name),Xs(x,e.name),Xs(S,e.name),Xs(A,e.name),Xs(j,e.name),Xs(F,e.name);const I=new _s({uid:P,auth:e,email:g,emailVerified:q,displayName:f,isAnonymous:X,photoURL:x,phoneNumber:y,tenantId:S,stsTokenManager:w,createdAt:j,lastLoginAt:F});return ue&&Array.isArray(ue)&&(I.providerData=ue.map(k=>Object.assign({},k))),A&&(I._redirectEventId=A),I}static async _fromIdTokenResponse(e,t,r=!1){const s=new ga;s.updateFromServerResponse(t);const i=new _s({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await xu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];pe(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?wI(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ga;a.updateFromIdToken(r);const l=new _s({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new cp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const By=new Map;function bs(n){Rs(n instanceof Function,"Expected a class definition");let e=By.get(n);return e?(Rs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,By.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}II.type="NONE";const qy=II;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zc(n,e,t){return`firebase:${n}:${e}:${t}`}class va{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Zc(this.userKey,s.apiKey,i),this.fullPersistenceKey=Zc("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?_s._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new va(bs(qy),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||bs(qy);const o=Zc(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=_s._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new va(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new va(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zy(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(AI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(EI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(PI(e))return"Blackberry";if(RI(e))return"Webos";if(TI(e))return"Safari";if((e.includes("chrome/")||xI(e))&&!e.includes("edge/"))return"Chrome";if(SI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function EI(n=mn()){return/firefox\//i.test(n)}function TI(n=mn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xI(n=mn()){return/crios\//i.test(n)}function AI(n=mn()){return/iemobile/i.test(n)}function SI(n=mn()){return/android/i.test(n)}function PI(n=mn()){return/blackberry/i.test(n)}function RI(n=mn()){return/webos/i.test(n)}function Gm(n=mn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Bk(n=mn()){var e;return Gm(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function qk(){return TS()&&document.documentMode===10}function CI(n=mn()){return Gm(n)||SI(n)||RI(n)||PI(n)||/windows phone/i.test(n)||AI(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kI(n,e=[]){let t;switch(n){case"Browser":t=zy(mn());break;case"Worker":t=`${zy(mn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${za}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gk(n,e={}){return Ft(n,"GET","/v2/passwordPolicy",Lt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=6;class Hk{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Kk,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gy(this),this.idTokenSubscription=new Gy(this),this.beforeStateQueue=new zk(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pI,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=bs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await va.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await bI(this,{idToken:e}),r=await _s._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Zt(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return pe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Sk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Zt(this.app))return Promise.reject(In(this));const t=e?ke(e):null;return t&&pe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&pe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Zt(this.app)?Promise.reject(In(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Zt(this.app)?Promise.reject(In(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(bs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Gk(this),t=new Hk(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Nu("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await jk(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&bs(e)||this._popupRedirectResolver;pe(t,this,"argument-error"),this.redirectPersistenceManager=await va.create(this,[bs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(pe(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=kI(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&xk(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Qt(n){return ke(n)}class Gy{constructor(e){this.auth=e,this.observer=null,this.addObserver=CS(t=>this.observer=t)}get next(){return pe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Qk(n){Xu=n}function Km(n){return Xu.loadJS(n)}function Jk(){return Xu.recaptchaV2Script}function Yk(){return Xu.recaptchaEnterpriseScript}function Xk(){return Xu.gapiScript}function DI(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const Zk="recaptcha-enterprise",eD="NO_RECAPTCHA";class VI{constructor(e){this.type=Zk,this.auth=Qt(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{_I(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new yI(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;Uy(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(eD)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&Uy(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=Yk();l.length!==0&&(l+=a),Km(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Ky(n,e,t,r=!1){const s=new VI(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Au(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Ky(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Ky(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function tD(n){const e=Qt(n),t=await _I(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new yI(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new VI(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nD(n,e){const t=Ou(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(_i(i,e??{}))return s;ir(s,"already-initialized")}return t.initialize({options:e})}function rD(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(bs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function sD(n,e,t){const r=Qt(n);pe(r._canInitEmulator,r,"emulator-config-failed"),pe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=NI(e),{host:o,port:a}=iD(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||oD()}function NI(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function iD(n){const e=NI(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Hy(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Hy(o)}}}function Hy(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function oD(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Qr("not implemented")}_getIdTokenResponse(e){return Qr("not implemented")}_linkToIdToken(e,t){return Qr("not implemented")}_getReauthenticationResolver(e){return Qr("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OI(n,e){return Ft(n,"POST","/v1/accounts:resetPassword",Lt(n,e))}async function aD(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function lD(n,e){return Ft(n,"POST","/v1/accounts:signUp",e)}async function uD(n,e){return Ft(n,"POST","/v1/accounts:update",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cD(n,e){return Fs(n,"POST","/v1/accounts:signInWithPassword",Lt(n,e))}async function Th(n,e){return Ft(n,"POST","/v1/accounts:sendOobCode",Lt(n,e))}async function dD(n,e){return Th(n,e)}async function hD(n,e){return Th(n,e)}async function fD(n,e){return Th(n,e)}async function pD(n,e){return Th(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mD(n,e){return Fs(n,"POST","/v1/accounts:signInWithEmailLink",Lt(n,e))}async function gD(n,e){return Fs(n,"POST","/v1/accounts:signInWithEmailLink",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su extends Zu{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Su(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Su(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Au(e,t,"signInWithPassword",cD);case"emailLink":return mD(e,{email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Au(e,r,"signUpPassword",lD);case"emailLink":return gD(e,{idToken:t,email:this._email,oobCode:this._password});default:ir(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Es(n,e){return Fs(n,"POST","/v1/accounts:signInWithIdp",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vD="http://localhost";class ks extends Zu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ks(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ir("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Um(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ks(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Es(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Es(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Es(e,t)}buildRequest(){const e={requestUri:vD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=qa(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yD(n,e){return Ft(n,"POST","/v1/accounts:sendVerificationCode",Lt(n,e))}async function _D(n,e){return Fs(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,e))}async function bD(n,e){const t=await Fs(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,e));if(t.temporaryProof)throw jl(n,"account-exists-with-different-credential",t);return t}const wD={USER_NOT_FOUND:"user-not-found"};async function ID(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Fs(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,t),wD)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho extends Zu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ho({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ho({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return _D(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return bD(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return ID(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new ho({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ED(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function TD(n){const e=Ol(Ml(n)).link,t=e?Ol(Ml(e)).deep_link_id:null,r=Ol(Ml(n)).deep_link_id;return(r?Ol(Ml(r)).link:null)||r||t||e||n}class ec{constructor(e){var t,r,s,i,o,a;const l=Ol(Ml(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=ED((s=l.mode)!==null&&s!==void 0?s:null);pe(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=TD(e);try{return new ec(t)}catch{return null}}}function $$(n){return ec.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(){this.providerId=Ro.PROVIDER_ID}static credential(e,t){return Su._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=ec.parseLink(t);return pe(r,"argument-error"),Su._fromEmailAndCode(e,r.code,r.tenantId)}}Ro.PROVIDER_ID="password";Ro.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ro.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl extends $s{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ed extends rl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return pe("providerId"in t&&"signInMethod"in t,"argument-error"),ks._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return pe(e.idToken||e.accessToken,"argument-error"),ks._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ed.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ed.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new ed(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii extends rl{constructor(){super("facebook.com")}static credential(e){return ks._fromParams({providerId:ii.PROVIDER_ID,signInMethod:ii.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ii.credentialFromTaggedObject(e)}static credentialFromError(e){return ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ii.credential(e.oauthAccessToken)}catch{return null}}}ii.FACEBOOK_SIGN_IN_METHOD="facebook.com";ii.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi extends rl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ks._fromParams({providerId:oi.PROVIDER_ID,signInMethod:oi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return oi.credentialFromTaggedObject(e)}static credentialFromError(e){return oi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return oi.credential(t,r)}catch{return null}}}oi.GOOGLE_SIGN_IN_METHOD="google.com";oi.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai extends rl{constructor(){super("github.com")}static credential(e){return ks._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ai.credential(e.oauthAccessToken)}catch{return null}}}ai.GITHUB_SIGN_IN_METHOD="github.com";ai.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD="http://localhost";class Pu extends Zu{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Es(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Es(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Es(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Pu(r,i)}static _create(e,t){return new Pu(e,t)}buildRequest(){return{requestUri:xD,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD="saml.";class dp extends $s{constructor(e){pe(e.startsWith(AD),"argument-error"),super(e)}static credentialFromResult(e){return dp.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return dp.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Pu.fromJSON(e);return pe(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Pu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li extends rl{constructor(){super("twitter.com")}static credential(e,t){return ks._fromParams({providerId:li.PROVIDER_ID,signInMethod:li.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return li.credentialFromTaggedObject(e)}static credentialFromError(e){return li.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return li.credential(t,r)}catch{return null}}}li.TWITTER_SIGN_IN_METHOD="twitter.com";li.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MI(n,e){return Fs(n,"POST","/v1/accounts:signUp",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await _s._fromIdTokenResponse(e,r,s),o=Wy(r);return new xr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Wy(r);return new xr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Wy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SD(n){var e;if(Zt(n.app))return Promise.reject(In(n));const t=Qt(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new xr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await MI(t,{returnSecureToken:!0}),s=await xr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd extends Vs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,kd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new kd(e,t,r,s)}}function LI(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?kd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FI(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U$(n,e){const t=ke(n);await xh(!0,t,e);const{providerUserInfo:r}=await Nk(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=FI(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Hm(n,e,t=!1){const r=await Cs(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return xr._forOperation(n,"link",r)}async function xh(n,e,t){await xu(e);const r=FI(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";pe(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $I(n,e,t=!1){const{auth:r}=n;if(Zt(r.app))return Promise.reject(In(r));const s="reauthenticate";try{const i=await Cs(n,LI(r,s,e,n),t);pe(i.idToken,r,"internal-error");const o=Eh(i.idToken);pe(o,r,"internal-error");const{sub:a}=o;return pe(n.uid===a,r,"user-mismatch"),xr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ir(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UI(n,e,t=!1){if(Zt(n.app))return Promise.reject(In(n));const r="signIn",s=await LI(n,r,e),i=await xr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Wm(n,e){return UI(Qt(n),e)}async function PD(n,e){const t=ke(n);return await xh(!1,t,e.providerId),Hm(t,e)}async function RD(n,e){return $I(ke(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CD(n,e){return Fs(n,"POST","/v1/accounts:signInWithCustomToken",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j$(n,e){if(Zt(n.app))return Promise.reject(In(n));const t=Qt(n),r=await CD(t,{token:e,returnSecureToken:!0}),s=await xr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Qm._fromServerResponse(e,t):"totpInfo"in t?Jm._fromServerResponse(e,t):ir(e,"internal-error")}}class Qm extends tc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Qm(t)}}class Jm extends tc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Jm(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ah(n,e,t){var r;pe(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),pe(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(pe(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(pe(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ym(n){const e=Qt(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function kD(n,e,t){const r=Qt(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Ah(r,s,t),await Au(r,s,"getOobCode",hD)}async function DD(n,e,t){await OI(ke(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ym(n),r})}async function B$(n,e){await uD(ke(n),{oobCode:e})}async function VD(n,e){const t=ke(n),r=await OI(t,{oobCode:e}),s=r.requestType;switch(pe(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":pe(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":pe(r.mfaInfo,t,"internal-error");default:pe(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=tc._fromServerResponse(Qt(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function q$(n,e){const{data:t}=await VD(ke(n),e);return t.email}async function ND(n,e,t){if(Zt(n.app))return Promise.reject(In(n));const r=Qt(n),o=await Au(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",MI).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Ym(n),l}),a=await xr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function OD(n,e,t){return Zt(n.app)?Promise.reject(In(n)):Wm(ke(n),Ro.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ym(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z$(n,e,t){const r=Qt(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){pe(a.handleCodeInApp,r,"argument-error"),a&&Ah(r,o,a)}i(s,t),await Au(r,s,"getOobCode",fD)}function G$(n,e){const t=ec.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function K$(n,e,t){if(Zt(n.app))return Promise.reject(In(n));const r=ke(n),s=Ro.credentialWithLink(e,t||Tu());return pe(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Wm(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MD(n,e){return Ft(n,"POST","/v1/accounts:createAuthUri",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H$(n,e){const t=qm()?Tu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await MD(ke(n),r);return s||[]}async function W$(n,e){const t=ke(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Ah(t.auth,s,e);const{email:i}=await dD(t.auth,s);i!==n.email&&await n.reload()}async function Q$(n,e,t){const r=ke(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Ah(r.auth,i,t);const{email:o}=await pD(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LD(n,e){return Ft(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J$(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=ke(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Cs(r,LD(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function FD(n,e){const t=ke(n);return Zt(t.auth.app)?Promise.reject(In(t.auth)):jI(t,e,null)}function $D(n,e){return jI(ke(n),null,e)}async function jI(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Cs(n,aD(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UD(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Eh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ya(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new jD(i,s);case"github.com":return new BD(i,s);case"google.com":return new qD(i,s);case"twitter.com":return new zD(i,s,n.screenName||null);case"custom":case"anonymous":return new ya(i,null);default:return new ya(i,r,s)}}class ya{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class BI extends ya{constructor(e,t,r,s){super(e,t,r),this.username=s}}class jD extends ya{constructor(e,t){super(e,"facebook.com",t)}}class BD extends BI{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class qD extends ya{constructor(e,t){super(e,"google.com",t)}}class zD extends BI{constructor(e,t,r){super(e,"twitter.com",t,r)}}function Y$(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:UD(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GD(n,e){return ke(n).setPersistence(e)}function X$(n){return tD(n)}async function Z$(n,e){return Qt(n).validatePassword(e)}function KD(n,e,t,r){return ke(n).onIdTokenChanged(e,t,r)}function HD(n,e,t){return ke(n).beforeAuthStateChanged(e,t)}function WD(n,e,t,r){return ke(n).onAuthStateChanged(e,t,r)}function eU(n){ke(n).useDeviceLanguage()}function tU(n,e){return ke(n).updateCurrentUser(e)}function QD(n){return ke(n).signOut()}function nU(n,e){return Qt(n).revokeAccessToken(e)}async function rU(n){return ke(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new ao("enroll",e,t)}static _fromMfaPendingCredential(e){return new ao("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return ao._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return ao._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Qt(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>tc._fromServerResponse(r,a));pe(s.mfaPendingCredential,r,"internal-error");const o=ao._fromMfaPendingCredential(s.mfaPendingCredential);return new Xm(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await xr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return pe(t.user,r,"internal-error"),xr._forOperation(t.user,t.operationType,c);default:ir(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function sU(n,e){var t;const r=ke(n),s=e;return pe(e.customData.operationType,r,"argument-error"),pe((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Xm._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JD(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Lt(n,e))}function YD(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Lt(n,e))}function XD(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Lt(n,e))}function ZD(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Lt(n,e))}function e2(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Lt(n,e))}class Zm{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>tc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Zm(e)}async getSession(){return ao._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Cs(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Cs(this.user,e2(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const vf=new WeakMap;function iU(n){const e=ke(n);return vf.has(e)||vf.set(e,Zm._fromUser(e)),vf.get(e)}const Dd="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Dd,"1"),this.storage.removeItem(Dd),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t2=1e3,n2=10;class zI extends qI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=CI(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);qk()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,n2):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},t2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zI.type="LOCAL";const GI=zI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KI extends qI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}KI.type="SESSION";const HI=KI;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r2(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Sh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await r2(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ph(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Ph("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function an(){return window}function i2(n){an().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eg(){return typeof an().WorkerGlobalScope<"u"&&typeof an().importScripts=="function"}async function o2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function a2(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function l2(){return eg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WI="firebaseLocalStorageDb",u2=1,Vd="firebaseLocalStorage",QI="fbase_key";class nc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Rh(n,e){return n.transaction([Vd],e?"readwrite":"readonly").objectStore(Vd)}function c2(){const n=indexedDB.deleteDatabase(WI);return new nc(n).toPromise()}function hp(){const n=indexedDB.open(WI,u2);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Vd,{keyPath:QI})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Vd)?e(r):(r.close(),await c2(),e(await hp()))})})}async function Qy(n,e,t){const r=Rh(n,!0).put({[QI]:e,value:t});return new nc(r).toPromise()}async function d2(n,e){const t=Rh(n,!1).get(e),r=await new nc(t).toPromise();return r===void 0?null:r.value}function Jy(n,e){const t=Rh(n,!0).delete(e);return new nc(t).toPromise()}const h2=800,f2=3;class JI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await hp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>f2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return eg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sh._getInstance(l2()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await o2(),!this.activeServiceWorker)return;this.sender=new s2(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||a2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await hp();return await Qy(e,Dd,"1"),await Jy(e,Dd),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Qy(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>d2(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Jy(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Rh(s,!1).getAll();return new nc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),h2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}JI.type="LOCAL";const p2=JI;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m2(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:start",Lt(n,e))}function g2(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Lt(n,e))}function v2(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2=500,_2=6e4,Nc=1e12;class b2{constructor(e){this.auth=e,this.counter=Nc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new w2(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Nc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Nc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Nc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class w2{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;pe(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=I2(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},_2)},y2))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function I2(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yf=DI("rcb"),E2=new Yu(3e4,6e4);class T2{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=an().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return pe(x2(t),e,"argument-error"),this.shouldResolveImmediately(t)&&$y(an().grecaptcha)?Promise.resolve(an().grecaptcha):new Promise((r,s)=>{const i=an().setTimeout(()=>{s(Qn(e,"network-request-failed"))},E2.get());an()[yf]=()=>{an().clearTimeout(i),delete an()[yf];const a=an().grecaptcha;if(!a||!$y(a)){s(Qn(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${Jk()}?${qa({onload:yf,render:"explicit",hl:t})}`;Km(o).catch(()=>{clearTimeout(i),s(Qn(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=an().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function x2(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class A2{async load(e){return new b2(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YI="recaptcha",S2={theme:"light",type:"image"};class oU{constructor(e,t,r=Object.assign({},S2)){this.parameters=r,this.type=YI,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Qt(e),this.isInvisible=this.parameters.size==="invisible",pe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;pe(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new A2:new T2,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){pe(!this.parameters.sitekey,this.auth,"argument-error"),pe(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),pe(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=an()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){pe(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){pe(qm()&&!eg(),this.auth,"internal-error"),await P2(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await Dk(this.auth);pe(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return pe(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function P2(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tg{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ho._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function aU(n,e,t){if(Zt(n.app))return Promise.reject(In(n));const r=Qt(n),s=await Ch(r,e,ke(t));return new tg(s,i=>Wm(r,i))}async function lU(n,e,t){const r=ke(n);await xh(!1,r,"phone");const s=await Ch(r.auth,e,ke(t));return new tg(s,i=>PD(r,i))}async function uU(n,e,t){const r=ke(n);if(Zt(r.auth.app))return Promise.reject(In(r.auth));const s=await Ch(r.auth,e,ke(t));return new tg(s,i=>RD(r,i))}async function Ch(n,e,t){var r;const s=await t.verify();try{pe(typeof s=="string",n,"argument-error"),pe(t.type===YI,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return pe(o.type==="enroll",n,"internal-error"),(await JD(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{pe(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return pe(a,n,"missing-multi-factor-info"),(await m2(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await yD(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function cU(n,e){const t=ke(n);if(Zt(t.auth.app))return Promise.reject(In(t.auth));await Hm(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{constructor(e){this.providerId=_a.PROVIDER_ID,this.auth=Qt(e)}verifyPhoneNumber(e,t){return Ch(this.auth,e,ke(t))}static credential(e,t){return ho._fromVerification(e,t)}static credentialFromResult(e){const t=e;return _a.credentialFromTaggedObject(t)}static credentialFromError(e){return _a.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ho._fromTokenResponse(t,r):null}}_a.PROVIDER_ID="phone";_a.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Co(n,e){return e?bs(e):(pe(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng extends Zu{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Es(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Es(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Es(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function R2(n){return UI(n.auth,new ng(n),n.bypassAuthState)}function C2(n){const{auth:e,user:t}=n;return pe(t,e,"internal-error"),$I(t,new ng(n),n.bypassAuthState)}async function k2(n){const{auth:e,user:t}=n;return pe(t,e,"internal-error"),Hm(t,new ng(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return R2;case"linkViaPopup":case"linkViaRedirect":return k2;case"reauthViaPopup":case"reauthViaRedirect":return C2;default:ir(this.auth,"internal-error")}}resolve(e){Rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D2=new Yu(2e3,1e4);async function dU(n,e,t){if(Zt(n.app))return Promise.reject(Qn(n,"operation-not-supported-in-this-environment"));const r=Qt(n);nl(n,e,$s);const s=Co(r,t);return new ws(r,"signInViaPopup",e,s).executeNotNull()}async function hU(n,e,t){const r=ke(n);if(Zt(r.auth.app))return Promise.reject(Qn(r.auth,"operation-not-supported-in-this-environment"));nl(r.auth,e,$s);const s=Co(r.auth,t);return new ws(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function fU(n,e,t){const r=ke(n);nl(r.auth,e,$s);const s=Co(r.auth,t);return new ws(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class ws extends XI{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ws.currentPopupAction&&ws.currentPopupAction.cancel(),ws.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return pe(e,this.auth,"internal-error"),e}async onExecution(){Rs(this.filter.length===1,"Popup operations only handle one event");const e=Ph();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Qn(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Qn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ws.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qn(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,D2.get())};e()}}ws.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2="pendingRedirect",td=new Map;class N2 extends XI{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=td.get(this.auth._key());if(!e){try{const r=await O2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}td.set(this.auth._key(),e)}return this.bypassAuthState||td.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function O2(n,e){const t=eE(e),r=ZI(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function rg(n,e){return ZI(n)._set(eE(e),"true")}function M2(n,e){td.set(n._key(),e)}function ZI(n){return bs(n._redirectPersistence)}function eE(n){return Zc(V2,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pU(n,e,t){return L2(n,e,t)}async function L2(n,e,t){if(Zt(n.app))return Promise.reject(In(n));const r=Qt(n);nl(n,e,$s),await r._initializationPromise;const s=Co(r,t);return await rg(s,r),s._openRedirect(r,e,"signInViaRedirect")}function mU(n,e,t){return F2(n,e,t)}async function F2(n,e,t){const r=ke(n);if(nl(r.auth,e,$s),Zt(r.auth.app))return Promise.reject(In(r.auth));await r.auth._initializationPromise;const s=Co(r.auth,t);await rg(s,r.auth);const i=await nE(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function gU(n,e,t){return $2(n,e,t)}async function $2(n,e,t){const r=ke(n);nl(r.auth,e,$s),await r.auth._initializationPromise;const s=Co(r.auth,t);await xh(!1,r,e.providerId),await rg(s,r.auth);const i=await nE(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function vU(n,e){return await Qt(n)._initializationPromise,tE(n,e,!1)}async function tE(n,e,t=!1){if(Zt(n.app))return Promise.reject(In(n));const r=Qt(n),s=Co(r,e),o=await new N2(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function nE(n){const e=Ph(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U2=10*60*1e3;class j2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!B2(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!rE(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Qn(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=U2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Yy(e))}saveEventToCache(e){this.cachedEventUids.add(Yy(e)),this.lastProcessedEventTime=Date.now()}}function Yy(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function rE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function B2(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rE(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q2(n,e={}){return Ft(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,G2=/^https?/;async function K2(n){if(n.config.emulator)return;const{authorizedDomains:e}=await q2(n);for(const t of e)try{if(H2(t))return}catch{}ir(n,"unauthorized-domain")}function H2(n){const e=Tu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!G2.test(t))return!1;if(z2.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2=new Yu(3e4,6e4);function Xy(){const n=an().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function Q2(n){return new Promise((e,t)=>{var r,s,i;function o(){Xy(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Xy(),t(Qn(n,"network-request-failed"))},timeout:W2.get()})}if(!((s=(r=an().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=an().gapi)===null||i===void 0)&&i.load)o();else{const a=DI("iframefcb");return an()[a]=()=>{gapi.load?o():t(Qn(n,"network-request-failed"))},Km(`${Xk()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw nd=null,e})}let nd=null;function J2(n){return nd=nd||Q2(n),nd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2=new Yu(5e3,15e3),X2="__/auth/iframe",Z2="emulator/auth/iframe",eV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function nV(n){const e=n.config;pe(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?zm(e,Z2):`https://${n.config.authDomain}/${X2}`,r={apiKey:e.apiKey,appName:n.name,v:za},s=tV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${qa(r).slice(1)}`}async function rV(n){const e=await J2(n),t=an().gapi;return pe(t,n,"internal-error"),e.open({where:document.body,url:nV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:eV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Qn(n,"network-request-failed"),a=an().setTimeout(()=>{i(o)},Y2.get());function l(){an().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},iV=500,oV=600,aV="_blank",lV="http://localhost";class Zy{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function uV(n,e,t,r=iV,s=oV){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},sV),{width:r.toString(),height:s.toString(),top:i,left:o}),c=mn().toLowerCase();t&&(a=xI(c)?aV:t),EI(c)&&(e=e||lV,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[y,x])=>`${g}${y}=${x},`,"");if(Bk(c)&&a!=="_self")return cV(e||"",a),new Zy(null);const f=window.open(e||"",a,d);pe(f,n,"popup-blocked");try{f.focus()}catch{}return new Zy(f)}function cV(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dV="__/auth/handler",hV="emulator/auth/handler",fV=encodeURIComponent("fac");async function e_(n,e,t,r,s,i){pe(n.config.authDomain,n,"auth-domain-config-required"),pe(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:za,eventId:s};if(e instanceof $s){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",RS(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof rl){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${fV}=${encodeURIComponent(l)}`:"";return`${pV(n)}?${qa(a).slice(1)}${c}`}function pV({config:n}){return n.emulator?zm(n,hV):`https://${n.authDomain}/${dV}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _f="webStorageSupport";class mV{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=HI,this._completeRedirectFn=tE,this._overrideRedirectResult=M2}async _openPopup(e,t,r,s){var i;Rs((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await e_(e,t,r,Tu(),s);return uV(e,o,Ph())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await e_(e,t,r,Tu(),s);return i2(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Rs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await rV(e),r=new j2(e);return t.register("authEvent",s=>(pe(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_f,{type:_f},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[_f];o!==void 0&&t(!!o),ir(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=K2(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return CI()||TI()||Gm()}}const gV=mV;class sE{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Qr("unexpected MultiFactorSessionType")}}}class sg extends sE{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new sg(e)}_finalizeEnroll(e,t,r){return YD(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return g2(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class vV{constructor(){}static assertion(e){return sg._fromCredential(e)}}vV.FACTOR_ID="phone";class yV{static assertionForEnrollment(e,t){return Ru._fromSecret(e,t)}static assertionForSignIn(e,t){return Ru._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;pe(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await XD(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return ig._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}yV.FACTOR_ID="totp";class Ru extends sE{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Ru(t,void 0,e)}static _fromEnrollmentId(e,t){return new Ru(t,e)}async _finalizeEnroll(e,t,r){return pe(typeof this.secret<"u",e,"argument-error"),ZD(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){pe(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return v2(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class ig{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new ig(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(Oc(e)||Oc(t))&&(s=!0),s&&(Oc(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),Oc(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Oc(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var t_="@firebase/auth",n_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){pe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bV(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function wV(n){Ta(new po("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;pe(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:kI(n)},c=new Wk(r,s,i,l);return rD(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ta(new po("auth-internal",e=>{const t=Qt(e.getProvider("auth").getImmediate());return(r=>new _V(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),fi(t_,n_,bV(n)),fi(t_,n_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IV=5*60,EV=F0("authIdTokenMaxAge")||IV;let r_=null;const TV=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>EV)return;const s=t==null?void 0:t.token;r_!==s&&(r_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function xV(n=z0()){const e=Ou(n,"auth");if(e.isInitialized())return e.getImmediate();const t=nD(n,{popupRedirectResolver:gV,persistence:[p2,GI,HI]}),r=F0("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=TV(i.toString());HD(t,o,()=>o(t.currentUser)),KD(t,a=>o(a))}}const s=M0("auth");return s&&sD(t,`http://${s}`),t}function AV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Qk({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Qn("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",AV().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});wV("Browser");const SV={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},iE=q0(SV),ae=ZC(iE),ln=xV(iE);try{ek(ae)}catch{}try{GD(ln,GI)}catch{}WD(ln,n=>{n||SD(ln)});async function PV(n,e){try{return(await ND(ln,n,e)).user}catch(t){throw t}}async function oE(n,e){try{return(await OD(ln,n,e)).user}catch(t){throw t}}async function aE(n){try{await kD(ln,n)}catch(e){throw e}}async function RV(n){try{const e=ln.currentUser;if(e)await $D(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const pi=Object.freeze(Object.defineProperty({__proto__:null,auth:ln,createPlayerAccount:PV,db:ae,resetPlayerPassword:aE,signInPlayer:oE,updatePlayerPassword:RV},Symbol.toStringTag,{value:"Module"})),sl="seasons";async function CV(n,e,t){return await Ih(Qe(ae,sl),{name:n,slug:e,pinCode:t,createdAt:Ju()})}async function kV(n){return await ja(Se(ae,sl,n))}async function bf(){const n=Eu(Qe(ae,sl),ak("createdAt","desc"));return(await vt(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Nd(n,e){const t=await Pn(Se(ae,sl,n));return t.exists()?t.data().pinCode===e:!1}async function fp(n){const e=await Pn(Se(ae,sl,n));return e.exists()?e.data().pinCode:null}async function Dl(n,e){const t=Se(ae,sl,n);await tl(t,{sortOrder:e})}const wf=7*24*60*60*1e3,Vl="impro_selector_pin_session";class DV{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(Vl);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<wf){try{t.timestamp=Date.now(),localStorage.setItem(Vl,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(Vl,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<wf;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(Vl,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(Vl),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=wf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const tr=new DV,VV={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},NV={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},OV={class:"text-center mb-6"},MV={class:"text-gray-300"},LV={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},FV={class:"text-sm text-green-400"},$V={class:"mb-6"},UV={class:"mb-4"},jV={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},BV={class:"flex justify-end space-x-3"},qV=["disabled"],lE={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(""),o=N(null);Ot(()=>t.show,d=>{d&&(s.value="",i.value="",hn(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(M(),L("div",VV,[h("div",NV,[h("div",OV,[f[1]||(f[1]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),h("p",MV,oe(n.message),1),n.sessionInfo?(M(),L("div",LV,[h("p",FV," Session active : "+oe(n.sessionInfo.timeRemaining)+" min restantes ",1)])):le("",!0)]),h("div",$V,[h("div",UV,[f[3]||(f[3]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),it(h("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Nn(l,["enter"]),Nn(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Rt,s.value]])]),f[4]||(f[4]=h("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(M(),L("div",jV,oe(i.value||t.error),1)):le("",!0),h("div",BV,[h("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,qV)])])])):le("",!0)}},zV={class:"relative p-6 pb-4 border-b border-white/10"},GV={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},uE={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Nt(()=>{},["stop"]))},[h("div",zV,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),h("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=lr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),h("div",GV,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):le("",!0)}},KV=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function HV(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function cE(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function WV(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function dE(n){if(!n)return!1;const e=String(n).toLowerCase();return KV.some(t=>e.includes(t.toLowerCase()))}function pp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?WV(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>pp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=dE(t)?"••••":pp(r);return e}return n}function QV(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&dE(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(pp(r))}return e}const JV=cE(HV());function Mc(n,e){const t=cE(n);return(...r)=>{if(t<JV)return;const s=QV(r);console[e](...s)}}const ve={debug:Mc("debug","log"),info:Mc("info","info"),warn:Mc("warn","warn"),error:Mc("error","error")},YV={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},XV={class:"text-center py-16 px-4 relative"},ZV=["aria-busy"],eN={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},tN={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},nN=["onClick"],rN={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},sN={class:"absolute top-4 right-4"},iN=["onClick","aria-expanded"],oN={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},aN=["onClick"],lN=["onClick"],uN=["onClick"],cN={key:2,class:"flex justify-center mt-12"},dN={key:3,class:"text-center py-16"},hN={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},fN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},pN={class:"mb-6"},mN={class:"mb-6"},gN={class:"mb-6"},vN={class:"flex justify-end space-x-3"},yN=["disabled"],_N={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},bN={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},wN={class:"text-center mb-6"},IN={class:"text-gray-300"},EN={__name:"Home",setup(n){const e=N([]),t=N(!0),r=Vu(),s=N(null),i=N(!1),o=N(!1),a=N(""),l=N(""),c=N(""),d=N(null),f=N(!1),g=N(null),y=N(""),x=N(!1);wr(async()=>{var De;try{e.value=await bf(),ve.info("Saisons chargées",{count:((De=e.value)==null?void 0:De.length)||0}),P().catch(te=>ve.error("Migration sortOrder échouée",te))}finally{t.value=!1}});const S=ze(()=>[...e.value].sort((De,te)=>{var Je,Ze;const Ve=typeof De.sortOrder=="number"?De.sortOrder:Number.MAX_SAFE_INTEGER,W=typeof te.sortOrder=="number"?te.sortOrder:Number.MAX_SAFE_INTEGER;if(Ve!==W)return Ve-W;const Y=(Je=De.createdAt)!=null&&Je.toMillis?De.createdAt.toMillis():0,Ne=(Ze=te.createdAt)!=null&&Ze.toMillis?te.createdAt.toMillis():0;return Y!==Ne?Ne-Y:(De.name||"").localeCompare(te.name||"")}));function A(De){r.push(`/season/${De}`)}function j(De){s.value=s.value===De?null:De}function F(){s.value=null}async function P(){if(!e.value.length)return;const De=e.value.map(Ve=>typeof Ve.sortOrder=="number"?Ve.sortOrder:null).filter(Ve=>Ve!==null);let te=De.length?Math.max(...De):0;for(const Ve of e.value)if(typeof Ve.sortOrder!="number"){te+=1;try{await Dl(Ve.id,te),Ve.sortOrder=te}catch(W){ve.error("Erreur migration sortOrder",{seasonName:Ve==null?void 0:Ve.name,error:W})}}}async function q(De){if(F(),De<=0)return;const te=[...S.value],Ve=te[De],W=te[De-1],Y=Ve.sortOrder;Ve.sortOrder=W.sortOrder,W.sortOrder=Y;try{await Promise.all([Dl(Ve.id,Ve.sortOrder),Dl(W.id,W.sortOrder)])}catch(Ne){ve.error("Erreur lors du déplacement vers le haut",Ne)}}async function X(De){F();const te=[...S.value];if(De>=te.length-1)return;const Ve=te[De],W=te[De+1],Y=Ve.sortOrder;Ve.sortOrder=W.sortOrder,W.sortOrder=Y;try{await Promise.all([Dl(Ve.id,Ve.sortOrder),Dl(W.id,W.sortOrder)])}catch(Ne){ve.error("Erreur lors du déplacement vers le bas",Ne)}}function ue(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function E(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function w(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await CV(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await bf(),await P(),I()}catch(De){ve.error("Erreur lors de la création de la saison",De),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function I(){i.value=!1,a.value="",l.value="",c.value=""}function k(De){d.value=De,o.value=!0}async function D(){o.value=!1,await Dt({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function $(){o.value=!1,d.value=null}function R(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Dt(De){if(tr.isPinCached(d.value.id)){const te=tr.getCachedPin(d.value.id);if(ve.debug("PIN en cache trouvé, utilisation automatique"),await Nd(d.value.id,te)){await Ue(De);return}else tr.clearSession()}g.value=De,f.value=!0}async function xt(De){var te,Ve,W,Y;ve.debug("PIN soumis pour l'opération",{operationType:(te=g.value)==null?void 0:te.type});try{const Ne=((W=(Ve=g.value)==null?void 0:Ve.data)==null?void 0:W.seasonId)||((Y=d.value)==null?void 0:Y.id),Je=await Nd(Ne,De);if(ve.debug("PIN validé",{valid:Je}),Je){tr.saveSession(Ne,De),ve.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const Ze=g.value;g.value=null,ve.debug("Appel de executePendingOperation",{operationType:Ze==null?void 0:Ze.type}),await Ue(Ze)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(Ne){ve.error("Erreur lors de la vérification du PIN",Ne),y.value="Erreur lors de la vérification du code PIN"}}function tt(){f.value=!1,g.value=null,y.value=""}function $e(){return d.value&&tr.isPinCached(d.value.id)?{timeRemaining:tr.getTimeRemaining(),isExpiringSoon:tr.isExpiringSoon()}:null}async function Ue(De){var W;if(ve.debug("executePendingOperation appelé",{hasOperation:!!De}),!De){ve.warn("Aucune opération à exécuter");return}const{type:te,data:Ve}=De;ve.info("Exécution de l'opération",{type:te});try{switch(te){case"deleteSeason":ve.info("Suppression de la saison",{seasonId:Ve.seasonId}),await kV(Ve.seasonId),ve.info("Saison supprimée, rechargement de la liste"),e.value=await bf(),ve.info("Liste des saisons rechargée",{count:((W=e.value)==null?void 0:W.length)||0});break;default:ve.warn("Type d'opération non reconnu",{type:te})}}catch(Y){ve.error("Erreur lors de l'exécution de l'opération",Y),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(De,te)=>{var Ve;return M(),L("div",YV,[h("div",XV,[h("button",{onClick:te[0]||(te[0]=W=>x.value=!0),class:"absolute right-4 top-4 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},te[8]||(te[8]=[h("span",{class:"text-2xl"},"❓",-1)])),te[9]||(te[9]=h("h1",{class:"text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent animate-pulse"}," Tu joues quand ? ",-1)),te[10]||(te[10]=h("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto leading-relaxed"},"Arrêtez de vous prendre la tête pour savoir qui sera sur scène quand. Laissez chacun indiquer ses dispos et le hasard choisir pour vous !",-1))]),h("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(M(),L("div",eN,[(M(),L(_t,null,ur(8,W=>h("div",{key:"skeleton-"+W,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},te[11]||(te[11]=[h("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),h("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),h("div",{class:"h-px bg-white/10 mb-4"},null,-1),h("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(M(),L("div",tN,[(M(!0),L(_t,null,ur(S.value,(W,Y)=>(M(),L("div",{key:W.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[h("div",{onClick:Ne=>A(W.slug),class:"text-center cursor-pointer"},[te[12]||(te[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[h("span",{class:"text-2xl"},"🎭")],-1)),h("h2",rN,oe(W.name),1),te[13]||(te[13]=h("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),te[14]||(te[14]=h("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,nN),h("div",sN,[h("div",{class:"relative",onClick:te[1]||(te[1]=Nt(()=>{},["stop"]))},[h("button",{onClick:Ne=>j(Y),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Y,"aria-haspopup":"true",title:"Options"},te[15]||(te[15]=[h("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,iN),s.value===Y?(M(),L("div",oN,[h("button",{onClick:Ne=>q(Y),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,aN),h("button",{onClick:Ne=>X(Y),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,lN),te[16]||(te[16]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:Ne=>k(W),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,uN)])):le("",!0)])])]))),128))])):le("",!0),!t.value&&e.value.length>0?(M(),L("div",cN,[h("button",{onClick:te[2]||(te[2]=W=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105"}," ✨ Nouvelle saison ")])):le("",!0),!t.value&&e.value.length===0?(M(),L("div",dN,[te[17]||(te[17]=h("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-4xl"},"🎪")],-1)),te[18]||(te[18]=h("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),te[19]||(te[19]=h("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),h("button",{onClick:te[3]||(te[3]=W=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):le("",!0)],8,ZV),i.value?(M(),L("div",hN,[h("div",fN,[te[24]||(te[24]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),h("div",pN,[te[20]||(te[20]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),it(h("input",{"onUpdate:modelValue":te[4]||(te[4]=W=>a.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:ue},null,544),[[Rt,a.value]])]),h("div",mN,[te[21]||(te[21]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),it(h("input",{"onUpdate:modelValue":te[5]||(te[5]=W=>l.value=W),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Rt,l.value]])]),h("div",gN,[te[22]||(te[22]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),it(h("input",{"onUpdate:modelValue":te[6]||(te[6]=W=>c.value=W),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:E},null,544),[[Rt,c.value]]),te[23]||(te[23]=h("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),h("div",vN,[h("button",{onClick:I,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:w,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,yN)])])])):le("",!0),o.value?(M(),L("div",_N,[h("div",bN,[h("div",wN,[te[25]||(te[25]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"⚠️")],-1)),te[26]||(te[26]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",IN,'Êtes-vous sûr de vouloir supprimer la saison "'+oe((Ve=d.value)==null?void 0:Ve.name)+'" ?',1)]),te[27]||(te[27]=h("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:$,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:D,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):le("",!0),ht(lE,{show:f.value,message:R(),error:y.value,"session-info":$e(),onSubmit:xt,onCancel:tt},null,8,["show","message","error","session-info"]),ht(uE,{show:x.value,onClose:te[7]||(te[7]=W=>x.value=!1)},null,8,["show"]),te[28]||(te[28]=lr('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},TN="modulepreload",xN=function(n){return"/"+n},s_={},un=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=xN(i),i in s_)return;s_[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":TN,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},kh="magicLinks";function Dh({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function og(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function mp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Dh({seasonId:n,playerId:e,eventId:t,action:r}),i=og(40),o=Se(ae,kh,s),a=Date.now()+1e3*60*60*24*7;await pn(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function hE({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=Dh({seasonId:n,playerId:e,eventId:r,action:s}),o=og(40),a=Se(ae,kh,i),l=Date.now()+1e3*60*60*24*7;await pn(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function fE({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=Dh({seasonId:n,playerId:e,eventId:t,action:s}),o=Se(ae,kh,i),a=await Pn(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function gp({seasonId:n,playerId:e,eventId:t,action:r}){const s=Dh({seasonId:n,playerId:e,eventId:t,action:r}),i=Se(ae,kh,s);await ja(i)}const ag="accountMagicLinks";function Vh(n){return`account__${n}`}async function pE({currentEmail:n,newEmail:e}){const t=og(40),r=Vh(t),s=Se(ae,ag,r),i=Date.now()+1e3*60*60*24*7;await pn(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function mE({token:n}){const e=Vh(n),t=Se(ae,ag,e),r=await Pn(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function gE({token:n}){const e=Vh(n),t=Se(ae,ag,e);await ja(t)}const AN=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:Vh,consumeAccountEmailUpdateLink:gE,consumeMagicLink:gp,createAccountEmailUpdateLink:pE,createEmailVerificationLink:hE,createMagicLink:mp,verifyAccountEmailUpdateLink:mE,verifyMagicLink:fE},Symbol.toStringTag,{value:"Module"})),i_="impro_selector_trusted_players",o_=180*24*60*60*1e3;class SN{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(i_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(i_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<o_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>o_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Si=new SN;function lg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function Od(n){return`seasonPreferredPlayer:${n||"global"}`}async function vE(n,e,t,r=null){try{ve.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await il(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await un(()=>import("./index.esm-70987b7c.js"),[]),{db:c}=await un(()=>Promise.resolve().then(()=>pi),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(P=>P.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");ve.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await un(()=>import("./index.esm-f4183392.js"),[]),{auth:x}=await un(()=>Promise.resolve().then(()=>pi),void 0),S=await y(x,e,t);ve.info("Compte Firebase Auth créé",{uid:S.user.uid});const A=lg(t),j=r?Se(c,"seasons",r,"playerProtection",n):Se(c,"playerProtection",n);await pn(j,{playerId:n,email:e,passwordHash:A,firebaseUid:S.user.uid,isProtected:!0,createdAt:new Date}),ve.info("Protection sauvegardée dans Firestore");try{r&&localStorage.setItem(Od(r),n)}catch{}return{success:!0}}catch(s){throw ve.error("Erreur lors de la protection du joueur",s),s}}async function yE({playerId:n,email:e,seasonId:t=null}){const r=t?Se(ae,"seasons",t,"playerProtection",n):Se(ae,"playerProtection",n);(await Pn(r)).exists()?await tl(r,{email:e,updatedAt:new Date}):await pn(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await hE({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function _E({playerId:n,seasonId:e=null}){const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n);if(!(await Pn(t)).exists())throw new Error("Protection introuvable");return await tl(t,{emailVerifiedAt:new Date}),{success:!0}}async function bE({playerId:n,seasonId:e=null}){const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n);return await tl(t,{emailVerifiedAt:null}),{success:!0}}async function wE(n,e=null){try{const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n);await pn(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date});try{if(e){const r=Od(e);localStorage.getItem(r)===n&&localStorage.removeItem(r)}}catch{}return{success:!0,email:""}}catch(t){throw ve.error("Erreur lors de la suppression de la protection",t),t}}async function mi(n,e=null){try{const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n),r=await Pn(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return ve.error("Erreur lors de la vérification de protection",t),!1}}async function il(n,e=null){try{const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n),r=await Pn(t);return r.exists()?r.data():null}catch(t){return ve.error("Erreur lors de la récupération des données de protection",t),null}}async function IE(n,e=null){try{const t=await il(n,e);return(t==null?void 0:t.email)||""}catch(t){return ve.error("Erreur lors de la récupération de l'email",t),""}}async function vp(n=null){try{const e=n?Qe(ae,"seasons",n,"playerProtection"):Qe(ae,"playerProtection");return(await vt(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return ve.error("Erreur lors du chargement des protections",e),[]}}async function EE(n){try{const e=[],t=Eu(Qe(ae,"playerProtection"),Rd("email","==",n));(await vt(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await vt(Qe(ae,"seasons"));for(const i of s.docs){const o=i.id,a=Eu(Qe(ae,"seasons",o,"playerProtection"),Rd("email","==",n));(await vt(a)).forEach(c=>{var f;const d=c.data();d!=null&&d.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...d})})}return e}catch(e){return ve.error("Erreur listAssociationsForEmail",e),[]}}async function TE(n,e,t=null){try{const r=await il(n,t);if(!r||!r.isProtected)return!1;if(r.email){ve.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await un(()=>import("./index.esm-f4183392.js"),[]),{auth:i}=await un(()=>Promise.resolve().then(()=>pi),void 0);await s(i,r.email,e),ve.debug("Mot de passe Firebase Auth valide"),Si.saveSession(n);try{t&&localStorage.setItem(Od(t),n)}catch{}return!0}catch(s){return ve.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{ve.debug("Vérification avec hash local");const s=lg(e),i=r.passwordHash===s;if(i){Si.saveSession(n);try{t&&localStorage.setItem(Od(t),n)}catch{}}return i}}catch(r){return ve.error("Erreur lors de la vérification du mot de passe",r),!1}}async function xE({playerId:n,seasonId:e=null}){const t=e?Se(ae,"seasons",e,"playerProtection",n):Se(ae,"playerProtection",n),r=await Pn(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await tl(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function fo(n){return Si.isPasswordCached(n)}function PN(n){return null}async function AE(n,e=null){try{ve.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await il(n,e);if(ve.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(ve.debug("Email à utiliser (masqué)"),t.firebaseUid){ve.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await un(()=>import("./index.esm-f4183392.js"),[]),{auth:s}=await un(()=>Promise.resolve().then(()=>pi),void 0);ve.debug("Tentative d'envoi d'email"),await r(s,t.email),ve.info("Email envoyé avec succès via Firebase Auth")}else{ve.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await un(()=>import("./index.esm-f4183392.js"),[]),{auth:i}=await un(()=>Promise.resolve().then(()=>pi),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);ve.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),ve.info("Email envoyé avec succès");const{updateDoc:l}=await un(()=>import("./index.esm-70987b7c.js"),[]),{db:c}=await un(()=>Promise.resolve().then(()=>pi),void 0),d=e?Se(c,"seasons",e,"playerProtection",n):Se(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")ve.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),ve.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw ve.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function RN(n,e,t=null){try{const r=lg(e),s=t?Se(ae,"seasons",t,"playerProtection",n):Se(ae,"playerProtection",n);return await tl(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw ve.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function CN(n){return new Promise((e,t)=>{ve.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Nh=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:bE,finalizeProtectionAfterVerification:xE,getCachedPlayerPassword:PN,getPlayerEmail:IE,getPlayerProtectionData:il,isPlayerPasswordCached:fo,isPlayerProtected:mi,listAssociationsForEmail:EE,listProtectedPlayers:vp,markEmailVerifiedForProtection:_E,protectPlayer:vE,requirePlayerPasswordForAvailability:CN,sendPasswordResetEmail:AE,startEmailVerificationForProtection:yE,unprotectPlayer:wE,updatePlayerPasswordInFirestore:RN,verifyPlayerPassword:TE},Symbol.toStringTag,{value:"Module"}));let Bn="mock",gi=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],To=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function SE(n){Bn=n}async function kN(){if(Bn!=="firebase"||!(await vt(Qe(ae,"seasons"))).empty)return;const e=Se(Qe(ae,"seasons"));await pn(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Ju()});const t=await vt(Qe(ae,"players"));for(const o of t.docs)await pn(Se(e,"players",o.id),o.data());const r=await vt(Qe(ae,"events"));for(const o of r.docs)await pn(Se(e,"events",o.id),o.data());const s=await vt(Qe(ae,"availability"));for(const o of s.docs)await pn(Se(e,"availability",o.id),o.data());const i=await vt(Qe(ae,"selections"));for(const o of i.docs)await pn(Se(e,"selections",o.id),o.data())}async function DN(){Bn==="firebase"&&await kN()}async function a_(n=null){return(Bn==="firebase"?n?(await vt(Qe(ae,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await vt(Qe(ae,"events"))).docs.map(t=>({id:t.id,...t.data()})):To).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function If(n=null){return(Bn==="firebase"?n?(await vt(Qe(ae,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await vt(Qe(ae,"players"))).docs.map(t=>({id:t.id,...t.data()})):gi).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function PE(n,e=null){if(Bn==="firebase"){const t=Se(e?Qe(ae,"seasons",e,"players"):Qe(ae,"players"));return await pn(t,{name:n}),t.id}else{const t=`p${gi.length+1}`;return gi.push({id:t,name:n}),t}}async function VN(n,e=null){if(Bn==="firebase"){const t=e?Se(ae,"seasons",e,"players",n):Se(ae,"players",n);await ja(t);const r=e?await vt(Qe(ae,"seasons",e,"availability")):await vt(Qe(ae,"availability")),s=Fm(ae);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else gi=gi.filter(t=>t.id!==n)}async function NN(n,e,t=null){if(Bn==="firebase"){const r=t?Se(ae,"seasons",t,"players",n):Se(ae,"players",n),s=await Pn(r),i=s.exists()&&s.data().name||null;if(await pn(r,{name:e},{merge:!0}),i&&i!==e){const o=Fm(ae);try{const a=t?Se(ae,"seasons",t,"availability",i):Se(ae,"availability",i),l=await Pn(a);if(l.exists()){const c=l.data()||{},d=t?Se(ae,"seasons",t,"availability",e):Se(ae,"availability",e);o.set(d,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?Qe(ae,"seasons",t,"selections"):Qe(ae,"selections");(await vt(a)).forEach(c=>{var f;const d=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(d.includes(i)){const g=d.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=gi.findIndex(s=>s.id===n);r!==-1&&(gi[r]={...gi[r],name:e})}}async function Zo(n,e,t=null){if(Bn==="firebase"){const r=t?await vt(Qe(ae,"seasons",t,"availability")):await vt(Qe(ae,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function ea(n=null){if(Bn==="firebase"){const e=n?await vt(Qe(ae,"seasons",n,"selections")):await vt(Qe(ae,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function l_(n,e,t=null){if(Bn==="firebase"){const r=t?Se(ae,"seasons",t,"availability",n):Se(ae,"availability",n);await pn(r,e)}}async function ON({seasonId:n,playerName:e,eventId:t,value:r}){if(Bn!=="firebase")return;const s=n?Se(ae,"seasons",n,"availability",e):Se(ae,"availability",e),i=await Pn(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await pn(s,a)}async function u_(n,e,t=null){if(Bn==="firebase"){const r=t?Se(ae,"seasons",t,"selections",n):Se(ae,"selections",n);await pn(r,{players:e})}}async function MN(n,e=null){if(ve.info("Suppression de l'événement",{eventId:n}),Bn==="firebase")try{ve.debug("Suppression de l'événement dans Firestore");const t=e?Se(ae,"seasons",e,"events",n):Se(ae,"events",n);await ja(t),ve.debug("Suppression de la sélection associée");const r=e?Se(ae,"seasons",e,"selections",n):Se(ae,"selections",n);await ja(r),ve.debug("Suppression des disponibilités");const s=e?await vt(Qe(ae,"seasons",e,"availability")):await vt(Qe(ae,"availability")),i=Fm(ae);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){ve.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),ve.info("Opérations de suppression terminées avec succès")}catch(t){throw ve.error("Erreur lors de la suppression",t),t}else To=To.filter(t=>t.id!==n)}async function LN(n,e=null){if(Bn==="firebase"){const t=Se(e?Qe(ae,"seasons",e,"events"):Qe(ae,"events"));return await pn(t,n),t.id}else{const t=`event${To.length+1}`;return To.push({id:t,...n}),t}}async function c_(n,e,t=null){if(Bn==="firebase"){const r=t?Se(ae,"seasons",t,"events",n):Se(ae,"events",n);await pn(r,e,{merge:!0})}else{const r=To.findIndex(s=>s.id===n);r!==-1&&(To[r]={id:n,...e})}}async function FN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,reason:o="new_event",fromEmail:a=void 0}){try{const f=Se(ae,"userPreferences",n),g=await Pn(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const l=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>Disponibilité demandée</h2>
      <p>Bonjour ${e},</p>
      <p>Peux-tu indiquer ta disponibilité pour <strong>${t}</strong> (${r}) ?</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;margin-right:8px;background:#16a34a;color:#fff;border-radius:8px;text-decoration:none;">Je suis dispo ✅</a>
        <a href="${i}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Pas dispo ❌</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: ${o}</p>
    </div>
  `,c=`Disponibilité demandée · ${t}`,d={to:n,message:{subject:c,html:l},createdAt:Ju(),meta:{reason:o,eventTitle:t,eventDate:r,playerName:e}};return a&&(d.from=a,d.replyTo=a),await Ih(Qe(ae,"mail"),d),{success:!0}}async function RE({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",d=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:d,html:f},createdAt:Ju(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await Ih(Qe(ae,"mail"),g)}async function $N({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return RE({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function UN({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Se(ae,"userPreferences",n),g=await Pn(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}ve.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Tu as été sélectionné(e) !</h2>
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;ve.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:Ju(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),ve.debug("queueSelectionEmail firestore payload ready");try{return await Ih(Qe(ae,"mail"),d),ve.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw ve.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function jN({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(ve.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await un(()=>Promise.resolve().then(()=>Nh),void 0),{createMagicLink:a}=await un(()=>Promise.resolve().then(()=>AN),void 0),l=`${window.location.origin}/season/${s}/event/${n}`,c=t.join(", "),d=`🎭 Sélection confirmée · ${e.title}`,f=[];for(const g of t){ve.debug("Traitement du joueur",{playerName:g});try{const y=i==null?void 0:i.find(P=>P.name===g);if(!y){ve.warn("Joueur non trouvé",{playerName:g});continue}ve.debug("Joueur trouvé");const x=await o(y.id,r);if(!x){ve.warn("Pas d'email pour le joueur",{playerName:g});continue}ve.debug("Email trouvé pour joueur");const A=`${(await a({seasonId:r,playerId:y.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,j=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection confirmée</h2>
          <p>Bonjour <strong>${g}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${d_(e.date)}).</p>
          <p>Sélection complète : <strong>${c}</strong>.</p>
          <p>Tu n'es plus disponible ? Signale le rapidement ici :</p>
          <p>
            <a href="${A}" style="display:inline-block;padding:10px 16px;background:#dc2626;color:#fff;border-radius:8px;text-decoration:none;">Signaler que je ne suis plus disponible</a>
          </p>
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 16px;background:#8b5cf6;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;ve.debug("HTML généré pour joueur");const F=UN({toEmail:x,playerName:g,eventTitle:e.title,eventDate:d_(e.date),eventUrl:l,html:j,subject:d});f.push(F),ve.info("Email ajouté à la queue",{playerName:g})}catch(y){ve.error("Erreur lors de l'envoi de l'email de sélection",{playerName:g,error:y})}}return ve.info("Nombre total d'emails à envoyer",{count:f.length}),await Promise.all(f),ve.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:f.length}}function d_(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}const BN={class:"relative p-5 pb-4 border-b border-white/10"},qN={class:"text-xl md:text-2xl font-bold text-white pr-10"},zN={key:0,class:"text-sm text-purple-300 mt-1"},GN={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},KN={class:"bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20 p-3"},HN={class:"text-blue-200 text-sm"},WN={class:"flex space-x-1 bg-gray-800 rounded-lg p-1"},QN=["onClick"],JN={key:0,class:"space-y-4"},YN={class:"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white whitespace-pre-line"},XN={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},ZN={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},eO={class:"text-blue-200 text-sm"},tO={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},nO={key:0,class:"space-y-2"},rO={class:"flex flex-wrap gap-2"},sO={key:1,class:"text-amber-400 text-sm"},iO={key:1,class:"space-y-4"},oO={class:"relative"},aO=["value"],lO=["title"],uO={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},cO={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},dO={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},hO=["disabled"],fO={key:0},pO={key:1},CE={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]}},emits:["close","notifications-sent","send-email-notifications"],setup(n,{emit:e}){const t=n,r=e,s=N("email"),i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=[{id:"email",label:"📧 Email"},{id:"copy",label:"📋 Copie"}],d=ze(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=ze(()=>{if(!t.event)return"";const P=A(t.event.date);if(t.mode==="selection"){const q=t.selectedPlayers.join(", ");return`Sélection pour ${t.event.title} du ${P} : ${q}`}else return`Bonjour !

Nouvel événement : ${t.event.title}
Date : ${P}

Lien direct vers l'événement : ${d.value}

Merci de confirmer votre disponibilité.`}),g=ze(()=>{if(!t.event||!t.selectedPlayers)return"";if(t.mode==="selection"){const P=t.selectedPlayers.join(", ");return`Sélection confirmée

Bonjour [Nom du joueur],

Tu as été sélectionné(e) pour ${t.event.title} (${A(t.event.date)}).

Sélection complète : ${P}.

Tu n'es plus disponible ? Signale le rapidement ici : [Lien de désistement]`}else return`Disponibilité demandée

Bonjour [Nom du joueur],

Peux-tu indiquer ta disponibilité pour ${t.event.title} (${A(t.event.date)}) ?`}),y=N([]);async function x(){if(!t.seasonId)return;let P=[];t.mode==="selection"?P=t.players.filter(X=>t.selectedPlayers.includes(X.name)):P=t.players.filter(X=>X.isProtected);const q=[];for(const X of P)try{const{getPlayerEmail:ue}=await un(()=>Promise.resolve().then(()=>Nh),void 0),E=await ue(X.id,t.seasonId);E&&q.push({...X,email:E})}catch(ue){console.warn(`Impossible de charger l'email pour ${X.name}:`,ue)}y.value=q}function S(){r("close")}function A(P){var X;return P?(typeof P=="string"?new Date(P):((X=P.toDate)==null?void 0:X.call(P))||P).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function j(){const P=f.value;navigator.clipboard.writeText(P).then(()=>{i.value=!0,o.value="Copié !",setTimeout(()=>{i.value=!1,o.value="Copier le message"},2e3)}).catch(q=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}async function F(){if(!(!t.event||y.value.length===0)){a.value=!0;try{t.mode==="selection"?r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers}):r("send-email-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual"})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}finally{a.value=!1}}}return wr(()=>{t.show&&(s.value="email",x())}),Ot(()=>t.show,P=>{P&&(s.value="email",x())}),Ot(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&x()}),(P,q)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:S},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:q[1]||(q[1]=Nt(()=>{},["stop"]))},[h("div",BN,[h("button",{onClick:S,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("h2",qN,oe(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1),n.event?(M(),L("p",zN,oe(n.event.title)+" — "+oe(A(n.event.date)),1)):le("",!0)]),h("div",GN,[h("div",KN,[h("p",HN,oe(n.mode==="selection"?"Choisis comment annoncer cette sélection aux joueurs :":"Choisis comment annoncer cet événement aux joueurs :"),1)]),h("div",WN,[(M(),L(_t,null,ur(c,X=>h("button",{key:X.id,onClick:ue=>s.value=X.id,class:fn(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200",s.value===X.id?"bg-purple-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"])},oe(X.label),11,QN)),64))]),s.value==="email"?(M(),L("div",JN,[h("div",null,[q[2]||(q[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Prévisualisation du message :",-1)),h("div",YN,oe(g.value),1)]),h("div",null,[h("label",XN,[q[3]||(q[3]=Ln(" Destinataires ")),h("button",{onClick:q[0]||(q[0]=X=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(M(),L("div",ZN,[h("p",eO,oe(n.mode==="selection"?"Les destinataires sont les joueurs sélectionnés qui ont renseigné une adresse email en utilisant la fonction Protéger.":"Les destinataires sont les joueurs qui ont renseigné une adresse email en utilisant la fonction Protéger."),1)])):le("",!0),h("div",tO,[y.value.length>0?(M(),L("div",nO,[h("div",rO,[(M(!0),L(_t,null,ur(y.value,X=>(M(),L("span",{key:X.id,class:"px-3 py-1 bg-gray-700 text-white rounded text-sm"},oe(X.name),1))),128))])])):(M(),L("div",sO," ⚠️ "+oe(n.mode==="selection"?"Aucun joueur sélectionné avec email renseigné. Les notifications ne pourront pas être envoyées.":"Aucun joueur protégé avec email renseigné. Les notifications ne pourront pas être envoyées."),1))])])])):le("",!0),s.value==="copy"?(M(),L("div",iO,[q[6]||(q[6]=h("div",{class:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-lg border border-purple-500/20 p-3"},[h("p",{class:"text-purple-200 text-sm"},"📋 Copie du message pour partage manuel")],-1)),h("div",oO,[h("textarea",{value:f.value,class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",rows:"6",readonly:""},null,8,aO),h("button",{onClick:j,class:"absolute top-2 right-2 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg p-2 hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:o.value},[i.value?(M(),L("svg",cO,q[5]||(q[5]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(M(),L("svg",uO,q[4]||(q[4]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2z"},null,-1)])))],8,lO)])])):le("",!0)]),h("div",dO,[s.value==="email"?(M(),L("button",{key:0,onClick:F,disabled:y.value.length===0||a.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(M(),L("span",pO,"📧 Envoi en cours...")):(M(),L("span",fO,"📧 Envoyer les notifications email"))],8,hO)):le("",!0),s.value==="copy"?(M(),L("button",{key:1,onClick:j,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 flex-1"}," 📋 Copier le message ")):le("",!0),h("button",{onClick:S,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):le("",!0)}},mO={class:"text-center mb-6"},gO={class:"text-lg text-gray-300"},vO={class:"mb-6"},yO={class:"space-y-4"},_O={class:"flex items-center gap-2 text-gray-300 text-sm"},bO=["disabled"],wO={key:0,class:"animate-spin"},IO={key:1},EO={class:"mb-6 text-center"},TO={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},xO={class:"text-red-300 text-sm"},AO={class:"text-center mb-6"},SO={class:"text-lg text-gray-300"},PO={class:"mb-6"},RO=["disabled"],CO={key:0,class:"animate-spin"},kO={key:1},DO={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},VO={class:"text-red-300 text-sm"},NO={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},OO={class:"text-green-300 text-sm"},MO={class:"flex justify-center"},ug={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N(!1),o=N(""),a=N(!1),l=N(""),c=N(""),d=N(null),f=N(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const S=await fp(t.seasonId);if(s.value===S){if(f.value)try{Si.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),x();return}if(await TE(t.player.id,s.value,t.seasonId)){if(f.value)try{Si.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),x()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(S){ve.error("Erreur lors de la vérification",S),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const S=await AE(t.player.id,t.seasonId);c.value=S.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(S){ve.error("Erreur lors de l'envoi de l'email",S),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function x(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Ot(()=>t.show,S=>{S&&hn(()=>{d.value&&d.value.focus()})}),(S,A)=>{var j,F;return M(),L(_t,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:x},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[3]||(A[3]=Nt(()=>{},["stop"]))},[h("div",mO,[A[7]||(A[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔐")],-1)),A[8]||(A[8]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),h("p",gO,oe((j=n.player)==null?void 0:j.name),1),A[9]||(A[9]=h("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),h("div",vO,[h("div",yO,[h("div",null,[A[10]||(A[10]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),it(h("input",{"onUpdate:modelValue":A[0]||(A[0]=P=>s.value=P),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Nn(g,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Rt,s.value]])]),h("div",_O,[it(h("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":A[1]||(A[1]=P=>f.value=P),class:"w-4 h-4"},null,512),[[wa,f.value]]),A[11]||(A[11]=h("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),h("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(M(),L("span",wO,"⏳")):(M(),L("span",IO,"🔓")),h("span",null,oe(i.value?"Vérification...":"Vérifier"),1)],8,bO)]),h("div",EO,[h("button",{onClick:A[2]||(A[2]=P=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(M(),L("div",TO,[h("div",xO,oe(o.value),1)])):le("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):le("",!0),a.value?(M(),L("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:A[6]||(A[6]=P=>a.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:A[5]||(A[5]=Nt(()=>{},["stop"]))},[h("div",AO,[A[12]||(A[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"📧")],-1)),A[13]||(A[13]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),h("p",SO,oe((F=n.player)==null?void 0:F.name),1)]),h("div",PO,[A[14]||(A[14]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(M(),L("span",CO,"⏳")):(M(),L("span",kO,"📧")),h("span",null,oe(i.value?"Envoi...":"Envoyer l'email"),1)],8,RO)]),l.value?(M(),L("div",DO,[h("div",VO,oe(l.value),1)])):le("",!0),c.value?(M(),L("div",NO,[h("div",OO,oe(c.value),1)])):le("",!0),h("div",MO,[h("button",{onClick:A[4]||(A[4]=P=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):le("",!0)],64)}}},LO={class:"text-center mb-6"},FO={class:"text-sm text-gray-300"},$O={key:0,class:"space-y-4"},UO={key:0,class:"text-sm text-gray-300"},jO={key:1,class:"space-y-4"},BO=["disabled"],qO={key:0,class:"animate-spin"},zO={key:1},GO={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},KO={class:"mt-6 flex justify-center gap-3"},HO=["disabled"],WO={key:0,class:"animate-spin"},QO={key:1},kE={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=N(1),i=N(""),o=N(""),a=N(""),l=N(!1),c=N(""),d=N(!1),f=Ba(),g=ze(()=>i.value&&i.value.includes("@")),y=ze(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function x(){var F,P,q;if(!(!g.value||!((F=t.player)!=null&&F.id))){l.value=!0,c.value="";try{const X=await yE({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),ue=(P=f.params)==null?void 0:P.slug,E=`${X.url}${ue?`&slug=${encodeURIComponent(ue)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await $N({toEmail:i.value,playerName:((q=t.player)==null?void 0:q.name)||"joueur",verifyUrl:E}),d.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function S(){try{await bE({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,d.value=!1,i.value="",o.value="",a.value=""}async function A(){var F;try{const P=await il((F=t.player)==null?void 0:F.id,t.seasonId);P!=null&&P.email&&(P!=null&&P.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}wr(()=>{A()}),Ot(()=>t.show,F=>{F&&A()});async function j(){if(y.value){l.value=!0,c.value="";try{await vE(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(F){c.value=(F==null?void 0:F.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(F,P)=>{var q;return n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:P[6]||(P[6]=X=>F.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[5]||(P[5]=Nt(()=>{},["stop"]))},[h("button",{onClick:P[0]||(P[0]=X=>F.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",LO,[P[7]||(P[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"👤")],-1)),P[8]||(P[8]=h("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),h("p",FO,"Pour sécuriser les saisies de "+oe((q=n.player)==null?void 0:q.name),1)]),s.value===1?(M(),L("div",$O,[h("div",null,[P[9]||(P[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),it(h("input",{"onUpdate:modelValue":P[1]||(P[1]=X=>i.value=X),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Rt,i.value]])]),d.value?(M(),L("div",UO,"Un email a été envoyé à "+oe(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)):le("",!0)])):s.value===2?(M(),L("div",jO,[h("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[P[10]||(P[10]=h("span",null,"✅",-1)),P[11]||(P[11]=h("span",null,"Adresse email vérifiée",-1)),h("button",{type:"button",onClick:S,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),h("div",null,[P[12]||(P[12]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),it(h("input",{"onUpdate:modelValue":P[2]||(P[2]=X=>o.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Rt,o.value]])]),h("div",null,[P[13]||(P[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),it(h("input",{"onUpdate:modelValue":P[3]||(P[3]=X=>a.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Rt,a.value]])]),h("button",{onClick:j,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(M(),L("span",qO,"⏳")):(M(),L("span",zO,"🔒")),h("span",null,oe(l.value?"Association...":"Associer ce joueur"),1)],8,BO)])):le("",!0),c.value?(M(),L("div",GO,oe(c.value),1)):le("",!0),h("div",KO,[h("button",{onClick:P[4]||(P[4]=X=>F.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),s.value===1?(M(),L("button",{key:0,onClick:x,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(M(),L("span",WO,"⏳")):(M(),L("span",QO,"✉️")),h("span",null,oe(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,HO)):le("",!0)])])])):le("",!0)}}},JO={class:"text-center mb-6"},YO={class:"text-2xl font-bold text-white mb-2"},XO={class:"text-lg text-gray-300"},ZO={class:"mb-6"},eM={class:"flex items-center space-x-3"},tM={class:"text-2xl"},nM={class:"font-semibold text-white"},rM={class:"text-sm text-gray-300"},sM={key:0,class:"mb-6"},iM={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},oM={class:"text-red-300 text-sm"},aM={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},lM={class:"text-green-300 text-sm"},uM={class:"flex justify-center gap-3"},cM=["disabled"],dM={key:3,class:"mt-4"},hM={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},fM={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=N(!1),o=N(!1),a=N(""),l=N(""),c=N(!1),d=N(!1);Ba();const f=N(!1);ze(()=>!1),ze(()=>!1);function g(){l.value="Compte créé et joueur associé !",s.value=!0,d.value=!1,r("update")}async function y(){var F;if((F=t.player)!=null&&F.id){s.value=await mi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:P}=await un(()=>Promise.resolve().then(()=>Nh),void 0);i.value=P(t.player.id)}catch{i.value=!1}}}function x(){var F;a.value="";try{if((F=t.player)!=null&&F.id&&fo(t.player.id)){S();return}}catch{}f.value=!0}async function S(){o.value=!0,a.value="",l.value="";try{const F=await wE(t.player.id,t.seasonId);l.value="Protection désactivée avec succès !",s.value=!1,F.email&&(email.value=F.email),r("update")}catch(F){logger.error("Erreur lors de la désactivation de la protection",F),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function A(){f.value=!1,S()}function j(){r("close")}return Ot(()=>t.player,()=>{t.show&&t.player&&y()},{immediate:!0}),Ot(()=>t.show,F=>{F&&t.player&&(a.value="",l.value="",c.value=!1,f.value=!1,y(),t.onboarding&&hn(()=>{}))}),(F,P)=>{var q;return M(),L(_t,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:j},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:P[2]||(P[2]=Nt(()=>{},["stop"]))},[h("button",{onClick:j,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",JO,[P[5]||(P[5]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),h("h2",YO,oe(s.value?"Déverrouiller les disponibilités":"Verrouiller ce joueur"),1),h("p",XO,oe((q=n.player)==null?void 0:q.name),1)]),h("div",ZO,[h("div",{class:fn(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[h("div",eM,[h("span",tM,oe(s.value?"🔒":"🔓"),1),h("div",null,[h("div",nM,oe(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),h("div",rM,oe(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?le("",!0):(M(),L("div",sM,P[6]||(P[6]=[h("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(M(),L("div",iM,[h("div",oM,oe(a.value),1)])):le("",!0),l.value?(M(),L("div",aM,[h("div",lM,oe(l.value),1)])):le("",!0),h("div",uM,[h("button",{onClick:j,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),s.value?(M(),L("button",{key:1,onClick:x,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,cM)):(M(),L("button",{key:0,onClick:P[0]||(P[0]=X=>d.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte "))]),s.value?le("",!0):(M(),L("div",dM,[h("button",{onClick:P[1]||(P[1]=X=>c.value=!c.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[P[7]||(P[7]=h("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),h("span",{class:fn(["text-blue-300 transition-transform duration-200",{"rotate-180":c.value}])},"▼",2)]),c.value?(M(),L("div",hM,P[8]||(P[8]=[h("div",{class:"text-gray-300"},"Vous pouvez continuer à utiliser cette application sans compte, mais avec un compte, vous bénéficiez de nombreux avantages.",-1),h("div",null,[Ln("• "),h("span",{class:"text-blue-300"},"Protéger vos saisies :"),Ln(" vous seul pourrez modifier les disponibilités de ce joueur")],-1),h("div",null,[Ln("• "),h("span",{class:"text-blue-300"},"Notifications :"),Ln(" recevez des emails lorsqu'il y a de nouvelles sélections")],-1),h("div",null,[Ln("• "),h("span",{class:"text-blue-300"},"Confort :"),Ln(" votre joueur reste toujours en haut de la liste")],-1)]))):le("",!0)]))])])):le("",!0),ht(kE,{show:d.value,player:n.player,"season-id":n.seasonId,onClose:P[3]||(P[3]=X=>d.value=!1),onSuccess:g},null,8,["show","player","season-id"]),ht(ug,{show:f.value,player:n.player,seasonId:n.seasonId,onClose:P[4]||(P[4]=X=>f.value=!1),onVerified:A},null,8,["show","player","seasonId"])],64)}}};const pM=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},mM={class:"relative text-center p-6 pb-4 border-b border-white/10"},gM={class:"text-2xl md:text-3xl font-bold text-white mb-1"},vM={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},yM={class:"grid grid-cols-3 gap-3 md:gap-4"},_M={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},bM={class:"text-xl md:text-2xl font-bold text-white"},wM={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},IM={class:"text-xl md:text-2xl font-bold text-white"},EM={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},TM={class:"text-xl md:text-2xl font-bold text-white"},xM={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},AM={key:0,class:"md:hidden mt-3 space-y-2"},SM={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},PM={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},RM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},CM={class:"mb-6"},kM={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N(""),a=N(null),l=N(!1),c=N(!1),d=N(null),f=N(!1),g=N(!1),y=N(!1);function x(){s("close")}function S(){var w;o.value=((w=r.player)==null?void 0:w.name)||"",i.value=!0,hn(()=>{a.value&&a.value.focus()})}function A(){i.value=!1,o.value=""}async function j(){var I,k;if(!o.value.trim())return;if(await mi((I=r.player)==null?void 0:I.id,r.seasonId)){fo((k=r.player)==null?void 0:k.id)?F():(d.value="update",c.value=!0);return}F()}function F(){var w;s("update",{playerId:(w=r.player)==null?void 0:w.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function P(){var I,k;if(await mi((I=r.player)==null?void 0:I.id,r.seasonId)){fo((k=r.player)==null?void 0:k.id)?q():(d.value="delete",c.value=!0);return}q()}function q(){var w;s("delete",(w=r.player)==null?void 0:w.id)}function X(){s("refresh")}function ue(w){d.value==="update"?F():d.value==="delete"&&q(),d.value=null}Ot(()=>r.show,w=>{var I;w||(i.value=!1,o.value="",d.value=null,l.value=!1),w&&((I=r.player)!=null&&I.id)&&(mi(r.player.id,r.seasonId).then(k=>{g.value=!!k}),un(()=>Promise.resolve().then(()=>Nh),void 0).then(k=>{try{y.value=!!k.isPlayerPasswordCached(r.player.id)}catch{y.value=!1}}))}),e({openProtection(){l.value=!0}});const E=N({position:null});return Ot(()=>r.show,w=>{w&&r.onboardingStep===4?hn(()=>{const I=document.querySelectorAll("button");let k=null;if(I.forEach(D=>{!k&&D.textContent&&D.textContent.includes("Protection")&&(k=D)}),k){const D=k.getBoundingClientRect();E.value.position={x:Math.round(D.right+8),y:Math.round(D.top+window.scrollY-4)}}}):w||(E.value.position=null)}),(w,I)=>{var k;return M(),L(_t,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:x},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:I[5]||(I[5]=Nt(()=>{},["stop"]))},[h("div",mM,[h("button",{onClick:x,class:"absolute right-3 top-3 text-white/80 hover:text-white"},"✖️"),I[10]||(I[10]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"👤")],-1)),h("h2",gM,oe((k=n.player)==null?void 0:k.name),1)]),h("div",vM,[h("div",null,[h("div",yM,[h("div",_M,[h("div",bM,oe(r.stats.availability),1),I[11]||(I[11]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",wM,[h("div",IM,oe(r.stats.selection),1),I[12]||(I[12]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",EM,[h("div",TM,oe(r.stats.ratio)+"%",1),I[13]||(I[13]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Taux",-1))])])]),h("div",xM,[h("button",{onClick:S,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},I[14]||(I[14]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:I[0]||(I[0]=D=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[h("span",null,oe(g.value?"🔓":"🔒"),1),h("span",null,oe(g.value?y.value?"Dissocier de mon compte":"Déverrouiller":"Verrouiller"),1)]),h("button",{onClick:P,class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},I[15]||(I[15]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:x,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")]),f.value?(M(),L("div",AM,[h("button",{onClick:I[1]||(I[1]=D=>{S(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"}," ✏️ Renommer "),h("button",{onClick:I[2]||(I[2]=D=>{P(),f.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"}," 🗑️ Supprimer ")])):le("",!0)]),h("div",SM,[h("button",{onClick:I[3]||(I[3]=D=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},oe(g.value?y.value?"🔓 Dissocier":"🔓 Déverrouiller":"🔒 Verrouiller"),1),h("button",{onClick:x,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer "),h("button",{onClick:I[4]||(I[4]=D=>f.value=!f.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ ")])])])):le("",!0),i.value?(M(),L("div",PM,[h("div",RM,[I[17]||(I[17]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),h("div",CM,[I[16]||(I[16]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),it(h("input",{"onUpdate:modelValue":I[6]||(I[6]=D=>o.value=D),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Nn(A,["esc"]),Nn(j,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Rt,o.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:A,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:j,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):le("",!0),ht(fM,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:I[7]||(I[7]=D=>l.value=!1),onUpdate:X,onOnboardingFinished:I[8]||(I[8]=D=>w.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),ht(ug,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:I[9]||(I[9]=D=>c.value=!1),onVerified:ue},null,8,["show","player","seasonId"])],64)}}},DM=pM(kM,[["__scopeId","data-v-7eab3d36"]]),VM={class:"relative p-6 pb-4 border-b border-white/10"},NM={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},OM={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=Nt(()=>{},["stop"]))},[h("div",VM,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),h("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=lr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),h("div",NM,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):le("",!0)}},MM={class:"relative text-center p-6 pb-4 border-b border-white/10"},LM={class:"text-2xl md:text-3xl font-bold text-white mb-1"},FM={class:"text-sm md:text-base text-purple-300"},$M={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},UM={class:"mb-3"},jM={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},BM={key:0,class:"flex items-center justify-between gap-2"},qM=["title"],zM={key:0,class:"text-purple-400 mr-2"},GM={key:1,class:"text-green-400 mr-2"},KM={key:2,class:"text-red-400 mr-2"},HM={key:3,class:"text-gray-400 mr-2"},WM=["onClick"],QM={key:1,class:"flex items-center justify-center"},JM=["onChange"],YM=["value"],XM=["onClick"],ZM={key:0,class:"mb-3"},eL={class:"grid grid-cols-3 gap-2 md:gap-3 mb-3"},tL={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},nL={class:"text-cyan-300 text-lg md:text-xl font-semibold"},rL={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},sL={class:"text-green-400 text-lg md:text-xl font-semibold"},iL={class:"p-3 md:p-3 rounded-lg border border-white/10 bg-white/5 text-center"},oL={class:"text-purple-400 text-lg md:text-xl font-semibold"},aL={key:1,class:"mb-3"},lL={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},uL={class:"flex-1"},cL={class:"text-blue-300 text-sm font-medium"},dL={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},hL=["disabled","title"],fL=["disabled"],pL=["disabled"],mL={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-email-notifications","update-selection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=N(!1),o=N("Copier le message"),a=N(!1),l=N(!1),c=N(""),d=N(!1),f=N(!1),g=ze(()=>{var W;return((W=r.event)==null?void 0:W.playerCount)||6}),y=N([]),x=N(null),S=ze(()=>Array.from({length:g.value},(Y,Ne)=>{var Je;return((Je=r.currentSelection)==null?void 0:Je[Ne])||null})),A=ze(()=>JSON.stringify(y.value)!==JSON.stringify(S.value)),j=ze(()=>(r.players||[]).map(W=>W.name).filter(W=>{var Y;return((Y=r.playerAvailability)==null?void 0:Y[W])===!0}).sort((W,Y)=>W.localeCompare(Y,"fr",{sensitivity:"base"})));function F(W){const Y=new Set(y.value.filter(Boolean)),Ne=y.value[W];return Ne&&Y.delete(Ne),j.value.filter(Je=>!Y.has(Je))}function P(W){x.value=W}function q(){x.value=null}function X(W,Y){var Je;const Ne=((Je=W==null?void 0:W.target)==null?void 0:Je.value)||"";Ne&&(y.value[Y]=Ne),x.value=null}function ue(W){y.value[W]=null}ze(()=>(F(-1).length<g.value,""));const E=ze(()=>r.currentSelection&&r.currentSelection.length>0),w=ze(()=>{var Je;if(!E.value)return!1;const W=r.currentSelection.some(Ze=>!tt(Ze)),Y=((Je=r.event)==null?void 0:Je.playerCount)||6,Ne=r.availableCount<Y;return W||Ne});ze(()=>{var Ne;if(!w.value)return"";const W=r.currentSelection.filter(Je=>!tt(Je)),Y=((Ne=r.event)==null?void 0:Ne.playerCount)||6;return W.length>0?W.length===1?`${W[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${W.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<Y?`Seulement ${r.availableCount} joueurs disponibles pour ${Y} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),ze(()=>{if(!r.event||!E.value)return"";const W=I(r.event.date),Y=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${W} : ${Y}`}),Ot(()=>r.show,W=>{if(W){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const Y=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ne=g.value;y.value=Array.from({length:Ne},(Je,Ze)=>Y[Ze]||null),x.value=null}}),Ot([g,()=>r.currentSelection,()=>{var W;return(W=r.event)==null?void 0:W.id}],()=>{if(!r.show)return;const W=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Y=g.value,Ne=Array.from({length:Y},(Je,Ze)=>W[Ze]||y.value[Ze]||null);y.value=Ne.slice(0,Y)});function I(W){var Ne;return W?(typeof W=="string"?new Date(W):((Ne=W.toDate)==null?void 0:Ne.call(W))||W).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function k(){s("selection")}function D(){s("perfect")}function $(){var Y;if(!((Y=r.event)!=null&&Y.id))return;const W=y.value.filter(Boolean);s("update-selection",{eventId:r.event.id,players:W})}function R(){s("close")}function Dt(){a.value=!0}function xt(){f.value=!0}function tt(W){return r.playerAvailability[W]===!0}function $e(W){return r.playerAvailability[W]===!1}function Ue(W){return r.currentSelection.includes(W)&&tt(W)}function De(W=!1,Y=!1){if(d.value=W,W){const Ne=I(r.event.date),Je=r.currentSelection.join(", ");Y?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ne} : ${Je}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ne} : ${Je}`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function te(){l.value=!1}e({showSuccess:De});function Ve(W){s("send-email-notifications",W),a.value=!1}return(W,Y)=>{var Ne,Je,Ze;return M(),L(_t,null,[n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:R},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:Y[1]||(Y[1]=Nt(()=>{},["stop"]))},[h("div",MM,[h("button",{onClick:R,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),Y[5]||(Y[5]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("h2",LM,"Sélection pour "+oe((Ne=n.event)==null?void 0:Ne.title),1),h("p",FM,oe(I((Je=n.event)==null?void 0:Je.date)),1),h("div",{class:"mt-3"},[h("button",{onClick:xt,class:"inline-flex items-center gap-2 text-sm text-blue-300 hover:text-blue-200"},Y[4]||(Y[4]=[h("span",null,"❓",-1),Ln(),h("span",null,"Kezako ?",-1)]))])]),h("div",$M,[h("div",UM,[Y[8]||(Y[8]=h("h3",{class:"text-base md:text-lg font-semibold text-white mb-2"},"Joueurs sélectionnés",-1)),h("div",jM,[(M(!0),L(_t,null,ur(y.value,(K,be)=>(M(),L("div",{key:"sel-slot-"+be,class:fn(["relative p-3 rounded-lg border text-center transition-colors",K?["bg-gradient-to-r",$e(K)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":tt(K)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[K?(M(),L("div",BM,[h("div",{class:"flex-1 text-white font-medium truncate",title:K},[Ue(K)?(M(),L("span",zM,"🎭")):tt(K)?(M(),L("span",GM,"✅")):$e(K)?(M(),L("span",KM,"❌")):(M(),L("span",HM,"–")),Ln(" "+oe(K),1)],8,qM),h("button",{onClick:de=>ue(be),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,WM)])):(M(),L("div",QM,[x.value===be?(M(),L("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:de=>X(de,be),onBlur:Y[0]||(Y[0]=de=>q())},[Y[6]||(Y[6]=h("option",{value:""},"— Choisir —",-1)),(M(!0),L(_t,null,ur(F(be),de=>(M(),L("option",{key:de,value:de},oe(de),9,YM))),128))],40,JM)):(M(),L("button",{key:1,onClick:de=>P(be),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},Y[7]||(Y[7]=[h("span",{class:"text-lg"},"＋",-1),h("span",{class:"text-sm"},"Ajouter",-1)]),8,XM))]))],2))),128))])]),w.value?(M(),L("div",ZM,Y[9]||(Y[9]=[h("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[h("div",{class:"text-yellow-400"},"⚠️"),h("div",{class:"text-yellow-200 text-sm"},"Sélection incomplète. Vérifie ci-dessous.")],-1)]))):le("",!0),h("div",eL,[h("div",tL,[h("div",nL,oe(((Ze=n.event)==null?void 0:Ze.playerCount)||6),1),Y[10]||(Y[10]=h("div",{class:"text-xs md:text-sm text-gray-400"},"À sélectionner",-1))]),h("div",rL,[h("div",sL,oe(n.availableCount),1),Y[11]||(Y[11]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Disponibles",-1))]),h("div",iL,[h("div",oL,oe(n.selectedCount),1),Y[12]||(Y[12]=h("div",{class:"text-xs md:text-sm text-gray-400"},"Sélectionnés",-1))])]),l.value?(M(),L("div",aL,[h("div",lL,[Y[14]||(Y[14]=h("div",{class:"text-blue-400 text-xl"},"✨",-1)),h("div",uL,[h("p",cL,oe(c.value),1)]),h("button",{onClick:te,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},Y[13]||(Y[13]=[h("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):le("",!0)]),h("div",dL,[h("button",{onClick:k,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":E.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},Y[15]||(Y[15]=[Ln(" ✨ "),h("span",{class:"hidden sm:inline"},"Sélection Auto",-1),h("span",{class:"sm:hidden"},"Auto",-1)]),8,hL),h("button",{onClick:$,disabled:!A.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed",title:"Enregistrer cette composition manuelle"},Y[16]||(Y[16]=[Ln(" 💾 "),h("span",{class:"hidden sm:inline"},"Enregistrer",-1),h("span",{class:"sm:hidden"},"Save",-1)]),8,fL),E.value?(M(),L("button",{key:0,onClick:D,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap"},Y[17]||(Y[17]=[Ln(" 👍 "),h("span",{class:"hidden sm:inline"},"Parfait",-1)]))):le("",!0),h("button",{onClick:Dt,disabled:!E.value,class:"h-12 px-3 md:px-4 bg-gray-700 text-white rounded-lg flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},Y[18]||(Y[18]=[Ln(" 📣 "),h("span",{class:"hidden sm:inline"},"Annoncer",-1)]),8,pL)])])])):le("",!0),ht(CE,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:Y[2]||(Y[2]=K=>a.value=!1),onSendEmailNotifications:Ve},null,8,["show","event","season-id","season-slug","players","selected-players"]),ht(OM,{show:f.value,onClose:Y[3]||(Y[3]=K=>f.value=!1)},null,8,["show"])],64)}}},gL={class:"flex items-center justify-center gap-2"},vL=["title"],yL=["title"],_L=["title"],bL=["title"],wL=["title"],h_={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=N(!1),i=ze(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=ze(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(M(),L("div",{class:fn(["flex items-center justify-center transition-all duration-200 min-h-20 p-3 md:p-5",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-white/10"]]),onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[h("div",gL,[i.value&&s.value?(M(),L("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},oe(n.chancePercent)+"% ",9,vL)):(M(),L(_t,{key:1},[n.isSelected?(M(),L("span",{key:0,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," 🎭 ",8,yL)):n.isAvailable===!0?(M(),L("span",{key:1,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ✅ ",8,_L)):n.isAvailable===!1?(M(),L("span",{key:2,class:"text-2xl md:text-3xl hover:scale-110 transition-transform duration-200",title:o.value}," ❌ ",8,bL)):(M(),L("span",{key:3,class:fn(["text-gray-500 transition-colors duration-200 text-xl",n.disabled?"":"hover:text-white"]),title:o.value}," – ",10,wL))],64))])],34))}},IL={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},EL={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},TL={class:"text-2xl md:text-3xl font-bold text-white mb-3"},xL={class:"text-gray-300 mb-6"},AL={class:"flex flex-col items-stretch justify-center gap-3"},SL=["value"],PL={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=ze(()=>`${s}/season/${t.seasonSlug}`),o=N(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=ze(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=ze(()=>a.value>0),c=N(l.value);Ot(a,A=>{c.value=A>0});const d=ze(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=ze(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function x(){var A;try{(A=navigator.clipboard)==null||A.writeText(i.value)}catch{}r("copy-link")}async function S(){try{if(t.seasonId){const{db:A}=await un(()=>Promise.resolve().then(()=>pi),void 0),{doc:j,updateDoc:F}=await un(()=>import("./index.esm-70987b7c.js"),[]);await F(j(A,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(A,j)=>l.value&&c.value?(M(),L("div",IL,[h("div",EL,[j[1]||(j[1]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎬")],-1)),h("h2",TL,oe(d.value),1),h("p",xL,oe(f.value),1),h("div",AL,[a.value===1?(M(),L("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(M(),L("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(M(),L(_t,{key:2},[h("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:j[0]||(j[0]=F=>F.target.select())},null,40,SL),h("div",{class:"flex gap-3 justify-center"},[h("button",{onClick:x,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),h("button",{onClick:S,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):le("",!0)])])])):le("",!0)}},RL={class:"flex justify-center gap-2 mb-4"},CL={class:"space-y-3"},kL={key:0},DL={key:0,class:"text-sm text-gray-400"},VL={key:1,class:"space-y-2"},NL={class:"flex items-center justify-between gap-3"},OL={class:"truncate"},ML={class:"text-white font-semibold"},LL={class:"text-gray-400 text-xs"},FL=["onClick"],$L={key:1,class:"text-sm text-gray-300"},UL={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},jL={class:"flex items-center justify-between"},BL={class:"flex items-center gap-2"},qL={class:"flex items-center justify-between"},zL={class:"flex items-center gap-2"},GL={class:"text-right"},KL=["disabled"],HL={key:0,class:"text-xs text-red-300"},WL={key:1,class:"text-xs text-green-300"},QL={key:2,class:"flex flex-col gap-3"},JL={class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},YL={class:"flex items-center gap-2"},XL=["disabled"],ZL={key:0,class:"mt-2 text-xs text-red-300"},eF={key:1,class:"mt-2 text-xs text-green-300"},tF={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","manage-player","change-password","logout-device","delete-account"],setup(n,{emit:e}){const t=n,r=e,s=N(""),i=N([]),o=N("players");function a(E){return["px-4 py-2 rounded-full text-sm transition-colors",o.value===E?"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"]}function l(E){return`${E.seasonId||"global"}__${E.playerId}`}async function c(){var E;try{s.value=((E=ln==null?void 0:ln.currentUser)==null?void 0:E.email)||""}catch{}try{const w=s.value?await EE(s.value):[],I=[];for(const k of w){let D=k.playerId;try{if(k.seasonId){const $=Se(ae,"seasons",k.seasonId,"players",k.playerId),R=await Pn($);R.exists()&&(D=R.data().name||D)}}catch{}I.push({...k,playerName:D})}i.value=I}catch{i.value=[]}}function d(){r("close")}Ot(()=>t.show,E=>{E&&(c(),X())}),wr(()=>{t.show&&(c(),X())});const f=N(""),g=N(!1),y=N(""),x=N(""),S=N(!1);Ot(s,E=>{f.value=E||""}),Ot(f,E=>{S.value=!!E&&E.includes("@")&&E!==s.value});async function A(){if(S.value){g.value=!0,y.value="",x.value="";try{const E=await pE({currentEmail:s.value,newEmail:f.value.trim()});await RE({toEmail:f.value.trim(),verifyUrl:E.url,purpose:"account_email_update",displayName:"utilisateur"}),x.value=`Un email de vérification a été envoyé à ${f.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(E){y.value=(E==null?void 0:E.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{g.value=!1}}}const j=N({notifyAvailability:!0,notifySelection:!0}),F=N(!1),P=N(""),q=N("");async function X(){try{if(!s.value)return;const E=Se(ae,"userPreferences",s.value),w=await Pn(E);if(w.exists()){const I=w.data()||{};j.value.notifyAvailability=I.notifyAvailability!==!1,j.value.notifySelection=I.notifySelection!==!1}else j.value={notifyAvailability:!0,notifySelection:!0}}catch{}}async function ue(){if(s.value){F.value=!0,P.value="",q.value="";try{const E=Se(ae,"userPreferences",s.value);await pn(E,{...j.value},{merge:!0}),q.value="Préférences sauvegardées"}catch{P.value="Impossible de sauvegarder vos préférences"}finally{F.value=!1}}}return(E,w)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:d},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:w[9]||(w[9]=Nt(()=>{},["stop"]))},[h("button",{onClick:d,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),w[15]||(w[15]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Gérez votre compte et vos préférences</p></div>',1)),h("div",RL,[h("button",{onClick:w[0]||(w[0]=I=>o.value="manage"),class:fn(a("manage"))},"Gérer",2),h("button",{onClick:w[1]||(w[1]=I=>o.value="notifications"),class:fn(a("notifications"))},"Notifications",2),h("button",{onClick:w[2]||(w[2]=I=>o.value="players"),class:fn(a("players"))},"Joueurs",2)]),h("div",CL,[o.value==="players"?(M(),L("div",kL,[w[10]||(w[10]=h("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(M(),L("div",DL,"Aucun joueur associé pour le moment.")):(M(),L("ul",VL,[(M(!0),L(_t,null,ur(i.value,I=>(M(),L("li",{key:l(I),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[h("div",NL,[h("div",OL,[h("div",ML,oe(I.seasonName||I.seasonId||"—"),1),h("div",LL,"Joueur : "+oe(I.playerName||"—"),1)]),h("button",{onClick:k=>E.$emit("manage-player",I),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,FL)])]))),128))]))])):o.value==="notifications"?(M(),L("div",$L,[h("div",UL,[h("div",jL,[h("label",BL,[it(h("input",{type:"checkbox","onUpdate:modelValue":w[3]||(w[3]=I=>j.value.notifyAvailability=I),class:"w-4 h-4"},null,512),[[wa,j.value.notifyAvailability]]),w[11]||(w[11]=h("span",null,"Recevoir les demandes de disponibilités",-1))])]),h("div",qL,[h("label",zL,[it(h("input",{type:"checkbox","onUpdate:modelValue":w[4]||(w[4]=I=>j.value.notifySelection=I),class:"w-4 h-4"},null,512),[[wa,j.value.notifySelection]]),w[12]||(w[12]=h("span",null,"Recevoir les emails de sélection",-1))])]),h("div",GL,[h("button",{onClick:ue,disabled:F.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},oe(F.value?"⏳":"Sauvegarder"),9,KL)]),P.value?(M(),L("div",HL,oe(P.value),1)):le("",!0),q.value?(M(),L("div",WL,oe(q.value),1)):le("",!0)])])):(M(),L("div",QL,[h("div",JL,[w[13]||(w[13]=h("label",{class:"block text-xs text-gray-400 mb-2"},"Email",-1)),h("div",YL,[it(h("input",{"onUpdate:modelValue":w[5]||(w[5]=I=>f.value=I),type:"email",class:"flex-1 p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"nouvel@email.com"},null,512),[[Rt,f.value]]),h("button",{onClick:A,disabled:!S.value||g.value,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},oe(g.value?"⏳":"Mettre à jour"),9,XL)]),y.value?(M(),L("div",ZL,oe(y.value),1)):le("",!0),x.value?(M(),L("div",eF,oe(x.value),1)):le("",!0)]),w[14]||(w[14]=h("div",{class:"text-sm text-gray-400"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),h("button",{onClick:w[6]||(w[6]=I=>E.$emit("change-password")),class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500"},"Changer de mot de passe"),h("button",{onClick:w[7]||(w[7]=I=>E.$emit("logout-device")),class:"w-full px-4 py-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600"},"Déconnexion de cet appareil"),h("button",{onClick:w[8]||(w[8]=I=>E.$emit("delete-account")),class:"w-full px-4 py-3 rounded-lg bg-red-600 text-white hover:bg-red-500"},"Supprimer mon compte")]))]),h("div",{class:"mt-6 text-center"},[h("button",{onClick:d,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):le("",!0)}},nF={class:"space-y-4"},rF={class:"flex items-center justify-between"},sF={class:"flex items-center gap-2 text-gray-300 text-sm"},iF={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},oF={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},aF={class:"flex justify-center gap-3 mt-2"},lF=["disabled"],uF={key:0,class:"animate-spin"},cF={key:1},dF={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=N(""),s=N(""),i=N(!1),o=N(""),a=N(""),l=N(!0),c=ze(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function d(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await oE(r.value.trim(),s.value),l.value)try{Si.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await aE(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,y)=>n.show?(M(),L("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=x=>g.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=Nt(()=>{},["stop"]))},[h("button",{onClick:y[0]||(y[0]=x=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte</p></div>',1)),h("div",nF,[h("div",null,[y[7]||(y[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),it(h("input",{"onUpdate:modelValue":y[1]||(y[1]=x=>r.value=x),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Rt,r.value]])]),h("div",null,[y[8]||(y[8]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),it(h("input",{"onUpdate:modelValue":y[2]||(y[2]=x=>s.value=x),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Rt,s.value]])]),h("div",rF,[h("label",sF,[it(h("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=x=>l.value=x),class:"w-4 h-4"},null,512),[[wa,l.value]]),y[9]||(y[9]=h("span",null,"Rester connecté sur cet appareil",-1))]),h("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(M(),L("div",iF,oe(o.value),1)):le("",!0),a.value?(M(),L("div",oF,oe(a.value),1)):le("",!0),h("div",aF,[h("button",{onClick:y[4]||(y[4]=x=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),h("button",{onClick:d,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(M(),L("span",uF,"⏳")):(M(),L("span",cF,"Se connecter"))],8,lF)])])])])):le("",!0)}};const hF={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},fF={ref:"pageHeaderRef",class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},pF={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},mF={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},gF={class:"hidden md:flex items-center gap-2"},vF={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},yF={class:"flex items-stretch relative"},_F={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},bF={class:"flex-1 overflow-hidden"},wF=["data-event-id","onClick"],IF=["title"],EF=["title"],TF={key:0,class:"mt-1 text-xs text-gray-400"},xF=["title","onClick"],AF=["title","onClick"],SF=["title","aria-label"],PF={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},RF={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},CF={key:0,class:"pointer-events-none"},kF={class:"flex items-center justify-between"},DF={key:1,class:"pointer-events-none"},VF={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},NF={class:"flex items-center justify-between"},OF={key:2,class:"pointer-events-none"},MF={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},LF={class:"flex items-center justify-between"},FF={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},$F=["data-player-id"],UF={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},jF={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},BF={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},qF=["onClick","title"],zF=["data-event-id"],GF={class:"border-t border-white/10"},KF={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},HF={class:"px-4 md:px-5 flex items-center"},WF=["data-event-id"],QF={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},JF={class:"text-center"},YF={class:"text-white text-lg"},XF={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},ZF={class:"text-white/60 text-xs mt-2"},e4={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},t4={class:"flex items-center space-x-2"},n4={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},r4={class:"flex items-center space-x-2"},s4={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},i4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},o4={class:"mb-6"},a4={class:"mb-6"},l4={class:"mb-6"},u4={class:"mb-6 flex items-center gap-3"},c4={class:"mb-6"},d4={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},h4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},f4={class:"mb-6"},p4={class:"flex justify-end space-x-3"},m4={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},g4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},v4={class:"flex justify-end space-x-3"},y4={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},_4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},b4={class:"flex justify-end space-x-3"},w4={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},I4={class:"relative text-center p-6 pb-4 border-b border-white/10"},E4={class:"text-2xl md:text-3xl font-bold text-white mb-1"},T4={class:"text-sm md:text-base text-purple-300"},x4={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},A4={key:0,class:"mb-4 md:mb-6"},S4={class:"text-gray-300 bg-gray-800/50 p-4 rounded-lg border border-gray-600/50"},P4={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},R4={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30"},C4={class:"text-xl md:text-2xl font-bold text-white"},k4={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30"},D4={class:"text-xl md:text-2xl font-bold text-white"},V4={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30"},N4={class:"text-xl md:text-2xl font-bold text-white"},O4={key:1,class:"mb-4 md:mb-6"},M4={class:"bg-gray-800 border border-gray-600 rounded-lg overflow-hidden"},L4={class:"col-span-4 p-3 flex items-center min-w-0"},F4=["title"],$4={key:0,class:"text-yellow-400 ml-2 text-lg",title:"Joueur protégé"},U4={class:"col-span-8 p-0"},j4={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},B4=["disabled","title"],q4=["title"],z4={key:2,class:"md:hidden mt-3 space-y-2"},G4=["disabled","title"],K4={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},H4={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},W4={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Q4={class:"mb-6"},J4={class:"mb-6"},Y4={class:"mb-6"},X4={class:"mb-6 flex items-center gap-3"},Z4={class:"mb-6"},e3={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},t3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},n3={class:"mb-6"},r3={class:"space-y-4"},s3=["disabled"],i3={key:0,class:"animate-spin"},o3={key:1},a3={class:"mb-6 text-center"},l3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},u3={class:"text-red-300 text-sm"},c3={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},d3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},h3={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},f3={class:"space-y-4"},p3={class:"mt-2 text-center"},m3={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},g3={class:"text-red-300 text-sm"},v3={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},y3=["disabled"],_3={key:0,class:"animate-spin"},b3={key:1},w3={class:"mb-6"},I3=["disabled"],E3={key:0,class:"animate-spin"},T3={key:1},x3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},A3={class:"text-red-300 text-sm"},S3={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},P3={class:"text-green-300 text-sm"},R3={class:"flex justify-center"},C3={class:"mb-6"},k3=["disabled"],D3={key:0,class:"animate-spin"},V3={key:1},N3={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},O3={class:"text-red-300 text-sm"},M3={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},L3={class:"text-green-300 text-sm"},F3={class:"flex justify-center"},$3={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},U3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},j3={class:"flex gap-3"},f_={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Vu(),r=Ba(),s=e.slug,i=N(""),o=N(""),a=N({}),l=N(!1),c=N(null),d=N(null),f=N(""),g=N(""),y=N(6),x=N(!1),S=N(""),A=N(null),j=N(null),F=N(null),P=N({position:null,side:null}),q=N({position:null}),X=N({position:null}),ue=N(!1),E=N(null),w=N(!1),I=N(null),k=N(null),D=N(!1),$=N(null),R=N(""),Dt=N(!1),xt=N(null),tt=N(""),$e=N(""),Ue=N(!1),De=N(null),te=N(!1),Ve=N(null),W=N(""),Y=N(""),Ne=N(!1),Je=N(null),Ze=N(!1),K=N(!1),be=N(""),de=N(""),Ae=N(!1),He=N(!1),lt=N(""),T=N(""),C=N(!1),O=N(null),Z=N(""),J=N(!1),ee=N(!1),ye=N(!1),he=N(null),ce=N(null),ie=N(null),Ee=N(0);function we(){try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||qe.value.length===0)return;const _=localStorage.getItem(`playerTourCompleted:${o.value}`),m=localStorage.getItem(`startPlayerTour:${o.value}`);!_&&m&&(Ee.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),hn(()=>{const V=document.querySelector('button[data-onboarding="add-player"]');if(V){V.scrollIntoView({behavior:"smooth",block:"end"});const Q=V.getBoundingClientRect(),se=document.getElementById("coachmark-add"),ge=280,fe=100,Le=(se==null?void 0:se.offsetWidth)||ge,We=(se==null?void 0:se.offsetHeight)||fe,dt=Math.round(Q.right+12);if(dt+Le<=window.innerWidth-12){const St=Q.top+Q.height/2-We/2,Jt=-14,Yt=12,ft=window.innerHeight-We-12,Dr=Math.max(Yt,Math.min(Math.round(St+Jt),ft));P.value={position:{x:dt,y:Dr},side:"right"}}else{const St=Math.round(Q.left+Q.width/2-Le/2),Jt=Math.round(Q.top-We-8),Yt=8,ft=window.innerWidth-Le-8;P.value={position:{x:Math.max(Yt,Math.min(St,ft)),y:Jt},side:null}}}}))}catch{}}const Te=N(!1),Re=N(null),Me=N(null),Be=N(!1),Xe=N(null),Kt=N(!1),$t=N(null),vn=N(!1),Vt=N(!1),fr=N(!1),Lr=N(!1),rn=N(null);function Rn(){Vt.value=!1}function Ni(){try{const _=ln==null?void 0:ln.currentUser;if(!_||_.isAnonymous){let m=null;ml.value&&(m=Ye.value.find(V=>V.id===ml.value)||null),m||(m=Ye.value[0]||null),Lr.value=!0,m&&(rn.value=m);return}}catch{}Vt.value=!0}async function ol(){var _;try{const m=(_=ln==null?void 0:ln.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:V}=await un(()=>Promise.resolve().then(()=>pi),void 0);await V(m),Oe.value=!0,ut.value="Email de réinitialisation envoyé.",setTimeout(()=>{Oe.value=!1},3e3)}catch{gr.value=!0,Ui.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{gr.value=!1},3e3)}}async function rc(){try{await QD(ln),Rn(),Oe.value=!0,ut.value="Déconnecté de cet appareil.",setTimeout(()=>{Oe.value=!1},2500)}catch{gr.value=!0,Ui.value="Déconnexion impossible.",setTimeout(()=>{gr.value=!1},3e3)}}async function sc(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Oi(_){var m;Rn();try{if(_.seasonId&&_.seasonId!==o.value){const V=Se(ae,"seasons",_.seasonId),se=(await vt(Qe(ae,"seasons"))).docs.find(fe=>fe.id===_.seasonId),ge=(m=se==null?void 0:se.data())==null?void 0:m.slug;if(ge){t.push(`/season/${ge}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const V=Ye.value.find(Q=>Q.id===_.playerId);if(V){G(V);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}wr(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}});function al(){hn(()=>{ul()})}const Ar=N(new Set),Jn=N(!0),Sr=N(0),Pr=N("Préparation de la grille"),Rr=N(e.eventId||null),Us=N(!1),Mi=N(null);Ot(()=>e.eventId,_=>{if(_)if(Rr.value=_,qe.value.length>0)fg(_);else{const m=Ot(qe,V=>{V.length>0&&(fg(_),m())},{immediate:!0})}});const cn=ze(()=>Ye.value.map(_=>({..._,isProtected:Ar.value.has(_.id),email:null}))),ic=ze(()=>Rr.value?kn.value.findIndex(_=>_.id===Rr.value):-1);ze(()=>{if(!Rr.value||ic.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${Rr.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Cn=N(null),js=N(!1),oc=N(!1),ll=N(0),Bs=N(null),qn=N(null),ko=N(null);function zn(){const _=Cn.value;if(!_)return;const{scrollLeft:m,scrollWidth:V,clientWidth:Q}=_;js.value=m>2,oc.value=m<V-Q-2}function ul(){var _;try{zn(),ll.value=((_=Cn.value)==null?void 0:_.scrollLeft)||0}catch{}}function Do(_){const m=Cn.value;if(!m)return;let V=0;const Q=m.querySelector("tbody tr td[data-event-id]");if(Q)V=Q.getBoundingClientRect().width;else if(qn!=null&&qn.value){const ge=qn.value.querySelector(".col-event");ge&&(V=ge.getBoundingClientRect().width)}(!V||!isFinite(V))&&(V=m.clientWidth*.6);const se=m.scrollLeft+_*V;m.scrollTo({left:se,behavior:"smooth"})}const Fr=N(null);N(0);const Yn=N(!1),Li=N(!1),ns=N(0);function Vo(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),pr(),Do(_)}function qs(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),Yn.value)return;Yn.value=!0,ns.value=_,Li.value=!1;const V=Cn.value;if(!V)return;let Q=0;const se=V.querySelector("tbody tr td[data-event-id]");if(se)Q=se.getBoundingClientRect().width;else if(qn!=null&&qn.value){const We=qn.value.querySelector(".col-event");We&&(Q=We.getBoundingClientRect().width)}(!Q||!isFinite(Q))&&(Q=V.clientWidth*.6);const ge=Q/6,fe=120,Le=()=>{if(!Yn.value||ns.value===0)return;Li.value||(Li.value=!0);const We=V.scrollLeft+ns.value*ge;V.scrollTo({left:We,behavior:"auto"}),Fr.value=window.setTimeout(Le,fe)};Fr.value=window.setTimeout(Le,250)}function pr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=Yn.value,V=Li.value;if(Yn.value=!1,Fr.value&&(clearTimeout(Fr.value),Fr.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!V){const Q=ns.value||0;Q!==0&&Do(Q),ns.value=0;return}ns.value=0,m&&V&&ac()}function ac(){const _=Cn.value;if(!_)return;let m=0;const V=_.querySelector("tbody tr td[data-event-id]");if(V)m=V.getBoundingClientRect().width;else if(qn!=null&&qn.value){const fe=qn.value.querySelector(".col-event");fe&&(m=fe.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const Q=_.scrollLeft,ge=Math.round(Q/m)*m;_.scrollTo({left:ge,behavior:"smooth"})}function Oh(_){A.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Oe.value=!0,ut.value="Nouveau joueur ajouté !",setTimeout(()=>{Oe.value=!1},3e3)}function No(){if(Ee.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),V=document.getElementById("coachmark-add"),Q=280,se=100,ge=V!=null&&V.offsetWidth&&V.offsetWidth>0?V.offsetWidth:Q,fe=V!=null&&V.offsetHeight&&V.offsetHeight>0?V.offsetHeight:se,Le=Math.round(m.right+12);if(Le+ge<=window.innerWidth-12){const dt=m.top+m.height/2-fe/2,St=cl(dt+-14,fe);P.value={position:{x:Le,y:St},side:"right"}}else{const dt=Math.round(m.left+m.width/2-ge/2),At=cl(m.top-fe-8,fe),St=8,Jt=window.innerWidth-ge-8;P.value={position:{x:Math.max(St,Math.min(dt,Jt)),y:At},side:null}}}function cl(_,m){const V=pageHeaderRef==null?void 0:pageHeaderRef.value,Q=V?Math.max(0,Math.round(V.getBoundingClientRect().height||0)):0,se=Math.max(12,Q+8),ge=window.innerHeight-m-12;return Math.max(se,Math.min(Math.round(_),ge))}const mr=N(!1),rs=N(null),$r=N(null),Oo=N({position:"fixed",top:"0px",right:"0px"});function dl(){try{const _=rs.value;if(!_)return;const m=_.getBoundingClientRect(),V=8,Q=Math.max(V,Math.round(m.bottom+V)),se=Math.max(V,Math.round(window.innerWidth-m.right));Oo.value={position:"fixed",top:`${Q}px`,right:`${se}px`,zIndex:400}}catch{}}function lc(){mr.value=!mr.value,mr.value&&hn(()=>dl())}function Mo(){mr.value=!1}function hl(_){if(!mr.value)return;const m=rs.value,V=$r.value,Q=m&&m.contains(_.target),se=V&&V.contains(_.target);!Q&&!se&&(mr.value=!1)}function Lo(_){_.key==="Escape"&&Mo()}function zs(){mr.value&&dl()}wr(()=>{document.addEventListener("click",hl),document.addEventListener("keydown",Lo),window.addEventListener("scroll",zs,{passive:!0}),window.addEventListener("resize",zs)}),aa(()=>{document.removeEventListener("click",hl),document.removeEventListener("keydown",Lo),window.removeEventListener("scroll",zs),window.removeEventListener("resize",zs)});function Fi(){var _;Ee.value===1&&((_=P.value)!=null&&_.position)&&No()}wr(()=>{window.addEventListener("scroll",Fi,{passive:!0}),window.addEventListener("resize",Fi)}),aa(()=>{window.removeEventListener("scroll",Fi),window.removeEventListener("resize",Fi)});function $i(_){return Ar.value.has(_)}async function fl(){if(o.value)try{const _=await vp(o.value),m=new Set;_.forEach(V=>{V.isProtected&&m.add(V.playerId||V.id)}),Ar.value=m}catch{const m=new Set;for(const V of Ye.value)await mi(V.id,o.value)&&m.add(V.id);Ar.value=m}}const Oe=N(!1),ut=N(""),gr=N(!1),Ui=N("");function ss(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Oe.value=!0,ut.value="Lien copié dans le presse-papiers",setTimeout(()=>{Oe.value=!1},2500)}catch{gr.value=!0,Ui.value="Impossible de copier le lien",setTimeout(()=>{gr.value=!1},2500)}}async function vr(_){await ls({type:"deleteEvent",data:{eventId:_}})}async function Fo(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await MN(m,o.value),qe.value=qe.value.filter(V=>V.id!==m),await Promise.all([a_(o.value),Zo(Ye.value,qe.value,o.value),ea(o.value)]).then(([V,Q,se])=>{qe.value=V,Ht.value=Q,ct.value=se}),l.value=!1,c.value=null,Oe.value=!0,ut.value="Événement supprimé avec succès !",setTimeout(()=>{Oe.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function $o(){l.value=!1,c.value=null}async function Uo(){if(!d.value||!f.value.trim()||!g.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:g.value,description:Z.value.trim()||"",playerCount:_,archived:!!J.value};await c_(d.value,m,o.value),!m.archived&&Ye.value.length>0&&Ar.value.size>0&&($t.value={id:d.value,...m},Kt.value=!0),await Promise.all([a_(o.value),Zo(Ye.value,qe.value,o.value),ea(o.value)]).then(([V,Q,se])=>{qe.value=V,Ht.value=Q,ct.value=se}),d.value=null,f.value="",g.value="",Z.value="",y.value=6,J.value=!1,Oe.value=!0,ut.value="Événement mis à jour avec succès !",setTimeout(()=>{Oe.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function It(){if(S.value.trim())try{const _=S.value.trim(),m=await PE(_,o.value);await Promise.all([If(o.value),Zo(Ye.value,qe.value,o.value),ea(o.value)]).then(([V,Q,se])=>{Ye.value=V,Ht.value=Q,ct.value=se,fl();const ge=Ye.value.find(Le=>Le.id===m);Oh(m),j.value=m,F.value=kn.value&&kn.value[0]&&kn.value[0].id?kn.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Ee<"u"&&(Ee.value=2)}catch{}const fe=document.querySelector(`[data-player-id="${m}"]`);fe&&fe.scrollIntoView({behavior:"smooth",block:"center"}),hn(()=>{const Le=`[data-player-id="${j.value}"] td[data-event-id="${F.value}"]`,We=document.querySelector(Le);if(We){const dt=We.getBoundingClientRect();q.value.position={x:Math.round(dt.left),y:Math.round(dt.top+window.scrollY-48)}}}),Oe.value=!0,ut.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Oe.value=!1},3e3),setTimeout(()=>{Oe.value=!1,ut.value=""},5e3)}),x.value=!1,S.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function Ur(){d.value=null,f.value="",g.value="",Z.value="",y.value=6}N(null);const jr=N(!1),yr=N(""),Gs=N(""),Ks=N(""),ji=N(6),jo=N(!1);async function Mh(){if(!yr.value.trim()||!Gs.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(ji.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:yr.value.trim(),date:Gs.value,description:Ks.value.trim()||"",playerCount:_,archived:!!jo.value};await Lh(m)}async function Lh(_){try{const m=await LN(_,o.value);qe.value=[...qe.value,{id:m,..._}];const V={};for(const Q of Ye.value)V[Q.name]=Ht.value[Q.name]||{},V[Q.name][m]=null,await l_(Q.name,V[Q.name],o.value);yr.value="",Gs.value="",Ks.value="",ji.value=6,jo.value=!1,jr.value=!1,await Promise.resolve(),Oe.value=!0,ut.value="Événement créé avec succès !",!_.archived&&Ye.value.length>0&&Ar.value.size>0&&($t.value={id:m,..._},Kt.value=!0),setTimeout(()=>{Oe.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function Bi(){yr.value="",Gs.value="",Ks.value="",ji.value=6,jr.value=!1}async function Cr(){await ls({type:"addEvent",data:{}})}const qe=N([]),Ye=N([]),Ht=N({}),ct=N({}),Fh=N({}),pl=N({});Ot([()=>qe.value.length,()=>Ye.value.length,Jn],()=>{Jn.value||hn(()=>{ul()})}),Ot([()=>Ye.value.length,()=>qe.value.length,o],()=>{we()}),wr(async()=>{var ge;SE("firebase"),await DN();const _=Eu(Qe(ae,"seasons"),Rd("slug","==",e.slug)),m=await vt(_);if(m.empty){t.push("/");return}else{const fe=m.docs[0];o.value=fe.id;const Le=fe.data();i.value=Le.name,a.value=Le,document.title=`Saison : ${i.value}`}if(o.value){Pr.value="Chargement des événements de la saison",Sr.value=20;const fe=await vt(Qe(ae,"seasons",o.value,"events"));qe.value=fe.docs.map(ft=>({id:ft.id,...ft.data(),playerCount:ft.data().playerCount||6})),Pr.value="Chargement des joueurs",Sr.value=45;const Le=await vt(Qe(ae,"seasons",o.value,"players"));Ye.value=Le.docs.map(ft=>({id:ft.id,...ft.data()})),Pr.value="Chargement des disponibilités",Sr.value=70;const We=await vt(Qe(ae,"seasons",o.value,"availability")),dt={};We.docs.forEach(ft=>{const Dr=ft.data(),ds={};Object.keys(Dr).forEach(Wi=>{const Ho=Dr[Wi];ds[Wi]=Ho==="oui"?!0:Ho==="non"?!1:Ho}),dt[ft.id]=ds}),Ht.value=dt,Pr.value="Chargement des sélections",Sr.value=85;const At=await vt(Qe(ae,"seasons",o.value,"selections")),St={};At.docs.forEach(ft=>{St[ft.id]=ft.data().players||[]}),ct.value=St;const Jt=await vp(o.value),Yt=new Set;Array.isArray(Jt)&&Jt.forEach(ft=>{ft.isProtected&&Yt.add(ft.playerId||ft.id)}),Ar.value=Yt}const V=fe=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>fe()):setTimeout(fe,0)};Pr.value="Préparation de l'interface",Sr.value=95,V(()=>{_l(),Gi()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await hn(),Sr.value=100,Jn.value=!1,hn(()=>{zn(),requestAnimationFrame(()=>zn()),setTimeout(()=>zn(),250);const fe=Cn.value;fe&&(fe.addEventListener("scroll",Le=>{zn(),ll.value=fe.scrollLeft||0},{passive:!0}),window.addEventListener("resize",zn),typeof ResizeObserver<"u"&&(ko.value=new ResizeObserver(()=>{zn()}),ko.value.observe(fe)))});const Q=r.query.event;if(Q&&qe.value.length>0){const fe=qe.value.find(Le=>Le.id===Q);fe?(console.debug("Événement trouvé depuis l'URL"),await qh(Q,fe)):(console.warn("Événement non trouvé avec l'ID"),gr.value=!0,Ui.value="Événement non trouvé",setTimeout(()=>{gr.value=!1},3e3))}const se=r.query.player;if(se&&Ye.value.length>0){const fe=Ye.value.find(Le=>Le.id===se);fe&&(G(fe),await hn(),r.query.open==="protection"&&((ge=k==null?void 0:k.value)!=null&&ge.openProtection)&&k.value.openProtection())}}),Ot(()=>r.params.eventId,_=>{if(_){const m=()=>{const V=qe.value.find(Q=>Q.id===_);return V?(Il(V),!0):!1};if(qe.value.length>0)m();else{const V=Ot(qe,Q=>{Q.length>0&&m()&&V()},{immediate:!0})}}},{immediate:!0});function uc(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Xn=ze(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...Ye.value].sort((ge,fe)=>(ge.name||"").localeCompare(fe.name||"","fr",{sensitivity:"base"}));if(!_)return m;const V=m.findIndex(ge=>ge.id===_);if(V<=0)return m;const Q=m[V],se=m.slice(0,V).concat(m.slice(V+1));return[Q,...se]}),ml=ze(()=>{try{if(o.value)return localStorage.getItem(`seasonPreferredPlayer:${o.value}`)}catch{}return null}),$h=ze(()=>[...qe.value].sort((_,m)=>{const V=uc(_.date),Q=uc(m.date),se=V?V.getTime():Number.POSITIVE_INFINITY,ge=Q?Q.getTime():Number.POSITIVE_INFINITY;return se!==ge?se-ge:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),kr=N(!1),kn=ze(()=>{const _=$h.value;return kr.value?_:_.filter(m=>!m.archived)});function cc(){kr.value=!kr.value}async function Br(_,m){const V=Ye.value.find(ge=>ge.name===_);if(!V){console.error("Joueur non trouvé");return}const Q=qe.value.find(ge=>ge.id===m);if(!Q){console.error("Événement non trouvé");return}if(Q.archived){Oe.value=!0,ut.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Oe.value=!1},3e3);return}if($i(V.id)){const ge=fo(V.id),fe=ie.value===V.id;console.debug("Joueur protégé:",{playerId:V.id,hasCachedPassword:ge,wasRecentlyVerified:fe,recentlyVerifiedPlayer:ie.value}),ge||fe?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),fe&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),ie.value=null),is(V,m)):(console.debug("Pas de session, affichage de la modal de vérification"),ce.value={playerName:_,eventId:m},he.value=V,ye.value=!0);return}is(V,m)}function is(_,m){var se,ge,fe;const V=(se=Ht.value[_.name])==null?void 0:se[m];console.debug("toggleAvailability");let Q;V===!0?Q=!1:V===!1?Q=void 0:Q=!0,Q===void 0?Ht.value[_.name]&&delete Ht.value[_.name][m]:(Ht.value[_.name]||(Ht.value[_.name]={}),Ht.value[_.name][m]=Q);try{typeof Ee<"u"&&Ee.value===1&&_.id===(j.value||((ge=Xn.value[0])==null?void 0:ge.id))&&m===(F.value||((fe=kn.value[0])==null?void 0:fe.id))&&(Ee.value=3,hn(()=>{const We=document.querySelector(`[data-player-id="${_.id}"]`);if(We){const dt=We.querySelector(".player-name");if(dt){const At=dt.getBoundingClientRect();X.value.position={x:Math.round(At.right+8),y:Math.round(At.top+window.scrollY-4)}}}}),aa(()=>{try{window.removeEventListener("resize",zn)}catch{}try{ko.value&&ko.value.disconnect()}catch{}}))}catch{}l_(_.name,Ht.value[_.name],o.value).then(async()=>{await hn(),Gi(),Oe.value=!0,ut.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Oe.value=!1},3e3)}).catch(Le=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function _r(_,m){var V;return(V=Ht.value[_])==null?void 0:V[m]}function gl(_,m){var se;const V=ct.value[m]||[],Q=(se=Ht.value[_])==null?void 0:se[m];return V.includes(_)&&Q===!0}async function Ut(_,m=6){const V=qe.value.find(fe=>fe.id===_),Q=(V==null?void 0:V.playerCount)||6,se=ct.value[_]||[];if(se.length>0&&se.every(fe=>_r(fe,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const Le=Ye.value.filter(At=>_r(At.name,_)).map(At=>{const St=os(At.name);return{name:At.name,weight:1/(1+St)}}),We=[],dt=[...Le];for(;We.length<Q&&dt.length>0;){const At=dt.reduce((Yt,ft)=>Yt+ft.weight,0);let St=Math.random()*At;const Jt=dt.findIndex(Yt=>(St-=Yt.weight,St<=0));Jt>=0&&(We.push(dt[Jt].name),dt.splice(Jt,1))}ct.value[_]=We}else{const fe=se.filter(We=>_r(We,_)),Le=Q-fe.length;if(Le<=0)ct.value[_]=fe;else{const We=new Set(fe),At=Ye.value.filter(Yt=>_r(Yt.name,_)&&!We.has(Yt.name)).map(Yt=>{const ft=os(Yt.name);return{name:Yt.name,weight:1/(1+ft)}}),St=[],Jt=[...At];for(;St.length<Le&&Jt.length>0;){const Yt=Jt.reduce((ds,Wi)=>ds+Wi.weight,0);let ft=Math.random()*Yt;const Dr=Jt.findIndex(ds=>(ft-=ds.weight,ft<=0));Dr>=0&&(St.push(Jt[Dr].name),Jt.splice(Dr,1))}ct.value[_]=[...fe,...St]}}await u_(_,ct.value[_],o.value),_l(),Gi()}async function dc(_,m=6){var fe,Le;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const V=Te.value,Q=(fe=Re.value)==null?void 0:fe.id,se=ct.value[_]&&ct.value[_].length>0,ge=se?[...ct.value[_]]:[];if(await Ut(_,m),console.debug("etat modal selection apres"),V&&!Te.value&&(console.debug("Restauration de la popin de sélection..."),Te.value=!0,Re.value=qe.value.find(We=>We.id===Q)),Te.value&&((Le=Re.value)==null?void 0:Le.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await hn(),Me.value&&Me.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const We=ct.value[_]||[],dt=ge.filter(St=>We.includes(St)),At=dt.length>0&&dt.length<ge.length;Me.value.showSuccess(se,At)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Oe.value=!0,qe.value.find(We=>We.id===_),ct.value[_],se?ut.value="Sélection mise à jour avec succès !":ut.value="Sélection effectuée avec succès !",setTimeout(()=>{Oe.value=!1},3e3)}function vl(_){_===0?P.value.position=null:_===1?q.value.position=null:_===2&&(X.value.position=null)}function hc(_){var V;return _?(typeof _=="string"?new Date(_):((V=_.toDate)==null?void 0:V.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function Bo(_){var V;return _?(typeof _=="string"?new Date(_):((V=_.toDate)==null?void 0:V.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function os(_){return Object.values(ct.value).filter(m=>m.includes(_)).length}function Hs(_){const m=Ht.value[_]||{};return Object.values(m).filter(V=>V===!0).length}function qi(_){return _?Object.values(Ht.value).filter(m=>m[_]===!0).length:0}function or(_){return _?(ct.value[_]||[]).length:0}function yl(_){const m=qe.value.find(Q=>Q.id===_),V=(m==null?void 0:m.playerCount)||6;return or(_)>=V}function Uh(_){const m=Hs(_),V=os(_);return m===0?0:V/m}function zi(_){Fh.value[_]={availability:Hs(_),selection:os(_),ratio:Uh(_)}}function _l(){Ye.value.forEach(_=>zi(_.name))}function Gi(){const _={};qe.value.forEach(m=>{const V=m.playerCount||6,se=Ye.value.filter(fe=>_r(fe.name,m.id)===!0).map(fe=>{const Le=os(fe.name);return{name:fe.name,weight:1/(1+Le)}}),ge=se.reduce((fe,Le)=>fe+Le.weight,0);se.forEach(fe=>{const Le=Math.min(1,fe.weight/ge*V);_[fe.name]||(_[fe.name]={}),_[fe.name][m.id]=Math.round(Le*100)})}),pl.value=_}const as=N(null),Ki=N(!1);async function qo(_=null){const m=_||as.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await VN(m,o.value),Ye.value=Ye.value.filter(V=>V.id!==m),Ki.value=!1,as.value=null,Oe.value=!0,ut.value="Joueur supprimé avec succès !",setTimeout(()=>{Oe.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function jh(){Ki.value=!1,as.value=null}async function fc(_){me(),await mi(_,o.value)?await bl({type:"deletePlayer",data:{playerId:_}}):await ls({type:"deletePlayer",data:{playerId:_}})}async function Hi(){if(E.value){const _=qe.value.find(V=>V.id===E.value),m=(_==null?void 0:_.playerCount)||6;await dc(E.value,m),ue.value=!1,E.value=null}}function pc(){ue.value=!1,E.value=null}function mc(){return $.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[$.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function ls(_){if(tr.isPinCached(o.value)){const m=tr.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await Nd(o.value,m)){await br(_);return}else tr.clearSession()}$.value=_,D.value=!0}async function bl(_){const m=_.data.playerId;if(fo(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await br(_);return}xt.value=_,Dt.value=!0}async function gc(_){try{if(await Nd(o.value,_)){tr.saveSession(o.value,_),D.value=!1;const V=$.value;$.value=null,await br(V)}else R.value="Code PIN incorrect",setTimeout(()=>{R.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),R.value="Erreur lors de la vérification du code PIN"}}function zo(){D.value=!1,$.value=null,R.value=""}async function wl(_){if(_){Ue.value=!0,tt.value="";try{const m=xt.value.data.playerId,V=await fp(o.value);if(_===V){try{Si.saveSession(xt.value.data.playerId,_)}catch{}Dt.value=!1;const se=xt.value;xt.value=null,$e.value="",await br(se);return}if(await verifyPlayerPassword(m,_,o.value)){Dt.value=!1;const se=xt.value;xt.value=null,$e.value="",await br(se)}else tt.value="Mot de passe incorrect",setTimeout(()=>{tt.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),tt.value="Erreur lors de la vérification du mot de passe"}finally{Ue.value=!1}}}function vc(){Dt.value=!1,xt.value=null,tt.value="",$e.value="",Ue.value=!1}async function qr(_){if(_){Ne.value=!0,W.value="";try{const m=Ve.value.data.player,V=await fp(o.value);if(_===V){try{Si.saveSession(Ve.value.data.player.id,_)}catch{}te.value=!1;const se=Ve.value;Ve.value=null,Y.value="",await br(se);return}if(await verifyPlayerPassword(m.id,_,o.value)){te.value=!1;const se=Ve.value;Ve.value=null,Y.value="",await br(se)}else W.value="Mot de passe incorrect",setTimeout(()=>{W.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),W.value="Erreur lors de la vérification du mot de passe"}finally{Ne.value=!1}}}function yc(){te.value=!1,Ve.value=null,W.value="",Y.value="",Ne.value=!1}async function _c(){K.value=!0,be.value="",de.value="";try{const _=Ve.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);de.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),be.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{K.value=!1}}async function bc(){He.value=!0,lt.value="",T.value="";try{const _=xt.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);T.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),lt.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{He.value=!1}}function wc(){return tr.isPinCached(o.value)?{timeRemaining:tr.getTimeRemaining(),isExpiringSoon:tr.isExpiringSoon()}:null}async function br(_){var Q;if(!_)return;const{type:m,data:V}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=V.eventId,l.value=!0;break;case"addEvent":jr.value=!0;break;case"deletePlayer":as.value=V.playerId,Ki.value=!0;break;case"launchSelection":ct.value[V.eventId]&&ct.value[V.eventId].length>0?(E.value=V.eventId,ue.value=!0,C.value=!1):(await dc(V.eventId,V.count),C.value=!1);break;case"toggleAvailability":is(V.player,V.eventId);break;case"toggleArchive":await setEventArchived(V.eventId,V.archived,o.value);{const se=qe.value.findIndex(ge=>ge.id===V.eventId);se!==-1&&(qe.value[se]={...qe.value[se],archived:!!V.archived}),J.value=!!V.archived}break;case"updateSelection":{const{eventId:se,players:ge}=V;await u_(se,Array.isArray(ge)?ge:[],o.value),ct.value[se]=Array.isArray(ge)?ge:[];try{(Q=Me.value)==null||Q.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Oe.value=!0,ut.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Oe.value=!1},3e3)}}function Gn(){t.push("/")}aa(()=>{const _=Cn.value;_&&_.removeEventListener("scroll",zn),window.removeEventListener("resize",zn)});async function Il(_){O.value=_,Z.value=_.description||"",J.value=!!_.archived;try{const[m,V]=await Promise.all([Zo(Ye.value,qe.value,o.value),ea(o.value)]);Ht.value=m,ct.value=V}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}C.value=!0}function Go(){C.value=!1,O.value=null,Z.value="",ee.value=!1}function us(){Go(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function u(_,m){console.debug("handleAvailabilityToggle appelé");const V=Ye.value.find(ge=>ge.name===_);if(!V){console.error("Joueur non trouvé");return}const Q=qe.value.find(ge=>ge.id===m);if(Q!=null&&Q.archived){Oe.value=!0,ut.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Oe.value=!1},3e3);return}console.debug("Joueur trouvé");const se=$i(V.id);if(console.debug("Joueur protégé"),se){fo(V.id)?(console.debug("Session active, procéder au toggle"),await Br(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),ce.value={playerName:_,eventId:m},he.value=V,ye.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await Br(_,m)}function p(_,m){return(ct.value[m]||[]).includes(_)}async function v(_){if(console.debug("Mot de passe vérifié"),he.value&&(ie.value=he.value.id,console.debug("Joueur marqué comme récemment vérifié")),ce.value){const{playerName:m,eventId:V}=ce.value;console.debug("Exécution de l'action en attente"),await Br(m,V),ce.value=null}else console.debug("Aucune action en attente trouvée");ye.value=!1,he.value=null}function b(){d.value=O.value.id,f.value=O.value.title,g.value=O.value.date,Z.value=O.value.description||"",y.value=O.value.playerCount||6,C.value=!1}async function U(){if(O.value)try{const _=!O.value.archived,m={...O.value,archived:_};await c_(O.value.id,m,o.value),O.value.archived=_;const V=qe.value.findIndex(Q=>Q.id===O.value.id);V!==-1&&(qe.value[V].archived=_),Oe.value=!0,ut.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Oe.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function G(_){I.value=_,w.value=!0;try{typeof Ee<"u"&&Ee.value}catch{}}function me(){w.value=!1,I.value=null}async function yt({playerId:_,newName:m}){try{await NN(_,m,o.value),await Promise.all([If(o.value),Zo(Ye.value,qe.value,o.value),ea(o.value)]).then(([V,Q,se])=>{if(Ye.value=V,Ht.value=Q,ct.value=se,fl(),I.value&&I.value.id===_){const ge=V.find(fe=>fe.id===_);ge&&(I.value=ge)}}),Oe.value=!0,ut.value="Joueur mis à jour avec succès !",setTimeout(()=>{Oe.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function dn(){try{await Promise.all([If(o.value),Zo(Ye.value,qe.value,o.value),ea(o.value)]).then(([_,m,V])=>{if(Ye.value=_,Ht.value=m,ct.value=V,fl(),I.value){const Q=_.find(se=>se.id===I.value.id);Q&&(I.value=Q)}}),Oe.value=!0,ut.value="Données mises à jour !",setTimeout(()=>{Oe.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function ot(_){if(!_)return{availability:0,selection:0,ratio:0};const m=Hs(_.name),V=os(_.name),Q=m===0?0:Math.round(V/m*100);return{availability:m,selection:V,ratio:Q}}function sn(_){const m=ct.value[_]||[],V=qe.value.find(ge=>ge.id===_),Q=(V==null?void 0:V.playerCount)||6,se=qi(_);if(m.length>0){const ge=m.some(Le=>!_r(Le,_)),fe=se<Q;if(ge||fe)return{type:"incomplete",hasUnavailablePlayers:ge,hasInsufficientPlayers:fe,unavailablePlayers:m.filter(Le=>!_r(Le,_)),availableCount:se,requiredCount:Q}}return se<Q?{type:"insufficient",availableCount:se,requiredCount:Q}:m.length===0?{type:"ready",availableCount:se,requiredCount:Q}:{type:"complete",availableCount:se,requiredCount:Q}}function yn(_){const m=sn(_);return m.type==="incomplete"||m.type==="insufficient"}function cs(_){const m=sn(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function ar({eventId:_,eventData:m,reason:V}){if(!o.value)return;const Q={id:_,...m};if(Q.archived){console.debug("Événement archivé, aucune notification envoyée"),Oe.value=!0,ut.value="Aucune notification envoyée : événement archivé",setTimeout(()=>{Oe.value=!1},3e3);return}const se=[];for(const ge of Ye.value){if(!await mi(ge.id,o.value))continue;const Le=await IE(ge.id,o.value);if(Le)try{const We=await mp({seasonId:o.value,playerId:ge.id,eventId:Q.id,action:"yes"}),dt=await mp({seasonId:o.value,playerId:ge.id,eventId:Q.id,action:"no"}),At=`${We.url}&slug=${encodeURIComponent(s)}`,St=`${dt.url}&slug=${encodeURIComponent(s)}`;await FN({toEmail:Le,playerName:ge.name,eventTitle:Q.title,eventDate:Bo(Q.date),yesUrl:At,noUrl:St,reason:V})}catch{console.error("Email non envoyé pour un joueur"),se.push(ge.id)}}Oe.value=!0,ut.value=se.length>0?`Emails envoyés (avec ${se.length} échec(s))`:"Emails envoyés aux joueurs protégés.",setTimeout(()=>{Oe.value=!1},3e3)}function Ws(_){if(_!=null&&_.archived){Oe.value=!0,ut.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Oe.value=!1},3e3);return}cg(),Xe.value=_,Be.value=!0}function Ko(){Be.value=!1,Xe.value=null}function cg(){Kt.value=!1,$t.value=null}async function dg({eventId:_,eventData:m,reason:V,selectedPlayers:Q}){try{V==="selection"?(await jN({eventId:_,eventData:m,selectedPlayers:Q,seasonId:o.value,seasonSlug:s,players:cn.value}),Bh(),Oe.value=!0,ut.value="Notifications de sélection envoyées avec succès !",setTimeout(()=>{Oe.value=!1},3e3)):(await ar({eventId:_,eventData:m,reason:V}),Ko(),Oe.value=!0,ut.value="Notifications envoyées avec succès !",setTimeout(()=>{Oe.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Oe.value=!0,ut.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Oe.value=!1},3e3)}}function hg(_){if(!_)return{};const m={};return Ye.value.forEach(V=>{m[V.name]=_r(V.name,_)}),m}function Ic(_){if(_!=null&&_.archived){Oe.value=!0,ut.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Oe.value=!1},3e3);return}Re.value=_,Te.value=!0}function Bh(){Te.value=!1,Re.value=null}async function DE(){if(!Re.value)return;const _=Re.value.id,m=Re.value.playerCount||6;if(qi(_)===0){Oe.value=!0,ut.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Oe.value=!1},3e3);return}await ls({type:"launchSelection",data:{eventId:_,count:m}})}function VE(){Bh(),Oe.value=!0,ut.value="Sélection validée !",setTimeout(()=>{Oe.value=!1},3e3)}async function NE(_){if(!_||!_.eventId)return;const{eventId:m,players:V}=_;await ls({type:"updateSelection",data:{eventId:m,players:V}})}async function qh(_,m){if(!_||!m)return;pg(),Rr.value=_,Us.value=!0,await hn();const V=document.querySelector(`[data-event-id="${_}"]`);if(!V){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(fe=>{fe.classList.remove("focused-event-highlight")});const Q=document.querySelectorAll(`[data-event-id="${_}"]`);Q.forEach(fe=>{fe.classList.add("focused-event-highlight")});const se=Q[0],ge=Q[Q.length-1];se&&se.classList.add("focused-event-column-start"),ge&&ge.classList.add("focused-event-column-end"),await OE(V),Oe.value=!0,ut.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Oe.value=!1},4e3),Mi.value=setTimeout(()=>{pg()},8e3)}function fg(_){if(!_)return;const m=qe.value.find(V=>V.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const V=qe.value.find(Q=>Q.id===_);V?qh(_,V):console.error("Événement toujours introuvable après retry")},500);return}qh(_,m)}async function OE(_){if(!_)return;if(await new Promise(V=>setTimeout(V,100)),window.innerWidth<=768){const V=Cn.value;if(V){const Q=_.offsetLeft,se=_.offsetWidth,ge=V.clientWidth,fe=Q-ge/2+se/2,Le=V.scrollWidth-ge,We=Math.max(0,Math.min(fe,Le));V.scrollTo({left:We,behavior:"smooth"}),setTimeout(()=>{const dt=_.getBoundingClientRect();if(dt.left<0||dt.right>window.innerWidth){const At=Q-20;V.scrollTo({left:Math.max(0,At),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Cn.value;m&&setTimeout(()=>{const V=document.querySelector(`[data-event-id="${Rr.value}"]`);if(V&&V.closest("tbody")){const Q=V.offsetLeft,se=V.offsetWidth,ge=m.clientWidth,fe=Q-ge/2+se/2,Le=m.scrollWidth-ge,We=Math.max(0,Math.min(fe,Le));m.scrollTo({left:We,behavior:"smooth"})}},300)}function pg(){Mi.value&&(clearTimeout(Mi.value),Mi.value=null),Rr.value=null,Us.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var V,Q,se,ge,fe,Le,We,dt,At,St,Jt,Yt,ft,Dr,ds,Wi,Ho,mg,gg;return M(),L(_t,null,[h("div",hF,[h("div",fF,[h("button",{onClick:Gn,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour à l'accueil"},m[69]||(m[69]=[h("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),h("h1",pF,oe(i.value?i.value:"Chargement..."),1),h("div",mF,[h("div",gF,[h("button",{onClick:Ni,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},m[70]||(m[70]=[h("span",{class:"text-2xl"},"👤",-1)])),h("button",{onClick:m[0]||(m[0]=H=>vn.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},m[71]||(m[71]=[h("span",{class:"text-2xl"},"❓",-1)]))]),h("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:rs},[h("button",{onClick:m[1]||(m[1]=Nt(H=>{lc(),dl()},["stop"])),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[72]||(m[72]=[h("span",{class:"text-2xl"},"⋯",-1)]))],512),(M(),ld(PT,{to:"body"},[mr.value?(M(),L("div",{key:0,ref_key:"headerMenuDropdownRef",ref:$r,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:ms(Oo.value)},[h("button",{onClick:m[2]||(m[2]=H=>{Ni(),Mo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[73]||(m[73]=[h("span",null,"👤",-1),h("span",{class:"text-sm"},"Mon compte",-1)])),h("button",{onClick:m[3]||(m[3]=H=>{vn.value=!0,Mo()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[74]||(m[74]=[h("span",null,"❓",-1),h("span",{class:"text-sm"},"Kezako ?",-1)]))],4)):le("",!0)]))])],512),h("div",vF,[h("div",{ref_key:"headerBarRef",ref:Bs,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[h("div",yF,[qe.value.length===0&&Ye.value.length===0?le("",!0):(M(),L("div",_F,[h("div",{class:"flex items-center justify-center h-full gap-2"},[h("button",{onClick:Cr,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[75]||(m[75]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),h("span",{class:"sm:hidden"},"Événement",-1)]))])])),h("div",bF,[h("div",{ref_key:"headerEventsRef",ref:qn,class:"flex relative z-[60]",style:ms({transform:`translateX(-${ll.value}px)`})},[(M(!0),L(_t,null,ur(kn.value,H=>(M(),L("div",{key:"h-"+H.id,"data-event-id":H.id,class:fn(["col-event flex-shrink-0 p-3 text-center cursor-pointer",{"archived-header":H.archived}]),onClick:Dn=>Il(H)},[h("div",{class:"header-date text-[16px] md:text-base text-gray-300",title:Bo(H.date)},oe(hc(H.date)),9,IF),h("div",{class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2",title:H.title},oe(H.title||"Sans titre"),9,EF),H.archived?(M(),L("div",TF,"(Archivé)")):le("",!0),yn(H.id)?(M(),L("div",{key:1,class:"mt-1 w-4 h-4 bg-yellow-500 rounded-full mx-auto flex items-center justify-center hover:bg-yellow-400 transition-colors duration-200",title:cs(H.id)+" - Cliquez pour ouvrir la sélection",onClick:Nt(Dn=>Ic(H),["stop"])},m[76]||(m[76]=[h("span",{class:"text-xs text-white font-bold"},"⚠️",-1)]),8,xF)):sn(H.id).type==="ready"?(M(),L("div",{key:2,class:"mt-1 w-4 h-4 bg-green-500 rounded-full mx-auto flex items-center justify-center hover:bg-green-400 transition-colors duration-200",title:cs(H.id)+" - Cliquez pour ouvrir la sélection",onClick:Nt(Dn=>Ic(H),["stop"])},m[77]||(m[77]=[h("span",{class:"text-xs text-white font-bold"},"🎲",-1)]),8,AF)):le("",!0)],10,wF))),128))],4)]),m[80]||(m[80]=h("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),h("button",{onClick:cc,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:kr.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":kr.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(M(),L("svg",PF,[m[78]||(m[78]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[79]||(m[79]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),kr.value?le("",!0):(M(),L("path",RF))]))],8,SF),it(h("button",{onClick:m[4]||(m[4]=Nt(H=>Vo(-1,H),["prevent"])),onMousedown:m[5]||(m[5]=Nt(H=>qs(-1,H),["prevent"])),onMouseup:m[6]||(m[6]=H=>pr(H)),onMouseleave:m[7]||(m[7]=H=>pr(H)),onTouchstart:m[8]||(m[8]=Nt(H=>qs(-1,H),["prevent"])),onTouchend:m[9]||(m[9]=H=>pr(H)),onTouchcancel:m[10]||(m[10]=H=>pr(H)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Xh,js.value]]),it(h("button",{onClick:m[11]||(m[11]=Nt(H=>Vo(1,H),["prevent"])),onMousedown:m[12]||(m[12]=Nt(H=>qs(1,H),["prevent"])),onMouseup:m[13]||(m[13]=H=>pr(H)),onMouseleave:m[14]||(m[14]=H=>pr(H)),onTouchstart:m[15]||(m[15]=Nt(H=>qs(1,H),["prevent"])),onTouchend:m[16]||(m[16]=H=>pr(H)),onTouchcancel:m[17]||(m[17]=H=>pr(H)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Xh,oc.value]])])],512),it(h("div",{ref_key:"gridboardRef",ref:Cn,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Ee.value===1?(M(),L("div",CF,[P.value.position?(M(),L("div",{key:0,class:"fixed z-[400]",style:ms({left:P.value.position.x+"px",top:P.value.position.y+"px"})},[h("div",{id:"coachmark-add",class:fn(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":P.value.side==="right","coachmark-left":P.value.side==="left"}])},[m[82]||(m[82]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[83]||(m[83]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),h("div",kF,[m[81]||(m[81]=h("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),h("button",{onClick:m[18]||(m[18]=H=>vl(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):le("",!0)])):le("",!0),Ee.value===2&&j.value&&F.value?(M(),L("div",DF,[q.value.position?(M(),L("div",{key:0,class:"fixed z-[400]",style:ms({position:"absolute",left:q.value.position.x+"px",top:q.value.position.y+"px"})},[h("div",VF,[m[85]||(m[85]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[86]||(m[86]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),h("div",NF,[m[84]||(m[84]=h("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),h("button",{onClick:m[19]||(m[19]=H=>vl(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):le("",!0)])):le("",!0),Ee.value===3&&j.value?(M(),L("div",OF,[X.value.position?(M(),L("div",{key:0,class:"fixed z-[400]",style:ms({position:"absolute",left:X.value.position.x+"px",top:X.value.position.y+"px"})},[h("div",MF,[m[88]||(m[88]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[89]||(m[89]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),h("div",LF,[m[87]||(m[87]=h("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),h("button",{onClick:m[20]||(m[20]=H=>vl(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):le("",!0)])):le("",!0),h("table",FF,[h("colgroup",null,[m[90]||(m[90]=h("col",{class:"col-left"},null,-1)),(M(!0),L(_t,null,ur(kn.value,(H,Dn)=>(M(),L("col",{key:"c"+Dn,class:"col-event"}))),128)),m[91]||(m[91]=h("col",{class:"col-right"},null,-1))]),m[95]||(m[95]=h("thead",{class:"hidden"},null,-1)),h("tbody",null,[(M(!0),L(_t,null,ur(Xn.value,H=>{var Dn;return M(),L("tr",{key:H.id,class:fn(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":H.id===A.value,"preferred-player":H.id===ml.value}]),"data-player-id":H.id},[h("td",UF,[h("div",jF,[$i(H.id)?(M(),L("span",BF," 🔒 ")):le("",!0),h("span",{onClick:Zn=>G(H),class:fn(["player-name hover:border-b-2 hover:border-dashed hover:border-purple-400 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Ee.value===3&&H.id===(j.value||((Dn=Xn.value[0])==null?void 0:Dn.id))}]),title:"Cliquez pour voir les détails : "+H.name},oe(H.name),11,qF)])]),(M(!0),L(_t,null,ur(kn.value,Zn=>{var vg,yg,_g;return M(),L("td",{key:Zn.id,"data-event-id":Zn.id,class:fn(["p-0",Zn.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Ee.value===2&&H.id===(j.value||((vg=Xn.value[0])==null?void 0:vg.id))&&Zn.id===(F.value||((yg=kn.value[0])==null?void 0:yg.id))}])},[ht(h_,{"player-name":H.name,"event-id":Zn.id,"is-available":_r(H.name,Zn.id),"is-selected":gl(H.name,Zn.id),"chance-percent":((_g=pl.value[H.name])==null?void 0:_g[Zn.id])??null,"show-selected-chance":yl(Zn.id),disabled:Zn.archived===!0,onToggle:Br},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,zF)}),128)),m[92]||(m[92]=h("td",{class:"p-3 md:p-4"},null,-1))],10,$F)}),128)),h("tr",GF,[h("td",KF,[h("div",HF,[h("button",{onClick:m[21]||(m[21]=H=>x.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[93]||(m[93]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),h("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(M(!0),L(_t,null,ur(kn.value,H=>(M(),L("td",{key:"add-row-"+H.id,"data-event-id":H.id,class:fn(["p-3 md:p-5",H.archived?"archived-col":""])},null,10,WF))),128)),m[94]||(m[94]=h("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Xh,!Jn.value]])])]),Jn.value?(M(),L("div",QF,[h("div",JF,[m[96]||(m[96]=h("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("p",YF,oe(Pr.value)+"…",1),h("div",XF,[h("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:ms({width:Sr.value+"%"})},null,4)]),h("p",ZF,oe(Sr.value)+"%",1)])])):le("",!0),Jn.value?le("",!0):(M(),ld(PL,{key:1,"season-id":o.value,"season-slug":Is(s),"players-count":Ye.value.length,"events-count":qe.value.length,"onboarding-done":((V=a.value)==null?void 0:V.onboardingCreatorDone)===!0,onCreateEvent:Cr,onAddPlayer:m[22]||(m[22]=()=>{x.value=!0}),onCopyLink:ss,onDismissed:al},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),le("",!0),Oe.value?(M(),L("div",e4,[h("div",t4,[m[97]||(m[97]=h("span",{class:"text-xl"},"✨",-1)),h("span",null,oe(ut.value),1)])])):le("",!0),gr.value?(M(),L("div",n4,[h("div",r4,[m[98]||(m[98]=h("span",{class:"text-xl"},"⚠️",-1)),h("span",null,oe(Ui.value),1)])])):le("",!0),jr.value?(M(),L("div",s4,[h("div",i4,[m[104]||(m[104]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),h("div",o4,[m[99]||(m[99]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),it(h("input",{"onUpdate:modelValue":m[23]||(m[23]=H=>yr.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Rt,yr.value]])]),h("div",a4,[m[100]||(m[100]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),it(h("input",{"onUpdate:modelValue":m[24]||(m[24]=H=>Gs.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Rt,Gs.value]])]),h("div",l4,[m[101]||(m[101]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),it(h("textarea",{"onUpdate:modelValue":m[25]||(m[25]=H=>Ks.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Rt,Ks.value]])]),h("div",u4,[it(h("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[26]||(m[26]=H=>jo.value=H),class:"w-4 h-4"},null,512),[[wa,jo.value]]),m[102]||(m[102]=h("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),h("div",c4,[m[103]||(m[103]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),it(h("input",{"onUpdate:modelValue":m[27]||(m[27]=H=>ji.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Rt,ji.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Bi,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Mh,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):le("",!0),x.value?(M(),L("div",d4,[h("div",h4,[m[106]||(m[106]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),h("div",f4,[m[105]||(m[105]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),it(h("input",{"onUpdate:modelValue":m[28]||(m[28]=H=>S.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Rt,S.value]])]),h("div",p4,[h("button",{onClick:m[29]||(m[29]=H=>x.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:It,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):le("",!0),l.value?(M(),L("div",m4,[h("div",g4,[m[107]||(m[107]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),h("div",v4,[h("button",{onClick:$o,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:m[30]||(m[30]=()=>Fo()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):le("",!0),Ki.value?(M(),L("div",y4,[h("div",_4,[m[108]||(m[108]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),h("div",b4,[h("button",{onClick:jh,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:m[31]||(m[31]=()=>qo()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):le("",!0),ue.value?(M(),L("div",w4,[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},[m[109]||(m[109]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🎭</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.</p></div><p class="mb-6 text-sm text-yellow-400 bg-yellow-900/20 p-3 rounded-lg border border-yellow-500/20"> ⚠️ Pensez à prévenir les gens du changement ! </p>',2)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:pc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:Hi,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):le("",!0),C.value?(M(),L("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:Go},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[41]||(m[41]=Nt(()=>{},["stop"]))},[h("div",I4,[h("button",{onClick:Go,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),m[110]||(m[110]=h("div",{class:"w-16 h-16 md:w-20 md:h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"},[h("span",{class:"text-2xl md:text-3xl"},"🎭")],-1)),h("h2",E4,oe((Q=O.value)==null?void 0:Q.title),1),h("p",T4,oe(Bo((se=O.value)==null?void 0:se.date)),1)]),h("div",x4,[(ge=O.value)!=null&&ge.description?(M(),L("div",A4,[h("p",S4,oe(O.value.description),1)])):le("",!0),h("div",P4,[h("div",R4,[h("div",C4,oe(qi((fe=O.value)==null?void 0:fe.id)),1),m[111]||(m[111]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",k4,[h("div",D4,oe(or((Le=O.value)==null?void 0:Le.id)),1),m[112]||(m[112]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",V4,[h("div",N4,oe(((We=O.value)==null?void 0:We.playerCount)||6),1),m[113]||(m[113]=h("div",{class:"text-xs md:text-sm text-gray-300"},"À sélectionner",-1))])]),O.value?(M(),L("div",O4,[m[115]||(m[115]=h("h3",{class:"text-lg font-semibold text-white mb-3"},"Disponibilités des joueurs",-1)),h("div",M4,[m[114]||(m[114]=h("div",{class:"grid grid-cols-12 gap-0 bg-gray-700 border-b border-gray-600"},[h("div",{class:"col-span-4 p-3 font-medium text-gray-300"},"Joueur"),h("div",{class:"col-span-8 p-3 font-medium text-gray-300 text-center"},"Disponibilité")],-1)),(M(!0),L(_t,null,ur(Xn.value,H=>{var Dn,Zn;return M(),L("div",{key:H.id,class:"grid grid-cols-12 gap-0 border-b border-gray-600 last:border-b-0 hover:bg-gray-700/50 transition-colors"},[h("div",L4,[h("span",{class:"font-medium text-white block truncate max-w-full flex-1 min-w-0",title:H.name},oe(H.name),9,F4),$i(H.id)?(M(),L("span",$4,"🔒")):le("",!0)]),h("div",U4,[ht(h_,{"player-name":H.name,"event-id":O.value.id,"is-available":hg(O.value.id)[H.name],"is-selected":p(H.name,O.value.id),"chance-percent":((Dn=pl.value[H.name])==null?void 0:Dn[O.value.id])??null,"show-selected-chance":yl(O.value.id),disabled:((Zn=O.value)==null?void 0:Zn.archived)===!0,onToggle:u},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):le("",!0),h("div",j4,[h("button",{onClick:b,class:"px-5 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 flex items-center gap-2"},m[116]||(m[116]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[32]||(m[32]=H=>Ws(O.value)),disabled:(dt=O.value)==null?void 0:dt.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(At=O.value)!=null&&At.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[117]||(m[117]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,B4),h("button",{onClick:U,class:"px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-600 text-white rounded-lg hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 flex items-center gap-2",title:(St=O.value)!=null&&St.archived?"Désarchiver cet événement":"Archiver cet événement"},[h("span",null,oe((Jt=O.value)!=null&&Jt.archived?"📂":"📁"),1),h("span",null,oe((Yt=O.value)!=null&&Yt.archived?"Désarchiver":"Archiver"),1)],8,q4),h("button",{onClick:m[33]||(m[33]=H=>Ic(O.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[118]||(m[118]=[h("span",null,"🎭",-1),h("span",null,"Sélectionner",-1)])),h("button",{onClick:m[34]||(m[34]=H=>{var Dn;return vr((Dn=O.value)==null?void 0:Dn.id)}),class:"px-5 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 flex items-center gap-2"},m[119]||(m[119]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)])),h("button",{onClick:us,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),ee.value?(M(),L("div",z4,[h("button",{onClick:m[35]||(m[35]=H=>{b(),ee.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-gray-800 text-white border border-white/10"},"✏️ Modifier"),h("button",{onClick:m[36]||(m[36]=H=>{Ws(O.value),ee.value=!1}),disabled:(ft=O.value)==null?void 0:ft.archived,class:"w-full px-4 py-3 rounded-lg bg-amber-600/20 text-amber-200 border border-amber-500/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(Dr=O.value)!=null&&Dr.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[120]||(m[120]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,G4),h("button",{onClick:m[37]||(m[37]=H=>{U(),ee.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-indigo-600/20 text-indigo-200 border border-indigo-500/30"},oe((ds=O.value)!=null&&ds.archived?"📂 Désarchiver":"📁 Archiver"),1),h("button",{onClick:m[38]||(m[38]=H=>{var Dn;vr((Dn=O.value)==null?void 0:Dn.id),ee.value=!1}),class:"w-full px-4 py-3 rounded-lg bg-red-600/20 text-red-200 border border-red-500/30"},"🗑️ Supprimer")])):le("",!0)]),h("div",K4,[h("button",{onClick:m[39]||(m[39]=H=>Ic(O.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),h("button",{onClick:us,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),h("button",{onClick:m[40]||(m[40]=H=>ee.value=!ee.value),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):le("",!0),ht(ug,{show:ye.value,player:he.value,seasonId:o.value,onClose:m[42]||(m[42]=H=>ye.value=!1),onVerified:v},null,8,["show","player","seasonId"]),d.value?(M(),L("div",H4,[h("div",W4,[m[126]||(m[126]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),h("div",Q4,[m[121]||(m[121]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),it(h("input",{"onUpdate:modelValue":m[43]||(m[43]=H=>f.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Nn(Ur,["esc"]),Nn(Uo,["enter"])],ref:"editTitleInput"},null,544),[[Rt,f.value]])]),h("div",J4,[m[122]||(m[122]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),it(h("input",{"onUpdate:modelValue":m[44]||(m[44]=H=>g.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Nn(Ur,["esc"]),Nn(Uo,["enter"])]},null,544),[[Rt,g.value]])]),h("div",Y4,[m[123]||(m[123]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),it(h("textarea",{"onUpdate:modelValue":m[45]||(m[45]=H=>Z.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Nn(Ur,["esc"])},null,544),[[Rt,Z.value]])]),h("div",X4,[it(h("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[46]||(m[46]=H=>J.value=H),class:"w-4 h-4"},null,512),[[wa,J.value]]),m[124]||(m[124]=h("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),h("div",Z4,[m[125]||(m[125]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),it(h("input",{"onUpdate:modelValue":m[47]||(m[47]=H=>y.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Nn(Ur,["esc"])},null,544),[[Rt,y.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Ur,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Uo,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):le("",!0),ht(lE,{show:D.value,message:mc(),error:R.value,"session-info":wc(),onSubmit:gc,onCancel:zo},null,8,["show","message","error","session-info"]),Dt.value?(M(),L("div",e3,[h("div",t3,[m[128]||(m[128]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",n3,[h("div",r3,[h("div",null,[m[127]||(m[127]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),it(h("input",{"onUpdate:modelValue":m[48]||(m[48]=H=>$e.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[49]||(m[49]=Nn(H=>wl($e.value),["enter"])),ref_key:"playerPasswordInputRef",ref:De},null,544),[[Rt,$e.value]])])]),h("button",{onClick:m[50]||(m[50]=H=>wl($e.value)),disabled:!$e.value||Ue.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ue.value?(M(),L("span",i3,"⏳")):(M(),L("span",o3,"🔓")),h("span",null,oe(Ue.value?"Vérification...":"Vérifier et supprimer"),1)],8,s3)]),h("div",a3,[h("button",{onClick:m[51]||(m[51]=H=>Ae.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),tt.value?(M(),L("div",l3,[h("div",u3,oe(tt.value),1)])):le("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:vc,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):le("",!0),te.value?(M(),L("div",c3,[h("div",d3,[m[131]||(m[131]=lr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",h3,[h("div",f3,[h("div",null,[m[129]||(m[129]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),it(h("input",{"onUpdate:modelValue":m[52]||(m[52]=H=>Y.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[53]||(m[53]=Nn(H=>qr(Y.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Je},null,544),[[Rt,Y.value]])])]),h("div",p3,[h("button",{onClick:m[54]||(m[54]=H=>Ze.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),W.value?(M(),L("div",m3,[h("div",g3,oe(W.value),1)])):le("",!0)]),h("div",v3,[h("button",{onClick:yc,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),h("button",{onClick:m[55]||(m[55]=H=>qr(Y.value)),disabled:!Y.value||Ne.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[Ne.value?(M(),L("span",_3,"⏳")):(M(),L("span",b3,"🔓")),h("span",null,[Ln(oe(Ne.value?"Vérification...":"Vérifier"),1),m[130]||(m[130]=h("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,y3)])])])):le("",!0),Ze.value?(M(),L("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[58]||(m[58]=H=>Ze.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[57]||(m[57]=Nt(()=>{},["stop"]))},[m[133]||(m[133]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),h("div",w3,[m[132]||(m[132]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:_c,disabled:K.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[K.value?(M(),L("span",E3,"⏳")):(M(),L("span",T3,"📧")),h("span",null,oe(K.value?"Envoi...":"Envoyer l'email"),1)],8,I3)]),be.value?(M(),L("div",x3,[h("div",A3,oe(be.value),1)])):le("",!0),de.value?(M(),L("div",S3,[h("div",P3,oe(de.value),1)])):le("",!0),h("div",R3,[h("button",{onClick:m[56]||(m[56]=H=>Ze.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):le("",!0),Ae.value?(M(),L("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[61]||(m[61]=H=>Ae.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[60]||(m[60]=Nt(()=>{},["stop"]))},[m[135]||(m[135]=lr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),h("div",C3,[m[134]||(m[134]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:bc,disabled:He.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[He.value?(M(),L("span",D3,"⏳")):(M(),L("span",V3,"📧")),h("span",null,oe(He.value?"Envoi...":"Envoyer l'email"),1)],8,k3)]),lt.value?(M(),L("div",N3,[h("div",O3,oe(lt.value),1)])):le("",!0),T.value?(M(),L("div",M3,[h("div",L3,oe(T.value),1)])):le("",!0),h("div",F3,[h("button",{onClick:m[59]||(m[59]=H=>Ae.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):le("",!0),ht(DM,{ref_key:"playerModalRef",ref:k,show:w.value,player:I.value,stats:ot(I.value),seasonId:o.value,"onboarding-step":Ee.value,"onboarding-player-id":j.value,onClose:me,onUpdate:yt,onDelete:fc,onRefresh:dn,onAdvanceOnboarding:m[62]||(m[62]=H=>{try{typeof Ee.value<"u"&&(Ee.value.value=H)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id"]),ht(mL,{ref_key:"selectionModalRef",ref:Me,show:Te.value,event:Re.value,"current-selection":ct.value[(Wi=Re.value)==null?void 0:Wi.id]||[],"available-count":qi((Ho=Re.value)==null?void 0:Ho.id),"selected-count":or((mg=Re.value)==null?void 0:mg.id),"player-availability":hg((gg=Re.value)==null?void 0:gg.id),"season-id":o.value,"season-slug":Is(s),players:cn.value,onClose:Bh,onSelection:DE,onPerfect:VE,onSendEmailNotifications:dg,onUpdateSelection:NE},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),ht(CE,{show:Be.value,event:Xe.value,"season-id":o.value,"season-slug":Is(s),players:cn.value,onClose:Ko,onSendEmailNotifications:dg},null,8,["show","event","season-id","season-slug","players"]),ht(uE,{show:vn.value,onClose:m[63]||(m[63]=H=>vn.value=!1)},null,8,["show"]),ht(tF,{show:Vt.value,"season-id":o.value,onClose:Rn,onManagePlayer:Oi,onChangePassword:ol,onLogoutDevice:rc,onDeleteAccount:sc},null,8,["show","season-id"]),ht(kE,{show:fr.value,player:rn.value,"season-id":o.value,onClose:m[64]||(m[64]=H=>fr.value=!1),onSuccess:m[65]||(m[65]=()=>{fr.value=!1,Vt.value=!0})},null,8,["show","player","season-id"]),ht(dF,{show:Lr.value,onClose:m[66]||(m[66]=H=>Lr.value=!1),onSuccess:m[67]||(m[67]=()=>{Lr.value=!1,Vt.value=!0})},null,8,["show"]),Kt.value?(M(),L("div",$3,[h("div",U3,[m[136]||(m[136]=h("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[137]||(m[137]=h("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),h("div",j3,[h("button",{onClick:m[68]||(m[68]=H=>Ws($t.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),h("button",{onClick:cg,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):le("",!0)],64)}}},B3={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},q3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},z3={key:0,class:"text-center py-8"},G3={key:1,class:"text-center py-8"},K3={class:"text-gray-300 mb-6"},H3={key:2,class:"space-y-6"},W3={class:"text-center"},Q3={class:"text-gray-300"},J3={class:"font-semibold text-white"},Y3={class:"space-y-4"},X3=["disabled"],Z3={key:0,class:"animate-spin"},e6={key:1},t6={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},n6={class:"text-red-300 text-sm"},r6={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},s6={class:"text-green-300 text-sm"},i6={__name:"PasswordReset",setup(n){const e=Ba(),t=Vu(),r=N(!0),s=N(""),i=N(""),o=N(""),a=N(""),l=N(""),c=N(!1),d=N(""),f=N(""),g=ze(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);wr(async()=>{try{const{oobCode:S}=e.query;if(ve.debug("Token reçu (masqué)"),!S){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=S,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(S){ve.error("Erreur lors de la vérification du lien",S),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,d.value="",f.value="";try{ve.debug("Début réinitialisation avec token (masqué)"),await DD(ln,o.value,a.value),ve.info("Mot de passe Firebase Auth mis à jour"),ve.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{x()},3e3)}catch(S){ve.error("Erreur lors de la réinitialisation",S),S.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":S.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function x(){t.push("/")}return(S,A)=>(M(),L("div",B3,[h("div",q3,[A[8]||(A[8]=lr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(M(),L("div",z3,A[2]||(A[2]=[h("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),h("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(M(),L("div",G3,[A[3]||(A[3]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"❌")],-1)),A[4]||(A[4]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),h("p",K3,oe(s.value),1),h("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(M(),L("div",H3,[h("div",W3,[h("p",Q3,[A[5]||(A[5]=Ln("Email : ")),h("span",J3,oe(i.value),1)])]),h("div",Y3,[h("div",null,[A[6]||(A[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),it(h("input",{"onUpdate:modelValue":A[0]||(A[0]=j=>a.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Nn(y,["enter"])},null,544),[[Rt,a.value]])]),h("div",null,[A[7]||(A[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),it(h("input",{"onUpdate:modelValue":A[1]||(A[1]=j=>l.value=j),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Nn(y,["enter"])},null,544),[[Rt,l.value]])])]),h("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(M(),L("span",Z3,"⏳")):(M(),L("span",e6,"🔑")),h("span",null,oe(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,X3),d.value?(M(),L("div",t6,[h("div",n6,oe(d.value),1)])):le("",!0),f.value?(M(),L("div",r6,[h("div",s6,oe(f.value),1)])):le("",!0)])):le("",!0)])]))}},o6={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},a6={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},l6={class:"text-3xl"},u6={class:"text-2xl font-bold text-white mb-2"},c6={class:"text-gray-300 mb-6"},d6={__name:"MagicLink",setup(n){const e=Ba(),t=Vu(),r=N("loading"),s=N("Traitement en cours..."),i=N("Merci de patienter pendant la validation du lien."),o=ze(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/")}return wr(async()=>{try{SE("firebase");const l=String(e.query.sid||""),c=String(e.query.pid||"");let d=String(e.query.eid||"");const f=String(e.query.t||""),g=String(e.query.a||""),y=String(e.query.slug||"");if(!f||!g){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(g==="account_email_update"){const P=await mE({token:f});if(!P.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await FD(ln.currentUser,P.data.newEmail),await gE({token:f}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(g==="verify_email"&&(d="protection"),!(await fE({seasonId:l,playerId:c,eventId:d,token:f,action:g})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(g==="verify_email"){await _E({playerId:c,seasonId:l});try{await xE({playerId:c,seasonId:l})}catch{}await gp({seasonId:l,playerId:c,eventId:"protection",action:g}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(y?()=>t.push(`/season/${y}?player=${encodeURIComponent(c)}&open=protection&verified=1`):()=>t.push("/"),800);return}const S=Se(ae,"seasons",l,"players",c),A=await Pn(S),j=A.exists()&&A.data().name||"";if(!j){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}await ON({seasonId:l,playerName:j,eventId:d,value:g==="yes"}),await gp({seasonId:l,playerId:c,eventId:d,action:g}),r.value="ok",s.value="Merci !",i.value=g==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible.",setTimeout(y?()=>t.push(`/season/${y}/event/${d}`):()=>t.push("/"),1200)}catch(l){ve.error("Magic link error",l),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(M(),L("div",o6,[h("div",a6,[h("div",{class:fn(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[h("span",l6,oe(o.value),1)],2),h("h1",u6,oe(s.value),1),h("p",c6,oe(i.value),1),h("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},h6={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},f6={class:"text-center py-12 px-4"},p6={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},m6={class:"container mx-auto px-4 pb-16"},g6={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},v6={class:"space-y-5"},y6=["onKeydown"],_6={class:"flex items-center justify-end gap-3 pt-2"},b6=["disabled"],w6={key:0,class:"mt-6 text-sm text-gray-200"},I6={__name:"JoinSeason",setup(n){const e=Ba(),t=Vu(),r=e.params.slug,s=N(""),i=N(""),o=N(""),a=N(!1),l=N("");wr(async()=>{const f=Eu(Qe(ae,"seasons"),Rd("slug","==",r)),g=await vt(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await PE(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){ve.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(M(),L("div",h6,[h("div",f6,[h("h1",p6,oe(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=h("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),h("div",m6,[h("div",g6,[g[3]||(g[3]=h("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),h("div",v6,[h("div",null,[g[2]||(g[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),it(h("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Nn(Nt(d,["prevent"]),["enter"])},null,40,y6),[[Rt,o.value]])]),h("div",_6,[h("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,b6)])]),l.value?(M(),L("div",w6,oe(l.value),1)):le("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const E6=[{path:"/",component:EN},{path:"/season/:slug",component:f_,props:!0},{path:"/season/:slug/event/:eventId",component:f_,props:!0},{path:"/season/:slug/join",component:I6,props:!0},{path:"/reset-password",component:i6},{path:"/magic",component:d6}],T6=aS({history:MA("/"),routes:E6});nA(iA).use(T6).mount("#app");export{Qe as $,dI as A,Eo as B,Xr as C,tn as D,R$ as E,xo as F,Sm as G,P$ as H,R6 as I,Tr as J,JC as K,XC as L,Ih as M,t$ as N,n$ as O,Ik as P,Sn as Q,K6 as R,N6 as S,zt as T,b$ as U,fh as V,bk as W,_$ as X,e$ as Y,L6 as Z,tb as _,bu as a,ec as a$,D6 as a0,YC as a1,uk as a2,S$ as a3,ja as a4,y$ as a5,U6 as a6,A$ as a7,Se as a8,z6 as a9,q6 as aA,l$ as aB,u$ as aC,G6 as aD,ak as aE,p$ as aF,m$ as aG,yk as aH,Eu as aI,Yw as aJ,V6 as aK,v$ as aL,Ju as aM,pn as aN,E$ as aO,x6 as aP,r$ as aQ,J6 as aR,Q6 as aS,Z6 as aT,j6 as aU,tl as aV,I$ as aW,F6 as aX,Rd as aY,Fm as aZ,O$ as a_,ek as aa,M6 as ab,$6 as ac,x$ as ad,X6 as ae,Y6 as af,Gt as ag,Qu as ah,dk as ai,c$ as aj,Pn as ak,s$ as al,i$ as am,vt as an,o$ as ao,a$ as ap,ZC as aq,T$ as ar,w$ as as,O6 as at,H6 as au,W6 as av,B6 as aw,d$ as ax,f$ as ay,h$ as az,tk as b,SD as b$,Zu as b0,L$ as b1,Su as b2,Ro as b3,ii as b4,k$ as b5,ai as b6,oi as b7,ks as b8,ed as b9,Ok as bA,sU as bB,vU as bC,qy as bD,p2 as bE,nD as bF,X$ as bG,G$ as bH,PD as bI,lU as bJ,fU as bK,gU as bL,iU as bM,WD as bN,KD as bO,$$ as bP,Tk as bQ,RD as bR,uU as bS,hU as bT,mU as bU,Fk as bV,nU as bW,W$ as bX,kD as bY,z$ as bZ,GD as b_,N$ as ba,ho as bb,_a as bc,vV as bd,D$ as be,oU as bf,dp as bg,V$ as bh,yV as bi,ig as bj,li as bk,B$ as bl,HD as bm,GI as bn,gV as bo,HI as bp,VD as bq,DD as br,sD as bs,ND as bt,M$ as bu,rU as bv,H$ as bw,Y$ as bx,xV as by,F$ as bz,$a as c,Wm as c0,j$ as c1,OD as c2,K$ as c3,aU as c4,dU as c5,pU as c6,QD as c7,U$ as c8,tU as c9,FD as ca,$D as cb,cU as cc,J$ as cd,eU as ce,Z$ as cf,Q$ as cg,q$ as ch,Ao as d,Tt as e,re as f,el as g,Hu as h,Yc as i,bh as j,Wu as k,yh as l,Mm as m,Ua as n,_h as o,oo as p,wk as q,Wt as r,mo as s,Ie as t,S6 as u,qP as v,Bt as w,C$ as x,et as y,A6 as z};
