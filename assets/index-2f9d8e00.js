(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function vv(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Gt={},ql=[],ws=()=>{},GC=()=>!1,Xf=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),yv=n=>n.startsWith("onUpdate:"),Fn=Object.assign,bv=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},QC=Object.prototype.hasOwnProperty,Lt=(n,e)=>QC.call(n,e),Ye=Array.isArray,Bl=n=>Nd(n)==="[object Map]",Ic=n=>Nd(n)==="[object Set]",bb=n=>Nd(n)==="[object Date]",ht=n=>typeof n=="function",Tn=n=>typeof n=="string",Ts=n=>typeof n=="symbol",Qt=n=>n!==null&&typeof n=="object",Xx=n=>(Qt(n)||ht(n))&&ht(n.then)&&ht(n.catch),Zx=Object.prototype.toString,Nd=n=>Zx.call(n),JC=n=>Nd(n).slice(8,-1),eE=n=>Nd(n)==="[object Object]",_v=n=>Tn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Pu=vv(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Zf=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},YC=/-(\w)/g,is=Zf(n=>n.replace(YC,(e,t)=>t?t.toUpperCase():"")),XC=/\B([A-Z])/g,Fo=Zf(n=>n.replace(XC,"-$1").toLowerCase()),ep=Zf(n=>n.charAt(0).toUpperCase()+n.slice(1)),pm=Zf(n=>n?`on${ep(n)}`:""),Eo=(n,e)=>!Object.is(n,e),Bh=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},lg=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},ff=n=>{const e=parseFloat(n);return isNaN(e)?n:e},ZC=n=>{const e=Tn(n)?Number(n):NaN;return isNaN(e)?n:e};let _b;const tp=()=>_b||(_b=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ur(n){if(Ye(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Tn(r)?rR(r):Ur(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Tn(n)||Qt(n))return n}const eR=/;(?![^(]*\))/g,tR=/:([^]+)/,nR=/\/\*[^]*?\*\//g;function rR(n){const e={};return n.replace(nR,"").split(eR).forEach(t=>{if(t){const r=t.split(tR);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function $t(n){let e="";if(Tn(n))e=n;else if(Ye(n))for(let t=0;t<n.length;t++){const r=$t(n[t]);r&&(e+=r+" ")}else if(Qt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const sR="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",iR=vv(sR);function tE(n){return!!n||n===""}function oR(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Od(n[r],e[r]);return t}function Od(n,e){if(n===e)return!0;let t=bb(n),r=bb(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Ts(n),r=Ts(e),t||r)return n===e;if(t=Ye(n),r=Ye(e),t||r)return t&&r?oR(n,e):!1;if(t=Qt(n),r=Qt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Od(n[o],e[o]))return!1}}return String(n)===String(e)}function wv(n,e){return n.findIndex(t=>Od(t,e))}const nE=n=>!!(n&&n.__v_isRef===!0),ie=n=>Tn(n)?n:n==null?"":Ye(n)||Qt(n)&&(n.toString===Zx||!ht(n.toString))?nE(n)?ie(n.value):JSON.stringify(n,rE,2):String(n),rE=(n,e)=>nE(e)?rE(n,e.value):Bl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[mm(r,i)+" =>"]=s,t),{})}:Ic(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>mm(t))}:Ts(e)?mm(e):Qt(e)&&!Ye(e)&&!eE(e)?String(e):e,mm=(n,e="")=>{var t;return Ts(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let kr;class aR{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=kr,!e&&kr&&(this.index=(kr.scopes||(kr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=kr;try{return kr=this,e()}finally{kr=t}}}on(){++this._on===1&&(this.prevScope=kr,kr=this)}off(){this._on>0&&--this._on===0&&(kr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function lR(){return kr}let Zt;const gm=new WeakSet;class sE{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,kr&&kr.active&&kr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,gm.has(this)&&(gm.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||oE(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,wb(this),aE(this);const e=Zt,t=xs;Zt=this,xs=!0;try{return this.fn()}finally{lE(this),Zt=e,xs=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Iv(e);this.deps=this.depsTail=void 0,wb(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?gm.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){cg(this)&&this.run()}get dirty(){return cg(this)}}let iE=0,Cu,Ru;function oE(n,e=!1){if(n.flags|=8,e){n.next=Ru,Ru=n;return}n.next=Cu,Cu=n}function xv(){iE++}function Ev(){if(--iE>0)return;if(Ru){let e=Ru;for(Ru=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Cu;){let e=Cu;for(Cu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function aE(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function lE(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),Iv(r),cR(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function cg(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(cE(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function cE(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Yu)||(n.globalVersion=Yu,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!cg(n))))return;n.flags|=2;const e=n.dep,t=Zt,r=xs;Zt=n,xs=!0;try{aE(n);const s=n.fn(n._value);(e.version===0||Eo(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Zt=t,xs=r,lE(n),n.flags&=-3}}function Iv(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)Iv(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function cR(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let xs=!0;const uE=[];function Pi(){uE.push(xs),xs=!1}function Ci(){const n=uE.pop();xs=n===void 0?!0:n}function wb(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Zt;Zt=void 0;try{e()}finally{Zt=t}}}let Yu=0;class uR{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Tv{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Zt||!xs||Zt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Zt)t=this.activeLink=new uR(Zt,this),Zt.deps?(t.prevDep=Zt.depsTail,Zt.depsTail.nextDep=t,Zt.depsTail=t):Zt.deps=Zt.depsTail=t,dE(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Zt.depsTail,t.nextDep=void 0,Zt.depsTail.nextDep=t,Zt.depsTail=t,Zt.deps===t&&(Zt.deps=r)}return t}trigger(e){this.version++,Yu++,this.notify(e)}notify(e){xv();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{Ev()}}}function dE(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)dE(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const ug=new WeakMap,ka=Symbol(""),dg=Symbol(""),Xu=Symbol("");function dr(n,e,t){if(xs&&Zt){let r=ug.get(n);r||ug.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new Tv),s.map=r,s.key=t),s.track()}}function bi(n,e,t,r,s,i){const o=ug.get(n);if(!o){Yu++;return}const a=l=>{l&&l.trigger()};if(xv(),e==="clear")o.forEach(a);else{const l=Ye(n),c=l&&_v(t);if(l&&t==="length"){const f=Number(r);o.forEach((h,p)=>{(p==="length"||p===Xu||!Ts(p)&&p>=f)&&a(h)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Xu)),e){case"add":l?c&&a(o.get("length")):(a(o.get(ka)),Bl(n)&&a(o.get(dg)));break;case"delete":l||(a(o.get(ka)),Bl(n)&&a(o.get(dg)));break;case"set":Bl(n)&&a(o.get(ka));break}}Ev()}function Sl(n){const e=Nt(n);return e===n?e:(dr(e,"iterate",Xu),rs(n)?e:e.map(sr))}function np(n){return dr(n=Nt(n),"iterate",Xu),n}const dR={__proto__:null,[Symbol.iterator](){return vm(this,Symbol.iterator,sr)},concat(...n){return Sl(this).concat(...n.map(e=>Ye(e)?Sl(e):e))},entries(){return vm(this,"entries",n=>(n[1]=sr(n[1]),n))},every(n,e){return pi(this,"every",n,e,void 0,arguments)},filter(n,e){return pi(this,"filter",n,e,t=>t.map(sr),arguments)},find(n,e){return pi(this,"find",n,e,sr,arguments)},findIndex(n,e){return pi(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return pi(this,"findLast",n,e,sr,arguments)},findLastIndex(n,e){return pi(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return pi(this,"forEach",n,e,void 0,arguments)},includes(...n){return ym(this,"includes",n)},indexOf(...n){return ym(this,"indexOf",n)},join(n){return Sl(this).join(n)},lastIndexOf(...n){return ym(this,"lastIndexOf",n)},map(n,e){return pi(this,"map",n,e,void 0,arguments)},pop(){return au(this,"pop")},push(...n){return au(this,"push",n)},reduce(n,...e){return xb(this,"reduce",n,e)},reduceRight(n,...e){return xb(this,"reduceRight",n,e)},shift(){return au(this,"shift")},some(n,e){return pi(this,"some",n,e,void 0,arguments)},splice(...n){return au(this,"splice",n)},toReversed(){return Sl(this).toReversed()},toSorted(n){return Sl(this).toSorted(n)},toSpliced(...n){return Sl(this).toSpliced(...n)},unshift(...n){return au(this,"unshift",n)},values(){return vm(this,"values",sr)}};function vm(n,e,t){const r=np(n),s=r[e]();return r!==n&&!rs(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const hR=Array.prototype;function pi(n,e,t,r,s,i){const o=np(n),a=o!==n&&!rs(n),l=o[e];if(l!==hR[e]){const h=l.apply(n,i);return a?sr(h):h}let c=t;o!==n&&(a?c=function(h,p){return t.call(this,sr(h),p,n)}:t.length>2&&(c=function(h,p){return t.call(this,h,p,n)}));const f=l.call(o,c,r);return a&&s?s(f):f}function xb(n,e,t,r){const s=np(n);let i=t;return s!==n&&(rs(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,sr(a),l,n)}),s[e](i,...r)}function ym(n,e,t){const r=Nt(n);dr(r,"iterate",Xu);const s=r[e](...t);return(s===-1||s===!1)&&Pv(t[0])?(t[0]=Nt(t[0]),r[e](...t)):s}function au(n,e,t=[]){Pi(),xv();const r=Nt(n)[e].apply(n,t);return Ev(),Ci(),r}const fR=vv("__proto__,__v_isRef,__isVue"),hE=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Ts));function pR(n){Ts(n)||(n=String(n));const e=Nt(this);return dr(e,"has",n),e.hasOwnProperty(n)}class fE{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?IR:vE:i?gE:mE).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=Ye(e);if(!s){let l;if(o&&(l=dR[t]))return l;if(t==="hasOwnProperty")return pR}const a=Reflect.get(e,t,fr(e)?e:r);return(Ts(t)?hE.has(t):fR(t))||(s||dr(e,"get",t),i)?a:fr(a)?o&&_v(t)?a:a.value:Qt(a)?s?bE(a):rp(a):a}}class pE extends fE{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Po(i);if(!rs(r)&&!Po(r)&&(i=Nt(i),r=Nt(r)),!Ye(e)&&fr(i)&&!fr(r))return l?!1:(i.value=r,!0)}const o=Ye(e)&&_v(t)?Number(t)<e.length:Lt(e,t),a=Reflect.set(e,t,r,fr(e)?e:s);return e===Nt(s)&&(o?Eo(r,i)&&bi(e,"set",t,r):bi(e,"add",t,r)),a}deleteProperty(e,t){const r=Lt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&bi(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Ts(t)||!hE.has(t))&&dr(e,"has",t),r}ownKeys(e){return dr(e,"iterate",Ye(e)?"length":ka),Reflect.ownKeys(e)}}class mR extends fE{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const gR=new pE,vR=new mR,yR=new pE(!0);const hg=n=>n,Eh=n=>Reflect.getPrototypeOf(n);function bR(n,e,t){return function(...r){const s=this.__v_raw,i=Nt(s),o=Bl(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),f=t?hg:e?pf:sr;return!e&&dr(i,"iterate",l?dg:ka),{next(){const{value:h,done:p}=c.next();return p?{value:h,done:p}:{value:a?[f(h[0]),f(h[1])]:f(h),done:p}},[Symbol.iterator](){return this}}}}function Ih(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function _R(n,e){const t={get(s){const i=this.__v_raw,o=Nt(i),a=Nt(s);n||(Eo(s,a)&&dr(o,"get",s),dr(o,"get",a));const{has:l}=Eh(o),c=e?hg:n?pf:sr;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&dr(Nt(s),"iterate",ka),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=Nt(i),a=Nt(s);return n||(Eo(s,a)&&dr(o,"has",s),dr(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=Nt(a),c=e?hg:n?pf:sr;return!n&&dr(l,"iterate",ka),a.forEach((f,h)=>s.call(i,c(f),c(h),o))}};return Fn(t,n?{add:Ih("add"),set:Ih("set"),delete:Ih("delete"),clear:Ih("clear")}:{add(s){!e&&!rs(s)&&!Po(s)&&(s=Nt(s));const i=Nt(this);return Eh(i).has.call(i,s)||(i.add(s),bi(i,"add",s,s)),this},set(s,i){!e&&!rs(i)&&!Po(i)&&(i=Nt(i));const o=Nt(this),{has:a,get:l}=Eh(o);let c=a.call(o,s);c||(s=Nt(s),c=a.call(o,s));const f=l.call(o,s);return o.set(s,i),c?Eo(i,f)&&bi(o,"set",s,i):bi(o,"add",s,i),this},delete(s){const i=Nt(this),{has:o,get:a}=Eh(i);let l=o.call(i,s);l||(s=Nt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&bi(i,"delete",s,void 0),c},clear(){const s=Nt(this),i=s.size!==0,o=s.clear();return i&&bi(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=bR(s,n,e)}),t}function Sv(n,e){const t=_R(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(Lt(t,s)&&s in r?t:r,s,i)}const wR={get:Sv(!1,!1)},xR={get:Sv(!1,!0)},ER={get:Sv(!0,!1)};const mE=new WeakMap,gE=new WeakMap,vE=new WeakMap,IR=new WeakMap;function TR(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function SR(n){return n.__v_skip||!Object.isExtensible(n)?0:TR(JC(n))}function rp(n){return Po(n)?n:Av(n,!1,gR,wR,mE)}function yE(n){return Av(n,!1,yR,xR,gE)}function bE(n){return Av(n,!0,vR,ER,vE)}function Av(n,e,t,r,s){if(!Qt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=SR(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function zl(n){return Po(n)?zl(n.__v_raw):!!(n&&n.__v_isReactive)}function Po(n){return!!(n&&n.__v_isReadonly)}function rs(n){return!!(n&&n.__v_isShallow)}function Pv(n){return n?!!n.__v_raw:!1}function Nt(n){const e=n&&n.__v_raw;return e?Nt(e):n}function AR(n){return!Lt(n,"__v_skip")&&Object.isExtensible(n)&&lg(n,"__v_skip",!0),n}const sr=n=>Qt(n)?rp(n):n,pf=n=>Qt(n)?bE(n):n;function fr(n){return n?n.__v_isRef===!0:!1}function A(n){return _E(n,!1)}function PR(n){return _E(n,!0)}function _E(n,e){return fr(n)?n:new CR(n,e)}class CR{constructor(e,t){this.dep=new Tv,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Nt(e),this._value=t?e:sr(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||rs(e)||Po(e);e=r?e:Nt(e),Eo(e,t)&&(this._rawValue=e,this._value=r?e:sr(e),this.dep.trigger())}}function Br(n){return fr(n)?n.value:n}const RR={get:(n,e,t)=>e==="__v_raw"?n:Br(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return fr(s)&&!fr(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function wE(n){return zl(n)?n:new Proxy(n,RR)}class kR{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Tv(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Yu-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Zt!==this)return oE(this,!0),!0}get value(){const e=this.dep.track();return cE(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function DR(n,e,t=!1){let r,s;return ht(n)?r=n:(r=n.get,s=n.set),new kR(r,s,t)}const Th={},mf=new WeakMap;let va;function NR(n,e=!1,t=va){if(t){let r=mf.get(t);r||mf.set(t,r=[]),r.push(n)}}function OR(n,e,t=Gt){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=j=>s?j:rs(j)||s===!1||s===0?_i(j,1):_i(j);let f,h,p,v,x=!1,_=!1;if(fr(n)?(h=()=>n.value,x=rs(n)):zl(n)?(h=()=>c(n),x=!0):Ye(n)?(_=!0,x=n.some(j=>zl(j)||rs(j)),h=()=>n.map(j=>{if(fr(j))return j.value;if(zl(j))return c(j);if(ht(j))return l?l(j,2):j()})):ht(n)?e?h=l?()=>l(n,2):n:h=()=>{if(p){Pi();try{p()}finally{Ci()}}const j=va;va=f;try{return l?l(n,3,[v]):n(v)}finally{va=j}}:h=ws,e&&s){const j=h,ne=s===!0?1/0:s;h=()=>_i(j(),ne)}const w=lR(),T=()=>{f.stop(),w&&w.active&&bv(w.effects,f)};if(i&&e){const j=e;e=(...ne)=>{j(...ne),T()}}let N=_?new Array(n.length).fill(Th):Th;const I=j=>{if(!(!(f.flags&1)||!f.dirty&&!j))if(e){const ne=f.run();if(s||x||(_?ne.some((ae,V)=>Eo(ae,N[V])):Eo(ne,N))){p&&p();const ae=va;va=f;try{const V=[ne,N===Th?void 0:_&&N[0]===Th?[]:N,v];N=ne,l?l(e,3,V):e(...V)}finally{va=ae}}}else f.run()};return a&&a(I),f=new sE(h),f.scheduler=o?()=>o(I,!1):I,v=j=>NR(j,!1,f),p=f.onStop=()=>{const j=mf.get(f);if(j){if(l)l(j,4);else for(const ne of j)ne();mf.delete(f)}},e?r?I(!0):N=f.run():o?o(I.bind(null,!0),!0):f.run(),T.pause=f.pause.bind(f),T.resume=f.resume.bind(f),T.stop=T,T}function _i(n,e=1/0,t){if(e<=0||!Qt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,fr(n))_i(n.value,e,t);else if(Ye(n))for(let r=0;r<n.length;r++)_i(n[r],e,t);else if(Ic(n)||Bl(n))n.forEach(r=>{_i(r,e,t)});else if(eE(n)){for(const r in n)_i(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&_i(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Vd(n,e,t,r){try{return r?n(...r):n()}catch(s){sp(s,e,t)}}function Ss(n,e,t,r){if(ht(n)){const s=Vd(n,e,t,r);return s&&Xx(s)&&s.catch(i=>{sp(i,e,t)}),s}if(Ye(n)){const s=[];for(let i=0;i<n.length;i++)s.push(Ss(n[i],e,t,r));return s}}function sp(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Gt;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const f=a.ec;if(f){for(let h=0;h<f.length;h++)if(f[h](n,l,c)===!1)return}a=a.parent}if(i){Pi(),Vd(i,null,10,[n,l,c]),Ci();return}}VR(n,t,s,r,o)}function VR(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Ar=[];let js=-1;const Hl=[];let io=null,Nl=0;const xE=Promise.resolve();let gf=null;function kt(n){const e=gf||xE;return n?e.then(this?n.bind(this):n):e}function MR(n){let e=js+1,t=Ar.length;for(;e<t;){const r=e+t>>>1,s=Ar[r],i=Zu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function Cv(n){if(!(n.flags&1)){const e=Zu(n),t=Ar[Ar.length-1];!t||!(n.flags&2)&&e>=Zu(t)?Ar.push(n):Ar.splice(MR(e),0,n),n.flags|=1,EE()}}function EE(){gf||(gf=xE.then(TE))}function LR(n){Ye(n)?Hl.push(...n):io&&n.id===-1?io.splice(Nl+1,0,n):n.flags&1||(Hl.push(n),n.flags|=1),EE()}function Eb(n,e,t=js+1){for(;t<Ar.length;t++){const r=Ar[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Ar.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function IE(n){if(Hl.length){const e=[...new Set(Hl)].sort((t,r)=>Zu(t)-Zu(r));if(Hl.length=0,io){io.push(...e);return}for(io=e,Nl=0;Nl<io.length;Nl++){const t=io[Nl];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}io=null,Nl=0}}const Zu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function TE(n){const e=ws;try{for(js=0;js<Ar.length;js++){const t=Ar[js];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Vd(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;js<Ar.length;js++){const t=Ar[js];t&&(t.flags&=-2)}js=-1,Ar.length=0,IE(),gf=null,(Ar.length||Hl.length)&&TE()}}let Kn=null,SE=null;function vf(n){const e=Kn;return Kn=n,SE=n&&n.type.__scopeId||null,e}function zh(n,e=Kn,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Mb(-1);const i=vf(e);let o;try{o=n(...s)}finally{vf(i),r._d&&Mb(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function at(n,e){if(Kn===null)return n;const t=cp(Kn),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Gt]=e[s];i&&(ht(i)&&(i={mounted:i,updated:i}),i.deep&&_i(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function ha(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Pi(),Ss(l,t,8,[n.el,a,n,e]),Ci())}}const AE=Symbol("_vte"),PE=n=>n.__isTeleport,ku=n=>n&&(n.disabled||n.disabled===""),Ib=n=>n&&(n.defer||n.defer===""),Tb=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Sb=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,fg=(n,e)=>{const t=n&&n.to;return Tn(t)?e?e(t):null:t},CE={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:f,pc:h,pbc:p,o:{insert:v,querySelector:x,createText:_,createComment:w}}=c,T=ku(e.props);let{shapeFlag:N,children:I,dynamicChildren:j}=e;if(n==null){const ne=e.el=_(""),ae=e.anchor=_("");v(ne,t,r),v(ae,t,r);const V=(S,$)=>{N&16&&(s&&s.isCE&&(s.ce._teleportTarget=S),f(I,S,$,s,i,o,a,l))},P=()=>{const S=e.target=fg(e.props,x),$=RE(S,e,_,v);S&&(o!=="svg"&&Tb(S)?o="svg":o!=="mathml"&&Sb(S)&&(o="mathml"),T||(V(S,$),Hh(e,!1)))};T&&(V(t,ae),Hh(e,!0)),Ib(e.props)?(e.el.__isMounted=!1,Sr(()=>{P(),delete e.el.__isMounted},i)):P()}else{if(Ib(e.props)&&n.el.__isMounted===!1){Sr(()=>{CE.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const ne=e.anchor=n.anchor,ae=e.target=n.target,V=e.targetAnchor=n.targetAnchor,P=ku(n.props),S=P?t:ae,$=P?ne:V;if(o==="svg"||Tb(ae)?o="svg":(o==="mathml"||Sb(ae))&&(o="mathml"),j?(p(n.dynamicChildren,j,S,s,i,o,a),Ov(n,e,!0)):l||h(n,e,S,$,s,i,o,a,!1),T)P?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Sh(e,t,ne,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const F=e.target=fg(e.props,x);F&&Sh(e,F,null,c,0)}else P&&Sh(e,ae,V,c,1);Hh(e,T)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:f,target:h,props:p}=n;if(h&&(s(c),s(f)),i&&s(l),o&16){const v=i||!ku(p);for(let x=0;x<a.length;x++){const _=a[x];r(_,e,t,v,!!_.dynamicChildren)}}},move:Sh,hydrate:$R};function Sh(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:f}=n,h=i===2;if(h&&r(o,e,t),(!h||ku(f))&&l&16)for(let p=0;p<c.length;p++)s(c[p],e,t,2);h&&r(a,e,t)}function $R(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:f}},h){const p=e.target=fg(e.props,l);if(p){const v=ku(e.props),x=p._lpa||p.firstChild;if(e.shapeFlag&16)if(v)e.anchor=h(o(n),e,a(n),t,r,s,i),e.targetStart=x,e.targetAnchor=x&&o(x);else{e.anchor=o(n);let _=x;for(;_;){if(_&&_.nodeType===8){if(_.data==="teleport start anchor")e.targetStart=_;else if(_.data==="teleport anchor"){e.targetAnchor=_,p._lpa=e.targetAnchor&&o(e.targetAnchor);break}}_=o(_)}e.targetAnchor||RE(p,e,f,c),h(x&&o(x),e,p,t,r,s,i)}Hh(e,v)}return e.anchor&&o(e.anchor)}const ed=CE;function Hh(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function RE(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[AE]=i,n&&(r(s,n),r(i,n)),i}const oo=Symbol("_leaveCb"),Ah=Symbol("_enterCb");function FR(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return In(()=>{n.isMounted=!0}),Rv(()=>{n.isUnmounting=!0}),n}const es=[Function,Array],kE={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:es,onEnter:es,onAfterEnter:es,onEnterCancelled:es,onBeforeLeave:es,onLeave:es,onAfterLeave:es,onLeaveCancelled:es,onBeforeAppear:es,onAppear:es,onAfterAppear:es,onAppearCancelled:es},DE=n=>{const e=n.subTree;return e.component?DE(e.component):e},UR={name:"BaseTransition",props:kE,setup(n,{slots:e}){const t=Lk(),r=FR();return()=>{const s=e.default&&VE(e.default(),!0);if(!s||!s.length)return;const i=NE(s),o=Nt(n),{mode:a}=o;if(r.isLeaving)return bm(i);const l=Ab(i);if(!l)return bm(i);let c=pg(l,o,r,t,h=>c=h);l.type!==hr&&td(l,c);let f=t.subTree&&Ab(t.subTree);if(f&&f.type!==hr&&!wa(l,f)&&DE(t).type!==hr){let h=pg(f,o,r,t);if(td(f,h),a==="out-in"&&l.type!==hr)return r.isLeaving=!0,h.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete h.afterLeave,f=void 0},bm(i);a==="in-out"&&l.type!==hr?h.delayLeave=(p,v,x)=>{const _=OE(r,f);_[String(f.key)]=f,p[oo]=()=>{v(),p[oo]=void 0,delete c.delayedLeave,f=void 0},c.delayedLeave=()=>{x(),delete c.delayedLeave,f=void 0}}:f=void 0}else f&&(f=void 0);return i}}};function NE(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==hr){e=t;break}}return e}const jR=UR;function OE(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function pg(n,e,t,r,s){const{appear:i,mode:o,persisted:a=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:f,onEnterCancelled:h,onBeforeLeave:p,onLeave:v,onAfterLeave:x,onLeaveCancelled:_,onBeforeAppear:w,onAppear:T,onAfterAppear:N,onAppearCancelled:I}=e,j=String(n.key),ne=OE(t,n),ae=(S,$)=>{S&&Ss(S,r,9,$)},V=(S,$)=>{const F=$[1];ae(S,$),Ye(S)?S.every(U=>U.length<=1)&&F():S.length<=1&&F()},P={mode:o,persisted:a,beforeEnter(S){let $=l;if(!t.isMounted)if(i)$=w||l;else return;S[oo]&&S[oo](!0);const F=ne[j];F&&wa(n,F)&&F.el[oo]&&F.el[oo](),ae($,[S])},enter(S){let $=c,F=f,U=h;if(!t.isMounted)if(i)$=T||c,F=N||f,U=I||h;else return;let O=!1;const pt=S[Ah]=ct=>{O||(O=!0,ct?ae(U,[S]):ae(F,[S]),P.delayedLeave&&P.delayedLeave(),S[Ah]=void 0)};$?V($,[S,pt]):pt()},leave(S,$){const F=String(n.key);if(S[Ah]&&S[Ah](!0),t.isUnmounting)return $();ae(p,[S]);let U=!1;const O=S[oo]=pt=>{U||(U=!0,$(),pt?ae(_,[S]):ae(x,[S]),S[oo]=void 0,ne[F]===n&&delete ne[F])};ne[F]=n,v?V(v,[S,O]):O()},clone(S){const $=pg(S,e,t,r,s);return s&&s($),$}};return P}function bm(n){if(ip(n))return n=Co(n),n.children=null,n}function Ab(n){if(!ip(n))return PE(n.type)&&n.children?NE(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&ht(t.default))return t.default()}}function td(n,e){n.shapeFlag&6&&n.component?(n.transition=e,td(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function VE(n,e=!1,t){let r=[],s=0;for(let i=0;i<n.length;i++){let o=n[i];const a=t==null?o.key:String(t)+String(o.key!=null?o.key:i);o.type===wt?(o.patchFlag&128&&s++,r=r.concat(VE(o.children,e,a))):(e||o.type!==hr)&&r.push(a!=null?Co(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}/*! #__NO_SIDE_EFFECTS__ */function ME(n,e){return ht(n)?(()=>Fn({name:n.name},e,{setup:n}))():n}function LE(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function Du(n,e,t,r,s=!1){if(Ye(n)){n.forEach((x,_)=>Du(x,e&&(Ye(e)?e[_]:e),t,r,s));return}if(Wl(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Du(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?cp(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,f=a.refs===Gt?a.refs={}:a.refs,h=a.setupState,p=Nt(h),v=h===Gt?()=>!1:x=>Lt(p,x);if(c!=null&&c!==l&&(Tn(c)?(f[c]=null,v(c)&&(h[c]=null)):fr(c)&&(c.value=null)),ht(l))Vd(l,a,12,[o,f]);else{const x=Tn(l),_=fr(l);if(x||_){const w=()=>{if(n.f){const T=x?v(l)?h[l]:f[l]:l.value;s?Ye(T)&&bv(T,i):Ye(T)?T.includes(i)||T.push(i):x?(f[l]=[i],v(l)&&(h[l]=f[l])):(l.value=[i],n.k&&(f[n.k]=l.value))}else x?(f[l]=o,v(l)&&(h[l]=o)):_&&(l.value=o,n.k&&(f[n.k]=o))};o?(w.id=-1,Sr(w,t)):w()}}}tp().requestIdleCallback;tp().cancelIdleCallback;const Wl=n=>!!n.type.__asyncLoader,ip=n=>n.type.__isKeepAlive;function qR(n,e){$E(n,"a",e)}function BR(n,e){$E(n,"da",e)}function $E(n,e,t=ir){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(op(e,r,t),t){let s=t.parent;for(;s&&s.parent;)ip(s.parent.vnode)&&zR(r,e,t,s),s=s.parent}}function zR(n,e,t,r){const s=op(e,n,r,!0);Ii(()=>{bv(r[e],s)},t)}function op(n,e,t=ir,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Pi();const a=Md(t),l=Ss(e,t,n,o);return a(),Ci(),l});return r?s.unshift(i):s.push(i),i}}const $i=n=>(e,t=ir)=>{(!sd||n==="sp")&&op(n,(...r)=>e(...r),t)},HR=$i("bm"),In=$i("m"),WR=$i("bu"),KR=$i("u"),Rv=$i("bum"),Ii=$i("um"),GR=$i("sp"),QR=$i("rtg"),JR=$i("rtc");function YR(n,e=ir){op("ec",n,e)}const FE="components";function XR(n,e){return ek(FE,n,!0,e)||n}const ZR=Symbol.for("v-ndc");function ek(n,e,t=!0,r=!1){const s=Kn||ir;if(s){const i=s.type;if(n===FE){const a=qk(i,!1);if(a&&(a===e||a===is(e)||a===ep(is(e))))return i}const o=Pb(s[n]||i[n],e)||Pb(s.appContext[n],e);return!o&&r?i:o}}function Pb(n,e){return n&&(n[e]||n[is(e)]||n[ep(is(e))])}function qr(n,e,t,r){let s;const i=t&&t[r],o=Ye(n);if(o||Tn(n)){const a=o&&zl(n);let l=!1,c=!1;a&&(l=!rs(n),c=Po(n),n=np(n)),s=new Array(n.length);for(let f=0,h=n.length;f<h;f++)s[f]=e(l?c?pf(sr(n[f])):sr(n[f]):n[f],f,void 0,i&&i[f])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Qt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const f=a[l];s[l]=e(n[f],f,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}function tk(n,e,t={},r,s){if(Kn.ce||Kn.parent&&Wl(Kn.parent)&&Kn.parent.ce)return e!=="default"&&(t.name=e),k(),ns(wt,null,[ze("slot",t,r&&r())],64);let i=n[e];i&&i._c&&(i._d=!1),k();const o=i&&UE(i(t)),a=t.key||o&&o.key,l=ns(wt,{key:(a&&!Ts(a)?a:`_${e}`)+(!o&&r?"_fb":"")},o||(r?r():[]),o&&n._===1?64:-2);return!s&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function UE(n){return n.some(e=>rd(e)?!(e.type===hr||e.type===wt&&!UE(e.children)):!0)?n:null}const mg=n=>n?sI(n)?cp(n):mg(n.parent):null,Nu=Fn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>mg(n.parent),$root:n=>mg(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>kv(n),$forceUpdate:n=>n.f||(n.f=()=>{Cv(n.update)}),$nextTick:n=>n.n||(n.n=kt.bind(n.proxy)),$watch:n=>xk.bind(n)}),_m=(n,e)=>n!==Gt&&!n.__isScriptSetup&&Lt(n,e),nk={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const v=o[e];if(v!==void 0)switch(v){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(_m(r,e))return o[e]=1,r[e];if(s!==Gt&&Lt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&Lt(c,e))return o[e]=3,i[e];if(t!==Gt&&Lt(t,e))return o[e]=4,t[e];gg&&(o[e]=0)}}const f=Nu[e];let h,p;if(f)return e==="$attrs"&&dr(n.attrs,"get",""),f(n);if((h=a.__cssModules)&&(h=h[e]))return h;if(t!==Gt&&Lt(t,e))return o[e]=4,t[e];if(p=l.config.globalProperties,Lt(p,e))return p[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return _m(s,e)?(s[e]=t,!0):r!==Gt&&Lt(r,e)?(r[e]=t,!0):Lt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Gt&&Lt(n,o)||_m(e,o)||(a=i[0])&&Lt(a,o)||Lt(r,o)||Lt(Nu,o)||Lt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Lt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Cb(n){return Ye(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let gg=!0;function rk(n){const e=kv(n),t=n.proxy,r=n.ctx;gg=!1,e.beforeCreate&&Rb(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:f,beforeMount:h,mounted:p,beforeUpdate:v,updated:x,activated:_,deactivated:w,beforeDestroy:T,beforeUnmount:N,destroyed:I,unmounted:j,render:ne,renderTracked:ae,renderTriggered:V,errorCaptured:P,serverPrefetch:S,expose:$,inheritAttrs:F,components:U,directives:O,filters:pt}=e;if(c&&sk(c,r,null),o)for(const Ze in o){const ce=o[Ze];ht(ce)&&(r[Ze]=ce.bind(t))}if(s){const Ze=s.call(t,t);Qt(Ze)&&(n.data=rp(Ze))}if(gg=!0,i)for(const Ze in i){const ce=i[Ze],z=ht(ce)?ce.bind(t,t):ht(ce.get)?ce.get.bind(t,t):ws,ke=!ht(ce)&&ht(ce.set)?ce.set.bind(t):ws,Oe=$e({get:z,set:ke});Object.defineProperty(r,Ze,{enumerable:!0,configurable:!0,get:()=>Oe.value,set:qe=>Oe.value=qe})}if(a)for(const Ze in a)jE(a[Ze],r,t,Ze);if(l){const Ze=ht(l)?l.call(t):l;Reflect.ownKeys(Ze).forEach(ce=>{Wh(ce,Ze[ce])})}f&&Rb(f,n,"c");function Ct(Ze,ce){Ye(ce)?ce.forEach(z=>Ze(z.bind(t))):ce&&Ze(ce.bind(t))}if(Ct(HR,h),Ct(In,p),Ct(WR,v),Ct(KR,x),Ct(qR,_),Ct(BR,w),Ct(YR,P),Ct(JR,ae),Ct(QR,V),Ct(Rv,N),Ct(Ii,j),Ct(GR,S),Ye($))if($.length){const Ze=n.exposed||(n.exposed={});$.forEach(ce=>{Object.defineProperty(Ze,ce,{get:()=>t[ce],set:z=>t[ce]=z})})}else n.exposed||(n.exposed={});ne&&n.render===ws&&(n.render=ne),F!=null&&(n.inheritAttrs=F),U&&(n.components=U),O&&(n.directives=O),S&&LE(n)}function sk(n,e,t=ws){Ye(n)&&(n=vg(n));for(const r in n){const s=n[r];let i;Qt(s)?"default"in s?i=Es(s.from||r,s.default,!0):i=Es(s.from||r):i=Es(s),fr(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Rb(n,e,t){Ss(Ye(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function jE(n,e,t,r){let s=r.includes(".")?ZE(t,r):()=>t[r];if(Tn(n)){const i=e[n];ht(i)&&Pt(s,i)}else if(ht(n))Pt(s,n.bind(t));else if(Qt(n))if(Ye(n))n.forEach(i=>jE(i,e,t,r));else{const i=ht(n.handler)?n.handler.bind(t):e[n.handler];ht(i)&&Pt(s,i,n)}}function kv(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>yf(l,c,o,!0)),yf(l,e,o)),Qt(e)&&i.set(e,l),l}function yf(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&yf(n,i,t,!0),s&&s.forEach(o=>yf(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=ik[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const ik={data:kb,props:Db,emits:Db,methods:_u,computed:_u,beforeCreate:Tr,created:Tr,beforeMount:Tr,mounted:Tr,beforeUpdate:Tr,updated:Tr,beforeDestroy:Tr,beforeUnmount:Tr,destroyed:Tr,unmounted:Tr,activated:Tr,deactivated:Tr,errorCaptured:Tr,serverPrefetch:Tr,components:_u,directives:_u,watch:ak,provide:kb,inject:ok};function kb(n,e){return e?n?function(){return Fn(ht(n)?n.call(this,this):n,ht(e)?e.call(this,this):e)}:e:n}function ok(n,e){return _u(vg(n),vg(e))}function vg(n){if(Ye(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Tr(n,e){return n?[...new Set([].concat(n,e))]:e}function _u(n,e){return n?Fn(Object.create(null),n,e):e}function Db(n,e){return n?Ye(n)&&Ye(e)?[...new Set([...n,...e])]:Fn(Object.create(null),Cb(n),Cb(e??{})):e}function ak(n,e){if(!n)return e;if(!e)return n;const t=Fn(Object.create(null),n);for(const r in e)t[r]=Tr(n[r],e[r]);return t}function qE(){return{app:null,config:{isNativeTag:GC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let lk=0;function ck(n,e){return function(r,s=null){ht(r)||(r=Fn({},r)),s!=null&&!Qt(s)&&(s=null);const i=qE(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:lk++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:zk,get config(){return i.config},set config(f){},use(f,...h){return o.has(f)||(f&&ht(f.install)?(o.add(f),f.install(c,...h)):ht(f)&&(o.add(f),f(c,...h))),c},mixin(f){return i.mixins.includes(f)||i.mixins.push(f),c},component(f,h){return h?(i.components[f]=h,c):i.components[f]},directive(f,h){return h?(i.directives[f]=h,c):i.directives[f]},mount(f,h,p){if(!l){const v=c._ceVNode||ze(r,s);return v.appContext=i,p===!0?p="svg":p===!1&&(p=void 0),h&&e?e(v,f):n(v,f,p),l=!0,c._container=f,f.__vue_app__=c,cp(v.component)}},onUnmount(f){a.push(f)},unmount(){l&&(Ss(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(f,h){return i.provides[f]=h,c},runWithContext(f){const h=Kl;Kl=c;try{return f()}finally{Kl=h}}};return c}}let Kl=null;function Wh(n,e){if(ir){let t=ir.provides;const r=ir.parent&&ir.parent.provides;r===t&&(t=ir.provides=Object.create(r)),t[n]=e}}function Es(n,e,t=!1){const r=ir||Kn;if(r||Kl){let s=Kl?Kl._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&ht(e)?e.call(r&&r.proxy):e}}const BE={},zE=()=>Object.create(BE),HE=n=>Object.getPrototypeOf(n)===BE;function uk(n,e,t,r=!1){const s={},i=zE();n.propsDefaults=Object.create(null),WE(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:yE(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function dk(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=Nt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const f=n.vnode.dynamicProps;for(let h=0;h<f.length;h++){let p=f[h];if(ap(n.emitsOptions,p))continue;const v=e[p];if(l)if(Lt(i,p))v!==i[p]&&(i[p]=v,c=!0);else{const x=is(p);s[x]=yg(l,a,x,v,n,!1)}else v!==i[p]&&(i[p]=v,c=!0)}}}else{WE(n,e,s,i)&&(c=!0);let f;for(const h in a)(!e||!Lt(e,h)&&((f=Fo(h))===h||!Lt(e,f)))&&(l?t&&(t[h]!==void 0||t[f]!==void 0)&&(s[h]=yg(l,a,h,void 0,n,!0)):delete s[h]);if(i!==a)for(const h in i)(!e||!Lt(e,h))&&(delete i[h],c=!0)}c&&bi(n.attrs,"set","")}function WE(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Pu(l))continue;const c=e[l];let f;s&&Lt(s,f=is(l))?!i||!i.includes(f)?t[f]=c:(a||(a={}))[f]=c:ap(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=Nt(t),c=a||Gt;for(let f=0;f<i.length;f++){const h=i[f];t[h]=yg(s,l,h,c[h],n,!Lt(c,h))}}return o}function yg(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=Lt(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&ht(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const f=Md(s);r=c[t]=l.call(null,e),f()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Fo(t))&&(r=!0))}return r}const hk=new WeakMap;function KE(n,e,t=!1){const r=t?hk:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!ht(n)){const f=h=>{l=!0;const[p,v]=KE(h,e,!0);Fn(o,p),v&&a.push(...v)};!t&&e.mixins.length&&e.mixins.forEach(f),n.extends&&f(n.extends),n.mixins&&n.mixins.forEach(f)}if(!i&&!l)return Qt(n)&&r.set(n,ql),ql;if(Ye(i))for(let f=0;f<i.length;f++){const h=is(i[f]);Nb(h)&&(o[h]=Gt)}else if(i)for(const f in i){const h=is(f);if(Nb(h)){const p=i[f],v=o[h]=Ye(p)||ht(p)?{type:p}:Fn({},p),x=v.type;let _=!1,w=!0;if(Ye(x))for(let T=0;T<x.length;++T){const N=x[T],I=ht(N)&&N.name;if(I==="Boolean"){_=!0;break}else I==="String"&&(w=!1)}else _=ht(x)&&x.name==="Boolean";v[0]=_,v[1]=w,(_||Lt(v,"default"))&&a.push(h)}}const c=[o,a];return Qt(n)&&r.set(n,c),c}function Nb(n){return n[0]!=="$"&&!Pu(n)}const Dv=n=>n[0]==="_"||n==="$stable",Nv=n=>Ye(n)?n.map(zs):[zs(n)],fk=(n,e,t)=>{if(e._n)return e;const r=zh((...s)=>Nv(e(...s)),t);return r._c=!1,r},GE=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Dv(s))continue;const i=n[s];if(ht(i))e[s]=fk(s,i,r);else if(i!=null){const o=Nv(i);e[s]=()=>o}}},QE=(n,e)=>{const t=Nv(e);n.slots.default=()=>t},JE=(n,e,t)=>{for(const r in e)(t||!Dv(r))&&(n[r]=e[r])},pk=(n,e,t)=>{const r=n.slots=zE();if(n.vnode.shapeFlag&32){const s=e.__;s&&lg(r,"__",s,!0);const i=e._;i?(JE(r,e,t),t&&lg(r,"_",i,!0)):GE(e,r)}else e&&QE(n,e)},mk=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Gt;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:JE(s,e,t):(i=!e.$stable,GE(e,s)),o=e}else e&&(QE(n,e),o={default:1});if(i)for(const a in s)!Dv(a)&&o[a]==null&&delete s[a]},Sr=Ck;function gk(n){return vk(n)}function vk(n,e){const t=tp();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:f,parentNode:h,nextSibling:p,setScopeId:v=ws,insertStaticContent:x}=n,_=(R,L,H,fe=null,oe=null,me=null,Ie=void 0,we=null,ee=!!L.dynamicChildren)=>{if(R===L)return;R&&!wa(R,L)&&(fe=ue(R),qe(R,oe,me,!0),R=null),L.patchFlag===-2&&(ee=!1,L.dynamicChildren=null);const{type:ge,ref:Le,shapeFlag:ye}=L;switch(ge){case lp:w(R,L,H,fe);break;case hr:T(R,L,H,fe);break;case Kh:R==null&&N(L,H,fe,Ie);break;case wt:U(R,L,H,fe,oe,me,Ie,we,ee);break;default:ye&1?ne(R,L,H,fe,oe,me,Ie,we,ee):ye&6?O(R,L,H,fe,oe,me,Ie,we,ee):(ye&64||ye&128)&&ge.process(R,L,H,fe,oe,me,Ie,we,ee,G)}Le!=null&&oe?Du(Le,R&&R.ref,me,L||R,!L):Le==null&&R&&R.ref!=null&&Du(R.ref,null,me,R,!0)},w=(R,L,H,fe)=>{if(R==null)r(L.el=a(L.children),H,fe);else{const oe=L.el=R.el;L.children!==R.children&&c(oe,L.children)}},T=(R,L,H,fe)=>{R==null?r(L.el=l(L.children||""),H,fe):L.el=R.el},N=(R,L,H,fe)=>{[R.el,R.anchor]=x(R.children,L,H,fe,R.el,R.anchor)},I=({el:R,anchor:L},H,fe)=>{let oe;for(;R&&R!==L;)oe=p(R),r(R,H,fe),R=oe;r(L,H,fe)},j=({el:R,anchor:L})=>{let H;for(;R&&R!==L;)H=p(R),s(R),R=H;s(L)},ne=(R,L,H,fe,oe,me,Ie,we,ee)=>{L.type==="svg"?Ie="svg":L.type==="math"&&(Ie="mathml"),R==null?ae(L,H,fe,oe,me,Ie,we,ee):S(R,L,oe,me,Ie,we,ee)},ae=(R,L,H,fe,oe,me,Ie,we)=>{let ee,ge;const{props:Le,shapeFlag:ye,transition:Re,dirs:Qe}=R;if(ee=R.el=o(R.type,me,Le&&Le.is,Le),ye&8?f(ee,R.children):ye&16&&P(R.children,ee,null,fe,oe,wm(R,me),Ie,we),Qe&&ha(R,null,fe,"created"),V(ee,R,R.scopeId,Ie,fe),Le){for(const rt in Le)rt!=="value"&&!Pu(rt)&&i(ee,rt,null,Le[rt],me,fe);"value"in Le&&i(ee,"value",null,Le.value,me),(ge=Le.onVnodeBeforeMount)&&Us(ge,fe,R)}Qe&&ha(R,null,fe,"beforeMount");const We=yk(oe,Re);We&&Re.beforeEnter(ee),r(ee,L,H),((ge=Le&&Le.onVnodeMounted)||We||Qe)&&Sr(()=>{ge&&Us(ge,fe,R),We&&Re.enter(ee),Qe&&ha(R,null,fe,"mounted")},oe)},V=(R,L,H,fe,oe)=>{if(H&&v(R,H),fe)for(let me=0;me<fe.length;me++)v(R,fe[me]);if(oe){let me=oe.subTree;if(L===me||tI(me.type)&&(me.ssContent===L||me.ssFallback===L)){const Ie=oe.vnode;V(R,Ie,Ie.scopeId,Ie.slotScopeIds,oe.parent)}}},P=(R,L,H,fe,oe,me,Ie,we,ee=0)=>{for(let ge=ee;ge<R.length;ge++){const Le=R[ge]=we?ao(R[ge]):zs(R[ge]);_(null,Le,L,H,fe,oe,me,Ie,we)}},S=(R,L,H,fe,oe,me,Ie)=>{const we=L.el=R.el;let{patchFlag:ee,dynamicChildren:ge,dirs:Le}=L;ee|=R.patchFlag&16;const ye=R.props||Gt,Re=L.props||Gt;let Qe;if(H&&fa(H,!1),(Qe=Re.onVnodeBeforeUpdate)&&Us(Qe,H,L,R),Le&&ha(L,R,H,"beforeUpdate"),H&&fa(H,!0),(ye.innerHTML&&Re.innerHTML==null||ye.textContent&&Re.textContent==null)&&f(we,""),ge?$(R.dynamicChildren,ge,we,H,fe,wm(L,oe),me):Ie||ce(R,L,we,null,H,fe,wm(L,oe),me,!1),ee>0){if(ee&16)F(we,ye,Re,H,oe);else if(ee&2&&ye.class!==Re.class&&i(we,"class",null,Re.class,oe),ee&4&&i(we,"style",ye.style,Re.style,oe),ee&8){const We=L.dynamicProps;for(let rt=0;rt<We.length;rt++){const gt=We[rt],fn=ye[gt],Xt=Re[gt];(Xt!==fn||gt==="value")&&i(we,gt,fn,Xt,oe,H)}}ee&1&&R.children!==L.children&&f(we,L.children)}else!Ie&&ge==null&&F(we,ye,Re,H,oe);((Qe=Re.onVnodeUpdated)||Le)&&Sr(()=>{Qe&&Us(Qe,H,L,R),Le&&ha(L,R,H,"updated")},fe)},$=(R,L,H,fe,oe,me,Ie)=>{for(let we=0;we<L.length;we++){const ee=R[we],ge=L[we],Le=ee.el&&(ee.type===wt||!wa(ee,ge)||ee.shapeFlag&198)?h(ee.el):H;_(ee,ge,Le,null,fe,oe,me,Ie,!0)}},F=(R,L,H,fe,oe)=>{if(L!==H){if(L!==Gt)for(const me in L)!Pu(me)&&!(me in H)&&i(R,me,L[me],null,oe,fe);for(const me in H){if(Pu(me))continue;const Ie=H[me],we=L[me];Ie!==we&&me!=="value"&&i(R,me,we,Ie,oe,fe)}"value"in H&&i(R,"value",L.value,H.value,oe)}},U=(R,L,H,fe,oe,me,Ie,we,ee)=>{const ge=L.el=R?R.el:a(""),Le=L.anchor=R?R.anchor:a("");let{patchFlag:ye,dynamicChildren:Re,slotScopeIds:Qe}=L;Qe&&(we=we?we.concat(Qe):Qe),R==null?(r(ge,H,fe),r(Le,H,fe),P(L.children||[],H,Le,oe,me,Ie,we,ee)):ye>0&&ye&64&&Re&&R.dynamicChildren?($(R.dynamicChildren,Re,H,oe,me,Ie,we),(L.key!=null||oe&&L===oe.subTree)&&Ov(R,L,!0)):ce(R,L,H,Le,oe,me,Ie,we,ee)},O=(R,L,H,fe,oe,me,Ie,we,ee)=>{L.slotScopeIds=we,R==null?L.shapeFlag&512?oe.ctx.activate(L,H,fe,Ie,ee):pt(L,H,fe,oe,me,Ie,ee):ct(R,L,ee)},pt=(R,L,H,fe,oe,me,Ie)=>{const we=R.component=Mk(R,fe,oe);if(ip(R)&&(we.ctx.renderer=G),$k(we,!1,Ie),we.asyncDep){if(oe&&oe.registerDep(we,Ct,Ie),!R.el){const ee=we.subTree=ze(hr);T(null,ee,L,H)}}else Ct(we,R,L,H,oe,me,Ie)},ct=(R,L,H)=>{const fe=L.component=R.component;if(Ak(R,L,H))if(fe.asyncDep&&!fe.asyncResolved){Ze(fe,L,H);return}else fe.next=L,fe.update();else L.el=R.el,fe.vnode=L},Ct=(R,L,H,fe,oe,me,Ie)=>{const we=()=>{if(R.isMounted){let{next:ye,bu:Re,u:Qe,parent:We,vnode:rt}=R;{const Vt=YE(R);if(Vt){ye&&(ye.el=rt.el,Ze(R,ye,Ie)),Vt.asyncDep.then(()=>{R.isUnmounted||we()});return}}let gt=ye,fn;fa(R,!1),ye?(ye.el=rt.el,Ze(R,ye,Ie)):ye=rt,Re&&Bh(Re),(fn=ye.props&&ye.props.onVnodeBeforeUpdate)&&Us(fn,We,ye,rt),fa(R,!0);const Xt=xm(R),Kt=R.subTree;R.subTree=Xt,_(Kt,Xt,h(Kt.el),ue(Kt),R,oe,me),ye.el=Xt.el,gt===null&&Pk(R,Xt.el),Qe&&Sr(Qe,oe),(fn=ye.props&&ye.props.onVnodeUpdated)&&Sr(()=>Us(fn,We,ye,rt),oe)}else{let ye;const{el:Re,props:Qe}=L,{bm:We,m:rt,parent:gt,root:fn,type:Xt}=R,Kt=Wl(L);if(fa(R,!1),We&&Bh(We),!Kt&&(ye=Qe&&Qe.onVnodeBeforeMount)&&Us(ye,gt,L),fa(R,!0),Re&&Ke){const Vt=()=>{R.subTree=xm(R),Ke(Re,R.subTree,R,oe,null)};Kt&&Xt.__asyncHydrate?Xt.__asyncHydrate(Re,R,Vt):Vt()}else{fn.ce&&fn.ce._def.shadowRoot!==!1&&fn.ce._injectChildStyle(Xt);const Vt=R.subTree=xm(R);_(null,Vt,H,fe,R,oe,me),L.el=Vt.el}if(rt&&Sr(rt,oe),!Kt&&(ye=Qe&&Qe.onVnodeMounted)){const Vt=L;Sr(()=>Us(ye,gt,Vt),oe)}(L.shapeFlag&256||gt&&Wl(gt.vnode)&&gt.vnode.shapeFlag&256)&&R.a&&Sr(R.a,oe),R.isMounted=!0,L=H=fe=null}};R.scope.on();const ee=R.effect=new sE(we);R.scope.off();const ge=R.update=ee.run.bind(ee),Le=R.job=ee.runIfDirty.bind(ee);Le.i=R,Le.id=R.uid,ee.scheduler=()=>Cv(Le),fa(R,!0),ge()},Ze=(R,L,H)=>{L.component=R;const fe=R.vnode.props;R.vnode=L,R.next=null,dk(R,L.props,fe,H),mk(R,L.children,H),Pi(),Eb(R),Ci()},ce=(R,L,H,fe,oe,me,Ie,we,ee=!1)=>{const ge=R&&R.children,Le=R?R.shapeFlag:0,ye=L.children,{patchFlag:Re,shapeFlag:Qe}=L;if(Re>0){if(Re&128){ke(ge,ye,H,fe,oe,me,Ie,we,ee);return}else if(Re&256){z(ge,ye,H,fe,oe,me,Ie,we,ee);return}}Qe&8?(Le&16&&Yt(ge,oe,me),ye!==ge&&f(H,ye)):Le&16?Qe&16?ke(ge,ye,H,fe,oe,me,Ie,we,ee):Yt(ge,oe,me,!0):(Le&8&&f(H,""),Qe&16&&P(ye,H,fe,oe,me,Ie,we,ee))},z=(R,L,H,fe,oe,me,Ie,we,ee)=>{R=R||ql,L=L||ql;const ge=R.length,Le=L.length,ye=Math.min(ge,Le);let Re;for(Re=0;Re<ye;Re++){const Qe=L[Re]=ee?ao(L[Re]):zs(L[Re]);_(R[Re],Qe,H,null,oe,me,Ie,we,ee)}ge>Le?Yt(R,oe,me,!0,!1,ye):P(L,H,fe,oe,me,Ie,we,ee,ye)},ke=(R,L,H,fe,oe,me,Ie,we,ee)=>{let ge=0;const Le=L.length;let ye=R.length-1,Re=Le-1;for(;ge<=ye&&ge<=Re;){const Qe=R[ge],We=L[ge]=ee?ao(L[ge]):zs(L[ge]);if(wa(Qe,We))_(Qe,We,H,null,oe,me,Ie,we,ee);else break;ge++}for(;ge<=ye&&ge<=Re;){const Qe=R[ye],We=L[Re]=ee?ao(L[Re]):zs(L[Re]);if(wa(Qe,We))_(Qe,We,H,null,oe,me,Ie,we,ee);else break;ye--,Re--}if(ge>ye){if(ge<=Re){const Qe=Re+1,We=Qe<Le?L[Qe].el:fe;for(;ge<=Re;)_(null,L[ge]=ee?ao(L[ge]):zs(L[ge]),H,We,oe,me,Ie,we,ee),ge++}}else if(ge>Re)for(;ge<=ye;)qe(R[ge],oe,me,!0),ge++;else{const Qe=ge,We=ge,rt=new Map;for(ge=We;ge<=Re;ge++){const pn=L[ge]=ee?ao(L[ge]):zs(L[ge]);pn.key!=null&&rt.set(pn.key,ge)}let gt,fn=0;const Xt=Re-We+1;let Kt=!1,Vt=0;const yr=new Array(Xt);for(ge=0;ge<Xt;ge++)yr[ge]=0;for(ge=Qe;ge<=ye;ge++){const pn=R[ge];if(fn>=Xt){qe(pn,oe,me,!0);continue}let Yn;if(pn.key!=null)Yn=rt.get(pn.key);else for(gt=We;gt<=Re;gt++)if(yr[gt-We]===0&&wa(pn,L[gt])){Yn=gt;break}Yn===void 0?qe(pn,oe,me,!0):(yr[Yn-We]=ge+1,Yn>=Vt?Vt=Yn:Kt=!0,_(pn,L[Yn],H,null,oe,me,Ie,we,ee),fn++)}const br=Kt?bk(yr):ql;for(gt=br.length-1,ge=Xt-1;ge>=0;ge--){const pn=We+ge,Yn=L[pn],Rs=pn+1<Le?L[pn+1].el:fe;yr[ge]===0?_(null,Yn,H,Rs,oe,me,Ie,we,ee):Kt&&(gt<0||ge!==br[gt]?Oe(Yn,H,Rs,2):gt--)}}},Oe=(R,L,H,fe,oe=null)=>{const{el:me,type:Ie,transition:we,children:ee,shapeFlag:ge}=R;if(ge&6){Oe(R.component.subTree,L,H,fe);return}if(ge&128){R.suspense.move(L,H,fe);return}if(ge&64){Ie.move(R,L,H,G);return}if(Ie===wt){r(me,L,H);for(let ye=0;ye<ee.length;ye++)Oe(ee[ye],L,H,fe);r(R.anchor,L,H);return}if(Ie===Kh){I(R,L,H);return}if(fe!==2&&ge&1&&we)if(fe===0)we.beforeEnter(me),r(me,L,H),Sr(()=>we.enter(me),oe);else{const{leave:ye,delayLeave:Re,afterLeave:Qe}=we,We=()=>{R.ctx.isUnmounted?s(me):r(me,L,H)},rt=()=>{ye(me,()=>{We(),Qe&&Qe()})};Re?Re(me,We,rt):rt()}else r(me,L,H)},qe=(R,L,H,fe=!1,oe=!1)=>{const{type:me,props:Ie,ref:we,children:ee,dynamicChildren:ge,shapeFlag:Le,patchFlag:ye,dirs:Re,cacheIndex:Qe}=R;if(ye===-2&&(oe=!1),we!=null&&(Pi(),Du(we,null,H,R,!0),Ci()),Qe!=null&&(L.renderCache[Qe]=void 0),Le&256){L.ctx.deactivate(R);return}const We=Le&1&&Re,rt=!Wl(R);let gt;if(rt&&(gt=Ie&&Ie.onVnodeBeforeUnmount)&&Us(gt,L,R),Le&6)On(R.component,H,fe);else{if(Le&128){R.suspense.unmount(H,fe);return}We&&ha(R,null,L,"beforeUnmount"),Le&64?R.type.remove(R,L,H,G,fe):ge&&!ge.hasOnce&&(me!==wt||ye>0&&ye&64)?Yt(ge,L,H,!1,!0):(me===wt&&ye&384||!oe&&Le&16)&&Yt(ee,L,H),fe&&mt(R)}(rt&&(gt=Ie&&Ie.onVnodeUnmounted)||We)&&Sr(()=>{gt&&Us(gt,L,R),We&&ha(R,null,L,"unmounted")},H)},mt=R=>{const{type:L,el:H,anchor:fe,transition:oe}=R;if(L===wt){zt(H,fe);return}if(L===Kh){j(R);return}const me=()=>{s(H),oe&&!oe.persisted&&oe.afterLeave&&oe.afterLeave()};if(R.shapeFlag&1&&oe&&!oe.persisted){const{leave:Ie,delayLeave:we}=oe,ee=()=>Ie(H,me);we?we(R.el,me,ee):ee()}else me()},zt=(R,L)=>{let H;for(;R!==L;)H=p(R),s(R),R=H;s(L)},On=(R,L,H)=>{const{bum:fe,scope:oe,job:me,subTree:Ie,um:we,m:ee,a:ge,parent:Le,slots:{__:ye}}=R;Ob(ee),Ob(ge),fe&&Bh(fe),Le&&Ye(ye)&&ye.forEach(Re=>{Le.renderCache[Re]=void 0}),oe.stop(),me&&(me.flags|=8,qe(Ie,R,L,H)),we&&Sr(we,L),Sr(()=>{R.isUnmounted=!0},L),L&&L.pendingBranch&&!L.isUnmounted&&R.asyncDep&&!R.asyncResolved&&R.suspenseId===L.pendingId&&(L.deps--,L.deps===0&&L.resolve())},Yt=(R,L,H,fe=!1,oe=!1,me=0)=>{for(let Ie=me;Ie<R.length;Ie++)qe(R[Ie],L,H,fe,oe)},ue=R=>{if(R.shapeFlag&6)return ue(R.component.subTree);if(R.shapeFlag&128)return R.suspense.next();const L=p(R.anchor||R.el),H=L&&L[AE];return H?p(H):L};let Pe=!1;const B=(R,L,H)=>{R==null?L._vnode&&qe(L._vnode,null,null,!0):_(L._vnode||null,R,L,null,null,null,H),L._vnode=R,Pe||(Pe=!0,Eb(),IE(),Pe=!1)},G={p:_,um:qe,m:Oe,r:mt,mt:pt,mc:P,pc:ce,pbc:$,n:ue,o:n};let Ce,Ke;return e&&([Ce,Ke]=e(G)),{render:B,hydrate:Ce,createApp:ck(B,Ce)}}function wm({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function fa({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function yk(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Ov(n,e,t=!1){const r=n.children,s=e.children;if(Ye(r)&&Ye(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=ao(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Ov(o,a)),a.type===lp&&(a.el=o.el),a.type===hr&&!a.el&&(a.el=o.el)}}function bk(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function YE(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:YE(e)}function Ob(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const _k=Symbol.for("v-scx"),wk=()=>Es(_k);function Pt(n,e,t){return XE(n,e,t)}function XE(n,e,t=Gt){const{immediate:r,deep:s,flush:i,once:o}=t,a=Fn({},t),l=e&&r||!e&&i!=="post";let c;if(sd){if(i==="sync"){const v=wk();c=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=ws,v.resume=ws,v.pause=ws,v}}const f=ir;a.call=(v,x,_)=>Ss(v,f,x,_);let h=!1;i==="post"?a.scheduler=v=>{Sr(v,f&&f.suspense)}:i!=="sync"&&(h=!0,a.scheduler=(v,x)=>{x?v():Cv(v)}),a.augmentJob=v=>{e&&(v.flags|=4),h&&(v.flags|=2,f&&(v.id=f.uid,v.i=f))};const p=OR(n,e,a);return sd&&(c?c.push(p):l&&p()),p}function xk(n,e,t){const r=this.proxy,s=Tn(n)?n.includes(".")?ZE(r,n):()=>r[n]:n.bind(r,r);let i;ht(e)?i=e:(i=e.handler,t=e);const o=Md(this),a=XE(s,i.bind(r),t);return o(),a}function ZE(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const Ek=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${is(e)}Modifiers`]||n[`${Fo(e)}Modifiers`];function Ik(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Gt;let s=t;const i=e.startsWith("update:"),o=i&&Ek(r,e.slice(7));o&&(o.trim&&(s=t.map(f=>Tn(f)?f.trim():f)),o.number&&(s=t.map(ff)));let a,l=r[a=pm(e)]||r[a=pm(is(e))];!l&&i&&(l=r[a=pm(Fo(e))]),l&&Ss(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Ss(c,n,6,s)}}function eI(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!ht(n)){const l=c=>{const f=eI(c,e,!0);f&&(a=!0,Fn(o,f))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Qt(n)&&r.set(n,null),null):(Ye(i)?i.forEach(l=>o[l]=null):Fn(o,i),Qt(n)&&r.set(n,o),o)}function ap(n,e){return!n||!Xf(e)?!1:(e=e.slice(2).replace(/Once$/,""),Lt(n,e[0].toLowerCase()+e.slice(1))||Lt(n,Fo(e))||Lt(n,e))}function xm(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:f,props:h,data:p,setupState:v,ctx:x,inheritAttrs:_}=n,w=vf(n);let T,N;try{if(t.shapeFlag&4){const j=s||r,ne=j;T=zs(c.call(ne,j,f,h,v,p,x)),N=a}else{const j=e;T=zs(j.length>1?j(h,{attrs:a,slots:o,emit:l}):j(h,null)),N=e.props?a:Tk(a)}}catch(j){Ou.length=0,sp(j,n,1),T=ze(hr)}let I=T;if(N&&_!==!1){const j=Object.keys(N),{shapeFlag:ne}=I;j.length&&ne&7&&(i&&j.some(yv)&&(N=Sk(N,i)),I=Co(I,N,!1,!0))}return t.dirs&&(I=Co(I,null,!1,!0),I.dirs=I.dirs?I.dirs.concat(t.dirs):t.dirs),t.transition&&td(I,t.transition),T=I,vf(w),T}const Tk=n=>{let e;for(const t in n)(t==="class"||t==="style"||Xf(t))&&((e||(e={}))[t]=n[t]);return e},Sk=(n,e)=>{const t={};for(const r in n)(!yv(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function Ak(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Vb(r,o,c):!!o;if(l&8){const f=e.dynamicProps;for(let h=0;h<f.length;h++){const p=f[h];if(o[p]!==r[p]&&!ap(c,p))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Vb(r,o,c):!0:!!o;return!1}function Vb(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!ap(t,i))return!0}return!1}function Pk({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const tI=n=>n.__isSuspense;function Ck(n,e){e&&e.pendingBranch?Ye(n)?e.effects.push(...n):e.effects.push(n):LR(n)}const wt=Symbol.for("v-fgt"),lp=Symbol.for("v-txt"),hr=Symbol.for("v-cmt"),Kh=Symbol.for("v-stc"),Ou=[];let Hr=null;function k(n=!1){Ou.push(Hr=n?null:[])}function Rk(){Ou.pop(),Hr=Ou[Ou.length-1]||null}let nd=1;function Mb(n,e=!1){nd+=n,n<0&&Hr&&e&&(Hr.hasOnce=!0)}function nI(n){return n.dynamicChildren=nd>0?Hr||ql:null,Rk(),nd>0&&Hr&&Hr.push(n),n}function D(n,e,t,r,s,i){return nI(d(n,e,t,r,s,i,!0))}function ns(n,e,t,r,s){return nI(ze(n,e,t,r,s,!0))}function rd(n){return n?n.__v_isVNode===!0:!1}function wa(n,e){return n.type===e.type&&n.key===e.key}const rI=({key:n})=>n??null,Gh=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Tn(n)||fr(n)||ht(n)?{i:Kn,r:n,k:e,f:!!t}:n:null);function d(n,e=null,t=null,r=0,s=null,i=n===wt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&rI(e),ref:e&&Gh(e),scopeId:SE,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Kn};return a?(Vv(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Tn(t)?8:16),nd>0&&!o&&Hr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Hr.push(l),l}const ze=kk;function kk(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===ZR)&&(n=hr),rd(n)){const a=Co(n,e,!0);return t&&Vv(a,t),nd>0&&!i&&Hr&&(a.shapeFlag&6?Hr[Hr.indexOf(n)]=a:Hr.push(a)),a.patchFlag=-2,a}if(Bk(n)&&(n=n.__vccOpts),e){e=Dk(e);let{class:a,style:l}=e;a&&!Tn(a)&&(e.class=$t(a)),Qt(l)&&(Pv(l)&&!Ye(l)&&(l=Fn({},l)),e.style=Ur(l))}const o=Tn(n)?1:tI(n)?128:PE(n)?64:Qt(n)?4:ht(n)?2:0;return d(n,e,t,r,s,o,i,!0)}function Dk(n){return n?Pv(n)||HE(n)?Fn({},n):n:null}function Co(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?Nk(s||{},e):s,f={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&rI(c),ref:e&&e.ref?t&&i?Ye(i)?i.concat(Gh(e)):[i,Gh(e)]:Gh(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==wt?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Co(n.ssContent),ssFallback:n.ssFallback&&Co(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&td(f,l.clone(f)),f}function lt(n=" ",e=0){return ze(lp,null,n,e)}function rr(n,e){const t=ze(Kh,null,n);return t.staticCount=e,t}function se(n="",e=!1){return e?(k(),ns(hr,null,n)):ze(hr,null,n)}function zs(n){return n==null||typeof n=="boolean"?ze(hr):Ye(n)?ze(wt,null,n.slice()):rd(n)?ao(n):ze(lp,null,String(n))}function ao(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Co(n)}function Vv(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(Ye(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),Vv(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!HE(e)?e._ctx=Kn:s===3&&Kn&&(Kn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else ht(e)?(e={default:e,_ctx:Kn},t=32):(e=String(e),r&64?(t=16,e=[lt(e)]):t=8);n.children=e,n.shapeFlag|=t}function Nk(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=$t([e.class,r.class]));else if(s==="style")e.style=Ur([e.style,r.style]);else if(Xf(s)){const i=e[s],o=r[s];o&&i!==o&&!(Ye(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Us(n,e,t,r=null){Ss(n,e,7,[t,r])}const Ok=qE();let Vk=0;function Mk(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||Ok,i={uid:Vk++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new aR(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:KE(r,s),emitsOptions:eI(r,s),emit:null,emitted:null,propsDefaults:Gt,inheritAttrs:r.inheritAttrs,ctx:Gt,data:Gt,props:Gt,attrs:Gt,slots:Gt,refs:Gt,setupState:Gt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=Ik.bind(null,i),n.ce&&n.ce(i),i}let ir=null;const Lk=()=>ir||Kn;let bf,bg;{const n=tp(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};bf=e("__VUE_INSTANCE_SETTERS__",t=>ir=t),bg=e("__VUE_SSR_SETTERS__",t=>sd=t)}const Md=n=>{const e=ir;return bf(n),n.scope.on(),()=>{n.scope.off(),bf(e)}},Lb=()=>{ir&&ir.scope.off(),bf(null)};function sI(n){return n.vnode.shapeFlag&4}let sd=!1;function $k(n,e=!1,t=!1){e&&bg(e);const{props:r,children:s}=n.vnode,i=sI(n);uk(n,r,i,e),pk(n,s,t||e);const o=i?Fk(n,e):void 0;return e&&bg(!1),o}function Fk(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,nk);const{setup:r}=t;if(r){Pi();const s=n.setupContext=r.length>1?jk(n):null,i=Md(n),o=Vd(r,n,0,[n.props,s]),a=Xx(o);if(Ci(),i(),(a||n.sp)&&!Wl(n)&&LE(n),a){if(o.then(Lb,Lb),e)return o.then(l=>{$b(n,l,e)}).catch(l=>{sp(l,n,0)});n.asyncDep=o}else $b(n,o,e)}else iI(n,e)}function $b(n,e,t){ht(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Qt(e)&&(n.setupState=wE(e)),iI(n,t)}let Fb;function iI(n,e,t){const r=n.type;if(!n.render){if(!e&&Fb&&!r.render){const s=r.template||kv(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Fn(Fn({isCustomElement:i,delimiters:a},o),l);r.render=Fb(s,c)}}n.render=r.render||ws}{const s=Md(n);Pi();try{rk(n)}finally{Ci(),s()}}}const Uk={get(n,e){return dr(n,"get",""),n[e]}};function jk(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,Uk),slots:n.slots,emit:n.emit,expose:e}}function cp(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(wE(AR(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in Nu)return Nu[t](n)},has(e,t){return t in e||t in Nu}})):n.proxy}function qk(n,e=!0){return ht(n)?n.displayName||n.name:n.name||e&&n.__name}function Bk(n){return ht(n)&&"__vccOpts"in n}const $e=(n,e)=>DR(n,e,sd);function Mv(n,e,t){const r=arguments.length;return r===2?Qt(e)&&!Ye(e)?rd(e)?ze(n,null,[e]):ze(n,e):ze(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&rd(t)&&(t=[t]),ze(n,e,t))}const zk="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let _g;const Ub=typeof window<"u"&&window.trustedTypes;if(Ub)try{_g=Ub.createPolicy("vue",{createHTML:n=>n})}catch{}const oI=_g?n=>_g.createHTML(n):n=>n,Hk="http://www.w3.org/2000/svg",Wk="http://www.w3.org/1998/Math/MathML",vi=typeof document<"u"?document:null,jb=vi&&vi.createElement("template"),Kk={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?vi.createElementNS(Hk,n):e==="mathml"?vi.createElementNS(Wk,n):t?vi.createElement(n,{is:t}):vi.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>vi.createTextNode(n),createComment:n=>vi.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>vi.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{jb.innerHTML=oI(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=jb.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Zi="transition",lu="animation",id=Symbol("_vtc"),aI={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Gk=Fn({},kE,aI),Qk=n=>(n.displayName="Transition",n.props=Gk,n),Em=Qk((n,{slots:e})=>Mv(jR,Jk(n),e)),pa=(n,e=[])=>{Ye(n)?n.forEach(t=>t(...e)):n&&n(...e)},qb=n=>n?Ye(n)?n.some(e=>e.length>1):n.length>1:!1;function Jk(n){const e={};for(const U in n)U in aI||(e[U]=n[U]);if(n.css===!1)return e;const{name:t="v",type:r,duration:s,enterFromClass:i=`${t}-enter-from`,enterActiveClass:o=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=o,appearToClass:f=a,leaveFromClass:h=`${t}-leave-from`,leaveActiveClass:p=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=n,x=Yk(s),_=x&&x[0],w=x&&x[1],{onBeforeEnter:T,onEnter:N,onEnterCancelled:I,onLeave:j,onLeaveCancelled:ne,onBeforeAppear:ae=T,onAppear:V=N,onAppearCancelled:P=I}=e,S=(U,O,pt,ct)=>{U._enterCancelled=ct,ma(U,O?f:a),ma(U,O?c:o),pt&&pt()},$=(U,O)=>{U._isLeaving=!1,ma(U,h),ma(U,v),ma(U,p),O&&O()},F=U=>(O,pt)=>{const ct=U?V:N,Ct=()=>S(O,U,pt);pa(ct,[O,Ct]),Bb(()=>{ma(O,U?l:i),mi(O,U?f:a),qb(ct)||zb(O,r,_,Ct)})};return Fn(e,{onBeforeEnter(U){pa(T,[U]),mi(U,i),mi(U,o)},onBeforeAppear(U){pa(ae,[U]),mi(U,l),mi(U,c)},onEnter:F(!1),onAppear:F(!0),onLeave(U,O){U._isLeaving=!0;const pt=()=>$(U,O);mi(U,h),U._enterCancelled?(mi(U,p),Kb()):(Kb(),mi(U,p)),Bb(()=>{U._isLeaving&&(ma(U,h),mi(U,v),qb(j)||zb(U,r,w,pt))}),pa(j,[U,pt])},onEnterCancelled(U){S(U,!1,void 0,!0),pa(I,[U])},onAppearCancelled(U){S(U,!0,void 0,!0),pa(P,[U])},onLeaveCancelled(U){$(U),pa(ne,[U])}})}function Yk(n){if(n==null)return null;if(Qt(n))return[Im(n.enter),Im(n.leave)];{const e=Im(n);return[e,e]}}function Im(n){return ZC(n)}function mi(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[id]||(n[id]=new Set)).add(e)}function ma(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[id];t&&(t.delete(e),t.size||(n[id]=void 0))}function Bb(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let Xk=0;function zb(n,e,t,r){const s=n._endId=++Xk,i=()=>{s===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:o,timeout:a,propCount:l}=Zk(n,e);if(!o)return r();const c=o+"end";let f=0;const h=()=>{n.removeEventListener(c,p),i()},p=v=>{v.target===n&&++f>=l&&h()};setTimeout(()=>{f<l&&h()},a+1),n.addEventListener(c,p)}function Zk(n,e){const t=window.getComputedStyle(n),r=x=>(t[x]||"").split(", "),s=r(`${Zi}Delay`),i=r(`${Zi}Duration`),o=Hb(s,i),a=r(`${lu}Delay`),l=r(`${lu}Duration`),c=Hb(a,l);let f=null,h=0,p=0;e===Zi?o>0&&(f=Zi,h=o,p=i.length):e===lu?c>0&&(f=lu,h=c,p=l.length):(h=Math.max(o,c),f=h>0?o>c?Zi:lu:null,p=f?f===Zi?i.length:l.length:0);const v=f===Zi&&/\b(transform|all)(,|$)/.test(r(`${Zi}Property`).toString());return{type:f,timeout:h,propCount:p,hasTransform:v}}function Hb(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>Wb(t)+Wb(n[r])))}function Wb(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function Kb(){return document.body.offsetHeight}function e2(n,e,t){const r=n[id];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const _f=Symbol("_vod"),lI=Symbol("_vsh"),Tm={beforeMount(n,{value:e},{transition:t}){n[_f]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):cu(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),cu(n,!0),r.enter(n)):r.leave(n,()=>{cu(n,!1)}):cu(n,e))},beforeUnmount(n,{value:e}){cu(n,e)}};function cu(n,e){n.style.display=e?n[_f]:"none",n[lI]=!e}const t2=Symbol(""),n2=/(^|;)\s*display\s*:/;function r2(n,e,t){const r=n.style,s=Tn(t);let i=!1;if(t&&!s){if(e)if(Tn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&Qh(r,a,"")}else for(const o in e)t[o]==null&&Qh(r,o,"");for(const o in t)o==="display"&&(i=!0),Qh(r,o,t[o])}else if(s){if(e!==t){const o=r[t2];o&&(t+=";"+o),r.cssText=t,i=n2.test(t)}}else e&&n.removeAttribute("style");_f in n&&(n[_f]=i?r.display:"",n[lI]&&(r.display="none"))}const Gb=/\s*!important$/;function Qh(n,e,t){if(Ye(t))t.forEach(r=>Qh(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=s2(n,e);Gb.test(t)?n.setProperty(Fo(r),t.replace(Gb,""),"important"):n[r]=t}}const Qb=["Webkit","Moz","ms"],Sm={};function s2(n,e){const t=Sm[e];if(t)return t;let r=is(e);if(r!=="filter"&&r in n)return Sm[e]=r;r=ep(r);for(let s=0;s<Qb.length;s++){const i=Qb[s]+r;if(i in n)return Sm[e]=i}return e}const Jb="http://www.w3.org/1999/xlink";function Yb(n,e,t,r,s,i=iR(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Jb,e.slice(6,e.length)):n.setAttributeNS(Jb,e,t):t==null||i&&!tE(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Ts(t)?String(t):t)}function Xb(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?oI(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=tE(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function uo(n,e,t,r){n.addEventListener(e,t,r)}function i2(n,e,t,r){n.removeEventListener(e,t,r)}const Zb=Symbol("_vei");function o2(n,e,t,r,s=null){const i=n[Zb]||(n[Zb]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=a2(e);if(r){const c=i[e]=u2(r,s);uo(n,a,c,l)}else o&&(i2(n,a,o,l),i[e]=void 0)}}const e_=/(?:Once|Passive|Capture)$/;function a2(n){let e;if(e_.test(n)){e={};let r;for(;r=n.match(e_);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Fo(n.slice(2)),e]}let Am=0;const l2=Promise.resolve(),c2=()=>Am||(l2.then(()=>Am=0),Am=Date.now());function u2(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Ss(d2(r,t.value),e,5,[r])};return t.value=n,t.attached=c2(),t}function d2(n,e){if(Ye(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const t_=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,h2=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?e2(n,r,o):e==="style"?r2(n,t,r):Xf(e)?yv(e)||o2(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):f2(n,e,r,o))?(Xb(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Yb(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Tn(r))?Xb(n,is(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Yb(n,e,r,o))};function f2(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&t_(e)&&ht(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return t_(e)&&Tn(t)?!1:e in n}const tc=n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ye(e)?t=>Bh(e,t):e};function p2(n){n.target.composing=!0}function n_(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ti=Symbol("_assign"),Ot={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Ti]=tc(s);const i=r||s.props&&s.props.type==="number";uo(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=ff(a)),n[Ti](a)}),t&&uo(n,"change",()=>{n.value=n.value.trim()}),e||(uo(n,"compositionstart",p2),uo(n,"compositionend",n_),uo(n,"change",n_))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Ti]=tc(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?ff(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},ts={deep:!0,created(n,e,t){n[Ti]=tc(t),uo(n,"change",()=>{const r=n._modelValue,s=od(n),i=n.checked,o=n[Ti];if(Ye(r)){const a=wv(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(Ic(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(cI(n,i))})},mounted:r_,beforeUpdate(n,e,t){n[Ti]=tc(t),r_(n,e,t)}};function r_(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(Ye(e))s=wv(e,r.props.value)>-1;else if(Ic(e))s=e.has(r.props.value);else{if(e===t)return;s=Od(e,cI(n,!0))}n.checked!==s&&(n.checked=s)}const m2={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=Ic(e);uo(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?ff(od(o)):od(o));n[Ti](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,kt(()=>{n._assigning=!1})}),n[Ti]=tc(r)},mounted(n,{value:e}){s_(n,e)},beforeUpdate(n,e,t){n[Ti]=tc(t)},updated(n,{value:e}){n._assigning||s_(n,e)}};function s_(n,e){const t=n.multiple,r=Ye(e);if(!(t&&!r&&!Ic(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=od(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=wv(e,a)>-1}else o.selected=e.has(a);else if(Od(od(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function od(n){return"_value"in n?n._value:n.value}function cI(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const g2=["ctrl","shift","alt","meta"],v2={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>g2.some(t=>n[`${t}Key`]&&!e.includes(t))},At=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=v2[e[o]];if(a&&a(s,e))return}return n(s,...i)})},y2={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},tr=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Fo(s.key);if(e.some(o=>o===i||y2[o]===i))return n(s)})},b2=Fn({patchProp:h2},Kk);let i_;function _2(){return i_||(i_=gk(b2))}const w2=(...n)=>{const e=_2().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=E2(r);if(!s)return;const i=e._component;!ht(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,x2(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function x2(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function E2(n){return Tn(n)?document.querySelector(n):n}const Pm="/icons/icon-48x48.png";/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Ol=typeof document<"u";function uI(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function I2(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&uI(n.default)}const Mt=Object.assign;function Cm(n,e){const t={};for(const r in e){const s=e[r];t[r]=As(s)?s.map(n):n(s)}return t}const Vu=()=>{},As=Array.isArray,dI=/#/g,T2=/&/g,S2=/\//g,A2=/=/g,P2=/\?/g,hI=/\+/g,C2=/%5B/g,R2=/%5D/g,fI=/%5E/g,k2=/%60/g,pI=/%7B/g,D2=/%7C/g,mI=/%7D/g,N2=/%20/g;function Lv(n){return encodeURI(""+n).replace(D2,"|").replace(C2,"[").replace(R2,"]")}function O2(n){return Lv(n).replace(pI,"{").replace(mI,"}").replace(fI,"^")}function wg(n){return Lv(n).replace(hI,"%2B").replace(N2,"+").replace(dI,"%23").replace(T2,"%26").replace(k2,"`").replace(pI,"{").replace(mI,"}").replace(fI,"^")}function V2(n){return wg(n).replace(A2,"%3D")}function M2(n){return Lv(n).replace(dI,"%23").replace(P2,"%3F")}function L2(n){return n==null?"":M2(n).replace(S2,"%2F")}function ad(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const $2=/\/$/,F2=n=>n.replace($2,"");function Rm(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=B2(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:ad(o)}}function U2(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function o_(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function j2(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&nc(e.matched[r],t.matched[s])&&gI(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function nc(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function gI(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!q2(n[t],e[t]))return!1;return!0}function q2(n,e){return As(n)?a_(n,e):As(e)?a_(e,n):n===e}function a_(n,e){return As(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function B2(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const eo={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var ld;(function(n){n.pop="pop",n.push="push"})(ld||(ld={}));var Mu;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Mu||(Mu={}));function z2(n){if(!n)if(Ol){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),F2(n)}const H2=/^[^#]+#/;function W2(n,e){return n.replace(H2,"#")+e}function K2(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const up=()=>({left:window.scrollX,top:window.scrollY});function G2(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=K2(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function l_(n,e){return(history.state?history.state.position-e:-1)+n}const xg=new Map;function Q2(n,e){xg.set(n,e)}function J2(n){const e=xg.get(n);return xg.delete(n),e}let Y2=()=>location.protocol+"//"+location.host;function vI(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),o_(l,"")}return o_(t,n)+r+s}function X2(n,e,t,r){let s=[],i=[],o=null;const a=({state:p})=>{const v=vI(n,location),x=t.value,_=e.value;let w=0;if(p){if(t.value=v,e.value=p,o&&o===x){o=null;return}w=_?p.position-_.position:0}else r(v);s.forEach(T=>{T(t.value,x,{delta:w,type:ld.pop,direction:w?w>0?Mu.forward:Mu.back:Mu.unknown})})};function l(){o=t.value}function c(p){s.push(p);const v=()=>{const x=s.indexOf(p);x>-1&&s.splice(x,1)};return i.push(v),v}function f(){const{history:p}=window;p.state&&p.replaceState(Mt({},p.state,{scroll:up()}),"")}function h(){for(const p of i)p();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",f)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",f,{passive:!0}),{pauseListeners:l,listen:c,destroy:h}}function c_(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?up():null}}function Z2(n){const{history:e,location:t}=window,r={value:vI(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,f){const h=n.indexOf("#"),p=h>-1?(t.host&&document.querySelector("base")?n:n.slice(h))+l:Y2()+n+l;try{e[f?"replaceState":"pushState"](c,"",p),s.value=c}catch(v){console.error(v),t[f?"replace":"assign"](p)}}function o(l,c){const f=Mt({},e.state,c_(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,f,!0),r.value=l}function a(l,c){const f=Mt({},s.value,e.state,{forward:l,scroll:up()});i(f.current,f,!0);const h=Mt({},c_(r.value,l,null),{position:f.position+1},c);i(l,h,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function eD(n){n=z2(n);const e=Z2(n),t=X2(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=Mt({location:"",base:n,go:r,createHref:W2.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function tD(n){return typeof n=="string"||n&&typeof n=="object"}function yI(n){return typeof n=="string"||typeof n=="symbol"}const bI=Symbol("");var u_;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(u_||(u_={}));function rc(n,e){return Mt(new Error,{type:n,[bI]:!0},e)}function gi(n,e){return n instanceof Error&&bI in n&&(e==null||!!(n.type&e))}const d_="[^/]+?",nD={sensitive:!1,strict:!1,start:!0,end:!0},rD=/[.+*?^${}()[\]/\\]/g;function sD(n,e){const t=Mt({},nD,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const f=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let h=0;h<c.length;h++){const p=c[h];let v=40+(t.sensitive?.25:0);if(p.type===0)h||(s+="/"),s+=p.value.replace(rD,"\\$&"),v+=40;else if(p.type===1){const{value:x,repeatable:_,optional:w,regexp:T}=p;i.push({name:x,repeatable:_,optional:w});const N=T||d_;if(N!==d_){v+=10;try{new RegExp(`(${N})`)}catch(j){throw new Error(`Invalid custom RegExp for param "${x}" (${N}): `+j.message)}}let I=_?`((?:${N})(?:/(?:${N}))*)`:`(${N})`;h||(I=w&&c.length<2?`(?:/${I})`:"/"+I),w&&(I+="?"),s+=I,v+=20,w&&(v+=-8),_&&(v+=-20),N===".*"&&(v+=-50)}f.push(v)}r.push(f)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const f=c.match(o),h={};if(!f)return null;for(let p=1;p<f.length;p++){const v=f[p]||"",x=i[p-1];h[x.name]=v&&x.repeatable?v.split("/"):v}return h}function l(c){let f="",h=!1;for(const p of n){(!h||!f.endsWith("/"))&&(f+="/"),h=!1;for(const v of p)if(v.type===0)f+=v.value;else if(v.type===1){const{value:x,repeatable:_,optional:w}=v,T=x in c?c[x]:"";if(As(T)&&!_)throw new Error(`Provided param "${x}" is an array but it is not repeatable (* or + modifiers)`);const N=As(T)?T.join("/"):T;if(!N)if(w)p.length<2&&(f.endsWith("/")?f=f.slice(0,-1):h=!0);else throw new Error(`Missing required param "${x}"`);f+=N}}return f||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function iD(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function _I(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=iD(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(h_(r))return 1;if(h_(s))return-1}return s.length-r.length}function h_(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const oD={type:0,value:""},aD=/[a-zA-Z0-9_]/;function lD(n){if(!n)return[[]];if(n==="/")return[[oD]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(v){throw new Error(`ERR (${t})/"${c}": ${v}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",f="";function h(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:f,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function p(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&h(),o()):l===":"?(h(),t=1):p();break;case 4:p(),t=r;break;case 1:l==="("?t=2:aD.test(l)?p():(h(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?f[f.length-1]=="\\"?f=f.slice(0,-1)+l:t=3:f+=l;break;case 3:h(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,f="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),h(),o(),s}function cD(n,e,t){const r=sD(lD(n.path),t),s=Mt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function uD(n,e){const t=[],r=new Map;e=g_({strict:!1,end:!0,sensitive:!1},e);function s(h){return r.get(h)}function i(h,p,v){const x=!v,_=p_(h);_.aliasOf=v&&v.record;const w=g_(e,h),T=[_];if("alias"in h){const j=typeof h.alias=="string"?[h.alias]:h.alias;for(const ne of j)T.push(p_(Mt({},_,{components:v?v.record.components:_.components,path:ne,aliasOf:v?v.record:_})))}let N,I;for(const j of T){const{path:ne}=j;if(p&&ne[0]!=="/"){const ae=p.record.path,V=ae[ae.length-1]==="/"?"":"/";j.path=p.record.path+(ne&&V+ne)}if(N=cD(j,p,w),v?v.alias.push(N):(I=I||N,I!==N&&I.alias.push(N),x&&h.name&&!m_(N)&&o(h.name)),wI(N)&&l(N),_.children){const ae=_.children;for(let V=0;V<ae.length;V++)i(ae[V],N,v&&v.children[V])}v=v||N}return I?()=>{o(I)}:Vu}function o(h){if(yI(h)){const p=r.get(h);p&&(r.delete(h),t.splice(t.indexOf(p),1),p.children.forEach(o),p.alias.forEach(o))}else{const p=t.indexOf(h);p>-1&&(t.splice(p,1),h.record.name&&r.delete(h.record.name),h.children.forEach(o),h.alias.forEach(o))}}function a(){return t}function l(h){const p=fD(h,t);t.splice(p,0,h),h.record.name&&!m_(h)&&r.set(h.record.name,h)}function c(h,p){let v,x={},_,w;if("name"in h&&h.name){if(v=r.get(h.name),!v)throw rc(1,{location:h});w=v.record.name,x=Mt(f_(p.params,v.keys.filter(I=>!I.optional).concat(v.parent?v.parent.keys.filter(I=>I.optional):[]).map(I=>I.name)),h.params&&f_(h.params,v.keys.map(I=>I.name))),_=v.stringify(x)}else if(h.path!=null)_=h.path,v=t.find(I=>I.re.test(_)),v&&(x=v.parse(_),w=v.record.name);else{if(v=p.name?r.get(p.name):t.find(I=>I.re.test(p.path)),!v)throw rc(1,{location:h,currentLocation:p});w=v.record.name,x=Mt({},p.params,h.params),_=v.stringify(x)}const T=[];let N=v;for(;N;)T.unshift(N.record),N=N.parent;return{name:w,path:_,params:x,matched:T,meta:hD(T)}}n.forEach(h=>i(h));function f(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:f,getRoutes:a,getRecordMatcher:s}}function f_(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function p_(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:dD(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function dD(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function m_(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function hD(n){return n.reduce((e,t)=>Mt(e,t.meta),{})}function g_(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function fD(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;_I(n,e[i])<0?r=i:t=i+1}const s=pD(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function pD(n){let e=n;for(;e=e.parent;)if(wI(e)&&_I(n,e)===0)return e}function wI({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function mD(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(hI," "),o=i.indexOf("="),a=ad(o<0?i:i.slice(0,o)),l=o<0?null:ad(i.slice(o+1));if(a in e){let c=e[a];As(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function v_(n){let e="";for(let t in n){const r=n[t];if(t=V2(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(As(r)?r.map(i=>i&&wg(i)):[r&&wg(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function gD(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=As(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const vD=Symbol(""),y_=Symbol(""),dp=Symbol(""),$v=Symbol(""),Eg=Symbol("");function uu(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function lo(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=p=>{p===!1?l(rc(4,{from:t,to:e})):p instanceof Error?l(p):tD(p)?l(rc(2,{from:e,to:p})):(o&&r.enterCallbacks[s]===o&&typeof p=="function"&&o.push(p),a())},f=i(()=>n.call(r&&r.instances[s],e,t,c));let h=Promise.resolve(f);n.length<3&&(h=h.then(c)),h.catch(p=>l(p))})}function km(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(uI(l)){const f=(l.__vccOpts||l)[e];f&&i.push(lo(f,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(f=>{if(!f)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const h=I2(f)?f.default:f;o.mods[a]=f,o.components[a]=h;const v=(h.__vccOpts||h)[e];return v&&lo(v,t,r,o,a,s)()}))}}return i}function b_(n){const e=Es(dp),t=Es($v),r=$e(()=>{const l=Br(n.to);return e.resolve(l)}),s=$e(()=>{const{matched:l}=r.value,{length:c}=l,f=l[c-1],h=t.matched;if(!f||!h.length)return-1;const p=h.findIndex(nc.bind(null,f));if(p>-1)return p;const v=__(l[c-2]);return c>1&&__(f)===v&&h[h.length-1].path!==v?h.findIndex(nc.bind(null,l[c-2])):p}),i=$e(()=>s.value>-1&&xD(t.params,r.value.params)),o=$e(()=>s.value>-1&&s.value===t.matched.length-1&&gI(t.params,r.value.params));function a(l={}){if(wD(l)){const c=e[Br(n.replace)?"replace":"push"](Br(n.to)).catch(Vu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:$e(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function yD(n){return n.length===1?n[0]:n}const bD=ME({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:b_,setup(n,{slots:e}){const t=rp(b_(n)),{options:r}=Es(dp),s=$e(()=>({[w_(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[w_(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&yD(e.default(t));return n.custom?i:Mv("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),_D=bD;function wD(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function xD(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!As(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function __(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const w_=(n,e,t)=>n??e??t,ED=ME({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Es(Eg),s=$e(()=>n.route||r.value),i=Es(y_,0),o=$e(()=>{let c=Br(i);const{matched:f}=s.value;let h;for(;(h=f[c])&&!h.components;)c++;return c}),a=$e(()=>s.value.matched[o.value]);Wh(y_,$e(()=>o.value+1)),Wh(vD,a),Wh(Eg,s);const l=A();return Pt(()=>[l.value,a.value,n.name],([c,f,h],[p,v,x])=>{f&&(f.instances[h]=c,v&&v!==f&&c&&c===p&&(f.leaveGuards.size||(f.leaveGuards=v.leaveGuards),f.updateGuards.size||(f.updateGuards=v.updateGuards))),c&&f&&(!v||!nc(f,v)||!p)&&(f.enterCallbacks[h]||[]).forEach(_=>_(c))},{flush:"post"}),()=>{const c=s.value,f=n.name,h=a.value,p=h&&h.components[f];if(!p)return x_(t.default,{Component:p,route:c});const v=h.props[f],x=v?v===!0?c.params:typeof v=="function"?v(c):v:null,w=Mv(p,Mt({},x,e,{onVnodeUnmounted:T=>{T.component.isUnmounted&&(h.instances[f]=null)},ref:l}));return x_(t.default,{Component:w,route:c})||w}}});function x_(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const ID=ED;function TD(n){const e=uD(n.routes,n),t=n.parseQuery||mD,r=n.stringifyQuery||v_,s=n.history,i=uu(),o=uu(),a=uu(),l=PR(eo);let c=eo;Ol&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const f=Cm.bind(null,ue=>""+ue),h=Cm.bind(null,L2),p=Cm.bind(null,ad);function v(ue,Pe){let B,G;return yI(ue)?(B=e.getRecordMatcher(ue),G=Pe):G=ue,e.addRoute(G,B)}function x(ue){const Pe=e.getRecordMatcher(ue);Pe&&e.removeRoute(Pe)}function _(){return e.getRoutes().map(ue=>ue.record)}function w(ue){return!!e.getRecordMatcher(ue)}function T(ue,Pe){if(Pe=Mt({},Pe||l.value),typeof ue=="string"){const L=Rm(t,ue,Pe.path),H=e.resolve({path:L.path},Pe),fe=s.createHref(L.fullPath);return Mt(L,H,{params:p(H.params),hash:ad(L.hash),redirectedFrom:void 0,href:fe})}let B;if(ue.path!=null)B=Mt({},ue,{path:Rm(t,ue.path,Pe.path).path});else{const L=Mt({},ue.params);for(const H in L)L[H]==null&&delete L[H];B=Mt({},ue,{params:h(L)}),Pe.params=h(Pe.params)}const G=e.resolve(B,Pe),Ce=ue.hash||"";G.params=f(p(G.params));const Ke=U2(r,Mt({},ue,{hash:O2(Ce),path:G.path})),R=s.createHref(Ke);return Mt({fullPath:Ke,hash:Ce,query:r===v_?gD(ue.query):ue.query||{}},G,{redirectedFrom:void 0,href:R})}function N(ue){return typeof ue=="string"?Rm(t,ue,l.value.path):Mt({},ue)}function I(ue,Pe){if(c!==ue)return rc(8,{from:Pe,to:ue})}function j(ue){return V(ue)}function ne(ue){return j(Mt(N(ue),{replace:!0}))}function ae(ue){const Pe=ue.matched[ue.matched.length-1];if(Pe&&Pe.redirect){const{redirect:B}=Pe;let G=typeof B=="function"?B(ue):B;return typeof G=="string"&&(G=G.includes("?")||G.includes("#")?G=N(G):{path:G},G.params={}),Mt({query:ue.query,hash:ue.hash,params:G.path!=null?{}:ue.params},G)}}function V(ue,Pe){const B=c=T(ue),G=l.value,Ce=ue.state,Ke=ue.force,R=ue.replace===!0,L=ae(B);if(L)return V(Mt(N(L),{state:typeof L=="object"?Mt({},Ce,L.state):Ce,force:Ke,replace:R}),Pe||B);const H=B;H.redirectedFrom=Pe;let fe;return!Ke&&j2(r,G,B)&&(fe=rc(16,{to:H,from:G}),Oe(G,G,!0,!1)),(fe?Promise.resolve(fe):$(H,G)).catch(oe=>gi(oe)?gi(oe,2)?oe:ke(oe):ce(oe,H,G)).then(oe=>{if(oe){if(gi(oe,2))return V(Mt({replace:R},N(oe.to),{state:typeof oe.to=="object"?Mt({},Ce,oe.to.state):Ce,force:Ke}),Pe||H)}else oe=U(H,G,!0,R,Ce);return F(H,G,oe),oe})}function P(ue,Pe){const B=I(ue,Pe);return B?Promise.reject(B):Promise.resolve()}function S(ue){const Pe=zt.values().next().value;return Pe&&typeof Pe.runWithContext=="function"?Pe.runWithContext(ue):ue()}function $(ue,Pe){let B;const[G,Ce,Ke]=SD(ue,Pe);B=km(G.reverse(),"beforeRouteLeave",ue,Pe);for(const L of G)L.leaveGuards.forEach(H=>{B.push(lo(H,ue,Pe))});const R=P.bind(null,ue,Pe);return B.push(R),Yt(B).then(()=>{B=[];for(const L of i.list())B.push(lo(L,ue,Pe));return B.push(R),Yt(B)}).then(()=>{B=km(Ce,"beforeRouteUpdate",ue,Pe);for(const L of Ce)L.updateGuards.forEach(H=>{B.push(lo(H,ue,Pe))});return B.push(R),Yt(B)}).then(()=>{B=[];for(const L of Ke)if(L.beforeEnter)if(As(L.beforeEnter))for(const H of L.beforeEnter)B.push(lo(H,ue,Pe));else B.push(lo(L.beforeEnter,ue,Pe));return B.push(R),Yt(B)}).then(()=>(ue.matched.forEach(L=>L.enterCallbacks={}),B=km(Ke,"beforeRouteEnter",ue,Pe,S),B.push(R),Yt(B))).then(()=>{B=[];for(const L of o.list())B.push(lo(L,ue,Pe));return B.push(R),Yt(B)}).catch(L=>gi(L,8)?L:Promise.reject(L))}function F(ue,Pe,B){a.list().forEach(G=>S(()=>G(ue,Pe,B)))}function U(ue,Pe,B,G,Ce){const Ke=I(ue,Pe);if(Ke)return Ke;const R=Pe===eo,L=Ol?history.state:{};B&&(G||R?s.replace(ue.fullPath,Mt({scroll:R&&L&&L.scroll},Ce)):s.push(ue.fullPath,Ce)),l.value=ue,Oe(ue,Pe,B,R),ke()}let O;function pt(){O||(O=s.listen((ue,Pe,B)=>{if(!On.listening)return;const G=T(ue),Ce=ae(G);if(Ce){V(Mt(Ce,{replace:!0,force:!0}),G).catch(Vu);return}c=G;const Ke=l.value;Ol&&Q2(l_(Ke.fullPath,B.delta),up()),$(G,Ke).catch(R=>gi(R,12)?R:gi(R,2)?(V(Mt(N(R.to),{force:!0}),G).then(L=>{gi(L,20)&&!B.delta&&B.type===ld.pop&&s.go(-1,!1)}).catch(Vu),Promise.reject()):(B.delta&&s.go(-B.delta,!1),ce(R,G,Ke))).then(R=>{R=R||U(G,Ke,!1),R&&(B.delta&&!gi(R,8)?s.go(-B.delta,!1):B.type===ld.pop&&gi(R,20)&&s.go(-1,!1)),F(G,Ke,R)}).catch(Vu)}))}let ct=uu(),Ct=uu(),Ze;function ce(ue,Pe,B){ke(ue);const G=Ct.list();return G.length?G.forEach(Ce=>Ce(ue,Pe,B)):console.error(ue),Promise.reject(ue)}function z(){return Ze&&l.value!==eo?Promise.resolve():new Promise((ue,Pe)=>{ct.add([ue,Pe])})}function ke(ue){return Ze||(Ze=!ue,pt(),ct.list().forEach(([Pe,B])=>ue?B(ue):Pe()),ct.reset()),ue}function Oe(ue,Pe,B,G){const{scrollBehavior:Ce}=n;if(!Ol||!Ce)return Promise.resolve();const Ke=!B&&J2(l_(ue.fullPath,0))||(G||!B)&&history.state&&history.state.scroll||null;return kt().then(()=>Ce(ue,Pe,Ke)).then(R=>R&&G2(R)).catch(R=>ce(R,ue,Pe))}const qe=ue=>s.go(ue);let mt;const zt=new Set,On={currentRoute:l,listening:!0,addRoute:v,removeRoute:x,clearRoutes:e.clearRoutes,hasRoute:w,getRoutes:_,resolve:T,options:n,push:j,replace:ne,go:qe,back:()=>qe(-1),forward:()=>qe(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:Ct.add,isReady:z,install(ue){const Pe=this;ue.component("RouterLink",_D),ue.component("RouterView",ID),ue.config.globalProperties.$router=Pe,Object.defineProperty(ue.config.globalProperties,"$route",{enumerable:!0,get:()=>Br(l)}),Ol&&!mt&&l.value===eo&&(mt=!0,j(s.location).catch(Ce=>{}));const B={};for(const Ce in eo)Object.defineProperty(B,Ce,{get:()=>l.value[Ce],enumerable:!0});ue.provide(dp,Pe),ue.provide($v,yE(B)),ue.provide(Eg,l);const G=ue.unmount;zt.add(ue),ue.unmount=function(){zt.delete(ue),zt.size<1&&(c=eo,O&&O(),O=null,l.value=eo,mt=!1,Ze=!1),G()}}};function Yt(ue){return ue.reduce((Pe,B)=>Pe.then(()=>S(B)),Promise.resolve())}return On}function SD(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>nc(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>nc(c,l))||s.push(l))}return[t,r,s]}function Za(){return Es(dp)}function Uo(n){return Es($v)}const AD=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xI=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},PD=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},EI={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,f=i>>2,h=(i&3)<<4|a>>4;let p=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(p=64)),r.push(t[f],t[h],t[p],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(xI(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):PD(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const h=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||h==null)throw new CD;const p=i<<2|a>>4;if(r.push(p),c!==64){const v=a<<4&240|c>>2;if(r.push(v),h!==64){const x=c<<6&192|h;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class CD extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const RD=function(n){const e=xI(n);return EI.encodeByteArray(e,!0)},wf=function(n){return RD(n).replace(/\./g,"")},II=function(n){try{return EI.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TI(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kD=()=>TI().__FIREBASE_DEFAULTS__,DD=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ND=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&II(n[1]);return e&&JSON.parse(e)},hp=()=>{try{return AD()||kD()||DD()||ND()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},SI=n=>{var e,t;return(t=(e=hp())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Fv=n=>{const e=SI(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},AI=()=>{var n;return(n=hp())==null?void 0:n.config},PI=n=>{var e;return(e=hp())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ld(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CI(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n},a="";return[wf(JSON.stringify(t)),wf(JSON.stringify(o)),a].join(".")}const Lu={};function VD(){const n={prod:[],emulator:[]};for(const e of Object.keys(Lu))Lu[e]?n.emulator.push(e):n.prod.push(e);return n}function MD(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let E_=!1;function fp(n,e){if(typeof window>"u"||typeof document>"u"||!si(window.location.host)||Lu[n]===e||Lu[n]||E_)return;Lu[n]=e;function t(p){return`__firebase__banner__${p}`}const r="__firebase__banner",i=VD().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,v){p.setAttribute("width","24"),p.setAttribute("id",v),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function c(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{E_=!0,o()},p}function f(p,v){p.setAttribute("id",v),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function h(){const p=MD(r),v=t("text"),x=document.getElementById(v)||document.createElement("span"),_=t("learnmore"),w=document.getElementById(_)||document.createElement("a"),T=t("preprendIcon"),N=document.getElementById(T)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const I=p.element;a(I),f(w,_);const j=c();l(N,T),I.append(N,x,w,j),document.body.appendChild(I)}i?(x.innerText="Preview backend disconnected.",N.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(N.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function LD(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qn())}function RI(){var e;const n=(e=hp())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function $D(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function FD(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function UD(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jD(){const n=qn();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function kI(){return!RI()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function DI(){return!RI()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Uv(){try{return typeof indexedDB=="object"}catch{return!1}}function NI(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(t){e(t)}})}function qD(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BD="FirebaseError";class Cs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=BD,Object.setPrototypeOf(this,Cs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,el.prototype.create)}}class el{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?zD(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Cs(s,a,r)}}function zD(n,e){return n.replace(HD,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const HD=/\{\$([^}]+)}/g;function WD(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ps(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(I_(i)&&I_(o)){if(!Ps(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function I_(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tc(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function wu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function xu(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function KD(n,e){const t=new GD(n,e);return t.subscribe.bind(t)}class GD{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");QD(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Dm),s.error===void 0&&(s.error=Dm),s.complete===void 0&&(s.complete=Dm);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function QD(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Dm(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Me(n){return n&&n._delegate?n._delegate:n}class Qr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ya="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new OD;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(XD(e))try{this.getOrInitializeService({instanceIdentifier:ya})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ya){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ya){return this.instances.has(e)}getOptions(e=ya){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:YD(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ya){return this.component?this.component.multipleInstances?e:ya:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function YD(n){return n===ya?void 0:n}function XD(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new JD(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _t;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(_t||(_t={}));const eN={debug:_t.DEBUG,verbose:_t.VERBOSE,info:_t.INFO,warn:_t.WARN,error:_t.ERROR,silent:_t.SILENT},tN=_t.INFO,nN={[_t.DEBUG]:"log",[_t.VERBOSE]:"log",[_t.INFO]:"info",[_t.WARN]:"warn",[_t.ERROR]:"error"},rN=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=nN[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class jv{constructor(e){this.name=e,this._logLevel=tN,this._logHandler=rN,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _t))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?eN[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_t.DEBUG,...e),this._logHandler(this,_t.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_t.VERBOSE,...e),this._logHandler(this,_t.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_t.INFO,...e),this._logHandler(this,_t.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_t.WARN,...e),this._logHandler(this,_t.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_t.ERROR,...e),this._logHandler(this,_t.ERROR,...e)}}const sN=(n,e)=>e.some(t=>n instanceof t);let T_,S_;function iN(){return T_||(T_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function oN(){return S_||(S_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const OI=new WeakMap,Ig=new WeakMap,VI=new WeakMap,Nm=new WeakMap,qv=new WeakMap;function aN(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Si(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&OI.set(t,n)}).catch(()=>{}),qv.set(e,n),e}function lN(n){if(Ig.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Ig.set(n,e)}let Tg={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Ig.get(n);if(e==="objectStoreNames")return n.objectStoreNames||VI.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Si(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function cN(n){Tg=n(Tg)}function uN(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Om(this),e,...t);return VI.set(r,e.sort?e.sort():[e]),Si(r)}:oN().includes(n)?function(...e){return n.apply(Om(this),e),Si(OI.get(this))}:function(...e){return Si(n.apply(Om(this),e))}}function dN(n){return typeof n=="function"?uN(n):(n instanceof IDBTransaction&&lN(n),sN(n,iN())?new Proxy(n,Tg):n)}function Si(n){if(n instanceof IDBRequest)return aN(n);if(Nm.has(n))return Nm.get(n);const e=dN(n);return e!==n&&(Nm.set(n,e),qv.set(e,n)),e}const Om=n=>qv.get(n);function pp(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Si(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Si(o.result),l.oldVersion,l.newVersion,Si(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Vm(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Si(t).then(()=>{})}const hN=["get","getKey","getAll","getAllKeys","count"],fN=["put","add","delete","clear"],Mm=new Map;function A_(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Mm.get(e))return Mm.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=fN.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||hN.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Mm.set(e,i),i}cN(n=>({...n,get:(e,t,r)=>A_(e,t)||n.get(e,t,r),has:(e,t)=>!!A_(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pN{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(mN(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function mN(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Sg="@firebase/app",P_="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ri=new jv("@firebase/app"),gN="@firebase/app-compat",vN="@firebase/analytics-compat",yN="@firebase/analytics",bN="@firebase/app-check-compat",_N="@firebase/app-check",wN="@firebase/auth",xN="@firebase/auth-compat",EN="@firebase/database",IN="@firebase/data-connect",TN="@firebase/database-compat",SN="@firebase/functions",AN="@firebase/functions-compat",PN="@firebase/installations",CN="@firebase/installations-compat",RN="@firebase/messaging",kN="@firebase/messaging-compat",DN="@firebase/performance",NN="@firebase/performance-compat",ON="@firebase/remote-config",VN="@firebase/remote-config-compat",MN="@firebase/storage",LN="@firebase/storage-compat",$N="@firebase/firestore",FN="@firebase/ai",UN="@firebase/firestore-compat",jN="firebase",qN="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xf="[DEFAULT]",BN={[Sg]:"fire-core",[gN]:"fire-core-compat",[yN]:"fire-analytics",[vN]:"fire-analytics-compat",[_N]:"fire-app-check",[bN]:"fire-app-check-compat",[wN]:"fire-auth",[xN]:"fire-auth-compat",[EN]:"fire-rtdb",[IN]:"fire-data-connect",[TN]:"fire-rtdb-compat",[SN]:"fire-fn",[AN]:"fire-fn-compat",[PN]:"fire-iid",[CN]:"fire-iid-compat",[RN]:"fire-fcm",[kN]:"fire-fcm-compat",[DN]:"fire-perf",[NN]:"fire-perf-compat",[ON]:"fire-rc",[VN]:"fire-rc-compat",[MN]:"fire-gcs",[LN]:"fire-gcs-compat",[$N]:"fire-fst",[UN]:"fire-fst-compat",[FN]:"fire-vertex","fire-js":"fire-js",[jN]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ef=new Map,zN=new Map,Ag=new Map;function C_(n,e){try{n.container.addComponent(e)}catch(t){Ri.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function os(n){const e=n.name;if(Ag.has(e))return Ri.debug(`There were multiple attempts to register component ${e}.`),!1;Ag.set(e,n);for(const t of Ef.values())C_(t,n);for(const t of zN.values())C_(t,n);return!0}function ii(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function HN(n,e,t=xf){ii(n,e).clearInstance(t)}function sn(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WN={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Io=new el("app","Firebase",WN);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KN{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Qr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Io.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl=qN;function MI(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:xf,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw Io.create("bad-app-name",{appName:String(s)});if(t||(t=AI()),!t)throw Io.create("no-options");const i=Ef.get(s);if(i){if(Ps(t,i.options)&&Ps(r,i.config))return i;throw Io.create("duplicate-app",{appName:s})}const o=new ZD(s);for(const l of Ag.values())o.addComponent(l);const a=new KN(t,r,o);return Ef.set(s,a),a}function nl(n=xf){const e=Ef.get(n);if(!e&&n===xf&&AI())return MI();if(!e)throw Io.create("no-app",{appName:n});return e}function pr(n,e,t){let r=BN[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ri.warn(o.join(" "));return}os(new Qr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GN="firebase-heartbeat-database",QN=1,cd="firebase-heartbeat-store";let Lm=null;function LI(){return Lm||(Lm=pp(GN,QN,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(cd)}catch(t){console.warn(t)}}}}).catch(n=>{throw Io.create("idb-open",{originalErrorMessage:n.message})})),Lm}async function JN(n){try{const t=(await LI()).transaction(cd),r=await t.objectStore(cd).get($I(n));return await t.done,r}catch(e){if(e instanceof Cs)Ri.warn(e.message);else{const t=Io.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ri.warn(t.message)}}}async function R_(n,e){try{const r=(await LI()).transaction(cd,"readwrite");await r.objectStore(cd).put(e,$I(n)),await r.done}catch(t){if(t instanceof Cs)Ri.warn(t.message);else{const r=Io.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ri.warn(r.message)}}}function $I(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YN=1024,XN=30;class ZN{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tO(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=k_();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>XN){const o=nO(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ri.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=k_(),{heartbeatsToSend:r,unsentEntries:s}=eO(this._heartbeatsCache.heartbeats),i=wf(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Ri.warn(t),""}}}function k_(){return new Date().toISOString().substring(0,10)}function eO(n,e=YN){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),D_(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),D_(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class tO{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Uv()?NI().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await JN(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return R_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return R_(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function D_(n){return wf(JSON.stringify({version:2,heartbeats:n})).length}function nO(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rO(n){os(new Qr("platform-logger",e=>new pN(e),"PRIVATE")),os(new Qr("heartbeat",e=>new ZN(e),"PRIVATE")),pr(Sg,P_,n),pr(Sg,P_,"esm2020"),pr("fire-js","")}rO("");const FI="@firebase/installations",Bv="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UI=1e4,jI=`w:${Bv}`,qI="FIS_v2",sO="https://firebaseinstallations.googleapis.com/v1",iO=60*60*1e3,oO="installations",aO="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lO={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Fa=new el(oO,aO,lO);function BI(n){return n instanceof Cs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zI({projectId:n}){return`${sO}/projects/${n}/installations`}function HI(n){return{token:n.token,requestStatus:2,expiresIn:uO(n.expiresIn),creationTime:Date.now()}}async function WI(n,e){const r=(await e.json()).error;return Fa.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function KI({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function cO(n,{refreshToken:e}){const t=KI(n);return t.append("Authorization",dO(e)),t}async function GI(n){const e=await n();return e.status>=500&&e.status<600?n():e}function uO(n){return Number(n.replace("s","000"))}function dO(n){return`${qI} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hO({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=zI(n),s=KI(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:qI,appId:n.appId,sdkVersion:jI},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await GI(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:HI(c.authToken)}}else throw await WI("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QI(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fO(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pO=/^[cdef][\w-]{21}$/,Pg="";function mO(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=gO(n);return pO.test(t)?t:Pg}catch{return Pg}}function gO(n){return fO(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mp(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JI=new Map;function YI(n,e){const t=mp(n);XI(t,e),vO(t,e)}function XI(n,e){const t=JI.get(n);if(t)for(const r of t)r(e)}function vO(n,e){const t=yO();t&&t.postMessage({key:n,fid:e}),bO()}let Pa=null;function yO(){return!Pa&&"BroadcastChannel"in self&&(Pa=new BroadcastChannel("[Firebase] FID Change"),Pa.onmessage=n=>{XI(n.data.key,n.data.fid)}),Pa}function bO(){JI.size===0&&Pa&&(Pa.close(),Pa=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O="firebase-installations-database",wO=1,Ua="firebase-installations-store";let $m=null;function zv(){return $m||($m=pp(_O,wO,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ua)}}})),$m}async function If(n,e){const t=mp(n),s=(await zv()).transaction(Ua,"readwrite"),i=s.objectStore(Ua),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&YI(n,e.fid),e}async function ZI(n){const e=mp(n),r=(await zv()).transaction(Ua,"readwrite");await r.objectStore(Ua).delete(e),await r.done}async function gp(n,e){const t=mp(n),s=(await zv()).transaction(Ua,"readwrite"),i=s.objectStore(Ua),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&YI(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hv(n){let e;const t=await gp(n.appConfig,r=>{const s=xO(r),i=EO(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Pg?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function xO(n){const e=n||{fid:mO(),registrationStatus:0};return eT(e)}function EO(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Fa.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=IO(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:TO(n)}:{installationEntry:e}}async function IO(n,e){try{const t=await hO(n,e);return If(n.appConfig,t)}catch(t){throw BI(t)&&t.customData.serverCode===409?await ZI(n.appConfig):await If(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function TO(n){let e=await N_(n.appConfig);for(;e.registrationStatus===1;)await QI(100),e=await N_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Hv(n);return r||t}return e}function N_(n){return gp(n,e=>{if(!e)throw Fa.create("installation-not-found");return eT(e)})}function eT(n){return SO(n)?{fid:n.fid,registrationStatus:0}:n}function SO(n){return n.registrationStatus===1&&n.registrationTime+UI<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AO({appConfig:n,heartbeatServiceProvider:e},t){const r=PO(n,t),s=cO(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:jI,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await GI(()=>fetch(r,a));if(l.ok){const c=await l.json();return HI(c)}else throw await WI("Generate Auth Token",l)}function PO(n,{fid:e}){return`${zI(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wv(n,e=!1){let t;const r=await gp(n.appConfig,i=>{if(!tT(i))throw Fa.create("not-registered");const o=i.authToken;if(!e&&kO(o))return i;if(o.requestStatus===1)return t=CO(n,e),i;{if(!navigator.onLine)throw Fa.create("app-offline");const a=NO(i);return t=RO(n,a),a}});return t?await t:r.authToken}async function CO(n,e){let t=await O_(n.appConfig);for(;t.authToken.requestStatus===1;)await QI(100),t=await O_(n.appConfig);const r=t.authToken;return r.requestStatus===0?Wv(n,e):r}function O_(n){return gp(n,e=>{if(!tT(e))throw Fa.create("not-registered");const t=e.authToken;return OO(t)?{...e,authToken:{requestStatus:0}}:e})}async function RO(n,e){try{const t=await AO(n,e),r={...e,authToken:t};return await If(n.appConfig,r),t}catch(t){if(BI(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await ZI(n.appConfig);else{const r={...e,authToken:{requestStatus:0}};await If(n.appConfig,r)}throw t}}function tT(n){return n!==void 0&&n.registrationStatus===2}function kO(n){return n.requestStatus===2&&!DO(n)}function DO(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+iO}function NO(n){const e={requestStatus:1,requestTime:Date.now()};return{...n,authToken:e}}function OO(n){return n.requestStatus===1&&n.requestTime+UI<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VO(n){const e=n,{installationEntry:t,registrationPromise:r}=await Hv(e);return r?r.catch(console.error):Wv(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MO(n,e=!1){const t=n;return await LO(t),(await Wv(t,e)).token}async function LO(n){const{registrationPromise:e}=await Hv(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $O(n){if(!n||!n.options)throw Fm("App Configuration");if(!n.name)throw Fm("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Fm(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Fm(n){return Fa.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nT="installations",FO="installations-internal",UO=n=>{const e=n.getProvider("app").getImmediate(),t=$O(e),r=ii(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},jO=n=>{const e=n.getProvider("app").getImmediate(),t=ii(e,nT).getImmediate();return{getId:()=>VO(t),getToken:s=>MO(t,s)}};function qO(){os(new Qr(nT,UO,"PUBLIC")),os(new Qr(FO,jO,"PRIVATE"))}qO();pr(FI,Bv);pr(FI,Bv,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BO="/firebase-messaging-sw.js",zO="/firebase-cloud-messaging-push-scope",rT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",HO="https://fcmregistrations.googleapis.com/v1",sT="google.c.a.c_id",WO="google.c.a.c_l",KO="google.c.a.ts",GO="google.c.a.e",V_=1e4;var M_;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(M_||(M_={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var ud;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(ud||(ud={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yi(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function QO(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Um="fcm_token_details_db",JO=5,L_="fcm_token_object_Store";async function YO(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(Um))return null;let e=null;return(await pp(Um,JO,{upgrade:async(r,s,i,o)=>{if(s<2||!r.objectStoreNames.contains(L_))return;const a=o.objectStore(L_),l=await a.index("fcmSenderId").get(n);if(await a.clear(),!!l){if(s===2){const c=l;if(!c.auth||!c.p256dh||!c.endpoint)return;e={token:c.fcmToken,createTime:c.createTime??Date.now(),subscriptionOptions:{auth:c.auth,p256dh:c.p256dh,endpoint:c.endpoint,swScope:c.swScope,vapidKey:typeof c.vapidKey=="string"?c.vapidKey:yi(c.vapidKey)}}}else if(s===3){const c=l;e={token:c.fcmToken,createTime:c.createTime,subscriptionOptions:{auth:yi(c.auth),p256dh:yi(c.p256dh),endpoint:c.endpoint,swScope:c.swScope,vapidKey:yi(c.vapidKey)}}}else if(s===4){const c=l;e={token:c.fcmToken,createTime:c.createTime,subscriptionOptions:{auth:yi(c.auth),p256dh:yi(c.p256dh),endpoint:c.endpoint,swScope:c.swScope,vapidKey:yi(c.vapidKey)}}}}}})).close(),await Vm(Um),await Vm("fcm_vapid_details_db"),await Vm("undefined"),XO(e)?e:null}function XO(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZO="firebase-messaging-database",eV=1,dd="firebase-messaging-store";let jm=null;function iT(){return jm||(jm=pp(ZO,eV,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(dd)}}})),jm}async function tV(n){const e=oT(n),r=await(await iT()).transaction(dd).objectStore(dd).get(e);if(r)return r;{const s=await YO(n.appConfig.senderId);if(s)return await Kv(n,s),s}}async function Kv(n,e){const t=oT(n),s=(await iT()).transaction(dd,"readwrite");return await s.objectStore(dd).put(e,t),await s.done,e}function oT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nV={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},Pr=new el("messaging","Messaging",nV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rV(n,e){const t=await Qv(n),r=aT(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(Gv(n.appConfig),s)).json()}catch(o){throw Pr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw Pr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw Pr.create("token-subscribe-no-token");return i.token}async function sV(n,e){const t=await Qv(n),r=aT(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${Gv(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw Pr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw Pr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw Pr.create("token-update-no-token");return i.token}async function iV(n,e){const r={method:"DELETE",headers:await Qv(n)};try{const i=await(await fetch(`${Gv(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw Pr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw Pr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Gv({projectId:n}){return`${HO}/projects/${n}/registrations`}async function Qv({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function aT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==rT&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oV=7*24*60*60*1e3;async function aV(n){const e=await cV(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:yi(e.getKey("auth")),p256dh:yi(e.getKey("p256dh"))},r=await tV(n.firebaseDependencies);if(r){if(uV(r.subscriptionOptions,t))return Date.now()>=r.createTime+oV?lV(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await iV(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return $_(n.firebaseDependencies,t)}else return $_(n.firebaseDependencies,t)}async function lV(n,e){try{const t=await sV(n.firebaseDependencies,e),r={...e,token:t,createTime:Date.now()};return await Kv(n.firebaseDependencies,r),t}catch(t){throw t}}async function $_(n,e){const r={token:await rV(n,e),createTime:Date.now(),subscriptionOptions:e};return await Kv(n,r),r.token}async function cV(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:QO(e)})}function uV(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F_(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return dV(e,n),hV(e,n),fV(e,n),e}function dV(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function hV(n,e){e.data&&(n.data=e.data)}function fV(n,e){var s,i,o,a;if(!e.fcmOptions&&!((s=e.notification)!=null&&s.click_action))return;n.fcmOptions={};const t=((i=e.fcmOptions)==null?void 0:i.link)??((o=e.notification)==null?void 0:o.click_action);t&&(n.fcmOptions.link=t);const r=(a=e.fcmOptions)==null?void 0:a.analytics_label;r&&(n.fcmOptions.analyticsLabel=r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pV(n){return typeof n=="object"&&!!n&&sT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mV("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function mV(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gV(n){if(!n||!n.options)throw qm("App Configuration Object");if(!n.name)throw qm("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw qm(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function qm(n){return Pr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vV{constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=gV(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yV(n){try{n.swRegistration=await navigator.serviceWorker.register(BO,{scope:zO}),n.swRegistration.update().catch(()=>{}),await bV(n.swRegistration)}catch(e){throw Pr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}async function bV(n){return new Promise((e,t)=>{const r=setTimeout(()=>t(new Error(`Service worker not registered after ${V_} ms`)),V_),s=n.installing||n.waiting;n.active?(clearTimeout(r),e()):s?s.onstatechange=i=>{var o;((o=i.target)==null?void 0:o.state)==="activated"&&(s.onstatechange=null,clearTimeout(r),e())}:(clearTimeout(r),t(new Error("No incoming service worker found.")))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _V(n,e){if(!e&&!n.swRegistration&&await yV(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw Pr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wV(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=rT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lT(n,e){if(!navigator)throw Pr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw Pr.create("permission-blocked");return await wV(n,e==null?void 0:e.vapidKey),await _V(n,e==null?void 0:e.serviceWorkerRegistration),aV(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xV(n,e,t){const r=EV(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[sT],message_name:t[WO],message_time:t[KO],message_device_time:Math.floor(Date.now()/1e3)})}function EV(n){switch(n){case ud.NOTIFICATION_CLICKED:return"notification_open";case ud.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IV(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===ud.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(F_(t)):n.onMessageHandler.next(F_(t)));const r=t.data;pV(r)&&r[GO]==="1"&&await xV(n,t.messageType,r)}const U_="@firebase/messaging",j_="0.12.23";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TV=n=>{const e=new vV(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>IV(e,t)),e},SV=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>lT(e,r)}};function AV(){os(new Qr("messaging",TV,"PUBLIC")),os(new Qr("messaging-internal",SV,"PRIVATE")),pr(U_,j_),pr(U_,j_,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cT(){try{await NI()}catch{return!1}return typeof window<"u"&&Uv()&&qD()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jv(n=nl()){return cT().then(e=>{if(!e)throw Pr.create("unsupported-browser")},e=>{throw Pr.create("indexed-db-unsupported")}),ii(Me(n),"messaging").getImmediate()}async function uT(n,e){return n=Me(n),lT(n,e)}AV();var PV="firebase",CV="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pr(PV,CV,"app");var q_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var To,dT;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(V,P){function S(){}S.prototype=P.prototype,V.D=P.prototype,V.prototype=new S,V.prototype.constructor=V,V.C=function($,F,U){for(var O=Array(arguments.length-2),pt=2;pt<arguments.length;pt++)O[pt-2]=arguments[pt];return P.prototype[F].apply($,O)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(V,P,S){S||(S=0);var $=Array(16);if(typeof P=="string")for(var F=0;16>F;++F)$[F]=P.charCodeAt(S++)|P.charCodeAt(S++)<<8|P.charCodeAt(S++)<<16|P.charCodeAt(S++)<<24;else for(F=0;16>F;++F)$[F]=P[S++]|P[S++]<<8|P[S++]<<16|P[S++]<<24;P=V.g[0],S=V.g[1],F=V.g[2];var U=V.g[3],O=P+(U^S&(F^U))+$[0]+3614090360&4294967295;P=S+(O<<7&4294967295|O>>>25),O=U+(F^P&(S^F))+$[1]+3905402710&4294967295,U=P+(O<<12&4294967295|O>>>20),O=F+(S^U&(P^S))+$[2]+606105819&4294967295,F=U+(O<<17&4294967295|O>>>15),O=S+(P^F&(U^P))+$[3]+3250441966&4294967295,S=F+(O<<22&4294967295|O>>>10),O=P+(U^S&(F^U))+$[4]+4118548399&4294967295,P=S+(O<<7&4294967295|O>>>25),O=U+(F^P&(S^F))+$[5]+1200080426&4294967295,U=P+(O<<12&4294967295|O>>>20),O=F+(S^U&(P^S))+$[6]+2821735955&4294967295,F=U+(O<<17&4294967295|O>>>15),O=S+(P^F&(U^P))+$[7]+4249261313&4294967295,S=F+(O<<22&4294967295|O>>>10),O=P+(U^S&(F^U))+$[8]+1770035416&4294967295,P=S+(O<<7&4294967295|O>>>25),O=U+(F^P&(S^F))+$[9]+2336552879&4294967295,U=P+(O<<12&4294967295|O>>>20),O=F+(S^U&(P^S))+$[10]+4294925233&4294967295,F=U+(O<<17&4294967295|O>>>15),O=S+(P^F&(U^P))+$[11]+2304563134&4294967295,S=F+(O<<22&4294967295|O>>>10),O=P+(U^S&(F^U))+$[12]+1804603682&4294967295,P=S+(O<<7&4294967295|O>>>25),O=U+(F^P&(S^F))+$[13]+4254626195&4294967295,U=P+(O<<12&4294967295|O>>>20),O=F+(S^U&(P^S))+$[14]+2792965006&4294967295,F=U+(O<<17&4294967295|O>>>15),O=S+(P^F&(U^P))+$[15]+1236535329&4294967295,S=F+(O<<22&4294967295|O>>>10),O=P+(F^U&(S^F))+$[1]+4129170786&4294967295,P=S+(O<<5&4294967295|O>>>27),O=U+(S^F&(P^S))+$[6]+3225465664&4294967295,U=P+(O<<9&4294967295|O>>>23),O=F+(P^S&(U^P))+$[11]+643717713&4294967295,F=U+(O<<14&4294967295|O>>>18),O=S+(U^P&(F^U))+$[0]+3921069994&4294967295,S=F+(O<<20&4294967295|O>>>12),O=P+(F^U&(S^F))+$[5]+3593408605&4294967295,P=S+(O<<5&4294967295|O>>>27),O=U+(S^F&(P^S))+$[10]+38016083&4294967295,U=P+(O<<9&4294967295|O>>>23),O=F+(P^S&(U^P))+$[15]+3634488961&4294967295,F=U+(O<<14&4294967295|O>>>18),O=S+(U^P&(F^U))+$[4]+3889429448&4294967295,S=F+(O<<20&4294967295|O>>>12),O=P+(F^U&(S^F))+$[9]+568446438&4294967295,P=S+(O<<5&4294967295|O>>>27),O=U+(S^F&(P^S))+$[14]+3275163606&4294967295,U=P+(O<<9&4294967295|O>>>23),O=F+(P^S&(U^P))+$[3]+4107603335&4294967295,F=U+(O<<14&4294967295|O>>>18),O=S+(U^P&(F^U))+$[8]+1163531501&4294967295,S=F+(O<<20&4294967295|O>>>12),O=P+(F^U&(S^F))+$[13]+2850285829&4294967295,P=S+(O<<5&4294967295|O>>>27),O=U+(S^F&(P^S))+$[2]+4243563512&4294967295,U=P+(O<<9&4294967295|O>>>23),O=F+(P^S&(U^P))+$[7]+1735328473&4294967295,F=U+(O<<14&4294967295|O>>>18),O=S+(U^P&(F^U))+$[12]+2368359562&4294967295,S=F+(O<<20&4294967295|O>>>12),O=P+(S^F^U)+$[5]+4294588738&4294967295,P=S+(O<<4&4294967295|O>>>28),O=U+(P^S^F)+$[8]+2272392833&4294967295,U=P+(O<<11&4294967295|O>>>21),O=F+(U^P^S)+$[11]+1839030562&4294967295,F=U+(O<<16&4294967295|O>>>16),O=S+(F^U^P)+$[14]+4259657740&4294967295,S=F+(O<<23&4294967295|O>>>9),O=P+(S^F^U)+$[1]+2763975236&4294967295,P=S+(O<<4&4294967295|O>>>28),O=U+(P^S^F)+$[4]+1272893353&4294967295,U=P+(O<<11&4294967295|O>>>21),O=F+(U^P^S)+$[7]+4139469664&4294967295,F=U+(O<<16&4294967295|O>>>16),O=S+(F^U^P)+$[10]+3200236656&4294967295,S=F+(O<<23&4294967295|O>>>9),O=P+(S^F^U)+$[13]+681279174&4294967295,P=S+(O<<4&4294967295|O>>>28),O=U+(P^S^F)+$[0]+3936430074&4294967295,U=P+(O<<11&4294967295|O>>>21),O=F+(U^P^S)+$[3]+3572445317&4294967295,F=U+(O<<16&4294967295|O>>>16),O=S+(F^U^P)+$[6]+76029189&4294967295,S=F+(O<<23&4294967295|O>>>9),O=P+(S^F^U)+$[9]+3654602809&4294967295,P=S+(O<<4&4294967295|O>>>28),O=U+(P^S^F)+$[12]+3873151461&4294967295,U=P+(O<<11&4294967295|O>>>21),O=F+(U^P^S)+$[15]+530742520&4294967295,F=U+(O<<16&4294967295|O>>>16),O=S+(F^U^P)+$[2]+3299628645&4294967295,S=F+(O<<23&4294967295|O>>>9),O=P+(F^(S|~U))+$[0]+4096336452&4294967295,P=S+(O<<6&4294967295|O>>>26),O=U+(S^(P|~F))+$[7]+1126891415&4294967295,U=P+(O<<10&4294967295|O>>>22),O=F+(P^(U|~S))+$[14]+2878612391&4294967295,F=U+(O<<15&4294967295|O>>>17),O=S+(U^(F|~P))+$[5]+4237533241&4294967295,S=F+(O<<21&4294967295|O>>>11),O=P+(F^(S|~U))+$[12]+1700485571&4294967295,P=S+(O<<6&4294967295|O>>>26),O=U+(S^(P|~F))+$[3]+2399980690&4294967295,U=P+(O<<10&4294967295|O>>>22),O=F+(P^(U|~S))+$[10]+4293915773&4294967295,F=U+(O<<15&4294967295|O>>>17),O=S+(U^(F|~P))+$[1]+2240044497&4294967295,S=F+(O<<21&4294967295|O>>>11),O=P+(F^(S|~U))+$[8]+1873313359&4294967295,P=S+(O<<6&4294967295|O>>>26),O=U+(S^(P|~F))+$[15]+4264355552&4294967295,U=P+(O<<10&4294967295|O>>>22),O=F+(P^(U|~S))+$[6]+2734768916&4294967295,F=U+(O<<15&4294967295|O>>>17),O=S+(U^(F|~P))+$[13]+1309151649&4294967295,S=F+(O<<21&4294967295|O>>>11),O=P+(F^(S|~U))+$[4]+4149444226&4294967295,P=S+(O<<6&4294967295|O>>>26),O=U+(S^(P|~F))+$[11]+3174756917&4294967295,U=P+(O<<10&4294967295|O>>>22),O=F+(P^(U|~S))+$[2]+718787259&4294967295,F=U+(O<<15&4294967295|O>>>17),O=S+(U^(F|~P))+$[9]+3951481745&4294967295,V.g[0]=V.g[0]+P&4294967295,V.g[1]=V.g[1]+(F+(O<<21&4294967295|O>>>11))&4294967295,V.g[2]=V.g[2]+F&4294967295,V.g[3]=V.g[3]+U&4294967295}r.prototype.u=function(V,P){P===void 0&&(P=V.length);for(var S=P-this.blockSize,$=this.B,F=this.h,U=0;U<P;){if(F==0)for(;U<=S;)s(this,V,U),U+=this.blockSize;if(typeof V=="string"){for(;U<P;)if($[F++]=V.charCodeAt(U++),F==this.blockSize){s(this,$),F=0;break}}else for(;U<P;)if($[F++]=V[U++],F==this.blockSize){s(this,$),F=0;break}}this.h=F,this.o+=P},r.prototype.v=function(){var V=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);V[0]=128;for(var P=1;P<V.length-8;++P)V[P]=0;var S=8*this.o;for(P=V.length-8;P<V.length;++P)V[P]=S&255,S/=256;for(this.u(V),V=Array(16),P=S=0;4>P;++P)for(var $=0;32>$;$+=8)V[S++]=this.g[P]>>>$&255;return V};function i(V,P){var S=a;return Object.prototype.hasOwnProperty.call(S,V)?S[V]:S[V]=P(V)}function o(V,P){this.h=P;for(var S=[],$=!0,F=V.length-1;0<=F;F--){var U=V[F]|0;$&&U==P||(S[F]=U,$=!1)}this.g=S}var a={};function l(V){return-128<=V&&128>V?i(V,function(P){return new o([P|0],0>P?-1:0)}):new o([V|0],0>V?-1:0)}function c(V){if(isNaN(V)||!isFinite(V))return h;if(0>V)return w(c(-V));for(var P=[],S=1,$=0;V>=S;$++)P[$]=V/S|0,S*=4294967296;return new o(P,0)}function f(V,P){if(V.length==0)throw Error("number format error: empty string");if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(V.charAt(0)=="-")return w(f(V.substring(1),P));if(0<=V.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=c(Math.pow(P,8)),$=h,F=0;F<V.length;F+=8){var U=Math.min(8,V.length-F),O=parseInt(V.substring(F,F+U),P);8>U?(U=c(Math.pow(P,U)),$=$.j(U).add(c(O))):($=$.j(S),$=$.add(c(O)))}return $}var h=l(0),p=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(_(this))return-w(this).m();for(var V=0,P=1,S=0;S<this.g.length;S++){var $=this.i(S);V+=(0<=$?$:4294967296+$)*P,P*=4294967296}return V},n.toString=function(V){if(V=V||10,2>V||36<V)throw Error("radix out of range: "+V);if(x(this))return"0";if(_(this))return"-"+w(this).toString(V);for(var P=c(Math.pow(V,6)),S=this,$="";;){var F=j(S,P).g;S=T(S,F.j(P));var U=((0<S.g.length?S.g[0]:S.h)>>>0).toString(V);if(S=F,x(S))return U+$;for(;6>U.length;)U="0"+U;$=U+$}},n.i=function(V){return 0>V?0:V<this.g.length?this.g[V]:this.h};function x(V){if(V.h!=0)return!1;for(var P=0;P<V.g.length;P++)if(V.g[P]!=0)return!1;return!0}function _(V){return V.h==-1}n.l=function(V){return V=T(this,V),_(V)?-1:x(V)?0:1};function w(V){for(var P=V.g.length,S=[],$=0;$<P;$++)S[$]=~V.g[$];return new o(S,~V.h).add(p)}n.abs=function(){return _(this)?w(this):this},n.add=function(V){for(var P=Math.max(this.g.length,V.g.length),S=[],$=0,F=0;F<=P;F++){var U=$+(this.i(F)&65535)+(V.i(F)&65535),O=(U>>>16)+(this.i(F)>>>16)+(V.i(F)>>>16);$=O>>>16,U&=65535,O&=65535,S[F]=O<<16|U}return new o(S,S[S.length-1]&-2147483648?-1:0)};function T(V,P){return V.add(w(P))}n.j=function(V){if(x(this)||x(V))return h;if(_(this))return _(V)?w(this).j(w(V)):w(w(this).j(V));if(_(V))return w(this.j(w(V)));if(0>this.l(v)&&0>V.l(v))return c(this.m()*V.m());for(var P=this.g.length+V.g.length,S=[],$=0;$<2*P;$++)S[$]=0;for($=0;$<this.g.length;$++)for(var F=0;F<V.g.length;F++){var U=this.i($)>>>16,O=this.i($)&65535,pt=V.i(F)>>>16,ct=V.i(F)&65535;S[2*$+2*F]+=O*ct,N(S,2*$+2*F),S[2*$+2*F+1]+=U*ct,N(S,2*$+2*F+1),S[2*$+2*F+1]+=O*pt,N(S,2*$+2*F+1),S[2*$+2*F+2]+=U*pt,N(S,2*$+2*F+2)}for($=0;$<P;$++)S[$]=S[2*$+1]<<16|S[2*$];for($=P;$<2*P;$++)S[$]=0;return new o(S,0)};function N(V,P){for(;(V[P]&65535)!=V[P];)V[P+1]+=V[P]>>>16,V[P]&=65535,P++}function I(V,P){this.g=V,this.h=P}function j(V,P){if(x(P))throw Error("division by zero");if(x(V))return new I(h,h);if(_(V))return P=j(w(V),P),new I(w(P.g),w(P.h));if(_(P))return P=j(V,w(P)),new I(w(P.g),P.h);if(30<V.g.length){if(_(V)||_(P))throw Error("slowDivide_ only works with positive integers.");for(var S=p,$=P;0>=$.l(V);)S=ne(S),$=ne($);var F=ae(S,1),U=ae($,1);for($=ae($,2),S=ae(S,2);!x($);){var O=U.add($);0>=O.l(V)&&(F=F.add(S),U=O),$=ae($,1),S=ae(S,1)}return P=T(V,F.j(P)),new I(F,P)}for(F=h;0<=V.l(P);){for(S=Math.max(1,Math.floor(V.m()/P.m())),$=Math.ceil(Math.log(S)/Math.LN2),$=48>=$?1:Math.pow(2,$-48),U=c(S),O=U.j(P);_(O)||0<O.l(V);)S-=$,U=c(S),O=U.j(P);x(U)&&(U=p),F=F.add(U),V=T(V,O)}return new I(F,V)}n.A=function(V){return j(this,V).h},n.and=function(V){for(var P=Math.max(this.g.length,V.g.length),S=[],$=0;$<P;$++)S[$]=this.i($)&V.i($);return new o(S,this.h&V.h)},n.or=function(V){for(var P=Math.max(this.g.length,V.g.length),S=[],$=0;$<P;$++)S[$]=this.i($)|V.i($);return new o(S,this.h|V.h)},n.xor=function(V){for(var P=Math.max(this.g.length,V.g.length),S=[],$=0;$<P;$++)S[$]=this.i($)^V.i($);return new o(S,this.h^V.h)};function ne(V){for(var P=V.g.length+1,S=[],$=0;$<P;$++)S[$]=V.i($)<<1|V.i($-1)>>>31;return new o(S,V.h)}function ae(V,P){var S=P>>5;P%=32;for(var $=V.g.length-S,F=[],U=0;U<$;U++)F[U]=0<P?V.i(U+S)>>>P|V.i(U+S+1)<<32-P:V.i(U+S);return new o(F,V.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,dT=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=f,To=o}).apply(typeof q_<"u"?q_:typeof self<"u"?self:typeof window<"u"?window:{});var Ph=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var hT,Eu,fT,Jh,Cg,pT,mT,gT;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,g,b){return u==Array.prototype||u==Object.prototype||(u[g]=b.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ph=="object"&&Ph];for(var g=0;g<u.length;++g){var b=u[g];if(b&&b.Math==Math)return b}throw Error("Cannot find global object")}var r=t(this);function s(u,g){if(g)e:{var b=r;u=u.split(".");for(var E=0;E<u.length-1;E++){var K=u[E];if(!(K in b))break e;b=b[K]}u=u[u.length-1],E=b[u],g=g(E),g!=E&&g!=null&&e(b,u,{configurable:!0,writable:!0,value:g})}}function i(u,g){u instanceof String&&(u+="");var b=0,E=!1,K={next:function(){if(!E&&b<u.length){var re=b++;return{value:g(re,u[re]),done:!1}}return E=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}s("Array.prototype.values",function(u){return u||function(){return i(this,function(g,b){return b})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var g=typeof u;return g=g!="object"?g:u?Array.isArray(u)?"array":g:"null",g=="array"||g=="object"&&typeof u.length=="number"}function c(u){var g=typeof u;return g=="object"&&u!=null||g=="function"}function f(u,g,b){return u.call.apply(u.bind,arguments)}function h(u,g,b){if(!u)throw Error();if(2<arguments.length){var E=Array.prototype.slice.call(arguments,2);return function(){var K=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(K,E),u.apply(g,K)}}return function(){return u.apply(g,arguments)}}function p(u,g,b){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:h,p.apply(null,arguments)}function v(u,g){var b=Array.prototype.slice.call(arguments,1);return function(){var E=b.slice();return E.push.apply(E,arguments),u.apply(this,E)}}function x(u,g){function b(){}b.prototype=g.prototype,u.aa=g.prototype,u.prototype=new b,u.prototype.constructor=u,u.Qb=function(E,K,re){for(var Ee=Array(arguments.length-2),Ut=2;Ut<arguments.length;Ut++)Ee[Ut-2]=arguments[Ut];return g.prototype[K].apply(E,Ee)}}function _(u){const g=u.length;if(0<g){const b=Array(g);for(let E=0;E<g;E++)b[E]=u[E];return b}return[]}function w(u,g){for(let b=1;b<arguments.length;b++){const E=arguments[b];if(l(E)){const K=u.length||0,re=E.length||0;u.length=K+re;for(let Ee=0;Ee<re;Ee++)u[K+Ee]=E[Ee]}else u.push(E)}}class T{constructor(g,b){this.i=g,this.j=b,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function N(u){return/^[\s\xa0]*$/.test(u)}function I(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function j(u){return j[" "](u),u}j[" "]=function(){};var ne=I().indexOf("Gecko")!=-1&&!(I().toLowerCase().indexOf("webkit")!=-1&&I().indexOf("Edge")==-1)&&!(I().indexOf("Trident")!=-1||I().indexOf("MSIE")!=-1)&&I().indexOf("Edge")==-1;function ae(u,g,b){for(const E in u)g.call(b,u[E],E,u)}function V(u,g){for(const b in u)g.call(void 0,u[b],b,u)}function P(u){const g={};for(const b in u)g[b]=u[b];return g}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(u,g){let b,E;for(let K=1;K<arguments.length;K++){E=arguments[K];for(b in E)u[b]=E[b];for(let re=0;re<S.length;re++)b=S[re],Object.prototype.hasOwnProperty.call(E,b)&&(u[b]=E[b])}}function F(u){var g=1;u=u.split(":");const b=[];for(;0<g&&u.length;)b.push(u.shift()),g--;return u.length&&b.push(u.join(":")),b}function U(u){a.setTimeout(()=>{throw u},0)}function O(){var u=z;let g=null;return u.g&&(g=u.g,u.g=u.g.next,u.g||(u.h=null),g.next=null),g}class pt{constructor(){this.h=this.g=null}add(g,b){const E=ct.get();E.set(g,b),this.h?this.h.next=E:this.g=E,this.h=E}}var ct=new T(()=>new Ct,u=>u.reset());class Ct{constructor(){this.next=this.g=this.h=null}set(g,b){this.h=g,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let Ze,ce=!1,z=new pt,ke=()=>{const u=a.Promise.resolve(void 0);Ze=()=>{u.then(Oe)}};var Oe=()=>{for(var u;u=O();){try{u.h.call(u.g)}catch(b){U(b)}var g=ct;g.j(u),100>g.h&&(g.h++,u.next=g.g,g.g=u)}ce=!1};function qe(){this.s=this.s,this.C=this.C}qe.prototype.s=!1,qe.prototype.ma=function(){this.s||(this.s=!0,this.N())},qe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function mt(u,g){this.type=u,this.g=this.target=g,this.defaultPrevented=!1}mt.prototype.h=function(){this.defaultPrevented=!0};var zt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,g=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const b=()=>{};a.addEventListener("test",b,g),a.removeEventListener("test",b,g)}catch{}return u}();function On(u,g){if(mt.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var b=this.type=u.type,E=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=g,g=u.relatedTarget){if(ne){e:{try{j(g.nodeName);var K=!0;break e}catch{}K=!1}K||(g=null)}}else b=="mouseover"?g=u.fromElement:b=="mouseout"&&(g=u.toElement);this.relatedTarget=g,E?(this.clientX=E.clientX!==void 0?E.clientX:E.pageX,this.clientY=E.clientY!==void 0?E.clientY:E.pageY,this.screenX=E.screenX||0,this.screenY=E.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:Yt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&On.aa.h.call(this)}}x(On,mt);var Yt={2:"touch",3:"pen",4:"mouse"};On.prototype.h=function(){On.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),Pe=0;function B(u,g,b,E,K){this.listener=u,this.proxy=null,this.src=g,this.type=b,this.capture=!!E,this.ha=K,this.key=++Pe,this.da=this.fa=!1}function G(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Ce(u){this.src=u,this.g={},this.h=0}Ce.prototype.add=function(u,g,b,E,K){var re=u.toString();u=this.g[re],u||(u=this.g[re]=[],this.h++);var Ee=R(u,g,E,K);return-1<Ee?(g=u[Ee],b||(g.fa=!1)):(g=new B(g,this.src,re,!!E,K),g.fa=b,u.push(g)),g};function Ke(u,g){var b=g.type;if(b in u.g){var E=u.g[b],K=Array.prototype.indexOf.call(E,g,void 0),re;(re=0<=K)&&Array.prototype.splice.call(E,K,1),re&&(G(g),u.g[b].length==0&&(delete u.g[b],u.h--))}}function R(u,g,b,E){for(var K=0;K<u.length;++K){var re=u[K];if(!re.da&&re.listener==g&&re.capture==!!b&&re.ha==E)return K}return-1}var L="closure_lm_"+(1e6*Math.random()|0),H={};function fe(u,g,b,E,K){if(E&&E.once)return Ie(u,g,b,E,K);if(Array.isArray(g)){for(var re=0;re<g.length;re++)fe(u,g[re],b,E,K);return null}return b=Qe(b),u&&u[ue]?u.K(g,b,c(E)?!!E.capture:!!E,K):oe(u,g,b,!1,E,K)}function oe(u,g,b,E,K,re){if(!g)throw Error("Invalid event type");var Ee=c(K)?!!K.capture:!!K,Ut=ye(u);if(Ut||(u[L]=Ut=new Ce(u)),b=Ut.add(g,b,E,Ee,re),b.proxy)return b;if(E=me(),b.proxy=E,E.src=u,E.listener=b,u.addEventListener)zt||(K=Ee),K===void 0&&(K=!1),u.addEventListener(g.toString(),E,K);else if(u.attachEvent)u.attachEvent(ge(g.toString()),E);else if(u.addListener&&u.removeListener)u.addListener(E);else throw Error("addEventListener and attachEvent are unavailable.");return b}function me(){function u(b){return g.call(u.src,u.listener,b)}const g=Le;return u}function Ie(u,g,b,E,K){if(Array.isArray(g)){for(var re=0;re<g.length;re++)Ie(u,g[re],b,E,K);return null}return b=Qe(b),u&&u[ue]?u.L(g,b,c(E)?!!E.capture:!!E,K):oe(u,g,b,!0,E,K)}function we(u,g,b,E,K){if(Array.isArray(g))for(var re=0;re<g.length;re++)we(u,g[re],b,E,K);else E=c(E)?!!E.capture:!!E,b=Qe(b),u&&u[ue]?(u=u.i,g=String(g).toString(),g in u.g&&(re=u.g[g],b=R(re,b,E,K),-1<b&&(G(re[b]),Array.prototype.splice.call(re,b,1),re.length==0&&(delete u.g[g],u.h--)))):u&&(u=ye(u))&&(g=u.g[g.toString()],u=-1,g&&(u=R(g,b,E,K)),(b=-1<u?g[u]:null)&&ee(b))}function ee(u){if(typeof u!="number"&&u&&!u.da){var g=u.src;if(g&&g[ue])Ke(g.i,u);else{var b=u.type,E=u.proxy;g.removeEventListener?g.removeEventListener(b,E,u.capture):g.detachEvent?g.detachEvent(ge(b),E):g.addListener&&g.removeListener&&g.removeListener(E),(b=ye(g))?(Ke(b,u),b.h==0&&(b.src=null,g[L]=null)):G(u)}}}function ge(u){return u in H?H[u]:H[u]="on"+u}function Le(u,g){if(u.da)u=!0;else{g=new On(g,this);var b=u.listener,E=u.ha||u.src;u.fa&&ee(u),u=b.call(E,g)}return u}function ye(u){return u=u[L],u instanceof Ce?u:null}var Re="__closure_events_fn_"+(1e9*Math.random()>>>0);function Qe(u){return typeof u=="function"?u:(u[Re]||(u[Re]=function(g){return u.handleEvent(g)}),u[Re])}function We(){qe.call(this),this.i=new Ce(this),this.M=this,this.F=null}x(We,qe),We.prototype[ue]=!0,We.prototype.removeEventListener=function(u,g,b,E){we(this,u,g,b,E)};function rt(u,g){var b,E=u.F;if(E)for(b=[];E;E=E.F)b.push(E);if(u=u.M,E=g.type||g,typeof g=="string")g=new mt(g,u);else if(g instanceof mt)g.target=g.target||u;else{var K=g;g=new mt(E,u),$(g,K)}if(K=!0,b)for(var re=b.length-1;0<=re;re--){var Ee=g.g=b[re];K=gt(Ee,E,!0,g)&&K}if(Ee=g.g=u,K=gt(Ee,E,!0,g)&&K,K=gt(Ee,E,!1,g)&&K,b)for(re=0;re<b.length;re++)Ee=g.g=b[re],K=gt(Ee,E,!1,g)&&K}We.prototype.N=function(){if(We.aa.N.call(this),this.i){var u=this.i,g;for(g in u.g){for(var b=u.g[g],E=0;E<b.length;E++)G(b[E]);delete u.g[g],u.h--}}this.F=null},We.prototype.K=function(u,g,b,E){return this.i.add(String(u),g,!1,b,E)},We.prototype.L=function(u,g,b,E){return this.i.add(String(u),g,!0,b,E)};function gt(u,g,b,E){if(g=u.i.g[String(g)],!g)return!0;g=g.concat();for(var K=!0,re=0;re<g.length;++re){var Ee=g[re];if(Ee&&!Ee.da&&Ee.capture==b){var Ut=Ee.listener,jn=Ee.ha||Ee.src;Ee.fa&&Ke(u.i,Ee),K=Ut.call(jn,E)!==!1&&K}}return K&&!E.defaultPrevented}function fn(u,g,b){if(typeof u=="function")b&&(u=p(u,b));else if(u&&typeof u.handleEvent=="function")u=p(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:a.setTimeout(u,g||0)}function Xt(u){u.g=fn(()=>{u.g=null,u.i&&(u.i=!1,Xt(u))},u.l);const g=u.h;u.h=null,u.m.apply(null,g)}class Kt extends qe{constructor(g,b){super(),this.m=g,this.l=b,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:Xt(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vt(u){qe.call(this),this.h=u,this.g={}}x(Vt,qe);var yr=[];function br(u){ae(u.g,function(g,b){this.g.hasOwnProperty(b)&&ee(g)},u),u.g={}}Vt.prototype.N=function(){Vt.aa.N.call(this),br(this)},Vt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pn=a.JSON.stringify,Yn=a.JSON.parse,Rs=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function oi(){}oi.prototype.h=null;function Ko(u){return u.h||(u.h=u.i())}function Go(){}var de={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function W(){mt.call(this,"d")}x(W,mt);function xe(){mt.call(this,"c")}x(xe,mt);var Ue={},it=null;function bt(){return it=it||new We}Ue.La="serverreachability";function ot(u){mt.call(this,Ue.La,u)}x(ot,mt);function Dt(u){const g=bt();rt(g,new ot(g))}Ue.STAT_EVENT="statevent";function bn(u,g){mt.call(this,Ue.STAT_EVENT,u),this.stat=g}x(bn,mt);function Xe(u){const g=bt();rt(g,new bn(g,u))}Ue.Ma="timingevent";function _r(u,g){mt.call(this,Ue.Ma,u),this.size=g}x(_r,mt);function ut(u,g){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},g)}function _n(){this.g=!0}_n.prototype.xa=function(){this.g=!1};function wr(u,g,b,E,K,re){u.info(function(){if(u.g)if(re)for(var Ee="",Ut=re.split("&"),jn=0;jn<Ut.length;jn++){var Et=Ut[jn].split("=");if(1<Et.length){var Vn=Et[0];Et=Et[1];var Rn=Vn.split("_");Ee=2<=Rn.length&&Rn[1]=="type"?Ee+(Vn+"="+Et+"&"):Ee+(Vn+"=redacted&")}}else Ee=null;else Ee=re;return"XMLHTTP REQ ("+E+") [attempt "+K+"]: "+g+`
`+b+`
`+Ee})}function Mr(u,g,b,E,K,re,Ee){u.info(function(){return"XMLHTTP RESP ("+E+") [ attempt "+K+"]: "+g+`
`+b+`
`+re+" "+Ee})}function Un(u,g,b,E){u.info(function(){return"XMLHTTP TEXT ("+g+"): "+Wi(u,b)+(E?" "+E:"")})}function Yr(u,g){u.info(function(){return"TIMEOUT: "+g})}_n.prototype.info=function(){};function Wi(u,g){if(!u.g)return g;if(!g)return null;try{var b=JSON.parse(g);if(b){for(u=0;u<b.length;u++)if(Array.isArray(b[u])){var E=b[u];if(!(2>E.length)){var K=E[1];if(Array.isArray(K)&&!(1>K.length)){var re=K[0];if(re!="noop"&&re!="stop"&&re!="close")for(var Ee=1;Ee<K.length;Ee++)K[Ee]=""}}}}return pn(b)}catch{return g}}var ks={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ki={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qo;function Gi(){}x(Gi,oi),Gi.prototype.g=function(){return new XMLHttpRequest},Gi.prototype.i=function(){return{}},Qo=new Gi;function us(u,g,b,E){this.j=u,this.i=g,this.l=b,this.R=E||1,this.U=new Vt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new oh}function oh(){this.i=null,this.g="",this.h=!1}var hl={},Fc={};function Uc(u,g,b){u.L=1,u.v=Os(mn(g)),u.m=b,u.P=!0,ah(u,null)}function ah(u,g){u.F=Date.now(),fl(u),u.A=mn(u.v);var b=u.A,E=u.R;Array.isArray(E)||(E=[String(E)]),vl(b.i,"t",E),u.C=0,b=u.j.J,u.h=new oh,u.g=bh(u.j,b?g:null,!u.m),0<u.O&&(u.M=new Kt(p(u.Y,u,u.g),u.O)),g=u.U,b=u.g,E=u.ca;var K="readystatechange";Array.isArray(K)||(K&&(yr[0]=K.toString()),K=yr);for(var re=0;re<K.length;re++){var Ee=fe(b,K[re],E||g.handleEvent,!1,g.h||g);if(!Ee)break;g.g[Ee.key]=Ee}g=u.H?P(u.H):{},u.m?(u.u||(u.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,g)):(u.u="GET",u.g.ea(u.A,u.u,null,g)),Dt(),wr(u.i,u.u,u.A,u.l,u.R,u.m)}us.prototype.ca=function(u){u=u.target;const g=this.M;g&&Ge(u)==3?g.j():this.Y(u)},us.prototype.Y=function(u){try{if(u==this.g)e:{const Rn=Ge(this.g);var g=this.g.Ba();const gs=this.g.Z();if(!(3>Rn)&&(Rn!=3||this.g&&(this.h.h||this.g.oa()||dt(this.g)))){this.J||Rn!=4||g==7||(g==8||0>=gs?Dt(3):Dt(2)),pl(this);var b=this.g.Z();this.X=b;t:if(lh(this)){var E=dt(this.g);u="";var K=E.length,re=Ge(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ds(this),Jo(this);var Ee="";break t}this.h.i=new a.TextDecoder}for(g=0;g<K;g++)this.h.h=!0,u+=this.h.i.decode(E[g],{stream:!(re&&g==K-1)});E.length=0,this.h.g+=u,this.C=0,Ee=this.h.g}else Ee=this.g.oa();if(this.o=b==200,Mr(this.i,this.u,this.A,this.l,this.R,Rn,b),this.o){if(this.T&&!this.K){t:{if(this.g){var Ut,jn=this.g;if((Ut=jn.g?jn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(Ut)){var Et=Ut;break t}}Et=null}if(b=Et)Un(this.i,this.l,b,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,jc(this,b);else{this.o=!1,this.s=3,Xe(12),Ds(this),Jo(this);break e}}if(this.P){b=!0;let $r;for(;!this.J&&this.C<Ee.length;)if($r=ch(this,Ee),$r==Fc){Rn==4&&(this.s=4,Xe(14),b=!1),Un(this.i,this.l,null,"[Incomplete Response]");break}else if($r==hl){this.s=4,Xe(15),Un(this.i,this.l,Ee,"[Invalid Chunk]"),b=!1;break}else Un(this.i,this.l,$r,null),jc(this,$r);if(lh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Rn!=4||Ee.length!=0||this.h.h||(this.s=1,Xe(16),b=!1),this.o=this.o&&b,!b)Un(this.i,this.l,Ee,"[Invalid Chunked Response]"),Ds(this),Jo(this);else if(0<Ee.length&&!this.W){this.W=!0;var Vn=this.j;Vn.g==this&&Vn.ba&&!Vn.M&&(Vn.j.info("Great, no buffering proxy detected. Bytes received: "+Ee.length),ca(Vn),Vn.M=!0,Xe(11))}}else Un(this.i,this.l,Ee,null),jc(this,Ee);Rn==4&&Ds(this),this.o&&!this.J&&(Rn==4?yh(this.j,this):(this.o=!1,fl(this)))}else wn(this.g),b==400&&0<Ee.indexOf("Unknown SID")?(this.s=3,Xe(12)):(this.s=0,Xe(13)),Ds(this),Jo(this)}}}catch{}finally{}};function lh(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function ch(u,g){var b=u.C,E=g.indexOf(`
`,b);return E==-1?Fc:(b=Number(g.substring(b,E)),isNaN(b)?hl:(E+=1,E+b>g.length?Fc:(g=g.slice(E,E+b),u.C=E+b,g)))}us.prototype.cancel=function(){this.J=!0,Ds(this)};function fl(u){u.S=Date.now()+u.I,uh(u,u.I)}function uh(u,g){if(u.B!=null)throw Error("WatchDog timer not null");u.B=ut(p(u.ba,u),g)}function pl(u){u.B&&(a.clearTimeout(u.B),u.B=null)}us.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(Yr(this.i,this.A),this.L!=2&&(Dt(),Xe(17)),Ds(this),this.s=2,Jo(this)):uh(this,this.S-u)};function Jo(u){u.j.G==0||u.J||yh(u.j,u)}function Ds(u){pl(u);var g=u.M;g&&typeof g.ma=="function"&&g.ma(),u.M=null,br(u.U),u.g&&(g=u.g,u.g=null,g.abort(),g.ma())}function jc(u,g){try{var b=u.j;if(b.G!=0&&(b.g==u||Xr(b.h,u))){if(!u.K&&Xr(b.h,u)&&b.G==3){try{var E=b.Da.g.parse(g)}catch{E=null}if(Array.isArray(E)&&E.length==3){var K=E;if(K[0]==0){e:if(!b.u){if(b.g)if(b.g.F+3e3<u.F)ua(b),aa(b);else break e;Qc(b),Xe(18)}}else b.za=K[1],0<b.za-b.T&&37500>K[2]&&b.F&&b.v==0&&!b.C&&(b.C=ut(p(b.Za,b),6e3));if(1>=ai(b.h)&&b.ca){try{b.ca()}catch{}b.ca=void 0}}else hi(b,11)}else if((u.K||b.g==u)&&ua(b),!N(g))for(K=b.Da.g.parse(g),g=0;g<K.length;g++){let Et=K[g];if(b.T=Et[0],Et=Et[1],b.G==2)if(Et[0]=="c"){b.K=Et[1],b.ia=Et[2];const Vn=Et[3];Vn!=null&&(b.la=Vn,b.j.info("VER="+b.la));const Rn=Et[4];Rn!=null&&(b.Aa=Rn,b.j.info("SVER="+b.Aa));const gs=Et[5];gs!=null&&typeof gs=="number"&&0<gs&&(E=1.5*gs,b.L=E,b.j.info("backChannelRequestTimeoutMs_="+E)),E=b;const $r=u.g;if($r){const xl=$r.g?$r.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xl){var re=E.h;re.g||xl.indexOf("spdy")==-1&&xl.indexOf("quic")==-1&&xl.indexOf("h2")==-1||(re.j=re.l,re.g=new Set,re.h&&(ml(re,re.h),re.h=null))}if(E.D){const eu=$r.g?$r.g.getResponseHeader("X-HTTP-Session-Id"):null;eu&&(E.ya=eu,Ht(E.I,E.D,eu))}}b.G=3,b.l&&b.l.ua(),b.ba&&(b.R=Date.now()-u.F,b.j.info("Handshake RTT: "+b.R+"ms")),E=b;var Ee=u;if(E.qa=Yc(E,E.J?E.ia:null,E.W),Ee.K){Yo(E.h,Ee);var Ut=Ee,jn=E.L;jn&&(Ut.I=jn),Ut.B&&(pl(Ut),fl(Ut)),E.g=Ee}else Rr(E);0<b.i.length&&zn(b)}else Et[0]!="stop"&&Et[0]!="close"||hi(b,7);else b.G==3&&(Et[0]=="stop"||Et[0]=="close"?Et[0]=="stop"?hi(b,7):oa(b):Et[0]!="noop"&&b.l&&b.l.ta(Et),b.v=0)}}Dt(4)}catch{}}var Lr=class{constructor(u,g){this.g=u,this.map=g}};function Ns(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ds(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function ai(u){return u.h?1:u.g?u.g.size:0}function Xr(u,g){return u.h?u.h==g:u.g?u.g.has(g):!1}function ml(u,g){u.g?u.g.add(g):u.h=g}function Yo(u,g){u.h&&u.h==g?u.h=null:u.g&&u.g.has(g)&&u.g.delete(g)}Ns.prototype.cancel=function(){if(this.i=Qi(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function Qi(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let g=u.i;for(const b of u.g.values())g=g.concat(b.D);return g}return _(u.i)}function am(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var g=[],b=u.length,E=0;E<b;E++)g.push(u[E]);return g}g=[],b=0;for(E in u)g[b++]=u[E];return g}function Zr(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var g=[];u=u.length;for(var b=0;b<u;b++)g.push(b);return g}g=[],b=0;for(const E in u)g[b++]=E;return g}}}function qc(u,g){if(u.forEach&&typeof u.forEach=="function")u.forEach(g,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,g,void 0);else for(var b=Zr(u),E=am(u),K=E.length,re=0;re<K;re++)g.call(void 0,E[re],b&&b[re],u)}var Bc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function zc(u,g){if(u){u=u.split("&");for(var b=0;b<u.length;b++){var E=u[b].indexOf("="),K=null;if(0<=E){var re=u[b].substring(0,E);K=u[b].substring(E+1)}else re=u[b];g(re,K?decodeURIComponent(K.replace(/\+/g," ")):"")}}}function li(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof li){this.h=u.h,ci(this,u.j),this.o=u.o,this.g=u.g,xr(this,u.s),this.l=u.l;var g=u.i,b=new Xo;b.i=g.i,g.g&&(b.g=new Map(g.g),b.h=g.h),Hc(this,b),this.m=u.m}else u&&(g=String(u).match(Bc))?(this.h=!1,ci(this,g[1]||"",!0),this.o=hs(g[2]||""),this.g=hs(g[3]||"",!0),xr(this,g[4]),this.l=hs(g[5]||"",!0),Hc(this,g[6]||"",!0),this.m=hs(g[7]||"")):(this.h=!1,this.i=new Xo(null,this.h))}li.prototype.toString=function(){var u=[],g=this.j;g&&u.push(Vs(g,Wc,!0),":");var b=this.g;return(b||g=="file")&&(u.push("//"),(g=this.o)&&u.push(Vs(g,Wc,!0),"@"),u.push(encodeURIComponent(String(b)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.s,b!=null&&u.push(":",String(b))),(b=this.l)&&(this.g&&b.charAt(0)!="/"&&u.push("/"),u.push(Vs(b,b.charAt(0)=="/"?fs:gl,!0))),(b=this.i.toString())&&u.push("?",b),(b=this.m)&&u.push("#",Vs(b,cm)),u.join("")};function mn(u){return new li(u)}function ci(u,g,b){u.j=b?hs(g,!0):g,u.j&&(u.j=u.j.replace(/:$/,""))}function xr(u,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);u.s=g}else u.s=null}function Hc(u,g,b){g instanceof Xo?(u.i=g,nt(u.i,u.h)):(b||(g=Vs(g,lm)),u.i=new Xo(g,u.h))}function Ht(u,g,b){u.i.set(g,b)}function Os(u){return Ht(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function hs(u,g){return u?g?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Vs(u,g,b){return typeof u=="string"?(u=encodeURI(u).replace(g,Ji),b&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function Ji(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Wc=/[#\/\?@]/g,gl=/[#\?:]/g,fs=/[#\?]/g,lm=/[#\?@]/g,cm=/#/g;function Xo(u,g){this.h=this.g=null,this.i=u||null,this.j=!!g}function ps(u){u.g||(u.g=new Map,u.h=0,u.i&&zc(u.i,function(g,b){u.add(decodeURIComponent(g.replace(/\+/g," ")),b)}))}n=Xo.prototype,n.add=function(u,g){ps(this),this.i=null,u=be(this,u);var b=this.g.get(u);return b||this.g.set(u,b=[]),b.push(g),this.h+=1,this};function Zo(u,g){ps(u),g=be(u,g),u.g.has(g)&&(u.i=null,u.h-=u.g.get(g).length,u.g.delete(g))}function ea(u,g){return ps(u),g=be(u,g),u.g.has(g)}n.forEach=function(u,g){ps(this),this.g.forEach(function(b,E){b.forEach(function(K){u.call(g,K,E,this)},this)},this)},n.na=function(){ps(this);const u=Array.from(this.g.values()),g=Array.from(this.g.keys()),b=[];for(let E=0;E<g.length;E++){const K=u[E];for(let re=0;re<K.length;re++)b.push(g[E])}return b},n.V=function(u){ps(this);let g=[];if(typeof u=="string")ea(this,u)&&(g=g.concat(this.g.get(be(this,u))));else{u=Array.from(this.g.values());for(let b=0;b<u.length;b++)g=g.concat(u[b])}return g},n.set=function(u,g){return ps(this),this.i=null,u=be(this,u),ea(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[g]),this.h+=1,this},n.get=function(u,g){return u?(u=this.V(u),0<u.length?String(u[0]):g):g};function vl(u,g,b){Zo(u,g),0<b.length&&(u.i=null,u.g.set(be(u,g),_(b)),u.h+=b.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],g=Array.from(this.g.keys());for(var b=0;b<g.length;b++){var E=g[b];const re=encodeURIComponent(String(E)),Ee=this.V(E);for(E=0;E<Ee.length;E++){var K=re;Ee[E]!==""&&(K+="="+encodeURIComponent(String(Ee[E]))),u.push(K)}}return this.i=u.join("&")};function be(u,g){return g=String(g),u.j&&(g=g.toLowerCase()),g}function nt(u,g){g&&!u.j&&(ps(u),u.i=null,u.g.forEach(function(b,E){var K=E.toLowerCase();E!=K&&(Zo(this,E),vl(this,K,b))},u)),u.j=g}function Xn(u,g){const b=new _n;if(a.Image){const E=new Image;E.onload=v(Ls,b,"TestLoadImage: loaded",!0,g,E),E.onerror=v(Ls,b,"TestLoadImage: error",!1,g,E),E.onabort=v(Ls,b,"TestLoadImage: abort",!1,g,E),E.ontimeout=v(Ls,b,"TestLoadImage: timeout",!1,g,E),a.setTimeout(function(){E.ontimeout&&E.ontimeout()},1e4),E.src=u}else g(!1)}function Ms(u,g){const b=new _n,E=new AbortController,K=setTimeout(()=>{E.abort(),Ls(b,"TestPingServer: timeout",!1,g)},1e4);fetch(u,{signal:E.signal}).then(re=>{clearTimeout(K),re.ok?Ls(b,"TestPingServer: ok",!0,g):Ls(b,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(K),Ls(b,"TestPingServer: error",!1,g)})}function Ls(u,g,b,E,K){try{K&&(K.onload=null,K.onerror=null,K.onabort=null,K.ontimeout=null),E(b)}catch{}}function dh(){this.g=new Rs}function hh(u,g,b){const E=b||"";try{qc(u,function(K,re){let Ee=K;c(K)&&(Ee=pn(K)),g.push(E+re+"="+encodeURIComponent(Ee))})}catch(K){throw g.push(E+"type="+encodeURIComponent("_badmap")),K}}function yl(u){this.l=u.Ub||null,this.j=u.eb||!1}x(yl,oi),yl.prototype.g=function(){return new bl(this.l,this.j)},yl.prototype.i=function(u){return function(){return u}}({});function bl(u,g){We.call(this),this.D=u,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(bl,We),n=bl.prototype,n.open=function(u,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=g,this.readyState=1,ms(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(g.body=u),(this.D||a).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ta(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,ms(this)),this.g&&(this.readyState=3,ms(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;_l(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function _l(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var g=u.value?u.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!u.done}))&&(this.response=this.responseText+=g)}u.done?ta(this):ms(this),this.readyState==3&&_l(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,ta(this))},n.Qa=function(u){this.g&&(this.response=u,ta(this))},n.ga=function(){this.g&&ta(this)};function ta(u){u.readyState=4,u.l=null,u.j=null,u.v=null,ms(u)}n.setRequestHeader=function(u,g){this.u.append(u,g)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],g=this.h.entries();for(var b=g.next();!b.done;)b=b.value,u.push(b[0]+": "+b[1]),b=g.next();return u.join(`\r
`)};function ms(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(bl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function na(u){let g="";return ae(u,function(b,E){g+=E,g+=":",g+=b,g+=`\r
`}),g}function $s(u,g,b){e:{for(E in b){var E=!1;break e}E=!0}E||(b=na(b),typeof u=="string"?b!=null&&encodeURIComponent(String(b)):Ht(u,g,b))}function Ft(u){We.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(Ft,We);var ra=/^https?$/i,sa=["POST","PUT"];n=Ft.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,g,b,E){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);g=g?g.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qo.g(),this.v=this.o?Ko(this.o):Ko(Qo),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(g,String(u),!0),this.B=!1}catch(re){ia(this,re);return}if(u=b||"",b=new Map(this.headers),E)if(Object.getPrototypeOf(E)===Object.prototype)for(var K in E)b.set(K,E[K]);else if(typeof E.keys=="function"&&typeof E.get=="function")for(const re of E.keys())b.set(re,E.get(re));else throw Error("Unknown input type for opt_headers: "+String(E));E=Array.from(b.keys()).find(re=>re.toLowerCase()=="content-type"),K=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(sa,g,void 0))||E||K||b.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[re,Ee]of b)this.g.setRequestHeader(re,Ee);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kc(this),this.u=!0,this.g.send(u),this.u=!1}catch(re){ia(this,re)}};function ia(u,g){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=g,u.m=5,fh(u),wl(u)}function fh(u){u.A||(u.A=!0,rt(u,"complete"),rt(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,rt(this,"complete"),rt(this,"abort"),wl(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),wl(this,!0)),Ft.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ph(this):this.bb())},n.bb=function(){ph(this)};function ph(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Ge(u)!=4||u.Z()!=2)){if(u.u&&Ge(u)==4)fn(u.Ea,0,u);else if(rt(u,"readystatechange"),Ge(u)==4){u.h=!1;try{const Ee=u.Z();e:switch(Ee){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var b;if(!(b=g)){var E;if(E=Ee===0){var K=String(u.D).match(Bc)[1]||null;!K&&a.self&&a.self.location&&(K=a.self.location.protocol.slice(0,-1)),E=!ra.test(K?K.toLowerCase():"")}b=E}if(b)rt(u,"complete"),rt(u,"success");else{u.m=6;try{var re=2<Ge(u)?u.g.statusText:""}catch{re=""}u.l=re+" ["+u.Z()+"]",fh(u)}}finally{wl(u)}}}}function wl(u,g){if(u.g){Kc(u);const b=u.g,E=u.v[0]?()=>{}:null;u.g=null,u.v=null,g||rt(u,"ready");try{b.onreadystatechange=E}catch{}}}function Kc(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Ge(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Ge(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var g=this.g.responseText;return u&&g.indexOf(u)==0&&(g=g.substring(u.length)),Yn(g)}};function dt(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function wn(u){const g={};u=(u.g&&2<=Ge(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let E=0;E<u.length;E++){if(N(u[E]))continue;var b=F(u[E]);const K=b[0];if(b=b[1],typeof b!="string")continue;b=b.trim();const re=g[K]||[];g[K]=re,re.push(b)}V(g,function(E){return E.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function et(u,g,b){return b&&b.internalChannelParams&&b.internalChannelParams[u]||g}function mh(u){this.Aa=0,this.i=[],this.j=new _n,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=et("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=et("baseRetryDelayMs",5e3,u),this.cb=et("retryDelaySeedMs",1e4,u),this.Wa=et("forwardChannelMaxRetries",2,u),this.wa=et("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Ns(u&&u.concurrentRequestLimit),this.Da=new dh,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=mh.prototype,n.la=8,n.G=1,n.connect=function(u,g,b,E){Xe(0),this.W=u,this.H=g||{},b&&E!==void 0&&(this.H.OSID=b,this.H.OAID=E),this.F=this.X,this.I=Yc(this,null,this.W),zn(this)};function oa(u){if(ui(u),u.G==3){var g=u.U++,b=mn(u.I);if(Ht(b,"SID",u.K),Ht(b,"RID",g),Ht(b,"TYPE","terminate"),la(u,b),g=new us(u,u.j,g),g.L=2,g.v=Os(mn(b)),b=!1,a.navigator&&a.navigator.sendBeacon)try{b=a.navigator.sendBeacon(g.v.toString(),"")}catch{}!b&&a.Image&&(new Image().src=g.v,b=!0),b||(g.g=bh(g.j,null),g.g.ea(g.v)),g.F=Date.now(),fl(g)}fi(u)}function aa(u){u.g&&(ca(u),u.g.cancel(),u.g=null)}function ui(u){aa(u),u.u&&(a.clearTimeout(u.u),u.u=null),ua(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function zn(u){if(!ds(u.h)&&!u.s){u.s=!0;var g=u.Ga;Ze||ke(),ce||(Ze(),ce=!0),z.add(g,u),u.B=0}}function Gc(u,g){return ai(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=g.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=ut(p(u.Ga,u,g),Jc(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const K=new us(this,this.j,u);let re=this.o;if(this.S&&(re?(re=P(re),$(re,this.S)):re=this.S),this.m!==null||this.O||(K.H=re,re=null),this.P)e:{for(var g=0,b=0;b<this.i.length;b++){t:{var E=this.i[b];if("__data__"in E.map&&(E=E.map.__data__,typeof E=="string")){E=E.length;break t}E=void 0}if(E===void 0)break;if(g+=E,4096<g){g=b;break e}if(g===4096||b===this.i.length-1){g=b+1;break e}}g=1e3}else g=1e3;g=di(this,K,g),b=mn(this.I),Ht(b,"RID",u),Ht(b,"CVER",22),this.D&&Ht(b,"X-HTTP-Session-Id",this.D),la(this,b),re&&(this.O?g="headers="+encodeURIComponent(String(na(re)))+"&"+g:this.m&&$s(b,this.m,re)),ml(this.h,K),this.Ua&&Ht(b,"TYPE","init"),this.P?(Ht(b,"$req",g),Ht(b,"SID","null"),K.T=!0,Uc(K,b,null)):Uc(K,b,g),this.G=2}}else this.G==3&&(u?gh(this,u):this.i.length==0||ds(this.h)||gh(this))};function gh(u,g){var b;g?b=g.l:b=u.U++;const E=mn(u.I);Ht(E,"SID",u.K),Ht(E,"RID",b),Ht(E,"AID",u.T),la(u,E),u.m&&u.o&&$s(E,u.m,u.o),b=new us(u,u.j,b,u.B+1),u.m===null&&(b.H=u.o),g&&(u.i=g.D.concat(u.i)),g=di(u,b,1e3),b.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),ml(u.h,b),Uc(b,E,g)}function la(u,g){u.H&&ae(u.H,function(b,E){Ht(g,E,b)}),u.l&&qc({},function(b,E){Ht(g,E,b)})}function di(u,g,b){b=Math.min(u.i.length,b);var E=u.l?p(u.l.Na,u.l,u):null;e:{var K=u.i;let re=-1;for(;;){const Ee=["count="+b];re==-1?0<b?(re=K[0].g,Ee.push("ofs="+re)):re=0:Ee.push("ofs="+re);let Ut=!0;for(let jn=0;jn<b;jn++){let Et=K[jn].g;const Vn=K[jn].map;if(Et-=re,0>Et)re=Math.max(0,K[jn].g-100),Ut=!1;else try{hh(Vn,Ee,"req"+Et+"_")}catch{E&&E(Vn)}}if(Ut){E=Ee.join("&");break e}}}return u=u.i.splice(0,b),g.D=u,E}function Rr(u){if(!u.g&&!u.u){u.Y=1;var g=u.Fa;Ze||ke(),ce||(Ze(),ce=!0),z.add(g,u),u.v=0}}function Qc(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=ut(p(u.Fa,u),Jc(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,vh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=ut(p(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Xe(10),aa(this),vh(this))};function ca(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function vh(u){u.g=new us(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var g=mn(u.qa);Ht(g,"RID","rpc"),Ht(g,"SID",u.K),Ht(g,"AID",u.T),Ht(g,"CI",u.F?"0":"1"),!u.F&&u.ja&&Ht(g,"TO",u.ja),Ht(g,"TYPE","xmlhttp"),la(u,g),u.m&&u.o&&$s(g,u.m,u.o),u.L&&(u.g.I=u.L);var b=u.g;u=u.ia,b.L=1,b.v=Os(mn(g)),b.m=null,b.P=!0,ah(b,u)}n.Za=function(){this.C!=null&&(this.C=null,aa(this),Qc(this),Xe(19))};function ua(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function yh(u,g){var b=null;if(u.g==g){ua(u),ca(u),u.g=null;var E=2}else if(Xr(u.h,g))b=g.D,Yo(u.h,g),E=1;else return;if(u.G!=0){if(g.o)if(E==1){b=g.m?g.m.length:0,g=Date.now()-g.F;var K=u.B;E=bt(),rt(E,new _r(E,b)),zn(u)}else Rr(u);else if(K=g.s,K==3||K==0&&0<g.X||!(E==1&&Gc(u,g)||E==2&&Qc(u)))switch(b&&0<b.length&&(g=u.h,g.i=g.i.concat(b)),K){case 1:hi(u,5);break;case 4:hi(u,10);break;case 3:hi(u,6);break;default:hi(u,2)}}}function Jc(u,g){let b=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(b*=2),b*g}function hi(u,g){if(u.j.info("Error code "+g),g==2){var b=p(u.fb,u),E=u.Xa;const K=!E;E=new li(E||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ci(E,"https"),Os(E),K?Xn(E.toString(),b):Ms(E.toString(),b)}else Xe(2);u.G=0,u.l&&u.l.sa(g),fi(u),ui(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Xe(2)):(this.j.info("Failed to ping google.com"),Xe(1))};function fi(u){if(u.G=0,u.ka=[],u.l){const g=Qi(u.h);(g.length!=0||u.i.length!=0)&&(w(u.ka,g),w(u.ka,u.i),u.h.i.length=0,_(u.i),u.i.length=0),u.l.ra()}}function Yc(u,g,b){var E=b instanceof li?mn(b):new li(b);if(E.g!="")g&&(E.g=g+"."+E.g),xr(E,E.s);else{var K=a.location;E=K.protocol,g=g?g+"."+K.hostname:K.hostname,K=+K.port;var re=new li(null);E&&ci(re,E),g&&(re.g=g),K&&xr(re,K),b&&(re.l=b),E=re}return b=u.D,g=u.ya,b&&g&&Ht(E,b,g),Ht(E,"VER",u.la),la(u,E),E}function bh(u,g,b){if(g&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=u.Ca&&!u.pa?new Ft(new yl({eb:b})):new Ft(u.pa),g.Ha(u.J),g}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Xc(){}n=Xc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Zn(){}Zn.prototype.g=function(u,g){return new Er(u,g)};function Er(u,g){We.call(this),this.g=new mh(g),this.l=u,this.h=g&&g.messageUrlParams||null,u=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(u?u["X-WebChannel-Content-Type"]=g.messageContentType:u={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(u?u["X-WebChannel-Client-Profile"]=g.va:u={"X-WebChannel-Client-Profile":g.va}),this.g.S=u,(u=g&&g.Sb)&&!N(u)&&(this.g.m=u),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!N(g)&&(this.g.D=g,u=this.h,u!==null&&g in u&&(u=this.h,g in u&&delete u[g])),this.j=new Fs(this)}x(Er,We),Er.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Er.prototype.close=function(){oa(this.g)},Er.prototype.o=function(u){var g=this.g;if(typeof u=="string"){var b={};b.__data__=u,u=b}else this.u&&(b={},b.__data__=pn(u),u=b);g.i.push(new Lr(g.Ya++,u)),g.G==3&&zn(g)},Er.prototype.N=function(){this.g.l=null,delete this.j,oa(this.g),delete this.g,Er.aa.N.call(this)};function _h(u){W.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var g=u.__sm__;if(g){e:{for(const b in g){u=b;break e}u=void 0}(this.i=u)&&(u=this.i,g=g!==null&&u in g?g[u]:void 0),this.data=g}else this.data=u}x(_h,W);function Zc(){xe.call(this),this.status=1}x(Zc,xe);function Fs(u){this.g=u}x(Fs,Xc),Fs.prototype.ua=function(){rt(this.g,"a")},Fs.prototype.ta=function(u){rt(this.g,new _h(u))},Fs.prototype.sa=function(u){rt(this.g,new Zc)},Fs.prototype.ra=function(){rt(this.g,"b")},Zn.prototype.createWebChannel=Zn.prototype.g,Er.prototype.send=Er.prototype.o,Er.prototype.open=Er.prototype.m,Er.prototype.close=Er.prototype.close,gT=function(){return new Zn},mT=function(){return bt()},pT=Ue,Cg={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ks.NO_ERROR=0,ks.TIMEOUT=8,ks.HTTP_ERROR=6,Jh=ks,Ki.COMPLETE="complete",fT=Ki,Go.EventType=de,de.OPEN="a",de.CLOSE="b",de.ERROR="c",de.MESSAGE="d",We.prototype.listen=We.prototype.K,Eu=Go,Ft.prototype.listenOnce=Ft.prototype.L,Ft.prototype.getLastError=Ft.prototype.Ka,Ft.prototype.getLastErrorCode=Ft.prototype.Ba,Ft.prototype.getStatus=Ft.prototype.Z,Ft.prototype.getResponseJson=Ft.prototype.Oa,Ft.prototype.getResponseText=Ft.prototype.oa,Ft.prototype.send=Ft.prototype.ea,Ft.prototype.setWithCredentials=Ft.prototype.Ha,hT=Ft}).apply(typeof Ph<"u"?Ph:typeof self<"u"?self:typeof window<"u"?window:{});const B_="@firebase/firestore",z_="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Wn.UNAUTHENTICATED=new Wn(null),Wn.GOOGLE_CREDENTIALS=new Wn("google-credentials-uid"),Wn.FIRST_PARTY=new Wn("first-party-uid"),Wn.MOCK_USER=new Wn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sc="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ro=new jv("@firebase/firestore");function Vl(){return Ro.logLevel}function dJ(n){Ro.setLogLevel(n)}function ve(n,...e){if(Ro.logLevel<=_t.DEBUG){const t=e.map(Yv);Ro.debug(`Firestore (${Sc}): ${n}`,...t)}}function Dn(n,...e){if(Ro.logLevel<=_t.ERROR){const t=e.map(Yv);Ro.error(`Firestore (${Sc}): ${n}`,...t)}}function as(n,...e){if(Ro.logLevel<=_t.WARN){const t=e.map(Yv);Ro.warn(`Firestore (${Sc}): ${n}`,...t)}}function Yv(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ne(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,vT(n,r,t)}function vT(n,e,t){let r=`FIRESTORE (${Sc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Dn(r),new Error(r)}function Fe(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||vT(e,s,r)}function hJ(n,e){n||Ne(57014,e)}function Ae(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class he extends Cs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yT{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class RV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Wn.UNAUTHENTICATED))}shutdown(){}}class kV{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class DV{constructor(e){this.t=e,this.currentUser=Wn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Fe(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Gn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Gn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{ve("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ve("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Gn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ve("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Fe(typeof r.accessToken=="string",31837,{l:r}),new yT(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Fe(e===null||typeof e=="string",2055,{h:e}),new Wn(e)}}class NV{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Wn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class OV{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new NV(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Wn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Rg{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class VV{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,sn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Fe(this.o===void 0,3512);const r=i=>{i.error!=null&&ve("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,ve("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ve("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):ve("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Rg(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Fe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Rg(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class fJ{getToken(){return Promise.resolve(new Rg(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MV(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xv{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=MV(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function st(n,e){return n<e?-1:n>e?1:0}function kg(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return Bm(s)===Bm(i)?st(s,i):Bm(s)?1:-1}return st(n.length,e.length)}const LV=55296,$V=57343;function Bm(n){const e=n.charCodeAt(0);return e>=LV&&e<=$V}function sc(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function bT(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dg="__name__";class Bs{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ne(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&Ne(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Bs.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Bs?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Bs.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return st(e.length,t.length)}static compareSegments(e,t){const r=Bs.isNumericId(e),s=Bs.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Bs.extractNumericId(e).compare(Bs.extractNumericId(t)):kg(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return To.fromString(e.substring(4,e.length-2))}}class vt extends Bs{construct(e,t,r){return new vt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new he(Y.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new vt(t)}static emptyPath(){return new vt([])}}const FV=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class dn extends Bs{construct(e,t,r){return new dn(e,t,r)}static isValidIdentifier(e){return FV.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),dn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Dg}static keyField(){return new dn([Dg])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new he(Y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new he(Y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new he(Y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new he(Y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new dn(t)}static emptyPath(){return new dn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Te{constructor(e){this.path=e}static fromPath(e){return new Te(vt.fromString(e))}static fromName(e){return new Te(vt.fromString(e).popFirst(5))}static empty(){return new Te(vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&vt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return vt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Te(new vt(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zv(n,e,t){if(!t)throw new he(Y.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function UV(n,e,t,r){if(e===!0&&r===!0)throw new he(Y.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function H_(n){if(!Te.isDocumentKey(n))throw new he(Y.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function W_(n){if(Te.isDocumentKey(n))throw new he(Y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function _T(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function vp(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ne(12329,{type:typeof n})}function yt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new he(Y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=vp(n);throw new he(Y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function wT(n,e){if(e<=0)throw new he(Y.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(n,e){const t={typeString:n};return e&&(t.value=e),t}function rl(n,e){if(!_T(n))throw new he(Y.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const o=n[r];if(s&&typeof o!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new he(Y.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K_=-62135596800,G_=1e6;class jt{static now(){return jt.fromMillis(Date.now())}static fromDate(e){return jt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*G_);return new jt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new he(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new he(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<K_)throw new he(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new he(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/G_}_compareTo(e){return this.seconds===e.seconds?st(this.nanoseconds,e.nanoseconds):st(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:jt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(rl(e,jt._jsonSchema))return new jt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-K_;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}jt._jsonSchemaVersion="firestore/timestamp/1.0",jt._jsonSchema={type:$n("string",jt._jsonSchemaVersion),seconds:$n("number"),nanoseconds:$n("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class He{static fromTimestamp(e){return new He(e)}static min(){return new He(new jt(0,0))}static max(){return new He(new jt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ic=-1;class oc{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Ng(n){return n.fields.find(e=>e.kind===2)}function ba(n){return n.fields.filter(e=>e.kind!==2)}function jV(n,e){let t=st(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=qV(n.fields[r],e.fields[r]),t!==0)return t;return st(n.fields.length,e.fields.length)}oc.UNKNOWN_ID=-1;class Da{constructor(e,t){this.fieldPath=e,this.kind=t}}function qV(n,e){const t=dn.comparator(n.fieldPath,e.fieldPath);return t!==0?t:st(n.kind,e.kind)}class ac{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ac(0,Jr.min())}}function xT(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=He.fromTimestamp(r===1e9?new jt(t+1,0):new jt(t,r));return new Jr(s,Te.empty(),e)}function ET(n){return new Jr(n.readTime,n.key,ic)}class Jr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Jr(He.min(),Te.empty(),ic)}static max(){return new Jr(He.max(),Te.empty(),ic)}}function ey(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Te.comparator(n.documentKey,e.documentKey),t!==0?t:st(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class TT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jo(n){if(n.code!==Y.FAILED_PRECONDITION||n.message!==IT)throw n;ve("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ne(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new J((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof J?t:J.resolve(t)}catch(t){return J.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):J.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):J.reject(t)}static resolve(e){return new J((t,r)=>{t(e)})}static reject(e){return new J((t,r)=>{r(e)})}static waitFor(e){return new J((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=J.resolve(!1);for(const r of e)t=t.next(s=>s?J.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new J((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(f=>{o[c]=f,++a,a===i&&r(o)},f=>s(f))}})}static doWhile(e,t){return new J((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jr="SimpleDb";class yp{static open(e,t,r,s){try{return new yp(t,e.transaction(s,r))}catch(i){throw new $u(t,i)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Gn,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new $u(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=ty(r.target.error);this.S.reject(new $u(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ve(jr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new zV(t)}}class Ys{static delete(e){return ve(jr,"Removing database:",e),xa(TI().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Uv())return!1;if(Ys.F())return!0;const e=qn(),t=Ys.M(e),r=0<t&&t<10,s=ST(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,Ys.M(qn())===12.2&&Dn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ve(jr,"Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new $u(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new he(Y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new he(Y.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new $u(e,o))},s.onupgradeneeded=i=>{ve(jr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{ve(jr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=yp.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.C(),c)).catch(c=>(a.abort(c),J.reject(c))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(ve(jr,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ST(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class BV{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return xa(this.U.delete())}}class $u extends he{constructor(e,t){super(Y.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function qo(n){return n.name==="IndexedDbTransactionError"}class zV{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ve(jr,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(ve(jr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),xa(r)}add(e){return ve(jr,"ADD",this.store.name,e,e),xa(this.store.add(e))}get(e){return xa(this.store.get(e)).next(t=>(t===void 0&&(t=null),ve(jr,"GET",this.store.name,e,t),t))}delete(e){return ve(jr,"DELETE",this.store.name,e),xa(this.store.delete(e))}count(){return ve(jr,"COUNT",this.store.name),xa(this.store.count())}J(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new J((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new J((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,t){ve(jr,"DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}te(e){const t=this.cursor({});return new J((r,s)=>{t.onerror=i=>{const o=ty(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new J((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new BV(a),c=t(a.primaryKey,a.value,l);if(c instanceof J){const f=c.catch(h=>(l.done(),J.reject(h)));r.push(f)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>J.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function xa(n){return new J((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=ty(r.target.error);t(s)}})}let Q_=!1;function ty(n){const e=Ys.M(qn());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new he("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Q_||(Q_=!0,setTimeout(()=>{throw r},0)),r}}return n}const Fu="IndexBackfiller";class HV{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){ve(Fu,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const t=await this.ne.ie();ve(Fu,`Documents written: ${t}`)}catch(t){qo(t)?ve(Fu,"Ignoring IndexedDB error during index backfill: ",t):await jo(t)}await this.re(6e4)})}}class WV{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){const r=new Set;let s=t,i=!0;return J.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return ve(Fu,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(ve(Fu,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}_e(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=ET(i);ey(o,r)>0&&(r=o)}),new Jr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Dr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const So=-1;function $d(n){return n==null}function hd(n){return n===0&&1/n==-1/0}function AT(n){return typeof n=="number"&&Number.isInteger(n)&&!hd(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tf="";function mr(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=J_(e)),e=KV(n.get(t),e);return J_(e)}function KV(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case Tf:t+="";break;default:t+=i}}return t}function J_(n){return n+Tf+""}function Ks(n){const e=n.length;if(Fe(e>=2,64408,{path:n}),e===2)return Fe(n.charAt(0)===Tf&&n.charAt(1)==="",56145,{path:n}),vt.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf(Tf,i);switch((o<0||o>t)&&Ne(50515,{path:n}),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ne(61167,{path:n})}i=o+2}return new vt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a="remoteDocuments",Fd="owner",Al="owner",fd="mutationQueues",GV="userId",ys="mutations",Y_="batchId",Ca="userMutationsIndex",X_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yh(n,e){return[n,mr(e)]}function PT(n,e,t){return[n,mr(e),t]}const QV={},lc="documentMutations",Sf="remoteDocumentsV14",JV=["prefixPath","collectionGroup","readTime","documentId"],Xh="documentKeyIndex",YV=["prefixPath","collectionGroup","documentId"],CT="collectionGroupIndex",XV=["collectionGroup","readTime","prefixPath","documentId"],pd="remoteDocumentGlobal",Og="remoteDocumentGlobalKey",cc="targets",RT="queryTargetsIndex",ZV=["canonicalId","targetId"],uc="targetDocuments",e3=["targetId","path"],ny="documentTargetsIndex",t3=["path","targetId"],Af="targetGlobalKey",Na="targetGlobal",md="collectionParents",n3=["collectionId","parent"],dc="clientMetadata",r3="clientId",bp="bundles",s3="bundleId",_p="namedQueries",i3="name",ry="indexConfiguration",o3="indexId",Vg="collectionGroupIndex",a3="collectionGroup",Uu="indexState",l3=["indexId","uid"],kT="sequenceNumberIndex",c3=["uid","sequenceNumber"],ju="indexEntries",u3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],DT="documentKeyIndex",d3=["indexId","uid","orderedDocumentKey"],wp="documentOverlays",h3=["userId","collectionPath","documentId"],Mg="collectionPathOverlayIndex",f3=["userId","collectionPath","largestBatchId"],NT="collectionGroupOverlayIndex",p3=["userId","collectionGroup","largestBatchId"],sy="globals",m3="name",OT=[fd,ys,lc,_a,cc,Fd,Na,uc,dc,pd,md,bp,_p],g3=[...OT,wp],VT=[fd,ys,lc,Sf,cc,Fd,Na,uc,dc,pd,md,bp,_p,wp],MT=VT,iy=[...MT,ry,Uu,ju],v3=iy,LT=[...iy,sy],y3=LT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg extends TT{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Bn(n,e){const t=Ae(n);return Ys.O(t.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z_(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Bo(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function $T(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function FT(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e,t){this.comparator=e,this.root=t||nr.EMPTY}insert(e,t){return new tn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nr.BLACK,null,null))}remove(e){return new tn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ch(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ch(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ch(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ch(this.root,e,this.comparator,!0)}}class Ch{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nr{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??nr.RED,this.left=s??nr.EMPTY,this.right=i??nr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new nr(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return nr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return nr.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ne(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ne(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ne(27949);return e+(this.isRed()?0:1)}}nr.EMPTY=null,nr.RED=!0,nr.BLACK=!1;nr.EMPTY=new class{constructor(){this.size=0}get key(){throw Ne(57766)}get value(){throw Ne(16141)}get color(){throw Ne(16727)}get left(){throw Ne(29726)}get right(){throw Ne(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new nr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.comparator=e,this.data=new tn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ew(this.data.getIterator())}getIteratorFrom(e){return new ew(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Bt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Bt(this.comparator);return t.data=e,t}}class ew{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Pl(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e){this.fields=e,e.sort(dn.comparator)}static empty(){return new Nr([])}unionWith(e){let t=new Bt(dn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Nr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sc(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mJ(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new UT("Invalid base64 string: "+i):i}}(e);return new Sn(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Sn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return st(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Sn.EMPTY_BYTE_STRING=new Sn("");const b3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ki(n){if(Fe(!!n,39018),typeof n=="string"){let e=0;const t=b3.exec(n);if(Fe(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:un(n.seconds),nanos:un(n.nanos)}}function un(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Di(n){return typeof n=="string"?Sn.fromBase64String(n):Sn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT="server_timestamp",qT="__type__",BT="__previous_value__",zT="__local_write_time__";function xp(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[qT])==null?void 0:r.stringValue)===jT}function Ep(n){const e=n.mapValue.fields[BT];return xp(e)?Ep(e):e}function gd(n){const e=ki(n.mapValue.fields[zT].timestampValue);return new jt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _3{constructor(e,t,r,s,i,o,a,l,c,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=f}}const vd="(default)";class ja{constructor(e,t){this.projectId=e,this.database=t||vd}static empty(){return new ja("","")}get isDefaultDatabase(){return this.database===vd}isEqual(e){return e instanceof ja&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy="__type__",HT="__max__",bo={mapValue:{fields:{__type__:{stringValue:HT}}}},ay="__vector__",hc="value",Zh={nullValue:"NULL_VALUE"};function ko(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xp(n)?4:WT(n)?9007199254740991:Ip(n)?10:11:Ne(28295,{value:n})}function ri(n,e){if(n===e)return!0;const t=ko(n);if(t!==ko(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return gd(n).isEqual(gd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=ki(s.timestampValue),a=ki(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return Di(s.bytesValue).isEqual(Di(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return un(s.geoPointValue.latitude)===un(i.geoPointValue.latitude)&&un(s.geoPointValue.longitude)===un(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return un(s.integerValue)===un(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=un(s.doubleValue),a=un(i.doubleValue);return o===a?hd(o)===hd(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return sc(n.arrayValue.values||[],e.arrayValue.values||[],ri);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Z_(o)!==Z_(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!ri(o[l],a[l])))return!1;return!0}(n,e);default:return Ne(52216,{left:n})}}function yd(n,e){return(n.values||[]).find(t=>ri(t,e))!==void 0}function Do(n,e){if(n===e)return 0;const t=ko(n),r=ko(e);if(t!==r)return st(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return st(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=un(i.integerValue||i.doubleValue),l=un(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return tw(n.timestampValue,e.timestampValue);case 4:return tw(gd(n),gd(e));case 5:return kg(n.stringValue,e.stringValue);case 6:return function(i,o){const a=Di(i),l=Di(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const f=st(a[c],l[c]);if(f!==0)return f}return st(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=st(un(i.latitude),un(o.latitude));return a!==0?a:st(un(i.longitude),un(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return nw(n.arrayValue,e.arrayValue);case 10:return function(i,o){var p,v,x,_;const a=i.fields||{},l=o.fields||{},c=(p=a[hc])==null?void 0:p.arrayValue,f=(v=l[hc])==null?void 0:v.arrayValue,h=st(((x=c==null?void 0:c.values)==null?void 0:x.length)||0,((_=f==null?void 0:f.values)==null?void 0:_.length)||0);return h!==0?h:nw(c,f)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===bo.mapValue&&o===bo.mapValue)return 0;if(i===bo.mapValue)return 1;if(o===bo.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},f=Object.keys(c);l.sort(),f.sort();for(let h=0;h<l.length&&h<f.length;++h){const p=kg(l[h],f[h]);if(p!==0)return p;const v=Do(a[l[h]],c[f[h]]);if(v!==0)return v}return st(l.length,f.length)}(n.mapValue,e.mapValue);default:throw Ne(23264,{he:t})}}function tw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return st(n,e);const t=ki(n),r=ki(e),s=st(t.seconds,r.seconds);return s!==0?s:st(t.nanos,r.nanos)}function nw(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Do(t[s],r[s]);if(i)return i}return st(t.length,r.length)}function fc(n){return $g(n)}function $g(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ki(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Di(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Te.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=$g(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${$g(t.fields[o])}`;return s+"}"}(n.mapValue):Ne(61005,{value:n})}function ef(n){switch(ko(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ep(n);return e?16+ef(e):16;case 5:return 2*n.stringValue.length;case 6:return Di(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+ef(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Bo(r.fields,(i,o)=>{s+=i.length+ef(o)}),s}(n.mapValue);default:throw Ne(13486,{value:n})}}function qa(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Fg(n){return!!n&&"integerValue"in n}function bd(n){return!!n&&"arrayValue"in n}function rw(n){return!!n&&"nullValue"in n}function sw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tf(n){return!!n&&"mapValue"in n}function Ip(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[oy])==null?void 0:r.stringValue)===ay}function qu(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Bo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=qu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qu(n.arrayValue.values[t]);return e}return{...n}}function WT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===HT}const KT={mapValue:{fields:{[oy]:{stringValue:ay},[hc]:{arrayValue:{}}}}};function w3(n){return"nullValue"in n?Zh:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?qa(ja.empty(),Te.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Ip(n)?KT:{mapValue:{}}:Ne(35942,{value:n})}function x3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?qa(ja.empty(),Te.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?KT:"mapValue"in n?Ip(n)?{mapValue:{}}:bo:Ne(61959,{value:n})}function iw(n,e){const t=Do(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ow(n,e){const t=Do(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this.value=e}static empty(){return new or({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!tf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qu(t)}setAll(e){let t=dn.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=qu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());tf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ri(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];tf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Bo(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new or(qu(this.value))}}function GT(n){const e=[];return Bo(n.fields,(t,r)=>{const s=new dn([t]);if(tf(r)){const i=GT(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Nr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new rn(e,0,He.min(),He.min(),He.min(),or.empty(),0)}static newFoundDocument(e,t,r,s){return new rn(e,1,t,He.min(),r,s,0)}static newNoDocument(e,t){return new rn(e,2,t,He.min(),He.min(),or.empty(),0)}static newUnknownDocument(e,t){return new rn(e,3,t,He.min(),He.min(),or.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(He.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=or.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=or.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=He.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof rn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e,t){this.position=e,this.inclusive=t}}function aw(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Te.comparator(Te.fromName(o.referenceValue),t.key):r=Do(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function lw(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!ri(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(e,t="asc"){this.field=e,this.dir=t}}function E3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT{}class xt extends QT{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new I3(e,t,r):t==="array-contains"?new A3(e,r):t==="in"?new t1(e,r):t==="not-in"?new P3(e,r):t==="array-contains-any"?new C3(e,r):new xt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new T3(e,r):new S3(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Do(t,this.value)):t!==null&&ko(this.value)===ko(t)&&this.matchesComparison(Do(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ne(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class qt extends QT{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new qt(e,t)}matches(e){return pc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function pc(n){return n.op==="and"}function Ug(n){return n.op==="or"}function ly(n){return JT(n)&&pc(n)}function JT(n){for(const e of n.filters)if(e instanceof qt)return!1;return!0}function jg(n){if(n instanceof xt)return n.field.canonicalString()+n.op.toString()+fc(n.value);if(ly(n))return n.filters.map(e=>jg(e)).join(",");{const e=n.filters.map(t=>jg(t)).join(",");return`${n.op}(${e})`}}function YT(n,e){return n instanceof xt?function(r,s){return s instanceof xt&&r.op===s.op&&r.field.isEqual(s.field)&&ri(r.value,s.value)}(n,e):n instanceof qt?function(r,s){return s instanceof qt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&YT(o,s.filters[a]),!0):!1}(n,e):void Ne(19439)}function XT(n,e){const t=n.filters.concat(e);return qt.create(t,n.op)}function ZT(n){return n instanceof xt?function(t){return`${t.field.canonicalString()} ${t.op} ${fc(t.value)}`}(n):n instanceof qt?function(t){return t.op.toString()+" {"+t.getFilters().map(ZT).join(" ,")+"}"}(n):"Filter"}class I3 extends xt{constructor(e,t,r){super(e,t,r),this.key=Te.fromName(r.referenceValue)}matches(e){const t=Te.comparator(e.key,this.key);return this.matchesComparison(t)}}class T3 extends xt{constructor(e,t){super(e,"in",t),this.keys=e1("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class S3 extends xt{constructor(e,t){super(e,"not-in",t),this.keys=e1("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function e1(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>Te.fromName(r.referenceValue))}class A3 extends xt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bd(t)&&yd(t.arrayValue,this.value)}}class t1 extends xt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&yd(this.value.arrayValue,t)}}class P3 extends xt{constructor(e,t){super(e,"not-in",t)}matches(e){if(yd(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!yd(this.value.arrayValue,t)}}class C3 extends xt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bd(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>yd(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function qg(n,e=null,t=[],r=[],s=null,i=null,o=null){return new R3(n,e,t,r,s,i,o)}function Ba(n){const e=Ae(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>jg(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),$d(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>fc(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>fc(r)).join(",")),e.Te=t}return e.Te}function Ud(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!E3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!YT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!lw(n.startAt,e.startAt)&&lw(n.endAt,e.endAt)}function Pf(n){return Te.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Cf(n,e){return n.filters.filter(t=>t instanceof xt&&t.field.isEqual(e))}function cw(n,e,t){let r=Zh,s=!0;for(const i of Cf(n,e)){let o=Zh,a=!0;switch(i.op){case"<":case"<=":o=w3(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Zh}iw({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];iw({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function uw(n,e,t){let r=bo,s=!0;for(const i of Cf(n,e)){let o=bo,a=!0;switch(i.op){case">=":case">":o=x3(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=bo}ow({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];ow({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function n1(n,e,t,r,s,i,o,a){return new Fi(n,e,t,r,s,i,o,a)}function Ac(n){return new Fi(n)}function dw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cy(n){return n.collectionGroup!==null}function Gl(n){const e=Ae(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Bt(dn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new _d(i,r))}),t.has(dn.keyField().canonicalString())||e.Ie.push(new _d(dn.keyField(),r))}return e.Ie}function gr(n){const e=Ae(n);return e.Ee||(e.Ee=s1(e,Gl(n))),e.Ee}function r1(n){const e=Ae(n);return e.de||(e.de=s1(e,n.explicitOrderBy)),e.de}function s1(n,e){if(n.limitType==="F")return qg(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new _d(s.field,i)});const t=n.endAt?new No(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new No(n.startAt.position,n.startAt.inclusive):null;return qg(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Bg(n,e){const t=n.filters.concat([e]);return new Fi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Rf(n,e,t){return new Fi(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function jd(n,e){return Ud(gr(n),gr(e))&&n.limitType===e.limitType}function i1(n){return`${Ba(gr(n))}|lt:${n.limitType}`}function Ml(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>ZT(s)).join(", ")}]`),$d(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>fc(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>fc(s)).join(",")),`Target(${r})`}(gr(n))}; limitType=${n.limitType})`}function qd(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Te.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Gl(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=aw(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,Gl(r),s)||r.endAt&&!function(o,a,l){const c=aw(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,Gl(r),s))}(n,e)}function o1(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function a1(n){return(e,t)=>{let r=!1;for(const s of Gl(n)){const i=k3(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function k3(n,e,t){const r=n.field.isKeyField()?Te.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Do(l,c):Ne(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ne(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Bo(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return FT(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D3=new tn(Te.comparator);function Or(){return D3}const l1=new tn(Te.comparator);function Iu(...n){let e=l1;for(const t of n)e=e.insert(t.key,t);return e}function c1(n){let e=l1;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Gs(){return Bu()}function u1(){return Bu()}function Bu(){return new Ui(n=>n.toString(),(n,e)=>n.isEqual(e))}const N3=new tn(Te.comparator),O3=new Bt(Te.comparator);function ft(...n){let e=O3;for(const t of n)e=e.add(t);return e}const V3=new Bt(st);function uy(){return V3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dy(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:hd(e)?"-0":e}}function d1(n){return{integerValue:""+n}}function h1(n,e){return AT(e)?d1(e):dy(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(){this._=void 0}}function M3(n,e,t){return n instanceof mc?function(s,i){const o={fields:{[qT]:{stringValue:jT},[zT]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&xp(i)&&(i=Ep(i)),i&&(o.fields[BT]=i),{mapValue:o}}(t,e):n instanceof za?p1(n,e):n instanceof Ha?m1(n,e):function(s,i){const o=f1(s,i),a=hw(o)+hw(s.Ae);return Fg(o)&&Fg(s.Ae)?d1(a):dy(s.serializer,a)}(n,e)}function L3(n,e,t){return n instanceof za?p1(n,e):n instanceof Ha?m1(n,e):t}function f1(n,e){return n instanceof gc?function(r){return Fg(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class mc extends Tp{}class za extends Tp{constructor(e){super(),this.elements=e}}function p1(n,e){const t=g1(e);for(const r of n.elements)t.some(s=>ri(s,r))||t.push(r);return{arrayValue:{values:t}}}class Ha extends Tp{constructor(e){super(),this.elements=e}}function m1(n,e){let t=g1(e);for(const r of n.elements)t=t.filter(s=>!ri(s,r));return{arrayValue:{values:t}}}class gc extends Tp{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function hw(n){return un(n.integerValue||n.doubleValue)}function g1(n){return bd(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e,t){this.field=e,this.transform=t}}function $3(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof za&&s instanceof za||r instanceof Ha&&s instanceof Ha?sc(r.elements,s.elements,ri):r instanceof gc&&s instanceof gc?ri(r.Ae,s.Ae):r instanceof mc&&s instanceof mc}(n.transform,e.transform)}class F3{constructor(e,t){this.version=e,this.transformResults=t}}class hn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new hn}static exists(e){return new hn(void 0,e)}static updateTime(e){return new hn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function nf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Sp{}function v1(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Cc(n.key,hn.none()):new Pc(n.key,n.data,hn.none());{const t=n.data,r=or.empty();let s=new Bt(dn.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new ji(n.key,r,new Nr(s.toArray()),hn.none())}}function U3(n,e,t){n instanceof Pc?function(s,i,o){const a=s.value.clone(),l=pw(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof ji?function(s,i,o){if(!nf(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=pw(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(y1(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function zu(n,e,t,r){return n instanceof Pc?function(i,o,a,l){if(!nf(i.precondition,o))return a;const c=i.value.clone(),f=mw(i.fieldTransforms,l,o);return c.setAll(f),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof ji?function(i,o,a,l){if(!nf(i.precondition,o))return a;const c=mw(i.fieldTransforms,l,o),f=o.data;return f.setAll(y1(i)),f.setAll(c),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(i,o,a){return nf(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function j3(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=f1(r.transform,s||null);i!=null&&(t===null&&(t=or.empty()),t.set(r.field,i))}return t||null}function fw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&sc(r,s,(i,o)=>$3(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Pc extends Sp{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ji extends Sp{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function y1(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function pw(n,e,t){const r=new Map;Fe(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,L3(o,a,t[s]))}return r}function mw(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,M3(i,o,e))}return r}class Cc extends Sp{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class hy extends Sp{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&U3(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=zu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=zu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=u1();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=v1(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(He.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ft())}isEqual(e){return this.batchId===e.batchId&&sc(this.mutations,e.mutations,(t,r)=>fw(t,r))&&sc(this.baseMutations,e.baseMutations,(t,r)=>fw(t,r))}}class py{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Fe(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return N3}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new py(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b1{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q3{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mn,St;function _1(n){switch(n){case Y.OK:return Ne(64938);case Y.CANCELLED:case Y.UNKNOWN:case Y.DEADLINE_EXCEEDED:case Y.RESOURCE_EXHAUSTED:case Y.INTERNAL:case Y.UNAVAILABLE:case Y.UNAUTHENTICATED:return!1;case Y.INVALID_ARGUMENT:case Y.NOT_FOUND:case Y.ALREADY_EXISTS:case Y.PERMISSION_DENIED:case Y.FAILED_PRECONDITION:case Y.ABORTED:case Y.OUT_OF_RANGE:case Y.UNIMPLEMENTED:case Y.DATA_LOSS:return!0;default:return Ne(15467,{code:n})}}function w1(n){if(n===void 0)return Dn("GRPC error has no .code"),Y.UNKNOWN;switch(n){case Mn.OK:return Y.OK;case Mn.CANCELLED:return Y.CANCELLED;case Mn.UNKNOWN:return Y.UNKNOWN;case Mn.DEADLINE_EXCEEDED:return Y.DEADLINE_EXCEEDED;case Mn.RESOURCE_EXHAUSTED:return Y.RESOURCE_EXHAUSTED;case Mn.INTERNAL:return Y.INTERNAL;case Mn.UNAVAILABLE:return Y.UNAVAILABLE;case Mn.UNAUTHENTICATED:return Y.UNAUTHENTICATED;case Mn.INVALID_ARGUMENT:return Y.INVALID_ARGUMENT;case Mn.NOT_FOUND:return Y.NOT_FOUND;case Mn.ALREADY_EXISTS:return Y.ALREADY_EXISTS;case Mn.PERMISSION_DENIED:return Y.PERMISSION_DENIED;case Mn.FAILED_PRECONDITION:return Y.FAILED_PRECONDITION;case Mn.ABORTED:return Y.ABORTED;case Mn.OUT_OF_RANGE:return Y.OUT_OF_RANGE;case Mn.UNIMPLEMENTED:return Y.UNIMPLEMENTED;case Mn.DATA_LOSS:return Y.DATA_LOSS;default:return Ne(39323,{code:n})}}(St=Mn||(Mn={}))[St.OK=0]="OK",St[St.CANCELLED=1]="CANCELLED",St[St.UNKNOWN=2]="UNKNOWN",St[St.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",St[St.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",St[St.NOT_FOUND=5]="NOT_FOUND",St[St.ALREADY_EXISTS=6]="ALREADY_EXISTS",St[St.PERMISSION_DENIED=7]="PERMISSION_DENIED",St[St.UNAUTHENTICATED=16]="UNAUTHENTICATED",St[St.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",St[St.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",St[St.ABORTED=10]="ABORTED",St[St.OUT_OF_RANGE=11]="OUT_OF_RANGE",St[St.UNIMPLEMENTED=12]="UNIMPLEMENTED",St[St.INTERNAL=13]="INTERNAL",St[St.UNAVAILABLE=14]="UNAVAILABLE",St[St.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Hu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x1(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B3=new To([4294967295,4294967295],0);function gw(n){const e=x1().encode(n),t=new dT;return t.update(e),new Uint8Array(t.digest())}function vw(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new To([t,r],0),new To([s,i],0)]}class gy{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Tu(`Invalid padding: ${t}`);if(r<0)throw new Tu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Tu(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Tu(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=To.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(To.fromNumber(r)));return s.compare(B3)===1&&(s=new To([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=gw(e),[r,s]=vw(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new gy(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const t=gw(e),[r,s]=vw(t);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Tu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zd{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Hd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new zd(He.min(),s,new tn(st),Or(),ft())}}class Hd{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Hd(r,t,ft(),ft(),ft())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class E1{constructor(e,t){this.targetId=e,this.Ce=t}}class I1{constructor(e,t,r=Sn.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class yw{constructor(){this.ve=0,this.Fe=bw(),this.Me=Sn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ft(),t=ft(),r=ft();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ne(38017,{changeType:i})}}),new Hd(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=bw()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Fe(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class z3{constructor(e){this.Ge=e,this.ze=new Map,this.je=Or(),this.Je=Rh(),this.He=Rh(),this.Ye=new tn(st)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:Ne(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(Pf(i))if(r===0){const o=new Te(i.path);this.et(t,o,rn.newNoDocument(o,He.min()))}else Fe(r===1,20013,{expectedCount:r});else{const o=this._t(t);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,c)}Hu==null||Hu.lt(function(f,h,p,v,x){var T,N,I;const _={localCacheCount:f,existenceFilterCount:h.count,databaseId:p.database,projectId:p.projectId},w=h.unchangedNames;return w&&(_.bloomFilter={applied:x===0,hashCount:(w==null?void 0:w.hashCount)??0,bitmapLength:((N=(T=w==null?void 0:w.bits)==null?void 0:T.bitmap)==null?void 0:N.length)??0,padding:((I=w==null?void 0:w.bits)==null?void 0:I.padding)??0,mightContain:j=>(v==null?void 0:v.mightContain(j))??!1}),_}(o,e.Ce,this.Ge.ht(),a,l))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=Di(r).toUint8Array()}catch(l){if(l instanceof UT)return as("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new gy(o,s,i)}catch(l){return as(l instanceof Tu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(t,i,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Pf(a.target)){const l=new Te(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,rn.newNoDocument(l,e))}i.Be&&(t.set(o,i.ke()),i.qe())}});let r=ft();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new zd(e,t,this.Ye,this.je,r);return this.je=Or(),this.Je=Rh(),this.He=Rh(),this.Ye=new tn(st),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new yw,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Bt(st),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Bt(st),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||ve("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new yw),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Rh(){return new tn(Te.comparator)}function bw(){return new tn(Te.comparator)}const H3=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),W3=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),K3=(()=>({and:"AND",or:"OR"}))();class G3{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function zg(n,e){return n.useProto3Json||$d(e)?e:{value:e}}function vc(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function T1(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Q3(n,e){return vc(n,e.toTimestamp())}function Nn(n){return Fe(!!n,49232),He.fromTimestamp(function(t){const r=ki(t);return new jt(r.seconds,r.nanos)}(n))}function vy(n,e){return Hg(n,e).canonicalString()}function Hg(n,e){const t=function(s){return new vt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function S1(n){const e=vt.fromString(n);return Fe(V1(e),10190,{key:e.toString()}),e}function wd(n,e){return vy(n.databaseId,e.path)}function Xs(n,e){const t=S1(e);if(t.get(1)!==n.databaseId.projectId)throw new he(Y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new he(Y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Te(C1(t))}function A1(n,e){return vy(n.databaseId,e)}function P1(n){const e=S1(n);return e.length===4?vt.emptyPath():C1(e)}function Wg(n){return new vt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function C1(n){return Fe(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function _w(n,e,t){return{name:wd(n,e),fields:t.value.mapValue.fields}}function Ap(n,e,t){const r=Xs(n,e.name),s=Nn(e.updateTime),i=e.createTime?Nn(e.createTime):He.min(),o=new or({mapValue:{fields:e.fields}}),a=rn.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function J3(n,e){return"found"in e?function(r,s){Fe(!!s.found,43571),s.found.name,s.found.updateTime;const i=Xs(r,s.found.name),o=Nn(s.found.updateTime),a=s.found.createTime?Nn(s.found.createTime):He.min(),l=new or({mapValue:{fields:s.found.fields}});return rn.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Fe(!!s.missing,3894),Fe(!!s.readTime,22933);const i=Xs(r,s.missing),o=Nn(s.readTime);return rn.newNoDocument(i,o)}(n,e):Ne(7234,{result:e})}function Y3(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ne(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,f){return c.useProto3Json?(Fe(f===void 0||typeof f=="string",58123),Sn.fromBase64String(f||"")):(Fe(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Sn.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const f=c.code===void 0?Y.UNKNOWN:w1(c.code);return new he(f,c.message||"")}(o);t=new I1(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Xs(n,r.document.name),i=Nn(r.document.updateTime),o=r.document.createTime?Nn(r.document.createTime):He.min(),a=new or({mapValue:{fields:r.document.fields}}),l=rn.newFoundDocument(s,i,o,a),c=r.targetIds||[],f=r.removedTargetIds||[];t=new rf(c,f,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Xs(n,r.document),i=r.readTime?Nn(r.readTime):He.min(),o=rn.newNoDocument(s,i),a=r.removedTargetIds||[];t=new rf([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Xs(n,r.document),i=r.removedTargetIds||[];t=new rf([],i,s,null)}else{if(!("filter"in e))return Ne(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new q3(s,i),a=r.targetId;t=new E1(a,o)}}return t}function xd(n,e){let t;if(e instanceof Pc)t={update:_w(n,e.key,e.value)};else if(e instanceof Cc)t={delete:wd(n,e.key)};else if(e instanceof ji)t={update:_w(n,e.key,e.data),updateMask:r4(e.fieldMask)};else{if(!(e instanceof hy))return Ne(16599,{Vt:e.type});t={verify:wd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof mc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof za)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ha)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof gc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw Ne(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Q3(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ne(27497)}(n,e.precondition)),t}function Kg(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?hn.updateTime(Nn(i.updateTime)):i.exists!==void 0?hn.exists(i.exists):hn.none()}(e.currentDocument):hn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Fe(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new mc;else if("appendMissingElements"in a){const f=a.appendMissingElements.values||[];l=new za(f)}else if("removeAllFromArray"in a){const f=a.removeAllFromArray.values||[];l=new Ha(f)}else"increment"in a?l=new gc(o,a.increment):Ne(16584,{proto:a});const c=dn.fromServerFormat(a.fieldPath);return new Bd(c,l)}(n,s)):[];if(e.update){e.update.name;const s=Xs(n,e.update.name),i=new or({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Nr(c.map(f=>dn.fromServerFormat(f)))}(e.updateMask);return new ji(s,i,o,t,r)}return new Pc(s,i,t,r)}if(e.delete){const s=Xs(n,e.delete);return new Cc(s,t)}if(e.verify){const s=Xs(n,e.verify);return new hy(s,t)}return Ne(1463,{proto:e})}function X3(n,e){return n&&n.length>0?(Fe(e!==void 0,14353),n.map(t=>function(s,i){let o=s.updateTime?Nn(s.updateTime):Nn(i);return o.isEqual(He.min())&&(o=Nn(i)),new F3(o,s.transformResults||[])}(t,e))):[]}function R1(n,e){return{documents:[A1(n,e.path)]}}function Pp(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=A1(n,s);const i=function(c){if(c.length!==0)return O1(qt.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(f=>function(p){return{field:ho(p.field),direction:e4(p.dir)}}(f))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=zg(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:t,parent:s}}function k1(n,e,t,r){const{ft:s,parent:i}=Pp(n,e),o={},a=[];let l=0;return t.forEach(c=>{const f=r?c.alias:"aggregate_"+l++;o[f]=c.alias,c.aggregateType==="count"?a.push({alias:f,count:{}}):c.aggregateType==="avg"?a.push({alias:f,avg:{field:ho(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:f,sum:{field:ho(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function D1(n){let e=P1(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Fe(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=function(h){const p=N1(h);return p instanceof qt&&ly(p)?p.getFilters():[p]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(p=>function(x){return new _d(Ll(x.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(p))}(t.orderBy));let a=null;t.limit&&(a=function(h){let p;return p=typeof h=="object"?h.value:h,$d(p)?null:p}(t.limit));let l=null;t.startAt&&(l=function(h){const p=!!h.before,v=h.values||[];return new No(v,p)}(t.startAt));let c=null;return t.endAt&&(c=function(h){const p=!h.before,v=h.values||[];return new No(v,p)}(t.endAt)),n1(e,s,o,i,a,"F",l,c)}function Z3(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ne(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function N1(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ll(t.unaryFilter.field);return xt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ll(t.unaryFilter.field);return xt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ll(t.unaryFilter.field);return xt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ll(t.unaryFilter.field);return xt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ne(61313);default:return Ne(60726)}}(n):n.fieldFilter!==void 0?function(t){return xt.create(Ll(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ne(58110);default:return Ne(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return qt.create(t.compositeFilter.filters.map(r=>N1(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ne(1026)}}(t.compositeFilter.op))}(n):Ne(30097,{filter:n})}function e4(n){return H3[n]}function t4(n){return W3[n]}function n4(n){return K3[n]}function ho(n){return{fieldPath:n.canonicalString()}}function Ll(n){return dn.fromServerFormat(n.fieldPath)}function O1(n){return n instanceof xt?function(t){if(t.op==="=="){if(sw(t.value))return{unaryFilter:{field:ho(t.field),op:"IS_NAN"}};if(rw(t.value))return{unaryFilter:{field:ho(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sw(t.value))return{unaryFilter:{field:ho(t.field),op:"IS_NOT_NAN"}};if(rw(t.value))return{unaryFilter:{field:ho(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ho(t.field),op:t4(t.op),value:t.value}}}(n):n instanceof qt?function(t){const r=t.getFilters().map(s=>O1(s));return r.length===1?r[0]:{compositeFilter:{op:n4(t.op),filters:r}}}(n):Ne(54877,{filter:n})}function r4(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function V1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,t,r,s,i=He.min(),o=He.min(),a=Sn.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new wi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new wi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(e){this.yt=e}}function s4(n,e){let t;if(e.document)t=Ap(n.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Te.fromSegments(e.noDocument.path),s=Ka(e.noDocument.readTime);t=rn.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ne(56709);{const r=Te.fromSegments(e.unknownDocument.path),s=Ka(e.unknownDocument.version);t=rn.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new jt(s[0],s[1]);return He.fromTimestamp(i)}(e.readTime)),t}function ww(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:kf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:wd(i,o.key),fields:o.data.value.mapValue.fields,updateTime:vc(i,o.version.toTimestamp()),createTime:vc(i,o.createTime.toTimestamp())}}(n.yt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Wa(e.version)};else{if(!e.isUnknownDocument())return Ne(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Wa(e.version)}}return r}function kf(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Wa(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ka(n){const e=new jt(n.seconds,n.nanoseconds);return He.fromTimestamp(e)}function Ea(n,e){const t=(e.baseMutations||[]).map(i=>Kg(n.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Kg(n.yt,i)),s=jt.fromMillis(e.localWriteTimeMs);return new fy(e.batchId,s,t,r)}function Su(n){const e=Ka(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ka(n.lastLimboFreeSnapshotVersion):He.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){const o=i.documents.length;return Fe(o===1,1966,{count:o}),gr(Ac(P1(i.documents[0])))}(n.query):function(i){return gr(D1(i))}(n.query),new wi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Sn.fromBase64String(n.resumeToken))}function L1(n,e){const t=Wa(e.snapshotVersion),r=Wa(e.lastLimboFreeSnapshotVersion);let s;s=Pf(e.target)?R1(n.yt,e.target):Pp(n.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ba(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Cp(n){const e=D1({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Rf(e,e.limit,"L"):e}function zm(n,e){return new my(e.largestBatchId,Kg(n.yt,e.overlayMutation))}function xw(n,e){const t=e.path.lastSegment();return[n,mr(e.path.popLast()),t]}function Ew(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Wa(r.readTime),documentKey:mr(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i4{getBundleMetadata(e,t){return Iw(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Ka(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return Iw(e).put(function(s){return{bundleId:s.id,createTime:Wa(Nn(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return Tw(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Cp(i.bundledQuery),readTime:Ka(i.readTime)}}(r)})}saveNamedQuery(e,t){return Tw(e).put(function(s){return{name:s.name,readTime:Wa(Nn(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function Iw(n){return Bn(n,bp)}function Tw(n){return Bn(n,_p)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const r=t.uid||"";return new Rp(e,r)}getOverlay(e,t){return du(e).get(xw(this.userId,t)).next(r=>r?zm(this.serializer,r):null)}getOverlays(e,t){const r=Gs();return J.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new my(t,o);s.push(this.St(e,a))}),J.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(mr(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(du(e).Z(Mg,a))}),J.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Gs(),i=mr(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return du(e).J(Mg,o).next(a=>{for(const l of a){const c=zm(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Gs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return du(e).ee({index:NT,range:a},(l,c,f)=>{const h=zm(this.serializer,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):f.done()}).next(()=>i)}St(e,t){return du(e).put(function(s,i,o){const[a,l,c]=xw(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:xd(s.yt,o.mutation)}}(this.serializer,this.userId,t))}}function du(n){return Bn(n,wp)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4{bt(e){return Bn(e,sy)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?Sn.fromUint8Array(r):Sn.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(un(e.integerValue));else if("doubleValue"in e){const r=un(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),hd(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=ki(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Di(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?WT(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Ip(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Ne(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const s of Object.keys(r))this.Ot(s,t),this.Ct(r[s],t)}kt(e,t){var o,a;const r=e.fields||{};this.Ft(t,53);const s=hc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(t,15),t.Mt(un(i)),this.Ot(s,t),this.Ct(r[s],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const s of r)this.Ct(s,t)}Lt(e,t){this.Ft(t,37),Te.fromName(e).path.forEach(r=>{this.Ft(t,60),this.Ut(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}Ia.Kt=new Ia;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl=255;function a4(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function Sw(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=a4(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class l4{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=t.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=t.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const t=this.en(e),r=Sw(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}nn(e){const t=this.en(e),r=Sw(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}rn(){this.sn(Cl),this.sn(255)}_n(){this.an(Cl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Gt(e){const t=255&e;t===0?(this.sn(0),this.sn(255)):t===Cl?(this.sn(Cl),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;t===0?(this.an(0),this.an(255)):t===Cl?(this.an(Cl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class c4{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class u4{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class hu{constructor(){this.cn=new l4,this.ln=new c4(this.cn),this.hn=new u4(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e,t,r,s){this.Tn=e,this.In=t,this.En=r,this.dn=s}An(){const e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new Ta(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:sf(this.En),directionalValue:sf(this.dn),orderedDocumentKey:sf(t),documentKey:r.path.toArray()}}Vn(e,t,r){const s=this.Rn(e,t,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function to(n,e){let t=n.Tn-e.Tn;return t!==0?t:(t=Aw(n.En,e.En),t!==0?t:(t=Aw(n.dn,e.dn),t!==0?t:Te.comparator(n.In,e.In)))}function Aw(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function sf(n){return DI()?function(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}(n):n}function Pw(n){return typeof n!="string"?n:function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(n)}class Cw{constructor(e){this.mn=new Bt((t,r)=>dn.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const r=t;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(Fe(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Ng(e);if(t!==void 0&&!this.wn(t))return!1;const r=ba(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Bt(dn.comparator);const t=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Da(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Da(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Da(r.field,r.dir==="asc"?0:1)));return new oc(oc.UNKNOWN_ID,this.collectionId,t,ac.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $1(n){var t,r;if(Fe(n instanceof xt||n instanceof qt,20012),n instanceof xt){if(n instanceof t1){const s=((r=(t=n.value.arrayValue)==null?void 0:t.values)==null?void 0:r.map(i=>xt.create(n.field,"==",i)))||[];return qt.create(s,"or")}return n}const e=n.filters.map(s=>$1(s));return qt.create(e,n.op)}function d4(n){if(n.getFilters().length===0)return[];const e=Jg($1(n));return Fe(F1(e),7391),Gg(e)||Qg(e)?[e]:e.getFilters()}function Gg(n){return n instanceof xt}function Qg(n){return n instanceof qt&&ly(n)}function F1(n){return Gg(n)||Qg(n)||function(t){if(t instanceof qt&&Ug(t)){for(const r of t.getFilters())if(!Gg(r)&&!Qg(r))return!1;return!0}return!1}(n)}function Jg(n){if(Fe(n instanceof xt||n instanceof qt,34018),n instanceof xt)return n;if(n.filters.length===1)return Jg(n.filters[0]);const e=n.filters.map(r=>Jg(r));let t=qt.create(e,n.op);return t=Df(t),F1(t)?t:(Fe(t instanceof qt,64498),Fe(pc(t),40251),Fe(t.filters.length>1,57927),t.filters.reduce((r,s)=>yy(r,s)))}function yy(n,e){let t;return Fe(n instanceof xt||n instanceof qt,38388),Fe(e instanceof xt||e instanceof qt,25473),t=n instanceof xt?e instanceof xt?function(s,i){return qt.create([s,i],"and")}(n,e):Rw(n,e):e instanceof xt?Rw(e,n):function(s,i){if(Fe(s.filters.length>0&&i.filters.length>0,48005),pc(s)&&pc(i))return XT(s,i.getFilters());const o=Ug(s)?s:i,a=Ug(s)?i:s,l=o.filters.map(c=>yy(c,a));return qt.create(l,"or")}(n,e),Df(t)}function Rw(n,e){if(pc(e))return XT(e,n.getFilters());{const t=e.filters.map(r=>yy(n,r));return qt.create(t,"or")}}function Df(n){if(Fe(n instanceof xt||n instanceof qt,11850),n instanceof xt)return n;const e=n.getFilters();if(e.length===1)return Df(e[0]);if(JT(n))return n;const t=e.map(s=>Df(s)),r=[];return t.forEach(s=>{s instanceof xt?r.push(s):s instanceof qt&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:qt.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4{constructor(){this.Cn=new by}addToCollectionParentIndex(e,t){return this.Cn.add(t),J.resolve()}getCollectionParents(e,t){return J.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return J.resolve()}deleteFieldIndex(e,t){return J.resolve()}deleteAllFieldIndexes(e){return J.resolve()}createTargetIndexes(e,t){return J.resolve()}getDocumentsMatchingTarget(e,t){return J.resolve(null)}getIndexType(e,t){return J.resolve(0)}getFieldIndexes(e,t){return J.resolve([])}getNextCollectionGroupToUpdate(e){return J.resolve(null)}getMinOffset(e,t){return J.resolve(Jr.min())}getMinOffsetFromCollectionGroup(e,t){return J.resolve(Jr.min())}updateCollectionGroup(e,t,r){return J.resolve()}updateIndexEntries(e,t){return J.resolve()}}class by{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Bt(vt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Bt(vt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kw="IndexedDbIndexManager",kh=new Uint8Array(0);class f4{constructor(e,t){this.databaseId=t,this.vn=new by,this.Fn=new Ui(r=>Ba(r),(r,s)=>Ud(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const i={collectionId:r,parent:mr(s)};return Dw(e).put(i)}return J.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[bT(t),""],!1,!0);return Dw(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ks(o.parent))}return r})}addFieldIndex(e,t){const r=fu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=kl(e);return i.next(a=>{o.put(Ew(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=fu(e),s=kl(e),i=Rl(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=fu(e),r=Rl(e),s=kl(e);return t.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,t){return J.forEach(this.Mn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Cw(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Rl(e);let s=!0;const i=new Map;return J.forEach(this.Mn(t),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=ft();const a=[];return J.forEach(i,(l,c)=>{ve(kw,`Using index ${function(I){return`id=${I.indexId}|cg=${I.collectionGroup}|f=${I.fields.map(j=>`${j.fieldPath}:${j.kind}`).join(",")}`}(l)} to execute ${Ba(t)}`);const f=function(I,j){const ne=Ng(j);if(ne===void 0)return null;for(const ae of Cf(I,ne.fieldPath))switch(ae.op){case"array-contains-any":return ae.value.arrayValue.values||[];case"array-contains":return[ae.value]}return null}(c,l),h=function(I,j){const ne=new Map;for(const ae of ba(j))for(const V of Cf(I,ae.fieldPath))switch(V.op){case"==":case"in":ne.set(ae.fieldPath.canonicalString(),V.value);break;case"not-in":case"!=":return ne.set(ae.fieldPath.canonicalString(),V.value),Array.from(ne.values())}return null}(c,l),p=function(I,j){const ne=[];let ae=!0;for(const V of ba(j)){const P=V.kind===0?cw(I,V.fieldPath,I.startAt):uw(I,V.fieldPath,I.startAt);ne.push(P.value),ae&&(ae=P.inclusive)}return new No(ne,ae)}(c,l),v=function(I,j){const ne=[];let ae=!0;for(const V of ba(j)){const P=V.kind===0?uw(I,V.fieldPath,I.endAt):cw(I,V.fieldPath,I.endAt);ne.push(P.value),ae&&(ae=P.inclusive)}return new No(ne,ae)}(c,l),x=this.On(l,c,p),_=this.On(l,c,v),w=this.Nn(l,c,h),T=this.Bn(l.indexId,f,x,p.inclusive,_,v.inclusive,w);return J.forEach(T,N=>r.Y(N,t.limit).next(I=>{I.forEach(j=>{const ne=Te.fromSegments(j.documentKey);o.has(ne)||(o=o.add(ne),a.push(ne))})}))}).next(()=>a)}return J.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=d4(qt.create(e.filters,"and")).map(r=>qg(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),f=[];for(let h=0;h<l;++h){const p=t?this.Ln(t[h/c]):kh,v=this.kn(e,p,r[h%c],s),x=this.qn(e,p,i[h%c],o),_=a.map(w=>this.kn(e,p,w,!0));f.push(...this.createRange(v,x,_))}return f}kn(e,t,r,s){const i=new Ta(e,Te.empty(),t,r);return s?i:i.An()}qn(e,t,r,s){const i=new Ta(e,Te.empty(),t,r);return s?i.An():i}xn(e,t){const r=new Cw(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Mn(t);return J.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Bt(dn.comparator),f=!1;for(const h of l.filters)for(const p of h.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?f=!0:c=c.add(p.field));for(const h of l.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(f?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Qn(e,t){const r=new hu;for(const s of ba(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);Ia.Kt.Dt(i,o)}return r.un()}Ln(e){const t=new hu;return Ia.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const r=new hu;return Ia.Kt.Dt(qa(this.databaseId,t),r.Pn(function(i){const o=ba(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,t,r){if(r===null)return[];let s=[];s.push(new hu);let i=0;for(const o of ba(e)){const a=r[i++];for(const l of s)if(this.Un(t,o.fieldPath)&&bd(a))s=this.Kn(s,o,a);else{const c=l.Pn(o.kind);Ia.Kt.Dt(a,c)}}return this.Wn(s)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new hu;l.seed(a.un()),Ia.Kt.Dt(o,l.Pn(t.kind)),i.push(l)}return i}Un(e,t){return!!e.filters.find(r=>r instanceof xt&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=fu(e),s=kl(e);return(t?r.J(Vg,IDBKeyRange.bound(t,t)):r.J()).next(i=>{const o=[];return J.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(f,h){const p=h?new ac(h.sequenceNumber,new Jr(Ka(h.readTime),new Te(Ks(h.documentKey)),h.largestBatchId)):ac.empty(),v=f.fields.map(([x,_])=>new Da(dn.fromServerFormat(x),_));return new oc(f.indexId,f.collectionGroup,v,p)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:st(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=fu(e),i=kl(e);return this.Gn(e).next(o=>s.J(Vg,IDBKeyRange.bound(t,t)).next(a=>J.forEach(a,l=>i.put(Ew(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return J.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?J.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),J.forEach(a,l=>this.zn(e,s,l).next(c=>{const f=this.jn(i,l);return c.isEqual(f)?J.resolve():this.Jn(e,i,l,c,f)}))))})}Hn(e,t,r,s){return Rl(e).put(s.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,s){return Rl(e).delete(s.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){const s=Rl(e);let i=new Bt(to);return s.ee({index:DT,range:IDBKeyRange.only([r.indexId,this.uid,sf(this.$n(r,t))])},(o,a)=>{i=i.add(new Ta(r.indexId,t,Pw(a.arrayValue),Pw(a.directionalValue)))}).next(()=>i)}jn(e,t){let r=new Bt(to);const s=this.Qn(t,e);if(s==null)return r;const i=Ng(t);if(i!=null){const o=e.data.field(i.fieldPath);if(bd(o))for(const a of o.arrayValue.values||[])r=r.add(new Ta(t.indexId,e.key,this.Ln(a),s))}else r=r.add(new Ta(t.indexId,e.key,kh,s));return r}Jn(e,t,r,s,i){ve(kw,"Updating index entries for document '%s'",t.key);const o=[];return function(l,c,f,h,p){const v=l.getIterator(),x=c.getIterator();let _=Pl(v),w=Pl(x);for(;_||w;){let T=!1,N=!1;if(_&&w){const I=f(_,w);I<0?N=!0:I>0&&(T=!0)}else _!=null?N=!0:T=!0;T?(h(w),w=Pl(x)):N?(p(_),_=Pl(v)):(_=Pl(v),w=Pl(x))}}(s,i,to,a=>{o.push(this.Hn(e,t,r,a))},a=>{o.push(this.Yn(e,t,r,a))}),J.waitFor(o)}Gn(e){let t=1;return kl(e).ee({index:kT,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>to(o,a)).filter((o,a,l)=>!a||to(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=to(o,e),l=to(o,t);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,kh,Te.empty()),l=s[o+1].Vn(this.uid,kh,Te.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,t){return to(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Nw)}getMinOffset(e,t){return J.mapArray(this.Mn(t),r=>this.xn(e,r).next(s=>s||Ne(44426))).next(Nw)}}function Dw(n){return Bn(n,md)}function Rl(n){return Bn(n,ju)}function fu(n){return Bn(n,ry)}function kl(n){return Bn(n,Uu)}function Nw(n){Fe(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;ey(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Jr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ow={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},U1=41943040;class ur{static withCacheSize(e){return new ur(e,ur.DEFAULT_COLLECTION_PERCENTILE,ur.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j1(n,e,t){const r=n.store(ys),s=n.store(lc),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.ee({range:o},(f,h,p)=>(a++,p.delete()));i.push(l.next(()=>{Fe(a===1,47070,{batchId:t.batchId})}));const c=[];for(const f of t.mutations){const h=PT(e,f.key.path,t.batchId);i.push(s.delete(h)),c.push(f.key)}return J.waitFor(i).next(()=>c)}function Nf(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ne(14731);e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ur.DEFAULT_COLLECTION_PERCENTILE=10,ur.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ur.DEFAULT=new ur(U1,ur.DEFAULT_COLLECTION_PERCENTILE,ur.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ur.DISABLED=new ur(-1,0,0);class kp{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,t,r,s){Fe(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new kp(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return no(e).ee({index:Ca,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=$l(e),o=no(e);return o.add({}).next(a=>{Fe(typeof a=="number",49019);const l=new fy(a,t,r,s),c=function(v,x,_){const w=_.baseMutations.map(N=>xd(v.yt,N)),T=_.mutations.map(N=>xd(v.yt,N));return{userId:x,batchId:_.batchId,localWriteTimeMs:_.localWriteTime.toMillis(),baseMutations:w,mutations:T}}(this.serializer,this.userId,l),f=[];let h=new Bt((p,v)=>st(p.canonicalString(),v.canonicalString()));for(const p of s){const v=PT(this.userId,p.key.path,a);h=h.add(p.key.path.popLast()),f.push(o.put(c)),f.push(i.put(v,QV))}return h.forEach(p=>{f.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),J.waitFor(f).next(()=>l)})}lookupMutationBatch(e,t){return no(e).get(t).next(r=>r?(Fe(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Ea(this.serializer,r)):null)}er(e,t){return this.Xn[t]?J.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return no(e).ee({index:Ca,range:s},(o,a,l)=>{a.userId===this.userId&&(Fe(a.batchId>=r,47524,{tr:r}),i=Ea(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=So;return no(e).ee({index:Ca,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,So],[this.userId,Number.POSITIVE_INFINITY]);return no(e).J(Ca,t).next(r=>r.map(s=>Ea(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Yh(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return $l(e).ee({range:s},(o,a,l)=>{const[c,f,h]=o,p=Ks(f);if(c===this.userId&&t.path.isEqual(p))return no(e).get(h).next(v=>{if(!v)throw Ne(61480,{nr:o,batchId:h});Fe(v.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:v.userId,batchId:h}),i.push(Ea(this.serializer,v))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Bt(st);const s=[];return t.forEach(i=>{const o=Yh(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=$l(e).ee({range:a},(c,f,h)=>{const[p,v,x]=c,_=Ks(v);p===this.userId&&i.path.isEqual(_)?r=r.add(x):h.done()});s.push(l)}),J.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Yh(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Bt(st);return $l(e).ee({range:o},(l,c,f)=>{const[h,p,v]=l,x=Ks(p);h===this.userId&&r.isPrefixOf(x)?x.length===s&&(a=a.add(v)):f.done()}).next(()=>this.rr(e,a))}rr(e,t){const r=[],s=[];return t.forEach(i=>{s.push(no(e).get(i).next(o=>{if(o===null)throw Ne(35274,{batchId:i});Fe(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(Ea(this.serializer,o))}))}),J.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return j1(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),J.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return J.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return $l(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=Ks(i[1]);s.push(l)}else a.done()}).next(()=>{Fe(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,t){return q1(e,this.userId,t)}_r(e){return B1(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:So,lastStreamToken:""})}}function q1(n,e,t){const r=Yh(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return $l(n).ee({range:i,X:!0},(a,l,c)=>{const[f,h,p]=a;f===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function no(n){return Bn(n,ys)}function $l(n){return Bn(n,lc)}function B1(n){return Bn(n,fd)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ga(0)}static cr(){return new Ga(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const r=new Ga(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>He.fromTimestamp(new jt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.hr(e,s)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Dl(e).delete(t.targetId)).next(()=>this.lr(e)).next(r=>(Fe(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Dl(e).ee((o,a)=>{const l=Su(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>J.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Dl(e).ee((r,s)=>{const i=Su(s);t(i)})}lr(e){return Vw(e).get(Af).next(t=>(Fe(t!==null,2888),t))}hr(e,t){return Vw(e).put(Af,t)}Pr(e,t){return Dl(e).put(L1(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Ba(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Dl(e).ee({range:s,index:RT},(o,a,l)=>{const c=Su(a);Ud(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=fo(e);return t.forEach(o=>{const a=mr(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),J.waitFor(s)}removeMatchingKeys(e,t,r){const s=fo(e);return J.forEach(t,i=>{const o=mr(i.path);return J.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=fo(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=fo(e);let i=ft();return s.ee({range:r,X:!0},(o,a,l)=>{const c=Ks(o[1]),f=new Te(c);i=i.add(f)}).next(()=>i)}containsKey(e,t){const r=mr(t.path),s=IDBKeyRange.bound([r],[bT(r)],!1,!0);let i=0;return fo(e).ee({index:ny,X:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}At(e,t){return Dl(e).get(t).next(r=>r?Su(r):null)}}function Dl(n){return Bn(n,cc)}function Vw(n){return Bn(n,Na)}function fo(n){return Bn(n,uc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mw="LruGarbageCollector",z1=1048576;function Lw([n,e],[t,r]){const s=st(n,t);return s===0?st(e,r):s}class m4{constructor(e){this.Ir=e,this.buffer=new Bt(Lw),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Lw(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class H1{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ve(Mw,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){qo(t)?ve(Mw,"Ignoring IndexedDB error during garbage collection: ",t):await jo(t)}await this.Vr(3e5)})}}class g4{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return J.resolve(Dr.ce);const r=new m4(t);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ve("LruGarbageCollector","Garbage collection skipped; disabled"),J.resolve(Ow)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ve("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ow):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,o,a,l,c;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(ve("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Vl()<=_t.DEBUG&&ve("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-f}ms`),J.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function W1(n,e){return new g4(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4{constructor(e,t){this.db=e,this.garbageCollector=W1(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(r,s)=>t(s))}addReference(e,t,r){return Dh(e,r)}removeReference(e,t,r){return Dh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Dh(e,t)}br(e,t){return function(s,i){let o=!1;return B1(s).te(a=>q1(s,a,i).next(l=>(l&&(o=!0),J.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=t){const l=this.br(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,He.min()),fo(e).delete(function(h){return[0,mr(h.path)]}(o))))});s.push(l)}}).next(()=>J.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Dh(e,t)}Sr(e,t){const r=fo(e);let s,i=Dr.ce;return r.ee({index:ny},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Dr.ce&&t(new Te(Ks(s)),i),i=c,s=l):i=Dr.ce}).next(()=>{i!==Dr.ce&&t(new Te(Ks(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Dh(n,e){return fo(n).put(function(r,s){return{targetId:0,path:mr(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K1{constructor(){this.changes=new Ui(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?J.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ga(e).put(r)}removeEntry(e,t,r){return ga(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],kf(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=rn.newInvalidDocument(t);return ga(e).ee({index:Xh,range:IDBKeyRange.only(pu(t))},(s,i)=>{r=this.Cr(t,i)}).next(()=>r)}vr(e,t){let r={size:0,document:rn.newInvalidDocument(t)};return ga(e).ee({index:Xh,range:IDBKeyRange.only(pu(t))},(s,i)=>{r={document:this.Cr(t,i),size:Nf(i)}}).next(()=>r)}getEntries(e,t){let r=Or();return this.Fr(e,t,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,t){let r=Or(),s=new tn(Te.comparator);return this.Fr(e,t,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,Nf(o))}).next(()=>({documents:r,Or:s}))}Fr(e,t,r){if(t.isEmpty())return J.resolve();let s=new Bt(Uw);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(pu(s.first()),pu(s.last())),o=s.getIterator();let a=o.getNext();return ga(e).ee({index:Xh,range:i},(l,c,f)=>{const h=Te.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Uw(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?f.j(pu(a)):f.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),kf(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ga(e).J(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let f=Or();for(const h of c){const p=this.Cr(Te.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);p.isFoundDocument()&&(qd(t,p)||s.has(p.key))&&(f=f.insert(p.key,p))}return f})}getAllFromCollectionGroup(e,t,r,s){let i=Or();const o=Fw(t,r),a=Fw(t,Jr.max());return ga(e).ee({index:CT,range:IDBKeyRange.bound(o,a,!0)},(l,c,f)=>{const h=this.Cr(Te.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(e){return new b4(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return $w(e).get(Og).next(t=>(Fe(!!t,20021),t))}Dr(e,t){return $w(e).put(Og,t)}Cr(e,t){if(t){const r=s4(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(He.min())))return r}return rn.newInvalidDocument(e)}}function G1(n){return new y4(n)}class b4 extends K1{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Ui(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Bt((i,o)=>st(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=ww(this.Nr.serializer,o);s=s.add(i.path.popLast());const c=Nf(l);r+=c-a.size,t.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=ww(this.Nr.serializer,o.convertToNoDocument(He.min()));t.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Nr.updateMetadata(e,r)),J.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(r=>(this.Br.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function $w(n){return Bn(n,pd)}function ga(n){return Bn(n,Sf)}function pu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Fw(n,e){const t=e.documentKey.path.toArray();return[n,kf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Uw(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=st(t[i],r[i]),s)return s;return s=st(t.length,r.length),s||(s=st(t[t.length-2],r[r.length-2]),s||st(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&zu(r.mutation,s,Nr.empty(),jt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ft()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ft()){const s=Gs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Iu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Gs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ft()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Or();const o=Bu(),a=function(){return Bu()}();return t.forEach((l,c)=>{const f=r.get(c.key);s.has(c.key)&&(f===void 0||f.mutation instanceof ji)?i=i.insert(c.key,c):f!==void 0?(o.set(c.key,f.mutation.getFieldMask()),zu(f.mutation,c,f.mutation.getFieldMask(),jt.now())):o.set(c.key,Nr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,f)=>o.set(c,f)),t.forEach((c,f)=>a.set(c,new _4(f,o.get(c)??null))),a))}recalculateAndSaveOverlays(e,t){const r=Bu();let s=new tn((o,a)=>o-a),i=ft();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let f=r.get(l)||Nr.empty();f=a.applyToLocalView(c,f),r.set(l,f);const h=(s.get(a.batchId)||ft()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,f=l.value,h=u1();f.forEach(p=>{if(!i.has(p)){const v=v1(t.get(p),r.get(p));v!==null&&h.set(p,v),i=i.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return J.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Te.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cy(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):J.resolve(Gs());let a=ic,l=i;return o.next(c=>J.forEach(c,(f,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(f)?J.resolve():this.remoteDocumentCache.getEntry(e,f).next(p=>{l=l.insert(f,p)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,ft())).next(f=>({batchId:a,changes:c1(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Te(t)).next(r=>{let s=Iu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Iu();return this.indexManager.getCollectionParents(e,i).next(a=>J.forEach(a,l=>{const c=function(h,p){return new Fi(p,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(f=>{f.forEach((h,p)=>{o=o.insert(h,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const f=c.getKey();o.get(f)===null&&(o=o.insert(f,rn.newInvalidDocument(f)))});let a=Iu();return o.forEach((l,c)=>{const f=i.get(l);f!==void 0&&zu(f.mutation,c,Nr.empty(),jt.now()),qd(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return J.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Nn(s.createTime)}}(t)),J.resolve()}getNamedQuery(e,t){return J.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:Cp(s.bundledQuery),readTime:Nn(s.readTime)}}(t)),J.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4{constructor(){this.overlays=new tn(Te.comparator),this.qr=new Map}getOverlay(e,t){return J.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Gs();return J.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.St(e,t,i)}),J.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),J.resolve()}getOverlaysForCollection(e,t,r){const s=Gs(),i=t.length+1,o=new Te(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return J.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new tn((c,f)=>c-f);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let f=i.get(c.largestBatchId);f===null&&(f=Gs(),i=i.insert(c.largestBatchId,f)),f.set(c.getKey(),c)}}const a=Gs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,f)=>a.set(c,f)),!(a.size()>=s)););return J.resolve(a)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new my(t,r));let i=this.qr.get(t);i===void 0&&(i=ft(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4{constructor(){this.sessionToken=Sn.EMPTY_BYTE_STRING}getSessionToken(e){return J.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,J.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{constructor(){this.Qr=new Bt(Hn.$r),this.Ur=new Bt(Hn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new Hn(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Gr(new Hn(e,t))}zr(e,t){e.forEach(r=>this.removeReference(r,t))}jr(e){const t=new Te(new vt([])),r=new Hn(t,e),s=new Hn(t,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Te(new vt([])),r=new Hn(t,e),s=new Hn(t,e+1);let i=ft();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new Hn(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Hn{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Te.comparator(e.key,t.key)||st(e.Yr,t.Yr)}static Kr(e,t){return st(e.Yr,t.Yr)||Te.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I4{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Bt(Hn.$r)}checkEmpty(e){return J.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new fy(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Hn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return J.resolve(o)}lookupMutationBatch(e,t){return J.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return J.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return J.resolve(this.mutationQueue.length===0?So:this.tr-1)}getAllMutationBatches(e){return J.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Hn(t,0),s=new Hn(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),J.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Bt(st);return t.forEach(s=>{const i=new Hn(s,0),o=new Hn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),J.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Te.isDocumentKey(i)||(i=i.child(""));const o=new Hn(new Te(i),0);let a=new Bt(st);return this.Zr.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.Yr)),!0)},o),J.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Fe(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return J.forEach(t.mutations,s=>{const i=new Hn(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new Hn(t,0),s=this.Zr.firstAfterOrEqual(r);return J.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,J.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4{constructor(e){this.ri=e,this.docs=function(){return new tn(Te.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return J.resolve(r?r.document.mutableCopy():rn.newInvalidDocument(t))}getEntries(e,t){let r=Or();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():rn.newInvalidDocument(s))}),J.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Or();const o=t.path,a=new Te(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:f}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||ey(ET(f),r)<=0||(s.has(f.key)||qd(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return J.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ne(9500)}ii(e,t){return J.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new S4(this)}getSize(e){return J.resolve(this.size)}}class S4 extends K1{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),J.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4{constructor(e){this.persistence=e,this.si=new Ui(t=>Ba(t),Ud),this.lastRemoteSnapshotVersion=He.min(),this.highestTargetId=0,this.oi=0,this._i=new _y,this.targetCount=0,this.ai=Ga.ur()}forEachTarget(e,t){return this.si.forEach((r,s)=>t(s)),J.resolve()}getLastRemoteSnapshotVersion(e){return J.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return J.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),J.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),J.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ga(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,J.resolve()}updateTargetData(e,t){return this.Pr(t),J.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,J.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),J.waitFor(i).next(()=>s)}getTargetCount(e){return J.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return J.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),J.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),J.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),J.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return J.resolve(r)}containsKey(e,t){return J.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wy{constructor(e,t){this.ui={},this.overlays={},this.ci=new Dr(0),this.li=!1,this.li=!0,this.hi=new E4,this.referenceDelegate=e(this),this.Pi=new A4(this),this.indexManager=new h4,this.remoteDocumentCache=function(s){return new T4(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new M1(t),this.Ii=new w4(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new x4,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new I4(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){ve("MemoryPersistence","Starting transaction:",e);const s=new P4(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,t){return J.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class P4 extends TT{constructor(e){super(),this.currentSequenceNumber=e}}class Dp{constructor(e){this.persistence=e,this.Ri=new _y,this.Vi=null}static mi(e){return new Dp(e)}get fi(){if(this.Vi)return this.Vi;throw Ne(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),J.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),J.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),J.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return J.forEach(this.fi,r=>{const s=Te.fromPath(r);return this.gi(e,s).next(i=>{i||t.removeEntry(s,He.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return J.or([()=>J.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Of{constructor(e,t){this.persistence=e,this.pi=new Ui(r=>mr(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=W1(this,t)}static mi(e,t){return new Of(e,t)}Ei(){}di(e){return J.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}wr(e){let t=0;return this.pr(e,r=>{t++}).next(()=>t)}pr(e,t){return J.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?J.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,t).next(a=>{a||(r++,i.removeEntry(o,He.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),J.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),J.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),J.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),J.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ef(e.data.value)),t}br(e,t,r){return J.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return J.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4{constructor(e){this.serializer=e}k(e,t,r,s){const i=new yp("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore(Fd)}(e),function(l){l.createObjectStore(fd,{keyPath:GV}),l.createObjectStore(ys,{keyPath:Y_,autoIncrement:!0}).createIndex(Ca,X_,{unique:!0}),l.createObjectStore(lc)}(e),jw(e),function(l){l.createObjectStore(_a)}(e));let o=J.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(uc),l.deleteObjectStore(cc),l.deleteObjectStore(Na)}(e),jw(e)),o=o.next(()=>function(l){const c=l.store(Na),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:He.min().toTimestamp(),targetCount:0};return c.put(Af,f)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store(ys).J().next(h=>{l.deleteObjectStore(ys),l.createObjectStore(ys,{keyPath:Y_,autoIncrement:!0}).createIndex(Ca,X_,{unique:!0});const p=c.store(ys),v=h.map(x=>p.put(x));return J.waitFor(v)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(dc,{keyPath:r3})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(pd)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(bp,{keyPath:s3})})(e),function(l){l.createObjectStore(_p,{keyPath:i3})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore(wp,{keyPath:h3});c.createIndex(Mg,f3,{unique:!1}),c.createIndex(NT,p3,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore(Sf,{keyPath:JV});c.createIndex(Xh,YV),c.createIndex(CT,XV)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(_a))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(ry,{keyPath:o3,autoIncrement:!0}).createIndex(Vg,a3,{unique:!1}),l.createObjectStore(Uu,{keyPath:l3}).createIndex(kT,c3,{unique:!1}),l.createObjectStore(ju,{keyPath:u3}).createIndex(DT,d3,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore(Uu).clear()}).next(()=>{t.objectStore(ju).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(sy,{keyPath:m3})})(e)})),r<18&&s>=18&&DI()&&(o=o.next(()=>{t.objectStore(Uu).clear()}).next(()=>{t.objectStore(ju).clear()})),o}wi(e){let t=0;return e.store(_a).ee((r,s)=>{t+=Nf(s)}).next(()=>{const r={byteSize:t};return e.store(pd).put(Og,r)})}yi(e){const t=e.store(fd),r=e.store(ys);return t.J().next(s=>J.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,So],[i.userId,i.lastAcknowledgedBatchId]);return r.J(Ca,o).next(a=>J.forEach(a,l=>{Fe(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const c=Ea(this.serializer,l);return j1(e,i.userId,c).next(()=>{})}))}))}Si(e){const t=e.store(uc),r=e.store(_a);return e.store(Na).get(Af).next(s=>{const i=[];return r.ee((o,a)=>{const l=new vt(o),c=function(h){return[0,mr(h)]}(l);i.push(t.get(c).next(f=>f?J.resolve():(h=>t.put({targetId:0,path:mr(h),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>J.waitFor(i))})}bi(e,t){e.createObjectStore(md,{keyPath:n3});const r=t.store(md),s=new by,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:mr(l)})}};return t.store(_a).ee({X:!0},(o,a)=>{const l=new vt(o);return i(l.popLast())}).next(()=>t.store(lc).ee({X:!0},([o,a,l],c)=>{const f=Ks(a);return i(f.popLast())}))}Di(e){const t=e.store(cc);return t.ee((r,s)=>{const i=Su(s),o=L1(this.serializer,i);return t.put(o)})}Ci(e,t){const r=t.store(_a),s=[];return r.ee((i,o)=>{const a=t.store(Sf),l=function(h){return h.document?new Te(vt.fromString(h.document.name).popFirst(5)):h.noDocument?Te.fromSegments(h.noDocument.path):h.unknownDocument?Te.fromSegments(h.unknownDocument.path):Ne(36783)}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>J.waitFor(s))}Fi(e,t){const r=t.store(ys),s=G1(this.serializer),i=new wy(Dp.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let c=a.get(l.userId)??ft();Ea(this.serializer,l).keys().forEach(f=>c=c.add(f)),a.set(l.userId,c)}),J.forEach(a,(l,c)=>{const f=new Wn(c),h=Rp.wt(this.serializer,f),p=i.getIndexManager(f),v=kp.wt(f,this.serializer,p,i.referenceDelegate);return new Q1(s,v,h,p).recalculateAndSaveOverlaysForDocumentKeys(new Lg(t,Dr.ce),l).next()})})}}function jw(n){n.createObjectStore(uc,{keyPath:e3}).createIndex(ny,t3,{unique:!0}),n.createObjectStore(cc,{keyPath:"targetId"}).createIndex(RT,ZV,{unique:!0}),n.createObjectStore(Na)}const ro="IndexedDbPersistence",Hm=18e5,Wm=5e3,Km="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",J1="main";class xy{constructor(e,t,r,s,i,o,a,l,c,f,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=c,this.Oi=f,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!xy.v())throw new he(Y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new v4(this,s),this.$i=t+J1,this.serializer=new M1(l),this.Ui=new Ys(this.$i,this.Ni,new C4(this.serializer)),this.hi=new o4,this.Pi=new p4(this.referenceDelegate,this.serializer),this.remoteDocumentCache=G1(this.serializer),this.Ii=new i4,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&Dn(ro,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new he(Y.FAILED_PRECONDITION,Km);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Dr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Nh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(qo(e))return ve(ro,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ve(ro,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return mu(e).get(Al).next(t=>J.resolve(this.es(t)))}ts(e){return Nh(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Hm)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Bn(t,dc);return r.J().next(s=>{const i=this.ss(s,Hm),o=s.filter(a=>i.indexOf(a)===-1);return J.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?J.resolve(!0):mu(e).get(Al).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Wm)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new he(Y.FAILED_PRECONDITION,Km);return!1}}return!(!this.networkEnabled||!this.inForeground)||Nh(e).J().next(r=>this.ss(r,Wm).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ve(ro,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Fd,dc],e=>{const t=new Lg(e,Dr.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(r=>this.rs(r.updateTimeMs,t)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Nh(e).J().next(t=>this.ss(t,Hm).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return kp.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new f4(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Rp.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){ve(ro,"Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===18?y3:l===17?LT:l===16?v3:l===15?iy:l===14?MT:l===13?VT:l===12?g3:l===11?OT:void Ne(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new Lg(a,this.ci?this.ci.next():Dr.ce),t==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw Dn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new he(Y.FAILED_PRECONDITION,IT);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return mu(e).get(Al).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,Wm)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new he(Y.FAILED_PRECONDITION,Km)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return mu(e).put(Al,t)}static v(){return Ys.v()}Zi(e){const t=mu(e);return t.get(Al).next(r=>this.es(r)?(ve(ro,"Releasing primary lease."),t.delete(Al)):J.resolve())}rs(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Dn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;kI()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const r=((t=this.Ki)==null?void 0:t.getItem(this._s(e)))!==null;return ve(ro,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Dn(ro,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Dn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function mu(n){return Bn(n,Fd)}function Nh(n){return Bn(n,dc)}function Ey(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=ft(),s=ft();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Iy(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return kI()?8:ST(qn())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new R4;return this.Ss(e,t,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,t,o,a.size)})}).next(()=>i.result)}bs(e,t,r,s){return r.documentReadCount<this.fs?(Vl()<=_t.DEBUG&&ve("QueryEngine","SDK will not create cache indexes for query:",Ml(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),J.resolve()):(Vl()<=_t.DEBUG&&ve("QueryEngine","Query:",Ml(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Vl()<=_t.DEBUG&&ve("QueryEngine","The SDK decides to create cache indexes for query:",Ml(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,gr(t))):J.resolve())}ys(e,t){if(dw(t))return J.resolve(null);let r=gr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Rf(t,null,"F"),r=gr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=ft(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.Ds(t,a);return this.Cs(t,c,o,l.readTime)?this.ys(e,Rf(t,null,"F")):this.vs(e,c,t,l)}))})))}ws(e,t,r,s){return dw(t)||s.isEqual(He.min())?J.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(t,i);return this.Cs(t,o,r,s)?J.resolve(null):(Vl()<=_t.DEBUG&&ve("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ml(t)),this.vs(e,o,t,xT(s,ic)).next(a=>a))})}Ds(e,t){let r=new Bt(a1(e));return t.forEach((s,i)=>{qd(e,i)&&(r=r.add(i))}),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return Vl()<=_t.DEBUG&&ve("QueryEngine","Using full collection scan to execute query:",Ml(t)),this.ps.getDocumentsMatchingQuery(e,t,Jr.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ty="LocalStore",k4=3e8;class D4{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new tn(st),this.xs=new Ui(i=>Ba(i),Ud),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Q1(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function X1(n,e,t,r){return new D4(n,e,t,r)}async function Z1(n,e){const t=Ae(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=ft();for(const c of s){o.push(c.batchId);for(const f of c.mutations)l=l.add(f.key)}for(const c of i){a.push(c.batchId);for(const f of c.mutations)l=l.add(f.key)}return t.localDocuments.getDocuments(r,l).next(c=>({Ls:c,removedBatchIds:o,addedBatchIds:a}))})})}function N4(n,e){const t=Ae(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,c,f){const h=c.batch,p=h.keys();let v=J.resolve();return p.forEach(x=>{v=v.next(()=>f.getEntry(l,x)).next(_=>{const w=c.docVersions.get(x);Fe(w!==null,48541),_.version.compareTo(w)<0&&(h.applyToRemoteDocument(_,c),_.isValidDocument()&&(_.setReadTime(c.commitVersion),f.addEntry(_)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=ft();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function eS(n){const e=Ae(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function O4(n,e){const t=Ae(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const a=[];e.targetChanges.forEach((f,h)=>{const p=s.get(h);if(!p)return;a.push(t.Pi.removeMatchingKeys(i,f.removedDocuments,h).next(()=>t.Pi.addMatchingKeys(i,f.addedDocuments,h)));let v=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?v=v.withResumeToken(Sn.EMPTY_BYTE_STRING,He.min()).withLastLimboFreeSnapshotVersion(He.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,r)),s=s.insert(h,v),function(_,w,T){return _.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=k4?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(p,v,f)&&a.push(t.Pi.updateTargetData(i,v))});let l=Or(),c=ft();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))}),a.push(tS(i,o,e.documentUpdates).next(f=>{l=f.ks,c=f.qs})),!r.isEqual(He.min())){const f=t.Pi.getLastRemoteSnapshotVersion(i).next(h=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(f)}return J.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.Ms=s,i))}function tS(n,e,t){let r=ft(),s=ft();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Or();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(He.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ve(Ty,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{ks:o,qs:s}})}function V4(n,e){const t=Ae(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=So),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function yc(n,e){const t=Ae(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Pi.getTargetData(r,e).next(i=>i?(s=i,J.resolve(s)):t.Pi.allocateTargetId(r).next(o=>(s=new wi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r})}async function bc(n,e,t){const r=Ae(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!qo(o))throw o;ve(Ty,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Vf(n,e,t){const r=Ae(n);let s=He.min(),i=ft();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,f){const h=Ae(l),p=h.xs.get(f);return p!==void 0?J.resolve(h.Ms.get(p)):h.Pi.getTargetData(c,f)}(r,o,gr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,t?s:He.min(),t?i:ft())).next(a=>(sS(r,o1(e),a),{documents:a,Qs:i})))}function nS(n,e){const t=Ae(n),r=Ae(t.Pi),s=t.Ms.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.At(i,e).next(o=>o?o.target:null))}function rS(n,e){const t=Ae(n),r=t.Os.get(e)||He.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ns.getAllFromCollectionGroup(s,e,xT(r,ic),Number.MAX_SAFE_INTEGER)).then(s=>(sS(t,e,s),s))}function sS(n,e,t){let r=n.Os.get(e)||He.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Os.set(e,r)}async function M4(n,e,t,r){const s=Ae(n);let i=ft(),o=Or();for(const c of t){const f=e.$s(c.metadata.name);c.document&&(i=i.add(f));const h=e.Us(c);h.setReadTime(e.Ks(c.metadata.readTime)),o=o.insert(f,h)}const a=s.Ns.newChangeBuffer({trackRemovals:!0}),l=await yc(s,function(f){return gr(Ac(vt.fromString(`__bundle__/docs/${f}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>tS(c,a,o).next(f=>(a.apply(c),f)).next(f=>s.Pi.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Pi.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,f.ks,f.qs)).next(()=>f.ks)))}async function L4(n,e,t=ft()){const r=await yc(n,gr(Cp(e.bundledQuery))),s=Ae(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=Nn(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ii.saveNamedQuery(i,e);const a=r.withResumeToken(Sn.EMPTY_BYTE_STRING,o);return s.Ms=s.Ms.insert(a.targetId,a),s.Pi.updateTargetData(i,a).next(()=>s.Pi.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Pi.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ii.saveNamedQuery(i,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iS="firestore_clients";function qw(n,e){return`${iS}_${n}_${e}`}const oS="firestore_mutations";function Bw(n,e,t){let r=`${oS}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}const aS="firestore_targets";function Gm(n,e){return`${aS}_${n}_${e}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hs="SharedClientState";class Mf{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Ws(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new he(s.error.code,s.error.message))),o?new Mf(e,t,s.state,i):(Dn(Hs,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Wu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ws(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new he(r.error.code,r.error.message))),i?new Wu(e,r.state,s):(Dn(Hs,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Lf{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=uy();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=AT(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Lf(e,i):(Dn(Hs,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Sy{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Sy(t.clientId,t.onlineState):(Dn(Hs,`Failed to parse online state: ${e}`),null)}}class Yg{constructor(){this.activeTargetIds=uy()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Qm{constructor(e,t,r,s,i){this.window=e,this.Mi=t,this.persistenceKey=r,this.Js=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new tn(st),this.started=!1,this.Xs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.eo=qw(this.persistenceKey,this.Js),this.no=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new Yg),this.ro=new RegExp(`^${iS}_${o}_([^_]*)$`),this.io=new RegExp(`^${oS}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${aS}_${o}_(\\d+)$`),this.oo=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this._o=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ts();for(const r of e){if(r===this.Js)continue;const s=this.getItem(qw(this.persistenceKey,r));if(s){const i=Lf.Ws(r,s);i&&(this.Zs=this.Zs.insert(i.clientId,i))}}this.ao();const t=this.storage.getItem(this.oo);if(t){const r=this.uo(t);r&&this.co(r)}for(const r of this.Xs)this.Ys(r);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,r){this.ho(e,t,r),this.Po(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Gm(this.persistenceKey,e));if(s){const i=Wu.Ws(e,s);i&&(r=i.state)}}return t&&this.To.zs(e),this.ao(),r}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Gm(this.persistenceKey,e))}updateQueryState(e,t,r){this.Io(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Po(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ve(Hs,"READ",e,t),t}setItem(e,t){ve(Hs,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){ve(Hs,"REMOVE",e),this.storage.removeItem(e)}Ys(e){const t=e;if(t.storageArea===this.storage){if(ve(Hs,"EVENT",t.key,t.newValue),t.key===this.eo)return void Dn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){const r=this.Ro(t.key);return this.Vo(r,null)}{const r=this.mo(t.key,t.newValue);if(r)return this.Vo(r.clientId,r)}}else if(this.io.test(t.key)){if(t.newValue!==null){const r=this.fo(t.key,t.newValue);if(r)return this.po(r)}}else if(this.so.test(t.key)){if(t.newValue!==null){const r=this.yo(t.key,t.newValue);if(r)return this.wo(r)}}else if(t.key===this.oo){if(t.newValue!==null){const r=this.uo(t.newValue);if(r)return this.co(r)}}else if(t.key===this.no){const r=function(i){let o=Dr.ce;if(i!=null)try{const a=JSON.parse(i);Fe(typeof a=="number",30636,{So:i}),o=a}catch(a){Dn(Hs,"Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Dr.ce&&this.sequenceNumberHandler(r)}else if(t.key===this._o){const r=this.bo(t.newValue);await Promise.all(r.map(s=>this.syncEngine.Do(s)))}}}else this.Xs.push(t)})}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,r){const s=new Mf(this.currentUser,e,t,r),i=Bw(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Gs())}Po(e){const t=Bw(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,r){const s=Gm(this.persistenceKey,e),i=new Wu(e,t,r);this.setItem(s,i.Gs())}Ao(e){const t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){const t=this.ro.exec(e);return t?t[1]:null}mo(e,t){const r=this.Ro(e);return Lf.Ws(r,t)}fo(e,t){const r=this.io.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Mf.Ws(new Wn(i),s,t)}yo(e,t){const r=this.so.exec(e),s=Number(r[1]);return Wu.Ws(s,t)}uo(e){return Sy.Ws(e)}bo(e){return JSON.parse(e)}async po(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);ve(Hs,`Ignoring mutation for non-active user ${e.user.uid}`)}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){const r=t?this.Zs.insert(e,t):this.Zs.remove(e),s=this.lo(this.Zs),i=this.lo(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.Fo(o,a).then(()=>{this.Zs=r})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=uy();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class lS{constructor(){this.Mo=new Yg,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Yg,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zw="ConnectivityMonitor";class Hw{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ve(zw,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ve(zw,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oh=null;function Xg(){return Oh===null?Oh=function(){return 268435456+Math.round(2147483648*Math.random())}():Oh++,"0x"+Oh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jm="RestConnection",F4={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class U4{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===vd?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const o=Xg(),a=this.zo(e,t.toUriEncodedString());ve(Jm,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:c}=new URL(a),f=si(c);return this.Jo(e,a,l,r,f).then(h=>(ve(Jm,`Received RPC '${e}' ${o}: `,h),h),h=>{throw as(Jm,`RPC '${e}' ${o} failed with error: `,h,"url: ",a,"request:",r),h})}Ho(e,t,r,s,i,o){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Sc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,t){const r=F4[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cr="WebChannelConnection";class q4 extends U4{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const o=Xg();return new Promise((a,l)=>{const c=new hT;c.setWithCredentials(!0),c.listenOnce(fT.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Jh.NO_ERROR:const h=c.getResponseJson();ve(cr,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),a(h);break;case Jh.TIMEOUT:ve(cr,`RPC '${e}' ${o} timed out`),l(new he(Y.DEADLINE_EXCEEDED,"Request time out"));break;case Jh.HTTP_ERROR:const p=c.getStatus();if(ve(cr,`RPC '${e}' ${o} failed with status:`,p,"response text:",c.getResponseText()),p>0){let v=c.getResponseJson();Array.isArray(v)&&(v=v[0]);const x=v==null?void 0:v.error;if(x&&x.status&&x.message){const _=function(T){const N=T.toLowerCase().replace(/_/g,"-");return Object.values(Y).indexOf(N)>=0?N:Y.UNKNOWN}(x.status);l(new he(_,x.message))}else l(new he(Y.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new he(Y.UNAVAILABLE,"Connection failed."));break;default:Ne(9055,{l_:e,streamId:o,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{ve(cr,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(s);ve(cr,`RPC '${e}' ${o} sending request:`,s),c.send(t,"POST",f,r,15)})}T_(e,t,r){const s=Xg(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=gT(),a=mT(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const f=i.join("");ve(cr,`Creating RPC '${e}' stream ${s}: ${f}`,l);const h=o.createWebChannel(f,l);this.I_(h);let p=!1,v=!1;const x=new j4({Yo:w=>{v?ve(cr,`Not sending because RPC '${e}' stream ${s} is closed:`,w):(p||(ve(cr,`Opening RPC '${e}' stream ${s} transport.`),h.open(),p=!0),ve(cr,`RPC '${e}' stream ${s} sending:`,w),h.send(w))},Zo:()=>h.close()}),_=(w,T,N)=>{w.listen(T,I=>{try{N(I)}catch(j){setTimeout(()=>{throw j},0)}})};return _(h,Eu.EventType.OPEN,()=>{v||(ve(cr,`RPC '${e}' stream ${s} transport opened.`),x.o_())}),_(h,Eu.EventType.CLOSE,()=>{v||(v=!0,ve(cr,`RPC '${e}' stream ${s} transport closed`),x.a_(),this.E_(h))}),_(h,Eu.EventType.ERROR,w=>{v||(v=!0,as(cr,`RPC '${e}' stream ${s} transport errored. Name:`,w.name,"Message:",w.message),x.a_(new he(Y.UNAVAILABLE,"The operation could not be completed")))}),_(h,Eu.EventType.MESSAGE,w=>{var T;if(!v){const N=w.data[0];Fe(!!N,16349);const I=N,j=(I==null?void 0:I.error)||((T=I[0])==null?void 0:T.error);if(j){ve(cr,`RPC '${e}' stream ${s} received error:`,j);const ne=j.status;let ae=function(S){const $=Mn[S];if($!==void 0)return w1($)}(ne),V=j.message;ae===void 0&&(ae=Y.INTERNAL,V="Unknown error status: "+ne+" with message "+j.message),v=!0,x.a_(new he(ae,V)),h.close()}else ve(cr,`RPC '${e}' stream ${s} received:`,N),x.u_(N)}}),_(a,pT.STAT_EVENT,w=>{w.stat===Cg.PROXY?ve(cr,`RPC '${e}' stream ${s} detected buffering proxy`):w.stat===Cg.NOPROXY&&ve(cr,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{x.__()},0),x}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cS(){return typeof window<"u"?window:null}function of(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sl(n){return new G3(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&ve("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ww="PersistentStream";class uS{constructor(e,t,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ay(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===Y.RESOURCE_EXHAUSTED?(Dn(t.toString()),Dn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Y.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new he(Y.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ve(Ww,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(ve(Ww,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class B4 extends uS{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Y3(this.serializer,e),r=function(i){if(!("targetChange"in i))return He.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?He.min():o.readTime?Nn(o.readTime):He.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=Wg(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Pf(l)?{documents:R1(i,l)}:{query:Pp(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=T1(i,o.resumeToken);const c=zg(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(He.min())>0){a.readTime=vc(i,o.snapshotVersion.toTimestamp());const c=zg(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=Z3(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=Wg(this.serializer),t.removeTarget=e,this.q_(t)}}class z4 extends uS{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Fe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Fe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Fe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=X3(e.writeResults,e.commitTime),r=Nn(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Wg(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>xd(this.serializer,r))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4{}class W4 extends H4{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new he(Y.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,Hg(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new he(Y.UNKNOWN,i.toString())})}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,Hg(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new he(Y.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class K4{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Dn(t),this.aa=!1):ve("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qa="RemoteStore";class G4{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{zo(this)&&(ve(Qa,"Restarting streams for network reachability change."),await async function(l){const c=Ae(l);c.Ea.add(4),await Rc(c),c.Ra.set("Unknown"),c.Ea.delete(4),await Wd(c)}(this))})}),this.Ra=new K4(r,s)}}async function Wd(n){if(zo(n))for(const e of n.da)await e(!0)}async function Rc(n){for(const e of n.da)await e(!1)}function Np(n,e){const t=Ae(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Ry(t)?Cy(t):Dc(t).O_()&&Py(t,e))}function _c(n,e){const t=Ae(n),r=Dc(t);t.Ia.delete(e),r.O_()&&dS(t,e),t.Ia.size===0&&(r.O_()?r.L_():zo(t)&&t.Ra.set("Unknown"))}function Py(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(He.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Dc(n).Y_(e)}function dS(n,e){n.Va.Ue(e),Dc(n).Z_(e)}function Cy(n){n.Va=new z3({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Dc(n).start(),n.Ra.ua()}function Ry(n){return zo(n)&&!Dc(n).x_()&&n.Ia.size>0}function zo(n){return Ae(n).Ea.size===0}function hS(n){n.Va=void 0}async function Q4(n){n.Ra.set("Online")}async function J4(n){n.Ia.forEach((e,t)=>{Py(n,e)})}async function Y4(n,e){hS(n),Ry(n)?(n.Ra.ha(e),Cy(n)):n.Ra.set("Unknown")}async function X4(n,e,t){if(n.Ra.set("Online"),e instanceof I1&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(n,e)}catch(r){ve(Qa,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await $f(n,r)}else if(e instanceof rf?n.Va.Ze(e):e instanceof E1?n.Va.st(e):n.Va.tt(e),!t.isEqual(He.min()))try{const r=await eS(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const f=i.Ia.get(c);f&&i.Ia.set(c,f.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const f=i.Ia.get(l);if(!f)return;i.Ia.set(l,f.withResumeToken(Sn.EMPTY_BYTE_STRING,f.snapshotVersion)),dS(i,l);const h=new wi(f.target,l,c,f.sequenceNumber);Py(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ve(Qa,"Failed to raise snapshot:",r),await $f(n,r)}}async function $f(n,e,t){if(!qo(e))throw e;n.Ea.add(1),await Rc(n),n.Ra.set("Offline"),t||(t=()=>eS(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ve(Qa,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Wd(n)})}function fS(n,e){return e().catch(t=>$f(n,t,e))}async function kc(n){const e=Ae(n),t=Oo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:So;for(;Z4(e);)try{const s=await V4(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,eM(e,s)}catch(s){await $f(e,s)}pS(e)&&mS(e)}function Z4(n){return zo(n)&&n.Ta.length<10}function eM(n,e){n.Ta.push(e);const t=Oo(n);t.O_()&&t.X_&&t.ea(e.mutations)}function pS(n){return zo(n)&&!Oo(n).x_()&&n.Ta.length>0}function mS(n){Oo(n).start()}async function tM(n){Oo(n).ra()}async function nM(n){const e=Oo(n);for(const t of n.Ta)e.ea(t.mutations)}async function rM(n,e,t){const r=n.Ta.shift(),s=py.from(r,e,t);await fS(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await kc(n)}async function sM(n,e){e&&Oo(n).X_&&await async function(r,s){if(function(o){return _1(o)&&o!==Y.ABORTED}(s.code)){const i=r.Ta.shift();Oo(r).B_(),await fS(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await kc(r)}}(n,e),pS(n)&&mS(n)}async function Kw(n,e){const t=Ae(n);t.asyncQueue.verifyOperationInProgress(),ve(Qa,"RemoteStore received new credentials");const r=zo(t);t.Ea.add(3),await Rc(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Wd(t)}async function Zg(n,e){const t=Ae(n);e?(t.Ea.delete(2),await Wd(t)):e||(t.Ea.add(2),await Rc(t),t.Ra.set("Unknown"))}function Dc(n){return n.ma||(n.ma=function(t,r,s){const i=Ae(t);return i.sa(),new B4(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:Q4.bind(null,n),t_:J4.bind(null,n),r_:Y4.bind(null,n),H_:X4.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),Ry(n)?Cy(n):n.Ra.set("Unknown")):(await n.ma.stop(),hS(n))})),n.ma}function Oo(n){return n.fa||(n.fa=function(t,r,s){const i=Ae(t);return i.sa(),new z4(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:tM.bind(null,n),r_:sM.bind(null,n),ta:nM.bind(null,n),na:rM.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await kc(n)):(await n.fa.stop(),n.Ta.length>0&&(ve(Qa,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Gn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new ky(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new he(Y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Nc(n,e){if(Dn("AsyncQueue",`${e}: ${n}`),qo(n))return new he(Y.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{static emptySet(e){return new Oa(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Te.comparator(t.key,r.key):(t,r)=>Te.comparator(t.key,r.key),this.keyedMap=Iu(),this.sortedSet=new tn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Oa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Oa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(){this.ga=new tn(Te.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ne(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ja{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Ja(e,t,Oa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&jd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class oM{constructor(){this.queries=Qw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=Ae(t),i=s.queries;s.queries=Qw(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new he(Y.ABORTED,"Firestore shutting down"))}}function Qw(){return new Ui(n=>i1(n),jd)}async function Dy(n,e){const t=Ae(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new iM,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Nc(o,`Initialization of query '${Ml(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&Oy(t)}async function Ny(n,e){const t=Ae(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function aM(n,e){const t=Ae(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&Oy(t)}function lM(n,e,t){const r=Ae(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function Oy(n){n.Ca.forEach(e=>{e.next()})}var ev,Jw;(Jw=ev||(ev={})).Ma="default",Jw.Cache="cache";class Vy{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ja(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Ja.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ev.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(e,t){this.Qa=e,this.byteLength=t}$a(){return"metadata"in this.Qa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(e){this.serializer=e}$s(e){return Xs(this.serializer,e)}Us(e){return e.metadata.exists?Ap(this.serializer,e.document,!1):rn.newNoDocument(this.$s(e.metadata.name),this.Ks(e.metadata.readTime))}Ks(e){return Nn(e)}}class My{constructor(e,t){this.Ua=e,this.serializer=t,this.Ka=[],this.Wa=[],this.collectionGroups=new Set,this.progress=vS(e)}get queries(){return this.Ka}get documents(){return this.Wa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Qa.namedQuery)this.Ka.push(e.Qa.namedQuery);else if(e.Qa.documentMetadata){this.Wa.push({metadata:e.Qa.documentMetadata}),e.Qa.documentMetadata.exists||++t;const r=vt.fromString(e.Qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Qa.document&&(this.Wa[this.Wa.length-1].document=e.Qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){const t=new Map,r=new Yw(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.$s(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||ft()).add(i);t.set(o,a)}}return t}async ja(e){const t=await M4(e,new Yw(this.serializer),this.Wa,this.Ua.id),r=this.za(this.documents);for(const s of this.Ka)await L4(e,s,r.get(s.name));return this.progress.taskState="Success",{progress:this.progress,Ja:this.collectionGroups,Ha:t}}}function vS(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yS{constructor(e){this.key=e}}class bS{constructor(e){this.key=e}}class _S{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ft(),this.mutatedKeys=ft(),this.eu=a1(e),this.tu=new Oa(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Gw,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,h)=>{const p=s.get(f),v=qd(this.query,h)?h:null,x=!!p&&this.mutatedKeys.has(p.key),_=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let w=!1;p&&v?p.data.isEqual(v.data)?x!==_&&(r.track({type:3,doc:v}),w=!0):this.su(p,v)||(r.track({type:2,doc:v}),w=!0,(l&&this.eu(v,l)>0||c&&this.eu(v,c)<0)&&(a=!0)):!p&&v?(r.track({type:0,doc:v}),w=!0):p&&!v&&(r.track({type:1,doc:p}),w=!0,(l||c)&&(a=!0)),w&&(v?(o=o.add(v),i=_?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((f,h)=>function(v,x){const _=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ne(20277,{Rt:w})}};return _(v)-_(x)}(f.type,h.type)||this.eu(f.doc,h.doc)),this.ou(r),s=s??!1;const a=t&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,c=l!==this.Za;return this.Za=l,o.length!==0||c?{snapshot:new Ja(this.query,e.tu,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Gw,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ft(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const t=[];return e.forEach(r=>{this.Xa.has(r)||t.push(new bS(r))}),this.Xa.forEach(r=>{e.has(r)||t.push(new yS(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=ft();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Ja.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Ho="SyncEngine";class cM{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class uM{constructor(e){this.key=e,this.hu=!1}}class dM{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Ui(a=>i1(a),jd),this.Iu=new Map,this.Eu=new Set,this.du=new tn(Te.comparator),this.Au=new Map,this.Ru=new _y,this.Vu={},this.mu=new Map,this.fu=Ga.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function hM(n,e,t=!0){const r=Op(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await wS(r,e,t,!0),s}async function fM(n,e){const t=Op(n);await wS(t,e,!0,!1)}async function wS(n,e,t,r){const s=await yc(n.localStore,gr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await Ly(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Np(n.remoteStore,s),a}async function Ly(n,e,t,r,s){n.pu=(h,p,v)=>async function(_,w,T,N){let I=w.view.ru(T);I.Cs&&(I=await Vf(_.localStore,w.query,!1).then(({documents:V})=>w.view.ru(V,I)));const j=N&&N.targetChanges.get(w.targetId),ne=N&&N.targetMismatches.get(w.targetId)!=null,ae=w.view.applyChanges(I,_.isPrimaryClient,j,ne);return tv(_,w.targetId,ae.au),ae.snapshot}(n,h,p,v);const i=await Vf(n.localStore,e,!0),o=new _S(e,i.Qs),a=o.ru(i.documents),l=Hd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);tv(n,t,c.au);const f=new cM(e,t,o);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),c.snapshot}async function pM(n,e,t){const r=Ae(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!jd(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await bc(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&_c(r.remoteStore,s.targetId),wc(r,s.targetId)}).catch(jo)):(wc(r,s.targetId),await bc(r.localStore,s.targetId,!0))}async function mM(n,e){const t=Ae(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),_c(t.remoteStore,r.targetId))}async function gM(n,e,t){const r=jy(n);try{const s=await function(o,a){const l=Ae(o),c=jt.now(),f=a.reduce((v,x)=>v.add(x.key),ft());let h,p;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let x=Or(),_=ft();return l.Ns.getEntries(v,f).next(w=>{x=w,x.forEach((T,N)=>{N.isValidDocument()||(_=_.add(T))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,x)).next(w=>{h=w;const T=[];for(const N of a){const I=j3(N,h.get(N.key).overlayedDocument);I!=null&&T.push(new ji(N.key,I,GT(I.value.mapValue),hn.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,T,a)}).next(w=>{p=w;const T=w.applyToLocalDocumentSet(h,_);return l.documentOverlayCache.saveOverlays(v,w.batchId,T)})}).then(()=>({batchId:p.batchId,changes:c1(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Vu[o.currentUser.toKey()];c||(c=new tn(st)),c=c.insert(a,l),o.Vu[o.currentUser.toKey()]=c}(r,s.batchId,t),await qi(r,s.changes),await kc(r.remoteStore)}catch(s){const i=Nc(s,"Failed to persist write");t.reject(i)}}async function xS(n,e){const t=Ae(n);try{const r=await O4(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Au.get(i);o&&(Fe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?Fe(o.hu,14607):s.removedDocuments.size>0&&(Fe(o.hu,42227),o.hu=!1))}),await qi(t,r,e)}catch(r){await jo(r)}}function Xw(n,e,t){const r=Ae(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ae(o);l.onlineState=a;let c=!1;l.queries.forEach((f,h)=>{for(const p of h.Sa)p.va(a)&&(c=!0)}),c&&Oy(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function vM(n,e,t){const r=Ae(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new tn(Te.comparator);o=o.insert(i,rn.newNoDocument(i,He.min()));const a=ft().add(i),l=new zd(He.min(),new Map,new tn(st),o,a);await xS(r,l),r.du=r.du.remove(i),r.Au.delete(e),Uy(r)}else await bc(r.localStore,e,!1).then(()=>wc(r,e,t)).catch(jo)}async function yM(n,e){const t=Ae(n),r=e.batch.batchId;try{const s=await N4(t.localStore,e);Fy(t,r,null),$y(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await qi(t,s)}catch(s){await jo(s)}}async function bM(n,e,t){const r=Ae(n);try{const s=await function(o,a){const l=Ae(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let f;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(Fe(h!==null,37113),f=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,f,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,f)).next(()=>l.localDocuments.getDocuments(c,f))})}(r.localStore,e);Fy(r,e,t),$y(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await qi(r,s)}catch(s){await jo(s)}}async function _M(n,e){const t=Ae(n);zo(t.remoteStore)||ve(Ho,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ae(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===So)return void e.resolve();const s=t.mu.get(r)||[];s.push(e),t.mu.set(r,s)}catch(r){const s=Nc(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function $y(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Fy(n,e,t){const r=Ae(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function wc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(r=>{n.Ru.containsKey(r)||ES(n,r)})}function ES(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(_c(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),Uy(n))}function tv(n,e,t){for(const r of t)r instanceof yS?(n.Ru.addReference(r.key,e),wM(n,r)):r instanceof bS?(ve(Ho,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||ES(n,r.key)):Ne(19791,{wu:r})}function wM(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(ve(Ho,"New document in limbo: "+t),n.Eu.add(r),Uy(n))}function Uy(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Te(vt.fromString(e)),r=n.fu.next();n.Au.set(r,new uM(t)),n.du=n.du.insert(t,r),Np(n.remoteStore,new wi(gr(Ac(t.path)),r,"TargetPurposeLimboResolution",Dr.ce))}}async function qi(n,e,t){const r=Ae(n),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,t).then(c=>{var f;if((c||t)&&r.isPrimaryClient){const h=c?!c.fromCache:(f=t==null?void 0:t.targetChanges.get(l.targetId))==null?void 0:f.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){s.push(c);const h=Iy.As(l.targetId,c);i.push(h)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,c){const f=Ae(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>J.forEach(c,p=>J.forEach(p.Es,v=>f.persistence.referenceDelegate.addReference(h,p.targetId,v)).next(()=>J.forEach(p.ds,v=>f.persistence.referenceDelegate.removeReference(h,p.targetId,v)))))}catch(h){if(!qo(h))throw h;ve(Ty,"Failed to update sequence numbers: "+h)}for(const h of c){const p=h.targetId;if(!h.fromCache){const v=f.Ms.get(p),x=v.snapshotVersion,_=v.withLastLimboFreeSnapshotVersion(x);f.Ms=f.Ms.insert(p,_)}}}(r.localStore,i))}async function xM(n,e){const t=Ae(n);if(!t.currentUser.isEqual(e)){ve(Ho,"User change. New user:",e.toKey());const r=await Z1(t.localStore,e);t.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new he(Y.CANCELLED,o))})}),i.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await qi(t,r.Ls)}}function EM(n,e){const t=Ae(n),r=t.Au.get(e);if(r&&r.hu)return ft().add(r.key);{let s=ft();const i=t.Iu.get(e);if(!i)return s;for(const o of i){const a=t.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}async function IM(n,e){const t=Ae(n),r=await Vf(t.localStore,e.query,!0),s=e.view.cu(r);return t.isPrimaryClient&&tv(t,e.targetId,s.au),s}async function TM(n,e){const t=Ae(n);return rS(t.localStore,e).then(r=>qi(t,r))}async function SM(n,e,t,r){const s=Ae(n),i=await function(a,l){const c=Ae(a),f=Ae(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>f.er(h,l).next(p=>p?c.localDocuments.getDocuments(h,p):J.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await kc(s.remoteStore):t==="acknowledged"||t==="rejected"?(Fy(s,e,r||null),$y(s,e),function(a,l){Ae(Ae(a).mutationQueue).ir(l)}(s.localStore,e)):Ne(6720,"Unknown batchState",{Su:t}),await qi(s,i)):ve(Ho,"Cannot apply mutation batch with id: "+e)}async function AM(n,e){const t=Ae(n);if(Op(t),jy(t),e===!0&&t.gu!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await Zw(t,r.toArray());t.gu=!0,await Zg(t.remoteStore,!0);for(const i of s)Np(t.remoteStore,i)}else if(e===!1&&t.gu!==!1){const r=[];let s=Promise.resolve();t.Iu.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(wc(t,o),bc(t.localStore,o,!0))),_c(t.remoteStore,o)}),await s,await Zw(t,r),function(o){const a=Ae(o);a.Au.forEach((l,c)=>{_c(a.remoteStore,c)}),a.Ru.Jr(),a.Au=new Map,a.du=new tn(Te.comparator)}(t),t.gu=!1,await Zg(t.remoteStore,!1)}}async function Zw(n,e,t){const r=Ae(n),s=[],i=[];for(const o of e){let a;const l=r.Iu.get(o);if(l&&l.length!==0){a=await yc(r.localStore,gr(l[0]));for(const c of l){const f=r.Tu.get(c),h=await IM(r,f);h.snapshot&&i.push(h.snapshot)}}else{const c=await nS(r.localStore,o);a=await yc(r.localStore,c),await Ly(r,IS(c),o,!1,a.resumeToken)}s.push(a)}return r.Pu.H_(i),s}function IS(n){return n1(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function PM(n){return function(t){return Ae(Ae(t).persistence).Ts()}(Ae(n).localStore)}async function CM(n,e,t,r){const s=Ae(n);if(s.gu)return void ve(Ho,"Ignoring unexpected query state notification.");const i=s.Iu.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await rS(s.localStore,o1(i[0])),a=zd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Sn.EMPTY_BYTE_STRING);await qi(s,o,a);break}case"rejected":await bc(s.localStore,e,!0),wc(s,e,r);break;default:Ne(64155,t)}}async function RM(n,e,t){const r=Op(n);if(r.gu){for(const s of e){if(r.Iu.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){ve(Ho,"Adding an already active target "+s);continue}const i=await nS(r.localStore,s),o=await yc(r.localStore,i);await Ly(r,IS(i),o.targetId,!1,o.resumeToken),Np(r.remoteStore,o)}for(const s of t)r.Iu.has(s)&&await bc(r.localStore,s,!1).then(()=>{_c(r.remoteStore,s),wc(r,s)}).catch(jo)}}function Op(n){const e=Ae(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=xS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=EM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=vM.bind(null,e),e.Pu.H_=aM.bind(null,e.eventManager),e.Pu.yu=lM.bind(null,e.eventManager),e}function jy(n){const e=Ae(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=yM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bM.bind(null,e),e}function kM(n,e,t){const r=Ae(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(v,x){const _=Ae(v),w=Nn(x.createTime);return _.persistence.runTransaction("hasNewerBundle","readonly",T=>_.Ii.getBundleMetadata(T,x.id)).then(T=>!!T&&T.createTime.compareTo(w)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(v){return{taskState:"Success",documentsLoaded:v.totalDocuments,bytesLoaded:v.totalBytes,totalDocuments:v.totalDocuments,totalBytes:v.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(vS(l));const c=new My(l,o.serializer);let f=await o.bu();for(;f;){const p=await c.Ga(f);p&&a._updateProgress(p),f=await o.bu()}const h=await c.ja(i.localStore);return await qi(i,h.Ha,void 0),await function(v,x){const _=Ae(v);return _.persistence.runTransaction("Save bundle","readwrite",w=>_.Ii.saveBundleMetadata(w,x))}(i.localStore,l),a._completeWith(h.progress),Promise.resolve(h.Ja)}catch(l){return as(Ho,`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class xc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=sl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return X1(this.persistence,new Y1,e.initialUser,this.serializer)}Cu(e){return new wy(Dp.mi,this.serializer)}Du(e){return new lS}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}xc.provider={build:()=>new xc};class qy extends xc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Fe(this.persistence.referenceDelegate instanceof Of,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new H1(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?ur.withCacheSize(this.cacheSizeBytes):ur.DEFAULT;return new wy(r=>Of.mi(r,t),this.serializer)}}class By extends xc{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await jy(this.xu.syncEngine),await kc(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return X1(this.persistence,new Y1,e.initialUser,this.serializer)}Fu(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new H1(r,e.asyncQueue,t)}Mu(e,t){const r=new WV(t,this.persistence);return new HV(e.asyncQueue,r)}Cu(e){const t=Ey(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?ur.withCacheSize(this.cacheSizeBytes):ur.DEFAULT;return new xy(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,cS(),of(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new lS}}class TS extends By{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xu.syncEngine;this.sharedClientState instanceof Qm&&(this.sharedClientState.syncEngine={Co:SM.bind(null,t),vo:CM.bind(null,t),Fo:RM.bind(null,t),Ts:PM.bind(null,t),Do:TM.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji(async r=>{await AM(this.xu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Du(e){const t=cS();if(!Qm.v(t))throw new he(Y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Ey(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Qm(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Vo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Xw(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=xM.bind(null,this.syncEngine),await Zg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new oM}()}createDatastore(e){const t=sl(e.databaseInfo.databaseId),r=function(i){return new q4(i)}(e.databaseInfo);return function(i,o,a,l){return new W4(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new G4(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Xw(this.syncEngine,t,0),function(){return Hw.v()?new Hw:new $4}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,f){const h=new dM(s,i,o,a,l,c);return f&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ae(s);ve(Qa,"RemoteStore shutting down."),i.Ea.add(5),await Rc(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Vo.provider={build:()=>new Vo};function ex(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Dn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DM{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new Gn,this.buffer=new Uint8Array,this.Lu=function(){return new TextDecoder("utf-8")}(),this.ku().then(r=>{r&&r.$a()?this.metadata.resolve(r.Qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Qa)}`))},r=>this.metadata.reject(r))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async bu(){return await this.getMetadata(),this.ku()}async ku(){const e=await this.qu();if(e===null)return null;const t=this.Lu.decode(e),r=Number(t);isNaN(r)&&this.Qu(`length string (${t}) is not valid number`);const s=await this.$u(r);return new gS(JSON.parse(s),e.length+r)}Uu(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qu(){for(;this.Uu()<0&&!await this.Ku(););if(this.buffer.length===0)return null;const e=this.Uu();e<0&&this.Qu("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async $u(e){for(;this.buffer.length<e;)await this.Ku()&&this.Qu("Reached the end of bundle when more is expected.");const t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qu(e){throw this.Bu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ku(){const e=await this.Bu.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NM{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.bu();if(!r||!r.$a())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r==null?void 0:r.Qa)}`);this.metadata=r;do r=this.bu(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Wu(){return this.elements}bu(){if(this.cursor===this.bundleData.length)return null;const e=this.qu(),t=this.$u(e);return new gS(JSON.parse(t),e)}$u(e){if(this.cursor+e>this.bundleData.length)throw new he(Y.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}qu(){const e=this.cursor;let t=this.cursor;for(;t<this.bundleData.length;){if(this.bundleData[t]==="{"){if(t===e)throw new Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw new Error("Reached the end of bundle when more is expected.")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OM{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new he(Y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ae(s),a={documents:i.map(h=>wd(o.serializer,h))},l=await o.Ho("BatchGetDocuments",o.serializer.databaseId,vt.emptyPath(),a,i.length),c=new Map;l.forEach(h=>{const p=J3(o.serializer,h);c.set(p.key.toString(),p)});const f=[];return i.forEach(h=>{const p=c.get(h.toString());Fe(!!p,55234,{key:h}),f.push(p)}),f}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Cc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Te.fromPath(r);this.mutations.push(new hy(s,this.precondition(s)))}),await async function(r,s){const i=Ae(r),o={writes:s.map(a=>xd(i.serializer,a))};await i.Go("Commit",i.serializer.databaseId,vt.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ne(50498,{Gu:e.constructor.name});t=He.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new he(Y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(He.min())?hn.exists(!1):hn.updateTime(t):hn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(He.min()))throw new he(Y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return hn.updateTime(t)}return hn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VM{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.zu=r.maxAttempts,this.M_=new Ay(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(async()=>{const e=new OM(this.datastore),t=this.Hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.Yu(s)}))}).catch(r=>{this.Yu(r)})})}Hu(e){try{const t=this.updateFunction(e);return!$d(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!_1(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo="FirestoreClient";class MM{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Wn.UNAUTHENTICATED,this.clientId=Xv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{ve(Mo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ve(Mo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Nc(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ym(n,e){n.asyncQueue.verifyOperationInProgress(),ve(Mo,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await Z1(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function tx(n,e){n.asyncQueue.verifyOperationInProgress();const t=await zy(n);ve(Mo,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Kw(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Kw(e.remoteStore,s)),n._onlineComponents=e}async function zy(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ve(Mo,"Using user provided OfflineComponentProvider");try{await Ym(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Y.FAILED_PRECONDITION||s.code===Y.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;as("Error using user provided cache. Falling back to memory cache: "+t),await Ym(n,new xc)}}else ve(Mo,"Using default OfflineComponentProvider"),await Ym(n,new qy(void 0));return n._offlineComponents}async function Mp(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ve(Mo,"Using user provided OnlineComponentProvider"),await tx(n,n._uninitializedComponentsProvider._online)):(ve(Mo,"Using default OnlineComponentProvider"),await tx(n,new Vo))),n._onlineComponents}function SS(n){return zy(n).then(e=>e.persistence)}function Oc(n){return zy(n).then(e=>e.localStore)}function AS(n){return Mp(n).then(e=>e.remoteStore)}function Hy(n){return Mp(n).then(e=>e.syncEngine)}function PS(n){return Mp(n).then(e=>e.datastore)}async function Ec(n){const e=await Mp(n),t=e.eventManager;return t.onListen=hM.bind(null,e.syncEngine),t.onUnlisten=pM.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=fM.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=mM.bind(null,e.syncEngine),t}function LM(n){return n.asyncQueue.enqueue(async()=>{const e=await SS(n),t=await AS(n);return e.setNetworkEnabled(!0),function(s){const i=Ae(s);return i.Ea.delete(0),Wd(i)}(t)})}function $M(n){return n.asyncQueue.enqueue(async()=>{const e=await SS(n),t=await AS(n);return e.setNetworkEnabled(!1),async function(s){const i=Ae(s);i.Ea.add(0),await Rc(i),i.Ra.set("Offline")}(t)})}function FM(n,e){const t=new Gn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,f){const h=Ae(c);return h.persistence.runTransaction("read document","readonly",p=>h.localDocuments.getDocument(p,f))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new he(Y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Nc(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await Oc(n),e,t)),t.promise}function CS(n,e,t={}){const r=new Gn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const f=new Vp({next:p=>{f.Nu(),o.enqueueAndForget(()=>Ny(i,h));const v=p.docs.has(a);!v&&p.fromCache?c.reject(new he(Y.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&p.fromCache&&l&&l.source==="server"?c.reject(new he(Y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(p)},error:p=>c.reject(p)}),h=new Vy(Ac(a.path),f,{includeMetadataChanges:!0,qa:!0});return Dy(i,h)}(await Ec(n),n.asyncQueue,e,t,r)),r.promise}function UM(n,e){const t=new Gn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Vf(s,i,!0),l=new _S(i,a.Qs),c=l.ru(a.documents),f=l.applyChanges(c,!1);o.resolve(f.snapshot)}catch(a){const l=Nc(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await Oc(n),e,t)),t.promise}function RS(n,e,t={}){const r=new Gn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const f=new Vp({next:p=>{f.Nu(),o.enqueueAndForget(()=>Ny(i,h)),p.fromCache&&l.source==="server"?c.reject(new he(Y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(p)},error:p=>c.reject(p)}),h=new Vy(a,f,{includeMetadataChanges:!0,qa:!0});return Dy(i,h)}(await Ec(n),n.asyncQueue,e,t,r)),r.promise}function jM(n,e,t){const r=new Gn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await PS(n);r.resolve(async function(o,a,l){var _;const c=Ae(o),{request:f,gt:h,parent:p}=k1(c.serializer,r1(a),l);c.connection.$o||delete f.parent;const v=(await c.Ho("RunAggregationQuery",c.serializer.databaseId,p,f,1)).filter(w=>!!w.result);Fe(v.length===1,64727);const x=(_=v[0].result)==null?void 0:_.aggregateFields;return Object.keys(x).reduce((w,T)=>(w[h[T]]=x[T],w),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function qM(n,e){const t=new Vp(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ae(s).Ca.add(i),i.next()}(await Ec(n),t)),()=>{t.Nu(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ae(s).Ca.delete(i)}(await Ec(n),t))}}function BM(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?x1().encode(o):o,function(f,h){return new DM(f,h)}(function(f,h){if(f instanceof Uint8Array)return ex(f,h);if(f instanceof ArrayBuffer)return ex(new Uint8Array(f),h);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,sl(e));n.asyncQueue.enqueueAndForget(async()=>{kM(await Hy(n),s,r)})}function zM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ae(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Ii.getNamedQuery(o,s))}(await Oc(n),e))}function kS(n,e){return function(r,s){return new NM(r,s)}(n,e)}function HM(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ae(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(h,p,v,x,_){h=[...h],p=[...p],h.sort(v),p.sort(v);const w=h.length,T=p.length;let N=0,I=0;for(;N<T&&I<w;){const j=v(h[I],p[N]);j<0?_(h[I++]):j>0?x(p[N++]):(N++,I++)}for(;N<T;)x(p[N++]);for(;I<w;)_(h[I++])}(c,s,jV,f=>{a.push(o.addFieldIndex(l,f))},f=>{a.push(o.deleteFieldIndex(l,f))})).next(()=>J.waitFor(a)))}(await Oc(n),e))}function WM(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ae(r).Fs.Vs=s}(await Oc(n),e))}function KM(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ae(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await Oc(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DS(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nx=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NS="firestore.googleapis.com",rx=!0;class sx{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new he(Y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=NS,this.ssl=rx}else this.host=e.host,this.ssl=e.ssl??rx;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=U1;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<z1)throw new he(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}UV("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=DS(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new he(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new he(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new he(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Kd{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sx({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new he(Y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new he(Y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sx(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new RV;switch(r.type){case"firstParty":return new OV(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new he(Y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=nx.get(t);r&&(ve("ComponentProvider","Removing Datastore"),nx.delete(t),r.terminate())}(this),Promise.resolve()}}function GM(n,e,t,r={}){var c;n=yt(n,Kd);const s=si(e),i=n._getSettings(),o={...i,emulatorOptions:n._getEmulatorOptions()},a=`${e}:${t}`;s&&(Ld(`https://${a}`),fp("Firestore",!0)),i.host!==NS&&i.host!==a&&as("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Ps(l,o)&&(n._setSettings(l),r.mockUserToken)){let f,h;if(typeof r.mockUserToken=="string")f=r.mockUserToken,h=Wn.MOCK_USER;else{f=CI(r.mockUserToken,(c=n._app)==null?void 0:c.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new he(Y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Wn(p)}n._authCredentials=new kV(new yT(f,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Jn(this.firestore,e,this._query)}}class Wt{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zs(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wt(this.firestore,e,this._key)}toJSON(){return{type:Wt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(rl(t,Wt._jsonSchema))return new Wt(e,r||null,new Te(vt.fromString(t.referencePath)))}}Wt._jsonSchemaVersion="firestore/documentReference/1.0",Wt._jsonSchema={type:$n("string",Wt._jsonSchemaVersion),referencePath:$n("string")};class Zs extends Jn{constructor(e,t,r){super(e,t,Ac(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wt(this.firestore,null,new Te(e))}withConverter(e){return new Zs(this.firestore,e,this._path)}}function tt(n,e,...t){if(n=Me(n),Zv("collection","path",e),n instanceof Kd){const r=vt.fromString(e,...t);return W_(r),new Zs(n,null,r)}{if(!(n instanceof Wt||n instanceof Zs))throw new he(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(vt.fromString(e,...t));return W_(r),new Zs(n.firestore,null,r)}}function gJ(n,e){if(n=yt(n,Kd),Zv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new he(Y.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Jn(n,null,function(r){return new Fi(vt.emptyPath(),r)}(e))}function pe(n,e,...t){if(n=Me(n),arguments.length===1&&(e=Xv.newId()),Zv("doc","path",e),n instanceof Kd){const r=vt.fromString(e,...t);return H_(r),new Wt(n,null,new Te(r))}{if(!(n instanceof Wt||n instanceof Zs))throw new he(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(vt.fromString(e,...t));return H_(r),new Wt(n.firestore,n instanceof Zs?n.converter:null,new Te(r))}}function vJ(n,e){return n=Me(n),e=Me(e),(n instanceof Wt||n instanceof Zs)&&(e instanceof Wt||e instanceof Zs)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function OS(n,e){return n=Me(n),e=Me(e),n instanceof Jn&&e instanceof Jn&&n.firestore===e.firestore&&jd(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ix="AsyncQueue";class ox{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ay(this,"async_queue_retry"),this._c=()=>{const r=of();r&&ve(ix,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=of();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=of();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Gn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!qo(e))throw e;ve(ix,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Dn("INTERNAL UNHANDLED ERROR: ",ax(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=ky.createAndSchedule(this,e,t,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&Ne(47125,{Pc:ax(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ax(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class QM{constructor(){this._progressObserver={},this._taskCompletionResolver=new Gn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yJ=-1;class Jt extends Kd{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new ox,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ox(e),this._firestoreClient=void 0,await e}}}function JM(n,e,t){t||(t=vd);const r=ii(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(Ps(i,e))return s;throw new he(Y.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new he(Y.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<z1)throw new he(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&si(e.host)&&Ld(e.host),r.initialize({options:e,instanceIdentifier:t})}function bJ(n,e){const t=typeof n=="object"?n:nl(),r=typeof n=="string"?n:e||vd,s=ii(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Fv("firestore");i&&GM(s,...i)}return s}function vn(n){if(n._terminated)throw new he(Y.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||VS(n),n._firestoreClient}function VS(n){var r,s,i;const e=n._freezeSettings(),t=function(a,l,c,f){return new _3(a,l,c,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,DS(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new MM(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function _J(n,e){as("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return MS(n,Vo.provider,{build:r=>new By(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function wJ(n){as("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();MS(n,Vo.provider,{build:t=>new TS(t,e.cacheSizeBytes)})}function MS(n,e,t){if((n=yt(n,Jt))._firestoreClient||n._terminated)throw new he(Y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new he(Y.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},VS(n)}function xJ(n){if(n._initialized&&!n._terminated)throw new he(Y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Gn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Ys.v())return Promise.resolve();const s=r+J1;await Ys.delete(s)}(Ey(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function EJ(n){return function(t){const r=new Gn;return t.asyncQueue.enqueueAndForget(async()=>_M(await Hy(t),r)),r.promise}(vn(n=yt(n,Jt)))}function IJ(n){return LM(vn(n=yt(n,Jt)))}function TJ(n){return $M(vn(n=yt(n,Jt)))}function SJ(n){return HN(n.app,"firestore",n._databaseId.database),n._delete()}function lx(n,e){const t=vn(n=yt(n,Jt)),r=new QM;return BM(t,n._databaseId,e,r),r}function YM(n,e){return zM(vn(n=yt(n,Jt)),e).then(t=>t?new Jn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class XM{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new zr(Sn.fromBase64String(e))}catch(t){throw new he(Y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new zr(Sn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:zr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(rl(e,zr._jsonSchema))return zr.fromBase64String(e.bytes)}}zr._jsonSchemaVersion="firestore/bytes/1.0",zr._jsonSchema={type:$n("string",zr._jsonSchemaVersion),bytes:$n("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new he(Y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function AJ(){return new il(Dg)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new he(Y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new he(Y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return st(this._lat,e._lat)||st(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ei._jsonSchemaVersion}}static fromJSON(e){if(rl(e,ei._jsonSchema))return new ei(e.latitude,e.longitude)}}ei._jsonSchemaVersion="firestore/geoPoint/1.0",ei._jsonSchema={type:$n("string",ei._jsonSchemaVersion),latitude:$n("number"),longitude:$n("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Is._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(rl(e,Is._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Is(e.vectorValues);throw new he(Y.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Is._jsonSchemaVersion="firestore/vectorValue/1.0",Is._jsonSchema={type:$n("string",Is._jsonSchemaVersion),vectorValues:$n("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM=/^__.*__$/;class eL{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new ji(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pc(e,this.data,t,this.fieldTransforms)}}class LS{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ji(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function $S(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ne(40011,{Ac:n})}}class Lp{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Lp({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ff(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if($S(this.Ac)&&ZM.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class tL{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||sl(e)}Cc(e,t,r,s=!1){return new Lp({Ac:e,methodName:t,Dc:r,path:dn.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function al(n){const e=n._freezeSettings(),t=sl(n._databaseId);return new tL(n._databaseId,!!e.ignoreUndefinedProperties,t)}function $p(n,e,t,r,s,i={}){const o=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Xy("Data must be an object, but it was:",o,r);const a=jS(r,o);let l,c;if(i.merge)l=new Nr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const h of i.mergeFields){const p=Id(e,h,t);if(!o.contains(p))throw new he(Y.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);BS(f,p)||f.push(p)}l=new Nr(f),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new eL(new or(a),l,c)}class Gd extends ol{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Gd}}function FS(n,e,t){return new Lp({Ac:3,Dc:e.settings.Dc,methodName:n._methodName,fc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Wy extends ol{_toFieldTransform(e){return new Bd(e.path,new mc)}isEqual(e){return e instanceof Wy}}class Ky extends ol{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=FS(this,e,!0),r=this.vc.map(i=>ll(i,t)),s=new za(r);return new Bd(e.path,s)}isEqual(e){return e instanceof Ky&&Ps(this.vc,e.vc)}}class Gy extends ol{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=FS(this,e,!0),r=this.vc.map(i=>ll(i,t)),s=new Ha(r);return new Bd(e.path,s)}isEqual(e){return e instanceof Gy&&Ps(this.vc,e.vc)}}class Qy extends ol{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new gc(e.serializer,h1(e.serializer,this.Fc));return new Bd(e.path,t)}isEqual(e){return e instanceof Qy&&this.Fc===e.Fc}}function Jy(n,e,t,r){const s=n.Cc(1,e,t);Xy("Data must be an object, but it was:",s,r);const i=[],o=or.empty();Bo(r,(l,c)=>{const f=Fp(e,l,t);c=Me(c);const h=s.yc(f);if(c instanceof Gd)i.push(f);else{const p=ll(c,h);p!=null&&(i.push(f),o.set(f,p))}});const a=new Nr(i);return new LS(o,a,s.fieldTransforms)}function Yy(n,e,t,r,s,i){const o=n.Cc(1,e,t),a=[Id(e,r,t)],l=[s];if(i.length%2!=0)throw new he(Y.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)a.push(Id(e,i[p])),l.push(i[p+1]);const c=[],f=or.empty();for(let p=a.length-1;p>=0;--p)if(!BS(c,a[p])){const v=a[p];let x=l[p];x=Me(x);const _=o.yc(v);if(x instanceof Gd)c.push(v);else{const w=ll(x,_);w!=null&&(c.push(v),f.set(v,w))}}const h=new Nr(c);return new LS(f,h,o.fieldTransforms)}function US(n,e,t,r=!1){return ll(t,n.Cc(r?4:3,e))}function ll(n,e){if(qS(n=Me(n)))return Xy("Unsupported field value:",e,n),jS(n,e);if(n instanceof ol)return function(r,s){if(!$S(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=ll(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Me(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return h1(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=jt.fromDate(r);return{timestampValue:vc(s.serializer,i)}}if(r instanceof jt){const i=new jt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:vc(s.serializer,i)}}if(r instanceof ei)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof zr)return{bytesValue:T1(s.serializer,r._byteString)};if(r instanceof Wt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:vy(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Is)return function(o,a){return{mapValue:{fields:{[oy]:{stringValue:ay},[hc]:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Sc("VectorValues must only contain numeric values.");return dy(a.serializer,c)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${vp(r)}`)}(n,e)}function jS(n,e){const t={};return FT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bo(n,(r,s)=>{const i=ll(s,e.mc(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function qS(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof jt||n instanceof ei||n instanceof zr||n instanceof Wt||n instanceof ol||n instanceof Is)}function Xy(n,e,t){if(!qS(t)||!_T(t)){const r=vp(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function Id(n,e,t){if((e=Me(e))instanceof il)return e._internalPath;if(typeof e=="string")return Fp(n,e);throw Ff("Field path arguments must be of type string or ",n,!1,void 0,t)}const nL=new RegExp("[~\\*/\\[\\]]");function Fp(n,e,t){if(e.search(nL)>=0)throw Ff(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new il(...e.split("."))._internalPath}catch{throw Ff(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ff(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new he(Y.INVALID_ARGUMENT,a+n+l)}function BS(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Wt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new rL(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Up("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class rL extends Td{data(){return super.data()}}function Up(n,e){return typeof e=="string"?Fp(n,e):e instanceof il?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zS(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new he(Y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Zy{}class Qd extends Zy{}function Lo(n,e,...t){let r=[];e instanceof Zy&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof Vc).length,a=i.filter(l=>l instanceof Jd).length;if(o>1||o>0&&a>0)throw new he(Y.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Jd extends Qd{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Jd(e,t,r)}_apply(e){const t=this._parse(e);return WS(e._query,t),new Jn(e.firestore,e.converter,Bg(e._query,t))}_parse(e){const t=al(e.firestore);return function(i,o,a,l,c,f,h){let p;if(c.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new he(Y.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){ux(h,f);const x=[];for(const _ of h)x.push(cx(l,i,_));p={arrayValue:{values:x}}}else p=cx(l,i,h)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||ux(h,f),p=US(a,o,h,f==="in"||f==="not-in");return xt.create(c,f,p)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function ss(n,e,t){const r=e,s=Up("where",n);return Jd._create(s,r,t)}class Vc extends Zy{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Vc(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:qt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)WS(o,l),o=Bg(o,l)}(e._query,t),new Jn(e.firestore,e.converter,Bg(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function PJ(...n){return n.forEach(e=>KS("or",e)),Vc._create("or",n)}function CJ(...n){return n.forEach(e=>KS("and",e)),Vc._create("and",n)}class e0 extends Qd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new e0(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new he(Y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new he(Y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new _d(i,o)}(e._query,this._field,this._direction);return new Jn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Fi(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function sL(n,e="asc"){const t=e,r=Up("orderBy",n);return e0._create(r,t)}class jp extends Qd{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new jp(e,t,r)}_apply(e){return new Jn(e.firestore,e.converter,Rf(e._query,this._limit,this._limitType))}}function RJ(n){return wT("limit",n),jp._create("limit",n,"F")}function kJ(n){return wT("limitToLast",n),jp._create("limitToLast",n,"L")}class qp extends Qd{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new qp(e,t,r)}_apply(e){const t=HS(e,this.type,this._docOrFields,this._inclusive);return new Jn(e.firestore,e.converter,function(s,i){return new Fi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function DJ(...n){return qp._create("startAt",n,!0)}function NJ(...n){return qp._create("startAfter",n,!1)}class Bp extends Qd{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Bp(e,t,r)}_apply(e){const t=HS(e,this.type,this._docOrFields,this._inclusive);return new Jn(e.firestore,e.converter,function(s,i){return new Fi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function OJ(...n){return Bp._create("endBefore",n,!1)}function VJ(...n){return Bp._create("endAt",n,!0)}function HS(n,e,t,r){if(t[0]=Me(t[0]),t[0]instanceof Td)return function(i,o,a,l,c){if(!l)throw new he(Y.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const f=[];for(const h of Gl(i))if(h.field.isKeyField())f.push(qa(o,l.key));else{const p=l.data.field(h.field);if(xp(p))throw new he(Y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const v=h.field.canonicalString();throw new he(Y.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}f.push(p)}return new No(f,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=al(n.firestore);return function(o,a,l,c,f,h){const p=o.explicitOrderBy;if(f.length>p.length)throw new he(Y.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let x=0;x<f.length;x++){const _=f[x];if(p[x].field.isKeyField()){if(typeof _!="string")throw new he(Y.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof _}`);if(!cy(o)&&_.indexOf("/")!==-1)throw new he(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${_}' contains a slash.`);const w=o.path.child(vt.fromString(_));if(!Te.isDocumentKey(w))throw new he(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${w}' is not because it contains an odd number of segments.`);const T=new Te(w);v.push(qa(a,T))}else{const w=US(l,c,_);v.push(w)}}return new No(v,h)}(n._query,n.firestore._databaseId,s,e,t,r)}}function cx(n,e,t){if(typeof(t=Me(t))=="string"){if(t==="")throw new he(Y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cy(e)&&t.indexOf("/")!==-1)throw new he(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(vt.fromString(t));if(!Te.isDocumentKey(r))throw new he(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qa(n,new Te(r))}if(t instanceof Wt)return qa(n,t._key);throw new he(Y.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vp(t)}.`)}function ux(n,e){if(!Array.isArray(n)||n.length===0)throw new he(Y.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function WS(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new he(Y.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new he(Y.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function KS(n,e){if(!(e instanceof Jd||e instanceof Vc))throw new he(Y.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class GS{convertValue(e,t="none"){switch(ko(e)){case 0:return null;case 1:return e.booleanValue;case 2:return un(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Di(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ne(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Bo(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var r,s,i;const t=(i=(s=(r=e.fields)==null?void 0:r[hc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>un(o.doubleValue));return new Is(t)}convertGeoPoint(e){return new ei(un(e.latitude),un(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ep(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(gd(e));default:return null}}convertTimestamp(e){const t=ki(e);return new jt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=vt.fromString(e);Fe(V1(r),9688,{name:e});const s=new ja(r.get(1),r.get(3)),i=new Te(r.popFirst(5));return s.isEqual(t)||Dn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zp(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class t0 extends GS{constructor(e){super(),this.firestore=e}convertBytes(e){return new zr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wt(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MJ(n){return new Ed("sum",Id("sum",n))}function LJ(n){return new Ed("avg",Id("average",n))}function iL(){return new Ed("count")}function $J(n,e){var t,r;return n instanceof Ed&&e instanceof Ed&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)==null?void 0:t.canonicalString())===((r=e._internalFieldPath)==null?void 0:r.canonicalString())}function FJ(n,e){return OS(n.query,e.query)&&Ps(n.data(),e.data())}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QS="NOT SUPPORTED";class _o{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Kr extends Td{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new af(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Up("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new he(Y.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Kr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}function UJ(n,e,t){if(rl(e,Kr._jsonSchema)){if(e.bundle===QS)throw new he(Y.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=sl(n._databaseId),s=kS(e.bundle,r),i=s.Wu(),o=new My(s.getMetadata(),r);for(const f of i)o.Ga(f);const a=o.documents;if(a.length!==1)throw new he(Y.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${a.length} documents.`);const l=Ap(r,a[0].document),c=new Te(vt.fromString(e.bundleName));return new Kr(n,new t0(n),c,l,new _o(!1,!1),t||null)}}Kr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Kr._jsonSchema={type:$n("string",Kr._jsonSchemaVersion),bundleSource:$n("string","DocumentSnapshot"),bundleName:$n("string"),bundle:$n("string")};class af extends Kr{data(e={}){return super.data(e)}}class Gr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new _o(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new af(this._firestore,this._userDataWriter,r.key,r,new _o(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new he(Y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new af(s._firestore,s._userDataWriter,a.doc.key,a.doc,new _o(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new af(s._firestore,s._userDataWriter,a.doc.key,a.doc,new _o(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,f=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),f=o.indexOf(a.doc.key)),{type:oL(a.type),doc:l,oldIndex:c,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new he(Y.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Gr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Xv.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function jJ(n,e,t){if(rl(e,Gr._jsonSchema)){if(e.bundle===QS)throw new he(Y.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");const r=sl(n._databaseId),s=kS(e.bundle,r),i=s.Wu(),o=new My(s.getMetadata(),r);for(const p of i)o.Ga(p);if(o.queries.length!==1)throw new he(Y.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);const a=Cp(o.queries[0].bundledQuery),l=o.documents;let c=new Oa;l.map(p=>{const v=Ap(r,p.document);c=c.add(v)});const f=Ja.fromInitialDocuments(a,c,ft(),!1,!1),h=new Jn(n,t||null,a);return new Gr(n,new t0(n),h,f)}}function oL(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ne(61501,{type:n})}}function qJ(n,e){return n instanceof Kr&&e instanceof Kr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Gr&&e instanceof Gr&&n._firestore===e._firestore&&OS(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tt(n){n=yt(n,Wt);const e=yt(n.firestore,Jt);return CS(vn(e),n._key).then(t=>n0(e,n,t))}Gr._jsonSchemaVersion="firestore/querySnapshot/1.0",Gr._jsonSchema={type:$n("string",Gr._jsonSchemaVersion),bundleSource:$n("string","QuerySnapshot"),bundleName:$n("string"),bundle:$n("string")};class Wo extends GS{constructor(e){super(),this.firestore=e}convertBytes(e){return new zr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wt(this.firestore,null,t)}}function BJ(n){n=yt(n,Wt);const e=yt(n.firestore,Jt),t=vn(e),r=new Wo(e);return FM(t,n._key).then(s=>new Kr(e,r,n._key,s,new _o(s!==null&&s.hasLocalMutations,!0),n.converter))}function zJ(n){n=yt(n,Wt);const e=yt(n.firestore,Jt);return CS(vn(e),n._key,{source:"server"}).then(t=>n0(e,n,t))}function It(n){n=yt(n,Jn);const e=yt(n.firestore,Jt),t=vn(e),r=new Wo(e);return zS(n._query),RS(t,n._query).then(s=>new Gr(e,r,n,s))}function HJ(n){n=yt(n,Jn);const e=yt(n.firestore,Jt),t=vn(e),r=new Wo(e);return UM(t,n._query).then(s=>new Gr(e,r,n,s))}function WJ(n){n=yt(n,Jn);const e=yt(n.firestore,Jt),t=vn(e),r=new Wo(e);return RS(t,n._query,{source:"server"}).then(s=>new Gr(e,r,n,s))}function en(n,e,t){n=yt(n,Wt);const r=yt(n.firestore,Jt),s=zp(n.converter,e,t);return Yd(r,[$p(al(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,hn.none())])}function cs(n,e,t,...r){n=yt(n,Wt);const s=yt(n.firestore,Jt),i=al(s);let o;return o=typeof(e=Me(e))=="string"||e instanceof il?Yy(i,"updateDoc",n._key,e,t,r):Jy(i,"updateDoc",n._key,e),Yd(s,[o.toMutation(n._key,hn.exists(!0))])}function Ni(n){return Yd(yt(n.firestore,Jt),[new Cc(n._key,hn.none())])}function Bi(n,e){const t=yt(n.firestore,Jt),r=pe(n),s=zp(n.converter,e);return Yd(t,[$p(al(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,hn.exists(!1))]).then(()=>r)}function dx(n,...e){var l,c,f;n=Me(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Ql(e[r])||(t=e[r++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Ql(e[r])){const h=e[r];e[r]=(l=h.next)==null?void 0:l.bind(h),e[r+1]=(c=h.error)==null?void 0:c.bind(h),e[r+2]=(f=h.complete)==null?void 0:f.bind(h)}let i,o,a;if(n instanceof Wt)o=yt(n.firestore,Jt),a=Ac(n._key.path),i={next:h=>{e[r]&&e[r](n0(o,n,h))},error:e[r+1],complete:e[r+2]};else{const h=yt(n,Jn);o=yt(h.firestore,Jt),a=h._query;const p=new Wo(o);i={next:v=>{e[r]&&e[r](new Gr(o,p,h,v))},error:e[r+1],complete:e[r+2]},zS(n._query)}return function(p,v,x,_){const w=new Vp(_),T=new Vy(v,w,x);return p.asyncQueue.enqueueAndForget(async()=>Dy(await Ec(p),T)),()=>{w.Nu(),p.asyncQueue.enqueueAndForget(async()=>Ny(await Ec(p),T))}}(vn(o),a,s,i)}function KJ(n,e,...t){const r=Me(n),s=function(l){const c={bundle:"",bundleName:"",bundleSource:""},f=["bundle","bundleName","bundleSource"];for(const h of f){if(!(h in l)){c.error=`snapshotJson missing required field: ${h}`;break}const p=l[h];if(typeof p!="string"){c.error=`snapshotJson field '${h}' must be a string.`;break}if(p.length===0){c.error=`snapshotJson field '${h}' cannot be an empty string.`;break}h==="bundle"?c.bundle=p:h==="bundleName"?c.bundleName=p:h==="bundleSource"&&(c.bundleSource=p)}return c}(e);if(s.error)throw new he(Y.INVALID_ARGUMENT,s.error);let i,o=0;if(typeof t[o]!="object"||Ql(t[o])||(i=t[o++]),s.bundleSource==="QuerySnapshot"){let a=null;if(typeof t[o]=="object"&&Ql(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(c,f,h,p,v){let x,_=!1;return lx(c,f.bundle).then(()=>YM(c,f.bundleName)).then(T=>{T&&!_&&(v&&T.withConverter(v),x=dx(T,h||{},p))}).catch(T=>(p.error&&p.error(T),()=>{})),()=>{_||(_=!0,x&&x())}}(r,s,i,a,t[o])}if(s.bundleSource==="DocumentSnapshot"){let a=null;if(typeof t[o]=="object"&&Ql(t[o])){const l=t[o++];a={next:l.next,error:l.error,complete:l.complete}}else a={next:t[o++],error:t[o++],complete:t[o++]};return function(c,f,h,p,v){let x,_=!1;return lx(c,f.bundle).then(()=>{if(!_){const T=new Wt(c,v||null,Te.fromPath(f.bundleName));x=dx(T,h||{},p)}}).catch(T=>(p.error&&p.error(T),()=>{})),()=>{_||(_=!0,x&&x())}}(r,s,i,a,t[o])}throw new he(Y.INVALID_ARGUMENT,`unsupported bundle source: ${s.bundleSource}`)}function GJ(n,e){return qM(vn(n=yt(n,Jt)),Ql(e)?e:{next:e})}function Yd(n,e){return function(r,s){const i=new Gn;return r.asyncQueue.enqueueAndForget(async()=>gM(await Hy(r),s,i)),i.promise}(vn(n),e)}function n0(n,e,t){const r=t.docs.get(e._key),s=new Wo(n);return new Kr(n,s,e._key,r,new _o(t.hasPendingWrites,t.fromCache),e.converter)}function QJ(n){return aL(n,{count:iL()})}function aL(n,e){const t=yt(n.firestore,Jt),r=vn(t),s=$T(e,(i,o)=>new b1(o,i.aggregateType,i._internalFieldPath));return jM(r,n._query,s).then(i=>function(a,l,c){const f=new Wo(a);return new XM(l,f,c)}(t,n,i))}class lL{constructor(e){this.kind="memory",this._onlineComponentProvider=Vo.provider,this._offlineComponentProvider=e!=null&&e.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new qy(void 0)}}toJSON(){return{kind:this.kind}}}class cL{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=pL(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class uL{constructor(){this.kind="memoryEager",this._offlineComponentProvider=xc.provider}toJSON(){return{kind:this.kind}}}class dL{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new qy(e)}}toJSON(){return{kind:this.kind}}}function JJ(){return new uL}function YJ(n){return new dL(n==null?void 0:n.cacheSizeBytes)}function XJ(n){return new lL(n)}function ZJ(n){return new cL(n)}class hL{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vo.provider,this._offlineComponentProvider={build:t=>new By(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class fL{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Vo.provider,this._offlineComponentProvider={build:t=>new TS(t,e==null?void 0:e.cacheSizeBytes)}}}function pL(n){return new hL(n==null?void 0:n.forceOwnership)}function eY(){return new fL}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mL={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gL{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=al(e)}set(e,t,r){this._verifyNotCommitted();const s=wo(e,this._firestore),i=zp(s.converter,t,r),o=$p(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,hn.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=wo(e,this._firestore);let o;return o=typeof(t=Me(t))=="string"||t instanceof il?Yy(this._dataReader,"WriteBatch.update",i._key,t,r,s):Jy(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,hn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=wo(e,this._firestore);return this._mutations=this._mutations.concat(new Cc(t._key,hn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new he(Y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function wo(n,e){if((n=Me(n)).firestore!==e)throw new he(Y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=al(e)}get(e){const t=wo(e,this._firestore),r=new t0(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return Ne(24041);const i=s[0];if(i.isFoundDocument())return new Td(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Td(this._firestore,r,t._key,null,t.converter);throw Ne(18433,{doc:i})})}set(e,t,r){const s=wo(e,this._firestore),i=zp(s.converter,t,r),o=$p(this._dataReader,"Transaction.set",s._key,i,s.converter!==null,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=wo(e,this._firestore);let o;return o=typeof(t=Me(t))=="string"||t instanceof il?Yy(this._dataReader,"Transaction.update",i._key,t,r,s):Jy(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=wo(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yL extends vL{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=wo(e,this._firestore),r=new Wo(this._firestore);return super.get(e).then(s=>new Kr(this._firestore,r,t._key,s._document,new _o(!1,!1),t.converter))}}function tY(n,e,t){n=yt(n,Jt);const r={...mL,...t};return function(i){if(i.maxAttempts<1)throw new he(Y.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Gn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await PS(i);new VM(i.asyncQueue,c,a,o,l).ju()}),l.promise}(vn(n),s=>e(new yL(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nY(){return new Gd("deleteField")}function on(){return new Wy("serverTimestamp")}function bL(...n){return new Ky("arrayUnion",n)}function rY(...n){return new Gy("arrayRemove",n)}function sY(n){return new Qy("increment",n)}function iY(n){return new Is(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hp(n){return vn(n=yt(n,Jt)),new gL(n,e=>Yd(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oY(n,e){const t=vn(n=yt(n,Jt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return as("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(f){throw new he(Y.INVALID_ARGUMENT,"Failed to parse JSON: "+(f==null?void 0:f.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=hx(l,"collectionGroup"),f=[];if(Array.isArray(l.fields))for(const h of l.fields){const p=Fp("setIndexConfiguration",hx(h,"fieldPath"));h.arrayConfig==="CONTAINS"?f.push(new Da(p,2)):h.order==="ASCENDING"?f.push(new Da(p,0)):h.order==="DESCENDING"&&f.push(new Da(p,1))}a.push(new oc(oc.UNKNOWN_ID,c,f,ac.empty()))}return a}(e);return HM(t,r)}function hx(n,e){if(typeof n[e]!="string")throw new he(Y.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _L{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function aY(n){var s;n=yt(n,Jt);const e=fx.get(n);if(e)return e;if(((s=vn(n)._uninitializedComponentsProvider)==null?void 0:s._offline.kind)!=="persistent")return null;const r=new _L(n);return fx.set(n,r),r}function lY(n){JS(n,!0)}function cY(n){JS(n,!1)}function uY(n){KM(vn(n._firestore)).then(e=>ve("deleting all persistent cache indexes succeeded")).catch(e=>as("deleting all persistent cache indexes failed",e))}function JS(n,e){WM(vn(n._firestore),e).then(t=>ve(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>as(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const fx=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dY(n){var r;const e=vn(yt(n.firestore,Jt)),t=(r=e._onlineComponents)==null?void 0:r.datastore.serializer;return t===void 0?null:Pp(t,gr(n._query)).ft}function hY(n,e){var i;const t=$T(e,(o,a)=>new b1(a,o.aggregateType,o._internalFieldPath)),r=vn(yt(n.firestore,Jt)),s=(i=r._onlineComponents)==null?void 0:i.datastore.serializer;return s===void 0?null:k1(s,r1(n._query),t,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fY{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return r0.instance.onExistenceFilterMismatch(e)}}class r0{constructor(){this.Mc=new Map}static get instance(){return Vh||(Vh=new r0,function(t){if(Hu)throw new Error("a TestingHooksSpi instance is already set");Hu=t}(Vh)),Vh}lt(e){this.Mc.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Mc;return r.set(t,e),()=>r.delete(t)}}let Vh=null;(function(e,t=!0){(function(s){Sc=s})(tl),os(new Qr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Jt(new DV(r.getProvider("auth-internal")),new VV(o,r.getProvider("app-check-internal")),function(c,f){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new he(Y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ja(c.options.projectId,f)}(o,s),o);return i={useFetchStreams:t,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),pr(B_,z_,e),pr(B_,z_,"esm2020")})();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YS="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wL{constructor(e,t,r,s){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,sn(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||r.get().then(i=>this.messaging=i,()=>{}),this.appCheck||s==null||s.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nv="us-central1";class xL{constructor(e,t,r,s,i=nv,o=(...a)=>fetch(...a)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new wL(e,t,r,s),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(i);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=nv}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function EL(n,e,t){const r=si(e);n.emulatorOrigin=`http${r?"s":""}://${e}:${t}`,r&&(Ld(n.emulatorOrigin),fp("Functions",!0))}const px="@firebase/functions",mx="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL="auth-internal",TL="app-check-internal",SL="messaging-internal";function AL(n){const e=(t,{instanceIdentifier:r})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider(IL),o=t.getProvider(SL),a=t.getProvider(TL);return new xL(s,i,o,a,r)};os(new Qr(YS,e,"PUBLIC").setMultipleInstances(!0)),pr(px,mx,n),pr(px,mx,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PL(n=nl(),e=nv){const r=ii(Me(n),YS).getImmediate({identifier:e}),s=Fv("functions");return s&&CL(r,...s),r}function CL(n,e,t){EL(Me(n),e,t)}AL();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XS="firebasestorage.googleapis.com",ZS="storageBucket",RL=2*60*1e3,kL=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn extends Cs{constructor(e,t,r=0){super(Xm(e),`Firebase Storage: ${t} (${Xm(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Pn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Xm(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var An;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(An||(An={}));function Xm(n){return"storage/"+n}function s0(){const n="An unknown error occurred, please check the error payload for server response.";return new Pn(An.UNKNOWN,n)}function DL(n){return new Pn(An.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function NL(n){return new Pn(An.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function OL(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Pn(An.UNAUTHENTICATED,n)}function VL(){return new Pn(An.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function ML(n){return new Pn(An.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function LL(){return new Pn(An.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function $L(){return new Pn(An.CANCELED,"User canceled the upload/download.")}function FL(n){return new Pn(An.INVALID_URL,"Invalid URL '"+n+"'.")}function UL(n){return new Pn(An.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function jL(){return new Pn(An.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+ZS+"' property when initializing the app?")}function qL(){return new Pn(An.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function BL(){return new Pn(An.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function zL(n){return new Pn(An.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function rv(n){return new Pn(An.INVALID_ARGUMENT,n)}function eA(){return new Pn(An.APP_DELETED,"The Firebase app was deleted.")}function HL(n){return new Pn(An.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ku(n,e){return new Pn(An.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function gu(n){throw new Pn(An.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Wr.makeFromUrl(e,t)}catch{return new Wr(e,"")}if(r.path==="")return r;throw UL(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(j){j.path.charAt(j.path.length-1)==="/"&&(j.path_=j.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(j){j.path_=decodeURIComponent(j.path)}const f="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",v=new RegExp(`^https?://${h}/${f}/b/${s}/o${p}`,"i"),x={bucket:1,path:3},_=t===XS?"(?:storage.googleapis.com|storage.cloud.google.com)":t,w="([^?#]*)",T=new RegExp(`^https?://${_}/${s}/${w}`,"i"),I=[{regex:a,indices:l,postModify:i},{regex:v,indices:x,postModify:c},{regex:T,indices:{bucket:1,path:2},postModify:c}];for(let j=0;j<I.length;j++){const ne=I[j],ae=ne.regex.exec(e);if(ae){const V=ae[ne.indices.bucket];let P=ae[ne.indices.path];P||(P=""),r=new Wr(V,P),ne.postModify(r);break}}if(r==null)throw FL(e);return r}}class WL{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KL(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function f(...w){c||(c=!0,e.apply(null,w))}function h(w){s=setTimeout(()=>{s=null,n(v,l())},w)}function p(){i&&clearTimeout(i)}function v(w,...T){if(c){p();return}if(w){p(),f.call(null,w,...T);return}if(l()||o){p(),f.call(null,w,...T);return}r<64&&(r*=2);let I;a===1?(a=2,I=0):I=(r+Math.random())*1e3,h(I)}let x=!1;function _(w){x||(x=!0,p(),!c&&(s!==null?(w||(a=2),clearTimeout(s),h(0)):w||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,_(!0)},t),_}function GL(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QL(n){return n!==void 0}function JL(n){return typeof n=="object"&&!Array.isArray(n)}function i0(n){return typeof n=="string"||n instanceof String}function gx(n){return o0()&&n instanceof Blob}function o0(){return typeof Blob<"u"}function vx(n,e,t,r){if(r<e)throw rv(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw rv(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wp(n,e,t){let r=e;return t==null&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function tA(n){const e=encodeURIComponent;let t="?";for(const r in n)if(n.hasOwnProperty(r)){const s=e(r)+"="+e(n[r]);t=t+s+"&"}return t=t.slice(0,-1),t}var Va;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Va||(Va={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YL(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,i=e.indexOf(n)!==-1;return t||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XL{constructor(e,t,r,s,i,o,a,l,c,f,h,p=!0,v=!1){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=f,this.connectionFactory_=h,this.retry=p,this.isUsingEmulator=v,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((x,_)=>{this.resolve_=x,this.reject_=_,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Mh(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Va.NO_ERROR,l=i.getStatus();if(!a||YL(l,this.additionalRetryCodes_)&&this.retry){const f=i.getErrorCode()===Va.ABORT;r(!1,new Mh(!1,null,f));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new Mh(c,i))})},t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());QL(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=s0();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?eA():$L();o(l)}else{const l=LL();o(l)}};this.canceled_?t(!1,new Mh(!1,null,!0)):this.backoffId_=KL(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&GL(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Mh{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function ZL(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function e$(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function t$(n,e){e&&(n["X-Firebase-GMPID"]=e)}function n$(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function r$(n,e,t,r,s,i,o=!0,a=!1){const l=tA(n.urlParams),c=n.url+l,f=Object.assign({},n.headers);return t$(f,e),ZL(f,t),e$(f,i),n$(f,r),new XL(c,n.method,f,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s$(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function i$(...n){const e=s$();if(e!==void 0){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}else{if(o0())return new Blob(n);throw new Pn(An.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function o$(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a$(n){if(typeof atob>"u")throw zL("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Zm{constructor(e,t){this.data=e,this.contentType=t||null}}function l$(n,e){switch(n){case Qs.RAW:return new Zm(nA(e));case Qs.BASE64:case Qs.BASE64URL:return new Zm(rA(n,e));case Qs.DATA_URL:return new Zm(u$(e),d$(e))}throw s0()}function nA(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=n.charCodeAt(++t);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function c$(n){let e;try{e=decodeURIComponent(n)}catch{throw Ku(Qs.DATA_URL,"Malformed data URL.")}return nA(e)}function rA(n,e){switch(n){case Qs.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw Ku(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Qs.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw Ku(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=a$(e)}catch(s){throw s.message.includes("polyfill")?s:Ku(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class sA{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw Ku(Qs.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;r!=null&&(this.base64=h$(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function u$(n){const e=new sA(n);return e.base64?rA(Qs.BASE64,e.rest):c$(e.rest)}function d$(n){return new sA(n).contentType}function h$(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class po{constructor(e,t){let r=0,s="";gx(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(gx(this.data_)){const r=this.data_,s=o$(r,e,t);return s===null?null:new po(s)}else{const r=new Uint8Array(this.data_.buffer,e,t-e);return new po(r,!0)}}static getBlob(...e){if(o0()){const t=e.map(r=>r instanceof po?r.data_:r);return new po(i$.apply(null,t))}else{const t=e.map(o=>i0(o)?l$(Qs.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new po(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iA(n){let e;try{e=JSON.parse(n)}catch{return null}return JL(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f$(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function p$(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return n.length===0?t:n+"/"+t}function oA(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m$(n,e){return e}class Ir{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||m$}}let Lh=null;function g$(n){return!i0(n)||n.length<2?n:oA(n)}function aA(){if(Lh)return Lh;const n=[];n.push(new Ir("bucket")),n.push(new Ir("generation")),n.push(new Ir("metageneration")),n.push(new Ir("name","fullPath",!0));function e(i,o){return g$(o)}const t=new Ir("name");t.xform=e,n.push(t);function r(i,o){return o!==void 0?Number(o):o}const s=new Ir("size");return s.xform=r,n.push(s),n.push(new Ir("timeCreated")),n.push(new Ir("updated")),n.push(new Ir("md5Hash",null,!0)),n.push(new Ir("cacheControl",null,!0)),n.push(new Ir("contentDisposition",null,!0)),n.push(new Ir("contentEncoding",null,!0)),n.push(new Ir("contentLanguage",null,!0)),n.push(new Ir("contentType",null,!0)),n.push(new Ir("metadata","customMetadata",!0)),Lh=n,Lh}function v$(n,e){function t(){const r=n.bucket,s=n.fullPath,i=new Wr(r,s);return e._makeStorageReference(i)}Object.defineProperty(n,"ref",{get:t})}function y$(n,e,t){const r={};r.type="file";const s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return v$(r,n),r}function lA(n,e,t){const r=iA(e);return r===null?null:y$(n,r,t)}function b$(n,e,t,r){const s=iA(e);if(s===null||!i0(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const f=n.bucket,h=n.fullPath,p="/b/"+o(f)+"/o/"+o(h),v=Wp(p,t,r),x=tA({alt:"media",token:c});return v+x})[0]}function _$(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}class a0{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cA(n){if(!n)throw s0()}function w$(n,e){function t(r,s){const i=lA(n,s,e);return cA(i!==null),i}return t}function x$(n,e){function t(r,s){const i=lA(n,s,e);return cA(i!==null),b$(i,s,n.host,n._protocol)}return t}function uA(n){function e(t,r){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=VL():s=OL():t.getStatus()===402?s=NL(n.bucket):t.getStatus()===403?s=ML(n.path):s=r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}return e}function dA(n){const e=uA(n);function t(r,s){let i=e(r,s);return r.getStatus()===404&&(i=DL(n.path)),i.serverResponse=s.serverResponse,i}return t}function E$(n,e,t){const r=e.fullServerUrl(),s=Wp(r,n.host,n._protocol),i="GET",o=n.maxOperationRetryTime,a=new a0(s,i,x$(n,t),o);return a.errorHandler=dA(e),a}function I$(n,e){const t=e.fullServerUrl(),r=Wp(t,n.host,n._protocol),s="DELETE",i=n.maxOperationRetryTime;function o(l,c){}const a=new a0(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=dA(e),a}function T$(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function S$(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=T$(null,e)),r}function A$(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let I="";for(let j=0;j<2;j++)I=I+Math.random().toString().slice(2);return I}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=S$(e,r,s),f=_$(c,t),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,p=`\r
--`+l+"--",v=po.getBlob(h,r,p);if(v===null)throw qL();const x={name:c.fullPath},_=Wp(i,n.host,n._protocol),w="POST",T=n.maxUploadRetryTime,N=new a0(_,w,w$(n,t),T);return N.urlParams=x,N.headers=o,N.body=v.uploadData(),N.errorHandler=uA(e),N}class P${constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Va.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Va.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Va.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s,i){if(this.sent_)throw gu("cannot .send() more than once");if(si(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw gu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw gu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw gu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw gu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class C$ extends P${initXhr(){this.xhr_.responseType="text"}}function l0(){return new C$}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e,t){this._service=e,t instanceof Wr?this._location=t:this._location=Wr.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Ya(e,t)}get root(){const e=new Wr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return oA(this._location.path)}get storage(){return this._service}get parent(){const e=f$(this._location.path);if(e===null)return null;const t=new Wr(this._location.bucket,e);return new Ya(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw HL(e)}}function R$(n,e,t){n._throwIfRoot("uploadBytes");const r=A$(n.storage,n._location,aA(),new po(e,!0),t);return n.storage.makeRequestWithTokens(r,l0).then(s=>({metadata:s,ref:n}))}function k$(n){n._throwIfRoot("getDownloadURL");const e=E$(n.storage,n._location,aA());return n.storage.makeRequestWithTokens(e,l0).then(t=>{if(t===null)throw BL();return t})}function D$(n){n._throwIfRoot("deleteObject");const e=I$(n.storage,n._location);return n.storage.makeRequestWithTokens(e,l0)}function N$(n,e){const t=p$(n._location.path,e),r=new Wr(n._location.bucket,t);return new Ya(n.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O$(n){return/^[A-Za-z]+:\/\//.test(n)}function V$(n,e){return new Ya(n,e)}function hA(n,e){if(n instanceof c0){const t=n;if(t._bucket==null)throw jL();const r=new Ya(t,t._bucket);return e!=null?hA(r,e):r}else return e!==void 0?N$(n,e):n}function M$(n,e){if(e&&O$(e)){if(n instanceof c0)return V$(n,e);throw rv("To use ref(service, url), the first argument must be a Storage instance.")}else return hA(n,e)}function yx(n,e){const t=e==null?void 0:e[ZS];return t==null?null:Wr.makeFromBucketSpec(t,n)}function L$(n,e,t,r={}){n.host=`${e}:${t}`;const s=si(e);s&&(Ld(`https://${n.host}/b`),fp("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(n._overrideAuthToken=typeof i=="string"?i:CI(i,n.app.options.projectId))}class c0{constructor(e,t,r,s,i,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=XS,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=RL,this._maxUploadRetryTime=kL,this._requests=new Set,s!=null?this._bucket=Wr.makeFromBucketSpec(s,this._host):this._bucket=yx(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Wr.makeFromBucketSpec(this._url,e):this._bucket=yx(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){vx("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){vx("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(sn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ya(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new WL(eA());{const o=r$(e,this._appId,r,s,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,s).getPromise()}}const bx="@firebase/storage",_x="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fA="storage";function $$(n,e,t){return n=Me(n),R$(n,e,t)}function F$(n){return n=Me(n),k$(n)}function U$(n){return n=Me(n),D$(n)}function pA(n,e){return n=Me(n),M$(n,e)}function j$(n=nl(),e){n=Me(n);const r=ii(n,fA).getImmediate({identifier:e}),s=Fv("storage");return s&&q$(r,...s),r}function q$(n,e,t,r={}){L$(n,e,t,r)}function B$(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new c0(t,r,s,e,tl)}function z$(){os(new Qr(fA,B$,"PUBLIC").setMultipleInstances(!0)),pr(bx,_x,""),pr(bx,_x,"esm2020")}z$();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pY={PHONE:"phone",TOTP:"totp"},mY={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},gY={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},vY={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},yY={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H$(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function mA(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const bY=H$,W$=mA,gA=new el("auth","Firebase",mA()),_Y={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type",INVALID_HOSTING_LINK_DOMAIN:"auth/invalid-hosting-link-domain"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uf=new jv("@firebase/auth");function K$(n,...e){Uf.logLevel<=_t.WARN&&Uf.warn(`Auth (${tl}): ${n}`,...e)}function lf(n,...e){Uf.logLevel<=_t.ERROR&&Uf.error(`Auth (${tl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vr(n,...e){throw d0(n,...e)}function Cr(n,...e){return d0(n,...e)}function u0(n,e,t){const r={...W$(),[e]:t};return new el("auth","Firebase",r).create(e,{appName:n.name})}function Qn(n){return u0(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Mc(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Vr(n,"argument-error"),u0(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function d0(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return gA.create(n,...e)}function _e(n,e,...t){if(!n)throw d0(e,...t)}function Js(n){const e="INTERNAL ASSERTION FAILED: "+n;throw lf(e),new Error(e)}function Oi(n,e){n||Js(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function h0(){return wx()==="http:"||wx()==="https:"}function wx(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G$(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(h0()||FD()||"connection"in navigator)?navigator.onLine:!0}function Q$(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t){this.shortDelay=e,this.longDelay=t,Oi(t>e,"Short delay should be less than long delay!"),this.isMobile=LD()||UD()}get(){return G$()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f0(n,e){Oi(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vA{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Js("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Js("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Js("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J$={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y$=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],X$=new Xd(3e4,6e4);function an(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function ln(n,e,t,r,s={}){return yA(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Tc({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c={method:e,headers:l,...i};return $D()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&si(n.emulatorConfig.host)&&(c.credentials="include"),vA.fetch()(await bA(n,n.config.apiHost,t,a),c)})}async function yA(n,e,t){n._canInitEmulator=!1;const r={...J$,...e};try{const s=new e6(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Au(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Au(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Au(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw Au(n,"user-disabled",o);const f=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw u0(n,f,c);Vr(n,f)}}catch(s){if(s instanceof Cs)throw s;Vr(n,"network-request-failed",{message:String(s)})}}async function zi(n,e,t,r,s={}){const i=await ln(n,e,t,r,s);return"mfaPendingCredential"in i&&Vr(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function bA(n,e,t,r){const s=`${e}${t}?${r}`,i=n,o=i.config.emulator?f0(n.config,s):`${n.config.apiScheme}://${s}`;return Y$.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function Z$(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class e6{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Cr(this.auth,"network-request-failed")),X$.get())})}}function Au(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=Cr(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xx(n){return n!==void 0&&n.getResponse!==void 0}function Ex(n){return n!==void 0&&n.enterprise!==void 0}class _A{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Z$(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t6(n){return(await ln(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function wA(n,e){return ln(n,"GET","/v2/recaptchaConfig",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n6(n,e){return ln(n,"POST","/v1/accounts:delete",e)}async function r6(n,e){return ln(n,"POST","/v1/accounts:update",e)}async function jf(n,e){return ln(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wY(n,e=!1){return Me(n).getIdToken(e)}async function s6(n,e=!1){const t=Me(n),r=await t.getIdToken(e),s=Kp(r);_e(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Gu(eg(s.auth_time)),issuedAtTime:Gu(eg(s.iat)),expirationTime:Gu(eg(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function eg(n){return Number(n)*1e3}function Kp(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return lf("JWT malformed, contained fewer than 3 sections"),null;try{const s=II(t);return s?JSON.parse(s):(lf("Failed to decode base64 JWT payload"),null)}catch(s){return lf("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Ix(n){const e=Kp(n);return _e(e,"internal-error"),_e(typeof e.exp<"u","internal-error"),_e(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vi(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Cs&&i6(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function i6({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o6{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Gu(this.lastLoginAt),this.creationTime=Gu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ad(n){var h;const e=n.auth,t=await n.getIdToken(),r=await Vi(n,jf(e,{idToken:t}));_e(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?xA(s.providerUserInfo):[],o=l6(n.providerData,i),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!(o!=null&&o.length),c=a?l:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new sv(s.createdAt,s.lastLoginAt),isAnonymous:c};Object.assign(n,f)}async function a6(n){const e=Me(n);await Ad(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function l6(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function xA(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c6(n,e){const t=await yA(n,{},async()=>{const r=Tc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=await bA(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return n.emulatorConfig&&si(n.emulatorConfig.host)&&(l.credentials="include"),vA.fetch()(o,l)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function u6(n,e){return ln(n,"POST","/v2/accounts:revokeToken",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_e(e.idToken,"internal-error"),_e(typeof e.idToken<"u","internal-error"),_e(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Ix(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){_e(e.length!==0,"internal-error");const t=Ix(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(_e(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await c6(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new Jl;return r&&(_e(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(_e(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(_e(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Jl,this.toJSON())}_performRefresh(){return Js("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function so(n,e){_e(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class bs{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new o6(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new sv(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Vi(this,this.stsTokenManager.getToken(this.auth,e));return _e(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return s6(this,e)}reload(){return a6(this)}_assign(e){this!==e&&(_e(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new bs({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){_e(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Ad(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(sn(this.auth.app))return Promise.reject(Qn(this.auth));const e=await this.getIdToken();return await Vi(this,n6(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,o=t.photoURL??void 0,a=t.tenantId??void 0,l=t._redirectEventId??void 0,c=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:h,emailVerified:p,isAnonymous:v,providerData:x,stsTokenManager:_}=t;_e(h&&_,e,"internal-error");const w=Jl.fromJSON(this.name,_);_e(typeof h=="string",e,"internal-error"),so(r,e.name),so(s,e.name),_e(typeof p=="boolean",e,"internal-error"),_e(typeof v=="boolean",e,"internal-error"),so(i,e.name),so(o,e.name),so(a,e.name),so(l,e.name),so(c,e.name),so(f,e.name);const T=new bs({uid:h,auth:e,email:s,emailVerified:p,displayName:r,isAnonymous:v,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:w,createdAt:c,lastLoginAt:f});return x&&Array.isArray(x)&&(T.providerData=x.map(N=>({...N}))),l&&(T._redirectEventId=l),T}static async _fromIdTokenResponse(e,t,r=!1){const s=new Jl;s.updateFromServerResponse(t);const i=new bs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Ad(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];_e(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?xA(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new Jl;a.updateFromIdToken(r);const l=new bs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new sv(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tx=new Map;function xi(n){Oi(n instanceof Function,"Expected a class definition");let e=Tx.get(n);return e?(Oi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Tx.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EA{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}EA.type="NONE";const Sx=EA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cf(n,e,t){return`firebase:${n}:${e}:${t}`}class Yl{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=cf(this.userKey,s.apiKey,i),this.fullPersistenceKey=cf("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await jf(this.auth,{idToken:e}).catch(()=>{});return t?bs._fromGetAccountInfoResponse(this.auth,t,e):null}return bs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Yl(xi(Sx),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||xi(Sx);const o=cf(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const f=await c._get(o);if(f){let h;if(typeof f=="string"){const p=await jf(e,{idToken:f}).catch(()=>{});if(!p)break;h=await bs._fromGetAccountInfoResponse(e,p,f)}else h=bs._fromJSON(e,f);c!==i&&(a=h),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Yl(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Yl(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ax(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(AA(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(IA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(CA(e))return"Blackberry";if(RA(e))return"Webos";if(TA(e))return"Safari";if((e.includes("chrome/")||SA(e))&&!e.includes("edge/"))return"Chrome";if(PA(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function IA(n=qn()){return/firefox\//i.test(n)}function TA(n=qn()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function SA(n=qn()){return/crios\//i.test(n)}function AA(n=qn()){return/iemobile/i.test(n)}function PA(n=qn()){return/android/i.test(n)}function CA(n=qn()){return/blackberry/i.test(n)}function RA(n=qn()){return/webos/i.test(n)}function p0(n=qn()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function d6(n=qn()){var e;return p0(n)&&!!((e=window.navigator)!=null&&e.standalone)}function h6(){return jD()&&document.documentMode===10}function kA(n=qn()){return p0(n)||PA(n)||RA(n)||CA(n)||/windows phone/i.test(n)||AA(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DA(n,e=[]){let t;switch(n){case"Browser":t=Ax(qn());break;case"Worker":t=`${Ax(qn())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${tl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f6{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p6(n,e={}){return ln(n,"GET","/v2/passwordPolicy",an(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m6=6;class g6{constructor(e){var r;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??m6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Px(this),this.idTokenSubscription=new Px(this),this.beforeStateQueue=new f6(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=gA,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=xi(t)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Yl.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await jf(this,{idToken:e}),r=await bs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(sn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return _e(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Ad(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Q$()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(sn(this.app))return Promise.reject(Qn(this));const t=e?Me(e):null;return t&&_e(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_e(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return sn(this.app)?Promise.reject(Qn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return sn(this.app)?Promise.reject(Qn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(xi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await p6(this),t=new g6(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new el("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await u6(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&xi(e)||this._popupRedirectResolver;_e(t,this,"argument-error"),this.redirectPersistenceManager=await Yl.create(this,[xi(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(_e(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _e(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=DA(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(sn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&K$(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Cn(n){return Me(n)}class Px{constructor(e){this.auth=e,this.observer=null,this.addObserver=KD(t=>this.observer=t)}get next(){return _e(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zd={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function y6(n){Zd=n}function m0(n){return Zd.loadJS(n)}function b6(){return Zd.recaptchaV2Script}function _6(){return Zd.recaptchaEnterpriseScript}function w6(){return Zd.gapiScript}function NA(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x6=500,E6=6e4,$h=1e12;class I6{constructor(e){this.auth=e,this.counter=$h,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new A6(e,this.auth.name,t||{})),this.counter++,r}reset(e){var r;const t=e||$h;(r=this._widgets.get(t))==null||r.delete(),this._widgets.delete(t)}getResponse(e){var r;const t=e||$h;return((r=this._widgets.get(t))==null?void 0:r.getResponse())||""}async execute(e){var r;const t=e||$h;return(r=this._widgets.get(t))==null||r.execute(),""}}class T6{constructor(){this.enterprise=new S6}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class S6{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class A6{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;_e(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=P6(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},E6)},x6))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function P6(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const C6="recaptcha-enterprise",Qu="NO_RECAPTCHA";class OA{constructor(e){this.type=C6,this.auth=Cn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{wA(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new _A(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;Ex(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(Qu)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new T6().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&Ex(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=_6();l.length!==0&&(l+=a),m0(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function vu(n,e,t,r=!1,s=!1){const i=new OA(n);let o;if(s)o=Qu;else try{o=await i.verify(t)}catch{o=await i.verify(t,!0)}const a={...e};if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Ao(n,e,t,r,s){var i,o;if(s==="EMAIL_PASSWORD_PROVIDER")if((i=n._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await vu(n,e,t,t==="getOobCode");return r(n,a)}else return r(n,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await vu(n,e,t,t==="getOobCode");return r(n,l)}else return Promise.reject(a)});else if(s==="PHONE_PROVIDER")if((o=n._getRecaptchaConfig())!=null&&o.isProviderEnabled("PHONE_PROVIDER")){const a=await vu(n,e,t);return r(n,a).catch(async l=>{var c;if(((c=n._getRecaptchaConfig())==null?void 0:c.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(l.code==="auth/missing-recaptcha-token"||l.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const f=await vu(n,e,t,!1,!0);return r(n,f)}return Promise.reject(l)})}else{const a=await vu(n,e,t,!1,!0);return r(n,a)}else return Promise.reject(s+" provider is not supported.")}async function VA(n){const e=Cn(n),t=await wA(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new _A(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new OA(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R6(n,e){const t=ii(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(Ps(i,e??{}))return s;Vr(s,"already-initialized")}return t.initialize({options:e})}function k6(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(xi);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function D6(n,e,t){const r=Cn(n);_e(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=MA(e),{host:o,port:a}=N6(e),l=a===null?"":`:${a}`,c={url:`${i}//${o}${l}/`},f=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){_e(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),_e(Ps(c,r.config.emulator)&&Ps(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=c,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,si(o)?(Ld(`${i}//${o}${l}`),fp("Auth",!0)):s||O6()}function MA(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function N6(n){const e=MA(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Cx(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Cx(o)}}}function Cx(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function O6(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Js("not implemented")}_getIdTokenResponse(e){return Js("not implemented")}_linkToIdToken(e,t){return Js("not implemented")}_getReauthenticationResolver(e){return Js("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LA(n,e){return ln(n,"POST","/v1/accounts:resetPassword",an(n,e))}async function V6(n,e){return ln(n,"POST","/v1/accounts:update",e)}async function M6(n,e){return ln(n,"POST","/v1/accounts:signUp",e)}async function L6(n,e){return ln(n,"POST","/v1/accounts:update",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $6(n,e){return zi(n,"POST","/v1/accounts:signInWithPassword",an(n,e))}async function Gp(n,e){return ln(n,"POST","/v1/accounts:sendOobCode",an(n,e))}async function F6(n,e){return Gp(n,e)}async function U6(n,e){return Gp(n,e)}async function j6(n,e){return Gp(n,e)}async function q6(n,e){return Gp(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B6(n,e){return zi(n,"POST","/v1/accounts:signInWithEmailLink",an(n,e))}async function z6(n,e){return zi(n,"POST","/v1/accounts:signInWithEmailLink",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd extends eh{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Pd(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Pd(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ao(e,t,"signInWithPassword",$6,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return B6(e,{email:this._email,oobCode:this._password});default:Vr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ao(e,r,"signUpPassword",M6,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return z6(e,{idToken:t,email:this._email,oobCode:this._password});default:Vr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ai(n,e){return zi(n,"POST","/v1/accounts:signInWithIdp",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H6="http://localhost";class Mi extends eh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Mi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Vr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const o=new Mi(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Ai(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ai(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ai(e,t)}buildRequest(){const e={requestUri:H6,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Tc(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rx(n,e){return ln(n,"POST","/v1/accounts:sendVerificationCode",an(n,e))}async function W6(n,e){return zi(n,"POST","/v1/accounts:signInWithPhoneNumber",an(n,e))}async function K6(n,e){const t=await zi(n,"POST","/v1/accounts:signInWithPhoneNumber",an(n,e));if(t.temporaryProof)throw Au(n,"account-exists-with-different-credential",t);return t}const G6={USER_NOT_FOUND:"user-not-found"};async function Q6(n,e){const t={...e,operation:"REAUTH"};return zi(n,"POST","/v1/accounts:signInWithPhoneNumber",an(n,t),G6)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma extends eh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ma({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ma({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return W6(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return K6(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return Q6(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Ma({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J6(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Y6(n){const e=wu(xu(n)).link,t=e?wu(xu(e)).deep_link_id:null,r=wu(xu(n)).deep_link_id;return(r?wu(xu(r)).link:null)||r||t||e||n}class th{constructor(e){const t=wu(xu(e)),r=t.apiKey??null,s=t.oobCode??null,i=J6(t.mode??null);_e(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=Y6(e);try{return new th(t)}catch{return null}}}function xY(n){return th.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(){this.providerId=cl.PROVIDER_ID}static credential(e,t){return Pd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=th.parseLink(t);return _e(r,"argument-error"),Pd._fromEmailAndCode(e,r.code,r.tenantId)}}cl.PROVIDER_ID="password";cl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";cl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc extends Hi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class uf extends Lc{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return _e("providerId"in t&&"signInMethod"in t,"argument-error"),Mi._fromParams(t)}credential(e){return this._credential({...e,nonce:e.rawNonce})}_credential(e){return _e(e.idToken||e.accessToken,"argument-error"),Mi._fromParams({...e,providerId:this.providerId,signInMethod:this.providerId})}static credentialFromResult(e){return uf.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return uf.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new uf(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo extends Lc{constructor(){super("facebook.com")}static credential(e){return Mi._fromParams({providerId:mo.PROVIDER_ID,signInMethod:mo.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mo.credentialFromTaggedObject(e)}static credentialFromError(e){return mo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return mo.credential(e.oauthAccessToken)}catch{return null}}}mo.FACEBOOK_SIGN_IN_METHOD="facebook.com";mo.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go extends Lc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Mi._fromParams({providerId:go.PROVIDER_ID,signInMethod:go.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return go.credentialFromTaggedObject(e)}static credentialFromError(e){return go.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return go.credential(t,r)}catch{return null}}}go.GOOGLE_SIGN_IN_METHOD="google.com";go.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo extends Lc{constructor(){super("github.com")}static credential(e){return Mi._fromParams({providerId:vo.PROVIDER_ID,signInMethod:vo.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vo.credentialFromTaggedObject(e)}static credentialFromError(e){return vo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return vo.credential(e.oauthAccessToken)}catch{return null}}}vo.GITHUB_SIGN_IN_METHOD="github.com";vo.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X6="http://localhost";class Cd extends eh{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Ai(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Ai(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ai(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Cd(r,i)}static _create(e,t){return new Cd(e,t)}buildRequest(){return{requestUri:X6,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z6="saml.";class iv extends Hi{constructor(e){_e(e.startsWith(Z6),"argument-error"),super(e)}static credentialFromResult(e){return iv.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return iv.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Cd.fromJSON(e);return _e(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Cd._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo extends Lc{constructor(){super("twitter.com")}static credential(e,t){return Mi._fromParams({providerId:yo.PROVIDER_ID,signInMethod:yo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return yo.credentialFromTaggedObject(e)}static credentialFromError(e){return yo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return yo.credential(t,r)}catch{return null}}}yo.TWITTER_SIGN_IN_METHOD="twitter.com";yo.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $A(n,e){return zi(n,"POST","/v1/accounts:signUp",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await bs._fromIdTokenResponse(e,r,s),o=kx(r);return new ls({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=kx(r);return new ls({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function kx(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FA(n){var s;if(sn(n.app))return Promise.reject(Qn(n));const e=Cn(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new ls({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await $A(e,{returnSecureToken:!0}),r=await ls._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(r.user),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf extends Cs{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,qf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new qf(e,t,r,s)}}function UA(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?qf._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jA(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EY(n,e){const t=Me(n);await Qp(!0,t,e);const{providerUserInfo:r}=await r6(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=jA(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function g0(n,e,t=!1){const r=await Vi(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ls._forOperation(n,"link",r)}async function Qp(n,e,t){await Ad(e);const r=jA(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";_e(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qA(n,e,t=!1){const{auth:r}=n;if(sn(r.app))return Promise.reject(Qn(r));const s="reauthenticate";try{const i=await Vi(n,UA(r,s,e,n),t);_e(i.idToken,r,"internal-error");const o=Kp(i.idToken);_e(o,r,"internal-error");const{sub:a}=o;return _e(n.uid===a,r,"user-mismatch"),ls._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Vr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BA(n,e,t=!1){if(sn(n.app))return Promise.reject(Qn(n));const r="signIn",s=await UA(n,r,e),i=await ls._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function v0(n,e){return BA(Cn(n),e)}async function e5(n,e){const t=Me(n);return await Qp(!1,t,e.providerId),g0(t,e)}async function t5(n,e){return qA(Me(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n5(n,e){return zi(n,"POST","/v1/accounts:signInWithCustomToken",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IY(n,e){if(sn(n.app))return Promise.reject(Qn(n));const t=Cn(n),r=await n5(t,{token:e,returnSecureToken:!0}),s=await ls._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?y0._fromServerResponse(e,t):"totpInfo"in t?b0._fromServerResponse(e,t):Vr(e,"internal-error")}}class y0 extends nh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new y0(t)}}class b0 extends nh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new b0(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jp(n,e,t){var r;_e(((r=t.url)==null?void 0:r.length)>0,n,"invalid-continue-uri"),_e(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),_e(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(_e(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(_e(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _0(n){const e=Cn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function zA(n,e,t){const r=Cn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Jp(r,s,t),await Ao(r,s,"getOobCode",U6,"EMAIL_PASSWORD_PROVIDER")}async function r5(n,e,t){await LA(Me(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&_0(n),r})}async function TY(n,e){await L6(Me(n),{oobCode:e})}async function s5(n,e){const t=Me(n),r=await LA(t,{oobCode:e}),s=r.requestType;switch(_e(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":_e(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":_e(r.mfaInfo,t,"internal-error");default:_e(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=nh._fromServerResponse(Cn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function i5(n,e){const{data:t}=await s5(Me(n),e);return t.email}async function HA(n,e,t){if(sn(n.app))return Promise.reject(Qn(n));const r=Cn(n),o=await Ao(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",$A,"EMAIL_PASSWORD_PROVIDER").catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&_0(n),l}),a=await ls._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function WA(n,e,t){return sn(n.app)?Promise.reject(Qn(n)):v0(Me(n),cl.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&_0(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SY(n,e,t){const r=Cn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){_e(a.handleCodeInApp,r,"argument-error"),a&&Jp(r,o,a)}i(s,t),await Ao(r,s,"getOobCode",j6,"EMAIL_PASSWORD_PROVIDER")}function AY(n,e){const t=th.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function PY(n,e,t){if(sn(n.app))return Promise.reject(Qn(n));const r=Me(n),s=cl.credentialWithLink(e,t||Sd());return _e(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),v0(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o5(n,e){return ln(n,"POST","/v1/accounts:createAuthUri",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CY(n,e){const t=h0()?Sd():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await o5(Me(n),r);return s||[]}async function RY(n,e){const t=Me(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Jp(t.auth,s,e);const{email:i}=await F6(t.auth,s);i!==n.email&&await n.reload()}async function kY(n,e,t){const r=Me(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Jp(r.auth,i,t);const{email:o}=await q6(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a5(n,e){return ln(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DY(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Me(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Vi(r,a5(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function l5(n,e){const t=Me(n);return sn(t.auth.app)?Promise.reject(Qn(t.auth)):KA(t,e,null)}function c5(n,e){return KA(Me(n),null,e)}async function KA(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await Vi(n,V6(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u5(n){var s,i;if(!n)return null;const{providerId:e}=n,t=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!e&&(n!=null&&n.idToken)){const o=(i=(s=Kp(n.idToken))==null?void 0:s.firebase)==null?void 0:i.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new Xl(r,a)}}if(!e)return null;switch(e){case"facebook.com":return new d5(r,t);case"github.com":return new h5(r,t);case"google.com":return new f5(r,t);case"twitter.com":return new p5(r,t,n.screenName||null);case"custom":case"anonymous":return new Xl(r,null);default:return new Xl(r,e,t)}}class Xl{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class GA extends Xl{constructor(e,t,r,s){super(e,t,r),this.username=s}}class d5 extends Xl{constructor(e,t){super(e,"facebook.com",t)}}class h5 extends GA{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class f5 extends Xl{constructor(e,t){super(e,"google.com",t)}}class p5 extends GA{constructor(e,t,r){super(e,"twitter.com",t,r)}}function NY(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:u5(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m5(n,e){return Me(n).setPersistence(e)}function OY(n){return VA(n)}async function VY(n,e){return Cn(n).validatePassword(e)}function g5(n,e,t,r){return Me(n).onIdTokenChanged(e,t,r)}function v5(n,e,t){return Me(n).beforeAuthStateChanged(e,t)}function y5(n,e,t,r){return Me(n).onAuthStateChanged(e,t,r)}function MY(n){Me(n).useDeviceLanguage()}function LY(n,e){return Me(n).updateCurrentUser(e)}function b5(n){return Me(n).signOut()}function $Y(n,e){return Cn(n).revokeAccessToken(e)}async function FY(n){return Me(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Ra("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ra("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if((t=e.multiFactorSession)!=null&&t.pendingCredential)return Ra._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if((r=e.multiFactorSession)!=null&&r.idToken)return Ra._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Cn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>nh._fromServerResponse(r,a));_e(s.mfaPendingCredential,r,"internal-error");const o=Ra._fromMfaPendingCredential(s.mfaPendingCredential);return new w0(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c={...s,idToken:l.idToken,refreshToken:l.refreshToken};switch(t.operationType){case"signIn":const f=await ls._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(f.user),f;case"reauthenticate":return _e(t.user,r,"internal-error"),ls._forOperation(t.user,t.operationType,c);default:Vr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function UY(n,e){var s;const t=Me(n),r=e;return _e(e.customData.operationType,t,"argument-error"),_e((s=r.customData._serverResponse)==null?void 0:s.mfaPendingCredential,t,"argument-error"),w0._fromError(t,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dx(n,e){return ln(n,"POST","/v2/accounts/mfaEnrollment:start",an(n,e))}function _5(n,e){return ln(n,"POST","/v2/accounts/mfaEnrollment:finalize",an(n,e))}function w5(n,e){return ln(n,"POST","/v2/accounts/mfaEnrollment:start",an(n,e))}function x5(n,e){return ln(n,"POST","/v2/accounts/mfaEnrollment:finalize",an(n,e))}function E5(n,e){return ln(n,"POST","/v2/accounts/mfaEnrollment:withdraw",an(n,e))}class x0{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>nh._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new x0(e)}async getSession(){return Ra._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await Vi(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await Vi(this.user,E5(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const tg=new WeakMap;function jY(n){const e=Me(n);return tg.has(e)||tg.set(e,x0._fromUser(e)),tg.get(e)}const Bf="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QA{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Bf,"1"),this.storage.removeItem(Bf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I5=1e3,T5=10;class JA extends QA{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=kA(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);h6()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,T5):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},I5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}JA.type="LOCAL";const YA=JA;/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S5=1e3;function ng(n){var r;const e=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),t=RegExp(`${e}=([^;]+)`);return((r=document.cookie.match(t))==null?void 0:r[1])??null}function rg(n){return`${window.location.protocol==="http:"?"__dev_":"__HOST-"}FIREBASE_${n.split(":")[3]}`}class XA{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(typeof window===void 0)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){return typeof isSecureContext=="boolean"&&!isSecureContext||typeof navigator>"u"||typeof document>"u"?!1:navigator.cookieEnabled??!0}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=rg(e);if(window.cookieStore){const r=await window.cookieStore.get(t);return r==null?void 0:r.value}return ng(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;const r=rg(e);document.cookie=`${r}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>{})}_addListener(e,t){if(!this._isAvailable())return;const r=rg(e);if(window.cookieStore){const a=c=>{const f=c.changed.find(p=>p.name===r);f&&t(f.value),c.deleted.find(p=>p.name===r)&&t(null)},l=()=>window.cookieStore.removeEventListener("change",a);return this.listenerUnsubscribes.set(t,l),window.cookieStore.addEventListener("change",a)}let s=ng(r);const i=setInterval(()=>{const a=ng(r);a!==s&&(t(a),s=a)},S5),o=()=>clearInterval(i);this.listenerUnsubscribes.set(t,o)}_removeListener(e,t){const r=this.listenerUnsubscribes.get(t);r&&(r(),this.listenerUnsubscribes.delete(t))}}XA.type="COOKIE";const qY=XA;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZA extends QA{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ZA.type="SESSION";const eP=ZA;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A5(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Yp(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await A5(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Yp.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xp(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Xp("",20);s.port1.start();const f=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const p=h;if(p.data.eventId===c)switch(p.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(p.data.response);break;default:clearTimeout(f),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ln(){return window}function C5(n){Ln().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E0(){return typeof Ln().WorkerGlobalScope<"u"&&typeof Ln().importScripts=="function"}async function R5(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function k5(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function D5(){return E0()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tP="firebaseLocalStorageDb",N5=1,zf="firebaseLocalStorage",nP="fbase_key";class rh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Zp(n,e){return n.transaction([zf],e?"readwrite":"readonly").objectStore(zf)}function O5(){const n=indexedDB.deleteDatabase(tP);return new rh(n).toPromise()}function ov(){const n=indexedDB.open(tP,N5);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(zf,{keyPath:nP})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(zf)?e(r):(r.close(),await O5(),e(await ov()))})})}async function Nx(n,e,t){const r=Zp(n,!0).put({[nP]:e,value:t});return new rh(r).toPromise()}async function V5(n,e){const t=Zp(n,!1).get(e),r=await new rh(t).toPromise();return r===void 0?null:r.value}function Ox(n,e){const t=Zp(n,!0).delete(e);return new rh(t).toPromise()}const M5=800,L5=3;class rP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ov(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>L5)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return E0()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Yp._getInstance(D5()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await R5(),!this.activeServiceWorker)return;this.sender=new P5(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||k5()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ov();return await Nx(e,Bf,"1"),await Ox(e,Bf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Nx(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>V5(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Ox(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Zp(s,!1).getAll();return new rh(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),M5)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}rP.type="LOCAL";const $5=rP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vx(n,e){return ln(n,"POST","/v2/accounts/mfaSignIn:start",an(n,e))}function F5(n,e){return ln(n,"POST","/v2/accounts/mfaSignIn:finalize",an(n,e))}function U5(n,e){return ln(n,"POST","/v2/accounts/mfaSignIn:finalize",an(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sg=NA("rcb"),j5=new Xd(3e4,6e4);class q5{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!((e=Ln().grecaptcha)!=null&&e.render)}load(e,t=""){return _e(B5(t),e,"argument-error"),this.shouldResolveImmediately(t)&&xx(Ln().grecaptcha)?Promise.resolve(Ln().grecaptcha):new Promise((r,s)=>{const i=Ln().setTimeout(()=>{s(Cr(e,"network-request-failed"))},j5.get());Ln()[sg]=()=>{Ln().clearTimeout(i),delete Ln()[sg];const a=Ln().grecaptcha;if(!a||!xx(a)){s(Cr(e,"internal-error"));return}const l=a.render;a.render=(c,f)=>{const h=l(c,f);return this.counter++,h},this.hostLanguage=t,r(a)};const o=`${b6()}?${Tc({onload:sg,render:"explicit",hl:t})}`;m0(o).catch(()=>{clearTimeout(i),s(Cr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!((t=Ln().grecaptcha)!=null&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function B5(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class z5{async load(e){return new I6(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ju="recaptcha",H5={theme:"light",type:"image"};class BY{constructor(e,t,r={...H5}){this.parameters=r,this.type=Ju,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Cn(e),this.isInvisible=this.parameters.size==="invisible",_e(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;_e(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new z5:new q5,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){_e(!this.parameters.sitekey,this.auth,"argument-error"),_e(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),_e(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Ln()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){_e(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){_e(h0()&&!E0(),this.auth,"internal-error"),await W5(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await t6(this.auth);_e(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return _e(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function W5(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ma._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function zY(n,e,t){if(sn(n.app))return Promise.reject(Qn(n));const r=Cn(n),s=await em(r,e,Me(t));return new I0(s,i=>v0(r,i))}async function HY(n,e,t){const r=Me(n);await Qp(!1,r,"phone");const s=await em(r.auth,e,Me(t));return new I0(s,i=>e5(r,i))}async function WY(n,e,t){const r=Me(n);if(sn(r.auth.app))return Promise.reject(Qn(r.auth));const s=await em(r.auth,e,Me(t));return new I0(s,i=>t5(r,i))}async function em(n,e,t){var r;if(!n._getRecaptchaConfig())try{await VA(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const i=s.session;if("phoneNumber"in s){_e(i.type==="enroll",n,"internal-error");const o={idToken:i.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Ao(n,o,"mfaSmsEnrollment",async(f,h)=>{if(h.phoneEnrollmentInfo.captchaResponse===Qu){_e((t==null?void 0:t.type)===Ju,f,"argument-error");const p=await ig(f,h,t);return Dx(f,p)}return Dx(f,h)},"PHONE_PROVIDER").catch(f=>Promise.reject(f))).phoneSessionInfo.sessionInfo}else{_e(i.type==="signin",n,"internal-error");const o=((r=s.multiFactorHint)==null?void 0:r.uid)||s.multiFactorUid;_e(o,n,"missing-multi-factor-info");const a={mfaPendingCredential:i.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Ao(n,a,"mfaSmsSignIn",async(h,p)=>{if(p.phoneSignInInfo.captchaResponse===Qu){_e((t==null?void 0:t.type)===Ju,h,"argument-error");const v=await ig(h,p,t);return Vx(h,v)}return Vx(h,p)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneResponseInfo.sessionInfo}}else{const i={phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Ao(n,i,"sendVerificationCode",async(c,f)=>{if(f.captchaResponse===Qu){_e((t==null?void 0:t.type)===Ju,c,"argument-error");const h=await ig(c,f,t);return Rx(c,h)}return Rx(c,f)},"PHONE_PROVIDER").catch(c=>Promise.reject(c))).sessionInfo}}finally{t==null||t._reset()}}async function KY(n,e){const t=Me(n);if(sn(t.auth.app))return Promise.reject(Qn(t.auth));await g0(t,e)}async function ig(n,e,t){_e(t.type===Ju,n,"argument-error");const r=await t.verify();_e(typeof r=="string",n,"argument-error");const s={...e};if("phoneEnrollmentInfo"in s){const i=s.phoneEnrollmentInfo.phoneNumber,o=s.phoneEnrollmentInfo.captchaResponse,a=s.phoneEnrollmentInfo.clientType,l=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:i,recaptchaToken:r,captchaResponse:o,clientType:a,recaptchaVersion:l}}),s}else if("phoneSignInInfo"in s){const i=s.phoneSignInInfo.captchaResponse,o=s.phoneSignInInfo.clientType,a=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:i,clientType:o,recaptchaVersion:a}}),s}else return Object.assign(s,{recaptchaToken:r}),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e){this.providerId=Zl.PROVIDER_ID,this.auth=Cn(e)}verifyPhoneNumber(e,t){return em(this.auth,e,Me(t))}static credential(e,t){return Ma._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Zl.credentialFromTaggedObject(t)}static credentialFromError(e){return Zl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Ma._fromTokenResponse(t,r):null}}Zl.PROVIDER_ID="phone";Zl.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ul(n,e){return e?xi(e):(_e(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0 extends eh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ai(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ai(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ai(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function K5(n){return BA(n.auth,new T0(n),n.bypassAuthState)}function G5(n){const{auth:e,user:t}=n;return _e(t,e,"internal-error"),qA(t,new T0(n),n.bypassAuthState)}async function Q5(n){const{auth:e,user:t}=n;return _e(t,e,"internal-error"),g0(t,new T0(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return K5;case"linkViaPopup":case"linkViaRedirect":return Q5;case"reauthViaPopup":case"reauthViaRedirect":return G5;default:Vr(this.auth,"internal-error")}}resolve(e){Oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J5=new Xd(2e3,1e4);async function GY(n,e,t){if(sn(n.app))return Promise.reject(Cr(n,"operation-not-supported-in-this-environment"));const r=Cn(n);Mc(n,e,Hi);const s=ul(r,t);return new Ei(r,"signInViaPopup",e,s).executeNotNull()}async function QY(n,e,t){const r=Me(n);if(sn(r.auth.app))return Promise.reject(Cr(r.auth,"operation-not-supported-in-this-environment"));Mc(r.auth,e,Hi);const s=ul(r.auth,t);return new Ei(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function JY(n,e,t){const r=Me(n);Mc(r.auth,e,Hi);const s=ul(r.auth,t);return new Ei(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class Ei extends sP{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ei.currentPopupAction&&Ei.currentPopupAction.cancel(),Ei.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _e(e,this.auth,"internal-error"),e}async onExecution(){Oi(this.filter.length===1,"Popup operations only handle one event");const e=Xp();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Cr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Cr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ei.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if((r=(t=this.authWindow)==null?void 0:t.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Cr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,J5.get())};e()}}Ei.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y5="pendingRedirect",df=new Map;class X5 extends sP{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=df.get(this.auth._key());if(!e){try{const r=await Z5(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}df.set(this.auth._key(),e)}return this.bypassAuthState||df.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Z5(n,e){const t=oP(e),r=iP(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function S0(n,e){return iP(n)._set(oP(e),"true")}function eF(n,e){df.set(n._key(),e)}function iP(n){return xi(n._redirectPersistence)}function oP(n){return cf(Y5,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YY(n,e,t){return tF(n,e,t)}async function tF(n,e,t){if(sn(n.app))return Promise.reject(Qn(n));const r=Cn(n);Mc(n,e,Hi),await r._initializationPromise;const s=ul(r,t);return await S0(s,r),s._openRedirect(r,e,"signInViaRedirect")}function XY(n,e,t){return nF(n,e,t)}async function nF(n,e,t){const r=Me(n);if(Mc(r.auth,e,Hi),sn(r.auth.app))return Promise.reject(Qn(r.auth));await r.auth._initializationPromise;const s=ul(r.auth,t);await S0(s,r.auth);const i=await lP(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function ZY(n,e,t){return rF(n,e,t)}async function rF(n,e,t){const r=Me(n);Mc(r.auth,e,Hi),await r.auth._initializationPromise;const s=ul(r.auth,t);await Qp(!1,r,e.providerId),await S0(s,r.auth);const i=await lP(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function eX(n,e){return await Cn(n)._initializationPromise,aP(n,e,!1)}async function aP(n,e,t=!1){if(sn(n.app))return Promise.reject(Qn(n));const r=Cn(n),s=ul(r,e),o=await new X5(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function lP(n){const e=Xp(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sF=10*60*1e3;class iF{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!oF(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!cP(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";t.onError(Cr(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=sF&&this.cachedEventUids.clear(),this.cachedEventUids.has(Mx(e))}saveEventToCache(e){this.cachedEventUids.add(Mx(e)),this.lastProcessedEventTime=Date.now()}}function Mx(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function cP({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function oF(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return cP(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aF(n,e={}){return ln(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lF=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cF=/^https?/;async function uF(n){if(n.config.emulator)return;const{authorizedDomains:e}=await aF(n);for(const t of e)try{if(dF(t))return}catch{}Vr(n,"unauthorized-domain")}function dF(n){const e=Sd(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!cF.test(t))return!1;if(lF.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hF=new Xd(3e4,6e4);function Lx(){const n=Ln().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function fF(n){return new Promise((e,t)=>{var s,i,o;function r(){Lx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Lx(),t(Cr(n,"network-request-failed"))},timeout:hF.get()})}if((i=(s=Ln().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Ln().gapi)!=null&&o.load)r();else{const a=NA("iframefcb");return Ln()[a]=()=>{gapi.load?r():t(Cr(n,"network-request-failed"))},m0(`${w6()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw hf=null,e})}let hf=null;function pF(n){return hf=hf||fF(n),hf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mF=new Xd(5e3,15e3),gF="__/auth/iframe",vF="emulator/auth/iframe",yF={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bF=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _F(n){const e=n.config;_e(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?f0(e,vF):`https://${n.config.authDomain}/${gF}`,r={apiKey:e.apiKey,appName:n.name,v:tl},s=bF.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Tc(r).slice(1)}`}async function wF(n){const e=await pF(n),t=Ln().gapi;return _e(t,n,"internal-error"),e.open({where:document.body,url:_F(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yF,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Cr(n,"network-request-failed"),a=Ln().setTimeout(()=>{i(o)},mF.get());function l(){Ln().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xF={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},EF=500,IF=600,TF="_blank",SF="http://localhost";class $x{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AF(n,e,t,r=EF,s=IF){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...xF,width:r.toString(),height:s.toString(),top:i,left:o},c=qn().toLowerCase();t&&(a=SA(c)?TF:t),IA(c)&&(e=e||SF,l.scrollbars="yes");const f=Object.entries(l).reduce((p,[v,x])=>`${p}${v}=${x},`,"");if(d6(c)&&a!=="_self")return PF(e||"",a),new $x(null);const h=window.open(e||"",a,f);_e(h,n,"popup-blocked");try{h.focus()}catch{}return new $x(h)}function PF(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CF="__/auth/handler",RF="emulator/auth/handler",kF=encodeURIComponent("fac");async function Fx(n,e,t,r,s,i){_e(n.config.authDomain,n,"auth-domain-config-required"),_e(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:tl,eventId:s};if(e instanceof Hi){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",WD(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,h]of Object.entries(i||{}))o[f]=h}if(e instanceof Lc){const f=e.getScopes().filter(h=>h!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const f of Object.keys(a))a[f]===void 0&&delete a[f];const l=await n._getAppCheckToken(),c=l?`#${kF}=${encodeURIComponent(l)}`:"";return`${DF(n)}?${Tc(a).slice(1)}${c}`}function DF({config:n}){return n.emulator?f0(n,RF):`https://${n.authDomain}/${CF}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const og="webStorageSupport";class NF{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=eP,this._completeRedirectFn=aP,this._overrideRedirectResult=eF}async _openPopup(e,t,r,s){var o;Oi((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await Fx(e,t,r,Sd(),s);return AF(e,i,Xp())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Fx(e,t,r,Sd(),s);return C5(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Oi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await wF(e),r=new iF(e);return t.register("authEvent",s=>(_e(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(og,{type:og},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[og];i!==void 0&&t(!!i),Vr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=uF(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return kA()||TA()||p0()}}const OF=NF;class uP{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Js("unexpected MultiFactorSessionType")}}}class A0 extends uP{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new A0(e)}_finalizeEnroll(e,t,r){return _5(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return F5(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class VF{constructor(){}static assertion(e){return A0._fromCredential(e)}}VF.FACTOR_ID="phone";class MF{static assertionForEnrollment(e,t){return Rd._fromSecret(e,t)}static assertionForSignIn(e,t){return Rd._fromEnrollmentId(e,t)}static async generateSecret(e){var s;const t=e;_e(typeof((s=t.user)==null?void 0:s.auth)<"u","internal-error");const r=await w5(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return P0._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}MF.FACTOR_ID="totp";class Rd extends uP{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Rd(t,void 0,e)}static _fromEnrollmentId(e,t){return new Rd(t,e)}async _finalizeEnroll(e,t,r){return _e(typeof this.secret<"u",e,"argument-error"),x5(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){_e(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return U5(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class P0{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new P0(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var s;let r=!1;return(Fh(e)||Fh(t))&&(r=!0),r&&(Fh(e)&&(e=((s=this.auth.currentUser)==null?void 0:s.email)||"unknownuser"),Fh(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function Fh(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var Ux="@firebase/auth",jx="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_e(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $F(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function FF(n){os(new Qr("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;_e(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:DA(n)},c=new v6(r,s,i,l);return k6(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),os(new Qr("auth-internal",e=>{const t=Cn(e.getProvider("auth").getImmediate());return(r=>new LF(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),pr(Ux,jx,$F(n)),pr(Ux,jx,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UF=5*60,jF=PI("authIdTokenMaxAge")||UF;let qx=null;const qF=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>jF)return;const s=t==null?void 0:t.token;qx!==s&&(qx=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function BF(n=nl()){const e=ii(n,"auth");if(e.isInitialized())return e.getImmediate();const t=R6(n,{popupRedirectResolver:OF,persistence:[$5,YA,eP]}),r=PI("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=qF(i.toString());v5(t,o,()=>o(t.currentUser)),g5(t,a=>o(a))}}const s=SI("auth");return s&&D6(t,`http://${s}`),t}function zF(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}y6({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=Cr("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",zF().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});FF("Browser");const HF={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.firebasestorage.app",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},tm=MI(HF),te=JM(tm,{cacheSizeBytes:50*1024*1024,experimentalForceOwningTab:!1}),C0=j$(tm),Ve=BF(tm),WF=PL(tm);try{m5(Ve,YA)}catch{}y5(Ve,n=>{n||FA(Ve)});async function KF(n,e){try{return(await HA(Ve,n,e)).user}catch(t){throw t}}async function dP(n,e){try{return(await WA(Ve,n,e)).user}catch(t){throw t}}async function R0(n){try{await zA(Ve,n)}catch(e){throw e}}async function GF(n){try{const e=Ve.currentUser;if(e)await c5(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const vr=Object.freeze(Object.defineProperty({__proto__:null,auth:Ve,createPlayerAccount:KF,db:te,functions:WF,getMessaging:Jv,resetPlayerPassword:R0,signInPlayer:dP,storage:C0,updatePlayerPassword:GF},Symbol.toStringTag,{value:"Module"})),av="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function k0(){try{return await cT()}catch{return!1}}async function hP(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.getRegistration();if(n&&n.active)return n;const e=await navigator.serviceWorker.register("/service-worker.js");return new Promise(t=>{if(e.active){t(e);return}const r=()=>{e.active&&(e.removeEventListener("statechange",r),t(e))};e.addEventListener("statechange",r)})}async function fP(n){var i;if(!await k0()||await Notification.requestPermission()!=="granted")return null;const t=Jv(nl());let r=n||await hP();const s=await uT(t,r?{vapidKey:av,serviceWorkerRegistration:r}:{vapidKey:av});try{const o=((i=Ve==null?void 0:Ve.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await en(pe(te,"userPushTokens",o),{tokens:bL(s),lastToken:s,email:o,updatedAt:on(),userAgent:navigator.userAgent,lastActivation:on()},{merge:!0})}catch{}return s}async function Hf(){try{const n=localStorage.getItem("fcmToken");if(n){const r=Jv(nl());try{const s=await uT(r,{vapidKey:av});if(s===n)return{active:!0,token:s}}catch{}}const e=await hP(),t=await fP(e);return t?(localStorage.setItem("fcmToken",t),{active:!0,token:t}):{active:!1,error:"Failed to get token"}}catch(n){return{active:!1,error:n.message}}}function QF(){setInterval(async()=>{try{const n=await Hf();n.active||(console.log("Push notifications inactive, attempting to reactivate..."),window.dispatchEvent(new CustomEvent("push-status-changed",{detail:n})))}catch(n){console.warn("Push health check failed:",n)}},5*60*1e3)}const JF=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function YF(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function pP(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function XF(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function mP(n){if(!n)return!1;const e=String(n).toLowerCase();return JF.some(t=>e.includes(t.toLowerCase()))}function lv(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?XF(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>lv(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=mP(t)?"••••":lv(r);return e}return n}function ZF(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&mP(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(lv(r))}return e}const eU=pP(YF());function Uh(n,e){const t=pP(n);return(...r)=>{if(t<eU)return;const s=ZF(r);console[e](...s)}}const M={debug:Uh("debug","log"),info:Uh("info","info"),warn:Uh("warn","warn"),error:Uh("error","error")},D0="userNavigation";async function Sa(n,e,t={}){try{if(!n||!e){M.warn("Données manquantes pour tracker la navigation",{userId:n,path:e});return}if(["/reset-password","/magic","/join","/login","/signup"].some(o=>e.startsWith(o)))return;const s={userId:n,lastVisitedPage:e,lastVisitedAt:on(),deviceInfo:rU(),...t},i=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n;await en(pe(te,D0,i),s,{merge:!0})}catch(r){r.code!=="permission-denied"&&M.error("Erreur lors du tracking de la navigation",r)}}async function tU(n){try{if(!n)return M.warn("Aucun userId fourni pour récupérer la navigation"),null;const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=pe(te,D0,e),r=await Tt(t);return r.exists()?r.data():null}catch(e){return M.error("Erreur lors de la récupération de la navigation",e),null}}async function nU(n){try{if(!n){M.warn("Aucun userId fourni pour effacer la navigation");return}const e=n.includes("@")?`email_${n.replace(/[^a-zA-Z0-9]/g,"_")}`:n,t=pe(te,D0,e);await en(t,{userId:n,lastVisitedPage:null,lastVisitedAt:on(),cleared:!0})}catch(e){e.code!=="permission-denied"&&M.error("Erreur lors de l'effacement de la navigation",e)}}function Bx(n){return!(!n||["/reset-password","/magic","/join","/login","/signup"].some(t=>n.startsWith(t))||n===window.location.pathname)}function rU(){try{return{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,timestamp:new Date().toISOString()}}catch{return{timestamp:new Date().toISOString()}}}function sU(){try{const n=localStorage.getItem("hatcast_current_user_id");if(n)return n;const t=new URLSearchParams(window.location.search).get("email");return t||null}catch(n){return M.error("Erreur lors de la récupération de l'ID utilisateur",n),null}}const iU={"data-testid":"app-loaded"},oU={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},aU={class:"flex items-center space-x-3"},lU={class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},cU={class:"flex items-center space-x-3"},uU={key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800"},dU={__name:"App",setup(n){const e=A(null),t=A(!1),r=A(!1),s=A(!1),i=A(!1),o=Uo();Pt(()=>o.path,async(x,_)=>{if(x!==_){const w=sU();if(w){const T={};if(x.startsWith("/season/")){const N=x.split("/");N.length>=3&&(T.seasonSlug=N[2])}if(x.includes("/event/")){const N=x.match(/\/event\/([^\/]+)/);N&&(T.eventId=N[1])}await Sa(w,x,T)}}},{immediate:!0});function a(x){x.preventDefault(),e.value=x,t.value=!0;const _=localStorage.getItem("hatcast-pwa-banner-last-shown"),w=Date.now(),T=24*60*60*1e3;_&&w-parseInt(_)<T?t.value=!1:localStorage.setItem("hatcast-pwa-banner-last-shown",w.toString())}async function l(){if(e.value){try{e.value.prompt();const{outcome:x}=await e.value.userChoice;x==="accepted"?(console.log("PWA installée avec succès"),localStorage.setItem("hatcast-pwa-installed","true")):console.log("Installation PWA refusée par l'utilisateur")}catch(x){console.error("Erreur lors de l'installation PWA:",x)}t.value=!1,e.value=null,i.value=!0}}function c(){i.value=!0,localStorage.setItem("hatcast-pwa-banner-dismissed",Date.now().toString())}function f(){t.value=!1,e.value=null,i.value=!0,localStorage.setItem("hatcast-pwa-installed","true")}function h(){const x=localStorage.getItem("hatcast-pwa-installed"),_=localStorage.getItem("hatcast-pwa-banner-dismissed");if(x==="true"){t.value=!1;return}if(_){const w=Date.now(),T=60*60*1e3;w-parseInt(_)<T&&(i.value=!0)}}function p(){s.value=!0,console.log("🚀 Début de la mise à jour PWA..."),setTimeout(async()=>{try{if(console.log("📡 Vérification du service worker..."),"serviceWorker"in navigator){const x=await navigator.serviceWorker.getRegistration();console.log("🔍 Enregistrement SW trouvé:",x),x&&x.active?(console.log("✅ Service worker actif trouvé, envoi du message SKIP_WAITING..."),x.active.postMessage({type:"SKIP_WAITING"}),console.log("📤 Message SKIP_WAITING envoyé"),await new Promise(_=>setTimeout(_,500)),console.log("⏳ Attente de 500ms terminée"),x.waiting?(console.log("🔄 Service worker en attente détecté, attente de l'activation..."),await new Promise(_=>{const w=()=>{x.waiting?(console.log("⏳ Service worker toujours en attente, nouvelle vérification dans 100ms..."),setTimeout(w,100)):(console.log("✅ Service worker activé avec succès"),_())};w()})):console.log("ℹ️ Aucun service worker en attente")):console.warn("⚠️ Aucun service worker actif trouvé")}else console.warn("⚠️ Service Worker non supporté sur cet appareil");console.log("🔄 Rechargement de la page..."),window.location.reload()}catch(x){console.error("❌ Erreur lors de la mise à jour:",x),s.value=!1,alert(`Erreur lors de la mise à jour: ${x.message}

Veuillez rafraîchir manuellement la page.`)}},1e3)}function v(){r.value=!0}return In(()=>{h(),Hf().then(x=>{x.active?console.log("Notifications push actives au démarrage"):console.log("Notifications push inactives au démarrage:",x.error)}),window.addEventListener("beforeinstallprompt",a),window.addEventListener("appinstalled",f),window.addEventListener("pwa-update-test",v),window.addEventListener("show-pwa-install-banner",()=>{console.log("📱 Déclenchement manuel de la barre d'installation PWA"),e.value&&!i.value?(t.value=!0,i.value=!1,localStorage.removeItem("hatcast-pwa-banner-last-shown"),localStorage.removeItem("hatcast-pwa-banner-dismissed"),console.log("✅ Barre d'installation PWA affichée manuellement")):console.log("⚠️ Impossible d'afficher la barre d'installation PWA (déjà affichée ou non disponible)")}),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),navigator.serviceWorker.addEventListener("message",x=>{x.data&&x.data.type==="SW_UPDATING"&&console.log("Service worker en cours de mise à jour...")}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(x=>{x&&x.update()})},60*60*1e3))}),Rv(()=>{window.removeEventListener("beforeinstallprompt",a),window.removeEventListener("appinstalled",f),window.removeEventListener("pwa-update-test",v),window.removeEventListener("show-pwa-install-banner",()=>{})}),(x,_)=>{const w=XR("router-view");return k(),D(wt,null,[d("div",iU,[ze(w)]),ze(Em,{name:"install-banner",appear:""},{default:zh(()=>[t.value&&!i.value?(k(),D("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:l},[d("div",oU,[_[2]||(_[2]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:Pm,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Installez l'app pour une meilleure expérience ")])],-1)),d("div",aU,[d("button",{class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:At(l,["stop"])}," Installer "),d("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:At(c,["stop"]),"aria-label":"Fermer la barre d'installation"},_[1]||(_[1]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):se("",!0)]),_:1}),ze(Em,{name:"install-banner",appear:""},{default:zh(()=>[r.value&&!s.value?(k(),D("div",{key:0,class:"fixed top-0 left-0 right-0 z-[99999] bg-black text-white shadow-lg border-b border-gray-800",onClick:p},[d("div",lU,[_[4]||(_[4]=d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:Pm,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Une nouvelle version est disponible. Mettez à jour pour profiter des dernières améliorations. ")])],-1)),d("div",cU,[d("button",{class:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",onClick:At(p,["stop"])}," Mettre à jour "),d("button",{class:"text-gray-400 hover:text-white p-2 rounded-full hover:bg-gray-800 transition-colors",onClick:_[0]||(_[0]=At(T=>r.value=!1,["stop"])),"aria-label":"Fermer la barre de mise à jour"},_[3]||(_[3]=[d("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])])):se("",!0)]),_:1}),ze(Em,{name:"install-banner",appear:""},{default:zh(()=>[s.value?(k(),D("div",uU,_[5]||(_[5]=[d("div",{class:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between"},[d("div",{class:"flex items-center space-x-3 flex-1"},[d("img",{src:Pm,alt:"HatCast",class:"w-8 h-8 rounded-lg"}),d("div",{class:"flex-1"},[d("div",{class:"flex items-center space-x-2"},[d("span",{class:"font-semibold text-lg text-white"},"HatCast")]),d("p",{class:"text-sm text-gray-300 leading-tight"}," Mise à jour en cours... Veuillez patienter ")])]),d("div",{class:"flex items-center space-x-3"},[d("div",{class:"flex items-center space-x-2"},[d("div",{class:"w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center"},[d("svg",{class:"w-3 h-3 text-white animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})])]),d("span",{class:"text-sm text-gray-300"},"Mise à jour...")])])],-1)]))):se("",!0)]),_:1})],64)}}},hU="modulepreload",fU=function(n){return"/"+n},zx={},je=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=fU(i),i in zx)return;zx[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let f=s.length-1;f>=0;f--){const h=s[f];if(h.href===i&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":hU,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((f,h)=>{c.addEventListener("load",f),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function pU(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(h=!0)=>{await l};async function f(){if("serviceWorker"in navigator){const{Workbox:h}=await je(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new h("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",p=>{(p.isUpdate||p.isExternal)&&window.location.reload()}),a.addEventListener("installed",p=>{p.isUpdate||r==null||r()}),a.register({immediate:e}).then(p=>{i?i("/service-worker.js",p):s==null||s(p)}).catch(p=>{o==null||o(p)})}}return l=f(),c}const dl="seasons";async function mU(n,e,t,r="",s=""){return await Bi(tt(te,dl),{name:n,slug:e,pinCode:t,description:r,logoUrl:s,createdAt:on()})}async function gU(n){return await Ni(pe(te,dl,n))}async function Fl(){const n=Lo(tt(te,dl),sL("createdAt","desc"));return(await It(n)).docs.map(t=>({id:t.id,...t.data()}))}async function Wf(n,e){const t=await Tt(pe(te,dl,n));return t.exists()?t.data().pinCode===e:!1}async function cv(n){const e=await Tt(pe(te,dl,n));return e.exists()?e.data().pinCode:null}async function yu(n,e){const t=pe(te,dl,n);await cs(t,{sortOrder:e})}async function vU(n,e){const t=pe(te,dl,n);await cs(t,e)}const N0="lastVisitedSeason",gP="lastVisitedSeasonTimestamp";async function yU(n){if(n)try{const e=Ve.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(N0,n),localStorage.setItem(gP,Date.now().toString())}catch(r){M.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=pe(te,"userPreferences",t);await en(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),M.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){M.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){M.error("Erreur lors de la mémorisation de la saison",e)}}async function vP(){try{const n=Ve.currentUser,e=n==null?void 0:n.email;if(e)try{const t=pe(te,"userPreferences",e),r=await Tt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return M.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){M.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(N0);if(t)return M.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){M.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return M.error("Erreur lors de la récupération de la dernière saison",n),null}}async function bU(n=null){var e;try{const t=n||((e=Ve.currentUser)==null?void 0:e.email);try{localStorage.removeItem(N0),localStorage.removeItem(gP)}catch(r){M.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=pe(te,"userPreferences",t);await en(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),M.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){M.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){M.error("Erreur lors du nettoyage des préférences",t)}}function _U(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const _s=A(null),Xa=A(!1),xo=A(!1),yP=$e(()=>_s.value?_s.value.isAnonymous?!!localStorage.getItem("userEmail"):!0:!1),wU=$e(()=>!!_s.value);function La(){var n;try{const e=Ve.currentUser;e!==_s.value&&(_s.value=e,M.debug("Synchronisation forcée de l'état d'authentification",{user:((n=_s.value)==null?void 0:n.email)||"non connecté"}))}catch(e){M.error("Erreur lors de la synchronisation forcée",e)}}function bP(){var n;if(!(Xa.value||xo.value)){xo.value=!0;try{_s.value=Ve.currentUser,M.debug("État initial de l'utilisateur:",((n=_s.value)==null?void 0:n.email)||"non connecté");const e=Ve.onAuthStateChanged(async t=>{const r=_s.value;_s.value=t,Xa.value=!0,xo.value=!1;try{if(t&&!r){const s=window.location.pathname;s&&s!=="/"&&await Sa(t.uid,s)}else if(!t&&r){await nU(r.uid);try{const{default:s}=await je(()=>Promise.resolve().then(()=>xP),void 0),{default:i}=await je(()=>Promise.resolve().then(()=>IP),void 0);s.clearSession(),i.clearAllSessions(),M.info("Sessions locales effacées par le service centralisé")}catch(s){M.warn("Erreur lors de l'effacement des sessions locales:",s)}}}catch(s){s.code!=="permission-denied"&&M.error("Erreur lors du tracking de navigation:",s)}});window._authStateUnsubscribe=e,M.info("Service d'état d'authentification initialisé avec succès")}catch(e){M.error("Erreur lors de l'initialisation du service d'authentification:",e),xo.value=!1}}}function xU(){window._authStateUnsubscribe&&(window._authStateUnsubscribe(),delete window._authStateUnsubscribe),Xa.value=!1,xo.value=!1}function O0(){return new Promise((n,e)=>{if(Xa.value){n();return}if(!xo.value){M.warn("Service d'authentification non initialisé et non en cours d'initialisation"),e(new Error("Service d'authentification non initialisé"));return}const t=setInterval(()=>{Xa.value&&(clearInterval(t),n())},100);setTimeout(()=>{clearInterval(t),M.warn("Timeout de waitForInitialization, rejet de la promesse"),e(new Error("Timeout d'initialisation du service d'authentification"))},5e3)})}function _P(){!Xa.value&&!xo.value&&Kf()}function Kf(){if(typeof Ve>"u"||!Ve){M.warn("Firebase auth non disponible, nouvelle tentative dans 500ms"),setTimeout(Kf,500);return}try{bP()}catch(n){M.error("Erreur lors de l'auto-initialisation:",n),setTimeout(Kf,1e3)}}setTimeout(Kf,100);const EU=Object.freeze(Object.defineProperty({__proto__:null,cleanup:xU,currentUser:_s,forceInitialize:_P,forceSync:La,initialize:bP,isAuthenticated:wU,isConnected:yP,isInitialized:Xa,isInitializing:xo,waitForInitialization:O0},Symbol.toStringTag,{value:"Module"})),IU={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},TU={class:"text-center"},SU={class:"text-white text-lg"},AU={__name:"SeasonResolver",setup(n){const e=Za(),t=A("Chargement...");return In(async()=>{try{if(new URLSearchParams(window.location.search).get("p")==="reset-password"){M.info("Redirection vers la page de reset password"),e.replace("/reset-password");return}t.value="Vérification de votre session...",La(),await O0();const i=await new Promise((l,c)=>{const f=setTimeout(()=>{c(new Error("Timeout Firebase Auth"))},3e3),h=Ve.onAuthStateChanged(p=>{clearTimeout(f),h(),l(p)});Ve.currentUser&&(clearTimeout(f),h(),l(Ve.currentUser))}),o=i==null?void 0:i.email;if(!o){M.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const a=await vP();if(!a){M.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const l=await Fl();if(!_U(a,l)){M.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await bU(o),e.replace("/seasons");return}}catch(l){M.error("Erreur lors de la vérification des saisons",l),e.replace("/seasons");return}M.info("Redirection vers la saison mémorisée",{seasonSlug:a}),e.replace(`/season/${a}`)}catch(r){M.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(k(),D("div",IU,[d("div",TU,[s[0]||(s[0]=d("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),d("p",SU,ie(t.value),1)])]))}},PU="/logos/hatcast-mask.png",uv="/logos/hatcast-logo-mobile.png";async function CU(n,e=800,t=800,r=.8){return new Promise((s,i)=>{const o=document.createElement("canvas"),a=o.getContext("2d"),l=new Image;l.onload=()=>{let{width:c,height:f}=l;c>e&&(f=f*e/c,c=e),f>t&&(c=c*t/f,f=t),o.width=c,o.height=f,a.drawImage(l,0,0,c,f),o.toBlob(h=>{if(h){const p=new File([h],n.name,{type:"image/jpeg",lastModified:Date.now()});s(p)}else i(new Error("Erreur lors du redimensionnement"))},"image/jpeg",r)},l.onerror=()=>i(new Error("Erreur lors du chargement de l'image")),l.src=URL.createObjectURL(n)})}async function wP(){if(!Ve.currentUser){M.info("Aucun utilisateur connecté, tentative de connexion anonyme...");try{await FA(Ve),M.info("Connexion anonyme réussie")}catch(n){throw M.error("Erreur lors de la connexion anonyme:",n),new Error("Impossible de s'authentifier: "+n.message)}}await new Promise(n=>setTimeout(n,1e3))}async function RU(n,e,t={}){var r;try{if(M.info("Début upload image",{fileName:n.name,path:e,originalSize:`${(n.size/1024/1024).toFixed(2)}MB`}),await wP(),!n.type.startsWith("image/"))throw new Error("Le fichier doit être une image");if(n.size>10*1024*1024)throw new Error("L'image est trop volumineuse (max 10MB)");let s=n;if(t.resize!==!1&&(n.size>1024*1024||t.forceResize)){M.info("Redimensionnement de l'image pour optimiser les performances...");try{s=await CU(n,t.maxWidth||800,t.maxHeight||800,t.quality||.8),M.info("Image redimensionnée",{newSize:`${(s.size/1024/1024).toFixed(2)}MB`,compression:`${((1-s.size/n.size)*100).toFixed(1)}%`})}catch(x){M.warn("Erreur lors du redimensionnement, utilisation du fichier original:",x),s=n}}const a=`${Date.now()}_${n.name}`,l=`${e}/${a}`,c=pA(C0,l);M.info("Tentative d'upload vers Firebase Storage...",{fullPath:l,user:(r=Ve.currentUser)==null?void 0:r.uid,isAuthenticated:!!Ve.currentUser,finalSize:`${(s.size/1024/1024).toFixed(2)}MB`});const f=$$(c,s),h=new Promise((x,_)=>setTimeout(()=>_(new Error("Timeout: Upload trop long")),3e4)),p=await Promise.race([f,h]);M.info("Image uploadée avec succès",{fullPath:l});const v=await F$(p.ref);return M.info("URL de téléchargement récupérée",{downloadURL:v}),v}catch(s){if(M.error("Erreur lors de l'upload de l'image",s),s.message.includes("CORS")||s.message.includes("preflight")||s.message.includes("permission")||s.message.includes("unauthenticated")||s.message.includes("ERR_FAILED")||s.message.includes("Timeout"))return M.warn("Erreur d'accès détectée, utilisation du stockage local temporaire",s.message),await kU(n,e);throw s}}async function kU(n,e){return new Promise((t,r)=>{const s=new FileReader;s.onload=i=>{const o=i.target.result;M.info("Image stockée localement en base64",{path:e}),t(o)},s.onerror=()=>r(new Error("Erreur lors de la lecture du fichier")),s.readAsDataURL(n)})}async function DU(n){var e;try{if(M.info("Début suppression image",{imageUrl:n}),n.startsWith("data:image/")){M.info("Image locale (base64), suppression ignorée");return}await wP();const r=(e=new URL(n).pathname.split("/o/")[1])==null?void 0:e.split("?")[0];if(!r)throw new Error("Impossible d'extraire le chemin de l'image");const s=decodeURIComponent(r),i=pA(C0,s);await U$(i),M.info("Image supprimée avec succès",{decodedPath:s})}catch(t){throw M.error("Erreur lors de la suppression de l'image",t),t}}function NU(n){return n&&n.includes("firebasestorage.googleapis.com")}const jh=parseInt("7")*24*60*60*1e3,qh=parseInt("10")*60*1e3,bu="hatcast_pin_session";class OU{constructor(){this.sessionData=this.loadSession(),console.log("🔐 Configuration des sessions PIN:",{connected:`${jh/(24*60*60*1e3)} jours`,anonymous:`${qh/(60*1e3)} minutes`,source:"variables d'environnement (personnalisées)"})}loadSession(){try{const e=localStorage.getItem(bu);if(e){const t=JSON.parse(e);t.isConnected===void 0&&(t.isConnected=!1);const r=t.isConnected?jh:qh;if(t.timestamp&&Date.now()-t.timestamp<r){try{t.timestamp=Date.now(),localStorage.setItem(bu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t,r=!1){try{const s={seasonId:e,pinCode:t,timestamp:Date.now(),isConnected:r};localStorage.setItem(bu,JSON.stringify(s)),this.sessionData=s}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.isConnected?jh:qh,r=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<t;if(r)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(bu,JSON.stringify(this.sessionData))}catch{}return r}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(bu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=this.sessionData.isConnected?jh:qh,t=Date.now()-this.sessionData.timestamp,r=e-t;return Math.max(0,Math.ceil(r/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const En=new OU,xP=Object.freeze(Object.defineProperty({__proto__:null,default:En},Symbol.toStringTag,{value:"Module"})),VU={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},MU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},LU={class:"text-center mb-6"},$U={class:"text-gray-300"},FU={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},UU={class:"text-sm text-green-400"},jU={class:"mb-6"},qU={class:"mb-4"},BU={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},zU={class:"flex justify-end space-x-3"},HU=["disabled"],EP={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=A(""),i=A(""),o=A(null);Pt(()=>t.show,f=>{f&&(s.value="",i.value="",kt(()=>{var h;(h=o.value)==null||h.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(f,h)=>n.show?(k(),D("div",VU,[d("div",MU,[d("div",LU,[h[1]||(h[1]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),h[2]||(h[2]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),d("p",$U,ie(n.message),1),n.sessionInfo?(k(),D("div",FU,[d("p",UU," Session active : "+ie(n.sessionInfo.timeRemaining)+" min restantes ",1)])):se("",!0)]),d("div",jU,[d("div",qU,[h[3]||(h[3]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),at(d("input",{"onUpdate:modelValue":h[0]||(h[0]=p=>s.value=p),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[tr(l,["enter"]),tr(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Ot,s.value]])]),h[4]||(h[4]=d("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(k(),D("div",BU,ie(i.value||t.error),1)):se("",!0),d("div",zU,[d("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,HU)])])])):se("",!0)}},Hx="hatcast_trusted_players",ag=parseInt("6")*30*24*60*60*1e3;class WU{constructor(){this.trustedMap=this.load(),console.log("🔐 Configuration des sessions utilisateur:",{duration:`${ag/(30*24*60*60*1e3)} mois`,source:"variables d'environnement (personnalisées)"})}load(){try{const e=localStorage.getItem(Hx);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(Hx,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<ag;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>ag&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const Li=new WU,IP=Object.freeze(Object.defineProperty({__proto__:null,default:Li},Symbol.toStringTag,{value:"Module"})),KU={class:"space-y-4"},GU={class:"flex items-center justify-between"},QU={class:"flex items-center gap-2 text-gray-300 text-sm"},JU={key:0,"data-testid":"error-message",class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},YU={key:1,"data-testid":"success-message",class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},XU={class:"flex justify-center gap-3 mt-2"},ZU=["disabled"],ej={key:0,class:"animate-spin"},tj={key:1},TP={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success","open-account-creation"],setup(n,{emit:e}){const t=n,r=e,s=A(""),i=A(""),o=A(!1),a=A(""),l=A(""),c=A(!0);Pt(()=>t.show,x=>{if(x){const _=localStorage.getItem("prefilledEmail");_&&(s.value=_,localStorage.removeItem("prefilledEmail"))}},{immediate:!0});const f=$e(()=>!!s.value&&s.value.includes("@")&&!!i.value);async function h(){if(f.value){o.value=!0,a.value="",l.value="";try{if(await dP(s.value.trim(),i.value),c.value)try{Li.saveSession(s.value.trim())}catch{}r("success",{email:s.value.trim(),action:"login_success"})}catch{a.value="Email ou mot de passe incorrect"}finally{o.value=!1}}}async function p(){if(!s.value||!s.value.includes("@")){a.value="Veuillez d'abord saisir votre adresse email";return}o.value=!0,a.value="",l.value="";try{await R0(s.value.trim()),l.value="Un email de réinitialisation a été envoyé à votre adresse email"}catch{a.value="Impossible d'envoyer l'email de réinitialisation"}finally{o.value=!1}}function v(){r("open-account-creation")}return(x,_)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:_[6]||(_[6]=w=>x.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:_[5]||(_[5]=At(()=>{},["stop"]))},[d("button",{onClick:_[0]||(_[0]=w=>x.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),_[11]||(_[11]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Se connecter</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),d("div",KU,[d("div",null,[_[7]||(_[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),at(d("input",{"data-testid":"email-input","onUpdate:modelValue":_[1]||(_[1]=w=>s.value=w),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ot,s.value]])]),d("div",null,[_[8]||(_[8]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),at(d("input",{"data-testid":"password-input","onUpdate:modelValue":_[2]||(_[2]=w=>i.value=w),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Ot,i.value]])]),d("div",GU,[d("label",QU,[at(d("input",{type:"checkbox","onUpdate:modelValue":_[3]||(_[3]=w=>c.value=w),class:"w-4 h-4"},null,512),[[ts,c.value]]),_[9]||(_[9]=d("span",null,"Rester connecté sur cet appareil",-1))]),d("button",{"data-testid":"forgot-password-btn",onClick:p,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),a.value?(k(),D("div",JU,ie(a.value),1)):se("",!0),l.value?(k(),D("div",YU,ie(l.value),1)):se("",!0),d("div",XU,[d("button",{"data-testid":"submit-btn",onClick:h,disabled:!f.value||o.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[o.value?(k(),D("span",ej,"⏳")):(k(),D("span",tj,"Se connecter"))],8,ZU),d("button",{onClick:_[4]||(_[4]=w=>x.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")]),_[10]||(_[10]=rr('<div class="relative my-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-600"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-gray-800 text-gray-400">ou</span></div></div>',1)),d("button",{"data-testid":"create-account-btn",onClick:v,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 font-medium"}," 🚀 Créer un compte ")])])])):se("",!0)}},nm=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},nj={};function rj(n,e){return k(),D(wt,null,[e[0]||(e[0]=d("div",{class:"text-gray-300"},"🎭 Ça marche déjà super bien sans, mais avec un compte, c'est encore plus cool :",-1)),e[1]||(e[1]=d("div",null,[lt("• "),d("span",{class:"text-blue-300"},"🔒 Tes dispos sont à l'abri :"),lt(" plus personne ne peut modifier tes choix à ta place")],-1)),e[2]||(e[2]=d("div",null,[lt("• "),d("span",{class:"text-blue-300"},"📧 Alertes VIP :"),lt(" sois le premier informé des nouveaux spectacles et sélections")],-1)),e[3]||(e[3]=d("div",null,[lt("• "),d("span",{class:"text-blue-300"},"⚡ Saisie express :"),lt(" ton nom reste en haut de la liste, plus besoin de le chercher")],-1))],64)}const Wx=nm(nj,[["render",rj]]),sj={key:0,class:"mt-4"},ij={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},oj={key:1},aj={key:0,class:"mt-3 pt-3 border-t border-blue-500/20 text-sm text-gray-300 space-y-2"},V0={__name:"AccountBenefitsHint",props:{inline:{type:Boolean,default:!1}},setup(n){const e=A(!1);return(t,r)=>n.inline?(k(),D("div",oj,[d("button",{onClick:r[1]||(r[1]=s=>e.value=!e.value),class:"text-blue-300 hover:text-blue-200 text-sm font-medium flex items-center gap-2 transition-colors"},[r[3]||(r[3]=d("span",null,"À quoi sert un compte ?",-1)),d("span",{class:$t(["transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(k(),D("div",aj,[ze(Wx)])):se("",!0)])):(k(),D("div",sj,[d("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[2]||(r[2]=d("h3",{class:"text-sm font-semibold text-blue-300"},"💡 À quoi sert un compte ?",-1)),d("span",{class:$t(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(k(),D("div",ij,[ze(Wx)])):se("",!0)]))}},lj={key:0,class:"space-y-4"},cj={key:0,class:"space-y-4"},uj={class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},dj={key:1,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},hj={class:"mt-6 flex justify-center gap-3"},fj=["disabled"],pj={key:0,class:"animate-spin"},mj={key:1},SP={__name:"AccountCreationModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=A(1),s=A(""),i=A(!1),o=A(""),a=A(!1),l=$e(()=>s.value&&s.value.includes("@"));Pt(()=>t.show,f=>{f&&(r.value=1,s.value="",o.value="",a.value=!1)});async function c(){if(l.value){i.value=!0,o.value="";try{const f="TempPass123!",h=await HA(Ve,s.value.trim(),f),p={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:s.value.trim()};localStorage.setItem("pendingAccountCreationNavigation",JSON.stringify(p)),await zA(Ve,s.value.trim()),await Ve.signOut(),a.value=!0}catch(f){console.error("Erreur lors de l'envoi de l'email:",f),f.code==="auth/email-already-in-use"?o.value='Un compte existe déjà avec cette adresse email. Utilise le bouton "Se connecter" à la place.':f.code==="auth/invalid-email"?o.value="Adresse email invalide.":f.code==="auth/weak-password"?o.value="Erreur interne. Veuillez réessayer.":o.value="Impossible d'envoyer l'email de vérification. Veuillez réessayer."}finally{i.value=!1}}}return(f,h)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:h[4]||(h[4]=p=>f.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:h[3]||(h[3]=At(()=>{},["stop"]))},[d("button",{onClick:h[0]||(h[0]=p=>f.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),h[8]||(h[8]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🚀</span></div><h2 class="text-2xl font-bold text-white mb-1">Créer ton compte</h2><p class="text-sm text-gray-300">Rejoins HatCast et profite de toutes les fonctionnalités !</p></div>',1)),r.value===1?(k(),D("div",lj,[d("div",null,[h[5]||(h[5]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),at(d("input",{"onUpdate:modelValue":h[1]||(h[1]=p=>s.value=p),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com",onKeydown:tr(c,["enter"])},null,544),[[Ot,s.value]])]),ze(V0),a.value?(k(),D("div",cj,[d("div",uj,[h[6]||(h[6]=d("span",null,"✅",-1)),d("span",null,"Un email de vérification a été envoyé à "+ie(s.value)+". Vérifie ta boîte mail et clique sur le lien pour continuer.",1)]),h[7]||(h[7]=d("div",{class:"p-3 rounded-lg border border-blue-500/30 bg-blue-500/10 text-blue-200 text-sm"},[d("p",{class:"font-medium mb-2"},"📧 Prochaines étapes :"),d("ol",{class:"list-decimal list-inside space-y-1 text-xs"},[d("li",null,"Vérifie ta boîte mail (et les spams si nécessaire)"),d("li",null,"Clique sur le lien de vérification dans l'email"),d("li",null,"Définis ton mot de passe sur la page qui s'ouvre"),d("li",null,"Tu seras automatiquement connecté et redirigé")])],-1))])):se("",!0),o.value?(k(),D("div",dj,ie(o.value),1)):se("",!0)])):se("",!0),d("div",hj,[r.value===1?(k(),D("button",{key:0,onClick:c,disabled:!l.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[i.value?(k(),D("span",pj,"⏳")):(k(),D("span",mj,"✉️")),d("span",null,ie(i.value?"Envoi...":"Envoyer l'email de vérification"),1)],8,fj)):se("",!0),r.value===1?(k(),D("button",{key:1,onClick:h[2]||(h[2]=p=>f.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")):se("",!0)])])])):se("",!0)}},rm="magicLinks";function sm({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function M0(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Gf({seasonId:n,playerId:e,eventId:t,action:r,slug:s}){const i=sm({seasonId:n,playerId:e,eventId:t,action:r}),o=M0(40),a=pe(te,rm,i),l=Date.now()+1e3*60*60*24*7;await en(a,{seasonId:n,playerId:e,eventId:t,token:o,action:r,expiresAt:l});let f=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(r)}`;return s&&(f+=`&slug=${encodeURIComponent(s)}`),{id:i,token:o,url:f}}async function AP({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=sm({seasonId:n,playerId:e,eventId:r,action:s}),o=M0(40),a=pe(te,rm,i),l=Date.now()+1e3*60*60*24*7;await en(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const f=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:f}}async function PP({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=sm({seasonId:n,playerId:e,eventId:t,action:s}),o=pe(te,rm,i),a=await Tt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function dv({seasonId:n,playerId:e,eventId:t,action:r}){const s=sm({seasonId:n,playerId:e,eventId:t,action:r}),i=pe(te,rm,s);await Ni(i)}const L0="accountMagicLinks";function im(n){return`account__${n}`}async function CP({currentEmail:n,newEmail:e}){const t=M0(40),r=im(t),s=pe(te,L0,r),i=Date.now()+1e3*60*60*24*7;await en(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function RP({token:n}){const e=im(n),t=pe(te,L0,e),r=await Tt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function kP({token:n}){const e=im(n),t=pe(te,L0,e);await Ni(t)}const DP=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:im,consumeAccountEmailUpdateLink:kP,consumeMagicLink:dv,createAccountEmailUpdateLink:CP,createEmailVerificationLink:AP,createMagicLink:Gf,verifyAccountEmailUpdateLink:RP,verifyMagicLink:PP},Symbol.toStringTag,{value:"Module"}));async function sh({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:on()};return await Bi(tt(te,"pushQueue"),i),{success:!0}}const gj=Object.freeze(Object.defineProperty({__proto__:null,queuePushMessage:sh},Symbol.toStringTag,{value:"Module"}));function NP({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,yesUrl:s,noUrl:i}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🎯 <strong>Nouveau spectacle à l'horizon !</strong></p>
      <p>Es-tu dispo le ${t} pour <a href="${r}" style="color:#3b82f6;text-decoration:underline;font-weight:600;">${e}</a> ?</p>
      <p>🎭 <em>On a besoin de toi pour que ça brille ! ✨</em></p>
      <p style="margin-top: 12px; text-align: center;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails : <a href="${r}" style="color:#3b82f6;text-decoration:underline;">${r}</a></p>
    </div>
  `}function vj({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,declineUrl:s,confirmUrl:i,selectedPlayers:o}){const a=n?`<strong>${n}</strong>`:"<strong>Hello</strong>",l=o?o.join(", "):"";return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${a}, tu es en lice pour faire partie de l'équipe pour <a href="${r}" style="color:#8b5cf6;text-decoration:underline;font-weight:600;">${e}</a> le ${t}!</p>
      
      <p>Voici la sélection temporaire : <strong>${l}</strong></p>
      
      <p style="margin: 20px 0; padding: 15px; background-color: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">
        <strong>⚠️ IMPORTANT : Tu dois confirmer ta participation !</strong><br>
        L'équipe ne sera confirmée que lorsque <strong>toutes les personnes sélectionnées auront confirmé</strong> leur disponibilité.
      </p>
      
      <div style="margin: 20px 0; text-align: center;">
        <a href="${i||r}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #10b981, #059669);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(16, 185, 129, 0.3);margin-right: 10px;">✅ Confirmer ma participation</a>
        
        <a href="${s}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #dc2626, #b91c1c);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(220, 38, 38, 0.3);margin-right: 10px;">❌ Décliner</a>
        
        <a href="${r}" style="display:inline-block;padding:10px 16px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;font-weight:500;">📋 Afficher les détails</a>
      </div>
    </div>
  `}function yj({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>Bonjour ${n}</strong>`:"<strong>Bonjour</strong>"}, tu n'as pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
      <p style="margin-top: 8px; font-weight: 600;">${e}</p>
      <p style="color:#374151;">${t}</p>
      <p style="margin-top: 8px;">Lien direct : ${r}</p>
    </div>
  `}function OP({playerName:n,eventTitle:e,eventDate:t,eventUrl:r}){return`${n?`${n}`:"Hello"},

🎯 Nouveau spectacle à l'horizon ! 

Es-tu dispo le ${t} pour ${e} ?

🎭 On a besoin de toi pour que ça brille ! ✨

✅ Dispo ❌ Pas dispo

Lien direct : ${r}`}function bj({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,confirmUrl:s}){return`${n?`Bonjour ${n}`:"Hello"},

Tu es sélectionné(e) pour ${e} le ${t}!

🕺 Prépares-toi à briller, toute l'équipe compte sur toi!

⚠️ IMPORTANT : Tu dois confirmer ta participation !
L'équipe ne sera confirmée que lorsque toutes les personnes sélectionnées auront confirmé leur disponibilité.

✅ Confirmer ma participation : ${s||r}
📋 Détails : ${r}

Un imprévu ?😬 
Pas de souci, signales vite ton indisponibilité ici pour qu'on relance la sélection du spectacle : ${r}`}function VP({eventTitle:n,eventDate:e,eventUrl:t,selectedPlayers:r}){const s=r.length>0?r.join(", "):"les personnes sélectionnées";return`🎭 ANNONCE SÉLECTION 🎭

${n}
📅 ${e}

✅ SÉLECTIONNÉS : ${s}

🎯 Préparez-vous à briller !

⚠️ PRÉSÉLECTION TEMPORAIRE ⚠️
Cette sélection sera définitive uniquement lorsque tous les joueurs sélectionnés auront confirmé leur participation.

🔗 Détails et confirmations : ${t}`}function MP({playerName:n,eventTitle:e,eventUrl:t,activationUrl:r,seasonTitle:s}){return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${n?`<strong>${n}</strong>`:"<strong>Hello</strong>"},</p>
      <p>🔔 <strong>Active tes notifications pour ne rien rater !</strong></p>
      <p>Tu veux être informé(e) en temps réel de <strong>tous tes événements</strong> de la saison <strong>${s}</strong> ?</p>
      <p>🎯 <em>Clique sur le bouton ci-dessous pour activer tes notifications et recevoir des alertes pour tes événements !</em></p>
      <p style="margin-top: 16px; text-align: center;">
        <a href="${r}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #8b5cf6, #ec4899);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(139, 92, 246, 0.3);">🔔 Activer mes notifications</a>
      </p>
      <p style="margin-top: 16px; color:#6b7280; font-size: 14px;">
        <em>En activant tes notifications, tu recevras des alertes pour :</em><br>
        • Les demandes de disponibilité<br>
        • Les sélections de joueurs<br>
        • Les changements d'horaires<br>
        • Les annonces importantes
      </p>
      <p style="margin-top: 16px; color:#6b7280;">Détails de l'événement : <a href="${t}" style="color:#3b82f6;text-decoration:underline;">${t}</a></p>
    </div>
  `}function _j({playerName:n,eventTitle:e,eventUrl:t,activationUrl:r,seasonTitle:s}){return`${n?`${n}`:"Hello"},

🔔 Active tes notifications pour ne rien rater !

Tu veux être informé(e) en temps réel de tous tes événements de la saison ${s} ?

🎯 Clique sur le lien ci-dessous pour activer tes notifications et recevoir des alertes pour tes événements !

🔔 Activer mes notifications : ${r}

En activant tes notifications, tu recevras des alertes pour :
• Les demandes de disponibilité
• Les sélections de joueurs  
• Les changements d'horaires
• Les annonces importantes

Détails de l'événement : ${t}`}function wj({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,noUrl:s,reminderType:i}){const o=i==="reminder_7days";return`
    <!DOCTYPE html>
    <html lang="fr">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Rappel spectacle - ${e}</title>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .button { display: inline-block; padding: 12px 24px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; margin: 10px 5px; }
        .button.secondary { background: #6c757d; }
        .footer { text-align: center; margin-top: 30px; color: #666; font-size: 14px; }
        .highlight { background: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107; margin: 20px 0; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>${o?"📅":"⏰"} Rappel spectacle</h1>
          <p>${e}</p>
        </div>
        
        <div class="content">
          <h2>Salut ${n} ! 👋</h2>
          
          <div class="highlight">
            <strong>${o?"Prépares-toi bien !":"C'est pour demain !"}</strong><br>
            Ton spectacle <strong>${e}</strong> a lieu dans <strong>${o?"7 jours":"1 jour"}</strong> !
          </div>
          
          <p>Date : <strong>${t}</strong></p>
          
          <p>Es-tu toujours disponible pour ce spectacle ?</p>
          
          <div style="text-align: center; margin: 30px 0;">
            <a href="${r}" class="button">📋 Voir les détails</a>
            <a href="${s}" class="button secondary">❌ Se désister</a>
          </div>
          
          <p><em>Si tu n'es plus disponible, n'oublie pas de te désister pour laisser ta place à quelqu'un d'autre !</em></p>
        </div>
        
        <div class="footer">
          <p>Ce message est envoyé automatiquement par HatCast</p>
          <p>Tu peux gérer tes préférences de notification dans l'application</p>
        </div>
      </div>
    </body>
    </html>
  `}function xj({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,confirmedPlayers:s}){const i=n?`<strong>${n}</strong>`:"<strong>Hello</strong>",o=s?s.join(", "):"";return`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${i},</p>
      <p>🎉 <strong>Félicitations ! L'équipe est confirmée !</strong></p>
      <p>L'équipe pour <a href="${r}" style="color:#10b981;text-decoration:underline;font-weight:600;">${e}</a> le ${t} est maintenant <strong>définitive</strong> !</p>
      
      <div style="margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 8px; color: white;">
        <h3 style="margin: 0 0 10px 0; color: white;">✅ ÉQUIPE CONFIRMÉE</h3>
        <p style="margin: 0; color: white;"><strong>${o}</strong></p>
      </div>
      
      <p>🎭 <em>Préparez-vous à briller sur scène ! ✨</em></p>
      
      <div style="margin: 20px 0; text-align: center;">
        <a href="${r}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #10b981, #059669);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(16, 185, 129, 0.3);">📋 Voir les détails du spectacle</a>
      </div>
    </div>
  `}function Ej({playerName:n,eventTitle:e,eventDate:t,eventUrl:r,confirmedPlayers:s}){const i=n?`Bonjour ${n}`:"Hello",o=s?s.join(", "):"";return`${i},

🎉 FÉLICITATIONS ! L'ÉQUIPE EST CONFIRMÉE !

L'équipe pour ${e} le ${t} est maintenant DÉFINITIVE !

✅ ÉQUIPE CONFIRMÉE : ${o}

🎭 Préparez-vous à briller sur scène ! ✨

📋 Détails du spectacle : ${r}`}function LP({eventTitle:n,eventDate:e,eventUrl:t,confirmedPlayers:r}){const s=r.length>0?r.join(", "):"l'équipe";return`🎉 ÉQUIPE CONFIRMÉE ! 🎉

${n}
📅 ${e}

✅ ÉQUIPE DÉFINITIVE : ${s}

🎭 Préparez-vous à briller sur scène ! ✨

🔗 Détails du spectacle : ${t}`}function Ij({playerName:n,eventTitle:e,eventDate:t,confirmedPlayers:r}){return{title:"🎉 Équipe confirmée !",body:r?r.join(", "):"l'équipe",data:{confirmedPlayers:r,eventTitle:e,eventDate:t}}}const Tj=Object.freeze(Object.defineProperty({__proto__:null,buildAvailabilityEmailTemplate:NP,buildAvailabilityTextTemplate:OP,buildConfirmedTeamEmailTemplate:xj,buildConfirmedTeamPushTemplate:Ij,buildConfirmedTeamTextTemplate:Ej,buildGlobalConfirmedTeamAnnouncementTemplate:LP,buildGlobalSelectionAnnouncementTemplate:VP,buildNoEmailTemplate:yj,buildNotificationActivationTemplate:MP,buildNotificationActivationTextTemplate:_j,buildReminderEmailTemplate:wj,buildSelectionEmailTemplate:vj,buildSelectionTextTemplate:bj},Symbol.toStringTag,{value:"Module"})),Sj="HatCast <impropick@gmail.com>",Aj="impropick@gmail.com";function ih(n=null){return{from:n||Sj,replyTo:n||Aj}}async function Pj({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const v=pe(te,"userPreferences",n),x=await Tt(v);if(x.exists()){const _=x.data();if((_==null?void 0:_.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=NP({playerName:e,eventTitle:t,eventDate:r,eventUrl:o,yesUrl:s,noUrl:i}),f=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,h={to:n,message:{subject:f,html:c},createdAt:on(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}},p=ih(l);h.from=p.from,h.replyTo=p.replyTo,await Bi(tt(te,"mail"),h);try{const v=pe(te,"userPreferences",n),x=await Tt(v),_=x.exists()?x.data():{};if((_==null?void 0:_.notifyAvailabilityPush)!==!1){const w=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,T=`${e}, t'es dispo ?`;await sh({toEmail:n,title:w,body:T,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function $P({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=r&&r!=="utilisateur"?`Salut ${r} !`:"Salut !",a=i?"Pour sécuriser ton compte, on a besoin de vérifier que tu as bien accès à cette adresse email.":"Pour protéger tes saisies de disponibilités, on a besoin de vérifier que tu as bien accès à cette adresse email.",l=i?"Confirmer mon email":"Vérifier mon email",c=i?"Confirme ton email":"🔒 Vérifie ton email pour protéger tes saisies",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>${o}</p>
      <p>${a}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #3b82f6, #1d4ed8);color:#fff;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(59, 130, 246, 0.3);">${l}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,h={to:n,message:{subject:c,html:f},createdAt:on(),meta:{reason:t,displayName:r}},p=ih(s);h.from=p.from,h.replyTo=p.replyTo,await Bi(tt(te,"mail"),h)}async function Cj({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return $P({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function Rj({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0,noUrl:l=void 0,confirmUrl:c=void 0,declineUrl:f=void 0}){try{const _=pe(te,"userPreferences",n),w=await Tt(_);if(w.exists()){const T=w.data();if((T==null?void 0:T.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}M.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const h=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,p=o||`🎭 Confirme ta participation pour · ${t}`;M.debug("queueSelectionEmail html/subject ready");const v={to:n,message:{subject:p,html:h},createdAt:on(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}},x=ih(a);v.from=x.from,v.replyTo=x.replyTo,M.debug("queueSelectionEmail firestore payload ready");try{await Bi(tt(te,"mail"),v);try{const _=pe(te,"userPreferences",n),w=await Tt(_),T=w.exists()?w.data():{};if(console.log("Préférences utilisateur pour notifications push",{toEmail:n,prefs:T,notifySelectionPush:T==null?void 0:T.notifySelectionPush,shouldSendPush:(T==null?void 0:T.notifySelectionPush)!==!1}),(T==null?void 0:T.notifySelectionPush)!==!1){console.log("Envoi notification push de sélection",{toEmail:n,playerName:e,eventTitle:t});{const N={url:s||window.location.origin};typeof c<"u"&&(N.confirmUrl=c),typeof f<"u"&&(N.declineUrl=f),typeof l<"u"&&(N.noUrl=l);const I=o.includes("Équipe confirmée"),j=I?"🎉 Équipe confirmée !":"🎭 Confirme ta participation !",ne=I?selectedPlayers.join(", "):`${e}, tu es en lice pour faire partie de l'équipe pour ${t} (${r}) 🎉`;await sh({toEmail:n,title:j,body:ne,data:N,reason:"selection"})}console.log("Notification push de sélection envoyée avec succès")}else console.log("Notification push de sélection désactivée par préférences utilisateur")}catch(_){console.error("Erreur lors de l'envoi de la notification push de sélection",_)}return M.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(_){throw M.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:_}),_}}async function kj({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const x=pe(te,"userPreferences",n),_=await Tt(x);if(_.exists()){const w=_.data();if((w==null?void 0:w.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",f=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,h=a||`🎭 Tu n'es plus dans la sélection · ${t}`,p={to:n,message:{subject:h,html:f},createdAt:on(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}},v=ih(l);p.from=v.from,p.replyTo=v.replyTo,await Bi(tt(te,"mail"),p);try{const x=pe(te,"userPreferences",n),_=await Tt(x),w=_.exists()?_.data():{};(w==null?void 0:w.notifySelectionPush)!==!1&&await sh({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function Dj({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i,isConfirmedTeam:o=!1}){if(M.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:a}=await je(()=>Promise.resolve().then(()=>$o),void 0),{createMagicLink:l}=await je(()=>Promise.resolve().then(()=>DP),void 0),c=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const f=o?`🎉 Équipe confirmée pour · ${e.title}`:`🎭 Confirme ta participation pour · ${e.title}`,h=[];for(const p of t){M.debug("Traitement du joueur",{playerName:p});try{const v=i==null?void 0:i.find(ne=>ne.name===p);if(!v){M.warn("Joueur non trouvé",{playerName:p});continue}M.debug("Joueur trouvé");const x=await a(v.id,r);if(!x){M.warn("Pas d'email pour le joueur",{playerName:p});continue}M.debug("Email trouvé pour joueur");const w=`${(await l({seasonId:r,playerId:v.id,eventId:n,action:"decline"})).url}&slug=${encodeURIComponent(s)}`;let T;const I=`${(await l({seasonId:r,playerId:v.id,eventId:n,action:"confirm"})).url}&slug=${encodeURIComponent(s)}`;try{const{buildSelectionEmailTemplate:ne,buildConfirmedTeamEmailTemplate:ae}=await je(()=>Promise.resolve().then(()=>Tj),void 0);M.debug("Magic links générés pour sélection",{playerName:p,confirmUrl:I.substring(0,100)+"...",declineUrl:w.substring(0,100)+"..."}),o?T=ae({playerName:p,eventTitle:e.title,eventDate:Aa(e.date),eventUrl:c,confirmedPlayers:t}):T=ne({playerName:p,eventTitle:e.title,eventDate:Aa(e.date),eventUrl:c,declineUrl:w,confirmUrl:I,selectedPlayers:t}),M.debug("HTML généré avec le template approprié")}catch(ne){M.error("Erreur lors de l'import du template, utilisation du template de fallback",{error:ne});const ae=t.join(", ");o?T=`
            <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
              <p>Bonjour <strong>${p}</strong>,</p>
              <p>🎉 <strong>Félicitations ! L'équipe est confirmée !</strong></p>
              <p>L'équipe pour <strong>${e.title}</strong> (${Aa(e.date)}) est maintenant <strong>définitive</strong> !</p>
              <div style="margin: 20px 0; padding: 15px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 8px; color: white;">
                <h3 style="margin: 0 0 10px 0; color: white;">✅ ÉQUIPE CONFIRMÉE</h3>
                <p style="margin: 0; color: white;"><strong>${ae}</strong></p>
              </div>
              <p>🎭 <em>Préparez-vous à briller sur scène ! ✨</em></p>
              <p style="text-align: center;">
                <a href="${c}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #10b981, #059669);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(16, 185, 129, 0.3);">📋 Voir les détails du spectacle</a>
              </p>
            </div>
          `:T=`
            <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
              <p>Bonjour <strong>${p}</strong>,</p>
              <p>Tu es en lice pour faire partie de l'équipe pour <strong>${e.title}</strong> (${Aa(e.date)}).</p>
              <p>Voici la sélection temporaire : <strong>${ae}</strong></p>
              <p>⚠️ IMPORTANT : Tu dois confirmer ta participation !</p>
              <p>L'équipe ne sera confirmée que lorsque tous les joueurs sélectionnés auront confirmé leur disponibilité.</p>
              <p>
                <a href="${I}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #10b981, #059669);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(16, 185, 129, 0.3);margin-right: 10px;">✅ Confirmer ma participation</a>
                <a href="${w}" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg, #dc2626, #b91c1c);color:white;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 12px rgba(220, 38, 38, 0.3);margin-right: 10px;">❌ Décliner</a>
                <a href="${c}" style="display:inline-block;padding:10px 16px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;font-weight:500;">📋 Afficher les détails</a>
              </p>
            </div>
          `,M.debug("HTML généré avec le template de fallback")}M.debug("HTML généré pour joueur");const j=Rj({toEmail:x,playerName:p,eventTitle:e.title,eventDate:Aa(e.date),eventUrl:c,html:T,subject:f,noUrl:w,confirmUrl:I,declineUrl:w});h.push(j),M.info("Email ajouté à la queue",{playerName:p})}catch(v){M.error("Erreur lors de l'envoi de l'email de sélection",{playerName:p,error:v.message,stack:v.stack})}}return M.info("Nombre total d'emails à envoyer",{count:h.length}),await Promise.all(h),M.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:h.length}}async function Nj({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(M.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await je(()=>Promise.resolve().then(()=>$o),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],f=Array.isArray(r)?r.join(", "):"";for(const h of t)try{const p=o==null?void 0:o.find(_=>_.name===h);if(!p){M.warn("Joueur retiré non trouvé",{playerName:h});continue}const v=await a(p.id,s);if(!v){M.warn("Pas d'email pour le joueur retiré",{playerName:h});continue}const x=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${h}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${Aa(e.date)}) 😔.</p>
          ${f?`<p>Nouvelle sélection: <strong>${f}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(kj({toEmail:v,playerName:h,eventTitle:e.title,eventDate:Aa(e.date),eventUrl:l,newSelectedPlayers:r,html:x}))}catch(p){M.error("Erreur lors de l'envoi de l'email de désélection",{playerName:h,error:p})}return await Promise.all(c),M.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function Aa(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function Oj({toEmail:n,playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i,fromEmail:o=void 0}){const a=MP({playerName:e,eventTitle:t,eventUrl:r,activationUrl:s,seasonTitle:i}),l=`🔔 Active tes notifications pour ${i}`,c={to:n,message:{subject:l,html:a},createdAt:on(),meta:{reason:"notification_activation",eventTitle:t,playerName:e}},f=ih(o);c.from=f.from,c.replyTo=f.replyTo;try{return await Bi(tt(te,"mail"),c),M.info("Email d'activation des notifications ajouté à la queue",{toEmail:n,playerName:e}),{success:!0}}catch(h){throw M.error("Erreur lors de l'ajout de l'email d'activation à la queue",h),h}}function $0(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function FP(n){return`seasonPreferredPlayer:${n||"global"}`}function Qf(n,e){try{const t=FP(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function UP(n,e){try{const t=FP(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function jP(n,e,t,r=null){try{M.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await $c(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await je(()=>import("./index.esm-fc00cd90.js"),[]),{db:c}=await je(()=>Promise.resolve().then(()=>vr),void 0),f=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),h=o(f,a("email","==",e)),p=await l(h);if(!p.empty&&p.docs.find(I=>I.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");M.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:v}=await je(()=>import("./index.esm-253f6bce.js"),[]),{auth:x}=await je(()=>Promise.resolve().then(()=>vr),void 0),_=await v(x,e,t);M.info("Compte Firebase Auth créé",{uid:_.user.uid});const w=$0(t),T=r?pe(c,"seasons",r,"playerProtection",n):pe(c,"playerProtection",n);return await en(T,{playerId:n,email:e,passwordHash:w,firebaseUid:_.user.uid,isProtected:!0,createdAt:new Date}),M.info("Protection sauvegardée dans Firestore"),r&&Qf(r,n),{success:!0}}catch(s){throw M.error("Erreur lors de la protection du joueur",s),s}}async function qP({playerId:n,email:e,seasonId:t=null}){const r=t?pe(te,"seasons",t,"playerProtection",n):pe(te,"playerProtection",n);(await Tt(r)).exists()?await cs(r,{email:e,updatedAt:new Date}):await en(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await AP({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function BP({playerId:n,seasonId:e=null}){const t=e?pe(te,"seasons",e,"playerProtection",n):pe(te,"playerProtection",n);if(!(await Tt(t)).exists())throw new Error("Protection introuvable");return await cs(t,{emailVerifiedAt:new Date}),{success:!0}}async function zP({playerId:n,seasonId:e=null}){const t=e?pe(te,"seasons",e,"playerProtection",n):pe(te,"playerProtection",n);return await cs(t,{emailVerifiedAt:null}),{success:!0}}async function HP(n,e=null){try{const t=e?pe(te,"seasons",e,"playerProtection",n):pe(te,"playerProtection",n);return await en(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&UP(e,n),{success:!0,email:""}}catch(t){throw M.error("Erreur lors de la suppression de la protection",t),t}}async function Ws(n,e=null){try{const t=e?pe(te,"seasons",e,"playerProtection",n):pe(te,"playerProtection",n),r=await Tt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return M.error("Erreur lors de la vérification de protection",t),!1}}async function $c(n,e=null){try{const t=e?pe(te,"seasons",e,"playerProtection",n):pe(te,"playerProtection",n),r=await Tt(t);return r.exists()?r.data():null}catch(t){return t.code!=="not-found"&&t.code!=="permission-denied"&&M.error("Erreur lors de la récupération des données de protection",t),null}}async function WP(n,e=null){try{const t=await $c(n,e);return(t==null?void 0:t.email)||""}catch(t){return t.code!=="not-found"&&t.code!=="permission-denied"&&M.error("Erreur lors de la récupération de l'email",t),""}}async function hv(n=null){try{const e=n?tt(te,"seasons",n,"playerProtection"):tt(te,"playerProtection");return(await It(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return e.code!=="not-found"&&e.code!=="permission-denied"&&M.error("Erreur lors du chargement des protections",e),[]}}async function kd(n){try{const e=[],t=Lo(tt(te,"playerProtection"),ss("email","==",n));(await It(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await It(tt(te,"seasons"));for(const i of s.docs){const o=i.id,a=Lo(tt(te,"seasons",o,"playerProtection"),ss("email","==",n));(await It(a)).forEach(c=>{var h;const f=c.data();f!=null&&f.isProtected&&e.push({seasonId:o,seasonName:(h=i.data())==null?void 0:h.name,playerId:c.id,...f})})}return e}catch(e){return e.code!=="not-found"&&e.code!=="permission-denied"&&M.error("Erreur listAssociationsForEmail",e),[]}}async function KP(n,e,t=null){try{const r=await $c(n,t);if(!r||!r.isProtected)return!1;if(r.email){M.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await je(()=>import("./index.esm-253f6bce.js"),[]),{auth:i}=await je(()=>Promise.resolve().then(()=>vr),void 0);return await s(i,r.email,e),M.debug("Mot de passe Firebase Auth valide"),Li.saveSession(n),t&&Qf(t,n),!0}catch(s){return M.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{M.debug("Vérification avec hash local");const s=$0(e),i=r.passwordHash===s;return i&&(Li.saveSession(n),t&&Qf(t,n)),i}}catch(r){return M.error("Erreur lors de la vérification du mot de passe",r),!1}}async function GP({playerId:n,seasonId:e=null}){const t=e?pe(te,"seasons",e,"playerProtection",n):pe(te,"playerProtection",n),r=await Tt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await cs(t,{isProtected:!0,updatedAt:new Date}),{success:!0,email:s.email,playerId:n,seasonId:e};throw new Error("Email non défini pour cette protection")}function $a(n){return Li.isPasswordCached(n)}function Vj(n){return null}async function QP(n,e=null){try{M.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await $c(n,e);if(M.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(M.debug("Email à utiliser (masqué)"),t.firebaseUid){M.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await je(()=>import("./index.esm-253f6bce.js"),[]),{auth:s}=await je(()=>Promise.resolve().then(()=>vr),void 0);M.debug("Tentative d'envoi d'email"),await r(s,t.email),M.info("Email envoyé avec succès via Firebase Auth")}else{M.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await je(()=>import("./index.esm-253f6bce.js"),[]),{auth:i}=await je(()=>Promise.resolve().then(()=>vr),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);M.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),M.info("Email envoyé avec succès");const{updateDoc:l}=await je(()=>import("./index.esm-fc00cd90.js"),[]),{db:c}=await je(()=>Promise.resolve().then(()=>vr),void 0),f=e?pe(c,"seasons",e,"playerProtection",n):pe(c,"playerProtection",n);await l(f,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")M.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),M.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw M.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function Mj(n,e,t=null){try{const r=$0(e),s=t?pe(te,"seasons",t,"playerProtection",n):pe(te,"playerProtection",n);return await cs(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw M.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function Lj(n){return new Promise((e,t)=>{M.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const $o=Object.freeze(Object.defineProperty({__proto__:null,addPreferredPlayerLocal:Qf,clearEmailVerificationForProtection:zP,finalizeProtectionAfterVerification:GP,getCachedPlayerPassword:Vj,getPlayerEmail:WP,getPlayerProtectionData:$c,isPlayerPasswordCached:$a,isPlayerProtected:Ws,listAssociationsForEmail:kd,listProtectedPlayers:hv,markEmailVerifiedForProtection:BP,protectPlayer:jP,removePreferredPlayerLocal:UP,requirePlayerPasswordForAvailability:Lj,sendPasswordResetEmail:QP,startEmailVerificationForProtection:qP,unprotectPlayer:HP,updatePlayerPasswordInFirestore:Mj,verifyPlayerPassword:KP},Symbol.toStringTag,{value:"Module"})),$j={class:"mb-4 md:mb-6"},Fj={class:"flex items-start gap-4"},Uj={class:"flex items-center gap-3"},jj={class:"space-y-2"},qj={class:"flex items-center gap-2"},Bj={class:"text-gray-400 text-xs md:text-sm"},zj={key:0,class:"flex items-center gap-2"},Hj=["title"],Wj={class:"text-blue-200"},Kj={class:"space-y-4 md:space-y-6"},Gj={class:"space-y-2 md:space-y-3"},Qj={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},Jj=["disabled"],Yj={key:0,class:"mt-2 text-xs text-red-300"},Xj={key:1,class:"mt-2 text-xs text-green-300"},Zj={class:"space-y-2 md:space-y-3"},e9={class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5"},t9={key:0,class:"space-y-2 md:space-y-3"},n9={class:"flex items-center justify-between"},r9=["title"],s9={key:0,class:"p-3 md:p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},i9={class:"flex items-center justify-between"},o9=["disabled"],a9={key:0,class:"text-xs text-green-300"},l9={key:1,class:"text-xs text-red-300"},c9={key:2,class:"text-[10px] text-gray-400 break-all"},u9={class:"text-[10px] text-gray-500"},d9={class:"flex items-center justify-between mb-4"},h9={class:"space-y-4"},f9=["disabled"],p9={key:0,class:"text-xs text-red-300 text-center"},m9={key:1,class:"text-xs text-green-300 text-center"},g9={class:"flex items-center justify-between mb-4"},v9={class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},y9={class:"space-y-3"},b9={key:0,class:"text-sm text-gray-400 text-center py-4"},_9={key:1,class:"space-y-2"},w9={class:"flex items-center gap-2 min-w-0 flex-1"},x9={class:"truncate"},E9={class:"text-white font-medium text-sm"},I9={class:"text-gray-400 text-xs"},T9=["onClick"],JP={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","delete-account","open-player"],setup(n,{emit:e}){const t=n,r=e,s=A(""),i=A(""),o=A(!1),a=A(""),l=A(""),c=A(!1),f=A(!1),h=A(""),p=A(""),v=A([]),x=A(!1),_=A(!1),w=A(!1),T=A(!1),N=A(""),I=A(""),j=A(localStorage.getItem("fcmToken")||""),ne=function(z){try{return z?z.length>20?z.slice(0,8)+"…"+z.slice(-6):z:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8"),ae=A(!1);Pt(s,ce=>{i.value=ce||""}),Pt(i,ce=>{c.value=!!ce&&ce.includes("@")&&ce!==s.value});async function V(){if(c.value){o.value=!0,a.value="",l.value="";try{const ce=await CP({currentEmail:s.value,newEmail:i.value.trim()});await $P({toEmail:i.value.trim(),verifyUrl:ce.url,purpose:"account_email_update",displayName:"utilisateur"}),l.value=`Un email de vérification a été envoyé à ${i.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(ce){a.value=(ce==null?void 0:ce.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{o.value=!1}}}async function P(){if(s.value){f.value=!0,h.value="",p.value="";try{const ce=window.location.pathname+window.location.search,z={lastVisitedPage:ce,timestamp:Date.now(),email:s.value,context:"account_menu_password_reset",returnToAccountMenu:!0,modalState:{accountMenu:!0,eventDetails:ce.includes("modal=event_details"),playerDetails:ce.includes("modal=player_details"),eventId:new URLSearchParams(window.location.search).get("event"),playerId:new URLSearchParams(window.location.search).get("player")}};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(z)),await R0(s.value),p.value="Email de réinitialisation envoyé. Vérifiez votre boîte de réception."}catch{h.value="Impossible d'envoyer l'email de réinitialisation. Veuillez réessayer."}finally{f.value=!1}}}function S(ce){return`${ce.seasonId||"global"}__${ce.playerId}`}async function $(){try{const ce=s.value?await kd(s.value):[],z=[];for(const ke of ce){let Oe=ke.playerId,qe=ke.seasonId||"—";try{if(ke.seasonId){const mt=pe(te,"seasons",ke.seasonId,"players",ke.playerId),zt=await Tt(mt);zt.exists()&&(Oe=zt.data().name||Oe);const On=pe(te,"seasons",ke.seasonId),Yt=await Tt(On);Yt.exists()&&(qe=Yt.data().name||qe)}}catch{}z.push({...ke,playerName:Oe,seasonName:qe})}v.value=z}catch{v.value=[]}}async function F(ce){if(confirm(`Êtes-vous sûr de vouloir dissocier la personne "${ce.playerName}" de votre compte ?`))try{const{deleteDoc:z}=await je(()=>import("./index.esm-fc00cd90.js"),[]);if(ce.seasonId){const Oe=pe(te,"seasons",ce.seasonId,"playerProtection",ce.playerId);await z(Oe)}else{const Oe=pe(te,"playerProtection",ce.playerId);await z(Oe)}try{if(ce.seasonId){const Oe=`seasonPreferredPlayer:${ce.seasonId}`,qe=localStorage.getItem(Oe);if(qe)if(qe.startsWith("[")){const zt=(JSON.parse(qe)||[]).filter(On=>On!==ce.playerId);localStorage.setItem(Oe,JSON.stringify(zt))}else qe===ce.playerId&&localStorage.removeItem(Oe)}}catch{}await $();const ke=`Personne "${ce.playerName}" dissociée avec succès`}catch(z){console.error("Erreur lors de la dissociation:",z),alert(`Erreur lors de la dissociation: ${z.message||"Veuillez réessayer"}`)}}function U(ce){r("open-player",ce),Ze()}async function O(){if(s.value){T.value=!0,I.value="",N.value="";try{const{queuePushMessage:ce}=await je(()=>Promise.resolve().then(()=>gj),void 0);await ce({toEmail:s.value,title:"Test HatCast",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),N.value="OK"}catch{I.value="Échec de l'envoi du test"}finally{T.value=!1}}}function pt(){const ce=new CustomEvent("pwa-update-test",{detail:{type:"test-update",timestamp:Date.now()}});window.dispatchEvent(ce),alert(`🧪 Test de mise à jour PWA déclenché !

Vérifiez que la notification toast apparaît en bas à droite de l'interface.`)}function ct(){if(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches){alert("📱 Votre application est déjà installée en mode standalone.");return}if(window.deferredPrompt)window.deferredPrompt.prompt(),window.deferredPrompt.userChoice.then(ce=>{ce.outcome==="accepted"?console.log("✅ Installation PWA acceptée par l'utilisateur"):console.log("❌ Installation PWA refusée par l'utilisateur"),window.deferredPrompt=null});else{const ce=new CustomEvent("show-pwa-install-banner",{detail:{type:"manual-trigger",timestamp:Date.now()}});window.dispatchEvent(ce),alert(`📱 Barre d'installation PWA déclenchée !

Si elle n'apparaît pas, essayez de naviguer sur le site pendant quelques minutes pour déclencher les critères d'installation.`)}}function Ct(){ae.value=!ae.value}function Ze(){r("close")}return Pt(()=>t.show,ce=>{var z;if(ce)try{s.value=((z=Ve==null?void 0:Ve.currentUser)==null?void 0:z.email)||"",$()}catch{}}),In(()=>{var ce;if(t.show)try{s.value=((ce=Ve==null?void 0:Ve.currentUser)==null?void 0:ce.email)||"",$()}catch{}w.value=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname.includes(".local")||window.location.search.includes("debug=true")}),(ce,z)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-2 md:p-4",onClick:Ze},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg md:max-w-xl max-h-[90vh] overflow-y-auto",onClick:z[3]||(z[3]=At(()=>{},["stop"]))},[d("button",{onClick:Ze,class:"absolute right-2 md:right-3 top-2 md:top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),d("div",$j,[d("div",Fj,[d("div",Uj,[z[13]||(z[13]=d("div",{class:"w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full flex items-center justify-center flex-shrink-0"},[d("span",{class:"text-lg md:text-xl"},"👤")],-1)),d("div",jj,[z[12]||(z[12]=d("h3",{class:"text-white font-semibold text-base md:text-lg"},"Mon compte",-1)),d("div",qj,[d("span",Bj,ie(s.value||"Non défini"),1),d("button",{onClick:z[0]||(z[0]=ke=>x.value=!0),class:"text-indigo-400 hover:text-indigo-300 transition-colors p-1 hover:bg-indigo-400/10 rounded flex-shrink-0",title:"Modifier l'email","aria-label":"Modifier l'email"}," ✏️ ")]),v.value.length>0?(k(),D("div",zj,[d("button",{onClick:z[1]||(z[1]=ke=>v.value.length===1?U(v.value[0]):_.value=!0),class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-xs md:text-sm hover:bg-blue-500/30 transition-colors cursor-pointer",title:v.value.length===1?`Voir ${v.value[0].playerName}`:"Gérer mes personnes"},[z[11]||(z[11]=d("span",{class:"text-blue-300"},"⭐",-1)),d("span",Wj,ie(v.value.length===1?v.value[0].playerName:`${v.value.length} personnes`),1)],8,Hj)])):se("",!0)])])])]),z[23]||(z[23]=d("div",{class:"border-t border-white/10 mb-4 md:mb-6"},null,-1)),d("div",Kj,[d("div",Gj,[z[15]||(z[15]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-green-400"},"🔑"),lt(" Mot de passe ")],-1)),d("div",Qj,[z[14]||(z[14]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),d("button",{onClick:P,disabled:f.value,class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ie(f.value?"⏳":"Changer de mot de passe"),9,Jj),h.value?(k(),D("div",Yj,ie(h.value),1)):se("",!0),p.value?(k(),D("div",Xj,ie(p.value),1)):se("",!0)])]),d("div",Zj,[z[17]||(z[17]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-red-400"},"⚠️"),lt(" Suppression de compte ")],-1)),d("div",e9,[z[16]||(z[16]=d("p",{class:"text-xs md:text-sm text-gray-400 mb-3"},"Cette action est irréversible et supprimera définitivement votre compte.",-1)),d("button",{onClick:z[2]||(z[2]=ke=>ce.$emit("delete-account")),class:"w-full px-3 md:px-4 py-2 md:py-3 rounded-lg bg-red-600 text-white hover:bg-red-500 text-sm"},"Supprimer mon compte")])]),w.value?(k(),D("div",t9,[d("div",n9,[z[18]||(z[18]=d("h3",{class:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base"},[d("span",{class:"text-purple-400"},"🛠️"),lt(" Développement ")],-1)),d("button",{onClick:Ct,class:"text-purple-400 hover:text-purple-300 transition-colors p-1 hover:bg-purple-400/10 rounded",title:ae.value?"Réduire":"Développer"},ie(ae.value?"▼":"▶"),9,r9)]),ae.value?(k(),D("div",s9,[z[22]||(z[22]=d("p",{class:"text-xs text-purple-200 mb-2"},"Outils de développement et de test",-1)),d("div",i9,[z[19]||(z[19]=d("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),d("button",{onClick:O,disabled:T.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ie(T.value?"Envoi…":"Envoyer un test"),9,o9)]),d("div",{class:"flex items-center justify-between"},[z[20]||(z[20]=d("div",{class:"text-xs text-gray-400"},"Test de mise à jour PWA",-1)),d("button",{onClick:pt,class:"px-3 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-500 transition-colors"}," 🧪 Simuler maj ")]),d("div",{class:"flex items-center justify-between"},[z[21]||(z[21]=d("div",{class:"text-xs text-gray-400"},"Renvoyer la barre d'installation PWA",-1)),d("button",{onClick:ct,class:"px-3 py-1 rounded bg-yellow-600 text-white text-xs hover:bg-yellow-500 transition-colors"}," 📱 Afficher install ")]),N.value?(k(),D("div",a9,"Notification test envoyée (vérifiez votre appareil)")):se("",!0),I.value?(k(),D("div",l9,ie(I.value),1)):se("",!0),j.value?(k(),D("div",c9,"FCM token: "+ie(j.value),1)):se("",!0),d("div",u9,"VAPID: "+ie(Br(ne)||"indisponible"),1)])):se("",!0)])):se("",!0)]),d("div",{class:"mt-4 md:mt-6 text-center"},[d("button",{onClick:Ze,class:"px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 text-sm"},"Fermer")])]),x.value?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:z[7]||(z[7]=ke=>x.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md",onClick:z[6]||(z[6]=At(()=>{},["stop"]))},[d("div",d9,[z[24]||(z[24]=d("h3",{class:"text-lg md:text-xl font-semibold text-white flex items-center gap-2"},[d("span",{class:"text-blue-400"},"📧"),lt(" Modifier l'email ")],-1)),d("button",{onClick:z[4]||(z[4]=ke=>x.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",h9,[d("div",null,[z[25]||(z[25]=d("label",{class:"block text-xs text-gray-400 mb-2"},"Nouvelle adresse email",-1)),at(d("input",{"onUpdate:modelValue":z[5]||(z[5]=ke=>i.value=ke),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400 text-sm",placeholder:"nouvel@email.com"},null,512),[[Ot,i.value]])]),d("button",{onClick:V,disabled:!c.value||o.value,class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-sm"},ie(o.value?"⏳":"Mettre à jour"),9,f9),a.value?(k(),D("div",p9,ie(a.value),1)):se("",!0),l.value?(k(),D("div",m9,ie(l.value),1)):se("",!0)])])])):se("",!0),_.value?(k(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:z[10]||(z[10]=ke=>_.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-4 md:p-6 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-lg",onClick:z[9]||(z[9]=At(()=>{},["stop"]))},[d("div",g9,[d("h3",v9,[z[26]||(z[26]=d("span",{class:"text-yellow-400"},"⭐",-1)),lt(" "+ie(v.value.length<=1?"Ma personne":"Mes personnes"),1)]),d("button",{onClick:z[8]||(z[8]=ke=>_.value=!1),class:"text-white/80 hover:text-white"},"✖️")]),d("div",y9,[v.value.length===0?(k(),D("div",b9," Aucune personne associée pour le moment. ")):(k(),D("div",_9,[(k(!0),D(wt,null,qr(v.value,ke=>(k(),D("div",{key:S(ke),class:"flex items-center justify-between p-3 bg-gray-800/30 rounded-lg"},[d("div",w9,[z[27]||(z[27]=d("span",{class:"text-yellow-400 text-sm"},"⭐",-1)),d("div",x9,[d("div",E9,ie(ke.playerName||"—"),1),d("div",I9,ie(ke.seasonName||ke.seasonId||"—"),1)])]),d("button",{onClick:Oe=>F(ke),class:"p-1.5 rounded bg-red-600/20 text-red-400 hover:bg-red-600/30 hover:text-red-300 transition-colors duration-200 flex-shrink-0",title:"Dissocier cette personne","aria-label":"Dissocier cette personne"}," 🗑️ ",8,T9)]))),128))]))])])])):se("",!0)])):se("",!0)}},Kx="/logos/hatcast-logo-desktop.png",S9={key:0,class:"w-10 h-10 bg-gray-600 animate-pulse rounded-full"},A9=["aria-expanded"],fv={__name:"AccountDropdown",props:{isConnected:{type:Boolean,default:!1},buttonClass:{type:String,default:"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700"}},emits:["open-account-menu","open-help","open-notifications","logout","open-login","open-account-creation"],setup(n,{emit:e}){const t=n,r=e,s=A(!1),i=A(!0),o=A(null),a=A({});Pt(()=>t.isConnected,w=>{i.value=!1},{immediate:!0}),In(()=>{i.value=!1});function l(){r("open-login")}function c(){s.value=!s.value,s.value&&kt(()=>f())}function f(){if(o.value){const w=o.value.getBoundingClientRect();a.value={top:`${w.bottom+8}px`,right:`${window.innerWidth-w.right}px`}}}function h(){s.value=!1,r("open-account-menu")}function p(){s.value=!1,r("open-help")}function v(){s.value=!1,r("open-notifications")}async function x(){s.value=!1;try{await Ve.signOut();try{const{default:w}=await je(()=>Promise.resolve().then(()=>xP),void 0),{default:T}=await je(()=>Promise.resolve().then(()=>IP),void 0);w.clearSession(),T.clearAllSessions(),console.log("Sessions locales effacées à la déconnexion")}catch(w){console.warn("Erreur lors de l'effacement des sessions:",w)}r("logout")}catch(w){console.error("Erreur lors de la déconnexion:",w)}}function _(){s.value=!1}return In(()=>{document.addEventListener("click",_),window.addEventListener("resize",f),window.addEventListener("scroll",f,{passive:!0})}),Ii(()=>{document.removeEventListener("click",_),window.removeEventListener("resize",f),window.removeEventListener("scroll",f)}),(w,T)=>(k(),D("div",{class:"relative",onClick:T[0]||(T[0]=At(()=>{},["stop"]))},[i.value?(k(),D("div",S9)):n.isConnected?(k(),D("button",{key:2,"data-testid":"user-menu",onClick:c,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte","aria-expanded":s.value,"aria-haspopup":"true",ref_key:"dropdownButton",ref:o},T[2]||(T[2]=[d("span",{class:"text-2xl"},"👤",-1)]),8,A9)):(k(),D("button",{key:1,"data-testid":"login-btn",onClick:l,class:$t(["px-2.5 py-1 md:px-4 md:py-2 text-xs md:text-base rounded-lg transition-all duration-300 border transition-colors",n.buttonClass])},T[1]||(T[1]=[d("span",{class:"md:hidden text-lg",title:"Se connecter"},"🔑",-1),d("span",{class:"hidden md:inline"},"Connexion",-1)]),2)),(k(),ns(ed,{to:"body"},[s.value&&n.isConnected?(k(),D("div",{key:0,class:"fixed w-auto min-w-[180px] max-w-[200px] md:min-w-[200px] md:max-w-[240px] bg-gray-900 border border-white/20 rounded-lg shadow-xl py-1 z-[9999]",style:Ur(a.value),role:"menu"},[d("button",{onClick:h,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},T[3]||(T[3]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"👤",-1),d("span",{class:"truncate"},"Mon compte",-1)])),d("button",{onClick:v,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},T[4]||(T[4]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🔔",-1),d("span",{class:"truncate"},"Notifications",-1)])),d("button",{onClick:p,class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},T[5]||(T[5]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"❓",-1),d("span",{class:"truncate"},"Aide",-1)])),T[7]||(T[7]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{"data-testid":"logout-btn",onClick:x,class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 md:gap-3 transition-colors duration-150",role:"menuitem"},T[6]||(T[6]=[d("span",{class:"text-base md:text-lg flex-shrink-0"},"🚪",-1),d("span",{class:"truncate"},"Se déconnecter",-1)]))],4)):se("",!0)]))]))}},P9={class:"container mx-auto px-4 py-4"},C9={class:"flex items-center justify-between"},R9={class:"flex items-center"},k9={href:"/","data-testid":"home-link",class:"flex items-center"},D9={class:"relative w-48 h-12 md:w-56 md:h-14"},N9={class:"flex items-center gap-2"},O9={__name:"AppHeader",props:{isScrolled:{type:Boolean,default:!1}},emits:["open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account-creation"],setup(n,{emit:e}){const t=n,r=e,s=Uo(),i=$e(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");Pt(()=>s.path,()=>{La(),setTimeout(()=>{La()},100)},{immediate:!0}),Ii(()=>{window._appHeaderUnsubscribe&&(window._appHeaderUnsubscribe(),delete window._appHeaderUnsubscribe)});function o(){r("open-account-menu")}function a(){r("open-help")}function l(){r("open-notifications")}function c(){r("open-players")}function f(){r("logout")}function h(){r("open-login")}return(p,v)=>(k(),D("header",{"data-testid":"app-header",class:$t(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",n.isScrolled?"bg-white/95 backdrop-blur-md border-b border-gray-200/50 shadow-lg":"bg-transparent"])},[d("nav",P9,[d("div",C9,[d("div",R9,[d("a",k9,[d("div",D9,[n.isScrolled?(k(),D(wt,{key:1},[v[2]||(v[2]=d("img",{src:uv,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden"},null,-1)),v[3]||(v[3]=d("img",{src:Kx,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block"},null,-1))],64)):(k(),D(wt,{key:0},[v[0]||(v[0]=d("img",{src:uv,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 md:hidden brightness-0 invert"},null,-1)),v[1]||(v[1]=d("img",{src:Kx,alt:"Logo HatCast - Retour à l'accueil",class:"w-full h-full drop-shadow-lg transform hover:scale-105 transition-all duration-300 hidden md:block brightness-0 invert"},null,-1))],64))])])]),d("div",N9,[ze(fv,{"is-connected":Br(yP),"button-class":i.value,onOpenAccountMenu:o,onOpenHelp:a,onOpenNotifications:l,onOpenPlayers:c,onLogout:f,onOpenLogin:h},null,8,["is-connected","button-class"]),tk(p.$slots,"actions")])])])],2))}},V9={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},M9={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-2xl"},L9={class:"flex border-b border-white/10 mb-6"},$9={class:"space-y-6"},F9={key:0,class:"space-y-4"},U9={class:"p-3 rounded-lg border border-blue-500/30 bg-blue-500/10"},j9={class:"text-blue-200 text-sm"},q9={class:"text-blue-100 font-semibold"},B9={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},z9={class:"space-y-3"},H9={class:"flex items-center justify-between"},W9={class:"flex items-center gap-2"},K9={class:"flex items-center justify-between"},G9={class:"flex items-center gap-2"},Q9={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},J9={class:"space-y-3 opacity-50"},Y9={class:"flex items-center justify-between"},X9={class:"flex items-center gap-2 cursor-not-allowed"},Z9={class:"flex items-center justify-between"},eq={class:"flex items-center gap-2 cursor-not-allowed"},tq={key:1,class:"space-y-4"},nq={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},rq={class:"flex items-center justify-between mb-3"},sq=["disabled"],iq={key:1,class:"inline-flex items-center text-xs text-gray-300"},oq={key:0,class:"text-xs text-gray-400 italic"},aq={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},lq={class:"space-y-3"},cq={class:"flex items-center justify-between"},uq={class:"flex items-center gap-2"},dq=["disabled"],hq={class:"flex items-center justify-between"},fq={class:"flex items-center gap-2"},pq=["disabled"],mq={class:"p-4 rounded-lg border border-white/10 bg-white/5 space-y-3"},gq={class:"space-y-3 opacity-50"},vq={class:"flex items-center justify-between"},yq={class:"flex items-center gap-2 cursor-not-allowed"},bq={class:"flex items-center justify-between"},_q={class:"flex items-center gap-2 cursor-not-allowed"},wq={key:0,class:"mt-4 text-xs text-red-300"},xq={key:1,class:"mt-4 text-xs text-green-300"},Eq={class:"mt-6 flex justify-between items-center"},Iq=["disabled"],YP={__name:"NotificationsModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=n,r=e,s=A(""),i=A({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0,notifyReminder7Days:!0,notifyReminder1Day:!0,notifyReminder7DaysPush:!0,notifyReminder1DayPush:!0}),o=A(!1),a=A(""),l=A(""),c=A(!1),f=A(localStorage.getItem("fcmToken")||""),h=A(!1),p=A("email");function v(N){const{active:I,token:j}=N.detail;I&&j?(f.value=j,h.value=!0,localStorage.setItem("fcmToken",j),console.log("Notifications push réactivées automatiquement")):(h.value=!1,f.value="",localStorage.removeItem("fcmToken"),console.log("Notifications push désactivées"))}async function x(){try{if(!s.value)return;const N=pe(te,"userPreferences",s.value),I=await Tt(N);if(I.exists()){const j=I.data()||{};i.value.notifyAvailability=j.notifyAvailability!==!1,i.value.notifySelection=j.notifySelection!==!1,i.value.notifySelectionPush=j.notifySelectionPush!==!1,i.value.notifyAvailabilityPush=j.notifyAvailabilityPush!==!1,i.value.notifyReminder7Days=j.notifyReminder7Days!==!1,i.value.notifyReminder1Day=j.notifyReminder1Day!==!1,i.value.notifyReminder7DaysPush=j.notifyReminder7DaysPush!==!1,i.value.notifyReminder1DayPush=j.notifyReminder1DayPush!==!1}else i.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0,notifyReminder7Days:!0,notifyReminder1Day:!0,notifyReminder7DaysPush:!0,notifyReminder1DayPush:!0}}catch{}}async function _(){try{if(c.value=!0,!await k0()){a.value="Push non supporté sur cet appareil";return}const I=await Hf();I.active?(f.value=I.token,h.value=!0,localStorage.setItem("fcmToken",I.token),console.log("Notifications push activées avec succès")):a.value=`Activation impossible: ${I.error}`}catch(N){const I=typeof Notification<"u"?Notification.permission:"unknown",j=N&&(N.message||N.code)?` (${N.message||N.code})`:"";testPushError.value=`Activation impossible – permission: ${I}${j}`}finally{c.value=!1}}async function w(){if(s.value){o.value=!0,a.value="",l.value="";try{const N=pe(te,"userPreferences",s.value);await en(N,{...i.value},{merge:!0}),l.value="Préférences sauvegardées"}catch{a.value="Impossible de sauvegarder vos préférences"}finally{o.value=!1}}}function T(){r("close")}return Pt(()=>t.show,N=>{N&&x()}),In(()=>{var N;try{s.value=((N=Ve==null?void 0:Ve.currentUser)==null?void 0:N.email)||"",h.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken"),QF(),window.addEventListener("push-status-changed",v),Hf().then(I=>{I.active&&(f.value=I.token,h.value=!0,localStorage.setItem("fcmToken",I.token))})}catch{}t.show&&x()}),Ii(()=>{window.removeEventListener("push-status-changed",v)}),(N,I)=>n.show?(k(),D("div",V9,[d("div",M9,[d("div",{class:"flex items-center justify-between mb-6"},[I[10]||(I[10]=d("h2",{class:"text-2xl font-bold text-white"},"🔔 Préférences de notifications",-1)),d("button",{onClick:T,class:"text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️")]),d("div",L9,[d("button",{onClick:I[0]||(I[0]=j=>p.value="email"),class:$t(["px-4 py-2 text-sm font-medium transition-colors duration-200",p.value==="email"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"])}," 📧 Emails ",2),d("button",{onClick:I[1]||(I[1]=j=>p.value="mobile"),class:$t(["px-4 py-2 text-sm font-medium transition-colors duration-200",p.value==="mobile"?"text-emerald-400 border-b-2 border-emerald-400":"text-gray-400 hover:text-white"])}," 📱 Mobile ",2)]),d("div",$9,[p.value==="email"?(k(),D("div",F9,[d("div",U9,[d("div",j9,[I[11]||(I[11]=lt("Nous enverrons des emails à l'adresse : ")),d("span",q9,ie(s.value||"Non connecté"),1)])]),d("div",B9,[I[14]||(I[14]=d("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Spectacles",-1)),d("div",z9,[d("div",H9,[d("label",W9,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[2]||(I[2]=j=>i.value.notifyAvailability=j),class:"w-4 h-4"},null,512),[[ts,i.value.notifyAvailability]]),I[12]||(I[12]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsqu'un spectacle a besoin de personnes",-1))])]),d("div",K9,[d("label",G9,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[3]||(I[3]=j=>i.value.notifySelection=j),class:"w-4 h-4"},null,512),[[ts,i.value.notifySelection]]),I[13]||(I[13]=d("span",{class:"text-sm text-white"},"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])])]),d("div",Q9,[I[17]||(I[17]=d("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Rappels automatiques",-1)),I[18]||(I[18]=d("p",{class:"text-xs text-gray-400 italic mb-3"},"🚧 Bientôt disponible",-1)),d("div",J9,[d("div",Y9,[d("label",X9,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[4]||(I[4]=j=>i.value.notifyReminder7Days=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[ts,i.value.notifyReminder7Days]]),I[15]||(I[15]=d("span",{class:"text-sm text-gray-400"},"Rappel automatique 7 jours avant un spectacle",-1))])]),d("div",Z9,[d("label",eq,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[5]||(I[5]=j=>i.value.notifyReminder1Day=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[ts,i.value.notifyReminder1Day]]),I[16]||(I[16]=d("span",{class:"text-sm text-gray-400"},"Rappel automatique 1 jour avant un spectacle",-1))])])])])])):se("",!0),p.value==="mobile"?(k(),D("div",tq,[I[27]||(I[27]=d("div",{class:"p-3 rounded-lg border border-orange-500/30 bg-orange-500/10"},[d("div",{class:"flex items-center gap-2 text-sm text-orange-300"},[d("span",null,"⚠️"),d("span",null,"Les notifications mobiles sont encore expérimentales")])],-1)),d("div",nq,[I[21]||(I[21]=d("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Notifications sur cet appareil",-1)),d("div",rq,[I[20]||(I[20]=d("span",{class:"text-sm text-white"},"Statut",-1)),h.value?(k(),D("span",iq,I[19]||(I[19]=[d("span",{class:"mr-1 text-emerald-400"},"✓",-1),lt(" Actif ")]))):(k(),D("button",{key:0,onClick:_,disabled:c.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ie(c.value?"...":"Activer"),9,sq))]),h.value?se("",!0):(k(),D("div",oq," ⚠️ Ces préférences sont désactivées car les notifications de l'application ne sont pas actives sur cet appareil "))]),d("div",aq,[I[22]||(I[22]=d("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Spectacles",-1)),d("div",lq,[d("div",cq,[d("label",uq,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[6]||(I[6]=j=>i.value.notifySelectionPush=j),disabled:!h.value,class:"w-4 h-4"},null,8,dq),[[ts,i.value.notifySelectionPush]]),d("span",{class:$t(["text-sm text-white",{"text-gray-400":!h.value}])},"Me notifier lorsque je suis concerné par une sélection",2)])]),d("div",hq,[d("label",fq,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[7]||(I[7]=j=>i.value.notifyAvailabilityPush=j),disabled:!h.value,class:"w-4 h-4"},null,8,pq),[[ts,i.value.notifyAvailabilityPush]]),d("span",{class:$t(["text-sm text-white",{"text-gray-400":!h.value}])},"Me notifier lorsqu'un spectacle a besoin de joueurs",2)])])])]),d("div",mq,[I[25]||(I[25]=d("h4",{class:"text-sm font-medium text-gray-300 mb-3"},"Rappels automatiques",-1)),I[26]||(I[26]=d("p",{class:"text-xs text-gray-400 italic mb-3"},"🚧 Bientôt disponible",-1)),d("div",gq,[d("div",vq,[d("label",yq,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[8]||(I[8]=j=>i.value.notifyReminder7DaysPush=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[ts,i.value.notifyReminder7DaysPush]]),I[23]||(I[23]=d("span",{class:"text-sm text-gray-400"},"Rappel 7 jours avant (notifications)",-1))])]),d("div",bq,[d("label",_q,[at(d("input",{type:"checkbox","onUpdate:modelValue":I[9]||(I[9]=j=>i.value.notifyReminder1DayPush=j),disabled:"",class:"w-4 h-4 cursor-not-allowed"},null,512),[[ts,i.value.notifyReminder1DayPush]]),I[24]||(I[24]=d("span",{class:"text-sm text-gray-400"},"Rappel 1 jour avant (notifications)",-1))])])])])])):se("",!0)]),a.value?(k(),D("div",wq,ie(a.value),1)):se("",!0),l.value?(k(),D("div",xq,ie(l.value),1)):se("",!0),d("div",Eq,[d("button",{onClick:w,disabled:o.value,class:"px-4 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-500 disabled:opacity-50"},ie(o.value?"⏳":"Sauvegarder"),9,Iq),d("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"}," Fermer ")])])])):se("",!0)}},Tq={class:"space-y-3"},Sq={key:0,class:"text-sm text-gray-400"},Aq={key:1,class:"space-y-2"},Pq={class:"flex items-center justify-between gap-3"},Cq={class:"truncate"},Rq={class:"text-white font-semibold"},kq={class:"text-gray-400 text-xs"},Dq=["onClick"],XP={__name:"PlayersModal",props:{show:{type:Boolean,default:!1}},emits:["close","manage-player"],setup(n,{emit:e}){const t=n,r=e,s=A(""),i=A([]);function o(f){return`${f.seasonId||"global"}__${f.playerId}`}async function a(){var f;try{s.value=((f=Ve==null?void 0:Ve.currentUser)==null?void 0:f.email)||""}catch{}try{const h=s.value?await kd(s.value):[],p=[];for(const v of h){let x=v.playerId;try{if(v.seasonId){const _=pe(te,"seasons",v.seasonId,"players",v.playerId),w=await Tt(_);w.exists()&&(x=w.data().name||x)}}catch{}p.push({...v,playerName:x})}i.value=p}catch{i.value=[]}}function l(f){r("manage-player",f),c()}function c(){r("close")}return Pt(()=>t.show,f=>{f&&a()}),In(()=>{t.show&&a()}),(f,h)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:c},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:h[0]||(h[0]=At(()=>{},["stop"]))},[d("button",{onClick:c,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),h[2]||(h[2]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👥</span></div><h2 class="text-2xl font-bold text-white mb-1">Mes personnes</h2><p class="text-sm text-gray-300">Gérez vos associations de personnes</p></div>',1)),d("div",Tq,[h[1]||(h[1]=d("h3",{class:"text-white font-semibold mb-2"},"Mes personnes associées",-1)),i.value.length===0?(k(),D("div",Sq,"Aucune personne associée pour le moment.")):(k(),D("ul",Aq,[(k(!0),D(wt,null,qr(i.value,p=>(k(),D("li",{key:o(p),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[d("div",Pq,[d("div",Cq,[d("div",Rq,ie(p.seasonName||p.seasonId||"—"),1),d("div",kq,"Personne : "+ie(p.playerName||"—"),1)]),d("button",{onClick:v=>l(p),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,Dq)])]))),128))]))]),d("div",{class:"mt-6 text-center"},[d("button",{onClick:c,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):se("",!0)}};function Nq({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){var l,c,f;const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const h=(i==null?void 0:i.notifyAvailability)!==!1,p=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:h,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:p,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🎯 Nouveau spectacle !",body:n==="availability_reminder"?`${e}, ${t} (${r})`:`🎭 On a besoin de toi pour ${t} le ${r} !`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}},console.log("URLs pour notifications de disponibilité:",{eventUrl:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,urls:s})}if(n==="selection"){const h=(i==null?void 0:i.notifySelection)!==!1,p=(i==null?void 0:i.notifySelectionPush)!==!1,v=o.isConfirmedTeam||!1;a.email={enabled:h,subject:v?`🎉 Équipe confirmée pour ${t}`:`🎭 Equipe pour ${t}`},a.push={enabled:p,title:v?"🎉 Équipe confirmée !":"🎭 Confirme ta participation !",body:v?((l=o.confirmedPlayers)==null?void 0:l.join(", "))||"Équipe confirmée":`🕺 Prépares-toi à briller pour ${t} le ${r}!`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n,isConfirmedTeam:v}},console.log("URLs pour notifications de sélection:",{eventUrl:s.eventUrl,noUrl:s.noUrl,urls:s})}if(n==="reminder_7days"||n==="reminder_1day"){const h=n==="reminder_7days"?(i==null?void 0:i.notifyReminder7Days)!==!1:(i==null?void 0:i.notifyReminder1Day)!==!1,p=n==="reminder_7days"?(i==null?void 0:i.notifyReminder7DaysPush)!==!1:(i==null?void 0:i.notifyReminder1DayPush)!==!1,v=n==="reminder_7days",x=v?"7 jours":"1 jour",_=v?"📅":"⏰";a.email={enabled:h,subject:`${_} Rappel : ${t} dans ${x}`},a.push={enabled:p,title:`${_} Rappel spectacle`,body:`${e}, ${t} dans ${x} ! Es-tu prêt(e) ?`,data:{url:s.eventUrl,noUrl:s.noUrl,reason:n,reminderType:n,eventId:o.eventId,seasonId:o.seasonId}},console.log("URLs pour notifications de rappel:",{eventUrl:s.eventUrl,noUrl:s.noUrl,reason:n,reminderType:n})}return console.log("buildNotificationPayloads",{reason:n,recipientName:e,prefs:i,payloads:a,emailEnabled:(c=a.email)==null?void 0:c.enabled,pushEnabled:(f=a.push)==null?void 0:f.enabled}),a}async function Oq({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await Tt(pe(te,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=Nq({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),f=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await Pj({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>f.push({channel:"email",success:!0})).catch(p=>{M.error("notifyRecipientAcrossChannels email error",p),f.push({channel:"email",success:!1})}):n==="selection"&&f.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled&&await sh({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>{M.info("Notification push envoyée avec succès",{reason:n,recipientEmail:e}),f.push({channel:"push",success:!0})}).catch(p=>{M.error("notifyRecipientAcrossChannels push error",p),f.push({channel:"push",success:!1})}),{success:f.some(p=>p.success),results:f}}async function Gx({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const f of t)try{if(o&&typeof a=="function"){const v=await Promise.resolve(a(f.name,n));if(v===!0||v===!1)continue}const h={};if(typeof i=="function"){const v=await i({seasonId:r,playerId:f.id,eventId:n,action:"yes"}),x=await i({seasonId:r,playerId:f.id,eventId:n,action:"no"});h.yesUrl=`${v.url}&slug=${encodeURIComponent(s)}`,h.noUrl=`${x.url}&slug=${encodeURIComponent(s)}`}h.eventUrl=c,(await Oq({reason:o?"availability_reminder":"availability_request",recipientEmail:f.email,recipientName:f.name,eventTitle:e.title,eventDate:Vq(e.date),urls:h})).success||l.push(f.id)}catch{l.push(f.id)}return{success:!0,failures:l}}async function Qx(n){const e={...n,isConfirmedTeam:n.isConfirmedTeam||!1};return Dj(e)}function Vq(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function ZP({seasonId:n,eventId:e,playerEmail:t,playerName:r,eventTitle:s,eventDate:i,seasonSlug:o}){try{const a=new Date(i),l=new Date,c=new Date(a);c.setDate(a.getDate()-7);const f=new Date(a);f.setDate(a.getDate()-1);const h=[];a>l&&a.getTime()-l.getTime()<=7*24*60*60*1e3?h.push({type:"7days",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"}):c>l&&h.push({type:"7days",scheduledFor:c,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"}),a>l&&a.getTime()-l.getTime()<=1*24*60*60*1e3?h.push({type:"1day",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"}):f>l&&h.push({type:"1day",scheduledFor:f,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:a,seasonSlug:o,status:"pending"});const p=[];for(const v of h)try{const x=await Bi(tt(te,"reminderQueue"),{...v,createdAt:on(),updatedAt:on()});p.push({success:!0,id:x.id,type:v.type}),M.info("Rappel créé avec succès",{reminderId:x.id,type:v.type,playerEmail:t}),console.log(`✅ Rappel ${v.type} créé:`,{id:x.id,playerEmail:t,eventTitle:v.eventTitle,scheduledFor:v.scheduledFor,eventDate:v.eventDate})}catch(x){M.error("Erreur lors de la création du rappel",{error:x,reminder:v}),p.push({success:!1,type:v.type,error:x.message})}return{success:!0,results:p}}catch(a){throw M.error("Erreur lors de la création des rappels",a),a}}async function eC({seasonId:n,eventId:e,playerEmail:t}){try{const r=Lo(tt(te,"reminderQueue"),ss("seasonId","==",n),ss("eventId","==",e),ss("playerEmail","==",t)),s=await It(r),i=s.docs.map(o=>Ni(o.ref));return await Promise.all(i),M.info("Rappels supprimés pour le joueur",{seasonId:n,eventId:e,playerEmail:t,count:s.docs.length}),{success:!0,deletedCount:s.docs.length}}catch(r){throw M.error("Erreur lors de la suppression des rappels",r),r}}async function Mq({seasonId:n,eventId:e}){try{const t=Lo(tt(te,"reminderQueue"),ss("seasonId","==",n),ss("eventId","==",e)),r=await It(t),s=r.docs.map(i=>Ni(i.ref));return await Promise.all(s),M.info("Rappels supprimés pour l'événement",{seasonId:n,eventId:e,count:r.docs.length}),{success:!0,deletedCount:r.docs.length}}catch(t){throw M.error("Erreur lors de la suppression des rappels de l'événement",t),t}}async function Lq(n){try{const e=new Date(n);e.setHours(0,0,0,0);const t=new Date(n);t.setHours(23,59,59,999);const r=Lo(tt(te,"reminderQueue"),ss("scheduledFor",">=",e),ss("scheduledFor","<=",t),ss("status","==","pending"));return(await It(r)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw M.error("Erreur lors de la récupération des rappels en attente",e),e}}async function $q(n,e){try{await pe(te,"reminderQueue",n).update({status:"processed",processedAt:on(),result:e}),M.info("Rappel marqué comme traité",{reminderId:n,result:e})}catch(t){throw M.error("Erreur lors du marquage du rappel comme traité",t),t}}async function Fq({seasonId:n,eventId:e,playerEmail:t,playerName:r,eventTitle:s,eventDate:i,seasonSlug:o}){try{const a=new Date,l=new Date(a.getTime()-24*60*60*1e3),c=[{type:"7days",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:new Date(i),seasonSlug:o,status:"pending"},{type:"1day",scheduledFor:l,eventId:e,seasonId:n,playerEmail:t,playerName:r,eventTitle:s,eventDate:new Date(i),seasonSlug:o,status:"pending"}],f=[];for(const h of c)try{const p=await Bi(tt(te,"reminderQueue"),{...h,createdAt:on(),updatedAt:on()});f.push({success:!0,id:p.id,type:h.type}),M.info("Rappel de test créé avec succès",{reminderId:p.id,type:h.type,playerEmail:t})}catch(p){M.error("Erreur lors de la création du rappel de test",{error:p,reminder:h}),f.push({success:!1,type:h.type,error:p.message})}return{success:!0,results:f}}catch(a){throw M.error("Erreur lors de la création des rappels de test",a),a}}const Uq=Object.freeze(Object.defineProperty({__proto__:null,createRemindersForSelection:ZP,getPendingRemindersForDate:Lq,markReminderProcessed:$q,removeRemindersForEvent:Mq,removeRemindersForPlayer:eC,triggerRemindersForEvent:Fq},Symbol.toStringTag,{value:"Module"}));let yn="mock",ti=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],ni=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function om(n){yn=n}async function tC(){if(yn!=="firebase"||!(await It(tt(te,"seasons"))).empty)return;const e=pe(tt(te,"seasons"));await en(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:on()});const t=await It(tt(te,"players"));for(const o of t.docs)await en(pe(e,"players",o.id),o.data());const r=await It(tt(te,"events"));for(const o of r.docs)await en(pe(e,"events",o.id),o.data());const s=await It(tt(te,"availability"));for(const o of s.docs)await en(pe(e,"availability",o.id),o.data());const i=await It(tt(te,"selections"));for(const o of i.docs)await en(pe(e,"selections",o.id),o.data())}async function F0(){yn==="firebase"&&await tC()}async function Dd(n=null){let e;return yn==="firebase"?n?e=(await It(tt(te,"seasons",n,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=(await It(tt(te,"events"))).docs.map(r=>({id:r.id,...r.data()})):e=ni,e.sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const f=new Date(c);return isNaN(f.getTime())?null:f},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function ec(n=null){let e;return yn==="firebase"?n?e=(await It(tt(te,"seasons",n,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=(await It(tt(te,"players"))).docs.map(r=>({id:r.id,...r.data()})):e=ti,e.sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function jq(n=null){if(yn==="firebase"){const r=(n?await It(tt(te,"seasons",n,"players")):await It(tt(te,"players"))).docs.map(i=>({id:i.id,...i.data()})).sort((i,o)=>i.name.localeCompare(o.name)),s=Hp(te);r.forEach((i,o)=>{const a=n?pe(te,"seasons",n,"players",i.id):pe(te,"players",i.id);s.update(a,{order:o})}),await s.commit()}else ti.sort((e,t)=>e.name.localeCompare(t.name)),ti.forEach((e,t)=>{e.order=t})}async function U0(n,e=null){if(yn==="firebase"){const t=pe(e?tt(te,"seasons",e,"players"):tt(te,"players"));return await en(t,{name:n}),t.id}else{const t=`p${ti.length+1}`;return ti.push({id:t,name:n}),t}}async function nC(n,e=null){if(yn==="firebase"){const t=e?pe(te,"seasons",e,"players",n):pe(te,"players",n);await Ni(t);const r=e?await It(tt(te,"seasons",e,"availability")):await It(tt(te,"availability")),s=Hp(te);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else ti=ti.filter(t=>t.id!==n)}async function rC(n,e,t=null){if(yn==="firebase"){const r=t?pe(te,"seasons",t,"players",n):pe(te,"players",n),s=await Tt(r),i=s.exists()&&s.data().name||null;if(await en(r,{name:e},{merge:!0}),i&&i!==e){const o=Hp(te);try{const a=t?pe(te,"seasons",t,"availability",i):pe(te,"availability",i),l=await Tt(a);if(l.exists()){const c=l.data()||{},f=t?pe(te,"seasons",t,"availability",e):pe(te,"availability",e);o.set(f,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?tt(te,"seasons",t,"selections"):tt(te,"selections");(await It(a)).forEach(c=>{var h;const f=Array.isArray((h=c.data())==null?void 0:h.players)?c.data().players:[];if(f.includes(i)){const p=f.map(v=>v===i?e:v);o.update(c.ref,{players:p})}})}catch{}await o.commit()}}else{const r=ti.findIndex(s=>s.id===n);r!==-1&&(ti[r]={...ti[r],name:e})}}async function co(n,e,t=null){if(yn==="firebase"){const r=t?await It(tt(te,"seasons",t,"availability")):await It(tt(te,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function qs(n=null){if(yn==="firebase"){const e=n?await It(tt(te,"seasons",n,"selections")):await It(tt(te,"selections")),t={};return e.forEach(r=>{const s=r.data();t[r.id]={players:s.players||[],confirmed:s.confirmed||!1,confirmedAt:s.confirmedAt||null,updatedAt:s.updatedAt||null,playerStatuses:s.playerStatuses||{},confirmedByAllPlayers:s.confirmedByAllPlayers||!1}}),t}else return{}}async function pv(n,e,t=null){if(yn==="firebase"){const r=t?pe(te,"seasons",t,"availability",n):pe(te,"availability",n);await en(r,e)}}async function sC({seasonId:n,playerName:e,eventId:t,value:r}){if(yn!=="firebase")return;const s=n?pe(te,"seasons",n,"availability",e):pe(te,"availability",e),i=await Tt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await en(s,a)}async function Jf(n,e,t=null){console.log("🔍 saveSelection appelé:",{eventId:n,players:e,seasonId:t});try{if(yn==="firebase"){console.log("🔥 Mode Firebase activé");const r=t?pe(te,"seasons",t,"selections",n):pe(te,"selections",n);console.log("🔍 Référence sélection:",r.path),console.log("📖 Récupération ancienne sélection...");const s=await Tt(r);console.log("📄 Document récupéré:",{exists:s.exists,hasData:!!s.data(),data:s.data()});const i=s.exists&&s.data()?s.data().players||[]:[];console.log("🔍 Ancienne sélection:",i),console.log("🔍 Nouvelle sélection:",e),console.log("💾 Sauvegarde...");const o={};e.forEach(l=>{o[l]="pending"});const a={players:e,confirmed:!1,confirmedByAllPlayers:!1,playerStatuses:o,updatedAt:on()};await en(r,a),console.log("✅ Sélection sauvegardée avec succès");try{if(console.log("🔄 Début gestion des rappels automatiques"),t){console.log("📅 Récupération des infos événement et saison");const l=pe(te,"seasons",t,"events",n),c=pe(te,"seasons",t);console.log("🔍 Références:",{eventRef:l.path,seasonRef:c.path});const[f,h]=await Promise.all([Tt(l),Tt(c)]);if(console.log("📄 Documents récupérés:",{eventExists:f.exists,seasonExists:h.exists}),f.exists&&h.exists){const p=f.data(),v=h.data();console.log("📊 Données récupérées:",{eventTitle:p.title,eventDate:p.date,seasonSlug:v.slug});const x=i.filter(w=>!e.includes(w));console.log("🗑️ Joueurs à désélectionner:",x);for(const w of x)try{const{getPlayerEmail:T}=await je(()=>Promise.resolve().then(()=>$o),void 0),N=await T(w,t);N&&await eC({seasonId:t,eventId:n,playerEmail:N})}catch(T){console.error("Erreur lors de la suppression des rappels pour",w,T)}const _=e.filter(w=>!i.includes(w));console.log("🆕 Nouveaux joueurs sélectionnés:",_);for(const w of _)try{console.log(`📧 Création rappels pour ${w}...`);const{getPlayerEmail:T}=await je(()=>Promise.resolve().then(()=>$o),void 0),N=await T(w,t);if(console.log(`📧 Email pour ${w}:`,N?`✅ ${N}`:"❌ null"),N){console.log(`🎯 Création rappels pour ${w} (${N})`);const I=await ZP({seasonId:t,eventId:n,playerEmail:N,playerName:w,eventTitle:p.title,eventDate:p.date,seasonSlug:v.slug});console.log(`✅ Rappels créés pour ${w}:`,I)}else console.log(`⚠️ Pas d'email pour ${w}, rappels non créés`)}catch(T){console.error(`❌ Erreur lors de la création des rappels pour ${w}:`,T)}}}}catch(l){console.error("Erreur lors de la gestion des rappels automatiques:",l)}}else console.log("🎭 Mode mock activé");console.log("✅ saveSelection terminé avec succès")}catch(r){throw console.error("❌ Erreur dans saveSelection:",r),r}}async function qq(n,e=null){console.log("🔒 confirmSelection appelé:",{eventId:n,seasonId:e});try{if(yn==="firebase"){const t=e?pe(te,"seasons",e,"selections",n):pe(te,"selections",n),r=await Tt(t),s=r.exists?r.data():{players:[]},i=s.playerStatuses||{};s.players.forEach(o=>{i[o]||(i[o]="pending")}),await cs(t,{confirmed:!0,confirmedAt:on(),confirmedByAllPlayers:!1,playerStatuses:i}),console.log("✅ Sélection confirmée avec succès")}else console.log("🎭 Mode mock activé")}catch(t){throw console.error("❌ Erreur dans confirmSelection:",t),t}}async function Bq(n,e=null){console.log("🔓 unconfirmSelection appelé:",{eventId:n,seasonId:e});try{if(yn==="firebase"){const t=e?pe(te,"seasons",e,"selections",n):pe(te,"selections",n),s=(await Tt(t)).data(),i={};s&&s.playerStatuses&&Object.entries(s.playerStatuses).forEach(([l,c])=>{c==="declined"&&(i[l]="declined")});const a=(Array.isArray(s==null?void 0:s.players)?s.players:[]).filter(l=>i[l]!=="declined");await cs(t,{confirmed:!1,confirmedAt:null,players:a,playerStatuses:i,confirmedByAllPlayers:!1}),console.log("✅ Confirmation de sélection annulée avec succès")}else console.log("🎭 Mode mock activé")}catch(t){throw console.error("❌ Erreur dans unconfirmSelection:",t),t}}async function zq(n,e=null){console.log("🗑️ deleteSelection appelé:",{eventId:n,seasonId:e});try{if(yn==="firebase"){const t=e?pe(te,"seasons",e,"selections",n):pe(te,"selections",n);await Ni(t),console.log("✅ Sélection supprimée avec succès")}else console.log("🎭 Mode mock activé")}catch(t){throw console.error("❌ Erreur dans deleteSelection:",t),t}}async function iC(n,e=null){if(M.info("Suppression de l'événement",{eventId:n}),yn==="firebase")try{M.debug("Suppression de l'événement dans Firestore");const t=e?pe(te,"seasons",e,"events",n):pe(te,"events",n);await Ni(t),M.debug("Suppression de la sélection associée");const r=e?pe(te,"seasons",e,"selections",n):pe(te,"selections",n);await Ni(r),M.debug("Suppression des disponibilités");const s=e?await It(tt(te,"seasons",e,"availability")):await It(tt(te,"availability")),i=Hp(te);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){M.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),M.info("Opérations de suppression terminées avec succès")}catch(t){throw M.error("Erreur lors de la suppression",t),t}else ni=ni.filter(t=>t.id!==n)}async function oC(n,e=null){if(yn==="firebase"){const t=pe(e?tt(te,"seasons",e,"events"):tt(te,"events"));return await en(t,n),t.id}else{const t=`event${ni.length+1}`;return ni.push({id:t,...n}),t}}async function mv(n,e,t=null){if(yn==="firebase"){const r=t?pe(te,"seasons",t,"events",n):pe(te,"events",n);await en(r,e,{merge:!0})}else{const r=ni.findIndex(s=>s.id===n);r!==-1&&(ni[r]={id:n,...e})}}async function Hq(n,e,t=null){if(yn==="firebase"){const r=t?pe(te,"seasons",t,"events",n):pe(te,"events",n);await cs(r,{archived:!!e})}else{const r=ni.findIndex(s=>s.id===n);r!==-1&&(ni[r]={...ni[r],archived:!!e})}}async function Wq(n,e,t,r=null){console.log("🔄 updatePlayerSelectionStatus appelé:",{eventId:n,playerName:e,status:t,seasonId:r});try{if(yn==="firebase"){const s=r?pe(te,"seasons",r,"selections",n):pe(te,"selections",n),i=await Tt(s);if(!i.exists)throw new Error("Sélection non trouvée");const o=i.data(),{players:a=[],playerStatuses:l={}}=o,c={...l,[e]:t},f=a.every(h=>c[h]==="confirmed");return console.log("🔍 Vérification état global:",{players:a,updatedPlayerStatuses:c,allPlayersConfirmed:f}),await cs(s,{[`playerStatuses.${e}`]:t,confirmedByAllPlayers:f,updatedAt:on()}),console.log("✅ Statut du joueur et état global mis à jour avec succès:",{playerName:e,status:t,confirmedByAllPlayers:f}),{confirmedByAllPlayers:f}}else return console.log("🎭 Mode mock activé"),{confirmedByAllPlayers:!1}}catch(s){throw console.error("❌ Erreur dans updatePlayerSelectionStatus:",s),s}}async function Kq(n,e=null){console.log("🔍 isAllPlayersConfirmed appelé:",{eventId:n,seasonId:e});try{if(yn==="firebase"){const t=e?pe(te,"seasons",e,"selections",n):pe(te,"selections",n),r=await Tt(t);if(!r.exists)return console.log("❌ Sélection non trouvée"),!1;const s=r.data(),{confirmedByAllPlayers:i=!1}=s;return console.log("🔍 État global de la sélection:",{confirmedByAllPlayers:i}),i}else return console.log("🎭 Mode mock activé"),!1}catch(t){return console.error("❌ Erreur dans isAllPlayersConfirmed:",t),!1}}const Ul=Object.freeze(Object.defineProperty({__proto__:null,addPlayer:U0,confirmSelection:qq,deleteEvent:iC,deletePlayer:nC,deleteSelection:zq,initializeStorage:F0,isAllPlayersConfirmed:Kq,loadAvailability:co,loadEvents:Dd,loadPlayers:ec,loadSelections:qs,migrateToSeasons:tC,reorderPlayersAlphabetically:jq,saveAvailability:pv,saveEvent:oC,saveSelection:Jf,setEventArchived:Hq,setSingleAvailability:sC,setStorageMode:om,unconfirmSelection:Bq,updateEvent:mv,updatePlayer:rC,updatePlayerSelectionStatus:Wq},Symbol.toStringTag,{value:"Module"})),Gq={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},Qq={class:"hero-section relative overflow-hidden pt-24"},Jq={class:"hero-content py-16 md:py-24 px-4 relative z-10"},Yq={class:"container mx-auto"},Xq={class:"grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24 items-center"},Zq={class:"text-center lg:text-left order-1 lg:order-2"},eB={class:"hero-cta mb-10"},tB={class:"flex flex-col sm:flex-row gap-4 items-center justify-center"},nB={class:"seasons-section py-16"},rB={class:"container mx-auto px-4"},sB=["aria-busy"],iB={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center animate-pulse"},oB={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto justify-items-center place-content-center"},aB=["onClick"],lB={class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg overflow-hidden"},cB=["src","alt"],uB={key:1,class:"text-2xl"},dB={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},hB={key:0,class:"text-gray-300 text-sm mb-4 line-clamp-2 leading-relaxed"},fB={class:"flex justify-center gap-6 text-sm"},pB={class:"text-center"},mB={class:"text-white font-semibold"},gB={class:"text-center"},vB={class:"text-white font-semibold"},yB={class:"absolute top-4 right-4"},bB=["onClick","aria-expanded"],_B={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},wB=["onClick"],xB=["onClick"],EB=["onClick"],IB=["onClick"],TB=["onClick"],SB={class:"text-center mt-12"},AB={key:2,class:"text-center py-16"},PB={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},CB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},RB={class:"mb-6"},kB={class:"mb-6"},DB={class:"mb-6"},NB={class:"mb-6"},OB={class:"flex justify-end space-x-3"},VB=["disabled"],MB={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},LB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},$B={class:"text-center mb-6"},FB={class:"text-gray-300"},UB={key:2,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},jB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},qB={class:"text-center mb-6"},BB={class:"text-gray-300"},zB={class:"mb-6"},HB={class:"mb-6"},WB={class:"mb-6"},KB={key:0,class:"mb-4 text-center"},GB={class:"w-20 h-20 mx-auto mb-3 rounded-full overflow-hidden border-2 border-white/20"},QB=["src","alt"],JB=["disabled"],YB={key:0,class:"text-2xl mb-2 animate-spin"},XB={key:1,class:"text-2xl mb-2"},ZB={class:"text-sm"},e8={key:0},t8={key:1},n8={key:2},r8={key:2,class:"text-xs text-gray-400 mt-1"},s8={class:"flex justify-end space-x-3"},i8=["disabled"],o8={key:0,class:"flex items-center gap-2"},a8={key:1},l8={__name:"Seasons",setup(n){const e=A([]),t=A(!0),r=Za(),s=A(null),i=A(!1),o=A(!1),a=A(!1),l=A(""),c=A(""),f=A(""),h=A(""),p=A(""),v=A(""),x=A(null),_=A(""),w=A(null),T=A(null),N=A(!1),I=A(!1),j=A(null),ne=A(""),ae=A(!1),V=A(!1),P=A(!1),S=A(!1),$=A(!1),F=A(!1);In(async()=>{var W,xe;try{M.info("Début du chargement des saisons"),om("firebase"),M.info("Mode de stockage défini sur Firebase"),await F0(),M.info("Stockage initialisé"),M.info("Attente de l'initialisation du service d'authentification...");try{_P(),await O0(),M.info("Service d'authentification initialisé")}catch(Ue){M.warn("Service d'authentification non initialisé, continuation sans authentification:",Ue.message||"Erreur inconnue")}try{La(),M.info("Synchronisation forcée effectuée")}catch(Ue){M.warn("Erreur lors de la synchronisation forcée:",Ue)}M.info("Chargement des saisons...");try{e.value=await Fl(),M.info("Saisons chargées",{count:((W=e.value)==null?void 0:W.length)||0})}catch(Ue){throw M.error("Erreur lors du chargement des saisons:",Ue),Ue}if(e.value.length>0){M.info("Chargement des données des saisons...");const Ue=await Promise.all(e.value.map(async it=>{try{M.debug(`Chargement des données pour la saison: ${it.name} (ID: ${it.id})`);let bt,ot;try{bt=await Dd(it.id),M.debug(`Événements chargés pour ${it.name}:`,bt)}catch(Dt){M.warn(`Erreur lors du chargement des événements pour ${it.name}:`,Dt),bt=[]}try{ot=await ec(it.id),M.debug(`Joueurs chargés pour ${it.name}:`,ot)}catch(Dt){M.warn(`Erreur lors du chargement des joueurs pour ${it.name}:`,Dt),ot=[]}return M.debug(`Saison ${it.name}: ${(bt==null?void 0:bt.length)||0} événements, ${(ot==null?void 0:ot.length)||0} joueurs`),{...it,events:bt||[],players:ot||[]}}catch(bt){return M.warn(`Erreur lors du chargement des données pour la saison ${it.id}:`,bt),{...it,events:[],players:[]}}}));e.value=Ue,M.info("Données des saisons chargées",{count:e.value.length}),e.value.forEach(it=>{var bt,ot;M.info(`Saison finale ${it.name}: ${((bt=it.events)==null?void 0:bt.length)||0} événements, ${((ot=it.players)==null?void 0:ot.length)||0} joueurs`)})}zt().catch(Ue=>M.error("Migration sortOrder échouée",Ue))}catch(Ue){M.error("Erreur lors du chargement initial des saisons:",Ue),M.error("Stack trace:",Ue.stack);try{M.info("Tentative de fallback pour charger les saisons..."),e.value=await Fl(),M.info("Saisons chargées en fallback",{count:((xe=e.value)==null?void 0:xe.length)||0})}catch(it){M.error("Échec du fallback pour charger les saisons:",it)}}finally{t.value=!1,M.info("Chargement terminé, isLoading = false")}const de=()=>{F.value=window.scrollY>10};return window.addEventListener("scroll",de,{passive:!0}),()=>{window.removeEventListener("scroll",de)}});const U=$e(()=>[...e.value].sort((de,W)=>{var ot,Dt;const xe=typeof de.sortOrder=="number"?de.sortOrder:Number.MAX_SAFE_INTEGER,Ue=typeof W.sortOrder=="number"?W.sortOrder:Number.MAX_SAFE_INTEGER;if(xe!==Ue)return xe-Ue;const it=(ot=de.createdAt)!=null&&ot.toMillis?de.createdAt.toMillis():0,bt=(Dt=W.createdAt)!=null&&Dt.toMillis?W.createdAt.toMillis():0;return it!==bt?bt-it:(de.name||"").localeCompare(W.name||"")}));function O(de){r.push(`/season/${de}`)}function pt(de){s.value=s.value===de?null:de}function ct(){s.value=null}function Ct(de){T.value=de,p.value=de.name,v.value=de.description||"",x.value=null,_.value=de.logoUrl||"",a.value=!0,ct()}function Ze(){a.value=!1,T.value=null,p.value="",v.value="",x.value=null,_.value="",N.value=!1}async function ce(){a.value=!1,await Le({type:"editSeason",data:{seasonId:T.value.id,seasonName:T.value.name,newName:p.value.trim(),newDescription:v.value.trim(),newLogo:x.value,newLogoPreview:_.value,oldName:T.value.name,oldDescription:T.value.description||"",oldLogoUrl:T.value.logoUrl||""}})}function z(){const de=document.querySelector(".help-section");de&&de.scrollIntoView({behavior:"smooth"})}function ke(){const de=document.querySelector(".seasons-section");de&&de.scrollIntoView({behavior:"smooth"})}function Oe(de){const W=de.target.files[0];if(W){x.value=W,N.value=!0;const xe=new FileReader;xe.onload=Ue=>{_.value=Ue.target.result,N.value=!1},xe.onerror=()=>{N.value=!1},xe.readAsDataURL(W)}}function qe(){console.log("removeLogo appelé"),x.value=null,_.value="",console.log("Logo supprimé")}function mt(){const de=document.querySelector('input[type="file"][accept="image/*"]');de?de.click():console.error("Input file non trouvé pour triggerLogoUpload")}async function zt(){if(!e.value.length)return;const de=e.value.map(xe=>typeof xe.sortOrder=="number"?xe.sortOrder:null).filter(xe=>xe!==null);let W=de.length?Math.max(...de):0;for(const xe of e.value)if(typeof xe.sortOrder!="number"){W+=1;try{await yu(xe.id,W),xe.sortOrder=W}catch(Ue){M.error("Erreur migration sortOrder",{seasonName:xe==null?void 0:xe.name,error:Ue})}}}async function On(de){try{if(!(de!=null&&de.id)){alert("Saison introuvable");return}const[W,xe]=await Promise.all([Dd(de.id),ec(de.id)]),[Ue,it]=await Promise.all([co(xe,W,de.id),qs(de.id)]),bt=["Joueur",...W.map(wr=>ue(wr))],ot=[];for(const wr of xe){const Mr=(wr==null?void 0:wr.name)||"",Un=(Ue==null?void 0:Ue[Mr])||{},Yr=[Mr,...W.map(Wi=>Ke(Un[Wi.id],it==null?void 0:it[Wi.id],Mr))];ot.push(Yr)}const Dt=B([bt,...ot]),bn=new Blob(["\uFEFF"+Dt],{type:"text/csv;charset=utf-8;"}),Xe=(de==null?void 0:de.name)||(de==null?void 0:de.slug)||"saison",_r=`${Ce(Xe)}-disponibilites.csv`,ut=URL.createObjectURL(bn),_n=document.createElement("a");_n.href=ut,_n.download=_r,document.body.appendChild(_n),_n.click(),document.body.removeChild(_n),URL.revokeObjectURL(ut),M.info("Export CSV saison",{seasonId:de.id,events:W.length,players:xe.length})}catch(W){M.error("Erreur export CSV",W),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function Yt(de){if(!de)return null;if(de instanceof Date)return de;if(typeof(de==null?void 0:de.toDate)=="function")return de.toDate();if(typeof de=="string"||typeof de=="number"){const W=new Date(de);return isNaN(W.getTime())?null:W}return null}function ue(de){const W=Yt(de==null?void 0:de.date),xe=W?`${W.getFullYear()}-${String(W.getMonth()+1).padStart(2,"0")}-${String(W.getDate()).padStart(2,"0")}`:"",Ue=(de==null?void 0:de.title)||"Sans titre";return`${xe} · ${Ue}`.trim()}function Pe(de){return de===!0||de==="oui"?"disponible":de===!1||de==="non"?"non disponible":""}function B(de){return de.map(W=>W.map(G).join(",")).join(`
`)}function G(de){const W=String(de??"");return/[",\n\r]/.test(W)?'"'+W.replace(/"/g,'""')+'"':W}function Ce(de){return String(de||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function Ke(de,W,xe){return Array.isArray(W)&&W.includes(xe)?de===!1||de==="non"?"non disponible":"sélectionné":Pe(de)}async function R(de){if(ct(),de<=0)return;const W=[...U.value],xe=W[de],Ue=W[de-1],it=xe.sortOrder;xe.sortOrder=Ue.sortOrder,Ue.sortOrder=it;try{await Promise.all([yu(xe.id,xe.sortOrder),yu(Ue.id,Ue.sortOrder)])}catch(bt){M.error("Erreur lors du déplacement vers le haut",bt)}}async function L(de){ct();const W=[...U.value];if(de>=W.length-1)return;const xe=W[de],Ue=W[de+1],it=xe.sortOrder;xe.sortOrder=Ue.sortOrder,Ue.sortOrder=it;try{await Promise.all([yu(xe.id,xe.sortOrder),yu(Ue.id,Ue.sortOrder)])}catch(bt){M.error("Erreur lors du déplacement vers le bas",bt)}}function H(){l.value&&(c.value=l.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function fe(){h.value=h.value.replace(/[^0-9]/g,""),h.value.length>4&&(h.value=h.value.slice(0,4))}async function oe(){if(!l.value.trim()||!c.value.trim()||!h.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(h.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await mU(l.value.trim(),c.value.trim(),h.value.trim(),f.value.trim(),""),e.value=await Fl(),await zt(),me()}catch(de){M.error("Erreur lors de la création de la saison",de),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function me(){i.value=!1,l.value="",c.value="",f.value="",h.value=""}function Ie(de){w.value=de,o.value=!0}async function we(){o.value=!1,await Le({type:"deleteSeason",data:{seasonId:w.value.id,seasonName:w.value.name}})}function ee(){o.value=!1,w.value=null}function ge(){return j.value?{deleteSeason:"Suppression de saison - Code PIN requis",editSeason:"Modification de saison - Code PIN requis"}[j.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Le(de){const W=de.type==="editSeason"?de.data.seasonId:w.value.id;if(En.isPinCached(W)){const xe=En.getCachedPin(W);if(M.debug("PIN en cache trouvé, utilisation automatique"),await Wf(W,xe)){await We(de);return}else En.clearSession()}j.value=de,I.value=!0}async function ye(de){var W,xe,Ue,it,bt;M.debug("PIN soumis pour l'opération",{operationType:(W=j.value)==null?void 0:W.type});try{const ot=((Ue=(xe=j.value)==null?void 0:xe.data)==null?void 0:Ue.seasonId)||((it=w.value)==null?void 0:it.id),Dt=await Wf(ot,de);if(M.debug("PIN validé",{valid:Dt}),Dt){const bn=!!((bt=Ve.currentUser)!=null&&bt.email);En.saveSession(ot,de,bn),M.debug("PIN correct, fermeture de la modal et exécution de l'opération"),I.value=!1;const Xe=j.value;j.value=null,M.debug("Appel de executePendingOperation",{operationType:Xe==null?void 0:Xe.type}),await We(Xe)}else ne.value="Code PIN incorrect",setTimeout(()=>{ne.value=""},3e3)}catch(ot){M.error("Erreur lors de la vérification du PIN",ot),ne.value="Erreur lors de la vérification du code PIN"}}function Re(){I.value=!1,j.value=null,ne.value=""}function Qe(){return w.value&&En.isPinCached(w.value.id)?{timeRemaining:En.getTimeRemaining(),isExpiringSoon:En.isExpiringSoon()}:null}async function We(de){var Ue;if(M.debug("executePendingOperation appelé",{hasOperation:!!de}),!de){M.warn("Aucune opération à exécuter");return}const{type:W,data:xe}=de;M.info("Exécution de l'opération",{type:W});try{switch(W){case"deleteSeason":M.info("Suppression de la saison",{seasonId:xe.seasonId}),await gU(xe.seasonId),M.info("Saison supprimée, rechargement de la liste"),e.value=await Fl(),M.info("Liste des saisons rechargée",{count:((Ue=e.value)==null?void 0:Ue.length)||0});break;case"editSeason":M.info("Modification de la saison",{seasonId:xe.seasonId});const it=xe.newName!==xe.oldName,bt=xe.newDescription!==xe.oldDescription,ot=xe.newLogo!==null;if(!it&&!bt&&!ot){M.info("Aucun changement détecté, opération annulée");return}const Dt={};if(xe.newName!==xe.oldName&&(Dt.name=xe.newName),xe.newDescription!==xe.oldDescription&&(Dt.description=xe.newDescription),xe.newLogo)try{N.value=!0,M.info("Upload du nouveau logo...");const Xe=await RU(xe.newLogo,`season-logos/${xe.seasonId}`,{resize:!0,maxWidth:64,maxHeight:64,quality:.6});if(Dt.logoUrl=Xe,xe.oldLogoUrl&&NU(xe.oldLogoUrl))try{await DU(xe.oldLogoUrl),M.info("Ancien logo supprimé")}catch(_r){M.warn("Erreur lors de la suppression de l'ancien logo:",_r)}}catch(Xe){throw M.error("Erreur lors de l'upload du logo:",Xe),new Error("Erreur lors de l'upload du logo: "+Xe.message)}finally{N.value=!1}await vU(xe.seasonId,Dt);const bn=e.value.findIndex(Xe=>Xe.id===xe.seasonId);bn!==-1&&(Dt.name&&(e.value[bn].name=xe.newName),Dt.description!==void 0&&(e.value[bn].description=xe.newDescription),Dt.logoUrl&&(e.value[bn].logoUrl=Dt.logoUrl)),M.info("Saison modifiée avec succès",{seasonId:xe.seasonId,oldName:xe.oldName,newName:xe.newName,oldDescription:xe.oldDescription,newDescription:xe.newDescription});break;default:M.warn("Type d'opération non reconnu",{type:W})}}catch(it){M.error("Erreur lors de l'exécution de l'opération",it),alert("Erreur lors de l'opération. Veuillez réessayer.")}}function rt(){ae.value=!0}function gt(){V.value=!0}function fn(){ae.value=!1}function Xt(){ae.value=!1,Go()}function Kt(){V.value=!1,Go()}function Vt(){P.value=!0}function yr(){P.value=!1}function br(){S.value=!0}function pn(){S.value=!1}function Yn(){$.value=!0}function Rs(){$.value=!1}function oi(){M.debug("Gestion de joueur demandée")}async function Ko(){try{await Ve.signOut(),P.value=!1;try{En.clearSession(),M.info("Session PIN effacée à la déconnexion")}catch(de){M.warn("Erreur lors de l'effacement de la session PIN:",de)}M.info("Utilisateur déconnecté avec succès")}catch(de){M.error("Erreur lors de la déconnexion",de),alert("Erreur lors de la déconnexion. Veuillez réessayer.")}}async function Go(){try{const de=await vP();if(de){r.push(`/season/${de}`);return}}catch(de){M.warn("Impossible de récupérer la saison préférée",de)}ke()}return In(()=>(La(),()=>{})),Pt(()=>r.currentRoute.value.path,async de=>{var W;if(de==="/"&&(La(),e.value.length===0&&!t.value)){t.value=!0;try{e.value=await Fl(),M.info("Saisons rechargées lors du changement de route",{count:((W=e.value)==null?void 0:W.length)||0})}catch(xe){M.error("Erreur lors du rechargement des saisons",xe)}finally{t.value=!1}}},{immediate:!0}),(de,W)=>{var xe,Ue,it,bt,ot,Dt,bn,Xe,_r;return k(),D("div",Gq,[ze(O9,{"is-scrolled":F.value,onOpenAccountMenu:Vt,onOpenHelp:z,onOpenNotifications:br,onOpenPlayers:Yn,onLogout:Ko,onOpenLogin:rt,onOpenAccountCreation:gt},null,8,["is-scrolled"]),d("section",Qq,[d("div",Jq,[d("div",Yq,[d("div",Xq,[W[15]||(W[15]=rr('<div class="text-center order-2 lg:order-1"><div class="hero-content-wrapper"><div class="hero-illustration relative hidden lg:block"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10 relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-pink-500/10 via-purple-500/10 to-cyan-500/10 rounded-3xl blur-xl"></div><div class="relative z-10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">HatCast - Grille des disponibilités</div></div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12 z-30"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12 z-30 flex items-center justify-center"><img src="'+PU+'" alt="Masque HatCast" class="w-10 h-10 object-contain transform rotate-12"></div></div></div></div>',1)),d("div",Zq,[W[14]||(W[14]=rr('<div class="hero-title mb-8"><h1 class="text-4xl md:text-6xl font-bold text-white mb-6 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent leading-tight"> Faites vos équipes d&#39;impro…<br>en un clin d&#39;œil </h1></div><div class="hero-subtitle mb-10"><p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl"> Plus de casse-tête pour savoir qui joue quand. Chacun indique ses dispos, <strong class="text-white">HatCast compose l&#39;équipe pour vous</strong>, équitablement et sans tension. </p></div>',2)),d("div",eB,[d("div",tB,[d("button",{onClick:W[0]||(W[0]=ut=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-5 px-10 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez "),d("button",{onClick:z,class:"inline-flex items-center gap-2 text-cyan-300 hover:text-cyan-200 font-medium py-3 px-6 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 border border-cyan-500/30 hover:border-cyan-400/50"},W[12]||(W[12]=[d("span",null,"ℹ️",-1),lt(" En savoir plus ")]))])]),d("div",{class:"hero-hint text-center"},[d("button",{onClick:ke,class:"inline-flex items-center gap-2 text-gray-400 hover:text-cyan-300 transition-all duration-300 text-sm cursor-pointer group"},W[13]||(W[13]=[d("span",{class:"group-hover:animate-bounce"},"↓",-1),d("span",null,"Vos saisons ci-dessous",-1),d("span",{class:"group-hover:animate-bounce"},"↓",-1)]))])])])])]),W[16]||(W[16]=d("div",{class:"hero-background absolute inset-0 z-0"},[d("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),d("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),d("section",nB,[d("div",rB,[W[34]||(W[34]=d("div",{class:"text-center mb-12"},[d("h2",{class:"text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Saisons en cours "),d("p",{class:"text-xl text-gray-300 max-w-2xl mx-auto"}," Sélectionnez une saison pour gérer les disponibilités et équipes. ")],-1)),d("div",{class:"pb-16","aria-busy":t.value},[t.value?(k(),D("div",iB,[(k(),D(wt,null,qr(8,ut=>d("div",{key:"skeleton-"+ut,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8 w-full max-w-sm"},W[17]||(W[17]=[d("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),d("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),d("div",{class:"h-px bg-white/10 mb-4"},null,-1),d("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(k(),D("div",oB,[(k(!0),D(wt,null,qr(U.value,(ut,_n)=>{var wr,Mr;return k(),D("div",{key:ut.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20 w-full max-w-sm"},[d("div",{onClick:Un=>O(ut.slug),class:"text-center cursor-pointer"},[d("div",lB,[ut.logoUrl?(k(),D("img",{key:0,src:ut.logoUrl,alt:`Logo de ${ut.name}`,class:"w-full h-full object-cover"},null,8,cB)):(k(),D("span",uB,"🎭"))]),d("h2",dB,ie(ut.name),1),ut.description?(k(),D("p",hB,ie(ut.description),1)):se("",!0),W[20]||(W[20]=d("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),d("div",fB,[d("div",pB,[d("div",mB,ie(((wr=ut.events)==null?void 0:wr.length)||0),1),W[18]||(W[18]=d("div",{class:"text-gray-400 text-xs"},"Événements",-1))]),d("div",gB,[d("div",vB,ie(((Mr=ut.players)==null?void 0:Mr.length)||0),1),W[19]||(W[19]=d("div",{class:"text-gray-400 text-xs"},"Personnes",-1))])])],8,aB),d("div",yB,[d("div",{class:"relative",onClick:W[1]||(W[1]=At(()=>{},["stop"]))},[d("button",{onClick:Un=>pt(_n),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===_n,"aria-haspopup":"true",title:"Options"},W[21]||(W[21]=[d("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,bB),s.value===_n?(k(),D("div",_B,[d("button",{onClick:Un=>{On(ut),ct()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},W[22]||(W[22]=[d("span",null,"📊",-1),lt(" Exporter CSV ")]),8,wB),W[27]||(W[27]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Un=>R(_n),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},W[23]||(W[23]=[d("span",null,"⬆️",-1),lt(" Avancer ")]),8,xB),d("button",{onClick:Un=>L(_n),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},W[24]||(W[24]=[d("span",null,"⬇️",-1),lt(" Reculer ")]),8,EB),W[28]||(W[28]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Un=>Ct(ut),class:"w-full text-left px-4 py-2 text-sm text-blue-300 hover:bg-white/10 flex items-center gap-2",role:"menuitem"},W[25]||(W[25]=[d("span",null,"✏️",-1),lt(" Modifier ")]),8,IB),W[29]||(W[29]=d("div",{class:"border-t border-white/10 my-1"},null,-1)),d("button",{onClick:Un=>Ie(ut),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2",role:"menuitem"},W[26]||(W[26]=[d("span",null,"🗑️",-1),lt(" Supprimer ")]),8,TB)])):se("",!0)])])])}),128))])):se("",!0),d("div",SB,[d("button",{onClick:W[2]||(W[2]=ut=>i.value=!0),class:"inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl text-lg hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-pink-500/25"},W[30]||(W[30]=[d("span",null,"➕",-1),lt(" Nouvelle saison ")]))]),!t.value&&e.value.length===0?(k(),D("div",AB,[W[31]||(W[31]=d("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-4xl"},"🎪")],-1)),W[32]||(W[32]=d("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),W[33]||(W[33]=d("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),d("button",{onClick:W[3]||(W[3]=ut=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):se("",!0)],8,sB)])]),i.value?(k(),D("div",PB,[d("div",CB,[W[41]||(W[41]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),d("div",RB,[W[35]||(W[35]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),at(d("input",{"onUpdate:modelValue":W[4]||(W[4]=ut=>l.value=ut),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:H},null,544),[[Ot,l.value]])]),d("div",kB,[W[36]||(W[36]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),at(d("input",{"onUpdate:modelValue":W[5]||(W[5]=ut=>c.value=ut),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Ot,c.value]])]),d("div",DB,[W[37]||(W[37]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),at(d("textarea",{"onUpdate:modelValue":W[6]||(W[6]=ut=>f.value=ut),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Ot,f.value]]),W[38]||(W[38]=d("p",{class:"text-xs text-gray-400 mt-1"},"Une brève description de votre saison",-1))]),d("div",NB,[W[39]||(W[39]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),at(d("input",{"onUpdate:modelValue":W[7]||(W[7]=ut=>h.value=ut),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:fe},null,544),[[Ot,h.value]]),W[40]||(W[40]=d("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),d("div",OB,[d("button",{onClick:me,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:oe,disabled:!l.value.trim()||!c.value.trim()||!h.value.trim()||h.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,VB)])])])):se("",!0),o.value?(k(),D("div",MB,[d("div",LB,[d("div",$B,[W[42]||(W[42]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"⚠️")],-1)),W[43]||(W[43]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",FB,'Êtes-vous sûr de vouloir supprimer la saison "'+ie((xe=w.value)==null?void 0:xe.name)+'" ?',1)]),W[44]||(W[44]=d("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:ee,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:we,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):se("",!0),a.value?(k(),D("div",UB,[d("div",jB,[d("div",qB,[W[45]||(W[45]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"✏️")],-1)),W[46]||(W[46]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Modifier la saison",-1)),d("p",BB,'Modifiez les informations de la saison "'+ie((Ue=T.value)==null?void 0:Ue.name)+'"',1)]),d("div",zB,[W[47]||(W[47]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),at(d("input",{"onUpdate:modelValue":W[8]||(W[8]=ut=>p.value=ut),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026"},null,512),[[Ot,p.value]])]),d("div",HB,[W[48]||(W[48]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description (optionnel)",-1)),at(d("textarea",{"onUpdate:modelValue":W[9]||(W[9]=ut=>v.value=ut),rows:"3",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400 resize-none",placeholder:"Ex: Saison 2025-2026 de la troupe d'improvisation La Malice"},null,512),[[Ot,v.value]])]),d("div",WB,[W[49]||(W[49]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Logo de la troupe (optionnel)",-1)),_.value||(it=T.value)!=null&&it.logoUrl?(k(),D("div",KB,[d("div",GB,[d("img",{src:_.value||((bt=T.value)==null?void 0:bt.logoUrl),alt:`Logo de ${(ot=T.value)==null?void 0:ot.name}`,class:"w-full h-full object-cover"},null,8,QB)]),_.value||(Dt=T.value)!=null&&Dt.logoUrl?(k(),D("button",{key:0,onClick:qe,type:"button",class:"text-xs text-red-400 hover:text-red-300 transition-colors"}," Supprimer le logo ")):se("",!0)])):se("",!0),d("div",{class:$t(["border-2 border-dashed rounded-lg p-6 text-center transition-all duration-300",N.value?"border-blue-500 bg-blue-900/20 animate-pulse":"border-gray-600 hover:border-gray-500"])},[d("input",{ref:"logoFileInput",type:"file",accept:"image/*",onChange:Oe,class:"hidden"},null,544),d("button",{onClick:mt,type:"button",disabled:N.value,class:"text-gray-300 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[N.value?(k(),D("div",YB,"⏳")):(k(),D("div",XB,"📷")),d("div",ZB,[N.value?(k(),D("span",e8," Upload en cours... ")):!_.value&&!((bn=T.value)!=null&&bn.logoUrl)?(k(),D("span",t8," Cliquez pour ajouter un logo ")):(k(),D("span",n8," Cliquez pour changer le logo "))]),N.value?se("",!0):(k(),D("div",r8," PNG, JPG, GIF (max 5MB) "))],8,JB)],2)]),W[51]||(W[51]=d("p",{class:"mb-6 text-sm text-blue-400 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20"}," ℹ️ Le slug de l'URL restera inchangé pour préserver les liens existants. ",-1)),d("div",s8,[d("button",{onClick:Ze,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ce,disabled:!p.value.trim()||p.value.trim()===((Xe=T.value)==null?void 0:Xe.name)&&v.value===(((_r=T.value)==null?void 0:_r.description)||"")&&!x.value||N.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"},[N.value?(k(),D("span",o8,W[50]||(W[50]=[d("span",{class:"animate-spin"},"⏳",-1),lt(" Upload en cours... ")]))):(k(),D("span",a8,"Modifier"))],8,i8)])])])):se("",!0),ze(EP,{show:I.value,message:ge(),error:ne.value,"session-info":Qe(),onSubmit:ye,onCancel:Re},null,8,["show","message","error","session-info"]),W[52]||(W[52]=rr('<section class="help-section py-20 bg-gradient-to-br from-gray-900/50 to-gray-800/50 border-t border-white/10"><div class="container mx-auto px-4"><div class="max-w-6xl mx-auto"><div class="text-center mb-16"><h2 class="text-4xl md:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"> Qu&#39;est-ce que HatCast ? </h2><p class="text-xl text-purple-300 max-w-3xl mx-auto"> L&#39;appli pour sélectionner vos équipes d&#39;impro simplement, équitablement et sans prise de tête </p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16"><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-pink-500/20 to-purple-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-pink-500/30"><span class="text-4xl">🎭</span></div><h3 class="text-xl font-bold text-white mb-3">Gestion des saisons</h3><p class="text-gray-300 text-sm leading-relaxed"> Déclarez tous vos spectacles et indiquez combien de personnes vous aurez besoin. Organisez votre saison d&#39;impro de A à Z. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-purple-500/20 to-cyan-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-purple-500/30"><span class="text-4xl">📅</span></div><h3 class="text-xl font-bold text-white mb-3">Sondage de disponibilités</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez des sondages pour vos événements. Chaque personne indique ses disponibilités et HatCast optimise la composition des équipes. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-cyan-500/20 to-pink-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-cyan-500/30"><span class="text-4xl">🎲</span></div><h3 class="text-xl font-bold text-white mb-3">Sélection auto ou manuelle</h3><p class="text-gray-300 text-sm leading-relaxed"> Laissez le hasard pondéré décider ou reprenez la main à tout moment. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-green-500/20 to-blue-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-green-500/30"><span class="text-4xl">📱</span></div><h3 class="text-xl font-bold text-white mb-3">Pensé pour le mobile</h3><p class="text-gray-300 text-sm leading-relaxed"> Utilisez HatCast facilement sur smartphone ou tablette, où que vous soyez. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-blue-500/20 to-indigo-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-blue-500/30"><span class="text-4xl">🔐</span></div><h3 class="text-xl font-bold text-white mb-3">Comptes facultatifs</h3><p class="text-gray-300 text-sm leading-relaxed"> Créez un compte pour recevoir des rappels et sécuriser vos infos. </p></div><div class="text-center p-6 bg-gradient-to-br from-gray-800/50 to-gray-700/50 rounded-2xl border border-white/10"><div class="w-20 h-20 bg-gradient-to-br from-emerald-500/20 to-teal-600/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-emerald-500/30"><span class="text-4xl">🔔</span></div><h3 class="text-xl font-bold text-white mb-3">Notifications intelligentes</h3><p class="text-gray-300 text-sm leading-relaxed"> Recevez des alertes par email et push pour les événements et sélections. Restez informé sans être submergé. </p></div></div></div></div></section><footer class="border-t border-white/10 bg-gradient-to-br from-gray-950 to-black"><div class="container mx-auto px-4 py-12"><div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8"><div><div class="flex items-center gap-3 mb-4"><div class="relative w-32 h-8"><img src="'+uv+'" alt="Logo HatCast" class="w-full h-full brightness-0 invert"></div></div><p class="text-gray-300 text-sm leading-relaxed max-w-md"> L&#39;appli pour sélectionner vos équipes d&#39;impro simplement, équitablement et sans prise de tête. </p></div><div><h4 class="text-white font-semibold mb-4 text-sm uppercase tracking-wider">Feedback</h4><div class="space-y-2"><a href="https://github.com/plamarque/hatcast/issues" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🐛 Signaler un bug </a><a href="https://github.com/plamarque/hatcast" target="_blank" rel="noopener noreferrer" class="block text-gray-300 hover:text-blue-300 transition-colors text-sm"> 🔗 Code source </a></div></div></div><div class="text-center text-xs text-gray-500 pt-6"><span>© Patrice Lamarque 2025</span></div></div></footer>',2)),ze(TP,{show:ae.value,onClose:fn,onSuccess:Xt,onOpenAccountCreation:W[10]||(W[10]=ut=>V.value=!0)},null,8,["show"]),ze(SP,{show:V.value,onClose:W[11]||(W[11]=ut=>V.value=!1),onSuccess:Kt},null,8,["show"]),ze(JP,{show:P.value,onClose:yr,onLogoutDevice:Ko},null,8,["show"]),ze(YP,{show:S.value,onClose:pn},null,8,["show"]),ze(XP,{show:$.value,onClose:Rs,onManagePlayer:oi},null,8,["show"])])}}};function c8(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//HatCast//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impropick.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function u8(n,e=""){const t=c8(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function d8(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",sf:"true",output:"xml"}).toString()}`}function h8(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"HatCast",allday:"false"}).toString()}`}function f8(n,e=""){const t=d8(n,e);window.open(t,"_blank")}function p8(n,e=""){const t=h8(n,e);window.open(t,"_blank")}function m8(n,e,t=""){switch(n){case"ics":u8(e,t);break;case"google":f8(e,t);break;case"outlook":p8(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}function g8(){const n=!!localStorage.getItem("fcmToken")||!!localStorage.getItem("userEmail")||!!localStorage.getItem("authUser"),e=Notification.permission==="granted"&&!!localStorage.getItem("fcmToken");return!n&&!e}async function v8(n){try{const{auth:e}=await je(()=>Promise.resolve().then(()=>vr),void 0),{createUserWithEmailAndPassword:t}=await je(()=>import("./index.esm-253f6bce.js"),[]);try{return await(await t(e,n,"temp_check_123")).user.delete(),M.info("Email vérifié : nouveau (compte temporaire supprimé)",{email:n}),!1}catch(r){return r.code==="auth/email-already-in-use"?(M.info("Email vérifié : existant",{email:n}),!0):(M.warn("Erreur lors de la vérification de l'email, considéré comme nouveau",{email:n,error:r.code}),!1)}}catch(e){return M.error("Erreur lors de la vérification de l'email",e),!1}}async function aC({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{let o=i;try{const c=await Tt(pe(te,"seasons",n));c.exists()&&(o=c.data().title||i)}catch(c){console.warn("Impossible de récupérer le titre de la saison, utilisation du slug:",c)}const a=await Gf({seasonId:n,playerId:"notification_activation",eventId:e,action:"activate_notifications",slug:i}),l=`${n}_${e}_${r.replace(/[^a-zA-Z0-9]/g,"_")}`;return await en(pe(te,"notificationActivations",l),{seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i,magicLinkId:a.id,magicLinkUrl:a.url,requestedAt:on(),status:"pending"}),await Oj({toEmail:r,playerName:t,eventTitle:s,eventUrl:`${window.location.origin}/season/${i}/event/${e}`,activationUrl:a.url,seasonTitle:o}),M.info("Demande d'activation des notifications créée",{activationId:l,email:r,playerName:t,eventId:e}),{success:!0,activationId:l,method:"firebase_magic_link"}}catch(o){throw M.error("Erreur lors de la création de la demande d'activation",o),o}}async function y8(n){try{const e=await b8(n);if(!e)throw new Error("Données d'activation introuvables");const{verifyMagicLink:t}=await je(()=>Promise.resolve().then(()=>DP),void 0);if(!(await t({seasonId:e.seasonId,playerId:"notification_activation",eventId:e.eventId,token:n,action:"activate_notifications"})).valid)throw new Error("Magic link invalide ou expiré");const s=await lC(),i=await x8(e.email);return await cC(e.email,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await _8(e.activationId),await uC(e),M.info("Notifications activées avec succès",{email:e.email,playerName:e.playerName,pushStatus:s}),{success:!0,email:e.email,playerName:e.playerName,pushStatus:s,accountStatus:i}}catch(e){throw M.error("Erreur lors de l'activation des notifications",e),e}}async function b8(n){try{const{collection:e,query:t,where:r,getDocs:s}=await je(()=>import("./index.esm-fc00cd90.js"),[]),i=t(e(te,"notificationActivations"),r("status","==","pending")),o=await s(i);for(const a of o.docs){const l=a.data();if(l.magicLinkUrl&&l.magicLinkUrl.includes(n))return{...l,activationId:a.id}}return null}catch(e){return M.error("Erreur lors de la récupération des données d'activation",e),null}}async function lC(){try{if(!await k0())return{active:!1,reason:"not_supported"};if(await Notification.requestPermission()!=="granted")return{active:!1,reason:"permission_denied"};const e=await fP();return e?{active:!0,token:e}:{active:!1,reason:"token_failed"}}catch(n){return M.error("Erreur lors de l'activation des notifications push",n),{active:!1,reason:"error",error:n.message}}}async function cC(n,e){try{await en(pe(te,"userPreferences",n),{...e,updatedAt:on(),notificationActivatedAt:on()},{merge:!0})}catch(t){throw M.error("Erreur lors de la mise à jour des préférences",t),t}}async function _8(n){try{await cs(pe(te,"notificationActivations",n),{status:"completed",completedAt:on()})}catch(e){M.error("Erreur lors de la finalisation de l'activation",e)}}async function uC(n){try{const{collection:e,query:t,where:r,getDocs:s,setDoc:i}=await je(()=>import("./index.esm-fc00cd90.js"),[]),o=t(e(te,"playerAssociations"),r("email","==",n.email),r("seasonId","==",n.seasonId));if(!(await s(o)).empty){M.info("Association joueur-email déjà existante",{email:n.email,seasonId:n.seasonId});return}await i(pe(te,"playerAssociations",`${n.seasonId}_${n.email}`),{email:n.email,seasonId:n.seasonId,playerName:n.playerName,associatedAt:on(),source:"notification_activation"}),M.info("Joueur associé à l'email",{email:n.email,playerName:n.playerName,seasonId:n.seasonId})}catch(e){M.error("Erreur lors de l'association du joueur",e)}}async function w8({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}){try{console.log("🔔 Activation directe des notifications pour utilisateur connecté");const o=await lC();return await cC(r,{notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),await uC({seasonId:n,eventId:e,playerName:t,email:r,eventTitle:s,seasonSlug:i}),M.info("Notifications activées directement pour utilisateur connecté",{email:r,playerName:t,eventId:e,pushStatus:o}),{success:!0,email:r,playerName:t,pushStatus:o,directActivation:!0}}catch(o){throw M.error("Erreur lors de l'activation directe des notifications",o),o}}async function x8(n){try{const{auth:e}=await je(()=>Promise.resolve().then(()=>vr),void 0),{createUserWithEmailAndPassword:t,sendPasswordResetEmail:r}=await je(()=>import("./index.esm-253f6bce.js"),[]);try{const s=await t(e,n,"temp_password_123");return await r(e,n),M.info("Compte Firebase Auth créé avec succès",{email:n,uid:s.user.uid}),{created:!0,reason:"new_account_created",uid:s.user.uid,passwordResetSent:!0}}catch(s){return s.code==="auth/email-already-in-use"?(M.info("Compte Firebase Auth existant trouvé",{email:n}),{created:!1,reason:"already_exists"}):(M.error("Erreur lors de la création du compte Firebase Auth",s),{created:!1,reason:"creation_failed",error:s.message})}}catch(e){return M.error("Erreur lors de la vérification/création du compte Firebase Auth",e),{created:!1,reason:"general_error",error:e.message}}}const Yf=Object.freeze(Object.defineProperty({__proto__:null,activateNotificationsForConnectedUser:w8,checkEmailExists:v8,createNotificationActivationRequest:aC,processNotificationActivation:y8,shouldPromptForNotifications:g8},Symbol.toStringTag,{value:"Module"}));const E8={class:"space-y-4"},I8={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},T8={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},S8={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},A8={key:0,class:"space-y-3"},P8={class:"text-gray-300 text-sm mb-3"},C8={class:"text-white font-medium"},R8={class:"text-green-400 font-medium"},k8={class:"text-yellow-400 font-medium"},D8={class:"flex flex-wrap gap-2"},N8=["title"],O8={key:0,class:"text-green-400 text-xs"},V8={key:1,class:"text-yellow-400 text-xs"},M8={key:1,class:"text-amber-400 text-sm"},L8={class:"block text-sm font-medium text-gray-300 mb-2"},$8={class:"space-y-3"},F8={key:0,class:"fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-fade-in"},U8={class:"whitespace-pre-wrap font-sans"},j8={__name:"MessagePreview",props:{mode:{type:String,required:!0,validator:n=>["event","selection"].includes(n)},event:{type:Object,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},selectedPlayers:{type:Array,default:()=>[]},availabilityByPlayer:{type:Object,default:()=>({})},isSelectionConfirmedByAllPlayers:{type:Boolean,default:!1}},setup(n){const e=n,t=A(!1),r=A(!1),s=A([]),i=A([]),o=A([]),a=$e(()=>!e.event||!e.seasonSlug?"":`${window.location.origin}/season/${e.seasonSlug}/event/${e.event.id}`),l=$e(()=>{const x=i.value.map(w=>({...w,hasContact:w.id!=="ALL",missingReason:""})),_=o.value.map(w=>({...w,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...x.filter(w=>w.id!=="ALL"),..._]}),c=$e(()=>{var T,N;if(!e.event)return"";const x=p((T=e.event)==null?void 0:T.date),_=(N=e.event)==null?void 0:N.title,w=a.value;return e.mode==="event"?OP({playerName:"",eventTitle:_,eventDate:x,eventUrl:w}):e.isSelectionConfirmedByAllPlayers?LP({eventTitle:_,eventDate:x,eventUrl:w,confirmedPlayers:e.selectedPlayers}):VP({eventTitle:_,eventDate:x,eventUrl:w,selectedPlayers:e.selectedPlayers})}),f=$e(()=>c.value);function h(){navigator.clipboard.writeText(f.value),r.value=!0,setTimeout(()=>{r.value=!1},2e3)}function p(x){if(!x)return"";const _=new Date(x),w={weekday:"long",day:"numeric",month:"long",year:"numeric"};return _.toLocaleDateString("fr-FR",w)}async function v(){if(!e.seasonId)return;let x=[];e.mode==="selection"?x=e.players.filter(N=>e.selectedPlayers.includes(N.name)):x=e.players;const _=[];for(const N of x)try{const{getPlayerEmail:I}=await je(()=>Promise.resolve().then(()=>$o),void 0),j=await I(N.id,e.seasonId);j&&_.push({...N,email:j})}catch(I){console.warn(`Impossible de charger l'email pour ${N.name}:`,I)}s.value=_;const w={id:"ALL",name:"Tous"};i.value=[w,..._];const T=x.filter(N=>!_.find(I=>I.id===N.id)).map(N=>({id:N.id,name:N.name}));o.value=T}return In(()=>{v()}),Pt(()=>[e.selectedPlayers,e.availabilityByPlayer],()=>{v()},{deep:!0}),(x,_)=>(k(),D("div",E8,[d("div",null,[d("label",I8,[_[1]||(_[1]=lt(" Personnes à Prévenir ")),d("button",{onClick:_[0]||(_[0]=w=>t.value=!t.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),t.value?(k(),D("div",T8,_[2]||(_[2]=[d("p",{class:"text-blue-200 text-sm"},[lt(" Cette liste montre toutes les personnes ciblées: "),d("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),lt(" et "),d("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),lt(". Les personnes en jaune ne peuvent pas être notifiées automatiquement. Utilise le message ci-dessous pour les contacter manuellement. ")],-1)]))):se("",!0),d("div",S8,[l.value.length>0?(k(),D("div",A8,[d("div",P8,[d("span",C8,ie(l.value.length-1),1),_[3]||(_[3]=lt(" personnes à prévenir. ")),d("span",R8,ie(s.value.length),1),_[4]||(_[4]=lt(" seront notifiées, ")),d("span",k8,ie(o.value.length),1),_[5]||(_[5]=lt(" devront être prévenues manuellement. "))]),d("div",D8,[(k(!0),D(wt,null,qr(l.value.filter(w=>w.id!=="ALL"),w=>(k(),D("span",{key:w.id||w.name,class:$t(["px-3 py-1 rounded text-sm border flex items-center gap-1",w.hasContact?"bg-gray-700 border-gray-600 text-white":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 opacity-75"]),title:w.hasContact?"Peut être notifié automatiquement":"Aucun canal actif - notification manuelle requise"},[lt(ie(w.name)+" ",1),w.hasContact?(k(),D("span",O8,"✓")):(k(),D("span",V8,"⚠️"))],10,N8))),128))])])):(k(),D("div",M8," ⚠️ Aucun destinataire disponible. "))])]),d("div",null,[d("label",L8,ie(n.mode==="selection"?"Message à copier pour annoncer la sélection à tous (WhatsApp) :":"Message à copier pour les contacts manuels :"),1),d("div",$8,[r.value?(k(),D("div",F8," ✅ Copié ! ")):se("",!0),d("div",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm cursor-pointer hover:bg-gray-700 transition-colors",onClick:h,title:"Cliquer pour copier le texte"},[d("pre",U8,ie(f.value),1)])])])]))}},q8=nm(j8,[["__scopeId","data-v-a921279a"]]);const B8={class:"relative p-5 pb-4 border-b border-white/10"},z8={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},H8={class:"hidden sm:inline"},W8={key:0,class:"text-sm text-purple-300 mt-1"},K8={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},G8={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Q8={class:"flex items-center gap-2 w-full"},J8=["disabled"],Y8={key:0},X8={key:1,class:"inline-flex items-center gap-2"},Z8={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})},isSelectionConfirmedByAllPlayers:{type:Boolean,default:!1}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e,s=$e(()=>t.sending);function i(){r("close")}function o(){return t.mode==="selection"?t.isSelectionConfirmedByAllPlayers?"Annoncer l'équipe":"Annoncer la sélection":"Confirmer l'événement"}function a(c){var h;return c?(typeof c=="string"?new Date(c):((h=c.toDate)==null?void 0:h.call(c))||c).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}async function l(){if(t.event)try{r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:t.mode==="selection"?"selection":"event",selectedPlayers:t.selectedPlayers,scope:"all"})}catch(c){console.error("Erreur lors de l'envoi des notifications:",c),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}}return(c,f)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:i},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:f[0]||(f[0]=At(()=>{},["stop"]))},[d("div",B8,[d("button",{onClick:i,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("h2",z8,[d("span",H8,ie(n.mode==="selection"?"📣":"📢"),1),d("span",null,ie(o()),1)]),n.event?(k(),D("p",W8,ie(n.event.title)+" — "+ie(a(n.event.date)),1)):se("",!0)]),d("div",K8,[ze(q8,{mode:n.mode,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,"selected-players":n.selectedPlayers,"availability-by-player":n.availabilityByPlayer,"is-selection-confirmed-by-all-players":n.isSelectionConfirmedByAllPlayers},null,8,["mode","event","season-id","season-slug","players","selected-players","availability-by-player","is-selection-confirmed-by-all-players"])]),d("div",G8,[d("div",Q8,[d("button",{onClick:l,disabled:s.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[s.value?(k(),D("span",X8,f[2]||(f[2]=[d("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),lt(" Envoi en cours... ")]))):(k(),D("span",Y8,f[1]||(f[1]=[d("span",{class:"hidden sm:inline"},"🔔 Notifier",-1),d("span",{class:"sm:hidden"},"🔔 Notifier",-1)])))],8,J8)]),d("button",{onClick:i,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):se("",!0)}},dC=nm(Z8,[["__scopeId","data-v-cc774b27"]]),ez={class:"relative p-6 pb-4 border-b border-white/10"},tz={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},nz={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=At(()=>{},["stop"]))},[d("div",ez,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),d("p",{class:"text-sm text-purple-300"},"L'appli pour organiser vos spectacles d'improvisation de manière simple et apaisée")])],-1))]),s[5]||(s[5]=rr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> HatCast est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),d("div",tz,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):se("",!0)}},rz={class:"text-center p-4 md:p-6 pb-3 md:pb-4 border-b border-white/10"},sz={class:"text-base md:text-lg text-gray-300"},iz={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},oz={class:"mb-4 md:mb-6"},az={class:"space-y-3 md:space-y-4"},lz={class:"flex items-center gap-2 text-gray-300 text-sm"},cz={class:"mb-4 md:mb-6 text-center"},uz={key:0,class:"mb-4 p-3 md:p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},dz={class:"text-red-300 text-sm"},hz={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},fz=["disabled"],pz={key:0,class:"animate-spin"},mz={key:1},gz={class:"text-center p-4 md:p-6 pb-3 md:pb-4 border-b border-white/10"},vz={class:"text-base md:text-lg text-gray-300"},yz={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},bz={key:0,class:"mb-4 p-3 md:p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_z={class:"text-red-300 text-sm"},wz={key:1,class:"mb-4 p-3 md:p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},xz={class:"text-green-300 text-sm"},Ez={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},Iz=["disabled"],Tz={key:0,class:"animate-spin"},Sz={key:1},j0={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=A(""),i=A(!1),o=A(""),a=A(!1),l=A(""),c=A(""),f=A(null),h=A(!0);async function p(){var _;if(s.value){i.value=!0,o.value="";try{const w=await cv(t.seasonId);if(s.value===w){const N=!!((_=Ve.currentUser)!=null&&_.email);if(En.saveSession(t.seasonId,s.value,N),h.value)try{Li.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),x();return}if(await KP(t.player.id,s.value,t.seasonId)){if(h.value)try{Li.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),x()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(w){M.error("Erreur lors de la vérification",w),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function v(){i.value=!0,l.value="",c.value="";try{const _=await QP(t.player.id,t.seasonId);c.value=_.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(_){M.error("Erreur lors de l'envoi de l'email",_),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function x(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Pt(()=>t.show,_=>{_&&kt(()=>{f.value&&f.value.focus()})}),(_,w)=>{var T,N;return k(),D(wt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4",onClick:x},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh] md:max-h-none",onClick:w[3]||(w[3]=At(()=>{},["stop"]))},[d("div",rz,[w[7]||(w[7]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-2 md:mb-3 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🔐")],-1)),w[8]||(w[8]=d("h2",{class:"text-xl md:text-2xl font-bold text-white mb-1 md:mb-2"},"Vérification requise",-1)),d("p",sz,ie((T=n.player)==null?void 0:T.name),1),w[9]||(w[9]=d("p",{class:"text-xs md:text-sm text-gray-400 mt-1"},"Cette personne est protégée par mot de passe",-1))]),d("div",iz,[d("div",oz,[d("div",az,[d("div",null,[w[10]||(w[10]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de la personne",-1)),at(d("input",{"onUpdate:modelValue":w[0]||(w[0]=I=>s.value=I),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:tr(p,["enter"]),ref_key:"passwordInput",ref:f},null,544),[[Ot,s.value]])]),d("div",lz,[at(d("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":w[1]||(w[1]=I=>h.value=I),class:"w-4 h-4"},null,512),[[ts,h.value]]),w[11]||(w[11]=d("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])])]),d("div",cz,[d("button",{onClick:w[2]||(w[2]=I=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(k(),D("div",uz,[d("div",dz,ie(o.value),1)])):se("",!0)]),d("div",hz,[d("button",{onClick:x,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:p,disabled:!s.value||i.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 flex-1 text-sm md:text-base whitespace-nowrap"},[i.value?(k(),D("span",pz,"⏳")):(k(),D("span",mz,"🔓")),d("span",null,ie(i.value?"Vérification...":"Vérifier"),1)],8,fz)])])])):se("",!0),a.value?(k(),D("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[120] p-0 md:p-4",onClick:w[6]||(w[6]=I=>a.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh] md:max-h-none",onClick:w[5]||(w[5]=At(()=>{},["stop"]))},[d("div",gz,[w[12]||(w[12]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-2 md:mb-3 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"📧")],-1)),w[13]||(w[13]=d("h2",{class:"text-xl md:text-2xl font-bold text-white mb-1 md:mb-2"},"Mot de passe oublié",-1)),d("p",vz,ie((N=n.player)==null?void 0:N.name),1)]),d("div",yz,[w[14]||(w[14]=d("div",{class:"mb-4 md:mb-6"},[d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à cette personne. ")],-1)),l.value?(k(),D("div",bz,[d("div",_z,ie(l.value),1)])):se("",!0),c.value?(k(),D("div",wz,[d("div",xz,ie(c.value),1)])):se("",!0)]),d("div",Ez,[d("button",{onClick:w[4]||(w[4]=I=>a.value=!1),class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Fermer "),d("button",{onClick:v,disabled:i.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 flex-1 text-sm md:text-base whitespace-nowrap"},[i.value?(k(),D("span",Tz,"⏳")):(k(),D("span",Sz,"📧")),d("span",null,ie(i.value?"Envoi...":"Envoyer l'email"),1)],8,Iz)])])])):se("",!0)],64)}}},Az={class:"text-center mb-6"},Pz={class:"text-sm text-gray-300"},Cz={key:0,class:"space-y-4"},Rz={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},kz={key:1,class:"space-y-4"},Dz=["disabled"],Nz={key:0,class:"animate-spin"},Oz={key:1},Vz={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},Mz={class:"mt-6 flex justify-center gap-3"},Lz=["disabled"],$z={key:0,class:"animate-spin"},Fz={key:1},hC={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=A(1),i=A(""),o=A(""),a=A(""),l=A(!1),c=A(""),f=A(!1),h=Uo(),p=$e(()=>i.value&&i.value.includes("@")),v=$e(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function x(){var N,I,j;if(!(!p.value||!((N=t.player)!=null&&N.id))){l.value=!0,c.value="";try{const ne=await qP({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),ae=(I=h.params)==null?void 0:I.slug,V=`${ne.url}${ae?`&slug=${encodeURIComponent(ae)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await Cj({toEmail:i.value,playerName:((j=t.player)==null?void 0:j.name)||"personne",verifyUrl:V}),f.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function _(){try{await zP({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,f.value=!1,i.value="",o.value="",a.value=""}async function w(){var N;try{const I=await $c((N=t.player)==null?void 0:N.id,t.seasonId);I!=null&&I.email&&(I!=null&&I.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}In(()=>{w()}),Pt(()=>t.show,N=>{N&&w()});async function T(){if(v.value){l.value=!0,c.value="";try{await jP(t.player.id,i.value.trim(),o.value,t.seasonId),r("success",{email:i.value.trim(),password:o.value})}catch(N){c.value=(N==null?void 0:N.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(N,I)=>{var j;return n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:I[6]||(I[6]=ne=>N.$emit("close"))},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:I[5]||(I[5]=At(()=>{},["stop"]))},[d("button",{onClick:I[0]||(I[0]=ne=>N.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",Az,[I[7]||(I[7]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"👤")],-1)),I[8]||(I[8]=d("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),d("p",Pz,"Pour sécuriser les saisies de "+ie((j=n.player)==null?void 0:j.name),1),ze(V0)]),s.value===1?(k(),D("div",Cz,[d("div",null,[I[9]||(I[9]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),at(d("input",{"onUpdate:modelValue":I[1]||(I[1]=ne=>i.value=ne),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Ot,i.value]])]),f.value?(k(),D("div",Rz,[I[10]||(I[10]=d("span",null,"✅",-1)),d("span",null,"Un email a été envoyé à "+ie(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):se("",!0)])):s.value===2?(k(),D("div",kz,[d("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[I[11]||(I[11]=d("span",null,"✅",-1)),I[12]||(I[12]=d("span",null,"Adresse email vérifiée",-1)),d("button",{type:"button",onClick:_,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),d("div",null,[I[13]||(I[13]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),at(d("input",{"onUpdate:modelValue":I[2]||(I[2]=ne=>o.value=ne),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Ot,o.value]])]),d("div",null,[I[14]||(I[14]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),at(d("input",{"onUpdate:modelValue":I[3]||(I[3]=ne=>a.value=ne),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Ot,a.value]])]),d("button",{onClick:T,disabled:!v.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(k(),D("span",Nz,"⏳")):(k(),D("span",Oz,"🔒")),d("span",null,ie(l.value?"Association...":"Associer cette personne"),1)],8,Dz)])):se("",!0),c.value?(k(),D("div",Vz,ie(c.value),1)):se("",!0),d("div",Mz,[s.value===1?(k(),D("button",{key:0,onClick:x,disabled:!p.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(k(),D("span",$z,"⏳")):(k(),D("span",Fz,"✉️")),d("span",null,ie(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,Lz)):se("",!0),d("button",{onClick:I[4]||(I[4]=ne=>N.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):se("",!0)}}},Uz={class:"text-center mb-6"},jz={class:"text-2xl font-bold text-white mb-2"},qz={class:"mb-6"},Bz={class:"flex items-center space-x-3"},zz={class:"text-2xl"},Hz={class:"font-semibold text-white"},Wz={class:"text-sm text-gray-300"},Kz={key:0,class:"mb-6"},Gz={class:"text-sm text-gray-300"},Qz={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Jz={class:"text-red-300 text-sm"},Yz={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Xz={class:"text-green-300 text-sm"},Zz={class:"flex justify-center gap-3"},e7=["disabled"],fC={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=A(!1),i=A(!1),o=A(!1),a=A(""),l=A(""),c=A(!1);Uo();const f=A(!1);$e(()=>!1),$e(()=>!1);async function h(T){var N;if(l.value="Compte créé et personne associée !",s.value=!0,c.value=!1,T!=null&&T.email&&(T!=null&&T.password))try{localStorage.setItem("prefilledEmail",T.email);const{signInWithEmailAndPassword:I}=await je(()=>import("./index.esm-253f6bce.js"),[]),{auth:j}=await je(()=>Promise.resolve().then(()=>vr),void 0);await I(j,T.email,T.password),r("update",{action:"protection_activated",email:T.email,playerId:(N=t.player)==null?void 0:N.id}),console.log("✅ Utilisateur connecté automatiquement après activation de la protection")}catch(I){console.error("Erreur lors de la connexion automatique:",I)}r("update")}async function p(){var T;if((T=t.player)!=null&&T.id){s.value=await Ws(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:N}=await je(()=>Promise.resolve().then(()=>$o),void 0);i.value=N(t.player.id)}catch{i.value=!1}}}function v(){var T;a.value="";try{if((T=t.player)!=null&&T.id&&$a(t.player.id)){x();return}}catch{}f.value=!0}async function x(){o.value=!0,a.value="",l.value="";try{const T=await HP(t.player.id,t.seasonId);l.value="Protection désactivée!",s.value=!1,T.email&&(email.value=T.email),r("update")}catch(T){logger.error("Erreur lors de la désactivation de la protection",T),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function _(){f.value=!1,x()}function w(){r("close")}return Pt(()=>t.player,()=>{t.show&&t.player&&p()},{immediate:!0}),Pt(()=>t.show,T=>{T&&t.player&&(a.value="",l.value="",f.value=!1,p(),t.onboarding&&kt(()=>{}))}),(T,N)=>{var I,j,ne,ae;return k(),D(wt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:w},[d("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:N[1]||(N[1]=At(()=>{},["stop"]))},[d("button",{onClick:w,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),d("div",Uz,[N[4]||(N[4]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🔒")],-1)),d("h2",jz,ie(s.value?"Désactiver la protection":"Protège tes saisies"),1)]),d("div",qz,[d("div",{class:$t(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[d("div",Bz,[d("span",zz,ie(s.value?"🔒":"🔓"),1),d("div",null,[d("div",Hz,ie(s.value?i.value?`${(I=n.player)==null?void 0:I.name} est associée à votre compte`:`${(j=n.player)==null?void 0:j.name} est associée à un compte utilisateur`:`${(ne=n.player)==null?void 0:ne.name} n'a pas de compte`),1),d("div",Wz,ie(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier ses disponibilités 😱"),1)])])],2)]),s.value?se("",!0):(k(),D("div",Kz,[d("div",Gz,"Si tu es bien "+ie((ae=n.player)==null?void 0:ae.name)+", tu peux protéger tes saisies à l'aide d'un compte utilisateur.",1)])),a.value?(k(),D("div",Qz,[d("div",Jz,ie(a.value),1)])):se("",!0),l.value?(k(),D("div",Yz,[d("div",Xz,ie(l.value),1)])):se("",!0),d("div",Zz,[s.value?(k(),D("button",{key:1,onClick:v,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Continuer ",8,e7)):(k(),D("button",{key:0,onClick:N[0]||(N[0]=V=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," C'est moi ! ")),d("button",{onClick:w,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):se("",!0),ze(hC,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:N[2]||(N[2]=V=>c.value=!1),onSuccess:h},null,8,["show","player","season-id"]),ze(j0,{show:f.value,player:n.player,seasonId:n.seasonId,onClose:N[3]||(N[3]=V=>f.value=!1),onVerified:_},null,8,["show","player","seasonId"])],64)}}};const t7={class:"relative p-4 md:p-6 border-b border-white/10"},n7={class:"flex items-start gap-4 md:gap-6"},r7={class:"flex-1 min-w-0"},s7={class:"flex items-center gap-3 mb-2"},i7={class:"text-xl md:text-2xl font-bold text-white leading-tight"},o7={class:"flex items-center gap-2"},a7={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},l7={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},c7={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},u7={class:"grid grid-cols-3 gap-3 md:gap-4"},d7={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},h7={class:"text-xl md:text-2xl font-bold text-white"},f7={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},p7={class:"text-xl md:text-2xl font-bold text-white"},m7={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},g7={class:"text-xl md:text-2xl font-bold text-white"},v7={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},y7={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},b7={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},_7={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},w7={class:"mb-6"},x7={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=A(!1),o=A(""),a=A(null),l=A(!1),c=A(!1),f=A(null);A(!1);const h=A(!1),p=A(!1),v=A(null),x=A(null),_=A({position:"fixed",top:"0px",left:"0px"}),w=A(null),T=A({position:"fixed",top:"0px",left:"0px"}),N=A(!1),I=A(!1);function j(){s("close"),h.value=!1,p.value=!1,_.value={position:"fixed",top:"0px",left:"0px"},T.value={position:"fixed",top:"0px",left:"0px"}}function ne(){var ce;o.value=((ce=r.player)==null?void 0:ce.name)||"",i.value=!0,kt(()=>{a.value&&a.value.focus()})}function ae(){i.value=!1,o.value=""}async function V(){var z,ke;if(!o.value.trim())return;if(await Ws((z=r.player)==null?void 0:z.id,r.seasonId)){$a((ke=r.player)==null?void 0:ke.id)?P():(f.value="update",c.value=!0);return}P()}function P(){var ce;s("update",{playerId:(ce=r.player)==null?void 0:ce.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function S(){var z,ke;if(await Ws((z=r.player)==null?void 0:z.id,r.seasonId)){$a((ke=r.player)==null?void 0:ke.id)?$():(f.value="delete",c.value=!0);return}$()}function $(){var ce;s("delete",(ce=r.player)==null?void 0:ce.id)}function F(){s("refresh")}function U(ce){f.value==="update"?P():f.value==="delete"&&$(),f.value=null}function O(){try{const ce=v.value;if(!ce)return;const z=ce.getBoundingClientRect(),ke=8;if(window.innerWidth>768){const Oe=Math.max(ke,Math.round(z.top-ke)),qe=Math.max(ke,Math.round(z.left));_.value={position:"fixed",top:`${Oe}px`,left:`${qe}px`,zIndex:400}}else{const Oe=Math.min(window.innerHeight-ke,Math.round(z.bottom+ke)),qe=Math.max(ke,Math.round(z.left));_.value={position:"fixed",top:`${Oe}px`,left:`${qe}px`,zIndex:400}}}catch{}}function pt(){try{const Oe=Math.max(8,window.innerHeight-8-48-120),qe=Math.max(8,Math.round(window.innerWidth-200-8));T.value={position:"fixed",top:`${Oe}px`,left:`${qe}px`,zIndex:400}}catch{}}function ct(){h.value=!h.value,h.value&&kt(()=>O())}function Ct(){p.value=!p.value,p.value&&kt(()=>pt())}Pt(()=>r.show,ce=>{var z;ce||(i.value=!1,o.value="",f.value=null,l.value=!1,h.value=!1,p.value=!1),ce&&((z=r.player)!=null&&z.id)&&(Ws(r.player.id,r.seasonId).then(ke=>{N.value=!!ke}),je(()=>Promise.resolve().then(()=>$o),void 0).then(ke=>{try{I.value=!!ke.isPlayerPasswordCached(r.player.id)}catch{I.value=!1}}))}),In(()=>{document.addEventListener("click",ce=>{if(h.value){const z=v.value,ke=x.value,Oe=z&&z.contains(ce.target),qe=ke&&ke.contains(ce.target);!Oe&&!qe&&(h.value=!1)}if(p.value){const z=w.value;z&&z.contains(ce.target)||(p.value=!1)}}),document.addEventListener("keydown",ce=>{ce.key==="Escape"&&(h.value&&(h.value=!1),p.value&&(p.value=!1))}),window.addEventListener("resize",()=>{h.value&&O(),p.value&&pt()}),window.addEventListener("scroll",()=>{h.value&&O(),p.value&&pt()},{passive:!0})}),e({openProtection(){l.value=!0}});const Ze=A({position:null});return Pt(()=>r.show,ce=>{ce&&r.onboardingStep===4?kt(()=>{const z=document.querySelectorAll("button");let ke=null;if(z.forEach(Oe=>{!ke&&Oe.textContent&&Oe.textContent.includes("Protection")&&(ke=Oe)}),ke){const Oe=ke.getBoundingClientRect();Ze.value.position={x:Math.round(Oe.right+8),y:Math.round(Oe.top+window.scrollY-4)}}}):ce||(Ze.value.position=null)}),(ce,z)=>{var ke;return k(),D(wt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:j},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:z[6]||(z[6]=At(()=>{},["stop"]))},[d("div",t7,[d("button",{onClick:j,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",n7,[z[15]||(z[15]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"👤")],-1)),d("div",r7,[d("div",s7,[d("h2",i7,ie((ke=n.player)==null?void 0:ke.name),1),d("div",o7,[n.isProtected?(k(),D("div",a7,z[13]||(z[13]=[d("span",{class:"text-yellow-400 text-sm"},"🔒",-1),d("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):se("",!0),n.isPreferred?(k(),D("div",l7,z[14]||(z[14]=[d("span",{class:"text-purple-400 text-sm"},"⭐",-1),d("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):se("",!0)])])])])]),d("div",c7,[d("div",null,[d("div",u7,[d("div",d7,[d("div",h7,ie(r.stats.availability),1),z[16]||(z[16]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),d("div",f7,[d("div",p7,ie(r.stats.selection),1),z[17]||(z[17]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),d("div",m7,[d("div",g7,ie(r.stats.ratio),1),z[18]||(z[18]=d("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),d("div",v7,[d("button",{onClick:z[0]||(z[0]=Oe=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[d("span",null,ie(N.value?"🔓":"🔒"),1),d("span",null,ie(N.value?"Désactiver la protection":"Protéger"),1)]),d("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:v},[d("button",{onClick:z[1]||(z[1]=Oe=>ct()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},z[19]||(z[19]=[d("span",null,"⋯",-1)]))],512),d("button",{onClick:j,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(k(),ns(ed,{to:"body"},[h.value?(k(),D("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:x,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Ur(_.value)},[d("button",{onClick:z[2]||(z[2]=Oe=>{ne(),h.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},z[20]||(z[20]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:z[3]||(z[3]=Oe=>{S(),h.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},z[21]||(z[21]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):se("",!0)]))])]),d("div",y7,[d("button",{onClick:z[4]||(z[4]=Oe=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ie(N.value?"🔓 Désactiver la protection":"🔒 Protéger"),1),d("button",{onClick:z[5]||(z[5]=Oe=>Ct()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),d("button",{onClick:j,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):se("",!0),(k(),ns(ed,{to:"body"},[p.value?(k(),D("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:w,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Ur(T.value)},[d("button",{onClick:z[7]||(z[7]=Oe=>{ne(),p.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},z[22]||(z[22]=[d("span",null,"✏️",-1),d("span",null,"Renommer",-1)])),d("button",{onClick:z[8]||(z[8]=Oe=>{S(),p.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},z[23]||(z[23]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):se("",!0)])),i.value?(k(),D("div",b7,[d("div",_7,[z[25]||(z[25]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer la personne",-1)),d("div",w7,[z[24]||(z[24]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),at(d("input",{"onUpdate:modelValue":z[9]||(z[9]=Oe=>o.value=Oe),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[tr(ae,["esc"]),tr(V,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Ot,o.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:ae,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:V,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):se("",!0),ze(fC,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:z[10]||(z[10]=Oe=>l.value=!1),onUpdate:F,onOnboardingFinished:z[11]||(z[11]=Oe=>ce.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),ze(j0,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:z[12]||(z[12]=Oe=>c.value=!1),onVerified:U},null,8,["show","player","seasonId"])],64)}}},E7=nm(x7,[["__scopeId","data-v-d7d3cb35"]]),I7={class:"relative p-6 pb-4 border-b border-white/10"},T7={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},S7={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=At(()=>{},["stop"]))},[d("div",I7,[d("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=d("div",{class:"flex items-center gap-3"},[d("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),d("div",null,[d("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),d("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=rr('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les personnes <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Toutes les personnes marquées « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),d("div",T7,[d("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):se("",!0)}},A7=["title"],gv={__name:"SelectionStatusBadge",props:{status:{type:String,required:!0,validator:n=>["complete","pending_confirmation","confirmed","incomplete","insufficient","ready"].includes(n)},show:{type:Boolean,default:!0},clickable:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},emits:["click"],setup(n,{emit:e}){const t=n,r=$e(()=>{let c="border";switch(t.clickable&&(c+=" cursor-pointer hover:bg-opacity-30 group"),t.status){case"complete":return`${c} bg-green-500/20 border-green-400/30 ${t.clickable?"hover:bg-green-500/30":""}`;case"pending_confirmation":return`${c} bg-orange-500/20 border-orange-400/30 ${t.clickable?"hover:bg-orange-500/30":""}`;case"confirmed":return`${c} bg-purple-500/20 border-purple-400/30 ${t.clickable?"hover:bg-purple-500/30":""}`;case"incomplete":return`${c} bg-yellow-500/20 border-yellow-400/30 ${t.clickable?"hover:bg-yellow-500/30":""}`;case"insufficient":return`${c} bg-red-500/20 border-red-400/30 ${t.clickable?"hover:bg-red-500/30":""}`;case"ready":return`${c} bg-blue-500/20 border-blue-400/30 ${t.clickable?"hover:bg-blue-500/30":""}`;default:return`${c} bg-gray-500/20 border-gray-400/30 ${t.clickable?"hover:bg-gray-500/30":""}`}}),s=$e(()=>{const c="font-medium";switch(t.status){case"complete":return`${c} text-green-300 ${t.clickable?"group-hover:text-green-200":""}`;case"pending_confirmation":return`${c} text-orange-300 ${t.clickable?"group-hover:text-orange-200":""}`;case"confirmed":return`${c} text-purple-300 ${t.clickable?"group-hover:text-purple-200":""}`;case"incomplete":return`${c} text-yellow-300 ${t.clickable?"group-hover:text-yellow-200":""}`;case"insufficient":return`${c} text-red-300 ${t.clickable?"group-hover:text-red-200":""}`;case"ready":return`${c} text-blue-300 ${t.clickable?"group-hover:text-blue-200":""}`;default:return`${c} text-gray-300 ${t.clickable?"group-hover:text-gray-200":""}`}}),i=$e(()=>{const c="font-medium";switch(t.status){case"complete":return`${c} text-green-200 ${t.clickable?"group-hover:text-green-100":""}`;case"pending_confirmation":return`${c} text-orange-200 ${t.clickable?"group-hover:text-orange-100":""}`;case"confirmed":return`${c} text-purple-200 ${t.clickable?"group-hover:text-purple-100":""}`;case"incomplete":return`${c} text-yellow-200 ${t.clickable?"group-hover:text-yellow-100":""}`;case"insufficient":return`${c} text-red-200 ${t.clickable?"group-hover:text-red-100":""}`;case"ready":return`${c} text-blue-200 ${t.clickable?"group-hover:text-blue-100":""}`;default:return`${c} text-gray-200 ${t.clickable?"group-hover:text-gray-100":""}`}}),o=$e(()=>{switch(t.status){case"complete":return"✅";case"pending_confirmation":return"⏳";case"confirmed":return"🎯";case"incomplete":return"⚠️";case"insufficient":return"❌";case"ready":return"🎲";default:return"❓"}}),a=$e(()=>{switch(t.status){case"complete":return"Complète";case"pending_confirmation":return"À confirmer";case"confirmed":return"Confirmée";case"incomplete":return"Incomplète";case"insufficient":return"Manque";case"ready":return"Prêt";default:return"Inconnu"}}),l=$e(()=>{switch(t.status){case"complete":return"Sélection complète (non confirmée)";case"pending_confirmation":return"Sélection à confirmer - En attente de confirmation des personnes";case"confirmed":return"Sélection confirmée - Toutes les personnes ont confirmé";case"incomplete":return"Sélection incomplète - Problèmes détectés";case"insufficient":return"Pas assez de personnes disponibles";case"ready":return"Prêt pour la sélection";default:return"Statut inconnu"}});return(c,f)=>n.show?(k(),D("div",{key:0,class:$t(["px-2 py-1 rounded-md border text-[11px] md:text-xs flex items-center gap-1 transition-colors duration-200",r.value]),title:l.value,onClick:f[0]||(f[0]=h=>c.$emit("click",h))},[d("span",{class:$t(s.value)},ie(o.value),3),d("span",{class:$t(i.value)},ie(a.value),3)],10,A7)):se("",!0)}},P7={class:"relative p-4 md:p-6 border-b border-white/10"},C7={class:"flex items-start gap-4 md:gap-6"},R7={class:"flex-1 min-w-0"},k7={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},D7={class:"flex items-center gap-3"},N7={class:"text-base md:text-lg text-purple-300"},O7={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},V7={class:"text-blue-200"},M7={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},L7={key:2,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de personnes disponibles"},$7={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},F7={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},U7={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},j7={class:"text-xl md:text-2xl font-bold text-yellow-300"},q7={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},B7={class:"text-xl md:text-2xl font-bold text-white"},z7={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},H7={class:"text-xl md:text-2xl font-bold text-white"},W7={class:"mb-3"},K7={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},G7={key:0,class:"flex items-center justify-between gap-2"},Q7=["title"],J7={key:0,class:"text-purple-400 mr-2"},Y7={key:1,class:"text-red-400 mr-2"},X7={key:2,class:"text-orange-400 mr-2"},Z7={key:3,class:"text-purple-400 mr-2"},eH={key:4,class:"text-green-400 mr-2"},tH={key:5,class:"text-red-400 mr-2"},nH={key:6,class:"text-gray-400 mr-2"},rH=["onClick"],sH={key:1,class:"w-6 h-6"},iH={key:1,class:"flex items-center justify-center"},oH=["onChange"],aH=["value"],lH=["onClick"],cH={key:2,class:"text-white/40 text-sm"},uH={key:0,class:"mb-3 p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg"},dH={key:1,class:"mb-3 p-3 bg-orange-500/10 border border-orange-500/20 rounded-lg"},hH={key:2,class:"mb-3 p-3 bg-green-500/10 border border-green-500/20 rounded-lg"},fH={key:3,class:"mb-3"},pH={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},mH={class:"flex-1"},gH={class:"text-blue-300 text-sm font-medium"},vH={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},yH=["disabled","title"],bH={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:[Array,Object],default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},isSelectionConfirmed:{type:Boolean,default:!1},isSelectionConfirmedByOrganizer:{type:Boolean,default:!1}},emits:["close","selection","perfect","send-notifications","updateSelection","confirm-selection","unconfirm-selection"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=A(!1),o=A("Copier le message"),a=A(!1),l=A(!1),c=A(""),f=A(!1),h=A(!1),p=$e(()=>{var B;return((B=r.event)==null?void 0:B.playerCount)||6}),v=A([]),x=A(null),_=$e(()=>(r.players||[]).map(B=>B.name).filter(B=>{var G;return((G=r.playerAvailability)==null?void 0:G[B])===!0}).sort((B,G)=>B.localeCompare(G,"fr",{sensitivity:"base"})));function w(B){const G=new Set(v.value.filter(Boolean)),Ce=v.value[B];return Ce&&G.delete(Ce),_.value.filter(Ke=>!G.has(Ke))}function T(B){r.isSelectionConfirmedByOrganizer||(x.value=B)}function N(){x.value=null}async function I(B,G){var Ke;if(r.isSelectionConfirmedByOrganizer)return;const Ce=((Ke=B==null?void 0:B.target)==null?void 0:Ke.value)||"";Ce&&(v.value[G]=Ce,await ce()),x.value=null}async function j(B){r.isSelectionConfirmedByOrganizer||(v.value[B]=null,await ce())}$e(()=>(w(-1).length<p.value,""));const ne=$e(()=>Array.isArray(r.currentSelection)?r.currentSelection&&r.currentSelection.length>0:r.currentSelection&&typeof r.currentSelection=="object"?r.currentSelection.players&&r.currentSelection.players.length>0:!1);function ae(){var Ke;let B=[];Array.isArray(r.currentSelection)?B=r.currentSelection||[]:r.currentSelection&&typeof r.currentSelection=="object"&&(B=r.currentSelection.players||[]);const G=((Ke=r.event)==null?void 0:Ke.playerCount)||6,Ce=r.availableCount||0;if(B.length>0){const R=B.some(H=>!qe(H)),L=Ce<G;if(R||L)return{type:"incomplete",hasUnavailablePlayers:R,hasInsufficientPlayers:L,unavailablePlayers:B.filter(H=>!qe(H)),availableCount:Ce,requiredCount:G}}return Ce<G?{type:"insufficient",availableCount:Ce,requiredCount:G}:B.length===0?{type:"ready",availableCount:Ce,requiredCount:G}:r.isSelectionConfirmed?{type:"confirmed",availableCount:Ce,requiredCount:G}:r.isSelectionConfirmedByOrganizer?{type:"pending_confirmation",availableCount:Ce,requiredCount:G}:{type:"complete",availableCount:Ce,requiredCount:G}}const V=$e(()=>{var R;if(!ne.value)return!1;let B=[];Array.isArray(r.currentSelection)?B=r.currentSelection||[]:r.currentSelection&&typeof r.currentSelection=="object"&&(B=r.currentSelection.players||[]);const G=B.some(L=>!qe(L)),Ce=((R=r.event)==null?void 0:R.playerCount)||6,Ke=r.availableCount<Ce;return G||Ke}),P=$e(()=>!r.currentSelection||typeof r.currentSelection!="object"||!r.currentSelection.playerStatuses?!1:Object.entries(r.currentSelection.playerStatuses).some(([G,Ce])=>Ce==="declined")),S=$e(()=>{var Ce;const B=zt(),G=((Ce=r.event)==null?void 0:Ce.playerCount)||6;return B.length>=G}),$=$e(()=>S.value&&!P.value);$e(()=>{var Ke;if(!V.value)return"";let B=[];Array.isArray(r.currentSelection)?B=r.currentSelection||[]:r.currentSelection&&typeof r.currentSelection=="object"&&(B=r.currentSelection.players||[]);const G=B.filter(R=>!qe(R)),Ce=((Ke=r.event)==null?void 0:Ke.playerCount)||6;return G.length>0?G.length===1?`${G[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${G.length} personnes ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<Ce?`Seulement ${r.availableCount} personnes disponibles pour ${Ce} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de personnes à sélectionner.`:"Sélection incomplète"});function F(B){return r.currentSelection&&typeof r.currentSelection=="object"&&!Array.isArray(r.currentSelection)&&r.currentSelection.playerStatuses&&r.currentSelection.playerStatuses[B]||"pending"}function U(B){if(r.isSelectionConfirmedByOrganizer)switch(F(B)){case"confirmed":return`${B} a confirmé sa participation`;case"declined":return`${B} a décliné sa participation`;case"pending":return`${B} doit encore confirmer sa participation`;default:return B}else return qe(B)?`${B} est disponible`:mt(B)?`${B} n'est pas disponible`:`${B} - disponibilité non indiquée`}$e(()=>{if(!r.event||!ne.value)return"";let B=[];Array.isArray(r.currentSelection)?B=r.currentSelection||[]:r.currentSelection&&typeof r.currentSelection=="object"&&(B=r.currentSelection.players||[]);const G=O(r.event.date),Ce=B.join(", ");return`Sélection pour ${r.event.title} du ${G} : ${Ce}`}),Pt(()=>r.show,B=>{if(B){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",f.value=!1,a.value=!1;let G=[];Array.isArray(r.currentSelection)?G=[...r.currentSelection]:r.currentSelection&&typeof r.currentSelection=="object"&&(G=[...r.currentSelection.players||[]]);const Ce=p.value;v.value=Array.from({length:Ce},(Ke,R)=>G[R]||null),x.value=null}}),Pt([p,()=>r.currentSelection,()=>{var B;return(B=r.event)==null?void 0:B.id}],()=>{if(!r.show)return;let B=[];Array.isArray(r.currentSelection)?B=[...r.currentSelection]:r.currentSelection&&typeof r.currentSelection=="object"&&(B=[...r.currentSelection.players||[]]);const G=p.value,Ce=Array.from({length:G},(Ke,R)=>B[R]||v.value[R]||null);v.value=Ce.slice(0,G)});function O(B){var Ce;return B?(typeof B=="string"?new Date(B):((Ce=B.toDate)==null?void 0:Ce.call(B))||B).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function pt(){s("selection")}function ct(){s("perfect")}async function Ct(){try{s("confirm-selection")}catch(B){console.error("Erreur lors de la confirmation de la sélection:",B),l.value=!0,c.value="Erreur lors de la validation de la sélection",setTimeout(()=>{l.value=!1},3e3)}}async function Ze(){try{s("unconfirm-selection")}catch(B){console.error("Erreur lors de la déverrouillage de la sélection:",B),l.value=!0,c.value="Erreur lors de la déverrouillage de la sélection",setTimeout(()=>{l.value=!1},3e3)}}async function ce(){var B;if(!(!((B=r.event)!=null&&B.id)||!r.seasonId)&&!r.isSelectionConfirmedByOrganizer)try{const G=v.value.filter(Boolean);await Jf(r.event.id,G,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(G){console.error("Erreur lors de la sauvegarde automatique:",G)}}function z(){s("close")}function ke(){a.value=!0}function Oe(){h.value=!0}function qe(B){return r.playerAvailability[B]===!0}function mt(B){return r.playerAvailability[B]===!1}function zt(){return Array.isArray(r.currentSelection)?r.currentSelection:r.currentSelection&&typeof r.currentSelection=="object"?r.currentSelection.players||[]:[]}function On(B){return zt().includes(B)&&qe(B)}function Yt(B=!1,G=!1){if(f.value=B,B){const Ce=O(r.event.date),Ke=zt().join(", ");G?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ce} : ${Ke}`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ce} : ${Ke}`}else c.value='Sélection effectuée avec succès ! Cliquez sur "Valider" pour notifier les personnes.';l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function ue(){l.value=!1}e({showSuccess:Yt});function Pe(B){s("send-notifications",B)}return Pt(()=>r.sending,(B,G)=>{G&&!B&&(a.value=!1)}),(B,G)=>{var Ce,Ke,R,L;return k(),D(wt,null,[n.show?(k(),D("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:z},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:G[1]||(G[1]=At(()=>{},["stop"]))},[d("div",P7,[d("button",{onClick:z,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",C7,[G[7]||(G[7]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",R7,[d("h2",k7,"Sélection de l'équipe pour "+ie((Ce=n.event)==null?void 0:Ce.title),1),d("div",D7,[d("p",N7,ie(O((Ke=n.event)==null?void 0:Ke.date)),1),d("div",O7,[G[4]||(G[4]=d("span",{class:"text-blue-300 hidden md:inline"},"👥",-1)),d("span",V7,ie(((R=n.event)==null?void 0:R.playerCount)||6)+" personnes",1)]),ae().type==="ready"?(k(),D("div",M7,G[5]||(G[5]=[d("span",{class:"text-blue-300 text-xs hidden md:inline"},"🆕",-1),d("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):ae().type?(k(),ns(gv,{key:1,status:ae().type,show:!0,clickable:!1,class:"text-sm"},null,8,["status"])):ae().type==="insufficient"?(k(),D("div",L7,G[6]||(G[6]=[d("span",{class:"text-red-300 text-xs hidden md:inline"},"❌",-1),d("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):se("",!0)])])])]),d("div",$7,[d("div",F7,[d("div",U7,[d("div",j7,ie(Math.max((((L=n.event)==null?void 0:L.playerCount)||6)-n.selectedCount,0)),1),G[8]||(G[8]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),d("div",q7,[d("div",B7,ie(n.availableCount),1),G[9]||(G[9]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",z7,[d("div",H7,ie(n.selectedCount),1),G[10]||(G[10]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),d("div",W7,[d("div",{class:"flex items-center gap-2 mb-2"},[G[12]||(G[12]=d("h3",{class:"text-base md:text-lg font-semibold text-white"},"Équipe sélectionnée",-1)),d("button",{onClick:Oe,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},G[11]||(G[11]=[d("span",{class:"text-sm"},"❓",-1)]))]),d("div",K7,[(k(!0),D(wt,null,qr(v.value,(H,fe)=>(k(),D("div",{key:"sel-slot-"+fe,class:$t(["relative p-3 rounded-lg border text-center transition-colors",H?["bg-gradient-to-r",n.isSelectionConfirmedByOrganizer&&F(H)==="declined"?"from-red-500/20 to-orange-500/20 border-red-500/30":n.isSelectionConfirmedByOrganizer&&F(H)==="confirmed"?"from-purple-500/20 to-pink-500/20 border-purple-500/30":n.isSelectionConfirmedByOrganizer&&F(H)==="pending"?"from-orange-500/20 to-yellow-500/20 border-orange-500/30":mt(H)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":qe(H)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[H?(k(),D("div",G7,[d("div",{class:"flex-1 text-white font-medium truncate",title:U(H)},[n.isSelectionConfirmedByOrganizer&&F(H)==="confirmed"?(k(),D("span",J7,"✅")):n.isSelectionConfirmedByOrganizer&&F(H)==="declined"?(k(),D("span",Y7,"❌")):n.isSelectionConfirmedByOrganizer&&F(H)==="pending"?(k(),D("span",X7,"⏳")):On(H)?(k(),D("span",Z7,"🎭")):qe(H)?(k(),D("span",eH,"✅")):mt(H)?(k(),D("span",tH,"❌")):(k(),D("span",nH,"–")),lt(" "+ie(H),1)],8,Q7),n.isSelectionConfirmedByOrganizer?(k(),D("div",sH)):(k(),D("button",{key:0,onClick:oe=>j(fe),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer cette personne"}," × ",8,rH))])):(k(),D("div",iH,[x.value===fe?(k(),D("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:oe=>I(oe,fe),onBlur:G[0]||(G[0]=oe=>N())},[G[13]||(G[13]=d("option",{value:""},"— Choisir —",-1)),(k(!0),D(wt,null,qr(w(fe),oe=>(k(),D("option",{key:oe,value:oe},ie(oe),9,aH))),128))],40,oH)):n.isSelectionConfirmedByOrganizer?(k(),D("div",cH,"Verrouillé")):(k(),D("button",{key:1,onClick:oe=>T(fe),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter une personne"},G[14]||(G[14]=[d("span",{class:"text-lg"},"＋",-1),d("span",{class:"text-sm"},"Ajouter",-1)]),8,lH))]))],2))),128))])]),n.isSelectionConfirmedByOrganizer&&!n.isSelectionConfirmed&&!P.value?(k(),D("div",uH,G[15]||(G[15]=[d("div",{class:"flex items-center gap-2 text-blue-200 text-sm"},[d("span",null,"⏳"),d("span",null,[d("strong",null,"Sélection temporaire verrouillée :"),lt(" Les personnes sélectionnées doivent confirmer leur participation. La sélection sera définitivement confirmée une fois que toutes auront validé. Pensez à l'annoncer !")])],-1)]))):se("",!0),n.isSelectionConfirmedByOrganizer&&P.value?(k(),D("div",dH,G[16]||(G[16]=[d("div",{class:"flex items-center gap-2 text-orange-200 text-sm"},[d("span",null,"⚠️"),d("span",null,[d("strong",null,"Sélection incomplète :"),lt(" Certaines personnes ont décliné leur participation. Cliquez sur Déverrouiller pour relancer la sélection et remplacer les personnes manquantes.")])],-1)]))):se("",!0),n.isSelectionConfirmed?(k(),D("div",hH,G[17]||(G[17]=[d("div",{class:"flex items-center gap-2 text-green-200 text-sm"},[d("span",null,"✅"),d("span",null,[d("strong",null,"Sélection définitive :"),lt(" S'il y a des changements de dernière minute cliquez sur Déverrouiller pour réouvrir la sélection.")])],-1)]))):se("",!0),l.value?(k(),D("div",fH,[d("div",pH,[G[19]||(G[19]=d("div",{class:"text-blue-400 text-xl"},"✨",-1)),d("div",mH,[d("p",gH,ie(c.value),1)]),d("button",{onClick:ue,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},G[18]||(G[18]=[d("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):se("",!0)]),d("div",vH,[n.isSelectionConfirmedByOrganizer?se("",!0):(k(),D("button",{key:0,onClick:pt,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucune personne disponible":ne.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},G[20]||(G[20]=[lt(" ✨ "),d("span",{class:"hidden sm:inline"},"Sélection Auto",-1),d("span",{class:"sm:hidden"},"Auto",-1)]),8,yH)),n.isSelectionConfirmedByOrganizer?(k(),D("button",{key:1,onClick:Ze,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-red-500 to-orange-600 text-white rounded-lg hover:from-red-600 hover:to-orange-700 transition-colors duration-300 flex-1 whitespace-nowrap",title:"Déverrouiller la sélection pour permettre les modifications"},G[21]||(G[21]=[lt(" 🔓 "),d("span",{class:"hidden sm:inline"},"Déverrouiller",-1),d("span",{class:"sm:hidden"},"Déverrouiller",-1)]))):se("",!0),ne.value&&!n.isSelectionConfirmedByOrganizer?(k(),D("button",{key:2,onClick:Ct,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 flex-1 whitespace-nowrap",title:"Valider la sélection et demander confirmation aux personnes"},G[22]||(G[22]=[lt(" ⏳ "),d("span",{class:"hidden sm:inline"},"Valider",-1),d("span",{class:"sm:hidden"},"Valider",-1)]))):se("",!0),ne.value&&n.isSelectionConfirmedByOrganizer&&$.value?(k(),D("button",{key:3,onClick:ke,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap",title:"Annoncer la sélection validée par l'organisateur"},G[23]||(G[23]=[lt(" 📣 "),d("span",{class:"hidden sm:inline"},"Annoncer",-1),d("span",{class:"sm:hidden"},"Annoncer",-1)]))):se("",!0),d("button",{onClick:ct,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},G[24]||(G[24]=[d("span",{class:"hidden sm:inline"},"Fermer",-1),d("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):se("",!0),ze(dC,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":zt(),sending:n.sending,"is-selection-confirmed-by-all-players":n.isSelectionConfirmed,onClose:G[2]||(G[2]=H=>a.value=!1),onSendNotifications:Pe},null,8,["show","event","season-id","season-slug","players","selected-players","sending","is-selection-confirmed-by-all-players"]),ze(S7,{show:h.value,onClose:G[3]||(G[3]=H=>h.value=!1)},null,8,["show"])],64)}}},_H={class:"flex flex-col items-center justify-center"},wH={key:0,class:"text-center"},xH={key:1,class:"text-center"},EH={key:2,class:"text-center"},IH={key:3,class:"text-center"},TH={key:4,class:"text-center"},SH={key:5,class:"text-center text-gray-400"},AH=["title"],Jx={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},isSelectionConfirmed:{type:Boolean,default:!1},isSelectionConfirmedByOrganizer:{type:Boolean,default:!1},playerSelectionStatus:{type:String,default:"pending"},seasonId:{type:String,default:null},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle","toggleSelectionStatus"],setup(n,{emit:e}){const t=n,r=e,s=A(!1),i=$e(()=>!(t.chancePercent==null||t.isAvailable!==!0)),o=$e(()=>{if(t.disabled)return"Événement archivé — désarchivez pour modifier";if(t.isSelected&&t.isAvailable===!0)if(t.isSelectionConfirmedByOrganizer)switch(t.playerSelectionStatus){case"pending":return`${t.playerName} est sélectionné et doit confirmer sa participation • Cliquer pour changer le statut`;case"confirmed":return`${t.playerName} a confirmé sa participation • Cliquer pour changer le statut`;case"declined":return`${t.playerName} a décliné sa participation • Cliquer pour changer le statut`;default:return`${t.playerName} est sélectionné • Cliquer pour changer le statut`}else return i.value?`${t.playerName} est sélectionné et doit confirmer • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné et doit confirmer`;else return t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`});function a(){if(!t.disabled)if(t.isSelected&&t.isAvailable===!0&&t.isSelectionConfirmedByOrganizer){const c=l(t.playerSelectionStatus);r("toggleSelectionStatus",t.playerName,t.eventId,c,t.seasonId)}else r("toggle",t.playerName,t.eventId)}function l(c){switch(c){case"pending":return"confirmed";case"confirmed":return"declined";case"declined":return"pending";default:return"pending"}}return(c,f)=>(k(),D("div",{class:$t(["flex items-center justify-center transition-all duration-200 rounded font-medium text-white mx-0.5 my-0.25",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105",n.compact?"min-h-0 p-1 md:p-2 text-xs":"min-h-20 p-2 md:p-3 text-sm",n.isSelected&&n.isAvailable===!0&&n.playerSelectionStatus==="confirmed"?"bg-gradient-to-br from-purple-500/60 to-pink-500/60":"",n.isSelected&&n.isAvailable===!0&&n.playerSelectionStatus==="pending"?"bg-gradient-to-br from-orange-500/60 to-yellow-500/60":"",n.isSelected&&n.isAvailable===!0&&n.playerSelectionStatus==="declined"?"bg-gradient-to-br from-red-500/60 to-orange-500/60":"",!n.isSelected&&n.isAvailable===!0?"bg-green-500/60":"",n.isAvailable===!1?"bg-red-500/60":"",n.isAvailable===null||n.isAvailable===void 0?"bg-gray-500/40":""]]),onClick:a,onMouseenter:f[0]||(f[0]=h=>s.value=!0),onMouseleave:f[1]||(f[1]=h=>s.value=!1)},[d("div",_H,[n.isSelected&&n.isAvailable===!0&&n.playerSelectionStatus==="confirmed"?(k(),D("span",wH," Joue ")):n.isSelected&&n.isAvailable===!0&&n.playerSelectionStatus==="pending"?(k(),D("span",xH," À confirmer ")):n.isSelected&&n.isAvailable===!0&&n.playerSelectionStatus==="declined"?(k(),D("span",EH," Décliné ")):n.isAvailable===!0?(k(),D("span",IH," Disponible ")):n.isAvailable===!1?(k(),D("span",TH," Pas disponible ")):(k(),D("span",SH," – ")),i.value&&n.isAvailable===!0?(k(),D("span",{key:6,class:"text-[10px] md:text-xs px-1.5 py-0.5 rounded-full bg-emerald-500/20 border border-emerald-400/30 text-emerald-200 mt-1",title:o.value},ie(n.chancePercent)+"% ",9,AH)):se("",!0)])],34))}},PH={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},CH={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},RH={class:"text-2xl md:text-3xl font-bold text-white mb-3"},kH={class:"text-gray-300 mb-6"},DH={class:"flex flex-col items-stretch justify-center gap-3"},NH=["value"],OH={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=$e(()=>`${s}/season/${t.seasonSlug}`),o=A(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=$e(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=$e(()=>a.value>0),c=A(l.value);Pt(a,w=>{c.value=w>0});const f=$e(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre première personne";case 3:return"Vous y êtes presque! Maintenant, invitez vos personnes.";default:return""}}),h=$e(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins une personne pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function p(){c.value=!1,r("create-event")}function v(){c.value=!1,r("add-player")}function x(){var w;try{(w=navigator.clipboard)==null||w.writeText(i.value)}catch{}r("copy-link")}async function _(){try{if(t.seasonId){const{db:w}=await je(()=>Promise.resolve().then(()=>vr),void 0),{doc:T,updateDoc:N}=await je(()=>import("./index.esm-fc00cd90.js"),[]);await N(T(w,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(w,T)=>l.value&&c.value?(k(),D("div",PH,[d("div",CH,[T[1]||(T[1]=d("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[d("span",{class:"text-3xl"},"🎬")],-1)),d("h2",RH,ie(f.value),1),d("p",kH,ie(h.value),1),d("div",DH,[a.value===1?(k(),D("button",{key:0,onClick:p,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(k(),D("button",{key:1,onClick:v,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter une personne ")):a.value===3?(k(),D(wt,{key:2},[d("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:T[0]||(T[0]=N=>N.target.select())},null,40,NH),d("div",{class:"flex gap-3 justify-center"},[d("button",{onClick:x,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),d("button",{onClick:_,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):se("",!0)])])])):se("",!0)}},VH={class:"sticky top-0 z-[60] text-center py-3 md:py-6 px-2 md:px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},MH=["title"],LH={class:"absolute right-1 md:right-4 top-1/2 -translate-y-1/2 flex items-center gap-1 md:gap-2"},$H={class:"hidden md:flex items-center gap-2"},FH={class:"md:hidden"},UH={__name:"SeasonHeader",props:{seasonName:{type:String,default:""},isScrolled:{type:Boolean,default:!1},seasonSlug:{type:String,default:""}},emits:["go-back","open-account-menu","open-help","open-notifications","open-players","logout","open-login","open-account","open-account-creation"],setup(n,{emit:e}){const t=n,r=e,s=A(null),i=$e(()=>{var w;return!!s.value&&!((w=s.value)!=null&&w.isAnonymous)}),o=$e(()=>t.isScrolled?"bg-blue-600 hover:bg-blue-700 text-white border-blue-600 hover:border-blue-700":"bg-white/10 hover:bg-white/20 text-white border-white/20 hover:border-white/40");function a(){t.seasonSlug&&(window.location.href=`/season/${t.seasonSlug}`)}function l(w){s.value=w}In(()=>{s.value=Ve.currentUser;const w=Ve.onAuthStateChanged(l);window._seasonHeaderUnsubscribe=w}),Ii(()=>{window._seasonHeaderUnsubscribe&&(window._seasonHeaderUnsubscribe(),delete window._seasonHeaderUnsubscribe)});function c(){r("go-back")}function f(){r("open-account-menu")}function h(){r("open-login")}function p(){r("open-help")}function v(){r("open-notifications")}function x(){r("open-players")}function _(){r("logout")}return(w,T)=>(k(),D("div",VH,[d("button",{onClick:c,class:"absolute left-1 md:left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-1.5 md:p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},T[0]||(T[0]=[d("svg",{class:"w-6 h-6 md:w-8 md:h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),d("h1",{onClick:a,class:"text-2xl md:text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent px-6 md:px-16 truncate max-w-full cursor-pointer hover:from-pink-300 hover:via-purple-300 hover:to-cyan-300 transition-all duration-200",title:n.seasonSlug?`Cliquer pour rafraîchir ${n.seasonName}`:n.seasonName},ie(n.seasonName?n.seasonName:"Chargement..."),9,MH),d("div",LH,[d("div",$H,[ze(fv,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:f,onOpenHelp:p,onOpenNotifications:v,onOpenPlayers:x,onLogout:_,onOpenLogin:h},null,8,["is-connected","button-class"]),i.value?se("",!0):(k(),D("button",{key:0,onClick:p,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},T[1]||(T[1]=[d("span",{class:"text-2xl"},"❓",-1)])))]),d("div",FH,[ze(fv,{"is-connected":i.value,"button-class":o.value,onOpenAccountMenu:f,onOpenHelp:p,onOpenNotifications:v,onOpenPlayers:x,onLogout:_,onOpenLogin:h},null,8,["is-connected","button-class"])])])]))}},jH={key:0,class:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/50"},qH={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-2xl shadow-2xl w-full max-w-md p-6 relative"},BH={class:"text-center mb-6"},zH={class:"text-gray-300 text-sm"},HH={class:"font-medium text-white"},WH={key:0,class:"space-y-4"},KH={key:0,class:"mb-4 p-3 bg-blue-500/20 border border-blue-400/30 rounded-lg"},GH={class:"text-blue-100 text-sm"},QH=["placeholder","disabled"],JH={key:0,class:"mt-2 text-xs"},YH={key:0,class:"text-green-400"},XH={key:1,class:"text-red-400"},ZH={class:"flex gap-3"},eW=["disabled"],tW={key:0,class:"animate-spin"},nW={key:1},rW={key:1,class:"text-center"},sW={class:"text-green-400 text-sm mb-4"},iW={class:"font-medium text-white"},oW={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg"},aW={class:"text-red-300 text-sm"},lW={__name:"NotificationPromptModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},eventTitle:{type:String,required:!0},seasonId:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,required:!0}},emits:["close","success","show-login"],setup(n,{emit:e}){const t=n,r=e,s=A(""),i=A(!1),o=A(""),a=A(!1),l=A(""),c=$e(()=>{const h=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,p=s.value,v=h.test(p),x=i.value;return p&&v&&!x});In(async()=>{var h;try{const{auth:p}=await je(()=>Promise.resolve().then(()=>vr),void 0);(h=p.currentUser)!=null&&h.email&&(l.value=p.currentUser.email,s.value=p.currentUser.email)}catch(p){console.error("Erreur lors de la récupération de l'email utilisateur:",p)}});async function f(){var h;if(c.value){i.value=!0,o.value="";try{console.log("🚀 Début de l'activation des notifications...");const{auth:p}=await je(()=>Promise.resolve().then(()=>vr),void 0),v=((h=p.currentUser)==null?void 0:h.email)===s.value;if(v){console.log("✅ Utilisateur déjà connecté, activation directe...");const{activateNotificationsForConnectedUser:x}=await je(()=>Promise.resolve().then(()=>Yf),void 0),_=await x({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Notifications activées directement:",_),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!0})}else{console.log("📧 Utilisateur non connecté, vérification de l'email...");const{checkEmailExists:x}=await je(()=>Promise.resolve().then(()=>Yf),void 0);if(await x(s.value)){console.log("🎯 Email existant détecté, affichage du popup de connexion"),r("close"),r("show-login",{email:s.value,playerName:t.playerName,eventId:t.eventId,seasonId:t.seasonId,seasonSlug:t.seasonSlug});return}console.log("📧 Nouvel email, envoi de l'email d'activation...");const w=await aC({seasonId:t.seasonId,eventId:t.eventId,playerName:t.playerName,email:s.value,eventTitle:t.eventTitle,seasonSlug:t.seasonSlug});console.log("✅ Résultat de la création:",w),a.value=!0,r("success",{email:s.value,playerName:t.playerName,directActivation:!1})}M.info("Activation des notifications terminée",{email:s.value,playerName:t.playerName,eventId:t.eventId,directActivation:v})}catch(p){console.error("❌ Erreur lors de l'activation:",p),M.error("Erreur lors de l'activation des notifications",p),o.value="Impossible d'activer les notifications. Veuillez réessayer."}finally{i.value=!1}}}return(h,p)=>n.show?(k(),D("div",jH,[d("div",qH,[d("button",{onClick:p[0]||(p[0]=v=>h.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10",title:"Fermer"},p[3]||(p[3]=[d("span",{class:"text-xl"},"✖️",-1)])),d("div",BH,[p[5]||(p[5]=d("div",{class:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-600"},[d("span",{class:"text-xl"},"🔔")],-1)),p[6]||(p[6]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Ne rate rien !",-1)),d("p",zH,[d("span",HH,ie(n.playerName),1),p[4]||(p[4]=lt(", active tes notifications pour recevoir des alertes en temps réel sur les spectacles. "))])]),a.value?(k(),D("div",rW,[d("p",sW,[p[10]||(p[10]=lt(" Email envoyé à ")),d("span",iW,ie(s.value),1)]),p[11]||(p[11]=d("p",{class:"text-gray-300 text-xs"}," Clique sur le lien qu'il contient pour activer tes notifications ",-1))])):(k(),D("div",WH,[l.value?(k(),D("div",KH,[p[7]||(p[7]=d("div",{class:"text-blue-200 text-sm font-medium mb-1"},"📧 Ton email actuel :",-1)),d("div",GH,ie(l.value),1),p[8]||(p[8]=d("div",{class:"text-blue-300 text-xs mt-1"},"C'est à cette adresse que tes notifications seront envoyées",-1))])):se("",!0),d("div",null,[p[9]||(p[9]=d("label",{for:"email",class:"block text-sm font-medium text-gray-300 mb-2"}," Ton adresse email ",-1)),at(d("input",{id:"email","onUpdate:modelValue":p[1]||(p[1]=v=>s.value=v),type:"email",placeholder:l.value||"votre@email.com",class:$t(["w-full px-4 py-3 bg-gray-800 border rounded-lg text-white placeholder-gray-400 focus:outline-none transition-colors",[s.value&&!c.value?"border-red-500 focus:border-red-500":s.value&&c.value?"border-green-500 focus:border-green-500":"border-white/20 focus:border-purple-500"]]),disabled:i.value},null,10,QH),[[Ot,s.value]]),s.value&&!i.value?(k(),D("div",JH,[c.value?(k(),D("span",YH,"✅ Email valide")):(k(),D("span",XH,"❌ Format d'email invalide"))])):se("",!0)]),d("div",ZH,[d("button",{onClick:f,disabled:!c.value||i.value,class:$t(["flex-1 px-6 py-3 rounded-lg transition-all duration-300 font-medium",[c.value&&!i.value?"bg-gradient-to-r from-purple-500 to-pink-600 text-white hover:from-purple-600 hover:to-pink-700":"bg-gray-600 text-gray-300 cursor-not-allowed"]])},[i.value?(k(),D("span",tW,"⏳")):(k(),D("span",nW,"Activer les notifications"))],10,eW),d("button",{onClick:p[2]||(p[2]=v=>h.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"}," Pas Maintenant ")])])),o.value?(k(),D("div",oW,[d("div",aW,ie(o.value),1)])):se("",!0)])])):se("",!0)}},cW={key:0,class:"fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60"},uW={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center relative"},dW={class:"text-gray-300 mb-6"},hW={class:"font-semibold text-white"},fW={class:"bg-blue-500/20 border border-blue-500/30 rounded-lg p-4 mb-6"},pW={class:"flex items-start gap-3"},mW={class:"text-left flex-1"},gW={key:0,class:"mb-6 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},vW={class:"flex items-start gap-3"},yW={class:"text-left"},bW={class:"text-green-200 text-sm"},_W={class:"font-mono"},wW={class:"flex gap-3"},xW=["disabled"],EW={key:0,class:"animate-spin"},IW={key:1},TW={__name:"NotificationSuccessModal",props:{show:{type:Boolean,default:!1},playerName:{type:String,required:!0},email:{type:String,required:!0},seasonSlug:{type:String,required:!0},eventId:{type:String,default:null}},emits:["close","createPassword"],setup(n,{emit:e}){const t=n;Za();const r=A(!1),s=A(!1);async function i(){s.value=!0;try{const{sendPasswordResetEmail:o}=await je(()=>import("./index.esm-253f6bce.js"),[]),{auth:a}=await je(()=>Promise.resolve().then(()=>vr),void 0);console.log("🚀 Envoi de l'email de réinitialisation pour:",t.email);const l={lastVisitedPage:window.location.pathname+window.location.search,timestamp:Date.now(),email:t.email};localStorage.setItem("pendingPasswordResetNavigation",JSON.stringify(l)),console.log("💾 Navigation sauvegardée pour redirection après reset:",l),console.log("📧 Envoi de l'email de réinitialisation..."),await o(a,t.email),console.log("✅ Email de réinitialisation envoyé avec succès à",t.email),r.value=!0}catch(o){console.error("❌ Erreur lors de l'envoi de l'email de réinitialisation:",o),o.code==="auth/user-not-found"?console.error("❌ Utilisateur non trouvé, le compte n'a pas été créé correctement"):o.code==="auth/too-many-requests"?console.error("❌ Trop de demandes, veuillez attendre avant de réessayer"):console.error("❌ Erreur inconnue:",o.message)}finally{s.value=!1}}return(o,a)=>n.show?(k(),D("div",cW,[d("div",uW,[d("button",{onClick:a[0]||(a[0]=l=>o.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors duration-200 text-xl font-bold",title:"Fermer"}," ✖️ "),a[9]||(a[9]=d("div",{class:"w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center bg-green-500"},[d("span",{class:"text-3xl"},"✅")],-1)),a[10]||(a[10]=d("h1",{class:"text-2xl font-bold text-white mb-4"},"Notifications activées !",-1)),d("p",dW,[a[2]||(a[2]=lt(" Nous enverrons désormais les alertes spectacle à ")),d("span",hW,ie(n.email),1)]),d("div",fW,[d("div",pW,[a[4]||(a[4]=d("span",{class:"text-blue-400 text-lg"},"💡",-1)),d("div",mW,[a[3]||(a[3]=d("p",{class:"text-blue-300 text-sm font-medium mb-3"}," Psst... tant que tu y es : crée ton mot de passe pour sécuriser ton compte ! ",-1)),ze(V0,{inline:!0})])])]),r.value?(k(),D("div",gW,[d("div",vW,[a[8]||(a[8]=d("span",{class:"text-green-400 text-lg"},"✅",-1)),d("div",yW,[a[7]||(a[7]=d("p",{class:"text-green-300 text-sm font-medium mb-1"},"Email envoyé !",-1)),d("p",bW,[a[5]||(a[5]=lt(" Vérifie ta boîte mail à ")),d("span",_W,ie(n.email),1),a[6]||(a[6]=lt(" et clique sur le lien pour créer ton mot de passe. "))])])])])):se("",!0),d("div",wW,[d("button",{onClick:i,class:$t(["flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 font-medium",{"opacity-50 cursor-not-allowed":r.value||s.value}]),disabled:r.value||s.value},[s.value?(k(),D("span",EW,"⏳")):(k(),D("span",IW,"🔐 Créer mon mot de passe"))],10,xW),d("button",{onClick:a[1]||(a[1]=l=>o.$emit("close")),class:"flex-1 px-6 py-3 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-all duration-300 font-medium"},ie(r.value?"Fermer":"Plus tard"),1)])])])):se("",!0)}};const SW={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},AW={class:"w-full px-0 md:px-0 pb-0 pt-[64px] md:pt-[80px] -mt-[64px] md:-mt-[80px] bg-gray-900"},PW={class:"flex items-stretch relative"},CW={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[101] bg-gray-900 h-full"},RW={class:"flex flex-col items-center justify-between h-full gap-3"},kW=["title"],DW={key:0,class:"w-16 h-16 md:w-14 md:h-14 rounded-lg overflow-hidden shadow-lg"},NW=["src","alt"],OW={key:1,class:"w-16 h-16 md:w-14 md:h-14 text-3xl md:text-2xl flex items-center justify-center text-white"},VW={class:"flex-1 overflow-hidden"},MW=["data-event-id"],LW=["title","onClick"],$W={class:"flex flex-col items-center flex-1 justify-center"},FW={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},UW={key:0,class:"mt-1 text-xs text-gray-400"},jW={class:"relative"},qW=["title"],BW={class:"flex flex-col items-center mt-2"},zW={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},HW=["title","onClick"],WW=["title","aria-label"],KW={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},GW={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},QW={key:0,class:"pointer-events-none"},JW={class:"flex items-center justify-between"},YW={key:1,class:"pointer-events-none"},XW={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},ZW={class:"flex items-center justify-between"},eK={key:2,class:"pointer-events-none"},tK={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},nK={class:"flex items-center justify-between"},rK={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},sK=["data-player-id"],iK={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},oK={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},aK={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Ma personne"},lK={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Personne protégée par mot de passe"},cK=["onClick","title"],uK={class:"group-hover:text-purple-300 transition-colors duration-200"},dK=["data-event-id"],hK={class:"border-t border-white/10"},fK={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},pK={class:"px-4 md:px-5 flex items-center"},mK=["data-event-id"],gK={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},vK={class:"text-center"},yK={class:"text-white text-lg"},bK={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},_K={class:"text-white/60 text-xs mt-2"},wK={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},xK={class:"flex items-center space-x-2"},EK={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},IK={class:"flex items-center space-x-2"},TK={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},SK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},AK={class:"mb-6"},PK={class:"mb-6"},CK={class:"mb-6"},RK={class:"mb-6 flex items-center gap-3"},kK={class:"mb-6"},DK={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},NK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},OK={class:"mb-6"},VK={class:"flex justify-end space-x-3"},MK={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},LK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},$K={class:"flex justify-end space-x-3"},FK={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},UK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},jK={class:"flex justify-end space-x-3"},qK={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},BK={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},zK={class:"text-center mb-6"},HK={class:"text-gray-300"},WK={key:0},KK={key:1},GK={class:"relative p-4 md:p-6 border-b border-white/10"},QK={class:"flex items-start gap-4 md:gap-6"},JK={class:"flex-1 min-w-0"},YK={class:"flex items-center gap-3 mb-2"},XK={class:"text-xl md:text-2xl font-bold text-white leading-tight"},ZK={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},eG={class:"text-blue-200"},tG={class:"mb-3"},nG={class:"text-base md:text-lg text-purple-300"},rG={class:"flex items-center gap-3 mb-3 pl-0 md:pl-0"},sG={class:"relative"},iG={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[99999] overflow-hidden"},oG={class:"p-2"},aG={key:0,class:"flex items-center gap-2 px-3 py-1.5 bg-purple-500/20 border border-purple-400/30 rounded text-sm"},lG={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30 ml-0 md:ml-0"},cG={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},uG={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},dG={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},hG={class:"text-xl md:text-2xl font-bold text-white"},fG={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},pG={class:"text-xl md:text-2xl font-bold text-white"},mG={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},gG={class:"text-xl md:text-2xl font-bold text-yellow-300"},vG={key:0,class:"mb-4 md:mb-6"},yG={class:"mb-3 flex items-center gap-3"},bG=["title"],_G={class:"truncate"},wG={class:"grid grid-cols-2 gap-2"},xG={class:"flex items-center min-w-0 gap-1.5"},EG={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Ma personne"},IG={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Personne protégée par mot de passe"},TG=["title"],SG={class:"flex-0 p-0"},AG={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},PG=["disabled","title"],CG=["title"],RG={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},kG=["disabled"],DG=["disabled","title"],NG={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},OG={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},VG={class:"mb-6"},MG={class:"mb-6"},LG={class:"mb-6"},$G={class:"mb-6 flex items-center gap-3"},FG={class:"mb-6"},UG={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},jG={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},qG={class:"mb-6"},BG={class:"space-y-4"},zG=["disabled"],HG={key:0,class:"animate-spin"},WG={key:1},KG={class:"mb-6 text-center"},GG={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},QG={class:"text-red-300 text-sm"},JG={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},YG={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},XG={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},ZG={class:"space-y-4"},eQ={class:"mt-2 text-center"},tQ={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},nQ={class:"text-red-300 text-sm"},rQ={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},sQ=["disabled"],iQ={key:0,class:"animate-spin"},oQ={key:1},aQ={class:"mb-6"},lQ=["disabled"],cQ={key:0,class:"animate-spin"},uQ={key:1},dQ={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},hQ={class:"text-red-300 text-sm"},fQ={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},pQ={class:"text-green-300 text-sm"},mQ={class:"flex justify-center"},gQ={class:"mb-6"},vQ=["disabled"],yQ={key:0,class:"animate-spin"},bQ={key:1},_Q={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},wQ={class:"text-red-300 text-sm"},xQ={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},EQ={class:"text-green-300 text-sm"},IQ={class:"flex justify-center"},TQ={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},SQ={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},AQ={class:"flex gap-3"},Yx={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=Za(),r=Uo(),s=A(null);function i(y){s.value=y,kt(()=>{l()}),kt(()=>{const m=new Set(Lr.value);Lr.value=new Set,kt(()=>{Lr.value=m})}),kt(async()=>{await o(y)})}async function o(y){try{if(h.value){const m=`seasonPreferredPlayer:${h.value}`;if(y!=null&&y.email){console.log("🔄 Synchronisation des favoris pour utilisateur connecté:",y.email);const q=(await kd(y.email)).filter(Q=>Q.seasonId===h.value);if(q.length>0){const Q=q.map(Z=>Z.playerId);localStorage.setItem(m,JSON.stringify(Q)),console.log("✅ Favoris synchronisés avec Firebase:",Q)}else localStorage.removeItem(m),console.log("✅ Favoris effacés (aucune association pour cette saison)")}else console.log("🔄 Utilisateur déconnecté, effacement des favoris"),localStorage.removeItem(m),console.log("✅ Favoris effacés (utilisateur déconnecté)");Gc()}}catch(m){console.error("❌ Erreur lors de la synchronisation des favoris:",m)}}const a=A(!1);async function l(){var y;if(!((y=ee.value)!=null&&y.id)){a.value=!1;return}try{a.value=await qC(ee.value.id)}catch(m){console.error("Erreur lors de la mise à jour de l'état de surveillance:",m),a.value=!1}}const c=e.slug,f=A(""),h=A(""),p=A({}),v=A(!1),x=A(!1),_=A(null),w=A(null),T=A(""),N=A(""),I=A(6),j=A(!1),ne=A(""),ae=A(null),V=A(null),P=A(null),S=A({position:null,side:null}),$=A({position:null}),F=A({position:null}),U=A(!1),O=A(null),pt=A(!1),ct=A(null),Ct=A(null),Ze=A(!1),ce=A(null),z=A(""),ke=A(!1),Oe=A(null),qe=A(""),mt=A(""),zt=A(!1),On=A(null),Yt=A(!1),ue=A(null),Pe=A(""),B=A(""),G=A(!1),Ce=A(null),Ke=A(!1),R=A(!1),L=A(""),H=A(""),fe=A(!1),oe=A(!1),me=A(""),Ie=A(""),we=A(!1),ee=A(null),ge=A(""),Le=A(!1),ye=A(!1),Re=A(!1),Qe=A(null),We=A(null),rt=A({position:"fixed",top:"0px",left:"0px"}),gt=A(null),fn=A({position:"fixed",top:"0px",left:"0px"}),Xt=A(!1),Kt=A(!1),Vt=A(null),yr=A(!1),br=A(null),pn=A(!1),Yn=A(null);function Rs(){try{const y=Qe.value;if(!y)return;const m=y.getBoundingClientRect(),C=8;if(window.innerWidth>768){const q=Math.max(C,Math.round(m.top-C)),Q=Math.max(C,Math.round(m.left));rt.value={position:"fixed",top:`${q}px`,left:`${Q}px`,zIndex:400}}else{const q=Math.min(window.innerHeight-C,Math.round(m.bottom+C)),Q=Math.max(C,Math.round(m.left));rt.value={position:"fixed",top:`${q}px`,left:`${Q}px`,zIndex:400}}}catch{}}function oi(){try{const q=Math.max(8,window.innerHeight-8-48-200),Q=Math.max(8,Math.round(window.innerWidth-200-8));fn.value={position:"fixed",top:`${q}px`,left:`${Q}px`,zIndex:400}}catch{}}function Ko(){Re.value=!Re.value,Re.value&&kt(()=>Rs())}function Go(){ye.value=!ye.value,ye.value&&kt(()=>oi())}function de(){Xt.value=!Xt.value}function W(){Xt.value=!1}const xe=A(!1),Ue=A(null),it=A(null),bt=A(null),ot=A(0);function Dt(){var y;try{if(!h.value||!p.value||p.value.onboardingCreatorDone!==!0||Ge.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${h.value}`);try{const q=((y=Ve==null?void 0:Ve.currentUser)==null?void 0:y.email)||"";q&&kd(q).then(async Q=>{const Z=Q.filter(le=>le.seasonId===h.value);if(Z.length>0){const le=`seasonPreferredPlayer:${h.value}`,Se=localStorage.getItem(le);let Be=[];if(Se)if(Se.startsWith("["))try{Be=JSON.parse(Se)||[]}catch{}else Be=[Se];const De=new Set(Be);Z.forEach(Rt=>De.add(Rt.playerId));const Je=Array.from(De);localStorage.setItem(le,JSON.stringify(Je))}}).catch(()=>{})}catch{}const C=localStorage.getItem(`startPlayerTour:${h.value}`);!m&&C&&(ot.value=1,localStorage.removeItem(`startPlayerTour:${h.value}`),kt(()=>{const q=document.querySelector('button[data-onboarding="add-player"]');if(q){q.scrollIntoView({behavior:"smooth",block:"end"});const Q=q.getBoundingClientRect(),Z=document.getElementById("coachmark-add"),le=280,Se=100,Be=(Z==null?void 0:Z.offsetWidth)||le,De=(Z==null?void 0:Z.offsetHeight)||Se,Je=Math.round(Q.right+12);if(Je+Be<=window.innerWidth-12){const gn=Q.top+Q.height/2-De/2,kn=-14,cn=12,lr=window.innerHeight-De-12,vs=Math.max(cn,Math.min(Math.round(gn+kn),lr));S.value={position:{x:Je,y:vs},side:"right"}}else{const gn=Math.round(Q.left+Q.width/2-Be/2),kn=Math.round(Q.top-De-8),cn=8,lr=window.innerWidth-Be-8;S.value={position:{x:Math.max(cn,Math.min(gn,lr)),y:kn},side:null}}}}))}catch{}}const bn=A(!1),Xe=A(null),_r=A(null),ut=A(!1),_n=A(null),wr=A(!1),Mr=A(null),Un=A(!1),Yr=A(!1),Wi=A(!1),ks=A(!1),Ki=A(!1),Qo=A(!1),Gi=A(!1),us=A(null);function oh(){Yr.value=!0;const y=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open"),m.set("open","account");const C=`${y}?${m.toString()}`;t.push(C)}function hl(){Yr.value=!1;const y=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open");const C=m.toString()?`${y}?${m.toString()}`:y;t.push(C)}function Fc(){Qo.value=!0}function Uc(){Qo.value=!1}function ah(){Gi.value=!0}function lh(){Gi.value=!1}function ch(){try{const q=Ve==null?void 0:Ve.currentUser;if(!q||q.isAnonymous){let Q=null;if(zn.value&&zn.value.size>0){const Z=zn.value.values().next().value;Q=dt.value.find(le=>le.id===Z)||null}Q||(Q=dt.value[0]||null),ks.value=!0,Q&&(us.value=Q);return}}catch{}Yr.value=!0;const y=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open"),m.set("open","account");const C=`${y}?${m.toString()}`;t.push(C)}function fl(){Ki.value=!0}async function uh(){var y;try{const m=(y=Ve==null?void 0:Ve.currentUser)==null?void 0:y.email;if(!m)return;const{resetPlayerPassword:C}=await je(()=>Promise.resolve().then(()=>vr),void 0);await C(m),be.value=!0,nt.value="Email de réinitialisation envoyé.",setTimeout(()=>{be.value=!1},3e3)}catch{Xn.value=!0,Ms.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{Xn.value=!1},3e3)}}async function pl(){try{await b5(Ve),hl();const y=`/season/${e.slug}`,m=new URLSearchParams(window.location.search);m.delete("open");const C=m.toString()?`${y}?${m.toString()}`:y;t.push(C),be.value=!0,nt.value="Déconnecté de cet appareil.",setTimeout(()=>{be.value=!1},2500)}catch{Xn.value=!0,Ms.value="Déconnexion impossible.",setTimeout(()=>{Xn.value=!1},3e3)}}async function Jo(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function Ds(y){var m;hl();try{if(y.seasonId&&y.seasonId!==h.value){const C=pe(te,"seasons",y.seasonId),Q=(await It(tt(te,"seasons"))).docs.find(le=>le.id===y.seasonId),Z=(m=Q==null?void 0:Q.data())==null?void 0:m.slug;if(Z){t.push(`/season/${Z}?player=${encodeURIComponent(y.playerId)}&open=protection`);return}}else{const C=dt.value.find(q=>q.id===y.playerId);if(C){El(C);return}t.push(`?player=${encodeURIComponent(y.playerId)}&open=protection`)}}catch{}}In(async()=>{var C;s.value=Ve.currentUser;const y=Ve.onAuthStateChanged(i);window._gridBoardUnsubscribe=y;try{h.value&&localStorage.getItem(`dismissCreatorOnboarding:${h.value}`)&&(onboardingDismissedShare.value=!0)}catch{}try{const q=window.location.pathname;if(q&&q!=="/"){const Z=new URLSearchParams(window.location.search).get("email")||localStorage.getItem("hatcast_last_email");Z&&await Sa(Z,q,{seasonSlug:e.slug,source:"grid_board"})}}catch(q){q.code!=="permission-denied"&&M.error("Erreur lors du tracking de navigation:",q)}try{const q=new URLSearchParams(window.location.search);if(q.get("open")==="account"&&kt(()=>{Yr.value=!0}),q.get("open")==="protection"&&q.get("player")&&!q.get("verified")){const Q=q.get("player"),Z=dt.value.find(le=>le.id===Q);Z&&kt(()=>{El(Z)})}if(q.get("modal")==="event_details"&&q.get("event")){const Q=q.get("event"),Z=Ge.value.find(le=>le.id===Q);Z&&kt(()=>{wh(Z)})}if(q.get("modal")==="player_details"&&q.get("player")&&!q.get("verified")){const Q=q.get("player"),Z=dt.value.find(le=>le.id===Q);Z&&kt(()=>{El(Z)})}if(q.get("verified")==="1"&&q.get("player")){const Q=q.get("player"),Z=localStorage.getItem("protectionActivated"),le=localStorage.getItem("protectedPlayerId");if(Z==="true"&&le===Q)try{const{addPreferredPlayerLocal:Se}=await je(()=>Promise.resolve().then(()=>$o),void 0),Be=h.value||localStorage.getItem("protectedSeasonId")||"global";await Se(Be,Q),Gc(),console.log("🔄 Mise à jour des favoris effectuée, état actuel:",Array.from(zn.value)),be.value=!0;const De=((C=dt.value.find(Je=>Je.id===Q))==null?void 0:C.name)||"le joueur";if(nt.value=`Protection activée ! ${De} est maintenant dans vos ⭐️ favoris`,setTimeout(()=>{be.value=!1},5e3),localStorage.removeItem("protectionActivated"),localStorage.removeItem("protectedPlayerId"),localStorage.removeItem("protectedSeasonId"),console.log("✅ Joueur ajouté en favoris après activation de la protection:",Q),q.get("open")==="protection"){const Je=dt.value.find(Rt=>Rt.id===Q);Je&&setTimeout(()=>{El(Je)},1e3)}}catch(Se){console.error("Erreur lors de l'ajout en favoris:",Se)}}}catch(q){M.error("Erreur lors de la détection automatique des modales:",q)}const m=()=>{v.value=window.scrollY>10};return window.addEventListener("scroll",m,{passive:!0}),document.addEventListener("click",q=>{if(Re.value){const Q=Qe.value,Z=We.value,le=Q&&Q.contains(q.target),Se=Z&&Z.contains(q.target);!le&&!Se&&(Re.value=!1)}if(ye.value){const Q=gt.value;Q&&Q.contains(q.target)||(ye.value=!1)}}),document.addEventListener("keydown",q=>{q.key==="Escape"&&(Re.value&&(Re.value=!1),ye.value&&(ye.value=!1))}),window.addEventListener("resize",()=>{Re.value&&Rs(),ye.value&&oi()}),window.addEventListener("scroll",()=>{Re.value&&Rs(),ye.value&&oi()},{passive:!0}),()=>{window.removeEventListener("scroll",m)}});function jc(){kt(()=>{Hc()})}const Lr=A(new Set),Ns=A(!0),ds=A(0),ai=A("Préparation de la grille"),Xr=A(e.eventId||null),ml=A(!1),Yo=A(null);Pt(()=>e.eventId,y=>{if(y)if(Xr.value=y,Ge.value.length>0)X0(y);else{const m=Pt(Ge,C=>{C.length>0&&(X0(y),m())},{immediate:!0})}});const Qi=$e(()=>dt.value.map(y=>({...y,isProtected:Lr.value.has(y.id),email:null}))),am=$e(()=>Xr.value?Rr.value.findIndex(y=>y.id===Xr.value):-1);$e(()=>{if(!Xr.value||am.value===-1)return!1;if(window.innerWidth<=768){const y=document.querySelector(`[data-event-id="${Xr.value}"]`);if(y){const m=y.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const Zr=A(null),qc=A(!1),Bc=A(!1),zc=A(0),li=A(null),mn=A(null),ci=A(null);function xr(){const y=Zr.value;if(!y)return;const{scrollLeft:m,scrollWidth:C,clientWidth:q}=y;qc.value=m>2,Bc.value=m<C-q-2}function Hc(){var y;try{xr(),zc.value=((y=Zr.value)==null?void 0:y.scrollLeft)||0}catch{}}function Ht(y){const m=Zr.value;if(!m)return;let C=0;const q=m.querySelector("tbody tr td[data-event-id]");if(q)C=q.getBoundingClientRect().width;else if(mn!=null&&mn.value){const Z=mn.value.querySelector(".col-event");Z&&(C=Z.getBoundingClientRect().width)}(!C||!isFinite(C))&&(C=m.clientWidth*.6);const Q=m.scrollLeft+y*C;m.scrollTo({left:Q,behavior:"smooth"})}const Os=A(null);A(0);const hs=A(!1),Vs=A(!1),Ji=A(0);function Wc(y,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),fs(),Ht(y)}function gl(y,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),hs.value)return;hs.value=!0,Ji.value=y,Vs.value=!1;const C=Zr.value;if(!C)return;let q=0;const Q=C.querySelector("tbody tr td[data-event-id]");if(Q)q=Q.getBoundingClientRect().width;else if(mn!=null&&mn.value){const Be=mn.value.querySelector(".col-event");Be&&(q=Be.getBoundingClientRect().width)}(!q||!isFinite(q))&&(q=C.clientWidth*.6);const Z=q/6,le=120,Se=()=>{if(!hs.value||Ji.value===0)return;Vs.value||(Vs.value=!0);const Be=C.scrollLeft+Ji.value*Z;C.scrollTo({left:Be,behavior:"auto"}),Os.value=window.setTimeout(Se,le)};Os.value=window.setTimeout(Se,250)}function fs(y){y&&typeof y.preventDefault=="function"&&y.preventDefault();const m=hs.value,C=Vs.value;if(hs.value=!1,Os.value&&(clearTimeout(Os.value),Os.value=null),y&&typeof y.type=="string"&&y.type.startsWith("touch")&&!C){const q=Ji.value||0;q!==0&&Ht(q),Ji.value=0;return}Ji.value=0,m&&C&&lm()}function lm(){const y=Zr.value;if(!y)return;let m=0;const C=y.querySelector("tbody tr td[data-event-id]");if(C)m=C.getBoundingClientRect().width;else if(mn!=null&&mn.value){const le=mn.value.querySelector(".col-event");le&&(m=le.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const q=y.scrollLeft,Z=Math.round(q/m)*m;y.scrollTo({left:Z,behavior:"smooth"})}function cm(y){ae.value=y;const m=document.querySelector(`[data-player-id="${y}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),be.value=!0,nt.value="Nouvelle personne ajoutée !",setTimeout(()=>{be.value=!1},3e3)}function Xo(){if(ot.value!==1)return;const y=document.querySelector('button[data-onboarding="add-player"]');if(!y)return;const m=y.getBoundingClientRect(),C=document.getElementById("coachmark-add"),q=280,Q=100,Z=C!=null&&C.offsetWidth&&C.offsetWidth>0?C.offsetWidth:q,le=C!=null&&C.offsetHeight&&C.offsetHeight>0?C.offsetHeight:Q,Se=Math.round(m.right+12);if(Se+Z<=window.innerWidth-12){const De=m.top+m.height/2-le/2,Rt=ps(De+-14,le);S.value={position:{x:Se,y:Rt},side:"right"}}else{const De=Math.round(m.left+m.width/2-Z/2),Je=ps(m.top-le-8,le),Rt=8,gn=window.innerWidth-Z-8;S.value={position:{x:Math.max(Rt,Math.min(De,gn)),y:Je},side:null}}}function ps(y,m){const C=pageHeaderRef==null?void 0:pageHeaderRef.value,q=C?Math.max(0,Math.round(C.getBoundingClientRect().height||0)):0,Q=Math.max(12,q+8),Z=window.innerHeight-m-12;return Math.max(Q,Math.min(Math.round(y),Z))}function Zo(){var y;ot.value===1&&((y=S.value)!=null&&y.position)&&Xo()}In(()=>{window.addEventListener("scroll",Zo,{passive:!0}),window.addEventListener("resize",Zo)}),Ii(()=>{window._gridBoardUnsubscribe&&(window._gridBoardUnsubscribe(),delete window._gridBoardUnsubscribe),window.removeEventListener("scroll",Zo),window.removeEventListener("resize",Zo)});function ea(y){var m;return(m=Ve.currentUser)!=null&&m.email?Lr.value.has(y):!1}async function vl(){if(h.value)try{const y=await hv(h.value),m=new Set;y.forEach(C=>{C.isProtected&&m.add(C.playerId||C.id)}),Lr.value=m}catch{const m=new Set;for(const C of dt.value)await Ws(C.id,h.value)&&m.add(C.id);Lr.value=m}}const be=A(!1),nt=A(""),Xn=A(!1),Ms=A("");function Ls(){try{const y=`${window.location.origin}/season/${c}`;navigator.clipboard.writeText(y),be.value=!0,nt.value="Lien copié dans le presse-papiers",setTimeout(()=>{be.value=!1},2500)}catch{Xn.value=!0,Ms.value="Impossible de copier le lien",setTimeout(()=>{Xn.value=!1},2500)}}async function dh(y){await da({type:"deleteEvent",data:{eventId:y}})}async function hh(y){if(!et.value[y]){be.value=!0,nt.value="Aucune sélection à réinitialiser pour cet événement",setTimeout(()=>{be.value=!1},3e3);return}await da({type:"resetSelection",data:{eventId:y}})}async function yl(y=null){const m=y||_.value;if(!m){console.error("Aucun événement à supprimer");return}try{await iC(m,h.value),Ge.value=Ge.value.filter(C=>C.id!==m),await Promise.all([Dd(h.value),co(dt.value,Ge.value,h.value),qs(h.value)]).then(([C,q,Q])=>{Ge.value=C,wn.value=q,et.value=Q}),x.value=!1,_.value=null,be.value=!0,nt.value="Événement supprimé avec succès !",setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function bl(){x.value=!1,_.value=null}async function _l(){if(!w.value||!T.value.trim()||!N.value)return;const y=parseInt(I.value);if(isNaN(y)||y<1||y>20){alert("Le nombre de personnes doit être un nombre entier entre 1 et 20");return}try{const m={title:T.value.trim(),date:N.value,description:ge.value.trim()||"",playerCount:y,archived:!!Le.value},C=Ge.value.find(Z=>Z.id===w.value),Q=(C==null?void 0:C.date)!==N.value;if(await mv(w.value,m,h.value),Q&&!m.archived)try{const{createRemindersForSelection:Z,removeRemindersForEvent:le}=await je(()=>Promise.resolve().then(()=>Uq),void 0);await le({seasonId:h.value,eventId:w.value});const Se=ar(w.value),Be=[];for(const De of Se)try{const Je=dt.value.find(Rt=>Rt.name===De);if(Je!=null&&Je.email){const Rt=await Z({seasonId:h.value,eventId:w.value,playerEmail:Je.email,playerName:Je.name,eventTitle:m.title,eventDate:m.date,seasonSlug:e.slug});Rt.success&&Be.push(...Rt.results)}}catch(Je){console.error("Erreur lors de la recréation des rappels pour",De,Je)}if(console.log("🎯 Rappels mis à jour pour la nouvelle date:",{eventId:w.value,eventTitle:m.title,newDate:m.date,selectedPlayers:Se.length,remindersCreated:Be.filter(De=>De.success).length}),Be.length>0){const De=Be.filter(Je=>Je.success).length}}catch(Z){console.error("Erreur lors de la mise à jour des rappels:",Z)}!m.archived&&dt.value.length>0&&Lr.value.size>0&&(Mr.value={id:w.value,...m},wr.value=!0),await Promise.all([Dd(h.value),co(dt.value,Ge.value,h.value),qs(h.value)]).then(([Z,le,Se])=>{Ge.value=Z,wn.value=le,et.value=Se}),w.value=null,T.value="",N.value="",ge.value="",I.value=6,Le.value=!1,be.value=!0,nt.value="Événement mis à jour avec succès !",setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function ta(){if(ne.value.trim())try{const y=ne.value.trim(),m=await U0(y,h.value);await Promise.all([ec(h.value),co(dt.value,Ge.value,h.value),qs(h.value)]).then(([C,q,Q])=>{dt.value=C,wn.value=q,et.value=Q,vl();const Z=dt.value.find(Se=>Se.id===m);cm(m),V.value=m,P.value=Rr.value&&Rr.value[0]&&Rr.value[0].id?Rr.value[0].id:null;try{h.value&&localStorage.setItem(`lastAddedPlayerId:${h.value}`,m)}catch{}try{typeof ot<"u"&&(ot.value=2)}catch{}const le=document.querySelector(`[data-player-id="${m}"]`);le&&le.scrollIntoView({behavior:"smooth",block:"center"}),kt(()=>{const Se=`[data-player-id="${V.value}"] td[data-event-id="${P.value}"]`,Be=document.querySelector(Se);if(Be){const De=Be.getBoundingClientRect();$.value.position={x:Math.round(De.left),y:Math.round(De.top+window.scrollY-48)}}}),be.value=!0,nt.value="Personne ajoutée avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{be.value=!1},3e3),setTimeout(()=>{be.value=!1,nt.value=""},5e3)}),j.value=!1,ne.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout de la personne. Veuillez réessayer.")}}function ms(){w.value=null,T.value="",N.value="",ge.value="",I.value=6}A(null);const na=A(!1),$s=A(""),Ft=A(""),ra=A(""),sa=A(6),ia=A(!1);async function fh(){if(!$s.value.trim()||!Ft.value){alert("Veuillez remplir le titre et la date de l'événement");return}const y=parseInt(sa.value);if(isNaN(y)||y<1||y>20){alert("Le nombre de personnes doit être un nombre entier entre 1 et 20");return}const m={title:$s.value.trim(),date:Ft.value,description:ra.value.trim()||"",playerCount:y,archived:!!ia.value};await ph(m)}async function ph(y){try{const m=await oC(y,h.value);Ge.value=[...Ge.value,{id:m,...y}];const C={};for(const q of dt.value)C[q.name]=wn.value[q.name]||{},C[q.name][m]=null,await pv(q.name,C[q.name],h.value);$s.value="",Ft.value="",ra.value="",sa.value=6,ia.value=!1,na.value=!1,await Promise.resolve(),be.value=!0,nt.value="Événement créé avec succès !",!y.archived&&dt.value.length>0&&Lr.value.size>0&&(Mr.value={id:m,...y},wr.value=!0),setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function wl(){$s.value="",Ft.value="",ra.value="",sa.value=6,na.value=!1}async function Kc(){await da({type:"addEvent",data:{}})}const Ge=A([]),dt=A([]),wn=A({}),et=A({}),mh=A({}),oa=A({});Pt([()=>Ge.value.length,()=>dt.value.length,Ns],()=>{Ns.value||kt(()=>{Hc()})}),Pt([()=>dt.value.length,()=>Ge.value.length,h],()=>{Dt()}),In(async()=>{try{om("firebase"),await F0();const m=Lo(tt(te,"seasons"),ss("slug","==",e.slug)),C=await It(m);if(C.empty){t.push("/seasons");return}else{const De=C.docs[0];h.value=De.id;const Je=De.data();f.value=Je.name,p.value=Je,document.title=`Saison : ${f.value}`,yU(e.slug)}if(h.value){ai.value="Chargement des événements de la saison",ds.value=20;const De=await It(tt(te,"seasons",h.value,"events"));Ge.value=De.docs.map(nn=>({id:nn.id,...nn.data(),playerCount:nn.data().playerCount||6})),ai.value="Chargement des joueurs",ds.value=45;const Je=await It(tt(te,"seasons",h.value,"players"));dt.value=Je.docs.map(nn=>({id:nn.id,...nn.data()})),ai.value="Chargement des disponibilités",ds.value=70;const Rt=await It(tt(te,"seasons",h.value,"availability")),gn={};Rt.docs.forEach(nn=>{const Fr=nn.data(),iu={};Object.keys(Fr).forEach(ou=>{const Tl=Fr[ou];iu[ou]=Tl==="oui"?!0:Tl==="non"?!1:Tl}),gn[nn.id]=iu}),wn.value=gn,ai.value="Chargement des sélections",ds.value=85;const kn=await It(tt(te,"seasons",h.value,"selections")),cn={};kn.docs.forEach(nn=>{const Fr=nn.data();Fr.players&&Array.isArray(Fr.players)?cn[nn.id]=Fr:Array.isArray(Fr)?cn[nn.id]={players:Fr,confirmed:!1,confirmedByAllPlayers:!1,playerStatuses:{},updatedAt:new Date}:cn[nn.id]={players:[],confirmed:!1,confirmedByAllPlayers:!1,playerStatuses:{},updatedAt:new Date}}),et.value=cn;const lr=await hv(h.value),vs=new Set;Array.isArray(lr)&&lr.forEach(nn=>{nn.isProtected&&vs.add(nn.playerId||nn.id)}),Lr.value=vs,Gc()}const q=De=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>De()):setTimeout(De,0)};ai.value="Préparation de l'interface",ds.value=95,q(()=>{Et(),Vn()}),await kt(),ds.value=100,Ns.value=!1,kt(()=>{xr(),requestAnimationFrame(()=>xr()),setTimeout(()=>xr(),250);const De=Zr.value;De&&(De.addEventListener("scroll",Je=>{xr(),zc.value=De.scrollLeft||0},{passive:!0}),window.addEventListener("resize",xr),typeof ResizeObserver<"u"&&(ci.value=new ResizeObserver(()=>{xr()}),ci.value.observe(De)))});const Q=r.query.event;if(Q&&Ge.value.length>0){const De=Ge.value.find(Je=>Je.id===Q);De?(await fm(Q,De),r.query.modal==="event_details"&&wh(De)):(console.warn("Événement non trouvé avec l'ID"),Xn.value=!0,Ms.value="Événement non trouvé",setTimeout(()=>{Xn.value=!1},3e3))}const Z=r.query.player;if(Z&&dt.value.length>0){const De=dt.value.find(Je=>Je.id===Z);De&&(El(De),await kt(),r.query.verified==="1"&&(be.value=!0,nt.value="Personne associée à votre compte.",setTimeout(()=>{be.value=!1},2500)))}const le=new URLSearchParams(window.location.search),Se=le.get("a")||r.query.a,Be=le.get("eid")||r.query.eid;if(Se==="confirm"&&Be&&(console.debug("🔄 Détection d'un magic link de confirmation, rechargement des données..."),await qs(h.value),et.value=await qs(h.value),console.debug("✅ Sélections rechargées après magic link"),t.replace({query:{...r.query,a:void 0,eid:void 0}})),console.debug("🔍 Vérification des paramètres notificationSuccess...",{routeQuery:r.query,notificationSuccess:r.query.notificationSuccess,email:r.query.email,playerName:r.query.playerName,eventId:r.query.eventId}),r.query.notificationSuccess==="1")console.debug("✅ Paramètres notificationSuccess détectés dans route.query"),Kt.value&&(Kt.value=!1,console.debug("🔒 Fermeture de NotificationPromptModal avant affichage de NotificationSuccessModal")),br.value={email:decodeURIComponent(r.query.email||""),playerName:decodeURIComponent(r.query.playerName||""),eventId:r.query.eventId||null},console.debug("📝 Données de notificationSuccess préparées:",br.value),setTimeout(()=>{yr.value=!0,console.debug("🎉 Ouverture de NotificationSuccessModal")},300),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}});else{const De=new URLSearchParams(window.location.search),Je=De.get("notificationSuccess"),Rt=De.get("email"),gn=De.get("playerName"),kn=De.get("eventId");console.debug("🔍 Fallback - Paramètres détectés via window.location.search:",{notificationSuccess:Je,email:Rt,playerName:gn,eventId:kn}),Je==="1"&&(console.debug("✅ Paramètres détectés via fallback"),Kt.value&&(Kt.value=!1,console.debug("🔒 Fermeture de NotificationPromptModal avant affichage de NotificationSuccessModal (fallback)")),br.value={email:decodeURIComponent(Rt||""),playerName:decodeURIComponent(gn||""),eventId:kn||null},console.debug("📝 Données de notificationSuccess préparées (fallback):",br.value),setTimeout(()=>{yr.value=!0,console.debug("🎉 Ouverture de NotificationSuccessModal (fallback)")},300),t.replace({query:{...r.query,notificationSuccess:void 0,email:void 0,playerName:void 0,eventId:void 0}}))}}catch(y){console.error("Erreur lors du chargement de la grille:",y),Xn.value=!0,Ms.value="Erreur lors du chargement des données",setTimeout(()=>{Xn.value=!1},5e3),Ns.value=!1}}),Pt(()=>r.params.eventId,y=>{if(y){const m=()=>{const C=Ge.value.find(q=>q.id===y);return C?(wh(C),!0):!1};if(Ge.value.length>0)m();else{const C=Pt(Ge,q=>{q.length>0&&m()&&C()},{immediate:!0})}}},{immediate:!0});function aa(y){if(!y)return null;if(y instanceof Date)return y;if(typeof(y==null?void 0:y.toDate)=="function")return y.toDate();if(typeof y=="string"||typeof y=="number"){const m=new Date(y);return isNaN(m.getTime())?null:m}return null}const ui=$e(()=>{let y=null;try{h.value&&(y=localStorage.getItem(`seasonPreferredPlayer:${h.value}`))}catch{}const m=[...dt.value].sort((le,Se)=>(le.name||"").localeCompare(Se.name||"","fr",{sensitivity:"base"}));if(!y)return m;let C=[];try{y.startsWith("[")?C=JSON.parse(y):y&&(C=[y])}catch{C=[]}const q=new Set(C);if(q.size===0)return m;const Q=m.filter(le=>q.has(le.id)),Z=m.filter(le=>!q.has(le.id));return[...Q,...Z]}),zn=A(new Set);function Gc(){try{if(h.value){let y=localStorage.getItem(`seasonPreferredPlayer:${h.value}`);if(y||(y=localStorage.getItem("seasonPreferredPlayer:global")),console.log("🔄 updatePreferredPlayersSet - raw localStorage:",y),!y){zn.value=new Set,console.log("🔄 updatePreferredPlayersSet - aucun favori trouvé");return}if(y.startsWith("[")){const m=JSON.parse(y);zn.value=new Set(Array.isArray(m)?m:[])}else zn.value=new Set([y]);console.log("🔄 updatePreferredPlayersSet - favoris mis à jour:",Array.from(zn.value))}}catch(y){console.error("🔄 updatePreferredPlayersSet - erreur:",y),zn.value=new Set}}function gh(){var y;return!!((y=Ve.currentUser)!=null&&y.email)||!!localStorage.getItem("userEmail")}const la=$e(()=>[...Ge.value].sort((y,m)=>{const C=aa(y.date),q=aa(m.date),Q=C?C.getTime():Number.POSITIVE_INFINITY,Z=q?q.getTime():Number.POSITIVE_INFINITY;return Q!==Z?Q-Z:(y.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),di=A(!1),Rr=$e(()=>{const y=la.value;return di.value?y:y.filter(m=>!m.archived)});function Qc(){di.value=!di.value}const ca=A("selected"),vh=$e(()=>{if(!ee.value)return ui.value;const y=ee.value.id,m=new Set(ar(y));return ui.value.filter(C=>{var le;const q=C.name,Q=(le=wn.value[q])==null?void 0:le[y],Z=m.has(q);switch(ca.value){case"selected":return Z;case"available":return Q===!0&&!Z;case"unavailable":return Q===!1;case"unknown":return Q!==!0&&Q!==!1;case"all":default:return!0}})}),ua=$e(()=>ee.value?Il(ee.value.id):null),yh=$e(()=>{if(!ee.value)return!1;const y=Il(ee.value.id);return y.type==="incomplete"||y.type==="insufficient"}),Jc=$e(()=>ee.value?dm(ee.value.id):"");async function hi(y,m){const C=dt.value.find(Z=>Z.name===y);if(!C){console.error("Joueur non trouvé");return}const q=Ge.value.find(Z=>Z.id===m);if(!q){console.error("Événement non trouvé");return}if(q.archived){be.value=!0,nt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{be.value=!1},3e3);return}if(ea(C.id)){const Z=$a(C.id),le=En.isPinCached(h.value);if(Z||le){await fi(C,m);return}else{it.value={playerName:y,eventId:m},Ue.value=C,xe.value=!0;return}}else if(await fi(C,m),!gh()){const Z=await Ws(C.id,h.value);setTimeout(()=>{Z&&(Vt.value={playerName:C.name,eventTitle:(q==null?void 0:q.title)||"cet événement",eventId:m},Kt.value=!0)},3500)}}function fi(y,m){var Q,Z,le;const C=(Q=wn.value[y.name])==null?void 0:Q[m];let q;C===!0?q=!1:C===!1?q=void 0:q=!0,q===void 0?wn.value[y.name]&&delete wn.value[y.name][m]:(wn.value[y.name]||(wn.value[y.name]={}),wn.value[y.name][m]=q);try{typeof ot<"u"&&ot.value===1&&y.id===(V.value||((Z=ui.value[0])==null?void 0:Z.id))&&m===(P.value||((le=Rr.value[0])==null?void 0:le.id))&&(ot.value=3,kt(()=>{const Be=document.querySelector(`[data-player-id="${y.id}"]`);if(Be){const De=Be.querySelector(".player-name");if(De){const Je=De.getBoundingClientRect();F.value.position={x:Math.round(Je.right+8),y:Math.round(Je.top+window.scrollY-4)}}}}),Ii(()=>{try{window.removeEventListener("resize",xr)}catch{}try{ci.value&&ci.value.disconnect()}catch{}}))}catch{}pv(y.name,wn.value[y.name],h.value).then(async()=>{await kt(),Vn(),be.value=!0,nt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{be.value=!1},3e3)}).catch(Se=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}async function Yc(y,m,C,q){try{const{updatePlayerSelectionStatus:Q}=await je(()=>Promise.resolve().then(()=>Ul),void 0),Z=await Q(m,y,C,q);if(et.value[m]){et.value[m].playerStatuses?et.value[m].playerStatuses[y]=C:et.value[m].playerStatuses={[y]:C},typeof Z.confirmedByAllPlayers=="boolean"&&(et.value[m].confirmedByAllPlayers=Z.confirmedByAllPlayers);const Se={...et.value[m]};et.value[m]=Se}let le=`Statut de ${y} mis à jour : ${bh(C)}`;Z.confirmedByAllPlayers&&(le+=" - Tous les joueurs ont confirmé ! 🎉"),be.value=!0,nt.value=le,setTimeout(()=>{be.value=!1},3e3)}catch(Q){console.error("❌ Erreur lors de la mise à jour du statut du joueur:",Q),Xn.value=!0,Ms.value="Erreur lors de la mise à jour du statut. Veuillez réessayer.",setTimeout(()=>{Xn.value=!1},3e3)}}function bh(y){switch(y){case"pending":return"À confirmer";case"confirmed":return"Confirmé";case"declined":return"Décliné";default:return"Inconnu"}}function Xc(y){const m=et.value[y];return!m||!m.playerStatuses?[]:Object.entries(m.playerStatuses).filter(([C,q])=>q==="declined").map(([C])=>C)}function Zn(y,m){var C;return(C=wn.value[y])==null?void 0:C[m]}function Er(y,m){var Q;const C=ar(m),q=(Q=wn.value[y])==null?void 0:Q[m];return C.includes(y)&&q===!0}async function _h(y,m=6){console.log("🎲 tirer appelé:",{eventId:y,count:m});const C=Ge.value.find(le=>le.id===y),q=(C==null?void 0:C.playerCount)||6;console.log("📅 Événement trouvé:",{eventTitle:C==null?void 0:C.title,requiredCount:q});const Q=ar(y);if(console.log("👥 Sélection actuelle:",Q),Q.length>0&&Q.every(le=>Zn(le,y))){const le=Xc(y),Be=dt.value.filter(Rt=>Zn(Rt.name,y)&&!le.includes(Rt.name)).map(Rt=>{const gn=b(Rt.name);return{name:Rt.name,weight:1/(1+gn)}}),De=[],Je=[...Be];for(;De.length<q&&Je.length>0;){const Rt=Je.reduce((cn,lr)=>cn+lr.weight,0);let gn=Math.random()*Rt;const kn=Je.findIndex(cn=>(gn-=cn.weight,gn<=0));kn>=0&&(De.push(Je[kn].name),Je.splice(kn,1))}et.value[y]={players:De,confirmed:!1,confirmedAt:null,updatedAt:new Date}}else{const le=Q.filter(Be=>Zn(Be,y)),Se=q-le.length;if(Se<=0)et.value[y]={players:le,confirmed:!1,confirmedAt:null,updatedAt:new Date};else{const Be=new Set(le),De=Xc(y),Rt=dt.value.filter(cn=>Zn(cn.name,y)&&!Be.has(cn.name)&&!De.includes(cn.name)).map(cn=>{const lr=b(cn.name);return{name:cn.name,weight:1/(1+lr)}}),gn=[],kn=[...Rt];for(;gn.length<Se&&kn.length>0;){const cn=kn.reduce((nn,Fr)=>nn+Fr.weight,0);let lr=Math.random()*cn;const vs=kn.findIndex(nn=>(lr-=nn.weight,lr<=0));vs>=0&&(gn.push(kn[vs].name),kn.splice(vs,1))}et.value[y]={players:[...le,...gn],confirmed:!1,confirmedAt:null,updatedAt:new Date}}}console.log("💾 Sauvegarde de la sélection:",{eventId:y,players:et.value[y].players,seasonId:h.value}),await Jf(y,et.value[y].players,h.value),Et(),Vn()}async function Zc(y,m=6){var le,Se;console.log("🛡️ tirerProtected appelé:",{eventId:y,count:m});const C=bn.value,q=(le=Xe.value)==null?void 0:le.id,Q=ar(y).length>0,Z=Q?[...ar(y)]:[];if(console.log("🎲 Appel de tirer..."),await _h(y,m),C&&!bn.value&&(bn.value=!0,Xe.value=Ge.value.find(Be=>Be.id===q)),bn.value&&((Se=Xe.value)==null?void 0:Se.id)===y){if(await kt(),_r.value&&_r.value.showSuccess){const Be=ar(y),De=Z.filter(Rt=>Be.includes(Rt)),Je=De.length>0&&De.length<Z.length;_r.value.showSuccess(Q,Je)}}else be.value=!0,Ge.value.find(Be=>Be.id===y),ar(y),Q?nt.value="Sélection mise à jour avec succès !":nt.value="Sélection effectuée avec succès !",setTimeout(()=>{be.value=!1},3e3)}function Fs(y){y===0?S.value.position=null:y===1?$.value.position=null:y===2&&(F.value.position=null)}function u(y){var C;return y?(typeof y=="string"?new Date(y):((C=y.toDate)==null?void 0:C.call(y))||y).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function g(y){var C;return y?(typeof y=="string"?new Date(y):((C=y.toDate)==null?void 0:C.call(y))||y).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function b(y){return Object.keys(et.value).filter(m=>ar(m).includes(y)).length}function E(y){const m=wn.value[y]||{};return Object.values(m).filter(C=>C===!0).length}function K(y){return y?Object.values(wn.value).filter(m=>m[y]===!0).length:0}function re(y){return y?ar(y).length:0}function Ee(y){const m=Ge.value.find(Z=>Z.id===y),C=(m==null?void 0:m.playerCount)||6,q=re(y)>=C,Q=Xi(y);return q&&Q}function Ut(y){const m=E(y),C=b(y);return m===0?0:C/m}function jn(y){mh.value[y]={availability:E(y),selection:b(y),ratio:Ut(y)}}function Et(){dt.value.forEach(y=>jn(y.name))}function Vn(){const y={};Ge.value.forEach(m=>{const C=m.playerCount||6,Q=dt.value.filter(le=>Zn(le.name,m.id)===!0).map(le=>{const Se=b(le.name);return{name:le.name,weight:1/(1+Se)}}),Z=Q.reduce((le,Se)=>le+Se.weight,0);Q.forEach(le=>{const Se=Math.min(1,le.weight/Z*C);y[le.name]||(y[le.name]={}),y[le.name][m.id]=Math.round(Se*100)})}),oa.value=y}const Rn=A(null),gs=A(!1);async function $r(y=null){const m=y||Rn.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await nC(m,h.value),dt.value=dt.value.filter(C=>C.id!==m),gs.value=!1,Rn.value=null,be.value=!0,nt.value="Personne supprimée avec succès !",setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression de la personne. Veuillez réessayer.")}}function xl(){gs.value=!1,Rn.value=null}async function eu(y){W0(),await Ws(y,h.value)?await yC({type:"deletePlayer",data:{playerId:y}}):await da({type:"deletePlayer",data:{playerId:y}})}async function mC(){if(O.value)try{const y=Ge.value.find(C=>C.id===O.value),m=(y==null?void 0:y.playerCount)||6;await Zc(O.value,m)}catch(y){console.error("Erreur lors de la confirmation du tirage:",y)}finally{U.value=!1,O.value=null}}function gC(){U.value=!1,O.value=null}function vC(){return ce.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis",resetSelection:"Réinitialisation de sélection - Code PIN requis",unconfirmSelection:"Déverrouillage de sélection - Code PIN requis"}[ce.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function da(y){if(En.isPinCached(h.value)){const m=En.getCachedPin(h.value);if(await Wf(h.value,m)){await Yi(y);return}else En.clearSession()}ce.value=y,Ze.value=!0}async function yC(y){const m=y.data.playerId;try{if(En.isPinCached(h.value)){await Yi(y);return}}catch{}if($a(m)){await Yi(y);return}Oe.value=y,ke.value=!0}async function bC(y){var m;try{if(await Wf(h.value,y)){const q=!!((m=Ve.currentUser)!=null&&m.email);En.saveSession(h.value,y,q),Ze.value=!1;const Q=ce.value;ce.value=null,await Yi(Q)}else z.value="Code PIN incorrect",setTimeout(()=>{z.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),z.value="Erreur lors de la vérification du code PIN"}}function _C(){Ze.value=!1,ce.value=null,z.value=""}async function q0(y){var m;if(y){zt.value=!0,qe.value="";try{const C=Oe.value.data.playerId,q=await cv(h.value);if(y===q){const Z=!!((m=Ve.currentUser)!=null&&m.email);try{En.saveSession(h.value,y,Z)}catch{}try{Li.saveSession(Oe.value.data.playerId)}catch{}ke.value=!1;const le=Oe.value;Oe.value=null,mt.value="",await Yi(le);return}if(await verifyPlayerPassword(C,y,h.value)){ke.value=!1;const Z=Oe.value;Oe.value=null,mt.value="",await Yi(Z)}else qe.value="Mot de passe incorrect",setTimeout(()=>{qe.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),qe.value="Erreur lors de la vérification du mot de passe"}finally{zt.value=!1}}}function wC(){ke.value=!1,Oe.value=null,qe.value="",mt.value="",zt.value=!1}async function B0(y){var m;if(y){G.value=!0,Pe.value="";try{const C=ue.value.data.player,q=await cv(h.value);if(y===q){const Z=!!((m=Ve.currentUser)!=null&&m.email);try{En.saveSession(h.value,y,Z)}catch{}try{Li.saveSession(ue.value.data.player.id)}catch{}Yt.value=!1;const le=ue.value;ue.value=null,B.value="",await Yi(le);return}if(await verifyPlayerPassword(C.id,y,h.value)){Yt.value=!1;const Z=ue.value;ue.value=null,B.value="",await Yi(Z)}else Pe.value="Mot de passe incorrect",setTimeout(()=>{Pe.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Pe.value="Erreur lors de la vérification du mot de passe"}finally{G.value=!1}}}function xC(){Yt.value=!1,ue.value=null,Pe.value="",B.value="",G.value=!1}async function EC(){R.value=!0,L.value="",H.value="";try{const y=ue.value.data.player,m=await sendPasswordResetEmail(y.id,h.value);H.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),L.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{R.value=!1}}async function IC(){oe.value=!0,me.value="",Ie.value="";try{const y=Oe.value.data.playerId,m=await sendPasswordResetEmail(y,h.value);Ie.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),me.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{oe.value=!1}}function TC(){return En.isPinCached(h.value)?{timeRemaining:En.getTimeRemaining(),isExpiringSoon:En.isExpiringSoon()}:null}async function Yi(y){var q;if(!y)return;const{type:m,data:C}=y;try{switch(m){case"deleteEvent":_.value=C.eventId,x.value=!0;break;case"addEvent":na.value=!0;break;case"deletePlayer":Rn.value=C.playerId,gs.value=!0;break;case"launchSelection":console.log("🚀 launchSelection appelé:",{eventId:C.eventId,count:C.count}),ar(C.eventId).length>0?(console.log("🔄 Sélection existante, affichage confirmation"),O.value=C.eventId,U.value=!0,we.value=!1):(console.log("🎯 Pas de sélection existante, lancement direct"),await Zc(C.eventId,C.count),we.value=!1);break;case"toggleAvailability":fi(C.player,C.eventId);break;case"toggleArchive":await setEventArchived(C.eventId,C.archived,h.value);{const Q=Ge.value.findIndex(Z=>Z.id===C.eventId);Q!==-1&&(Ge.value[Q]={...Ge.value[Q],archived:!!C.archived}),Le.value=!!C.archived}break;case"updateSelection":{const{eventId:Q,players:Z}=C,le=[...ar(Q)],Se=Array.isArray(Z)?Z:[];await Jf(Q,Se,h.value),et.value[Q]?typeof et.value[Q]=="object"&&et.value[Q].players?(et.value[Q].players=Se,et.value[Q].updatedAt=new Date):et.value[Q]={players:Se,confirmed:!1,confirmedAt:null,updatedAt:new Date}:et.value[Q]={players:Se,confirmed:!1,confirmedAt:null,updatedAt:new Date};try{const Be=le.filter(De=>!Se.includes(De));if(Be.length>0){const De=Ge.value.find(Je=>Je.id===Q);await Nj({eventId:Q,eventData:De,removedPlayers:Be,newSelectedPlayers:Se,seasonId:h.value,seasonSlug:c,players:Qi.value})}}catch{}try{(q=_r.value)==null||q.showSuccess(!0,!0)}catch{}}break;case"unconfirmSelection":{const{eventId:Q}=C;try{const{unconfirmSelection:Z,loadSelections:le}=await je(()=>Promise.resolve().then(()=>Ul),void 0);await Z(Q,h.value);const Se=await le(h.value);et.value=Se,be.value=!0,nt.value="Sélection déverrouillée !",setTimeout(()=>{be.value=!1},3e3)}catch(Z){console.error("Erreur lors du déverrouillage de la sélection:",Z),be.value=!0,nt.value="Erreur lors du déverrouillage de la sélection",setTimeout(()=>{be.value=!1},3e3)}}break;case"resetSelection":{const{eventId:Q}=C;try{const{deleteSelection:Z,loadSelections:le}=await je(()=>Promise.resolve().then(()=>Ul),void 0);await Z(Q,h.value);const Se=await le(h.value);et.value=Se,be.value=!0,nt.value='Sélection réinitialisée ! Le statut est maintenant "Nouveau"',setTimeout(()=>{be.value=!1},3e3)}catch(Z){console.error("Erreur lors de la réinitialisation de la sélection:",Z),be.value=!0,nt.value="Erreur lors de la réinitialisation de la sélection",setTimeout(()=>{be.value=!1},3e3)}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),be.value=!0,nt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{be.value=!1},3e3)}}function SC(){t.push("/seasons")}function AC(){window.location.href=`/season/${e.slug}`}Ii(()=>{const y=Zr.value;y&&y.removeEventListener("scroll",xr),window.removeEventListener("resize",xr)});async function wh(y){ee.value=y,ge.value=y.description||"",Le.value=!!y.archived;const m=`/season/${e.slug}?event=${y.id}&modal=event_details`;t.push(m);try{const C=getCurrentUserId();C&&await Sa(C,m,{seasonSlug:e.slug,eventId:y.id,eventTitle:y.title,navigationType:"event_details",context:{currentPage:m,timestamp:new Date().toISOString()}})}catch(C){C.code!=="permission-denied"&&M.error("Erreur lors du tracking de l'état de navigation:",C)}try{const[C,q]=await Promise.all([co(dt.value,Ge.value,h.value),qs(h.value)]);wn.value=C,et.value=q}catch(C){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",C)}we.value=!0,kt(()=>{l()})}function PC(){we.value=!1,ee.value=null,ge.value="",ye.value=!1,Re.value=!1,W(),rt.value={position:"fixed",top:"0px",left:"0px"},fn.value={position:"fixed",top:"0px",left:"0px"}}function um(y,m=null){const C=m||ee.value;if(C)try{m8(y,C,f.value),be.value=!0,y==="ics"?nt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":y==="google"?nt.value="Google Calendar ouvert dans un nouvel onglet":y==="outlook"&&(nt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{be.value=!1},3e3)}catch(q){console.error("Erreur lors de l'ajout au calendrier:",q),be.value=!0,nt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{be.value=!1},3e3)}}function xh(){PC();const y=`/season/${e.slug}`;t.push(y);try{const m=getCurrentUserId();m&&Sa(m,y,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}})}catch(m){m.code!=="permission-denied"&&M.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}async function CC(y,m){var Z;const C=dt.value.find(le=>le.name===y);if(!C){console.error("Joueur non trouvé");return}const q=Ge.value.find(le=>le.id===m);if(q!=null&&q.archived){be.value=!0,nt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{be.value=!1},3e3);return}if(ea(C.id)){const le=$a(C.id),Se=En.isPinCached(h.value);if(le||Se){await fi(C,m);return}else{it.value={playerName:y,eventId:m},Ue.value=C,xe.value=!0;return}}else if(await fi(C,m),!((Z=Ve.currentUser)!=null&&Z.email)){const le=await Ws(C.id,h.value);setTimeout(()=>{le&&(Vt.value={playerName:C.name,eventTitle:(eventItem==null?void 0:eventItem.title)||"cet événement",eventId:m},Kt.value=!0)},3500)}}function RC(y,m){return ar(m).includes(y)}async function kC(y){if(Ue.value&&(bt.value=Ue.value.id),it.value){const{playerName:m,eventId:C}=it.value,q=dt.value.find(Q=>Q.name===m);q&&await fi(q,C),it.value=null}xe.value=!1,Ue.value=null}function z0(){w.value=ee.value.id,T.value=ee.value.title,N.value=ee.value.date,ge.value=ee.value.description||"",I.value=ee.value.playerCount||6,we.value=!1}async function H0(){if(ee.value)try{const y=!ee.value.archived,m={...ee.value,archived:y};await mv(ee.value.id,m,h.value),ee.value.archived=y;const C=Ge.value.findIndex(q=>q.id===ee.value.id);C!==-1&&(Ge.value[C].archived=y),be.value=!0,nt.value=y?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function El(y){ct.value=y,pt.value=!0;const m=`/season/${e.slug}?player=${y.id}&modal=player_details`;t.push(m);try{const C=getCurrentUserId();C&&Sa(C,m,{seasonSlug:e.slug,playerId:y.id,playerName:y.name,navigationType:"player_details",context:{currentPage:m,timestamp:new Date().toISOString()}})}catch(C){C.code!=="permission-denied"&&M.error("Erreur lors du tracking de l'état de navigation joueur:",C)}try{typeof ot<"u"&&ot.value}catch{}}function W0(){pt.value=!1,ct.value=null;const y=`/season/${e.slug}`;if(r.path!==y){t.push(y);try{const m=getCurrentUserId();m&&Sa(m,y,{seasonSlug:e.slug,navigationType:"season_overview",context:{previousPage:r.path,timestamp:new Date().toISOString()}})}catch(m){m.code!=="permission-denied"&&M.error("Erreur lors du tracking du retour à la vue d'ensemble:",m)}}}async function DC({playerId:y,newName:m}){try{await rC(y,m,h.value),await Promise.all([ec(h.value),co(dt.value,Ge.value,h.value),qs(h.value)]).then(([C,q,Q])=>{if(dt.value=C,wn.value=q,et.value=Q,vl(),ct.value&&ct.value.id===y){const Z=C.find(le=>le.id===y);Z&&(ct.value=Z)}}),be.value=!0,nt.value="Joueur mis à jour avec succès !",setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function NC(){try{await Promise.all([ec(h.value),co(dt.value,Ge.value,h.value),qs(h.value)]).then(([y,m,C])=>{if(dt.value=y,wn.value=m,et.value=C,vl(),ct.value){const q=y.find(Q=>Q.id===ct.value.id);q&&(ct.value=q)}}),be.value=!0,nt.value="Données mises à jour !",setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function OC(y){if(!y)return{availability:0,selection:0,ratio:0};const m=E(y.name),C=b(y.name),q=m===0?0:Math.round(C/m*100);return{availability:m,selection:C,ratio:q}}function Il(y){const m=ar(y),C=Ge.value.find(Se=>Se.id===y),q=(C==null?void 0:C.playerCount)||6,Q=K(y),Z=ru(y),le=Xi(y);if(m.length===0)return{type:"ready",availableCount:Q,requiredCount:q,isConfirmedByOrganizer:!1,isConfirmedByAllPlayers:!1};if(m.length>0){const Se=m.some(De=>!Zn(De,y)),Be=Q<q;if(Se||Be)return{type:"incomplete",hasUnavailablePlayers:Se,hasInsufficientPlayers:Be,unavailablePlayers:m.filter(De=>!Zn(De,y)),availableCount:Q,requiredCount:q,isConfirmedByOrganizer:Z,isConfirmedByAllPlayers:le}}return Q<q?{type:"insufficient",availableCount:Q,requiredCount:q,isConfirmedByOrganizer:!1,isConfirmedByAllPlayers:!1}:le?{type:"confirmed",availableCount:Q,requiredCount:q,isConfirmedByOrganizer:Z,isConfirmedByAllPlayers:le}:Z?{type:"pending_confirmation",availableCount:Q,requiredCount:q,isConfirmedByOrganizer:Z,isConfirmedByAllPlayers:le}:{type:"complete",availableCount:Q,requiredCount:q,isConfirmedByOrganizer:Z,isConfirmedByAllPlayers:le}}function dm(y){const m=Il(y);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles (non confirmée)`;case"pending_confirmation":return`Sélection à confirmer : ${m.availableCount} joueurs disponibles (en attente de confirmation des joueurs)`;case"confirmed":return`Sélection confirmée : ${m.availableCount} joueurs disponibles (tous ont confirmé)`;default:return""}}async function VC(){const y=[];for(const m of dt.value){if(!await Ws(m.id,h.value))continue;const q=await WP(m.id,h.value);q&&y.push({...m,email:q})}return y}function tu(y){if(y!=null&&y.archived){be.value=!0,nt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{be.value=!1},3e3);return}G0(),_n.value=y,ut.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(y==null?void 0:y.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function K0(){ut.value=!1,_n.value=null;try{const y=new URLSearchParams(window.location.search);y.get("modal")==="announce"&&(y.delete("modal"),y.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${y.toString()}`))}catch{}}function G0(){wr.value=!1,Mr.value=null}const nu=A(!1);async function Q0({eventId:y,eventData:m,reason:C,selectedPlayers:q,scope:Q="all",recipient:Z=null}){nu.value=!0;let le=!1;try{if(C==="selection"){if(!ru(y)){be.value=!0,nt.value="Impossible d'envoyer les notifications : la sélection n'est pas encore validée par l'organisateur",setTimeout(()=>{be.value=!1},3e3),nu.value=!1;return}Q==="single"&&(Z!=null&&Z.email)?await Qx({eventId:y,eventData:m,selectedPlayers:[Z.name],seasonId:h.value,seasonSlug:c,players:Qi.value,isConfirmedTeam:Xi(y)}):await Qx({eventId:y,eventData:m,selectedPlayers:q,seasonId:h.value,seasonSlug:c,players:Qi.value,isConfirmedTeam:Xi(y)}),le=!0,be.value=!0;const Se=Xi(y);nt.value=Q==="single"?`Notification envoyée à ${(Z==null?void 0:Z.name)||"1 joueur"}`:Se?"Notifications d'équipe confirmée envoyées à tous les joueurs !":"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{be.value=!1},3e3)}else Q==="single"&&(Z!=null&&Z.email)?await Gx({eventId:y,eventData:m,players:[Z],seasonId:h.value,seasonSlug:c,createMagicLink:Gf,reminder:!1,getAvailabilityForEvent:(Se,Be)=>Zn(Se,Be)}):await Gx({eventId:y,eventData:m,players:await VC(),seasonId:h.value,seasonSlug:c,createMagicLink:Gf,reminder:!1,getAvailabilityForEvent:(Se,Be)=>Zn(Se,Be)}),le=!0,be.value=!0,nt.value=Q==="single"?`Notification envoyée à ${(Z==null?void 0:Z.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{be.value=!1},3e3)}catch{console.error("Erreur lors de l'envoi des notifications"),be.value=!0,nt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{be.value=!1},3e3)}finally{nu.value=!1,le&&setTimeout(()=>{K0()},1e3)}}function hm(y){if(!y)return{};const m={};return dt.value.forEach(C=>{m[C.name]=Zn(C.name,y)}),m}function ar(y){const m=et.value[y];return m?m.players&&Array.isArray(m.players)?m.players:Array.isArray(m)?m:[]:[]}function Xi(y){const m=et.value[y];return m?typeof m.confirmedByAllPlayers=="boolean"?m.confirmedByAllPlayers:typeof m.confirmed=="boolean"&&m.confirmed&&m.playerStatuses&&m.players?m.players.every(q=>m.playerStatuses[q]==="confirmed"):!1:!1}function ru(y){const m=et.value[y];return m&&typeof m.confirmed=="boolean"?m.confirmed:!1}function J0(y,m){const C=et.value[m];return C&&C.playerStatuses&&C.playerStatuses[y]?C.playerStatuses[y]:"pending"}function su(y){if(y!=null&&y.archived){be.value=!0,nt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{be.value=!1},3e3);return}Xe.value=y,bn.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(y==null?void 0:y.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function Y0(){bn.value=!1,Xe.value=null;try{const y=new URLSearchParams(window.location.search);y.get("modal")==="selection"&&(y.delete("modal"),y.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${y.toString()}`))}catch{}}async function MC(){if(!Xe.value)return;const y=Xe.value.id,m=Xe.value.playerCount||6;if(K(y)===0){be.value=!0,nt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{be.value=!1},3e3);return}await da({type:"launchSelection",data:{eventId:y,count:m}})}async function LC(){Y0(),be.value=!0,nt.value="Sélection validée !",setTimeout(()=>{be.value=!1},3e3)}async function $C(){if(!Xe.value)return;const y=Xe.value.id;try{const{confirmSelection:m}=await je(()=>Promise.resolve().then(()=>Ul),void 0);if(await m(y,h.value),et.value[y])if(typeof et.value[y]=="object"&&et.value[y].players)et.value[y].confirmed=!0,et.value[y].confirmedAt=new Date;else{const C=Array.isArray(et.value[y])?et.value[y]:[];et.value[y]={players:C,confirmed:!0,confirmedAt:new Date,updatedAt:new Date}}be.value=!0,nt.value="Sélection validée !",setTimeout(()=>{be.value=!1},3e3)}catch(m){console.error("Erreur lors de la confirmation de la sélection:",m),be.value=!0,nt.value="Erreur lors de la confirmation de la sélection",setTimeout(()=>{be.value=!1},3e3)}}async function FC(){if(!Xe.value)return;const y=Xe.value.id;try{await da({type:"unconfirmSelection",data:{eventId:y}})}catch(m){console.error("Erreur lors de la demande de déverrouillage:",m)}}async function UC(y){if(!y||!y.eventId)return;const{eventId:m,players:C}=y;await da({type:"updateSelection",data:{eventId:m,players:C}})}async function fm(y,m){if(!y||!m)return;Z0(),Xr.value=y,ml.value=!0,await kt();const C=document.querySelector(`[data-event-id="${y}"]`);if(!C){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(le=>{le.classList.remove("focused-event-highlight")});const q=document.querySelectorAll(`[data-event-id="${y}"]`);q.forEach(le=>{le.classList.add("focused-event-highlight")});const Q=q[0],Z=q[q.length-1];Q&&Q.classList.add("focused-event-column-start"),Z&&Z.classList.add("focused-event-column-end"),await jC(C),be.value=!0,nt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{be.value=!1},4e3),Yo.value=setTimeout(()=>{Z0()},8e3)}function X0(y){if(!y)return;const m=Ge.value.find(C=>C.id===y);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const C=Ge.value.find(q=>q.id===y);C?fm(y,C):console.error("Événement toujours introuvable après retry")},500);return}fm(y,m)}Pt(Ge,y=>{try{const m=new URLSearchParams(window.location.search),C=m.get("modal"),q=m.get("event");if(!C||!q)return;const Q=y.find(Z=>Z.id===q);if(!Q)return;C==="announce"&&tu(Q),C==="selection"&&su(Q)}catch{}},{immediate:!0});async function jC(y){if(!y)return;if(await new Promise(C=>setTimeout(C,100)),window.innerWidth<=768){const C=Zr.value;if(C){const q=y.offsetLeft,Q=y.offsetWidth,Z=C.clientWidth,le=q-Z/2+Q/2,Se=C.scrollWidth-Z,Be=Math.max(0,Math.min(le,Se));C.scrollTo({left:Be,behavior:"smooth"}),setTimeout(()=>{const De=y.getBoundingClientRect();if(De.left<0||De.right>window.innerWidth){const Je=q-20;C.scrollTo({left:Math.max(0,Je),behavior:"smooth"})}},500)}}else y.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=Zr.value;m&&setTimeout(()=>{const C=document.querySelector(`[data-event-id="${Xr.value}"]`);if(C&&C.closest("tbody")){const q=C.offsetLeft,Q=C.offsetWidth,Z=m.clientWidth,le=q-Z/2+Q/2,Se=m.scrollWidth-Z,Be=Math.max(0,Math.min(le,Se));m.scrollTo({left:Be,behavior:"smooth"})}},300)}function Z0(){Yo.value&&(clearTimeout(Yo.value),Yo.value=null),Xr.value=null,ml.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(y=>{y.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(y=>{y.classList.remove("focused-event-column-start","focused-event-column-end")})}async function qC(y){var m;if(!y)return!1;try{if(!((m=s.value)!=null&&m.email))return!1;const{db:C}=await je(()=>Promise.resolve().then(()=>vr),void 0),{doc:q,getDoc:Q}=await je(()=>import("./index.esm-fc00cd90.js"),[]),Z=await Q(q(C,"userPreferences",s.value.email));if(Z.exists()){const le=Z.data(),Se=le.notifyAvailability===!0||le.notifySelection===!0,Be=(le.notifyAvailabilityPush===!0||le.notifySelectionPush===!0)&&!!localStorage.getItem("fcmToken");return Se||Be}return!1}catch(C){return console.error("Erreur lors de la vérification de surveillance:",C),!1}}function BC(y){y&&(Vt.value={playerName:"Vous",eventTitle:y.title||"ce spectacle",seasonId:h.value,seasonSlug:e.slug,eventId:y.id},setTimeout(()=>{Kt.value=!0},500))}function zC(y){Kt.value=!1,Vt.value=null,be.value=!0,y.directActivation?nt.value=`Notifications activées directement pour ${y.playerName} !`:nt.value=`Email envoyé à ${y.email} pour activer les notifications !`,setTimeout(()=>{be.value=!1},4e3),M.info("Activation des notifications terminée avec succès",y)}function HC(y){Kt.value=!1,Vt.value=null,localStorage.setItem("pendingNotificationData",JSON.stringify({email:y.email,playerName:y.playerName,eventId:y.eventId,seasonId:y.seasonId,seasonSlug:y.seasonSlug,eventTitle:y.eventTitle})),y.email&&localStorage.setItem("prefilledEmail",y.email),ks.value=!0,M.info("Affichage du popup de connexion pour utilisateur existant",y)}async function WC(y){ks.value=!1;const m=localStorage.getItem("pendingNotificationData");if(y.action==="login_success"&&m){console.log("🎯 Connexion réussie, activation des notifications...");try{const C=JSON.parse(m),{activateNotificationsForConnectedUser:q}=await je(()=>Promise.resolve().then(()=>Yf),void 0),Q=await q({seasonId:C.seasonId,eventId:C.eventId,playerName:C.playerName,email:y.email,eventTitle:C.eventTitle,seasonSlug:C.seasonSlug});be.value=!0,nt.value=`Notifications activées avec succès pour ${C.playerName} !`,setTimeout(()=>{be.value=!1},4e3),localStorage.removeItem("pendingNotificationData"),M.info("Notifications activées avec succès après connexion",Q)}catch(C){console.error("❌ Erreur lors de l'activation des notifications après connexion:",C),Xn.value=!0,Ms.value="Erreur lors de l'activation des notifications. Veuillez réessayer.",setTimeout(()=>{Xn.value=!1},5e3),localStorage.removeItem("pendingNotificationData")}}else console.log("🔐 Connexion normale, affichage du menu du compte"),Yr.value=!0}function KC(y){pn.value=!1,Yn.value=null,be.value=!0,(y==null?void 0:y.action)==="protection_activated"?(nt.value="Protection activée et compte connecté !",M.info("Protection activée et utilisateur connecté automatiquement",y)):(nt.value="Protection activée avec succès !",M.info("Protection des saisies activée avec succès",y)),setTimeout(()=>{be.value=!1},4e3)}return(y,m)=>{var C,q,Q,Z,le,Se,Be,De,Je,Rt,gn,kn,cn,lr,vs,nn,Fr,iu,ou,Tl,eb,tb,nb,rb,sb,ib,ob,ab,lb,cb,ub,db,hb,fb,pb,mb;return k(),D(wt,null,[d("div",SW,[ze(UH,{"season-name":f.value,"is-scrolled":v.value,"season-slug":e.slug,onGoBack:SC,onOpenAccountMenu:oh,onOpenHelp:m[0]||(m[0]=X=>Un.value=!0),onOpenNotifications:Fc,onOpenPlayers:ah,onLogout:pl,onOpenLogin:ch,onOpenAccount:ch,onOpenAccountCreation:fl},null,8,["season-name","is-scrolled","season-slug"]),d("div",AW,[d("div",{ref_key:"headerBarRef",ref:li,class:"sticky top-0 z-[100] bg-gray-900 overflow-hidden"},[d("div",PW,[Ge.value.length===0&&dt.value.length===0?se("",!0):(k(),D("div",CW,[d("div",RW,[d("button",{onClick:Kc,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouveau spectacle"},m[83]||(m[83]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter un spectacle",-1),d("span",{class:"sm:hidden"},"Spectacle",-1)])),d("div",{onClick:AC,class:"flex items-center justify-center p-1 relative z-[102] cursor-pointer hover:bg-white/10 rounded-lg transition-colors duration-200",title:`Cliquer pour rafraîchir ${f.value}`},[(C=p.value)!=null&&C.logoUrl?(k(),D("div",DW,[d("img",{src:p.value.logoUrl,alt:`Logo de ${f.value}`,class:"w-full h-full object-cover"},null,8,NW)])):(k(),D("span",OW,"🎭"))],8,kW)])])),d("div",VW,[d("div",{ref_key:"headerEventsRef",ref:mn,class:"flex relative z-[60]",style:Ur({transform:`translateX(-${zc.value}px)`})},[(k(!0),D(wt,null,qr(Rr.value,X=>(k(),D("div",{key:"h-"+X.id,"data-event-id":X.id,class:$t(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":X.archived}])},[d("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:X.title+" - Cliquez pour voir les détails",onClick:At(xn=>wh(X),["stop"])},[d("div",$W,[d("div",FW,ie(X.title||"Sans titre"),1),X.archived?(k(),D("div",UW,"(Archivé)")):se("",!0)]),d("div",jW,[d("div",{class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 px-2 py-1 rounded",title:g(X.date)},ie(u(X.date)),9,qW)])],8,LW),d("div",BW,[X.archived?(k(),D("div",zW,m[84]||(m[84]=[d("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),d("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):Il(X.id).type==="ready"?(k(),D("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:dm(X.id)+" - Cliquez pour ouvrir la sélection",onClick:At(xn=>su(X),["stop"])},m[85]||(m[85]=[d("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),d("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,HW)):Il(X.id).type?(k(),ns(gv,{key:2,status:Il(X.id).type,show:!0,clickable:!0,class:"mx-auto cursor-pointer group",title:dm(X.id)+" - Cliquez pour ouvrir la sélection",onClick:At(xn=>su(X),["stop"])},null,8,["status","title","onClick"])):se("",!0)])],10,MW))),128))],4)]),m[88]||(m[88]=d("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[101] bg-gray-900 h-full"},null,-1)),d("button",{onClick:Qc,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:di.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":di.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(k(),D("svg",KW,[m[86]||(m[86]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[87]||(m[87]=d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),di.value?se("",!0):(k(),D("path",GW))]))],8,WW),at(d("button",{onClick:m[1]||(m[1]=At(X=>Wc(-1,X),["prevent"])),onMousedown:m[2]||(m[2]=At(X=>gl(-1,X),["prevent"])),onMouseup:m[3]||(m[3]=X=>fs(X)),onMouseleave:m[4]||(m[4]=X=>fs(X)),onTouchstart:m[5]||(m[5]=At(X=>gl(-1,X),["prevent"])),onTouchend:m[6]||(m[6]=X=>fs(X)),onTouchcancel:m[7]||(m[7]=X=>fs(X)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Tm,qc.value]]),at(d("button",{onClick:m[8]||(m[8]=At(X=>Wc(1,X),["prevent"])),onMousedown:m[9]||(m[9]=At(X=>gl(1,X),["prevent"])),onMouseup:m[10]||(m[10]=X=>fs(X)),onMouseleave:m[11]||(m[11]=X=>fs(X)),onTouchstart:m[12]||(m[12]=At(X=>gl(1,X),["prevent"])),onTouchend:m[13]||(m[13]=X=>fs(X)),onTouchcancel:m[14]||(m[14]=X=>fs(X)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Tm,Bc.value]])])],512),at(d("div",{ref_key:"gridboardRef",ref:Zr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[ot.value===1?(k(),D("div",QW,[S.value.position?(k(),D("div",{key:0,class:"fixed z-[400]",style:Ur({left:S.value.position.x+"px",top:S.value.position.y+"px"})},[d("div",{id:"coachmark-add",class:$t(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":S.value.side==="right","coachmark-left":S.value.side==="left"}])},[m[90]||(m[90]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[91]||(m[91]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter une personne" pour vous inscrire',-1)),d("div",JW,[m[89]||(m[89]=d("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),d("button",{onClick:m[15]||(m[15]=X=>Fs(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):se("",!0)])):se("",!0),ot.value===2&&V.value&&P.value?(k(),D("div",YW,[$.value.position?(k(),D("div",{key:0,class:"fixed z-[400]",style:Ur({position:"absolute",left:$.value.position.x+"px",top:$.value.position.y+"px"})},[d("div",XW,[m[93]||(m[93]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[94]||(m[94]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),d("div",ZW,[m[92]||(m[92]=d("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),d("button",{onClick:m[16]||(m[16]=X=>Fs(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):se("",!0)])):se("",!0),ot.value===3&&V.value?(k(),D("div",eK,[F.value.position?(k(),D("div",{key:0,class:"fixed z-[400]",style:Ur({position:"absolute",left:F.value.position.x+"px",top:F.value.position.y+"px"})},[d("div",tK,[m[96]||(m[96]=d("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[97]||(m[97]=d("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),d("div",nK,[m[95]||(m[95]=d("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),d("button",{onClick:m[17]||(m[17]=X=>Fs(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):se("",!0)])):se("",!0),d("table",rK,[d("colgroup",null,[m[98]||(m[98]=d("col",{class:"col-left"},null,-1)),(k(!0),D(wt,null,qr(Rr.value,(X,xn)=>(k(),D("col",{key:"c"+xn,class:"col-event"}))),128)),m[99]||(m[99]=d("col",{class:"col-right"},null,-1))]),m[103]||(m[103]=d("thead",{class:"hidden"},null,-1)),d("tbody",null,[(k(!0),D(wt,null,qr(ui.value,X=>{var xn;return k(),D("tr",{key:X.id,class:$t(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":X.id===ae.value,"preferred-player":zn.value.has(X.id)}]),"data-player-id":X.id},[d("td",iK,[d("div",oK,[zn.value.has(X.id)?(k(),D("span",aK," ⭐ ")):ea(X.id)?(k(),D("span",lK," 🔒 ")):se("",!0),d("div",{onClick:er=>El(X),class:$t(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":ot.value===3&&X.id===(V.value||((xn=ui.value[0])==null?void 0:xn.id))}]),title:"Cliquez pour voir les détails : "+X.name},[d("span",uK,ie(X.name),1)],10,cK)])]),(k(!0),D(wt,null,qr(Rr.value,er=>{var gb,vb,yb;return k(),D("td",{key:er.id,"data-event-id":er.id,class:$t(["p-0",er.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":ot.value===2&&X.id===(V.value||((gb=ui.value[0])==null?void 0:gb.id))&&er.id===(P.value||((vb=Rr.value[0])==null?void 0:vb.id))}])},[ze(Jx,{"player-name":X.name,"event-id":er.id,"is-available":Zn(X.name,er.id),"is-selected":Er(X.name,er.id),"is-selection-confirmed":Xi(er.id),"is-selection-confirmed-by-organizer":ru(er.id),"player-selection-status":J0(X.name,er.id),"season-id":h.value,"chance-percent":((yb=oa.value[X.name])==null?void 0:yb[er.id])??null,"show-selected-chance":Ee(er.id),disabled:er.archived===!0,onToggle:hi,onToggleSelectionStatus:Yc},null,8,["player-name","event-id","is-available","is-selected","is-selection-confirmed","is-selection-confirmed-by-organizer","player-selection-status","season-id","chance-percent","show-selected-chance","disabled"])],10,dK)}),128)),m[100]||(m[100]=d("td",{class:"p-3 md:p-4"},null,-1))],10,sK)}),128)),d("tr",hK,[d("td",fK,[d("div",pK,[d("button",{onClick:m[18]||(m[18]=X=>j.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter une nouvelle personne","data-onboarding":"add-player"},m[101]||(m[101]=[d("span",{class:"text-lg"},"➕",-1),d("span",{class:"hidden sm:inline"},"Ajouter une personne",-1),d("span",{class:"sm:hidden"},"Personne",-1)]))])]),(k(!0),D(wt,null,qr(Rr.value,X=>(k(),D("td",{key:"add-row-"+X.id,"data-event-id":X.id,class:$t(["p-3 md:p-5",X.archived?"archived-col":""])},null,10,mK))),128)),m[102]||(m[102]=d("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Tm,!Ns.value]])])]),Ns.value?(k(),D("div",gK,[d("div",vK,[m[104]||(m[104]=d("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[d("span",{class:"text-3xl"},"🎭")],-1)),d("p",yK,ie(ai.value)+"…",1),d("div",bK,[d("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:Ur({width:ds.value+"%"})},null,4)]),d("p",_K,ie(ds.value)+"%",1)])])):se("",!0),Ns.value?se("",!0):(k(),ns(OH,{key:1,"season-id":h.value,"season-slug":Br(c),"players-count":dt.value.length,"events-count":Ge.value.length,"onboarding-done":((q=p.value)==null?void 0:q.onboardingCreatorDone)===!0,onCreateEvent:Kc,onAddPlayer:m[19]||(m[19]=()=>{j.value=!0}),onCopyLink:Ls,onDismissed:jc},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),se("",!0),be.value?(k(),D("div",wK,[d("div",xK,[m[105]||(m[105]=d("span",{class:"text-xl"},"✨",-1)),d("span",null,ie(nt.value),1)])])):se("",!0),Xn.value?(k(),D("div",EK,[d("div",IK,[m[106]||(m[106]=d("span",{class:"text-xl"},"⚠️",-1)),d("span",null,ie(Ms.value),1)])])):se("",!0),na.value?(k(),D("div",TK,[d("div",SK,[m[112]||(m[112]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau spectacle",-1)),d("div",AK,[m[107]||(m[107]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),at(d("input",{"onUpdate:modelValue":m[20]||(m[20]=X=>$s.value=X),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre du spectacle"},null,512),[[Ot,$s.value]])]),d("div",PK,[m[108]||(m[108]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),at(d("input",{"onUpdate:modelValue":m[21]||(m[21]=X=>Ft.value=X),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Ot,Ft.value]])]),d("div",CK,[m[109]||(m[109]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),at(d("textarea",{"onUpdate:modelValue":m[22]||(m[22]=X=>ra.value=X),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description du spectacle (optionnel)"},null,512),[[Ot,ra.value]])]),d("div",RK,[at(d("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[23]||(m[23]=X=>ia.value=X),class:"w-4 h-4"},null,512),[[ts,ia.value]]),m[110]||(m[110]=d("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),d("div",kK,[m[111]||(m[111]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de personnes à sélectionner",-1)),at(d("input",{"onUpdate:modelValue":m[24]||(m[24]=X=>sa.value=X),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Ot,sa.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:wl,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:fh,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):se("",!0),j.value?(k(),D("div",DK,[d("div",NK,[m[114]||(m[114]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle personne",-1)),d("div",OK,[m[113]||(m[113]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),at(d("input",{"onUpdate:modelValue":m[25]||(m[25]=X=>ne.value=X),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom de la personne"},null,512),[[Ot,ne.value]])]),d("div",VK,[d("button",{onClick:m[26]||(m[26]=X=>j.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:ta,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):se("",!0),x.value?(k(),D("div",MK,[d("div",LK,[m[115]||(m[115]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce spectacle ?</p></div>',1)),d("div",$K,[d("button",{onClick:bl,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:m[27]||(m[27]=()=>yl()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):se("",!0),gs.value?(k(),D("div",FK,[d("div",UK,[m[116]||(m[116]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cette personne ?</p></div>',1)),d("div",jK,[d("button",{onClick:xl,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:m[28]||(m[28]=()=>$r()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):se("",!0),U.value?(k(),D("div",qK,[d("div",BK,[d("div",zK,[m[117]||(m[117]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"🎭")],-1)),m[118]||(m[118]=d("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),d("p",HK,[O.value&&ar(O.value).every(X=>Zn(X,O.value))?(k(),D("span",WK,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(k(),D("span",KK,"La sélection sera mise à jour : les personnes disponibles seront conservées, les slots vides seront complétés."))])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:gC,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{onClick:mC,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):se("",!0),we.value?(k(),D("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:xh},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[45]||(m[45]=At(()=>{},["stop"]))},[d("div",GK,[d("button",{onClick:xh,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),d("div",QK,[m[126]||(m[126]=d("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[d("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),d("div",JK,[d("div",YK,[d("h2",XK,ie((Q=ee.value)==null?void 0:Q.title),1),d("div",ZK,[m[119]||(m[119]=d("span",{class:"text-blue-300 hidden md:inline"},"👥",-1)),d("span",eG,ie(((Z=ee.value)==null?void 0:Z.playerCount)||6)+" personnes",1)])]),d("div",tG,[d("p",nG,ie(g((le=ee.value)==null?void 0:le.date)),1)]),d("div",rG,[d("div",sG,[d("button",{onClick:m[29]||(m[29]=X=>de()),class:"px-3 py-1.5 bg-purple-500/20 border border-purple-400/30 rounded text-sm flex items-center gap-2 hover:bg-purple-500/30 transition-colors duration-200 cursor-pointer",title:"Ajouter à votre agenda"},m[120]||(m[120]=[d("span",{class:"text-purple-300"},"📅",-1),d("span",{class:"text-purple-200"},"Ajouter à l'agenda",-1)])),Xt.value?(k(),D("div",iG,[d("div",oG,[d("button",{onClick:m[30]||(m[30]=X=>{um("google"),W()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[121]||(m[121]=[d("span",null,"🌐",-1),d("span",null,"Google Calendar",-1)])),d("button",{onClick:m[31]||(m[31]=X=>{um("outlook"),W()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[122]||(m[122]=[d("span",null,"📧",-1),d("span",null,"Outlook",-1)])),d("button",{onClick:m[32]||(m[32]=X=>{um("ics"),W()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[123]||(m[123]=[d("span",null,"📥",-1),d("span",null,"Télécharger (.ics)",-1)]))])])):se("",!0)]),a.value?(k(),D("div",aG,m[124]||(m[124]=[d("span",{class:"text-purple-300"},"✅",-1),d("span",{class:"text-purple-200"},"Notifications activées",-1)]))):(k(),D("button",{key:1,onClick:m[33]||(m[33]=X=>BC(ee.value)),class:"flex items-center gap-2 px-3 py-1.5 bg-purple-500/20 border border-purple-400/30 rounded text-sm hover:bg-purple-500/30 transition-colors duration-200 cursor-pointer",title:"Reçois des alertes en temps réel : sélections, changements d'horaires, et plus !"},m[125]||(m[125]=[d("span",{class:"text-purple-300"},"🔔",-1),d("span",{class:"text-purple-200"},"Activer les notifications",-1)])))]),(Se=ee.value)!=null&&Se.description?(k(),D("div",lG,ie(ee.value.description),1)):se("",!0)])])]),d("div",cG,[d("div",uG,[d("div",dG,[d("div",hG,ie(K((Be=ee.value)==null?void 0:Be.id)),1),m[127]||(m[127]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),d("div",fG,[d("div",pG,ie(re((De=ee.value)==null?void 0:De.id)),1),m[128]||(m[128]=d("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),d("div",mG,[d("div",gG,ie(Math.max((((Je=ee.value)==null?void 0:Je.playerCount)||6)-re((Rt=ee.value)==null?void 0:Rt.id),0)),1),m[129]||(m[129]=d("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),ee.value?(k(),D("div",vG,[d("div",yG,[yh.value?(k(),D("div",{key:0,class:$t(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[50%] truncate",((gn=ua.value)==null?void 0:gn.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:Jc.value},[m[130]||(m[130]=d("span",null,"⚠️",-1)),d("span",_G,ie(Jc.value),1)],10,bG)):se("",!0),ee.value&&ar(ee.value.id).length>0?(k(),ns(gv,{key:1,status:(kn=ua.value)==null?void 0:kn.type,show:!0,clickable:!1},null,8,["status"])):se("",!0),at(d("select",{"onUpdate:modelValue":m[34]||(m[34]=X=>ca.value=X),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[131]||(m[131]=[rr('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[m2,ca.value]])]),d("div",wG,[(k(!0),D(wt,null,qr(vh.value,X=>{var xn,er;return k(),D("div",{key:X.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[d("div",xG,[zn.value.has(X.id)?(k(),D("span",EG," ⭐ ")):ea(X.id)?(k(),D("span",IG," 🔒 ")):se("",!0),d("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:X.name},ie(X.name),9,TG)]),d("div",SG,[ze(Jx,{"player-name":X.name,"event-id":ee.value.id,"is-available":hm(ee.value.id)[X.name],"is-selected":RC(X.name,ee.value.id),"is-selection-confirmed":Xi(ee.value.id),"is-selection-confirmed-by-organizer":ru(ee.value.id),"player-selection-status":J0(X.name,ee.value.id),"season-id":h.value,"chance-percent":((xn=oa.value[X.name])==null?void 0:xn[ee.value.id])??null,"show-selected-chance":Ee(ee.value.id),disabled:((er=ee.value)==null?void 0:er.archived)===!0,compact:!0,onToggle:CC,onToggleSelectionStatus:Yc},null,8,["player-name","event-id","is-available","is-selected","is-selection-confirmed","is-selection-confirmed-by-organizer","player-selection-status","season-id","chance-percent","show-selected-chance","disabled"])])])}),128))])])):se("",!0),d("div",AG,[d("button",{onClick:m[35]||(m[35]=X=>tu(ee.value)),disabled:(cn=ee.value)==null?void 0:cn.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(lr=ee.value)!=null&&lr.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux personnes (email, copie, WhatsApp)"},m[132]||(m[132]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,PG),d("button",{onClick:m[36]||(m[36]=X=>su(ee.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[133]||(m[133]=[d("span",null,"🎭",-1),d("span",null,"Sélection Équipe",-1)])),d("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:Qe},[d("button",{onClick:m[37]||(m[37]=X=>Ko()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[134]||(m[134]=[d("span",null,"⋯",-1)]))],512),d("button",{onClick:xh,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(k(),ns(ed,{to:"body"},[Re.value?(k(),D("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:We,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:Ur(rt.value)},[d("button",{onClick:m[38]||(m[38]=X=>{z0(),Re.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[135]||(m[135]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[39]||(m[39]=X=>{H0(),Re.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(vs=ee.value)!=null&&vs.archived?"Désarchiver cet événement":"Archiver cet événement"},[d("span",null,ie((nn=ee.value)!=null&&nn.archived?"📂":"📁"),1),d("span",null,ie((Fr=ee.value)!=null&&Fr.archived?"Désarchiver":"Archiver"),1)],8,CG),d("button",{onClick:m[40]||(m[40]=X=>{var xn;hh((xn=ee.value)==null?void 0:xn.id),Re.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:"Supprimer complètement la sélection et remettre le statut à 'Nouveau'"},m[136]||(m[136]=[d("span",null,"🔄",-1),d("span",null,"Réinitialiser",-1)])),d("button",{onClick:m[41]||(m[41]=X=>{var xn;dh((xn=ee.value)==null?void 0:xn.id),Re.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[137]||(m[137]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):se("",!0)]))])]),d("div",RG,[d("button",{onClick:m[42]||(m[42]=X=>tu(ee.value)),disabled:(iu=ee.value)==null?void 0:iu.archived,class:"h-12 px-4 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex-[1.4] disabled:opacity-50 disabled:cursor-not-allowed"},"📢 Annoncer",8,kG),d("button",{onClick:m[43]||(m[43]=X=>su(ee.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélection Équipe"),d("button",{onClick:xh,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),d("button",{onClick:m[44]||(m[44]=X=>Go()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):se("",!0),(k(),ns(ed,{to:"body"},[ye.value?(k(),D("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:gt,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:Ur(fn.value)},[d("button",{onClick:m[46]||(m[46]=X=>{tu(ee.value),ye.value=!1}),disabled:(ou=ee.value)==null?void 0:ou.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(Tl=ee.value)!=null&&Tl.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux personnes (email, copie, WhatsApp)"},m[138]||(m[138]=[d("span",null,"📢",-1),d("span",null,"Annoncer",-1)]),8,DG),d("button",{onClick:m[47]||(m[47]=X=>{z0(),ye.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[139]||(m[139]=[d("span",null,"✏️",-1),d("span",null,"Modifier",-1)])),d("button",{onClick:m[48]||(m[48]=X=>{H0(),ye.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[d("span",null,ie((eb=ee.value)!=null&&eb.archived?"📂":"📁"),1),d("span",null,ie((tb=ee.value)!=null&&tb.archived?"Désarchiver":"Archiver"),1)]),d("button",{onClick:m[49]||(m[49]=X=>{var xn;hh((xn=ee.value)==null?void 0:xn.id),ye.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:"Supprimer complètement la sélection et remettre le statut à 'Nouveau'"},m[140]||(m[140]=[d("span",null,"🔄",-1),d("span",null,"Réinitialiser",-1)])),d("button",{onClick:m[50]||(m[50]=X=>{var xn;dh((xn=ee.value)==null?void 0:xn.id),ye.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[141]||(m[141]=[d("span",null,"🗑️",-1),d("span",null,"Supprimer",-1)]))],4)):se("",!0)])),ze(j0,{show:xe.value,player:Ue.value,seasonId:h.value,onClose:m[51]||(m[51]=X=>xe.value=!1),onVerified:kC},null,8,["show","player","seasonId"]),w.value?(k(),D("div",NG,[d("div",OG,[m[147]||(m[147]=d("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier le spectacle",-1)),d("div",VG,[m[142]||(m[142]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),at(d("input",{"onUpdate:modelValue":m[52]||(m[52]=X=>T.value=X),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[tr(ms,["esc"]),tr(_l,["enter"])],ref:"editTitleInput"},null,544),[[Ot,T.value]])]),d("div",MG,[m[143]||(m[143]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),at(d("input",{"onUpdate:modelValue":m[53]||(m[53]=X=>N.value=X),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[tr(ms,["esc"]),tr(_l,["enter"])]},null,544),[[Ot,N.value]])]),d("div",LG,[m[144]||(m[144]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),at(d("textarea",{"onUpdate:modelValue":m[54]||(m[54]=X=>ge.value=X),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description du spectacle (optionnel)",onKeydown:tr(ms,["esc"])},null,544),[[Ot,ge.value]])]),d("div",$G,[at(d("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[55]||(m[55]=X=>Le.value=X),class:"w-4 h-4"},null,512),[[ts,Le.value]]),m[145]||(m[145]=d("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver ce spectacle",-1))]),d("div",FG,[m[146]||(m[146]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de personnes à sélectionner",-1)),at(d("input",{"onUpdate:modelValue":m[56]||(m[56]=X=>I.value=X),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:tr(ms,["esc"])},null,544),[[Ot,I.value]])]),d("div",{class:"flex justify-end space-x-3"},[d("button",{onClick:ms,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),d("button",{onClick:_l,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):se("",!0),ze(EP,{show:Ze.value,message:vC(),error:z.value,"session-info":TC(),onSubmit:bC,onCancel:_C},null,8,["show","message","error","session-info"]),ke.value?(k(),D("div",UG,[d("div",jG,[m[149]||(m[149]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de personne protégée</p><p class="text-sm text-gray-400 mt-2">Cette personne est protégée par mot de passe</p></div>',1)),d("div",qG,[d("div",BG,[d("div",null,[m[148]||(m[148]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de la personne",-1)),at(d("input",{"onUpdate:modelValue":m[57]||(m[57]=X=>mt.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[58]||(m[58]=tr(X=>q0(mt.value),["enter"])),ref_key:"playerPasswordInputRef",ref:On},null,544),[[Ot,mt.value]])])]),d("button",{onClick:m[59]||(m[59]=X=>q0(mt.value)),disabled:!mt.value||zt.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[zt.value?(k(),D("span",HG,"⏳")):(k(),D("span",WG,"🔓")),d("span",null,ie(zt.value?"Vérification...":"Vérifier et supprimer"),1)],8,zG)]),d("div",KG,[d("button",{onClick:m[60]||(m[60]=X=>fe.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),qe.value?(k(),D("div",GG,[d("div",QG,ie(qe.value),1)])):se("",!0),d("div",{class:"flex justify-center"},[d("button",{onClick:wC,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):se("",!0),Yt.value?(k(),D("div",JG,[d("div",YG,[m[152]||(m[152]=rr('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Cette personne est protégée par mot de passe</p></div>',1)),d("div",XG,[d("div",ZG,[d("div",null,[m[150]||(m[150]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe de la personne",-1)),at(d("input",{"onUpdate:modelValue":m[61]||(m[61]=X=>B.value=X),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[62]||(m[62]=tr(X=>B0(B.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:Ce},null,544),[[Ot,B.value]])])]),d("div",eQ,[d("button",{onClick:m[63]||(m[63]=X=>Ke.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Pe.value?(k(),D("div",tQ,[d("div",nQ,ie(Pe.value),1)])):se("",!0)]),d("div",rQ,[d("button",{onClick:xC,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),d("button",{onClick:m[64]||(m[64]=X=>B0(B.value)),disabled:!B.value||G.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[G.value?(k(),D("span",iQ,"⏳")):(k(),D("span",oQ,"🔓")),d("span",null,[lt(ie(G.value?"Vérification...":"Vérifier"),1),m[151]||(m[151]=d("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,sQ)])])])):se("",!0),Ke.value?(k(),D("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[67]||(m[67]=X=>Ke.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[66]||(m[66]=At(()=>{},["stop"]))},[m[154]||(m[154]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),d("div",aQ,[m[153]||(m[153]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à cette personne. ",-1)),d("button",{onClick:EC,disabled:R.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[R.value?(k(),D("span",cQ,"⏳")):(k(),D("span",uQ,"📧")),d("span",null,ie(R.value?"Envoi...":"Envoyer l'email"),1)],8,lQ)]),L.value?(k(),D("div",dQ,[d("div",hQ,ie(L.value),1)])):se("",!0),H.value?(k(),D("div",fQ,[d("div",pQ,ie(H.value),1)])):se("",!0),d("div",mQ,[d("button",{onClick:m[65]||(m[65]=X=>Ke.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):se("",!0),fe.value?(k(),D("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[70]||(m[70]=X=>fe.value=!1)},[d("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[69]||(m[69]=At(()=>{},["stop"]))},[m[156]||(m[156]=rr('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de personne protégée</p></div>',1)),d("div",gQ,[m[155]||(m[155]=d("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à cette personne. ",-1)),d("button",{onClick:IC,disabled:oe.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[oe.value?(k(),D("span",yQ,"⏳")):(k(),D("span",bQ,"📧")),d("span",null,ie(oe.value?"Envoi...":"Envoyer l'email"),1)],8,vQ)]),me.value?(k(),D("div",_Q,[d("div",wQ,ie(me.value),1)])):se("",!0),Ie.value?(k(),D("div",xQ,[d("div",EQ,ie(Ie.value),1)])):se("",!0),d("div",IQ,[d("button",{onClick:m[68]||(m[68]=X=>fe.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):se("",!0),ze(E7,{ref_key:"playerModalRef",ref:Ct,show:pt.value,player:ct.value,stats:OC(ct.value),seasonId:h.value,"onboarding-step":ot.value,"onboarding-player-id":V.value,"is-protected":ct.value?Lr.value.has(ct.value.id):!1,"is-preferred":ct.value?zn.value.has(ct.value.id):!1,onClose:W0,onUpdate:DC,onDelete:eu,onRefresh:NC,onAdvanceOnboarding:m[71]||(m[71]=X=>{try{typeof ot.value<"u"&&(ot.value.value=X)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),ze(bH,{ref_key:"selectionModalRef",ref:_r,show:bn.value,event:Xe.value,"current-selection":et.value[(nb=Xe.value)==null?void 0:nb.id]||[],"available-count":K((rb=Xe.value)==null?void 0:rb.id),"selected-count":re((sb=Xe.value)==null?void 0:sb.id),"player-availability":hm((ib=Xe.value)==null?void 0:ib.id),"season-id":h.value,"season-slug":Br(c),players:Qi.value,sending:nu.value,"is-selection-confirmed":Xi((ob=Xe.value)==null?void 0:ob.id),"is-selection-confirmed-by-organizer":ru((ab=Xe.value)==null?void 0:ab.id),onClose:Y0,onSelection:MC,onPerfect:LC,onSendNotifications:Q0,onUpdateSelection:UC,onConfirmSelection:$C,onUnconfirmSelection:FC},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players","sending","is-selection-confirmed","is-selection-confirmed-by-organizer"]),ze(dC,{show:ut.value,event:_n.value,"season-id":h.value,"season-slug":Br(c),players:Qi.value,sending:nu.value,"availability-by-player":hm((lb=_n.value)==null?void 0:lb.id),onClose:K0,onSendNotifications:Q0},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),ze(nz,{show:Un.value,onClose:m[72]||(m[72]=X=>Un.value=!1)},null,8,["show"]),ze(JP,{show:Yr.value,"season-id":h.value,onClose:hl,onManagePlayer:Ds,onChangePassword:uh,onLogoutDevice:pl,onDeleteAccount:Jo},null,8,["show","season-id"]),ze(YP,{show:Qo.value,onClose:Uc},null,8,["show"]),ze(XP,{show:Gi.value,onClose:lh,onManagePlayer:Ds},null,8,["show"]),ze(lW,{show:Kt.value,"player-name":((cb=Vt.value)==null?void 0:cb.playerName)||"","event-title":((ub=Vt.value)==null?void 0:ub.eventTitle)||"","season-id":h.value,"season-slug":Br(c),"event-id":((db=Vt.value)==null?void 0:db.eventId)||"",onClose:m[73]||(m[73]=X=>Kt.value=!1),onSuccess:zC,onShowLogin:HC},null,8,["show","player-name","event-title","season-id","season-slug","event-id"]),ze(fC,{show:pn.value,player:((hb=Yn.value)==null?void 0:hb.player)||null,"season-id":h.value,onClose:m[74]||(m[74]=X=>pn.value=!1),onUpdate:KC},null,8,["show","player","season-id"]),ze(TW,{show:yr.value,"player-name":((fb=br.value)==null?void 0:fb.playerName)||"",email:((pb=br.value)==null?void 0:pb.email)||"","season-slug":Br(c),"event-id":((mb=br.value)==null?void 0:mb.eventId)||null,onClose:m[75]||(m[75]=X=>yr.value=!1)},null,8,["show","player-name","email","season-slug","event-id"]),ze(hC,{show:Wi.value,player:us.value,"season-id":h.value,onClose:m[76]||(m[76]=X=>Wi.value=!1),onSuccess:m[77]||(m[77]=()=>{Wi.value=!1,Yr.value=!0})},null,8,["show","player","season-id"]),ze(TP,{show:ks.value,onClose:m[78]||(m[78]=X=>ks.value=!1),onSuccess:WC,onOpenAccountCreation:m[79]||(m[79]=X=>Ki.value=!0)},null,8,["show"]),ze(SP,{show:Ki.value,onClose:m[80]||(m[80]=X=>Ki.value=!1),onSuccess:m[81]||(m[81]=()=>{Ki.value=!1,Yr.value=!0})},null,8,["show"]),wr.value?(k(),D("div",TQ,[d("div",SQ,[m[157]||(m[157]=d("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer ce spectacle ?",-1)),m[158]||(m[158]=d("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux personnes pour qu'elles indiquent leur disponibilité",-1)),d("div",AQ,[d("button",{onClick:m[82]||(m[82]=X=>tu(Mr.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),d("button",{onClick:G0,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):se("",!0)],64)}}},PQ={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},CQ={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},RQ={key:0,class:"text-center py-8"},kQ={key:1,class:"text-center py-8"},DQ={class:"text-gray-300 mb-6"},NQ={key:2,class:"space-y-6"},OQ={class:"text-center"},VQ={class:"text-gray-300 mb-4"},MQ={class:"font-semibold text-white"},LQ={class:"space-y-4"},$Q=["disabled"],FQ={key:0,class:"animate-spin"},UQ={key:1},jQ={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},qQ={class:"text-red-300 text-sm"},BQ={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},zQ={class:"text-green-300 text-sm"},HQ={__name:"PasswordReset",setup(n){const e=Uo(),t=Za(),r=A(!0),s=A(""),i=A(""),o=A(""),a=A(""),l=A(""),c=A(!1),f=A(""),h=A(""),p=$e(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);In(async()=>{try{const{oobCode:_}=e.query;if(M.debug("Token reçu (masqué)"),!_){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=_;try{M.debug("Vérification du token et récupération de l'email...");const w=await i5(Ve,_);i.value=w,M.info("Email récupéré depuis le token:",w)}catch(w){M.error("Erreur lors de la vérification du token:",w),s.value="Lien de réinitialisation invalide ou expiré",r.value=!1;return}r.value=!1}catch(_){M.error("Erreur lors de la vérification du lien",_),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function v(){if(p.value){c.value=!0,f.value="",h.value="";try{M.debug("Début réinitialisation avec token (masqué)"),await r5(Ve,o.value,a.value),M.info("Mot de passe Firebase Auth mis à jour"),M.info("Réinitialisation terminée avec Firebase Auth");try{M.debug("Tentative de connexion automatique...");const _=await WA(Ve,i.value,a.value);M.info("Connexion automatique réussie après reset",{uid:_.user.uid}),localStorage.getItem("pendingAccountCreationNavigation")?h.value="Compte créé avec succès ! Redirection...":h.value="Mot de passe réinitialisé et connexion réussie ! Redirection...",setTimeout(()=>{x()},2e3)}catch(_){M.error("Erreur lors de la connexion automatique",_),h.value="Mot de passe réinitialisé ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{x()},3e3)}}catch(_){M.error("Erreur lors de la réinitialisation",_),_.code==="auth/weak-password"?f.value="Le mot de passe doit contenir au moins 6 caractères":_.code==="auth/invalid-action-code"?f.value="Lien de réinitialisation invalide ou expiré":f.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}async function x(){try{let _=localStorage.getItem("pendingAccountCreationNavigation"),w=!0;if(_||(_=localStorage.getItem("pendingPasswordResetNavigation"),w=!1),_)try{const N=JSON.parse(_),{lastVisitedPage:I,timestamp:j,email:ne}=N,ae=Date.now()-j<36e5,V=ne===i.value;if(ae&&V&&Bx(I)){if(M.info("✅ Redirection vers la page sauvegardée:",I),w?(localStorage.removeItem("pendingAccountCreationNavigation"),M.info("🎉 Compte créé avec succès, redirection vers la page d'origine")):(localStorage.removeItem("pendingPasswordResetNavigation"),M.info("🔑 Mot de passe réinitialisé, redirection vers la page d'origine")),N.returnToAccountMenu){const P=new URL(I,window.location.origin),S=new URLSearchParams(P.search);if(N.modalState){const{modalState:F}=N;F.eventId&&(S.set("event",F.eventId),S.set("modal","event_details")),F.playerId&&(S.set("player",F.playerId),S.set("modal","player_details")),S.set("open","account")}const $=`${P.pathname}?${S.toString()}`;M.info('🔄 Redirection vers "Mon Compte" avec état complet:',$),t.push($)}else t.push(I);return}else M.info("⚠️ Navigation sauvegardée invalide ou expirée, nettoyage..."),localStorage.removeItem("pendingPasswordResetNavigation")}catch(N){M.error("Erreur lors du parsing de la navigation sauvegardée:",N),localStorage.removeItem("pendingPasswordResetNavigation")}const T=await tU(i.value);T!=null&&T.lastVisitedPage&&Bx(T.lastVisitedPage)?(M.info("Redirection vers la dernière page visitée (Firestore):",T.lastVisitedPage),t.push(T.lastVisitedPage)):(M.info("Aucune page précédente valide, redirection vers les saisons"),t.push("/seasons"))}catch(_){M.error("Erreur lors de la récupération de la navigation, redirection vers les saisons",_),t.push("/seasons")}}return(_,w)=>(k(),D("div",PQ,[d("div",CQ,[w[8]||(w[8]=rr('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(k(),D("div",RQ,w[2]||(w[2]=[d("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),d("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(k(),D("div",kQ,[w[3]||(w[3]=d("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[d("span",{class:"text-2xl"},"❌")],-1)),w[4]||(w[4]=d("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),d("p",DQ,ie(s.value),1),d("button",{onClick:x,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):o.value?(k(),D("div",NQ,[d("div",OQ,[d("p",VQ,[w[5]||(w[5]=lt(" Réinitialisation pour ")),d("span",MQ,ie(i.value),1)])]),d("div",LQ,[d("div",null,[w[6]||(w[6]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),at(d("input",{"onUpdate:modelValue":w[0]||(w[0]=T=>a.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:tr(v,["enter"])},null,544),[[Ot,a.value]])]),d("div",null,[w[7]||(w[7]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),at(d("input",{"onUpdate:modelValue":w[1]||(w[1]=T=>l.value=T),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:tr(v,["enter"])},null,544),[[Ot,l.value]])])]),d("button",{onClick:v,disabled:!p.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(k(),D("span",FQ,"⏳")):(k(),D("span",UQ,"🔑")),d("span",null,ie(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,$Q),f.value?(k(),D("div",jQ,[d("div",qQ,ie(f.value),1)])):se("",!0),h.value?(k(),D("div",BQ,[d("div",zQ,ie(h.value),1)])):se("",!0)])):se("",!0)])]))}},WQ={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},KQ={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},GQ={class:"text-3xl"},QQ={class:"text-2xl font-bold text-white mb-2"},JQ={class:"text-gray-300 mb-6"},YQ={__name:"MagicLink",setup(n){const e=Uo(),t=Za(),r=A("loading"),s=A("Traitement en cours..."),i=A("Merci de patienter pendant la validation du lien."),o=$e(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return In(async()=>{var l,c,f;try{om("firebase");const h=String(e.query.sid||""),p=String(e.query.pid||"");let v=String(e.query.eid||"");const x=String(e.query.t||""),_=String(e.query.a||""),w=String(e.query.slug||"");if(!x||!_){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants. Vérifiez que le lien est complet.";return}if(_==="verify_email"&&(!h||!p)){r.value="error",s.value="Lien invalide",i.value="Lien de vérification incomplet : informations de saison ou de joueur manquantes.";return}if((_==="yes"||_==="no")&&(!h||!p||!v)){r.value="error",s.value="Lien invalide",i.value="Lien de disponibilité incomplet : informations manquantes.";return}if(_==="account_email_update"){const ne=await RP({token:x});if(!ne.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await l5(Ve.currentUser,ne.data.newEmail),await kP({token:x}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(_==="verify_email"&&(v="protection"),!(await PP({seasonId:h,playerId:p,eventId:v,token:x,action:_})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(_==="verify_email"){await BP({playerId:p,seasonId:h});let ne=null;try{ne=await GP({playerId:p,seasonId:h})}catch{}if(ne!=null&&ne.success&&(ne!=null&&ne.email))try{const{auth:ae}=await je(()=>Promise.resolve().then(()=>vr),void 0),{signInAnonymously:V,updateProfile:P}=await je(()=>import("./index.esm-253f6bce.js"),[]),$=(await V(ae)).user;await P($,{displayName:ne.email.split("@")[0],photoURL:null}),localStorage.setItem("userEmail",ne.email),localStorage.setItem("isAnonymousUser","true"),console.log("✅ Connexion anonyme réussie avec email associé:",ne.email);try{const{forceSync:F}=await je(()=>Promise.resolve().then(()=>EU),void 0);F(),console.log("🔄 Synchronisation forcée de l'état d'authentification")}catch(F){console.warn("Impossible de synchroniser l'état d'authentification:",F)}localStorage.setItem("protectionActivated","true"),localStorage.setItem("protectedPlayerId",p),localStorage.setItem("protectedSeasonId",h);try{const F=localStorage.getItem("seasonPreferredPlayer:global");if(!F)localStorage.setItem("seasonPreferredPlayer:global",JSON.stringify([p]));else if(F.startsWith("[")){const U=JSON.parse(F);U.includes(p)||(U.push(p),localStorage.setItem("seasonPreferredPlayer:global",JSON.stringify(U)))}else F!==p&&localStorage.setItem("seasonPreferredPlayer:global",JSON.stringify([F,p]))}catch{}console.log("✅ Protection activée, email stocké pour connexion automatique:",ne.email)}catch(ae){console.error("Erreur lors de la préparation de la connexion automatique:",ae)}await dv({seasonId:h,playerId:p,eventId:"protection",action:_}),r.value="ok",s.value="Protection activée !",i.value="Merci ! Votre compte est maintenant protégé et vous êtes connecté automatiquement.",setTimeout(w?()=>t.push(`/season/${w}?player=${encodeURIComponent(p)}&verified=1`):()=>t.push("/seasons"),800);return}if(_==="activate_notifications"){try{const{processNotificationActivation:ne}=await je(()=>Promise.resolve().then(()=>Yf),void 0),ae=await ne(x);if(ae.success)if(console.log("✅ Activation des notifications réussie:",{success:ae.success,email:ae.email,playerName:ae.playerName,accountStatus:ae.accountStatus}),r.value="ok",s.value="Notifications activées !",(l=ae.accountStatus)!=null&&l.created?(console.log("🎉 Compte créé, affichage du message de création de compte"),i.value=`Parfait ! Tes notifications sont maintenant actives pour ${ae.playerName}. Un compte a été créé avec ton email et tu recevras un email pour définir ton mot de passe.`):(console.log("ℹ️ Compte existant, pas de modal de succès"),i.value=`Parfait ! Tes notifications sont maintenant actives pour ${ae.playerName}. Tu recevras des alertes pour tes spectacles.`),i.value+=`

💡 Conseil : Pour une meilleure expérience, tu peux créer un mot de passe pour ton compte et te connecter directement à l'avenir.`,(c=ae.accountStatus)!=null&&c.created)if(console.log("🎯 Nouvel utilisateur détecté, redirection avec modal de succès...",{slug:w,eventId:v,email:ae.email,playerName:ae.playerName}),w&&v){const V=`/season/${w}?event=${v}&modal=event_details&notificationSuccess=1&email=${encodeURIComponent(ae.email)}&playerName=${encodeURIComponent(ae.playerName)}&eventId=${v}`;console.log("🔗 Redirection vers:",V),t.push(V)}else if(w){const V=`/season/${w}?notificationSuccess=1&email=${encodeURIComponent(ae.email)}&playerName=${encodeURIComponent(ae.playerName)}`;console.log("🔗 Redirection vers:",V),t.push(V)}else console.log("🔗 Redirection vers /seasons (pas de slug)"),t.push("/seasons");else w&&v?t.push(`/season/${w}?event=${v}&modal=event_details`):w?t.push(`/season/${w}`):t.push("/seasons");else throw new Error("Échec de l'activation des notifications")}catch(ne){M.error("Erreur lors de l'activation des notifications",ne),r.value="error",s.value="Erreur d'activation",i.value="Impossible d'activer tes notifications. Veuillez réessayer."}return}const N=pe(te,"seasons",h,"players",p),I=await Tt(N),j=I.exists()&&I.data().name||"";if(!j){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(_!=="confirm"&&_!=="decline"&&await sC({seasonId:h,playerName:j,eventId:v,value:_==="yes"}),_==="no")try{const ne=pe(te,"seasons",h,"selections",v),ae=await Tt(ne);if(ae.exists()){const V=Array.isArray((f=ae.data())==null?void 0:f.players)?ae.data().players:[],P=V.filter(S=>S!==j);P.length!==V.length&&await setDoc(ne,{players:P},{merge:!0})}}catch{}if(_==="decline")try{const{updatePlayerSelectionStatus:ne}=await je(()=>Promise.resolve().then(()=>Ul),void 0);await ne(v,j,"declined",h),console.log("✅ Statut du joueur mis à jour : declined")}catch(ne){console.error("❌ Erreur lors de la mise à jour du statut du joueur:",ne)}if(_==="confirm")try{const{updatePlayerSelectionStatus:ne}=await je(()=>Promise.resolve().then(()=>Ul),void 0);await ne(v,j,"confirmed",h),console.log("✅ Statut du joueur mis à jour : confirmed")}catch(ne){console.error("❌ Erreur lors de la mise à jour du statut du joueur:",ne)}await dv({seasonId:h,playerId:p,eventId:v,action:_}),r.value="ok",s.value="Merci !",_==="confirm"?i.value='Votre participation a été confirmée ! Vous êtes maintenant "Joue" dans cette sélection.':_==="decline"?i.value='Votre participation a été déclinée. Vous êtes maintenant "Décliné" dans cette sélection.':_==="yes"?i.value="Votre disponibilité a été enregistrée: Disponible.":_==="no"&&(i.value="Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)"),setTimeout(w?()=>t.push(`/season/${w}/event/${v}`):()=>t.push("/seasons"),1200)}catch(h){M.error("Magic link error",h),r.value="error",s.value="Erreur",h.code==="auth/invalid-action-code"?i.value="Ce lien de vérification est invalide ou a expiré.":h.code==="auth/expired-action-code"?i.value="Ce lien de vérification a expiré. Veuillez demander un nouveau lien.":h.message&&h.message.includes("seasonId")?i.value="Lien de vérification invalide : saison introuvable.":h.message&&h.message.includes("playerId")?i.value="Lien de vérification invalide : joueur introuvable.":i.value="Impossible de traiter votre lien. Veuillez vérifier que le lien est complet et valide."}}),(l,c)=>(k(),D("div",WQ,[d("div",KQ,[d("div",{class:$t(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[d("span",GQ,ie(o.value),1)],2),d("h1",QQ,ie(s.value),1),d("p",JQ,ie(i.value),1),d("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},XQ={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},ZQ={class:"text-center py-12 px-4"},eJ={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},tJ={class:"container mx-auto px-4 pb-16"},nJ={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},rJ={class:"space-y-5"},sJ=["onKeydown"],iJ={class:"flex items-center justify-end gap-3 pt-2"},oJ=["disabled"],aJ={key:0,class:"mt-6 text-sm text-gray-200"},lJ={__name:"JoinSeason",setup(n){const e=Uo(),t=Za(),r=e.params.slug,s=A(""),i=A(""),o=A(""),a=A(!1),l=A("");In(async()=>{const h=Lo(tt(te,"seasons"),ss("slug","==",r)),p=await It(h);if(p.empty)l.value="Saison introuvable";else{const v=p.docs[0];s.value=v.id,i.value=v.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function f(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await U0(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(h){M.error("Erreur inscription",h),l.value=`Erreur lors de l'inscription: ${(h==null?void 0:h.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(h,p)=>(k(),D("div",XQ,[d("div",ZQ,[d("h1",eJ,ie(i.value||"Rejoindre la saison"),1),p[1]||(p[1]=d("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),d("div",tJ,[d("div",nJ,[p[3]||(p[3]=d("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),d("div",rJ,[d("div",null,[p[2]||(p[2]=d("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),at(d("input",{"onUpdate:modelValue":p[0]||(p[0]=v=>o.value=v),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:tr(At(f,["prevent"]),["enter"])},null,40,sJ),[[Ot,o.value]])]),d("div",iJ,[d("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),d("button",{disabled:!o.value.trim()||a.value,onClick:f,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,oJ)])]),l.value?(k(),D("div",aJ,ie(l.value),1)):se("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const cJ=[{path:"/",component:AU},{path:"/seasons",component:l8},{path:"/season/:slug",component:Yx,props:!0},{path:"/season/:slug/event/:eventId",component:Yx,props:!0},{path:"/season/:slug/join",component:lJ,props:!0},{path:"/reset-password",component:HQ},{path:"/magic",component:YQ}],uJ=TD({history:eD("/"),routes:cJ});let jl;window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),jl=n,console.log("Événement beforeinstallprompt capturé")});window.addEventListener("appinstalled",n=>{console.log("Application installée"),jl=null});window.triggerInstall=()=>{jl&&(jl.prompt(),jl.userChoice.then(n=>{n.outcome==="accepted"?console.log("Utilisateur a accepté l'installation"):console.log("Utilisateur a refusé l'installation"),jl=null}))};window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches&&console.log("Application déjà installée en mode standalone");const pC=w2(dU);pC.use(uJ);pC.mount("#app");pU({immediate:!0,onRegistered(n){window.__swReg=n}});export{tt as $,GS as A,zr as B,Zs as C,Wt as D,hY as E,il as F,ei as G,dY as H,mJ as I,as as J,UV as K,QM as L,Bi as M,$J as N,FJ as O,_L as P,Jn as Q,CJ as R,_o as S,jt as T,rY as U,Is as V,gL as W,bL as X,LJ as Y,xJ as Z,Xv as _,Ed as a,ss as a$,gJ as a0,GM as a1,iL as a2,uY as a3,Ni as a4,nY as a5,TJ as a6,cY as a7,pe as a8,AJ as a9,YJ as aA,YM as aB,dx as aC,KJ as aD,GJ as aE,PJ as aF,sL as aG,ZJ as aH,eY as aI,pL as aJ,Lo as aK,OS as aL,jJ as aM,vJ as aN,tY as aO,on as aP,en as aQ,oY as aR,dJ as aS,qJ as aT,NJ as aU,DJ as aV,MJ as aW,SJ as aX,cs as aY,iY as aZ,EJ as a_,UJ as aa,_J as ab,wJ as ac,IJ as ad,lY as ae,VJ as af,OJ as ag,vn as ah,Yd as ai,aL as aj,QJ as ak,Tt as al,BJ as am,zJ as an,It as ao,HJ as ap,WJ as aq,bJ as ar,aY as as,sY as at,JM as au,RJ as av,kJ as aw,lx as ax,JJ as ay,XJ as az,XM as b,RY as b$,Hp as b0,yY as b1,th as b2,eh as b3,_Y as b4,Pd as b5,cl as b6,mo as b7,pY as b8,vo as b9,CY as bA,NY as bB,BF as bC,wY as bD,s6 as bE,UY as bF,eX as bG,Sx as bH,$5 as bI,R6 as bJ,OY as bK,AY as bL,e5 as bM,HY as bN,JY as bO,ZY as bP,jY as bQ,y5 as bR,g5 as bS,xY as bT,W$ as bU,t5 as bV,WY as bW,QY as bX,XY as bY,a6 as bZ,$Y as b_,go as ba,Mi as bb,uf as bc,vY as bd,Ma as be,Zl as bf,VF as bg,mY as bh,BY as bi,iv as bj,gY as bk,MF as bl,P0 as bm,yo as bn,TY as bo,v5 as bp,qY as bq,YA as br,OF as bs,eP as bt,s5 as bu,r5 as bv,D6 as bw,HA as bx,bY as by,FY as bz,Kr as c,zA as c0,SY as c1,m5 as c2,FA as c3,v0 as c4,IY as c5,WA as c6,PY as c7,zY as c8,GY as c9,YY as ca,b5 as cb,EY as cc,LY as cd,l5 as ce,c5 as cf,KY as cg,DY as ch,MY as ci,VY as cj,kY as ck,i5 as cl,ol as d,Jt as e,he as f,Vc as g,Qd as h,af as i,Bp as j,Jd as k,yJ as l,jp as m,e0 as n,Gr as o,qp as p,yL as q,Sn as r,ja as s,Te as t,fJ as u,RV as v,dn as w,fY as x,yt as y,hJ as z};
