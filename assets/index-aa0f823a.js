(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Yp(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const Ct={},Da=[],Fr=()=>{},PT=()=>!1,ih=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Xp=n=>n.startsWith("onUpdate:"),Cn=Object.assign,Zp=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},RT=Object.prototype.hasOwnProperty,It=(n,e)=>RT.call(n,e),ze=Array.isArray,Na=n=>tc(n)==="[object Map]",cl=n=>tc(n)==="[object Set]",wv=n=>tc(n)==="[object Date]",Je=n=>typeof n=="function",dn=n=>typeof n=="string",us=n=>typeof n=="symbol",Vt=n=>n!==null&&typeof n=="object",x_=n=>(Vt(n)||Je(n))&&Je(n.then)&&Je(n.catch),T_=Object.prototype.toString,tc=n=>T_.call(n),CT=n=>tc(n).slice(8,-1),A_=n=>tc(n)==="[object Object]",em=n=>dn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,uu=Yp(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),oh=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},kT=/-(\w)/g,Pr=oh(n=>n.replace(kT,(e,t)=>t?t.toUpperCase():"")),DT=/\B([A-Z])/g,Ui=oh(n=>n.replace(DT,"-$1").toLowerCase()),ah=oh(n=>n.charAt(0).toUpperCase()+n.slice(1)),vf=oh(n=>n?`on${ah(n)}`:""),xi=(n,e)=>!Object.is(n,e),sd=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},Zf=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Ad=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Iv;const lh=()=>Iv||(Iv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function mr(n){if(ze(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=dn(r)?MT(r):mr(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(dn(n)||Vt(n))return n}const NT=/;(?![^(]*\))/g,VT=/:([^]+)/,OT=/\/\*[^]*?\*\//g;function MT(n){const e={};return n.replace(OT,"").split(NT).forEach(t=>{if(t){const r=t.split(VT);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function St(n){let e="";if(dn(n))e=n;else if(ze(n))for(let t=0;t<n.length;t++){const r=St(n[t]);r&&(e+=r+" ")}else if(Vt(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const LT="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",FT=Yp(LT);function S_(n){return!!n||n===""}function $T(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=nc(n[r],e[r]);return t}function nc(n,e){if(n===e)return!0;let t=wv(n),r=wv(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=us(n),r=us(e),t||r)return n===e;if(t=ze(n),r=ze(e),t||r)return t&&r?$T(n,e):!1;if(t=Vt(n),r=Vt(e),t||r){if(!t||!r)return!1;const s=Object.keys(n).length,i=Object.keys(e).length;if(s!==i)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!nc(n[o],e[o]))return!1}}return String(n)===String(e)}function tm(n,e){return n.findIndex(t=>nc(t,e))}const P_=n=>!!(n&&n.__v_isRef===!0),ae=n=>dn(n)?n:n==null?"":ze(n)||Vt(n)&&(n.toString===T_||!Je(n.toString))?P_(n)?ae(n.value):JSON.stringify(n,R_,2):String(n),R_=(n,e)=>P_(e)?R_(n,e.value):Na(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[yf(r,i)+" =>"]=s,t),{})}:cl(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>yf(t))}:us(e)?yf(e):Vt(e)&&!ze(e)&&!A_(e)?String(e):e,yf=(n,e="")=>{var t;return us(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let rr;class UT{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=rr,!e&&rr&&(this.index=(rr.scopes||(rr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=rr;try{return rr=this,e()}finally{rr=t}}}on(){++this._on===1&&(this.prevScope=rr,rr=this)}off(){this._on>0&&--this._on===0&&(rr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function jT(){return rr}let Dt;const _f=new WeakSet;class C_{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,rr&&rr.active&&rr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,_f.has(this)&&(_f.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||D_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ev(this),N_(this);const e=Dt,t=$r;Dt=this,$r=!0;try{return this.fn()}finally{V_(this),Dt=e,$r=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)sm(e);this.deps=this.depsTail=void 0,Ev(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?_f.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ep(this)&&this.run()}get dirty(){return ep(this)}}let k_=0,cu,du;function D_(n,e=!1){if(n.flags|=8,e){n.next=du,du=n;return}n.next=cu,cu=n}function nm(){k_++}function rm(){if(--k_>0)return;if(du){let e=du;for(du=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;cu;){let e=cu;for(cu=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function N_(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function V_(n){let e,t=n.depsTail,r=t;for(;r;){const s=r.prevDep;r.version===-1?(r===t&&(t=s),sm(r),BT(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=s}n.deps=e,n.depsTail=t}function ep(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(O_(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function O_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Au)||(n.globalVersion=Au,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!ep(n))))return;n.flags|=2;const e=n.dep,t=Dt,r=$r;Dt=n,$r=!0;try{N_(n);const s=n.fn(n._value);(e.version===0||xi(s,n._value))&&(n.flags|=128,n._value=s,e.version++)}catch(s){throw e.version++,s}finally{Dt=t,$r=r,V_(n),n.flags&=-3}}function sm(n,e=!1){const{dep:t,prevSub:r,nextSub:s}=n;if(r&&(r.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)sm(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function BT(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let $r=!0;const M_=[];function Os(){M_.push($r),$r=!1}function Ms(){const n=M_.pop();$r=n===void 0?!0:n}function Ev(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Dt;Dt=void 0;try{e()}finally{Dt=t}}}let Au=0;class qT{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class im{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Dt||!$r||Dt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Dt)t=this.activeLink=new qT(Dt,this),Dt.deps?(t.prevDep=Dt.depsTail,Dt.depsTail.nextDep=t,Dt.depsTail=t):Dt.deps=Dt.depsTail=t,L_(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Dt.depsTail,t.nextDep=void 0,Dt.depsTail.nextDep=t,Dt.depsTail=t,Dt.deps===t&&(Dt.deps=r)}return t}trigger(e){this.version++,Au++,this.notify(e)}notify(e){nm();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{rm()}}}function L_(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)L_(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const tp=new WeakMap,Oo=Symbol(""),np=Symbol(""),Su=Symbol("");function Bn(n,e,t){if($r&&Dt){let r=tp.get(n);r||tp.set(n,r=new Map);let s=r.get(t);s||(r.set(t,s=new im),s.map=r,s.key=t),s.track()}}function As(n,e,t,r,s,i){const o=tp.get(n);if(!o){Au++;return}const a=l=>{l&&l.trigger()};if(nm(),e==="clear")o.forEach(a);else{const l=ze(n),c=l&&em(t);if(l&&t==="length"){const d=Number(r);o.forEach((f,g)=>{(g==="length"||g===Su||!us(g)&&g>=d)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),c&&a(o.get(Su)),e){case"add":l?c&&a(o.get("length")):(a(o.get(Oo)),Na(n)&&a(o.get(np)));break;case"delete":l||(a(o.get(Oo)),Na(n)&&a(o.get(np)));break;case"set":Na(n)&&a(o.get(Oo));break}}rm()}function ba(n){const e=wt(n);return e===n?e:(Bn(e,"iterate",Su),Ar(n)?e:e.map(Mn))}function uh(n){return Bn(n=wt(n),"iterate",Su),n}const zT={__proto__:null,[Symbol.iterator](){return bf(this,Symbol.iterator,Mn)},concat(...n){return ba(this).concat(...n.map(e=>ze(e)?ba(e):e))},entries(){return bf(this,"entries",n=>(n[1]=Mn(n[1]),n))},every(n,e){return Is(this,"every",n,e,void 0,arguments)},filter(n,e){return Is(this,"filter",n,e,t=>t.map(Mn),arguments)},find(n,e){return Is(this,"find",n,e,Mn,arguments)},findIndex(n,e){return Is(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return Is(this,"findLast",n,e,Mn,arguments)},findLastIndex(n,e){return Is(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return Is(this,"forEach",n,e,void 0,arguments)},includes(...n){return wf(this,"includes",n)},indexOf(...n){return wf(this,"indexOf",n)},join(n){return ba(this).join(n)},lastIndexOf(...n){return wf(this,"lastIndexOf",n)},map(n,e){return Is(this,"map",n,e,void 0,arguments)},pop(){return zl(this,"pop")},push(...n){return zl(this,"push",n)},reduce(n,...e){return xv(this,"reduce",n,e)},reduceRight(n,...e){return xv(this,"reduceRight",n,e)},shift(){return zl(this,"shift")},some(n,e){return Is(this,"some",n,e,void 0,arguments)},splice(...n){return zl(this,"splice",n)},toReversed(){return ba(this).toReversed()},toSorted(n){return ba(this).toSorted(n)},toSpliced(...n){return ba(this).toSpliced(...n)},unshift(...n){return zl(this,"unshift",n)},values(){return bf(this,"values",Mn)}};function bf(n,e,t){const r=uh(n),s=r[e]();return r!==n&&!Ar(n)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=t(i.value)),i}),s}const KT=Array.prototype;function Is(n,e,t,r,s,i){const o=uh(n),a=o!==n&&!Ar(n),l=o[e];if(l!==KT[e]){const f=l.apply(n,i);return a?Mn(f):f}let c=t;o!==n&&(a?c=function(f,g){return t.call(this,Mn(f),g,n)}:t.length>2&&(c=function(f,g){return t.call(this,f,g,n)}));const d=l.call(o,c,r);return a&&s?s(d):d}function xv(n,e,t,r){const s=uh(n);let i=t;return s!==n&&(Ar(n)?t.length>3&&(i=function(o,a,l){return t.call(this,o,a,l,n)}):i=function(o,a,l){return t.call(this,o,Mn(a),l,n)}),s[e](i,...r)}function wf(n,e,t){const r=wt(n);Bn(r,"iterate",Su);const s=r[e](...t);return(s===-1||s===!1)&&lm(t[0])?(t[0]=wt(t[0]),r[e](...t)):s}function zl(n,e,t=[]){Os(),nm();const r=wt(n)[e].apply(n,t);return rm(),Ms(),r}const GT=Yp("__proto__,__v_isRef,__isVue"),F_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(us));function HT(n){us(n)||(n=String(n));const e=wt(this);return Bn(e,"has",n),e.hasOwnProperty(n)}class $_{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?rA:q_:i?B_:j_).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const o=ze(e);if(!s){let l;if(o&&(l=zT[t]))return l;if(t==="hasOwnProperty")return HT}const a=Reflect.get(e,t,Kn(e)?e:r);return(us(t)?F_.has(t):GT(t))||(s||Bn(e,"get",t),i)?a:Kn(a)?o&&em(t)?a:a.value:Vt(a)?s?K_(a):ch(a):a}}class U_ extends $_{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const l=Ri(i);if(!Ar(r)&&!Ri(r)&&(i=wt(i),r=wt(r)),!ze(e)&&Kn(i)&&!Kn(r))return l?!1:(i.value=r,!0)}const o=ze(e)&&em(t)?Number(t)<e.length:It(e,t),a=Reflect.set(e,t,r,Kn(e)?e:s);return e===wt(s)&&(o?xi(r,i)&&As(e,"set",t,r):As(e,"add",t,r)),a}deleteProperty(e,t){const r=It(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&As(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!us(t)||!F_.has(t))&&Bn(e,"has",t),r}ownKeys(e){return Bn(e,"iterate",ze(e)?"length":Oo),Reflect.ownKeys(e)}}class WT extends $_{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const QT=new U_,JT=new WT,YT=new U_(!0);const rp=n=>n,zc=n=>Reflect.getPrototypeOf(n);function XT(n,e,t){return function(...r){const s=this.__v_raw,i=wt(s),o=Na(i),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...r),d=t?rp:e?Sd:Mn;return!e&&Bn(i,"iterate",l?np:Oo),{next(){const{value:f,done:g}=c.next();return g?{value:f,done:g}:{value:a?[d(f[0]),d(f[1])]:d(f),done:g}},[Symbol.iterator](){return this}}}}function Kc(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function ZT(n,e){const t={get(s){const i=this.__v_raw,o=wt(i),a=wt(s);n||(xi(s,a)&&Bn(o,"get",s),Bn(o,"get",a));const{has:l}=zc(o),c=e?rp:n?Sd:Mn;if(l.call(o,s))return c(i.get(s));if(l.call(o,a))return c(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!n&&Bn(wt(s),"iterate",Oo),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=wt(i),a=wt(s);return n||(xi(s,a)&&Bn(o,"has",s),Bn(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,l=wt(a),c=e?rp:n?Sd:Mn;return!n&&Bn(l,"iterate",Oo),a.forEach((d,f)=>s.call(i,c(d),c(f),o))}};return Cn(t,n?{add:Kc("add"),set:Kc("set"),delete:Kc("delete"),clear:Kc("clear")}:{add(s){!e&&!Ar(s)&&!Ri(s)&&(s=wt(s));const i=wt(this);return zc(i).has.call(i,s)||(i.add(s),As(i,"add",s,s)),this},set(s,i){!e&&!Ar(i)&&!Ri(i)&&(i=wt(i));const o=wt(this),{has:a,get:l}=zc(o);let c=a.call(o,s);c||(s=wt(s),c=a.call(o,s));const d=l.call(o,s);return o.set(s,i),c?xi(i,d)&&As(o,"set",s,i):As(o,"add",s,i),this},delete(s){const i=wt(this),{has:o,get:a}=zc(i);let l=o.call(i,s);l||(s=wt(s),l=o.call(i,s)),a&&a.call(i,s);const c=i.delete(s);return l&&As(i,"delete",s,void 0),c},clear(){const s=wt(this),i=s.size!==0,o=s.clear();return i&&As(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=XT(s,n,e)}),t}function om(n,e){const t=ZT(n,e);return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(It(t,s)&&s in r?t:r,s,i)}const eA={get:om(!1,!1)},tA={get:om(!1,!0)},nA={get:om(!0,!1)};const j_=new WeakMap,B_=new WeakMap,q_=new WeakMap,rA=new WeakMap;function sA(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function iA(n){return n.__v_skip||!Object.isExtensible(n)?0:sA(CT(n))}function ch(n){return Ri(n)?n:am(n,!1,QT,eA,j_)}function z_(n){return am(n,!1,YT,tA,B_)}function K_(n){return am(n,!0,JT,nA,q_)}function am(n,e,t,r,s){if(!Vt(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=iA(n);if(i===0)return n;const o=s.get(n);if(o)return o;const a=new Proxy(n,i===2?r:t);return s.set(n,a),a}function Va(n){return Ri(n)?Va(n.__v_raw):!!(n&&n.__v_isReactive)}function Ri(n){return!!(n&&n.__v_isReadonly)}function Ar(n){return!!(n&&n.__v_isShallow)}function lm(n){return n?!!n.__v_raw:!1}function wt(n){const e=n&&n.__v_raw;return e?wt(e):n}function oA(n){return!It(n,"__v_skip")&&Object.isExtensible(n)&&Zf(n,"__v_skip",!0),n}const Mn=n=>Vt(n)?ch(n):n,Sd=n=>Vt(n)?K_(n):n;function Kn(n){return n?n.__v_isRef===!0:!1}function P(n){return G_(n,!1)}function aA(n){return G_(n,!0)}function G_(n,e){return Kn(n)?n:new lA(n,e)}class lA{constructor(e,t){this.dep=new im,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:wt(e),this._value=t?e:Mn(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||Ar(e)||Ri(e);e=r?e:wt(e),xi(e,t)&&(this._rawValue=e,this._value=r?e:Mn(e),this.dep.trigger())}}function is(n){return Kn(n)?n.value:n}const uA={get:(n,e,t)=>e==="__v_raw"?n:is(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Kn(s)&&!Kn(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function H_(n){return Va(n)?n:new Proxy(n,uA)}class cA{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new im(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Au-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Dt!==this)return D_(this,!0),!0}get value(){const e=this.dep.track();return O_(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function dA(n,e,t=!1){let r,s;return Je(n)?r=n:(r=n.get,s=n.set),new cA(r,s,t)}const Gc={},Pd=new WeakMap;let Io;function hA(n,e=!1,t=Io){if(t){let r=Pd.get(t);r||Pd.set(t,r=[]),r.push(n)}}function fA(n,e,t=Ct){const{immediate:r,deep:s,once:i,scheduler:o,augmentJob:a,call:l}=t,c=z=>s?z:Ar(z)||s===!1||s===0?Ss(z,1):Ss(z);let d,f,g,y,E=!1,A=!1;if(Kn(n)?(f=()=>n.value,E=Ar(n)):Va(n)?(f=()=>c(n),E=!0):ze(n)?(A=!0,E=n.some(z=>Va(z)||Ar(z)),f=()=>n.map(z=>{if(Kn(z))return z.value;if(Va(z))return c(z);if(Je(z))return l?l(z,2):z()})):Je(n)?e?f=l?()=>l(n,2):n:f=()=>{if(g){Os();try{g()}finally{Ms()}}const z=Io;Io=d;try{return l?l(n,3,[y]):n(y)}finally{Io=z}}:f=Fr,e&&s){const z=f,de=s===!0?1/0:s;f=()=>Ss(z(),de)}const R=jT(),B=()=>{d.stop(),R&&R.active&&Zp(R.effects,d)};if(i&&e){const z=e;e=(...de)=>{z(...de),B()}}let q=A?new Array(n.length).fill(Gc):Gc;const F=z=>{if(!(!(d.flags&1)||!d.dirty&&!z))if(e){const de=d.run();if(s||E||(A?de.some((me,T)=>xi(me,q[T])):xi(de,q))){g&&g();const me=Io;Io=d;try{const T=[de,q===Gc?void 0:A&&q[0]===Gc?[]:q,y];q=de,l?l(e,3,T):e(...T)}finally{Io=me}}}else d.run()};return a&&a(F),d=new C_(f),d.scheduler=o?()=>o(F,!1):F,y=z=>hA(z,!1,d),g=d.onStop=()=>{const z=Pd.get(d);if(z){if(l)l(z,4);else for(const de of z)de();Pd.delete(d)}},e?r?F(!0):q=d.run():o?o(F.bind(null,!0),!0):d.run(),B.pause=d.pause.bind(d),B.resume=d.resume.bind(d),B.stop=B,B}function Ss(n,e=1/0,t){if(e<=0||!Vt(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,Kn(n))Ss(n.value,e,t);else if(ze(n))for(let r=0;r<n.length;r++)Ss(n[r],e,t);else if(cl(n)||Na(n))n.forEach(r=>{Ss(r,e,t)});else if(A_(n)){for(const r in n)Ss(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Ss(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function rc(n,e,t,r){try{return r?n(...r):n()}catch(s){dh(s,e,t)}}function cs(n,e,t,r){if(Je(n)){const s=rc(n,e,t,r);return s&&x_(s)&&s.catch(i=>{dh(i,e,t)}),s}if(ze(n)){const s=[];for(let i=0;i<n.length;i++)s.push(cs(n[i],e,t,r));return s}}function dh(n,e,t,r=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Ct;if(e){let a=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](n,l,c)===!1)return}a=a.parent}if(i){Os(),rc(i,null,10,[n,l,c]),Ms();return}}pA(n,t,s,r,o)}function pA(n,e,t,r=!0,s=!1){if(s)throw n;console.error(n)}const Zn=[];let es=-1;const Oa=[];let di=null,Ta=0;const W_=Promise.resolve();let Rd=null;function Ut(n){const e=Rd||W_;return n?e.then(this?n.bind(this):n):e}function mA(n){let e=es+1,t=Zn.length;for(;e<t;){const r=e+t>>>1,s=Zn[r],i=Pu(s);i<n||i===n&&s.flags&2?e=r+1:t=r}return e}function um(n){if(!(n.flags&1)){const e=Pu(n),t=Zn[Zn.length-1];!t||!(n.flags&2)&&e>=Pu(t)?Zn.push(n):Zn.splice(mA(e),0,n),n.flags|=1,Q_()}}function Q_(){Rd||(Rd=W_.then(Y_))}function gA(n){ze(n)?Oa.push(...n):di&&n.id===-1?di.splice(Ta+1,0,n):n.flags&1||(Oa.push(n),n.flags|=1),Q_()}function Tv(n,e,t=es+1){for(;t<Zn.length;t++){const r=Zn[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;Zn.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function J_(n){if(Oa.length){const e=[...new Set(Oa)].sort((t,r)=>Pu(t)-Pu(r));if(Oa.length=0,di){di.push(...e);return}for(di=e,Ta=0;Ta<di.length;Ta++){const t=di[Ta];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}di=null,Ta=0}}const Pu=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Y_(n){const e=Fr;try{for(es=0;es<Zn.length;es++){const t=Zn[es];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),rc(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;es<Zn.length;es++){const t=Zn[es];t&&(t.flags&=-2)}es=-1,Zn.length=0,J_(),Rd=null,(Zn.length||Oa.length)&&Y_()}}let gr=null,X_=null;function Cd(n){const e=gr;return gr=n,X_=n&&n.type.__scopeId||null,e}function vA(n,e=gr,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&Lv(-1);const i=Cd(e);let o;try{o=n(...s)}finally{Cd(i),r._d&&Lv(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function tt(n,e){if(gr===null)return n;const t=mh(gr),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,l=Ct]=e[s];i&&(Je(i)&&(i={mounted:i,updated:i}),i.deep&&Ss(o),r.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function _o(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let l=a.dir[r];l&&(Os(),cs(l,t,8,[n.el,a,n,e]),Ms())}}const Z_=Symbol("_vte"),yA=n=>n.__isTeleport,hu=n=>n&&(n.disabled||n.disabled===""),Av=n=>n&&(n.defer||n.defer===""),Sv=n=>typeof SVGElement<"u"&&n instanceof SVGElement,Pv=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,sp=(n,e)=>{const t=n&&n.to;return dn(t)?e?e(t):null:t},eb={name:"Teleport",__isTeleport:!0,process(n,e,t,r,s,i,o,a,l,c){const{mc:d,pc:f,pbc:g,o:{insert:y,querySelector:E,createText:A,createComment:R}}=c,B=hu(e.props);let{shapeFlag:q,children:F,dynamicChildren:z}=e;if(n==null){const de=e.el=A(""),me=e.anchor=A("");y(de,t,r),y(me,t,r);const T=(x,N)=>{q&16&&(s&&s.isCE&&(s.ce._teleportTarget=x),d(F,x,N,s,i,o,a,l))},w=()=>{const x=e.target=sp(e.props,E),N=tb(x,e,A,y);x&&(o!=="svg"&&Sv(x)?o="svg":o!=="mathml"&&Pv(x)&&(o="mathml"),B||(T(x,N),id(e,!1)))};B&&(T(t,me),id(e,!0)),Av(e.props)?(e.el.__isMounted=!1,Yn(()=>{w(),delete e.el.__isMounted},i)):w()}else{if(Av(e.props)&&n.el.__isMounted===!1){Yn(()=>{eb.process(n,e,t,r,s,i,o,a,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const de=e.anchor=n.anchor,me=e.target=n.target,T=e.targetAnchor=n.targetAnchor,w=hu(n.props),x=w?t:me,N=w?de:T;if(o==="svg"||Sv(me)?o="svg":(o==="mathml"||Pv(me))&&(o="mathml"),z?(g(n.dynamicChildren,z,x,s,i,o,a),pm(n,e,!0)):l||f(n,e,x,N,s,i,o,a,!1),B)w?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Hc(e,t,de,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const L=e.target=sp(e.props,E);L&&Hc(e,L,null,c,0)}else w&&Hc(e,me,T,c,1);id(e,B)}},remove(n,e,t,{um:r,o:{remove:s}},i){const{shapeFlag:o,children:a,anchor:l,targetStart:c,targetAnchor:d,target:f,props:g}=n;if(f&&(s(c),s(d)),i&&s(l),o&16){const y=i||!hu(g);for(let E=0;E<a.length;E++){const A=a[E];r(A,e,t,y,!!A.dynamicChildren)}}},move:Hc,hydrate:_A};function Hc(n,e,t,{o:{insert:r},m:s},i=2){i===0&&r(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:d}=n,f=i===2;if(f&&r(o,e,t),(!f||hu(d))&&l&16)for(let g=0;g<c.length;g++)s(c[g],e,t,2);f&&r(a,e,t)}function _A(n,e,t,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:l,insert:c,createText:d}},f){const g=e.target=sp(e.props,l);if(g){const y=hu(e.props),E=g._lpa||g.firstChild;if(e.shapeFlag&16)if(y)e.anchor=f(o(n),e,a(n),t,r,s,i),e.targetStart=E,e.targetAnchor=E&&o(E);else{e.anchor=o(n);let A=E;for(;A;){if(A&&A.nodeType===8){if(A.data==="teleport start anchor")e.targetStart=A;else if(A.data==="teleport anchor"){e.targetAnchor=A,g._lpa=e.targetAnchor&&o(e.targetAnchor);break}}A=o(A)}e.targetAnchor||tb(g,e,d,c),f(E&&o(E),e,g,t,r,s,i)}id(e,y)}return e.anchor&&o(e.anchor)}const fu=eb;function id(n,e){const t=n.ctx;if(t&&t.ut){let r,s;for(e?(r=n.el,s=n.anchor):(r=n.targetStart,s=n.targetAnchor);r&&r!==s;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function tb(n,e,t,r){const s=e.targetStart=t(""),i=e.targetAnchor=t("");return s[Z_]=i,n&&(r(s,n),r(i,n)),i}function cm(n,e){n.shapeFlag&6&&n.component?(n.transition=e,cm(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function nb(n,e){return Je(n)?(()=>Cn({name:n.name},e,{setup:n}))():n}function rb(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function pu(n,e,t,r,s=!1){if(ze(n)){n.forEach((E,A)=>pu(E,e&&(ze(e)?e[A]:e),t,r,s));return}if(mu(r)&&!s){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&pu(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?mh(r.component):r.el,o=s?null:i,{i:a,r:l}=n,c=e&&e.r,d=a.refs===Ct?a.refs={}:a.refs,f=a.setupState,g=wt(f),y=f===Ct?()=>!1:E=>It(g,E);if(c!=null&&c!==l&&(dn(c)?(d[c]=null,y(c)&&(f[c]=null)):Kn(c)&&(c.value=null)),Je(l))rc(l,a,12,[o,d]);else{const E=dn(l),A=Kn(l);if(E||A){const R=()=>{if(n.f){const B=E?y(l)?f[l]:d[l]:l.value;s?ze(B)&&Zp(B,i):ze(B)?B.includes(i)||B.push(i):E?(d[l]=[i],y(l)&&(f[l]=d[l])):(l.value=[i],n.k&&(d[n.k]=l.value))}else E?(d[l]=o,y(l)&&(f[l]=o)):A&&(l.value=o,n.k&&(d[n.k]=o))};o?(R.id=-1,Yn(R,t)):R()}}}lh().requestIdleCallback;lh().cancelIdleCallback;const mu=n=>!!n.type.__asyncLoader,sb=n=>n.type.__isKeepAlive;function bA(n,e){ib(n,"a",e)}function wA(n,e){ib(n,"da",e)}function ib(n,e,t=qn){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(hh(e,r,t),t){let s=t.parent;for(;s&&s.parent;)sb(s.parent.vnode)&&IA(r,e,t,s),s=s.parent}}function IA(n,e,t,r){const s=hh(e,n,r,!0);ka(()=>{Zp(r[e],s)},t)}function hh(n,e,t=qn,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{Os();const a=sc(t),l=cs(e,t,n,o);return a(),Ms(),l});return r?s.unshift(i):s.push(i),i}}const qs=n=>(e,t=qn)=>{(!Cu||n==="sp")&&hh(n,(...r)=>e(...r),t)},EA=qs("bm"),zn=qs("m"),xA=qs("bu"),TA=qs("u"),ob=qs("bum"),ka=qs("um"),AA=qs("sp"),SA=qs("rtg"),PA=qs("rtc");function RA(n,e=qn){hh("ec",n,e)}const ab="components";function CA(n,e){return DA(ab,n,!0,e)||n}const kA=Symbol.for("v-ndc");function DA(n,e,t=!0,r=!1){const s=gr||qn;if(s){const i=s.type;if(n===ab){const a=y1(i,!1);if(a&&(a===e||a===Pr(e)||a===ah(Pr(e))))return i}const o=Rv(s[n]||i[n],e)||Rv(s.appContext[n],e);return!o&&r?i:o}}function Rv(n,e){return n&&(n[e]||n[Pr(e)]||n[ah(Pr(e))])}function Tr(n,e,t,r){let s;const i=t&&t[r],o=ze(n);if(o||dn(n)){const a=o&&Va(n);let l=!1,c=!1;a&&(l=!Ar(n),c=Ri(n),n=uh(n)),s=new Array(n.length);for(let d=0,f=n.length;d<f;d++)s[d]=e(l?c?Sd(Mn(n[d])):Mn(n[d]):n[d],d,void 0,i&&i[d])}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i&&i[a])}else if(Vt(n))if(n[Symbol.iterator])s=Array.from(n,(a,l)=>e(a,l,void 0,i&&i[l]));else{const a=Object.keys(n);s=new Array(a.length);for(let l=0,c=a.length;l<c;l++){const d=a[l];s[l]=e(n[d],d,l,i&&i[l])}}else s=[];return t&&(t[r]=s),s}const ip=n=>n?Tb(n)?mh(n):ip(n.parent):null,gu=Cn(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>ip(n.parent),$root:n=>ip(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>dm(n),$forceUpdate:n=>n.f||(n.f=()=>{um(n.update)}),$nextTick:n=>n.n||(n.n=Ut.bind(n.proxy)),$watch:n=>ZA.bind(n)}),If=(n,e)=>n!==Ct&&!n.__isScriptSetup&&It(n,e),NA={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const y=o[e];if(y!==void 0)switch(y){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(If(r,e))return o[e]=1,r[e];if(s!==Ct&&It(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&It(c,e))return o[e]=3,i[e];if(t!==Ct&&It(t,e))return o[e]=4,t[e];op&&(o[e]=0)}}const d=gu[e];let f,g;if(d)return e==="$attrs"&&Bn(n.attrs,"get",""),d(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==Ct&&It(t,e))return o[e]=4,t[e];if(g=l.config.globalProperties,It(g,e))return g[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return If(s,e)?(s[e]=t,!0):r!==Ct&&It(r,e)?(r[e]=t,!0):It(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==Ct&&It(n,o)||If(e,o)||(a=i[0])&&It(a,o)||It(r,o)||It(gu,o)||It(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:It(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Cv(n){return ze(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let op=!0;function VA(n){const e=dm(n),t=n.proxy,r=n.ctx;op=!1,e.beforeCreate&&kv(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:l,inject:c,created:d,beforeMount:f,mounted:g,beforeUpdate:y,updated:E,activated:A,deactivated:R,beforeDestroy:B,beforeUnmount:q,destroyed:F,unmounted:z,render:de,renderTracked:me,renderTriggered:T,errorCaptured:w,serverPrefetch:x,expose:N,inheritAttrs:L,components:j,directives:C,filters:ht}=e;if(c&&OA(c,r,null),o)for(const U in o){const W=o[U];Je(W)&&(r[U]=W.bind(t))}if(s){const U=s.call(t,t);Vt(U)&&(n.data=ch(U))}if(op=!0,i)for(const U in i){const W=i[U],re=Je(W)?W.bind(t,t):Je(W.get)?W.get.bind(t,t):Fr,Se=!Je(W)&&Je(W.set)?W.set.bind(t):Fr,Z=Ue({get:re,set:Se});Object.defineProperty(r,U,{enumerable:!0,configurable:!0,get:()=>Z.value,set:Q=>Z.value=Q})}if(a)for(const U in a)lb(a[U],r,t,U);if(l){const U=Je(l)?l.call(t):l;Reflect.ownKeys(U).forEach(W=>{od(W,U[W])})}d&&kv(d,n,"c");function ee(U,W){ze(W)?W.forEach(re=>U(re.bind(t))):W&&U(W.bind(t))}if(ee(EA,f),ee(zn,g),ee(xA,y),ee(TA,E),ee(bA,A),ee(wA,R),ee(RA,w),ee(PA,me),ee(SA,T),ee(ob,q),ee(ka,z),ee(AA,x),ze(N))if(N.length){const U=n.exposed||(n.exposed={});N.forEach(W=>{Object.defineProperty(U,W,{get:()=>t[W],set:re=>t[W]=re})})}else n.exposed||(n.exposed={});de&&n.render===Fr&&(n.render=de),L!=null&&(n.inheritAttrs=L),j&&(n.components=j),C&&(n.directives=C),x&&rb(n)}function OA(n,e,t=Fr){ze(n)&&(n=ap(n));for(const r in n){const s=n[r];let i;Vt(s)?"default"in s?i=Ur(s.from||r,s.default,!0):i=Ur(s.from||r):i=Ur(s),Kn(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function kv(n,e,t){cs(ze(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function lb(n,e,t,r){let s=r.includes(".")?bb(t,r):()=>t[r];if(dn(n)){const i=e[n];Je(i)&&Pt(s,i)}else if(Je(n))Pt(s,n.bind(t));else if(Vt(n))if(ze(n))n.forEach(i=>lb(i,e,t,r));else{const i=Je(n.handler)?n.handler.bind(t):e[n.handler];Je(i)&&Pt(s,i,n)}}function dm(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let l;return a?l=a:!s.length&&!t&&!r?l=e:(l={},s.length&&s.forEach(c=>kd(l,c,o,!0)),kd(l,e,o)),Vt(e)&&i.set(e,l),l}function kd(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&kd(n,i,t,!0),s&&s.forEach(o=>kd(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=MA[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const MA={data:Dv,props:Nv,emits:Nv,methods:tu,computed:tu,beforeCreate:Jn,created:Jn,beforeMount:Jn,mounted:Jn,beforeUpdate:Jn,updated:Jn,beforeDestroy:Jn,beforeUnmount:Jn,destroyed:Jn,unmounted:Jn,activated:Jn,deactivated:Jn,errorCaptured:Jn,serverPrefetch:Jn,components:tu,directives:tu,watch:FA,provide:Dv,inject:LA};function Dv(n,e){return e?n?function(){return Cn(Je(n)?n.call(this,this):n,Je(e)?e.call(this,this):e)}:e:n}function LA(n,e){return tu(ap(n),ap(e))}function ap(n){if(ze(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Jn(n,e){return n?[...new Set([].concat(n,e))]:e}function tu(n,e){return n?Cn(Object.create(null),n,e):e}function Nv(n,e){return n?ze(n)&&ze(e)?[...new Set([...n,...e])]:Cn(Object.create(null),Cv(n),Cv(e??{})):e}function FA(n,e){if(!n)return e;if(!e)return n;const t=Cn(Object.create(null),n);for(const r in e)t[r]=Jn(n[r],e[r]);return t}function ub(){return{app:null,config:{isNativeTag:PT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let $A=0;function UA(n,e){return function(r,s=null){Je(r)||(r=Cn({},r)),s!=null&&!Vt(s)&&(s=null);const i=ub(),o=new WeakSet,a=[];let l=!1;const c=i.app={_uid:$A++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:b1,get config(){return i.config},set config(d){},use(d,...f){return o.has(d)||(d&&Je(d.install)?(o.add(d),d.install(c,...f)):Je(d)&&(o.add(d),d(c,...f))),c},mixin(d){return i.mixins.includes(d)||i.mixins.push(d),c},component(d,f){return f?(i.components[d]=f,c):i.components[d]},directive(d,f){return f?(i.directives[d]=f,c):i.directives[d]},mount(d,f,g){if(!l){const y=c._ceVNode||st(r,s);return y.appContext=i,g===!0?g="svg":g===!1&&(g=void 0),f&&e?e(y,d):n(y,d,g),l=!0,c._container=d,d.__vue_app__=c,mh(y.component)}},onUnmount(d){a.push(d)},unmount(){l&&(cs(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(d,f){return i.provides[d]=f,c},runWithContext(d){const f=Ma;Ma=c;try{return d()}finally{Ma=f}}};return c}}let Ma=null;function od(n,e){if(qn){let t=qn.provides;const r=qn.parent&&qn.parent.provides;r===t&&(t=qn.provides=Object.create(r)),t[n]=e}}function Ur(n,e,t=!1){const r=qn||gr;if(r||Ma){let s=Ma?Ma._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return t&&Je(e)?e.call(r&&r.proxy):e}}const cb={},db=()=>Object.create(cb),hb=n=>Object.getPrototypeOf(n)===cb;function jA(n,e,t,r=!1){const s={},i=db();n.propsDefaults=Object.create(null),fb(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:z_(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function BA(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=wt(s),[l]=n.propsOptions;let c=!1;if((r||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let f=0;f<d.length;f++){let g=d[f];if(fh(n.emitsOptions,g))continue;const y=e[g];if(l)if(It(i,g))y!==i[g]&&(i[g]=y,c=!0);else{const E=Pr(g);s[E]=lp(l,a,E,y,n,!1)}else y!==i[g]&&(i[g]=y,c=!0)}}}else{fb(n,e,s,i)&&(c=!0);let d;for(const f in a)(!e||!It(e,f)&&((d=Ui(f))===f||!It(e,d)))&&(l?t&&(t[f]!==void 0||t[d]!==void 0)&&(s[f]=lp(l,a,f,void 0,n,!0)):delete s[f]);if(i!==a)for(const f in i)(!e||!It(e,f))&&(delete i[f],c=!0)}c&&As(n.attrs,"set","")}function fb(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(uu(l))continue;const c=e[l];let d;s&&It(s,d=Pr(l))?!i||!i.includes(d)?t[d]=c:(a||(a={}))[d]=c:fh(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,o=!0)}if(i){const l=wt(t),c=a||Ct;for(let d=0;d<i.length;d++){const f=i[d];t[f]=lp(s,l,f,c[f],n,!It(c,f))}}return o}function lp(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=It(o,"default");if(a&&r===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Je(l)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const d=sc(s);r=c[t]=l.call(null,e),d()}}else r=l;s.ce&&s.ce._setProp(t,r)}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Ui(t))&&(r=!0))}return r}const qA=new WeakMap;function pb(n,e,t=!1){const r=t?qA:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let l=!1;if(!Je(n)){const d=f=>{l=!0;const[g,y]=pb(f,e,!0);Cn(o,g),y&&a.push(...y)};!t&&e.mixins.length&&e.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!i&&!l)return Vt(n)&&r.set(n,Da),Da;if(ze(i))for(let d=0;d<i.length;d++){const f=Pr(i[d]);Vv(f)&&(o[f]=Ct)}else if(i)for(const d in i){const f=Pr(d);if(Vv(f)){const g=i[d],y=o[f]=ze(g)||Je(g)?{type:g}:Cn({},g),E=y.type;let A=!1,R=!0;if(ze(E))for(let B=0;B<E.length;++B){const q=E[B],F=Je(q)&&q.name;if(F==="Boolean"){A=!0;break}else F==="String"&&(R=!1)}else A=Je(E)&&E.name==="Boolean";y[0]=A,y[1]=R,(A||It(y,"default"))&&a.push(f)}}const c=[o,a];return Vt(n)&&r.set(n,c),c}function Vv(n){return n[0]!=="$"&&!uu(n)}const hm=n=>n[0]==="_"||n==="$stable",fm=n=>ze(n)?n.map(ts):[ts(n)],zA=(n,e,t)=>{if(e._n)return e;const r=vA((...s)=>fm(e(...s)),t);return r._c=!1,r},mb=(n,e,t)=>{const r=n._ctx;for(const s in n){if(hm(s))continue;const i=n[s];if(Je(i))e[s]=zA(s,i,r);else if(i!=null){const o=fm(i);e[s]=()=>o}}},gb=(n,e)=>{const t=fm(e);n.slots.default=()=>t},vb=(n,e,t)=>{for(const r in e)(t||!hm(r))&&(n[r]=e[r])},KA=(n,e,t)=>{const r=n.slots=db();if(n.vnode.shapeFlag&32){const s=e.__;s&&Zf(r,"__",s,!0);const i=e._;i?(vb(r,e,t),t&&Zf(r,"_",i,!0)):mb(e,r)}else e&&gb(n,e)},GA=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=Ct;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:vb(s,e,t):(i=!e.$stable,mb(e,s)),o=e}else e&&(gb(n,e),o={default:1});if(i)for(const a in s)!hm(a)&&o[a]==null&&delete s[a]},Yn=o1;function HA(n){return WA(n)}function WA(n,e){const t=lh();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:l,setText:c,setElementText:d,parentNode:f,nextSibling:g,setScopeId:y=Fr,insertStaticContent:E}=n,A=(I,S,M,le=null,ne=null,ie=null,_e=void 0,be=null,we=!!S.dynamicChildren)=>{if(I===S)return;I&&!Kl(I,S)&&(le=D(I),Q(I,ne,ie,!0),I=null),S.patchFlag===-2&&(we=!1,S.dynamicChildren=null);const{type:ge,ref:Me,shapeFlag:xe}=S;switch(ge){case ph:R(I,S,M,le);break;case Ci:B(I,S,M,le);break;case ad:I==null&&q(S,M,le,_e);break;case ct:j(I,S,M,le,ne,ie,_e,be,we);break;default:xe&1?de(I,S,M,le,ne,ie,_e,be,we):xe&6?C(I,S,M,le,ne,ie,_e,be,we):(xe&64||xe&128)&&ge.process(I,S,M,le,ne,ie,_e,be,we,oe)}Me!=null&&ne?pu(Me,I&&I.ref,ie,S||I,!S):Me==null&&I&&I.ref!=null&&pu(I.ref,null,ie,I,!0)},R=(I,S,M,le)=>{if(I==null)r(S.el=a(S.children),M,le);else{const ne=S.el=I.el;S.children!==I.children&&c(ne,S.children)}},B=(I,S,M,le)=>{I==null?r(S.el=l(S.children||""),M,le):S.el=I.el},q=(I,S,M,le)=>{[I.el,I.anchor]=E(I.children,S,M,le,I.el,I.anchor)},F=({el:I,anchor:S},M,le)=>{let ne;for(;I&&I!==S;)ne=g(I),r(I,M,le),I=ne;r(S,M,le)},z=({el:I,anchor:S})=>{let M;for(;I&&I!==S;)M=g(I),s(I),I=M;s(S)},de=(I,S,M,le,ne,ie,_e,be,we)=>{S.type==="svg"?_e="svg":S.type==="math"&&(_e="mathml"),I==null?me(S,M,le,ne,ie,_e,be,we):x(I,S,ne,ie,_e,be,we)},me=(I,S,M,le,ne,ie,_e,be)=>{let we,ge;const{props:Me,shapeFlag:xe,transition:ke,dirs:Be}=I;if(we=I.el=o(I.type,ie,Me&&Me.is,Me),xe&8?d(we,I.children):xe&16&&w(I.children,we,null,le,ne,Ef(I,ie),_e,be),Be&&_o(I,null,le,"created"),T(we,I,I.scopeId,_e,le),Me){for(const He in Me)He!=="value"&&!uu(He)&&i(we,He,null,Me[He],ie,le);"value"in Me&&i(we,"value",null,Me.value,ie),(ge=Me.onVnodeBeforeMount)&&Zr(ge,le,I)}Be&&_o(I,null,le,"beforeMount");const je=QA(ne,ke);je&&ke.beforeEnter(we),r(we,S,M),((ge=Me&&Me.onVnodeMounted)||je||Be)&&Yn(()=>{ge&&Zr(ge,le,I),je&&ke.enter(we),Be&&_o(I,null,le,"mounted")},ne)},T=(I,S,M,le,ne)=>{if(M&&y(I,M),le)for(let ie=0;ie<le.length;ie++)y(I,le[ie]);if(ne){let ie=ne.subTree;if(S===ie||Ib(ie.type)&&(ie.ssContent===S||ie.ssFallback===S)){const _e=ne.vnode;T(I,_e,_e.scopeId,_e.slotScopeIds,ne.parent)}}},w=(I,S,M,le,ne,ie,_e,be,we=0)=>{for(let ge=we;ge<I.length;ge++){const Me=I[ge]=be?hi(I[ge]):ts(I[ge]);A(null,Me,S,M,le,ne,ie,_e,be)}},x=(I,S,M,le,ne,ie,_e)=>{const be=S.el=I.el;let{patchFlag:we,dynamicChildren:ge,dirs:Me}=S;we|=I.patchFlag&16;const xe=I.props||Ct,ke=S.props||Ct;let Be;if(M&&bo(M,!1),(Be=ke.onVnodeBeforeUpdate)&&Zr(Be,M,S,I),Me&&_o(S,I,M,"beforeUpdate"),M&&bo(M,!0),(xe.innerHTML&&ke.innerHTML==null||xe.textContent&&ke.textContent==null)&&d(be,""),ge?N(I.dynamicChildren,ge,be,M,le,Ef(S,ne),ie):_e||W(I,S,be,null,M,le,Ef(S,ne),ie,!1),we>0){if(we&16)L(be,xe,ke,M,ne);else if(we&2&&xe.class!==ke.class&&i(be,"class",null,ke.class,ne),we&4&&i(be,"style",xe.style,ke.style,ne),we&8){const je=S.dynamicProps;for(let He=0;He<je.length;He++){const rt=je[He],mn=xe[rt],nn=ke[rt];(nn!==mn||rt==="value")&&i(be,rt,mn,nn,ne,M)}}we&1&&I.children!==S.children&&d(be,S.children)}else!_e&&ge==null&&L(be,xe,ke,M,ne);((Be=ke.onVnodeUpdated)||Me)&&Yn(()=>{Be&&Zr(Be,M,S,I),Me&&_o(S,I,M,"updated")},le)},N=(I,S,M,le,ne,ie,_e)=>{for(let be=0;be<S.length;be++){const we=I[be],ge=S[be],Me=we.el&&(we.type===ct||!Kl(we,ge)||we.shapeFlag&198)?f(we.el):M;A(we,ge,Me,null,le,ne,ie,_e,!0)}},L=(I,S,M,le,ne)=>{if(S!==M){if(S!==Ct)for(const ie in S)!uu(ie)&&!(ie in M)&&i(I,ie,S[ie],null,ne,le);for(const ie in M){if(uu(ie))continue;const _e=M[ie],be=S[ie];_e!==be&&ie!=="value"&&i(I,ie,be,_e,ne,le)}"value"in M&&i(I,"value",S.value,M.value,ne)}},j=(I,S,M,le,ne,ie,_e,be,we)=>{const ge=S.el=I?I.el:a(""),Me=S.anchor=I?I.anchor:a("");let{patchFlag:xe,dynamicChildren:ke,slotScopeIds:Be}=S;Be&&(be=be?be.concat(Be):Be),I==null?(r(ge,M,le),r(Me,M,le),w(S.children||[],M,Me,ne,ie,_e,be,we)):xe>0&&xe&64&&ke&&I.dynamicChildren?(N(I.dynamicChildren,ke,M,ne,ie,_e,be),(S.key!=null||ne&&S===ne.subTree)&&pm(I,S,!0)):W(I,S,M,Me,ne,ie,_e,be,we)},C=(I,S,M,le,ne,ie,_e,be,we)=>{S.slotScopeIds=be,I==null?S.shapeFlag&512?ne.ctx.activate(S,M,le,_e,we):ht(S,M,le,ne,ie,_e,we):et(I,S,we)},ht=(I,S,M,le,ne,ie,_e)=>{const be=I.component=f1(I,le,ne);if(sb(I)&&(be.ctx.renderer=oe),p1(be,!1,_e),be.asyncDep){if(ne&&ne.registerDep(be,ee,_e),!I.el){const we=be.subTree=st(Ci);B(null,we,S,M)}}else ee(be,I,S,M,ne,ie,_e)},et=(I,S,M)=>{const le=S.component=I.component;if(s1(I,S,M))if(le.asyncDep&&!le.asyncResolved){U(le,S,M);return}else le.next=S,le.update();else S.el=I.el,le.vnode=S},ee=(I,S,M,le,ne,ie,_e)=>{const be=()=>{if(I.isMounted){let{next:xe,bu:ke,u:Be,parent:je,vnode:He}=I;{const rn=yb(I);if(rn){xe&&(xe.el=He.el,U(I,xe,_e)),rn.asyncDep.then(()=>{I.isUnmounted||be()});return}}let rt=xe,mn;bo(I,!1),xe?(xe.el=He.el,U(I,xe,_e)):xe=He,ke&&sd(ke),(mn=xe.props&&xe.props.onVnodeBeforeUpdate)&&Zr(mn,je,xe,He),bo(I,!0);const nn=xf(I),wn=I.subTree;I.subTree=nn,A(wn,nn,f(wn.el),D(wn),I,ne,ie),xe.el=nn.el,rt===null&&i1(I,nn.el),Be&&Yn(Be,ne),(mn=xe.props&&xe.props.onVnodeUpdated)&&Yn(()=>Zr(mn,je,xe,He),ne)}else{let xe;const{el:ke,props:Be}=S,{bm:je,m:He,parent:rt,root:mn,type:nn}=I,wn=mu(S);if(bo(I,!1),je&&sd(je),!wn&&(xe=Be&&Be.onVnodeBeforeMount)&&Zr(xe,rt,S),bo(I,!0),ke&&qe){const rn=()=>{I.subTree=xf(I),qe(ke,I.subTree,I,ne,null)};wn&&nn.__asyncHydrate?nn.__asyncHydrate(ke,I,rn):rn()}else{mn.ce&&mn.ce._def.shadowRoot!==!1&&mn.ce._injectChildStyle(nn);const rn=I.subTree=xf(I);A(null,rn,M,le,I,ne,ie),S.el=rn.el}if(He&&Yn(He,ne),!wn&&(xe=Be&&Be.onVnodeMounted)){const rn=S;Yn(()=>Zr(xe,rt,rn),ne)}(S.shapeFlag&256||rt&&mu(rt.vnode)&&rt.vnode.shapeFlag&256)&&I.a&&Yn(I.a,ne),I.isMounted=!0,S=M=le=null}};I.scope.on();const we=I.effect=new C_(be);I.scope.off();const ge=I.update=we.run.bind(we),Me=I.job=we.runIfDirty.bind(we);Me.i=I,Me.id=I.uid,we.scheduler=()=>um(Me),bo(I,!0),ge()},U=(I,S,M)=>{S.component=I;const le=I.vnode.props;I.vnode=S,I.next=null,BA(I,S.props,le,M),GA(I,S.children,M),Os(),Tv(I),Ms()},W=(I,S,M,le,ne,ie,_e,be,we=!1)=>{const ge=I&&I.children,Me=I?I.shapeFlag:0,xe=S.children,{patchFlag:ke,shapeFlag:Be}=S;if(ke>0){if(ke&128){Se(ge,xe,M,le,ne,ie,_e,be,we);return}else if(ke&256){re(ge,xe,M,le,ne,ie,_e,be,we);return}}Be&8?(Me&16&&vt(ge,ne,ie),xe!==ge&&d(M,xe)):Me&16?Be&16?Se(ge,xe,M,le,ne,ie,_e,be,we):vt(ge,ne,ie,!0):(Me&8&&d(M,""),Be&16&&w(xe,M,le,ne,ie,_e,be,we))},re=(I,S,M,le,ne,ie,_e,be,we)=>{I=I||Da,S=S||Da;const ge=I.length,Me=S.length,xe=Math.min(ge,Me);let ke;for(ke=0;ke<xe;ke++){const Be=S[ke]=we?hi(S[ke]):ts(S[ke]);A(I[ke],Be,M,null,ne,ie,_e,be,we)}ge>Me?vt(I,ne,ie,!0,!1,xe):w(S,M,le,ne,ie,_e,be,we,xe)},Se=(I,S,M,le,ne,ie,_e,be,we)=>{let ge=0;const Me=S.length;let xe=I.length-1,ke=Me-1;for(;ge<=xe&&ge<=ke;){const Be=I[ge],je=S[ge]=we?hi(S[ge]):ts(S[ge]);if(Kl(Be,je))A(Be,je,M,null,ne,ie,_e,be,we);else break;ge++}for(;ge<=xe&&ge<=ke;){const Be=I[xe],je=S[ke]=we?hi(S[ke]):ts(S[ke]);if(Kl(Be,je))A(Be,je,M,null,ne,ie,_e,be,we);else break;xe--,ke--}if(ge>xe){if(ge<=ke){const Be=ke+1,je=Be<Me?S[Be].el:le;for(;ge<=ke;)A(null,S[ge]=we?hi(S[ge]):ts(S[ge]),M,je,ne,ie,_e,be,we),ge++}}else if(ge>ke)for(;ge<=xe;)Q(I[ge],ne,ie,!0),ge++;else{const Be=ge,je=ge,He=new Map;for(ge=je;ge<=ke;ge++){const $t=S[ge]=we?hi(S[ge]):ts(S[ge]);$t.key!=null&&He.set($t.key,ge)}let rt,mn=0;const nn=ke-je+1;let wn=!1,rn=0;const lr=new Array(nn);for(ge=0;ge<nn;ge++)lr[ge]=0;for(ge=Be;ge<=xe;ge++){const $t=I[ge];if(mn>=nn){Q($t,ne,ie,!0);continue}let In;if($t.key!=null)In=He.get($t.key);else for(rt=je;rt<=ke;rt++)if(lr[rt-je]===0&&Kl($t,S[rt])){In=rt;break}In===void 0?Q($t,ne,ie,!0):(lr[In-je]=ge+1,In>=rn?rn=In:wn=!0,A($t,S[In],M,null,ne,ie,_e,be,we),mn++)}const kr=wn?JA(lr):Da;for(rt=kr.length-1,ge=nn-1;ge>=0;ge--){const $t=je+ge,In=S[$t],ps=$t+1<Me?S[$t+1].el:le;lr[ge]===0?A(null,In,M,ps,ne,ie,_e,be,we):wn&&(rt<0||ge!==kr[rt]?Z(In,M,ps,2):rt--)}}},Z=(I,S,M,le,ne=null)=>{const{el:ie,type:_e,transition:be,children:we,shapeFlag:ge}=I;if(ge&6){Z(I.component.subTree,S,M,le);return}if(ge&128){I.suspense.move(S,M,le);return}if(ge&64){_e.move(I,S,M,oe);return}if(_e===ct){r(ie,S,M);for(let xe=0;xe<we.length;xe++)Z(we[xe],S,M,le);r(I.anchor,S,M);return}if(_e===ad){F(I,S,M);return}if(le!==2&&ge&1&&be)if(le===0)be.beforeEnter(ie),r(ie,S,M),Yn(()=>be.enter(ie),ne);else{const{leave:xe,delayLeave:ke,afterLeave:Be}=be,je=()=>{I.ctx.isUnmounted?s(ie):r(ie,S,M)},He=()=>{xe(ie,()=>{je(),Be&&Be()})};ke?ke(ie,je,He):He()}else r(ie,S,M)},Q=(I,S,M,le=!1,ne=!1)=>{const{type:ie,props:_e,ref:be,children:we,dynamicChildren:ge,shapeFlag:Me,patchFlag:xe,dirs:ke,cacheIndex:Be}=I;if(xe===-2&&(ne=!1),be!=null&&(Os(),pu(be,null,M,I,!0),Ms()),Be!=null&&(S.renderCache[Be]=void 0),Me&256){S.ctx.deactivate(I);return}const je=Me&1&&ke,He=!mu(I);let rt;if(He&&(rt=_e&&_e.onVnodeBeforeUnmount)&&Zr(rt,S,I),Me&6)ft(I.component,M,le);else{if(Me&128){I.suspense.unmount(M,le);return}je&&_o(I,null,S,"beforeUnmount"),Me&64?I.type.remove(I,S,M,oe,le):ge&&!ge.hasOnce&&(ie!==ct||xe>0&&xe&64)?vt(ge,S,M,!1,!0):(ie===ct&&xe&384||!ne&&Me&16)&&vt(we,S,M),le&&Ee(I)}(He&&(rt=_e&&_e.onVnodeUnmounted)||je)&&Yn(()=>{rt&&Zr(rt,S,I),je&&_o(I,null,S,"unmounted")},M)},Ee=I=>{const{type:S,el:M,anchor:le,transition:ne}=I;if(S===ct){We(M,le);return}if(S===ad){z(I);return}const ie=()=>{s(M),ne&&!ne.persisted&&ne.afterLeave&&ne.afterLeave()};if(I.shapeFlag&1&&ne&&!ne.persisted){const{leave:_e,delayLeave:be}=ne,we=()=>_e(M,ie);be?be(I.el,ie,we):we()}else ie()},We=(I,S)=>{let M;for(;I!==S;)M=g(I),s(I),I=M;s(S)},ft=(I,S,M)=>{const{bum:le,scope:ne,job:ie,subTree:_e,um:be,m:we,a:ge,parent:Me,slots:{__:xe}}=I;Ov(we),Ov(ge),le&&sd(le),Me&&ze(xe)&&xe.forEach(ke=>{Me.renderCache[ke]=void 0}),ne.stop(),ie&&(ie.flags|=8,Q(_e,I,S,M)),be&&Yn(be,S),Yn(()=>{I.isUnmounted=!0},S),S&&S.pendingBranch&&!S.isUnmounted&&I.asyncDep&&!I.asyncResolved&&I.suspenseId===S.pendingId&&(S.deps--,S.deps===0&&S.resolve())},vt=(I,S,M,le=!1,ne=!1,ie=0)=>{for(let _e=ie;_e<I.length;_e++)Q(I[_e],S,M,le,ne)},D=I=>{if(I.shapeFlag&6)return D(I.component.subTree);if(I.shapeFlag&128)return I.suspense.next();const S=g(I.anchor||I.el),M=S&&S[Z_];return M?g(M):S};let $=!1;const te=(I,S,M)=>{I==null?S._vnode&&Q(S._vnode,null,null,!0):A(S._vnode||null,I,S,null,null,null,M),S._vnode=I,$||($=!0,Tv(),J_(),$=!1)},oe={p:A,um:Q,m:Z,r:Ee,mt:ht,mc:w,pc:W,pbc:N,n:D,o:n};let Ve,qe;return e&&([Ve,qe]=e(oe)),{render:te,hydrate:Ve,createApp:UA(te,Ve)}}function Ef({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function bo({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function QA(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function pm(n,e,t=!1){const r=n.children,s=e.children;if(ze(r)&&ze(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=hi(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&pm(o,a)),a.type===ph&&(a.el=o.el),a.type===Ci&&!a.el&&(a.el=o.el)}}function JA(n){const e=n.slice(),t=[0];let r,s,i,o,a;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<c?i=a+1:o=a;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function yb(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:yb(e)}function Ov(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const YA=Symbol.for("v-scx"),XA=()=>Ur(YA);function Pt(n,e,t){return _b(n,e,t)}function _b(n,e,t=Ct){const{immediate:r,deep:s,flush:i,once:o}=t,a=Cn({},t),l=e&&r||!e&&i!=="post";let c;if(Cu){if(i==="sync"){const y=XA();c=y.__watcherHandles||(y.__watcherHandles=[])}else if(!l){const y=()=>{};return y.stop=Fr,y.resume=Fr,y.pause=Fr,y}}const d=qn;a.call=(y,E,A)=>cs(y,d,E,A);let f=!1;i==="post"?a.scheduler=y=>{Yn(y,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(y,E)=>{E?y():um(y)}),a.augmentJob=y=>{e&&(y.flags|=4),f&&(y.flags|=2,d&&(y.id=d.uid,y.i=d))};const g=fA(n,e,a);return Cu&&(c?c.push(g):l&&g()),g}function ZA(n,e,t){const r=this.proxy,s=dn(n)?n.includes(".")?bb(r,n):()=>r[n]:n.bind(r,r);let i;Je(e)?i=e:(i=e.handler,t=e);const o=sc(this),a=_b(s,i.bind(r),t);return o(),a}function bb(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}const e1=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Pr(e)}Modifiers`]||n[`${Ui(e)}Modifiers`];function t1(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||Ct;let s=t;const i=e.startsWith("update:"),o=i&&e1(r,e.slice(7));o&&(o.trim&&(s=t.map(d=>dn(d)?d.trim():d)),o.number&&(s=t.map(Ad)));let a,l=r[a=vf(e)]||r[a=vf(Pr(e))];!l&&i&&(l=r[a=vf(Ui(e))]),l&&cs(l,n,6,s);const c=r[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,cs(c,n,6,s)}}function wb(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!Je(n)){const l=c=>{const d=wb(c,e,!0);d&&(a=!0,Cn(o,d))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!a?(Vt(n)&&r.set(n,null),null):(ze(i)?i.forEach(l=>o[l]=null):Cn(o,i),Vt(n)&&r.set(n,o),o)}function fh(n,e){return!n||!ih(e)?!1:(e=e.slice(2).replace(/Once$/,""),It(n,e[0].toLowerCase()+e.slice(1))||It(n,Ui(e))||It(n,e))}function xf(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:l,render:c,renderCache:d,props:f,data:g,setupState:y,ctx:E,inheritAttrs:A}=n,R=Cd(n);let B,q;try{if(t.shapeFlag&4){const z=s||r,de=z;B=ts(c.call(de,z,d,f,y,g,E)),q=a}else{const z=e;B=ts(z.length>1?z(f,{attrs:a,slots:o,emit:l}):z(f,null)),q=e.props?a:n1(a)}}catch(z){vu.length=0,dh(z,n,1),B=st(Ci)}let F=B;if(q&&A!==!1){const z=Object.keys(q),{shapeFlag:de}=F;z.length&&de&7&&(i&&z.some(Xp)&&(q=r1(q,i)),F=qa(F,q,!1,!0))}return t.dirs&&(F=qa(F,null,!1,!0),F.dirs=F.dirs?F.dirs.concat(t.dirs):t.dirs),t.transition&&cm(F,t.transition),B=F,Cd(R),B}const n1=n=>{let e;for(const t in n)(t==="class"||t==="style"||ih(t))&&((e||(e={}))[t]=n[t]);return e},r1=(n,e)=>{const t={};for(const r in n)(!Xp(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function s1(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?Mv(r,o,c):!!o;if(l&8){const d=e.dynamicProps;for(let f=0;f<d.length;f++){const g=d[f];if(o[g]!==r[g]&&!fh(c,g))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Mv(r,o,c):!0:!!o;return!1}function Mv(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!fh(t,i))return!0}return!1}function i1({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const Ib=n=>n.__isSuspense;function o1(n,e){e&&e.pendingBranch?ze(n)?e.effects.push(...n):e.effects.push(n):gA(n)}const ct=Symbol.for("v-fgt"),ph=Symbol.for("v-txt"),Ci=Symbol.for("v-cmt"),ad=Symbol.for("v-stc"),vu=[];let vr=null;function V(n=!1){vu.push(vr=n?null:[])}function a1(){vu.pop(),vr=vu[vu.length-1]||null}let Ru=1;function Lv(n,e=!1){Ru+=n,n<0&&vr&&e&&(vr.hasOnce=!0)}function Eb(n){return n.dynamicChildren=Ru>0?vr||Da:null,a1(),Ru>0&&vr&&vr.push(n),n}function O(n,e,t,r,s,i){return Eb(h(n,e,t,r,s,i,!0))}function ko(n,e,t,r,s){return Eb(st(n,e,t,r,s,!0))}function Dd(n){return n?n.__v_isVNode===!0:!1}function Kl(n,e){return n.type===e.type&&n.key===e.key}const xb=({key:n})=>n??null,ld=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?dn(n)||Kn(n)||Je(n)?{i:gr,r:n,k:e,f:!!t}:n:null);function h(n,e=null,t=null,r=0,s=null,i=n===ct?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&xb(e),ref:e&&ld(e),scopeId:X_,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:gr};return a?(mm(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=dn(t)?8:16),Ru>0&&!o&&vr&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&vr.push(l),l}const st=l1;function l1(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===kA)&&(n=Ci),Dd(n)){const a=qa(n,e,!0);return t&&mm(a,t),Ru>0&&!i&&vr&&(a.shapeFlag&6?vr[vr.indexOf(n)]=a:vr.push(a)),a.patchFlag=-2,a}if(_1(n)&&(n=n.__vccOpts),e){e=u1(e);let{class:a,style:l}=e;a&&!dn(a)&&(e.class=St(a)),Vt(l)&&(lm(l)&&!ze(l)&&(l=Cn({},l)),e.style=mr(l))}const o=dn(n)?1:Ib(n)?128:yA(n)?64:Vt(n)?4:Je(n)?2:0;return h(n,e,t,r,s,o,i,!0)}function u1(n){return n?lm(n)||hb(n)?Cn({},n):n:null}function qa(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:l}=n,c=e?c1(s||{},e):s,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&xb(c),ref:e&&e.ref?t&&i?ze(i)?i.concat(ld(e)):[i,ld(e)]:ld(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==ct?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&qa(n.ssContent),ssFallback:n.ssFallback&&qa(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&cm(d,l.clone(d)),d}function Yt(n=" ",e=0){return st(ph,null,n,e)}function Xn(n,e){const t=st(ad,null,n);return t.staticCount=e,t}function ye(n="",e=!1){return e?(V(),ko(Ci,null,n)):st(Ci,null,n)}function ts(n){return n==null||typeof n=="boolean"?st(Ci):ze(n)?st(ct,null,n.slice()):Dd(n)?hi(n):st(ph,null,String(n))}function hi(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:qa(n)}function mm(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(ze(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),mm(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!hb(e)?e._ctx=gr:s===3&&gr&&(gr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Je(e)?(e={default:e,_ctx:gr},t=32):(e=String(e),r&64?(t=16,e=[Yt(e)]):t=8);n.children=e,n.shapeFlag|=t}function c1(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=St([e.class,r.class]));else if(s==="style")e.style=mr([e.style,r.style]);else if(ih(s)){const i=e[s],o=r[s];o&&i!==o&&!(ze(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function Zr(n,e,t,r=null){cs(n,e,7,[t,r])}const d1=ub();let h1=0;function f1(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||d1,i={uid:h1++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new UT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:pb(r,s),emitsOptions:wb(r,s),emit:null,emitted:null,propsDefaults:Ct,inheritAttrs:r.inheritAttrs,ctx:Ct,data:Ct,props:Ct,attrs:Ct,slots:Ct,refs:Ct,setupState:Ct,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=t1.bind(null,i),n.ce&&n.ce(i),i}let qn=null,Nd,up;{const n=lh(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};Nd=e("__VUE_INSTANCE_SETTERS__",t=>qn=t),up=e("__VUE_SSR_SETTERS__",t=>Cu=t)}const sc=n=>{const e=qn;return Nd(n),n.scope.on(),()=>{n.scope.off(),Nd(e)}},Fv=()=>{qn&&qn.scope.off(),Nd(null)};function Tb(n){return n.vnode.shapeFlag&4}let Cu=!1;function p1(n,e=!1,t=!1){e&&up(e);const{props:r,children:s}=n.vnode,i=Tb(n);jA(n,r,i,e),KA(n,s,t||e);const o=i?m1(n,e):void 0;return e&&up(!1),o}function m1(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,NA);const{setup:r}=t;if(r){Os();const s=n.setupContext=r.length>1?v1(n):null,i=sc(n),o=rc(r,n,0,[n.props,s]),a=x_(o);if(Ms(),i(),(a||n.sp)&&!mu(n)&&rb(n),a){if(o.then(Fv,Fv),e)return o.then(l=>{$v(n,l,e)}).catch(l=>{dh(l,n,0)});n.asyncDep=o}else $v(n,o,e)}else Ab(n,e)}function $v(n,e,t){Je(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Vt(e)&&(n.setupState=H_(e)),Ab(n,t)}let Uv;function Ab(n,e,t){const r=n.type;if(!n.render){if(!e&&Uv&&!r.render){const s=r.template||dm(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=r,c=Cn(Cn({isCustomElement:i,delimiters:a},o),l);r.render=Uv(s,c)}}n.render=r.render||Fr}{const s=sc(n);Os();try{VA(n)}finally{Ms(),s()}}}const g1={get(n,e){return Bn(n,"get",""),n[e]}};function v1(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,g1),slots:n.slots,emit:n.emit,expose:e}}function mh(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(H_(oA(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in gu)return gu[t](n)},has(e,t){return t in e||t in gu}})):n.proxy}function y1(n,e=!0){return Je(n)?n.displayName||n.name:n.name||e&&n.__name}function _1(n){return Je(n)&&"__vccOpts"in n}const Ue=(n,e)=>dA(n,e,Cu);function Sb(n,e,t){const r=arguments.length;return r===2?Vt(e)&&!ze(e)?Dd(e)?st(n,null,[e]):st(n,e):st(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&Dd(t)&&(t=[t]),st(n,e,t))}const b1="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let cp;const jv=typeof window<"u"&&window.trustedTypes;if(jv)try{cp=jv.createPolicy("vue",{createHTML:n=>n})}catch{}const Pb=cp?n=>cp.createHTML(n):n=>n,w1="http://www.w3.org/2000/svg",I1="http://www.w3.org/1998/Math/MathML",xs=typeof document<"u"?document:null,Bv=xs&&xs.createElement("template"),E1={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?xs.createElementNS(w1,n):e==="mathml"?xs.createElementNS(I1,n):t?xs.createElement(n,{is:t}):xs.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>xs.createTextNode(n),createComment:n=>xs.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>xs.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Bv.innerHTML=Pb(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const a=Bv.content;if(r==="svg"||r==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},x1=Symbol("_vtc");function T1(n,e,t){const r=n[x1];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const Vd=Symbol("_vod"),Rb=Symbol("_vsh"),Tf={beforeMount(n,{value:e},{transition:t}){n[Vd]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Gl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),Gl(n,!0),r.enter(n)):r.leave(n,()=>{Gl(n,!1)}):Gl(n,e))},beforeUnmount(n,{value:e}){Gl(n,e)}};function Gl(n,e){n.style.display=e?n[Vd]:"none",n[Rb]=!e}const A1=Symbol(""),S1=/(^|;)\s*display\s*:/;function P1(n,e,t){const r=n.style,s=dn(t);let i=!1;if(t&&!s){if(e)if(dn(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&ud(r,a,"")}else for(const o in e)t[o]==null&&ud(r,o,"");for(const o in t)o==="display"&&(i=!0),ud(r,o,t[o])}else if(s){if(e!==t){const o=r[A1];o&&(t+=";"+o),r.cssText=t,i=S1.test(t)}}else e&&n.removeAttribute("style");Vd in n&&(n[Vd]=i?r.display:"",n[Rb]&&(r.display="none"))}const qv=/\s*!important$/;function ud(n,e,t){if(ze(t))t.forEach(r=>ud(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=R1(n,e);qv.test(t)?n.setProperty(Ui(r),t.replace(qv,""),"important"):n[r]=t}}const zv=["Webkit","Moz","ms"],Af={};function R1(n,e){const t=Af[e];if(t)return t;let r=Pr(e);if(r!=="filter"&&r in n)return Af[e]=r;r=ah(r);for(let s=0;s<zv.length;s++){const i=zv[s]+r;if(i in n)return Af[e]=i}return e}const Kv="http://www.w3.org/1999/xlink";function Gv(n,e,t,r,s,i=FT(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(Kv,e.slice(6,e.length)):n.setAttributeNS(Kv,e,t):t==null||i&&!S_(t)?n.removeAttribute(e):n.setAttribute(e,i?"":us(t)?String(t):t)}function Hv(n,e,t,r,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?Pb(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let o=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=S_(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{n[e]=t}catch{}o&&n.removeAttribute(s||e)}function pi(n,e,t,r){n.addEventListener(e,t,r)}function C1(n,e,t,r){n.removeEventListener(e,t,r)}const Wv=Symbol("_vei");function k1(n,e,t,r,s=null){const i=n[Wv]||(n[Wv]={}),o=i[e];if(r&&o)o.value=r;else{const[a,l]=D1(e);if(r){const c=i[e]=O1(r,s);pi(n,a,c,l)}else o&&(C1(n,a,o,l),i[e]=void 0)}}const Qv=/(?:Once|Passive|Capture)$/;function D1(n){let e;if(Qv.test(n)){e={};let r;for(;r=n.match(Qv);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Ui(n.slice(2)),e]}let Sf=0;const N1=Promise.resolve(),V1=()=>Sf||(N1.then(()=>Sf=0),Sf=Date.now());function O1(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;cs(M1(r,t.value),e,5,[r])};return t.value=n,t.attached=V1(),t}function M1(n,e){if(ze(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Jv=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,L1=(n,e,t,r,s,i)=>{const o=s==="svg";e==="class"?T1(n,r,o):e==="style"?P1(n,t,r):ih(e)?Xp(e)||k1(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):F1(n,e,r,o))?(Hv(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Gv(n,e,r,o,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!dn(r))?Hv(n,Pr(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Gv(n,e,r,o))};function F1(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&Jv(e)&&Je(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Jv(e)&&dn(t)?!1:e in n}const za=n=>{const e=n.props["onUpdate:modelValue"]||!1;return ze(e)?t=>sd(e,t):e};function $1(n){n.target.composing=!0}function Yv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Ds=Symbol("_assign"),Nt={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Ds]=za(s);const i=r||s.props&&s.props.type==="number";pi(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=Ad(a)),n[Ds](a)}),t&&pi(n,"change",()=>{n.value=n.value.trim()}),e||(pi(n,"compositionstart",$1),pi(n,"compositionend",Yv),pi(n,"change",Yv))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},o){if(n[Ds]=za(o),n.composing)return;const a=(i||n.type==="number")&&!/^0\d/.test(n.value)?Ad(n.value):n.value,l=e??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===l)||(n.value=l))}},Ii={deep:!0,created(n,e,t){n[Ds]=za(t),pi(n,"change",()=>{const r=n._modelValue,s=ku(n),i=n.checked,o=n[Ds];if(ze(r)){const a=tm(r,s),l=a!==-1;if(i&&!l)o(r.concat(s));else if(!i&&l){const c=[...r];c.splice(a,1),o(c)}}else if(cl(r)){const a=new Set(r);i?a.add(s):a.delete(s),o(a)}else o(Cb(n,i))})},mounted:Xv,beforeUpdate(n,e,t){n[Ds]=za(t),Xv(n,e,t)}};function Xv(n,{value:e,oldValue:t},r){n._modelValue=e;let s;if(ze(e))s=tm(e,r.props.value)>-1;else if(cl(e))s=e.has(r.props.value);else{if(e===t)return;s=nc(e,Cb(n,!0))}n.checked!==s&&(n.checked=s)}const U1={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const s=cl(e);pi(n,"change",()=>{const i=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Ad(ku(o)):ku(o));n[Ds](n.multiple?s?new Set(i):i:i[0]),n._assigning=!0,Ut(()=>{n._assigning=!1})}),n[Ds]=za(r)},mounted(n,{value:e}){Zv(n,e)},beforeUpdate(n,e,t){n[Ds]=za(t)},updated(n,{value:e}){n._assigning||Zv(n,e)}};function Zv(n,e){const t=n.multiple,r=ze(e);if(!(t&&!r&&!cl(e))){for(let s=0,i=n.options.length;s<i;s++){const o=n.options[s],a=ku(o);if(t)if(r){const l=typeof a;l==="string"||l==="number"?o.selected=e.some(c=>String(c)===String(a)):o.selected=tm(e,a)>-1}else o.selected=e.has(a);else if(nc(ku(o),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function ku(n){return"_value"in n?n._value:n.value}function Cb(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const j1=["ctrl","shift","alt","meta"],B1={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>j1.some(t=>n[`${t}Key`]&&!e.includes(t))},mt=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=(s,...i)=>{for(let o=0;o<e.length;o++){const a=B1[e[o]];if(a&&a(s,e))return}return n(s,...i)})},q1={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Un=(n,e)=>{const t=n._withKeys||(n._withKeys={}),r=e.join(".");return t[r]||(t[r]=s=>{if(!("key"in s))return;const i=Ui(s.key);if(e.some(o=>o===i||q1[o]===i))return n(s)})},z1=Cn({patchProp:L1},E1);let ey;function K1(){return ey||(ey=HA(z1))}const G1=(...n)=>{const e=K1().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=W1(r);if(!s)return;const i=e._component;!Je(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,H1(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function H1(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function W1(n){return dn(n)?document.querySelector(n):n}const Q1={key:2,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg"},J1={__name:"App",setup(n){const e=P(null),t=P(!1),r=P(!1),s=P(!1);function i(c){c.preventDefault(),e.value=c,t.value=!0}async function o(){e.value&&(e.value.prompt(),await e.value.userChoice,t.value=!1,e.value=null)}function a(){t.value=!1,e.value=null}function l(){s.value=!0,"serviceWorker"in navigator&&navigator.serviceWorker.postMessage({type:"SKIP_WAITING"}),window.location.reload()}return zn(()=>{window.addEventListener("beforeinstallprompt",i),window.addEventListener("appinstalled",a),"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",()=>{s.value||(r.value=!0)}),setInterval(()=>{navigator.serviceWorker.getRegistration().then(c=>{c&&c.update()})},60*60*1e3))}),ob(()=>{window.removeEventListener("beforeinstallprompt",i),window.removeEventListener("appinstalled",a)}),(c,d)=>{const f=CA("router-view");return V(),O(ct,null,[st(f),t.value?(V(),O("button",{key:0,class:"fixed bottom-4 right-4 z-50 rounded-full bg-sky-600 text-white px-4 py-2 shadow-lg hover:bg-sky-700 active:bg-sky-800",onClick:o}," Installer l’app ")):ye("",!0),r.value&&!s.value?(V(),O("button",{key:1,class:"fixed bottom-4 right-4 z-50 rounded-full bg-green-600 text-white px-4 py-2 shadow-lg hover:bg-green-700 active:bg-green-800",onClick:l}," 🔄 Mettre à jour ")):ye("",!0),s.value?(V(),O("div",Q1," 🔄 Mise à jour... ")):ye("",!0)],64)}}};/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Aa=typeof document<"u";function kb(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function Y1(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&kb(n.default)}const bt=Object.assign;function Pf(n,e){const t={};for(const r in e){const s=e[r];t[r]=jr(s)?s.map(n):n(s)}return t}const yu=()=>{},jr=Array.isArray,Db=/#/g,X1=/&/g,Z1=/\//g,eS=/=/g,tS=/\?/g,Nb=/\+/g,nS=/%5B/g,rS=/%5D/g,Vb=/%5E/g,sS=/%60/g,Ob=/%7B/g,iS=/%7C/g,Mb=/%7D/g,oS=/%20/g;function gm(n){return encodeURI(""+n).replace(iS,"|").replace(nS,"[").replace(rS,"]")}function aS(n){return gm(n).replace(Ob,"{").replace(Mb,"}").replace(Vb,"^")}function dp(n){return gm(n).replace(Nb,"%2B").replace(oS,"+").replace(Db,"%23").replace(X1,"%26").replace(sS,"`").replace(Ob,"{").replace(Mb,"}").replace(Vb,"^")}function lS(n){return dp(n).replace(eS,"%3D")}function uS(n){return gm(n).replace(Db,"%23").replace(tS,"%3F")}function cS(n){return n==null?"":uS(n).replace(Z1,"%2F")}function Du(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const dS=/\/$/,hS=n=>n.replace(dS,"");function Rf(n,e,t="/"){let r,s={},i="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(r=e.slice(0,l),i=e.slice(l+1,a>-1?a:e.length),s=n(i)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=gS(r??e,t),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:Du(o)}}function fS(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function ty(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function pS(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Ka(e.matched[r],t.matched[s])&&Lb(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ka(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function Lb(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!mS(n[t],e[t]))return!1;return!0}function mS(n,e){return jr(n)?ny(n,e):jr(e)?ny(e,n):n===e}function ny(n,e){return jr(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function gS(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,o,a;for(o=0;o<r.length;o++)if(a=r[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(o).join("/")}const ai={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Nu;(function(n){n.pop="pop",n.push="push"})(Nu||(Nu={}));var _u;(function(n){n.back="back",n.forward="forward",n.unknown=""})(_u||(_u={}));function vS(n){if(!n)if(Aa){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),hS(n)}const yS=/^[^#]+#/;function _S(n,e){return n.replace(yS,"#")+e}function bS(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const gh=()=>({left:window.scrollX,top:window.scrollY});function wS(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=bS(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function ry(n,e){return(history.state?history.state.position-e:-1)+n}const hp=new Map;function IS(n,e){hp.set(n,e)}function ES(n){const e=hp.get(n);return hp.delete(n),e}let xS=()=>location.protocol+"//"+location.host;function Fb(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let a=s.includes(n.slice(i))?n.slice(i).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),ty(l,"")}return ty(t,n)+r+s}function TS(n,e,t,r){let s=[],i=[],o=null;const a=({state:g})=>{const y=Fb(n,location),E=t.value,A=e.value;let R=0;if(g){if(t.value=y,e.value=g,o&&o===E){o=null;return}R=A?g.position-A.position:0}else r(y);s.forEach(B=>{B(t.value,E,{delta:R,type:Nu.pop,direction:R?R>0?_u.forward:_u.back:_u.unknown})})};function l(){o=t.value}function c(g){s.push(g);const y=()=>{const E=s.indexOf(g);E>-1&&s.splice(E,1)};return i.push(y),y}function d(){const{history:g}=window;g.state&&g.replaceState(bt({},g.state,{scroll:gh()}),"")}function f(){for(const g of i)g();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:l,listen:c,destroy:f}}function sy(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?gh():null}}function AS(n){const{history:e,location:t}=window,r={value:Fb(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,d){const f=n.indexOf("#"),g=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:xS()+n+l;try{e[d?"replaceState":"pushState"](c,"",g),s.value=c}catch(y){console.error(y),t[d?"replace":"assign"](g)}}function o(l,c){const d=bt({},e.state,sy(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});i(l,d,!0),r.value=l}function a(l,c){const d=bt({},s.value,e.state,{forward:l,scroll:gh()});i(d.current,d,!0);const f=bt({},sy(r.value,l,null),{position:d.position+1},c);i(l,f,!1),r.value=l}return{location:r,state:s,push:a,replace:o}}function SS(n){n=vS(n);const e=AS(n),t=TS(n,e.state,e.location,e.replace);function r(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=bt({location:"",base:n,go:r,createHref:_S.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function PS(n){return typeof n=="string"||n&&typeof n=="object"}function $b(n){return typeof n=="string"||typeof n=="symbol"}const Ub=Symbol("");var iy;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(iy||(iy={}));function Ga(n,e){return bt(new Error,{type:n,[Ub]:!0},e)}function Es(n,e){return n instanceof Error&&Ub in n&&(e==null||!!(n.type&e))}const oy="[^/]+?",RS={sensitive:!1,strict:!1,start:!0,end:!0},CS=/[.+*?^${}()[\]/\\]/g;function kS(n,e){const t=bt({},RS,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const d=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const g=c[f];let y=40+(t.sensitive?.25:0);if(g.type===0)f||(s+="/"),s+=g.value.replace(CS,"\\$&"),y+=40;else if(g.type===1){const{value:E,repeatable:A,optional:R,regexp:B}=g;i.push({name:E,repeatable:A,optional:R});const q=B||oy;if(q!==oy){y+=10;try{new RegExp(`(${q})`)}catch(z){throw new Error(`Invalid custom RegExp for param "${E}" (${q}): `+z.message)}}let F=A?`((?:${q})(?:/(?:${q}))*)`:`(${q})`;f||(F=R&&c.length<2?`(?:/${F})`:"/"+F),R&&(F+="?"),s+=F,y+=20,R&&(y+=-8),A&&(y+=-20),q===".*"&&(y+=-50)}d.push(y)}r.push(d)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const d=c.match(o),f={};if(!d)return null;for(let g=1;g<d.length;g++){const y=d[g]||"",E=i[g-1];f[E.name]=y&&E.repeatable?y.split("/"):y}return f}function l(c){let d="",f=!1;for(const g of n){(!f||!d.endsWith("/"))&&(d+="/"),f=!1;for(const y of g)if(y.type===0)d+=y.value;else if(y.type===1){const{value:E,repeatable:A,optional:R}=y,B=E in c?c[E]:"";if(jr(B)&&!A)throw new Error(`Provided param "${E}" is an array but it is not repeatable (* or + modifiers)`);const q=jr(B)?B.join("/"):B;if(!q)if(R)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):f=!0);else throw new Error(`Missing required param "${E}"`);d+=q}}return d||"/"}return{re:o,score:r,keys:i,parse:a,stringify:l}}function DS(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function jb(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=DS(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(ay(r))return 1;if(ay(s))return-1}return s.length-r.length}function ay(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const NS={type:0,value:""},VS=/[a-zA-Z0-9_]/;function OS(n){if(!n)return[[]];if(n==="/")return[[NS]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(y){throw new Error(`ERR (${t})/"${c}": ${y}`)}let t=0,r=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,l,c="",d="";function f(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:d,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function g(){c+=l}for(;a<n.length;){if(l=n[a++],l==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):g();break;case 4:g(),t=r;break;case 1:l==="("?t=2:VS.test(l)?g():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+l:t=3:d+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}function MS(n,e,t){const r=kS(OS(n.path),t),s=bt(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function LS(n,e){const t=[],r=new Map;e=dy({strict:!1,end:!0,sensitive:!1},e);function s(f){return r.get(f)}function i(f,g,y){const E=!y,A=uy(f);A.aliasOf=y&&y.record;const R=dy(e,f),B=[A];if("alias"in f){const z=typeof f.alias=="string"?[f.alias]:f.alias;for(const de of z)B.push(uy(bt({},A,{components:y?y.record.components:A.components,path:de,aliasOf:y?y.record:A})))}let q,F;for(const z of B){const{path:de}=z;if(g&&de[0]!=="/"){const me=g.record.path,T=me[me.length-1]==="/"?"":"/";z.path=g.record.path+(de&&T+de)}if(q=MS(z,g,R),y?y.alias.push(q):(F=F||q,F!==q&&F.alias.push(q),E&&f.name&&!cy(q)&&o(f.name)),Bb(q)&&l(q),A.children){const me=A.children;for(let T=0;T<me.length;T++)i(me[T],q,y&&y.children[T])}y=y||q}return F?()=>{o(F)}:yu}function o(f){if($b(f)){const g=r.get(f);g&&(r.delete(f),t.splice(t.indexOf(g),1),g.children.forEach(o),g.alias.forEach(o))}else{const g=t.indexOf(f);g>-1&&(t.splice(g,1),f.record.name&&r.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return t}function l(f){const g=US(f,t);t.splice(g,0,f),f.record.name&&!cy(f)&&r.set(f.record.name,f)}function c(f,g){let y,E={},A,R;if("name"in f&&f.name){if(y=r.get(f.name),!y)throw Ga(1,{location:f});R=y.record.name,E=bt(ly(g.params,y.keys.filter(F=>!F.optional).concat(y.parent?y.parent.keys.filter(F=>F.optional):[]).map(F=>F.name)),f.params&&ly(f.params,y.keys.map(F=>F.name))),A=y.stringify(E)}else if(f.path!=null)A=f.path,y=t.find(F=>F.re.test(A)),y&&(E=y.parse(A),R=y.record.name);else{if(y=g.name?r.get(g.name):t.find(F=>F.re.test(g.path)),!y)throw Ga(1,{location:f,currentLocation:g});R=y.record.name,E=bt({},g.params,f.params),A=y.stringify(E)}const B=[];let q=y;for(;q;)B.unshift(q.record),q=q.parent;return{name:R,path:A,params:E,matched:B,meta:$S(B)}}n.forEach(f=>i(f));function d(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:o,clearRoutes:d,getRoutes:a,getRecordMatcher:s}}function ly(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function uy(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:FS(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function FS(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function cy(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function $S(n){return n.reduce((e,t)=>bt(e,t.meta),{})}function dy(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function US(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;jb(n,e[i])<0?r=i:t=i+1}const s=jS(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function jS(n){let e=n;for(;e=e.parent;)if(Bb(e)&&jb(n,e)===0)return e}function Bb({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function BS(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(Nb," "),o=i.indexOf("="),a=Du(o<0?i:i.slice(0,o)),l=o<0?null:Du(i.slice(o+1));if(a in e){let c=e[a];jr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function hy(n){let e="";for(let t in n){const r=n[t];if(t=lS(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(jr(r)?r.map(i=>i&&dp(i)):[r&&dp(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function qS(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=jr(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const zS=Symbol(""),fy=Symbol(""),vh=Symbol(""),vm=Symbol(""),fp=Symbol("");function Hl(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function fi(n,e,t,r,s,i=o=>o()){const o=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((a,l)=>{const c=g=>{g===!1?l(Ga(4,{from:t,to:e})):g instanceof Error?l(g):PS(g)?l(Ga(2,{from:e,to:g})):(o&&r.enterCallbacks[s]===o&&typeof g=="function"&&o.push(g),a())},d=i(()=>n.call(r&&r.instances[s],e,t,c));let f=Promise.resolve(d);n.length<3&&(f=f.then(c)),f.catch(g=>l(g))})}function Cf(n,e,t,r,s=i=>i()){const i=[];for(const o of n)for(const a in o.components){let l=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(kb(l)){const d=(l.__vccOpts||l)[e];d&&i.push(fi(d,t,r,o,a,s))}else{let c=l();i.push(()=>c.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=Y1(d)?d.default:d;o.mods[a]=d,o.components[a]=f;const y=(f.__vccOpts||f)[e];return y&&fi(y,t,r,o,a,s)()}))}}return i}function py(n){const e=Ur(vh),t=Ur(vm),r=Ue(()=>{const l=is(n.to);return e.resolve(l)}),s=Ue(()=>{const{matched:l}=r.value,{length:c}=l,d=l[c-1],f=t.matched;if(!d||!f.length)return-1;const g=f.findIndex(Ka.bind(null,d));if(g>-1)return g;const y=my(l[c-2]);return c>1&&my(d)===y&&f[f.length-1].path!==y?f.findIndex(Ka.bind(null,l[c-2])):g}),i=Ue(()=>s.value>-1&&QS(t.params,r.value.params)),o=Ue(()=>s.value>-1&&s.value===t.matched.length-1&&Lb(t.params,r.value.params));function a(l={}){if(WS(l)){const c=e[is(n.replace)?"replace":"push"](is(n.to)).catch(yu);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:Ue(()=>r.value.href),isActive:i,isExactActive:o,navigate:a}}function KS(n){return n.length===1?n[0]:n}const GS=nb({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:py,setup(n,{slots:e}){const t=ch(py(n)),{options:r}=Ur(vh),s=Ue(()=>({[gy(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[gy(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&KS(e.default(t));return n.custom?i:Sb("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),HS=GS;function WS(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function QS(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!jr(s)||s.length!==r.length||r.some((i,o)=>i!==s[o]))return!1}return!0}function my(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const gy=(n,e,t)=>n??e??t,JS=nb({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Ur(fp),s=Ue(()=>n.route||r.value),i=Ur(fy,0),o=Ue(()=>{let c=is(i);const{matched:d}=s.value;let f;for(;(f=d[c])&&!f.components;)c++;return c}),a=Ue(()=>s.value.matched[o.value]);od(fy,Ue(()=>o.value+1)),od(zS,a),od(fp,s);const l=P();return Pt(()=>[l.value,a.value,n.name],([c,d,f],[g,y,E])=>{d&&(d.instances[f]=c,y&&y!==d&&c&&c===g&&(d.leaveGuards.size||(d.leaveGuards=y.leaveGuards),d.updateGuards.size||(d.updateGuards=y.updateGuards))),c&&d&&(!y||!Ka(d,y)||!g)&&(d.enterCallbacks[f]||[]).forEach(A=>A(c))},{flush:"post"}),()=>{const c=s.value,d=n.name,f=a.value,g=f&&f.components[d];if(!g)return vy(t.default,{Component:g,route:c});const y=f.props[d],E=y?y===!0?c.params:typeof y=="function"?y(c):y:null,R=Sb(g,bt({},E,e,{onVnodeUnmounted:B=>{B.component.isUnmounted&&(f.instances[d]=null)},ref:l}));return vy(t.default,{Component:R,route:c})||R}}});function vy(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const YS=JS;function XS(n){const e=LS(n.routes,n),t=n.parseQuery||BS,r=n.stringifyQuery||hy,s=n.history,i=Hl(),o=Hl(),a=Hl(),l=aA(ai);let c=ai;Aa&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=Pf.bind(null,D=>""+D),f=Pf.bind(null,cS),g=Pf.bind(null,Du);function y(D,$){let te,oe;return $b(D)?(te=e.getRecordMatcher(D),oe=$):oe=D,e.addRoute(oe,te)}function E(D){const $=e.getRecordMatcher(D);$&&e.removeRoute($)}function A(){return e.getRoutes().map(D=>D.record)}function R(D){return!!e.getRecordMatcher(D)}function B(D,$){if($=bt({},$||l.value),typeof D=="string"){const S=Rf(t,D,$.path),M=e.resolve({path:S.path},$),le=s.createHref(S.fullPath);return bt(S,M,{params:g(M.params),hash:Du(S.hash),redirectedFrom:void 0,href:le})}let te;if(D.path!=null)te=bt({},D,{path:Rf(t,D.path,$.path).path});else{const S=bt({},D.params);for(const M in S)S[M]==null&&delete S[M];te=bt({},D,{params:f(S)}),$.params=f($.params)}const oe=e.resolve(te,$),Ve=D.hash||"";oe.params=d(g(oe.params));const qe=fS(r,bt({},D,{hash:aS(Ve),path:oe.path})),I=s.createHref(qe);return bt({fullPath:qe,hash:Ve,query:r===hy?qS(D.query):D.query||{}},oe,{redirectedFrom:void 0,href:I})}function q(D){return typeof D=="string"?Rf(t,D,l.value.path):bt({},D)}function F(D,$){if(c!==D)return Ga(8,{from:$,to:D})}function z(D){return T(D)}function de(D){return z(bt(q(D),{replace:!0}))}function me(D){const $=D.matched[D.matched.length-1];if($&&$.redirect){const{redirect:te}=$;let oe=typeof te=="function"?te(D):te;return typeof oe=="string"&&(oe=oe.includes("?")||oe.includes("#")?oe=q(oe):{path:oe},oe.params={}),bt({query:D.query,hash:D.hash,params:oe.path!=null?{}:D.params},oe)}}function T(D,$){const te=c=B(D),oe=l.value,Ve=D.state,qe=D.force,I=D.replace===!0,S=me(te);if(S)return T(bt(q(S),{state:typeof S=="object"?bt({},Ve,S.state):Ve,force:qe,replace:I}),$||te);const M=te;M.redirectedFrom=$;let le;return!qe&&pS(r,oe,te)&&(le=Ga(16,{to:M,from:oe}),Z(oe,oe,!0,!1)),(le?Promise.resolve(le):N(M,oe)).catch(ne=>Es(ne)?Es(ne,2)?ne:Se(ne):W(ne,M,oe)).then(ne=>{if(ne){if(Es(ne,2))return T(bt({replace:I},q(ne.to),{state:typeof ne.to=="object"?bt({},Ve,ne.to.state):Ve,force:qe}),$||M)}else ne=j(M,oe,!0,I,Ve);return L(M,oe,ne),ne})}function w(D,$){const te=F(D,$);return te?Promise.reject(te):Promise.resolve()}function x(D){const $=We.values().next().value;return $&&typeof $.runWithContext=="function"?$.runWithContext(D):D()}function N(D,$){let te;const[oe,Ve,qe]=ZS(D,$);te=Cf(oe.reverse(),"beforeRouteLeave",D,$);for(const S of oe)S.leaveGuards.forEach(M=>{te.push(fi(M,D,$))});const I=w.bind(null,D,$);return te.push(I),vt(te).then(()=>{te=[];for(const S of i.list())te.push(fi(S,D,$));return te.push(I),vt(te)}).then(()=>{te=Cf(Ve,"beforeRouteUpdate",D,$);for(const S of Ve)S.updateGuards.forEach(M=>{te.push(fi(M,D,$))});return te.push(I),vt(te)}).then(()=>{te=[];for(const S of qe)if(S.beforeEnter)if(jr(S.beforeEnter))for(const M of S.beforeEnter)te.push(fi(M,D,$));else te.push(fi(S.beforeEnter,D,$));return te.push(I),vt(te)}).then(()=>(D.matched.forEach(S=>S.enterCallbacks={}),te=Cf(qe,"beforeRouteEnter",D,$,x),te.push(I),vt(te))).then(()=>{te=[];for(const S of o.list())te.push(fi(S,D,$));return te.push(I),vt(te)}).catch(S=>Es(S,8)?S:Promise.reject(S))}function L(D,$,te){a.list().forEach(oe=>x(()=>oe(D,$,te)))}function j(D,$,te,oe,Ve){const qe=F(D,$);if(qe)return qe;const I=$===ai,S=Aa?history.state:{};te&&(oe||I?s.replace(D.fullPath,bt({scroll:I&&S&&S.scroll},Ve)):s.push(D.fullPath,Ve)),l.value=D,Z(D,$,te,I),Se()}let C;function ht(){C||(C=s.listen((D,$,te)=>{if(!ft.listening)return;const oe=B(D),Ve=me(oe);if(Ve){T(bt(Ve,{replace:!0,force:!0}),oe).catch(yu);return}c=oe;const qe=l.value;Aa&&IS(ry(qe.fullPath,te.delta),gh()),N(oe,qe).catch(I=>Es(I,12)?I:Es(I,2)?(T(bt(q(I.to),{force:!0}),oe).then(S=>{Es(S,20)&&!te.delta&&te.type===Nu.pop&&s.go(-1,!1)}).catch(yu),Promise.reject()):(te.delta&&s.go(-te.delta,!1),W(I,oe,qe))).then(I=>{I=I||j(oe,qe,!1),I&&(te.delta&&!Es(I,8)?s.go(-te.delta,!1):te.type===Nu.pop&&Es(I,20)&&s.go(-1,!1)),L(oe,qe,I)}).catch(yu)}))}let et=Hl(),ee=Hl(),U;function W(D,$,te){Se(D);const oe=ee.list();return oe.length?oe.forEach(Ve=>Ve(D,$,te)):console.error(D),Promise.reject(D)}function re(){return U&&l.value!==ai?Promise.resolve():new Promise((D,$)=>{et.add([D,$])})}function Se(D){return U||(U=!D,ht(),et.list().forEach(([$,te])=>D?te(D):$()),et.reset()),D}function Z(D,$,te,oe){const{scrollBehavior:Ve}=n;if(!Aa||!Ve)return Promise.resolve();const qe=!te&&ES(ry(D.fullPath,0))||(oe||!te)&&history.state&&history.state.scroll||null;return Ut().then(()=>Ve(D,$,qe)).then(I=>I&&wS(I)).catch(I=>W(I,D,$))}const Q=D=>s.go(D);let Ee;const We=new Set,ft={currentRoute:l,listening:!0,addRoute:y,removeRoute:E,clearRoutes:e.clearRoutes,hasRoute:R,getRoutes:A,resolve:B,options:n,push:z,replace:de,go:Q,back:()=>Q(-1),forward:()=>Q(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:ee.add,isReady:re,install(D){const $=this;D.component("RouterLink",HS),D.component("RouterView",YS),D.config.globalProperties.$router=$,Object.defineProperty(D.config.globalProperties,"$route",{enumerable:!0,get:()=>is(l)}),Aa&&!Ee&&l.value===ai&&(Ee=!0,z(s.location).catch(Ve=>{}));const te={};for(const Ve in ai)Object.defineProperty(te,Ve,{get:()=>l.value[Ve],enumerable:!0});D.provide(vh,$),D.provide(vm,z_(te)),D.provide(fp,l);const oe=D.unmount;We.add(D),D.unmount=function(){We.delete(D),We.size<1&&(c=ai,C&&C(),C=null,l.value=ai,Ee=!1,U=!1),oe()}}};function vt(D){return D.reduce(($,te)=>$.then(()=>x(te)),Promise.resolve())}return ft}function ZS(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(n.matched.find(c=>Ka(c,a))?r.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Ka(c,l))||s.push(l))}return[t,r,s]}function dl(){return Ur(vh)}function hl(n){return Ur(vm)}const eP="modulepreload",tP=function(n){return"/"+n},yy={},Xt=function(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=tP(i),i in yy)return;yy[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const f=s[d];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":eP,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})};function nP(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=n;let a,l;const c=async(f=!0)=>{await l};async function d(){if("serviceWorker"in navigator){const{Workbox:f}=await Xt(()=>import("./workbox-window.prod.es5-5ffdab76.js"),[]);a=new f("/service-worker.js",{scope:"/",type:"classic"}),a.addEventListener("activated",g=>{(g.isUpdate||g.isExternal)&&window.location.reload()}),a.addEventListener("installed",g=>{g.isUpdate||r==null||r()}),a.register({immediate:e}).then(g=>{i?i("/service-worker.js",g):s==null||s(g)}).catch(g=>{o==null||o(g)})}}return l=d(),c}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},rP=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},zb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=i>>2,f=(i&3)<<4|a>>4;let g=(a&15)<<2|c>>6,y=c&63;l||(y=64,o||(g=64)),r.push(t[d],t[f],t[g],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(qb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):rP(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const f=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||c==null||f==null)throw new sP;const g=i<<2|a>>4;if(r.push(g),c!==64){const y=a<<4&240|c>>2;if(r.push(y),f!==64){const E=c<<6&192|f;r.push(E)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class sP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const iP=function(n){const e=qb(n);return zb.encodeByteArray(e,!0)},Od=function(n){return iP(n).replace(/\./g,"")},Kb=function(n){try{return zb.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aP=()=>oP().__FIREBASE_DEFAULTS__,lP=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},uP=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Kb(n[1]);return e&&JSON.parse(e)},yh=()=>{try{return aP()||lP()||uP()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Gb=n=>{var e,t;return(t=(e=yh())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},cP=n=>{const e=Gb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Hb=()=>{var n;return(n=yh())===null||n===void 0?void 0:n.config},Wb=n=>{var e;return(e=yh())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[Od(JSON.stringify(t)),Od(JSON.stringify(o)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _n(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function fP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_n())}function pP(){var n;const e=(n=yh())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function mP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function gP(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function vP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function yP(){const n=_n();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Qb(){return!pP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ym(){try{return typeof indexedDB=="object"}catch{return!1}}function Jb(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}function _P(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP="FirebaseError";class fs extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=bP,Object.setPrototypeOf(this,fs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xo.prototype.create)}}class Xo{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?wP(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new fs(s,a,r)}}function wP(n,e){return n.replace(IP,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const IP=/\{\$([^}]+)}/g;function EP(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ki(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],o=e[s];if(_y(i)&&_y(o)){if(!ki(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function _y(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fl(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function nu(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function ru(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function xP(n,e){const t=new TP(n,e);return t.subscribe.bind(t)}class TP{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");AP(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=kf),s.error===void 0&&(s.error=kf),s.complete===void 0&&(s.complete=kf);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function AP(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function kf(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(n){return n&&n._delegate?n._delegate:n}class Br{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new dP;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(RP(e))try{this.getOrInitializeService({instanceIdentifier:Eo})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Eo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Eo){return this.instances.has(e)}getOptions(e=Eo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,t){var r;const s=this.normalizeInstanceIdentifier(t),i=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;i.add(e),this.onInitCallbacks.set(s,i);const o=this.instances.get(s);return o&&e(o,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:PP(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Eo){return this.component?this.component.multipleInstances?e:Eo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function PP(n){return n===Eo?void 0:n}function RP(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new SP(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var it;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(it||(it={}));const kP={debug:it.DEBUG,verbose:it.VERBOSE,info:it.INFO,warn:it.WARN,error:it.ERROR,silent:it.SILENT},DP=it.INFO,NP={[it.DEBUG]:"log",[it.VERBOSE]:"log",[it.INFO]:"info",[it.WARN]:"warn",[it.ERROR]:"error"},VP=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=NP[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _m{constructor(e){this.name=e,this._logLevel=DP,this._logHandler=VP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in it))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?kP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,it.DEBUG,...e),this._logHandler(this,it.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,it.VERBOSE,...e),this._logHandler(this,it.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,it.INFO,...e),this._logHandler(this,it.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,it.WARN,...e),this._logHandler(this,it.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,it.ERROR,...e),this._logHandler(this,it.ERROR,...e)}}const OP=(n,e)=>e.some(t=>n instanceof t);let by,wy;function MP(){return by||(by=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function LP(){return wy||(wy=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Yb=new WeakMap,pp=new WeakMap,Xb=new WeakMap,Df=new WeakMap,bm=new WeakMap;function FP(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Ns(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Yb.set(t,n)}).catch(()=>{}),bm.set(e,n),e}function $P(n){if(pp.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});pp.set(n,e)}let mp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return pp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Xb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ns(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function UP(n){mp=n(mp)}function jP(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Nf(this),e,...t);return Xb.set(r,e.sort?e.sort():[e]),Ns(r)}:LP().includes(n)?function(...e){return n.apply(Nf(this),e),Ns(Yb.get(this))}:function(...e){return Ns(n.apply(Nf(this),e))}}function BP(n){return typeof n=="function"?jP(n):(n instanceof IDBTransaction&&$P(n),OP(n,MP())?new Proxy(n,mp):n)}function Ns(n){if(n instanceof IDBRequest)return FP(n);if(Df.has(n))return Df.get(n);const e=BP(n);return e!==n&&(Df.set(n,e),bm.set(e,n)),e}const Nf=n=>bm.get(n);function _h(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Ns(o);return r&&o.addEventListener("upgradeneeded",l=>{r(Ns(o.result),l.oldVersion,l.newVersion,Ns(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function Vf(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Ns(t).then(()=>{})}const qP=["get","getKey","getAll","getAllKeys","count"],zP=["put","add","delete","clear"],Of=new Map;function Iy(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Of.get(e))return Of.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=zP.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||qP.includes(t)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),s&&l.done]))[0]};return Of.set(e,i),i}UP(n=>({...n,get:(e,t,r)=>Iy(e,t)||n.get(e,t,r),has:(e,t)=>!!Iy(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(GP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function GP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const gp="@firebase/app",Ey="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ls=new _m("@firebase/app"),HP="@firebase/app-compat",WP="@firebase/analytics-compat",QP="@firebase/analytics",JP="@firebase/app-check-compat",YP="@firebase/app-check",XP="@firebase/auth",ZP="@firebase/auth-compat",eR="@firebase/database",tR="@firebase/data-connect",nR="@firebase/database-compat",rR="@firebase/functions",sR="@firebase/functions-compat",iR="@firebase/installations",oR="@firebase/installations-compat",aR="@firebase/messaging",lR="@firebase/messaging-compat",uR="@firebase/performance",cR="@firebase/performance-compat",dR="@firebase/remote-config",hR="@firebase/remote-config-compat",fR="@firebase/storage",pR="@firebase/storage-compat",mR="@firebase/firestore",gR="@firebase/vertexai-preview",vR="@firebase/firestore-compat",yR="firebase",_R="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Md="[DEFAULT]",bR={[gp]:"fire-core",[HP]:"fire-core-compat",[QP]:"fire-analytics",[WP]:"fire-analytics-compat",[YP]:"fire-app-check",[JP]:"fire-app-check-compat",[XP]:"fire-auth",[ZP]:"fire-auth-compat",[eR]:"fire-rtdb",[tR]:"fire-data-connect",[nR]:"fire-rtdb-compat",[rR]:"fire-fn",[sR]:"fire-fn-compat",[iR]:"fire-iid",[oR]:"fire-iid-compat",[aR]:"fire-fcm",[lR]:"fire-fcm-compat",[uR]:"fire-perf",[cR]:"fire-perf-compat",[dR]:"fire-rc",[hR]:"fire-rc-compat",[fR]:"fire-gcs",[pR]:"fire-gcs-compat",[mR]:"fire-fst",[vR]:"fire-fst-compat",[gR]:"fire-vertex","fire-js":"fire-js",[yR]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld=new Map,wR=new Map,vp=new Map;function xy(n,e){try{n.container.addComponent(e)}catch(t){Ls.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ds(n){const e=n.name;if(vp.has(e))return Ls.debug(`There were multiple attempts to register component ${e}.`),!1;vp.set(e,n);for(const t of Ld.values())xy(t,n);for(const t of wR.values())xy(t,n);return!0}function ji(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function IR(n,e,t=Md){ji(n,e).clearInstance(t)}function ln(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ER={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ti=new Xo("app","Firebase",ER);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Br("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ti.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pl=_R;function Zb(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Md,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Ti.create("bad-app-name",{appName:String(s)});if(t||(t=Hb()),!t)throw Ti.create("no-options");const i=Ld.get(s);if(i){if(ki(t,i.options)&&ki(r,i.config))return i;throw Ti.create("duplicate-app",{appName:s})}const o=new CP(s);for(const l of vp.values())o.addComponent(l);const a=new xR(t,r,o);return Ld.set(s,a),a}function wm(n=Md){const e=Ld.get(n);if(!e&&n===Md&&Hb())return Zb();if(!e)throw Ti.create("no-app",{appName:n});return e}function Sr(n,e,t){var r;let s=(r=bR[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ls.warn(a.join(" "));return}ds(new Br(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TR="firebase-heartbeat-database",AR=1,Vu="firebase-heartbeat-store";let Mf=null;function ew(){return Mf||(Mf=_h(TR,AR,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Vu)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ti.create("idb-open",{originalErrorMessage:n.message})})),Mf}async function SR(n){try{const t=(await ew()).transaction(Vu),r=await t.objectStore(Vu).get(tw(n));return await t.done,r}catch(e){if(e instanceof fs)Ls.warn(e.message);else{const t=Ti.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ls.warn(t.message)}}}async function Ty(n,e){try{const r=(await ew()).transaction(Vu,"readwrite");await r.objectStore(Vu).put(e,tw(n)),await r.done}catch(t){if(t instanceof fs)Ls.warn(t.message);else{const r=Ti.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ls.warn(r.message)}}}function tw(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PR=1024,RR=30*24*60*60*1e3;class CR{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new DR(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ay();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=RR}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Ls.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ay(),{heartbeatsToSend:r,unsentEntries:s}=kR(this._heartbeatsCache.heartbeats),i=Od(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Ls.warn(t),""}}}function Ay(){return new Date().toISOString().substring(0,10)}function kR(n,e=PR){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),Sy(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Sy(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class DR{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ym()?Jb().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await SR(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ty(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return Ty(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Sy(n){return Od(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NR(n){ds(new Br("platform-logger",e=>new KP(e),"PRIVATE")),ds(new Br("heartbeat",e=>new CR(e),"PRIVATE")),Sr(gp,Ey,n),Sr(gp,Ey,"esm2017"),Sr("fire-js","")}NR("");var VR="firebase",OR="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Sr(VR,OR,"app");var Py=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mo,nw;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,w){function x(){}x.prototype=w.prototype,T.D=w.prototype,T.prototype=new x,T.prototype.constructor=T,T.C=function(N,L,j){for(var C=Array(arguments.length-2),ht=2;ht<arguments.length;ht++)C[ht-2]=arguments[ht];return w.prototype[L].apply(N,C)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,w,x){x||(x=0);var N=Array(16);if(typeof w=="string")for(var L=0;16>L;++L)N[L]=w.charCodeAt(x++)|w.charCodeAt(x++)<<8|w.charCodeAt(x++)<<16|w.charCodeAt(x++)<<24;else for(L=0;16>L;++L)N[L]=w[x++]|w[x++]<<8|w[x++]<<16|w[x++]<<24;w=T.g[0],x=T.g[1],L=T.g[2];var j=T.g[3],C=w+(j^x&(L^j))+N[0]+3614090360&4294967295;w=x+(C<<7&4294967295|C>>>25),C=j+(L^w&(x^L))+N[1]+3905402710&4294967295,j=w+(C<<12&4294967295|C>>>20),C=L+(x^j&(w^x))+N[2]+606105819&4294967295,L=j+(C<<17&4294967295|C>>>15),C=x+(w^L&(j^w))+N[3]+3250441966&4294967295,x=L+(C<<22&4294967295|C>>>10),C=w+(j^x&(L^j))+N[4]+4118548399&4294967295,w=x+(C<<7&4294967295|C>>>25),C=j+(L^w&(x^L))+N[5]+1200080426&4294967295,j=w+(C<<12&4294967295|C>>>20),C=L+(x^j&(w^x))+N[6]+2821735955&4294967295,L=j+(C<<17&4294967295|C>>>15),C=x+(w^L&(j^w))+N[7]+4249261313&4294967295,x=L+(C<<22&4294967295|C>>>10),C=w+(j^x&(L^j))+N[8]+1770035416&4294967295,w=x+(C<<7&4294967295|C>>>25),C=j+(L^w&(x^L))+N[9]+2336552879&4294967295,j=w+(C<<12&4294967295|C>>>20),C=L+(x^j&(w^x))+N[10]+4294925233&4294967295,L=j+(C<<17&4294967295|C>>>15),C=x+(w^L&(j^w))+N[11]+2304563134&4294967295,x=L+(C<<22&4294967295|C>>>10),C=w+(j^x&(L^j))+N[12]+1804603682&4294967295,w=x+(C<<7&4294967295|C>>>25),C=j+(L^w&(x^L))+N[13]+4254626195&4294967295,j=w+(C<<12&4294967295|C>>>20),C=L+(x^j&(w^x))+N[14]+2792965006&4294967295,L=j+(C<<17&4294967295|C>>>15),C=x+(w^L&(j^w))+N[15]+1236535329&4294967295,x=L+(C<<22&4294967295|C>>>10),C=w+(L^j&(x^L))+N[1]+4129170786&4294967295,w=x+(C<<5&4294967295|C>>>27),C=j+(x^L&(w^x))+N[6]+3225465664&4294967295,j=w+(C<<9&4294967295|C>>>23),C=L+(w^x&(j^w))+N[11]+643717713&4294967295,L=j+(C<<14&4294967295|C>>>18),C=x+(j^w&(L^j))+N[0]+3921069994&4294967295,x=L+(C<<20&4294967295|C>>>12),C=w+(L^j&(x^L))+N[5]+3593408605&4294967295,w=x+(C<<5&4294967295|C>>>27),C=j+(x^L&(w^x))+N[10]+38016083&4294967295,j=w+(C<<9&4294967295|C>>>23),C=L+(w^x&(j^w))+N[15]+3634488961&4294967295,L=j+(C<<14&4294967295|C>>>18),C=x+(j^w&(L^j))+N[4]+3889429448&4294967295,x=L+(C<<20&4294967295|C>>>12),C=w+(L^j&(x^L))+N[9]+568446438&4294967295,w=x+(C<<5&4294967295|C>>>27),C=j+(x^L&(w^x))+N[14]+3275163606&4294967295,j=w+(C<<9&4294967295|C>>>23),C=L+(w^x&(j^w))+N[3]+4107603335&4294967295,L=j+(C<<14&4294967295|C>>>18),C=x+(j^w&(L^j))+N[8]+1163531501&4294967295,x=L+(C<<20&4294967295|C>>>12),C=w+(L^j&(x^L))+N[13]+2850285829&4294967295,w=x+(C<<5&4294967295|C>>>27),C=j+(x^L&(w^x))+N[2]+4243563512&4294967295,j=w+(C<<9&4294967295|C>>>23),C=L+(w^x&(j^w))+N[7]+1735328473&4294967295,L=j+(C<<14&4294967295|C>>>18),C=x+(j^w&(L^j))+N[12]+2368359562&4294967295,x=L+(C<<20&4294967295|C>>>12),C=w+(x^L^j)+N[5]+4294588738&4294967295,w=x+(C<<4&4294967295|C>>>28),C=j+(w^x^L)+N[8]+2272392833&4294967295,j=w+(C<<11&4294967295|C>>>21),C=L+(j^w^x)+N[11]+1839030562&4294967295,L=j+(C<<16&4294967295|C>>>16),C=x+(L^j^w)+N[14]+4259657740&4294967295,x=L+(C<<23&4294967295|C>>>9),C=w+(x^L^j)+N[1]+2763975236&4294967295,w=x+(C<<4&4294967295|C>>>28),C=j+(w^x^L)+N[4]+1272893353&4294967295,j=w+(C<<11&4294967295|C>>>21),C=L+(j^w^x)+N[7]+4139469664&4294967295,L=j+(C<<16&4294967295|C>>>16),C=x+(L^j^w)+N[10]+3200236656&4294967295,x=L+(C<<23&4294967295|C>>>9),C=w+(x^L^j)+N[13]+681279174&4294967295,w=x+(C<<4&4294967295|C>>>28),C=j+(w^x^L)+N[0]+3936430074&4294967295,j=w+(C<<11&4294967295|C>>>21),C=L+(j^w^x)+N[3]+3572445317&4294967295,L=j+(C<<16&4294967295|C>>>16),C=x+(L^j^w)+N[6]+76029189&4294967295,x=L+(C<<23&4294967295|C>>>9),C=w+(x^L^j)+N[9]+3654602809&4294967295,w=x+(C<<4&4294967295|C>>>28),C=j+(w^x^L)+N[12]+3873151461&4294967295,j=w+(C<<11&4294967295|C>>>21),C=L+(j^w^x)+N[15]+530742520&4294967295,L=j+(C<<16&4294967295|C>>>16),C=x+(L^j^w)+N[2]+3299628645&4294967295,x=L+(C<<23&4294967295|C>>>9),C=w+(L^(x|~j))+N[0]+4096336452&4294967295,w=x+(C<<6&4294967295|C>>>26),C=j+(x^(w|~L))+N[7]+1126891415&4294967295,j=w+(C<<10&4294967295|C>>>22),C=L+(w^(j|~x))+N[14]+2878612391&4294967295,L=j+(C<<15&4294967295|C>>>17),C=x+(j^(L|~w))+N[5]+4237533241&4294967295,x=L+(C<<21&4294967295|C>>>11),C=w+(L^(x|~j))+N[12]+1700485571&4294967295,w=x+(C<<6&4294967295|C>>>26),C=j+(x^(w|~L))+N[3]+2399980690&4294967295,j=w+(C<<10&4294967295|C>>>22),C=L+(w^(j|~x))+N[10]+4293915773&4294967295,L=j+(C<<15&4294967295|C>>>17),C=x+(j^(L|~w))+N[1]+2240044497&4294967295,x=L+(C<<21&4294967295|C>>>11),C=w+(L^(x|~j))+N[8]+1873313359&4294967295,w=x+(C<<6&4294967295|C>>>26),C=j+(x^(w|~L))+N[15]+4264355552&4294967295,j=w+(C<<10&4294967295|C>>>22),C=L+(w^(j|~x))+N[6]+2734768916&4294967295,L=j+(C<<15&4294967295|C>>>17),C=x+(j^(L|~w))+N[13]+1309151649&4294967295,x=L+(C<<21&4294967295|C>>>11),C=w+(L^(x|~j))+N[4]+4149444226&4294967295,w=x+(C<<6&4294967295|C>>>26),C=j+(x^(w|~L))+N[11]+3174756917&4294967295,j=w+(C<<10&4294967295|C>>>22),C=L+(w^(j|~x))+N[2]+718787259&4294967295,L=j+(C<<15&4294967295|C>>>17),C=x+(j^(L|~w))+N[9]+3951481745&4294967295,T.g[0]=T.g[0]+w&4294967295,T.g[1]=T.g[1]+(L+(C<<21&4294967295|C>>>11))&4294967295,T.g[2]=T.g[2]+L&4294967295,T.g[3]=T.g[3]+j&4294967295}r.prototype.u=function(T,w){w===void 0&&(w=T.length);for(var x=w-this.blockSize,N=this.B,L=this.h,j=0;j<w;){if(L==0)for(;j<=x;)s(this,T,j),j+=this.blockSize;if(typeof T=="string"){for(;j<w;)if(N[L++]=T.charCodeAt(j++),L==this.blockSize){s(this,N),L=0;break}}else for(;j<w;)if(N[L++]=T[j++],L==this.blockSize){s(this,N),L=0;break}}this.h=L,this.o+=w},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var w=1;w<T.length-8;++w)T[w]=0;var x=8*this.o;for(w=T.length-8;w<T.length;++w)T[w]=x&255,x/=256;for(this.u(T),T=Array(16),w=x=0;4>w;++w)for(var N=0;32>N;N+=8)T[x++]=this.g[w]>>>N&255;return T};function i(T,w){var x=a;return Object.prototype.hasOwnProperty.call(x,T)?x[T]:x[T]=w(T)}function o(T,w){this.h=w;for(var x=[],N=!0,L=T.length-1;0<=L;L--){var j=T[L]|0;N&&j==w||(x[L]=j,N=!1)}this.g=x}var a={};function l(T){return-128<=T&&128>T?i(T,function(w){return new o([w|0],0>w?-1:0)}):new o([T|0],0>T?-1:0)}function c(T){if(isNaN(T)||!isFinite(T))return f;if(0>T)return R(c(-T));for(var w=[],x=1,N=0;T>=x;N++)w[N]=T/x|0,x*=4294967296;return new o(w,0)}function d(T,w){if(T.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(T.charAt(0)=="-")return R(d(T.substring(1),w));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var x=c(Math.pow(w,8)),N=f,L=0;L<T.length;L+=8){var j=Math.min(8,T.length-L),C=parseInt(T.substring(L,L+j),w);8>j?(j=c(Math.pow(w,j)),N=N.j(j).add(c(C))):(N=N.j(x),N=N.add(c(C)))}return N}var f=l(0),g=l(1),y=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-R(this).m();for(var T=0,w=1,x=0;x<this.g.length;x++){var N=this.i(x);T+=(0<=N?N:4294967296+N)*w,w*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(E(this))return"0";if(A(this))return"-"+R(this).toString(T);for(var w=c(Math.pow(T,6)),x=this,N="";;){var L=z(x,w).g;x=B(x,L.j(w));var j=((0<x.g.length?x.g[0]:x.h)>>>0).toString(T);if(x=L,E(x))return j+N;for(;6>j.length;)j="0"+j;N=j+N}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function E(T){if(T.h!=0)return!1;for(var w=0;w<T.g.length;w++)if(T.g[w]!=0)return!1;return!0}function A(T){return T.h==-1}n.l=function(T){return T=B(this,T),A(T)?-1:E(T)?0:1};function R(T){for(var w=T.g.length,x=[],N=0;N<w;N++)x[N]=~T.g[N];return new o(x,~T.h).add(g)}n.abs=function(){return A(this)?R(this):this},n.add=function(T){for(var w=Math.max(this.g.length,T.g.length),x=[],N=0,L=0;L<=w;L++){var j=N+(this.i(L)&65535)+(T.i(L)&65535),C=(j>>>16)+(this.i(L)>>>16)+(T.i(L)>>>16);N=C>>>16,j&=65535,C&=65535,x[L]=C<<16|j}return new o(x,x[x.length-1]&-2147483648?-1:0)};function B(T,w){return T.add(R(w))}n.j=function(T){if(E(this)||E(T))return f;if(A(this))return A(T)?R(this).j(R(T)):R(R(this).j(T));if(A(T))return R(this.j(R(T)));if(0>this.l(y)&&0>T.l(y))return c(this.m()*T.m());for(var w=this.g.length+T.g.length,x=[],N=0;N<2*w;N++)x[N]=0;for(N=0;N<this.g.length;N++)for(var L=0;L<T.g.length;L++){var j=this.i(N)>>>16,C=this.i(N)&65535,ht=T.i(L)>>>16,et=T.i(L)&65535;x[2*N+2*L]+=C*et,q(x,2*N+2*L),x[2*N+2*L+1]+=j*et,q(x,2*N+2*L+1),x[2*N+2*L+1]+=C*ht,q(x,2*N+2*L+1),x[2*N+2*L+2]+=j*ht,q(x,2*N+2*L+2)}for(N=0;N<w;N++)x[N]=x[2*N+1]<<16|x[2*N];for(N=w;N<2*w;N++)x[N]=0;return new o(x,0)};function q(T,w){for(;(T[w]&65535)!=T[w];)T[w+1]+=T[w]>>>16,T[w]&=65535,w++}function F(T,w){this.g=T,this.h=w}function z(T,w){if(E(w))throw Error("division by zero");if(E(T))return new F(f,f);if(A(T))return w=z(R(T),w),new F(R(w.g),R(w.h));if(A(w))return w=z(T,R(w)),new F(R(w.g),w.h);if(30<T.g.length){if(A(T)||A(w))throw Error("slowDivide_ only works with positive integers.");for(var x=g,N=w;0>=N.l(T);)x=de(x),N=de(N);var L=me(x,1),j=me(N,1);for(N=me(N,2),x=me(x,2);!E(N);){var C=j.add(N);0>=C.l(T)&&(L=L.add(x),j=C),N=me(N,1),x=me(x,1)}return w=B(T,L.j(w)),new F(L,w)}for(L=f;0<=T.l(w);){for(x=Math.max(1,Math.floor(T.m()/w.m())),N=Math.ceil(Math.log(x)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),j=c(x),C=j.j(w);A(C)||0<C.l(T);)x-=N,j=c(x),C=j.j(w);E(j)&&(j=g),L=L.add(j),T=B(T,C)}return new F(L,T)}n.A=function(T){return z(this,T).h},n.and=function(T){for(var w=Math.max(this.g.length,T.g.length),x=[],N=0;N<w;N++)x[N]=this.i(N)&T.i(N);return new o(x,this.h&T.h)},n.or=function(T){for(var w=Math.max(this.g.length,T.g.length),x=[],N=0;N<w;N++)x[N]=this.i(N)|T.i(N);return new o(x,this.h|T.h)},n.xor=function(T){for(var w=Math.max(this.g.length,T.g.length),x=[],N=0;N<w;N++)x[N]=this.i(N)^T.i(N);return new o(x,this.h^T.h)};function de(T){for(var w=T.g.length+1,x=[],N=0;N<w;N++)x[N]=T.i(N)<<1|T.i(N-1)>>>31;return new o(x,T.h)}function me(T,w){var x=w>>5;w%=32;for(var N=T.g.length-x,L=[],j=0;j<N;j++)L[j]=0<w?T.i(j+x)>>>w|T.i(j+x+1)<<32-w:T.i(j+x);return new o(L,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,nw=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=d,Mo=o}).apply(typeof Py<"u"?Py:typeof self<"u"?self:typeof window<"u"?window:{});var Wc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var rw,su,sw,cd,yp,iw,ow,aw;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,p,v){return u==Array.prototype||u==Object.prototype||(u[p]=v.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Wc=="object"&&Wc];for(var p=0;p<u.length;++p){var v=u[p];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(u,p){if(p)e:{var v=r;u=u.split(".");for(var b=0;b<u.length-1;b++){var K=u[b];if(!(K in v))break e;v=v[K]}u=u[u.length-1],b=v[u],p=p(b),p!=b&&p!=null&&e(v,u,{configurable:!0,writable:!0,value:p})}}function i(u,p){u instanceof String&&(u+="");var v=0,b=!1,K={next:function(){if(!b&&v<u.length){var J=v++;return{value:p(J,u[J]),done:!1}}return b=!0,{done:!0,value:void 0}}};return K[Symbol.iterator]=function(){return K},K}s("Array.prototype.values",function(u){return u||function(){return i(this,function(p,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(u){var p=typeof u;return p=p!="object"?p:u?Array.isArray(u)?"array":p:"null",p=="array"||p=="object"&&typeof u.length=="number"}function c(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function d(u,p,v){return u.call.apply(u.bind,arguments)}function f(u,p,v){if(!u)throw Error();if(2<arguments.length){var b=Array.prototype.slice.call(arguments,2);return function(){var K=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(K,b),u.apply(p,K)}}return function(){return u.apply(p,arguments)}}function g(u,p,v){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function y(u,p){var v=Array.prototype.slice.call(arguments,1);return function(){var b=v.slice();return b.push.apply(b,arguments),u.apply(this,b)}}function E(u,p){function v(){}v.prototype=p.prototype,u.aa=p.prototype,u.prototype=new v,u.prototype.constructor=u,u.Qb=function(b,K,J){for(var Te=Array(arguments.length-2),Tt=2;Tt<arguments.length;Tt++)Te[Tt-2]=arguments[Tt];return p.prototype[K].apply(b,Te)}}function A(u){const p=u.length;if(0<p){const v=Array(p);for(let b=0;b<p;b++)v[b]=u[b];return v}return[]}function R(u,p){for(let v=1;v<arguments.length;v++){const b=arguments[v];if(l(b)){const K=u.length||0,J=b.length||0;u.length=K+J;for(let Te=0;Te<J;Te++)u[K+Te]=b[Te]}else u.push(b)}}class B{constructor(p,v){this.i=p,this.j=v,this.h=0,this.g=null}get(){let p;return 0<this.h?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function q(u){return/^[\s\xa0]*$/.test(u)}function F(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function z(u){return z[" "](u),u}z[" "]=function(){};var de=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function me(u,p,v){for(const b in u)p.call(v,u[b],b,u)}function T(u,p){for(const v in u)p.call(void 0,u[v],v,u)}function w(u){const p={};for(const v in u)p[v]=u[v];return p}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(u,p){let v,b;for(let K=1;K<arguments.length;K++){b=arguments[K];for(v in b)u[v]=b[v];for(let J=0;J<x.length;J++)v=x[J],Object.prototype.hasOwnProperty.call(b,v)&&(u[v]=b[v])}}function L(u){var p=1;u=u.split(":");const v=[];for(;0<p&&u.length;)v.push(u.shift()),p--;return u.length&&v.push(u.join(":")),v}function j(u){a.setTimeout(()=>{throw u},0)}function C(){var u=re;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class ht{constructor(){this.h=this.g=null}add(p,v){const b=et.get();b.set(p,v),this.h?this.h.next=b:this.g=b,this.h=b}}var et=new B(()=>new ee,u=>u.reset());class ee{constructor(){this.next=this.g=this.h=null}set(p,v){this.h=p,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let U,W=!1,re=new ht,Se=()=>{const u=a.Promise.resolve(void 0);U=()=>{u.then(Z)}};var Z=()=>{for(var u;u=C();){try{u.h.call(u.g)}catch(v){j(v)}var p=et;p.j(u),100>p.h&&(p.h++,u.next=p.g,p.g=u)}W=!1};function Q(){this.s=this.s,this.C=this.C}Q.prototype.s=!1,Q.prototype.ma=function(){this.s||(this.s=!0,this.N())},Q.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ee(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}Ee.prototype.h=function(){this.defaultPrevented=!0};var We=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const v=()=>{};a.addEventListener("test",v,p),a.removeEventListener("test",v,p)}catch{}return u}();function ft(u,p){if(Ee.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var v=this.type=u.type,b=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget){if(de){e:{try{z(p.nodeName);var K=!0;break e}catch{}K=!1}K||(p=null)}}else v=="mouseover"?p=u.fromElement:v=="mouseout"&&(p=u.toElement);this.relatedTarget=p,b?(this.clientX=b.clientX!==void 0?b.clientX:b.pageX,this.clientY=b.clientY!==void 0?b.clientY:b.pageY,this.screenX=b.screenX||0,this.screenY=b.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:vt[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&ft.aa.h.call(this)}}E(ft,Ee);var vt={2:"touch",3:"pen",4:"mouse"};ft.prototype.h=function(){ft.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var D="closure_listenable_"+(1e6*Math.random()|0),$=0;function te(u,p,v,b,K){this.listener=u,this.proxy=null,this.src=p,this.type=v,this.capture=!!b,this.ha=K,this.key=++$,this.da=this.fa=!1}function oe(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Ve(u){this.src=u,this.g={},this.h=0}Ve.prototype.add=function(u,p,v,b,K){var J=u.toString();u=this.g[J],u||(u=this.g[J]=[],this.h++);var Te=I(u,p,b,K);return-1<Te?(p=u[Te],v||(p.fa=!1)):(p=new te(p,this.src,J,!!b,K),p.fa=v,u.push(p)),p};function qe(u,p){var v=p.type;if(v in u.g){var b=u.g[v],K=Array.prototype.indexOf.call(b,p,void 0),J;(J=0<=K)&&Array.prototype.splice.call(b,K,1),J&&(oe(p),u.g[v].length==0&&(delete u.g[v],u.h--))}}function I(u,p,v,b){for(var K=0;K<u.length;++K){var J=u[K];if(!J.da&&J.listener==p&&J.capture==!!v&&J.ha==b)return K}return-1}var S="closure_lm_"+(1e6*Math.random()|0),M={};function le(u,p,v,b,K){if(b&&b.once)return _e(u,p,v,b,K);if(Array.isArray(p)){for(var J=0;J<p.length;J++)le(u,p[J],v,b,K);return null}return v=Be(v),u&&u[D]?u.K(p,v,c(b)?!!b.capture:!!b,K):ne(u,p,v,!1,b,K)}function ne(u,p,v,b,K,J){if(!p)throw Error("Invalid event type");var Te=c(K)?!!K.capture:!!K,Tt=xe(u);if(Tt||(u[S]=Tt=new Ve(u)),v=Tt.add(p,v,b,Te,J),v.proxy)return v;if(b=ie(),v.proxy=b,b.src=u,b.listener=v,u.addEventListener)We||(K=Te),K===void 0&&(K=!1),u.addEventListener(p.toString(),b,K);else if(u.attachEvent)u.attachEvent(ge(p.toString()),b);else if(u.addListener&&u.removeListener)u.addListener(b);else throw Error("addEventListener and attachEvent are unavailable.");return v}function ie(){function u(v){return p.call(u.src,u.listener,v)}const p=Me;return u}function _e(u,p,v,b,K){if(Array.isArray(p)){for(var J=0;J<p.length;J++)_e(u,p[J],v,b,K);return null}return v=Be(v),u&&u[D]?u.L(p,v,c(b)?!!b.capture:!!b,K):ne(u,p,v,!0,b,K)}function be(u,p,v,b,K){if(Array.isArray(p))for(var J=0;J<p.length;J++)be(u,p[J],v,b,K);else b=c(b)?!!b.capture:!!b,v=Be(v),u&&u[D]?(u=u.i,p=String(p).toString(),p in u.g&&(J=u.g[p],v=I(J,v,b,K),-1<v&&(oe(J[v]),Array.prototype.splice.call(J,v,1),J.length==0&&(delete u.g[p],u.h--)))):u&&(u=xe(u))&&(p=u.g[p.toString()],u=-1,p&&(u=I(p,v,b,K)),(v=-1<u?p[u]:null)&&we(v))}function we(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[D])qe(p.i,u);else{var v=u.type,b=u.proxy;p.removeEventListener?p.removeEventListener(v,b,u.capture):p.detachEvent?p.detachEvent(ge(v),b):p.addListener&&p.removeListener&&p.removeListener(b),(v=xe(p))?(qe(v,u),v.h==0&&(v.src=null,p[S]=null)):oe(u)}}}function ge(u){return u in M?M[u]:M[u]="on"+u}function Me(u,p){if(u.da)u=!0;else{p=new ft(p,this);var v=u.listener,b=u.ha||u.src;u.fa&&we(u),u=v.call(b,p)}return u}function xe(u){return u=u[S],u instanceof Ve?u:null}var ke="__closure_events_fn_"+(1e9*Math.random()>>>0);function Be(u){return typeof u=="function"?u:(u[ke]||(u[ke]=function(p){return u.handleEvent(p)}),u[ke])}function je(){Q.call(this),this.i=new Ve(this),this.M=this,this.F=null}E(je,Q),je.prototype[D]=!0,je.prototype.removeEventListener=function(u,p,v,b){be(this,u,p,v,b)};function He(u,p){var v,b=u.F;if(b)for(v=[];b;b=b.F)v.push(b);if(u=u.M,b=p.type||p,typeof p=="string")p=new Ee(p,u);else if(p instanceof Ee)p.target=p.target||u;else{var K=p;p=new Ee(b,u),N(p,K)}if(K=!0,v)for(var J=v.length-1;0<=J;J--){var Te=p.g=v[J];K=rt(Te,b,!0,p)&&K}if(Te=p.g=u,K=rt(Te,b,!0,p)&&K,K=rt(Te,b,!1,p)&&K,v)for(J=0;J<v.length;J++)Te=p.g=v[J],K=rt(Te,b,!1,p)&&K}je.prototype.N=function(){if(je.aa.N.call(this),this.i){var u=this.i,p;for(p in u.g){for(var v=u.g[p],b=0;b<v.length;b++)oe(v[b]);delete u.g[p],u.h--}}this.F=null},je.prototype.K=function(u,p,v,b){return this.i.add(String(u),p,!1,v,b)},je.prototype.L=function(u,p,v,b){return this.i.add(String(u),p,!0,v,b)};function rt(u,p,v,b){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();for(var K=!0,J=0;J<p.length;++J){var Te=p[J];if(Te&&!Te.da&&Te.capture==v){var Tt=Te.listener,vn=Te.ha||Te.src;Te.fa&&qe(u.i,Te),K=Tt.call(vn,b)!==!1&&K}}return K&&!b.defaultPrevented}function mn(u,p,v){if(typeof u=="function")v&&(u=g(u,v));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(p)?-1:a.setTimeout(u,p||0)}function nn(u){u.g=mn(()=>{u.g=null,u.i&&(u.i=!1,nn(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class wn extends Q{constructor(p,v){super(),this.m=p,this.l=v,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:nn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rn(u){Q.call(this),this.h=u,this.g={}}E(rn,Q);var lr=[];function kr(u){me(u.g,function(p,v){this.g.hasOwnProperty(v)&&we(p)},u),u.g={}}rn.prototype.N=function(){rn.aa.N.call(this),kr(this)},rn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var $t=a.JSON.stringify,In=a.JSON.parse,ps=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function Wt(){}Wt.prototype.h=null;function Sc(u){return u.h||(u.h=u.i())}function qr(){}var gn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ms(){Ee.call(this,"d")}E(ms,Ee);function Wi(){Ee.call(this,"c")}E(Wi,Ee);var _r={},Qi=null;function gs(){return Qi=Qi||new je}_r.La="serverreachability";function Ji(u){Ee.call(this,_r.La,u)}E(Ji,Ee);function Dr(u){const p=gs();He(p,new Ji(p))}_r.STAT_EVENT="statevent";function ia(u,p){Ee.call(this,_r.STAT_EVENT,u),this.stat=p}E(ia,Ee);function hn(u){const p=gs();He(p,new ia(p,u))}_r.Ma="timingevent";function kl(u,p){Ee.call(this,_r.Ma,u),this.size=p}E(kl,Ee);function vs(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function Js(){this.g=!0}Js.prototype.xa=function(){this.g=!1};function sf(u,p,v,b,K,J){u.info(function(){if(u.g)if(J)for(var Te="",Tt=J.split("&"),vn=0;vn<Tt.length;vn++){var ut=Tt[vn].split("=");if(1<ut.length){var Tn=ut[0];ut=ut[1];var yn=Tn.split("_");Te=2<=yn.length&&yn[1]=="type"?Te+(Tn+"="+ut+"&"):Te+(Tn+"=redacted&")}}else Te=null;else Te=J;return"XMLHTTP REQ ("+b+") [attempt "+K+"]: "+p+`
`+v+`
`+Te})}function of(u,p,v,b,K,J,Te){u.info(function(){return"XMLHTTP RESP ("+b+") [ attempt "+K+"]: "+p+`
`+v+`
`+J+" "+Te})}function Ys(u,p,v,b){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+lf(u,v)+(b?" "+b:"")})}function af(u,p){u.info(function(){return"TIMEOUT: "+p})}Js.prototype.info=function(){};function lf(u,p){if(!u.g)return p;if(!p)return null;try{var v=JSON.parse(p);if(v){for(u=0;u<v.length;u++)if(Array.isArray(v[u])){var b=v[u];if(!(2>b.length)){var K=b[1];if(Array.isArray(K)&&!(1>K.length)){var J=K[0];if(J!="noop"&&J!="stop"&&J!="close")for(var Te=1;Te<K.length;Te++)K[Te]=""}}}}return $t(v)}catch{return p}}var ur={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},zr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},br;function Nr(){}E(Nr,Wt),Nr.prototype.g=function(){return new XMLHttpRequest},Nr.prototype.i=function(){return{}},br=new Nr;function kn(u,p,v,b){this.j=u,this.i=p,this.l=v,this.R=b||1,this.U=new rn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Dl}function Dl(){this.i=null,this.g="",this.h=!1}var Yi={},ys={};function Nl(u,p,v){u.L=1,u.v=to(Ir(p)),u.m=v,u.P=!0,cr(u,null)}function cr(u,p){u.F=Date.now(),Xs(u),u.A=Ir(u.v);var v=u.A,b=u.R;Array.isArray(b)||(b=[String(b)]),Vc(v.i,"t",b),u.C=0,v=u.j.J,u.h=new Dl,u.g=jc(u.j,v?p:null,!u.m),0<u.O&&(u.M=new wn(g(u.Y,u,u.g),u.O)),p=u.U,v=u.g,b=u.ca;var K="readystatechange";Array.isArray(K)||(K&&(lr[0]=K.toString()),K=lr);for(var J=0;J<K.length;J++){var Te=le(v,K[J],b||p.handleEvent,!1,p.h||p);if(!Te)break;p.g[Te.key]=Te}p=u.H?w(u.H):{},u.m?(u.u||(u.u="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,p)):(u.u="GET",u.g.ea(u.A,u.u,null,p)),Dr(),sf(u.i,u.u,u.A,u.l,u.R,u.m)}kn.prototype.ca=function(u){u=u.target;const p=this.M;p&&Mr(u)==3?p.j():this.Y(u)},kn.prototype.Y=function(u){try{if(u==this.g)e:{const yn=Mr(this.g);var p=this.g.Ba();const ii=this.g.Z();if(!(3>yn)&&(yn!=3||this.g&&(this.h.h||this.g.oa()||bs(this.g)))){this.J||yn!=4||p==7||(p==8||0>=ii?Dr(3):Dr(2)),Dn(this);var v=this.g.Z();this.X=v;t:if(Vl(this)){var b=bs(this.g);u="";var K=b.length,J=Mr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){En(this),Kr(this);var Te="";break t}this.h.i=new a.TextDecoder}for(p=0;p<K;p++)this.h.h=!0,u+=this.h.i.decode(b[p],{stream:!(J&&p==K-1)});b.length=0,this.h.g+=u,this.C=0,Te=this.h.g}else Te=this.g.oa();if(this.o=v==200,of(this.i,this.u,this.A,this.l,this.R,yn,v),this.o){if(this.T&&!this.K){t:{if(this.g){var Tt,vn=this.g;if((Tt=vn.g?vn.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(Tt)){var ut=Tt;break t}}ut=null}if(v=ut)Ys(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,oa(this,v);else{this.o=!1,this.s=3,hn(12),En(this),Kr(this);break e}}if(this.P){v=!0;let fr;for(;!this.J&&this.C<Te.length;)if(fr=Pc(this,Te),fr==ys){yn==4&&(this.s=4,hn(14),v=!1),Ys(this.i,this.l,null,"[Incomplete Response]");break}else if(fr==Yi){this.s=4,hn(15),Ys(this.i,this.l,Te,"[Invalid Chunk]"),v=!1;break}else Ys(this.i,this.l,fr,null),oa(this,fr);if(Vl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),yn!=4||Te.length!=0||this.h.h||(this.s=1,hn(16),v=!1),this.o=this.o&&v,!v)Ys(this.i,this.l,Te,"[Invalid Chunked Response]"),En(this),Kr(this);else if(0<Te.length&&!this.W){this.W=!0;var Tn=this.j;Tn.g==this&&Tn.ba&&!Tn.M&&(Tn.j.info("Great, no buffering proxy detected. Bytes received: "+Te.length),uo(Tn),Tn.M=!0,hn(11))}}else Ys(this.i,this.l,Te,null),oa(this,Te);yn==4&&En(this),this.o&&!this.J&&(yn==4?ws(this.j,this):(this.o=!1,Xs(this)))}else hr(this.g),v==400&&0<Te.indexOf("Unknown SID")?(this.s=3,hn(12)):(this.s=0,hn(13)),En(this),Kr(this)}}}catch{}finally{}};function Vl(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function Pc(u,p){var v=u.C,b=p.indexOf(`
`,v);return b==-1?ys:(v=Number(p.substring(v,b)),isNaN(v)?Yi:(b+=1,b+v>p.length?ys:(p=p.slice(b,b+v),u.C=b+v,p)))}kn.prototype.cancel=function(){this.J=!0,En(this)};function Xs(u){u.S=Date.now()+u.I,Rc(u,u.I)}function Rc(u,p){if(u.B!=null)throw Error("WatchDog timer not null");u.B=vs(g(u.ba,u),p)}function Dn(u){u.B&&(a.clearTimeout(u.B),u.B=null)}kn.prototype.ba=function(){this.B=null;const u=Date.now();0<=u-this.S?(af(this.i,this.A),this.L!=2&&(Dr(),hn(17)),En(this),this.s=2,Kr(this)):Rc(this,this.S-u)};function Kr(u){u.j.G==0||u.J||ws(u.j,u)}function En(u){Dn(u);var p=u.M;p&&typeof p.ma=="function"&&p.ma(),u.M=null,kr(u.U),u.g&&(p=u.g,u.g=null,p.abort(),p.ma())}function oa(u,p){try{var v=u.j;if(v.G!=0&&(v.g==u||Gr(v.h,u))){if(!u.K&&Gr(v.h,u)&&v.G==3){try{var b=v.Da.g.parse(p)}catch{b=null}if(Array.isArray(b)&&b.length==3){var K=b;if(K[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<u.F)co(v),ha(v);else break e;ma(v),hn(18)}}else v.za=K[1],0<v.za-v.T&&37500>K[2]&&v.F&&v.v==0&&!v.C&&(v.C=vs(g(v.Za,v),6e3));if(1>=Xi(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else xr(v,11)}else if((u.K||v.g==u)&&co(v),!q(p))for(K=v.Da.g.parse(p),p=0;p<K.length;p++){let ut=K[p];if(v.T=ut[0],ut=ut[1],v.G==2)if(ut[0]=="c"){v.K=ut[1],v.ia=ut[2];const Tn=ut[3];Tn!=null&&(v.la=Tn,v.j.info("VER="+v.la));const yn=ut[4];yn!=null&&(v.Aa=yn,v.j.info("SVER="+v.Aa));const ii=ut[5];ii!=null&&typeof ii=="number"&&0<ii&&(b=1.5*ii,v.L=b,v.j.info("backChannelRequestTimeoutMs_="+b)),b=v;const fr=u.g;if(fr){const va=fr.g?fr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(va){var J=b.h;J.g||va.indexOf("spdy")==-1&&va.indexOf("quic")==-1&&va.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(aa(J,J.h),J.h=null))}if(b.D){const Bl=fr.g?fr.g.getResponseHeader("X-HTTP-Session-Id"):null;Bl&&(b.ya=Bl,xt(b.I,b.D,Bl))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-u.F,v.j.info("Handshake RTT: "+v.R+"ms")),b=v;var Te=u;if(b.qa=jl(b,b.J?b.ia:null,b.W),Te.K){Zi(b.h,Te);var Tt=Te,vn=b.L;vn&&(Tt.I=vn),Tt.B&&(Dn(Tt),Xs(Tt)),b.g=Te}else $c(b);0<v.i.length&&lo(v)}else ut[0]!="stop"&&ut[0]!="close"||xr(v,7);else v.G==3&&(ut[0]=="stop"||ut[0]=="close"?ut[0]=="stop"?xr(v,7):Ul(v):ut[0]!="noop"&&v.l&&v.l.ta(ut),v.v=0)}}Dr(4)}catch{}}var Cc=class{constructor(u,p){this.g=u,this.map=p}};function Zs(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ei(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function Xi(u){return u.h?1:u.g?u.g.size:0}function Gr(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function aa(u,p){u.g?u.g.add(p):u.h=p}function Zi(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Zs.prototype.cancel=function(){if(this.i=wr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function wr(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const v of u.g.values())p=p.concat(v.D);return p}return A(u.i)}function uf(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var p=[],v=u.length,b=0;b<v;b++)p.push(u[b]);return p}p=[],v=0;for(b in u)p[v++]=u[b];return p}function cf(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var p=[];u=u.length;for(var v=0;v<u;v++)p.push(v);return p}p=[],v=0;for(const b in u)p[v++]=b;return p}}}function kc(u,p){if(u.forEach&&typeof u.forEach=="function")u.forEach(p,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,p,void 0);else for(var v=cf(u),b=uf(u),K=b.length,J=0;J<K;J++)p.call(void 0,b[J],v&&v[J],u)}var Ol=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Hr(u,p){if(u){u=u.split("&");for(var v=0;v<u.length;v++){var b=u[v].indexOf("="),K=null;if(0<=b){var J=u[v].substring(0,b);K=u[v].substring(b+1)}else J=u[v];p(J,K?decodeURIComponent(K.replace(/\+/g," ")):"")}}}function Vr(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof Vr){this.h=u.h,eo(this,u.j),this.o=u.o,this.g=u.g,ti(this,u.s),this.l=u.l;var p=u.i,v=new Er;v.i=p.i,p.g&&(v.g=new Map(p.g),v.h=p.h),Dc(this,v),this.m=u.m}else u&&(p=String(u).match(Ol))?(this.h=!1,eo(this,p[1]||"",!0),this.o=ni(p[2]||""),this.g=ni(p[3]||"",!0),ti(this,p[4]),this.l=ni(p[5]||"",!0),Dc(this,p[6]||"",!0),this.m=ni(p[7]||"")):(this.h=!1,this.i=new Er(null,this.h))}Vr.prototype.toString=function(){var u=[],p=this.j;p&&u.push(Wr(p,no,!0),":");var v=this.g;return(v||p=="file")&&(u.push("//"),(p=this.o)&&u.push(Wr(p,no,!0),"@"),u.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&u.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&u.push("/"),u.push(Wr(v,v.charAt(0)=="/"?Le:Ml,!0))),(v=this.i.toString())&&u.push("?",v),(v=this.m)&&u.push("#",Wr(v,dr)),u.join("")};function Ir(u){return new Vr(u)}function eo(u,p,v){u.j=v?ni(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ti(u,p){if(p){if(p=Number(p),isNaN(p)||0>p)throw Error("Bad port number "+p);u.s=p}else u.s=null}function Dc(u,p,v){p instanceof Er?(u.i=p,df(u.i,u.h)):(v||(p=Wr(p,lt)),u.i=new Er(p,u.h))}function xt(u,p,v){u.i.set(p,v)}function to(u){return xt(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function ni(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function Wr(u,p,v){return typeof u=="string"?(u=encodeURI(u).replace(p,la),v&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function la(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var no=/[#\/\?@]/g,Ml=/[#\?:]/g,Le=/[#\?]/g,lt=/[#\?@]/g,dr=/#/g;function Er(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Qr(u){u.g||(u.g=new Map,u.h=0,u.i&&Hr(u.i,function(p,v){u.add(decodeURIComponent(p.replace(/\+/g," ")),v)}))}n=Er.prototype,n.add=function(u,p){Qr(this),this.i=null,u=Jr(this,u);var v=this.g.get(u);return v||this.g.set(u,v=[]),v.push(p),this.h+=1,this};function Ll(u,p){Qr(u),p=Jr(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function Nc(u,p){return Qr(u),p=Jr(u,p),u.g.has(p)}n.forEach=function(u,p){Qr(this),this.g.forEach(function(v,b){v.forEach(function(K){u.call(p,K,b,this)},this)},this)},n.na=function(){Qr(this);const u=Array.from(this.g.values()),p=Array.from(this.g.keys()),v=[];for(let b=0;b<p.length;b++){const K=u[b];for(let J=0;J<K.length;J++)v.push(p[b])}return v},n.V=function(u){Qr(this);let p=[];if(typeof u=="string")Nc(this,u)&&(p=p.concat(this.g.get(Jr(this,u))));else{u=Array.from(this.g.values());for(let v=0;v<u.length;v++)p=p.concat(u[v])}return p},n.set=function(u,p){return Qr(this),this.i=null,u=Jr(this,u),Nc(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},n.get=function(u,p){return u?(u=this.V(u),0<u.length?String(u[0]):p):p};function Vc(u,p,v){Ll(u,p),0<v.length&&(u.i=null,u.g.set(Jr(u,p),A(v)),u.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(var v=0;v<p.length;v++){var b=p[v];const J=encodeURIComponent(String(b)),Te=this.V(b);for(b=0;b<Te.length;b++){var K=J;Te[b]!==""&&(K+="="+encodeURIComponent(String(Te[b]))),u.push(K)}}return this.i=u.join("&")};function Jr(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function df(u,p){p&&!u.j&&(Qr(u),u.i=null,u.g.forEach(function(v,b){var K=b.toLowerCase();b!=K&&(Ll(this,b),Vc(this,K,v))},u)),u.j=p}function ro(u,p){const v=new Js;if(a.Image){const b=new Image;b.onload=y(Qn,v,"TestLoadImage: loaded",!0,p,b),b.onerror=y(Qn,v,"TestLoadImage: error",!1,p,b),b.onabort=y(Qn,v,"TestLoadImage: abort",!1,p,b),b.ontimeout=y(Qn,v,"TestLoadImage: timeout",!1,p,b),a.setTimeout(function(){b.ontimeout&&b.ontimeout()},1e4),b.src=u}else p(!1)}function ua(u,p){const v=new Js,b=new AbortController,K=setTimeout(()=>{b.abort(),Qn(v,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:b.signal}).then(J=>{clearTimeout(K),J.ok?Qn(v,"TestPingServer: ok",!0,p):Qn(v,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(K),Qn(v,"TestPingServer: error",!1,p)})}function Qn(u,p,v,b,K){try{K&&(K.onload=null,K.onerror=null,K.onabort=null,K.ontimeout=null),b(v)}catch{}}function ri(){this.g=new ps}function so(u,p,v){const b=v||"";try{kc(u,function(K,J){let Te=K;c(K)&&(Te=$t(K)),p.push(b+J+"="+encodeURIComponent(Te))})}catch(K){throw p.push(b+"type="+encodeURIComponent("_badmap")),K}}function Yr(u){this.l=u.Ub||null,this.j=u.eb||!1}E(Yr,Wt),Yr.prototype.g=function(){return new _s(this.l,this.j)},Yr.prototype.i=function(u){return function(){return u}}({});function _s(u,p){je.call(this),this.D=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}E(_s,je),n=_s.prototype,n.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=p,this.readyState=1,oo(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const p={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(p.body=u),(this.D||a).fetch(new Request(this.A,p)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,io(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,oo(this)),this.g&&(this.readyState=3,oo(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Oc(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Oc(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.v.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?io(this):oo(this),this.readyState==3&&Oc(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,io(this))},n.Qa=function(u){this.g&&(this.response=u,io(this))},n.ga=function(){this.g&&io(this)};function io(u){u.readyState=4,u.l=null,u.j=null,u.v=null,oo(u)}n.setRequestHeader=function(u,p){this.u.append(u,p)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var v=p.next();!v.done;)v=v.value,u.push(v[0]+": "+v[1]),v=p.next();return u.join(`\r
`)};function oo(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(_s.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function Fl(u){let p="";return me(u,function(v,b){p+=b,p+=":",p+=v,p+=`\r
`}),p}function Ke(u,p,v){e:{for(b in v){var b=!1;break e}b=!0}b||(v=Fl(v),typeof u=="string"?v!=null&&encodeURIComponent(String(v)):xt(u,p,v))}function Fe(u){je.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}E(Fe,je);var Qt=/^https?$/i,pt=["POST","PUT"];n=Fe.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,p,v,b){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():br.g(),this.v=this.o?Sc(this.o):Sc(br),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(J){Mc(this,J);return}if(u=v||"",v=new Map(this.headers),b)if(Object.getPrototypeOf(b)===Object.prototype)for(var K in b)v.set(K,b[K]);else if(typeof b.keys=="function"&&typeof b.get=="function")for(const J of b.keys())v.set(J,b.get(J));else throw Error("Unknown input type for opt_headers: "+String(b));b=Array.from(v.keys()).find(J=>J.toLowerCase()=="content-type"),K=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(pt,p,void 0))||b||K||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,Te]of v)this.g.setRequestHeader(J,Te);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Xr(this),this.u=!0,this.g.send(u),this.u=!1}catch(J){Mc(this,J)}};function Mc(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.m=5,ca(u),Or(u)}function ca(u){u.A||(u.A=!0,He(u,"complete"),He(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,He(this,"complete"),He(this,"abort"),Or(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Or(this,!0)),Fe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?$l(this):this.bb())},n.bb=function(){$l(this)};function $l(u){if(u.h&&typeof o<"u"&&(!u.v[1]||Mr(u)!=4||u.Z()!=2)){if(u.u&&Mr(u)==4)mn(u.Ea,0,u);else if(He(u,"readystatechange"),Mr(u)==4){u.h=!1;try{const Te=u.Z();e:switch(Te){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var v;if(!(v=p)){var b;if(b=Te===0){var K=String(u.D).match(Ol)[1]||null;!K&&a.self&&a.self.location&&(K=a.self.location.protocol.slice(0,-1)),b=!Qt.test(K?K.toLowerCase():"")}v=b}if(v)He(u,"complete"),He(u,"success");else{u.m=6;try{var J=2<Mr(u)?u.g.statusText:""}catch{J=""}u.l=J+" ["+u.Z()+"]",ca(u)}}finally{Or(u)}}}}function Or(u,p){if(u.g){Xr(u);const v=u.g,b=u.v[0]?()=>{}:null;u.g=null,u.v=null,p||He(u,"ready");try{v.onreadystatechange=b}catch{}}}function Xr(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function Mr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<Mr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),In(p)}};function bs(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function hr(u){const p={};u=(u.g&&2<=Mr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let b=0;b<u.length;b++){if(q(u[b]))continue;var v=L(u[b]);const K=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const J=p[K]||[];p[K]=J,J.push(v)}T(p,function(b){return b.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ao(u,p,v){return v&&v.internalChannelParams&&v.internalChannelParams[u]||p}function da(u){this.Aa=0,this.i=[],this.j=new Js,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ao("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ao("baseRetryDelayMs",5e3,u),this.cb=ao("retryDelaySeedMs",1e4,u),this.Wa=ao("forwardChannelMaxRetries",2,u),this.wa=ao("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new Zs(u&&u.concurrentRequestLimit),this.Da=new ri,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=da.prototype,n.la=8,n.G=1,n.connect=function(u,p,v,b){hn(0),this.W=u,this.H=p||{},v&&b!==void 0&&(this.H.OSID=v,this.H.OAID=b),this.F=this.X,this.I=jl(this,null,this.W),lo(this)};function Ul(u){if(Lc(u),u.G==3){var p=u.U++,v=Ir(u.I);if(xt(v,"SID",u.K),xt(v,"RID",p),xt(v,"TYPE","terminate"),xn(u,v),p=new kn(u,u.j,p),p.L=2,p.v=to(Ir(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(p.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=p.v,v=!0),v||(p.g=jc(p.j,null),p.g.ea(p.v)),p.F=Date.now(),Xs(p)}ho(u)}function ha(u){u.g&&(uo(u),u.g.cancel(),u.g=null)}function Lc(u){ha(u),u.u&&(a.clearTimeout(u.u),u.u=null),co(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function lo(u){if(!ei(u.h)&&!u.s){u.s=!0;var p=u.Ga;U||Se(),W||(U(),W=!0),re.add(p,u),u.B=0}}function fa(u,p){return Xi(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=p.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=vs(g(u.Ga,u,p),ga(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;const K=new kn(this,this.j,u);let J=this.o;if(this.S&&(J?(J=w(J),N(J,this.S)):J=this.S),this.m!==null||this.O||(K.H=J,J=null),this.P)e:{for(var p=0,v=0;v<this.i.length;v++){t:{var b=this.i[v];if("__data__"in b.map&&(b=b.map.__data__,typeof b=="string")){b=b.length;break t}b=void 0}if(b===void 0)break;if(p+=b,4096<p){p=v;break e}if(p===4096||v===this.i.length-1){p=v+1;break e}}p=1e3}else p=1e3;p=Fc(this,K,p),v=Ir(this.I),xt(v,"RID",u),xt(v,"CVER",22),this.D&&xt(v,"X-HTTP-Session-Id",this.D),xn(this,v),J&&(this.O?p="headers="+encodeURIComponent(String(Fl(J)))+"&"+p:this.m&&Ke(v,this.m,J)),aa(this.h,K),this.Ua&&xt(v,"TYPE","init"),this.P?(xt(v,"$req",p),xt(v,"SID","null"),K.T=!0,Nl(K,v,null)):Nl(K,v,p),this.G=2}}else this.G==3&&(u?pa(this,u):this.i.length==0||ei(this.h)||pa(this))};function pa(u,p){var v;p?v=p.l:v=u.U++;const b=Ir(u.I);xt(b,"SID",u.K),xt(b,"RID",v),xt(b,"AID",u.T),xn(u,b),u.m&&u.o&&Ke(b,u.m,u.o),v=new kn(u,u.j,v,u.B+1),u.m===null&&(v.H=u.o),p&&(u.i=p.D.concat(u.i)),p=Fc(u,v,1e3),v.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),aa(u.h,v),Nl(v,b,p)}function xn(u,p){u.H&&me(u.H,function(v,b){xt(p,b,v)}),u.l&&kc({},function(v,b){xt(p,b,v)})}function Fc(u,p,v){v=Math.min(u.i.length,v);var b=u.l?g(u.l.Na,u.l,u):null;e:{var K=u.i;let J=-1;for(;;){const Te=["count="+v];J==-1?0<v?(J=K[0].g,Te.push("ofs="+J)):J=0:Te.push("ofs="+J);let Tt=!0;for(let vn=0;vn<v;vn++){let ut=K[vn].g;const Tn=K[vn].map;if(ut-=J,0>ut)J=Math.max(0,K[vn].g-100),Tt=!1;else try{so(Tn,Te,"req"+ut+"_")}catch{b&&b(Tn)}}if(Tt){b=Te.join("&");break e}}}return u=u.i.splice(0,v),p.D=u,b}function $c(u){if(!u.g&&!u.u){u.Y=1;var p=u.Fa;U||Se(),W||(U(),W=!0),re.add(p,u),u.v=0}}function ma(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=vs(g(u.Fa,u),ga(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Uc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=vs(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,hn(10),ha(this),Uc(this))};function uo(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Uc(u){u.g=new kn(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var p=Ir(u.qa);xt(p,"RID","rpc"),xt(p,"SID",u.K),xt(p,"AID",u.T),xt(p,"CI",u.F?"0":"1"),!u.F&&u.ja&&xt(p,"TO",u.ja),xt(p,"TYPE","xmlhttp"),xn(u,p),u.m&&u.o&&Ke(p,u.m,u.o),u.L&&(u.g.I=u.L);var v=u.g;u=u.ia,v.L=1,v.v=to(Ir(p)),v.m=null,v.P=!0,cr(v,u)}n.Za=function(){this.C!=null&&(this.C=null,ha(this),ma(this),hn(19))};function co(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function ws(u,p){var v=null;if(u.g==p){co(u),uo(u),u.g=null;var b=2}else if(Gr(u.h,p))v=p.D,Zi(u.h,p),b=1;else return;if(u.G!=0){if(p.o)if(b==1){v=p.m?p.m.length:0,p=Date.now()-p.F;var K=u.B;b=gs(),He(b,new kl(b,v)),lo(u)}else $c(u);else if(K=p.s,K==3||K==0&&0<p.X||!(b==1&&fa(u,p)||b==2&&ma(u)))switch(v&&0<v.length&&(p=u.h,p.i=p.i.concat(v)),K){case 1:xr(u,5);break;case 4:xr(u,10);break;case 3:xr(u,6);break;default:xr(u,2)}}}function ga(u,p){let v=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(v*=2),v*p}function xr(u,p){if(u.j.info("Error code "+p),p==2){var v=g(u.fb,u),b=u.Xa;const K=!b;b=new Vr(b||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||eo(b,"https"),to(b),K?ro(b.toString(),v):ua(b.toString(),v)}else hn(2);u.G=0,u.l&&u.l.sa(p),ho(u),Lc(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),hn(2)):(this.j.info("Failed to ping google.com"),hn(1))};function ho(u){if(u.G=0,u.ka=[],u.l){const p=wr(u.h);(p.length!=0||u.i.length!=0)&&(R(u.ka,p),R(u.ka,u.i),u.h.i.length=0,A(u.i),u.i.length=0),u.l.ra()}}function jl(u,p,v){var b=v instanceof Vr?Ir(v):new Vr(v);if(b.g!="")p&&(b.g=p+"."+b.g),ti(b,b.s);else{var K=a.location;b=K.protocol,p=p?p+"."+K.hostname:K.hostname,K=+K.port;var J=new Vr(null);b&&eo(J,b),p&&(J.g=p),K&&ti(J,K),v&&(J.l=v),b=J}return v=u.D,p=u.ya,v&&p&&xt(b,v,p),xt(b,"VER",u.la),xn(u,b),b}function jc(u,p,v){if(p&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Ca&&!u.pa?new Fe(new Yr({eb:v})):new Fe(u.pa),p.Ha(u.J),p}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Bc(){}n=Bc.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function fo(){}fo.prototype.g=function(u,p){return new Nn(u,p)};function Nn(u,p){je.call(this),this.g=new da(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.va&&(u?u["X-WebChannel-Client-Profile"]=p.va:u={"X-WebChannel-Client-Profile":p.va}),this.g.S=u,(u=p&&p.Sb)&&!q(u)&&(this.g.m=u),this.v=p&&p.supportsCrossDomainXhr||!1,this.u=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!q(p)&&(this.g.D=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new si(this)}E(Nn,je),Nn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Nn.prototype.close=function(){Ul(this.g)},Nn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var v={};v.__data__=u,u=v}else this.u&&(v={},v.__data__=$t(u),u=v);p.i.push(new Cc(p.Ya++,u)),p.G==3&&lo(p)},Nn.prototype.N=function(){this.g.l=null,delete this.j,Ul(this.g),delete this.g,Nn.aa.N.call(this)};function po(u){ms.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const v in p){u=v;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}E(po,ms);function mo(){Wi.call(this),this.status=1}E(mo,Wi);function si(u){this.g=u}E(si,Bc),si.prototype.ua=function(){He(this.g,"a")},si.prototype.ta=function(u){He(this.g,new po(u))},si.prototype.sa=function(u){He(this.g,new mo)},si.prototype.ra=function(){He(this.g,"b")},fo.prototype.createWebChannel=fo.prototype.g,Nn.prototype.send=Nn.prototype.o,Nn.prototype.open=Nn.prototype.m,Nn.prototype.close=Nn.prototype.close,aw=function(){return new fo},ow=function(){return gs()},iw=_r,yp={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ur.NO_ERROR=0,ur.TIMEOUT=8,ur.HTTP_ERROR=6,cd=ur,zr.COMPLETE="complete",sw=zr,qr.EventType=gn,gn.OPEN="a",gn.CLOSE="b",gn.ERROR="c",gn.MESSAGE="d",je.prototype.listen=je.prototype.K,su=qr,Fe.prototype.listenOnce=Fe.prototype.L,Fe.prototype.getLastError=Fe.prototype.Ka,Fe.prototype.getLastErrorCode=Fe.prototype.Ba,Fe.prototype.getStatus=Fe.prototype.Z,Fe.prototype.getResponseJson=Fe.prototype.Oa,Fe.prototype.getResponseText=Fe.prototype.oa,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Ha,rw=Fe}).apply(typeof Wc<"u"?Wc:typeof self<"u"?self:typeof window<"u"?window:{});const Ry="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Sn.UNAUTHENTICATED=new Sn(null),Sn.GOOGLE_CREDENTIALS=new Sn("google-credentials-uid"),Sn.FIRST_PARTY=new Sn("first-party-uid"),Sn.MOCK_USER=new Sn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ml="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Di=new _m("@firebase/firestore");function Sa(){return Di.logLevel}function PB(n){Di.setLogLevel(n)}function fe(n,...e){if(Di.logLevel<=it.DEBUG){const t=e.map(Im);Di.debug(`Firestore (${ml}): ${n}`,...t)}}function an(n,...e){if(Di.logLevel<=it.ERROR){const t=e.map(Im);Di.error(`Firestore (${ml}): ${n}`,...t)}}function Rr(n,...e){if(Di.logLevel<=it.WARN){const t=e.map(Im);Di.warn(`Firestore (${ml}): ${n}`,...t)}}function Im(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ce(n="Unexpected state"){const e=`FIRESTORE (${ml}) INTERNAL ASSERTION FAILED: `+n;throw an(e),new Error(e)}function Ne(n,e){n||Ce()}function RB(n,e){n||Ce()}function Ae(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pe extends fs{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lw{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class MR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Sn.UNAUTHENTICATED))}shutdown(){}}class LR{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class FR{constructor(e){this.t=e,this.currentUser=Sn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Ne(this.o===void 0);let r=this.i;const s=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let i=new Pn;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Pn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Pn)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ne(typeof r.accessToken=="string"),new lw(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ne(e===null||typeof e=="string"),new Sn(e)}}class $R{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Sn.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class UR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new $R(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Sn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class uw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jR{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Ne(this.o===void 0);const r=i=>{i.error!=null&&fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,fe("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Ne(typeof t.token=="string"),this.R=t.token,new uw(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class CB{getToken(){return Promise.resolve(new uw(""))}invalidateToken(){}start(e,t){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BR(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=BR(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function Ge(n,e){return n<e?-1:n>e?1:0}function Ha(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function dw(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pe(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pe(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pe(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pe(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Gt.fromMillis(Date.now())}static fromDate(e){return Gt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Gt(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ge(this.nanoseconds,e.nanoseconds):Ge(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.timestamp=e}static fromTimestamp(e){return new $e(e)}static min(){return new $e(new Gt(0,0))}static max(){return new $e(new Gt(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ce(),r===void 0?r=e.length-t:r>e.length-t&&Ce(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ou.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ou?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ot extends Ou{construct(e,t,r){return new ot(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new pe(Y.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new ot(t)}static emptyPath(){return new ot([])}}const qR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bt extends Ou{construct(e,t,r){return new Bt(e,t,r)}static isValidIdentifier(e){return qR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Bt(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new pe(Y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new pe(Y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new pe(Y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new pe(Y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bt(t)}static emptyPath(){return new Bt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.path=e}static fromPath(e){return new Re(ot.fromString(e))}static fromName(e){return new Re(ot.fromString(e).popFirst(5))}static empty(){return new Re(ot.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ot.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ot.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Re(new ot(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function _p(n){return n.fields.find(e=>e.kind===2)}function xo(n){return n.fields.filter(e=>e.kind!==2)}function zR(n,e){let t=Ge(n.collectionGroup,e.collectionGroup);if(t!==0)return t;for(let r=0;r<Math.min(n.fields.length,e.fields.length);++r)if(t=KR(n.fields[r],e.fields[r]),t!==0)return t;return Ge(n.fields.length,e.fields.length)}Wa.UNKNOWN_ID=-1;class Lo{constructor(e,t){this.fieldPath=e,this.kind=t}}function KR(n,e){const t=Bt.comparator(n.fieldPath,e.fieldPath);return t!==0?t:Ge(n.kind,e.kind)}class Qa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qa(0,yr.min())}}function hw(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=$e.fromTimestamp(r===1e9?new Gt(t+1,0):new Gt(t,r));return new yr(s,Re.empty(),e)}function fw(n){return new yr(n.readTime,n.key,-1)}class yr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new yr($e.min(),Re.empty(),-1)}static max(){return new yr($e.max(),Re.empty(),-1)}}function Em(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Re.comparator(n.documentKey,e.documentKey),t!==0?t:Ge(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class mw{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bi(n){if(n.code!==Y.FAILED_PRECONDITION||n.message!==pw)throw n;fe("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ce(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new G((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof G?t:G.resolve(t)}catch(t){return G.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):G.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):G.reject(t)}static resolve(e){return new G((t,r)=>{t(e)})}static reject(e){return new G((t,r)=>{r(e)})}static waitFor(e){return new G((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},l=>r(l))}),o=!0,i===s&&t()})}static or(e){let t=G.resolve(!1);for(const r of e)t=t.next(s=>s?G.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new G((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;t(e[c]).next(d=>{o[c]=d,++a,a===i&&r(o)},d=>s(d))}})}static doWhile(e,t){return new G((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Pn,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new bu(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const s=xm(r.target.error);this.V.reject(new bu(e,s))}}static open(e,t,r,s){try{return new bh(t,e.transaction(s,r))}catch(i){throw new bu(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(fe("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new HR(t)}}class os{constructor(e,t,r){this.name=e,this.version=t,this.p=r,os.S(_n())===12.2&&an("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return fe("SimpleDb","Removing database:",e),So(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!ym())return!1;if(os.v())return!0;const e=_n(),t=os.S(e),r=0<t&&t<10,s=gw(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(fe("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;t(o)},s.onblocked=()=>{r(new bu(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new pe(Y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new pe(Y.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new bu(e,o))},s.onupgradeneeded=i=>{fe("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.p.O(o,s.transaction,i.oldVersion,this.version).next(()=>{fe("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,s){const i=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=bh.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),G.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(fe("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function gw(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class GR{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return So(this.B.delete())}}class bu extends pe{constructor(e,t){super(Y.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function qi(n){return n.name==="IndexedDbTransactionError"}class HR{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(fe("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(fe("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),So(r)}add(e){return fe("SimpleDb","ADD",this.store.name,e,e),So(this.store.add(e))}get(e){return So(this.store.get(e)).next(t=>(t===void 0&&(t=null),fe("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return fe("SimpleDb","DELETE",this.store.name,e),So(this.store.delete(e))}count(){return fe("SimpleDb","COUNT",this.store.name),So(this.store.count())}U(e,t){const r=this.options(e,t),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new G((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.W(i,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new G((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}j(e,t){fe("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Y(e){const t=this.cursor({});return new G((r,s)=>{t.onerror=i=>{const o=xm(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new G((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new GR(a),c=t(a.primaryKey,a.value,l);if(c instanceof G){const d=c.catch(f=>(l.done(),G.reject(f)));r.push(d)}l.isDone?s():l.K===null?a.continue():a.continue(l.K)}}).next(()=>G.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function So(n){return new G((e,t)=>{n.onsuccess=r=>{const s=r.target.result;e(s)},n.onerror=r=>{const s=xm(r.target.error);t(s)}})}let Cy=!1;function xm(n){const e=os.S(_n());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new pe("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Cy||(Cy=!0,setTimeout(()=>{throw r},0)),r}}return n}class WR{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){fe("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{fe("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){qi(t)?fe("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Bi(t)}await this.X(6e4)})}}class QR{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let s=t,i=!0;return G.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return fe("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(s,i)).next(a=>(fe("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=fw(i);Em(o,r)>0&&(r=o)}),new yr(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}sr.oe=-1;function ic(n){return n==null}function Mu(n){return n===0&&1/n==-1/0}function vw(n){return typeof n=="number"&&Number.isInteger(n)&&!Mu(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gn(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ky(e)),e=JR(n.get(t),e);return ky(e)}function JR(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function ky(n){return n+""}function ns(n){const e=n.length;if(Ne(e>=2),e===2)return Ne(n.charAt(0)===""&&n.charAt(1)===""),ot.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("",i);switch((o<0||o>t)&&Ce(),n.charAt(o+1)){case"":const a=n.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=n.substring(i,o),s+="\0";break;case"":s+=n.substring(i,o+1);break;default:Ce()}i=o+2}return new ot(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dy=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(n,e){return[n,Gn(e)]}function yw(n,e,t){return[n,Gn(e),t]}const YR={},XR=["prefixPath","collectionGroup","readTime","documentId"],ZR=["prefixPath","collectionGroup","documentId"],eC=["collectionGroup","readTime","prefixPath","documentId"],tC=["canonicalId","targetId"],nC=["targetId","path"],rC=["path","targetId"],sC=["collectionId","parent"],iC=["indexId","uid"],oC=["uid","sequenceNumber"],aC=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],lC=["indexId","uid","orderedDocumentKey"],uC=["userId","collectionPath","documentId"],cC=["userId","collectionPath","largestBatchId"],dC=["userId","collectionGroup","largestBatchId"],_w=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],hC=[..._w,"documentOverlays"],bw=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ww=bw,Tm=[...ww,"indexConfiguration","indexState","indexEntries"],fC=Tm,pC=[...Tm,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bp extends mw{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function bn(n,e){const t=Ae(n);return os.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ny(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function zi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Iw(n,e){const t=[];for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(e(n[r],r,n));return t}function Ew(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t){this.comparator=e,this.root=t||On.EMPTY}insert(e,t){return new Ot(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,On.BLACK,null,null))}remove(e){return new Ot(this.comparator,this.root.remove(e,this.comparator).copy(null,null,On.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Qc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Qc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Qc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Qc(this.root,e,this.comparator,!0)}}class Qc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class On{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??On.RED,this.left=s??On.EMPTY,this.right=i??On.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new On(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return On.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return On.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,On.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,On.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ce();const e=this.left.check();if(e!==this.right.check())throw Ce();return e+(this.isRed()?0:1)}}On.EMPTY=null,On.RED=!0,On.BLACK=!1;On.EMPTY=new class{constructor(){this.size=0}get key(){throw Ce()}get value(){throw Ce()}get color(){throw Ce()}get left(){throw Ce()}get right(){throw Ce()}copy(e,t,r,s,i){return this}insert(e,t,r){return new On(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e){this.comparator=e,this.data=new Ot(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vy(this.data.getIterator())}getIteratorFrom(e){return new Vy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Rt)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Rt(this.comparator);return t.data=e,t}}class Vy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function wa(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e){this.fields=e,e.sort(Bt.comparator)}static empty(){return new ir([])}unionWith(e){let t=new Rt(Bt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new ir(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ha(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DB(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new xw("Invalid base64 string: "+i):i}}(e);return new en(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new en(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ge(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}en.EMPTY_BYTE_STRING=new en("");const mC=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fs(n){if(Ne(!!n),typeof n=="string"){let e=0;const t=mC.exec(n);if(Ne(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:jt(n.seconds),nanos:jt(n.nanos)}}function jt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function $s(n){return typeof n=="string"?en.fromBase64String(n):en.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Ih(n){const e=n.mapValue.fields.__previous_value__;return wh(e)?Ih(e):e}function Lu(n){const e=Fs(n.mapValue.fields.__local_write_time__.timestampValue);return new Gt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(e,t,r,s,i,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Uo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Uo("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Uo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ei={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},hd={nullValue:"NULL_VALUE"};function Ni(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?wh(n)?4:Tw(n)?9007199254740991:Eh(n)?10:11:Ce()}function hs(n,e){if(n===e)return!0;const t=Ni(n);if(t!==Ni(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lu(n).isEqual(Lu(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Fs(s.timestampValue),a=Fs(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return $s(s.bytesValue).isEqual($s(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return jt(s.geoPointValue.latitude)===jt(i.geoPointValue.latitude)&&jt(s.geoPointValue.longitude)===jt(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return jt(s.integerValue)===jt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=jt(s.doubleValue),a=jt(i.doubleValue);return o===a?Mu(o)===Mu(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Ha(n.arrayValue.values||[],e.arrayValue.values||[],hs);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Ny(o)!==Ny(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!hs(o[l],a[l])))return!1;return!0}(n,e);default:return Ce()}}function Fu(n,e){return(n.values||[]).find(t=>hs(t,e))!==void 0}function Vi(n,e){if(n===e)return 0;const t=Ni(n),r=Ni(e);if(t!==r)return Ge(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ge(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=jt(i.integerValue||i.doubleValue),l=jt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Oy(n.timestampValue,e.timestampValue);case 4:return Oy(Lu(n),Lu(e));case 5:return Ge(n.stringValue,e.stringValue);case 6:return function(i,o){const a=$s(i),l=$s(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const d=Ge(a[c],l[c]);if(d!==0)return d}return Ge(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ge(jt(i.latitude),jt(o.latitude));return a!==0?a:Ge(jt(i.longitude),jt(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return My(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,l,c,d;const f=i.fields||{},g=o.fields||{},y=(a=f.value)===null||a===void 0?void 0:a.arrayValue,E=(l=g.value)===null||l===void 0?void 0:l.arrayValue,A=Ge(((c=y==null?void 0:y.values)===null||c===void 0?void 0:c.length)||0,((d=E==null?void 0:E.values)===null||d===void 0?void 0:d.length)||0);return A!==0?A:My(y,E)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ei.mapValue&&o===Ei.mapValue)return 0;if(i===Ei.mapValue)return 1;if(o===Ei.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){const g=Ge(l[f],d[f]);if(g!==0)return g;const y=Vi(a[l[f]],c[d[f]]);if(y!==0)return y}return Ge(l.length,d.length)}(n.mapValue,e.mapValue);default:throw Ce()}}function Oy(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ge(n,e);const t=Fs(n),r=Fs(e),s=Ge(t.seconds,r.seconds);return s!==0?s:Ge(t.nanos,r.nanos)}function My(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Vi(t[s],r[s]);if(i)return i}return Ge(t.length,r.length)}function Ja(n){return wp(n)}function wp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Fs(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return $s(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=wp(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${wp(t.fields[o])}`;return s+"}"}(n.mapValue):Ce()}function fd(n){switch(Ni(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ih(n);return e?16+fd(e):16;case 5:return 2*n.stringValue.length;case 6:return $s(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+fd(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return zi(r.fields,(i,o)=>{s+=i.length+fd(o)}),s}(n.mapValue);default:throw Ce()}}function jo(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ip(n){return!!n&&"integerValue"in n}function $u(n){return!!n&&"arrayValue"in n}function Ly(n){return!!n&&"nullValue"in n}function Fy(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function pd(n){return!!n&&"mapValue"in n}function Eh(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function wu(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return zi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=wu(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wu(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Tw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Aw={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function vC(n){return"nullValue"in n?hd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?jo(Uo.empty(),Re.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Eh(n)?Aw:{mapValue:{}}:Ce()}function yC(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?jo(Uo.empty(),Re.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Aw:"mapValue"in n?Eh(n)?{mapValue:{}}:Ei:Ce()}function $y(n,e){const t=Vi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Uy(n,e){const t=Vi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.value=e}static empty(){return new Ln({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!pd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wu(t)}setAll(e){let t=Bt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=wu(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());pd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return hs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];pd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){zi(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Ln(wu(this.value))}}function Sw(n){const e=[];return zi(n.fields,(t,r)=>{const s=new Bt([t]);if(pd(r)){const i=Sw(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new ir(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Mt(e,0,$e.min(),$e.min(),$e.min(),Ln.empty(),0)}static newFoundDocument(e,t,r,s){return new Mt(e,1,t,$e.min(),r,s,0)}static newNoDocument(e,t){return new Mt(e,2,t,$e.min(),$e.min(),Ln.empty(),0)}static newUnknownDocument(e,t){return new Mt(e,3,t,$e.min(),$e.min(),Ln.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ln.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ln.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t){this.position=e,this.inclusive=t}}function jy(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=Re.comparator(Re.fromName(o.referenceValue),t.key):r=Vi(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function By(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!hs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(e,t="asc"){this.field=e,this.dir=t}}function _C(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pw{}class at extends Pw{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new bC(e,t,r):t==="array-contains"?new EC(e,r):t==="in"?new Vw(e,r):t==="not-in"?new xC(e,r):t==="array-contains-any"?new TC(e,r):new at(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new wC(e,r):new IC(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Vi(t,this.value)):t!==null&&Ni(this.value)===Ni(t)&&this.matchesComparison(Vi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ce()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class At extends Pw{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new At(e,t)}matches(e){return Ya(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Ya(n){return n.op==="and"}function Ep(n){return n.op==="or"}function Am(n){return Rw(n)&&Ya(n)}function Rw(n){for(const e of n.filters)if(e instanceof At)return!1;return!0}function xp(n){if(n instanceof at)return n.field.canonicalString()+n.op.toString()+Ja(n.value);if(Am(n))return n.filters.map(e=>xp(e)).join(",");{const e=n.filters.map(t=>xp(t)).join(",");return`${n.op}(${e})`}}function Cw(n,e){return n instanceof at?function(r,s){return s instanceof at&&r.op===s.op&&r.field.isEqual(s.field)&&hs(r.value,s.value)}(n,e):n instanceof At?function(r,s){return s instanceof At&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Cw(o,s.filters[a]),!0):!1}(n,e):void Ce()}function kw(n,e){const t=n.filters.concat(e);return At.create(t,n.op)}function Dw(n){return n instanceof at?function(t){return`${t.field.canonicalString()} ${t.op} ${Ja(t.value)}`}(n):n instanceof At?function(t){return t.op.toString()+" {"+t.getFilters().map(Dw).join(" ,")+"}"}(n):"Filter"}class bC extends at{constructor(e,t,r){super(e,t,r),this.key=Re.fromName(r.referenceValue)}matches(e){const t=Re.comparator(e.key,this.key);return this.matchesComparison(t)}}class wC extends at{constructor(e,t){super(e,"in",t),this.keys=Nw("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class IC extends at{constructor(e,t){super(e,"not-in",t),this.keys=Nw("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Nw(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Re.fromName(r.referenceValue))}class EC extends at{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return $u(t)&&Fu(t.arrayValue,this.value)}}class Vw extends at{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Fu(this.value.arrayValue,t)}}class xC extends at{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Fu(this.value.arrayValue,t)}}class TC extends at{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$u(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Fu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ue=null}}function Tp(n,e=null,t=[],r=[],s=null,i=null,o=null){return new AC(n,e,t,r,s,i,o)}function Bo(n){const e=Ae(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>xp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),ic(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ja(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ja(r)).join(",")),e.ue=t}return e.ue}function oc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!_C(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Cw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!By(n.startAt,e.startAt)&&By(n.endAt,e.endAt)}function Fd(n){return Re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function $d(n,e){return n.filters.filter(t=>t instanceof at&&t.field.isEqual(e))}function qy(n,e,t){let r=hd,s=!0;for(const i of $d(n,e)){let o=hd,a=!0;switch(i.op){case"<":case"<=":o=vC(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=hd}$y({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];$y({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}function zy(n,e,t){let r=Ei,s=!0;for(const i of $d(n,e)){let o=Ei,a=!0;switch(i.op){case">=":case">":o=yC(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ei}Uy({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(t!==null){for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Uy({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ow(n,e,t,r,s,i,o,a){return new zs(n,e,t,r,s,i,o,a)}function gl(n){return new zs(n)}function Ky(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sm(n){return n.collectionGroup!==null}function La(n){const e=Ae(n);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Rt(Bt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new Uu(i,r))}),t.has(Bt.keyField().canonicalString())||e.ce.push(new Uu(Bt.keyField(),r))}return e.ce}function Hn(n){const e=Ae(n);return e.le||(e.le=Lw(e,La(n))),e.le}function Mw(n){const e=Ae(n);return e.he||(e.he=Lw(e,n.explicitOrderBy)),e.he}function Lw(n,e){if(n.limitType==="F")return Tp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Uu(s.field,i)});const t=n.endAt?new Oi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Oi(n.startAt.position,n.startAt.inclusive):null;return Tp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Ap(n,e){const t=n.filters.concat([e]);return new zs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ud(n,e,t){return new zs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ac(n,e){return oc(Hn(n),Hn(e))&&n.limitType===e.limitType}function Fw(n){return`${Bo(Hn(n))}|lt:${n.limitType}`}function Pa(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Dw(s)).join(", ")}]`),ic(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Ja(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Ja(s)).join(",")),`Target(${r})`}(Hn(n))}; limitType=${n.limitType})`}function lc(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):Re.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of La(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=jy(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,La(r),s)||r.endAt&&!function(o,a,l){const c=jy(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,La(r),s))}(n,e)}function $w(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Uw(n){return(e,t)=>{let r=!1;for(const s of La(n)){const i=SC(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function SC(n,e,t){const r=n.field.isKeyField()?Re.comparator(e.key,t.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Vi(l,c):Ce()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ce()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){zi(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return Ew(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PC=new Ot(Re.comparator);function or(){return PC}const jw=new Ot(Re.comparator);function iu(...n){let e=jw;for(const t of n)e=e.insert(t.key,t);return e}function Bw(n){let e=jw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function rs(){return Iu()}function qw(){return Iu()}function Iu(){return new Ks(n=>n.toString(),(n,e)=>n.isEqual(e))}const RC=new Ot(Re.comparator),CC=new Rt(Re.comparator);function Xe(...n){let e=CC;for(const t of n)e=e.add(t);return e}const kC=new Rt(Ge);function Pm(){return kC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mu(e)?"-0":e}}function zw(n){return{integerValue:""+n}}function Kw(n,e){return vw(e)?zw(e):Rm(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(){this._=void 0}}function DC(n,e,t){return n instanceof Xa?function(s,i){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&wh(i)&&(i=Ih(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(t,e):n instanceof qo?Hw(n,e):n instanceof zo?Ww(n,e):function(s,i){const o=Gw(s,i),a=Gy(o)+Gy(s.Pe);return Ip(o)&&Ip(s.Pe)?zw(a):Rm(s.serializer,a)}(n,e)}function NC(n,e,t){return n instanceof qo?Hw(n,e):n instanceof zo?Ww(n,e):t}function Gw(n,e){return n instanceof Za?function(r){return Ip(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Xa extends xh{}class qo extends xh{constructor(e){super(),this.elements=e}}function Hw(n,e){const t=Qw(e);for(const r of n.elements)t.some(s=>hs(s,r))||t.push(r);return{arrayValue:{values:t}}}class zo extends xh{constructor(e){super(),this.elements=e}}function Ww(n,e){let t=Qw(e);for(const r of n.elements)t=t.filter(s=>!hs(s,r));return{arrayValue:{values:t}}}class Za extends xh{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Gy(n){return jt(n.integerValue||n.doubleValue)}function Qw(n){return $u(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(e,t){this.field=e,this.transform=t}}function VC(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof qo&&s instanceof qo||r instanceof zo&&s instanceof zo?Ha(r.elements,s.elements,hs):r instanceof Za&&s instanceof Za?hs(r.Pe,s.Pe):r instanceof Xa&&s instanceof Xa}(n.transform,e.transform)}class OC{constructor(e,t){this.version=e,this.transformResults=t}}class qt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qt}static exists(e){return new qt(void 0,e)}static updateTime(e){return new qt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function md(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Th{}function Jw(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new yl(n.key,qt.none()):new vl(n.key,n.data,qt.none());{const t=n.data,r=Ln.empty();let s=new Rt(Bt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Gs(n.key,r,new ir(s.toArray()),qt.none())}}function MC(n,e,t){n instanceof vl?function(s,i,o){const a=s.value.clone(),l=Wy(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Gs?function(s,i,o){if(!md(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Wy(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(Yw(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Eu(n,e,t,r){return n instanceof vl?function(i,o,a,l){if(!md(i.precondition,o))return a;const c=i.value.clone(),d=Qy(i.fieldTransforms,l,o);return c.setAll(d),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof Gs?function(i,o,a,l){if(!md(i.precondition,o))return a;const c=Qy(i.fieldTransforms,l,o),d=o.data;return d.setAll(Yw(i)),d.setAll(c),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(i,o,a){return md(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function LC(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Gw(r.transform,s||null);i!=null&&(t===null&&(t=Ln.empty()),t.set(r.field,i))}return t||null}function Hy(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ha(r,s,(i,o)=>VC(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class vl extends Th{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Gs extends Th{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Yw(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Wy(n,e,t){const r=new Map;Ne(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,NC(o,a,t[s]))}return r}function Qy(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,DC(i,o,e))}return r}class yl extends Th{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Cm extends Th{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&MC(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Eu(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Eu(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=qw();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const l=Jw(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument($e.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Xe())}isEqual(e){return this.batchId===e.batchId&&Ha(this.mutations,e.mutations,(t,r)=>Hy(t,r))&&Ha(this.baseMutations,e.baseMutations,(t,r)=>Hy(t,r))}}class Dm{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){Ne(e.mutations.length===r.length);let s=function(){return RC}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Dm(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fn,dt;function Zw(n){switch(n){default:return Ce();case Y.CANCELLED:case Y.UNKNOWN:case Y.DEADLINE_EXCEEDED:case Y.RESOURCE_EXHAUSTED:case Y.INTERNAL:case Y.UNAVAILABLE:case Y.UNAUTHENTICATED:return!1;case Y.INVALID_ARGUMENT:case Y.NOT_FOUND:case Y.ALREADY_EXISTS:case Y.PERMISSION_DENIED:case Y.FAILED_PRECONDITION:case Y.ABORTED:case Y.OUT_OF_RANGE:case Y.UNIMPLEMENTED:case Y.DATA_LOSS:return!0}}function eI(n){if(n===void 0)return an("GRPC error has no .code"),Y.UNKNOWN;switch(n){case fn.OK:return Y.OK;case fn.CANCELLED:return Y.CANCELLED;case fn.UNKNOWN:return Y.UNKNOWN;case fn.DEADLINE_EXCEEDED:return Y.DEADLINE_EXCEEDED;case fn.RESOURCE_EXHAUSTED:return Y.RESOURCE_EXHAUSTED;case fn.INTERNAL:return Y.INTERNAL;case fn.UNAVAILABLE:return Y.UNAVAILABLE;case fn.UNAUTHENTICATED:return Y.UNAUTHENTICATED;case fn.INVALID_ARGUMENT:return Y.INVALID_ARGUMENT;case fn.NOT_FOUND:return Y.NOT_FOUND;case fn.ALREADY_EXISTS:return Y.ALREADY_EXISTS;case fn.PERMISSION_DENIED:return Y.PERMISSION_DENIED;case fn.FAILED_PRECONDITION:return Y.FAILED_PRECONDITION;case fn.ABORTED:return Y.ABORTED;case fn.OUT_OF_RANGE:return Y.OUT_OF_RANGE;case fn.UNIMPLEMENTED:return Y.UNIMPLEMENTED;case fn.DATA_LOSS:return Y.DATA_LOSS;default:return Ce()}}(dt=fn||(fn={}))[dt.OK=0]="OK",dt[dt.CANCELLED=1]="CANCELLED",dt[dt.UNKNOWN=2]="UNKNOWN",dt[dt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",dt[dt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",dt[dt.NOT_FOUND=5]="NOT_FOUND",dt[dt.ALREADY_EXISTS=6]="ALREADY_EXISTS",dt[dt.PERMISSION_DENIED=7]="PERMISSION_DENIED",dt[dt.UNAUTHENTICATED=16]="UNAUTHENTICATED",dt[dt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",dt[dt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",dt[dt.ABORTED=10]="ABORTED",dt[dt.OUT_OF_RANGE=11]="OUT_OF_RANGE",dt[dt.UNIMPLEMENTED=12]="UNIMPLEMENTED",dt[dt.INTERNAL=13]="INTERNAL",dt[dt.UNAVAILABLE=14]="UNAVAILABLE",dt[dt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tI(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C=new Mo([4294967295,4294967295],0);function Jy(n){const e=tI().encode(n),t=new nw;return t.update(e),new Uint8Array(t.digest())}function Yy(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Mo([t,r],0),new Mo([s,i],0)]}class Vm{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ou(`Invalid padding: ${t}`);if(r<0)throw new ou(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ou(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ou(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Mo.fromNumber(this.Ie)}Ee(e,t,r){let s=e.add(t.multiply(Mo.fromNumber(r)));return s.compare($C)===1&&(s=new Mo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Jy(e),[r,s]=Yy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);if(!this.de(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Vm(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=Jy(e),[r,s]=Yy(t);for(let i=0;i<this.hashCount;i++){const o=this.Ee(r,s,i);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ou extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,dc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new cc($e.min(),s,new Ot(Ge),or(),Xe())}}class dc{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new dc(r,t,Xe(),Xe(),Xe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gd{constructor(e,t,r,s){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=s}}class nI{constructor(e,t){this.targetId=e,this.me=t}}class rI{constructor(e,t,r=en.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Xy{constructor(){this.fe=0,this.ge=e0(),this.pe=en.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Xe(),t=Xe(),r=Xe();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:Ce()}}),new dc(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=e0()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ne(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class UC{constructor(e){this.Le=e,this.Be=new Map,this.ke=or(),this.qe=Zy(),this.Qe=new Ot(Ge)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ce()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,r=e.me.count,s=this.Je(t);if(s){const i=s.target;if(Fd(i))if(r===0){const o=new Re(i.path);this.Ue(t,o,Mt.newNoDocument(o,$e.min()))}else Ne(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}jd==null||jd.et(function(d,f,g,y,E){var A,R,B,q,F,z;const de={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},me=f.unchangedNames;return me&&(de.bloomFilter={applied:E===0,hashCount:(A=me==null?void 0:me.hashCount)!==null&&A!==void 0?A:0,bitmapLength:(q=(B=(R=me==null?void 0:me.bits)===null||R===void 0?void 0:R.bitmap)===null||B===void 0?void 0:B.length)!==null&&q!==void 0?q:0,padding:(z=(F=me==null?void 0:me.bits)===null||F===void 0?void 0:F.padding)!==null&&z!==void 0?z:0,mightContain:T=>{var w;return(w=y==null?void 0:y.mightContain(T))!==null&&w!==void 0&&w}}),de}(o,e.me,this.Le.tt(),a,l))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=$s(r).toUint8Array()}catch(l){if(l instanceof xw)return Rr("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Vm(o,s,i)}catch(l){return Rr(l instanceof ou?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,o)=>{const a=this.Je(o);if(a){if(i.current&&Fd(a.target)){const l=new Re(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Mt.newNoDocument(l,e))}i.be&&(t.set(o,i.ve()),i.Ce())}});let r=Xe();this.qe.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.ke.forEach((i,o)=>o.setReadTime(e));const s=new cc(e,t,this.Qe,this.ke,r);return this.ke=or(),this.qe=Zy(),this.Qe=new Ot(Ge),s}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Xy,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Rt(Ge),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||fe("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Xy),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Zy(){return new Ot(Re.comparator)}function e0(){return new Ot(Re.comparator)}const jC=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),BC=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),qC=(()=>({and:"AND",or:"OR"}))();class zC{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Sp(n,e){return n.useProto3Json||ic(e)?e:{value:e}}function el(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function sI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function KC(n,e){return el(n,e.toTimestamp())}function un(n){return Ne(!!n),$e.fromTimestamp(function(t){const r=Fs(t);return new Gt(r.seconds,r.nanos)}(n))}function Om(n,e){return Pp(n,e).canonicalString()}function Pp(n,e){const t=function(s){return new ot(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function iI(n){const e=ot.fromString(n);return Ne(mI(e)),e}function ju(n,e){return Om(n.databaseId,e.path)}function as(n,e){const t=iI(e);if(t.get(1)!==n.databaseId.projectId)throw new pe(Y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new pe(Y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Re(lI(t))}function oI(n,e){return Om(n.databaseId,e)}function aI(n){const e=iI(n);return e.length===4?ot.emptyPath():lI(e)}function Rp(n){return new ot(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function lI(n){return Ne(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function t0(n,e,t){return{name:ju(n,e),fields:t.value.mapValue.fields}}function uI(n,e,t){const r=as(n,e.name),s=un(e.updateTime),i=e.createTime?un(e.createTime):$e.min(),o=new Ln({mapValue:{fields:e.fields}}),a=Mt.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function GC(n,e){return"found"in e?function(r,s){Ne(!!s.found),s.found.name,s.found.updateTime;const i=as(r,s.found.name),o=un(s.found.updateTime),a=s.found.createTime?un(s.found.createTime):$e.min(),l=new Ln({mapValue:{fields:s.found.fields}});return Mt.newFoundDocument(i,o,a,l)}(n,e):"missing"in e?function(r,s){Ne(!!s.missing),Ne(!!s.readTime);const i=as(r,s.missing),o=un(s.readTime);return Mt.newNoDocument(i,o)}(n,e):Ce()}function HC(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ce()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,d){return c.useProto3Json?(Ne(d===void 0||typeof d=="string"),en.fromBase64String(d||"")):(Ne(d===void 0||d instanceof Buffer||d instanceof Uint8Array),en.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const d=c.code===void 0?Y.UNKNOWN:eI(c.code);return new pe(d,c.message||"")}(o);t=new rI(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=as(n,r.document.name),i=un(r.document.updateTime),o=r.document.createTime?un(r.document.createTime):$e.min(),a=new Ln({mapValue:{fields:r.document.fields}}),l=Mt.newFoundDocument(s,i,o,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new gd(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=as(n,r.document),i=r.readTime?un(r.readTime):$e.min(),o=Mt.newNoDocument(s,i),a=r.removedTargetIds||[];t=new gd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=as(n,r.document),i=r.removedTargetIds||[];t=new gd([],i,s,null)}else{if(!("filter"in e))return Ce();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new FC(s,i),a=r.targetId;t=new nI(a,o)}}return t}function Bu(n,e){let t;if(e instanceof vl)t={update:t0(n,e.key,e.value)};else if(e instanceof yl)t={delete:ju(n,e.key)};else if(e instanceof Gs)t={update:t0(n,e.key,e.data),updateMask:ZC(e.fieldMask)};else{if(!(e instanceof Cm))return Ce();t={verify:ju(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Xa)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof qo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof zo)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Za)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ce()}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:KC(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ce()}(n,e.precondition)),t}function Cp(n,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?qt.updateTime(un(i.updateTime)):i.exists!==void 0?qt.exists(i.exists):qt.none()}(e.currentDocument):qt.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)Ne(a.setToServerValue==="REQUEST_TIME"),l=new Xa;else if("appendMissingElements"in a){const d=a.appendMissingElements.values||[];l=new qo(d)}else if("removeAllFromArray"in a){const d=a.removeAllFromArray.values||[];l=new zo(d)}else"increment"in a?l=new Za(o,a.increment):Ce();const c=Bt.fromServerFormat(a.fieldPath);return new uc(c,l)}(n,s)):[];if(e.update){e.update.name;const s=as(n,e.update.name),i=new Ln({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new ir(c.map(d=>Bt.fromServerFormat(d)))}(e.updateMask);return new Gs(s,i,o,t,r)}return new vl(s,i,t,r)}if(e.delete){const s=as(n,e.delete);return new yl(s,t)}if(e.verify){const s=as(n,e.verify);return new Cm(s,t)}return Ce()}function WC(n,e){return n&&n.length>0?(Ne(e!==void 0),n.map(t=>function(s,i){let o=s.updateTime?un(s.updateTime):un(i);return o.isEqual($e.min())&&(o=un(i)),new OC(o,s.transformResults||[])}(t,e))):[]}function cI(n,e){return{documents:[oI(n,e.path)]}}function Ah(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=oI(n,s);const i=function(c){if(c.length!==0)return pI(At.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:mi(g.field),direction:JC(g.dir)}}(d))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=Sp(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:s}}function dI(n,e,t,r){const{_t:s,parent:i}=Ah(n,e),o={},a=[];let l=0;return t.forEach(c=>{const d=r?c.alias:"aggregate_"+l++;o[d]=c.alias,c.aggregateType==="count"?a.push({alias:d,count:{}}):c.aggregateType==="avg"?a.push({alias:d,avg:{field:mi(c.fieldPath)}}):c.aggregateType==="sum"&&a.push({alias:d,sum:{field:mi(c.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},ut:o,parent:i}}function hI(n){let e=aI(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Ne(r===1);const d=t.from[0];d.allDescendants?s=d.collectionId:e=e.child(d.collectionId)}let i=[];t.where&&(i=function(f){const g=fI(f);return g instanceof At&&Am(g)?g.getFilters():[g]}(t.where));let o=[];t.orderBy&&(o=function(f){return f.map(g=>function(E){return new Uu(Ra(E.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,ic(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){const g=!!f.before,y=f.values||[];return new Oi(y,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){const g=!f.before,y=f.values||[];return new Oi(y,g)}(t.endAt)),Ow(e,s,o,i,a,"F",l,c)}function QC(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ce()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function fI(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Ra(t.unaryFilter.field);return at.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ra(t.unaryFilter.field);return at.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ra(t.unaryFilter.field);return at.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ra(t.unaryFilter.field);return at.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ce()}}(n):n.fieldFilter!==void 0?function(t){return at.create(Ra(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ce()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return At.create(t.compositeFilter.filters.map(r=>fI(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ce()}}(t.compositeFilter.op))}(n):Ce()}function JC(n){return jC[n]}function YC(n){return BC[n]}function XC(n){return qC[n]}function mi(n){return{fieldPath:n.canonicalString()}}function Ra(n){return Bt.fromServerFormat(n.fieldPath)}function pI(n){return n instanceof at?function(t){if(t.op==="=="){if(Fy(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NAN"}};if(Ly(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Fy(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NAN"}};if(Ly(t.value))return{unaryFilter:{field:mi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:mi(t.field),op:YC(t.op),value:t.value}}}(n):n instanceof At?function(t){const r=t.getFilters().map(s=>pI(s));return r.length===1?r[0]:{compositeFilter:{op:XC(t.op),filters:r}}}(n):Ce()}function ZC(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function mI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{constructor(e,t,r,s,i=$e.min(),o=$e.min(),a=en.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Ps(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ps(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gI{constructor(e){this.ct=e}}function ek(n,e){let t;if(e.document)t=uI(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Re.fromSegments(e.noDocument.path),s=Go(e.noDocument.readTime);t=Mt.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ce();{const r=Re.fromSegments(e.unknownDocument.path),s=Go(e.unknownDocument.version);t=Mt.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(s){const i=new Gt(s[0],s[1]);return $e.fromTimestamp(i)}(e.readTime)),t}function n0(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Bd(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:ju(i,o.key),fields:o.data.value.mapValue.fields,updateTime:el(i,o.version.toTimestamp()),createTime:el(i,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Ko(e.version)};else{if(!e.isUnknownDocument())return Ce();r.unknownDocument={path:t.path.toArray(),version:Ko(e.version)}}return r}function Bd(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Ko(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Go(n){const e=new Gt(n.seconds,n.nanoseconds);return $e.fromTimestamp(e)}function Po(n,e){const t=(e.baseMutations||[]).map(i=>Cp(n.ct,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Cp(n.ct,i)),s=Gt.fromMillis(e.localWriteTimeMs);return new km(e.batchId,s,t,r)}function au(n){const e=Go(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Go(n.lastLimboFreeSnapshotVersion):$e.min();let r;return r=function(i){return i.documents!==void 0}(n.query)?function(i){return Ne(i.documents.length===1),Hn(gl(aI(i.documents[0])))}(n.query):function(i){return Hn(hI(i))}(n.query),new Ps(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,en.fromBase64String(n.resumeToken))}function vI(n,e){const t=Ko(e.snapshotVersion),r=Ko(e.lastLimboFreeSnapshotVersion);let s;s=Fd(e.target)?cI(n.ct,e.target):Ah(n.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Bo(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Mm(n){const e=hI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ud(e,e.limit,"L"):e}function Lf(n,e){return new Nm(e.largestBatchId,Cp(n.ct,e.overlayMutation))}function r0(n,e){const t=e.path.lastSegment();return[n,Gn(e.path.popLast()),t]}function s0(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Ko(r.readTime),documentKey:Gn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tk{getBundleMetadata(e,t){return i0(e).get(t).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Go(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,t){return i0(e).put(function(s){return{bundleId:s.id,createTime:Ko(un(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return o0(e).get(t).next(r=>{if(r)return function(i){return{name:i.name,query:Mm(i.bundledQuery),readTime:Go(i.readTime)}}(r)})}saveNamedQuery(e,t){return o0(e).put(function(s){return{name:s.name,readTime:Ko(un(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function i0(n){return bn(n,"bundles")}function o0(n){return bn(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sh{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new Sh(e,r)}getOverlay(e,t){return Wl(e).get(r0(this.userId,t)).next(r=>r?Lf(this.serializer,r):null)}getOverlays(e,t){const r=rs();return G.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Nm(t,o);s.push(this.ht(e,a))}),G.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Gn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Wl(e).j("collectionPathOverlayIndex",a))}),G.waitFor(i)}getOverlaysForCollection(e,t,r){const s=rs(),i=Gn(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Wl(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=Lf(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=rs();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Wl(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{const f=Lf(this.serializer,c);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):d.done()}).next(()=>i)}ht(e,t){return Wl(e).put(function(s,i,o){const[a,l,c]=r0(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Bu(s.ct,o.mutation)}}(this.serializer,this.userId,t))}}function Wl(n){return bn(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{Pt(e){return bn(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?en.fromUint8Array(r):en.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(jt(e.integerValue));else if("doubleValue"in e){const r=jt(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),Mu(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Fs(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt($s(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?Tw(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Eh(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ce()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const s of Object.keys(r))this.Vt(s,t),this.Tt(r[s],t)}wt(e,t){var r,s;const i=e.fields||{};this.dt(t,53);const o="value",a=((s=(r=i[o].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(jt(a)),this.Vt(o,t),this.Tt(i[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const s of r)this.Tt(s,t)}yt(e,t){this.dt(t,37),Re.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Ro.vt=new Ro;function rk(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function a0(n){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=rk(255&r[i]);if(s+=o,o!==8)break}return s}(n);return Math.ceil(e/8)}class sk{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),r=a0(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),r=a0(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class ik{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class ok{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Ql{constructor(){this.jt=new sk,this.Ht=new ik(this.jt),this.Jt=new ok(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Co(this.indexId,this.documentKey,this.arrayValue,r)}}function li(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=l0(n.arrayValue,e.arrayValue),t!==0?t:(t=l0(n.directionalValue,e.directionalValue),t!==0?t:Re.comparator(n.documentKey,e.documentKey)))}function l0(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(e){this.Xt=new Rt((t,r)=>Bt.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(Ne(e.collectionGroup===this.collectionId),this.nn)return!1;const t=_p(e);if(t!==void 0&&!this.sn(t))return!1;const r=xo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.sn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new Rt(Bt.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Lo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Lo(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Lo(r.field,r.dir==="asc"?0:1)));return new Wa(Wa.UNKNOWN_ID,this.collectionId,t,Qa.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(n){var e,t;if(Ne(n instanceof at||n instanceof At),n instanceof at){if(n instanceof Vw){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>at.create(n.field,"==",i)))||[];return At.create(s,"or")}return n}const r=n.filters.map(s=>yI(s));return At.create(r,n.op)}function ak(n){if(n.getFilters().length===0)return[];const e=Np(yI(n));return Ne(_I(e)),kp(e)||Dp(e)?[e]:e.getFilters()}function kp(n){return n instanceof at}function Dp(n){return n instanceof At&&Am(n)}function _I(n){return kp(n)||Dp(n)||function(t){if(t instanceof At&&Ep(t)){for(const r of t.getFilters())if(!kp(r)&&!Dp(r))return!1;return!0}return!1}(n)}function Np(n){if(Ne(n instanceof at||n instanceof At),n instanceof at)return n;if(n.filters.length===1)return Np(n.filters[0]);const e=n.filters.map(r=>Np(r));let t=At.create(e,n.op);return t=qd(t),_I(t)?t:(Ne(t instanceof At),Ne(Ya(t)),Ne(t.filters.length>1),t.filters.reduce((r,s)=>Lm(r,s)))}function Lm(n,e){let t;return Ne(n instanceof at||n instanceof At),Ne(e instanceof at||e instanceof At),t=n instanceof at?e instanceof at?function(s,i){return At.create([s,i],"and")}(n,e):c0(n,e):e instanceof at?c0(e,n):function(s,i){if(Ne(s.filters.length>0&&i.filters.length>0),Ya(s)&&Ya(i))return kw(s,i.getFilters());const o=Ep(s)?s:i,a=Ep(s)?i:s,l=o.filters.map(c=>Lm(c,a));return At.create(l,"or")}(n,e),qd(t)}function c0(n,e){if(Ya(e))return kw(e,n.getFilters());{const t=e.filters.map(r=>Lm(n,r));return At.create(t,"or")}}function qd(n){if(Ne(n instanceof at||n instanceof At),n instanceof at)return n;const e=n.getFilters();if(e.length===1)return qd(e[0]);if(Rw(n))return n;const t=e.map(s=>qd(s)),r=[];return t.forEach(s=>{s instanceof at?r.push(s):s instanceof At&&(s.op===n.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:At.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lk{constructor(){this.un=new Fm}addToCollectionParentIndex(e,t){return this.un.add(t),G.resolve()}getCollectionParents(e,t){return G.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return G.resolve()}deleteFieldIndex(e,t){return G.resolve()}deleteAllFieldIndexes(e){return G.resolve()}createTargetIndexes(e,t){return G.resolve()}getDocumentsMatchingTarget(e,t){return G.resolve(null)}getIndexType(e,t){return G.resolve(0)}getFieldIndexes(e,t){return G.resolve([])}getNextCollectionGroupToUpdate(e){return G.resolve(null)}getMinOffset(e,t){return G.resolve(yr.min())}getMinOffsetFromCollectionGroup(e,t){return G.resolve(yr.min())}updateCollectionGroup(e,t,r){return G.resolve()}updateIndexEntries(e,t){return G.resolve()}}class Fm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Rt(ot.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Rt(ot.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jc=new Uint8Array(0);class uk{constructor(e,t){this.databaseId=t,this.cn=new Fm,this.ln=new Ks(r=>Bo(r),(r,s)=>oc(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:r,parent:Gn(s)};return d0(e).put(i)}return G.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[dw(t),""],!1,!0);return d0(e).U(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(ns(o.parent))}return r})}addFieldIndex(e,t){const r=Jl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete s.indexId;const i=r.add(s);if(t.indexState){const o=Ea(e);return i.next(a=>{o.put(s0(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Jl(e),s=Ea(e),i=Ia(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=Jl(e),r=Ia(e),s=Ea(e);return t.j().next(()=>r.j()).next(()=>s.j())}createTargetIndexes(e,t){return G.forEach(this.hn(t),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new u0(r).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const r=Ia(e);let s=!0;const i=new Map;return G.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Xe();const a=[];return G.forEach(i,(l,c)=>{fe("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`}(l)} to execute ${Bo(t)}`);const d=function(F,z){const de=_p(z);if(de===void 0)return null;for(const me of $d(F,de.fieldPath))switch(me.op){case"array-contains-any":return me.value.arrayValue.values||[];case"array-contains":return[me.value]}return null}(c,l),f=function(F,z){const de=new Map;for(const me of xo(z))for(const T of $d(F,me.fieldPath))switch(T.op){case"==":case"in":de.set(me.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return de.set(me.fieldPath.canonicalString(),T.value),Array.from(de.values())}return null}(c,l),g=function(F,z){const de=[];let me=!0;for(const T of xo(z)){const w=T.kind===0?qy(F,T.fieldPath,F.startAt):zy(F,T.fieldPath,F.startAt);de.push(w.value),me&&(me=w.inclusive)}return new Oi(de,me)}(c,l),y=function(F,z){const de=[];let me=!0;for(const T of xo(z)){const w=T.kind===0?zy(F,T.fieldPath,F.endAt):qy(F,T.fieldPath,F.endAt);de.push(w.value),me&&(me=w.inclusive)}return new Oi(de,me)}(c,l),E=this.In(l,c,g),A=this.In(l,c,y),R=this.Tn(l,c,f),B=this.En(l.indexId,d,E,g.inclusive,A,y.inclusive,R);return G.forEach(B,q=>r.G(q,t.limit).next(F=>{F.forEach(z=>{const de=Re.fromSegments(z.documentKey);o.has(de)||(o=o.add(de),a.push(de))})}))}).next(()=>a)}return G.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=ak(At.create(e.filters,"and")).map(r=>Tp(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,s,i,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,i.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){const g=t?this.dn(t[f/c]):Jc,y=this.An(e,g,r[f%c],s),E=this.Rn(e,g,i[f%c],o),A=a.map(R=>this.An(e,g,R,!0));d.push(...this.createRange(y,E,A))}return d}An(e,t,r,s){const i=new Co(e,Re.empty(),t,r);return s?i:i.Zt()}Rn(e,t,r,s){const i=new Co(e,Re.empty(),t,r);return s?i.Zt():i}Pn(e,t){const r=new u0(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.hn(t);return G.forEach(s,i=>this.Pn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Rt(Bt.comparator),d=!1;for(const f of l.filters)for(const g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(const f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&s.length>1&&r===2?1:r)}Vn(e,t){const r=new Ql;for(const s of xo(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const o=r.Yt(s.kind);Ro.vt.It(i,o)}return r.zt()}dn(e){const t=new Ql;return Ro.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new Ql;return Ro.vt.It(jo(this.databaseId,t),r.Yt(function(i){const o=xo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let s=[];s.push(new Ql);let i=0;for(const o of xo(e)){const a=r[i++];for(const l of s)if(this.fn(t,o.fieldPath)&&$u(a))s=this.gn(s,o,a);else{const c=l.Yt(o.kind);Ro.vt.It(a,c)}}return this.pn(s)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Ql;l.seed(a.zt()),Ro.vt.It(o,l.Yt(t.kind)),i.push(l)}return i}fn(e,t){return!!e.filters.find(r=>r instanceof at&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=Jl(e),s=Ea(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(i=>{const o=[];return G.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(d,f){const g=f?new Qa(f.sequenceNumber,new yr(Go(f.readTime),new Re(ns(f.documentKey)),f.largestBatchId)):Qa.empty(),y=d.fields.map(([E,A])=>new Lo(Bt.fromServerFormat(E),A));return new Wa(d.indexId,d.collectionGroup,y,g)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ge(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Jl(e),i=Ea(e);return this.yn(e).next(o=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>G.forEach(a,l=>i.put(s0(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return G.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?G.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),G.forEach(a,l=>this.wn(e,s,l).next(c=>{const d=this.Sn(i,l);return c.isEqual(d)?G.resolve():this.bn(e,i,l,c,d)}))))})}Dn(e,t,r,s){return Ia(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,s){return Ia(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const s=Ia(e);let i=new Rt(li);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{i=i.add(new Co(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}Sn(e,t){let r=new Rt(li);const s=this.Vn(t,e);if(s==null)return r;const i=_p(t);if(i!=null){const o=e.data.field(i.fieldPath);if($u(o))for(const a of o.arrayValue.values||[])r=r.add(new Co(t.indexId,e.key,this.dn(a),s))}else r=r.add(new Co(t.indexId,e.key,Jc,s));return r}bn(e,t,r,s,i){fe("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,d,f,g){const y=l.getIterator(),E=c.getIterator();let A=wa(y),R=wa(E);for(;A||R;){let B=!1,q=!1;if(A&&R){const F=d(A,R);F<0?q=!0:F>0&&(B=!0)}else A!=null?q=!0:B=!0;B?(f(R),R=wa(E)):q?(g(A),A=wa(y)):(A=wa(y),R=wa(E))}}(s,i,li,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),G.waitFor(o)}yn(e){let t=1;return Ea(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>li(o,a)).filter((o,a,l)=>!a||li(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=li(o,e),l=li(o,t);if(a===0)s[0]=e.Zt();else if(a>0&&l<0)s.push(o),s.push(o.Zt());else if(l>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.Cn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Jc,[]],l=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Jc,[]];i.push(IDBKeyRange.bound(a,l))}return i}Cn(e,t){return li(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(h0)}getMinOffset(e,t){return G.mapArray(this.hn(t),r=>this.Pn(e,r).next(s=>s||Ce())).next(h0)}}function d0(n){return bn(n,"collectionParents")}function Ia(n){return bn(n,"indexEntries")}function Jl(n){return bn(n,"indexConfiguration")}function Ea(n){return bn(n,"indexState")}function h0(n){Ne(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;Em(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new yr(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class jn{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new jn(e,jn.DEFAULT_COLLECTION_PERCENTILE,jn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bI(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(d,f,g)=>(a++,g.delete()));i.push(l.next(()=>{Ne(a===1)}));const c=[];for(const d of t.mutations){const f=yw(e,d.key.path,t.batchId);i.push(s.delete(f)),c.push(d.key)}return G.waitFor(i).next(()=>c)}function zd(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ce();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */jn.DEFAULT_COLLECTION_PERCENTILE=10,jn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,jn.DEFAULT=new jn(41943040,jn.DEFAULT_COLLECTION_PERCENTILE,jn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),jn.DISABLED=new jn(-1,0,0);class Ph{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Fn={}}static lt(e,t,r,s){Ne(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Ph(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ui(e).J({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Ca(e),o=ui(e);return o.add({}).next(a=>{Ne(typeof a=="number");const l=new km(a,t,r,s),c=function(y,E,A){const R=A.baseMutations.map(q=>Bu(y.ct,q)),B=A.mutations.map(q=>Bu(y.ct,q));return{userId:E,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:R,mutations:B}}(this.serializer,this.userId,l),d=[];let f=new Rt((g,y)=>Ge(g.canonicalString(),y.canonicalString()));for(const g of s){const y=yw(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(o.put(c)),d.push(i.put(y,YR))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),G.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return ui(e).get(t).next(r=>r?(Ne(r.userId===this.userId),Po(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?G.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ui(e).J({index:"userMutationsIndex",range:s},(o,a,l)=>{a.userId===this.userId&&(Ne(a.batchId>=r),i=Po(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ui(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ui(e).U("userMutationsIndex",t).next(r=>r.map(s=>Po(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=dd(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Ca(e).J({range:s},(o,a,l)=>{const[c,d,f]=o,g=ns(d);if(c===this.userId&&t.path.isEqual(g))return ui(e).get(f).next(y=>{if(!y)throw Ce();Ne(y.userId===this.userId),i.push(Po(this.serializer,y))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Rt(Ge);const s=[];return t.forEach(i=>{const o=dd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ca(e).J({range:a},(c,d,f)=>{const[g,y,E]=c,A=ns(y);g===this.userId&&i.path.isEqual(A)?r=r.add(E):f.done()});s.push(l)}),G.waitFor(s).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=dd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Rt(Ge);return Ca(e).J({range:o},(l,c,d)=>{const[f,g,y]=l,E=ns(g);f===this.userId&&r.isPrefixOf(E)?E.length===s&&(a=a.add(y)):d.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ui(e).get(i).next(o=>{if(o===null)throw Ce();Ne(o.userId===this.userId),r.push(Po(this.serializer,o))}))}),G.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return bI(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),G.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return G.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ca(e).J({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=ns(i[1]);s.push(l)}else a.done()}).next(()=>{Ne(s.length===0)})})}containsKey(e,t){return wI(e,this.userId,t)}Nn(e){return II(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function wI(n,e,t){const r=dd(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ca(n).J({range:i,H:!0},(a,l,c)=>{const[d,f,g]=a;d===e&&f===s&&(o=!0),c.done()}).next(()=>o)}function ui(n){return bn(n,"mutations")}function Ca(n){return bn(n,"documentMutations")}function II(n){return bn(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Ho(0)}static kn(){return new Ho(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new Ho(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>$e.fromTimestamp(new Gt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>xa(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(Ne(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return xa(e).J((o,a)=>{const l=au(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>G.waitFor(i)).next(()=>s)}forEachTarget(e,t){return xa(e).J((r,s)=>{const i=au(s);t(i)})}qn(e){return p0(e).get("targetGlobalKey").next(t=>(Ne(t!==null),t))}Qn(e,t){return p0(e).put("targetGlobalKey",t)}Kn(e,t){return xa(e).put(vI(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Bo(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return xa(e).J({range:s,index:"queryTargetsIndex"},(o,a,l)=>{const c=au(a);oc(t,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=gi(e);return t.forEach(o=>{const a=Gn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),G.waitFor(s)}removeMatchingKeys(e,t,r){const s=gi(e);return G.forEach(t,i=>{const o=Gn(i.path);return G.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=gi(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=gi(e);let i=Xe();return s.J({range:r,H:!0},(o,a,l)=>{const c=ns(o[1]),d=new Re(c);i=i.add(d)}).next(()=>i)}containsKey(e,t){const r=Gn(t.path),s=IDBKeyRange.bound([r],[dw(r)],!1,!0);let i=0;return gi(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}ot(e,t){return xa(e).get(t).next(r=>r?au(r):null)}}function xa(n){return bn(n,"targets")}function p0(n){return bn(n,"targetGlobal")}function gi(n){return bn(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m0([n,e],[t,r]){const s=Ge(n,t);return s===0?Ge(e,r):s}class dk{constructor(e){this.Un=e,this.buffer=new Rt(m0),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();m0(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class EI{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){fe("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){qi(t)?fe("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Bi(t)}await this.Hn(3e5)})}}class hk{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return G.resolve(sr.oe);const r=new dk(t);return this.Jn.forEachTarget(e,s=>r.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>r.zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(fe("LruGarbageCollector","Garbage collection skipped; disabled"),G.resolve(f0)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),f0):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,s,i,o,a,l,c;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(i=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Sa()<=it.DEBUG&&fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),G.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function xI(n,e){return new hk(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e,t){this.db=e,this.garbageCollector=xI(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,s)=>t(s))}addReference(e,t,r){return Yc(e,r)}removeReference(e,t,r){return Yc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Yc(e,t)}nr(e,t){return function(s,i){let o=!1;return II(s).Y(a=>wI(s,a,i).next(l=>(l&&(o=!0),G.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,$e.min()),gi(e).delete(function(f){return[0,Gn(f.path)]}(o))))});s.push(l)}}).next(()=>G.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Yc(e,t)}tr(e,t){const r=gi(e);let s,i=sr.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==sr.oe&&t(new Re(ns(s)),i),i=c,s=l):i=sr.oe}).next(()=>{i!==sr.oe&&t(new Re(ns(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Yc(n,e){return gi(n).put(function(r,s){return{targetId:0,path:Gn(r.path),sequenceNumber:s}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TI{constructor(){this.changes=new Ks(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Mt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?G.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return wo(e).put(r)}removeEntry(e,t,r){return wo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Bd(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Mt.newInvalidDocument(t);return wo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Yl(t))},(s,i)=>{r=this.ir(t,i)}).next(()=>r)}sr(e,t){let r={size:0,document:Mt.newInvalidDocument(t)};return wo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Yl(t))},(s,i)=>{r={document:this.ir(t,i),size:zd(i)}}).next(()=>r)}getEntries(e,t){let r=or();return this._r(e,t,(s,i)=>{const o=this.ir(s,i);r=r.insert(s,o)}).next(()=>r)}ar(e,t){let r=or(),s=new Ot(Re.comparator);return this._r(e,t,(i,o)=>{const a=this.ir(i,o);r=r.insert(i,a),s=s.insert(i,zd(o))}).next(()=>({documents:r,ur:s}))}_r(e,t,r){if(t.isEmpty())return G.resolve();let s=new Rt(y0);t.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Yl(s.first()),Yl(s.last())),o=s.getIterator();let a=o.getNext();return wo(e).J({index:"documentKeyIndex",range:i},(l,c,d)=>{const f=Re.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&y0(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?d.$(Yl(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s,i){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Bd(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return wo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let d=or();for(const f of c){const g=this.ir(Re.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(lc(t,g)||s.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,s){let i=or();const o=v0(t,r),a=v0(t,yr.max());return wo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,d)=>{const f=this.ir(Re.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(f.key,f),i.size===s&&d.done()}).next(()=>i)}newChangeBuffer(e){return new mk(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return g0(e).get("remoteDocumentGlobalKey").next(t=>(Ne(!!t),t))}rr(e,t){return g0(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=ek(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual($e.min())))return r}return Mt.newInvalidDocument(e)}}function AI(n){return new pk(n)}class mk extends TI{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Ks(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new Rt((i,o)=>Ge(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=n0(this.cr.serializer,o);s=s.add(i.path.popLast());const c=zd(l);r+=c-a.size,t.push(this.cr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=n0(this.cr.serializer,o.convertToNoDocument($e.min()));t.push(this.cr.addEntry(e,i,l))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,r)),G.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:s})=>(s.forEach((i,o)=>{this.lr.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function g0(n){return bn(n,"remoteDocumentGlobal")}function wo(n){return bn(n,"remoteDocumentsV14")}function Yl(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function v0(n,e){const t=e.documentKey.path.toArray();return[n,Bd(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function y0(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=Ge(t[i],r[i]),s)return s;return s=Ge(t.length,r.length),s||(s=Ge(t[t.length-2],r[r.length-2]),s||Ge(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Eu(r.mutation,s,ir.empty(),Gt.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Xe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Xe()){const s=rs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=iu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=rs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Xe()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=or();const o=Iu(),a=function(){return Iu()}();return t.forEach((l,c)=>{const d=r.get(c.key);s.has(c.key)&&(d===void 0||d.mutation instanceof Gs)?i=i.insert(c.key,c):d!==void 0?(o.set(c.key,d.mutation.getFieldMask()),Eu(d.mutation,c,d.mutation.getFieldMask(),Gt.now())):o.set(c.key,ir.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,d)=>o.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new gk(d,(f=o.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Iu();let s=new Ot((o,a)=>o-a),i=Xe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let d=r.get(l)||ir.empty();d=a.applyToLocalView(c,d),r.set(l,d);const f=(s.get(a.batchId)||Xe()).add(l);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,d=l.value,f=qw();d.forEach(g=>{if(!i.has(g)){const y=Jw(t.get(g),r.get(g));y!==null&&f.set(g,y),i=i.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,f))}return G.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return Re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Sm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):G.resolve(rs());let a=-1,l=i;return o.next(c=>G.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(d)?G.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Xe())).next(d=>({batchId:a,changes:Bw(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Re(t)).next(r=>{let s=iu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=iu();return this.indexManager.getCollectionParents(e,i).next(a=>G.forEach(a,l=>{const c=function(f,g){return new zs(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(d=>{d.forEach((f,g)=>{o=o.insert(f,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((l,c)=>{const d=c.getKey();o.get(d)===null&&(o=o.insert(d,Mt.newInvalidDocument(d)))});let a=iu();return o.forEach((l,c)=>{const d=i.get(l);d!==void 0&&Eu(d.mutation,c,ir.empty(),Gt.now()),lc(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return G.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:un(s.createTime)}}(t)),G.resolve()}getNamedQuery(e,t){return G.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Mm(s.bundledQuery),readTime:un(s.readTime)}}(t)),G.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(){this.overlays=new Ot(Re.comparator),this.Ir=new Map}getOverlay(e,t){return G.resolve(this.overlays.get(t))}getOverlays(e,t){const r=rs();return G.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.ht(e,t,i)}),G.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(r)),G.resolve()}getOverlaysForCollection(e,t,r){const s=rs(),i=t.length+1,o=new Re(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return G.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new Ot((c,d)=>c-d);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=i.get(c.largestBatchId);d===null&&(d=rs(),i=i.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}const a=rs(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=s)););return G.resolve(a)}ht(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Nm(t,r));let i=this.Ir.get(t);i===void 0&&(i=Xe(),this.Ir.set(t,i)),this.Ir.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(){this.sessionToken=en.EMPTY_BYTE_STRING}getSessionToken(e){return G.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,G.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(){this.Tr=new Rt(An.Er),this.dr=new Rt(An.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new An(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new An(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Re(new ot([])),r=new An(t,e),s=new An(t,e+1),i=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),i.push(o.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Re(new ot([])),r=new An(t,e),s=new An(t,e+1);let i=Xe();return this.dr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new An(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class An{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Re.comparator(e.key,t.key)||Ge(e.wr,t.wr)}static Ar(e,t){return Ge(e.wr,t.wr)||Re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Rt(An.Er)}checkEmpty(e){return G.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new km(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.br=this.br.add(new An(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return G.resolve(o)}lookupMutationBatch(e,t){return G.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.vr(r),i=s<0?0:s;return G.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return G.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return G.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new An(t,0),s=new An(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([r,s],o=>{const a=this.Dr(o.wr);i.push(a)}),G.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Rt(Ge);return t.forEach(s=>{const i=new An(s,0),o=new An(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,o],a=>{r=r.add(a.wr)})}),G.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;Re.isDocumentKey(i)||(i=i.child(""));const o=new An(new Re(i),0);let a=new Rt(Ge);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.wr)),!0)},o),G.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Ne(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return G.forEach(t.mutations,s=>{const i=new An(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new An(t,0),s=this.br.firstAfterOrEqual(r);return G.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,G.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wk{constructor(e){this.Mr=e,this.docs=function(){return new Ot(Re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return G.resolve(r?r.document.mutableCopy():Mt.newInvalidDocument(t))}getEntries(e,t){let r=or();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Mt.newInvalidDocument(s))}),G.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=or();const o=t.path,a=new Re(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:d}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Em(fw(d),r)<=0||(s.has(d.key)||lc(t,d))&&(i=i.insert(d.key,d.mutableCopy()))}return G.resolve(i)}getAllFromCollectionGroup(e,t,r,s){Ce()}Or(e,t){return G.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ik(this)}getSize(e){return G.resolve(this.size)}}class Ik extends TI{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),G.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e){this.persistence=e,this.Nr=new Ks(t=>Bo(t),oc),this.lastRemoteSnapshotVersion=$e.min(),this.highestTargetId=0,this.Lr=0,this.Br=new $m,this.targetCount=0,this.kr=Ho.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,s)=>t(s)),G.resolve()}getLastRemoteSnapshotVersion(e){return G.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return G.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),G.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),G.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Ho(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,G.resolve()}updateTargetData(e,t){return this.Kn(t),G.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,G.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),G.waitFor(i).next(()=>s)}getTargetCount(e){return G.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return G.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),G.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),G.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),G.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return G.resolve(r)}containsKey(e,t){return G.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e,t){this.qr={},this.overlays={},this.Qr=new sr(0),this.Kr=!1,this.Kr=!0,this.$r=new _k,this.referenceDelegate=e(this),this.Ur=new Ek(this),this.indexManager=new lk,this.remoteDocumentCache=function(s){return new wk(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new gI(t),this.Gr=new vk(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yk,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new bk(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("MemoryPersistence","Starting transaction:",e);const s=new xk(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return G.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class xk extends mw{constructor(e){super(),this.currentSequenceNumber=e}}class Rh{constructor(e){this.persistence=e,this.Jr=new $m,this.Yr=null}static Zr(e){return new Rh(e)}get Xr(){if(this.Yr)return this.Yr;throw Ce()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),G.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),G.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),G.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return G.forEach(this.Xr,r=>{const s=Re.fromPath(r);return this.ei(e,s).next(i=>{i||t.removeEntry(s,$e.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return G.or([()=>G.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class Kd{constructor(e,t){this.persistence=e,this.ti=new Ks(r=>Gn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=xI(this,t)}static Zr(e,t){return new Kd(e,t)}zr(){}jr(e){return G.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Yn(e){const t=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}Zn(e,t){return G.forEach(this.ti,(r,s)=>this.nr(e,r,s).next(i=>i?G.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.Or(e,o=>this.nr(e,o,t).next(a=>{a||(r++,i.removeEntry(o,$e.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ti.set(t,e.currentSequenceNumber),G.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),G.resolve()}removeReference(e,t,r){return this.ti.set(r,e.currentSequenceNumber),G.resolve()}updateLimboDocument(e,t){return this.ti.set(t,e.currentSequenceNumber),G.resolve()}Wr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=fd(e.data.value)),t}nr(e,t,r){return G.or([()=>this.persistence.Hr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.ti.get(t);return G.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tk{constructor(e){this.serializer=e}O(e,t,r,s){const i=new bh("createOrUpgrade",t);r<1&&s>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Dy,{unique:!0}),l.createObjectStore("documentMutations")}(e),_0(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=G.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),_0(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$e.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Dy,{unique:!0});const f=c.store("mutations"),g=d.map(y=>f.put(y));return G.waitFor(g)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.ni(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),r<7&&s>=7&&(o=o.next(()=>this.ii(i))),r<8&&s>=8&&(o=o.next(()=>this.si(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.oi(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:uC});c.createIndex("collectionPathOverlayIndex",cC,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",dC,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:XR});c.createIndex("documentKeyIndex",ZR),c.createIndex("collectionGroupIndex",eC)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.ai(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:iC}).createIndex("sequenceNumberIndex",oC,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:aC}).createIndex("documentKeyIndex",lC,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,s)=>{t+=zd(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(s=>G.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>G.forEach(a,l=>{Ne(l.userId===i.userId);const c=Po(this.serializer,l);return bI(e,i.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.J((o,a)=>{const l=new ot(o),c=function(f){return[0,Gn(f)]}(l);i.push(t.get(c).next(d=>d?G.resolve():(f=>t.put({targetId:0,path:Gn(f),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>G.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:sC});const r=t.store("collectionParents"),s=new Fm,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Gn(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new ot(o);return i(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const d=ns(a);return i(d.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,s)=>{const i=au(s),o=vI(this.serializer,i);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),s=[];return r.J((i,o)=>{const a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new Re(ot.fromString(f.document.name).popFirst(5)):f.noDocument?Re.fromSegments(f.noDocument.path):f.unknownDocument?Re.fromSegments(f.unknownDocument.path):Ce()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>G.waitFor(s))}ai(e,t){const r=t.store("mutations"),s=AI(this.serializer),i=new Um(Rh.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:Xe();Po(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),G.forEach(a,(l,c)=>{const d=new Sn(c),f=Sh.lt(this.serializer,d),g=i.getIndexManager(d),y=Ph.lt(d,this.serializer,g,i.referenceDelegate);return new SI(s,y,f,g).recalculateAndSaveOverlaysForDocumentKeys(new bp(t,sr.oe),l).next()})})}}function _0(n){n.createObjectStore("targetDocuments",{keyPath:nC}).createIndex("documentTargetsIndex",rC,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",tC,{unique:!0}),n.createObjectStore("targetGlobal")}const Ff="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class jm{constructor(e,t,r,s,i,o,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=i,this.window=o,this.document=a,this.ci=c,this.li=d,this.hi=f,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=g=>Promise.resolve(),!jm.D())throw new pe(Y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new fk(this,s),this.Ai=t+"main",this.serializer=new gI(l),this.Ri=new os(this.Ai,this.hi,new Tk(this.serializer)),this.$r=new nk,this.Ur=new ck(this.referenceDelegate,this.serializer),this.remoteDocumentCache=AI(this.serializer),this.Gr=new tk,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,d===!1&&an("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new pe(Y.FAILED_PRECONDITION,Ff);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new sr(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Xc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(qi(e))return fe("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return fe("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Xl(e).get("owner").next(t=>G.resolve(this.vi(t)))}Ci(e){return Xc(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=bn(t,"clientMetadata");return r.U().next(s=>{const i=this.xi(s,18e5),o=s.filter(a=>i.indexOf(a)===-1);return G.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?G.resolve(!0):Xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new pe(Y.FAILED_PRECONDITION,Ff);return!1}}return!(!this.networkEnabled||!this.inForeground)||Xc(e).U().next(r=>this.xi(r,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&fe("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new bp(e,sr.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Xc(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Ph.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new uk(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Sh.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){fe("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(l){return l===17?pC:l===16?fC:l===15?Tm:l===14?ww:l===13?bw:l===12?hC:l===11?_w:void Ce()}(this.hi);let o;return this.Ri.runTransaction(e,s,i,a=>(o=new bp(a,this.Qr?this.Qr.next():sr.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw an(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new pe(Y.FAILED_PRECONDITION,pw);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Xl(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new pe(Y.FAILED_PRECONDITION,Ff)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Xl(e).put("owner",t)}static D(){return os.D()}bi(e){const t=Xl(e);return t.get("owner").next(r=>this.vi(r)?(fe("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):G.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(an(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Qb()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return fe("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return an("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){an("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Xl(n){return bn(n,"owner")}function Xc(n){return bn(n,"clientMetadata")}function Bm(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=s}static Wi(e,t){let r=Xe(),s=Xe();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new qm(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Qb()?8:gw(_n())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.Yi(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Zi(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new Ak;return this.Xi(e,t,o).next(a=>{if(i.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>i.result)}es(e,t,r,s){return r.documentReadCount<this.ji?(Sa()<=it.DEBUG&&fe("QueryEngine","SDK will not create cache indexes for query:",Pa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),G.resolve()):(Sa()<=it.DEBUG&&fe("QueryEngine","Query:",Pa(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Sa()<=it.DEBUG&&fe("QueryEngine","The SDK decides to create cache indexes for query:",Pa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Hn(t))):G.resolve())}Yi(e,t){if(Ky(t))return G.resolve(null);let r=Hn(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Ud(t,null,"F"),r=Hn(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Xe(...i);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,Ud(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,s){return Ky(t)||s.isEqual($e.min())?G.resolve(null):this.Ji.getDocuments(e,r).next(i=>{const o=this.ts(t,i);return this.ns(t,o,r,s)?G.resolve(null):(Sa()<=it.DEBUG&&fe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Pa(t)),this.rs(e,o,t,hw(s,-1)).next(a=>a))})}ts(e,t){let r=new Rt(Uw(e));return t.forEach((s,i)=>{lc(e,i)&&(r=r.add(i))}),r}ns(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,r){return Sa()<=it.DEBUG&&fe("QueryEngine","Using full collection scan to execute query:",Pa(t)),this.Ji.getDocumentsMatchingQuery(e,t,yr.min(),r)}rs(e,t,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e,t,r,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ot(Ge),this._s=new Ks(i=>Bo(i),oc),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new SI(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function RI(n,e,t,r){return new Sk(n,e,t,r)}async function CI(n,e){const t=Ae(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Xe();for(const c of s){o.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}for(const c of i){a.push(c.batchId);for(const d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function Pk(n,e){const t=Ae(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){const f=c.batch,g=f.keys();let y=G.resolve();return g.forEach(E=>{y=y.next(()=>d.getEntry(l,E)).next(A=>{const R=c.docVersions.get(E);Ne(R!==null),A.version.compareTo(R)<0&&(f.applyToRemoteDocument(A,c),A.isValidDocument()&&(A.setReadTime(c.commitVersion),d.addEntry(A)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Xe();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function kI(n){const e=Ae(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Rk(n,e){const t=Ae(n),r=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const a=[];e.targetChanges.forEach((d,f)=>{const g=s.get(f);if(!g)return;a.push(t.Ur.removeMatchingKeys(i,d.removedDocuments,f).next(()=>t.Ur.addMatchingKeys(i,d.addedDocuments,f)));let y=g.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?y=y.withResumeToken(en.EMPTY_BYTE_STRING,$e.min()).withLastLimboFreeSnapshotVersion($e.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),s=s.insert(f,y),function(A,R,B){return A.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=3e8?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0}(g,y,d)&&a.push(t.Ur.updateTargetData(i,y))});let l=or(),c=Xe();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,d))}),a.push(DI(i,o,e.documentUpdates).next(d=>{l=d.Ps,c=d.Is})),!r.isEqual($e.min())){const d=t.Ur.getLastRemoteSnapshotVersion(i).next(f=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(d)}return G.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(t.os=s,i))}function DI(n,e,t){let r=Xe(),s=Xe();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=or();return t.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual($e.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):fe("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:s}})}function Ck(n,e){const t=Ae(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function tl(n,e){const t=Ae(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Ur.getTargetData(r,e).next(i=>i?(s=i,G.resolve(s)):t.Ur.allocateTargetId(r).next(o=>(s=new Ps(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function nl(n,e,t){const r=Ae(n),s=r.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!qi(o))throw o;fe("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Gd(n,e,t){const r=Ae(n);let s=$e.min(),i=Xe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,d){const f=Ae(l),g=f._s.get(d);return g!==void 0?G.resolve(f.os.get(g)):f.Ur.getTargetData(c,d)}(r,o,Hn(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?s:$e.min(),t?i:Xe())).next(a=>(OI(r,$w(e),a),{documents:a,Ts:i})))}function NI(n,e){const t=Ae(n),r=Ae(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ot(i,e).next(o=>o?o.target:null))}function VI(n,e){const t=Ae(n),r=t.us.get(e)||$e.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,hw(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(OI(t,e,s),s))}function OI(n,e,t){let r=n.us.get(e)||$e.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.us.set(e,r)}async function kk(n,e,t,r){const s=Ae(n);let i=Xe(),o=or();for(const c of t){const d=e.Es(c.metadata.name);c.document&&(i=i.add(d));const f=e.ds(c);f.setReadTime(e.As(c.metadata.readTime)),o=o.insert(d,f)}const a=s.cs.newChangeBuffer({trackRemovals:!0}),l=await tl(s,function(d){return Hn(gl(ot.fromString(`__bundle__/docs/${d}`)))}(r));return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>DI(c,a,o).next(d=>(a.apply(c),d)).next(d=>s.Ur.removeMatchingKeysForTargetId(c,l.targetId).next(()=>s.Ur.addMatchingKeys(c,i,l.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,d.Ps,d.Is)).next(()=>d.Ps)))}async function Dk(n,e,t=Xe()){const r=await tl(n,Hn(Mm(e.bundledQuery))),s=Ae(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=un(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Gr.saveNamedQuery(i,e);const a=r.withResumeToken(en.EMPTY_BYTE_STRING,o);return s.os=s.os.insert(a.targetId,a),s.Ur.updateTargetData(i,a).next(()=>s.Ur.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Ur.addMatchingKeys(i,t,r.targetId)).next(()=>s.Gr.saveNamedQuery(i,e))})}function b0(n,e){return`firestore_clients_${n}_${e}`}function w0(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function $f(n,e){return`firestore_targets_${n}_${e}`}class Hd{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Rs(e,t,r){const s=JSON.parse(r);let i,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(i=new pe(s.error.code,s.error.message))),o?new Hd(e,t,s.state,i):(an("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class xu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let s,i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new pe(r.error.code,r.error.message))),i?new xu(e,r.state,s):(an("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Wd{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let s=typeof r=="object"&&r.activeTargetIds instanceof Array,i=Pm();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=vw(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Wd(e,i):(an("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class zm{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new zm(t.clientId,t.onlineState):(an("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Vp{constructor(){this.activeTargetIds=Pm()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Uf{constructor(e,t,r,s,i){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ot(Ge),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=b0(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Vp),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const s=this.getItem(b0(this.persistenceKey,r));if(s){const i=Wd.Rs(r,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem($f(this.persistenceKey,e));if(s){const i=xu.Rs(e,s);i&&(r=i.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem($f(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return fe("SharedClientState","READ",e,t),t}setItem(e,t){fe("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){fe("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(fe("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void an("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(i){let o=sr.oe;if(i!=null)try{const a=JSON.parse(i);Ne(typeof a=="number"),o=a}catch(a){an("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==sr.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const s=new Hd(this.currentUser,e,t,r),i=w0(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=w0(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const s=$f(this.persistenceKey,e),i=new xu(e,t,r);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return Wd.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),s=Number(r[1]),i=r[2]!==void 0?r[2]:null;return Hd.Rs(new Sn(i),s,t)}Ys(e,t){const r=this.Ms.exec(e),s=Number(r[1]);return xu.Rs(s,t)}Ls(e){return zm.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);fe("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(r),o=[],a=[];return i.forEach(l=>{s.has(l)||o.push(l)}),s.forEach(l=>{i.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Pm();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class MI{constructor(){this.so=new Vp,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Vp,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){fe("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){fe("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zc=null;function jf(){return Zc===null?Zc=function(){return 268435456+Math.round(2147483648*Math.random())}():Zc++,"0x"+Zc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ok{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $n="WebChannelConnection";class Mk extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,r,s,i,o){const a=jf(),l=this.xo(t,r.toUriEncodedString());fe("RestConnection",`Sending RPC '${t}' ${a}:`,l,s);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,i,o),this.No(t,l,c,s).then(d=>(fe("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Rr("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",s),d})}Lo(t,r,s,i,o,a){return this.Mo(t,r,s,i,o)}Oo(t,r,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ml}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>t[o]=i),s&&s.headers.forEach((i,o)=>t[o]=i)}xo(t,r){const s=Vk[t];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,s){const i=jf();return new Promise((o,a)=>{const l=new rw;l.setWithCredentials(!0),l.listenOnce(sw.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case cd.NO_ERROR:const d=l.getResponseJson();fe($n,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(d)),o(d);break;case cd.TIMEOUT:fe($n,`RPC '${e}' ${i} timed out`),a(new pe(Y.DEADLINE_EXCEEDED,"Request time out"));break;case cd.HTTP_ERROR:const f=l.getStatus();if(fe($n,`RPC '${e}' ${i} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const E=function(R){const B=R.toLowerCase().replace(/_/g,"-");return Object.values(Y).indexOf(B)>=0?B:Y.UNKNOWN}(y.status);a(new pe(E,y.message))}else a(new pe(Y.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new pe(Y.UNAVAILABLE,"Connection failed."));break;default:Ce()}}finally{fe($n,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);fe($n,`RPC '${e}' ${i} sending request:`,s),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const s=jf(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=aw(),a=ow(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");fe($n,`Creating RPC '${e}' stream ${s}: ${d}`,l);const f=o.createWebChannel(d,l);let g=!1,y=!1;const E=new Ok({Io:R=>{y?fe($n,`Not sending because RPC '${e}' stream ${s} is closed:`,R):(g||(fe($n,`Opening RPC '${e}' stream ${s} transport.`),f.open(),g=!0),fe($n,`RPC '${e}' stream ${s} sending:`,R),f.send(R))},To:()=>f.close()}),A=(R,B,q)=>{R.listen(B,F=>{try{q(F)}catch(z){setTimeout(()=>{throw z},0)}})};return A(f,su.EventType.OPEN,()=>{y||(fe($n,`RPC '${e}' stream ${s} transport opened.`),E.yo())}),A(f,su.EventType.CLOSE,()=>{y||(y=!0,fe($n,`RPC '${e}' stream ${s} transport closed`),E.So())}),A(f,su.EventType.ERROR,R=>{y||(y=!0,Rr($n,`RPC '${e}' stream ${s} transport errored:`,R),E.So(new pe(Y.UNAVAILABLE,"The operation could not be completed")))}),A(f,su.EventType.MESSAGE,R=>{var B;if(!y){const q=R.data[0];Ne(!!q);const F=q,z=F.error||((B=F[0])===null||B===void 0?void 0:B.error);if(z){fe($n,`RPC '${e}' stream ${s} received error:`,z);const de=z.status;let me=function(x){const N=fn[x];if(N!==void 0)return eI(N)}(de),T=z.message;me===void 0&&(me=Y.INTERNAL,T="Unknown error status: "+de+" with message "+z.message),y=!0,E.So(new pe(me,T)),f.close()}else fe($n,`RPC '${e}' stream ${s} received:`,q),E.bo(q)}}),A(a,iw.STAT_EVENT,R=>{R.stat===yp.PROXY?fe($n,`RPC '${e}' stream ${s} detected buffering proxy`):R.stat===yp.NOPROXY&&fe($n,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{E.wo()},0),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LI(){return typeof window<"u"?window:null}function vd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(n){return new zC(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-r);s>0&&fe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(e,t,r,s,i,o,a,l){this.ui=e,this.Ho=r,this.Jo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Km(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===Y.RESOURCE_EXHAUSTED?(an(t.toString()),an("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===Y.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===t&&this.P_(r,s)},r=>{e(()=>{const s=new pe(Y.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return fe("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(fe("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Lk extends FI{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=HC(this.serializer,e),r=function(i){if(!("targetChange"in i))return $e.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?$e.min():o.readTime?un(o.readTime):$e.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=Rp(this.serializer),t.addTarget=function(i,o){let a;const l=o.target;if(a=Fd(l)?{documents:cI(i,l)}:{query:Ah(i,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=sI(i,o.resumeToken);const c=Sp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo($e.min())>0){a.readTime=el(i,o.snapshotVersion.toTimestamp());const c=Sp(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=QC(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=Rp(this.serializer),t.removeTarget=e,this.a_(t)}}class Fk extends FI{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Ne(!!e.streamToken),this.lastStreamToken=e.streamToken,Ne(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ne(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=WC(e.writeResults,e.commitTime),r=un(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=Rp(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Bu(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new pe(Y.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Mo(e,Pp(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new pe(Y.UNKNOWN,i.toString())})}Lo(e,t,r,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,Pp(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new pe(Y.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Uk{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(an(t),this.D_=!1):fe("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(o=>{r.enqueueAndForget(async()=>{Ki(this)&&(fe("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=Ae(l);c.L_.add(4),await _l(c),c.q_.set("Unknown"),c.L_.delete(4),await fc(c)}(this))})}),this.q_=new Uk(r,s)}}async function fc(n){if(Ki(n))for(const e of n.B_)await e(!0)}async function _l(n){for(const e of n.B_)await e(!1)}function Ch(n,e){const t=Ae(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Wm(t)?Hm(t):wl(t).r_()&&Gm(t,e))}function rl(n,e){const t=Ae(n),r=wl(t);t.N_.delete(e),r.r_()&&$I(t,e),t.N_.size===0&&(r.r_()?r.o_():Ki(t)&&t.q_.set("Unknown"))}function Gm(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($e.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}wl(n).A_(e)}function $I(n,e){n.Q_.xe(e),wl(n).R_(e)}function Hm(n){n.Q_=new UC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),wl(n).start(),n.q_.v_()}function Wm(n){return Ki(n)&&!wl(n).n_()&&n.N_.size>0}function Ki(n){return Ae(n).L_.size===0}function UI(n){n.Q_=void 0}async function Bk(n){n.q_.set("Online")}async function qk(n){n.N_.forEach((e,t)=>{Gm(n,e)})}async function zk(n,e){UI(n),Wm(n)?(n.q_.M_(e),Hm(n)):n.q_.set("Unknown")}async function Kk(n,e,t){if(n.q_.set("Online"),e instanceof rI&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.N_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.N_.delete(a),s.Q_.removeTarget(a))}(n,e)}catch(r){fe("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Qd(n,r)}else if(e instanceof gd?n.Q_.Ke(e):e instanceof nI?n.Q_.He(e):n.Q_.We(e),!t.isEqual($e.min()))try{const r=await kI(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const d=i.N_.get(c);d&&i.N_.set(c,d.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const d=i.N_.get(l);if(!d)return;i.N_.set(l,d.withResumeToken(en.EMPTY_BYTE_STRING,d.snapshotVersion)),$I(i,l);const f=new Ps(d.target,l,c,d.sequenceNumber);Gm(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){fe("RemoteStore","Failed to raise snapshot:",r),await Qd(n,r)}}async function Qd(n,e,t){if(!qi(e))throw e;n.L_.add(1),await _l(n),n.q_.set("Offline"),t||(t=()=>kI(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{fe("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await fc(n)})}function jI(n,e){return e().catch(t=>Qd(n,t,e))}async function bl(n){const e=Ae(n),t=Mi(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Gk(e);)try{const s=await Ck(e.localStore,r);if(s===null){e.O_.length===0&&t.o_();break}r=s.batchId,Hk(e,s)}catch(s){await Qd(e,s)}BI(e)&&qI(e)}function Gk(n){return Ki(n)&&n.O_.length<10}function Hk(n,e){n.O_.push(e);const t=Mi(n);t.r_()&&t.V_&&t.m_(e.mutations)}function BI(n){return Ki(n)&&!Mi(n).n_()&&n.O_.length>0}function qI(n){Mi(n).start()}async function Wk(n){Mi(n).p_()}async function Qk(n){const e=Mi(n);for(const t of n.O_)e.m_(t.mutations)}async function Jk(n,e,t){const r=n.O_.shift(),s=Dm.from(r,e,t);await jI(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await bl(n)}async function Yk(n,e){e&&Mi(n).V_&&await async function(r,s){if(function(o){return Zw(o)&&o!==Y.ABORTED}(s.code)){const i=r.O_.shift();Mi(r).s_(),await jI(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await bl(r)}}(n,e),BI(n)&&qI(n)}async function E0(n,e){const t=Ae(n);t.asyncQueue.verifyOperationInProgress(),fe("RemoteStore","RemoteStore received new credentials");const r=Ki(t);t.L_.add(3),await _l(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await fc(t)}async function Op(n,e){const t=Ae(n);e?(t.L_.delete(2),await fc(t)):e||(t.L_.add(2),await _l(t),t.q_.set("Unknown"))}function wl(n){return n.K_||(n.K_=function(t,r,s){const i=Ae(t);return i.w_(),new Lk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:Bk.bind(null,n),Ro:qk.bind(null,n),mo:zk.bind(null,n),d_:Kk.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),Wm(n)?Hm(n):n.q_.set("Unknown")):(await n.K_.stop(),UI(n))})),n.K_}function Mi(n){return n.U_||(n.U_=function(t,r,s){const i=Ae(t);return i.w_(),new Fk(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Wk.bind(null,n),mo:Yk.bind(null,n),f_:Qk.bind(null,n),g_:Jk.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await bl(n)):(await n.U_.stop(),n.O_.length>0&&(fe("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Pn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Qm(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new pe(Y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Il(n,e){if(an("AsyncQueue",`${e}: ${n}`),qi(n))return new pe(Y.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Re.comparator(t.key,r.key):(t,r)=>Re.comparator(t.key,r.key),this.keyedMap=iu(),this.sortedSet=new Ot(this.comparator)}static emptySet(e){return new Fa(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Fa)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Fa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(){this.W_=new Ot(Re.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ce():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class sl{constructor(e,t,r,s,i,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new sl(e,t,Fa.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ac(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Zk{constructor(){this.queries=T0(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const s=Ae(t),i=s.queries;s.queries=T0(),i.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new pe(Y.ABORTED,"Firestore shutting down"))}}function T0(){return new Ks(n=>Fw(n),ac)}async function Jm(n,e){const t=Ae(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(r=2):(i=new Xk,r=e.J_()?0:1);try{switch(r){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=Il(o,`Initialization of query '${Pa(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Xm(t)}async function Ym(n,e){const t=Ae(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.j_.indexOf(e);o>=0&&(i.j_.splice(o,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function e2(n,e){const t=Ae(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.j_)a.X_(s)&&(r=!0);o.z_=s}}r&&Xm(t)}function t2(n,e,t){const r=Ae(n),s=r.queries.get(e);if(s)for(const i of s.j_)i.onError(t);r.queries.delete(e)}function Xm(n){n.Y_.forEach(e=>{e.next()})}var Mp,A0;(A0=Mp||(Mp={})).ea="default",A0.Cache="cache";class Zm{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new sl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=sl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Mp.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(e){this.serializer=e}Es(e){return as(this.serializer,e)}ds(e){return e.metadata.exists?uI(this.serializer,e.document,!1):Mt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return un(e)}}class r2{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=zI(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const r=ot.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,r=new S0(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.Es(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||Xe()).add(i);t.set(o,a)}}return t}async complete(){const e=await kk(this.localStore,new S0(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const r of this.queries)await Dk(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function zI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KI{constructor(e){this.key=e}}class GI{constructor(e){this.key=e}}class HI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Xe(),this.mutatedKeys=Xe(),this.Aa=Uw(e),this.Ra=new Fa(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new x0,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((d,f)=>{const g=s.get(d),y=lc(this.query,f)?f:null,E=!!g&&this.mutatedKeys.has(g.key),A=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations);let R=!1;g&&y?g.data.isEqual(y.data)?E!==A&&(r.track({type:3,doc:y}),R=!0):this.ga(g,y)||(r.track({type:2,doc:y}),R=!0,(l&&this.Aa(y,l)>0||c&&this.Aa(y,c)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),R=!0):g&&!y&&(r.track({type:1,doc:g}),R=!0,(l||c)&&(a=!0)),R&&(y?(o=o.add(y),i=A?i.add(d):i.delete(d)):(o=o.delete(d),i=i.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),i=i.delete(d.key),r.track({type:1,doc:d})}return{Ra:o,fa:r,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((d,f)=>function(y,E){const A=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ce()}};return A(y)-A(E)}(d.type,f.type)||this.Aa(d.doc,f.doc)),this.pa(r),s=s!=null&&s;const a=t&&!s?this.ya():[],l=this.da.size===0&&this.current&&!s?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new sl(this.query,e.Ra,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new x0,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Xe(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new GI(r))}),this.da.forEach(r=>{e.has(r)||t.push(new KI(r))}),t}ba(e){this.Ta=e.Ts,this.da=Xe();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return sl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class s2{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class i2{constructor(e){this.key=e,this.va=!1}}class o2{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Ks(a=>Fw(a),ac),this.Ma=new Map,this.xa=new Set,this.Oa=new Ot(Re.comparator),this.Na=new Map,this.La=new $m,this.Ba={},this.ka=new Map,this.qa=Ho.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function a2(n,e,t=!0){const r=kh(n);let s;const i=r.Fa.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await WI(r,e,t,!0),s}async function l2(n,e){const t=kh(n);await WI(t,e,!0,!1)}async function WI(n,e,t,r){const s=await tl(n.localStore,Hn(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await eg(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&Ch(n.remoteStore,s),a}async function eg(n,e,t,r,s){n.Ka=(f,g,y)=>async function(A,R,B,q){let F=R.view.ma(B);F.ns&&(F=await Gd(A.localStore,R.query,!1).then(({documents:T})=>R.view.ma(T,F)));const z=q&&q.targetChanges.get(R.targetId),de=q&&q.targetMismatches.get(R.targetId)!=null,me=R.view.applyChanges(F,A.isPrimaryClient,z,de);return Lp(A,R.targetId,me.wa),me.snapshot}(n,f,g,y);const i=await Gd(n.localStore,e,!0),o=new HI(e,i.Ts),a=o.ma(i.documents),l=dc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),c=o.applyChanges(a,n.isPrimaryClient,l);Lp(n,t,c.wa);const d=new s2(e,t,o);return n.Fa.set(e,d),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function u2(n,e,t){const r=Ae(n),s=r.Fa.get(e),i=r.Ma.get(s.targetId);if(i.length>1)return r.Ma.set(s.targetId,i.filter(o=>!ac(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await nl(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&rl(r.remoteStore,s.targetId),il(r,s.targetId)}).catch(Bi)):(il(r,s.targetId),await nl(r.localStore,s.targetId,!0))}async function c2(n,e){const t=Ae(n),r=t.Fa.get(e),s=t.Ma.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),rl(t.remoteStore,r.targetId))}async function d2(n,e,t){const r=sg(n);try{const s=await function(o,a){const l=Ae(o),c=Gt.now(),d=a.reduce((y,E)=>y.add(E.key),Xe());let f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",y=>{let E=or(),A=Xe();return l.cs.getEntries(y,d).next(R=>{E=R,E.forEach((B,q)=>{q.isValidDocument()||(A=A.add(B))})}).next(()=>l.localDocuments.getOverlayedDocuments(y,E)).next(R=>{f=R;const B=[];for(const q of a){const F=LC(q,f.get(q.key).overlayedDocument);F!=null&&B.push(new Gs(q.key,F,Sw(F.value.mapValue),qt.exists(!0)))}return l.mutationQueue.addMutationBatch(y,c,B,a)}).next(R=>{g=R;const B=R.applyToLocalDocumentSet(f,A);return l.documentOverlayCache.saveOverlays(y,R.batchId,B)})}).then(()=>({batchId:g.batchId,changes:Bw(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new Ot(Ge)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,s.batchId,t),await Hs(r,s.changes),await bl(r.remoteStore)}catch(s){const i=Il(s,"Failed to persist write");t.reject(i)}}async function QI(n,e){const t=Ae(n);try{const r=await Rk(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Na.get(i);o&&(Ne(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?Ne(o.va):s.removedDocuments.size>0&&(Ne(o.va),o.va=!1))}),await Hs(t,r,e)}catch(r){await Bi(r)}}function P0(n,e,t){const r=Ae(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Fa.forEach((i,o)=>{const a=o.view.Z_(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Ae(o);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(const g of f.j_)g.Z_(a)&&(c=!0)}),c&&Xm(l)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function h2(n,e,t){const r=Ae(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Na.get(e),i=s&&s.key;if(i){let o=new Ot(Re.comparator);o=o.insert(i,Mt.newNoDocument(i,$e.min()));const a=Xe().add(i),l=new cc($e.min(),new Map,new Ot(Ge),o,a);await QI(r,l),r.Oa=r.Oa.remove(i),r.Na.delete(e),rg(r)}else await nl(r.localStore,e,!1).then(()=>il(r,e,t)).catch(Bi)}async function f2(n,e){const t=Ae(n),r=e.batch.batchId;try{const s=await Pk(t.localStore,e);ng(t,r,null),tg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Hs(t,s)}catch(s){await Bi(s)}}async function p2(n,e,t){const r=Ae(n);try{const s=await function(o,a){const l=Ae(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(Ne(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);ng(r,e,t),tg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Hs(r,s)}catch(s){await Bi(s)}}async function m2(n,e){const t=Ae(n);Ki(t.remoteStore)||fe("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=Ae(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();const s=t.ka.get(r)||[];s.push(e),t.ka.set(r,s)}catch(r){const s=Il(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function tg(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function ng(n,e,t){const r=Ae(n);let s=r.Ba[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function il(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||JI(n,r)})}function JI(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(rl(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),rg(n))}function Lp(n,e,t){for(const r of t)r instanceof KI?(n.La.addReference(r.key,e),g2(n,r)):r instanceof GI?(fe("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||JI(n,r.key)):Ce()}function g2(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(fe("SyncEngine","New document in limbo: "+t),n.xa.add(r),rg(n))}function rg(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Re(ot.fromString(e)),r=n.qa.next();n.Na.set(r,new i2(t)),n.Oa=n.Oa.insert(t,r),Ch(n.remoteStore,new Ps(Hn(gl(t.path)),r,"TargetPurposeLimboResolution",sr.oe))}}async function Hs(n,e,t){const r=Ae(n),s=[],i=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){const f=c?!c.fromCache:(d=t==null?void 0:t.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){s.push(c);const f=qm.Wi(l.targetId,c);i.push(f)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(l,c){const d=Ae(l);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>G.forEach(c,g=>G.forEach(g.$i,y=>d.persistence.referenceDelegate.addReference(f,g.targetId,y)).next(()=>G.forEach(g.Ui,y=>d.persistence.referenceDelegate.removeReference(f,g.targetId,y)))))}catch(f){if(!qi(f))throw f;fe("LocalStore","Failed to update sequence numbers: "+f)}for(const f of c){const g=f.targetId;if(!f.fromCache){const y=d.os.get(g),E=y.snapshotVersion,A=y.withLastLimboFreeSnapshotVersion(E);d.os=d.os.insert(g,A)}}}(r.localStore,i))}async function v2(n,e){const t=Ae(n);if(!t.currentUser.isEqual(e)){fe("SyncEngine","User change. New user:",e.toKey());const r=await CI(t.localStore,e);t.currentUser=e,function(i,o){i.ka.forEach(a=>{a.forEach(l=>{l.reject(new pe(Y.CANCELLED,o))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Hs(t,r.hs)}}function y2(n,e){const t=Ae(n),r=t.Na.get(e);if(r&&r.va)return Xe().add(r.key);{let s=Xe();const i=t.Ma.get(e);if(!i)return s;for(const o of i){const a=t.Fa.get(o);s=s.unionWith(a.view.Va)}return s}}async function _2(n,e){const t=Ae(n),r=await Gd(t.localStore,e.query,!0),s=e.view.ba(r);return t.isPrimaryClient&&Lp(t,e.targetId,s.wa),s}async function b2(n,e){const t=Ae(n);return VI(t.localStore,e).then(r=>Hs(t,r))}async function w2(n,e,t,r){const s=Ae(n),i=await function(a,l){const c=Ae(a),d=Ae(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.Mn(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):G.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await bl(s.remoteStore):t==="acknowledged"||t==="rejected"?(ng(s,e,r||null),tg(s,e),function(a,l){Ae(Ae(a).mutationQueue).On(l)}(s.localStore,e)):Ce(),await Hs(s,i)):fe("SyncEngine","Cannot apply mutation batch with id: "+e)}async function I2(n,e){const t=Ae(n);if(kh(t),sg(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),s=await R0(t,r.toArray());t.Qa=!0,await Op(t.remoteStore,!0);for(const i of s)Ch(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const r=[];let s=Promise.resolve();t.Ma.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(il(t,o),nl(t.localStore,o,!0))),rl(t.remoteStore,o)}),await s,await R0(t,r),function(o){const a=Ae(o);a.Na.forEach((l,c)=>{rl(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new Ot(Re.comparator)}(t),t.Qa=!1,await Op(t.remoteStore,!1)}}async function R0(n,e,t){const r=Ae(n),s=[],i=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await tl(r.localStore,Hn(l[0]));for(const c of l){const d=r.Fa.get(c),f=await _2(r,d);f.snapshot&&i.push(f.snapshot)}}else{const c=await NI(r.localStore,o);a=await tl(r.localStore,c),await eg(r,YI(c),o,!1,a.resumeToken)}s.push(a)}return r.Ca.d_(i),s}function YI(n){return Ow(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function E2(n){return function(t){return Ae(Ae(t).persistence).Qi()}(Ae(n).localStore)}async function x2(n,e,t,r){const s=Ae(n);if(s.Qa)return void fe("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=await VI(s.localStore,$w(i[0])),a=cc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",en.EMPTY_BYTE_STRING);await Hs(s,o,a);break}case"rejected":await nl(s.localStore,e,!0),il(s,e,r);break;default:Ce()}}async function T2(n,e,t){const r=kh(n);if(r.Qa){for(const s of e){if(r.Ma.has(s)&&r.sharedClientState.isActiveQueryTarget(s)){fe("SyncEngine","Adding an already active target "+s);continue}const i=await NI(r.localStore,s),o=await tl(r.localStore,i);await eg(r,YI(i),o.targetId,!1,o.resumeToken),Ch(r.remoteStore,o)}for(const s of t)r.Ma.has(s)&&await nl(r.localStore,s,!1).then(()=>{rl(r.remoteStore,s),il(r,s)}).catch(Bi)}}function kh(n){const e=Ae(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=QI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=y2.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=h2.bind(null,e),e.Ca.d_=e2.bind(null,e.eventManager),e.Ca.$a=t2.bind(null,e.eventManager),e}function sg(n){const e=Ae(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=f2.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=p2.bind(null,e),e}function A2(n,e,t){const r=Ae(n);(async function(i,o,a){try{const l=await o.getMetadata();if(await function(y,E){const A=Ae(y),R=un(E.createTime);return A.persistence.runTransaction("hasNewerBundle","readonly",B=>A.Gr.getBundleMetadata(B,E.id)).then(B=>!!B&&B.createTime.compareTo(R)>=0)}(i.localStore,l))return await o.close(),a._completeWith(function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(zI(l));const c=new r2(l,i.localStore,o.serializer);let d=await o.Ua();for(;d;){const g=await c.la(d);g&&a._updateProgress(g),d=await o.Ua()}const f=await c.complete();return await Hs(i,f.Ia,void 0),await function(y,E){const A=Ae(y);return A.persistence.runTransaction("Save bundle","readwrite",R=>A.Gr.saveBundleMetadata(R,E))}(i.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Pa)}catch(l){return Rr("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}class Li{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=hc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return RI(this.persistence,new PI,e.initialUser,this.serializer)}Ga(e){return new Um(Rh.Zr,this.serializer)}Wa(e){return new MI}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Li.provider={build:()=>new Li};class S2 extends Li{constructor(e){super(),this.cacheSizeBytes=e}ja(e,t){Ne(this.persistence.referenceDelegate instanceof Kd);const r=this.persistence.referenceDelegate.garbageCollector;return new EI(r,e.asyncQueue,t)}Ga(e){const t=this.cacheSizeBytes!==void 0?jn.withCacheSize(this.cacheSizeBytes):jn.DEFAULT;return new Um(r=>Kd.Zr(r,t),this.serializer)}}class ig extends Li{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await sg(this.Ja.syncEngine),await bl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return RI(this.persistence,new PI,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new EI(r,e.asyncQueue,t)}Ha(e,t){const r=new QR(t,this.persistence);return new WR(e.asyncQueue,r)}Ga(e){const t=Bm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?jn.withCacheSize(this.cacheSizeBytes):jn.DEFAULT;return new jm(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,LI(),vd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new MI}}class XI extends ig{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Uf&&(this.sharedClientState.syncEngine={no:w2.bind(null,t),ro:x2.bind(null,t),io:T2.bind(null,t),Qi:E2.bind(null,t),eo:b2.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await I2(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=LI();if(!Uf.D(t))throw new pe(Y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Bm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Uf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Fi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>P0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=v2.bind(null,this.syncEngine),await Op(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Zk}()}createDatastore(e){const t=hc(e.databaseInfo.databaseId),r=function(i){return new Mk(i)}(e.databaseInfo);return function(i,o,a,l){return new $k(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new jk(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>P0(this.syncEngine,t,0),function(){return I0.D()?new I0:new Nk}())}createSyncEngine(e,t){return function(s,i,o,a,l,c,d){const f=new o2(s,i,o,a,l,c);return d&&(f.Qa=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Ae(s);fe("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await _l(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Fi.provider={build:()=>new Fi};function C0(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):an("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P2{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Pn,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);const s=await this.iu(r);return new n2(JSON.parse(s),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R2{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new pe(Y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(s,i){const o=Ae(s),a={documents:i.map(f=>ju(o.serializer,f))},l=await o.Lo("BatchGetDocuments",o.serializer.databaseId,ot.emptyPath(),a,i.length),c=new Map;l.forEach(f=>{const g=GC(o.serializer,f);c.set(g.key.toString(),g)});const d=[];return i.forEach(f=>{const g=c.get(f.toString());Ne(!!g),d.push(g)}),d}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new yl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const s=Re.fromPath(r);this.mutations.push(new Cm(s,this.precondition(s)))}),await async function(r,s){const i=Ae(r),o={writes:s.map(a=>Bu(i.serializer,a))};await i.Mo("Commit",i.serializer.databaseId,ot.emptyPath(),o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ce();t=$e.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new pe(Y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($e.min())?qt.exists(!1):qt.updateTime(t):qt.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($e.min()))throw new pe(Y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qt.updateTime(t)}return qt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this._u=r.maxAttempts,this.t_=new Km(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new R2(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(s=>{this.lu(s)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const t=this.updateFunction(e);return!ic(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!Zw(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k2{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Sn.UNAUTHENTICATED,this.clientId=cw.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{fe("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(fe("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Pn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Il(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Bf(n,e){n.asyncQueue.verifyOperationInProgress(),fe("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await CI(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function k0(n,e){n.asyncQueue.verifyOperationInProgress();const t=await og(n);fe("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>E0(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>E0(e.remoteStore,s)),n._onlineComponents=e}async function og(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){fe("FirestoreClient","Using user provided OfflineComponentProvider");try{await Bf(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Y.FAILED_PRECONDITION||s.code===Y.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Rr("Error using user provided cache. Falling back to memory cache: "+t),await Bf(n,new Li)}}else fe("FirestoreClient","Using default OfflineComponentProvider"),await Bf(n,new Li);return n._offlineComponents}async function Nh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(fe("FirestoreClient","Using user provided OnlineComponentProvider"),await k0(n,n._uninitializedComponentsProvider._online)):(fe("FirestoreClient","Using default OnlineComponentProvider"),await k0(n,new Fi))),n._onlineComponents}function ZI(n){return og(n).then(e=>e.persistence)}function El(n){return og(n).then(e=>e.localStore)}function eE(n){return Nh(n).then(e=>e.remoteStore)}function ag(n){return Nh(n).then(e=>e.syncEngine)}function tE(n){return Nh(n).then(e=>e.datastore)}async function ol(n){const e=await Nh(n),t=e.eventManager;return t.onListen=a2.bind(null,e.syncEngine),t.onUnlisten=u2.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=l2.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=c2.bind(null,e.syncEngine),t}function D2(n){return n.asyncQueue.enqueue(async()=>{const e=await ZI(n),t=await eE(n);return e.setNetworkEnabled(!0),function(s){const i=Ae(s);return i.L_.delete(0),fc(i)}(t)})}function N2(n){return n.asyncQueue.enqueue(async()=>{const e=await ZI(n),t=await eE(n);return e.setNetworkEnabled(!1),async function(s){const i=Ae(s);i.L_.add(0),await _l(i),i.q_.set("Offline")}(t)})}function V2(n,e){const t=new Pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await function(c,d){const f=Ae(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new pe(Y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const l=Il(a,`Failed to get document '${i} from cache`);o.reject(l)}}(await El(n),e,t)),t.promise}function nE(n,e,t={}){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Dh({next:g=>{d.Za(),o.enqueueAndForget(()=>Ym(i,f));const y=g.docs.has(a);!y&&g.fromCache?c.reject(new pe(Y.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&l&&l.source==="server"?c.reject(new pe(Y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Zm(gl(a.path),d,{includeMetadataChanges:!0,_a:!0});return Jm(i,f)}(await ol(n),n.asyncQueue,e,t,r)),r.promise}function O2(n,e){const t=new Pn;return n.asyncQueue.enqueueAndForget(async()=>async function(s,i,o){try{const a=await Gd(s,i,!0),l=new HI(i,a.Ts),c=l.ma(a.documents),d=l.applyChanges(c,!1);o.resolve(d.snapshot)}catch(a){const l=Il(a,`Failed to execute query '${i} against cache`);o.reject(l)}}(await El(n),e,t)),t.promise}function rE(n,e,t={}){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const d=new Dh({next:g=>{d.Za(),o.enqueueAndForget(()=>Ym(i,f)),g.fromCache&&l.source==="server"?c.reject(new pe(Y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Zm(a,d,{includeMetadataChanges:!0,_a:!0});return Jm(i,f)}(await ol(n),n.asyncQueue,e,t,r)),r.promise}function M2(n,e,t){const r=new Pn;return n.asyncQueue.enqueueAndForget(async()=>{try{const s=await tE(n);r.resolve(async function(o,a,l){var c;const d=Ae(o),{request:f,ut:g,parent:y}=dI(d.serializer,Mw(a),l);d.connection.Fo||delete f.parent;const E=(await d.Lo("RunAggregationQuery",d.serializer.databaseId,y,f,1)).filter(R=>!!R.result);Ne(E.length===1);const A=(c=E[0].result)===null||c===void 0?void 0:c.aggregateFields;return Object.keys(A).reduce((R,B)=>(R[g[B]]=A[B],R),{})}(s,e,t))}catch(s){r.reject(s)}}),r.promise}function L2(n,e){const t=new Dh(e);return n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ae(s).Y_.add(i),i.next()}(await ol(n),t)),()=>{t.Za(),n.asyncQueue.enqueueAndForget(async()=>function(s,i){Ae(s).Y_.delete(i)}(await ol(n),t))}}function F2(n,e,t,r){const s=function(o,a){let l;return l=typeof o=="string"?tI().encode(o):o,function(d,f){return new P2(d,f)}(function(d,f){if(d instanceof Uint8Array)return C0(d,f);if(d instanceof ArrayBuffer)return C0(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,hc(e));n.asyncQueue.enqueueAndForget(async()=>{A2(await ag(n),s,r)})}function $2(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){const i=Ae(r);return i.persistence.runTransaction("Get named query","readonly",o=>i.Gr.getNamedQuery(o,s))}(await El(n),e))}function U2(n,e){return n.asyncQueue.enqueue(async()=>async function(r,s){const i=Ae(r),o=i.indexManager,a=[];return i.persistence.runTransaction("Configure indexes","readwrite",l=>o.getFieldIndexes(l).next(c=>function(f,g,y,E,A){f=[...f],g=[...g],f.sort(y),g.sort(y);const R=f.length,B=g.length;let q=0,F=0;for(;q<B&&F<R;){const z=y(f[F],g[q]);z<0?A(f[F++]):z>0?E(g[q++]):(q++,F++)}for(;q<B;)E(g[q++]);for(;F<R;)A(f[F++])}(c,s,zR,d=>{a.push(o.addFieldIndex(l,d))},d=>{a.push(o.deleteFieldIndex(l,d))})).next(()=>G.waitFor(a)))}(await El(n),e))}function j2(n,e){return n.asyncQueue.enqueue(async()=>function(r,s){Ae(r).ss.zi=s}(await El(n),e))}function B2(n){return n.asyncQueue.enqueue(async()=>function(t){const r=Ae(t),s=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",i=>s.deleteAllFieldIndexes(i))}(await El(n)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sE(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(n,e,t){if(!t)throw new pe(Y.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function q2(n,e,t,r){if(e===!0&&r===!0)throw new pe(Y.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function N0(n){if(!Re.isDocumentKey(n))throw new pe(Y.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function V0(n){if(Re.isDocumentKey(n))throw new pe(Y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Vh(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ce()}function nt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new pe(Y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Vh(n);throw new pe(Y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function iE(n,e){if(e<=0)throw new pe(Y.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new pe(Y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}q2("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=sE((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new pe(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new pe(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new pe(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pc{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new O0({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new pe(Y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new pe(Y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new O0(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new MR;switch(r.type){case"firstParty":return new UR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new pe(Y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=D0.get(t);r&&(fe("ComponentProvider","Removing Datastore"),D0.delete(t),r.terminate())}(this),Promise.resolve()}}function z2(n,e,t,r={}){var s;const i=(n=nt(n,pc))._getSettings(),o=`${e}:${t}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&Rr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Sn.MOCK_USER;else{a=hP(r.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new pe(Y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Sn(c)}n._authCredentials=new LR(new lw(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Fn(this.firestore,e,this._query)}}class cn{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ls(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cn(this.firestore,e,this._key)}}class ls extends Fn{constructor(e,t,r){super(e,t,gl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cn(this.firestore,null,new Re(e))}withConverter(e){return new ls(this.firestore,e,this._path)}}function Ye(n,e,...t){if(n=Oe(n),lg("collection","path",e),n instanceof pc){const r=ot.fromString(e,...t);return V0(r),new ls(n,null,r)}{if(!(n instanceof cn||n instanceof ls))throw new pe(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ot.fromString(e,...t));return V0(r),new ls(n.firestore,null,r)}}function OB(n,e){if(n=nt(n,pc),lg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new pe(Y.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Fn(n,null,function(r){return new zs(ot.emptyPath(),r)}(e))}function Pe(n,e,...t){if(n=Oe(n),arguments.length===1&&(e=cw.newId()),lg("doc","path",e),n instanceof pc){const r=ot.fromString(e,...t);return N0(r),new cn(n,null,new Re(r))}{if(!(n instanceof cn||n instanceof ls))throw new pe(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ot.fromString(e,...t));return N0(r),new cn(n.firestore,n instanceof ls?n.converter:null,new Re(r))}}function MB(n,e){return n=Oe(n),e=Oe(e),(n instanceof cn||n instanceof ls)&&(e instanceof cn||e instanceof ls)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function oE(n,e){return n=Oe(n),e=Oe(e),n instanceof Fn&&e instanceof Fn&&n.firestore===e.firestore&&ac(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Km(this,"async_queue_retry"),this.Vu=()=>{const r=vd();r&&fe("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=vd();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=vd();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Pn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!qi(e))throw e;fe("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw an("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Qm.createAndSchedule(this,e,t,r,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&Ce()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Fp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(n,["next","error","complete"])}class K2{constructor(){this._progressObserver={},this._taskCompletionResolver=new Pn,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LB=-1;class kt extends pc{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new M0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new M0(e),this._firestoreClient=void 0,await e}}}function FB(n,e,t){t||(t="(default)");const r=ji(n,"firestore");if(r.isInitialized(t)){const s=r.getImmediate({identifier:t}),i=r.getOptions(t);if(ki(i,e))return s;throw new pe(Y.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new pe(Y.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new pe(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function G2(n,e){const t=typeof n=="object"?n:wm(),r=typeof n=="string"?n:e||"(default)",s=ji(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=cP("firestore");i&&z2(s,...i)}return s}function Ht(n){if(n._terminated)throw new pe(Y.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||aE(n),n._firestoreClient}function aE(n){var e,t,r;const s=n._freezeSettings(),i=function(a,l,c,d){return new gC(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,sE(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new k2(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}function H2(n,e){Rr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings();return lE(n,Fi.provider,{build:r=>new ig(r,t.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function $B(n){Rr("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=n._freezeSettings();lE(n,Fi.provider,{build:t=>new XI(t,e.cacheSizeBytes)})}function lE(n,e,t){if((n=nt(n,kt))._firestoreClient||n._terminated)throw new pe(Y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new pe(Y.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},aE(n)}function UB(n){if(n._initialized&&!n._terminated)throw new pe(Y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Pn;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!os.D())return Promise.resolve();const s=r+"main";await os.delete(s)}(Bm(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function jB(n){return function(t){const r=new Pn;return t.asyncQueue.enqueueAndForget(async()=>m2(await ag(t),r)),r.promise}(Ht(n=nt(n,kt)))}function BB(n){return D2(Ht(n=nt(n,kt)))}function qB(n){return N2(Ht(n=nt(n,kt)))}function zB(n){return IR(n.app,"firestore",n._databaseId.database),n._delete()}function KB(n,e){const t=Ht(n=nt(n,kt)),r=new K2;return F2(t,n._databaseId,e,r),r}function GB(n,e){return $2(Ht(n=nt(n,kt)),e).then(t=>t?new Fn(n,null,t.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class W2{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wo(en.fromBase64String(e))}catch(t){throw new pe(Y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wo(en.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new pe(Y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function HB(){return new Zo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pe(Y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pe(Y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ge(this._lat,e._lat)||Ge(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q2=/^__.*__$/;class J2{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms):new vl(e,this.data,t,this.fieldTransforms)}}class uE{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Gs(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ce()}}class Mh{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Mh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Jd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(cE(this.Cu)&&Q2.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Y2{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||hc(e)}Qu(e,t,r,s=!1){return new Mh({Cu:e,methodName:t,qu:r,path:Bt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ta(n){const e=n._freezeSettings(),t=hc(n._databaseId);return new Y2(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Lh(n,e,t,r,s,i={}){const o=n.Qu(i.merge||i.mergeFields?2:0,e,t,s);gg("Data must be an object, but it was:",o,r);const a=fE(r,o);let l,c;if(i.merge)l=new ir(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const d=[];for(const f of i.mergeFields){const g=zu(e,f,t);if(!o.contains(g))throw new pe(Y.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);mE(d,g)||d.push(g)}l=new ir(d),c=o.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=o.fieldTransforms;return new J2(new Ln(a),l,c)}class mc extends ea{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mc}}function dE(n,e,t){return new Mh({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class cg extends ea{_toFieldTransform(e){return new uc(e.path,new Xa)}isEqual(e){return e instanceof cg}}class dg extends ea{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=dE(this,e,!0),r=this.Ku.map(i=>na(i,t)),s=new qo(r);return new uc(e.path,s)}isEqual(e){return e instanceof dg&&ki(this.Ku,e.Ku)}}class hg extends ea{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=dE(this,e,!0),r=this.Ku.map(i=>na(i,t)),s=new zo(r);return new uc(e.path,s)}isEqual(e){return e instanceof hg&&ki(this.Ku,e.Ku)}}class fg extends ea{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Za(e.serializer,Kw(e.serializer,this.$u));return new uc(e.path,t)}isEqual(e){return e instanceof fg&&this.$u===e.$u}}function pg(n,e,t,r){const s=n.Qu(1,e,t);gg("Data must be an object, but it was:",s,r);const i=[],o=Ln.empty();zi(r,(l,c)=>{const d=Fh(e,l,t);c=Oe(c);const f=s.Nu(d);if(c instanceof mc)i.push(d);else{const g=na(c,f);g!=null&&(i.push(d),o.set(d,g))}});const a=new ir(i);return new uE(o,a,s.fieldTransforms)}function mg(n,e,t,r,s,i){const o=n.Qu(1,e,t),a=[zu(e,r,t)],l=[s];if(i.length%2!=0)throw new pe(Y.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<i.length;g+=2)a.push(zu(e,i[g])),l.push(i[g+1]);const c=[],d=Ln.empty();for(let g=a.length-1;g>=0;--g)if(!mE(c,a[g])){const y=a[g];let E=l[g];E=Oe(E);const A=o.Nu(y);if(E instanceof mc)c.push(y);else{const R=na(E,A);R!=null&&(c.push(y),d.set(y,R))}}const f=new ir(c);return new uE(d,f,o.fieldTransforms)}function hE(n,e,t,r=!1){return na(t,n.Qu(r?4:3,e))}function na(n,e){if(pE(n=Oe(n)))return gg("Unsupported field value:",e,n),fE(n,e);if(n instanceof ea)return function(r,s){if(!cE(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=na(a,s.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(n,e)}return function(r,s){if((r=Oe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Kw(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Gt.fromDate(r);return{timestampValue:el(s.serializer,i)}}if(r instanceof Gt){const i=new Gt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:el(s.serializer,i)}}if(r instanceof ug)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Wo)return{bytesValue:sI(s.serializer,r._byteString)};if(r instanceof cn){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Om(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Oh)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return Rm(a.serializer,l)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Vh(r)}`)}(n,e)}function fE(n,e){const t={};return Ew(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zi(n,(r,s)=>{const i=na(s,e.Mu(r));i!=null&&(t[r]=i)}),{mapValue:{fields:t}}}function pE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Gt||n instanceof ug||n instanceof Wo||n instanceof cn||n instanceof ea||n instanceof Oh)}function gg(n,e,t){if(!pE(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const r=Vh(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function zu(n,e,t){if((e=Oe(e))instanceof Zo)return e._internalPath;if(typeof e=="string")return Fh(n,e);throw Jd("Field path arguments must be of type string or ",n,!1,void 0,t)}const X2=new RegExp("[~\\*/\\[\\]]");function Fh(n,e,t){if(e.search(X2)>=0)throw Jd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Zo(...e.split("."))._internalPath}catch{throw Jd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Jd(n,e,t,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new pe(Y.INVALID_ARGUMENT,a+n+l)}function mE(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new cn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Z2(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field($h("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Z2 extends Ku{data(){return super.data()}}function $h(n,e){return typeof e=="string"?Fh(n,e):e instanceof Zo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new pe(Y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vg{}class gc extends vg{}function Gu(n,e,...t){let r=[];e instanceof vg&&r.push(e),r=r.concat(t),function(i){const o=i.filter(l=>l instanceof xl).length,a=i.filter(l=>l instanceof vc).length;if(o>1||o>0&&a>0)throw new pe(Y.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class vc extends gc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new vc(e,t,r)}_apply(e){const t=this._parse(e);return yE(e._query,t),new Fn(e.firestore,e.converter,Ap(e._query,t))}_parse(e){const t=ta(e.firestore);return function(i,o,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new pe(Y.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){F0(f,d);const y=[];for(const E of f)y.push(L0(l,i,E));g={arrayValue:{values:y}}}else g=L0(l,i,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||F0(f,d),g=hE(a,o,f,d==="in"||d==="not-in");return at.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Yd(n,e,t){const r=e,s=$h("where",n);return vc._create(s,r,t)}class xl extends vg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new xl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:At.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)yE(o,l),o=Ap(o,l)}(e._query,t),new Fn(e.firestore,e.converter,Ap(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function WB(...n){return n.forEach(e=>_E("or",e)),xl._create("or",n)}function QB(...n){return n.forEach(e=>_E("and",e)),xl._create("and",n)}class yg extends gc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new yg(e,t)}_apply(e){const t=function(s,i,o){if(s.startAt!==null)throw new pe(Y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new pe(Y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Uu(i,o)}(e._query,this._field,this._direction);return new Fn(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new zs(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function eD(n,e="asc"){const t=e,r=$h("orderBy",n);return yg._create(r,t)}class Uh extends gc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Uh(e,t,r)}_apply(e){return new Fn(e.firestore,e.converter,Ud(e._query,this._limit,this._limitType))}}function JB(n){return iE("limit",n),Uh._create("limit",n,"F")}function YB(n){return iE("limitToLast",n),Uh._create("limitToLast",n,"L")}class jh extends gc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new jh(e,t,r)}_apply(e){const t=vE(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new zs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,t))}}function XB(...n){return jh._create("startAt",n,!0)}function ZB(...n){return jh._create("startAfter",n,!1)}class Bh extends gc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Bh(e,t,r)}_apply(e){const t=vE(e,this.type,this._docOrFields,this._inclusive);return new Fn(e.firestore,e.converter,function(s,i){return new zs(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,t))}}function eq(...n){return Bh._create("endBefore",n,!1)}function tq(...n){return Bh._create("endAt",n,!0)}function vE(n,e,t,r){if(t[0]=Oe(t[0]),t[0]instanceof Ku)return function(i,o,a,l,c){if(!l)throw new pe(Y.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const d=[];for(const f of La(i))if(f.field.isKeyField())d.push(jo(o,l.key));else{const g=l.data.field(f.field);if(wh(g))throw new pe(Y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){const y=f.field.canonicalString();throw new pe(Y.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new Oi(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ta(n.firestore);return function(o,a,l,c,d,f){const g=o.explicitOrderBy;if(d.length>g.length)throw new pe(Y.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const y=[];for(let E=0;E<d.length;E++){const A=d[E];if(g[E].field.isKeyField()){if(typeof A!="string")throw new pe(Y.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof A}`);if(!Sm(o)&&A.indexOf("/")!==-1)throw new pe(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${A}' contains a slash.`);const R=o.path.child(ot.fromString(A));if(!Re.isDocumentKey(R))throw new pe(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const B=new Re(R);y.push(jo(a,B))}else{const R=hE(l,c,A);y.push(R)}}return new Oi(y,f)}(n._query,n.firestore._databaseId,s,e,t,r)}}function L0(n,e,t){if(typeof(t=Oe(t))=="string"){if(t==="")throw new pe(Y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Sm(e)&&t.indexOf("/")!==-1)throw new pe(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ot.fromString(t));if(!Re.isDocumentKey(r))throw new pe(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return jo(n,new Re(r))}if(t instanceof cn)return jo(n,t._key);throw new pe(Y.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vh(t)}.`)}function F0(n,e){if(!Array.isArray(n)||n.length===0)throw new pe(Y.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function yE(n,e){const t=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new pe(Y.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new pe(Y.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function _E(n,e){if(!(e instanceof vc||e instanceof xl))throw new pe(Y.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class bE{convertValue(e,t="none"){switch(Ni(e)){case 0:return null;case 1:return e.booleanValue;case 2:return jt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($s(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ce()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return zi(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>jt(o.doubleValue));return new Oh(i)}convertGeoPoint(e){return new ug(jt(e.latitude),jt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ih(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Lu(e));default:return null}}convertTimestamp(e){const t=Fs(e);return new Gt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ot.fromString(e);Ne(mI(r));const s=new Uo(r.get(1),r.get(3)),i=new Re(r.popFirst(5));return s.isEqual(t)||an(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class tD extends bE{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,t)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nq(n){return new qu("sum",zu("sum",n))}function rq(n){return new qu("avg",zu("average",n))}function nD(){return new qu("count")}function sq(n,e){var t,r;return n instanceof qu&&e instanceof qu&&n.aggregateType===e.aggregateType&&((t=n._internalFieldPath)===null||t===void 0?void 0:t.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function iq(n,e){return oE(n.query,e.query)&&ki(n.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class al extends Ku{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new yd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field($h("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class yd extends al{data(e={}){return super.data(e)}}class ll{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Do(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new yd(this._firestore,this._userDataWriter,r.key,r,new Do(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new pe(Y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new yd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Do(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new yd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Do(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,d=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:rD(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function rD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ce()}}function oq(n,e){return n instanceof al&&e instanceof al?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ll&&e instanceof ll&&n._firestore===e._firestore&&oE(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zt(n){n=nt(n,cn);const e=nt(n.firestore,kt);return nE(Ht(e),n._key).then(t=>_g(e,n,t))}class Gi extends bE{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wo(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,t)}}function aq(n){n=nt(n,cn);const e=nt(n.firestore,kt),t=Ht(e),r=new Gi(e);return V2(t,n._key).then(s=>new al(e,r,n._key,s,new Do(s!==null&&s.hasLocalMutations,!0),n.converter))}function lq(n){n=nt(n,cn);const e=nt(n.firestore,kt);return nE(Ht(e),n._key,{source:"server"}).then(t=>_g(e,n,t))}function Et(n){n=nt(n,Fn);const e=nt(n.firestore,kt),t=Ht(e),r=new Gi(e);return gE(n._query),rE(t,n._query).then(s=>new ll(e,r,n,s))}function uq(n){n=nt(n,Fn);const e=nt(n.firestore,kt),t=Ht(e),r=new Gi(e);return O2(t,n._query).then(s=>new ll(e,r,n,s))}function cq(n){n=nt(n,Fn);const e=nt(n.firestore,kt),t=Ht(e),r=new Gi(e);return rE(t,n._query,{source:"server"}).then(s=>new ll(e,r,n,s))}function Zt(n,e,t){n=nt(n,cn);const r=nt(n.firestore,kt),s=qh(n.converter,e,t);return yc(r,[Lh(ta(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,qt.none())])}function Tl(n,e,t,...r){n=nt(n,cn);const s=nt(n.firestore,kt),i=ta(s);let o;return o=typeof(e=Oe(e))=="string"||e instanceof Zo?mg(i,"updateDoc",n._key,e,t,r):pg(i,"updateDoc",n._key,e),yc(s,[o.toMutation(n._key,qt.exists(!0))])}function ul(n){return yc(nt(n.firestore,kt),[new yl(n._key,qt.none())])}function Al(n,e){const t=nt(n.firestore,kt),r=Pe(n),s=qh(n.converter,e);return yc(t,[Lh(ta(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,qt.exists(!1))]).then(()=>r)}function dq(n,...e){var t,r,s;n=Oe(n);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Fp(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Fp(e[o])){const f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(s=f.complete)===null||s===void 0?void 0:s.bind(f)}let l,c,d;if(n instanceof cn)c=nt(n.firestore,kt),d=gl(n._key.path),l={next:f=>{e[o]&&e[o](_g(c,n,f))},error:e[o+1],complete:e[o+2]};else{const f=nt(n,Fn);c=nt(f.firestore,kt),d=f._query;const g=new Gi(c);l={next:y=>{e[o]&&e[o](new ll(c,g,f,y))},error:e[o+1],complete:e[o+2]},gE(n._query)}return function(g,y,E,A){const R=new Dh(A),B=new Zm(y,R,E);return g.asyncQueue.enqueueAndForget(async()=>Jm(await ol(g),B)),()=>{R.Za(),g.asyncQueue.enqueueAndForget(async()=>Ym(await ol(g),B))}}(Ht(c),d,a,l)}function hq(n,e){return L2(Ht(n=nt(n,kt)),Fp(e)?e:{next:e})}function yc(n,e){return function(r,s){const i=new Pn;return r.asyncQueue.enqueueAndForget(async()=>d2(await ag(r),s,i)),i.promise}(Ht(n),e)}function _g(n,e,t){const r=t.docs.get(e._key),s=new Gi(n);return new al(n,s,e._key,r,new Do(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fq(n){return sD(n,{count:nD()})}function sD(n,e){const t=nt(n.firestore,kt),r=Ht(t),s=Iw(e,(i,o)=>new Xw(o,i.aggregateType,i._internalFieldPath));return M2(r,n._query,s).then(i=>function(a,l,c){const d=new Gi(a);return new W2(l,d,c)}(t,n,i))}class iD{constructor(e){this.kind="memory",this._onlineComponentProvider=Fi.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Li.provider}toJSON(){return{kind:this.kind}}}class oD{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=dD(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class aD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Li.provider}toJSON(){return{kind:this.kind}}}class lD{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new S2(e)}}toJSON(){return{kind:this.kind}}}function pq(){return new aD}function mq(n){return new lD(n==null?void 0:n.cacheSizeBytes)}function gq(n){return new iD(n)}function vq(n){return new oD(n)}class uD{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Fi.provider,this._offlineComponentProvider={build:t=>new ig(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class cD{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Fi.provider,this._offlineComponentProvider={build:t=>new XI(t,e==null?void 0:e.cacheSizeBytes)}}}function dD(n){return new uD(n==null?void 0:n.forceOwnership)}function yq(){return new cD}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fD{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ta(e)}set(e,t,r){this._verifyNotCommitted();const s=vi(e,this._firestore),i=qh(s.converter,t,r),o=Lh(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,r);return this._mutations.push(o.toMutation(s._key,qt.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=vi(e,this._firestore);let o;return o=typeof(t=Oe(t))=="string"||t instanceof Zo?mg(this._dataReader,"WriteBatch.update",i._key,t,r,s):pg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,qt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=vi(e,this._firestore);return this._mutations=this._mutations.concat(new yl(t._key,qt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new pe(Y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function vi(n,e){if((n=Oe(n)).firestore!==e)throw new pe(Y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ta(t)}get(t){const r=vi(t,this._firestore),s=new tD(this._firestore);return this._transaction.lookup([r._key]).then(i=>{if(!i||i.length!==1)return Ce();const o=i[0];if(o.isFoundDocument())return new Ku(this._firestore,s,o.key,o,r.converter);if(o.isNoDocument())return new Ku(this._firestore,s,r._key,null,r.converter);throw Ce()})}set(t,r,s){const i=vi(t,this._firestore),o=qh(i.converter,r,s),a=Lh(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,s);return this._transaction.set(i._key,a),this}update(t,r,s,...i){const o=vi(t,this._firestore);let a;return a=typeof(r=Oe(r))=="string"||r instanceof Zo?mg(this._dataReader,"Transaction.update",o._key,r,s,i):pg(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=vi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=vi(e,this._firestore),r=new Gi(this._firestore);return super.get(e).then(s=>new al(this._firestore,r,t._key,s._document,new Do(!1,!1),t.converter))}}function bq(n,e,t){n=nt(n,kt);const r=Object.assign(Object.assign({},hD),t);return function(i){if(i.maxAttempts<1)throw new pe(Y.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,o,a){const l=new Pn;return i.asyncQueue.enqueueAndForget(async()=>{const c=await tE(i);new C2(i.asyncQueue,c,a,o,l).au()}),l.promise}(Ht(n),s=>e(new pD(n,s)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wq(){return new mc("deleteField")}function Hi(){return new cg("serverTimestamp")}function mD(...n){return new dg("arrayUnion",n)}function Iq(...n){return new hg("arrayRemove",n)}function Eq(n){return new fg("increment",n)}function xq(n){return new Oh(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bg(n){return Ht(n=nt(n,kt)),new fD(n,e=>yc(n,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tq(n,e){const t=Ht(n=nt(n,kt));if(!t._uninitializedComponentsProvider||t._uninitializedComponentsProvider._offline.kind==="memory")return Rr("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(i){const o=typeof i=="string"?function(c){try{return JSON.parse(c)}catch(d){throw new pe(Y.INVALID_ARGUMENT,"Failed to parse JSON: "+(d==null?void 0:d.message))}}(i):i,a=[];if(Array.isArray(o.indexes))for(const l of o.indexes){const c=$0(l,"collectionGroup"),d=[];if(Array.isArray(l.fields))for(const f of l.fields){const g=Fh("setIndexConfiguration",$0(f,"fieldPath"));f.arrayConfig==="CONTAINS"?d.push(new Lo(g,2)):f.order==="ASCENDING"?d.push(new Lo(g,0)):f.order==="DESCENDING"&&d.push(new Lo(g,1))}a.push(new Wa(Wa.UNKNOWN_ID,c,d,Qa.empty()))}return a}(e);return U2(t,r)}function $0(n,e){if(typeof n[e]!="string")throw new pe(Y.INVALID_ARGUMENT,"Missing string value for: "+e);return n[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function Aq(n){var e;n=nt(n,kt);const t=U0.get(n);if(t)return t;if(((e=Ht(n)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new gD(n);return U0.set(n,r),r}function Sq(n){wE(n,!0)}function Pq(n){wE(n,!1)}function Rq(n){B2(Ht(n._firestore)).then(e=>fe("deleting all persistent cache indexes succeeded")).catch(e=>Rr("deleting all persistent cache indexes failed",e))}function wE(n,e){j2(Ht(n._firestore),e).then(t=>fe(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(t=>Rr(`setting persistent cache index auto creation isEnabled=${e} failed`,t))}const U0=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cq(n){var e;const t=(e=Ht(nt(n.firestore,kt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return t===void 0?null:Ah(t,Hn(n._query))._t}function kq(n,e){var t;const r=Iw(e,(i,o)=>new Xw(o,i.aggregateType,i._internalFieldPath)),s=(t=Ht(nt(n.firestore,kt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return s===void 0?null:dI(s,Mw(n._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dq{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return wg.instance.onExistenceFilterMismatch(e)}}class wg{constructor(){this.Uu=new Map}static get instance(){return ed||(ed=new wg,function(t){if(jd)throw new Error("a TestingHooksSpi instance is already set");jd=t}(ed)),ed}et(e){this.Uu.forEach(t=>t(e))}onExistenceFilterMismatch(e){const t=Symbol(),r=this.Uu;return r.set(t,e),()=>r.delete(t)}}let ed=null;(function(e,t=!0){(function(s){ml=s})(pl),ds(new Br("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new kt(new FR(r.getProvider("auth-internal")),new jR(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new pe(Y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Uo(c.options.projectId,d)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Sr(Ry,"4.7.3",e),Sr(Ry,"4.7.3","esm2017")})();function Ig(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nq={PHONE:"phone",TOTP:"totp"},Vq={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Oq={EMAIL_LINK:"emailLink",EMAIL_PASSWORD:"password",FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PHONE:"phone",TWITTER:"twitter.com"},Mq={LINK:"link",REAUTHENTICATE:"reauthenticate",SIGN_IN:"signIn"},Lq={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vD(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function IE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Fq=vD,yD=IE,EE=new Xo("auth","Firebase",IE()),$q={ADMIN_ONLY_OPERATION:"auth/admin-restricted-operation",ARGUMENT_ERROR:"auth/argument-error",APP_NOT_AUTHORIZED:"auth/app-not-authorized",APP_NOT_INSTALLED:"auth/app-not-installed",CAPTCHA_CHECK_FAILED:"auth/captcha-check-failed",CODE_EXPIRED:"auth/code-expired",CORDOVA_NOT_READY:"auth/cordova-not-ready",CORS_UNSUPPORTED:"auth/cors-unsupported",CREDENTIAL_ALREADY_IN_USE:"auth/credential-already-in-use",CREDENTIAL_MISMATCH:"auth/custom-token-mismatch",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"auth/requires-recent-login",DEPENDENT_SDK_INIT_BEFORE_AUTH:"auth/dependent-sdk-initialized-before-auth",DYNAMIC_LINK_NOT_ACTIVATED:"auth/dynamic-link-not-activated",EMAIL_CHANGE_NEEDS_VERIFICATION:"auth/email-change-needs-verification",EMAIL_EXISTS:"auth/email-already-in-use",EMULATOR_CONFIG_FAILED:"auth/emulator-config-failed",EXPIRED_OOB_CODE:"auth/expired-action-code",EXPIRED_POPUP_REQUEST:"auth/cancelled-popup-request",INTERNAL_ERROR:"auth/internal-error",INVALID_API_KEY:"auth/invalid-api-key",INVALID_APP_CREDENTIAL:"auth/invalid-app-credential",INVALID_APP_ID:"auth/invalid-app-id",INVALID_AUTH:"auth/invalid-user-token",INVALID_AUTH_EVENT:"auth/invalid-auth-event",INVALID_CERT_HASH:"auth/invalid-cert-hash",INVALID_CODE:"auth/invalid-verification-code",INVALID_CONTINUE_URI:"auth/invalid-continue-uri",INVALID_CORDOVA_CONFIGURATION:"auth/invalid-cordova-configuration",INVALID_CUSTOM_TOKEN:"auth/invalid-custom-token",INVALID_DYNAMIC_LINK_DOMAIN:"auth/invalid-dynamic-link-domain",INVALID_EMAIL:"auth/invalid-email",INVALID_EMULATOR_SCHEME:"auth/invalid-emulator-scheme",INVALID_IDP_RESPONSE:"auth/invalid-credential",INVALID_LOGIN_CREDENTIALS:"auth/invalid-credential",INVALID_MESSAGE_PAYLOAD:"auth/invalid-message-payload",INVALID_MFA_SESSION:"auth/invalid-multi-factor-session",INVALID_OAUTH_CLIENT_ID:"auth/invalid-oauth-client-id",INVALID_OAUTH_PROVIDER:"auth/invalid-oauth-provider",INVALID_OOB_CODE:"auth/invalid-action-code",INVALID_ORIGIN:"auth/unauthorized-domain",INVALID_PASSWORD:"auth/wrong-password",INVALID_PERSISTENCE:"auth/invalid-persistence-type",INVALID_PHONE_NUMBER:"auth/invalid-phone-number",INVALID_PROVIDER_ID:"auth/invalid-provider-id",INVALID_RECIPIENT_EMAIL:"auth/invalid-recipient-email",INVALID_SENDER:"auth/invalid-sender",INVALID_SESSION_INFO:"auth/invalid-verification-id",INVALID_TENANT_ID:"auth/invalid-tenant-id",MFA_INFO_NOT_FOUND:"auth/multi-factor-info-not-found",MFA_REQUIRED:"auth/multi-factor-auth-required",MISSING_ANDROID_PACKAGE_NAME:"auth/missing-android-pkg-name",MISSING_APP_CREDENTIAL:"auth/missing-app-credential",MISSING_AUTH_DOMAIN:"auth/auth-domain-config-required",MISSING_CODE:"auth/missing-verification-code",MISSING_CONTINUE_URI:"auth/missing-continue-uri",MISSING_IFRAME_START:"auth/missing-iframe-start",MISSING_IOS_BUNDLE_ID:"auth/missing-ios-bundle-id",MISSING_OR_INVALID_NONCE:"auth/missing-or-invalid-nonce",MISSING_MFA_INFO:"auth/missing-multi-factor-info",MISSING_MFA_SESSION:"auth/missing-multi-factor-session",MISSING_PHONE_NUMBER:"auth/missing-phone-number",MISSING_SESSION_INFO:"auth/missing-verification-id",MODULE_DESTROYED:"auth/app-deleted",NEED_CONFIRMATION:"auth/account-exists-with-different-credential",NETWORK_REQUEST_FAILED:"auth/network-request-failed",NULL_USER:"auth/null-user",NO_AUTH_EVENT:"auth/no-auth-event",NO_SUCH_PROVIDER:"auth/no-such-provider",OPERATION_NOT_ALLOWED:"auth/operation-not-allowed",OPERATION_NOT_SUPPORTED:"auth/operation-not-supported-in-this-environment",POPUP_BLOCKED:"auth/popup-blocked",POPUP_CLOSED_BY_USER:"auth/popup-closed-by-user",PROVIDER_ALREADY_LINKED:"auth/provider-already-linked",QUOTA_EXCEEDED:"auth/quota-exceeded",REDIRECT_CANCELLED_BY_USER:"auth/redirect-cancelled-by-user",REDIRECT_OPERATION_PENDING:"auth/redirect-operation-pending",REJECTED_CREDENTIAL:"auth/rejected-credential",SECOND_FACTOR_ALREADY_ENROLLED:"auth/second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"auth/maximum-second-factor-count-exceeded",TENANT_ID_MISMATCH:"auth/tenant-id-mismatch",TIMEOUT:"auth/timeout",TOKEN_EXPIRED:"auth/user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"auth/too-many-requests",UNAUTHORIZED_DOMAIN:"auth/unauthorized-continue-uri",UNSUPPORTED_FIRST_FACTOR:"auth/unsupported-first-factor",UNSUPPORTED_PERSISTENCE:"auth/unsupported-persistence-type",UNSUPPORTED_TENANT_OPERATION:"auth/unsupported-tenant-operation",UNVERIFIED_EMAIL:"auth/unverified-email",USER_CANCELLED:"auth/user-cancelled",USER_DELETED:"auth/user-not-found",USER_DISABLED:"auth/user-disabled",USER_MISMATCH:"auth/user-mismatch",USER_SIGNED_OUT:"auth/user-signed-out",WEAK_PASSWORD:"auth/weak-password",WEB_STORAGE_UNSUPPORTED:"auth/web-storage-unsupported",ALREADY_INITIALIZED:"auth/already-initialized",RECAPTCHA_NOT_ENABLED:"auth/recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"auth/missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"auth/invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"auth/invalid-recaptcha-action",MISSING_CLIENT_TYPE:"auth/missing-client-type",MISSING_RECAPTCHA_VERSION:"auth/missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"auth/invalid-recaptcha-version",INVALID_REQ_TYPE:"auth/invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xd=new _m("@firebase/auth");function _D(n,...e){Xd.logLevel<=it.WARN&&Xd.warn(`Auth (${pl}): ${n}`,...e)}function _d(n,...e){Xd.logLevel<=it.ERROR&&Xd.error(`Auth (${pl}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ar(n,...e){throw xg(n,...e)}function er(n,...e){return xg(n,...e)}function Eg(n,e,t){const r=Object.assign(Object.assign({},yD()),{[e]:t});return new Xo("auth","Firebase",r).create(e,{appName:n.name})}function Rn(n){return Eg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Sl(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&ar(n,"argument-error"),Eg(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function xg(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return EE.create(n,...e)}function Ie(n,e,...t){if(!n)throw xg(e,...t)}function ss(n){const e="INTERNAL ASSERTION FAILED: "+n;throw _d(e),new Error(e)}function Us(n,e){n||ss(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hu(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Tg(){return j0()==="http:"||j0()==="https:"}function j0(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Tg()||gP()||"connection"in navigator)?navigator.onLine:!0}function wD(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(e,t){this.shortDelay=e,this.longDelay=t,Us(t>e,"Short delay should be less than long delay!"),this.isMobile=fP()||vP()}get(){return bD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ag(n,e){Us(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ss("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ss("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ss("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ED=new _c(3e4,6e4);function Lt(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Ft(n,e,t,r,s={}){return TE(n,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=fl(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},i);return mP()||(c.referrerPolicy="no-referrer"),xE.fetch()(AE(n,n.config.apiHost,t,a),c)})}async function TE(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},ID),e);try{const s=new TD(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw lu(n,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw lu(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw lu(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw lu(n,"user-disabled",o);const d=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Eg(n,d,c);ar(n,d)}}catch(s){if(s instanceof fs)throw s;ar(n,"network-request-failed",{message:String(s)})}}async function Ws(n,e,t,r,s={}){const i=await Ft(n,e,t,r,s);return"mfaPendingCredential"in i&&ar(n,"multi-factor-auth-required",{_serverResponse:i}),i}function AE(n,e,t,r){const s=`${e}${t}?${r}`;return n.config.emulator?Ag(n.config,s):`${n.config.apiScheme}://${s}`}function xD(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class TD{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(er(this.auth,"network-request-failed")),ED.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function lu(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=er(n,e,r);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B0(n){return n!==void 0&&n.getResponse!==void 0}function q0(n){return n!==void 0&&n.enterprise!==void 0}class SE{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return xD(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AD(n){return(await Ft(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function PE(n,e){return Ft(n,"GET","/v2/recaptchaConfig",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SD(n,e){return Ft(n,"POST","/v1/accounts:delete",e)}async function PD(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function RE(n,e){return Ft(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tu(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uq(n,e=!1){return Oe(n).getIdToken(e)}async function RD(n,e=!1){const t=Oe(n),r=await t.getIdToken(e),s=zh(r);Ie(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:Tu(qf(s.auth_time)),issuedAtTime:Tu(qf(s.iat)),expirationTime:Tu(qf(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function qf(n){return Number(n)*1e3}function zh(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return _d("JWT malformed, contained fewer than 3 sections"),null;try{const s=Kb(t);return s?JSON.parse(s):(_d("Failed to decode base64 JWT payload"),null)}catch(s){return _d("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function z0(n){const e=zh(n);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function js(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof fs&&CD(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function CD({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Tu(this.lastLoginAt),this.creationTime=Tu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wu(n){var e;const t=n.auth,r=await n.getIdToken(),s=await js(n,RE(t,{idToken:r}));Ie(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];n._notifyReloadListener(i);const o=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?CE(i.providerUserInfo):[],a=ND(n.providerData,o),l=n.isAnonymous,c=!(n.email&&i.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new $p(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function DD(n){const e=Oe(n);await Wu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function ND(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function CE(n){return n.map(e=>{var{providerId:t}=e,r=Ig(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VD(n,e){const t=await TE(n,{},async()=>{const r=fl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,o=AE(n,s,"/v1/token",`key=${i}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",xE.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function OD(n,e){return Ft(n,"POST","/v2/accounts:revokeToken",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):z0(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const t=z0(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await VD(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,o=new $a;return r&&(Ie(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ie(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $a,this.toJSON())}_performRefresh(){return ss("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(n,e){Ie(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Rs{constructor(e){var{uid:t,auth:r,stsTokenManager:s}=e,i=Ig(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new kD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new $p(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await js(this,this.stsTokenManager.getToken(this.auth,e));return Ie(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return RD(this,e)}reload(){return DD(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Rs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Wu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ln(this.auth.app))return Promise.reject(Rn(this.auth));const e=await this.getIdToken();return await js(this,SD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,s,i,o,a,l,c,d;const f=(r=t.displayName)!==null&&r!==void 0?r:void 0,g=(s=t.email)!==null&&s!==void 0?s:void 0,y=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,E=(o=t.photoURL)!==null&&o!==void 0?o:void 0,A=(a=t.tenantId)!==null&&a!==void 0?a:void 0,R=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,B=(c=t.createdAt)!==null&&c!==void 0?c:void 0,q=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:F,emailVerified:z,isAnonymous:de,providerData:me,stsTokenManager:T}=t;Ie(F&&T,e,"internal-error");const w=$a.fromJSON(this.name,T);Ie(typeof F=="string",e,"internal-error"),ci(f,e.name),ci(g,e.name),Ie(typeof z=="boolean",e,"internal-error"),Ie(typeof de=="boolean",e,"internal-error"),ci(y,e.name),ci(E,e.name),ci(A,e.name),ci(R,e.name),ci(B,e.name),ci(q,e.name);const x=new Rs({uid:F,auth:e,email:g,emailVerified:z,displayName:f,isAnonymous:de,photoURL:E,phoneNumber:y,tenantId:A,stsTokenManager:w,createdAt:B,lastLoginAt:q});return me&&Array.isArray(me)&&(x.providerData=me.map(N=>Object.assign({},N))),R&&(x._redirectEventId=R),x}static async _fromIdTokenResponse(e,t,r=!1){const s=new $a;s.updateFromServerResponse(t);const i=new Rs({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Wu(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];Ie(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?CE(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new $a;a.updateFromIdToken(r);const l=new Rs({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new $p(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K0=new Map;function Cs(n){Us(n instanceof Function,"Expected a class definition");let e=K0.get(n);return e?(Us(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,K0.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}kE.type="NONE";const G0=kE;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(n,e,t){return`firebase:${n}:${e}:${t}`}class Ua{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=bd(this.userKey,s.apiKey,i),this.fullPersistenceKey=bd("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Rs._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Ua(Cs(G0),e,r);const s=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Cs(G0);const o=bd(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const d=await c._get(o);if(d){const f=Rs._fromJSON(e,d);c!==i&&(a=f),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new Ua(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new Ua(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H0(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(OE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(DE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(LE(e))return"Blackberry";if(FE(e))return"Webos";if(NE(e))return"Safari";if((e.includes("chrome/")||VE(e))&&!e.includes("edge/"))return"Chrome";if(ME(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function DE(n=_n()){return/firefox\//i.test(n)}function NE(n=_n()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function VE(n=_n()){return/crios\//i.test(n)}function OE(n=_n()){return/iemobile/i.test(n)}function ME(n=_n()){return/android/i.test(n)}function LE(n=_n()){return/blackberry/i.test(n)}function FE(n=_n()){return/webos/i.test(n)}function Sg(n=_n()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function MD(n=_n()){var e;return Sg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function LD(){return yP()&&document.documentMode===10}function $E(n=_n()){return Sg(n)||ME(n)||FE(n)||LE(n)||/windows phone/i.test(n)||OE(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UE(n,e=[]){let t;switch(n){case"Browser":t=H0(_n());break;case"Worker":t=`${H0(_n())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${pl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $D(n,e={}){return Ft(n,"GET","/v2/passwordPolicy",Lt(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD=6;class jD{constructor(e){var t,r,s,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:UD,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,s,i,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(i=l.containsUppercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new W0(this),this.idTokenSubscription=new W0(this),this.beforeStateQueue=new FD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=EE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Cs(t)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await Ua.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await RE(this,{idToken:e}),r=await Rs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ln(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Wu(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=wD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ln(this.app))return Promise.reject(Rn(this));const t=e?Oe(e):null;return t&&Ie(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ln(this.app)?Promise.reject(Rn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ln(this.app)?Promise.reject(Rn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Cs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $D(this),t=new jD(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Xo("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await OD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Cs(e)||this._popupRedirectResolver;Ie(t,this,"argument-error"),this.redirectPersistenceManager=await Ua.create(this,[Cs(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=UE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&_D(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function tn(n){return Oe(n)}class W0{constructor(e){this.auth=e,this.observer=null,this.addObserver=xP(t=>this.observer=t)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function qD(n){bc=n}function Pg(n){return bc.loadJS(n)}function zD(){return bc.recaptchaV2Script}function KD(){return bc.recaptchaEnterpriseScript}function GD(){return bc.gapiScript}function jE(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const HD="recaptcha-enterprise",WD="NO_RECAPTCHA";class BE{constructor(e){this.type=HD,this.auth=tn(e)}async verify(e="verify",t=!1){async function r(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{PE(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new SE(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;q0(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(WD)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,o)=>{r(this.auth).then(a=>{if(!t&&q0(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=KD();l.length!==0&&(l+=a),Pg(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Q0(n,e,t,r=!1){const s=new BE(n);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Qu(n,e,t,r){var s;if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Q0(n,e,t,t==="getOobCode");return r(n,i)}else return r(n,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Q0(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(i)})}async function QD(n){const e=tn(n),t=await PE(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new SE(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")&&new BE(e).verify()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JD(n,e){const t=ji(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(ki(i,e??{}))return s;ar(s,"already-initialized")}return t.initialize({options:e})}function YD(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Cs);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function XD(n,e,t){const r=tn(n);Ie(r._canInitEmulator,r,"emulator-config-failed"),Ie(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),i=qE(e),{host:o,port:a}=ZD(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${i}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||eN()}function qE(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function ZD(n){const e=qE(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:J0(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:J0(o)}}}function J0(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function eN(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wc{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ss("not implemented")}_getIdTokenResponse(e){return ss("not implemented")}_linkToIdToken(e,t){return ss("not implemented")}_getReauthenticationResolver(e){return ss("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zE(n,e){return Ft(n,"POST","/v1/accounts:resetPassword",Lt(n,e))}async function tN(n,e){return Ft(n,"POST","/v1/accounts:update",e)}async function nN(n,e){return Ft(n,"POST","/v1/accounts:signUp",e)}async function rN(n,e){return Ft(n,"POST","/v1/accounts:update",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sN(n,e){return Ws(n,"POST","/v1/accounts:signInWithPassword",Lt(n,e))}async function Kh(n,e){return Ft(n,"POST","/v1/accounts:sendOobCode",Lt(n,e))}async function iN(n,e){return Kh(n,e)}async function oN(n,e){return Kh(n,e)}async function aN(n,e){return Kh(n,e)}async function lN(n,e){return Kh(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uN(n,e){return Ws(n,"POST","/v1/accounts:signInWithEmailLink",Lt(n,e))}async function cN(n,e){return Ws(n,"POST","/v1/accounts:signInWithEmailLink",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju extends wc{constructor(e,t,r,s=null){super("password",r),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Ju(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Ju(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qu(e,t,"signInWithPassword",sN);case"emailLink":return uN(e,{email:this._email,oobCode:this._password});default:ar(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Qu(e,r,"signUpPassword",nN);case"emailLink":return cN(e,{idToken:t,email:this._email,oobCode:this._password});default:ar(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vs(n,e){return Ws(n,"POST","/v1/accounts:signInWithIdp",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dN="http://localhost";class Bs extends wc{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Bs(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ar("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=t,i=Ig(t,["providerId","signInMethod"]);if(!r||!s)return null;const o=new Bs(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return Vs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Vs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Vs(e,t)}buildRequest(){const e={requestUri:dN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=fl(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hN(n,e){return Ft(n,"POST","/v1/accounts:sendVerificationCode",Lt(n,e))}async function fN(n,e){return Ws(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,e))}async function pN(n,e){const t=await Ws(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,e));if(t.temporaryProof)throw lu(n,"account-exists-with-different-credential",t);return t}const mN={USER_NOT_FOUND:"user-not-found"};async function gN(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Ws(n,"POST","/v1/accounts:signInWithPhoneNumber",Lt(n,t),mN)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo extends wc{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Fo({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Fo({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return fN(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return pN(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return gN(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i}=e;return!r&&!t&&!s&&!i?null:new Fo({verificationId:t,verificationCode:r,phoneNumber:s,temporaryProof:i})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vN(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function yN(n){const e=nu(ru(n)).link,t=e?nu(ru(e)).deep_link_id:null,r=nu(ru(n)).deep_link_id;return(r?nu(ru(r)).link:null)||r||t||e||n}class Ic{constructor(e){var t,r,s,i,o,a;const l=nu(ru(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,d=(r=l.oobCode)!==null&&r!==void 0?r:null,f=vN((s=l.mode)!==null&&s!==void 0?s:null);Ie(c&&d&&f,"argument-error"),this.apiKey=c,this.operation=f,this.code=d,this.continueUrl=(i=l.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=yN(e);try{return new Ic(t)}catch{return null}}}function jq(n){return Ic.parseLink(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(){this.providerId=ra.PROVIDER_ID}static credential(e,t){return Ju._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ic.parseLink(t);return Ie(r,"argument-error"),Ju._fromEmailAndCode(e,r.code,r.tenantId)}}ra.PROVIDER_ID="password";ra.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ra.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl extends Qs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class wd extends Pl{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Ie("providerId"in t&&"signInMethod"in t,"argument-error"),Bs._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ie(e.idToken||e.accessToken,"argument-error"),Bs._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return wd.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return wd.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:i,nonce:o,providerId:a}=e;if(!r&&!s&&!t&&!i||!a)return null;try{return new wd(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:i})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi extends Pl{constructor(){super("facebook.com")}static credential(e){return Bs._fromParams({providerId:yi.PROVIDER_ID,signInMethod:yi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yi.credentialFromTaggedObject(e)}static credentialFromError(e){return yi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yi.credential(e.oauthAccessToken)}catch{return null}}}yi.FACEBOOK_SIGN_IN_METHOD="facebook.com";yi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i extends Pl{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Bs._fromParams({providerId:_i.PROVIDER_ID,signInMethod:_i.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return _i.credentialFromTaggedObject(e)}static credentialFromError(e){return _i.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return _i.credential(t,r)}catch{return null}}}_i.GOOGLE_SIGN_IN_METHOD="google.com";_i.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bi extends Pl{constructor(){super("github.com")}static credential(e){return Bs._fromParams({providerId:bi.PROVIDER_ID,signInMethod:bi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bi.credentialFromTaggedObject(e)}static credentialFromError(e){return bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bi.credential(e.oauthAccessToken)}catch{return null}}}bi.GITHUB_SIGN_IN_METHOD="github.com";bi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _N="http://localhost";class Yu extends wc{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Vs(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Vs(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Vs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,pendingToken:i}=t;return!r||!s||!i||r!==s?null:new Yu(r,i)}static _create(e,t){return new Yu(e,t)}buildRequest(){return{requestUri:_N,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bN="saml.";class Up extends Qs{constructor(e){Ie(e.startsWith(bN),"argument-error"),super(e)}static credentialFromResult(e){return Up.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Up.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Yu.fromJSON(e);return Ie(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Yu._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi extends Pl{constructor(){super("twitter.com")}static credential(e,t){return Bs._fromParams({providerId:wi.PROVIDER_ID,signInMethod:wi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return wi.credentialFromTaggedObject(e)}static credentialFromError(e){return wi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return wi.credential(t,r)}catch{return null}}}wi.TWITTER_SIGN_IN_METHOD="twitter.com";wi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KE(n,e){return Ws(n,"POST","/v1/accounts:signUp",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await Rs._fromIdTokenResponse(e,r,s),o=Y0(r);return new Cr({user:i,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=Y0(r);return new Cr({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function Y0(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wN(n){var e;if(ln(n.app))return Promise.reject(Rn(n));const t=tn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Cr({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await KE(t,{returnSecureToken:!0}),s=await Cr._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd extends fs{constructor(e,t,r,s){var i;super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Zd.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Zd(e,t,r,s)}}function GE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Zd._fromErrorAndOperation(n,i,e,r):i})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HE(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bq(n,e){const t=Oe(n);await Gh(!0,t,e);const{providerUserInfo:r}=await PD(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=HE(r||[]);return t.providerData=t.providerData.filter(i=>s.has(i.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Rg(n,e,t=!1){const r=await js(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Cr._forOperation(n,"link",r)}async function Gh(n,e,t){await Wu(e);const r=HE(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";Ie(r.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WE(n,e,t=!1){const{auth:r}=n;if(ln(r.app))return Promise.reject(Rn(r));const s="reauthenticate";try{const i=await js(n,GE(r,s,e,n),t);Ie(i.idToken,r,"internal-error");const o=zh(i.idToken);Ie(o,r,"internal-error");const{sub:a}=o;return Ie(n.uid===a,r,"user-mismatch"),Cr._forOperation(n,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ar(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QE(n,e,t=!1){if(ln(n.app))return Promise.reject(Rn(n));const r="signIn",s=await GE(n,r,e),i=await Cr._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}async function Cg(n,e){return QE(tn(n),e)}async function IN(n,e){const t=Oe(n);return await Gh(!1,t,e.providerId),Rg(t,e)}async function EN(n,e){return WE(Oe(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xN(n,e){return Ws(n,"POST","/v1/accounts:signInWithCustomToken",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qq(n,e){if(ln(n.app))return Promise.reject(Rn(n));const t=tn(n),r=await xN(t,{token:e,returnSecureToken:!0}),s=await Cr._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ec{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?kg._fromServerResponse(e,t):"totpInfo"in t?Dg._fromServerResponse(e,t):ar(e,"internal-error")}}class kg extends Ec{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new kg(t)}}class Dg extends Ec{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Dg(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(n,e,t){var r;Ie(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ie(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ie(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ie(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ng(n){const e=tn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function TN(n,e,t){const r=tn(n),s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Hh(r,s,t),await Qu(r,s,"getOobCode",oN)}async function AN(n,e,t){await zE(Oe(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ng(n),r})}async function zq(n,e){await rN(Oe(n),{oobCode:e})}async function SN(n,e){const t=Oe(n),r=await zE(t,{oobCode:e}),s=r.requestType;switch(Ie(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ie(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ie(r.mfaInfo,t,"internal-error");default:Ie(r.email,t,"internal-error")}let i=null;return r.mfaInfo&&(i=Ec._fromServerResponse(tn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:i},operation:s}}async function Kq(n,e){const{data:t}=await SN(Oe(n),e);return t.email}async function PN(n,e,t){if(ln(n.app))return Promise.reject(Rn(n));const r=tn(n),o=await Qu(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",KE).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&Ng(n),l}),a=await Cr._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function RN(n,e,t){return ln(n.app)?Promise.reject(Rn(n)):Cg(Oe(n),ra.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Ng(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gq(n,e,t){const r=tn(n),s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function i(o,a){Ie(a.handleCodeInApp,r,"argument-error"),a&&Hh(r,o,a)}i(s,t),await Qu(r,s,"getOobCode",aN)}function Hq(n,e){const t=Ic.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function Wq(n,e,t){if(ln(n.app))return Promise.reject(Rn(n));const r=Oe(n),s=ra.credentialWithLink(e,t||Hu());return Ie(s._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Cg(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CN(n,e){return Ft(n,"POST","/v1/accounts:createAuthUri",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qq(n,e){const t=Tg()?Hu():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:s}=await CN(Oe(n),r);return s||[]}async function Jq(n,e){const t=Oe(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Hh(t.auth,s,e);const{email:i}=await iN(t.auth,s);i!==n.email&&await n.reload()}async function Yq(n,e,t){const r=Oe(n),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Hh(r.auth,i,t);const{email:o}=await lN(r.auth,i);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kN(n,e){return Ft(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xq(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=Oe(n),i={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await js(r,kN(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function DN(n,e){const t=Oe(n);return ln(t.auth.app)?Promise.reject(Rn(t.auth)):JE(t,e,null)}function NN(n,e){return JE(Oe(n),null,e)}async function JE(n,e,t){const{auth:r}=n,i={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(i.email=e),t&&(i.password=t);const o=await js(n,tN(r,i));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VN(n){var e,t;if(!n)return null;const{providerId:r}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},i=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=zh(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ja(i,a)}}if(!r)return null;switch(r){case"facebook.com":return new ON(i,s);case"github.com":return new MN(i,s);case"google.com":return new LN(i,s);case"twitter.com":return new FN(i,s,n.screenName||null);case"custom":case"anonymous":return new ja(i,null);default:return new ja(i,r,s)}}class ja{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class YE extends ja{constructor(e,t,r,s){super(e,t,r),this.username=s}}class ON extends ja{constructor(e,t){super(e,"facebook.com",t)}}class MN extends YE{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class LN extends ja{constructor(e,t){super(e,"google.com",t)}}class FN extends YE{constructor(e,t,r){super(e,"twitter.com",t,r)}}function Zq(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:VN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $N(n,e){return Oe(n).setPersistence(e)}function e9(n){return QD(n)}async function t9(n,e){return tn(n).validatePassword(e)}function UN(n,e,t,r){return Oe(n).onIdTokenChanged(e,t,r)}function jN(n,e,t){return Oe(n).beforeAuthStateChanged(e,t)}function BN(n,e,t,r){return Oe(n).onAuthStateChanged(e,t,r)}function n9(n){Oe(n).useDeviceLanguage()}function r9(n,e){return Oe(n).updateCurrentUser(e)}function qN(n){return Oe(n).signOut()}function s9(n,e){return tn(n).revokeAccessToken(e)}async function i9(n){return Oe(n).delete()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new No("enroll",e,t)}static _fromMfaPendingCredential(e){return new No("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return No._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return No._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=tn(e),s=t.customData._serverResponse,i=(s.mfaInfo||[]).map(a=>Ec._fromServerResponse(r,a));Ie(s.mfaPendingCredential,r,"internal-error");const o=No._fromMfaPendingCredential(s.mfaPendingCredential);return new Vg(o,i,async a=>{const l=await a._process(r,o);delete s.mfaInfo,delete s.mfaPendingCredential;const c=Object.assign(Object.assign({},s),{idToken:l.idToken,refreshToken:l.refreshToken});switch(t.operationType){case"signIn":const d=await Cr._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return Ie(t.user,r,"internal-error"),Cr._forOperation(t.user,t.operationType,c);default:ar(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function o9(n,e){var t;const r=Oe(n),s=e;return Ie(e.customData.operationType,r,"argument-error"),Ie((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Vg._fromError(r,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Lt(n,e))}function KN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Lt(n,e))}function GN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:start",Lt(n,e))}function HN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:finalize",Lt(n,e))}function WN(n,e){return Ft(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Lt(n,e))}class Og{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Ec._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Og(e)}async getSession(){return No._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,s=await this.getSession(),i=await js(this.user,r._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const s=await js(this.user,WN(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:i})=>i!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const zf=new WeakMap;function a9(n){const e=Oe(n);return zf.has(e)||zf.set(e,Og._fromUser(e)),zf.get(e)}const eh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(eh,"1"),this.storage.removeItem(eh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QN=1e3,JN=10;class ZE extends XE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$E(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);LD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,JN):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},QN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ZE.type="LOCAL";const ex=ZE;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tx extends XE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tx.type="SESSION";const nx=tx;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YN(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new Wh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(t.origin,i)),l=await YN(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Wh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qh(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=Qh("",20);s.port1.start();const d=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const g=f;if(g.data.eventId===c)switch(g.data.status){case"ack":clearTimeout(d),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(g.data.response);break;default:clearTimeout(d),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pn(){return window}function ZN(n){pn().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mg(){return typeof pn().WorkerGlobalScope<"u"&&typeof pn().importScripts=="function"}async function eV(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function tV(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function nV(){return Mg()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rx="firebaseLocalStorageDb",rV=1,th="firebaseLocalStorage",sx="fbase_key";class xc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Jh(n,e){return n.transaction([th],e?"readwrite":"readonly").objectStore(th)}function sV(){const n=indexedDB.deleteDatabase(rx);return new xc(n).toPromise()}function jp(){const n=indexedDB.open(rx,rV);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(th,{keyPath:sx})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(th)?e(r):(r.close(),await sV(),e(await jp()))})})}async function X0(n,e,t){const r=Jh(n,!0).put({[sx]:e,value:t});return new xc(r).toPromise()}async function iV(n,e){const t=Jh(n,!1).get(e),r=await new xc(t).toPromise();return r===void 0?null:r.value}function Z0(n,e){const t=Jh(n,!0).delete(e);return new xc(t).toPromise()}const oV=800,aV=3;class ix{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await jp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>aV)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Mg()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Wh._getInstance(nV()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await eV(),!this.activeServiceWorker)return;this.sender=new XN(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||tV()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await jp();return await X0(e,eh,"1"),await Z0(e,eh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>X0(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>iV(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Z0(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Jh(s,!1).getAll();return new xc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),oV)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ix.type="LOCAL";const lV=ix;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uV(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:start",Lt(n,e))}function cV(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Lt(n,e))}function dV(n,e){return Ft(n,"POST","/v2/accounts/mfaSignIn:finalize",Lt(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hV=500,fV=6e4,td=1e12;class pV{constructor(e){this.auth=e,this.counter=td,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new mV(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||td;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||td;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||td;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class mV{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;Ie(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=gV(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},fV)},hV))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function gV(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kf=jE("rcb"),vV=new _c(3e4,6e4);class yV{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=pn().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ie(_V(t),e,"argument-error"),this.shouldResolveImmediately(t)&&B0(pn().grecaptcha)?Promise.resolve(pn().grecaptcha):new Promise((r,s)=>{const i=pn().setTimeout(()=>{s(er(e,"network-request-failed"))},vV.get());pn()[Kf]=()=>{pn().clearTimeout(i),delete pn()[Kf];const a=pn().grecaptcha;if(!a||!B0(a)){s(er(e,"internal-error"));return}const l=a.render;a.render=(c,d)=>{const f=l(c,d);return this.counter++,f},this.hostLanguage=t,r(a)};const o=`${zD()}?${fl({onload:Kf,render:"explicit",hl:t})}`;Pg(o).catch(()=>{clearTimeout(i),s(er(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=pn().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function _V(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class bV{async load(e){return new pV(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ox="recaptcha",wV={theme:"light",type:"image"};class l9{constructor(e,t,r=Object.assign({},wV)){this.parameters=r,this.type=ox,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=tn(e),this.isInvisible=this.parameters.size==="invisible",Ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof t=="string"?document.getElementById(t):t;Ie(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new bV:new yV,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(s=>{const i=o=>{o&&(this.tokenChangeListeners.delete(i),s(o))};this.tokenChangeListeners.add(i),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ie(!this.parameters.sitekey,this.auth,"argument-error"),Ie(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ie(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=pn()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ie(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ie(Tg()&&!Mg(),this.auth,"internal-error"),await IV(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await AD(this.auth);Ie(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ie(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function IV(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lg{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Fo._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function u9(n,e,t){if(ln(n.app))return Promise.reject(Rn(n));const r=tn(n),s=await Yh(r,e,Oe(t));return new Lg(s,i=>Cg(r,i))}async function c9(n,e,t){const r=Oe(n);await Gh(!1,r,"phone");const s=await Yh(r.auth,e,Oe(t));return new Lg(s,i=>IN(r,i))}async function d9(n,e,t){const r=Oe(n);if(ln(r.auth.app))return Promise.reject(Rn(r.auth));const s=await Yh(r.auth,e,Oe(t));return new Lg(s,i=>EN(r,i))}async function Yh(n,e,t){var r;const s=await t.verify();try{Ie(typeof s=="string",n,"argument-error"),Ie(t.type===ox,n,"argument-error");let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const o=i.session;if("phoneNumber"in i)return Ie(o.type==="enroll",n,"internal-error"),(await zN(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{Ie(o.type==="signin",n,"internal-error");const a=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;return Ie(a,n,"missing-multi-factor-info"),(await uV(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await hN(n,{phoneNumber:i.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function h9(n,e){const t=Oe(n);if(ln(t.auth.app))return Promise.reject(Rn(t.auth));await Rg(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e){this.providerId=Ba.PROVIDER_ID,this.auth=tn(e)}verifyPhoneNumber(e,t){return Yh(this.auth,e,Oe(t))}static credential(e,t){return Fo._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ba.credentialFromTaggedObject(t)}static credentialFromError(e){return Ba.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Fo._fromTokenResponse(t,r):null}}Ba.PROVIDER_ID="phone";Ba.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sa(n,e){return e?Cs(e):(Ie(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg extends wc{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Vs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Vs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Vs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function EV(n){return QE(n.auth,new Fg(n),n.bypassAuthState)}function xV(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),WE(t,new Fg(n),n.bypassAuthState)}async function TV(n){const{auth:e,user:t}=n;return Ie(t,e,"internal-error"),Rg(t,new Fg(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ax{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return EV;case"linkViaPopup":case"linkViaRedirect":return TV;case"reauthViaPopup":case"reauthViaRedirect":return xV;default:ar(this.auth,"internal-error")}}resolve(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Us(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AV=new _c(2e3,1e4);async function f9(n,e,t){if(ln(n.app))return Promise.reject(er(n,"operation-not-supported-in-this-environment"));const r=tn(n);Sl(n,e,Qs);const s=sa(r,t);return new ks(r,"signInViaPopup",e,s).executeNotNull()}async function p9(n,e,t){const r=Oe(n);if(ln(r.auth.app))return Promise.reject(er(r.auth,"operation-not-supported-in-this-environment"));Sl(r.auth,e,Qs);const s=sa(r.auth,t);return new ks(r.auth,"reauthViaPopup",e,s,r).executeNotNull()}async function m9(n,e,t){const r=Oe(n);Sl(r.auth,e,Qs);const s=sa(r.auth,t);return new ks(r.auth,"linkViaPopup",e,s,r).executeNotNull()}class ks extends ax{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,ks.currentPopupAction&&ks.currentPopupAction.cancel(),ks.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){Us(this.filter.length===1,"Popup operations only handle one event");const e=Qh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(er(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(er(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ks.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(er(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,AV.get())};e()}}ks.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SV="pendingRedirect",Id=new Map;class PV extends ax{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Id.get(this.auth._key());if(!e){try{const r=await RV(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Id.set(this.auth._key(),e)}return this.bypassAuthState||Id.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function RV(n,e){const t=ux(e),r=lx(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}async function $g(n,e){return lx(n)._set(ux(e),"true")}function CV(n,e){Id.set(n._key(),e)}function lx(n){return Cs(n._redirectPersistence)}function ux(n){return bd(SV,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g9(n,e,t){return kV(n,e,t)}async function kV(n,e,t){if(ln(n.app))return Promise.reject(Rn(n));const r=tn(n);Sl(n,e,Qs),await r._initializationPromise;const s=sa(r,t);return await $g(s,r),s._openRedirect(r,e,"signInViaRedirect")}function v9(n,e,t){return DV(n,e,t)}async function DV(n,e,t){const r=Oe(n);if(Sl(r.auth,e,Qs),ln(r.auth.app))return Promise.reject(Rn(r.auth));await r.auth._initializationPromise;const s=sa(r.auth,t);await $g(s,r.auth);const i=await dx(r);return s._openRedirect(r.auth,e,"reauthViaRedirect",i)}function y9(n,e,t){return NV(n,e,t)}async function NV(n,e,t){const r=Oe(n);Sl(r.auth,e,Qs),await r.auth._initializationPromise;const s=sa(r.auth,t);await Gh(!1,r,e.providerId),await $g(s,r.auth);const i=await dx(r);return s._openRedirect(r.auth,e,"linkViaRedirect",i)}async function _9(n,e){return await tn(n)._initializationPromise,cx(n,e,!1)}async function cx(n,e,t=!1){if(ln(n.app))return Promise.reject(Rn(n));const r=tn(n),s=sa(r,e),o=await new PV(r,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function dx(n){const e=Qh(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VV=10*60*1e3;class OV{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!MV(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!hx(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(er(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=VV&&this.cachedEventUids.clear(),this.cachedEventUids.has(e_(e))}saveEventToCache(e){this.cachedEventUids.add(e_(e)),this.lastProcessedEventTime=Date.now()}}function e_(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function hx({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function MV(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hx(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LV(n,e={}){return Ft(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FV=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$V=/^https?/;async function UV(n){if(n.config.emulator)return;const{authorizedDomains:e}=await LV(n);for(const t of e)try{if(jV(t))return}catch{}ar(n,"unauthorized-domain")}function jV(n){const e=Hu(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!$V.test(t))return!1;if(FV.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BV=new _c(3e4,6e4);function t_(){const n=pn().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function qV(n){return new Promise((e,t)=>{var r,s,i;function o(){t_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{t_(),t(er(n,"network-request-failed"))},timeout:BV.get()})}if(!((s=(r=pn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=pn().gapi)===null||i===void 0)&&i.load)o();else{const a=jE("iframefcb");return pn()[a]=()=>{gapi.load?o():t(er(n,"network-request-failed"))},Pg(`${GD()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw Ed=null,e})}let Ed=null;function zV(n){return Ed=Ed||qV(n),Ed}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KV=new _c(5e3,15e3),GV="__/auth/iframe",HV="emulator/auth/iframe",WV={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},QV=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JV(n){const e=n.config;Ie(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Ag(e,HV):`https://${n.config.authDomain}/${GV}`,r={apiKey:e.apiKey,appName:n.name,v:pl},s=QV.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${fl(r).slice(1)}`}async function YV(n){const e=await zV(n),t=pn().gapi;return Ie(t,n,"internal-error"),e.open({where:document.body,url:JV(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:WV,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=er(n,"network-request-failed"),a=pn().setTimeout(()=>{i(o)},KV.get());function l(){pn().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XV={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ZV=500,eO=600,tO="_blank",nO="http://localhost";class n_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rO(n,e,t,r=ZV,s=eO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},XV),{width:r.toString(),height:s.toString(),top:i,left:o}),c=_n().toLowerCase();t&&(a=VE(c)?tO:t),DE(c)&&(e=e||nO,l.scrollbars="yes");const d=Object.entries(l).reduce((g,[y,E])=>`${g}${y}=${E},`,"");if(MD(c)&&a!=="_self")return sO(e||"",a),new n_(null);const f=window.open(e||"",a,d);Ie(f,n,"popup-blocked");try{f.focus()}catch{}return new n_(f)}function sO(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iO="__/auth/handler",oO="emulator/auth/handler",aO=encodeURIComponent("fac");async function r_(n,e,t,r,s,i){Ie(n.config.authDomain,n,"auth-domain-config-required"),Ie(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:pl,eventId:s};if(e instanceof Qs){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",EP(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries(i||{}))o[d]=f}if(e instanceof Pl){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const l=await n._getAppCheckToken(),c=l?`#${aO}=${encodeURIComponent(l)}`:"";return`${lO(n)}?${fl(a).slice(1)}${c}`}function lO({config:n}){return n.emulator?Ag(n,oO):`https://${n.authDomain}/${iO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gf="webStorageSupport";class uO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=nx,this._completeRedirectFn=cx,this._overrideRedirectResult=CV}async _openPopup(e,t,r,s){var i;Us((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const o=await r_(e,t,r,Hu(),s);return rO(e,o,Qh())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await r_(e,t,r,Hu(),s);return ZN(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Us(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await YV(e),r=new OV(e);return t.register("authEvent",s=>(Ie(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gf,{type:Gf},s=>{var i;const o=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[Gf];o!==void 0&&t(!!o),ar(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=UV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return $E()||NE()||Sg()}}const cO=uO;class fx{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return ss("unexpected MultiFactorSessionType")}}}class Ug extends fx{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Ug(e)}_finalizeEnroll(e,t,r){return KN(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return cV(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class dO{constructor(){}static assertion(e){return Ug._fromCredential(e)}}dO.FACTOR_ID="phone";class hO{static assertionForEnrollment(e,t){return Xu._fromSecret(e,t)}static assertionForSignIn(e,t){return Xu._fromEnrollmentId(e,t)}static async generateSecret(e){var t;const r=e;Ie(typeof((t=r.user)===null||t===void 0?void 0:t.auth)<"u","internal-error");const s=await GN(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return jg._fromStartTotpMfaEnrollmentResponse(s,r.user.auth)}}hO.FACTOR_ID="totp";class Xu extends fx{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new Xu(t,void 0,e)}static _fromEnrollmentId(e,t){return new Xu(t,e)}async _finalizeEnroll(e,t,r){return Ie(typeof this.secret<"u",e,"argument-error"),HN(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){Ie(this.enrollmentId!==void 0&&this.otp!==void 0,e,"argument-error");const r={verificationCode:this.otp};return dV(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class jg{constructor(e,t,r,s,i,o,a){this.sessionInfo=o,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=s,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new jg(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let s=!1;return(nd(e)||nd(t))&&(s=!0),s&&(nd(e)&&(e=((r=this.auth.currentUser)===null||r===void 0?void 0:r.email)||"unknownuser"),nd(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function nd(n){return typeof n>"u"||(n==null?void 0:n.length)===0}var s_="@firebase/auth",i_="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pO(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function mO(n){ds(new Br("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:UE(n)},c=new BD(r,s,i,l);return YD(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ds(new Br("auth-internal",e=>{const t=tn(e.getProvider("auth").getImmediate());return(r=>new fO(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Sr(s_,i_,pO(n)),Sr(s_,i_,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gO=5*60,vO=Wb("authIdTokenMaxAge")||gO;let o_=null;const yO=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>vO)return;const s=t==null?void 0:t.token;o_!==s&&(o_=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function _O(n=wm()){const e=ji(n,"auth");if(e.isInitialized())return e.getImmediate();const t=JD(n,{popupRedirectResolver:cO,persistence:[lV,ex,nx]}),r=Wb("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=yO(i.toString());jN(t,o,()=>o(t.currentUser)),UN(t,a=>o(a))}}const s=Gb("auth");return s&&XD(t,`http://${s}`),t}function bO(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}qD({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=er("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",bO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});mO("Browser");const wO={apiKey:"AIzaSyDCqJRmxKiIzuAhgXsmXICCx_O65aujNa0",authDomain:"impro-selector.firebaseapp.com",projectId:"impro-selector",storageBucket:"impro-selector.appspot.com",messagingSenderId:"730278491306",appId:"1:730278491306:web:c966af1179221e91118cd3",measurementId:"G-3NB062D088"},Xh=Zb(wO),ue=G2(Xh),gt=_O(Xh);try{H2(ue)}catch{}try{$N(gt,ex)}catch{}BN(gt,n=>{n||wN(gt)});async function IO(n,e){try{return(await PN(gt,n,e)).user}catch(t){throw t}}async function px(n,e){try{return(await RN(gt,n,e)).user}catch(t){throw t}}async function mx(n){try{await TN(gt,n)}catch(e){throw e}}async function EO(n){try{const e=gt.currentUser;if(e)await NN(e,n);else throw new Error("Aucun utilisateur connecté")}catch(e){throw e}}const Ai=Object.freeze(Object.defineProperty({__proto__:null,app:Xh,auth:gt,createPlayerAccount:IO,db:ue,resetPlayerPassword:mx,signInPlayer:px,updatePlayerPassword:EO},Symbol.toStringTag,{value:"Module"})),Rl="seasons";async function xO(n,e,t){return await Al(Ye(ue,Rl),{name:n,slug:e,pinCode:t,createdAt:Hi()})}async function TO(n){return await ul(Pe(ue,Rl,n))}async function xd(){const n=Gu(Ye(ue,Rl),eD("createdAt","desc"));return(await Et(n)).docs.map(t=>({id:t.id,...t.data()}))}async function nh(n,e){const t=await zt(Pe(ue,Rl,n));return t.exists()?t.data().pinCode===e:!1}async function Bp(n){const e=await zt(Pe(ue,Rl,n));return e.exists()?e.data().pinCode:null}async function Zl(n,e){const t=Pe(ue,Rl,n);await Tl(t,{sortOrder:e})}const AO=["pin","pinCode","password","motdepasse","mdp","token","oobCode","apiKey","apikey","key","secret","authorization","auth","bearer"];function SO(){var t,r,s,i;const n=((r=(t=import.meta)==null?void 0:t.env)==null?void 0:r.MODE)==="development"?"debug":"warn";return((i=(s=import.meta)==null?void 0:s.env)==null?void 0:i.VITE_LOG_LEVEL)||n}function gx(n){switch(n){case"debug":return 10;case"info":return 20;case"warn":return 30;case"error":return 40;case"silent":return 100;default:return 30}}function PO(n){return typeof n!="string"?n:n.length<=2?"••":n.length>=8?`${n.slice(0,2)}••••${n.slice(-2)}`:"••••"}function vx(n){if(!n)return!1;const e=String(n).toLowerCase();return AO.some(t=>e.includes(t.toLowerCase()))}function qp(n){if(n==null)return n;if(typeof n=="string"){if(n.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){const[r,s]=n.split("@"),i=r.length<=2?"••":`${r.slice(0,2)}••`,o=s.split("."),a=o[0].length<=2?"••":`${o[0].slice(0,2)}••`;return`${i}@${a}.${o.slice(1).join(".")}`}return n.length>=12&&!/\s/.test(n)?PO(n):n}if(typeof n=="number"){const e=String(n);return/^\d{4,6}$/.test(e)?"••••":n}if(Array.isArray(n))return n.map(e=>qp(e));if(typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=vx(t)?"••••":qp(r);return e}return n}function RO(n){const e=[];for(let t=0;t<n.length;t+=1){const r=n[t],s=t>0?n[t-1]:null;if(typeof s=="string"&&vx(s)&&(typeof r=="string"||typeof r=="number")){e.push("••••");continue}e.push(qp(r))}return e}const CO=gx(SO());function rd(n,e){const t=gx(n);return(...r)=>{if(t<CO)return;const s=RO(r);console[e](...s)}}const ce={debug:rd("debug","log"),info:rd("info","info"),warn:rd("warn","warn"),error:rd("error","error")},Bg="lastVisitedSeason",yx="lastVisitedSeasonTimestamp";async function kO(n){if(n)try{const e=gt.currentUser,t=e==null?void 0:e.email;try{localStorage.setItem(Bg,n),localStorage.setItem(yx,Date.now().toString())}catch(r){ce.warn("Erreur lors de la sauvegarde localStorage",r)}if(t)try{const r=Pe(ue,"userPreferences",t);await Zt(r,{lastVisitedSeason:n,lastVisitedSeasonTimestamp:Date.now()},{merge:!0}),ce.debug("Préférence de saison sauvegardée dans Firebase",{seasonSlug:n,userEmail:t})}catch(r){ce.warn("Erreur lors de la sauvegarde Firebase",r)}}catch(e){ce.error("Erreur lors de la mémorisation de la saison",e)}}async function DO(){try{const n=gt.currentUser,e=n==null?void 0:n.email;if(e)try{const t=Pe(ue,"userPreferences",e),r=await zt(t);if(r.exists()){const s=r.data();if(s.lastVisitedSeason)return ce.debug("Préférence de saison récupérée depuis Firebase",{seasonSlug:s.lastVisitedSeason}),s.lastVisitedSeason}}catch(t){ce.warn("Erreur lors de la récupération Firebase",t)}try{const t=localStorage.getItem(Bg);if(t)return ce.debug("Préférence de saison récupérée depuis localStorage",{seasonSlug:t}),t}catch(t){ce.warn("Erreur lors de la lecture localStorage",t)}return null}catch(n){return ce.error("Erreur lors de la récupération de la dernière saison",n),null}}async function NO(n=null){var e;try{const t=n||((e=gt.currentUser)==null?void 0:e.email);try{localStorage.removeItem(Bg),localStorage.removeItem(yx)}catch(r){ce.warn("Erreur lors du nettoyage localStorage",r)}if(t)try{const r=Pe(ue,"userPreferences",t);await Zt(r,{lastVisitedSeason:null,lastVisitedSeasonTimestamp:null},{merge:!0}),ce.debug("Préférence de saison nettoyée dans Firebase",{userEmail:t})}catch(r){ce.warn("Erreur lors du nettoyage Firebase",r)}}catch(t){ce.error("Erreur lors du nettoyage des préférences",t)}}function VO(n,e){return!n||!e||!Array.isArray(e)?!1:e.some(t=>t.slug===n)}const OO={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center"},MO={class:"text-center"},LO={class:"text-white text-lg"},FO={__name:"SeasonResolver",setup(n){const e=dl(),t=P("Chargement...");return zn(async()=>{try{t.value="Vérification de votre session...",await new Promise(o=>{const a=gt.onAuthStateChanged(l=>{a(),o(l)})});const r=gt.currentUser,s=r==null?void 0:r.email;if(!s){ce.info("Utilisateur non connecté, redirection vers /seasons"),e.replace("/seasons");return}t.value="Récupération de vos préférences...";const i=await DO();if(!i){ce.info("Aucune saison mémorisée, redirection vers /seasons"),e.replace("/seasons");return}t.value="Vérification de la saison...";try{const o=await xd();if(!VO(i,o)){ce.info("Saison mémorisée n'existe plus, redirection vers /seasons"),await NO(s),e.replace("/seasons");return}}catch(o){ce.error("Erreur lors de la vérification des saisons",o),e.replace("/seasons");return}ce.info("Redirection vers la saison mémorisée",{seasonSlug:i}),e.replace(`/season/${i}`)}catch(r){ce.error("Erreur lors de la résolution de la saison",r),e.replace("/seasons")}}),(r,s)=>(V(),O("div",OO,[h("div",MO,[s[0]||(s[0]=h("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-white mx-auto mb-4"},null,-1)),h("p",LO,ae(t.value),1)])]))}},$O="/assets/logo-6a5e5ee2.svg",Hf=7*24*60*60*1e3,eu="impro_selector_pin_session";class UO{constructor(){this.sessionData=this.loadSession()}loadSession(){try{const e=localStorage.getItem(eu);if(e){const t=JSON.parse(e);if(t.timestamp&&Date.now()-t.timestamp<Hf){try{t.timestamp=Date.now(),localStorage.setItem(eu,JSON.stringify(t))}catch{}return t}else this.clearSession()}}catch{console.error("Erreur lors du chargement de la session PIN")}return null}saveSession(e,t){try{const r={seasonId:e,pinCode:t,timestamp:Date.now()};localStorage.setItem(eu,JSON.stringify(r)),this.sessionData=r}catch{console.error("Erreur lors de la sauvegarde de la session PIN")}}isPinCached(e){if(!this.sessionData)return!1;const t=this.sessionData.seasonId===e&&this.sessionData.timestamp&&Date.now()-this.sessionData.timestamp<Hf;if(t)try{this.sessionData.timestamp=Date.now(),localStorage.setItem(eu,JSON.stringify(this.sessionData))}catch{}return t}getCachedPin(e){return this.isPinCached(e)?this.sessionData.pinCode:null}clearSession(){try{localStorage.removeItem(eu),this.sessionData=null}catch{console.error("Erreur lors de la suppression de la session PIN")}}getTimeRemaining(){if(!this.sessionData||!this.sessionData.timestamp)return 0;const e=Date.now()-this.sessionData.timestamp,t=Hf-e;return Math.max(0,Math.ceil(t/(60*1e3)))}isExpiringSoon(){return this.getTimeRemaining()<=2}}const Vn=new UO,jO={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},BO={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},qO={class:"text-center mb-6"},zO={class:"text-gray-300"},KO={key:0,class:"mt-2 p-2 bg-green-900/20 border border-green-500/30 rounded-lg"},GO={class:"text-sm text-green-400"},HO={class:"mb-6"},WO={class:"mb-4"},QO={key:0,class:"mb-4 p-3 bg-red-900/20 border border-red-500/30 rounded-lg text-red-400 text-center"},JO={class:"flex justify-end space-x-3"},YO=["disabled"],_x={__name:"PinModal",props:{show:{type:Boolean,default:!1},message:{type:String,default:"Veuillez saisir le code PIN à 4 chiffres"},error:{type:String,default:""},sessionInfo:{type:Object,default:null}},emits:["submit","cancel"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(""),o=P(null);Pt(()=>t.show,d=>{d&&(s.value="",i.value="",Ut(()=>{var f;(f=o.value)==null||f.focus()}))});function a(){s.value=s.value.replace(/[^0-9]/g,""),s.value.length>4&&(s.value=s.value.slice(0,4))}function l(){s.value.length===4&&r("submit",s.value)}function c(){r("cancel")}return(d,f)=>n.show?(V(),O("div",jO,[h("div",BO,[h("div",qO,[f[1]||(f[1]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),f[2]||(f[2]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Code d'accès requis",-1)),h("p",zO,ae(n.message),1),n.sessionInfo?(V(),O("div",KO,[h("p",GO," Session active : "+ae(n.sessionInfo.timeRemaining)+" min restantes ",1)])):ye("",!0)]),h("div",HO,[h("div",WO,[f[3]||(f[3]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN",-1)),tt(h("input",{"onUpdate:modelValue":f[0]||(f[0]=g=>s.value=g),type:"password",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-4 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white text-center text-2xl font-mono tracking-widest",placeholder:"••••",onInput:a,onKeydown:[Un(l,["enter"]),Un(c,["escape"])],ref_key:"pinInput",ref:o},null,544),[[Nt,s.value]])]),f[4]||(f[4]=h("p",{class:"text-xs text-gray-400 text-center"},"Tapez directement votre code PIN à 4 chiffres",-1))]),i.value||t.error?(V(),O("div",QO,ae(i.value||t.error),1)):ye("",!0),h("div",JO,[h("button",{onClick:c,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:l,disabled:s.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Valider ",8,YO)])])])):ye("",!0)}},XO={class:"relative p-6 pb-4 border-b border-white/10"},ZO={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},bx={__name:"AppHelpModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[95] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=mt(()=>{},["stop"]))},[h("div",XO,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Kezako ?"),h("p",{class:"text-sm text-purple-300"},"L'appli pour sélectionner les joueurs d'impro de manière simple et apaisée")])],-1))]),s[5]||(s[5]=Xn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">C&#39;est quoi ?</h3><p> Tu joues quand ? est une appli conçue pour faciliter <span class="text-white">la sélection des joueurs d&#39;impro</span> pour les spectacles. L&#39;idée est née au sein de <span class="text-purple-300">La Malice</span> pour <span class="text-white">dépersonnaliser une tâche délicate</span> qui créait des tensions depuis des années. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-3"><h3 class="text-white font-semibold">Comment ça marche</h3><p> L&#39;asso déclare ses dates et le nombre de personnes nécessaires. Les joueurs indiquent leurs disponibilités. L&#39;appli propose des sélections. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Sélection auto ou manuelle</h3><p> Le <span class="text-white">mode sélection auto</span> s&#39;appuie sur le hasard (pondéré) pour simplifier la vie. Vous pouvez aussi repasser en mode <span class="text-white">manuel</span> si besoin. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Pensée mobile • Libre d&#39;utilisation</h3><p> L&#39;appli est <span class="text-white">pensée pour le mobile</span> et peut être utilisée librement par La Malice ou <span class="text-white">toute autre troupe</span>. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2"><h3 class="text-white font-semibold">Comptes (facultatif)</h3><p> Les joueurs qui le souhaitent peuvent créer un compte via leur email pour <span class="text-white">recevoir des notifications</span>, <span class="text-white">protéger leurs saisies</span> et bénéficier d&#39;un meilleur confort d&#39;utilisation. </p></div><div class="bg-white/5 border border-white/10 rounded-lg p-4 space-y-2 text-sm"><h3 class="text-white font-semibold">Statut &amp; licence</h3><p> Application <span class="text-white">en cours de développement</span>, <span class="text-white">sans garanties</span> à ce stade. Licence libre <span class="text-white">MIT</span>. </p><p>Contact &amp; retours : <a href="mailto:impropick@gmail.com" class="text-blue-300 underline">impropick@gmail.com</a></p></div></div>',1)),h("div",ZO,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ye("",!0)}};let Wn="mock",Si=[{id:"p1",name:"Alice"},{id:"p2",name:"Bob"},{id:"p3",name:"Charlie"},{id:"p4",name:"David"},{id:"p5",name:"Eva"},{id:"p6",name:"Fanny"},{id:"p7",name:"Georges"},{id:"p8",name:"Hélène"},{id:"p9",name:"Ismaël"},{id:"p10",name:"Jade"},{id:"p11",name:"Karim"},{id:"p12",name:"Léa"},{id:"p13",name:"Marc"},{id:"p14",name:"Nina"},{id:"p15",name:"Oscar"}],Qo=[{id:"event1",title:"Apérock Septembre",date:"2025-09-08",description:"Soirée apéro-rock avec ambiance festive"},{id:"event2",title:"Match à Cambo",date:"2025-11-25",description:"Match d'improvisation compétitif à Cambo-les-Bains"},{id:"event3",title:"Impro des Familles",date:"2025-12-02",description:"Spectacle d'improvisation pour toute la famille"},{id:"event4",title:"Cabaret Surprise",date:"2026-01-20",description:"Cabaret avec des surprises et des performances uniques"},{id:"event5",title:"Impro Plage",date:"2026-03-10",description:"Improvisation en plein air avec vue sur la plage"}];function wx(n){Wn=n}async function eM(){if(Wn!=="firebase"||!(await Et(Ye(ue,"seasons"))).empty)return;const e=Pe(Ye(ue,"seasons"));await Zt(e,{name:"Malice 2025-2026",slug:"malice-2025-2026",createdAt:Hi()});const t=await Et(Ye(ue,"players"));for(const o of t.docs)await Zt(Pe(e,"players",o.id),o.data());const r=await Et(Ye(ue,"events"));for(const o of r.docs)await Zt(Pe(e,"events",o.id),o.data());const s=await Et(Ye(ue,"availability"));for(const o of s.docs)await Zt(Pe(e,"availability",o.id),o.data());const i=await Et(Ye(ue,"selections"));for(const o of i.docs)await Zt(Pe(e,"selections",o.id),o.data())}async function tM(){Wn==="firebase"&&await eM()}async function zp(n=null){return(Wn==="firebase"?n?(await Et(Ye(ue,"seasons",n,"events"))).docs.map(t=>({id:t.id,...t.data()})):(await Et(Ye(ue,"events"))).docs.map(t=>({id:t.id,...t.data()})):Qo).sort((t,r)=>{const s=c=>{if(!c)return null;if(c instanceof Date)return c;if(typeof(c==null?void 0:c.toDate)=="function")return c.toDate();const d=new Date(c);return isNaN(d.getTime())?null:d},i=s(t.date),o=s(r.date),a=i?i.getTime():Number.POSITIVE_INFINITY,l=o?o.getTime():Number.POSITIVE_INFINITY;return a!==l?a-l:(t.title||"").localeCompare(r.title||"","fr",{sensitivity:"base"})})}async function Td(n=null){return(Wn==="firebase"?n?(await Et(Ye(ue,"seasons",n,"players"))).docs.map(t=>({id:t.id,...t.data()})):(await Et(Ye(ue,"players"))).docs.map(t=>({id:t.id,...t.data()})):Si).sort((t,r)=>t.order<r.order?-1:t.order>r.order?1:t.name.localeCompare(r.name))}async function Ix(n,e=null){if(Wn==="firebase"){const t=Pe(e?Ye(ue,"seasons",e,"players"):Ye(ue,"players"));return await Zt(t,{name:n}),t.id}else{const t=`p${Si.length+1}`;return Si.push({id:t,name:n}),t}}async function nM(n,e=null){if(Wn==="firebase"){const t=e?Pe(ue,"seasons",e,"players",n):Pe(ue,"players",n);await ul(t);const r=e?await Et(Ye(ue,"seasons",e,"availability")):await Et(Ye(ue,"availability")),s=bg(ue);r.forEach(i=>{const o=i.data();if(o[n]!==void 0){const a={...o};delete a[n],s.update(i.ref,a)}}),await s.commit()}else Si=Si.filter(t=>t.id!==n)}async function rM(n,e,t=null){if(Wn==="firebase"){const r=t?Pe(ue,"seasons",t,"players",n):Pe(ue,"players",n),s=await zt(r),i=s.exists()&&s.data().name||null;if(await Zt(r,{name:e},{merge:!0}),i&&i!==e){const o=bg(ue);try{const a=t?Pe(ue,"seasons",t,"availability",i):Pe(ue,"availability",i),l=await zt(a);if(l.exists()){const c=l.data()||{},d=t?Pe(ue,"seasons",t,"availability",e):Pe(ue,"availability",e);o.set(d,c,{merge:!0}),o.delete(a)}}catch{}try{const a=t?Ye(ue,"seasons",t,"selections"):Ye(ue,"selections");(await Et(a)).forEach(c=>{var f;const d=Array.isArray((f=c.data())==null?void 0:f.players)?c.data().players:[];if(d.includes(i)){const g=d.map(y=>y===i?e:y);o.update(c.ref,{players:g})}})}catch{}await o.commit()}}else{const r=Si.findIndex(s=>s.id===n);r!==-1&&(Si[r]={...Si[r],name:e})}}async function To(n,e,t=null){if(Wn==="firebase"){const r=t?await Et(Ye(ue,"seasons",t,"availability")):await Et(Ye(ue,"availability")),s={};return r.forEach(i=>{s[i.id]=i.data()}),s}else{const r={};return n.forEach(s=>{r[s.name]={},e.forEach(i=>{r[s.name][i.id]=void 0})}),e.forEach(s=>{const i=[...n].sort(()=>.5-Math.random());i.slice(0,4).forEach(o=>{r[o.name][s.id]=!0}),i.slice(4).forEach(o=>{const a=Math.random();r[o.name][s.id]=a<.4?!0:a<.8?!1:void 0})}),r}}async function Ao(n=null){if(Wn==="firebase"){const e=n?await Et(Ye(ue,"seasons",n,"selections")):await Et(Ye(ue,"selections")),t={};return e.forEach(r=>{t[r.id]=r.data().players||[]}),t}else return{}}async function a_(n,e,t=null){if(Wn==="firebase"){const r=t?Pe(ue,"seasons",t,"availability",n):Pe(ue,"availability",n);await Zt(r,e)}}async function sM({seasonId:n,playerName:e,eventId:t,value:r}){if(Wn!=="firebase")return;const s=n?Pe(ue,"seasons",n,"availability",e):Pe(ue,"availability",e),i=await zt(s),a={...i.exists()?i.data():{}};r===void 0?delete a[t]:a[t]=r,await Zt(s,a)}async function Kp(n,e,t=null){if(Wn==="firebase"){const r=t?Pe(ue,"seasons",t,"selections",n):Pe(ue,"selections",n);await Zt(r,{players:e})}}async function iM(n,e=null){if(ce.info("Suppression de l'événement",{eventId:n}),Wn==="firebase")try{ce.debug("Suppression de l'événement dans Firestore");const t=e?Pe(ue,"seasons",e,"events",n):Pe(ue,"events",n);await ul(t),ce.debug("Suppression de la sélection associée");const r=e?Pe(ue,"seasons",e,"selections",n):Pe(ue,"selections",n);await ul(r),ce.debug("Suppression des disponibilités");const s=e?await Et(Ye(ue,"seasons",e,"availability")):await Et(Ye(ue,"availability")),i=bg(ue);s.forEach(o=>{const a=o.data();if(a[n]!==void 0){ce.debug("Mise à jour de la disponibilité pour un joueur");const l={...a};delete l[n],i.update(o.ref,l)}}),await i.commit(),ce.info("Opérations de suppression terminées avec succès")}catch(t){throw ce.error("Erreur lors de la suppression",t),t}else Qo=Qo.filter(t=>t.id!==n)}async function oM(n,e=null){if(Wn==="firebase"){const t=Pe(e?Ye(ue,"seasons",e,"events"):Ye(ue,"events"));return await Zt(t,n),t.id}else{const t=`event${Qo.length+1}`;return Qo.push({id:t,...n}),t}}async function l_(n,e,t=null){if(Wn==="firebase"){const r=t?Pe(ue,"seasons",t,"events",n):Pe(ue,"events",n);await Zt(r,e,{merge:!0})}else{const r=Qo.findIndex(s=>s.id===n);r!==-1&&(Qo[r]={id:n,...e})}}const aM={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},lM={class:"hero-section relative overflow-hidden"},uM={class:"hero-content py-20 md:py-28 px-4 relative z-10"},cM={class:"container mx-auto"},dM={class:"grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20 items-center"},hM={class:"text-center lg:text-left order-1 lg:order-2"},fM={class:"hero-cta mb-8"},pM=["aria-busy"],mM={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto animate-pulse"},gM={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-7xl mx-auto"},vM=["onClick"],yM={class:"text-2xl font-bold text-white mb-4 group-hover:text-purple-300 transition-colors"},_M={class:"absolute top-4 right-4"},bM=["onClick","aria-expanded"],wM={key:0,class:"absolute right-0 mt-2 w-44 bg-gray-900 border border-white/10 rounded-lg shadow-xl py-1 z-10",role:"menu"},IM=["onClick"],EM=["onClick"],xM=["onClick"],TM=["onClick"],AM={key:2,class:"text-center py-16"},SM={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},PM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},RM={class:"mb-6"},CM={class:"mb-6"},kM={class:"mb-6"},DM={class:"flex justify-end space-x-3"},NM=["disabled"],VM={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},OM={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},MM={class:"text-center mb-6"},LM={class:"text-gray-300"},FM={__name:"Seasons",setup(n){const e=P([]),t=P(!0),r=dl(),s=P(null),i=P(!1),o=P(!1),a=P(""),l=P(""),c=P(""),d=P(null),f=P(!1),g=P(null),y=P(""),E=P(!1);zn(async()=>{var D;try{e.value=await xd(),ce.info("Saisons chargées",{count:((D=e.value)==null?void 0:D.length)||0}),F().catch($=>ce.error("Migration sortOrder échouée",$))}finally{t.value=!1}});const A=Ue(()=>[...e.value].sort((D,$)=>{var I,S;const te=typeof D.sortOrder=="number"?D.sortOrder:Number.MAX_SAFE_INTEGER,oe=typeof $.sortOrder=="number"?$.sortOrder:Number.MAX_SAFE_INTEGER;if(te!==oe)return te-oe;const Ve=(I=D.createdAt)!=null&&I.toMillis?D.createdAt.toMillis():0,qe=(S=$.createdAt)!=null&&S.toMillis?$.createdAt.toMillis():0;return Ve!==qe?qe-Ve:(D.name||"").localeCompare($.name||"")}));function R(D){r.push(`/season/${D}`)}function B(D){s.value=s.value===D?null:D}function q(){s.value=null}async function F(){if(!e.value.length)return;const D=e.value.map(te=>typeof te.sortOrder=="number"?te.sortOrder:null).filter(te=>te!==null);let $=D.length?Math.max(...D):0;for(const te of e.value)if(typeof te.sortOrder!="number"){$+=1;try{await Zl(te.id,$),te.sortOrder=$}catch(oe){ce.error("Erreur migration sortOrder",{seasonName:te==null?void 0:te.name,error:oe})}}}async function z(D){try{if(!(D!=null&&D.id)){alert("Saison introuvable");return}const[$,te]=await Promise.all([zp(D.id),Td(D.id)]),[oe,Ve]=await Promise.all([To(te,$,D.id),Ao(D.id)]),qe=["Joueur",...$.map(be=>me(be))],I=[];for(const be of te){const we=(be==null?void 0:be.name)||"",ge=(oe==null?void 0:oe[we])||{},Me=[we,...$.map(xe=>L(ge[xe.id],Ve==null?void 0:Ve[xe.id],we))];I.push(Me)}const S=w([qe,...I]),M=new Blob(["\uFEFF"+S],{type:"text/csv;charset=utf-8;"}),le=(D==null?void 0:D.name)||(D==null?void 0:D.slug)||"saison",ne=`${N(le)}-disponibilites.csv`,ie=URL.createObjectURL(M),_e=document.createElement("a");_e.href=ie,_e.download=ne,document.body.appendChild(_e),_e.click(),document.body.removeChild(_e),URL.revokeObjectURL(ie),ce.info("Export CSV saison",{seasonId:D.id,events:$.length,players:te.length})}catch($){ce.error("Erreur export CSV",$),alert("Erreur lors de l'export CSV. Veuillez réessayer.")}}function de(D){if(!D)return null;if(D instanceof Date)return D;if(typeof(D==null?void 0:D.toDate)=="function")return D.toDate();if(typeof D=="string"||typeof D=="number"){const $=new Date(D);return isNaN($.getTime())?null:$}return null}function me(D){const $=de(D==null?void 0:D.date),te=$?`${$.getFullYear()}-${String($.getMonth()+1).padStart(2,"0")}-${String($.getDate()).padStart(2,"0")}`:"",oe=(D==null?void 0:D.title)||"Sans titre";return`${te} · ${oe}`.trim()}function T(D){return D===!0||D==="oui"?"disponible":D===!1||D==="non"?"non disponible":""}function w(D){return D.map($=>$.map(x).join(",")).join(`
`)}function x(D){const $=String(D??"");return/[",\n\r]/.test($)?'"'+$.replace(/"/g,'""')+'"':$}function N(D){return String(D||"").normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\-_. ]+/g,"-").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.+|\.+$/g,"")||"fichier"}function L(D,$,te){return Array.isArray($)&&$.includes(te)?D===!1||D==="non"?"non disponible":"sélectionné":T(D)}async function j(D){if(q(),D<=0)return;const $=[...A.value],te=$[D],oe=$[D-1],Ve=te.sortOrder;te.sortOrder=oe.sortOrder,oe.sortOrder=Ve;try{await Promise.all([Zl(te.id,te.sortOrder),Zl(oe.id,oe.sortOrder)])}catch(qe){ce.error("Erreur lors du déplacement vers le haut",qe)}}async function C(D){q();const $=[...A.value];if(D>=$.length-1)return;const te=$[D],oe=$[D+1],Ve=te.sortOrder;te.sortOrder=oe.sortOrder,oe.sortOrder=Ve;try{await Promise.all([Zl(te.id,te.sortOrder),Zl(oe.id,oe.sortOrder)])}catch(qe){ce.error("Erreur lors du déplacement vers le bas",qe)}}function ht(){a.value&&(l.value=a.value.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))}function et(){c.value=c.value.replace(/[^0-9]/g,""),c.value.length>4&&(c.value=c.value.slice(0,4))}async function ee(){if(!a.value.trim()||!l.value.trim()||!c.value.trim()){alert("Veuillez remplir tous les champs, y compris le code PIN à 4 chiffres");return}if(c.value.length!==4){alert("Le code PIN doit contenir exactement 4 chiffres");return}try{await xO(a.value.trim(),l.value.trim(),c.value.trim()),e.value=await xd(),await F(),U()}catch(D){ce.error("Erreur lors de la création de la saison",D),alert("Erreur lors de la création de la saison. Veuillez réessayer.")}}function U(){i.value=!1,a.value="",l.value="",c.value=""}function W(D){d.value=D,o.value=!0}async function re(){o.value=!1,await Q({type:"deleteSeason",data:{seasonId:d.value.id,seasonName:d.value.name}})}function Se(){o.value=!1,d.value=null}function Z(){return g.value?{deleteSeason:"Suppression de saison - Code PIN requis"}[g.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function Q(D){if(Vn.isPinCached(d.value.id)){const $=Vn.getCachedPin(d.value.id);if(ce.debug("PIN en cache trouvé, utilisation automatique"),await nh(d.value.id,$)){await vt(D);return}else Vn.clearSession()}g.value=D,f.value=!0}async function Ee(D){var $,te,oe,Ve;ce.debug("PIN soumis pour l'opération",{operationType:($=g.value)==null?void 0:$.type});try{const qe=((oe=(te=g.value)==null?void 0:te.data)==null?void 0:oe.seasonId)||((Ve=d.value)==null?void 0:Ve.id),I=await nh(qe,D);if(ce.debug("PIN validé",{valid:I}),I){Vn.saveSession(qe,D),ce.debug("PIN correct, fermeture de la modal et exécution de l'opération"),f.value=!1;const S=g.value;g.value=null,ce.debug("Appel de executePendingOperation",{operationType:S==null?void 0:S.type}),await vt(S)}else y.value="Code PIN incorrect",setTimeout(()=>{y.value=""},3e3)}catch(qe){ce.error("Erreur lors de la vérification du PIN",qe),y.value="Erreur lors de la vérification du code PIN"}}function We(){f.value=!1,g.value=null,y.value=""}function ft(){return d.value&&Vn.isPinCached(d.value.id)?{timeRemaining:Vn.getTimeRemaining(),isExpiringSoon:Vn.isExpiringSoon()}:null}async function vt(D){var oe;if(ce.debug("executePendingOperation appelé",{hasOperation:!!D}),!D){ce.warn("Aucune opération à exécuter");return}const{type:$,data:te}=D;ce.info("Exécution de l'opération",{type:$});try{switch($){case"deleteSeason":ce.info("Suppression de la saison",{seasonId:te.seasonId}),await TO(te.seasonId),ce.info("Saison supprimée, rechargement de la liste"),e.value=await xd(),ce.info("Liste des saisons rechargée",{count:((oe=e.value)==null?void 0:oe.length)||0});break;default:ce.warn("Type d'opération non reconnu",{type:$})}}catch(Ve){ce.error("Erreur lors de l'exécution de l'opération",Ve),alert("Erreur lors de l'opération. Veuillez réessayer.")}}return(D,$)=>{var te;return V(),O("div",aM,[h("section",lM,[h("button",{onClick:$[0]||($[0]=oe=>E.value=!0),class:"absolute right-4 top-4 z-10 text-white/90 hover:text-white p-2 rounded-full hover:bg-white/10 transition-all duration-200",title:"Kezako ?","aria-label":"Kezako ?"},$[8]||($[8]=[h("span",{class:"text-2xl"},"❓",-1)])),h("div",uM,[h("div",cM,[h("div",dM,[$[12]||($[12]=Xn('<div class="text-center lg:text-left order-2 lg:order-1"><div class="hero-content-wrapper"><div class="kijoukan-logo mb-8 flex justify-center lg:justify-start"><div class="relative w-24 h-24 md:w-32 md:h-32"><img src="'+$O+'" alt="Logo Kijoukan - Checkmark qui se transforme en masque" class="w-full h-full drop-shadow-2xl transform hover:scale-110 transition-all duration-500 hover:rotate-3"></div></div><div class="hero-illustration relative"><div class="relative mx-auto lg:mx-0 w-full max-w-lg"><div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-4 shadow-2xl border border-white/10"><div class="flex items-center gap-3 mb-4"><div class="flex gap-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><div class="w-3 h-3 bg-yellow-500 rounded-full"></div><div class="w-3 h-3 bg-green-500 rounded-full"></div></div><div class="text-gray-400 text-sm">Kijoukan - Grille des disponibilités</div></div><div class="bg-gray-700 rounded-2xl p-4 min-h-[300px]"><div class="grid grid-cols-4 gap-2 mb-4"><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">15 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">22 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">29 Jan</div><div class="text-center text-xs text-gray-300 bg-gray-600 rounded p-2">5 Fév</div></div><div class="space-y-2"><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Marie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-gray-500/20 border border-gray-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Pierre</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div><div class="flex items-center gap-2"><div class="w-16 text-xs text-gray-300">Sophie</div><div class="grid grid-cols-4 gap-2 flex-1"><div class="h-6 bg-red-500/20 border border-red-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div><div class="h-6 bg-green-500/20 border border-green-500/30 rounded"></div></div></div></div></div></div><div class="absolute -top-4 -right-4 w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-2xl shadow-xl transform rotate-12"></div><div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-r from-cyan-400 to-blue-500 rounded-2xl shadow-xl transform -rotate-12"></div></div></div></div></div>',1)),h("div",hM,[$[9]||($[9]=h("div",{class:"hero-title mb-6"},[h("h1",{class:"text-4xl md:text-6xl font-bold text-white mb-4 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"}," Tu joues quand ? ")],-1)),$[10]||($[10]=h("div",{class:"hero-subtitle mb-8"},[h("p",{class:"text-xl md:text-2xl text-gray-300 leading-relaxed"}," Arrêtez de vous prendre la tête pour savoir qui sera sur scène quand. Laissez chacun indiquer ses dispos et le hasard choisir pour vous ! ")],-1)),h("div",fM,[h("button",{onClick:$[1]||($[1]=oe=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl hover:shadow-pink-500/25 transition-all duration-300 transform hover:scale-105 text-lg md:text-xl"}," 🚀 Démarrez ")]),$[11]||($[11]=h("div",{class:"hero-hint"},[h("div",{class:"inline-flex items-center gap-2 text-gray-400 text-sm"},[h("span",null,"↓"),h("span",null,"Vos saisons ci-dessous"),h("span",null,"↓")])],-1))])])])]),$[13]||($[13]=h("div",{class:"hero-background absolute inset-0 z-0"},[h("div",{class:"absolute top-20 left-10 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl"}),h("div",{class:"absolute bottom-20 right-10 w-40 h-40 bg-purple-500/10 rounded-full blur-3xl"}),h("div",{class:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"})],-1))]),h("div",{class:"container mx-auto px-4 pb-16","aria-busy":t.value},[t.value?(V(),O("div",mM,[(V(),O(ct,null,Tr(8,oe=>h("div",{key:"skeleton-"+oe,class:"bg-gradient-to-br from-white/10 to-white/5 border border-white/10 rounded-2xl p-8"},$[14]||($[14]=[h("div",{class:"w-16 h-16 bg-white/10 rounded-full mx-auto mb-6"},null,-1),h("div",{class:"h-6 bg-white/10 rounded mb-4 w-2/3 mx-auto"},null,-1),h("div",{class:"h-px bg-white/10 mb-4"},null,-1),h("div",{class:"h-4 bg-white/10 rounded w-1/2 mx-auto"},null,-1)]))),64))])):e.value.length>0?(V(),O("div",gM,[(V(!0),O(ct,null,Tr(A.value,(oe,Ve)=>(V(),O("div",{key:oe.id,class:"group relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-sm border border-white/20 rounded-2xl p-8 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/20"},[h("div",{onClick:qe=>R(oe.slug),class:"text-center cursor-pointer"},[$[15]||($[15]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg"},[h("span",{class:"text-2xl"},"🎭")],-1)),h("h2",yM,ae(oe.name),1),$[16]||($[16]=h("div",{class:"w-full bg-gradient-to-r from-transparent via-white/20 to-transparent h-px mb-4"},null,-1)),$[17]||($[17]=h("p",{class:"text-gray-300 text-sm"}," Cliquez pour accéder ",-1))],8,vM),h("div",_M,[h("div",{class:"relative",onClick:$[2]||($[2]=mt(()=>{},["stop"]))},[h("button",{onClick:qe=>B(Ve),class:"p-1 rounded-full text-gray-300 hover:text-white hover:bg-white/10","aria-expanded":s.value===Ve,"aria-haspopup":"true",title:"Options"},$[18]||($[18]=[h("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.75a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3zm0 7.5a1.5 1.5 0 110-3 1.5 1.5 0 010 3z"})],-1)]),8,bM),s.value===Ve?(V(),O("div",wM,[h("button",{onClick:qe=>{z(oe),q()},class:"w-full text-left px-4 py-2 text-sm text-emerald-300 hover:bg-white/10",role:"menuitem"}," Exporter CSV ",8,IM),$[19]||($[19]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:qe=>j(Ve),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Monter ",8,EM),h("button",{onClick:qe=>C(Ve),class:"w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-white/10",role:"menuitem"}," Descendre ",8,xM),$[20]||($[20]=h("div",{class:"border-t border-white/10 my-1"},null,-1)),h("button",{onClick:qe=>W(oe),class:"w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-red-500/10",role:"menuitem"}," Supprimer ",8,TM)])):ye("",!0)])])]))),128))])):ye("",!0),!t.value&&e.value.length===0?(V(),O("div",AM,[$[21]||($[21]=h("div",{class:"w-24 h-24 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-4xl"},"🎪")],-1)),$[22]||($[22]=h("h3",{class:"text-2xl font-bold text-white mb-4"},"Aucune saison créée",-1)),$[23]||($[23]=h("p",{class:"text-gray-300 mb-8"},"Commencez par créer votre première saison de spectacles !",-1)),h("button",{onClick:$[3]||($[3]=oe=>i.value=!0),class:"bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-xl hover:shadow-pink-500/25 transition-all duration-300"}," Créer ma première saison ")])):ye("",!0)],8,pM),i.value?(V(),O("div",SM,[h("div",PM,[$[28]||($[28]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvelle saison",-1)),h("div",RM,[$[24]||($[24]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom de la saison",-1)),tt(h("input",{"onUpdate:modelValue":$[4]||($[4]=oe=>a.value=oe),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: La Malice 2025-2026",onInput:ht},null,544),[[Nt,a.value]])]),h("div",CM,[$[25]||($[25]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Slug (URL)",-1)),tt(h("input",{"onUpdate:modelValue":$[5]||($[5]=oe=>l.value=oe),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: malice-2025-2026"},null,512),[[Nt,l.value]])]),h("div",kM,[$[26]||($[26]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Code PIN (4 chiffres)",-1)),tt(h("input",{"onUpdate:modelValue":$[6]||($[6]=oe=>c.value=oe),type:"text",inputmode:"numeric",maxlength:"4",pattern:"[0-9]{4}",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"1234",onInput:et},null,544),[[Nt,c.value]]),$[27]||($[27]=h("p",{class:"text-xs text-gray-400 mt-1"},"Ce code protégera les opérations sensibles (suppressions, sélections)",-1))]),h("div",DM,[h("button",{onClick:U,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:ee,disabled:!a.value.trim()||!l.value.trim()||!c.value.trim()||c.value.length!==4,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Créer ",8,NM)])])])):ye("",!0),o.value?(V(),O("div",VM,[h("div",OM,[h("div",MM,[$[29]||($[29]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"⚠️")],-1)),$[30]||($[30]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",LM,'Êtes-vous sûr de vouloir supprimer la saison "'+ae((te=d.value)==null?void 0:te.name)+'" ?',1)]),$[31]||($[31]=h("p",{class:"mb-6 text-sm text-red-400 bg-red-900/20 p-3 rounded-lg border border-red-500/20"}," ⚠️ Cette action est irréversible et supprimera toutes les données de cette saison. ",-1)),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:Se,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:re,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ye("",!0),st(_x,{show:f.value,message:Z(),error:y.value,"session-info":ft(),onSubmit:Ee,onCancel:We},null,8,["show","message","error","session-info"]),st(bx,{show:E.value,onClose:$[7]||($[7]=oe=>E.value=!1)},null,8,["show"]),$[32]||($[32]=Xn('<footer class="mt-16 border-t border-white/10"><div class="container mx-auto px-4 py-6 text-center text-xs text-gray-400"><span>© Patrice Lamarque 2025</span><span class="mx-2">•</span><span>Licence MIT</span><span class="mx-2">•</span><a href="https://github.com/plamarque/impro-selector" target="_blank" rel="noopener noreferrer" class="underline decoration-white/20 hover:decoration-white/40 hover:text-gray-200">GitHub</a></div></footer>',1))])}}},Zh="magicLinks";function ef({seasonId:n,playerId:e,eventId:t,action:r}){return`${n}__${e}__${t}__${r}`}function qg(n=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}async function Gp({seasonId:n,playerId:e,eventId:t,action:r}){const s=ef({seasonId:n,playerId:e,eventId:t,action:r}),i=qg(40),o=Pe(ue,Zh,s),a=Date.now()+1e3*60*60*24*7;await Zt(o,{seasonId:n,playerId:e,eventId:t,token:i,action:r,expiresAt:a});const c=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&eid=${encodeURIComponent(t)}&t=${encodeURIComponent(i)}&a=${encodeURIComponent(r)}`;return{id:s,token:i,url:c}}async function Ex({seasonId:n,playerId:e,email:t}){const r="protection",s="verify_email",i=ef({seasonId:n,playerId:e,eventId:r,action:s}),o=qg(40),a=Pe(ue,Zh,i),l=Date.now()+1e3*60*60*24*7;await Zt(a,{seasonId:n,playerId:e,eventId:r,token:o,action:s,email:t,expiresAt:l});const d=`${window.location.origin+"/"}magic?sid=${encodeURIComponent(n)}&pid=${encodeURIComponent(e)}&t=${encodeURIComponent(o)}&a=${encodeURIComponent(s)}`;return{id:i,token:o,url:d}}async function xx({seasonId:n,playerId:e,eventId:t,token:r,action:s}){const i=ef({seasonId:n,playerId:e,eventId:t,action:s}),o=Pe(ue,Zh,i),a=await zt(o);if(!a.exists())return{valid:!1,reason:"not_found"};const l=a.data();return l.token!==r?{valid:!1,reason:"token_mismatch"}:l.action!==s?{valid:!1,reason:"action_mismatch"}:typeof l.expiresAt=="number"&&Date.now()>l.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:l}}async function Hp({seasonId:n,playerId:e,eventId:t,action:r}){const s=ef({seasonId:n,playerId:e,eventId:t,action:r}),i=Pe(ue,Zh,s);await ul(i)}const zg="accountMagicLinks";function tf(n){return`account__${n}`}async function Tx({currentEmail:n,newEmail:e}){const t=qg(40),r=tf(t),s=Pe(ue,zg,r),i=Date.now()+1e3*60*60*24*7;await Zt(s,{token:t,currentEmail:n,newEmail:e,action:"account_email_update",expiresAt:i});const a=`${window.location.origin+"/"}magic?a=account_email_update&t=${encodeURIComponent(t)}`;return{id:r,token:t,url:a}}async function Ax({token:n}){const e=tf(n),t=Pe(ue,zg,e),r=await zt(t);if(!r.exists())return{valid:!1,reason:"not_found"};const s=r.data();return s.token!==n?{valid:!1,reason:"token_mismatch"}:typeof s.expiresAt=="number"&&Date.now()>s.expiresAt?{valid:!1,reason:"expired"}:{valid:!0,data:s}}async function Sx({token:n}){const e=tf(n),t=Pe(ue,zg,e);await ul(t)}const $M=Object.freeze(Object.defineProperty({__proto__:null,buildAccountId:tf,consumeAccountEmailUpdateLink:Sx,consumeMagicLink:Hp,createAccountEmailUpdateLink:Tx,createEmailVerificationLink:Ex,createMagicLink:Gp,verifyAccountEmailUpdateLink:Ax,verifyMagicLink:xx},Symbol.toStringTag,{value:"Module"})),u_="impro_selector_trusted_players",c_=180*24*60*60*1e3;class UM{constructor(){this.trustedMap=this.load()}load(){try{const e=localStorage.getItem(u_);if(!e)return{};const t=JSON.parse(e);return typeof t=="object"&&t!==null?t:{}}catch{return{}}}persist(){try{localStorage.setItem(u_,JSON.stringify(this.trustedMap))}catch{}}isPasswordCached(e){if(!e)return!1;const t=this.trustedMap[e];if(!t)return!1;const r=Date.now(),s=r-t<c_;return s?(this.trustedMap[e]=r,this.persist()):(delete this.trustedMap[e],this.persist()),s}getCachedPassword(e){return null}saveSession(e,t){e&&(this.trustedMap[e]=Date.now(),this.persist())}clearSession(e){e&&(delete this.trustedMap[e],this.persist())}clearExpiredSessions(){const e=Date.now();let t=!1;for(const[r,s]of Object.entries(this.trustedMap))e-s>c_&&(delete this.trustedMap[r],t=!0);t&&this.persist()}clearAllSessions(){this.trustedMap={},this.persist()}}const $i=new UM;function Kg(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e=e&e}return e.toString()}function Px(n){return`seasonPreferredPlayer:${n||"global"}`}function Wp(n,e){try{const t=Px(n),r=localStorage.getItem(t);if(!r){localStorage.setItem(t,JSON.stringify([e]));return}if(r.startsWith("[")){const s=JSON.parse(r);s.includes(e)||(s.push(e),localStorage.setItem(t,JSON.stringify(s)))}else r!==e&&localStorage.setItem(t,JSON.stringify([r,e]))}catch{}}function jM(n,e){try{const t=Px(n),r=localStorage.getItem(t);if(!r)return;if(r.startsWith("[")){const s=JSON.parse(r).filter(i=>i!==e);s.length===0?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(s))}else r===e&&localStorage.removeItem(t)}catch{}}async function Rx(n,e,t,r=null){try{ce.info("Début protectPlayer",{playerId:n,seasonId:r});const s=await Cl(n,r);if(s&&s.isProtected)throw new Error("Ce joueur est déjà protégé");const{collection:i,query:o,where:a,getDocs:l}=await Xt(()=>import("./index.esm-f01e8498.js"),[]),{db:c}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0),d=r?i(c,"seasons",r,"playerProtection"):i(c,"playerProtection"),f=o(d,a("email","==",e)),g=await l(f);if(!g.empty&&g.docs.find(F=>F.id!==n))throw new Error("Cette adresse email est déjà utilisée par un autre joueur");ce.debug("Création du compte Firebase Auth...");const{createUserWithEmailAndPassword:y}=await Xt(()=>import("./index.esm-018a5c49.js"),[]),{auth:E}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0),A=await y(E,e,t);ce.info("Compte Firebase Auth créé",{uid:A.user.uid});const R=Kg(t),B=r?Pe(c,"seasons",r,"playerProtection",n):Pe(c,"playerProtection",n);return await Zt(B,{playerId:n,email:e,passwordHash:R,firebaseUid:A.user.uid,isProtected:!0,createdAt:new Date}),ce.info("Protection sauvegardée dans Firestore"),r&&Wp(r,n),{success:!0}}catch(s){throw ce.error("Erreur lors de la protection du joueur",s),s}}async function Cx({playerId:n,email:e,seasonId:t=null}){const r=t?Pe(ue,"seasons",t,"playerProtection",n):Pe(ue,"playerProtection",n);(await zt(r)).exists()?await Tl(r,{email:e,updatedAt:new Date}):await Zt(r,{playerId:n,email:e,isProtected:!1,createdAt:new Date});const{url:i}=await Ex({seasonId:t,playerId:n,email:e});return{success:!0,url:i}}async function kx({playerId:n,seasonId:e=null}){const t=e?Pe(ue,"seasons",e,"playerProtection",n):Pe(ue,"playerProtection",n);if(!(await zt(t)).exists())throw new Error("Protection introuvable");return await Tl(t,{emailVerifiedAt:new Date}),{success:!0}}async function Dx({playerId:n,seasonId:e=null}){const t=e?Pe(ue,"seasons",e,"playerProtection",n):Pe(ue,"playerProtection",n);return await Tl(t,{emailVerifiedAt:null}),{success:!0}}async function Nx(n,e=null){try{const t=e?Pe(ue,"seasons",e,"playerProtection",n):Pe(ue,"playerProtection",n);return await Zt(t,{playerId:n,email:"",isProtected:!1,emailVerifiedAt:null,updatedAt:new Date}),e&&jM(e,n),{success:!0,email:""}}catch(t){throw ce.error("Erreur lors de la suppression de la protection",t),t}}async function Pi(n,e=null){try{const t=e?Pe(ue,"seasons",e,"playerProtection",n):Pe(ue,"playerProtection",n),r=await zt(t);return r.exists()?r.data().isProtected===!0:!1}catch(t){return ce.error("Erreur lors de la vérification de protection",t),!1}}async function Cl(n,e=null){try{const t=e?Pe(ue,"seasons",e,"playerProtection",n):Pe(ue,"playerProtection",n),r=await zt(t);return r.exists()?r.data():null}catch(t){return ce.error("Erreur lors de la récupération des données de protection",t),null}}async function Vx(n,e=null){try{const t=await Cl(n,e);return(t==null?void 0:t.email)||""}catch(t){return ce.error("Erreur lors de la récupération de l'email",t),""}}async function Qp(n=null){try{const e=n?Ye(ue,"seasons",n,"playerProtection"):Ye(ue,"playerProtection");return(await Et(e)).docs.map(r=>({id:r.id,...r.data()}))}catch(e){return ce.error("Erreur lors du chargement des protections",e),[]}}async function Gg(n){try{const e=[],t=Gu(Ye(ue,"playerProtection"),Yd("email","==",n));(await Et(t)).forEach(i=>{const o=i.data();o!=null&&o.isProtected&&e.push({seasonId:null,playerId:i.id,...o})});const s=await Et(Ye(ue,"seasons"));for(const i of s.docs){const o=i.id,a=Gu(Ye(ue,"seasons",o,"playerProtection"),Yd("email","==",n));(await Et(a)).forEach(c=>{var f;const d=c.data();d!=null&&d.isProtected&&e.push({seasonId:o,seasonName:(f=i.data())==null?void 0:f.name,playerId:c.id,...d})})}return e}catch(e){return ce.error("Erreur listAssociationsForEmail",e),[]}}async function Ox(n,e,t=null){try{const r=await Cl(n,t);if(!r||!r.isProtected)return!1;if(r.email){ce.debug("Vérification avec Firebase Auth");try{const{signInWithEmailAndPassword:s}=await Xt(()=>import("./index.esm-018a5c49.js"),[]),{auth:i}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0);return await s(i,r.email,e),ce.debug("Mot de passe Firebase Auth valide"),$i.saveSession(n),t&&Wp(t,n),!0}catch(s){return ce.debug("Mot de passe Firebase Auth invalide",{code:s.code}),!1}}else{ce.debug("Vérification avec hash local");const s=Kg(e),i=r.passwordHash===s;return i&&($i.saveSession(n),t&&Wp(t,n)),i}}catch(r){return ce.error("Erreur lors de la vérification du mot de passe",r),!1}}async function Mx({playerId:n,seasonId:e=null}){const t=e?Pe(ue,"seasons",e,"playerProtection",n):Pe(ue,"playerProtection",n),r=await zt(t);if(!r.exists())throw new Error("Protection introuvable");const s=r.data();if(s!=null&&s.email)return await Tl(t,{isProtected:!0,updatedAt:new Date}),{success:!0};throw new Error("Email non défini pour cette protection")}function $o(n){return $i.isPasswordCached(n)}function BM(n){return null}async function Lx(n,e=null){try{ce.info("Début sendPasswordResetEmail",{playerId:n,seasonId:e});const t=await Cl(n,e);if(ce.debug("Protection data disponible"),!t||!t.isProtected)throw new Error("Joueur non protégé");if(ce.debug("Email à utiliser (masqué)"),t.firebaseUid){ce.debug("Utilisation du compte Firebase Auth existant");const{sendPasswordResetEmail:r}=await Xt(()=>import("./index.esm-018a5c49.js"),[]),{auth:s}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0);ce.debug("Tentative d'envoi d'email"),await r(s,t.email),ce.info("Email envoyé avec succès via Firebase Auth")}else{ce.debug("Pas de compte Firebase Auth, création temporaire...");const{createUserWithEmailAndPassword:r,sendPasswordResetEmail:s}=await Xt(()=>import("./index.esm-018a5c49.js"),[]),{auth:i}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0),o=Math.random().toString(36).slice(-8)+"A1!";try{const a=await r(i,t.email,o);ce.info("Compte temporaire créé",{uid:a.user.uid}),await s(i,t.email),ce.info("Email envoyé avec succès");const{updateDoc:l}=await Xt(()=>import("./index.esm-f01e8498.js"),[]),{db:c}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0),d=e?Pe(c,"seasons",e,"playerProtection",n):Pe(c,"playerProtection",n);await l(d,{firebaseUid:a.user.uid})}catch(a){if(a.code==="auth/email-already-in-use")ce.debug("Email déjà utilisé, tentative d'envoi direct..."),await s(i,t.email),ce.info("Email envoyé avec succès");else throw a}}return{success:!0,message:"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}}catch(t){throw ce.error("Erreur lors de l'envoi de l'email de réinitialisation",{error:t}),t.code==="auth/user-not-found"?new Error("Aucun compte trouvé avec cette adresse email"):t.code==="auth/too-many-requests"?new Error("Trop de tentatives. Veuillez réessayer plus tard"):t.code==="auth/invalid-email"?new Error("Adresse email invalide"):new Error(`Erreur lors de l'envoi de l'email: ${t.message}`)}}async function qM(n,e,t=null){try{const r=Kg(e),s=t?Pe(ue,"seasons",t,"playerProtection",n):Pe(ue,"playerProtection",n);return await Tl(s,{passwordHash:r,updatedAt:new Date}),{success:!0}}catch(r){throw ce.error("Erreur lors de la mise à jour du mot de passe",r),r}}async function zM(n){return new Promise((e,t)=>{ce.debug("Demande de mot de passe pour disponibilité"),t(new Error("Gestion de mot de passe à implémenter côté composant"))})}const Tc=Object.freeze(Object.defineProperty({__proto__:null,clearEmailVerificationForProtection:Dx,finalizeProtectionAfterVerification:Mx,getCachedPlayerPassword:BM,getPlayerEmail:Vx,getPlayerProtectionData:Cl,isPlayerPasswordCached:$o,isPlayerProtected:Pi,listAssociationsForEmail:Gg,listProtectedPlayers:Qp,markEmailVerifiedForProtection:kx,protectPlayer:Rx,requirePlayerPasswordForAvailability:zM,sendPasswordResetEmail:Lx,startEmailVerificationForProtection:Cx,unprotectPlayer:Nx,updatePlayerPasswordInFirestore:qM,verifyPlayerPassword:Ox},Symbol.toStringTag,{value:"Module"}));async function Ac({toEmail:n,title:e,body:t,data:r={},reason:s="generic"}){if(!n)return{success:!1,error:"missing_toEmail"};const i={to:n,title:e,body:t,data:r,reason:s,createdAt:Hi()};return await Al(Ye(ue,"pushQueue"),i),{success:!0}}async function KM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,yesUrl:s,noUrl:i,eventUrl:o=void 0,reason:a="new_event",fromEmail:l=void 0}){try{const g=Pe(ue,"userPreferences",n),y=await zt(g);if(y.exists()){const E=y.data();if((E==null?void 0:E.notifyAvailability)===!1)return{success:!0,skipped:!0}}}catch{}const c=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>Nouvel événement programmé!</strong></p>
      <p style="margin: 12px 0 2px 0; font-weight: 600;">${t}</p>
      <p style="margin: 0 0 16px 0; color:#374151;">${r}</p>
      <p>Nous avons besoin de savoir si tu es disponible.</p>
      <p style="margin-top: 12px;">
        <a href="${s}" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
        <a href="${i}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
      <p style="margin-top: 16px;">Merci!!</p>
    </div>
  `,d=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,f={to:n,message:{subject:d,html:c},createdAt:Hi(),meta:{reason:a,eventTitle:t,eventDate:r,playerName:e}};l&&(f.from=l,f.replyTo=l),await Al(Ye(ue,"mail"),f);try{const g=Pe(ue,"userPreferences",n),y=await zt(g),E=y.exists()?y.data():{};if((E==null?void 0:E.notifyAvailabilityPush)!==!1){const A=`${a==="reminder"?"Rappel: ":""}${t} (${r})`,R=`${e}, t'es dispo ?`;await Ac({toEmail:n,title:A,body:R,data:{url:o||window.location.origin,yesUrl:s,noUrl:i,reason:a},reason:a==="reminder"?"availability_reminder":"availability_request"})}}catch{}return{success:!0}}async function Fx({toEmail:n,verifyUrl:e,purpose:t="player_protection",displayName:r="utilisateur",fromEmail:s=void 0}){const i=t==="account_email_update",o=i?"Vérification de votre nouvelle adresse email":"Vérification de votre email",a=`Bonjour ${r},`,l=i?"Pour sécuriser votre compte, merci de confirmer que vous avez accès à cette nouvelle adresse email.":"Pour sécuriser votre joueur, merci de confirmer que vous avez accès à cette adresse email.",c=i?"Confirmer mon adresse email":"Vérifier mon email",d=i?"Confirmez votre nouvelle adresse email":"Confirmez votre email pour activer la protection",f=`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>${o}</h2>
      <p>${a}</p>
      <p>${l}</p>
      <p>
        <a href="${e}" style="display:inline-block;padding:10px 16px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;">${c}</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Ce lien expirera dans 7 jours.</p>
    </div>
  `,g={to:n,message:{subject:d,html:f},createdAt:Hi(),meta:{reason:t,displayName:r}};s&&(g.from=s,g.replyTo=s),await Al(Ye(ue,"mail"),g)}async function GM({toEmail:n,playerName:e,verifyUrl:t,fromEmail:r=void 0}){return Fx({toEmail:n,verifyUrl:t,purpose:"player_protection",displayName:e,fromEmail:r})}async function HM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,html:i=void 0,subject:o=void 0,fromEmail:a=void 0}){try{const f=Pe(ue,"userPreferences",n),g=await zt(f);if(g.exists()){const y=g.data();if((y==null?void 0:y.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}ce.debug("queueSelectionEmail",{forPlayer:e,hasCustomHtml:!!i,hasCustomSubject:!!o});const l=i||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p>Bonjour ${e},</p>
      <p>Félicitations ! Tu as été sélectionné(e) pour <strong>${t}</strong> (${r}).</p>
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Tu recevras bientôt plus d'informations sur l'organisation.</p>
    </div>
  `,c=o||`🎭 Sélection confirmée · ${t}`;ce.debug("queueSelectionEmail html/subject ready");const d={to:n,message:{subject:c,html:l},createdAt:Hi(),meta:{reason:"selection",eventTitle:t,eventDate:r,playerName:e}};a&&(d.from=a,d.replyTo=a),ce.debug("queueSelectionEmail firestore payload ready");try{await Al(Ye(ue,"mail"),d);try{const f=Pe(ue,"userPreferences",n),g=await zt(f),y=g.exists()?g.data():{};(y==null?void 0:y.notifySelectionPush)!==!1&&await Ac({toEmail:n,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s||window.location.origin},reason:"selection"})}catch{}return ce.info("Email ajouté à la queue Firestore",{playerName:e}),{success:!0}}catch(f){throw ce.error("Erreur lors de l'ajout à Firestore",{playerName:e,error:f}),f}}async function WM({toEmail:n,playerName:e,eventTitle:t,eventDate:r,eventUrl:s,newSelectedPlayers:i=[],html:o=void 0,subject:a=void 0,fromEmail:l=void 0}){try{const y=Pe(ue,"userPreferences",n),E=await zt(y);if(E.exists()){const A=E.data();if((A==null?void 0:A.notifySelection)===!1)return{success:!0,skipped:!0}}}catch{}const c=Array.isArray(i)?i.join(", "):"",d=o||`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <h2>🎭 Sélection mise à jour</h2>
      <p>Bonjour ${e},</p>
      <p>La sélection pour <strong>${t}</strong> (${r}) a été mise à jour et tu n'en fais plus partie 😔.</p>
      ${c?`<p>Nouvelle sélection: <strong>${c}</strong>.</p>`:""}
      <p>
        <a href="${s}" style="display:inline-block;padding:10px 16px;background:#6b7280;color:#fff;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
      </p>
      <p style="font-size:12px;color:#6b7280;">Motif: mise à jour de sélection (relance auto ou ajustement manuel).</p>
    </div>
  `,f=a||`🎭 Tu n'es plus dans la sélection · ${t}`,g={to:n,message:{subject:f,html:d},createdAt:Hi(),meta:{reason:"deselection",eventTitle:t,eventDate:r,playerName:e,newSelectedPlayers:i}};l&&(g.from=l,g.replyTo=l),await Al(Ye(ue,"mail"),g);try{const y=Pe(ue,"userPreferences",n),E=await zt(y),A=E.exists()?E.data():{};(A==null?void 0:A.notifySelectionPush)!==!1&&await Ac({toEmail:n,title:"🎭 Sélection mise à jour",body:`${e}, tu n'es plus sélectionné(e) pour ${t} (${r}) 😔`,data:{url:s||window.location.origin,noUrl:s&&s.includes("/event/")?s.replace("/event/","/magic?auto=no&event="):void 0},reason:"deselection"})}catch{}return{success:!0}}async function QM({eventId:n,eventData:e,selectedPlayers:t,seasonId:r,seasonSlug:s,players:i}){if(ce.info("sendSelectionEmailsForEvent",{eventId:n,seasonId:r,seasonSlug:s,playersCount:i==null?void 0:i.length,selectedCount:t==null?void 0:t.length}),!e||!t||t.length===0)throw new Error("Données manquantes pour l'envoi des emails de sélection");const{getPlayerEmail:o}=await Xt(()=>Promise.resolve().then(()=>Tc),void 0),{createMagicLink:a}=await Xt(()=>Promise.resolve().then(()=>$M),void 0),l=`${window.location.origin}/season/${s}/event/${n}`;t.join(", ");const c=`🎭 Sélection confirmée · ${e.title}`,d=[];for(const f of t){ce.debug("Traitement du joueur",{playerName:f});try{const g=i==null?void 0:i.find(q=>q.name===f);if(!g){ce.warn("Joueur non trouvé",{playerName:f});continue}ce.debug("Joueur trouvé");const y=await o(g.id,r);if(!y){ce.warn("Pas d'email pour le joueur",{playerName:f});continue}ce.debug("Email trouvé pour joueur");const A=`${(await a({seasonId:r,playerId:g.id,eventId:n,action:"no"})).url}&slug=${encodeURIComponent(s)}`,R=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu as été sélectionné(e) pour <strong>${e.title}</strong> (${rh(e.date)}).</p>
          <p>Un imprévu ?</p>
          <p>
            <a href="${A}" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;margin-right:8px;">❌ Plus dispo</a>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #8b5cf6;color:#8b5cf6;border-radius:8px;text-decoration:none;">Afficher les Détails</a>
          </p>
        </div>
      `;ce.debug("HTML généré pour joueur");const B=HM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:rh(e.date),eventUrl:l,html:R,subject:c});d.push(B),ce.info("Email ajouté à la queue",{playerName:f})}catch(g){ce.error("Erreur lors de l'envoi de l'email de sélection",{playerName:f,error:g})}}return ce.info("Nombre total d'emails à envoyer",{count:d.length}),await Promise.all(d),ce.info("Tous les emails ont été envoyés avec succès"),{success:!0,count:d.length}}async function JM({eventId:n,eventData:e,removedPlayers:t,newSelectedPlayers:r,seasonId:s,seasonSlug:i,players:o}){if(ce.info("sendDeselectionEmailsForEvent",{eventId:n,seasonId:s,removedCount:t==null?void 0:t.length}),!e||!t||t.length===0)return{success:!0,count:0};const{getPlayerEmail:a}=await Xt(()=>Promise.resolve().then(()=>Tc),void 0),l=`${window.location.origin}/season/${i}/event/${n}`,c=[],d=Array.isArray(r)?r.join(", "):"";for(const f of t)try{const g=o==null?void 0:o.find(A=>A.name===f);if(!g){ce.warn("Joueur retiré non trouvé",{playerName:f});continue}const y=await a(g.id,s);if(!y){ce.warn("Pas d'email pour le joueur retiré",{playerName:f});continue}const E=`
        <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
          <h2>🎭 Sélection mise à jour</h2>
          <p>Bonjour <strong>${f}</strong>,</p>
          <p>Tu n'es plus sélectionné(e) pour <strong>${e.title}</strong> (${rh(e.date)}) 😔.</p>
          ${d?`<p>Nouvelle sélection: <strong>${d}</strong>.</p>`:""}
          <p>
            <a href="${l}" style="display:inline-block;padding:10px 12px;border:2px solid #6b7280;color:#6b7280;border-radius:8px;text-decoration:none;">Voir les détails de l'événement</a>
          </p>
        </div>
      `;c.push(WM({toEmail:y,playerName:f,eventTitle:e.title,eventDate:rh(e.date),eventUrl:l,newSelectedPlayers:r,html:E}))}catch(g){ce.error("Erreur lors de l'envoi de l'email de désélection",{playerName:f,error:g})}return await Promise.all(c),ce.info("Emails de désélection envoyés",{count:c.length}),{success:!0,count:c.length}}function rh(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function YM({reason:n,recipientName:e,eventTitle:t,eventDate:r,urls:s={},prefs:i={},extra:o={}}){const a={email:null,push:null};if(n==="availability_request"||n==="availability_reminder"){const l=(i==null?void 0:i.notifyAvailability)!==!1,c=(i==null?void 0:i.notifyAvailabilityPush)!==!1;a.email={enabled:l,subject:n==="availability_reminder"?`Rappel disponibilité · ${t} (${r})`:`Disponibilité demandée · ${t} (${r})`},a.push={enabled:c,title:n==="availability_reminder"?"⏰ Rappel disponibilité":"🗓️ Disponibilité demandée",body:`${e}, ${t} (${r})`,data:{url:s.eventUrl,yesUrl:s.yesUrl,noUrl:s.noUrl,reason:n}}}if(n==="selection"){const l=(i==null?void 0:i.notifySelection)!==!1,c=(i==null?void 0:i.notifySelectionPush)!==!1;a.email={enabled:l,subject:`🎭 Sélection confirmée · ${t}`},a.push={enabled:c,title:"🎭 Sélection confirmée",body:`${e}, tu as été sélectionné(e) pour ${t} (${r}) 🎉`,data:{url:s.eventUrl}}}return a}async function XM({reason:n,recipientEmail:e,recipientName:t,eventTitle:r,eventDate:s,urls:i={},extra:o={}}){if(!e)return{success:!1,skipped:!0,reason:"missing_email"};const a=await zt(Pe(ue,"userPreferences",e)).catch(()=>null),l=a!=null&&a.exists()?a.data():{},c=YM({reason:n,recipientName:t,eventTitle:r,eventDate:s,urls:i,prefs:l,extra:o}),d=[];return c.email&&c.email.enabled&&(n==="availability_request"||n==="availability_reminder"?await KM({toEmail:e,playerName:t,eventTitle:r,eventDate:s,yesUrl:i.yesUrl,noUrl:i.noUrl,eventUrl:i.eventUrl,reason:n==="availability_reminder"?"reminder":"new_event"}).then(()=>d.push({channel:"email",success:!0})).catch(g=>{ce.error("notifyRecipientAcrossChannels email error",g),d.push({channel:"email",success:!1})}):n==="selection"&&d.push({channel:"email",success:!0,skipped:!0,note:"batch_handled_elsewhere"})),c.push&&c.push.enabled&&await Ac({toEmail:e,title:c.push.title,body:c.push.body,data:c.push.data||{},reason:n}).then(()=>d.push({channel:"push",success:!0})).catch(g=>{ce.error("notifyRecipientAcrossChannels push error",g),d.push({channel:"push",success:!1})}),{success:d.some(g=>g.success),results:d}}async function d_({eventId:n,eventData:e,players:t,seasonId:r,seasonSlug:s,createMagicLink:i,reminder:o=!1,getAvailabilityForEvent:a=null}){const l=[],c=`${window.location.origin}/season/${s}/event/${n}`;for(const d of t)try{if(o&&typeof a=="function"){const y=await Promise.resolve(a(d.name,n));if(y===!0||y===!1)continue}const f={};if(typeof i=="function"){const y=await i({seasonId:r,playerId:d.id,eventId:n,action:"yes"}),E=await i({seasonId:r,playerId:d.id,eventId:n,action:"no"});f.yesUrl=`${y.url}&slug=${encodeURIComponent(s)}`,f.noUrl=`${E.url}&slug=${encodeURIComponent(s)}`}f.eventUrl=c,(await XM({reason:o?"availability_reminder":"availability_request",recipientEmail:d.email,recipientName:d.name,eventTitle:e.title,eventDate:ZM(e.date),urls:f})).success||l.push(d.id)}catch{l.push(d.id)}return{success:!0,failures:l}}async function h_(n){return QM(n)}function ZM(n){var t;return n?(typeof n=="string"?new Date(n):((t=n.toDate)==null?void 0:t.call(n))||n).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function eL(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Impro Selector//Calendar Event//FR","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${n.id}@impro-selector.com`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTSTART:${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`DTEND:${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`SUMMARY:${n.title}`,`DESCRIPTION:${n.description||""}${e?`\\n\\nSaison : ${e}`:""}`,"STATUS:CONFIRMED","SEQUENCE:0","BEGIN:VALARM","TRIGGER:-PT1H","ACTION:DISPLAY",`DESCRIPTION:Rappel : ${n.title}`,"END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)}function tL(n,e=""){const t=eL(n,e),r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${n.title.replace(/[^a-z0-9]/gi,"_")}_${n.date}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function nL(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:n.title,dates:`${r.toISOString().replace(/[-:]/g,"").split(".")[0]}Z/${s.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,details:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",sf:"true",output:"xml"}).toString()}`}function rL(n,e=""){const t=new Date(n.date),r=new Date(t);r.setHours(19,0,0,0);const s=new Date(r);return s.setHours(23,0,0,0),`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({subject:n.title,startdt:r.toISOString(),enddt:s.toISOString(),body:`${n.description||""}${e?`

Saison : ${e}`:""}`,location:"Impro Selector",allday:"false"}).toString()}`}function sL(n,e=""){const t=nL(n,e);window.open(t,"_blank")}function iL(n,e=""){const t=rL(n,e);window.open(t,"_blank")}function oL(n,e,t=""){switch(n){case"ics":tL(e,t);break;case"google":sL(e,t);break;case"outlook":iL(e,t);break;default:console.warn("Type de calendrier non supporté:",n)}}const aL="/icons/manifest-icon-192.maskable.png",lL={class:"relative p-5 pb-4 border-b border-white/10"},uL={class:"text-xl md:text-2xl font-bold text-white pr-10 flex items-center gap-2"},cL={key:0,class:"text-sm text-purple-300 mt-1"},dL={class:"px-4 md:px-6 py-4 md:py-6 space-y-6 overflow-y-auto"},hL={class:"space-y-4"},fL={class:"block text-sm font-medium text-gray-300 mb-2 flex items-center gap-2"},pL={key:0,class:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 mb-3"},mL={class:"bg-gray-800 border border-gray-600 rounded-lg p-3"},gL={key:0,class:"space-y-2"},vL={class:"flex flex-wrap gap-2"},yL=["onClick","title"],_L={key:1,class:"text-amber-400 text-sm"},bL={class:"inline-flex bg-gray-800 rounded-lg overflow-hidden border border-gray-700 mb-3"},wL={class:"text-sm text-gray-300"},IL={class:"text-sm text-gray-300"},EL={class:"text-sm text-gray-300"},xL=["innerHTML"],TL=["value"],AL={class:"mt-3"},SL={class:"text-lg font-semibold leading-snug"},PL={class:"mt-2 text-base whitespace-pre-line text-white/90"},RL={class:"mt-4 flex items-center gap-4 text-base"},CL={key:1,class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-100 text-gray-900 border border-white/20"},kL={class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm mb-2"},DL=["value"],NL={class:"sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},VL={class:"flex items-center gap-2 w-full"},OL=["disabled"],ML={key:0},LL={class:"hidden sm:inline"},FL={key:1,class:"inline-flex items-center gap-2"},$L=["title"],UL={key:0},jL={key:1},$x={__name:"EventAnnounceModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]},mode:{type:String,default:"event",validator:n=>["event","selection"].includes(n)},selectedPlayers:{type:Array,default:()=>[]},sending:{type:Boolean,default:!1},availabilityByPlayer:{type:Object,default:()=>({})}},emits:["close","notifications-sent","send-notifications"],setup(n,{emit:e}){const t=n,r=e;P("notify");const s=P(!1),i=P("Copier le message"),o=P(!1),a=Ue(()=>t.sending||o.value),l=P(!1),c=P("email"),d=Ue(()=>!t.event||!t.seasonSlug?"":`${window.location.origin}/season/${t.seasonSlug}/event/${t.event.id}`),f=Ue(()=>{if(!t.event)return"";if(c.value==="push"){const U=R.value,W=B.value;if(t.mode==="event"){const re=`

Lien direct: ${d.value}`;return`${U}
${W}
✅ Dispo
❌ Pas dispo${re}`}return`${U}
${W}
Ouvrir`}const ee=`

Lien direct: ${d.value}`;return`Objet: ${g.value}

${A.value}${ee}`}),g=Ue(()=>{var U,W,re;const ee=j((U=t.event)==null?void 0:U.date);return t.mode==="event"?`${(W=t.event)==null?void 0:W.title} (${ee})`:`🎭 Sélectionné pour ${(re=t.event)==null?void 0:re.title}`}),y=Ue(()=>"impropick@gmail.com"),E=Ue(()=>{var W,re,Se,Z,Q,Ee,We;const ee=((W=z.value)==null?void 0:W.id)==="ALL"?"<joueur>":((re=z.value)==null?void 0:re.name)||"[Nom du joueur]",U=j((Se=t.event)==null?void 0:Se.date);return z.value&&z.value.id&&z.value.id!=="ALL"&&!((Z=me.value.find(ft=>ft.id===z.value.id))!=null&&Z.hasContact)?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${ee}</strong> n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal.</p>
        <p style="margin-top: 8px; font-weight: 600;">${(Q=t.event)==null?void 0:Q.title}</p>
        <p style="color:#374151;">${U}</p>
        <p style="margin-top: 8px;">Lien direct : ${d.value}</p>
      </div>
    `:t.mode==="event"?`
      <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
        <p><strong>${ee}</strong>, un nouvel événement est prévu.</p>
        <p style="margin: 12px 0 2px 0; font-weight: 600;">${(Ee=t.event)==null?void 0:Ee.title}</p>
        <p style="margin: 0 0 16px 0; color:#374151;">${U}</p>
        <p>Nous avons besoin de savoir si tu es disponible.</p>
        <p style="margin-top: 12px;">
          <a href="#yes" style="display:inline-block;padding:10px 12px;margin-right:8px;border:2px solid #16a34a;color:#16a34a;border-radius:8px;text-decoration:none;">✅ Dispo</a>
          <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
        </p>
        <p style="margin-top: 16px;">Merci!!</p>
      </div>
    `:`
    <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height:1.5;">
      <p><strong>${ee}</strong>, tu as été sélectionné pour <strong>${(We=t.event)==null?void 0:We.title}</strong> le <strong>${U}</strong>!</p>
      <p style="margin-top: 16px; font-weight: 600;">Actions rapides :</p>
      <p style="margin-top: 8px;">
        <a href="#no" style="display:inline-block;padding:10px 12px;border:2px solid #dc2626;color:#dc2626;border-radius:8px;text-decoration:none;">❌ Pas dispo</a>
      </p>
    </div>
  `}),A=Ue(()=>E.value.replace(/<\/?div[^>]*>/g,`
`).replace(/<\/?p[^>]*>/g,`
`).replace(/<br\s*\/?>(\n)?/g,`
`).replace(/<[^>]+>/g,"").replace(/\n{3,}/g,`

`).trim()),R=Ue(()=>{var ee,U;return t.mode==="event"?`${(ee=t.event)==null?void 0:ee.title} (${j((U=t.event)==null?void 0:U.date)})`:"🎭 Sélectionné pour"}),B=Ue(()=>{var Se,Z,Q,Ee,We,ft;const ee=j((Se=t.event)==null?void 0:Se.date),U=((Z=z.value)==null?void 0:Z.id)==="ALL"?"<joueur>":((Q=z.value)==null?void 0:Q.name)||"[Nom du joueur]",W=z.value&&z.value.id&&z.value.id!=="ALL",re=W?!!((Ee=me.value.find(vt=>vt.id===z.value.id))!=null&&Ee.hasContact):!0;return W&&!re?`${U} n'a pas installé l'appli. Envoie-lui ce message manuellement.
${(We=t.event)==null?void 0:We.title} (${ee})
Lien: ${d.value}`:t.mode==="event"?`${U}, t'es dispo ?`:`${U}, tu as été sélectionné pour ${(ft=t.event)==null?void 0:ft.title} le ${ee}!

[ Afficher les Détails]

Un imprévu ?
❌ Pas dispo`}),q=P([]),F=P([]),z=P(null),de=P([]),me=Ue(()=>{const ee=F.value.map(W=>({...W,hasContact:W.id!=="ALL",missingReason:""})),U=de.value.map(W=>({...W,hasContact:!1,missingReason:"Aucun canal actif"}));return[{id:"ALL",name:"Tous",hasContact:!0},...ee.filter(W=>W.id!=="ALL"),...U]}),T=Ue(()=>{if(!z.value||z.value.id==="ALL")return!0;const ee=me.value.find(U=>(U.id||U.name)===(z.value.id||z.value.name));return!!(ee!=null&&ee.hasContact)}),w=Ue(()=>{var W,re,Se,Z,Q;const ee=((W=z.value)==null?void 0:W.id)==="ALL"?"<joueur>":((re=z.value)==null?void 0:re.name)||"[Nom du joueur]",U=j((Se=t.event)==null?void 0:Se.date);return t.mode==="selection"?`Bonjour ${ee},
Tu as été sélectionné(e) pour ${(Z=t.event)==null?void 0:Z.title} (${U})
Un imprévu ? ${x.value}
Détails : ${d.value}`:`Bonjour ${ee},
${(Q=t.event)==null?void 0:Q.title} (${U})
Peux-tu indiquer ta disponibilité ?
Lien : ${d.value}`}),x=Ue(()=>{var ee,U;try{const W=(ee=z.value)!=null&&ee.id&&z.value.id!=="ALL"?t.players.find(re=>re.id===z.value.id):null;return!W||!((U=t.event)!=null&&U.id)||!t.seasonId?"[lien désistement]":`${window.location.origin}/magic?auto=no&season=${encodeURIComponent(t.seasonId)}&player=${encodeURIComponent(W.id)}&event=${encodeURIComponent(t.event.id)}&slug=${encodeURIComponent(t.seasonSlug||"")}`}catch{return"[lien désistement]"}});async function N(){if(!t.seasonId)return;let ee=[];t.mode==="selection"?ee=t.players.filter(Se=>t.selectedPlayers.includes(Se.name)):ee=t.players.filter(Se=>{var Q;return typeof((Q=t.availabilityByPlayer)==null?void 0:Q[Se.name])>"u"});const U=[];for(const Se of ee)try{const{getPlayerEmail:Z}=await Xt(()=>Promise.resolve().then(()=>Tc),void 0),Q=await Z(Se.id,t.seasonId);Q&&U.push({...Se,email:Q})}catch(Z){console.warn(`Impossible de charger l'email pour ${Se.name}:`,Z)}q.value=U;const W={id:"ALL",name:"Tous"};F.value=[W,...U];const re=ee.filter(Se=>!U.find(Z=>Z.id===Se.id)).map(Se=>({id:Se.id,name:Se.name}));de.value=re,z.value||(z.value=W)}function L(){r("close")}function j(ee){var W;return ee?(typeof ee=="string"?new Date(ee):((W=ee.toDate)==null?void 0:W.call(ee))||ee).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function C(){const ee=f.value;navigator.clipboard.writeText(ee).then(()=>{s.value=!0,i.value="Copié !",setTimeout(()=>{s.value=!1,i.value="Copier le message"},2e3)}).catch(U=>{console.warn("Erreur lors de la copie du texte"),alert("Impossible de copier le message.")})}function ht(ee){z.value=ee}async function et(){if(!(!t.event||F.value.length===0)){o.value=!0;try{const ee=z.value&&z.value.id!=="ALL"?"single":"all",U=ee==="single"?{id:z.value.id,name:z.value.name,email:z.value.email}:null;t.mode==="selection"?r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"selection",selectedPlayers:t.selectedPlayers,scope:ee,recipient:U}):r("send-notifications",{eventId:t.event.id,eventData:t.event,reason:"manual",scope:ee,recipient:U})}catch{console.error("Erreur lors de l'envoi des notifications"),alert("Erreur lors de l'envoi des notifications. Veuillez réessayer.")}}}return zn(()=>{t.show&&N()}),Pt(()=>t.show,ee=>{ee&&N()}),Pt(()=>t.selectedPlayers,()=>{t.show&&t.mode==="selection"&&N()}),Pt(()=>t.availabilityByPlayer,()=>{t.show&&t.mode==="event"&&N()},{deep:!0}),Pt(()=>t.sending,ee=>{ee||(o.value=!1)}),(ee,U)=>{var W,re,Se,Z,Q;return n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:L},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[92vh] flex flex-col",onClick:U[3]||(U[3]=mt(()=>{},["stop"]))},[h("div",lL,[h("button",{onClick:L,title:"Fermer",class:"absolute right-2.5 top-2.5 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("h2",uL,[h("span",null,ae(n.mode==="selection"?"📣":"📢"),1),h("span",null,ae(n.mode==="selection"?"Annoncer la sélection":"Annoncer l'événement"),1)]),n.event?(V(),O("p",cL,ae(n.event.title)+" — "+ae(j(n.event.date)),1)):ye("",!0)]),h("div",dL,[h("div",hL,[h("div",null,[h("label",fL,[U[4]||(U[4]=Yt(" Personnes à Prévenir ")),h("button",{onClick:U[0]||(U[0]=Ee=>l.value=!l.value),class:"text-blue-400 hover:text-blue-300 text-lg cursor-help",title:"Cliquer pour plus d'information"}," ? ")]),l.value?(V(),O("div",pL,U[5]||(U[5]=[h("p",{class:"text-blue-200 text-sm"},[Yt(" Cette liste montre tous les joueurs ciblés: "),h("span",{class:"text-purple-300"},"« Tous »"),Yt(", "),h("span",{class:"text-gray-200"},"ceux notifiables (email/push actifs)"),Yt(" et "),h("span",{class:"text-yellow-300"},"ceux en jaune sans canal actif"),Yt(". Les joueurs en jaune ne peuvent pas être notifiés automatiquement. Utilise « Copier le message » pour leur écrire via un autre moyen (l'URL de l'événement est incluse). ")],-1)]))):ye("",!0),h("div",mL,[me.value.length>0?(V(),O("div",gL,[h("div",vL,[(V(!0),O(ct,null,Tr(me.value,Ee=>(V(),O("button",{key:Ee.id||Ee.name,type:"button",onClick:We=>ht(Ee),class:St(["px-3 py-1 rounded text-sm border transition-colors",z.value&&z.value.id===Ee.id?"bg-purple-600 border-purple-500 text-white":Ee.hasContact?"bg-gray-700 border-gray-600 text-white hover:bg-gray-600":"bg-yellow-900/20 border-yellow-600/40 text-yellow-200 hover:bg-yellow-900/30 opacity-75 cursor-not-allowed"]),title:Ee.hasContact?"Prévisualiser pour "+Ee.name:Ee.missingReason||"Aucun canal actif"},ae(Ee.name),11,yL))),128))])])):(V(),O("div",_L," ⚠️ Aucun destinataire disponible. "))])]),h("div",null,[U[13]||(U[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Aperçu du message :",-1)),h("div",bL,[h("button",{class:St(["px-3 py-1.5 text-sm transition-colors",c.value==="email"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:U[1]||(U[1]=Ee=>c.value="email"),title:"Prévisualiser l'email"},"📧",2),h("button",{class:St(["px-3 py-1.5 text-sm transition-colors",c.value==="push"?"bg-purple-600 text-white":"text-gray-300 hover:bg-gray-700"]),onClick:U[2]||(U[2]=Ee=>c.value="push"),title:"Prévisualiser la notification push"},"🔔",2)]),c.value==="email"?(V(),O("div",{key:0,class:St(T.value||((W=z.value)==null?void 0:W.id)==="ALL"?"bg-gray-800 border border-gray-600 rounded-lg p-4 text-white space-y-3":"space-y-3")},[T.value||((re=z.value)==null?void 0:re.id)==="ALL"?(V(),O(ct,{key:0},[h("div",wL,[U[6]||(U[6]=h("span",{class:"font-semibold"},"De:",-1)),Yt(" "+ae(y.value),1)]),h("div",IL,[U[7]||(U[7]=h("span",{class:"font-semibold"},"À:",-1)),Yt(" "+ae(((Se=z.value)==null?void 0:Se.id)==="ALL"?"<joueur>":((Z=z.value)==null?void 0:Z.name)||"[Nom du joueur]"),1)]),h("div",EL,[U[8]||(U[8]=h("span",{class:"font-semibold"},"Objet:",-1)),Yt(" "+ae(g.value),1)]),h("div",{class:"bg-white text-black rounded-md p-4",innerHTML:E.value},null,8,xL)],64)):(V(),O(ct,{key:1},[U[9]||(U[9]=h("div",{class:"bg-yellow-500/10 border border-yellow-500/30 text-yellow-200 rounded-md p-3 text-sm"}," Ce joueur n'a pas configuré d'email. Utilise la fonction « Copier le message » et envoie-lui ces informations par un autre canal. ",-1)),h("textarea",{class:"w-full mt-2 p-3 bg-gray-900 border border-gray-700 rounded-md text-white text-sm",value:w.value,rows:"5",readonly:""},null,8,TL)],64))],2)):(V(),O("div",{key:1,class:St(z.value&&z.value.id!=="ALL"&&!T.value?"text-white":"bg-gray-900 border border-gray-700 rounded-xl p-4 text-white")},[z.value&&z.value.id!=="ALL"&&!T.value?(V(),O(ct,{key:1},[h("div",kL,ae((Q=z.value)==null?void 0:Q.name)+" n'a pas installé l'appli. Envoie-lui ce message manuellement. ",1),h("textarea",{class:"w-full p-3 bg-gray-800 border border-gray-700 rounded-md text-white text-sm",value:w.value,rows:"5",readonly:""},null,8,DL)],64)):(V(),O(ct,{key:0},[U[12]||(U[12]=Xn('<div class="flex items-center justify-between text-xs text-white/70"><div class="flex items-center gap-2 min-w-0"><div class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center">🔔</div><div class="truncate">Impropick</div><span class="opacity-60">•</span><span>il y a 1 min</span></div><img src="'+aL+'" alt="App icon" class="w-10 h-10 rounded-full shadow"></div>',1)),h("div",AL,[h("div",SL,ae(R.value),1),h("div",PL,ae(B.value),1)]),h("div",RL,[t.mode==="event"?(V(),O(ct,{key:0},[U[10]||(U[10]=h("span",{class:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-600/20 text-green-300 border border-green-600/40"},"✅ Dispo",-1)),U[11]||(U[11]=h("span",{class:"text-red-600/20 text-red-300 border border-red-600/40"},"❌ Pas dispo",-1))],64)):(V(),O("span",CL,"Ouvrir"))])],64))],2))])])]),h("div",NL,[h("div",VL,[h("button",{onClick:et,disabled:F.value.length===0||a.value||z.value&&z.value.id!=="ALL"&&!T.value,class:"h-12 px-6 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600 flex-1"},[a.value?(V(),O("span",FL,U[17]||(U[17]=[h("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[h("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),h("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),Yt(" Envoi en cours... ")]))):(V(),O("span",ML,[z.value&&z.value.id!=="ALL"?(V(),O("span",{key:0,class:St(T.value?"":"opacity-60")},[h("span",LL,"🔔 Notifier "+ae(z.value.name),1),U[14]||(U[14]=h("span",{class:"sm:hidden"},"🔔 Notifier",-1))],2)):(V(),O(ct,{key:1},[U[15]||(U[15]=h("span",{class:"hidden sm:inline"},"🔔 Envoyer les notifications",-1)),U[16]||(U[16]=h("span",{class:"sm:hidden"},"🔔 Envoyer",-1))],64))]))],8,OL),h("button",{onClick:C,class:"h-12 px-6 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300",title:i.value},[s.value?(V(),O("span",jL,"✅ Copié")):(V(),O("span",UL,U[18]||(U[18]=[h("span",{class:"hidden sm:inline"},"📋 Copier le message",-1),h("span",{class:"sm:hidden"},"📋 Copier",-1)])))],8,$L)]),h("button",{onClick:L,class:"h-12 px-4 bg-gray-700 text-white rounded-lg"}," Fermer ")])])])):ye("",!0)}}},BL={class:"text-center mb-6"},qL={class:"text-lg text-gray-300"},zL={class:"mb-6"},KL={class:"space-y-4"},GL={class:"flex items-center gap-2 text-gray-300 text-sm"},HL=["disabled"],WL={key:0,class:"animate-spin"},QL={key:1},JL={class:"mb-6 text-center"},YL={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},XL={class:"text-red-300 text-sm"},ZL={class:"text-center mb-6"},e4={class:"text-lg text-gray-300"},t4={class:"mb-6"},n4=["disabled"],r4={key:0,class:"animate-spin"},s4={key:1},i4={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},o4={class:"text-red-300 text-sm"},a4={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},l4={class:"text-green-300 text-sm"},u4={class:"flex justify-center"},Hg={__name:"PasswordVerificationModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","verified"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P(!1),o=P(""),a=P(!1),l=P(""),c=P(""),d=P(null),f=P(!0);async function g(){if(s.value){i.value=!0,o.value="";try{const A=await Bp(t.seasonId);if(s.value===A){if(f.value)try{$i.saveSession(t.player.id)}catch{}r("verified",{type:"season_pin"}),E();return}if(await Ox(t.player.id,s.value,t.seasonId)){if(f.value)try{$i.saveSession(t.player.id)}catch{}r("verified",{type:"player_password"}),E()}else o.value="Mot de passe incorrect. Veuillez réessayer."}catch(A){ce.error("Erreur lors de la vérification",A),o.value="Erreur lors de la vérification. Veuillez réessayer."}finally{i.value=!1}}}async function y(){i.value=!0,l.value="",c.value="";try{const A=await Lx(t.player.id,t.seasonId);c.value=A.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch(A){ce.error("Erreur lors de l'envoi de l'email",A),l.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{i.value=!1}}function E(){r("close"),s.value="",o.value="",a.value=!1,l.value="",c.value=""}return Pt(()=>t.show,A=>{A&&Ut(()=>{d.value&&d.value.focus()})}),(A,R)=>{var B,q;return V(),O(ct,null,[n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4",onClick:E},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:R[3]||(R[3]=mt(()=>{},["stop"]))},[h("div",BL,[R[7]||(R[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔐")],-1)),R[8]||(R[8]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Vérification requise",-1)),h("p",qL,ae((B=n.player)==null?void 0:B.name),1),R[9]||(R[9]=h("p",{class:"text-sm text-gray-400 mt-2"},"Ce joueur est protégé par mot de passe",-1))]),h("div",zL,[h("div",KL,[h("div",null,[R[10]||(R[10]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(h("input",{"onUpdate:modelValue":R[0]||(R[0]=F=>s.value=F),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:Un(g,["enter"]),ref_key:"passwordInput",ref:d},null,544),[[Nt,s.value]])]),h("div",GL,[tt(h("input",{id:"staySignedIn",type:"checkbox","onUpdate:modelValue":R[1]||(R[1]=F=>f.value=F),class:"w-4 h-4"},null,512),[[Ii,f.value]]),R[11]||(R[11]=h("label",{for:"staySignedIn"},"Rester connecté sur cet appareil",-1))])]),h("button",{onClick:g,disabled:!s.value||i.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(V(),O("span",WL,"⏳")):(V(),O("span",QL,"🔓")),h("span",null,ae(i.value?"Vérification...":"Vérifier"),1)],8,HL)]),h("div",JL,[h("button",{onClick:R[2]||(R[2]=F=>a.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),o.value?(V(),O("div",YL,[h("div",XL,ae(o.value),1)])):ye("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:E,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ye("",!0),a.value?(V(),O("div",{key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:R[6]||(R[6]=F=>a.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:R[5]||(R[5]=mt(()=>{},["stop"]))},[h("div",ZL,[R[12]||(R[12]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"📧")],-1)),R[13]||(R[13]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Mot de passe oublié",-1)),h("p",e4,ae((q=n.player)==null?void 0:q.name),1)]),h("div",t4,[R[14]||(R[14]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:y,disabled:i.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[i.value?(V(),O("span",r4,"⏳")):(V(),O("span",s4,"📧")),h("span",null,ae(i.value?"Envoi...":"Envoyer l'email"),1)],8,n4)]),l.value?(V(),O("div",i4,[h("div",o4,ae(l.value),1)])):ye("",!0),c.value?(V(),O("div",a4,[h("div",l4,ae(c.value),1)])):ye("",!0),h("div",u4,[h("button",{onClick:R[4]||(R[4]=F=>a.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ye("",!0)],64)}}},c4={class:"mt-4"},d4={key:0,class:"mt-2 p-3 bg-blue-500/5 border border-blue-500/10 rounded-lg text-sm text-gray-300 space-y-2"},Ux={__name:"AccountBenefitsHint",setup(n){const e=P(!1);return(t,r)=>(V(),O("div",c4,[h("button",{onClick:r[0]||(r[0]=s=>e.value=!e.value),class:"w-full p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hover:bg-blue-500/20 transition-all duration-200 flex items-center justify-between"},[r[1]||(r[1]=h("h3",{class:"text-sm font-semibold text-blue-300"},"💡 A quoi sert un compte ?",-1)),h("span",{class:St(["text-blue-300 transition-transform duration-200",{"rotate-180":e.value}])},"▼",2)]),e.value?(V(),O("div",d4,r[2]||(r[2]=[h("div",{class:"text-gray-300"},"Ça fonctionne très bien sans compte. Mais si vous en créez un, vous aurez quelques trucs sympas en plus :",-1),h("div",null,[Yt("• "),h("span",{class:"text-blue-300"},"Protégez vos saisies :"),Yt(" vous êtes sûr que personne n'a changé vos dispos car vous êtes le seul à pouvoir les modifier")],-1),h("div",null,[Yt("• "),h("span",{class:"text-blue-300"},"Notifications :"),Yt(" nouveaux spectacles, disponibilités et sélections dans votre boite mail")],-1),h("div",null,[Yt("• "),h("span",{class:"text-blue-300"},"Saisie simplifiée :"),Yt(" votre joueur reste toujours en haut de la liste")],-1)]))):ye("",!0)]))}},h4={class:"text-center mb-6"},f4={class:"text-sm text-gray-300"},p4={key:0,class:"space-y-4"},m4={key:0,class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},g4={key:1,class:"space-y-4"},v4=["disabled"],y4={key:0,class:"animate-spin"},_4={key:1},b4={key:2,class:"mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},w4={class:"mt-6 flex justify-center gap-3"},I4=["disabled"],E4={key:0,class:"animate-spin"},x4={key:1},jx={__name:"AccountClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null}},emits:["close","success"],setup(n,{emit:e}){const t=n,r=e,s=P(1),i=P(""),o=P(""),a=P(""),l=P(!1),c=P(""),d=P(!1),f=hl(),g=Ue(()=>i.value&&i.value.includes("@")),y=Ue(()=>o.value&&a.value&&o.value===a.value&&o.value.length>=6);async function E(){var q,F,z;if(!(!g.value||!((q=t.player)!=null&&q.id))){l.value=!0,c.value="";try{const de=await Cx({playerId:t.player.id,email:i.value.trim(),seasonId:t.seasonId}),me=(F=f.params)==null?void 0:F.slug,T=`${de.url}${me?`&slug=${encodeURIComponent(me)}`:""}&player=${encodeURIComponent(t.player.id)}&open=protection`;await GM({toEmail:i.value,playerName:((z=t.player)==null?void 0:z.name)||"joueur",verifyUrl:T}),d.value=!0}catch{c.value="Impossible d'envoyer l'email de vérification"}finally{l.value=!1}}}async function A(){try{await Dx({playerId:t.player.id,seasonId:t.seasonId})}catch{}s.value=1,d.value=!1,i.value="",o.value="",a.value=""}async function R(){var q;try{const F=await Cl((q=t.player)==null?void 0:q.id,t.seasonId);F!=null&&F.email&&(F!=null&&F.emailVerifiedAt)?s.value=2:s.value=1}catch{s.value=1}}zn(()=>{R()}),Pt(()=>t.show,q=>{q&&R()});async function B(){if(y.value){l.value=!0,c.value="";try{await Rx(t.player.id,i.value.trim(),o.value,t.seasonId),r("success")}catch(q){c.value=(q==null?void 0:q.message)||"Erreur lors de l'association"}finally{l.value=!1}}}return(q,F)=>{var z;return n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[160] p-4",onClick:F[6]||(F[6]=de=>q.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:F[5]||(F[5]=mt(()=>{},["stop"]))},[h("button",{onClick:F[0]||(F[0]=de=>q.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",h4,[F[7]||(F[7]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"👤")],-1)),F[8]||(F[8]=h("h2",{class:"text-2xl font-bold text-white mb-1"},"Associer un compte",-1)),h("p",f4,"Pour sécuriser les saisies de "+ae((z=n.player)==null?void 0:z.name),1),st(Ux)]),s.value===1?(V(),O("div",p4,[h("div",null,[F[9]||(F[9]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Adresse email",-1)),tt(h("input",{"onUpdate:modelValue":F[1]||(F[1]=de=>i.value=de),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Nt,i.value]])]),d.value?(V(),O("div",m4,[F[10]||(F[10]=h("span",null,"✅",-1)),h("span",null,"Un email a été envoyé à "+ae(i.value)+". Cliquez sur le lien contenu dans l'email pour continuer.",1)])):ye("",!0)])):s.value===2?(V(),O("div",g4,[h("div",{class:"p-3 rounded-lg border border-green-500/30 bg-green-500/10 text-green-200 text-sm flex items-center gap-2"},[F[11]||(F[11]=h("span",null,"✅",-1)),F[12]||(F[12]=h("span",null,"Adresse email vérifiée",-1)),h("button",{type:"button",onClick:A,title:"Changer d'adresse email",class:"ml-auto px-2 py-1 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 text-white/80 hover:text-white transition-colors"},"✏️")]),h("div",null,[F[13]||(F[13]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),tt(h("input",{"onUpdate:modelValue":F[2]||(F[2]=de=>o.value=de),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe sécurisé (min. 6 caractères)"},null,512),[[Nt,o.value]])]),h("div",null,[F[14]||(F[14]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),tt(h("input",{"onUpdate:modelValue":F[3]||(F[3]=de=>a.value=de),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe"},null,512),[[Nt,a.value]])]),h("button",{onClick:B,disabled:!y.value||l.value,class:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(V(),O("span",y4,"⏳")):(V(),O("span",_4,"🔒")),h("span",null,ae(l.value?"Association...":"Associer ce joueur"),1)],8,v4)])):ye("",!0),c.value?(V(),O("div",b4,ae(c.value),1)):ye("",!0),h("div",w4,[s.value===1?(V(),O("button",{key:0,onClick:E,disabled:!g.value||l.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[l.value?(V(),O("span",E4,"⏳")):(V(),O("span",x4,"✉️")),h("span",null,ae(l.value?"Envoi...":"Envoyer le lien de vérification"),1)],8,I4)):ye("",!0),h("button",{onClick:F[4]||(F[4]=de=>q.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])):ye("",!0)}}},T4={class:"text-center mb-6"},A4={class:"text-2xl font-bold text-white mb-2"},S4={class:"text-lg text-gray-300"},P4={class:"mb-6"},R4={class:"flex items-center space-x-3"},C4={class:"text-2xl"},k4={class:"font-semibold text-white"},D4={class:"text-sm text-gray-300"},N4={key:0,class:"mb-6"},V4={key:1,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},O4={class:"text-red-300 text-sm"},M4={key:2,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},L4={class:"text-green-300 text-sm"},F4={class:"flex justify-center gap-3"},$4=["disabled"],U4={__name:"PlayerClaimModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},seasonId:{type:String,default:null},onboarding:{type:Boolean,default:!1}},emits:["close","update","onboarding-finished"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=P(!1),o=P(!1),a=P(""),l=P(""),c=P(!1);hl();const d=P(!1);Ue(()=>!1),Ue(()=>!1);function f(){l.value="Compte créé et joueur associé !",s.value=!0,c.value=!1,r("update")}async function g(){var B;if((B=t.player)!=null&&B.id){s.value=await Pi(t.player.id,t.seasonId);try{const{isPlayerPasswordCached:q}=await Xt(()=>Promise.resolve().then(()=>Tc),void 0);i.value=q(t.player.id)}catch{i.value=!1}}}function y(){var B;a.value="";try{if((B=t.player)!=null&&B.id&&$o(t.player.id)){E();return}}catch{}d.value=!0}async function E(){o.value=!0,a.value="",l.value="";try{const B=await Nx(t.player.id,t.seasonId);l.value="Joueur déverrouillé!",s.value=!1,B.email&&(email.value=B.email),r("update")}catch(B){logger.error("Erreur lors de la désactivation de la protection",B),a.value="Erreur lors de la désactivation de la protection. Veuillez réessayer."}finally{o.value=!1}}function A(){d.value=!1,E()}function R(){r("close")}return Pt(()=>t.player,()=>{t.show&&t.player&&g()},{immediate:!0}),Pt(()=>t.show,B=>{B&&t.player&&(a.value="",l.value="",d.value=!1,g(),t.onboarding&&Ut(()=>{}))}),(B,q)=>{var F;return V(),O(ct,null,[n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4",onClick:R},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:q[1]||(q[1]=mt(()=>{},["stop"]))},[h("button",{onClick:R,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"}," ✖️ "),h("div",T4,[q[4]||(q[4]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🔒")],-1)),h("h2",A4,ae(s.value?"Déverrouiller ce joueur":"Verrouiller ce joueur"),1),h("p",S4,ae((F=n.player)==null?void 0:F.name),1)]),h("div",P4,[h("div",{class:St(["flex items-center justify-between p-4 rounded-lg",s.value?"bg-green-500/20 border border-green-500/30":"bg-gray-500/20 border border-gray-500/30"])},[h("div",R4,[h("span",C4,ae(s.value?"🔒":"🔓"),1),h("div",null,[h("div",k4,ae(s.value?i.value?"Joueur associé à votre compte":"Ce joueur est associé à un compte utilisateur":"Joueur sans compte"),1),h("div",D4,ae(s.value?i.value?"Seul vous pouvez modifier":"Seul le titulaire peut modifier les disponibilités":"Tout le monde peut modifier les disponibilités"),1)])])],2)]),s.value?ye("",!0):(V(),O("div",N4,q[5]||(q[5]=[h("div",{class:"text-sm text-gray-300"},"Vous pouvez protéger vos saisies de disponibilités avec un compte utilisateur.",-1)]))),a.value?(V(),O("div",V4,[h("div",O4,ae(a.value),1)])):ye("",!0),l.value?(V(),O("div",M4,[h("div",L4,ae(l.value),1)])):ye("",!0),h("div",F4,[s.value?(V(),O("button",{key:1,onClick:y,disabled:o.value,class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," 🔓 Dissocier ",8,$4)):(V(),O("button",{key:0,onClick:q[0]||(q[0]=z=>c.value=!0),class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300"}," Associer un compte ")),h("button",{onClick:R,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ye("",!0),st(jx,{show:c.value,player:n.player,"season-id":n.seasonId,onClose:q[2]||(q[2]=z=>c.value=!1),onSuccess:f},null,8,["show","player","season-id"]),st(Hg,{show:d.value,player:n.player,seasonId:n.seasonId,onClose:q[3]||(q[3]=z=>d.value=!1),onVerified:A},null,8,["show","player","seasonId"])],64)}}};const j4=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},B4={class:"relative p-4 md:p-6 border-b border-white/10"},q4={class:"flex items-start gap-4 md:gap-6"},z4={class:"flex-1 min-w-0"},K4={class:"flex items-center gap-3 mb-2"},G4={class:"text-xl md:text-2xl font-bold text-white leading-tight"},H4={class:"flex items-center gap-2"},W4={key:0,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/30 rounded-full"},Q4={key:1,class:"flex items-center gap-1 px-2 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full"},J4={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},Y4={class:"grid grid-cols-3 gap-3 md:gap-4"},X4={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},Z4={class:"text-xl md:text-2xl font-bold text-white"},e3={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},t3={class:"text-xl md:text-2xl font-bold text-white"},n3={class:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 p-3 md:p-4 rounded-lg border border-green-500/30 text-center"},r3={class:"text-xl md:text-2xl font-bold text-white"},s3={class:"hidden md:flex justify-center flex-wrap gap-3 mt-6"},i3={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},o3={key:1,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},a3={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},l3={class:"mb-6"},u3={__name:"PlayerModal",props:{show:{type:Boolean,default:!1},player:{type:Object,default:null},stats:{type:Object,default:()=>({availability:0,selection:0,ratio:0})},seasonId:{type:String,default:null},onboardingStep:{type:Number,default:0},onboardingPlayerId:{type:[String,null],default:null},isProtected:{type:Boolean,default:!1},isPreferred:{type:Boolean,default:!1}},emits:["close","update","delete","refresh","advance-onboarding"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P(""),a=P(null),l=P(!1),c=P(!1),d=P(null);P(!1);const f=P(!1),g=P(!1),y=P(null),E=P(null),A=P({position:"fixed",top:"0px",left:"0px"}),R=P(null),B=P({position:"fixed",top:"0px",left:"0px"}),q=P(!1),F=P(!1);function z(){s("close"),f.value=!1,g.value=!1,A.value={position:"fixed",top:"0px",left:"0px"},B.value={position:"fixed",top:"0px",left:"0px"}}function de(){var W;o.value=((W=r.player)==null?void 0:W.name)||"",i.value=!0,Ut(()=>{a.value&&a.value.focus()})}function me(){i.value=!1,o.value=""}async function T(){var re,Se;if(!o.value.trim())return;if(await Pi((re=r.player)==null?void 0:re.id,r.seasonId)){$o((Se=r.player)==null?void 0:Se.id)?w():(d.value="update",c.value=!0);return}w()}function w(){var W;s("update",{playerId:(W=r.player)==null?void 0:W.id,newName:o.value.trim()}),i.value=!1,o.value=""}async function x(){var re,Se;if(await Pi((re=r.player)==null?void 0:re.id,r.seasonId)){$o((Se=r.player)==null?void 0:Se.id)?N():(d.value="delete",c.value=!0);return}N()}function N(){var W;s("delete",(W=r.player)==null?void 0:W.id)}function L(){s("refresh")}function j(W){d.value==="update"?w():d.value==="delete"&&N(),d.value=null}function C(){try{const W=y.value;if(!W)return;const re=W.getBoundingClientRect(),Se=8;if(window.innerWidth>768){const Z=Math.max(Se,Math.round(re.top-Se)),Q=Math.max(Se,Math.round(re.left));A.value={position:"fixed",top:`${Z}px`,left:`${Q}px`,zIndex:400}}else{const Z=Math.min(window.innerHeight-Se,Math.round(re.bottom+Se)),Q=Math.max(Se,Math.round(re.left));A.value={position:"fixed",top:`${Z}px`,left:`${Q}px`,zIndex:400}}}catch{}}function ht(){try{const Z=Math.max(8,window.innerHeight-8-48-120),Q=Math.max(8,Math.round(window.innerWidth-200-8));B.value={position:"fixed",top:`${Z}px`,left:`${Q}px`,zIndex:400}}catch{}}function et(){f.value=!f.value,f.value&&Ut(()=>C())}function ee(){g.value=!g.value,g.value&&Ut(()=>ht())}Pt(()=>r.show,W=>{var re;W||(i.value=!1,o.value="",d.value=null,l.value=!1,f.value=!1,g.value=!1),W&&((re=r.player)!=null&&re.id)&&(Pi(r.player.id,r.seasonId).then(Se=>{q.value=!!Se}),Xt(()=>Promise.resolve().then(()=>Tc),void 0).then(Se=>{try{F.value=!!Se.isPlayerPasswordCached(r.player.id)}catch{F.value=!1}}))}),zn(()=>{document.addEventListener("click",W=>{if(f.value){const re=y.value,Se=E.value,Z=re&&re.contains(W.target),Q=Se&&Se.contains(W.target);!Z&&!Q&&(f.value=!1)}if(g.value){const re=R.value;re&&re.contains(W.target)||(g.value=!1)}}),document.addEventListener("keydown",W=>{W.key==="Escape"&&(f.value&&(f.value=!1),g.value&&(g.value=!1))}),window.addEventListener("resize",()=>{f.value&&C(),g.value&&ht()}),window.addEventListener("scroll",()=>{f.value&&C(),g.value&&ht()},{passive:!0})}),e({openProtection(){l.value=!0}});const U=P({position:null});return Pt(()=>r.show,W=>{W&&r.onboardingStep===4?Ut(()=>{const re=document.querySelectorAll("button");let Se=null;if(re.forEach(Z=>{!Se&&Z.textContent&&Z.textContent.includes("Protection")&&(Se=Z)}),Se){const Z=Se.getBoundingClientRect();U.value.position={x:Math.round(Z.right+8),y:Math.round(Z.top+window.scrollY-4)}}}):W||(U.value.position=null)}),(W,re)=>{var Se;return V(),O(ct,null,[n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:z},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-xl max-h-[92vh] flex flex-col",onClick:re[6]||(re[6]=mt(()=>{},["stop"]))},[h("div",B4,[h("button",{onClick:z,class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("div",q4,[re[15]||(re[15]=h("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex-shrink-0 flex items-center justify-center"},[h("span",{class:"text-xl md:text-2xl"},"👤")],-1)),h("div",z4,[h("div",K4,[h("h2",G4,ae((Se=n.player)==null?void 0:Se.name),1),h("div",H4,[n.isProtected?(V(),O("div",W4,re[13]||(re[13]=[h("span",{class:"text-yellow-400 text-sm"},"🔒",-1),h("span",{class:"text-yellow-300 text-xs font-medium"},"Protégé",-1)]))):ye("",!0),n.isPreferred?(V(),O("div",Q4,re[14]||(re[14]=[h("span",{class:"text-purple-400 text-sm"},"⭐",-1),h("span",{class:"text-purple-300 text-xs font-medium"},"Favori",-1)]))):ye("",!0)])])])])]),h("div",J4,[h("div",null,[h("div",Y4,[h("div",X4,[h("div",Z4,ae(r.stats.availability),1),re[16]||(re[16]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibilités",-1))]),h("div",e3,[h("div",t3,ae(r.stats.selection),1),re[17]||(re[17]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélections",-1))]),h("div",n3,[h("div",r3,ae(r.stats.ratio),1),re[18]||(re[18]=h("div",{class:"text-xs md:text-sm text-gray-300"},"% de sélection",-1))])])]),h("div",s3,[h("button",{onClick:re[0]||(re[0]=Z=>l.value=!0),class:"px-5 py-3 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2"},[h("span",null,ae(q.value?"🔓":"🔒"),1),h("span",null,ae(q.value?"Déverrouiller":"Verrouiller"),1)]),h("div",{class:"relative",ref_key:"playerMoreActionsRef",ref:y},[h("button",{onClick:re[1]||(re[1]=Z=>et()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},re[19]||(re[19]=[h("span",null,"⋯",-1),h("span",null,"Plus",-1)]))],512),h("button",{onClick:z,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer "),(V(),ko(fu,{to:"body"},[f.value?(V(),O("div",{key:0,ref_key:"playerMoreActionsDropdownRef",ref:E,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:mr(A.value)},[h("button",{onClick:re[2]||(re[2]=Z=>{de(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},re[20]||(re[20]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:re[3]||(re[3]=Z=>{x(),f.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},re[21]||(re[21]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ye("",!0)]))])]),h("div",i3,[h("button",{onClick:re[4]||(re[4]=Z=>l.value=!0),class:"h-12 px-4 bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-lg hover:from-yellow-600 hover:to-orange-700 transition-all duration-300 flex-[1.4]"},ae(q.value?"🔓 Déverrouiller":"🔒 Verrouiller"),1),h("button",{onClick:re[5]||(re[5]=Z=>ee()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"}," ⋯ "),h("button",{onClick:z,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"}," Fermer ")])])])):ye("",!0),(V(),ko(fu,{to:"body"},[g.value?(V(),O("div",{key:0,ref_key:"playerMoreActionsMobileDropdownRef",ref:R,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:mr(B.value)},[h("button",{onClick:re[7]||(re[7]=Z=>{de(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},re[22]||(re[22]=[h("span",null,"✏️",-1),h("span",null,"Renommer",-1)])),h("button",{onClick:re[8]||(re[8]=Z=>{x(),g.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},re[23]||(re[23]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ye("",!0)])),i.value?(V(),O("div",o3,[h("div",a3,[re[25]||(re[25]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Renommer le joueur",-1)),h("div",l3,[re[24]||(re[24]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),tt(h("input",{"onUpdate:modelValue":re[9]||(re[9]=Z=>o.value=Z),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Un(me,["esc"]),Un(T,["enter"])],ref_key:"editNameInput",ref:a},null,544),[[Nt,o.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:me,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:T,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ye("",!0),st(U4,{show:l.value,player:n.player,seasonId:n.seasonId,onboarding:n.onboardingStep===4,onClose:re[10]||(re[10]=Z=>l.value=!1),onUpdate:L,onOnboardingFinished:re[11]||(re[11]=Z=>W.$emit("advance-onboarding",5))},null,8,["show","player","seasonId","onboarding"]),st(Hg,{show:c.value,player:n.player,seasonId:n.seasonId,onClose:re[12]||(re[12]=Z=>c.value=!1),onVerified:j},null,8,["show","player","seasonId"])],64)}}},c3=j4(u3,[["__scopeId","data-v-8237d7ee"]]),d3={class:"relative p-6 pb-4 border-b border-white/10"},h3={class:"sticky bottom-0 p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex justify-end"},f3={__name:"HowItWorksModal",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:e}){const t=e;return(r,s)=>n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[90] p-0 md:p-4",onClick:s[3]||(s[3]=i=>t("close"))},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:s[2]||(s[2]=mt(()=>{},["stop"]))},[h("div",d3,[h("button",{onClick:s[0]||(s[0]=i=>t("close")),title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),s[4]||(s[4]=h("div",{class:"flex items-center gap-3"},[h("div",{class:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full flex items-center justify-center text-2xl"},"❓"),h("div",null,[h("h2",{class:"text-xl md:text-2xl font-bold text-white"},"Comment fonctionne la sélection automatique ?"),h("p",{class:"text-sm text-blue-300"},"Tirage au sort pondéré pour favoriser l'équité")])],-1))]),s[5]||(s[5]=Xn('<div class="px-4 md:px-6 py-4 md:py-6 overflow-y-auto space-y-4 text-gray-200"><div class="bg-white/5 border border-white/10 rounded-lg p-4"><h3 class="text-white font-semibold mb-2">En bref</h3><p>On tire au sort uniquement parmi les joueurs <span class="text-green-300">disponibles</span>. Ceux qui ont <span class="text-purple-300">moins joué</span> ont plus de chances d&#39;être tirés. À long terme, tout le monde joue à peu près autant.</p></div><div class="space-y-3"><h3 class="text-white font-semibold">Détails du tirage</h3><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><span class="text-white">Qui participe ?</span> Tous les joueurs marqués « ✅ Disponible » pour l’événement.</li><li><span class="text-white">Un coup de pouce aux moins joués</span> : si vous avez moins joué récemment, le tirage vous favorise un peu plus.</li><li><span class="text-white">Comment se fait le tirage ?</span> On tire un nom au hasard en tenant compte de cet avantage, on le met de côté, puis on recommence jusqu’à avoir assez de joueurs.</li><li><span class="text-white">Si on relance</span> : on garde les joueurs encore disponibles et on complète seulement les places manquantes.</li><li><span class="text-white">Indisponibles</span> : ils ne sont jamais tirés au sort.</li></ol></div><div class="space-y-2"><h3 class="text-white font-semibold">Estimation des chances</h3><p>L’application peut afficher un pourcentage indicatif pour aider à comprendre : si Alice a moins joué que Bob, elle aura un pourcentage plus élevé. C’est une indication, pas une promesse : deux tirages peuvent donner des résultats différents.</p></div><div class="space-y-2"><h3 class="text-white font-semibold">Pourquoi c’est juste</h3><ul class="list-disc list-inside space-y-1 text-gray-300"><li>Ceux qui ont moins joué ont automatiquement plus de chances.</li><li>Après une sélection, vos chances diminuent un peu pour laisser la place aux autres.</li><li>Sur la durée, les sélections s’<span class="text-green-300">équilibrent naturellement</span>.</li></ul></div><div class="space-y-2"><h3 class="text-white font-semibold">Exemples rapides</h3><p> • Alice n’a encore jamais été sélectionnée, Bob a été sélectionné une fois, Charlie plusieurs fois. Pour 1 place, on aura environ : Alice 57 %, Bob 29 %, Charlie 14 %.<br> • S’il y a 2 places, les chances de chacun augmentent, mais l’ordre reste aléatoire : un tirage peut donner Alice + Bob, un autre Alice + Charlie. </p></div><div class="text-xs text-gray-400"> Remarque : l’algorithme favorise l’équité à long terme, mais <span class="text-gray-300">n’assure pas</span> une rotation parfaite à chaque événement. </div></div>',1)),h("div",h3,[h("button",{onClick:s[1]||(s[1]=i=>t("close")),class:"h-10 px-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600"},"Compris")])])])):ye("",!0)}},p3={class:"relative p-4 md:p-6 border-b border-white/10"},m3={class:"flex items-start gap-4 md:gap-6"},g3={class:"flex-1 min-w-0"},v3={class:"text-xl md:text-2xl font-bold text-white leading-tight mb-2"},y3={class:"flex items-center gap-3"},_3={class:"text-base md:text-lg text-purple-300"},b3={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},w3={class:"text-blue-200"},I3={key:0,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm flex items-center gap-1",title:"Prêt pour la sélection"},E3={key:1,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded text-sm flex items-center gap-1",title:"Sélection complète"},x3={key:2,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded text-sm flex items-center gap-1",title:"Sélection incomplète"},T3={key:3,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded text-sm flex items-center gap-1",title:"Pas assez de joueurs disponibles"},A3={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},S3={class:"grid grid-cols-3 gap-3 md:gap-4 mb-4"},P3={class:"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 p-3 md:p-4 rounded-lg border border-yellow-500/30 text-center"},R3={class:"text-xl md:text-2xl font-bold text-yellow-300"},C3={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},k3={class:"text-xl md:text-2xl font-bold text-white"},D3={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},N3={class:"text-xl md:text-2xl font-bold text-white"},V3={class:"mb-3"},O3={class:"grid grid-cols-2 md:grid-cols-3 gap-3 mb-0"},M3={key:0,class:"flex items-center justify-between gap-2"},L3=["title"],F3={key:0,class:"text-purple-400 mr-2"},$3={key:1,class:"text-green-400 mr-2"},U3={key:2,class:"text-red-400 mr-2"},j3={key:3,class:"text-gray-400 mr-2"},B3=["onClick"],q3={key:1,class:"flex items-center justify-center"},z3=["onChange"],K3=["value"],G3=["onClick"],H3={key:0,class:"mb-3"},W3={key:1,class:"mb-3"},Q3={class:"flex items-center space-x-3 p-3 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-lg border border-blue-500/20"},J3={class:"flex-1"},Y3={class:"text-blue-300 text-sm font-medium"},X3={class:"sticky bottom-0 w-full p-3 bg-gray-900/80 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Z3=["disabled","title"],eF=["disabled"],tF={__name:"SelectionModal",props:{show:{type:Boolean,default:!1},event:{type:Object,default:null},currentSelection:{type:Array,default:()=>[]},availableCount:{type:Number,default:0},selectedCount:{type:Number,default:0},playerAvailability:{type:Object,default:()=>({})},seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},players:{type:Array,default:()=>[]}},emits:["close","selection","perfect","send-notifications"],setup(n,{expose:e,emit:t}){const r=n,s=t,i=P(!1),o=P("Copier le message"),a=P(!1),l=P(!1),c=P(""),d=P(!1),f=P(!1),g=Ue(()=>{var Z;return((Z=r.event)==null?void 0:Z.playerCount)||6}),y=P([]),E=P(null),A=Ue(()=>(r.players||[]).map(Z=>Z.name).filter(Z=>{var Q;return((Q=r.playerAvailability)==null?void 0:Q[Z])===!0}).sort((Z,Q)=>Z.localeCompare(Q,"fr",{sensitivity:"base"})));function R(Z){const Q=new Set(y.value.filter(Boolean)),Ee=y.value[Z];return Ee&&Q.delete(Ee),A.value.filter(We=>!Q.has(We))}function B(Z){E.value=Z}function q(){E.value=null}async function F(Z,Q){var We;const Ee=((We=Z==null?void 0:Z.target)==null?void 0:We.value)||"";Ee&&(y.value[Q]=Ee,await L()),E.value=null}async function z(Z){y.value[Z]=null,await L()}Ue(()=>(R(-1).length<g.value,""));const de=Ue(()=>r.currentSelection&&r.currentSelection.length>0);function me(){var We;const Z=r.currentSelection||[],Q=((We=r.event)==null?void 0:We.playerCount)||6,Ee=r.availableCount||0;if(Z.length>0){const ft=Z.some(D=>!et(D)),vt=Ee<Q;if(ft||vt)return{type:"incomplete",hasUnavailablePlayers:ft,hasInsufficientPlayers:vt,unavailablePlayers:Z.filter(D=>!et(D)),availableCount:Ee,requiredCount:Q}}return Ee<Q?{type:"insufficient",availableCount:Ee,requiredCount:Q}:Z.length===0?{type:"ready",availableCount:Ee,requiredCount:Q}:{type:"complete",availableCount:Ee,requiredCount:Q}}const T=Ue(()=>{var We;if(!de.value)return!1;const Z=r.currentSelection.some(ft=>!et(ft)),Q=((We=r.event)==null?void 0:We.playerCount)||6,Ee=r.availableCount<Q;return Z||Ee});Ue(()=>{var Ee;if(!T.value)return"";const Z=r.currentSelection.filter(We=>!et(We)),Q=((Ee=r.event)==null?void 0:Ee.playerCount)||6;return Z.length>0?Z.length===1?`${Z[0]} n'est plus disponible. Veuillez relancer la sélection.`:`${Z.length} joueurs ne sont plus disponibles. Veuillez relancer la sélection.`:r.availableCount<Q?`Seulement ${r.availableCount} joueurs disponibles pour ${Q} requis. Veuillez attendre plus de disponibilités ou ajuster le nombre de joueurs à sélectionner.`:"Sélection incomplète"}),Ue(()=>{if(!r.event||!de.value)return"";const Z=w(r.event.date),Q=r.currentSelection.join(", ");return`Sélection pour ${r.event.title} du ${Z} : ${Q}`}),Pt(()=>r.show,Z=>{if(Z){i.value=!1,o.value="Copier le message",l.value=!1,c.value="",d.value=!1,a.value=!1;const Q=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Ee=g.value;y.value=Array.from({length:Ee},(We,ft)=>Q[ft]||null),E.value=null}}),Pt([g,()=>r.currentSelection,()=>{var Z;return(Z=r.event)==null?void 0:Z.id}],()=>{if(!r.show)return;const Z=Array.isArray(r.currentSelection)?[...r.currentSelection]:[],Q=g.value,Ee=Array.from({length:Q},(We,ft)=>Z[ft]||y.value[ft]||null);y.value=Ee.slice(0,Q)});function w(Z){var Ee;return Z?(typeof Z=="string"?new Date(Z):((Ee=Z.toDate)==null?void 0:Ee.call(Z))||Z).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function x(){s("selection")}function N(){s("perfect")}async function L(){var Z;if(!(!((Z=r.event)!=null&&Z.id)||!r.seasonId))try{const Q=y.value.filter(Boolean);await Kp(r.event.id,Q,r.seasonId),console.debug("Sélection sauvegardée automatiquement")}catch(Q){console.error("Erreur lors de la sauvegarde automatique:",Q)}}function j(){s("close")}function C(){a.value=!0}function ht(){f.value=!0}function et(Z){return r.playerAvailability[Z]===!0}function ee(Z){return r.playerAvailability[Z]===!1}function U(Z){return r.currentSelection.includes(Z)&&et(Z)}function W(Z=!1,Q=!1){if(d.value=Z,Z){const Ee=w(r.event.date),We=r.currentSelection.join(", ");Q?c.value=`Sélection mise à jour pour ${r.event.title} du ${Ee} : ${We}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`:c.value=`Nouvelle sélection pour ${r.event.title} du ${Ee} : ${We}. Pensez à prévenir les joueurs via le bouton "Annoncer" !`}else c.value="Sélection effectuée avec succès !";l.value=!0,setTimeout(()=>{l.value=!1},8e3)}function re(){l.value=!1}e({showSuccess:W});function Se(Z){s("send-notifications",Z)}return(Z,Q)=>{var Ee,We,ft,vt;return V(),O(ct,null,[n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:j},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:Q[1]||(Q[1]=mt(()=>{},["stop"]))},[h("div",p3,[h("button",{onClick:j,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("div",m3,[Q[9]||(Q[9]=h("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[h("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),h("div",g3,[h("h2",v3,"Sélection pour "+ae((Ee=n.event)==null?void 0:Ee.title),1),h("div",y3,[h("p",_3,ae(w((We=n.event)==null?void 0:We.date)),1),h("div",b3,[Q[4]||(Q[4]=h("span",{class:"text-blue-300"},"👥",-1)),h("span",w3,ae(((ft=n.event)==null?void 0:ft.playerCount)||6)+" joueurs",1)]),me().type==="ready"?(V(),O("div",I3,Q[5]||(Q[5]=[h("span",{class:"text-blue-300 text-xs"},"🆕",-1),h("span",{class:"text-blue-200 text-xs"},"Nouveau",-1)]))):me().type==="complete"?(V(),O("div",E3,Q[6]||(Q[6]=[h("span",{class:"text-green-300 text-xs"},"✅",-1),h("span",{class:"text-green-200 text-xs"},"Complet",-1)]))):me().type==="incomplete"?(V(),O("div",x3,Q[7]||(Q[7]=[h("span",{class:"text-orange-300 text-xs"},"⚠️",-1),h("span",{class:"text-orange-200 text-xs"},"À finaliser",-1)]))):me().type==="insufficient"?(V(),O("div",T3,Q[8]||(Q[8]=[h("span",{class:"text-red-300 text-xs"},"❌",-1),h("span",{class:"text-red-200 text-xs"},"Manque",-1)]))):ye("",!0)])])])]),h("div",A3,[h("div",S3,[h("div",P3,[h("div",R3,ae(Math.max((((vt=n.event)==null?void 0:vt.playerCount)||6)-n.selectedCount,0)),1),Q[10]||(Q[10]=h("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))]),h("div",C3,[h("div",k3,ae(n.availableCount),1),Q[11]||(Q[11]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",D3,[h("div",N3,ae(n.selectedCount),1),Q[12]||(Q[12]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))])]),h("div",V3,[h("div",{class:"flex items-center gap-2 mb-2"},[Q[14]||(Q[14]=h("h3",{class:"text-base md:text-lg font-semibold text-white"},"Joueurs sélectionnés",-1)),h("button",{onClick:ht,class:"text-blue-300 hover:text-blue-200 p-1 rounded-full hover:bg-blue-500/10 transition-colors",title:"Comment fonctionne la sélection automatique ?"},Q[13]||(Q[13]=[h("span",{class:"text-sm"},"❓",-1)]))]),h("div",O3,[(V(!0),O(ct,null,Tr(y.value,(D,$)=>(V(),O("div",{key:"sel-slot-"+$,class:St(["relative p-3 rounded-lg border text-center transition-colors",D?["bg-gradient-to-r",ee(D)?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30":et(D)?"from-green-500/20 to-emerald-500/20 border-green-500/30":"from-red-500/20 to-red-600/20 border-red-500/30"]:"border-dashed border-white/20 hover:border-white/40 bg-white/5"])},[D?(V(),O("div",M3,[h("div",{class:"flex-1 text-white font-medium truncate",title:D},[U(D)?(V(),O("span",F3,"🎭")):et(D)?(V(),O("span",$3,"✅")):ee(D)?(V(),O("span",U3,"❌")):(V(),O("span",j3,"–")),Yt(" "+ae(D),1)],8,L3),h("button",{onClick:te=>z($),class:"text-white/80 hover:text-white rounded-full hover:bg-white/10 px-2 py-1",title:"Retirer ce joueur"}," × ",8,B3)])):(V(),O("div",q3,[E.value===$?(V(),O("select",{key:0,class:"w-full bg-gray-800 text-white rounded-md p-2 border border-white/20 focus:outline-none",onChange:te=>F(te,$),onBlur:Q[0]||(Q[0]=te=>q())},[Q[15]||(Q[15]=h("option",{value:""},"— Choisir —",-1)),(V(!0),O(ct,null,Tr(R($),te=>(V(),O("option",{key:te,value:te},ae(te),9,K3))),128))],40,z3)):(V(),O("button",{key:1,onClick:te=>B($),class:"flex items-center gap-2 text-white/80 hover:text-white px-2 py-1 rounded-md hover:bg-white/10",title:"Ajouter un joueur"},Q[16]||(Q[16]=[h("span",{class:"text-lg"},"＋",-1),h("span",{class:"text-sm"},"Ajouter",-1)]),8,G3))]))],2))),128))])]),de.value?(V(),O("div",H3,Q[17]||(Q[17]=[h("div",{class:"flex items-center space-x-2 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20"},[h("div",{class:"text-yellow-400"},"⚠️"),h("div",{class:"text-yellow-200 text-sm"},"Pensez à prévenir les gens de vos changements !")],-1)]))):ye("",!0),l.value?(V(),O("div",W3,[h("div",Q3,[Q[19]||(Q[19]=h("div",{class:"text-blue-400 text-xl"},"✨",-1)),h("div",J3,[h("p",Y3,ae(c.value),1)]),h("button",{onClick:re,class:"text-blue-400 hover:text-blue-300 transition-colors",title:"Fermer le message"},Q[18]||(Q[18]=[h("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):ye("",!0)]),h("div",X3,[h("button",{onClick:x,disabled:n.availableCount===0,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex-1 whitespace-nowrap",title:n.availableCount===0?"Aucun joueur disponible":de.value?"Relancer la sélection automatique":"Lancer la sélection automatique"},Q[20]||(Q[20]=[Yt(" ✨ "),h("span",{class:"hidden sm:inline"},"Sélection Auto",-1),h("span",{class:"sm:hidden"},"Auto",-1)]),8,Z3),h("button",{onClick:C,disabled:!de.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 flex-1 whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"},Q[21]||(Q[21]=[Yt(" 📣 "),h("span",{class:"hidden sm:inline"},"Annoncer",-1),h("span",{class:"sm:hidden"},"Annoncer",-1)]),8,eF),h("button",{onClick:N,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 whitespace-nowrap"},Q[22]||(Q[22]=[h("span",{class:"hidden sm:inline"},"Fermer",-1),h("span",{class:"sm:hidden"},"Fermer",-1)]))])])])):ye("",!0),st($x,{show:a.value,event:n.event,"season-id":n.seasonId,"season-slug":n.seasonSlug,players:n.players,mode:"selection","selected-players":n.currentSelection,onClose:Q[2]||(Q[2]=D=>a.value=!1),onSendNotifications:Se},null,8,["show","event","season-id","season-slug","players","selected-players"]),st(f3,{show:f.value,onClose:Q[3]||(Q[3]=D=>f.value=!1)},null,8,["show"])],64)}}},nF={class:"flex items-center justify-center gap-2"},rF=["title"],sF=["title"],iF=["title"],oF=["title"],aF=["title"],f_={__name:"AvailabilityCell",props:{playerName:{type:String,required:!0},compact:{type:Boolean,default:!1},eventId:{type:String,required:!0},isAvailable:{type:Boolean,default:null},isSelected:{type:Boolean,default:!1},chancePercent:{type:Number,default:null},showSelectedChance:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["toggle"],setup(n,{emit:e}){const t=n,r=e,s=P(!1),i=Ue(()=>!(t.chancePercent==null||t.isAvailable!==!0||t.isSelected&&!t.showSelectedChance)),o=Ue(()=>t.disabled?"Événement archivé — désarchivez pour modifier":t.isSelected&&t.isAvailable===!0?i.value?`${t.playerName} est sélectionné pour cet événement • avait ~${t.chancePercent}% de chances`:`${t.playerName} est sélectionné pour cet événement`:t.isAvailable===!0?t.chancePercent!=null?`${t.playerName} est disponible • ~${t.chancePercent}% de chances d'être sélectionné`:`${t.playerName} est disponible`:t.isAvailable===!1?`${t.playerName} n'est pas disponible`:`Cliquer pour indiquer la disponibilité de ${t.playerName}`);function a(){t.disabled||r("toggle",t.playerName,t.eventId)}return(l,c)=>(V(),O("div",{class:St(["flex items-center justify-center transition-all duration-200",[n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-white/10",n.compact?"min-h-0 p-1 md:p-2":"min-h-20 p-3 md:p-5"]]),onClick:a,onMouseenter:c[0]||(c[0]=d=>s.value=!0),onMouseleave:c[1]||(c[1]=d=>s.value=!1)},[h("div",nF,[i.value&&s.value?(V(),O("span",{key:0,class:"text-[11px] md:text-xs px-2 py-0.5 rounded-full bg-emerald-500/15 border border-emerald-400/40 text-emerald-200",title:o.value},ae(n.chancePercent)+"% ",9,rF)):(V(),O(ct,{key:1},[n.isSelected&&n.isAvailable===!0?(V(),O("span",{key:0,class:St([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," 🎭 ",10,sF)):n.isAvailable===!0?(V(),O("span",{key:1,class:St([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," ✅ ",10,iF)):n.isAvailable===!1?(V(),O("span",{key:2,class:St([n.compact?"text-xl md:text-2xl":"text-2xl md:text-3xl","hover:scale-110 transition-transform duration-200"]),title:o.value}," ❌ ",10,oF)):(V(),O("span",{key:3,class:St(["text-gray-500 transition-colors duration-200",[n.compact?"text-base md:text-lg":"text-xl md:text-2xl",n.disabled?"":"hover:text-white"]]),title:o.value}," – ",10,aF))],64))])],34))}},lF={key:0,class:"fixed inset-0 z-[130] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"},uF={class:"w-full max-w-xl bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl text-center"},cF={class:"text-2xl md:text-3xl font-bold text-white mb-3"},dF={class:"text-gray-300 mb-6"},hF={class:"flex flex-col items-stretch justify-center gap-3"},fF=["value"],pF={__name:"CreatorOnboardingModal",props:{seasonId:{type:String,default:""},seasonSlug:{type:String,default:""},playersCount:{type:Number,default:0},eventsCount:{type:Number,default:0},onboardingDone:{type:Boolean,default:!1}},emits:["create-event","add-player","copy-link","dismissed"],setup(n,{emit:e}){const t=n,r=e,s=window.location.origin,i=Ue(()=>`${s}/season/${t.seasonSlug}`),o=P(!1);try{t.seasonId&&(o.value=!!localStorage.getItem(`dismissCreatorOnboarding:${t.seasonId}`))}catch{}const a=Ue(()=>t.onboardingDone?0:t.eventsCount===0&&t.playersCount===0?1:t.eventsCount>0&&t.playersCount===0?2:t.eventsCount>0&&t.playersCount>0&&!o.value?3:0),l=Ue(()=>a.value>0),c=P(l.value);Pt(a,R=>{c.value=R>0});const d=Ue(()=>{switch(a.value){case 1:return"Commençons par créer votre premier événement";case 2:return"Super ! Ajoutez votre premier joueur";case 3:return"Vous y êtes presque! Maintenant, invitez vos joueurs.";default:return""}}),f=Ue(()=>{switch(a.value){case 1:return"Un titre, une date... et c’est parti.";case 2:return"Ajoutez au moins un joueur pour commencer à saisir des disponibilités.";case 3:return"Laissez vos membres s’inscrire eux-même et indiquer leurs disponibilités en leur envoyant le lien direct.";default:return""}});function g(){c.value=!1,r("create-event")}function y(){c.value=!1,r("add-player")}function E(){var R;try{(R=navigator.clipboard)==null||R.writeText(i.value)}catch{}r("copy-link")}async function A(){try{if(t.seasonId){const{db:R}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0),{doc:B,updateDoc:q}=await Xt(()=>import("./index.esm-f01e8498.js"),[]);await q(B(R,"seasons",t.seasonId),{onboardingCreatorDone:!0})}else localStorage.setItem("dismissCreatorOnboarding","1")}catch{}o.value=!0,c.value=!1,r("dismissed")}return(R,B)=>l.value&&c.value?(V(),O("div",lF,[h("div",uF,[B[1]||(B[1]=h("div",{class:"w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto mb-6 flex items-center justify-center"},[h("span",{class:"text-3xl"},"🎬")],-1)),h("h2",cF,ae(d.value),1),h("p",dF,ae(f.value),1),h("div",hF,[a.value===1?(V(),O("button",{key:0,onClick:g,class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all"}," ✨ Créer un événement ")):a.value===2?(V(),O("button",{key:1,onClick:y,class:"px-5 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all"}," 👤 Ajouter un joueur ")):a.value===3?(V(),O(ct,{key:2},[h("input",{value:i.value,type:"text",readonly:"",class:"w-full px-3 py-2 bg-gray-800 border border-white/20 rounded-lg text-white text-sm select-all",onFocus:B[0]||(B[0]=q=>q.target.select())},null,40,fF),h("div",{class:"flex gap-3 justify-center"},[h("button",{onClick:E,class:"px-5 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-all"}," 🔗 Copier le lien "),h("button",{onClick:A,class:"px-5 py-3 bg-transparent text-gray-300 border border-white/20 rounded-lg hover:bg-white/10 transition-all"}," J’ai compris ")])],64)):ye("",!0)])])])):ye("",!0)}},Bx="@firebase/installations",Wg="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qx=1e4,zx=`w:${Wg}`,Kx="FIS_v2",mF="https://firebaseinstallations.googleapis.com/v1",gF=60*60*1e3,vF="installations",yF="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _F={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Jo=new Xo(vF,yF,_F);function Gx(n){return n instanceof fs&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hx({projectId:n}){return`${mF}/projects/${n}/installations`}function Wx(n){return{token:n.token,requestStatus:2,expiresIn:wF(n.expiresIn),creationTime:Date.now()}}async function Qx(n,e){const r=(await e.json()).error;return Jo.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function Jx({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function bF(n,{refreshToken:e}){const t=Jx(n);return t.append("Authorization",IF(e)),t}async function Yx(n){const e=await n();return e.status>=500&&e.status<600?n():e}function wF(n){return Number(n.replace("s","000"))}function IF(n){return`${Kx} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EF({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=Hx(n),s=Jx(n),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={fid:t,authVersion:Kx,appId:n.appId,sdkVersion:zx},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Yx(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:Wx(c.authToken)}}else throw await Qx("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xx(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xF(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TF=/^[cdef][\w-]{21}$/,Jp="";function AF(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=SF(n);return TF.test(t)?t:Jp}catch{return Jp}}function SF(n){return xF(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zx=new Map;function eT(n,e){const t=nf(n);tT(t,e),PF(t,e)}function tT(n,e){const t=Zx.get(n);if(t)for(const r of t)r(e)}function PF(n,e){const t=RF();t&&t.postMessage({key:n,fid:e}),CF()}let Vo=null;function RF(){return!Vo&&"BroadcastChannel"in self&&(Vo=new BroadcastChannel("[Firebase] FID Change"),Vo.onmessage=n=>{tT(n.data.key,n.data.fid)}),Vo}function CF(){Zx.size===0&&Vo&&(Vo.close(),Vo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kF="firebase-installations-database",DF=1,Yo="firebase-installations-store";let Wf=null;function Qg(){return Wf||(Wf=_h(kF,DF,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Yo)}}})),Wf}async function sh(n,e){const t=nf(n),s=(await Qg()).transaction(Yo,"readwrite"),i=s.objectStore(Yo),o=await i.get(t);return await i.put(e,t),await s.done,(!o||o.fid!==e.fid)&&eT(n,e.fid),e}async function nT(n){const e=nf(n),r=(await Qg()).transaction(Yo,"readwrite");await r.objectStore(Yo).delete(e),await r.done}async function rf(n,e){const t=nf(n),s=(await Qg()).transaction(Yo,"readwrite"),i=s.objectStore(Yo),o=await i.get(t),a=e(o);return a===void 0?await i.delete(t):await i.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&eT(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jg(n){let e;const t=await rf(n.appConfig,r=>{const s=NF(r),i=VF(n,s);return e=i.registrationPromise,i.installationEntry});return t.fid===Jp?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function NF(n){const e=n||{fid:AF(),registrationStatus:0};return rT(e)}function VF(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Jo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=OF(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:MF(n)}:{installationEntry:e}}async function OF(n,e){try{const t=await EF(n,e);return sh(n.appConfig,t)}catch(t){throw Gx(t)&&t.customData.serverCode===409?await nT(n.appConfig):await sh(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function MF(n){let e=await p_(n.appConfig);for(;e.registrationStatus===1;)await Xx(100),e=await p_(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await Jg(n);return r||t}return e}function p_(n){return rf(n,e=>{if(!e)throw Jo.create("installation-not-found");return rT(e)})}function rT(n){return LF(n)?{fid:n.fid,registrationStatus:0}:n}function LF(n){return n.registrationStatus===1&&n.registrationTime+qx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FF({appConfig:n,heartbeatServiceProvider:e},t){const r=$F(n,t),s=bF(n,t),i=e.getImmediate({optional:!0});if(i){const c=await i.getHeartbeatsHeader();c&&s.append("x-firebase-client",c)}const o={installation:{sdkVersion:zx,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},l=await Yx(()=>fetch(r,a));if(l.ok){const c=await l.json();return Wx(c)}else throw await Qx("Generate Auth Token",l)}function $F(n,{fid:e}){return`${Hx(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yg(n,e=!1){let t;const r=await rf(n.appConfig,i=>{if(!sT(i))throw Jo.create("not-registered");const o=i.authToken;if(!e&&BF(o))return i;if(o.requestStatus===1)return t=UF(n,e),i;{if(!navigator.onLine)throw Jo.create("app-offline");const a=zF(i);return t=jF(n,a),a}});return t?await t:r.authToken}async function UF(n,e){let t=await m_(n.appConfig);for(;t.authToken.requestStatus===1;)await Xx(100),t=await m_(n.appConfig);const r=t.authToken;return r.requestStatus===0?Yg(n,e):r}function m_(n){return rf(n,e=>{if(!sT(e))throw Jo.create("not-registered");const t=e.authToken;return KF(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function jF(n,e){try{const t=await FF(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await sh(n.appConfig,r),t}catch(t){if(Gx(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await nT(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await sh(n.appConfig,r)}throw t}}function sT(n){return n!==void 0&&n.registrationStatus===2}function BF(n){return n.requestStatus===2&&!qF(n)}function qF(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+gF}function zF(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function KF(n){return n.requestStatus===1&&n.requestTime+qx<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GF(n){const e=n,{installationEntry:t,registrationPromise:r}=await Jg(e);return r?r.catch(console.error):Yg(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HF(n,e=!1){const t=n;return await WF(t),(await Yg(t,e)).token}async function WF(n){const{registrationPromise:e}=await Jg(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QF(n){if(!n||!n.options)throw Qf("App Configuration");if(!n.name)throw Qf("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Qf(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Qf(n){return Jo.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iT="installations",JF="installations-internal",YF=n=>{const e=n.getProvider("app").getImmediate(),t=QF(e),r=ji(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},XF=n=>{const e=n.getProvider("app").getImmediate(),t=ji(e,iT).getImmediate();return{getId:()=>GF(t),getToken:s=>HF(t,s)}};function ZF(){ds(new Br(iT,YF,"PUBLIC")),ds(new Br(JF,XF,"PRIVATE"))}ZF();Sr(Bx,Wg);Sr(Bx,Wg,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e$="/firebase-messaging-sw.js",t$="/firebase-cloud-messaging-push-scope",oT="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",n$="https://fcmregistrations.googleapis.com/v1",aT="google.c.a.c_id",r$="google.c.a.c_l",s$="google.c.a.ts",i$="google.c.a.e";var g_;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(g_||(g_={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Zu;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(Zu||(Zu={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ts(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function o$(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;++i)s[i]=r.charCodeAt(i);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jf="fcm_token_details_db",a$=5,v_="fcm_token_object_Store";async function l$(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(i=>i.name).includes(Jf))return null;let e=null;return(await _h(Jf,a$,{upgrade:async(r,s,i,o)=>{var a;if(s<2||!r.objectStoreNames.contains(v_))return;const l=o.objectStore(v_),c=await l.index("fcmSenderId").get(n);if(await l.clear(),!!c){if(s===2){const d=c;if(!d.auth||!d.p256dh||!d.endpoint)return;e={token:d.fcmToken,createTime:(a=d.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:d.auth,p256dh:d.p256dh,endpoint:d.endpoint,swScope:d.swScope,vapidKey:typeof d.vapidKey=="string"?d.vapidKey:Ts(d.vapidKey)}}}else if(s===3){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:Ts(d.auth),p256dh:Ts(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:Ts(d.vapidKey)}}}else if(s===4){const d=c;e={token:d.fcmToken,createTime:d.createTime,subscriptionOptions:{auth:Ts(d.auth),p256dh:Ts(d.p256dh),endpoint:d.endpoint,swScope:d.swScope,vapidKey:Ts(d.vapidKey)}}}}}})).close(),await Vf(Jf),await Vf("fcm_vapid_details_db"),await Vf("undefined"),u$(e)?e:null}function u$(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c$="firebase-messaging-database",d$=1,ec="firebase-messaging-store";let Yf=null;function lT(){return Yf||(Yf=_h(c$,d$,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ec)}}})),Yf}async function h$(n){const e=uT(n),r=await(await lT()).transaction(ec).objectStore(ec).get(e);if(r)return r;{const s=await l$(n.appConfig.senderId);if(s)return await Xg(n,s),s}}async function Xg(n,e){const t=uT(n),s=(await lT()).transaction(ec,"readwrite");return await s.objectStore(ec).put(e,t),await s.done,e}function uT({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f$={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},tr=new Xo("messaging","Messaging",f$);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p$(n,e){const t=await ev(n),r=cT(e),s={method:"POST",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(Zg(n.appConfig),s)).json()}catch(o){throw tr.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-subscribe-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-subscribe-no-token");return i.token}async function m$(n,e){const t=await ev(n),r=cT(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(r)};let i;try{i=await(await fetch(`${Zg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw tr.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(i.error){const o=i.error.message;throw tr.create("token-update-failed",{errorInfo:o})}if(!i.token)throw tr.create("token-update-no-token");return i.token}async function g$(n,e){const r={method:"DELETE",headers:await ev(n)};try{const i=await(await fetch(`${Zg(n.appConfig)}/${e}`,r)).json();if(i.error){const o=i.error.message;throw tr.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw tr.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Zg({projectId:n}){return`${n$}/projects/${n}/registrations`}async function ev({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function cT({p256dh:n,auth:e,endpoint:t,vapidKey:r}){const s={web:{endpoint:t,auth:e,p256dh:n}};return r!==oT&&(s.web.applicationPubKey=r),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v$=7*24*60*60*1e3;async function y$(n){const e=await b$(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:Ts(e.getKey("auth")),p256dh:Ts(e.getKey("p256dh"))},r=await h$(n.firebaseDependencies);if(r){if(w$(r.subscriptionOptions,t))return Date.now()>=r.createTime+v$?_$(n,{token:r.token,createTime:Date.now(),subscriptionOptions:t}):r.token;try{await g$(n.firebaseDependencies,r.token)}catch(s){console.warn(s)}return y_(n.firebaseDependencies,t)}else return y_(n.firebaseDependencies,t)}async function _$(n,e){try{const t=await m$(n.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await Xg(n.firebaseDependencies,r),t}catch(t){throw t}}async function y_(n,e){const r={token:await p$(n,e),createTime:Date.now(),subscriptionOptions:e};return await Xg(n,r),r.token}async function b$(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:o$(e)})}function w$(n,e){const t=e.vapidKey===n.vapidKey,r=e.endpoint===n.endpoint,s=e.auth===n.auth,i=e.p256dh===n.p256dh;return t&&r&&s&&i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return I$(e,n),E$(e,n),x$(e,n),e}function I$(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const r=e.notification.body;r&&(n.notification.body=r);const s=e.notification.image;s&&(n.notification.image=s);const i=e.notification.icon;i&&(n.notification.icon=i)}function E$(n,e){e.data&&(n.data=e.data)}function x$(n,e){var t,r,s,i,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(r=e.fcmOptions)===null||r===void 0?void 0:r.link)!==null&&s!==void 0?s:(i=e.notification)===null||i===void 0?void 0:i.click_action;a&&(n.fcmOptions.link=a);const l=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;l&&(n.fcmOptions.analyticsLabel=l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T$(n){return typeof n=="object"&&!!n&&aT in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */A$("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function A$(n,e){const t=[];for(let r=0;r<n.length;r++)t.push(n.charAt(r)),r<e.length&&t.push(e.charAt(r));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S$(n){if(!n||!n.options)throw Xf("App Configuration Object");if(!n.name)throw Xf("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const r of e)if(!t[r])throw Xf(r);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Xf(n){return tr.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P${constructor(e,t,r){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=S$(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:r}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R$(n){try{n.swRegistration=await navigator.serviceWorker.register(e$,{scope:t$}),n.swRegistration.update().catch(()=>{})}catch(e){throw tr.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C$(n,e){if(!e&&!n.swRegistration&&await R$(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw tr.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k$(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=oT)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dT(n,e){if(!navigator)throw tr.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw tr.create("permission-blocked");return await k$(n,e==null?void 0:e.vapidKey),await C$(n,e==null?void 0:e.serviceWorkerRegistration),y$(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D$(n,e,t){const r=N$(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(r,{message_id:t[aT],message_name:t[r$],message_time:t[s$],message_device_time:Math.floor(Date.now()/1e3)})}function N$(n){switch(n){case Zu.NOTIFICATION_CLICKED:return"notification_open";case Zu.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V$(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===Zu.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(__(t)):n.onMessageHandler.next(__(t)));const r=t.data;T$(r)&&r[i$]==="1"&&await D$(n,t.messageType,r)}const b_="@firebase/messaging",w_="0.12.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O$=n=>{const e=new P$(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>V$(e,t)),e},M$=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:r=>dT(e,r)}};function L$(){ds(new Br("messaging",O$,"PUBLIC")),ds(new Br("messaging-internal",M$,"PRIVATE")),Sr(b_,w_),Sr(b_,w_,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hT(){try{await Jb()}catch{return!1}return typeof window<"u"&&ym()&&_P()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F$(n=wm()){return hT().then(e=>{if(!e)throw tr.create("unsupported-browser")},e=>{throw tr.create("indexed-db-unsupported")}),ji(Oe(n),"messaging").getImmediate()}async function $$(n,e){return n=Oe(n),dT(n,e)}L$();const I_="BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8";async function fT(){try{return await hT()}catch{return!1}}async function U$(){if(typeof navigator>"u"||!navigator.serviceWorker)return null;const n=await navigator.serviceWorker.ready;if(n!=null&&n.active&&n.active.state==="activated")return n;const e=(n==null?void 0:n.installing)||(n==null?void 0:n.waiting);return!e||e.state==="activated"||await new Promise(t=>{const r=()=>{e.state==="activated"&&(e.removeEventListener("statechange",r),t())};e.addEventListener("statechange",r)}),n}async function j$(n){var i;if(!await fT()||await Notification.requestPermission()!=="granted")return null;const t=F$(Xh);let r=n||await U$();const s=await $$(t,r?{vapidKey:I_,serviceWorkerRegistration:r}:{vapidKey:I_});try{const o=((i=gt==null?void 0:gt.currentUser)==null?void 0:i.email)||"anonymous";o&&s&&await Zt(Pe(ue,"userPushTokens",o),{tokens:mD(s),lastToken:s,email:o,updatedAt:Hi(),userAgent:navigator.userAgent},{merge:!0})}catch{}return s}const B$={class:"flex justify-center gap-2 mb-4"},q$={class:"space-y-3"},z$={key:0},K$={key:0,class:"text-sm text-gray-400"},G$={key:1,class:"space-y-2"},H$={class:"flex items-center justify-between gap-3"},W$={class:"truncate"},Q$={class:"text-white font-semibold"},J$={class:"text-gray-400 text-xs"},Y$=["onClick"],X$={key:1,class:"text-sm text-gray-300 space-y-3"},Z$={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},e6={class:"flex items-center justify-between"},t6={class:"flex items-center gap-2"},n6={class:"flex items-center justify-between"},r6={class:"flex items-center gap-2"},s6={class:"p-3 rounded-lg border border-white/10 bg-white/5 space-y-3"},i6={class:"flex items-center justify-between"},o6={class:"flex items-center gap-2"},a6={class:"flex items-center justify-between"},l6={class:"flex items-center gap-2"},u6={class:"flex items-center justify-between pt-2 border-t border-white/10"},c6=["disabled"],d6={key:1,class:"inline-flex items-center text-xs text-gray-300"},h6={class:"flex items-center justify-between pt-2"},f6=["disabled"],p6={key:0,class:"text-xs text-green-300"},m6={key:1,class:"text-xs text-red-300"},g6={key:2,class:"text-[10px] text-gray-400 break-all"},v6={class:"text-[10px] text-gray-500"},y6={class:"text-right"},_6=["disabled"],b6={key:0,class:"text-xs text-red-300"},w6={key:1,class:"text-xs text-green-300"},I6={key:2,class:"flex flex-col gap-3"},E6={class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},x6={class:"flex items-center gap-2"},T6=["disabled"],A6={key:0,class:"mt-2 text-xs text-red-300"},S6={key:1,class:"mt-2 text-xs text-green-300"},P6={__name:"AccountMenu",props:{show:{type:Boolean,default:!1},seasonId:{type:String,default:null}},emits:["close","manage-player","change-password","logout-device","delete-account"],setup(n,{emit:e}){const t=n,r=e,s=P(""),i=P([]),o=P("players");function a(ee){return["px-4 py-2 rounded-full text-sm transition-colors",o.value===ee?"bg-gradient-to-r from-pink-500 to-purple-600 text-white shadow-lg":"bg-white/5 text-gray-300 hover:bg-white/10 border border-white/10"]}function l(ee){return`${ee.seasonId||"global"}__${ee.playerId}`}async function c(){var ee;try{s.value=((ee=gt==null?void 0:gt.currentUser)==null?void 0:ee.email)||""}catch{}try{const U=s.value?await Gg(s.value):[],W=[];for(const re of U){let Se=re.playerId;try{if(re.seasonId){const Z=Pe(ue,"seasons",re.seasonId,"players",re.playerId),Q=await zt(Z);Q.exists()&&(Se=Q.data().name||Se)}}catch{}W.push({...re,playerName:Se})}i.value=W}catch{i.value=[]}}function d(){r("close")}Pt(()=>t.show,ee=>{ee&&(c(),j())}),zn(()=>{t.show&&(c(),j())});const f=P(""),g=P(!1),y=P(""),E=P(""),A=P(!1);Pt(s,ee=>{f.value=ee||""}),Pt(f,ee=>{A.value=!!ee&&ee.includes("@")&&ee!==s.value});async function R(){if(A.value){g.value=!0,y.value="",E.value="";try{const ee=await Tx({currentEmail:s.value,newEmail:f.value.trim()});await Fx({toEmail:f.value.trim(),verifyUrl:ee.url,purpose:"account_email_update",displayName:"utilisateur"}),E.value=`Un email de vérification a été envoyé à ${f.value.trim()}. Cliquez sur le lien pour confirmer le changement.`}catch(ee){y.value=(ee==null?void 0:ee.code)==="auth/requires-recent-login"?"Veuillez vous reconnecter pour modifier votre email":"Impossible de mettre à jour l'email"}finally{g.value=!1}}}const B=P({notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}),q=P(!1),F=P(""),z=P(""),de=P(!1),me=P(""),T=P(""),w=P(!1),x=P(localStorage.getItem("fcmToken")||""),N=P(!1),L=function(U){try{return U?U.length>20?U.slice(0,8)+"…"+U.slice(-6):U:""}catch{return""}}("BCp_LGds4qlhPqneNocMDmN2dv6iF11IVY3ZfS-3PxrkVbLzPR_Sm3v8aiiNzKhOSRFM_BpncKbxum9M333w-N8");async function j(){try{if(!s.value)return;const ee=Pe(ue,"userPreferences",s.value),U=await zt(ee);if(U.exists()){const W=U.data()||{};B.value.notifyAvailability=W.notifyAvailability!==!1,B.value.notifySelection=W.notifySelection!==!1,B.value.notifySelectionPush=W.notifySelectionPush!==!1,B.value.notifyAvailabilityPush=W.notifyAvailabilityPush!==!1}else B.value={notifyAvailability:!0,notifySelection:!0,notifySelectionPush:!0,notifyAvailabilityPush:!0}}catch{}}async function C(){if(s.value){de.value=!0,T.value="",me.value="";try{await Ac({toEmail:s.value,title:"Test Impro Selector",body:"Ceci est un test de notification",data:{url:"/"},reason:"manual_test"}),me.value="OK"}catch{T.value="Échec de l'envoi du test"}finally{de.value=!1}}}async function ht(){try{if(w.value=!0,!await fT()){T.value="Push non supporté sur cet appareil";return}const U=window.__swReg,W=await j$(U);if(W){x.value=W;try{localStorage.setItem("fcmToken",W)}catch{}N.value=!0}}catch(ee){const U=typeof Notification<"u"?Notification.permission:"unknown",W=ee&&(ee.message||ee.code)?` (${ee.message||ee.code})`:"";T.value=`Activation impossible – permission: ${U}${W}`}finally{w.value=!1}}zn(()=>{try{N.value=typeof Notification<"u"&&Notification.permission==="granted"&&!!localStorage.getItem("fcmToken")}catch{N.value=!1}});async function et(){if(s.value){q.value=!0,F.value="",z.value="";try{const ee=Pe(ue,"userPreferences",s.value);await Zt(ee,{...B.value},{merge:!0}),z.value="Préférences sauvegardées"}catch{F.value="Impossible de sauvegarder vos préférences"}finally{q.value=!1}}}return(ee,U)=>n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[150] p-4",onClick:d},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-xl",onClick:U[11]||(U[11]=mt(()=>{},["stop"]))},[h("button",{onClick:d,class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),U[25]||(U[25]=Xn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-indigo-400 to-cyan-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Gérez votre compte et vos préférences</p></div>',1)),h("div",B$,[h("button",{onClick:U[0]||(U[0]=W=>o.value="manage"),class:St(a("manage"))},"Gérer",2),h("button",{onClick:U[1]||(U[1]=W=>o.value="notifications"),class:St(a("notifications"))},"Notifications",2),h("button",{onClick:U[2]||(U[2]=W=>o.value="players"),class:St(a("players"))},"Joueurs",2)]),h("div",q$,[o.value==="players"?(V(),O("div",z$,[U[12]||(U[12]=h("h3",{class:"text-white font-semibold mb-2"},"Mes joueurs associés",-1)),i.value.length===0?(V(),O("div",K$,"Aucun joueur associé pour le moment.")):(V(),O("ul",G$,[(V(!0),O(ct,null,Tr(i.value,W=>(V(),O("li",{key:l(W),class:"p-3 rounded-lg border border-white/10 bg-white/5 text-sm text-gray-300"},[h("div",H$,[h("div",W$,[h("div",Q$,ae(W.seasonName||W.seasonId||"—"),1),h("div",J$,"Joueur : "+ae(W.playerName||"—"),1)]),h("button",{onClick:re=>ee.$emit("manage-player",W),class:"px-3 py-2 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-xs"},"Gérer",8,Y$)])]))),128))]))])):o.value==="notifications"?(V(),O("div",X$,[h("div",Z$,[U[15]||(U[15]=h("div",{class:"text-white font-semibold text-sm mb-1"},"Emails",-1)),h("div",e6,[h("label",t6,[tt(h("input",{type:"checkbox","onUpdate:modelValue":U[3]||(U[3]=W=>B.value.notifyAvailability=W),class:"w-4 h-4"},null,512),[[Ii,B.value.notifyAvailability]]),U[13]||(U[13]=h("span",null,"M'envoyer un email lorsqu'un événement a besoin de joueurs",-1))])]),h("div",n6,[h("label",r6,[tt(h("input",{type:"checkbox","onUpdate:modelValue":U[4]||(U[4]=W=>B.value.notifySelection=W),class:"w-4 h-4"},null,512),[[Ii,B.value.notifySelection]]),U[14]||(U[14]=h("span",null,"M'envoyer un email lorsque je suis concerné par une sélection",-1))])])]),h("div",s6,[U[21]||(U[21]=h("div",{class:"text-white font-semibold text-sm mb-1"},"Push (expérimental)",-1)),U[22]||(U[22]=h("div",{class:"text-xs text-emerald-200 mb-1"},"Fonctionnalité en test: activable uniquement ici.",-1)),h("div",i6,[h("label",o6,[tt(h("input",{type:"checkbox","onUpdate:modelValue":U[5]||(U[5]=W=>B.value.notifySelectionPush=W),class:"w-4 h-4"},null,512),[[Ii,B.value.notifySelectionPush]]),U[16]||(U[16]=h("span",null,"Me notifier lorsque je suis concerné par une sélection",-1))])]),h("div",a6,[h("label",l6,[tt(h("input",{type:"checkbox","onUpdate:modelValue":U[6]||(U[6]=W=>B.value.notifyAvailabilityPush=W),class:"w-4 h-4"},null,512),[[Ii,B.value.notifyAvailabilityPush]]),U[17]||(U[17]=h("span",null,"Me notifier lorsqu'un événement a besoin de joueurs",-1))])]),h("div",u6,[U[19]||(U[19]=h("div",{class:"text-xs text-gray-400"},"Notifications sur cet appareil",-1)),N.value?(V(),O("span",d6,U[18]||(U[18]=[h("span",{class:"mr-1 text-emerald-400"},"✓",-1),Yt(" Actif ")]))):(V(),O("button",{key:0,onClick:ht,disabled:w.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ae(w.value?"...":"Activer"),9,c6))]),h("div",h6,[U[20]||(U[20]=h("div",{class:"text-xs text-gray-400"},"Test de notification push",-1)),h("button",{onClick:C,disabled:de.value||!s.value,class:"px-3 py-1 rounded bg-emerald-600 text-white text-xs hover:bg-emerald-500 disabled:opacity-50"},ae(de.value?"Envoi…":"Envoyer un test"),9,f6)]),me.value?(V(),O("div",p6,"Notification test envoyée (vérifiez votre appareil)")):ye("",!0),T.value?(V(),O("div",m6,ae(T.value),1)):ye("",!0),x.value?(V(),O("div",g6,"FCM token: "+ae(x.value),1)):ye("",!0),h("div",v6,"VAPID: "+ae(is(L)||"indisponible"),1)]),h("div",y6,[h("button",{onClick:et,disabled:q.value,class:"px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-500 disabled:opacity-50"},ae(q.value?"⏳":"Sauvegarder"),9,_6)]),F.value?(V(),O("div",b6,ae(F.value),1)):ye("",!0),z.value?(V(),O("div",w6,ae(z.value),1)):ye("",!0)])):(V(),O("div",I6,[h("div",E6,[U[23]||(U[23]=h("label",{class:"block text-xs text-gray-400 mb-2"},"Email",-1)),h("div",x6,[tt(h("input",{"onUpdate:modelValue":U[7]||(U[7]=W=>f.value=W),type:"email",class:"flex-1 p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"nouvel@email.com"},null,512),[[Nt,f.value]]),h("button",{onClick:R,disabled:!A.value||g.value,class:"px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"},ae(g.value?"⏳":"Mettre à jour"),9,T6)]),y.value?(V(),O("div",A6,ae(y.value),1)):ye("",!0),E.value?(V(),O("div",S6,ae(E.value),1)):ye("",!0)]),U[24]||(U[24]=h("div",{class:"text-sm text-gray-400"},"Vous pouvez changer votre mot de passe pour sécuriser vos opérations sensibles.",-1)),h("button",{onClick:U[8]||(U[8]=W=>ee.$emit("change-password")),class:"w-full px-4 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-500"},"Changer de mot de passe"),h("button",{onClick:U[9]||(U[9]=W=>ee.$emit("logout-device")),class:"w-full px-4 py-3 rounded-lg bg-gray-700 text-white hover:bg-gray-600"},"Déconnexion de cet appareil"),h("button",{onClick:U[10]||(U[10]=W=>ee.$emit("delete-account")),class:"w-full px-4 py-3 rounded-lg bg-red-600 text-white hover:bg-red-500"},"Supprimer mon compte")]))]),h("div",{class:"mt-6 text-center"},[h("button",{onClick:d,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800"},"Fermer")])])])):ye("",!0)}},R6={class:"space-y-4"},C6={class:"flex items-center justify-between"},k6={class:"flex items-center gap-2 text-gray-300 text-sm"},D6={key:0,class:"p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300 text-sm"},N6={key:1,class:"p-3 bg-green-500/20 border border-green-500/30 rounded-lg text-green-300 text-sm"},V6={class:"flex justify-center gap-3 mt-2"},O6=["disabled"],M6={key:0,class:"animate-spin"},L6={key:1},F6={__name:"AccountLoginModal",props:{show:{type:Boolean,default:!1}},emits:["close","success"],setup(n,{emit:e}){const t=e,r=P(""),s=P(""),i=P(!1),o=P(""),a=P(""),l=P(!0),c=Ue(()=>!!r.value&&r.value.includes("@")&&!!s.value);async function d(){if(c.value){i.value=!0,o.value="",a.value="";try{if(await px(r.value.trim(),s.value),l.value)try{$i.saveSession(r.value.trim())}catch{}t("success")}catch{o.value="Email ou mot de passe incorrect"}finally{i.value=!1}}}async function f(){if(!r.value||!r.value.includes("@")){o.value="Saisissez votre email pour recevoir un lien de réinitialisation",setTimeout(()=>{o.value=""},2500);return}i.value=!0,o.value="",a.value="";try{await mx(r.value.trim()),a.value="Email de réinitialisation envoyé"}catch{o.value="Impossible d'envoyer l'email de réinitialisation"}finally{i.value=!1}}return(g,y)=>n.show?(V(),O("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[170] p-4",onClick:y[6]||(y[6]=E=>g.$emit("close"))},[h("div",{class:"relative bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl w-full max-w-md",onClick:y[5]||(y[5]=mt(()=>{},["stop"]))},[h("button",{onClick:y[0]||(y[0]=E=>g.$emit("close")),class:"absolute right-3 top-3 text-white/80 hover:text-white","aria-label":"Fermer",title:"Fermer"},"✖️"),y[10]||(y[10]=Xn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">👤</span></div><h2 class="text-2xl font-bold text-white mb-1">Mon compte</h2><p class="text-sm text-gray-300">Connectez-vous pour gérer votre compte et vos préférences</p></div>',1)),h("div",R6,[st(Ux),h("div",null,[y[7]||(y[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Email",-1)),tt(h("input",{"onUpdate:modelValue":y[1]||(y[1]=E=>r.value=E),type:"email",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"votre@email.com"},null,512),[[Nt,r.value]])]),h("div",null,[y[8]||(y[8]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe",-1)),tt(h("input",{"onUpdate:modelValue":y[2]||(y[2]=E=>s.value=E),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Mot de passe"},null,512),[[Nt,s.value]])]),h("div",C6,[h("label",k6,[tt(h("input",{type:"checkbox","onUpdate:modelValue":y[3]||(y[3]=E=>l.value=E),class:"w-4 h-4"},null,512),[[Ii,l.value]]),y[9]||(y[9]=h("span",null,"Rester connecté sur cet appareil",-1))]),h("button",{onClick:f,class:"text-sm text-blue-400 hover:text-blue-300 underline"},"Mot de passe oublié ?")]),o.value?(V(),O("div",D6,ae(o.value),1)):ye("",!0),a.value?(V(),O("div",N6,ae(a.value),1)):ye("",!0),h("div",V6,[h("button",{onClick:d,disabled:!c.value||i.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"},[i.value?(V(),O("span",M6,"⏳")):(V(),O("span",L6,"Se connecter"))],8,O6),h("button",{onClick:y[4]||(y[4]=E=>g.$emit("close")),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer")])])])])):ye("",!0)}};const $6={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},U6={ref:"pageHeaderRef",class:"sticky top-0 z-[60] text-center py-4 md:py-6 px-4 relative bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900/95 backdrop-blur-sm border-b border-white/10"},j6={class:"text-4xl font-bold text-white mb-0 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},B6={class:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2"},q6={class:"hidden md:flex items-center gap-2"},z6={class:"w-full px-0 md:px-0 pb-0 pt-[72px] md:pt-[80px] -mt-[72px] md:-mt-[80px] bg-gray-900"},K6={class:"flex items-stretch relative"},G6={key:0,class:"col-left flex-shrink-0 p-3 md:p-4 sticky left-0 z-[81] bg-gray-900 h-full"},H6={class:"flex-1 overflow-hidden"},W6=["data-event-id"],Q6=["title","onClick"],J6={class:"flex flex-col items-center flex-1 justify-center"},Y6={class:"header-title text-[22px] md:text-2xl leading-snug text-white text-center clamp-2 group-hover:text-purple-300 transition-colors duration-200"},X6={key:0,class:"mt-1 text-xs text-gray-400"},Z6={class:"relative"},eU=["onClick","title"],tU={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},nU={class:"p-2"},rU=["onClick"],sU=["onClick"],iU=["onClick"],oU={class:"flex flex-col items-center mt-2"},aU={key:0,class:"px-2 py-1 bg-gray-500/20 border border-gray-400/30 rounded-md mx-auto flex items-center justify-center",title:"Événement archivé"},lU=["title","onClick"],uU=["title","onClick"],cU=["title","onClick"],dU=["title","onClick"],hU=["title","aria-label"],fU={class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},pU={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 3l18 18"},mU={key:0,class:"pointer-events-none"},gU={class:"flex items-center justify-between"},vU={key:1,class:"pointer-events-none"},yU={id:"coachmark-avail",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-pink-500/40 rounded-xl shadow-2xl p-3 text-white relative"},_U={class:"flex items-center justify-between"},bU={key:2,class:"pointer-events-none"},wU={id:"coachmark-name",class:"coachmark pointer-events-auto max-w-sm bg-gray-900 border border-yellow-500/40 rounded-xl shadow-2xl p-3 text-white relative"},IU={class:"flex items-center justify-between"},EU={class:"table-auto border-separate border-spacing-0 table-fixed w-auto min-w-max"},xU=["data-player-id"],TU={class:"px-0 py-4 md:py-5 font-medium text-white relative group text-xl md:text-2xl sticky left-0 z-40 bg-gray-900 left-col-td"},AU={class:"px-4 md:px-5 font-bold text-xl md:text-2xl flex items-center w-full min-w-0"},SU={key:0,class:"text-yellow-400 mr-1 text-sm",title:"Mon joueur"},PU={key:1,class:"text-yellow-400 mr-1 text-sm",title:"Joueur protégé par mot de passe"},RU=["onClick","title"],CU={class:"group-hover:text-purple-300 transition-colors duration-200"},kU=["data-event-id"],DU={class:"border-t border-white/10"},NU={class:"px-0 py-4 md:py-5 sticky left-0 z-40 bg-gray-900 left-col-td"},VU={class:"px-4 md:px-5 flex items-center"},OU=["data-event-id"],MU={key:0,class:"fixed inset-0 z-[120] flex items-center justify-center bg-gray-950/80 backdrop-blur-sm"},LU={class:"text-center"},FU={class:"text-white text-lg"},$U={class:"mt-3 w-64 h-2 bg-white/10 rounded-full overflow-hidden"},UU={class:"text-white/60 text-xs mt-2"},jU={key:3,class:"fixed bottom-4 left-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl shadow-2xl border border-green-400/30 backdrop-blur-sm z-[200]"},BU={class:"flex items-center space-x-2"},qU={key:4,class:"fixed bottom-4 left-4 bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl shadow-2xl border border-red-400/30 backdrop-blur-sm z-[200]"},zU={class:"flex items-center space-x-2"},KU={key:5,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},GU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},HU={class:"mb-6"},WU={class:"mb-6"},QU={class:"mb-6"},JU={class:"mb-6 flex items-center gap-3"},YU={class:"mb-6"},XU={key:6,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4"},ZU={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},e5={class:"mb-6"},t5={class:"flex justify-end space-x-3"},n5={key:7,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},r5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},s5={class:"flex justify-end space-x-3"},i5={key:8,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[60] p-4"},o5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},a5={class:"flex justify-end space-x-3"},l5={key:9,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[95] p-4"},u5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},c5={class:"text-center mb-6"},d5={class:"text-gray-300"},h5={key:0},f5={key:1},p5={class:"relative p-4 md:p-6 border-b border-white/10"},m5={class:"flex items-start gap-4 md:gap-6"},g5={class:"flex-1 min-w-0"},v5={class:"flex items-center gap-3 mb-2"},y5={class:"text-xl md:text-2xl font-bold text-white leading-tight"},_5={class:"flex items-center gap-2 px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded text-sm"},b5={class:"text-blue-200"},w5={class:"flex items-center gap-3 mb-3"},I5={class:"text-base md:text-lg text-purple-300"},E5={class:"relative"},x5={key:0,class:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 w-48 bg-gray-900 border border-white/20 rounded-lg shadow-xl z-[9999] overflow-hidden"},T5={class:"p-2"},A5={key:0,class:"text-sm text-gray-300 bg-gray-800/30 p-3 rounded-lg border border-gray-600/30"},S5={class:"px-4 md:px-6 py-4 md:py-6 overflow-y-auto"},P5={class:"grid grid-cols-3 gap-3 md:gap-4 mb-2 md:mb-4"},R5={class:"bg-gradient-to-r from-cyan-500/20 to-blue-500/20 p-3 md:p-4 rounded-lg border border-cyan-500/30 text-center"},C5={class:"text-xl md:text-2xl font-bold text-white"},k5={class:"bg-gradient-to-r from-purple-500/20 to-pink-500/20 p-3 md:p-4 rounded-lg border border-purple-500/30 text-center"},D5={class:"text-xl md:text-2xl font-bold text-white"},N5={class:"p-3 md:p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10 text-center"},V5={class:"text-xl md:text-2xl font-bold text-yellow-300"},O5={key:0,class:"mb-4 md:mb-6"},M5={class:"mb-3 flex items-center"},L5=["title"],F5={class:"truncate"},$5={class:"space-y-0.5"},U5={class:"flex items-center min-w-0 gap-1.5"},j5={key:0,class:"text-yellow-400 mr-1 text-xs",title:"Mon joueur"},B5={key:1,class:"text-yellow-400 mr-1 text-xs",title:"Joueur protégé par mot de passe"},q5=["title"],z5={class:"flex-0 p-0"},K5={class:"hidden md:flex justify-center flex-wrap gap-3 mt-4"},G5=["disabled","title"],H5=["title"],W5={class:"md:hidden sticky bottom-0 w-full p-3 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2"},Q5=["disabled","title"],J5={key:11,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},Y5={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},X5={class:"mb-6"},Z5={class:"mb-6"},ej={class:"mb-6"},tj={class:"mb-6 flex items-center gap-3"},nj={class:"mb-6"},rj={key:12,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[110] p-4"},sj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},ij={class:"mb-6"},oj={class:"space-y-4"},aj=["disabled"],lj={key:0,class:"animate-spin"},uj={key:1},cj={class:"mb-6 text-center"},dj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},hj={class:"text-red-300 text-sm"},fj={key:13,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[110] p-0 md:p-4"},pj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 shadow-2xl w-full max-w-md rounded-t-2xl md:rounded-2xl flex flex-col max-h-[90vh]"},mj={class:"px-4 pt-3 pb-16 md:px-6 md:pt-4 md:pb-20 overflow-y-auto"},gj={class:"space-y-4"},vj={class:"mt-2 text-center"},yj={key:0,class:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},_j={class:"text-red-300 text-sm"},bj={class:"sticky bottom-0 w-full p-3 md:p-4 bg-gray-900/95 border-t border-white/10 backdrop-blur-sm flex items-center gap-2 pb-[env(safe-area-inset-bottom)]"},wj=["disabled"],Ij={key:0,class:"animate-spin"},Ej={key:1},xj={class:"mb-6"},Tj=["disabled"],Aj={key:0,class:"animate-spin"},Sj={key:1},Pj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Rj={class:"text-red-300 text-sm"},Cj={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},kj={class:"text-green-300 text-sm"},Dj={class:"flex justify-center"},Nj={class:"mb-6"},Vj=["disabled"],Oj={key:0,class:"animate-spin"},Mj={key:1},Lj={key:0,class:"mb-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},Fj={class:"text-red-300 text-sm"},$j={key:1,class:"mb-4 p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},Uj={class:"text-green-300 text-sm"},jj={class:"flex justify-center"},Bj={key:16,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[90] p-4"},qj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-6 rounded-2xl shadow-2xl max-w-md"},zj={class:"flex gap-3"},E_={__name:"GridBoard",props:{slug:{type:String,required:!0},eventId:{type:String,required:!1}},setup(n){const e=n,t=dl(),r=hl(),s=e.slug,i=P(""),o=P(""),a=P({}),l=P(!1),c=P(null),d=P(null),f=P(""),g=P(""),y=P(6),E=P(!1),A=P(""),R=P(null),B=P(null),q=P(null),F=P({position:null,side:null}),z=P({position:null}),de=P({position:null}),me=P(!1),T=P(null),w=P(!1),x=P(null),N=P(null),L=P(!1),j=P(null),C=P(""),ht=P(!1),et=P(null),ee=P(""),U=P(""),W=P(!1),re=P(null),Se=P(!1),Z=P(null),Q=P(""),Ee=P(""),We=P(!1),ft=P(null),vt=P(!1),D=P(!1),$=P(""),te=P(""),oe=P(!1),Ve=P(!1),qe=P(""),I=P(""),S=P(!1),M=P(null),le=P(""),ne=P(!1),ie=P(!1),_e=P(!1),be=P(null),we=P(null),ge=P({position:"fixed",top:"0px",left:"0px"}),Me=P(null),xe=P({position:"fixed",top:"0px",left:"0px"}),ke=P(null),Be=P(!1);function je(){try{const _=be.value;if(!_)return;const m=_.getBoundingClientRect(),k=8;if(window.innerWidth>768){const X=Math.max(k,Math.round(m.top-k)),se=Math.max(k,Math.round(m.left));ge.value={position:"fixed",top:`${X}px`,left:`${se}px`,zIndex:400}}else{const X=Math.min(window.innerHeight-k,Math.round(m.bottom+k)),se=Math.max(k,Math.round(m.left));ge.value={position:"fixed",top:`${X}px`,left:`${se}px`,zIndex:400}}}catch{}}function He(){try{const X=Math.max(8,window.innerHeight-8-48-200),se=Math.max(8,Math.round(window.innerWidth-200-8));xe.value={position:"fixed",top:`${X}px`,left:`${se}px`,zIndex:400}}catch{}}function rt(){_e.value=!_e.value,_e.value&&Ut(()=>je())}function mn(){ie.value=!ie.value,ie.value&&Ut(()=>He())}function nn(_){ke.value===_?ke.value=null:ke.value=_}function wn(){ke.value=null}function rn(){Be.value=!Be.value}function lr(){Be.value=!1}const kr=P(!1),$t=P(null),In=P(null),ps=P(null),Wt=P(0);function Sc(){var _;try{if(!o.value||!a.value||a.value.onboardingCreatorDone!==!0||Ke.value.length===0)return;const m=localStorage.getItem(`playerTourCompleted:${o.value}`);try{const X=((_=gt==null?void 0:gt.currentUser)==null?void 0:_.email)||"";X&&Gg(X).then(async se=>{const ve=se.filter(he=>he.seasonId===o.value);if(ve.length>0){const he=`seasonPreferredPlayer:${o.value}`,De=localStorage.getItem(he);let Qe=[];if(De)if(De.startsWith("["))try{Qe=JSON.parse(De)||[]}catch{}else Qe=[De];const Ze=new Set(Qe);ve.forEach(Kt=>Ze.add(Kt.playerId));const yt=Array.from(Ze);localStorage.setItem(he,JSON.stringify(yt))}}).catch(()=>{})}catch{}const k=localStorage.getItem(`startPlayerTour:${o.value}`);!m&&k&&(Wt.value=1,localStorage.removeItem(`startPlayerTour:${o.value}`),Ut(()=>{const X=document.querySelector('button[data-onboarding="add-player"]');if(X){X.scrollIntoView({behavior:"smooth",block:"end"});const se=X.getBoundingClientRect(),ve=document.getElementById("coachmark-add"),he=280,De=100,Qe=(ve==null?void 0:ve.offsetWidth)||he,Ze=(ve==null?void 0:ve.offsetHeight)||De,yt=Math.round(se.right+12);if(yt+Qe<=window.innerWidth-12){const sn=se.top+se.height/2-Ze/2,on=-14,_t=12,pr=window.innerHeight-Ze-12,Lr=Math.max(_t,Math.min(Math.round(sn+on),pr));F.value={position:{x:yt,y:Lr},side:"right"}}else{const sn=Math.round(se.left+se.width/2-Qe/2),on=Math.round(se.top-Ze-8),_t=8,pr=window.innerWidth-Qe-8;F.value={position:{x:Math.max(_t,Math.min(sn,pr)),y:on},side:null}}}}))}catch{}}const qr=P(!1),gn=P(null),ms=P(null),Wi=P(!1),_r=P(null),Qi=P(!1),gs=P(null),Ji=P(!1),Dr=P(!1),ia=P(!1),hn=P(!1),kl=P(null);function vs(){Dr.value=!1}function Js(){try{const _=gt==null?void 0:gt.currentUser;if(!_||_.isAnonymous){let m=null;if(Xr.value&&Xr.value.size>0){const k=Xr.value.values().next().value;m=Fe.value.find(X=>X.id===k)||null}m||(m=Fe.value[0]||null),hn.value=!0,m&&(kl.value=m);return}}catch{}Dr.value=!0}async function sf(){var _;try{const m=(_=gt==null?void 0:gt.currentUser)==null?void 0:_.email;if(!m)return;const{resetPlayerPassword:k}=await Xt(()=>Promise.resolve().then(()=>Ai),void 0);await k(m),Le.value=!0,lt.value="Email de réinitialisation envoyé.",setTimeout(()=>{Le.value=!1},3e3)}catch{dr.value=!0,Er.value="Impossible d'envoyer l'email de réinitialisation.",setTimeout(()=>{dr.value=!1},3e3)}}async function of(){try{await qN(gt),vs(),Le.value=!0,lt.value="Déconnecté de cet appareil.",setTimeout(()=>{Le.value=!1},2500)}catch{dr.value=!0,Er.value="Déconnexion impossible.",setTimeout(()=>{dr.value=!1},3e3)}}async function Ys(){alert("Suppression de compte: contactez l'organisateur pour dissocier vos joueurs. Fonction complète à venir.")}async function af(_){var m;vs();try{if(_.seasonId&&_.seasonId!==o.value){const k=Pe(ue,"seasons",_.seasonId),se=(await Et(Ye(ue,"seasons"))).docs.find(he=>he.id===_.seasonId),ve=(m=se==null?void 0:se.data())==null?void 0:m.slug;if(ve){t.push(`/season/${ve}?player=${encodeURIComponent(_.playerId)}&open=protection`);return}}else{const k=Fe.value.find(X=>X.id===_.playerId);if(k){ff(k);return}t.push(`?player=${encodeURIComponent(_.playerId)}&open=protection`)}}catch{}}zn(()=>{try{o.value&&localStorage.getItem(`dismissCreatorOnboarding:${o.value}`)&&(onboardingDismissedShare.value=!0)}catch{}document.addEventListener("click",_=>{if(_e.value){const m=be.value,k=we.value,X=m&&m.contains(_.target),se=k&&k.contains(_.target);!X&&!se&&(_e.value=!1)}if(ie.value){const m=Me.value;m&&m.contains(_.target)||(ie.value=!1)}}),document.addEventListener("keydown",_=>{_.key==="Escape"&&(_e.value&&(_e.value=!1),ie.value&&(ie.value=!1))}),window.addEventListener("resize",()=>{_e.value&&je(),ie.value&&He()}),window.addEventListener("scroll",()=>{_e.value&&je(),ie.value&&He()},{passive:!0})});function lf(){Ut(()=>{oa()})}const ur=P(new Set),zr=P(!0),br=P(0),Nr=P("Préparation de la grille"),kn=P(e.eventId||null),Dl=P(!1),Yi=P(null);Pt(()=>e.eventId,_=>{if(_)if(kn.value=_,Ke.value.length>0)uv(_);else{const m=Pt(Ke,k=>{k.length>0&&(uv(_),m())},{immediate:!0})}});const ys=Ue(()=>Fe.value.map(_=>({..._,isProtected:ur.value.has(_.id),email:null}))),Nl=Ue(()=>kn.value?hr.value.findIndex(_=>_.id===kn.value):-1);Ue(()=>{if(!kn.value||Nl.value===-1)return!1;if(window.innerWidth<=768){const _=document.querySelector(`[data-event-id="${kn.value}"]`);if(_){const m=_.getBoundingClientRect();return m.left>=0&&m.right<=window.innerWidth}}return!0});const cr=P(null),Vl=P(!1),Pc=P(!1),Xs=P(0),Rc=P(null),Dn=P(null),Kr=P(null);function En(){const _=cr.value;if(!_)return;const{scrollLeft:m,scrollWidth:k,clientWidth:X}=_;Vl.value=m>2,Pc.value=m<k-X-2}function oa(){var _;try{En(),Xs.value=((_=cr.value)==null?void 0:_.scrollLeft)||0}catch{}}function Cc(_){const m=cr.value;if(!m)return;let k=0;const X=m.querySelector("tbody tr td[data-event-id]");if(X)k=X.getBoundingClientRect().width;else if(Dn!=null&&Dn.value){const ve=Dn.value.querySelector(".col-event");ve&&(k=ve.getBoundingClientRect().width)}(!k||!isFinite(k))&&(k=m.clientWidth*.6);const se=m.scrollLeft+_*k;m.scrollTo({left:se,behavior:"smooth"})}const Zs=P(null);P(0);const ei=P(!1),Xi=P(!1),Gr=P(0);function aa(_,m){m&&typeof m.preventDefault=="function"&&m.preventDefault(),wr(),Cc(_)}function Zi(_,m){if(m&&typeof m.preventDefault=="function"&&m.preventDefault(),ei.value)return;ei.value=!0,Gr.value=_,Xi.value=!1;const k=cr.value;if(!k)return;let X=0;const se=k.querySelector("tbody tr td[data-event-id]");if(se)X=se.getBoundingClientRect().width;else if(Dn!=null&&Dn.value){const Qe=Dn.value.querySelector(".col-event");Qe&&(X=Qe.getBoundingClientRect().width)}(!X||!isFinite(X))&&(X=k.clientWidth*.6);const ve=X/6,he=120,De=()=>{if(!ei.value||Gr.value===0)return;Xi.value||(Xi.value=!0);const Qe=k.scrollLeft+Gr.value*ve;k.scrollTo({left:Qe,behavior:"auto"}),Zs.value=window.setTimeout(De,he)};Zs.value=window.setTimeout(De,250)}function wr(_){_&&typeof _.preventDefault=="function"&&_.preventDefault();const m=ei.value,k=Xi.value;if(ei.value=!1,Zs.value&&(clearTimeout(Zs.value),Zs.value=null),_&&typeof _.type=="string"&&_.type.startsWith("touch")&&!k){const X=Gr.value||0;X!==0&&Cc(X),Gr.value=0;return}Gr.value=0,m&&k&&uf()}function uf(){const _=cr.value;if(!_)return;let m=0;const k=_.querySelector("tbody tr td[data-event-id]");if(k)m=k.getBoundingClientRect().width;else if(Dn!=null&&Dn.value){const he=Dn.value.querySelector(".col-event");he&&(m=he.getBoundingClientRect().width)}if(!m||!isFinite(m)||m<=0)return;const X=_.scrollLeft,ve=Math.round(X/m)*m;_.scrollTo({left:ve,behavior:"smooth"})}function cf(_){R.value=_;const m=document.querySelector(`[data-player-id="${_}"]`);m&&m.scrollIntoView({behavior:"smooth",block:"center"}),Le.value=!0,lt.value="Nouveau joueur ajouté !",setTimeout(()=>{Le.value=!1},3e3)}function kc(){if(Wt.value!==1)return;const _=document.querySelector('button[data-onboarding="add-player"]');if(!_)return;const m=_.getBoundingClientRect(),k=document.getElementById("coachmark-add"),X=280,se=100,ve=k!=null&&k.offsetWidth&&k.offsetWidth>0?k.offsetWidth:X,he=k!=null&&k.offsetHeight&&k.offsetHeight>0?k.offsetHeight:se,De=Math.round(m.right+12);if(De+ve<=window.innerWidth-12){const Ze=m.top+m.height/2-he/2,Kt=Ol(Ze+-14,he);F.value={position:{x:De,y:Kt},side:"right"}}else{const Ze=Math.round(m.left+m.width/2-ve/2),yt=Ol(m.top-he-8,he),Kt=8,sn=window.innerWidth-ve-8;F.value={position:{x:Math.max(Kt,Math.min(Ze,sn)),y:yt},side:null}}}function Ol(_,m){const k=pageHeaderRef==null?void 0:pageHeaderRef.value,X=k?Math.max(0,Math.round(k.getBoundingClientRect().height||0)):0,se=Math.max(12,X+8),ve=window.innerHeight-m-12;return Math.max(se,Math.min(Math.round(_),ve))}const Hr=P(!1),Vr=P(null),Ir=P(null),eo=P({position:"fixed",top:"0px",right:"0px"});function ti(){try{const _=Vr.value;if(!_)return;const m=_.getBoundingClientRect(),k=8,X=Math.max(k,Math.round(m.bottom+k)),se=Math.max(k,Math.round(window.innerWidth-m.right));eo.value={position:"fixed",top:`${X}px`,right:`${se}px`,zIndex:400}}catch{}}function Dc(){Hr.value=!Hr.value,Hr.value&&Ut(()=>ti())}function xt(){Hr.value=!1}function to(_){if(!Hr.value)return;const m=Vr.value,k=Ir.value,X=m&&m.contains(_.target),se=k&&k.contains(_.target);!X&&!se&&(Hr.value=!1)}function ni(_){_.key==="Escape"&&xt()}function Wr(){Hr.value&&ti()}zn(()=>{document.addEventListener("click",to),document.addEventListener("keydown",ni),window.addEventListener("scroll",Wr,{passive:!0}),window.addEventListener("resize",Wr)}),ka(()=>{document.removeEventListener("click",to),document.removeEventListener("keydown",ni),window.removeEventListener("scroll",Wr),window.removeEventListener("resize",Wr)});function la(){var _;Wt.value===1&&((_=F.value)!=null&&_.position)&&kc()}zn(()=>{window.addEventListener("scroll",la,{passive:!0}),window.addEventListener("resize",la)}),ka(()=>{window.removeEventListener("scroll",la),window.removeEventListener("resize",la)});function no(_){return ur.value.has(_)}async function Ml(){if(o.value)try{const _=await Qp(o.value),m=new Set;_.forEach(k=>{k.isProtected&&m.add(k.playerId||k.id)}),ur.value=m}catch{const m=new Set;for(const k of Fe.value)await Pi(k.id,o.value)&&m.add(k.id);ur.value=m}}const Le=P(!1),lt=P(""),dr=P(!1),Er=P("");function Qr(){try{const _=`${window.location.origin}/season/${s}`;navigator.clipboard.writeText(_),Le.value=!0,lt.value="Lien copié dans le presse-papiers",setTimeout(()=>{Le.value=!1},2500)}catch{dr.value=!0,Er.value="Impossible de copier le lien",setTimeout(()=>{dr.value=!1},2500)}}async function Ll(_){await J({type:"deleteEvent",data:{eventId:_}})}async function Nc(_=null){const m=_||c.value;if(console.debug("deleteEventConfirmed"),!m){console.error("Aucun événement à supprimer");return}try{await iM(m,o.value),Ke.value=Ke.value.filter(k=>k.id!==m),await Promise.all([zp(o.value),To(Fe.value,Ke.value,o.value),Ao(o.value)]).then(([k,X,se])=>{Ke.value=k,Qt.value=X,pt.value=se}),l.value=!1,c.value=null,Le.value=!0,lt.value="Événement supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression de l'événement"),alert("Erreur lors de la suppression de l'événement. Veuillez réessayer.")}}function Vc(){l.value=!1,c.value=null}async function Jr(){if(!d.value||!f.value.trim()||!g.value)return;const _=parseInt(y.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}try{const m={title:f.value.trim(),date:g.value,description:le.value.trim()||"",playerCount:_,archived:!!ne.value};await l_(d.value,m,o.value),!m.archived&&Fe.value.length>0&&ur.value.size>0&&(gs.value={id:d.value,...m},Qi.value=!0),await Promise.all([zp(o.value),To(Fe.value,Ke.value,o.value),Ao(o.value)]).then(([k,X,se])=>{Ke.value=k,Qt.value=X,pt.value=se}),d.value=null,f.value="",g.value="",le.value="",y.value=6,ne.value=!1,Le.value=!0,lt.value="Événement mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition de l'événement"),alert("Erreur lors de l'édition de l'événement. Veuillez réessayer.")}}async function df(){if(A.value.trim())try{const _=A.value.trim(),m=await Ix(_,o.value);await Promise.all([Td(o.value),To(Fe.value,Ke.value,o.value),Ao(o.value)]).then(([k,X,se])=>{Fe.value=k,Qt.value=X,pt.value=se,Ml();const ve=Fe.value.find(De=>De.id===m);cf(m),B.value=m,q.value=hr.value&&hr.value[0]&&hr.value[0].id?hr.value[0].id:null;try{o.value&&localStorage.setItem(`lastAddedPlayerId:${o.value}`,m)}catch{}try{typeof Wt<"u"&&(Wt.value=2)}catch{}const he=document.querySelector(`[data-player-id="${m}"]`);he&&he.scrollIntoView({behavior:"smooth",block:"center"}),Ut(()=>{const De=`[data-player-id="${B.value}"] td[data-event-id="${q.value}"]`,Qe=document.querySelector(De);if(Qe){const Ze=Qe.getBoundingClientRect();z.value.position={x:Math.round(Ze.left),y:Math.round(Ze.top+window.scrollY-48)}}}),Le.value=!0,lt.value="Joueur ajouté avec succès ! Vous pouvez maintenant indiquer sa disponibilité.",setTimeout(()=>{Le.value=!1},3e3),setTimeout(()=>{Le.value=!1,lt.value=""},5e3)}),E.value=!1,A.value=""}catch{console.error("Erreur lors de l'ajout du joueur"),alert("Erreur lors de l'ajout du joueur. Veuillez réessayer.")}}function ro(){d.value=null,f.value="",g.value="",le.value="",y.value=6}P(null);const ua=P(!1),Qn=P(""),ri=P(""),so=P(""),Yr=P(6),_s=P(!1);async function Oc(){if(!Qn.value.trim()||!ri.value){alert("Veuillez remplir le titre et la date de l'événement");return}const _=parseInt(Yr.value);if(isNaN(_)||_<1||_>20){alert("Le nombre de joueurs doit être un nombre entier entre 1 et 20");return}const m={title:Qn.value.trim(),date:ri.value,description:so.value.trim()||"",playerCount:_,archived:!!_s.value};await io(m)}async function io(_){try{const m=await oM(_,o.value);Ke.value=[...Ke.value,{id:m,..._}];const k={};for(const X of Fe.value)k[X.name]=Qt.value[X.name]||{},k[X.name][m]=null,await a_(X.name,k[X.name],o.value);Qn.value="",ri.value="",so.value="",Yr.value=6,_s.value=!1,ua.value=!1,await Promise.resolve(),Le.value=!0,lt.value="Événement créé avec succès !",!_.archived&&Fe.value.length>0&&ur.value.size>0&&(gs.value={id:m,..._},Qi.value=!0),setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la création de l'événement"),alert("Erreur lors de la création de l'événement. Veuillez réessayer.")}}function oo(){Qn.value="",ri.value="",so.value="",Yr.value=6,ua.value=!1}async function Fl(){await J({type:"addEvent",data:{}})}const Ke=P([]),Fe=P([]),Qt=P({}),pt=P({}),Mc=P({}),ca=P({});Pt([()=>Ke.value.length,()=>Fe.value.length,zr],()=>{zr.value||Ut(()=>{oa()})}),Pt([()=>Fe.value.length,()=>Ke.value.length,o],()=>{Sc()}),zn(async()=>{try{wx("firebase"),await tM();const m=Gu(Ye(ue,"seasons"),Yd("slug","==",e.slug)),k=await Et(m);if(k.empty){t.push("/seasons");return}else{const he=k.docs[0];o.value=he.id;const De=he.data();i.value=De.name,a.value=De,document.title=`Saison : ${i.value}`,kO(e.slug)}if(o.value){Nr.value="Chargement des événements de la saison",br.value=20;const he=await Et(Ye(ue,"seasons",o.value,"events"));Ke.value=he.docs.map(_t=>({id:_t.id,..._t.data(),playerCount:_t.data().playerCount||6})),Nr.value="Chargement des joueurs",br.value=45;const De=await Et(Ye(ue,"seasons",o.value,"players"));Fe.value=De.docs.map(_t=>({id:_t.id,..._t.data()})),Nr.value="Chargement des disponibilités",br.value=70;const Qe=await Et(Ye(ue,"seasons",o.value,"availability")),Ze={};Qe.docs.forEach(_t=>{const pr=_t.data(),Lr={};Object.keys(pr).forEach(yo=>{const _a=pr[yo];Lr[yo]=_a==="oui"?!0:_a==="non"?!1:_a}),Ze[_t.id]=Lr}),Qt.value=Ze,Nr.value="Chargement des sélections",br.value=85;const yt=await Et(Ye(ue,"seasons",o.value,"selections")),Kt={};yt.docs.forEach(_t=>{Kt[_t.id]=_t.data().players||[]}),pt.value=Kt;const sn=await Qp(o.value),on=new Set;Array.isArray(sn)&&sn.forEach(_t=>{_t.isProtected&&on.add(_t.playerId||_t.id)}),ur.value=on}const X=he=>{typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(()=>he()):setTimeout(he,0)};Nr.value="Préparation de l'interface",br.value=95,X(()=>{fo(),Nn()}),console.debug("players (deduplicated)"),console.debug("availability loaded"),await Ut(),br.value=100,zr.value=!1,Ut(()=>{En(),requestAnimationFrame(()=>En()),setTimeout(()=>En(),250);const he=cr.value;he&&(he.addEventListener("scroll",De=>{En(),Xs.value=he.scrollLeft||0},{passive:!0}),window.addEventListener("resize",En),typeof ResizeObserver<"u"&&(Kr.value=new ResizeObserver(()=>{En()}),Kr.value.observe(he)))});const se=r.query.event;if(se&&Ke.value.length>0){const he=Ke.value.find(De=>De.id===se);he?(console.debug("Événement trouvé depuis l'URL"),await gf(se,he)):(console.warn("Événement non trouvé avec l'ID"),dr.value=!0,Er.value="Événement non trouvé",setTimeout(()=>{dr.value=!1},3e3))}const ve=r.query.player;if(ve&&Fe.value.length>0){const he=Fe.value.find(De=>De.id===ve);he&&(ff(he),await Ut(),r.query.verified==="1"&&(Le.value=!0,lt.value="Joueur associé à votre compte.",setTimeout(()=>{Le.value=!1},2500)))}}catch(_){console.error("Erreur lors du chargement de la grille:",_),dr.value=!0,Er.value="Erreur lors du chargement des données",setTimeout(()=>{dr.value=!1},5e3),zr.value=!1}}),Pt(()=>r.params.eventId,_=>{if(_){const m=()=>{const k=Ke.value.find(X=>X.id===_);return k?(tv(k),!0):!1};if(Ke.value.length>0)m();else{const k=Pt(Ke,X=>{X.length>0&&m()&&k()},{immediate:!0})}}},{immediate:!0});function $l(_){if(!_)return null;if(_ instanceof Date)return _;if(typeof(_==null?void 0:_.toDate)=="function")return _.toDate();if(typeof _=="string"||typeof _=="number"){const m=new Date(_);return isNaN(m.getTime())?null:m}return null}const Or=Ue(()=>{let _=null;try{o.value&&(_=localStorage.getItem(`seasonPreferredPlayer:${o.value}`))}catch{}const m=[...Fe.value].sort((he,De)=>(he.name||"").localeCompare(De.name||"","fr",{sensitivity:"base"}));if(!_)return m;let k=[];try{_.startsWith("[")?k=JSON.parse(_):_&&(k=[_])}catch{k=[]}const X=new Set(k);if(X.size===0)return m;const se=m.filter(he=>X.has(he.id)),ve=m.filter(he=>!X.has(he.id));return[...se,...ve]}),Xr=Ue(()=>{try{if(o.value){const _=localStorage.getItem(`seasonPreferredPlayer:${o.value}`);if(!_)return new Set;if(_.startsWith("[")){const m=JSON.parse(_);return new Set(Array.isArray(m)?m:[])}return new Set([_])}}catch{}return new Set}),Mr=Ue(()=>[...Ke.value].sort((_,m)=>{const k=$l(_.date),X=$l(m.date),se=k?k.getTime():Number.POSITIVE_INFINITY,ve=X?X.getTime():Number.POSITIVE_INFINITY;return se!==ve?se-ve:(_.title||"").localeCompare(m.title||"","fr",{sensitivity:"base"})})),bs=P(!1),hr=Ue(()=>{const _=Mr.value;return bs.value?_:_.filter(m=>!m.archived)});function ao(){bs.value=!bs.value}const da=P("selected"),Ul=Ue(()=>{var k;if(!M.value)return Or.value;const _=M.value.id,m=new Set(((k=pt.value)==null?void 0:k[_])||[]);return Or.value.filter(X=>{var De;const se=X.name,ve=(De=Qt.value[se])==null?void 0:De[_],he=m.has(se);switch(da.value){case"selected":return he;case"available":return ve===!0&&!he;case"unavailable":return ve===!1;case"unknown":return ve!==!0&&ve!==!1;case"all":default:return!0}})}),ha=Ue(()=>M.value?go(M.value.id):null),Lc=Ue(()=>{if(!M.value)return!1;const _=go(M.value.id);return _.type==="incomplete"||_.type==="insufficient"}),lo=Ue(()=>M.value?ql(M.value.id):"");async function fa(_,m){const k=Fe.value.find(ve=>ve.name===_);if(!k){console.error("Joueur non trouvé");return}const X=Ke.value.find(ve=>ve.id===m);if(!X){console.error("Événement non trouvé");return}if(X.archived){Le.value=!0,lt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Le.value=!1},3e3);return}if(no(k.id)){const ve=$o(k.id),he=ps.value===k.id;console.debug("Joueur protégé:",{playerId:k.id,hasCachedPassword:ve,wasRecentlyVerified:he,recentlyVerifiedPlayer:ps.value}),ve||he?(console.debug("Session active ou joueur récemment vérifié, procéder au toggle"),he&&(console.debug("Nettoyage du flag recentlyVerifiedPlayer"),ps.value=null),pa(k,m)):(console.debug("Pas de session, affichage de la modal de vérification"),In.value={playerName:_,eventId:m},$t.value=k,kr.value=!0);return}pa(k,m)}function pa(_,m){var se,ve,he;const k=(se=Qt.value[_.name])==null?void 0:se[m];console.debug("toggleAvailability");let X;k===!0?X=!1:k===!1?X=void 0:X=!0,X===void 0?Qt.value[_.name]&&delete Qt.value[_.name][m]:(Qt.value[_.name]||(Qt.value[_.name]={}),Qt.value[_.name][m]=X);try{typeof Wt<"u"&&Wt.value===1&&_.id===(B.value||((ve=Or.value[0])==null?void 0:ve.id))&&m===(q.value||((he=hr.value[0])==null?void 0:he.id))&&(Wt.value=3,Ut(()=>{const Qe=document.querySelector(`[data-player-id="${_.id}"]`);if(Qe){const Ze=Qe.querySelector(".player-name");if(Ze){const yt=Ze.getBoundingClientRect();de.value.position={x:Math.round(yt.right+8),y:Math.round(yt.top+window.scrollY-4)}}}}),ka(()=>{try{window.removeEventListener("resize",En)}catch{}try{Kr.value&&Kr.value.disconnect()}catch{}}))}catch{}a_(_.name,Qt.value[_.name],o.value).then(async()=>{await Ut(),Nn(),Le.value=!0,lt.value="Disponibilité mise à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}).catch(De=>{console.error("Erreur lors de la mise à jour de la disponibilité"),alert("Erreur lors de la mise à jour de la disponibilité. Veuillez réessayer.")})}function xn(_,m){var k;return(k=Qt.value[_])==null?void 0:k[m]}function Fc(_,m){var se;const k=pt.value[m]||[],X=(se=Qt.value[_])==null?void 0:se[m];return k.includes(_)&&X===!0}async function $c(_,m=6){const k=Ke.value.find(he=>he.id===_),X=(k==null?void 0:k.playerCount)||6,se=pt.value[_]||[];if(se.length>0&&se.every(he=>xn(he,_))){console.debug("Tous les joueurs sélectionnés sont disponibles, nouveau tirage complet");const De=Fe.value.filter(yt=>xn(yt.name,_)).map(yt=>{const Kt=ws(yt.name);return{name:yt.name,weight:1/(1+Kt)}}),Qe=[],Ze=[...De];for(;Qe.length<X&&Ze.length>0;){const yt=Ze.reduce((on,_t)=>on+_t.weight,0);let Kt=Math.random()*yt;const sn=Ze.findIndex(on=>(Kt-=on.weight,Kt<=0));sn>=0&&(Qe.push(Ze[sn].name),Ze.splice(sn,1))}pt.value[_]=Qe}else{const he=se.filter(Qe=>xn(Qe,_)),De=X-he.length;if(De<=0)pt.value[_]=he;else{const Qe=new Set(he),yt=Fe.value.filter(on=>xn(on.name,_)&&!Qe.has(on.name)).map(on=>{const _t=ws(on.name);return{name:on.name,weight:1/(1+_t)}}),Kt=[],sn=[...yt];for(;Kt.length<De&&sn.length>0;){const on=sn.reduce((Lr,yo)=>Lr+yo.weight,0);let _t=Math.random()*on;const pr=sn.findIndex(Lr=>(_t-=Lr.weight,_t<=0));pr>=0&&(Kt.push(sn[pr].name),sn.splice(pr,1))}pt.value[_]=[...he,...Kt]}}await Kp(_,pt.value[_],o.value),fo(),Nn()}async function ma(_,m=6){var he,De;console.debug("tirerProtected appelé"),console.debug("etat modal selection avant");const k=qr.value,X=(he=gn.value)==null?void 0:he.id,se=pt.value[_]&&pt.value[_].length>0,ve=se?[...pt.value[_]]:[];if(await $c(_,m),console.debug("etat modal selection apres"),k&&!qr.value&&(console.debug("Restauration de la popin de sélection..."),qr.value=!0,gn.value=Ke.value.find(Qe=>Qe.id===X)),qr.value&&((De=gn.value)==null?void 0:De.id)===_)if(console.debug("Popin de sélection ouverte, mise à jour..."),await Ut(),ms.value&&ms.value.showSuccess){console.debug("Appel de showSuccess sur la popin de sélection");const Qe=pt.value[_]||[],Ze=ve.filter(Kt=>Qe.includes(Kt)),yt=Ze.length>0&&Ze.length<ve.length;ms.value.showSuccess(se,yt)}else console.debug("showSuccess indisponible");else console.debug("Popin de sélection fermée, affichage message global"),Le.value=!0,Ke.value.find(Qe=>Qe.id===_),pt.value[_],se?lt.value="Sélection mise à jour avec succès !":lt.value="Sélection effectuée avec succès !",setTimeout(()=>{Le.value=!1},3e3)}function uo(_){_===0?F.value.position=null:_===1?z.value.position=null:_===2&&(de.value.position=null)}function Uc(_){var k;return _?(typeof _=="string"?new Date(_):((k=_.toDate)==null?void 0:k.call(_))||_).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):""}function co(_){var k;return _?(typeof _=="string"?new Date(_):((k=_.toDate)==null?void 0:k.call(_))||_).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""}function ws(_){return Object.values(pt.value).filter(m=>m.includes(_)).length}function ga(_){const m=Qt.value[_]||{};return Object.values(m).filter(k=>k===!0).length}function xr(_){return _?Object.values(Qt.value).filter(m=>m[_]===!0).length:0}function ho(_){return _?(pt.value[_]||[]).length:0}function jl(_){const m=Ke.value.find(X=>X.id===_),k=(m==null?void 0:m.playerCount)||6;return ho(_)>=k}function jc(_){const m=ga(_),k=ws(_);return m===0?0:k/m}function Bc(_){Mc.value[_]={availability:ga(_),selection:ws(_),ratio:jc(_)}}function fo(){Fe.value.forEach(_=>Bc(_.name))}function Nn(){const _={};Ke.value.forEach(m=>{const k=m.playerCount||6,se=Fe.value.filter(he=>xn(he.name,m.id)===!0).map(he=>{const De=ws(he.name);return{name:he.name,weight:1/(1+De)}}),ve=se.reduce((he,De)=>he+De.weight,0);se.forEach(he=>{const De=Math.min(1,he.weight/ve*k);_[he.name]||(_[he.name]={}),_[he.name][m.id]=Math.round(De*100)})}),ca.value=_}const po=P(null),mo=P(!1);async function si(_=null){const m=_||po.value;if(!m){console.error("Aucun joueur à supprimer");return}try{await nM(m,o.value),Fe.value=Fe.value.filter(k=>k.id!==m),mo.value=!1,po.value=null,Le.value=!0,lt.value="Joueur supprimé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la suppression du joueur"),alert("Erreur lors de la suppression du joueur. Veuillez réessayer.")}}function u(){mo.value=!1,po.value=null}async function p(_){iv(),await Pi(_,o.value)?await Te({type:"deletePlayer",data:{playerId:_}}):await J({type:"deletePlayer",data:{playerId:_}})}async function v(){if(T.value){const _=Ke.value.find(k=>k.id===T.value),m=(_==null?void 0:_.playerCount)||6;await ma(T.value,m),me.value=!1,T.value=null}}function b(){me.value=!1,T.value=null}function K(){return j.value?{deleteEvent:"Suppression d'événement - Code PIN requis",addEvent:"Ajout d'événement - Code PIN requis",deletePlayer:"Suppression de joueur - Code PIN requis",launchSelection:"Lancement de sélection - Code PIN requis",toggleArchive:"Archivage d'événement - Code PIN requis",updateSelection:"Mise à jour de sélection - Code PIN requis"}[j.value.type]||"Code PIN requis":"Veuillez saisir le code PIN à 4 chiffres"}async function J(_){if(Vn.isPinCached(o.value)){const m=Vn.getCachedPin(o.value);if(console.debug("PIN en cache trouvé, utilisation automatique"),await nh(o.value,m)){await oi(_);return}else Vn.clearSession()}j.value=_,L.value=!0}async function Te(_){const m=_.data.playerId;try{if(Vn.isPinCached(o.value)){console.debug("PIN de saison en cache — saut de la demande de mot de passe joueur"),await oi(_);return}}catch{}if($o(m)){console.debug("Mot de passe du joueur en cache trouvé, utilisation automatique"),await oi(_);return}et.value=_,ht.value=!0}async function Tt(_){try{if(await nh(o.value,_)){Vn.saveSession(o.value,_),L.value=!1;const k=j.value;j.value=null,await oi(k)}else C.value="Code PIN incorrect",setTimeout(()=>{C.value=""},3e3)}catch{console.error("Erreur lors de la vérification du PIN"),C.value="Erreur lors de la vérification du code PIN"}}function vn(){L.value=!1,j.value=null,C.value=""}async function ut(_){if(_){W.value=!0,ee.value="";try{const m=et.value.data.playerId,k=await Bp(o.value);if(_===k){try{Vn.saveSession(o.value,_)}catch{}try{$i.saveSession(et.value.data.playerId)}catch{}ht.value=!1;const se=et.value;et.value=null,U.value="",await oi(se);return}if(await verifyPlayerPassword(m,_,o.value)){ht.value=!1;const se=et.value;et.value=null,U.value="",await oi(se)}else ee.value="Mot de passe incorrect",setTimeout(()=>{ee.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),ee.value="Erreur lors de la vérification du mot de passe"}finally{W.value=!1}}}function Tn(){ht.value=!1,et.value=null,ee.value="",U.value="",W.value=!1}async function yn(_){if(_){We.value=!0,Q.value="";try{const m=Z.value.data.player,k=await Bp(o.value);if(_===k){try{Vn.saveSession(o.value,_)}catch{}try{$i.saveSession(Z.value.data.player.id)}catch{}Se.value=!1;const se=Z.value;Z.value=null,Ee.value="",await oi(se);return}if(await verifyPlayerPassword(m.id,_,o.value)){Se.value=!1;const se=Z.value;Z.value=null,Ee.value="",await oi(se)}else Q.value="Mot de passe incorrect",setTimeout(()=>{Q.value=""},3e3)}catch{console.error("Erreur lors de la vérification du mot de passe"),Q.value="Erreur lors de la vérification du mot de passe"}finally{We.value=!1}}}function ii(){Se.value=!1,Z.value=null,Q.value="",Ee.value="",We.value=!1}async function fr(){D.value=!0,$.value="",te.value="";try{const _=Z.value.data.player,m=await sendPasswordResetEmail(_.id,o.value);te.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),$.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{D.value=!1}}async function va(){Ve.value=!0,qe.value="",I.value="";try{const _=et.value.data.playerId,m=await sendPasswordResetEmail(_,o.value);I.value=m.message||"Email de réinitialisation envoyé ! Vérifiez votre boîte de réception."}catch{console.error("Erreur lors de l'envoi de l'email"),qe.value="Erreur lors de l'envoi de l'email. Veuillez réessayer."}finally{Ve.value=!1}}function Bl(){return Vn.isPinCached(o.value)?{timeRemaining:Vn.getTimeRemaining(),isExpiringSoon:Vn.isExpiringSoon()}:null}async function oi(_){var X;if(!_)return;const{type:m,data:k}=_;try{switch(m){case"deleteEvent":console.debug("executePendingOperation - data.eventId reçu"),c.value=k.eventId,l.value=!0;break;case"addEvent":ua.value=!0;break;case"deletePlayer":po.value=k.playerId,mo.value=!0;break;case"launchSelection":pt.value[k.eventId]&&pt.value[k.eventId].length>0?(T.value=k.eventId,me.value=!0,S.value=!1):(await ma(k.eventId,k.count),S.value=!1);break;case"toggleAvailability":pa(k.player,k.eventId);break;case"toggleArchive":await setEventArchived(k.eventId,k.archived,o.value);{const se=Ke.value.findIndex(ve=>ve.id===k.eventId);se!==-1&&(Ke.value[se]={...Ke.value[se],archived:!!k.archived}),ne.value=!!k.archived}break;case"updateSelection":{const{eventId:se,players:ve}=k,he=[...pt.value[se]||[]],De=Array.isArray(ve)?ve:[];await Kp(se,De,o.value),pt.value[se]=De;try{const Qe=he.filter(Ze=>!De.includes(Ze));if(Qe.length>0){const Ze=Ke.value.find(yt=>yt.id===se);await JM({eventId:se,eventData:Ze,removedPlayers:Qe,newSelectedPlayers:De,seasonId:o.value,seasonSlug:s,players:ys.value})}}catch{}try{(X=ms.value)==null||X.showSuccess(!0,!0)}catch{}}break}}catch{console.error("Erreur lors de l'exécution de l'opération"),Le.value=!0,lt.value="Erreur lors de l'opération. Veuillez réessayer.",setTimeout(()=>{Le.value=!1},3e3)}}function mT(){t.push("/seasons")}ka(()=>{const _=cr.value;_&&_.removeEventListener("scroll",En),window.removeEventListener("resize",En)});async function tv(_){M.value=_,le.value=_.description||"",ne.value=!!_.archived;try{const[m,k]=await Promise.all([To(Fe.value,Ke.value,o.value),Ao(o.value)]);Qt.value=m,pt.value=k}catch(m){console.warn("Impossible de rafraîchir les données avant ouverture des détails:",m)}S.value=!0}function hf(){S.value=!1,M.value=null,le.value="",ie.value=!1,_e.value=!1,wn(),lr(),ge.value={position:"fixed",top:"0px",left:"0px"},xe.value={position:"fixed",top:"0px",left:"0px"}}function ya(_,m=null){const k=m||M.value;if(k)try{oL(_,k,i.value),Le.value=!0,_==="ics"?lt.value="Fichier .ics téléchargé ! Importez-le dans votre agenda":_==="google"?lt.value="Google Calendar ouvert dans un nouvel onglet":_==="outlook"&&(lt.value="Outlook ouvert dans un nouvel onglet"),setTimeout(()=>{Le.value=!1},3e3)}catch(X){console.error("Erreur lors de l'ajout au calendrier:",X),Le.value=!0,lt.value="Erreur lors de l'ajout au calendrier",setTimeout(()=>{Le.value=!1},3e3)}}function nv(){hf(),r.params.eventId&&t.push(`/season/${e.slug}`)}async function gT(_,m){console.debug("handleAvailabilityToggle appelé");const k=Fe.value.find(ve=>ve.name===_);if(!k){console.error("Joueur non trouvé");return}const X=Ke.value.find(ve=>ve.id===m);if(X!=null&&X.archived){Le.value=!0,lt.value="Événement archivé — désarchivez pour modifier",setTimeout(()=>{Le.value=!1},3e3);return}console.debug("Joueur trouvé");const se=no(k.id);if(console.debug("Joueur protégé"),se){$o(k.id)?(console.debug("Session active, procéder au toggle"),await fa(_,m)):(console.debug("Demande du mot de passe pour joueur protégé"),In.value={playerName:_,eventId:m},$t.value=k,kr.value=!0);return}console.debug("Joueur non protégé, procéder au toggle"),await fa(_,m)}function vT(_,m){return(pt.value[m]||[]).includes(_)}async function yT(_){if(console.debug("Mot de passe vérifié"),$t.value&&(ps.value=$t.value.id,console.debug("Joueur marqué comme récemment vérifié")),In.value){const{playerName:m,eventId:k}=In.value;console.debug("Exécution de l'action en attente"),await fa(m,k),In.value=null}else console.debug("Aucune action en attente trouvée");kr.value=!1,$t.value=null}function rv(){d.value=M.value.id,f.value=M.value.title,g.value=M.value.date,le.value=M.value.description||"",y.value=M.value.playerCount||6,S.value=!1}async function sv(){if(M.value)try{const _=!M.value.archived,m={...M.value,archived:_};await l_(M.value.id,m,o.value),M.value.archived=_;const k=Ke.value.findIndex(X=>X.id===M.value.id);k!==-1&&(Ke.value[k].archived=_),Le.value=!0,lt.value=_?"Événement archivé avec succès !":"Événement désarchivé avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de la modification de l'archivage"),alert("Erreur lors de la modification de l'archivage. Veuillez réessayer.")}}function ff(_){x.value=_,w.value=!0;try{typeof Wt<"u"&&Wt.value}catch{}}function iv(){w.value=!1,x.value=null}async function _T({playerId:_,newName:m}){try{await rM(_,m,o.value),await Promise.all([Td(o.value),To(Fe.value,Ke.value,o.value),Ao(o.value)]).then(([k,X,se])=>{if(Fe.value=k,Qt.value=X,pt.value=se,Ml(),x.value&&x.value.id===_){const ve=k.find(he=>he.id===_);ve&&(x.value=ve)}}),Le.value=!0,lt.value="Joueur mis à jour avec succès !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors de l'édition du joueur"),alert("Erreur lors de l'édition du joueur. Veuillez réessayer.")}}async function bT(){try{await Promise.all([Td(o.value),To(Fe.value,Ke.value,o.value),Ao(o.value)]).then(([_,m,k])=>{if(Fe.value=_,Qt.value=m,pt.value=k,Ml(),x.value){const X=_.find(se=>se.id===x.value.id);X&&(x.value=X)}}),Le.value=!0,lt.value="Données mises à jour !",setTimeout(()=>{Le.value=!1},3e3)}catch{console.error("Erreur lors du rafraîchissement")}}function wT(_){if(!_)return{availability:0,selection:0,ratio:0};const m=ga(_.name),k=ws(_.name),X=m===0?0:Math.round(k/m*100);return{availability:m,selection:k,ratio:X}}function go(_){const m=pt.value[_]||[],k=Ke.value.find(ve=>ve.id===_),X=(k==null?void 0:k.playerCount)||6,se=xr(_);if(m.length>0){const ve=m.some(De=>!xn(De,_)),he=se<X;if(ve||he)return{type:"incomplete",hasUnavailablePlayers:ve,hasInsufficientPlayers:he,unavailablePlayers:m.filter(De=>!xn(De,_)),availableCount:se,requiredCount:X}}return se<X?{type:"insufficient",availableCount:se,requiredCount:X}:m.length===0?{type:"ready",availableCount:se,requiredCount:X}:{type:"complete",availableCount:se,requiredCount:X}}function ql(_){const m=go(_);switch(m.type){case"incomplete":return m.hasUnavailablePlayers?m.unavailablePlayers.length===1?`Sélection incomplète : ${m.unavailablePlayers[0]} n'est plus disponible`:`Sélection incomplète : ${m.unavailablePlayers.length} joueurs ne sont plus disponibles`:`Sélection incomplète : ${m.availableCount} joueurs disponibles pour ${m.requiredCount} requis`;case"insufficient":return`Pas assez de joueurs : ${m.availableCount} disponibles pour ${m.requiredCount} requis`;case"ready":return`Prêt pour la sélection : ${m.availableCount} joueurs disponibles`;case"complete":return`Sélection complète : ${m.availableCount} joueurs disponibles`;default:return""}}async function IT(){const _=[];for(const m of Fe.value){if(!await Pi(m.id,o.value))continue;const X=await Vx(m.id,o.value);X&&_.push({...m,email:X})}return _}function qc(_){if(_!=null&&_.archived){Le.value=!0,lt.value="Impossible d'annoncer un événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}ov(),_r.value=_,Wi.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","announce"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function ET(){Wi.value=!1,_r.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="announce"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}function ov(){Qi.value=!1,gs.value=null}const pf=P(!1);async function av({eventId:_,eventData:m,reason:k,selectedPlayers:X,scope:se="all",recipient:ve=null}){pf.value=!0;try{k==="selection"?(se==="single"&&(ve!=null&&ve.email)?await h_({eventId:_,eventData:m,selectedPlayers:[ve.name],seasonId:o.value,seasonSlug:s,players:ys.value}):await h_({eventId:_,eventData:m,selectedPlayers:X,seasonId:o.value,seasonSlug:s,players:ys.value}),Le.value=!0,lt.value=se==="single"?`Notification envoyée à ${(ve==null?void 0:ve.name)||"1 joueur"}`:"Notifications de sélection envoyées à tous les joueurs sélectionnés !",setTimeout(()=>{Le.value=!1},3e3)):(se==="single"&&(ve!=null&&ve.email)?await d_({eventId:_,eventData:m,players:[ve],seasonId:o.value,seasonSlug:s,createMagicLink:Gp,reminder:!1,getAvailabilityForEvent:(he,De)=>xn(he,De)}):await d_({eventId:_,eventData:m,players:await IT(),seasonId:o.value,seasonSlug:s,createMagicLink:Gp,reminder:!1,getAvailabilityForEvent:(he,De)=>xn(he,De)}),Le.value=!0,lt.value=se==="single"?`Notification envoyée à ${(ve==null?void 0:ve.name)||"1 joueur"}`:"Notifications envoyées à tous les joueurs protégés !",setTimeout(()=>{Le.value=!1},3e3))}catch{console.error("Erreur lors de l'envoi des notifications"),Le.value=!0,lt.value="Erreur lors de l'envoi des notifications",setTimeout(()=>{Le.value=!1},3e3)}pf.value=!1}function mf(_){if(!_)return{};const m={};return Fe.value.forEach(k=>{m[k.name]=xn(k.name,_)}),m}function vo(_){if(_!=null&&_.archived){Le.value=!0,lt.value="Impossible d'ouvrir la sélection sur un événement archivé",setTimeout(()=>{Le.value=!1},3e3);return}gn.value=_,qr.value=!0;try{const m=new URLSearchParams(window.location.search);m.set("modal","selection"),m.set("event",(_==null?void 0:_.id)||""),history.replaceState(null,"",`${window.location.pathname}?${m.toString()}`)}catch{}}function lv(){qr.value=!1,gn.value=null;try{const _=new URLSearchParams(window.location.search);_.get("modal")==="selection"&&(_.delete("modal"),_.delete("event"),history.replaceState(null,"",`${window.location.pathname}?${_.toString()}`))}catch{}}async function xT(){if(!gn.value)return;const _=gn.value.id,m=gn.value.playerCount||6;if(xr(_)===0){Le.value=!0,lt.value="Aucun joueur disponible pour cet événement",setTimeout(()=>{Le.value=!1},3e3);return}await J({type:"launchSelection",data:{eventId:_,count:m}})}function TT(){lv(),Le.value=!0,lt.value="Sélection validée !",setTimeout(()=>{Le.value=!1},3e3)}async function AT(_){if(!_||!_.eventId)return;const{eventId:m,players:k}=_;await J({type:"updateSelection",data:{eventId:m,players:k}})}async function gf(_,m){if(!_||!m)return;cv(),kn.value=_,Dl.value=!0,await Ut();const k=document.querySelector(`[data-event-id="${_}"]`);if(!k){console.warn("Élément événement non trouvé dans le DOM");return}document.querySelectorAll(".focused-event-highlight").forEach(he=>{he.classList.remove("focused-event-highlight")});const X=document.querySelectorAll(`[data-event-id="${_}"]`);X.forEach(he=>{he.classList.add("focused-event-highlight")});const se=X[0],ve=X[X.length-1];se&&se.classList.add("focused-event-column-start"),ve&&ve.classList.add("focused-event-column-end"),await ST(k),Le.value=!0,lt.value=`Événement ciblé : ${m.title}`,setTimeout(()=>{Le.value=!1},4e3),Yi.value=setTimeout(()=>{cv()},8e3)}function uv(_){if(!_)return;const m=Ke.value.find(k=>k.id===_);if(!m){console.warn("Événement non trouvé dans la liste des événements"),setTimeout(()=>{const k=Ke.value.find(X=>X.id===_);k?gf(_,k):console.error("Événement toujours introuvable après retry")},500);return}gf(_,m)}Pt(Ke,_=>{try{const m=new URLSearchParams(window.location.search),k=m.get("modal"),X=m.get("event");if(!k||!X)return;const se=_.find(ve=>ve.id===X);if(!se)return;k==="announce"&&qc(se),k==="selection"&&vo(se)}catch{}},{immediate:!0});async function ST(_){if(!_)return;if(await new Promise(k=>setTimeout(k,100)),window.innerWidth<=768){const k=cr.value;if(k){const X=_.offsetLeft,se=_.offsetWidth,ve=k.clientWidth,he=X-ve/2+se/2,De=k.scrollWidth-ve,Qe=Math.max(0,Math.min(he,De));k.scrollTo({left:Qe,behavior:"smooth"}),setTimeout(()=>{const Ze=_.getBoundingClientRect();if(Ze.left<0||Ze.right>window.innerWidth){const yt=X-20;k.scrollTo({left:Math.max(0,yt),behavior:"smooth"})}},500)}}else _.scrollIntoView({behavior:"smooth",block:"center",inline:"center"});const m=cr.value;m&&setTimeout(()=>{const k=document.querySelector(`[data-event-id="${kn.value}"]`);if(k&&k.closest("tbody")){const X=k.offsetLeft,se=k.offsetWidth,ve=m.clientWidth,he=X-ve/2+se/2,De=m.scrollWidth-ve,Qe=Math.max(0,Math.min(he,De));m.scrollTo({left:Qe,behavior:"smooth"})}},300)}function cv(){Yi.value&&(clearTimeout(Yi.value),Yi.value=null),kn.value=null,Dl.value=!1,document.querySelectorAll(".focused-event-highlight").forEach(_=>{_.classList.remove("focused-event-highlight")}),document.querySelectorAll(".focused-event-column-start, .focused-event-column-end").forEach(_=>{_.classList.remove("focused-event-column-start","focused-event-column-end")})}return(_,m)=>{var k,X,se,ve,he,De,Qe,Ze,yt,Kt,sn,on,_t,pr,Lr,yo,_a,dv,hv,fv,pv,mv,gv,vv;return V(),O(ct,null,[h("div",$6,[h("div",U6,[h("button",{onClick:mT,class:"absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Retour aux saisons"},m[77]||(m[77]=[h("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])),h("h1",j6,ae(i.value?i.value:"Chargement..."),1),h("div",B6,[h("div",q6,[h("button",{onClick:Js,class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Mon compte","aria-label":"Mon compte"},m[78]||(m[78]=[h("span",{class:"text-2xl"},"👤",-1)])),h("button",{onClick:m[0]||(m[0]=H=>Ji.value=!0),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Kezako ?","aria-label":"Kezako ?"},m[79]||(m[79]=[h("span",{class:"text-2xl"},"❓",-1)]))]),h("div",{class:"relative md:hidden",ref_key:"headerMenuRef",ref:Vr},[h("button",{onClick:m[1]||(m[1]=mt(H=>{Dc(),ti()},["stop"])),class:"text-white hover:text-purple-300 transition-colors duration-200 p-2 rounded-full hover:bg-white/10",title:"Menu","aria-label":"Menu"},m[80]||(m[80]=[h("span",{class:"text-2xl"},"⋯",-1)]))],512),(V(),ko(fu,{to:"body"},[Hr.value?(V(),O("div",{key:0,ref_key:"headerMenuDropdownRef",ref:Ir,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:mr(eo.value)},[h("button",{onClick:m[2]||(m[2]=H=>{Js(),xt()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[81]||(m[81]=[h("span",null,"👤",-1),h("span",{class:"text-sm"},"Mon compte",-1)])),h("button",{onClick:m[3]||(m[3]=H=>{Ji.value=!0,xt()}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[82]||(m[82]=[h("span",null,"❓",-1),h("span",{class:"text-sm"},"Kezako ?",-1)]))],4)):ye("",!0)]))])],512),h("div",z6,[h("div",{ref_key:"headerBarRef",ref:Rc,class:"sticky top-0 z-[80] bg-gray-900 overflow-hidden"},[h("div",K6,[Ke.value.length===0&&Fe.value.length===0?ye("",!0):(V(),O("div",G6,[h("div",{class:"flex items-center justify-center h-full gap-2"},[h("button",{onClick:Fl,class:"flex items-center space-x-2 px-3 py-2 md:px-4 md:py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl text-sm md:text-base font-medium",title:"Ajouter un nouvel événement"},m[83]||(m[83]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un événement",-1),h("span",{class:"sm:hidden"},"Événement",-1)]))])])),h("div",H6,[h("div",{ref_key:"headerEventsRef",ref:Dn,class:"flex relative z-[60]",style:mr({transform:`translateX(-${Xs.value}px)`})},[(V(!0),O(ct,null,Tr(hr.value,H=>(V(),O("div",{key:"h-"+H.id,"data-event-id":H.id,class:St(["col-event flex-shrink-0 p-3 text-center flex flex-col justify-between",{"archived-header":H.archived}])},[h("div",{class:"flex flex-col items-center justify-between p-2 rounded-lg hover:bg-white/10 transition-colors duration-200 cursor-pointer group h-24",title:H.title+" - Cliquez pour voir les détails",onClick:mt(Jt=>tv(H),["stop"])},[h("div",J6,[h("div",Y6,ae(H.title||"Sans titre"),1),H.archived?(V(),O("div",X6,"(Archivé)")):ye("",!0)]),h("div",Z6,[h("div",{onClick:mt(Jt=>nn(H.id),["stop"]),class:"header-date text-[16px] md:text-base text-gray-300 group-hover:text-purple-200 transition-colors duration-200 cursor-pointer hover:bg-white/10 px-2 py-1 rounded",title:co(H.date)+" - Cliquez pour ajouter à votre agenda"},ae(Uc(H.date)),9,eU),ke.value===H.id?(V(),O("div",tU,[h("div",nU,[h("button",{onClick:mt(Jt=>{ya("google",H),wn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[84]||(m[84]=[h("span",null,"🌐",-1),h("span",null,"Google Calendar",-1)]),8,rU),h("button",{onClick:mt(Jt=>{ya("outlook",H),wn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[85]||(m[85]=[h("span",null,"📧",-1),h("span",null,"Outlook",-1)]),8,sU),h("button",{onClick:mt(Jt=>{ya("ics",H),wn()},["stop"]),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[86]||(m[86]=[h("span",null,"📥",-1),h("span",null,"Télécharger (.ics)",-1)]),8,iU)])])):ye("",!0)])],8,Q6),h("div",oU,[H.archived?(V(),O("div",aU,m[87]||(m[87]=[h("span",{class:"text-xs text-gray-300 font-medium"},"📁",-1),h("span",{class:"text-xs text-gray-200 font-medium ml-1"},"Archivé",-1)]))):go(H.id).type==="ready"?(V(),O("div",{key:1,class:"px-2 py-1 bg-blue-500/20 border border-blue-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-blue-500/30 transition-colors duration-200 cursor-pointer group",title:ql(H.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(Jt=>vo(H),["stop"])},m[88]||(m[88]=[h("span",{class:"text-xs text-blue-300 font-medium group-hover:text-blue-200"},"🆕",-1),h("span",{class:"text-xs text-blue-200 font-medium ml-1 group-hover:text-blue-100"},"Nouveau",-1)]),8,lU)):go(H.id).type==="complete"?(V(),O("div",{key:2,class:"px-2 py-1 bg-green-500/20 border border-green-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-green-500/30 transition-colors duration-200 cursor-pointer group",title:ql(H.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(Jt=>vo(H),["stop"])},m[89]||(m[89]=[h("span",{class:"text-xs text-green-300 font-medium group-hover:text-green-200"},"✅",-1),h("span",{class:"text-xs text-green-200 font-medium ml-1 group-hover:text-green-100"},"Complet",-1)]),8,uU)):go(H.id).type==="incomplete"?(V(),O("div",{key:3,class:"px-2 py-1 bg-orange-500/20 border border-orange-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-orange-500/30 transition-colors duration-200 cursor-pointer group",title:ql(H.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(Jt=>vo(H),["stop"])},m[90]||(m[90]=[h("span",{class:"text-xs text-orange-300 font-medium group-hover:text-orange-200"},"⚠️",-1),h("span",{class:"text-xs text-orange-200 font-medium ml-1 group-hover:text-orange-100"},"À finaliser",-1)]),8,cU)):go(H.id).type==="insufficient"?(V(),O("div",{key:4,class:"px-2 py-1 bg-red-500/20 border border-red-400/30 rounded-md mx-auto flex items-center justify-center hover:bg-red-500/30 transition-colors duration-200 cursor-pointer group",title:ql(H.id)+" - Cliquez pour ouvrir la sélection",onClick:mt(Jt=>vo(H),["stop"])},m[91]||(m[91]=[h("span",{class:"text-xs text-red-300 font-medium group-hover:text-red-200"},"❌",-1),h("span",{class:"text-xs text-red-200 font-medium ml-1 group-hover:text-red-100"},"Manque",-1)]),8,dU)):ye("",!0)])],10,W6))),128))],4)]),m[94]||(m[94]=h("div",{class:"col-right flex-shrink-0 p-3 sticky right-0 z-[81] bg-gray-900 h-full"},null,-1)),h("button",{onClick:ao,class:"absolute right-2 top-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[86] backdrop-blur-sm",title:bs.value?"Masquer les événements archivés":"Afficher les événements archivés","aria-label":bs.value?"Masquer les événements archivés":"Afficher les événements archivés"},[(V(),O("svg",fU,[m[92]||(m[92]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.25 12c1.5-4 5.25-7.5 9.75-7.5S20.25 8 21.75 12c-1.5 4-5.25 7.5-9.75 7.5S3.75 16 2.25 12z"},null,-1)),m[93]||(m[93]=h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)),bs.value?ye("",!0):(V(),O("path",pU))]))],8,hU),tt(h("button",{onClick:m[4]||(m[4]=mt(H=>aa(-1,H),["prevent"])),onMousedown:m[5]||(m[5]=mt(H=>Zi(-1,H),["prevent"])),onMouseup:m[6]||(m[6]=H=>wr(H)),onMouseleave:m[7]||(m[7]=H=>wr(H)),onTouchstart:m[8]||(m[8]=mt(H=>Zi(-1,H),["prevent"])),onTouchend:m[9]||(m[9]=H=>wr(H)),onTouchcancel:m[10]||(m[10]=H=>wr(H)),class:"absolute left-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements précédents — cliquez pour défiler"}," ‹ ",544),[[Tf,Vl.value]]),tt(h("button",{onClick:m[11]||(m[11]=mt(H=>aa(1,H),["prevent"])),onMousedown:m[12]||(m[12]=mt(H=>Zi(1,H),["prevent"])),onMouseup:m[13]||(m[13]=H=>wr(H)),onMouseleave:m[14]||(m[14]=H=>wr(H)),onTouchstart:m[15]||(m[15]=mt(H=>Zi(1,H),["prevent"])),onTouchend:m[16]||(m[16]=H=>wr(H)),onTouchcancel:m[17]||(m[17]=H=>wr(H)),class:"absolute right-2 bottom-2 w-9 h-9 rounded-full border border-white/30 bg-white/10 hover:bg-white/20 text-white flex items-center justify-center z-[85] backdrop-blur-sm",title:"Événements suivants — cliquez pour défiler"}," › ",544),[[Tf,Pc.value]])])],512),tt(h("div",{ref_key:"gridboardRef",ref:cr,class:"gridboard overflow-x-auto bg-gradient-to-br from-blue-900/50 via-purple-900/50 to-indigo-900/50"},[Wt.value===1?(V(),O("div",mU,[F.value.position?(V(),O("div",{key:0,class:"fixed z-[400]",style:mr({left:F.value.position.x+"px",top:F.value.position.y+"px"})},[h("div",{id:"coachmark-add",class:St(["coachmark pointer-events-auto max-w-sm bg-gray-900 border border-purple-500/40 rounded-xl shadow-2xl p-3 text-white relative",{"coachmark-right":F.value.side==="right","coachmark-left":F.value.side==="left"}])},[m[96]||(m[96]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ajoutez votre nom",-1)),m[97]||(m[97]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},'Cliquez sur "Ajouter un joueur" pour vous inscrire',-1)),h("div",gU,[m[95]||(m[95]=h("span",{class:"text-purple-300 text-base md:text-sm"},"Étape 1/4",-1)),h("button",{onClick:m[18]||(m[18]=H=>uo(0)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant >")])],2)],4)):ye("",!0)])):ye("",!0),Wt.value===2&&B.value&&q.value?(V(),O("div",vU,[z.value.position?(V(),O("div",{key:0,class:"fixed z-[400]",style:mr({position:"absolute",left:z.value.position.x+"px",top:z.value.position.y+"px"})},[h("div",yU,[m[99]||(m[99]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Indiquez vos disponibilités",-1)),m[100]||(m[100]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez cette case pour alterner Oui / Non / Vide",-1)),h("div",_U,[m[98]||(m[98]=h("span",{class:"text-pink-300 text-base md:text-sm"},"Étape 2/4",-1)),h("button",{onClick:m[19]||(m[19]=H=>uo(1)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ye("",!0)])):ye("",!0),Wt.value===3&&B.value?(V(),O("div",bU,[de.value.position?(V(),O("div",{key:0,class:"fixed z-[400]",style:mr({position:"absolute",left:de.value.position.x+"px",top:de.value.position.y+"px"})},[h("div",wU,[m[102]||(m[102]=h("div",{class:"text-lg md:text-base font-semibold mb-1"},"Ouvrez votre fiche",-1)),m[103]||(m[103]=h("div",{class:"text-base md:text-sm text-gray-300 mb-2"},"Cliquez sur votre nom pour voir les détails et la protection",-1)),h("div",IU,[m[101]||(m[101]=h("span",{class:"text-yellow-300 text-base md:text-sm"},"Étape 3/4",-1)),h("button",{onClick:m[20]||(m[20]=H=>uo(2)),class:"text-base md:text-sm text-white/80 hover:text-white"},"Suivant")])])],4)):ye("",!0)])):ye("",!0),h("table",EU,[h("colgroup",null,[m[104]||(m[104]=h("col",{class:"col-left"},null,-1)),(V(!0),O(ct,null,Tr(hr.value,(H,Jt)=>(V(),O("col",{key:"c"+Jt,class:"col-event"}))),128)),m[105]||(m[105]=h("col",{class:"col-right"},null,-1))]),m[109]||(m[109]=h("thead",{class:"hidden"},null,-1)),h("tbody",null,[(V(!0),O(ct,null,Tr(Or.value,H=>{var Jt;return V(),O("tr",{key:H.id,class:St(["border-b border-white/10 hover:bg-white/5 transition-all duration-200",{"highlighted-player":H.id===R.value,"preferred-player":Xr.value.has(H.id)}]),"data-player-id":H.id},[h("td",TU,[h("div",AU,[Xr.value.has(H.id)?(V(),O("span",SU," ⭐ ")):no(H.id)?(V(),O("span",PU," 🔒 ")):ye("",!0),h("div",{onClick:nr=>ff(H),class:St(["player-name hover:bg-white/10 rounded-lg p-2 cursor-pointer transition-colors duration-200 text-[22px] md:text-2xl leading-tight block truncate max-w-full flex-1 min-w-0 group",{"inline-block rounded px-1 ring-2 ring-yellow-400 animate-pulse":Wt.value===3&&H.id===(B.value||((Jt=Or.value[0])==null?void 0:Jt.id))}]),title:"Cliquez pour voir les détails : "+H.name},[h("span",CU,ae(H.name),1)],10,RU)])]),(V(!0),O(ct,null,Tr(hr.value,nr=>{var yv,_v,bv;return V(),O("td",{key:nr.id,"data-event-id":nr.id,class:St(["p-0",nr.archived?"archived-col":"",{"relative ring-2 ring-pink-400 rounded-md animate-pulse":Wt.value===2&&H.id===(B.value||((yv=Or.value[0])==null?void 0:yv.id))&&nr.id===(q.value||((_v=hr.value[0])==null?void 0:_v.id))}])},[st(f_,{"player-name":H.name,"event-id":nr.id,"is-available":xn(H.name,nr.id),"is-selected":Fc(H.name,nr.id),"chance-percent":((bv=ca.value[H.name])==null?void 0:bv[nr.id])??null,"show-selected-chance":jl(nr.id),disabled:nr.archived===!0,onToggle:fa},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])],10,kU)}),128)),m[106]||(m[106]=h("td",{class:"p-3 md:p-4"},null,-1))],10,xU)}),128)),h("tr",DU,[h("td",NU,[h("div",VU,[h("button",{onClick:m[21]||(m[21]=H=>E.value=!0),class:"w-full md:w-auto flex items-center justify-center space-x-2 px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 text-white rounded-lg hover:from-purple-600 hover:to-pink-700 transition-all duration-300 text-sm md:text-base font-medium",title:"Ajouter un nouveau joueur","data-onboarding":"add-player"},m[107]||(m[107]=[h("span",{class:"text-lg"},"➕",-1),h("span",{class:"hidden sm:inline"},"Ajouter un joueur",-1),h("span",{class:"sm:hidden"},"Joueur",-1)]))])]),(V(!0),O(ct,null,Tr(hr.value,H=>(V(),O("td",{key:"add-row-"+H.id,"data-event-id":H.id,class:St(["p-3 md:p-5",H.archived?"archived-col":""])},null,10,OU))),128)),m[108]||(m[108]=h("td",{class:"p-3 md:p-4"},null,-1))])])])],512),[[Tf,!zr.value]])])]),zr.value?(V(),O("div",MU,[h("div",LU,[m[110]||(m[110]=h("div",{class:"w-20 h-20 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 animate-pulse mx-auto mb-6 flex items-center justify-center shadow-2xl"},[h("span",{class:"text-3xl"},"🎭")],-1)),h("p",FU,ae(Nr.value)+"…",1),h("div",$U,[h("div",{class:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all duration-300",style:mr({width:br.value+"%"})},null,4)]),h("p",UU,ae(br.value)+"%",1)])])):ye("",!0),zr.value?ye("",!0):(V(),ko(pF,{key:1,"season-id":o.value,"season-slug":is(s),"players-count":Fe.value.length,"events-count":Ke.value.length,"onboarding-done":((k=a.value)==null?void 0:k.onboardingCreatorDone)===!0,onCreateEvent:Fl,onAddPlayer:m[22]||(m[22]=()=>{E.value=!0}),onCopyLink:Qr,onDismissed:lf},null,8,["season-id","season-slug","players-count","events-count","onboarding-done"])),ye("",!0),Le.value?(V(),O("div",jU,[h("div",BU,[m[111]||(m[111]=h("span",{class:"text-xl"},"✨",-1)),h("span",null,ae(lt.value),1)])])):ye("",!0),dr.value?(V(),O("div",qU,[h("div",zU,[m[112]||(m[112]=h("span",{class:"text-xl"},"⚠️",-1)),h("span",null,ae(Er.value),1)])])):ye("",!0),ua.value?(V(),O("div",KU,[h("div",GU,[m[118]||(m[118]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouvel événement",-1)),h("div",HU,[m[113]||(m[113]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),tt(h("input",{"onUpdate:modelValue":m[23]||(m[23]=H=>Qn.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Titre de l'événement"},null,512),[[Nt,Qn.value]])]),h("div",WU,[m[114]||(m[114]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),tt(h("input",{"onUpdate:modelValue":m[24]||(m[24]=H=>ri.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white"},null,512),[[Nt,ri.value]])]),h("div",QU,[m[115]||(m[115]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),tt(h("textarea",{"onUpdate:modelValue":m[25]||(m[25]=H=>so.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)"},null,512),[[Nt,so.value]])]),h("div",JU,[tt(h("input",{id:"new-archived",type:"checkbox","onUpdate:modelValue":m[26]||(m[26]=H=>_s.value=H),class:"w-4 h-4"},null,512),[[Ii,_s.value]]),m[116]||(m[116]=h("label",{for:"new-archived",class:"text-sm font-medium text-gray-300"},"Créer comme archivé",-1))]),h("div",YU,[m[117]||(m[117]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),tt(h("input",{"onUpdate:modelValue":m[27]||(m[27]=H=>Yr.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",placeholder:"6"},null,512),[[Nt,Yr.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:oo,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Oc,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Créer ")])])])):ye("",!0),E.value?(V(),O("div",XU,[h("div",ZU,[m[120]||(m[120]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✨ Nouveau joueur",-1)),h("div",e5,[m[119]||(m[119]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nom",-1)),tt(h("input",{"onUpdate:modelValue":m[28]||(m[28]=H=>A.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nom du joueur"},null,512),[[Nt,A.value]])]),h("div",t5,[h("button",{onClick:m[29]||(m[29]=H=>E.value=!1),class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:df,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ajouter ")])])])):ye("",!0),l.value?(V(),O("div",n5,[h("div",r5,[m[121]||(m[121]=Xn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer cet événement ?</p></div>',1)),h("div",s5,[h("button",{onClick:Vc,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:m[30]||(m[30]=()=>Nc()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"}," Supprimer ")])])])):ye("",!0),mo.value?(V(),O("div",i5,[h("div",o5,[m[122]||(m[122]=Xn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">⚠️</span></div><h2 class="text-2xl font-bold text-white mb-2">Confirmation</h2><p class="text-gray-300">Êtes-vous sûr de vouloir supprimer ce joueur ?</p></div>',1)),h("div",a5,[h("button",{onClick:u,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:m[31]||(m[31]=()=>si()),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300"},"Supprimer")])])])):ye("",!0),me.value?(V(),O("div",l5,[h("div",u5,[h("div",c5,[m[123]||(m[123]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"🎭")],-1)),m[124]||(m[124]=h("h2",{class:"text-2xl font-bold text-white mb-2"},"Confirmation",-1)),h("p",d5,[T.value&&pt.value[T.value]&&pt.value[T.value].every(H=>xn(H,T.value))?(V(),O("span",h5,"Attention, toute la sélection sera refaite en fonction des disponibilités actuelles.")):(V(),O("span",f5,"La sélection sera mise à jour : les joueurs disponibles seront conservés, les slots vides seront complétés."))])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:b,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{onClick:v,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"},"Confirmer")])])])):ye("",!0),S.value?(V(),O("div",{key:10,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end md:items-center justify-center z-[80] p-0 md:p-4",onClick:hf},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 rounded-t-2xl md:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[92vh] flex flex-col",onClick:m[45]||(m[45]=mt(()=>{},["stop"]))},[h("div",p5,[h("button",{onClick:hf,title:"Fermer",class:"absolute right-3 top-3 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10"},"✖️"),h("div",m5,[m[130]||(m[130]=h("div",{class:"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex-shrink-0 flex items-center justify-center"},[h("span",{class:"text-xl md:text-2xl"},"🎭")],-1)),h("div",g5,[h("div",v5,[h("h2",y5,ae((X=M.value)==null?void 0:X.title),1),h("div",_5,[m[125]||(m[125]=h("span",{class:"text-blue-300"},"👥",-1)),h("span",b5,ae(((se=M.value)==null?void 0:se.playerCount)||6)+" joueurs",1)])]),h("div",w5,[h("p",I5,ae(co((ve=M.value)==null?void 0:ve.date)),1),h("div",E5,[h("button",{onClick:m[32]||(m[32]=H=>rn()),class:"px-3 py-1.5 hover:bg-white/20 rounded text-purple-300 hover:text-green-400 transition-colors duration-200 text-sm flex items-center gap-2 border border-purple-500/30",title:"Ajouter à votre agenda"},m[126]||(m[126]=[h("span",null,"📅",-1),h("span",null,"Agenda",-1)])),Be.value?(V(),O("div",x5,[h("div",T5,[h("button",{onClick:m[33]||(m[33]=H=>{ya("google"),lr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Google Calendar"},m[127]||(m[127]=[h("span",null,"🌐",-1),h("span",null,"Google Calendar",-1)])),h("button",{onClick:m[34]||(m[34]=H=>{ya("outlook"),lr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm",title:"Ouvrir dans Outlook"},m[128]||(m[128]=[h("span",null,"📧",-1),h("span",null,"Outlook",-1)])),h("button",{onClick:m[35]||(m[35]=H=>{ya("ics"),lr()}),class:"w-full text-left px-3 py-2 text-white hover:bg-white/10 flex items-center gap-2 rounded text-sm border-t border-white/10 pt-2 mt-2",title:"Télécharger un fichier .ics compatible avec tous les agendas"},m[129]||(m[129]=[h("span",null,"📥",-1),h("span",null,"Télécharger (.ics)",-1)]))])])):ye("",!0)])]),(he=M.value)!=null&&he.description?(V(),O("div",A5,ae(M.value.description),1)):ye("",!0)])])]),h("div",S5,[h("div",P5,[h("div",R5,[h("div",C5,ae(xr((De=M.value)==null?void 0:De.id)),1),m[131]||(m[131]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Disponibles",-1))]),h("div",k5,[h("div",D5,ae(ho((Qe=M.value)==null?void 0:Qe.id)),1),m[132]||(m[132]=h("div",{class:"text-xs md:text-sm text-gray-300"},"Sélectionnés",-1))]),h("div",N5,[h("div",V5,ae(Math.max((((Ze=M.value)==null?void 0:Ze.playerCount)||6)-ho((yt=M.value)==null?void 0:yt.id),0)),1),m[133]||(m[133]=h("div",{class:"text-xs md:text-sm text-yellow-300"},"Manquants",-1))])]),M.value?(V(),O("div",O5,[h("div",M5,[Lc.value?(V(),O("div",{key:0,class:St(["flex items-center gap-2 px-2 py-1 rounded-md border text-[11px] md:text-xs max-w-[70%] truncate",((Kt=ha.value)==null?void 0:Kt.type)==="incomplete"?"bg-yellow-500/10 border-yellow-500/30 text-yellow-200":"bg-orange-500/10 border-orange-500/30 text-orange-200"]),title:lo.value},[m[134]||(m[134]=h("span",null,"⚠️",-1)),h("span",F5,ae(lo.value),1)],10,L5)):ye("",!0),tt(h("select",{"onUpdate:modelValue":m[36]||(m[36]=H=>da.value=H),class:"ml-auto bg-gray-800 text-white rounded-md px-3 py-2 border border-white/10 focus:outline-none text-sm",title:"Filtrer les joueurs par statut"},m[135]||(m[135]=[Xn('<option value="selected">Sélectionnés</option><option value="available">Disponibles</option><option value="unavailable">Non Disponibles</option><option value="unknown">Pas de réponse</option><option value="all">Tous</option>',5)]),512),[[U1,da.value]])]),h("div",$5,[(V(!0),O(ct,null,Tr(Ul.value,H=>{var Jt,nr;return V(),O("div",{key:H.id,class:"flex items-center justify-between px-2 py-1.5 rounded-md hover:bg-gray-800/40 transition-colors"},[h("div",U5,[Xr.value.has(H.id)?(V(),O("span",j5," ⭐ ")):no(H.id)?(V(),O("span",B5," 🔒 ")):ye("",!0),h("span",{class:"text-white text-sm md:text-base block truncate max-w-full flex-1 min-w-0",title:H.name},ae(H.name),9,q5)]),h("div",z5,[st(f_,{"player-name":H.name,"event-id":M.value.id,"is-available":mf(M.value.id)[H.name],"is-selected":vT(H.name,M.value.id),"chance-percent":((Jt=ca.value[H.name])==null?void 0:Jt[M.value.id])??null,"show-selected-chance":jl(M.value.id),disabled:((nr=M.value)==null?void 0:nr.archived)===!0,compact:!0,onToggle:gT},null,8,["player-name","event-id","is-available","is-selected","chance-percent","show-selected-chance","disabled"])])])}),128))])])):ye("",!0),h("div",K5,[h("button",{onClick:m[37]||(m[37]=H=>vo(M.value)),class:"px-5 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2",title:"Gérer la sélection"},m[136]||(m[136]=[h("span",null,"🎭",-1),h("span",null,"Sélectionner",-1)])),h("button",{onClick:m[38]||(m[38]=H=>qc(M.value)),disabled:(sn=M.value)==null?void 0:sn.archived,class:"px-5 py-3 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-lg hover:from-amber-600 hover:to-orange-700 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:from-gray-500 disabled:to-gray-600",title:(on=M.value)!=null&&on.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[137]||(m[137]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,G5),h("div",{class:"relative",ref_key:"eventMoreActionsRef",ref:be},[h("button",{onClick:m[39]||(m[39]=H=>rt()),class:"px-5 py-3 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 flex items-center gap-2",title:"Plus d'actions"},m[138]||(m[138]=[h("span",null,"⋯",-1),h("span",null,"Plus",-1)]))],512),h("button",{onClick:nv,class:"px-5 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"},"Fermer"),(V(),ko(fu,{to:"body"},[_e.value?(V(),O("div",{key:0,ref_key:"eventMoreActionsDropdownRef",ref:we,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden",style:mr(ge.value)},[h("button",{onClick:m[40]||(m[40]=H=>{rv(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[139]||(m[139]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[41]||(m[41]=H=>{sv(),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10",title:(_t=M.value)!=null&&_t.archived?"Désarchiver cet événement":"Archiver cet événement"},[h("span",null,ae((pr=M.value)!=null&&pr.archived?"📂":"📁"),1),h("span",null,ae((Lr=M.value)!=null&&Lr.archived?"Désarchiver":"Archiver"),1)],8,H5),h("button",{onClick:m[42]||(m[42]=H=>{var Jt;Ll((Jt=M.value)==null?void 0:Jt.id),_e.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[140]||(m[140]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ye("",!0)]))])]),h("div",W5,[h("button",{onClick:m[43]||(m[43]=H=>vo(M.value)),class:"h-12 px-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300 flex-[1.4]"},"🎭 Sélectionner"),h("button",{onClick:nv,class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex-1"},"Fermer"),h("button",{onClick:m[44]||(m[44]=H=>mn()),class:"h-12 px-4 bg-gray-700 text-white rounded-lg flex items-center justify-center w-12"},"⋯")])])])):ye("",!0),(V(),ko(fu,{to:"body"},[ie.value?(V(),O("div",{key:0,ref_key:"eventMoreActionsMobileDropdownRef",ref:Me,class:"w-48 bg-gray-900 border border-white/10 rounded-xl shadow-2xl z-[400] overflow-hidden md:hidden",style:mr(xe.value)},[h("button",{onClick:m[46]||(m[46]=H=>{qc(M.value),ie.value=!1}),disabled:(yo=M.value)==null?void 0:yo.archived,class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10 disabled:opacity-50 disabled:cursor-not-allowed",title:(_a=M.value)!=null&&_a.archived?"Impossible d'annoncer un événement archivé":"Annoncer l'événement aux joueurs (email, copie, WhatsApp)"},m[141]||(m[141]=[h("span",null,"📢",-1),h("span",null,"Annoncer",-1)]),8,Q5),h("button",{onClick:m[47]||(m[47]=H=>{rv(),ie.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},m[142]||(m[142]=[h("span",null,"✏️",-1),h("span",null,"Modifier",-1)])),h("button",{onClick:m[48]||(m[48]=H=>{sv(),ie.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2 border-b border-white/10"},[h("span",null,ae((dv=M.value)!=null&&dv.archived?"📂":"📁"),1),h("span",null,ae((hv=M.value)!=null&&hv.archived?"Désarchiver":"Archiver"),1)]),h("button",{onClick:m[49]||(m[49]=H=>{var Jt;Ll((Jt=M.value)==null?void 0:Jt.id),ie.value=!1}),class:"w-full text-left px-4 py-3 text-white hover:bg-white/10 flex items-center gap-2"},m[143]||(m[143]=[h("span",null,"🗑️",-1),h("span",null,"Supprimer",-1)]))],4)):ye("",!0)])),st(Hg,{show:kr.value,player:$t.value,seasonId:o.value,onClose:m[50]||(m[50]=H=>kr.value=!1),onVerified:yT},null,8,["show","player","seasonId"]),d.value?(V(),O("div",J5,[h("div",Y5,[m[149]||(m[149]=h("h2",{class:"text-2xl font-bold mb-6 text-white text-center"},"✏️ Modifier l'événement",-1)),h("div",X5,[m[144]||(m[144]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Titre",-1)),tt(h("input",{"onUpdate:modelValue":m[51]||(m[51]=H=>f.value=H),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",onKeydown:[Un(ro,["esc"]),Un(Jr,["enter"])],ref:"editTitleInput"},null,544),[[Nt,f.value]])]),h("div",Z5,[m[145]||(m[145]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Date",-1)),tt(h("input",{"onUpdate:modelValue":m[52]||(m[52]=H=>g.value=H),type:"date",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:[Un(ro,["esc"]),Un(Jr,["enter"])]},null,544),[[Nt,g.value]])]),h("div",ej,[m[146]||(m[146]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Description",-1)),tt(h("textarea",{"onUpdate:modelValue":m[53]||(m[53]=H=>le.value=H),class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",rows:"3",placeholder:"Description de l'événement (optionnel)",onKeydown:Un(ro,["esc"])},null,544),[[Nt,le.value]])]),h("div",tj,[tt(h("input",{id:"edit-archived",type:"checkbox","onUpdate:modelValue":m[54]||(m[54]=H=>ne.value=H),class:"w-4 h-4"},null,512),[[Ii,ne.value]]),m[147]||(m[147]=h("label",{for:"edit-archived",class:"text-sm font-medium text-gray-300"},"Archiver cet événement",-1))]),h("div",nj,[m[148]||(m[148]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nombre de joueurs à sélectionner",-1)),tt(h("input",{"onUpdate:modelValue":m[55]||(m[55]=H=>y.value=H),type:"number",min:"1",max:"20",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white",onKeydown:Un(ro,["esc"])},null,544),[[Nt,y.value]])]),h("div",{class:"flex justify-end space-x-3"},[h("button",{onClick:ro,class:"px-6 py-3 text-gray-300 hover:text-white transition-colors"}," Annuler "),h("button",{onClick:Jr,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Sauvegarder ")])])])):ye("",!0),st(_x,{show:L.value,message:K(),error:C.value,"session-info":Bl(),onSubmit:Tt,onCancel:vn},null,8,["show","message","error","session-info"]),ht.value?(V(),O("div",rj,[h("div",sj,[m[151]||(m[151]=Xn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-2">Vérification requise</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p><p class="text-sm text-gray-400 mt-2">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",ij,[h("div",oj,[h("div",null,[m[150]||(m[150]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(h("input",{"onUpdate:modelValue":m[56]||(m[56]=H=>U.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[57]||(m[57]=Un(H=>ut(U.value),["enter"])),ref_key:"playerPasswordInputRef",ref:re},null,544),[[Nt,U.value]])])]),h("button",{onClick:m[58]||(m[58]=H=>ut(U.value)),disabled:!U.value||W.value,class:"w-full mt-4 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[W.value?(V(),O("span",lj,"⏳")):(V(),O("span",uj,"🔓")),h("span",null,ae(W.value?"Vérification...":"Vérifier et supprimer"),1)],8,aj)]),h("div",cj,[h("button",{onClick:m[59]||(m[59]=H=>oe.value=!0),class:"text-sm text-red-400 hover:text-red-300 transition-colors underline"}," Mot de passe oublié ? ")]),ee.value?(V(),O("div",dj,[h("div",hj,ae(ee.value),1)])):ye("",!0),h("div",{class:"flex justify-center"},[h("button",{onClick:Tn,class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Annuler ")])])])):ye("",!0),Se.value?(V(),O("div",fj,[h("div",pj,[m[154]||(m[154]=Xn('<div class="text-center p-6 pb-4 border-b border-white/10"><div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center"><span class="text-2xl">🔐</span></div><h2 class="text-2xl font-bold text-white mb-1">Vérification requise</h2><p class="text-base text-gray-300">Modification de disponibilité</p><p class="text-sm text-gray-400 mt-1">Ce joueur est protégé par mot de passe</p></div>',1)),h("div",mj,[h("div",gj,[h("div",null,[m[152]||(m[152]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Mot de passe du joueur",-1)),tt(h("input",{"onUpdate:modelValue":m[60]||(m[60]=H=>Ee.value=H),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Entrez le mot de passe",onKeydown:m[61]||(m[61]=Un(H=>yn(Ee.value),["enter"])),ref_key:"availabilityPasswordInputRef",ref:ft},null,544),[[Nt,Ee.value]])])]),h("div",vj,[h("button",{onClick:m[62]||(m[62]=H=>vt.value=!0),class:"text-sm text-blue-400 hover:text-blue-300 transition-colors underline"}," Mot de passe oublié ? ")]),Q.value?(V(),O("div",yj,[h("div",_j,ae(Q.value),1)])):ye("",!0)]),h("div",bj,[h("button",{onClick:ii,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex-1 text-sm md:text-base whitespace-nowrap"}," Annuler "),h("button",{onClick:m[63]||(m[63]=H=>yn(Ee.value)),disabled:!Ee.value||We.value,class:"h-12 px-3 md:px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 flex-1 text-sm md:text-base whitespace-nowrap"},[We.value?(V(),O("span",Ij,"⏳")):(V(),O("span",Ej,"🔓")),h("span",null,[Yt(ae(We.value?"Vérification...":"Vérifier"),1),m[153]||(m[153]=h("span",{class:"hidden sm:inline"}," et modifier",-1))])],8,wj)])])])):ye("",!0),vt.value?(V(),O("div",{key:14,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[66]||(m[66]=H=>vt.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[65]||(m[65]=mt(()=>{},["stop"]))},[m[156]||(m[156]=Xn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Modification de disponibilité</p></div>',1)),h("div",xj,[m[155]||(m[155]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:fr,disabled:D.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[D.value?(V(),O("span",Aj,"⏳")):(V(),O("span",Sj,"📧")),h("span",null,ae(D.value?"Envoi...":"Envoyer l'email"),1)],8,Tj)]),$.value?(V(),O("div",Pj,[h("div",Rj,ae($.value),1)])):ye("",!0),te.value?(V(),O("div",Cj,[h("div",kj,ae(te.value),1)])):ye("",!0),h("div",Dj,[h("button",{onClick:m[64]||(m[64]=H=>vt.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ye("",!0),oe.value?(V(),O("div",{key:15,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[120] p-4",onClick:m[69]||(m[69]=H=>oe.value=!1)},[h("div",{class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md",onClick:m[68]||(m[68]=mt(()=>{},["stop"]))},[m[158]||(m[158]=Xn('<div class="text-center mb-6"><div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-red-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-2xl">📧</span></div><h2 class="text-2xl font-bold text-white mb-2">Mot de passe oublié</h2><p class="text-lg text-gray-300">Suppression de joueur protégé</p></div>',1)),h("div",Nj,[m[157]||(m[157]=h("p",{class:"text-sm text-gray-300 mb-4"}," Un email de réinitialisation sera envoyé à l'adresse associée à ce joueur. ",-1)),h("button",{onClick:va,disabled:Ve.value,class:"w-full px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:from-orange-600 hover:to-red-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[Ve.value?(V(),O("span",Oj,"⏳")):(V(),O("span",Mj,"📧")),h("span",null,ae(Ve.value?"Envoi...":"Envoyer l'email"),1)],8,Vj)]),qe.value?(V(),O("div",Lj,[h("div",Fj,ae(qe.value),1)])):ye("",!0),I.value?(V(),O("div",$j,[h("div",Uj,ae(I.value),1)])):ye("",!0),h("div",jj,[h("button",{onClick:m[67]||(m[67]=H=>oe.value=!1),class:"px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-300"}," Fermer ")])])])):ye("",!0),st(c3,{ref_key:"playerModalRef",ref:N,show:w.value,player:x.value,stats:wT(x.value),seasonId:o.value,"onboarding-step":Wt.value,"onboarding-player-id":B.value,"is-protected":x.value?ur.value.has(x.value.id):!1,"is-preferred":x.value?Xr.value.has(x.value.id):!1,onClose:iv,onUpdate:_T,onDelete:p,onRefresh:bT,onAdvanceOnboarding:m[70]||(m[70]=H=>{try{typeof Wt.value<"u"&&(Wt.value.value=H)}catch{}})},null,8,["show","player","stats","seasonId","onboarding-step","onboarding-player-id","is-protected","is-preferred"]),st(tF,{ref_key:"selectionModalRef",ref:ms,show:qr.value,event:gn.value,"current-selection":pt.value[(fv=gn.value)==null?void 0:fv.id]||[],"available-count":xr((pv=gn.value)==null?void 0:pv.id),"selected-count":ho((mv=gn.value)==null?void 0:mv.id),"player-availability":mf((gv=gn.value)==null?void 0:gv.id),"season-id":o.value,"season-slug":is(s),players:ys.value,onClose:lv,onSelection:xT,onPerfect:TT,onSendNotifications:av,onUpdateSelection:AT},null,8,["show","event","current-selection","available-count","selected-count","player-availability","season-id","season-slug","players"]),st($x,{show:Wi.value,event:_r.value,"season-id":o.value,"season-slug":is(s),players:ys.value,sending:pf.value,"availability-by-player":mf((vv=_r.value)==null?void 0:vv.id),onClose:ET,onSendNotifications:av},null,8,["show","event","season-id","season-slug","players","sending","availability-by-player"]),st(bx,{show:Ji.value,onClose:m[71]||(m[71]=H=>Ji.value=!1)},null,8,["show"]),st(P6,{show:Dr.value,"season-id":o.value,onClose:vs,onManagePlayer:af,onChangePassword:sf,onLogoutDevice:of,onDeleteAccount:Ys},null,8,["show","season-id"]),st(jx,{show:ia.value,player:kl.value,"season-id":o.value,onClose:m[72]||(m[72]=H=>ia.value=!1),onSuccess:m[73]||(m[73]=()=>{ia.value=!1,Dr.value=!0})},null,8,["show","player","season-id"]),st(F6,{show:hn.value,onClose:m[74]||(m[74]=H=>hn.value=!1),onSuccess:m[75]||(m[75]=()=>{hn.value=!1,Dr.value=!0})},null,8,["show"]),Qi.value?(V(),O("div",Bj,[h("div",qj,[m[159]||(m[159]=h("h3",{class:"text-xl font-bold text-white mb-4 text-center"},"Voulez-vous annoncer cet événement ?",-1)),m[160]||(m[160]=h("p",{class:"text-gray-300 text-center mb-6"},"Envoyer des notifications aux joueurs pour qu'ils indiquent leur disponibilité",-1)),h("div",zj,[h("button",{onClick:m[76]||(m[76]=H=>qc(gs.value)),class:"flex-1 px-4 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300"}," 📢 Oui "),h("button",{onClick:ov,class:"flex-1 px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-300"}," Plus tard ")])])])):ye("",!0)],64)}}},Kj={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},Gj={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md"},Hj={key:0,class:"text-center py-8"},Wj={key:1,class:"text-center py-8"},Qj={class:"text-gray-300 mb-6"},Jj={key:2,class:"space-y-6"},Yj={class:"text-center"},Xj={class:"text-gray-300"},Zj={class:"font-semibold text-white"},eB={class:"space-y-4"},tB=["disabled"],nB={key:0,class:"animate-spin"},rB={key:1},sB={key:0,class:"p-4 bg-red-500/20 border border-red-500/30 rounded-lg"},iB={class:"text-red-300 text-sm"},oB={key:1,class:"p-4 bg-green-500/20 border border-green-500/30 rounded-lg"},aB={class:"text-green-300 text-sm"},lB={__name:"PasswordReset",setup(n){const e=hl(),t=dl(),r=P(!0),s=P(""),i=P(""),o=P(""),a=P(""),l=P(""),c=P(!1),d=P(""),f=P(""),g=Ue(()=>a.value&&l.value&&a.value===l.value&&a.value.length>=6);zn(async()=>{try{const{oobCode:A}=e.query;if(ce.debug("Token reçu (masqué)"),!A){s.value="Lien de réinitialisation incomplet",r.value=!1;return}o.value=A,i.value="patrice.lamarque+ron@gmail.com",r.value=!1}catch(A){ce.error("Erreur lors de la vérification du lien",A),s.value="Erreur lors de la vérification du lien",r.value=!1}});async function y(){if(g.value){c.value=!0,d.value="",f.value="";try{ce.debug("Début réinitialisation avec token (masqué)"),await AN(gt,o.value,a.value),ce.info("Mot de passe Firebase Auth mis à jour"),ce.info("Réinitialisation terminée avec Firebase Auth"),f.value="Mot de passe réinitialisé avec succès ! Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",setTimeout(()=>{E()},3e3)}catch(A){ce.error("Erreur lors de la réinitialisation",A),A.code==="auth/weak-password"?d.value="Le mot de passe doit contenir au moins 6 caractères":A.code==="auth/invalid-action-code"?d.value="Lien de réinitialisation invalide ou expiré":d.value="Erreur lors de la réinitialisation. Veuillez réessayer."}finally{c.value=!1}}}function E(){t.push("/seasons")}return(A,R)=>(V(),O("div",Kj,[h("div",Gj,[R[8]||(R[8]=Xn('<div class="text-center mb-6"><div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-3xl">🔑</span></div><h1 class="text-3xl font-bold text-white mb-2">Réinitialisation</h1><p class="text-lg text-gray-300">Nouveau mot de passe</p></div>',1)),r.value?(V(),O("div",Hj,R[2]||(R[2]=[h("div",{class:"animate-spin w-8 h-8 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4"},null,-1),h("p",{class:"text-gray-300"},"Vérification du lien...",-1)]))):s.value?(V(),O("div",Wj,[R[3]||(R[3]=h("div",{class:"w-16 h-16 bg-gradient-to-br from-red-400 to-red-600 rounded-full mx-auto mb-4 flex items-center justify-center"},[h("span",{class:"text-2xl"},"❌")],-1)),R[4]||(R[4]=h("h2",{class:"text-xl font-bold text-white mb-2"},"Lien invalide",-1)),h("p",Qj,ae(s.value),1),h("button",{onClick:E,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300"}," Retour à l'accueil ")])):i.value?(V(),O("div",Jj,[h("div",Yj,[h("p",Xj,[R[5]||(R[5]=Yt("Email : ")),h("span",Zj,ae(i.value),1)])]),h("div",eB,[h("div",null,[R[6]||(R[6]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Nouveau mot de passe",-1)),tt(h("input",{"onUpdate:modelValue":R[0]||(R[0]=B=>a.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Nouveau mot de passe",onKeydown:Un(y,["enter"])},null,544),[[Nt,a.value]])]),h("div",null,[R[7]||(R[7]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Confirmer le mot de passe",-1)),tt(h("input",{"onUpdate:modelValue":R[1]||(R[1]=B=>l.value=B),type:"password",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Confirmer le mot de passe",onKeydown:Un(y,["enter"])},null,544),[[Nt,l.value]])])]),h("button",{onClick:y,disabled:!g.value||c.value,class:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2"},[c.value?(V(),O("span",nB,"⏳")):(V(),O("span",rB,"🔑")),h("span",null,ae(c.value?"Réinitialisation...":"Réinitialiser le mot de passe"),1)],8,tB),d.value?(V(),O("div",sB,[h("div",iB,ae(d.value),1)])):ye("",!0),f.value?(V(),O("div",oB,[h("div",aB,ae(f.value),1)])):ye("",!0)])):ye("",!0)])]))}},uB={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4"},cB={class:"bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center"},dB={class:"text-3xl"},hB={class:"text-2xl font-bold text-white mb-2"},fB={class:"text-gray-300 mb-6"},pB={__name:"MagicLink",setup(n){const e=hl(),t=dl(),r=P("loading"),s=P("Traitement en cours..."),i=P("Merci de patienter pendant la validation du lien."),o=Ue(()=>r.value==="loading"?"⏳":r.value==="ok"?"✅":"❌");function a(){const l=e.query.slug;l?t.push(`/season/${l}`):t.push("/seasons")}return zn(async()=>{var l;try{wx("firebase");const c=String(e.query.sid||""),d=String(e.query.pid||"");let f=String(e.query.eid||"");const g=String(e.query.t||""),y=String(e.query.a||""),E=String(e.query.slug||"");if(!g||!y){r.value="error",s.value="Lien invalide",i.value="Paramètres manquants.";return}if(y==="account_email_update"){const z=await Ax({token:g});if(!z.valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}try{await DN(gt.currentUser,z.data.newEmail),await Sx({token:g}),r.value="ok",s.value="Email mis à jour",i.value="Votre adresse email a été mise à jour avec succès."}catch{r.value="error",s.value="Action impossible",i.value="Veuillez vous reconnecter puis réessayer."}return}if(y==="verify_email"&&(f="protection"),!(await xx({seasonId:c,playerId:d,eventId:f,token:g,action:y})).valid){r.value="error",s.value="Lien invalide",i.value="Le lien est invalide ou expiré.";return}if(y==="verify_email"){await kx({playerId:d,seasonId:c});try{await Mx({playerId:d,seasonId:c})}catch{}await Hp({seasonId:c,playerId:d,eventId:"protection",action:y}),r.value="ok",s.value="Email vérifié",i.value="Merci ! Vous pouvez maintenant définir votre mot de passe.",setTimeout(E?()=>t.push(`/season/${E}?player=${encodeURIComponent(d)}&verified=1`):()=>t.push("/seasons"),800);return}const R=Pe(ue,"seasons",c,"players",d),B=await zt(R),q=B.exists()&&B.data().name||"";if(!q){r.value="error",s.value="Lien invalide",i.value="Joueur introuvable.";return}if(await sM({seasonId:c,playerName:q,eventId:f,value:y==="yes"}),y==="no")try{const z=Pe(ue,"seasons",c,"selections",f),de=await zt(z);if(de.exists()){const me=Array.isArray((l=de.data())==null?void 0:l.players)?de.data().players:[],T=me.filter(w=>w!==q);T.length!==me.length&&await setDoc(z,{players:T},{merge:!0})}}catch{}await Hp({seasonId:c,playerId:d,eventId:f,action:y}),r.value="ok",s.value="Merci !",i.value=y==="yes"?"Votre disponibilité a été enregistrée: Disponible.":"Votre disponibilité a été enregistrée: Non disponible. (Si vous étiez sélectionné(e), vous avez été retiré(e) de la sélection.)",setTimeout(E?()=>t.push(`/season/${E}/event/${f}`):()=>t.push("/seasons"),1200)}catch(c){ce.error("Magic link error",c),r.value="error",s.value="Erreur",i.value="Impossible de traiter votre lien."}}),(l,c)=>(V(),O("div",uB,[h("div",cB,[h("div",{class:St(["w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center",r.value==="ok"?"bg-green-500":r.value==="loading"?"bg-blue-500":"bg-red-500"])},[h("span",dB,ae(o.value),1)],2),h("h1",hB,ae(s.value),1),h("p",fB,ae(i.value),1),h("button",{onClick:a,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all duration-300"}," Ouvrir la saison ")])]))}},mB={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900"},gB={class:"text-center py-12 px-4"},vB={class:"text-4xl font-bold text-white mb-2 bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent"},yB={class:"container mx-auto px-4 pb-16"},_B={class:"max-w-xl mx-auto bg-gradient-to-br from-gray-900 to-gray-800 border border-white/20 p-8 rounded-2xl shadow-2xl"},bB={class:"space-y-5"},wB=["onKeydown"],IB={class:"flex items-center justify-end gap-3 pt-2"},EB=["disabled"],xB={key:0,class:"mt-6 text-sm text-gray-200"},TB={__name:"JoinSeason",setup(n){const e=hl(),t=dl(),r=e.params.slug,s=P(""),i=P(""),o=P(""),a=P(!1),l=P("");zn(async()=>{const f=Gu(Ye(ue,"seasons"),Yd("slug","==",r)),g=await Et(f);if(g.empty)l.value="Saison introuvable";else{const y=g.docs[0];s.value=y.id,i.value=y.data().name,document.title=`Rejoindre : ${i.value}`}});function c(){t.push(`/season/${r}`)}async function d(){if(!(!o.value.trim()||!s.value)){a.value=!0,l.value="";try{await Ix(o.value.trim(),s.value),l.value="Inscription réussie. Vous pouvez maintenant indiquer vos disponibilités.";try{localStorage.setItem(`startPlayerTour:${s.value}`,"1"),localStorage.setItem(`dismissCreatorOnboarding:${s.value}`,"1")}catch{}setTimeout(()=>{c()},600)}catch(f){ce.error("Erreur inscription",f),l.value=`Erreur lors de l'inscription: ${(f==null?void 0:f.message)||"Veuillez réessayer"}`}finally{a.value=!1}}}return(f,g)=>(V(),O("div",mB,[h("div",gB,[h("h1",vB,ae(i.value||"Rejoindre la saison"),1),g[1]||(g[1]=h("p",{class:"text-gray-300"},"Inscrivez-vous pour indiquer vos disponibilités aux événements",-1))]),h("div",yB,[h("div",_B,[g[3]||(g[3]=h("h2",{class:"text-2xl font-bold text-white mb-6 text-center"},"Je rejoins la saison",-1)),h("div",bB,[h("div",null,[g[2]||(g[2]=h("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Votre nom",-1)),tt(h("input",{"onUpdate:modelValue":g[0]||(g[0]=y=>o.value=y),type:"text",class:"w-full p-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400",placeholder:"Ex: Marie Dupont",onKeydown:Un(mt(d,["prevent"]),["enter"])},null,40,wB),[[Nt,o.value]])]),h("div",IB,[h("button",{onClick:c,class:"px-5 py-3 text-gray-300 hover:text-white transition-colors"},"Annuler"),h("button",{disabled:!o.value.trim()||a.value,onClick:d,class:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-300"}," Rejoindre ",8,EB)])]),l.value?(V(),O("div",xB,ae(l.value),1)):ye("",!0)])])]))}};{const n=()=>{};console.debug=n,console.log=n,console.info=n}const AB=[{path:"/",component:FO},{path:"/seasons",component:FM},{path:"/season/:slug",component:E_,props:!0},{path:"/season/:slug/event/:eventId",component:E_,props:!0},{path:"/season/:slug/join",component:TB,props:!0},{path:"/reset-password",component:lB},{path:"/magic",component:pB}],SB=XS({history:SS("/"),routes:AB}),pT=G1(J1);pT.use(SB);pT.mount("#app");nP({immediate:!0,onRegistered(n){window.__swReg=n}});export{Ye as $,bE as A,Wo as B,ls as C,cn as D,kq as E,Zo as F,ug as G,Cq as H,DB as I,Rr as J,q2 as K,K2 as L,Al as M,sq as N,iq as O,gD as P,Fn as Q,QB as R,LB as S,Gt as T,Iq as U,Oh as V,fD as W,mD as X,rq as Y,UB as Z,cw as _,qu as a,Ic as a$,OB as a0,z2 as a1,nD as a2,Rq as a3,ul as a4,wq as a5,qB as a6,Pq as a7,Pe as a8,HB as a9,GB as aA,dq as aB,hq as aC,WB as aD,eD as aE,vq as aF,yq as aG,dD as aH,Gu as aI,oE as aJ,MB as aK,bq as aL,Hi as aM,Zt as aN,Tq as aO,PB as aP,oq as aQ,ZB as aR,XB as aS,nq as aT,zB as aU,Tl as aV,xq as aW,jB as aX,Yd as aY,bg as aZ,Lq as a_,H2 as aa,$B as ab,BB as ac,Sq as ad,tq as ae,eq as af,Ht as ag,yc as ah,sD as ai,fq as aj,zt as ak,aq as al,lq as am,Et as an,uq as ao,cq as ap,G2 as aq,Aq as ar,Eq as as,FB as at,JB as au,YB as av,KB as aw,pq as ax,gq as ay,mq as az,W2 as b,wN as b$,wc as b0,$q as b1,Ju as b2,ra as b3,yi as b4,Nq as b5,bi as b6,_i as b7,Bs as b8,wd as b9,RD as bA,o9 as bB,_9 as bC,G0 as bD,lV as bE,JD as bF,e9 as bG,Hq as bH,IN as bI,c9 as bJ,m9 as bK,y9 as bL,a9 as bM,BN as bN,UN as bO,jq as bP,yD as bQ,EN as bR,d9 as bS,p9 as bT,v9 as bU,DD as bV,s9 as bW,Jq as bX,TN as bY,Gq as bZ,$N as b_,Mq as ba,Fo as bb,Ba as bc,dO as bd,Vq as be,l9 as bf,Up as bg,Oq as bh,hO as bi,jg as bj,wi as bk,zq as bl,jN as bm,ex as bn,cO as bo,nx as bp,SN as bq,AN as br,XD as bs,PN as bt,Fq as bu,i9 as bv,Qq as bw,Zq as bx,_O as by,Uq as bz,al as c,Cg as c0,qq as c1,RN as c2,Wq as c3,u9 as c4,f9 as c5,g9 as c6,qN as c7,Bq as c8,r9 as c9,DN as ca,NN as cb,h9 as cc,Xq as cd,n9 as ce,t9 as cf,Yq as cg,Kq as ch,ea as d,kt as e,pe as f,xl as g,gc as h,yd as i,Bh as j,vc as k,Uh as l,yg as m,ll as n,jh as o,Do as p,pD as q,en as r,Uo as s,Re as t,CB as u,MR as v,Bt as w,Dq as x,nt as y,RB as z};
